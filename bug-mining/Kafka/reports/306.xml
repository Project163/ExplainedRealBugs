<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:38:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-957] MirrorMaker needs to preserve the key in the source cluster</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-957</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, MirrorMaker only propagates the message to the target cluster, but not the associated key.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655965">KAFKA-957</key>
            <summary>MirrorMaker needs to preserve the key in the source cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Jul 2013 04:51:06 +0000</created>
                <updated>Wed, 24 Jul 2013 18:44:26 +0000</updated>
                            <resolved>Wed, 24 Jul 2013 18:44:20 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13702667" author="guozhang" created="Tue, 9 Jul 2013 00:14:26 +0000"  >&lt;p&gt;The proposed design is the following:&lt;/p&gt;

&lt;p&gt;1. Keep the ProducerDataChannel for non-keyed messages.&lt;/p&gt;

&lt;p&gt;2. For each message in the consumers&apos; stream, check if its key is null:&lt;/p&gt;

&lt;p&gt;2.1. If yes, put it directly to the ProducerDataChannel.&lt;/p&gt;

&lt;p&gt;2.2. If not, select the producer based on the key&apos;s hash value, and call the send function of that producer directly (would possibly block).&lt;/p&gt;

&lt;p&gt;Patch will be available once the system tests are passed.&lt;/p&gt;</comment>
                            <comment id="13706578" author="guozhang" created="Fri, 12 Jul 2013 02:22:43 +0000"  >&lt;p&gt;4. Add a ByteArrayPartitioner since Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;.hashCode will result in different values for objects even with the same content. Enforce MirrorMaker to use this ByteArray Partitioner&lt;/p&gt;

&lt;p&gt;Passed MirrorMaker testcase 5001&lt;/p&gt;</comment>
                            <comment id="13710525" author="guozhang" created="Wed, 17 Jul 2013 00:23:24 +0000"  >&lt;p&gt;5. Use java.util.Arrays.hashCode to determine which producer to send a keyed message&lt;/p&gt;

&lt;p&gt;6. Check if the partitioner class is specified instead of always trying to override the partitioner.&lt;/p&gt;

&lt;p&gt;Passed testcase 5007 referring to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-976&quot; title=&quot;Order-Preserving Mirror Maker Testcase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-976&quot;&gt;&lt;del&gt;KAFKA-976&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13710571" author="jjkoshy" created="Wed, 17 Jul 2013 01:06:06 +0000"  >&lt;p&gt;Thanks for incorporating 5 and 6. Couple additional comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For the two match statements you have it is probably sufficient and&lt;br/&gt;
  clearer to just use if (key == null) .... and if (props.contains(..))&lt;/li&gt;
	&lt;li&gt;I&apos;m not so sure if the trace is required but it could be useful. Would&lt;br/&gt;
  prefer the following format: &quot;Sending message with key &amp;lt;key&amp;gt;&quot; - no need to&lt;br/&gt;
  show the payload. Also, may want to use java.util.Arrays.toString on the&lt;br/&gt;
  byte array.&lt;/li&gt;
	&lt;li&gt;Per Jay&apos;s offline comments, hashCode in general is a bit unsafe to &quot;rely&quot;.&lt;br/&gt;
  For e.g., it could be a non-uniform distribution or the underlying&lt;br/&gt;
  function could change. That said, your usage is safe. Still, it should be&lt;br/&gt;
  straightforward to do a custom hash function that we can rely on for&lt;br/&gt;
  consistency.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13710609" author="guozhang" created="Wed, 17 Jul 2013 02:01:35 +0000"  >&lt;p&gt;Thanks for the comment.&lt;/p&gt;

&lt;p&gt;For the first comment, since I needed to make a var for creating the config object if I use if () instead of match, I did not incorporate that. For the second match I have changed it to &quot;if&quot;.&lt;/p&gt;</comment>
                            <comment id="13718597" author="guozhang" created="Wed, 24 Jul 2013 17:21:17 +0000"  >&lt;p&gt;7. Use Utils.abs to make sure the result of the hashCode function would be always non-negative.&lt;/p&gt;</comment>
                            <comment id="13718690" author="jjkoshy" created="Wed, 24 Jul 2013 18:44:09 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13718691" author="jjkoshy" created="Wed, 24 Jul 2013 18:44:20 +0000"  >&lt;p&gt;Committed to 0.8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12591954" name="KAFKA-957.v1.patch" size="4841" author="guozhang" created="Fri, 12 Jul 2013 02:22:43 +0000"/>
                            <attachment id="12592690" name="KAFKA-957.v2.patch" size="5139" author="guozhang" created="Wed, 17 Jul 2013 00:41:06 +0000"/>
                            <attachment id="12592686" name="KAFKA-957.v2.patch" size="3743" author="guozhang" created="Wed, 17 Jul 2013 00:23:24 +0000"/>
                            <attachment id="12592705" name="KAFKA-957.v3.patch" size="4954" author="guozhang" created="Wed, 17 Jul 2013 02:01:35 +0000"/>
                            <attachment id="12593981" name="KAFKA-957.v4.patch" size="4965" author="guozhang" created="Wed, 24 Jul 2013 17:21:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336240</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lzyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>