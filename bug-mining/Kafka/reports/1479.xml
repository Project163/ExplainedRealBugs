<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:01:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5232] Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&apos;t been deleted during previous uptime</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5232</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We are using 0.10.2.0 (but this is reproducible even with 0.10.2.1 and latest upstream) in our environments. Our topic names contain (one or more) dot characters in their name. So we have topics like &lt;tt&gt;foo.bar-testtopic&lt;/tt&gt;. Topic deletion is enabled on the broker(s) and our application does delete the topics as and when necessary.&lt;/p&gt;

&lt;p&gt;We just ran into a case today where for some reason the Kafka broker had either to be taken down (or went down on its own). Some of the topics which were deleted (i.e. a deletion marker folder was created for them) were left around after Kafka broker had gone down. So the Kafka logs dir had directories like &lt;tt&gt;foo.bar-testtopic-0.bb7981c216b845648edfe6e2b0a5c050-delete&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When we restarted the Kafka broker, it refused to start and kept shutting down and running into this exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2017-05-12 21:36:27,876] ERROR There was an error in one of the threads during logs loading: java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: -1 (kafka.log.LogManager)
[2017-05-12 21:36:27,900] FATAL [Kafka Server 0], Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)
java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: -1
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.substring(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:1967)
	at kafka.log.Log$.parseTopicPartitionName(Log.scala:1146)
	at kafka.log.LogManager.$anonfun$loadLogs$10(LogManager.scala:153)
	at kafka.utils.CoreUtils$$anon$1.run(CoreUtils.scala:57)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
[2017-05-12 21:36:27,950] INFO [Kafka Server 0], shutting down (kafka.server.KafkaServer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only way we could get past this is pointing Kafka broker to a different Kafka logs directory which effectively meant a lot our topics were no longer accessible to the application.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13071755">KAFKA-5232</key>
            <summary>Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&apos;t been deleted during previous uptime</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jaikiran">Jaikiran Pai</assignee>
                                    <reporter username="jaikiran">Jaikiran Pai</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 May 2017 12:12:55 +0000</created>
                <updated>Wed, 17 May 2017 14:38:57 +0000</updated>
                            <resolved>Mon, 15 May 2017 12:10:32 +0000</resolved>
                                    <version>0.10.2.0</version>
                    <version>0.10.2.1</version>
                                    <fixVersion>0.10.2.2</fixVersion>
                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16009307" author="githubbot" created="Sat, 13 May 2017 12:26:06 +0000"  >&lt;p&gt;GitHub user jaikiran opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3043&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt; Fix Log.parseTopicPartitionName to take into account dot character in topic names of deleted topics&lt;/p&gt;

&lt;p&gt;    The commit here contains a fix and testcase for the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-5232&lt;/a&gt;, where if a topic marked for deletion, has a `.` character in its name then the Kafka broker fails to start and keeps shutting down&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jaikiran/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jaikiran/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3043.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3043&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 512fc57e3fe9482d5b059bb2279a04a3640ccde5&lt;br/&gt;
Author: Jaikiran Pai &amp;lt;jaikiran.pai@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-13T12:15:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt; Fix the bug where the Log.parseTopicPartitionName wasn&apos;t taking into account the potential presence of &apos;.&apos; character in topic names while looking for topics that are marked for deletion&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16009309" author="jaikiran" created="Sat, 13 May 2017 12:26:54 +0000"  >&lt;p&gt;I just submitted a PR which contains a fix and includes a testcase to test this fix &lt;a href=&quot;https://github.com/apache/kafka/pull/3043&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16009314" author="jaikiran" created="Sat, 13 May 2017 12:34:32 +0000"  >&lt;p&gt;One of the crude (but easy) way to reproduce this issue is as follows:&lt;/p&gt;

&lt;p&gt;1. Bring up Zookeeper and Kafka broker and create a topic (which has dot in its name).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./kafka-topics.sh --create --topic hello.world-testtopic --replication-factor 1 --partitions 1 --zookeeper localhost:2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. Let&apos;s assume &lt;tt&gt;/tmp/kafka-logs&lt;/tt&gt; is where Kafka is configured for its topic logs. Now let&apos;s delete the newly created topic&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./kafka-topics.sh --delete --topic hello.world-testtopic --zookeeper localhost:2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. Immediately as soon as this topic deletion command succeeds &lt;tt&gt;kill -9 &amp;lt;kafka-broker-pid&amp;gt;&lt;/tt&gt; to replicate the case where for whatever reason, Kafka broker didn&apos;t delete the topics that have been marked for deletion.&lt;/p&gt;

&lt;p&gt;4. Make sure the topic that we deleted is still lying around marked for deletion, in the topic logs directory, by running:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ls /tmp/kafka-logs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You should see a directory like this, in there &lt;tt&gt;hello.world-testtopic-0.&amp;lt;some-unique-id&amp;gt;-delete&lt;/tt&gt;. If you don&apos;t find such a directory in there, repeat steps 1 to 4 above till you end up in a state where Kafka broker hasn&apos;t been able to trigger the deletion of the topic. Only then move to step 5.&lt;/p&gt;

&lt;p&gt;5. Now that the topic, with the dot character, that is marked for deletion is lying around, start the Kafka broker. You will see exceptions like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2017-05-12 21:36:27,876] ERROR There was an error in one of the threads during logs loading: java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: -1 (kafka.log.LogManager)
[2017-05-12 21:36:27,900] FATAL [Kafka Server 0], Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)
java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: -1
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.substring(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:1967)
	at kafka.log.Log$.parseTopicPartitionName(Log.scala:1146)
	at kafka.log.LogManager.$anonfun$loadLogs$10(LogManager.scala:153)
	at kafka.utils.CoreUtils$$anon$1.run(CoreUtils.scala:57)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
[2017-05-12 21:36:27,950] INFO [Kafka Server 0], shutting down (kafka.server.KafkaServer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and Kafka broker never starts and keeps shutting down.&lt;/p&gt;</comment>
                            <comment id="16009752" author="githubbot" created="Sun, 14 May 2017 14:18:28 +0000"  >&lt;p&gt;GitHub user jaikiran opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3050&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    (trunk) &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt; Fix Log.parseTopicPartitionName to take into account dot character in topic names of deleted topics&lt;/p&gt;

&lt;p&gt;    The commit here contains a fix and a test case for the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-5232&lt;/a&gt;. This PR is meant for `trunk` branch and a corresponding PR for `0.10.2` branch has been raised here &lt;a href=&quot;https://github.com/apache/kafka/pull/3043&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jaikiran/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jaikiran/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt;-trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3050.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3050.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3050&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8695ce9a64ce27b329468c63288aff17cd1c2d2e&lt;br/&gt;
Author: Jaikiran Pai &amp;lt;jaikiran.pai@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-13T12:15:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5232&quot; title=&quot;Kafka broker fails to start if a topic containing dot in its name is marked for delete but hasn&amp;#39;t been deleted during previous uptime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5232&quot;&gt;&lt;del&gt;KAFKA-5232&lt;/del&gt;&lt;/a&gt; Fix the bug where the Log.parseTopicPartitionName wasn&apos;t taking into account the potential presence of &apos;.&apos; character in topic names while looking for topics that are marked for deletion&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16010146" author="githubbot" created="Mon, 15 May 2017 08:18:56 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3050&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16010396" author="ijuma" created="Mon, 15 May 2017 12:10:32 +0000"  >&lt;p&gt;Issue resolved by pull request 3043&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3043&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16014128" author="githubbot" created="Wed, 17 May 2017 14:38:57 +0000"  >&lt;p&gt;Github user jaikiran closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3043&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3043&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3expz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>