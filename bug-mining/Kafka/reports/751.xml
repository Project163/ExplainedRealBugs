<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:44:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2437] Controller does not handle zk node deletion correctly.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2437</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We see this issue occasionally. The symptom is that when /controller path got deleted, the old controller does not resign so we end up having more than one controller in the cluster (although the requests from controller with old epoch will not be accepted). After checking zookeeper watcher by using wchp, it looks the zookeeper session who created the /controller path does not have a watcher on /controller. That causes the old controller not resigning. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12856464">KAFKA-2437</key>
            <summary>Controller does not handle zk node deletion correctly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="becket_qin">Jiangjie Qin</assignee>
                                    <reporter username="becket_qin">Jiangjie Qin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Aug 2015 18:42:33 +0000</created>
                <updated>Thu, 3 Sep 2015 01:23:12 +0000</updated>
                            <resolved>Thu, 3 Sep 2015 01:23:12 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14698910" author="becket_qin" created="Mon, 17 Aug 2015 01:07:38 +0000"  >&lt;p&gt;Possibly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1155&quot; title=&quot;Kafka server can miss zookeeper watches during long zkclient callbacks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1155&quot;&gt;&lt;del&gt;KAFKA-1155&lt;/del&gt;&lt;/a&gt;. I&apos;m doing some further investigation.&lt;/p&gt;</comment>
                            <comment id="14728248" author="becket_qin" created="Wed, 2 Sep 2015 23:50:54 +0000"  >&lt;p&gt;Debugged with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt; and found the following root cause.&lt;/p&gt;

&lt;p&gt;zkClient determine whether to find handleDataChanged() or handledDataDeleted() in the following way. When receive event from zookeeper, it tries to read the data from the watched path. If the path does not exist any more, handledDataDeleted() will be fired. Otherwise, handleDataChange() will be fired.&lt;/p&gt;

&lt;p&gt;When we delete /controller path. zkClient watcher will receive zk event, but before zkClient read data from the watched path, the path got created again by another broker. In this case, only handleDataChange() will fire, i.e. a broker will miss a node deletion event. If the broker missed the node deletion event happen to be the old controller, it will not resign and the cluster will end up with more than one controller.&lt;/p&gt;</comment>
                            <comment id="14728309" author="githubbot" created="Thu, 3 Sep 2015 00:46:36 +0000"  >&lt;p&gt;GitHub user becketqin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2437&quot; title=&quot;Controller does not handle zk node deletion correctly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2437&quot;&gt;&lt;del&gt;KAFKA-2437&lt;/del&gt;&lt;/a&gt;: Fix ZookeeperLeaderElector to handle node deletion correctly.&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/becketqin/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/becketqin/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2437&quot; title=&quot;Controller does not handle zk node deletion correctly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2437&quot;&gt;&lt;del&gt;KAFKA-2437&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/189.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/189.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #189&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 11d9fd6595932553e138a3c3094322ebd9170d6c&lt;br/&gt;
Author: Jiangjie Qin &amp;lt;becket.qin@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-09-03T00:41:26Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2437&quot; title=&quot;Controller does not handle zk node deletion correctly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2437&quot;&gt;&lt;del&gt;KAFKA-2437&lt;/del&gt;&lt;/a&gt;: Fix ZookeeperLeaderElector to handle node deletion correctly.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14728351" author="githubbot" created="Thu, 3 Sep 2015 01:13:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/189&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iz9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>