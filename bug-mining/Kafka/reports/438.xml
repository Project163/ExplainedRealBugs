<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:40:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1398] Topic config changes can be lost and cause fatal exceptions on broker restarts</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1398</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Our topic config cleanup policy seems to be broken. When a broker is&lt;br/&gt;
bounced and starting up:&lt;br/&gt;
1 - Read all the children of the config change path&lt;br/&gt;
2 - For each, if the change id is greater than the last executed change,&lt;br/&gt;
  then extract the topic information.&lt;br/&gt;
3 - If there is a log for that topic on this broker, then apply the change.&lt;br/&gt;
  However, if there is no log, then delete the config change.&lt;/p&gt;

&lt;p&gt;In step 3, a delete triggers a child change watch firing on all the other&lt;br/&gt;
brokers. The other brokers currently take all the children of the config&lt;br/&gt;
path but will ignore those config changes that are less than the last&lt;br/&gt;
executed change. At least one issue here is that if a broker does not have&lt;br/&gt;
partitions for a topic then the lastExecutedChange is not updated (for&lt;br/&gt;
that topic).&lt;/p&gt;

&lt;p&gt;Consider this scenario:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Three brokers 0, 1, 2&lt;/li&gt;
	&lt;li&gt;Topic A has partitions only assigned to broker 0&lt;/li&gt;
	&lt;li&gt;Topic B has partitions only assigned to broker 1&lt;/li&gt;
	&lt;li&gt;Topic C has partitions only assigned to broker 2&lt;/li&gt;
	&lt;li&gt;Change 0: topic A&lt;/li&gt;
	&lt;li&gt;Change 1: topic B&lt;/li&gt;
	&lt;li&gt;Change 2: topic C&lt;/li&gt;
	&lt;li&gt;lastExecutedChange on broker 0 is 0&lt;/li&gt;
	&lt;li&gt;lastExecutedChange on broker 1 is 1&lt;/li&gt;
	&lt;li&gt;lastExecutedChange on broker 2 is 2&lt;/li&gt;
	&lt;li&gt;Bounce broker 1&lt;/li&gt;
	&lt;li&gt;The above bounce will cause Change 0 and Change 2 to get deleted.&lt;/li&gt;
	&lt;li&gt;Watch fires on broker 0 and 1&lt;/li&gt;
	&lt;li&gt;Broker 0 will try and read the topic corresponding to change 1 (since its&lt;br/&gt;
  lastExecutedChange is 0) and then change 2. That read will fail:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2014/04/15 19:35:34.236 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;TopicConfigManager&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-server&amp;#93;&lt;/span&gt; [] Processed topic config change 25 for topic xyz, setting new config to&lt;br/&gt;
 &lt;/p&gt;
{retention.ms=3600000, segment.ms=3600000}
&lt;p&gt;.&lt;br/&gt;
2014/04/15 19:35:34.238 FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;KafkaServerStartable&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-server&amp;#93;&lt;/span&gt; [] Fatal error during KafkaServerStable startup. Prepare to shutdown&lt;br/&gt;
org.I0Itec.zkclient.exception.ZkNoNodeException: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /config/changes/config_change_0000000026&lt;br/&gt;
        at org.I0Itec.zkclient.exception.ZkException.create(ZkException.java:47)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:685)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient.readData(ZkClient.java:766)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient.readData(ZkClient.java:761)&lt;br/&gt;
        at kafka.utils.ZkUtils$.readData(ZkUtils.scala:467)&lt;br/&gt;
        at kafka.server.TopicConfigManager$$anonfun$kafka$server$TopicConfigManager$$processConfigChanges$2.apply(TopicConfigManager.scala:97)&lt;br/&gt;
        at kafka.server.TopicConfigManager$$anonfun$kafka$server$TopicConfigManager$$processConfigChanges$2.apply(TopicConfigManager.scala:93)&lt;br/&gt;
        at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:57)&lt;br/&gt;
        at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:43)&lt;br/&gt;
        at kafka.server.TopicConfigManager.kafka$server$TopicConfigManager$$processConfigChanges(TopicConfigManager.scala:93)&lt;br/&gt;
        at kafka.server.TopicConfigManager.processAllConfigChanges(TopicConfigManager.scala:81)&lt;br/&gt;
        at kafka.server.TopicConfigManager.startup(TopicConfigManager.scala:72)&lt;br/&gt;
        at kafka.server.KafkaServer.startup(KafkaServer.scala:104)&lt;br/&gt;
        at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:34)&lt;br/&gt;
        ...&lt;br/&gt;
Caused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /config/changes/config_change_0000000026&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:102)&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42)&lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:927)&lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:956)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkConnection.readData(ZkConnection.java:103)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient$9.call(ZkClient.java:770)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient$9.call(ZkClient.java:766)&lt;br/&gt;
        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:675)&lt;br/&gt;
        ... 39 more&lt;/p&gt;


&lt;p&gt;Another issue is that there are two logging statements with incorrect&lt;br/&gt;
qualifiers which makes things a little harder to debug. E.g.,&lt;/p&gt;

&lt;p&gt;2014/04/15 19:35:34.223 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;TopicConfigManager&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-server&amp;#93;&lt;/span&gt; [] Ignoring topic config change %d for topic %s since the change has expired&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12708658">KAFKA-1398</key>
            <summary>Topic config changes can be lost and cause fatal exceptions on broker restarts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkreps">Jay Kreps</assignee>
                                    <reporter username="jjkoshy">Joel Jacob Koshy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Apr 2014 01:35:07 +0000</created>
                <updated>Tue, 27 May 2014 18:42:47 +0000</updated>
                            <resolved>Fri, 18 Apr 2014 23:23:25 +0000</resolved>
                                    <version>0.8.1</version>
                                    <fixVersion>0.8.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13973632" author="jkreps" created="Fri, 18 Apr 2014 00:36:26 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20471/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="13973636" author="jkreps" created="Fri, 18 Apr 2014 00:39:41 +0000"  >&lt;p&gt;Looks like this got broken with the delete topic work.&lt;/p&gt;

&lt;p&gt;I refactored a bit&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added a unit test for the simple case of changing config&lt;/li&gt;
	&lt;li&gt;Moved purge logic into another method&lt;/li&gt;
	&lt;li&gt;Changed the zk ops to handle the case where the znode is purged in between the notification and the read.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13974311" author="jkreps" created="Fri, 18 Apr 2014 18:05:19 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20492/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20492/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="13974418" author="jkreps" created="Fri, 18 Apr 2014 19:59:43 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20498/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20498/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="13974420" author="jkreps" created="Fri, 18 Apr 2014 20:03:08 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20471/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="13974455" author="jjkoshy" created="Fri, 18 Apr 2014 20:41:54 +0000"  >&lt;p&gt;Reopening to keep track of the follow-up. Also, I need to commit to 0.8.1.&lt;/p&gt;</comment>
                            <comment id="13974623" author="jjkoshy" created="Fri, 18 Apr 2014 23:23:25 +0000"  >&lt;p&gt;Committed to 0.8.1 as well&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12707583">KAFKA-1380</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640877" name="KAFKA-1398.patch" size="7374" author="jkreps" created="Fri, 18 Apr 2014 19:59:43 +0000"/>
                            <attachment id="12640860" name="KAFKA-1398.patch" size="7482" author="jkreps" created="Fri, 18 Apr 2014 18:05:18 +0000"/>
                            <attachment id="12640749" name="KAFKA-1398.patch" size="6019" author="jkreps" created="Fri, 18 Apr 2014 00:36:25 +0000"/>
                            <attachment id="12640879" name="KAFKA-1398_2014-04-18_13:03:03.patch" size="3437" author="jkreps" created="Fri, 18 Apr 2014 20:03:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386981</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1unx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387244</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>