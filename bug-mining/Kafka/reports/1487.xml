<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:01:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5241] GlobalKTable does not checkpoint offsets after restoring state</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5241</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I&apos;m experimenting with an application that uses a relatively large GlobalKTable, and noticed that streams was not checkpointing its offsets on close(). This is because although  &lt;tt&gt;org.apache.kafka.streams.processor.internals.GlobalStateManagerImpl#restoreState&lt;/tt&gt; updates the checkpoint map, the actual checkpointing itself is guarded by a check that the offsets passed from the &lt;tt&gt;GloablStateUpdateTask&lt;/tt&gt; are not empty. This is frustrating because if the topic backing the global table is both large (therefore taking a long time to restore) and infrequently written, then streams rebuilds the table from scratch every time the application is started.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13071976">KAFKA-5241</key>
            <summary>GlobalKTable does not checkpoint offsets after restoring state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twbecker">Tommy Becker</assignee>
                                    <reporter username="twbecker">Tommy Becker</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 May 2017 12:00:14 +0000</created>
                <updated>Fri, 20 Dec 2024 03:38:41 +0000</updated>
                            <resolved>Tue, 16 May 2017 21:01:43 +0000</resolved>
                                    <version>0.10.2.1</version>
                                    <fixVersion>0.10.2.2</fixVersion>
                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16010389" author="twbecker" created="Mon, 15 May 2017 12:01:01 +0000"  >&lt;p&gt;I have a patch for this and will take the issue, if someone can grant me permission to assign to myself.&lt;/p&gt;</comment>
                            <comment id="16010417" author="githubbot" created="Mon, 15 May 2017 12:33:17 +0000"  >&lt;p&gt;GitHub user twbecker opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3054&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5241&quot; title=&quot;GlobalKTable does not checkpoint offsets after restoring state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5241&quot;&gt;&lt;del&gt;KAFKA-5241&lt;/del&gt;&lt;/a&gt;: GlobalKTable does not checkpoint offsets after restoring state&lt;/p&gt;

&lt;p&gt;    Ensure checkpointable offsets for GlobalKTables are always written on close.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/twbecker/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twbecker/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5241&quot; title=&quot;GlobalKTable does not checkpoint offsets after restoring state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5241&quot;&gt;&lt;del&gt;KAFKA-5241&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3054.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3054.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3054&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4f7263768ef73d18cf6b90894f4a0286bc79ea14&lt;br/&gt;
Author: Tommy Becker &amp;lt;tobecker@tivo.com&amp;gt;&lt;br/&gt;
Date:   2017-05-15T12:13:07Z&lt;/p&gt;

&lt;p&gt;    Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5241&quot; title=&quot;GlobalKTable does not checkpoint offsets after restoring state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5241&quot;&gt;&lt;del&gt;KAFKA-5241&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    Ensure checkpointable offsets for GlobalKTables are always written on close.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16011360" author="twbecker" created="Mon, 15 May 2017 21:29:41 +0000"  >&lt;p&gt;I should also add that it seems broken that in the absence of checkpointed offsets in the store, the existing DB is simply opened and the contents of the topic written to it again. I would think that without a checkpoint the directory should be cleared and a new DB created since the contents of what is there are unknown. Should file a separate JIRA for this?&lt;/p&gt;</comment>
                            <comment id="16012270" author="damianguy" created="Tue, 16 May 2017 12:45:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twbecker&quot; class=&quot;user-hover&quot; rel=&quot;twbecker&quot;&gt;twbecker&lt;/a&gt; Probably worth filing another JIRA for this as it is not just global stores that have this issue&lt;/p&gt;</comment>
                            <comment id="16012722" author="guozhang" created="Tue, 16 May 2017 16:57:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twbecker&quot; class=&quot;user-hover&quot; rel=&quot;twbecker&quot;&gt;twbecker&lt;/a&gt; Added you to the contributor list and assigned this ticket to you.&lt;/p&gt;</comment>
                            <comment id="16013101" author="githubbot" created="Tue, 16 May 2017 21:00:45 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3054&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16013105" author="guozhang" created="Tue, 16 May 2017 21:01:43 +0000"  >&lt;p&gt;Issue resolved by pull request 3054&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3054&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17902052" author="sg12" created="Sat, 30 Nov 2024 16:47:13 +0000"  >&lt;p&gt;Hello,&#160;&lt;/p&gt;


&lt;p&gt;it is back on 3.8.1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/StateManagerUtil.java#L78C35-L78C72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/StateManagerUtil.java#L78C35-L78C72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;the check above prevents .checkpoint to be created for potentially large global state which is expensive to restore if source topic is idle&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateUpdateTask.java#L167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateUpdateTask.java#L167&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17907268" author="mjsax" created="Fri, 20 Dec 2024 03:38:41 +0000"  >&lt;p&gt;Thanks for your comment. As discussed, it&apos;s not the exact some issue you observe and this ticket reports.&lt;/p&gt;

&lt;p&gt;Thanks for filing a new ticket for the issue you discovered: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-18168&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-18168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Replying here, if anybody reads your comment, so close the loop.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ez33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>