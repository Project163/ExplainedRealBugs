<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:01:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5263] kakfa-clients consume 100% CPU with manual partition assignment when network connection is lost</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5263</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Noticed that lose of the connection to Kafka broker leads kafka-clients to consume 100% CPU. The bug only appears when the manual partition assignmet is used. It appears since the version 0.10.1.0. The bug is quite similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1642&quot; title=&quot;[Java New Producer Kafka Trunk] CPU Usage Spike to 100% when network connection is lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1642&quot;&gt;&lt;del&gt;KAFKA-1642&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13072843">KAFKA-5263</key>
            <summary>kakfa-clients consume 100% CPU with manual partition assignment when network connection is lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="kosm">Konstantin Smirnov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 May 2017 15:25:21 +0000</created>
                <updated>Tue, 25 Jul 2017 11:11:38 +0000</updated>
                            <resolved>Thu, 25 May 2017 10:24:21 +0000</resolved>
                                    <version>0.10.1.0</version>
                    <version>0.10.1.1</version>
                    <version>0.10.2.0</version>
                    <version>0.10.2.1</version>
                                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16014226" author="kosm" created="Wed, 17 May 2017 15:34:56 +0000"  >&lt;p&gt;Sample code leading to the trouble:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Starting consumer&quot;&lt;/span&gt;);
        Properties props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;group.id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test12345&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;reconnect.backoff.ms&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;retry.backoff.ms&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;session.timeout.ms&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;10000&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;key.deserializer&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;value.deserializer&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;);
        
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (KafkaConsumer&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; consumer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaConsumer&amp;lt;&amp;gt;(props)) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic = &lt;span class=&quot;code-quote&quot;&gt;&quot;test-topic&quot;&lt;/span&gt;; 
&lt;span class=&quot;code-comment&quot;&gt;//            consumer.subscribe(Arrays.asList(topic));
&lt;/span&gt;            List&amp;lt;TopicPartition&amp;gt; partitions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PartitionInfo partition : consumer.partitionsFor(topic)) {
                partitions.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopicPartition(topic, partition.partition()));
            }
            consumer.assign(partitions);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (;;) {
                ConsumerRecords&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; records = consumer.poll(1000);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!records.isEmpty()) {
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Records aren&apos;t empty!&quot;&lt;/span&gt;);
                }
                records.forEach(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out::println);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start Kafka broker&lt;/li&gt;
	&lt;li&gt;Run the sample code&lt;/li&gt;
	&lt;li&gt;Stop Kafka broker&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16014278" author="kosm" created="Wed, 17 May 2017 15:46:45 +0000"  >&lt;p&gt;Sample application output&lt;/p&gt;</comment>
                            <comment id="16014281" author="kosm" created="Wed, 17 May 2017 15:48:31 +0000"  >&lt;p&gt;Captured profile&lt;/p&gt;</comment>
                            <comment id="16021013" author="githubbot" created="Tue, 23 May 2017 10:34:58 +0000"  >&lt;p&gt;GitHub user rajinisivaram opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3124&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5263&quot; title=&quot;kakfa-clients consume 100% CPU with manual partition assignment when network connection is lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5263&quot;&gt;&lt;del&gt;KAFKA-5263&lt;/del&gt;&lt;/a&gt;: Avoid tight polling loop in consumer with no ready nodes&lt;/p&gt;

&lt;p&gt;    If all brokers are unavailable, consumers using manual assignment poll in a tight loop with no channels to poll from. Producers and consumers using group management avoid this since they wait for metadata which attempt to create new connections with any necessary backoff. This PR does a similar wait for consumers using manual assignment when no nodes are ready.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rajinisivaram/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5263&quot; title=&quot;kakfa-clients consume 100% CPU with manual partition assignment when network connection is lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5263&quot;&gt;&lt;del&gt;KAFKA-5263&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3124.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3124.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3124&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e4cd05a61c3e5422b2a897004b41d523b5af8c16&lt;br/&gt;
Author: Rajini Sivaram &amp;lt;rajinisivaram@googlemail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-23T10:05:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5263&quot; title=&quot;kakfa-clients consume 100% CPU with manual partition assignment when network connection is lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5263&quot;&gt;&lt;del&gt;KAFKA-5263&lt;/del&gt;&lt;/a&gt;: Avoid tight polling loop in consumer with no ready nodes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16024491" author="rsivaram" created="Thu, 25 May 2017 10:24:21 +0000"  >&lt;p&gt;Issue resolved by pull request 3124&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3124&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16024492" author="githubbot" created="Thu, 25 May 2017 10:24:59 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3124&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16024593" author="kosm" created="Thu, 25 May 2017 11:37:35 +0000"  >&lt;p&gt;Thanks a lot for your fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12868549" name="cpu_consuming.log" size="38489" author="kosm" created="Wed, 17 May 2017 15:46:45 +0000"/>
                            <attachment id="12868550" name="cpu_consuming_profile.csv" size="3871" author="kosm" created="Wed, 17 May 2017 15:48:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f4e7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>