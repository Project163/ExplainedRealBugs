<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-528] IndexOutOfBoundsException thrown by kafka.consumer.ConsumerFetcherThread</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-528</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;1. Attached file system_test_1348521165.tar.gz contains all the associated log files for this test session.&lt;/p&gt;

&lt;p&gt;2. The system test output log can be found at: system_test_1348521165/system_test_output.log&lt;/p&gt;

&lt;p&gt;3. The following log message can be found at: system_test_1348521165/logs/console_consumer-5/console_consumer.log&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-24 14:15:12,016&amp;#93;&lt;/span&gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ConsumerFetcherThread-console-consumer-16186_jfung-1348521311426-2c83ced7-0-1&amp;#93;&lt;/span&gt;, Error due to  (kafka.consumer.ConsumerFetcherThread)&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException&lt;/p&gt;

&lt;p&gt;        at java.nio.Buffer.checkIndex(Buffer.java:512)&lt;/p&gt;

&lt;p&gt;        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:121)&lt;/p&gt;

&lt;p&gt;        at kafka.message.Message.magic(Message.scala:119)&lt;/p&gt;

&lt;p&gt;        at kafka.message.Message.checksum(Message.scala:132)&lt;/p&gt;

&lt;p&gt;        at kafka.message.Message.isValid(Message.scala:144)&lt;/p&gt;

&lt;p&gt;        at kafka.message.ByteBufferMessageSet$$anon$1.makeNextOuter(ByteBufferMessageSet.scala:118)&lt;/p&gt;

&lt;p&gt;        at kafka.message.ByteBufferMessageSet$$anon$1.makeNext(ByteBufferMessageSet.scala:149)&lt;/p&gt;

&lt;p&gt;        at kafka.message.ByteBufferMessageSet$$anon$1.makeNext(ByteBufferMessageSet.scala:89)&lt;/p&gt;

&lt;p&gt;        at kafka.utils.IteratorTemplate.maybeComputeNext(IteratorTemplate.scala:61)&lt;/p&gt;

&lt;p&gt;        at kafka.utils.IteratorTemplate.hasNext(IteratorTemplate.scala:53)&lt;/p&gt;

&lt;p&gt;        at kafka.message.ByteBufferMessageSet.shallowValidBytes(ByteBufferMessageSet.scala:54)&lt;/p&gt;

&lt;p&gt;        at kafka.message.ByteBufferMessageSet.validBytes(ByteBufferMessageSet.scala:49)&lt;/p&gt;

&lt;p&gt;        at kafka.consumer.PartitionTopicInfo.enqueue(PartitionTopicInfo.scala:54)&lt;/p&gt;

&lt;p&gt;        at kafka.consumer.ConsumerFetcherThread.processPartitionData(ConsumerFetcherThread.scala:42)&lt;/p&gt;

&lt;p&gt;        at kafka.server.AbstractFetcherThread$$anonfun$doWork$5.apply(AbstractFetcherThread.scala:103)&lt;/p&gt;

&lt;p&gt;        at kafka.server.AbstractFetcherThread$$anonfun$doWork$5.apply(AbstractFetcherThread.scala:96)&lt;/p&gt;

&lt;p&gt;        at scala.collection.immutable.Map$Map2.foreach(Map.scala:127)&lt;/p&gt;

&lt;p&gt;        at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:96)&lt;/p&gt;

&lt;p&gt;        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:50)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608934">KAFKA-528</key>
            <summary>IndexOutOfBoundsException thrown by kafka.consumer.ConsumerFetcherThread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="jfung">John Fung</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Mon, 24 Sep 2012 21:49:32 +0000</created>
                <updated>Sat, 29 Sep 2012 18:19:44 +0000</updated>
                            <resolved>Sat, 29 Sep 2012 18:19:40 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13462887" author="junrao" created="Tue, 25 Sep 2012 15:42:20 +0000"  >&lt;p&gt;Attach a patch. There are a couple of critical issues.&lt;/p&gt;

&lt;p&gt;1. FileMessageSet.truncateTo(): There is a java bug in FileChannel.truncate. The problem is that file size is set correctly, but file position is not changed accordingly. Added a fix that manually sets the file position.&lt;/p&gt;

&lt;p&gt;2. ZookeeperConsumerConnector: The call to get the initial offset sometimes fails since it&apos;s connected to a broker that&apos;s not the leader of a partition. Changed it to set the initial offset in ConsumerFetcherThread.&lt;/p&gt;

&lt;p&gt;Also fixed a few other issues:&lt;br/&gt;
3. Partition: There is unnecessary ISR expansion.&lt;/p&gt;

&lt;p&gt;4. SyncProducer: lastConnectionTime should be set in connect().&lt;/p&gt;

&lt;p&gt;5. DumpLogSegment: Report if log is corrupted at the end of a file.&lt;/p&gt;

&lt;p&gt;6. Added some more tracing code. &lt;/p&gt;</comment>
                            <comment id="13465852" author="jkreps" created="Fri, 28 Sep 2012 19:42:06 +0000"  >&lt;p&gt;+1 Lgtm.&lt;/p&gt;

&lt;p&gt;You made the logging for leaderAndIsr request to be info level. If it is info level it would be good to rephrase that in a way folks would be able to understand, otherwise we have a log full of really esoteric things that only make sense to us.&lt;/p&gt;</comment>
                            <comment id="13466002" author="jfung" created="Fri, 28 Sep 2012 23:20:41 +0000"  >&lt;p&gt;1. Tested kafka-528.patch with rev. 1389460 and there is no data loss now. The Exception specified in this JIRA is not showing.&lt;/p&gt;

&lt;p&gt;2. However, there is still another exception showing in broker log (already filed under &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-529&quot; title=&quot;kafka.server.ReplicaFetcherThread: java.lang.IndexOutOfBoundsException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-529&quot;&gt;&lt;del&gt;KAFKA-529&lt;/del&gt;&lt;/a&gt;) :&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-28 23:05:54,669&amp;#93;&lt;/span&gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcherThread-2-0-on-broker-3&amp;#93;&lt;/span&gt;, Error due to  (kafka.server.ReplicaFetcherThread)&lt;br/&gt;
java.lang.IndexOutOfBoundsException&lt;br/&gt;
        at java.nio.Buffer.checkIndex(Buffer.java:514)&lt;br/&gt;
        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:121)&lt;br/&gt;
        at kafka.message.Message.magic(Message.scala:119)&lt;br/&gt;
        at kafka.message.Message.checksum(Message.scala:132)&lt;br/&gt;
        at kafka.message.Message.isValid(Message.scala:144)&lt;/p&gt;</comment>
                            <comment id="13466086" author="junrao" created="Sat, 29 Sep 2012 02:13:15 +0000"  >&lt;p&gt;Attach patch v2. Fixed one additional bug in KafkaController.&lt;/p&gt;

&lt;p&gt;The bug is that Map((&quot;a&quot;,0)&lt;del&gt;&amp;gt;0,(&quot;a&quot;,1)&lt;/del&gt;&amp;gt;0)).map(_,_1) returns Map(&quot;a&quot; -&amp;gt; 1) while we expect it to be Seq((&quot;a,0),(&quot;a&quot;,1)). Fixed it by using .keySet instead. &lt;/p&gt;

&lt;p&gt;With patch v2, our system test now passes.&lt;/p&gt;</comment>
                            <comment id="13466271" author="nehanarkhede" created="Sat, 29 Sep 2012 17:22:05 +0000"  >&lt;p&gt;+1 on patch v2.&lt;/p&gt;

&lt;p&gt;Minor comments on logging -&lt;/p&gt;

&lt;p&gt;1. The debug statement in Replica says &quot;Updated highwatermark to &quot;. It will be good to know the topic and partition as well.&lt;br/&gt;
2. The println in DumpLogSegment says &quot;Log is corrupted from... Is corrupted&quot;. Let&apos;s fix that.&lt;/p&gt;
</comment>
                            <comment id="13466281" author="junrao" created="Sat, 29 Sep 2012 18:19:40 +0000"  >&lt;p&gt;Thanks for the review. Committed to 0.8 with some minor changes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546531" name="kafka-528.patch" size="11693" author="junrao" created="Tue, 25 Sep 2012 15:42:20 +0000"/>
                            <attachment id="12547088" name="kafka-528_v2.patch" size="10678" author="junrao" created="Sat, 29 Sep 2012 02:13:15 +0000"/>
                            <attachment id="12546390" name="system_test_1348521165.tar.gz" size="111452" author="jfung" created="Mon, 24 Sep 2012 21:59:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>291942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rhqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>158519</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>