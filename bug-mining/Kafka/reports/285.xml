<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:38:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-903] [0.8.0 - windows]  FATAL - [highwatermark-checkpoint-thread1] (Logging.scala:109) - Attempt to swap the new high watermark file with the old one failed</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-903</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This FATAL shuts down both brokers on windows, &lt;/p&gt;
{2013-05-10 18:23:57,636}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Sending 1 &lt;br/&gt;
messages with no compression to &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt;&lt;/p&gt;
{2013-05-10 18:23:57,637}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Producer &lt;br/&gt;
sending messages with correlation id 178 for topics &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; to &lt;br/&gt;
broker 1 on 192.168.1.100:9093&lt;/p&gt;
{2013-05-10 18:23:57,689}
&lt;p&gt; FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;highwatermark-checkpoint-thread1&amp;#93;&lt;/span&gt; &lt;br/&gt;
(Logging.scala:109) - Attempt to swap the new high watermark file with the &lt;br/&gt;
old one failed&lt;/p&gt;
{2013-05-10 18:23:57,739}
&lt;p&gt;  INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4&amp;#93;&lt;/span&gt; (Logging.scala:67) - [Kafka &lt;br/&gt;
Server 0], shutting down&lt;/p&gt;

&lt;p&gt;Furthermore, attempts to restart them fail, with the following log:&lt;/p&gt;
{2013-05-10 19:14:52,156}
&lt;p&gt;  INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1&amp;#93;&lt;/span&gt; (Logging.scala:67) - &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Server 0&amp;#93;&lt;/span&gt;, started&lt;/p&gt;
{2013-05-10 19:14:52,157}
&lt;p&gt;  INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ZkClient-EventThread-32-localhost:2181&amp;#93;&lt;/span&gt; (Logging.scala:67) - New leader is 0&lt;/p&gt;
{2013-05-10 19:14:52,193}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ZkClient-EventThread-32-localhost:2181&amp;#93;&lt;/span&gt; (ZkEventThread.java:79) - Delivering event #1 done&lt;/p&gt;
{2013-05-10 19:14:52,193}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ZkClient-EventThread-32-localhost:2181&amp;#93;&lt;/span&gt; (ZkEventThread.java:69) - Delivering event #4 ZkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;Data of /controller_epoch changed sent to kafka.controller.ControllerEpochListener@5cb88f42&amp;#93;&lt;/span&gt;&lt;/p&gt;
{2013-05-10 19:14:52,210}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SyncThread:0&amp;#93;&lt;/span&gt; (FinalRequestProcessor.java:78) - Processing request:: sessionid:0x13e9127882e0001 type:exists cxid:0x1d zxid:0xfffffffffffffffe txntype:unknown reqpath:/controller_epoch&lt;/p&gt;
{2013-05-10 19:14:52,210}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SyncThread:0&amp;#93;&lt;/span&gt; (FinalRequestProcessor.java:160) - sessionid:0x13e9127882e0001 type:exists cxid:0x1d zxid:0xfffffffffffffffe txntype:unknown reqpath:/controller_epoch&lt;/p&gt;
{2013-05-10 19:14:52,213}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1-SendThread(localhost:2181)&amp;#93;&lt;/span&gt; (ClientCnxn.java:838) - Reading reply sessionid:0x13e9127882e0001, packet:: clientPath:null serverPath:null finished:false header:: 29,3  replyHeader:: 29,37,0  request:: &apos;/controller_epoch,T  response:: s&lt;/p&gt;
{16,36,1368231712816,1368234889961,1,0,0,0,1,0,16}
&lt;p&gt; &lt;/p&gt;
{2013-05-10 19:14:52,219}
&lt;p&gt;  INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-5&amp;#93;&lt;/span&gt; (Logging.scala:67) - &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Server 0&amp;#93;&lt;/span&gt;, shutting down&lt;/p&gt;</description>
                <environment>Windows 7 with SP 1; jdk 7_0_17; scala-library-2.8.2, probably copied on 4/30. kafka-0.8, built current on 4/30.&lt;br/&gt;
&lt;br/&gt;
-rwx------+ 1 reefedjib None   41123 Mar 19  2009 commons-cli-1.2.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   58160 Jan 11 13:45 commons-codec-1.4.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  575389 Apr 18 13:41 commons-collections-3.2.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  143847 May 21  2009 commons-compress-1.0.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   52543 Jan 11 13:45 commons-exec-1.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   57779 Jan 11 13:45 commons-fileupload-1.2.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  109043 Jan 20  2008 commons-io-1.4.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  279193 Jan 11 13:45 commons-lang-2.5.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   60686 Jan 11 13:45 commons-logging-1.1.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None 1891110 Apr 18 13:41 guava-13.0.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  206866 Apr  7 21:24 jackson-core-2.1.4.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  232245 Apr  7 21:24 jackson-core-asl-1.9.12.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   69314 Apr  7 21:24 jackson-dataformat-smile-2.1.4.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  780385 Apr  7 21:24 jackson-mapper-asl-1.9.12.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   47913 May  9 23:39 jopt-simple-3.0-rc2.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None 2365575 Apr 30 13:06 kafka_2.8.0-0.8.0-SNAPSHOT.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  481535 Jan 11 13:46 log4j-1.2.16.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   20647 Apr 18 13:41 log4j-over-slf4j-1.6.6.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  251784 Apr 18 13:41 logback-classic-1.0.6.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  349706 Apr 18 13:41 logback-core-1.0.6.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   82123 Nov 26 13:11 metrics-core-2.2.0.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None 1540457 Jul 12  2012 ojdbc14.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None 6418368 Apr 30 08:23 scala-library-2.8.2.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None 3114958 Apr  2 07:47 scalatest_2.10-1.9.1.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   25962 Apr 18 13:41 slf4j-api-1.6.5.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None   62269 Nov 29 03:26 zkclient-0.2.jar&lt;br/&gt;
-rwx------+ 1 reefedjib None  601677 Apr 18 13:41 zookeeper-3.3.3.jar&lt;br/&gt;
</environment>
        <key id="12647144">KAFKA-903</key>
            <summary>[0.8.0 - windows]  FATAL - [highwatermark-checkpoint-thread1] (Logging.scala:109) - Attempt to swap the new high watermark file with the old one failed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="reefedjib">Rob Withers</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 May 2013 01:18:14 +0000</created>
                <updated>Thu, 28 Sep 2017 01:27:04 +0000</updated>
                            <resolved>Mon, 3 Jun 2013 23:52:27 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13655155" author="junrao" created="Sat, 11 May 2013 05:04:21 +0000"  >&lt;p&gt;Attach a patch. Rob, could you give it a try?&lt;/p&gt;</comment>
                            <comment id="13655169" author="reefedjib" created="Sat, 11 May 2013 05:28:16 +0000"  >&lt;p&gt;I&apos;d love too.  Could you build me a jar and email it too me, please?  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13655170" author="junrao" created="Sat, 11 May 2013 05:53:18 +0000"  >&lt;p&gt;Attach the kafka jar with the patch.&lt;/p&gt;</comment>
                            <comment id="13655175" author="reefedjib" created="Sat, 11 May 2013 06:32:43 +0000"  >&lt;p&gt;That jar is missing a lot - it only has a MANIFEST.  Should I be able to do anything with it?&lt;/p&gt;</comment>
                            <comment id="13655300" author="junrao" created="Sat, 11 May 2013 15:39:44 +0000"  >&lt;p&gt;Attach the right jar this time.&lt;/p&gt;</comment>
                            <comment id="13655307" author="reefedjib" created="Sat, 11 May 2013 16:09:42 +0000"  >&lt;p&gt;It still fails.  Where should I look in the jar to ensure the patch is in there?  Which class method?   Also, could you generate a jar for me with sources?&lt;/p&gt;

&lt;p&gt;thanks a lot and happy saturday!&lt;/p&gt;


{2013-05-11 10:00:58,630}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Producer sent messages with correlation id 232 for topics &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; to broker 0 on 192.168.1.100:9092&lt;/p&gt;
{2013-05-11 10:00:58,637}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Getting broker partition info for topic robert_v_2x0&lt;/p&gt;
{2013-05-11 10:00:58,638}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; has leader 0&lt;/p&gt;
{2013-05-11 10:00:58,639}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Broker partitions registered for topic: robert_v_2x0 are 0&lt;/p&gt;
{2013-05-11 10:00:58,639}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Sending 1 messages with no compression to &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt;&lt;/p&gt;
{2013-05-11 10:00:58,640}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Producer sending messages with correlation id 234 for topics &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; to broker 0 on 192.168.1.100:9092&lt;/p&gt;
{2013-05-11 10:00:58,648}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-1&amp;#93;&lt;/span&gt; (Logging.scala:51) - &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Request Handler 1 on Broker 0&amp;#93;&lt;/span&gt;, handles request Request(1,sun.nio.ch.SelectionKeyImpl@2b12cf49,null,1368288058646,/192.168.1.100:60622)&lt;/p&gt;
{2013-05-11 10:00:58,649}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-1&amp;#93;&lt;/span&gt; (Logging.scala:51) - Adding index entry 115 =&amp;gt; 5220900 to 00000000000000000000.index.&lt;/p&gt;
{2013-05-11 10:00:58,650}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-1&amp;#93;&lt;/span&gt; (Logging.scala:51) - Partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; on broker 0: Highwatermark for partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; updated to 116&lt;/p&gt;
{2013-05-11 10:00:58,650}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-1&amp;#93;&lt;/span&gt; (Logging.scala:51) - &lt;span class=&quot;error&quot;&gt;&amp;#91;KafkaApi-0&amp;#93;&lt;/span&gt; Produce to local log in 2 ms&lt;/p&gt;
{2013-05-11 10:00:58,656}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Producer sent messages with correlation id 234 for topics &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; to broker 0 on 192.168.1.100:9092&lt;/p&gt;
{2013-05-11 10:00:58,666}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Getting broker partition info for topic robert_v_2x0&lt;/p&gt;
{2013-05-11 10:00:58,667}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; has leader 0&lt;/p&gt;
{2013-05-11 10:00:58,667}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Broker partitions registered for topic: robert_v_2x0 are 0&lt;/p&gt;
{2013-05-11 10:00:58,669}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Sending 1 messages with no compression to &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt;&lt;/p&gt;
{2013-05-11 10:00:58,670}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;local-vat&amp;#93;&lt;/span&gt; (Logging.scala:51) - Producer sending messages with correlation id 236 for topics &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; to broker 0 on 192.168.1.100:9092&lt;/p&gt;
{2013-05-11 10:00:58,716}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-0&amp;#93;&lt;/span&gt; (Logging.scala:51) - &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Request Handler 0 on Broker 0&amp;#93;&lt;/span&gt;, handles request Request(1,sun.nio.ch.SelectionKeyImpl@2b12cf49,null,1368288058674,/192.168.1.100:60622)&lt;/p&gt;
{2013-05-11 10:00:58,717}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-0&amp;#93;&lt;/span&gt; (Logging.scala:51) - Adding index entry 116 =&amp;gt; 5232005 to 00000000000000000000.index.&lt;/p&gt;
{2013-05-11 10:00:58,718}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-0&amp;#93;&lt;/span&gt; (Logging.scala:51) - Partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; on broker 0: Highwatermark for partition &lt;span class=&quot;error&quot;&gt;&amp;#91;robert_v_2x0,0&amp;#93;&lt;/span&gt; updated to 117&lt;/p&gt;
{2013-05-11 10:00:58,718}
&lt;p&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-request-handler-0&amp;#93;&lt;/span&gt; (Logging.scala:51) - &lt;span class=&quot;error&quot;&gt;&amp;#91;KafkaApi-0&amp;#93;&lt;/span&gt; Produce to local log in 2 ms&lt;/p&gt;
{2013-05-11 10:00:58,726}
&lt;p&gt; FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;highwatermark-checkpoint-thread1&amp;#93;&lt;/span&gt; (Logging.scala:109) - Attempt to swap the new high watermark file with the old one failed&lt;/p&gt;</comment>
                            <comment id="13655356" author="junrao" created="Sat, 11 May 2013 19:56:04 +0000"  >&lt;p&gt;Hmm, this may have to do with Windows not supporting file.renameTo() if the target file already exists (&lt;a href=&quot;http://stackoverflow.com/questions/1000183/reliable-file-renameto-alternative-on-windows&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/1000183/reliable-file-renameto-alternative-on-windows&lt;/a&gt;). We periodically checkpoint high watermarks to disk. The way we do this is to first write all values to a tmp file replication-offset-checkpoint.tmp and then rename the tmp file to replication-offset-checkpoint. This way, if there is any I/O error during checkpointing, we still have the old checkpoint file for use. Not sure what the best way to do this in Windows.&lt;/p&gt;

&lt;p&gt;Could you try java 7 and see if it still has the same issue (the above link suggests that it&apos;s fixed in jdk 7)?&lt;/p&gt;</comment>
                            <comment id="13655367" author="reefedjib" created="Sat, 11 May 2013 20:39:45 +0000"  >&lt;p&gt;I am on jdk 7.0.17,  That thread mentions apache.commons.io.FileUtils.moveFile().   Also, my suggestion to be done with the issue: I know there is a way to detect platform, just write a small strategy pattern for the general platform and for windows and plug her in.&lt;/p&gt;</comment>
                            <comment id="13655381" author="junrao" created="Sat, 11 May 2013 22:09:27 +0000"  >&lt;p&gt;Attach patch v2. If a file can&apos;t be renamed, it deletes the target file first. The implication is that during a hard crash, if the high watermark file is missing, one has to manually rename it from the temporary high watermark file.&lt;/p&gt;</comment>
                            <comment id="13655382" author="junrao" created="Sat, 11 May 2013 22:10:44 +0000"  >&lt;p&gt;Deleted the old jar and a attach a new jar built with patch v2.&lt;/p&gt;</comment>
                            <comment id="13655643" author="reefedjib" created="Sun, 12 May 2013 21:50:02 +0000"  >&lt;p&gt;Jun, it looks like this works.  I have 23 MB in the log file, on broker0.  No replication and I guess I am only sending to partition 0.  So, please close this issue.&lt;/p&gt;

&lt;p&gt;I am still having trouble with consumption, but given it is a weekend, I am busy with other stuff.  I will dig in to it later and report my progress.  &lt;/p&gt;

&lt;p&gt;Thanks for all your help,&lt;br/&gt;
rob&lt;/p&gt;</comment>
                            <comment id="13659805" author="jkreps" created="Thu, 16 May 2013 18:31:05 +0000"  >&lt;p&gt;I don&apos;t think this rename functionality is such a good idea. There are many ways a rename can fail: (1) permissions, (2) disk errors, (3) bad target name, (4) rename is to another volume, etc. Java doesn&apos;t differentiate these, so in any of these cases we would then try to delete the file. Not sure this is a good idea.&lt;/p&gt;

&lt;p&gt;Another approach would be to add a Utils.IsWindows = System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;) and using this to fall back to the funky non-atomic behavior.&lt;/p&gt;</comment>
                            <comment id="13659987" author="sriramsub" created="Thu, 16 May 2013 20:59:34 +0000"  >&lt;p&gt;There are two claims in this JIRA -&lt;/p&gt;

&lt;p&gt;1. &quot;this may have to do with Windows not supporting file.renameTo() if the target file already exists&quot;&lt;br/&gt;
2. renameTo is not atomic in windows&lt;/p&gt;

&lt;p&gt;Claim 1 is wrong. MoveFileEx is the native api that helps you to rename an existing file. &quot;MOVEFILE_REPLACE_EXISTING&quot; is the flag you would use. This might be a bug in the java api or as the SO link indicates, does not work for non empty directories. (&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365240(v=vs.85).aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365240(v=vs.85).aspx&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Claim 2 is possible depending on the OS settings. The caller of MoveFileEx is supposed to handle the failure.&lt;/p&gt;</comment>
                            <comment id="13668746" author="tnachen" created="Tue, 28 May 2013 22:30:09 +0000"  >&lt;p&gt;Do you know when this is going to be pushed to 0.8 branch?&lt;/p&gt;</comment>
                            <comment id="13668988" author="junrao" created="Wed, 29 May 2013 04:47:20 +0000"  >&lt;p&gt;Attach patch v3. &lt;/p&gt;

&lt;p&gt;To address Jay&apos;s concern, instead of using a generic renameTo util, only falls back to the non-atomic renameTo in checkpointing the high watermark file. Since both files are in the same dir and we control the naming, those other causes you listed that can fail renameTo won&apos;t happen. I didn&apos;t do the os level checking since I am not sure it that works well for environments like cygwin. We could guard this under a broker config parameter, but I am not sure if it&apos;s worth it.&lt;/p&gt;

&lt;p&gt;For Sriram&apos;s concern, this seems to be at least a problem for some versions of java on Windows since other projects like Hadoop (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-959&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP-959&lt;/a&gt;) have also seen this before.&lt;/p&gt;
</comment>
                            <comment id="13671688" author="nehanarkhede" created="Fri, 31 May 2013 17:56:58 +0000"  >&lt;p&gt;+1 on v3&lt;/p&gt;</comment>
                            <comment id="13673781" author="jkreps" created="Mon, 3 Jun 2013 23:32:10 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13673813" author="junrao" created="Mon, 3 Jun 2013 23:52:27 +0000"  >&lt;p&gt;Thanks for the review. Committed v3 to 0.8.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12644633">KAFKA-876</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12582769" name="kafka-903.patch" size="788" author="junrao" created="Sat, 11 May 2013 05:04:21 +0000"/>
                            <attachment id="12582802" name="kafka-903_v2.patch" size="2470" author="junrao" created="Sat, 11 May 2013 22:09:27 +0000"/>
                            <attachment id="12585155" name="kafka-903_v3.patch" size="949" author="junrao" created="Wed, 29 May 2013 04:47:47 +0000"/>
                            <attachment id="12582803" name="kafka_2.8.0-0.8.0-SNAPSHOT.jar" size="2368507" author="junrao" created="Sat, 11 May 2013 22:10:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327501</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ki93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327845</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>