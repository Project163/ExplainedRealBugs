<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:39:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1036] Unable to rename replication offset checkpoint in windows</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1036</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Although there was a fix for checkpoint file renaming in windows that tries to delete the existing checkpoint file if renamed failed, I&apos;m still seeing renaming errors on windows even though the destination file doesn&apos;t exist.&lt;/p&gt;

&lt;p&gt;A bit investigation shows that it wasn&apos;t able to rename the file since the kafka jvm still holds a fie lock on the tmp file and wasn&apos;t able to rename it. &lt;/p&gt;

&lt;p&gt;Attaching a patch that calls a explict writer.close so it can release the lock and can able to rename it.&lt;/p&gt;</description>
                <environment>windows</environment>
        <key id="12666189">KAFKA-1036</key>
            <summary>Unable to rename replication offset checkpoint in windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tnachen">Timothy Chen</reporter>
                        <labels>
                            <label>windows</label>
                    </labels>
                <created>Thu, 29 Aug 2013 21:02:11 +0000</created>
                <updated>Fri, 14 Dec 2018 16:35:19 +0000</updated>
                            <resolved>Tue, 15 Oct 2013 22:59:41 +0000</resolved>
                                    <version>0.8.1</version>
                                    <fixVersion>0.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13759134" author="junrao" created="Thu, 5 Sep 2013 14:55:03 +0000"  >&lt;p&gt;Hi, Tim,&lt;/p&gt;

&lt;p&gt;Do you still want to provide a patch? I saw a patch attached and then deleted.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;</comment>
                            <comment id="13762052" author="tnachen" created="Mon, 9 Sep 2013 17:18:49 +0000"  >&lt;p&gt;Hi Jun, I just realized I don&apos;t have clearance to provide a patch yet. It will be much easier if you can help fix this since it&apos;s just a one line fix.&lt;/p&gt;</comment>
                            <comment id="13766549" author="junrao" created="Fri, 13 Sep 2013 15:29:51 +0000"  >&lt;p&gt;Hmm, not sure how to patch this since we close the writer before renaming the file.&lt;/p&gt;</comment>
                            <comment id="13773527" author="jkreps" created="Fri, 20 Sep 2013 22:28:37 +0000"  >&lt;p&gt;I&apos;m a little confused. I don&apos;t see any file locking happening in our code. The lock I see is just an in-memory lock and should prevent the file from being deleted.&lt;/p&gt;

&lt;p&gt;So perhaps the problem you are describing is that we don&apos;t close the file until after the file move? This is legit in unix but perhaps not in windows.&lt;/p&gt;</comment>
                            <comment id="13788728" author="junrao" created="Mon, 7 Oct 2013 23:51:35 +0000"  >&lt;p&gt;This seems to be only affecting trunk. So, moving to 0.8.1.&lt;/p&gt;</comment>
                            <comment id="13795772" author="jkreps" created="Tue, 15 Oct 2013 22:59:41 +0000"  >&lt;p&gt;Checked in fix on trunk. Note that I don&apos;t have access to a windows box so I can&apos;t actually validate the fix if anyone who does have access gave this a spin that would be great.&lt;/p&gt;</comment>
                            <comment id="13805216" author="jantxu" created="Fri, 25 Oct 2013 10:51:46 +0000"  >&lt;p&gt;Hi Jay, &lt;/p&gt;

&lt;p&gt;I just stumbled upon this issue, since I am on Windows. I just checked out the trunk since I had this problem with the current beta due to this issue. But I still face the same issue:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2013-10-25 12:43:43,422&amp;#93;&lt;/span&gt; FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;Replica Manager on Broker 0&amp;#93;&lt;/span&gt;: Error writing to&lt;br/&gt;
highwatermark file:  (kafka.server.ReplicaManager)&lt;br/&gt;
java.io.IOException: File rename from D:\Databases\Kafka\kafka-logs\replication-&lt;br/&gt;
offset-checkpoint.tmp to D:\Databases\Kafka\kafka-logs\replication-offset-checkpoint failed.&lt;/p&gt;

&lt;p&gt;I also tried to use nio move functionality to see if that solved the problem, but fails for the same reason&lt;/p&gt;

&lt;p&gt;Thanks a lot and regards&lt;/p&gt;

&lt;p&gt;Jan&lt;/p&gt;</comment>
                            <comment id="13816304" author="davidlao" created="Thu, 7 Nov 2013 19:23:27 +0000"  >&lt;p&gt;Hi Jay, Can you provide a patch for 0.8 as well?  I&apos;m running into similar issue on Windows.&lt;/p&gt;</comment>
                            <comment id="13816331" author="tnachen" created="Thu, 7 Nov 2013 19:39:51 +0000"  >&lt;p&gt;Hi Jay,&lt;/p&gt;

&lt;p&gt;The code isn&apos;t doing any locking, but looks like in Windows if you don&apos;t close the writer there is still a pending file lock on the file itself in Windows looking via the file monitor.&lt;/p&gt;

&lt;p&gt;That&apos;s why I needed to add a extra writer.close after the rename fails.&lt;/p&gt;

&lt;p&gt;Tim&lt;/p&gt;</comment>
                            <comment id="13817195" author="jantxu" created="Fri, 8 Nov 2013 11:19:18 +0000"  >&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;I think the problem is that the second check for renameTo == true fails although the rename was executed properly. When I remove the second check, it works without problems and the file gets renamed properly (see the attached patch). I guess the root cause of this problem is the platform dependency of the old File API:&lt;br/&gt;
Many aspects of the behavior of this method are inherently platform-dependent: The rename operation might not be able to move a file from one filesystem to another, it might not be atomic, and it might not succeed if a file with the destination abstract pathname already exists&lt;/p&gt;

&lt;p&gt;Maybe it would be a solution to use NIO instead?&lt;/p&gt;

&lt;p&gt;Best regards&lt;/p&gt;

&lt;p&gt;Jan&lt;/p&gt;</comment>
                            <comment id="13817199" author="jantxu" created="Fri, 8 Nov 2013 11:20:28 +0000"  >&lt;p&gt;The second check for renaming fails on windows, although the renaming worked. &lt;/p&gt;</comment>
                            <comment id="13836698" author="nehanarkhede" created="Mon, 2 Dec 2013 17:16:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jantxu&quot; class=&quot;user-hover&quot; rel=&quot;jantxu&quot;&gt;jantxu&lt;/a&gt; Are you sure this is required? If we always delete the destination file and then execute renameTo, it should work in all cases, no? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sriramsub&quot; class=&quot;user-hover&quot; rel=&quot;sriramsub&quot;&gt;sriramsub&lt;/a&gt; What do you think?&lt;/p&gt;</comment>
                            <comment id="13840328" author="junrao" created="Thu, 5 Dec 2013 17:46:37 +0000"  >&lt;p&gt;We are relying on file renaming being an atomic operation. So, if supported, we should still do rename, instead of deletion followed by creation. The issue with the latter is that if the broker crashes btw the two operations, the broker is left with no checkpoint file.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13195298">KAFKA-7575</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12612813" name="filelock.patch.diff" size="835" author="jantxu" created="Fri, 8 Nov 2013 11:20:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1norb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346429</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>