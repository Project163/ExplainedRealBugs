<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3769] KStream job spending 60% of time writing metrics</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3769</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I&apos;ve been profiling a complex streams job, and found two major hotspots when writing metrics, which take up about 60% of the CPU time of the job. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; A PR is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12973899">KAFKA-3769</key>
            <summary>KStream job spending 60% of time writing metrics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="gfodor">Greg Fodor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 May 2016 06:49:20 +0000</created>
                <updated>Tue, 6 Sep 2016 19:56:42 +0000</updated>
                            <resolved>Tue, 16 Aug 2016 17:43:42 +0000</resolved>
                                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15306306" author="gfodor" created="Mon, 30 May 2016 06:52:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/1447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1447&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15306318" author="gfodor" created="Mon, 30 May 2016 07:05:53 +0000"  >&lt;p&gt;Actually, additionally it looks like the code path for fetching from RocksDB spends most of its time recording the latency metrics &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15306321" author="gfodor" created="Mon, 30 May 2016 07:13:33 +0000"  >&lt;p&gt;It seems it might be desirable to have a way to just flip off some or all of the metrics.&lt;/p&gt;</comment>
                            <comment id="15306381" author="gfodor" created="Mon, 30 May 2016 08:06:37 +0000"  >&lt;p&gt;Consider the PR a first pass, please advise on how we may want to deal with the fact that for KStream jobs with lots of tasks, etc, the overhead of writing the various process/poll/latency metrics is immense.&lt;/p&gt;</comment>
                            <comment id="15309288" author="jkreps" created="Wed, 1 Jun 2016 05:22:33 +0000"  >&lt;p&gt;Nice catch.&lt;/p&gt;</comment>
                            <comment id="15311179" author="gfodor" created="Wed, 1 Jun 2016 21:37:12 +0000"  >&lt;p&gt;Thanks Jay!&lt;/p&gt;

&lt;p&gt;Guozhang, what are your thoughts on instead of trying to reduce the granularity of the metrics, potentially having a way to just disable the process/latency metrics collection? I&apos;m still pretty new to KStreams, and haven&apos;t used these metrics, but I&apos;m guessing they will be used for occasionally tuning the job against production data but not necessarily for operational monitoring. (I could be wrong about this.) As such, it seems that you may want to just have a switch you flip when you are running in production that will disable the metrics and maximize the throughput of the job, and then turn it on selectively when you want to perform performance measurement. &lt;/p&gt;</comment>
                            <comment id="15313295" author="guozhang" created="Thu, 2 Jun 2016 23:31:41 +0000"  >&lt;p&gt;Hello Greg, I will continue the discussion in your PR.&lt;/p&gt;</comment>
                            <comment id="15313369" author="githubbot" created="Fri, 3 Jun 2016 00:14:31 +0000"  >&lt;p&gt;Github user gfodor closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1447&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15325148" author="githubbot" created="Fri, 10 Jun 2016 19:39:03 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3769&quot; title=&quot;KStream job spending 60% of time writing metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3769&quot;&gt;&lt;del&gt;KAFKA-3769&lt;/del&gt;&lt;/a&gt;: Optimize metrics recording overhead&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K3769-optimize-metrics&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1490.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1490.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1490&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 68c889e1cba59280e4c1a37007efcdec6c784878&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-10T17:50:29Z&lt;/p&gt;

&lt;p&gt;    reduce time.milliseconds&lt;/p&gt;

&lt;p&gt;commit ad5403c919fe6ee9e5c5e7e3d9c9f2534a5a3717&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-10T19:38:05Z&lt;/p&gt;

&lt;p&gt;    use milliseconds instead of nanoseconds for state store metrics&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15326778" author="gfodor" created="Mon, 13 Jun 2016 03:40:19 +0000"  >&lt;p&gt;Discussion/resolution moved to: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3811&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-3811&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15340672" author="githubbot" created="Mon, 20 Jun 2016 23:30:36 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1530&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3769&quot; title=&quot;KStream job spending 60% of time writing metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3769&quot;&gt;&lt;del&gt;KAFKA-3769&lt;/del&gt;&lt;/a&gt;: Create new sensors per-thread in KafkaStreams&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K3769-per-thread-metrics&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1530.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1530.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1530&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8a8efa52bc5538ba933f85a0cdb9196d4a222e10&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-20T23:02:34Z&lt;/p&gt;

&lt;p&gt;    use per-thread sensor names&lt;/p&gt;

&lt;p&gt;commit 25859f4b5121e19602741809c18864d99a84574f&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-20T23:02:40Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;trunk&apos; of &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf/kafka&lt;/a&gt; into K3769-per-thread-metrics&lt;/p&gt;

&lt;p&gt;commit 5fae56123fabc0568a99c27ba5b2e792b9f6a685&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-20T23:29:47Z&lt;/p&gt;

&lt;p&gt;    remove unused imports&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15340675" author="githubbot" created="Mon, 20 Jun 2016 23:32:18 +0000"  >&lt;p&gt;Github user guozhangwang closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1490&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15423136" author="githubbot" created="Tue, 16 Aug 2016 17:42:28 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1530&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15423143" author="ewencp" created="Tue, 16 Aug 2016 17:43:42 +0000"  >&lt;p&gt;Issue resolved by pull request 1530&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1530&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15463861" author="gfodor" created="Mon, 5 Sep 2016 01:56:47 +0000"  >&lt;p&gt;I&apos;ve done some additional profiling and I have found that this problem also seems to crop up in complex kafka streams jobs within the Kafka core Selector class. Should I open another JIRA?&lt;/p&gt;</comment>
                            <comment id="15468157" author="guozhang" created="Tue, 6 Sep 2016 18:35:56 +0000"  >&lt;p&gt;Yes please &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Also is it a general issue in &lt;tt&gt;Selector&lt;/tt&gt; class, or a specific issue in Kafka Streams?&lt;/p&gt;</comment>
                            <comment id="15468374" author="gfodor" created="Tue, 6 Sep 2016 19:56:41 +0000"  >&lt;p&gt;It&apos;s just the sensor calls inside of Selector, not Kafka Streams&lt;br/&gt;
specific. I&apos;ll verify as much as I can from the profiler snapshot that&lt;br/&gt;
it&apos;s the same issue and will open a jira.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12977909">KAFKA-3826</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12975359">KAFKA-3785</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yolr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>