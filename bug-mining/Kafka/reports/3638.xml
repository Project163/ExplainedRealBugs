<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16015] kafka-leader-election timeout values always overwritten by default values </title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16015</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Using the&#160;&lt;b&gt;kafka-leader-election.sh&lt;/b&gt; I was getting random timeouts like these:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error completing leader election (PREFERRED) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition: sebatestemptytopic-4: org.apache.kafka.common.errors.TimeoutException: The request timed out.
Error completing leader election (PREFERRED) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition: __CruiseControlMetrics-3: org.apache.kafka.common.errors.TimeoutException: The request timed out.
Error completing leader election (PREFERRED) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition: __KafkaCruiseControlModelTrainingSamples-18: org.apache.kafka.common.errors.TimeoutException: The request timed out.
Error completing leader election (PREFERRED) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition: __KafkaCruiseControlPartitionMetricSamples-8: org.apache.kafka.common.errors.TimeoutException: The request timed out. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These timeouts were raised from the client side as the controller always finished with all the Kafka leader elections.&lt;/p&gt;

&lt;p&gt;One pattern I detected was always the timeouts were raised after about 15 seconds.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So i checked this command has an option to pass configurations&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Option &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Description
------ &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;-----------
--admin.config &amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;: config file&amp;gt; &#160; &#160;Configuration properties files to pass
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; to the admin client &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I created the file in order to increment the values of &lt;b&gt;request.timeout.ms&lt;/b&gt;&#160; and&#160;&lt;b&gt;default.api.timeout.ms.&lt;/b&gt; So even after increasing these values&#160; I got the same result, timeouts were happening, like the new values were not having any effect.&#160;&lt;/p&gt;

&lt;p&gt;So I checked the source code and I came across with a bug, no matter the value we pass to the timeouts the default values were ALWAYS overwriting them.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is the&lt;a href=&quot;https://github.com/apache/kafka/blob/3.6/core/src/main/scala/kafka/admin/LeaderElectionCommand.scala#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.6 branch&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object LeaderElectionCommand &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Logging {
&#160; def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]): Unit = {
&#160; &#160; run(args, 30.second)
&#160; }&#160; def run(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;], timeout: Duration): Unit = {
&#160; &#160; val commandOptions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LeaderElectionCommandOptions(args)
&#160; &#160; CommandLineUtils.maybePrintHelpOrVersion(
&#160; &#160; &#160; commandOptions,
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;This tool attempts to elect a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a set of topic partitions. The type of elections supported are preferred replicas and unclean replicas.&quot;&lt;/span&gt;
&#160; &#160; )&#160; &#160; validate(commandOptions)&#160; &#160; val electionType = commandOptions.options.valueOf(commandOptions.electionType)&#160; &#160; val jsonFileTopicPartitions = Option(commandOptions.options.valueOf(commandOptions.pathToJsonFile)).map { path &#160;=&amp;gt;
&#160; &#160; &#160; parseReplicaElectionData(Utils.readFileAsString(path))
&#160; &#160; }&#160; &#160; val singleTopicPartition = (
&#160; &#160; &#160; Option(commandOptions.options.valueOf(commandOptions.topic)),
&#160; &#160; &#160; Option(commandOptions.options.valueOf(commandOptions.partition))
&#160; &#160; ) match {
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (Some(topic), Some(partition)) =&amp;gt; Some(Set(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopicPartition(topic, partition)))
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; None
&#160; &#160; }&#160; &#160; /* Note: No need to look at --all-topic-partitions as we want &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to be None &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it is use.
&#160; &#160; &#160;* The validate function should be checking that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; option is required &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the --topic and --path-to-json-file
&#160; &#160; &#160;* are not specified.
&#160; &#160; &#160;*/
&#160; &#160; val topicPartitions = jsonFileTopicPartitions.orElse(singleTopicPartition)&#160; &#160; val adminClient = {
&#160; &#160; &#160; val props = Option(commandOptions.options.valueOf(commandOptions.adminClientConfig)).map { config =&amp;gt;
&#160; &#160; &#160; &#160; Utils.loadProps(config)
&#160; &#160; &#160; }.getOrElse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties())&#160; &#160; &#160; props.setProperty(
&#160; &#160; &#160; &#160; AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG,
&#160; &#160; &#160; &#160; commandOptions.options.valueOf(commandOptions.bootstrapServer)
&#160; &#160; &#160; )
&#160; &#160; &#160; props.setProperty(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, timeout.toMillis.toString)
&#160; &#160; &#160; props.setProperty(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, (timeout.toMillis / 2).toString)&#160; &#160; &#160; Admin.create(props)
&#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As we can see the default timeout is 30 seconds, and the request timeout is 30/2 which validates the 15 seconds timeout.&lt;/p&gt;

&lt;p&gt;Also we can see in the code how the custom values passed by the config file are overwritten by the defaults.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The proposal is easy, we need to use the defaults values only when the timeouts were not defined by the config file, for example like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!props.containsKey(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG)) {
&#160; &#160; &#160; &#160; &#160; props.setProperty(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, timeout.toMillis.toString)
&#160; &#160; &#160; }
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!props.containsKey(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG)) {
&#160; &#160; &#160; &#160; &#160; props.setProperty(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, (timeout.toMillis / 2).toString)
&#160; &#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I tested it and now I am able to modify the timeouts and make my application to catch the result of the command properly.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13561969">KAFKA-16015</key>
            <summary>kafka-leader-election timeout values always overwritten by default values </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergio_troiano@hotmail.com">Sergio Troiano</assignee>
                                    <reporter username="sergio_troiano@hotmail.com">Sergio Troiano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Dec 2023 09:42:25 +0000</created>
                <updated>Fri, 29 Dec 2023 09:56:08 +0000</updated>
                            <resolved>Fri, 29 Dec 2023 09:55:49 +0000</resolved>
                                    <version>3.5.1</version>
                    <version>3.6.1</version>
                                    <fixVersion>3.7.0</fixVersion>
                    <fixVersion>3.8.0</fixVersion>
                                    <component>admin</component>
                    <component>tools</component>
                        <due>Fri, 15 Dec 2023 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17797113" author="JIRAUSER285632" created="Fri, 15 Dec 2023 09:47:02 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pprovenzano&quot; class=&quot;user-hover&quot; rel=&quot;pprovenzano&quot;&gt;pprovenzano&lt;/a&gt; , I will open a PR in the 3.6 branch and also in the trunk one as I see the bug is in place, one detail I see is in the trunk the&#160;&lt;b&gt;LeaderElectionCommand.scala&lt;/b&gt;&#160;was rewritten in &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/tools/src/main/java/org/apache/kafka/tools/LeaderElectionCommand.java#L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java here&lt;/a&gt; . If you agree I can send the PR for both branches&#160;&lt;/p&gt;</comment>
                            <comment id="17797218" author="JIRAUSER298332" created="Fri, 15 Dec 2023 15:05:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergio_troiano%40hotmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sergio_troiano@hotmail.com&quot;&gt;sergio_troiano@hotmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I would suggest opening a PR for trunk first so that it can then be cherry-picked to 3.7 branch before code freeze.&lt;/p&gt;

&lt;p&gt;The 3.6 and 3.5 point releases have already shipped and this isn&apos;t a security issue that needs to be immediately addressed so we have more time to get the fix into those branches.&lt;/p&gt;</comment>
                            <comment id="17797219" author="JIRAUSER285632" created="Fri, 15 Dec 2023 15:07:36 +0000"  >&lt;p&gt;Thanks as usual &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pprovenzano&quot; class=&quot;user-hover&quot; rel=&quot;pprovenzano&quot;&gt;pprovenzano&lt;/a&gt; &#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will open then only the PR for trunk , I will update the ticket when the PR is ready&lt;/p&gt;</comment>
                            <comment id="17797933" author="JIRAUSER285632" created="Sun, 17 Dec 2023 14:35:43 +0000"  >&lt;p&gt;Pr open,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/15030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/15030&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ma8g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>