<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-537] expose clientId and correlationId in ConsumerConfig</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-537</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We need to expose clientId and correlationId in ConsumerConfig and use it properly in AbstractFetcherThread. For follower fetchers, we should set the clientId to a special string, something list &quot;follower&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12609555">KAFKA-537</key>
            <summary>expose clientId and correlationId in ConsumerConfig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yeyangever">Yang Ye</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>bugs</label>
                            <label>newbie</label>
                    </labels>
                <created>Fri, 28 Sep 2012 15:59:33 +0000</created>
                <updated>Tue, 16 Oct 2012 17:31:30 +0000</updated>
                            <resolved>Tue, 16 Oct 2012 17:31:20 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13467196" author="junrao" created="Mon, 1 Oct 2012 21:07:31 +0000"  >&lt;p&gt;In this jira, we can probably also log the client id when hit unexpected exceptions in the server.&lt;/p&gt;</comment>
                            <comment id="13472678" author="jkreps" created="Tue, 9 Oct 2012 19:44:27 +0000"  >&lt;p&gt;The correlation id is meant to be a per-connection, per-client, per-request counter. This lets the client have multiple in-flight requests at the same time on the same connection. So it should not be exposed in the client config as a static value. Instead we should initialize an AtomicInteger to 0 and pass in counter.getAndIncrement() to the request on each call.&lt;/p&gt;</comment>
                            <comment id="13473833" author="nehanarkhede" created="Thu, 11 Oct 2012 04:36:06 +0000"  >&lt;p&gt;Agree with Jay here. I assume this is to enable special consumers that can fetch from any replica and to be able to tell external consumers from followers. Wouldn&apos;t the clientId suffice ?&lt;/p&gt;</comment>
                            <comment id="13473835" author="yeyangever" created="Thu, 11 Oct 2012 04:44:11 +0000"  >&lt;p&gt;To enable special consumer to fetch from any replica, we don&apos;t use client id, we use the replicaId in the fetch request. (-1 means from ordinary consumer, -2 from low level consumer (that can fetch from any replica, n&amp;gt;=0 means from broker n)&lt;/p&gt;

&lt;p&gt;Client id is currently used for identify each difference service. (client of kafka)&lt;/p&gt;

&lt;p&gt;correlation id is currently not used. We can discuss how to use it tmr&lt;/p&gt;
</comment>
                            <comment id="13474712" author="yeyangever" created="Fri, 12 Oct 2012 01:25:38 +0000"  >&lt;p&gt;&lt;br/&gt;
As suggested by Jay and Neha, I added a &quot;AtomicInteger&quot; field in FetchRequestBuilder to indicate and maintain the correlationId. &lt;/p&gt;</comment>
                            <comment id="13474725" author="nehanarkhede" created="Fri, 12 Oct 2012 01:54:57 +0000"  >&lt;p&gt;Forgive me for asking a pretty basic question, what is the purpose of this JIRA and what problem is it trying to solve ?&lt;/p&gt;</comment>
                            <comment id="13474736" author="yeyangever" created="Fri, 12 Oct 2012 02:26:14 +0000"  >&lt;p&gt;By exposing clientId to ConsumerConfig, different consumers can specify their own clientId&apos;s. So that we will be able to log correct client of kafka (various kind of services)&lt;/p&gt;

&lt;p&gt;Also this jira makes the correlationId meaningful  (it&apos;s not used before). This is supposed to indicate a request-response correlation between a client and the server&lt;/p&gt;</comment>
                            <comment id="13474739" author="nehanarkhede" created="Fri, 12 Oct 2012 02:32:12 +0000"  >&lt;p&gt;Got it, thanks for the explanation, makes it easier to review ! &lt;/p&gt;</comment>
                            <comment id="13474761" author="nehanarkhede" created="Fri, 12 Oct 2012 03:44:55 +0000"  >&lt;p&gt;v2 doesn&apos;t apply cleanly, probably due to the &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-432&quot; title=&quot;allow consumer to read from followers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-432&quot;&gt;&lt;del&gt;KAFKA-432&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-510&quot; title=&quot;broker needs to know the replication factor per partition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-510&quot;&gt;&lt;del&gt;KAFKA-510&lt;/del&gt;&lt;/a&gt; checkin. I&apos;m afraid this patch needs a rebase. Thanks for your patience !&lt;/p&gt;</comment>
                            <comment id="13475110" author="nehanarkhede" created="Fri, 12 Oct 2012 16:19:24 +0000"  >&lt;p&gt;Until you rebase, I reviewed v2 on an older svn review. Here are some review comments -&lt;/p&gt;

&lt;p&gt;1. ConsumerConfig&lt;/p&gt;

&lt;p&gt;1. Every config value has a comment explaining its purpose. Please can you add this for the new config &quot;clientid&quot; ?&lt;br/&gt;
2. I wonder if specifying a default value of empty string is useful ? Maybe groupid makes more sense or no default at all.&lt;/p&gt;

&lt;p&gt;2. FetchRequest&lt;/p&gt;

&lt;p&gt;2.1 According to coding convention, every constant is in camel case with first letter capital. Please can you change replicaFetcherClientId to ReplicaFetcherClientId ?&lt;/p&gt;

&lt;p&gt;3. KafkaApis&lt;/p&gt;

&lt;p&gt;3.1 Fix the typo - private def appendToLocalLog(producerRquest: ProducerRequest): Iterable&lt;span class=&quot;error&quot;&gt;&amp;#91;ProduceResult&amp;#93;&lt;/span&gt; = {&lt;br/&gt;
3.2 Let&apos;s fix the requestLogger to print the clientId. This allows us to have a meaningful access log for Kafka where requests can be traced back to client ids.&lt;/p&gt;

&lt;p&gt;4. ReplicaFetcherThread&lt;/p&gt;

&lt;p&gt;4.1 Every replica&apos;s clientId is &quot;replica fetcher&quot;. I wonder if we can add the replica&apos;s id/host/both to the replica&apos;s client id. This will allow us to differentiate amongst requests from the various replicas at the leader.&lt;/p&gt;

&lt;p&gt;5. FetchRequestBuilder&lt;/p&gt;

&lt;p&gt;Right now, we are depending on the user to not re-create the FetchRequestBuilder each time. How about making the builder a singleton so that is not possible ? That way, we can guarantee that it is initialized to 0 only one per client.&lt;/p&gt;</comment>
                            <comment id="13476407" author="yeyangever" created="Mon, 15 Oct 2012 20:28:11 +0000"  >&lt;p&gt;Thanks for the comments, to address then:&lt;/p&gt;

&lt;p&gt;1. ConsumerConfig&lt;br/&gt;
1. Every config value has a comment explaining its purpose. Please can you add this for the new config &quot;clientid&quot; ?&lt;/p&gt;

&lt;p&gt;&amp;#8212; added&lt;/p&gt;

&lt;p&gt;2. I wonder if specifying a default value of empty string is useful ? Maybe groupid makes more sense or no default at all.&lt;/p&gt;

&lt;p&gt;&amp;#8212; Agree, empty string is not meaningful at all. So what about set it default to groupid, also this empty string &quot;DefaultClientId&quot; is kept and used as default value of FetchRequest and FetchRequestBuilder. (This default value is only used in testing, when used by real consumer, the clientId will be set to the clientId of the consumer config&lt;/p&gt;


&lt;p&gt;2. FetchRequest&lt;/p&gt;

&lt;p&gt;2.1 According to coding convention, every constant is in camel case with first letter capital. Please can you change replicaFetcherClientId to ReplicaFetcherClientId ?&lt;/p&gt;

&lt;p&gt;&amp;#8212; changed&lt;/p&gt;


&lt;p&gt;3. KafkaApis&lt;/p&gt;

&lt;p&gt;3.1 Fix the typo - private def appendToLocalLog(producerRquest: ProducerRequest): Iterable&lt;span class=&quot;error&quot;&gt;&amp;#91;ProduceResult&amp;#93;&lt;/span&gt; = {&lt;/p&gt;

&lt;p&gt;&amp;#8212; new patch does not affect KafkaApis.scala now, it should be addressed in other patches&lt;/p&gt;


&lt;p&gt;3.2 Let&apos;s fix the requestLogger to print the clientId. This allows us to have a meaningful access log for Kafka where requests can be traced back to client ids.&lt;/p&gt;

&lt;p&gt;&amp;#8212; in requestLogger.trace(&quot;Handling fetch request &quot; + fetchRequest.toString), the fetchRequest.toString should also contain the clientId, so I think we don&apos;t need do it separately &lt;/p&gt;




&lt;p&gt;4. ReplicaFetcherThread&lt;/p&gt;

&lt;p&gt;4.1 Every replica&apos;s clientId is &quot;replica fetcher&quot;. I wonder if we can add the replica&apos;s id/host/both to the replica&apos;s client id. This will allow us to differentiate amongst requests from the various replicas at the leader.&lt;/p&gt;

&lt;p&gt;&amp;#8212; added broker host and port in the clientId&lt;/p&gt;


&lt;p&gt;5. FetchRequestBuilder&lt;/p&gt;

&lt;p&gt;Right now, we are depending on the user to not re-create the FetchRequestBuilder each time. How about making the builder a singleton so that is not possible ? That way, we can guarantee that it is initialized to 0 only one per client.&lt;/p&gt;

&lt;p&gt;&amp;#8212; We cannot make it a singleton because the fetchMap within each request builder cannot be shared&lt;/p&gt;</comment>
                            <comment id="13477190" author="nehanarkhede" created="Tue, 16 Oct 2012 17:31:30 +0000"  >&lt;p&gt;Committed the v3 patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12548444" name="kafka_537_v1.diff" size="9043" author="yeyangever" created="Tue, 9 Oct 2012 19:39:19 +0000"/>
                            <attachment id="12548841" name="kafka_537_v2.diff" size="14890" author="yeyangever" created="Fri, 12 Oct 2012 01:25:38 +0000"/>
                            <attachment id="12549198" name="kafka_537_v3.diff" size="16989" author="yeyangever" created="Mon, 15 Oct 2012 20:28:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0297b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>