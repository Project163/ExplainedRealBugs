<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2121] prevent potential resource leak in KafkaProducer and KafkaConsumer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2121</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;On Mon, Apr 13, 2015 at 7:17 PM, Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt; wrote:&lt;br/&gt;
It is a valid problem and we should correct it as soon as possible, I&apos;m&lt;br/&gt;
with Ewen regarding the solution.&lt;/p&gt;

&lt;p&gt;On Mon, Apr 13, 2015 at 5:05 PM, Ewen Cheslack-Postava &amp;lt;ewen@confluent.io&amp;gt;&lt;br/&gt;
wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt; Steven,&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Looks like there is even more that could potentially be leaked &amp;#8211; since key&lt;br/&gt;
&amp;gt; and value serializers are created and configured at the end, even the IO&lt;br/&gt;
&amp;gt; thread allocated by the producer could leak. Given that, I think 1 isn&apos;t a&lt;br/&gt;
&amp;gt; great option since, as you said, it doesn&apos;t really address the underlying&lt;br/&gt;
&amp;gt; issue.&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; 3 strikes me as bad from a user experience perspective. It&apos;s true we might&lt;br/&gt;
&amp;gt; want to introduce additional constructors to make testing easier, but the&lt;br/&gt;
&amp;gt; more components I need to allocate myself and inject into the producer&apos;s&lt;br/&gt;
&amp;gt; constructor, the worse the default experience is. And since you would have&lt;br/&gt;
&amp;gt; to inject the dependencies to get correct, non-leaking behavior, it will&lt;br/&gt;
&amp;gt; always be more code than previously (and a backwards incompatible change).&lt;br/&gt;
&amp;gt; Additionally, the code creating a the producer would have be more&lt;br/&gt;
&amp;gt; complicated since it would have to deal with the cleanup carefully whereas&lt;br/&gt;
&amp;gt; it previously just had to deal with the exception. Besides, for testing&lt;br/&gt;
&amp;gt; specifically, you can avoid exposing more constructors just for testing by&lt;br/&gt;
&amp;gt; using something like PowerMock that let you mock private methods. That&lt;br/&gt;
&amp;gt; requires a bit of code reorganization, but doesn&apos;t affect the public&lt;br/&gt;
&amp;gt; interface at all.&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; So my take is that a variant of 2 is probably best. I&apos;d probably do two&lt;br/&gt;
&amp;gt; things. First, make close() safe to call even if some fields haven&apos;t been&lt;br/&gt;
&amp;gt; initialized, which presumably just means checking for null fields. (You&lt;br/&gt;
&amp;gt; might also want to figure out if all the methods close() calls are&lt;br/&gt;
&amp;gt; idempotent and decide whether some fields should be marked non-final and&lt;br/&gt;
&amp;gt; cleared to null when close() is called). Second, add the try/catch as you&lt;br/&gt;
&amp;gt; suggested, but just use close().&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; -Ewen&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; On Mon, Apr 13, 2015 at 3:53 PM, Steven Wu &amp;lt;stevenz3wu@gmail.com&amp;gt; wrote:&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; Here is the resource leak problem that we have encountered when 0.8.2&lt;br/&gt;
&amp;gt; java&lt;br/&gt;
&amp;gt; &amp;gt; KafkaProducer failed in constructor. here is the code snippet of&lt;br/&gt;
&amp;gt; &amp;gt; KafkaProducer to illustrate the problem.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; -------------------------------&lt;br/&gt;
&amp;gt; &amp;gt; public KafkaProducer(ProducerConfig config, Serializer&amp;lt;K&amp;gt; keySerializer,&lt;br/&gt;
&amp;gt; &amp;gt; Serializer&amp;lt;V&amp;gt; valueSerializer) &lt;/p&gt;
{
&amp;gt; &amp;gt;
&amp;gt; &amp;gt;     // create metrcis reporter via reflection
&amp;gt; &amp;gt;     List&amp;lt;MetricsReporter&amp;gt; reporters =
&amp;gt; &amp;gt;
&amp;gt; &amp;gt;
&amp;gt; config.getConfiguredInstances(ProducerConfig.METRIC_REPORTER_CLASSES_CONFIG,
&amp;gt; &amp;gt; MetricsReporter.class);
&amp;gt; &amp;gt;
&amp;gt; &amp;gt;     // validate bootstrap servers
&amp;gt; &amp;gt;     List&amp;lt;InetSocketAddress&amp;gt; addresses =
&amp;gt; &amp;gt;
&amp;gt; &amp;gt;
&amp;gt; ClientUtils.parseAndValidateAddresses(config.getList(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG));
&amp;gt; &amp;gt;
&amp;gt; &amp;gt; }
&lt;p&gt;&amp;gt; &amp;gt; -------------------------------&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; let&apos;s say MyMetricsReporter creates a thread in constructor. if hostname&lt;br/&gt;
&amp;gt; &amp;gt; validation threw an exception, constructor won&apos;t call the close method of&lt;br/&gt;
&amp;gt; &amp;gt; MyMetricsReporter to clean up the resource. as a result, we created&lt;br/&gt;
&amp;gt; thread&lt;br/&gt;
&amp;gt; &amp;gt; leak issue. this becomes worse when we try to auto recovery (i.e. keep&lt;br/&gt;
&amp;gt; &amp;gt; creating KafkaProducer again -&amp;gt; failing again -&amp;gt; more thread leaks).&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; there are multiple options of fixing this.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; 1) just move the hostname validation to the beginning. but this is only&lt;br/&gt;
&amp;gt; fix&lt;br/&gt;
&amp;gt; &amp;gt; one symtom. it didn&apos;t fix the fundamental problem. what if some other&lt;br/&gt;
&amp;gt; lines&lt;br/&gt;
&amp;gt; &amp;gt; throw an exception.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; 2) use try-catch. in the catch section, try to call close methods for any&lt;br/&gt;
&amp;gt; &amp;gt; non-null objects constructed so far.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; 3) explicitly declare the dependency in the constructor. this way, when&lt;br/&gt;
&amp;gt; &amp;gt; KafkaProducer threw an exception, I can call close method of metrics&lt;br/&gt;
&amp;gt; &amp;gt; reporters for releasing resources.&lt;br/&gt;
&amp;gt; &amp;gt;     KafkaProducer(..., List&amp;lt;MetricsReporter&amp;gt; reporters)&lt;br/&gt;
&amp;gt; &amp;gt; we don&apos;t have to dependency injection framework. but generally hiding&lt;br/&gt;
&amp;gt; &amp;gt; dependency is a bad coding practice. it is also hard to plug in mocks for&lt;br/&gt;
&amp;gt; &amp;gt; dependencies. this is probably the most intrusive change.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; I am willing to submit a patch. but like to hear your opinions on how we&lt;br/&gt;
&amp;gt; &amp;gt; should fix the issue.&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt; &amp;gt; Thanks,&lt;br/&gt;
&amp;gt; &amp;gt; Steven&lt;br/&gt;
&amp;gt; &amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; &amp;#8211;&lt;br/&gt;
&amp;gt; Thanks,&lt;br/&gt;
&amp;gt; Ewen&lt;br/&gt;
&amp;gt;&lt;/p&gt;



&lt;p&gt;&amp;#8211;&lt;br/&gt;
-- Guozhang&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820878">KAFKA-2121</key>
            <summary>prevent potential resource leak in KafkaProducer and KafkaConsumer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stevenz3wu">Steven Zhen Wu</assignee>
                                    <reporter username="stevenz3wu">Steven Zhen Wu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Apr 2015 17:15:28 +0000</created>
                <updated>Fri, 8 May 2015 04:04:21 +0000</updated>
                            <resolved>Fri, 8 May 2015 04:04:21 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14494931" author="stevenz3wu" created="Tue, 14 Apr 2015 21:31:41 +0000"  >&lt;p&gt;add a unit test file&lt;/p&gt;</comment>
                            <comment id="14495183" author="ewencp" created="Wed, 15 Apr 2015 00:09:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; looks like a good start. I&apos;ll leave some comments here, but it&apos;s usually easier to do reviews if you submit the to reviewboard. The patch submission tool makes this process pretty painless once you&apos;ve got it setup: &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/Patch+submission+and+review#Patchsubmissionandreview-Kafkapatchreviewtool&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/Patch+submission+and+review#Patchsubmissionandreview-Kafkapatchreviewtool&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I&apos;m getting a bunch of checkstyle complaints when I try to test. These should all be easy to fix (and should be causing tests to fail before even running). The only rule that might not be obvious from the error message is that the static final field in MockMetricsReporter is expected to be all-caps since it looks like a constant to checkstyle.&lt;/li&gt;
	&lt;li&gt;In the constructor, could we throw some subclass of KafkaException instead? The new clients try to stick to that exception hierarchy except in a few special cases. Alternatively, maybe if we caught Error and RuntimeException instead of Throwable then we could just rethrow the same exception?&lt;/li&gt;
	&lt;li&gt;The new version of close() will swallow exceptions when called normally (i.e. not from the constructor). They&apos;ll be logged, but the caller won&apos;t see the exception anymore. Maybe we should save the first exception and rethrow it?&lt;/li&gt;
	&lt;li&gt;Exception messages should be capitalized.&lt;/li&gt;
	&lt;li&gt;In the test, we should probably have an assert outside the catch. And is there any reason the closeCount is being reset to 0?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14495206" author="stevenz3wu" created="Wed, 15 Apr 2015 00:29:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;&lt;br/&gt;
I will create a item on reviewboard. will try to address your comments there.&lt;/p&gt;

&lt;p&gt;I  wished that apache/kafka just used github. then it will be really painless from the beginning. &lt;/p&gt;</comment>
                            <comment id="14497051" author="stevenz3wu" created="Wed, 15 Apr 2015 21:31:18 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14497057" author="stevenz3wu" created="Wed, 15 Apr 2015 21:37:58 +0000"  >&lt;p&gt;finally, I was able to post to review board. had some issues with my python installation. finally used virtualenv to make it work. I haven&apos;t yet addressed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; comments yet. will update the reviewboard.&lt;/p&gt;</comment>
                            <comment id="14498282" author="stevenz3wu" created="Thu, 16 Apr 2015 16:55:19 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14498371" author="stevenz3wu" created="Thu, 16 Apr 2015 17:44:00 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14501669" author="stevenz3wu" created="Sun, 19 Apr 2015 03:09:27 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14502275" author="stevenz3wu" created="Mon, 20 Apr 2015 03:08:52 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14502295" author="stevenz3wu" created="Mon, 20 Apr 2015 03:30:24 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14502297" author="stevenz3wu" created="Mon, 20 Apr 2015 03:32:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I have applied same fix to KafkaConsumer. &lt;/p&gt;

&lt;p&gt;I also made one change to KafkaProducer. I think it should be safe. basically, I moved the close of NetworkClient in Sender to KafkaProducer.&lt;/p&gt;</comment>
                            <comment id="14502306" author="stevenz3wu" created="Mon, 20 Apr 2015 03:42:14 +0000"  >&lt;p&gt;BTW, when I ran &quot;./gradlew clients:test&quot; on cmd-line, there are a few test failures. But when I ran them in IDE, they are fine.&lt;/p&gt;

&lt;p&gt;SenderTest&lt;br/&gt;
RecordAccumulatorTest&lt;br/&gt;
PartitionerTest&lt;br/&gt;
BufferPoolTest&lt;/p&gt;</comment>
                            <comment id="14502327" author="ewencp" created="Mon, 20 Apr 2015 04:27:26 +0000"  >&lt;p&gt;Odd, I don&apos;t see those, but I do see some like this now:&lt;/p&gt;

&lt;p&gt;kafka.api.ProducerFailureHandlingTest &amp;gt; testSendAfterClosed FAILED&lt;br/&gt;
    org.apache.kafka.common.KafkaException: Failed to close kafka producer&lt;br/&gt;
        at org.apache.kafka.clients.producer.KafkaProducer.close(KafkaProducer.java:555)&lt;br/&gt;
        at org.apache.kafka.clients.producer.KafkaProducer.close(KafkaProducer.java:526)&lt;br/&gt;
        at kafka.api.ProducerFailureHandlingTest.tearDown(ProducerFailureHandlingTest.scala:73)&lt;/p&gt;

&lt;p&gt;        Caused by:&lt;br/&gt;
        java.nio.channels.ClosedSelectorException&lt;br/&gt;
            at sun.nio.ch.SelectorImpl.keys(SelectorImpl.java:51)&lt;br/&gt;
            at org.apache.kafka.common.network.Selector.close(Selector.java:175)&lt;br/&gt;
            at org.apache.kafka.clients.NetworkClient.close(NetworkClient.java:319)&lt;br/&gt;
            at org.apache.kafka.clients.ClientUtils.closeQuietly(ClientUtils.java:57)&lt;br/&gt;
            at org.apache.kafka.clients.producer.KafkaProducer.close(KafkaProducer.java:549)&lt;br/&gt;
            ... 2 more&lt;/p&gt;

&lt;p&gt;Note that this is in core:tests. A bunch of client behavior isn&apos;t thoroughly tested until integration tests with the server.&lt;/p&gt;

&lt;p&gt;The problem is that NetworkClient doesn&apos;t seem to handle close() being called twice. Since this is already available public interface, we&apos;d have to consider that a regression &amp;#8211; we can&apos;t really change that behavior at this point just by cleaning up the tests. I think this is related to the change you made to pull that call out of Sender because it used to be called from Sender.run() and that wouldn&apos;t have been invoked twice. Another solution might be to null out the fields of KafkaProducer and KafkaConsumer as you close() them, but this probably means we need to think through that change or revert it.&lt;/p&gt;</comment>
                            <comment id="14503086" author="stevenz3wu" created="Mon, 20 Apr 2015 16:06:14 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14503172" author="stevenz3wu" created="Mon, 20 Apr 2015 16:51:56 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14503176" author="stevenz3wu" created="Mon, 20 Apr 2015 16:52:53 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14503190" author="stevenz3wu" created="Mon, 20 Apr 2015 16:57:55 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14503278" author="stevenz3wu" created="Mon, 20 Apr 2015 17:41:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I made two more changes in latest commit&lt;br/&gt;
1) moved close of NetworkClient back in Sender for the reason you outlined above&lt;br/&gt;
2) close deserializers in KafkaConsumer similar to what KafkaProducer does with serializers&lt;/p&gt;</comment>
                            <comment id="14503279" author="stevenz3wu" created="Mon, 20 Apr 2015 17:41:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I made two more changes in latest commit&lt;br/&gt;
1) moved close of NetworkClient back in Sender for the reason you outlined above&lt;br/&gt;
2) close deserializers in KafkaConsumer similar to what KafkaProducer does with serializers&lt;/p&gt;</comment>
                            <comment id="14503345" author="ewencp" created="Mon, 20 Apr 2015 18:25:12 +0000"  >&lt;p&gt;Latest patch LGTM, maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; could review when he has a chance? This patch also ends up fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2126&quot; title=&quot;New consumer does not correctly configure deserializers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2126&quot;&gt;&lt;del&gt;KAFKA-2126&lt;/del&gt;&lt;/a&gt; since it needed to in order to close the deserializers properly, so I closed that one in favor of this patch.&lt;/p&gt;</comment>
                            <comment id="14504384" author="stevenz3wu" created="Tue, 21 Apr 2015 05:48:38 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33242/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33242/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14507450" author="guozhang" created="Wed, 22 Apr 2015 17:15:59 +0000"  >&lt;p&gt;Thanks for the patch Steven, committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14507509" author="stevenz3wu" created="Wed, 22 Apr 2015 17:39:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; thanks. would it go in next 0.8.3 release?&lt;/p&gt;</comment>
                            <comment id="14507518" author="ewencp" created="Wed, 22 Apr 2015 17:41:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; Yes, it&apos;ll be released with 0.8.3.&lt;/p&gt;</comment>
                            <comment id="14510117" author="slydon" created="Fri, 24 Apr 2015 00:10:19 +0000"  >&lt;p&gt;While this does resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-2126&lt;/a&gt;, there is a slight bug with the &apos;isKey&apos; parameter which would be solved by the following patch.  This is so minor it seems silly to open a new branch+ticket+reviewboard just to change a boolean value.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- a/clients/src/main/java/org/apache/kafka/clients/consumer/KafkaConsumer.java
+++ b/clients/src/main/java/org/apache/kafka/clients/consumer/KafkaConsumer.java
@@ -495,7 +495,7 @@ public class KafkaConsumer&amp;lt;K, V&amp;gt; implements Consumer&amp;lt;K, V&amp;gt; {
             if (keyDeserializer == null) {
                 this.keyDeserializer = config.getConfiguredInstance(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,
                         Deserializer.class);
-                this.keyDeserializer.configure(config.originals(), false);
+                this.keyDeserializer.configure(config.originals(), true);
             } else {
                 this.keyDeserializer = keyDeserializer;
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14514675" author="ewencp" created="Mon, 27 Apr 2015 18:43:26 +0000"  >&lt;p&gt;Reopening since there&apos;s a trivial follow up patch that still needs to be applied. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; since you committed the original patch, can you follow up on this?&lt;/p&gt;</comment>
                            <comment id="14516028" author="stevenz3wu" created="Tue, 28 Apr 2015 00:21:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I would like to hear your opinion about a source incompatibility scenario that my colleague &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=allenxwang&quot; class=&quot;user-hover&quot; rel=&quot;allenxwang&quot;&gt;allenxwang&lt;/a&gt; pointed out.&lt;/p&gt;

&lt;p&gt;Serializer&amp;lt;T&amp;gt; keySerializer = ...&lt;br/&gt;
Serializer&amp;lt;T&amp;gt; valueSerializer = ...&lt;br/&gt;
KafkaProducer producer = new KafkaProducer(config, keySerializer, valueSerializer)&lt;br/&gt;
// ...&lt;br/&gt;
keySerializer.close()&lt;br/&gt;
valueSerializer.close()&lt;/p&gt;

&lt;p&gt;with this change, Serializer#close now throws an checked IOException that requires catch. it will cause compiling error.  are you concerned with the above problem?&lt;/p&gt;

&lt;p&gt;Obviously, this won&apos;t be an issue if user rely on KafkaProducer to close the serializers and don&apos;t explicitly close serializers. &lt;br/&gt;
For the long term, I think it is beneficial to converge on the java.io.Closeable interface. this may be a very small price to pay for short term.&lt;/p&gt;</comment>
                            <comment id="14516054" author="guozhang" created="Tue, 28 Apr 2015 00:39:45 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slydon&quot; class=&quot;user-hover&quot; rel=&quot;slydon&quot;&gt;slydon&lt;/a&gt; for pointing out the bug, will make a follow-up commit.&lt;/p&gt;

&lt;p&gt;Regarding IOException in close(): hmm, I overlooked this is actually an API change, but I also agree it is beneficial to move to Closeable for the long term. Will bring it up to the dev mailing list for discussion.&lt;/p&gt;</comment>
                            <comment id="14516064" author="ewencp" created="Tue, 28 Apr 2015 00:44:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; Interesting. Looks like this wasn&apos;t obvious for a couple of reasons:&lt;/p&gt;

&lt;p&gt;1. Removing throws clauses is fine when overriding, so the implementations didn&apos;t cause the compiler to complain.&lt;br/&gt;
2. There&apos;s no testing of the implementation classes directly, so nothing was exercising their close() methods. Even if we tested them directly, we&apos;d have to make sure to test them using a Serializer variable instead of their more specific type in order to force handling of the exception.&lt;br/&gt;
3. I wasn&apos;t expecting user code to be calling close() on those objects &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Apparently that was an incorrect assumption on my part.&lt;/p&gt;

&lt;p&gt;So yeah, I think this unfortunately requires us to revert those changes. I think the other changes to Closeable should be fine since they are internal classes &amp;#8211; they may be marked public, but we don&apos;t consider them as such (they are filtered out of the javadocs).&lt;/p&gt;

&lt;p&gt;Not sure what that means for being able to avoid all that duplicated code for the close() calls, it may just have to be messy. We could potentially introduce an interface for non-IOException-throwing closeables, but I&apos;m not sure that&apos;s worth the trouble?&lt;/p&gt;</comment>
                            <comment id="14517596" author="stevenz3wu" created="Tue, 28 Apr 2015 18:26:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I am ok to reverse the change on Serializer. &lt;/p&gt;

&lt;p&gt;what about Deserializer? I assume nobody is using it because consumer is not feature completed yet. so we can keep the change.&lt;/p&gt;

&lt;p&gt;should we wait more feedbacks on the DISCUSS email thread that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; started?&lt;/p&gt;

&lt;p&gt;should I include the revert as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2151&quot; title=&quot;make MockMetricsReporter a little more generic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2151&quot;&gt;&lt;del&gt;KAFKA-2151&lt;/del&gt;&lt;/a&gt;? or a new jira for reverting? what&apos;s the common practice here?&lt;/p&gt;</comment>
                            <comment id="14517647" author="ewencp" created="Tue, 28 Apr 2015 18:50:35 +0000"  >&lt;p&gt;I&apos;d give people some more time to comment, it&apos;s tough to keep up with the volume of that list and it hasn&apos;t been a full day yet.&lt;/p&gt;

&lt;p&gt;If we revert it, I&apos;d personally revert both just for consistency, but if it generates any more discussion on the mailing list you should probably just ask people there what they think.&lt;/p&gt;

&lt;p&gt;On where to submit the patch, I don&apos;t know that there is a common practice for this. I&apos;d just submit it here. That way it will get tagged with this JIRA in the commit log message which makes it easy for people to track down the origin of the changes.&lt;/p&gt;</comment>
                            <comment id="14518533" author="stevenz3wu" created="Wed, 29 Apr 2015 01:37:44 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33654/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33654/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14523538" author="stevenz3wu" created="Fri, 1 May 2015 18:00:10 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33760/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33760/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14524185" author="stevenz3wu" created="Fri, 1 May 2015 22:42:35 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33760/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33760/diff/&lt;/a&gt;&lt;br/&gt;
 against branch apache/trunk&lt;/p&gt;</comment>
                            <comment id="14533822" author="guozhang" created="Fri, 8 May 2015 04:04:04 +0000"  >&lt;p&gt;Committed the followup patch to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12821259">KAFKA-2126</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12729795" name="KAFKA-2121.patch" size="10049" author="stevenz3wu" created="Fri, 1 May 2015 18:00:09 +0000"/>
                            <attachment id="12729017" name="KAFKA-2121.patch" size="6114" author="stevenz3wu" created="Wed, 29 Apr 2015 01:37:43 +0000"/>
                            <attachment id="12725694" name="KAFKA-2121.patch" size="15541" author="stevenz3wu" created="Wed, 15 Apr 2015 21:31:18 +0000"/>
                            <attachment id="12725914" name="KAFKA-2121_2015-04-16_09:55:14.patch" size="22958" author="stevenz3wu" created="Thu, 16 Apr 2015 16:55:18 +0000"/>
                            <attachment id="12725927" name="KAFKA-2121_2015-04-16_10:43:55.patch" size="25750" author="stevenz3wu" created="Thu, 16 Apr 2015 17:43:59 +0000"/>
                            <attachment id="12726416" name="KAFKA-2121_2015-04-18_20:09:20.patch" size="19279" author="stevenz3wu" created="Sun, 19 Apr 2015 03:09:26 +0000"/>
                            <attachment id="12726504" name="KAFKA-2121_2015-04-19_20:08:45.patch" size="36560" author="stevenz3wu" created="Mon, 20 Apr 2015 03:08:52 +0000"/>
                            <attachment id="12726506" name="KAFKA-2121_2015-04-19_20:30:18.patch" size="44331" author="stevenz3wu" created="Mon, 20 Apr 2015 03:30:23 +0000"/>
                            <attachment id="12726594" name="KAFKA-2121_2015-04-20_09:06:09.patch" size="38462" author="stevenz3wu" created="Mon, 20 Apr 2015 16:06:14 +0000"/>
                            <attachment id="12726601" name="KAFKA-2121_2015-04-20_09:51:51.patch" size="40644" author="stevenz3wu" created="Mon, 20 Apr 2015 16:51:56 +0000"/>
                            <attachment id="12726602" name="KAFKA-2121_2015-04-20_09:52:46.patch" size="40644" author="stevenz3wu" created="Mon, 20 Apr 2015 16:52:52 +0000"/>
                            <attachment id="12726604" name="KAFKA-2121_2015-04-20_09:57:49.patch" size="40296" author="stevenz3wu" created="Mon, 20 Apr 2015 16:57:55 +0000"/>
                            <attachment id="12726799" name="KAFKA-2121_2015-04-20_22:48:31.patch" size="47116" author="stevenz3wu" created="Tue, 21 Apr 2015 05:48:37 +0000"/>
                            <attachment id="12729884" name="KAFKA-2121_2015-05-01_15:42:30.patch" size="13219" author="stevenz3wu" created="Fri, 1 May 2015 22:42:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d8lj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>