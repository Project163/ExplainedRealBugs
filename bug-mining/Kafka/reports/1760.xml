<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:05:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6308] Connect: Struct equals/hashCode method should use Arrays#deep* methods</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6308</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;At the moment, &lt;tt&gt;org.apache.kafka.connect.data.Struct#equals&lt;/tt&gt; checks two things, after ensuring the incoming &lt;tt&gt;Object o&lt;/tt&gt; is indeed of the correct type:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Whether the schemas of &lt;tt&gt;this&lt;/tt&gt; and &lt;tt&gt;o&lt;/tt&gt; are equal, via &lt;tt&gt;Objects#equals&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Whether the values of &lt;tt&gt;this&lt;/tt&gt; and &lt;tt&gt;o&lt;/tt&gt; are qual, via &lt;tt&gt;Arrays#equals&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter check is problematic. &lt;tt&gt;Arrays#equals&lt;/tt&gt; is meant for one-dimensional arrays of any kind, and thus simply checks the &lt;tt&gt;equals&lt;/tt&gt; methods of all corresponding elements of its parameters &lt;tt&gt;a1&lt;/tt&gt; and &lt;tt&gt;a2&lt;/tt&gt;. However, elements of the &lt;tt&gt;Struct#values&lt;/tt&gt; array may themselves be arrays in a specific case, namely if a field has a &lt;tt&gt;BYTES&lt;/tt&gt; Schema Type and the user&apos;s input for this field is of type &lt;tt&gt;byte[]&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Given that, I would suggest to use &lt;tt&gt;Arrays#deepEquals&lt;/tt&gt; to compare the &lt;tt&gt;values&lt;/tt&gt; arrays of two &lt;tt&gt;Struct&lt;/tt&gt; instances. With similar reasoning, I would also suggest to use &lt;tt&gt;Arrays#deepHashCode&lt;/tt&gt; in the Struct&apos;s &lt;tt&gt;hashCode&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;This would allow to properly compare and hash structs that get byte arrays passed in as field values instead of the recommended ByteBuffers. An alternative might be to automatically wrap byte arrays passed into any &lt;tt&gt;put&lt;/tt&gt; method in a ByteBuffer.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13122624">KAFKA-6308</key>
            <summary>Connect: Struct equals/hashCode method should use Arrays#deep* methods</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tobiasgies">Tobias Gies</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>newbie</label>
                    </labels>
                <created>Mon, 4 Dec 2017 16:53:56 +0000</created>
                <updated>Thu, 14 Dec 2017 23:31:39 +0000</updated>
                            <resolved>Thu, 14 Dec 2017 23:31:08 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16278375" author="githubbot" created="Tue, 5 Dec 2017 10:43:05 +0000"  >&lt;p&gt;GitHub user tobiasgies opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4293&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6308&quot; title=&quot;Connect: Struct equals/hashCode method should use Arrays#deep* methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6308&quot;&gt;&lt;del&gt;KAFKA-6308&lt;/del&gt;&lt;/a&gt;: Connect Struct should use deepEquals/deepHashCode&lt;/p&gt;

&lt;p&gt;    This changes the Struct&apos;s equals and hashCode method to use&lt;br/&gt;
    Arrays#deepEquals and Arrays#deepHashCode, respectively. This resolves&lt;br/&gt;
    a problem where two structs with values of type byte[] would not be considered&lt;br/&gt;
    equal even though the byte arrays&apos; contents are equal. By using deepEquals,&lt;br/&gt;
    the byte arrays&apos; contents are compared instead of ther identity.&lt;/p&gt;

&lt;p&gt;    Since this changes the behavior of the equals method for byte array values,&lt;br/&gt;
    the behavior of hashCode must change alongside it to ensure the methods&lt;br/&gt;
    still fulfill the general contract of &quot;equal objects must have equal hashCodes&quot;.&lt;/p&gt;

&lt;p&gt;    Test rationale:&lt;br/&gt;
    All existing unit tests for equals were untouched and continue to work.&lt;br/&gt;
    A new test method was added to verify the behavior of equals and hashCode&lt;br/&gt;
    for Struct instances that contain a byte array value. I verify the reflixivity and&lt;br/&gt;
    transitivity of equals as well as the fact that equal Structs have equal hashCodes&lt;br/&gt;
    and not-equal structs do not have equal hashCodes. &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tobiasgies/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tobiasgies/kafka&lt;/a&gt; feature/kafka-6308-deepequals&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4293.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4293.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4293&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0e4764d98bdda4246299bfdcc722795ab7834d8e&lt;br/&gt;
Author: Tobias Gies &amp;lt;tobias.gies@trivago.com&amp;gt;&lt;br/&gt;
Date:   2017-12-04T17:19:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6308&quot; title=&quot;Connect: Struct equals/hashCode method should use Arrays#deep* methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6308&quot;&gt;&lt;del&gt;KAFKA-6308&lt;/del&gt;&lt;/a&gt; use deepEquals instead of equals for values array comparison&lt;/p&gt;

&lt;p&gt;commit 4d2ea566179ea1f584cbc5f6304b5c131c72d2a9&lt;br/&gt;
Author: Tobias Gies &amp;lt;tobias.gies@trivago.com&amp;gt;&lt;br/&gt;
Date:   2017-12-04T17:45:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6308&quot; title=&quot;Connect: Struct equals/hashCode method should use Arrays#deep* methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6308&quot;&gt;&lt;del&gt;KAFKA-6308&lt;/del&gt;&lt;/a&gt; use deepHashCode instead of hashCode to ensure contract stability between equals and hashCode&lt;/p&gt;

&lt;p&gt;commit 55a3164c27dc2098ab270419032254106c13c533&lt;br/&gt;
Author: Tobias Gies &amp;lt;tobias@tobiasgies.de&amp;gt;&lt;br/&gt;
Date:   2017-12-04T22:02:07Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;trunk&apos; into feature/kafka-6308-deepequals&lt;/p&gt;

&lt;p&gt;commit 3876c1dd2dcde35fd544bb43c2ea124d84860f2a&lt;br/&gt;
Author: Tobias Gies &amp;lt;tobias.gies@trivago.com&amp;gt;&lt;br/&gt;
Date:   2017-12-05T10:26:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6308&quot; title=&quot;Connect: Struct equals/hashCode method should use Arrays#deep* methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6308&quot;&gt;&lt;del&gt;KAFKA-6308&lt;/del&gt;&lt;/a&gt; restructure test assertions based on method contracts&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16291791" author="hachikuji" created="Thu, 14 Dec 2017 23:31:08 +0000"  >&lt;p&gt;Issue resolved by pull request 4293&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4293&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16291794" author="githubbot" created="Thu, 14 Dec 2017 23:31:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4293&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nia7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>