<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:38:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-15417] JoinWindow does not  seem to work properly with a KStream - KStream - LeftJoin()</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-15417</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In Kafka-streams 3.4.0 :&lt;/p&gt;

&lt;p&gt;According to the javadoc of the Joinwindow:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;There are three different window configuration supported:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;em&gt;before = after = time-difference&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;before = 0 and after = time-difference&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;&lt;b&gt;before = time-difference and after = 0&lt;/b&gt;&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;However if&#160;I use a joinWindow with &lt;b&gt;before = time-difference and after = 0&lt;/b&gt; &lt;br/&gt;
on a kstream-kstream-leftjoin the &lt;b&gt;after=0&lt;/b&gt; part does not seem to work.&lt;/p&gt;

&lt;p&gt;When using &lt;em&gt;stream1.leftjoin(stream2, joinWindow)&lt;/em&gt; with &lt;em&gt;joinWindow&lt;/em&gt;.&lt;em&gt;after=0 and joinWindow.before=30s&lt;/em&gt;, any new message on stream 1 that can not be joined with any messages on stream2 should be joined with a null-record after the &lt;em&gt;joinWindow.after&lt;/em&gt; has ended and a new message has arrived on stream1.&lt;/p&gt;

&lt;p&gt;It does not.&lt;/p&gt;

&lt;p&gt;Only if the new message arrives after the value of &lt;em&gt;joinWindow.before&lt;/em&gt; the previous message will be joined with a null-record.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Attached you can find two files with a TopologyTestDriver Unit test to reproduce.&lt;/p&gt;

&lt;p&gt;topology:&#160; &#160;stream1.leftjoin( stream2, joiner, joinwindow)&lt;/p&gt;

&lt;p&gt;joinWindow has before=5000ms and after=0&lt;/p&gt;

&lt;p&gt;message1(key1) -&amp;gt;&#160; stream1&lt;/p&gt;

&lt;p&gt;after 4000ms message2(key2) -&amp;gt; stream1&#160; -&amp;gt;&#160; NO null-record join was made, but the after period was expired.&lt;br/&gt;
after 4900ms message2(key2) -&amp;gt; stream1&#160; -&amp;gt;&#160; NO null-record join was made, but the after period was expired.&lt;br/&gt;
after 5000ms message2(key2) -&amp;gt; stream1&#160; -&amp;gt;&#160; A null-record join was made,&#160; before period was expired.&lt;br/&gt;
after 6000ms message2(key2) -&amp;gt; stream1&#160; -&amp;gt;&#160; A null-record join was made,&#160; before period was expired.&lt;/p&gt;



&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13549023">KAFKA-15417</key>
            <summary>JoinWindow does not  seem to work properly with a KStream - KStream - LeftJoin()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="VictorvandenHoven">Victor van den Hoven</assignee>
                                    <reporter username="VictorvandenHoven">Victor van den Hoven</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Aug 2023 16:52:57 +0000</created>
                <updated>Tue, 2 Apr 2024 13:47:15 +0000</updated>
                            <resolved>Wed, 6 Mar 2024 01:07:52 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17761918" author="mjsax" created="Tue, 5 Sep 2023 01:55:01 +0000"  >&lt;p&gt;I believe it could be related to an internal &quot;throttling&quot; mechanism that was added to improve throughput.&lt;/p&gt;

&lt;p&gt;Can you try to set config&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;#95;&amp;#95;emit.interval.ms.kstreams.outer.join.spurious.results.fix&amp;#95;&amp;#95;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;to zero to see if it resolve the issue?&lt;/p&gt;</comment>
                            <comment id="17761996" author="victorvandenhoven" created="Tue, 5 Sep 2023 08:57:39 +0000"  >&lt;p&gt;Thank you for your comment.&lt;/p&gt;

&lt;p&gt;There is unfortunately no improvement.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I tested it with the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
 &lt;em&gt;&lt;font color=&quot;#6a3e3e&quot;&gt;props&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.put(StreamsConfig.InternalConfig.&lt;/font&gt;&lt;font color=&quot;#0000c0&quot;&gt;EMIT_INTERVAL_MS_KSTREAMS_OUTER_JOIN_SPURIOUS_RESULTS_FIX&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;, 0);&lt;/font&gt;&lt;/em&gt;&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;At startup I get the following warning:&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;em&gt;WARN 25120 &amp;#8212; [ &#160; &#160; &#160; &#160; &#160; main] o.a.k.clients.consumer.ConsumerConfig &#160; &#160;: These configurations &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;specific.avro.reader, schema.registry.url, __emit.interval.ms.kstreams.outer.join.spurious.results.fix__&amp;#93;&lt;/span&gt;&apos; were supplied but are not used yet.&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I use the following joinwindow:&lt;/p&gt;

&lt;p&gt;&#160; &#160;### JoinWindow size: 20000ms&lt;br/&gt;
&#160; &#160;### JoinWindow before: 20000ms&lt;br/&gt;
&#160; &#160;### JoinWindow after: 0ms&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Started with empty topics:&lt;/p&gt;

&lt;p&gt;Test1:&#160;&#160;&lt;/p&gt;

&lt;p&gt;streamA.leftjoin( streamB);&lt;/p&gt;

&lt;p&gt;put message on streamA&#160; (key1, a1)&lt;br/&gt;
wait 5000ms&lt;br/&gt;
put message on streamA (key1, a2)&lt;/p&gt;

&lt;p&gt;expected join-record (key1, null) but there is not.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Started with empty topics:&lt;/p&gt;

&lt;p&gt;Test2:&#160;&#160;&lt;/p&gt;

&lt;p&gt;streamA.leftjoin( streamB);&lt;/p&gt;

&lt;p&gt;put message on streamA&#160; (key1, a1)&lt;br/&gt;
wait 25000ms&lt;br/&gt;
put message on streamA (key1, a2)&lt;/p&gt;

&lt;p&gt;there is a join-record (key1, null) .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17762535" author="mjsax" created="Thu, 7 Sep 2023 01:38:39 +0000"  >&lt;p&gt;Thanks. I did look into this and found this PR: &lt;a href=&quot;https://github.com/apache/kafka/commit/03411ca28b21d554d754b3f67a7857afe64f5bef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/03411ca28b21d554d754b3f67a7857afe64f5bef&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It introduces `joinSpuriousLookBackTimeMs` but it seems it sets it to before/after for the left/right join node incorrectly &#8211; I think it must be flipped... The added unit tests seems to make incorrect assumptions when a window should get closed, but it was not caught during review (it&apos;s easy to flip before/after in your mind...)&lt;/p&gt;

&lt;p&gt;Hence, the fix itself is simple, but updating the unit test is a little bit more work. Would you be interested to work on a PR to fix it?&lt;/p&gt;</comment>
                            <comment id="17762676" author="victorvandenhoven" created="Thu, 7 Sep 2023 09:42:43 +0000"  >&lt;p&gt;Yes, I think it was incorrect and flipped.&lt;/p&gt;

&lt;p&gt;Sure, I can give it a try to work on a PR.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17762863" author="mjsax" created="Thu, 7 Sep 2023 20:07:56 +0000"  >&lt;p&gt;Thanks a lot! Assigned the ticket to you.&lt;/p&gt;</comment>
                            <comment id="17767979" author="victorvandenhoven" created="Fri, 22 Sep 2023 12:15:40 +0000"  >&lt;p&gt;There is a PR submitted for this: &#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/14426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/14426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Not only the joinSpuriousLookBackTimeMs was flipped. &lt;br/&gt;
Also I think that the emit-logic should come after the join-logic. &lt;br/&gt;
Because only then you can determine whether you need to emit non-joined items or not.&lt;br/&gt;
Otherwise you will always emit non-joined items, even if there is found a joined item.&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17768550" author="victorvandenhoven" created="Mon, 25 Sep 2023 06:52:06 +0000"  >&lt;p&gt;What to do with &quot;Flaky tests&quot;?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I do not think my PR has anything to do with it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Just commit and try again and pray?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063142/13063142_Afbeelding+1.png&quot; height=&quot;156&quot; width=&quot;133&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063144/13063144_Afbeelding+1-1.png&quot; height=&quot;99&quot; width=&quot;483&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13063144" name="Afbeelding 1-1.png" size="65167" author="VictorvandenHoven" created="Mon, 25 Sep 2023 14:21:51 +0000"/>
                            <attachment id="13063142" name="Afbeelding 1.png" size="21163" author="VictorvandenHoven" created="Mon, 25 Sep 2023 13:21:28 +0000"/>
                            <attachment id="13062566" name="SimpleStreamTopology.java" size="1588" author="VictorvandenHoven" created="Tue, 29 Aug 2023 16:41:25 +0000"/>
                            <attachment id="13062565" name="SimpleStreamTopologyTest.java" size="2994" author="VictorvandenHoven" created="Tue, 29 Aug 2023 16:41:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k2q8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>