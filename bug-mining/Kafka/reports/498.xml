<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:41:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1451] Broker stuck due to leader election race </title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1451</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Symptoms&quot;&gt;&lt;/a&gt;Symptoms&lt;/h3&gt;

&lt;p&gt;The broker does not become available due to being stuck in an infinite loop while electing leader. This can be recognised by the following line being repeatedly written to server.log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2014-05-14 04:35:09,187] INFO I wrote &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; conflicted ephemeral node [{&lt;span class=&quot;code-quote&quot;&gt;&quot;version&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;brokerid&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1400060079108&quot;&lt;/span&gt;}] at /controller a &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; back in a different session, hence I will backoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;StepstoReproduce&quot;&gt;&lt;/a&gt;Steps to Reproduce&lt;/h3&gt;

&lt;p&gt;In a single kafka 0.8.1.1 node, single zookeeper 3.4.6 (but will likely behave the same with the ZK version included in Kafka distribution) node setup:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;start both zookeeper and kafka (in any order)&lt;/li&gt;
	&lt;li&gt;stop zookeeper&lt;/li&gt;
	&lt;li&gt;stop kafka&lt;/li&gt;
	&lt;li&gt;start kafka&lt;/li&gt;
	&lt;li&gt;start zookeeper&lt;/li&gt;
&lt;/ol&gt;


&lt;h3&gt;&lt;a name=&quot;LikelyCause&quot;&gt;&lt;/a&gt;Likely Cause&lt;/h3&gt;

&lt;p&gt;&lt;tt&gt;ZookeeperLeaderElector&lt;/tt&gt; subscribes to data changes on startup, and then triggers an election. if the deletion of ephemeral &lt;tt&gt;/controller&lt;/tt&gt; node associated with previous zookeeper session of the broker happens after subscription to changes in new session, election will be invoked twice, once from &lt;tt&gt;startup&lt;/tt&gt; and once from &lt;tt&gt;handleDataDeleted&lt;/tt&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;startup&lt;/tt&gt;: acquire &lt;tt&gt;controllerLock&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;startup&lt;/tt&gt;: subscribe to data changes&lt;/li&gt;
	&lt;li&gt;zookeeper: delete &lt;tt&gt;/controller&lt;/tt&gt; since the session that created it timed out&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;handleDataDeleted&lt;/tt&gt;: &lt;tt&gt;/controller&lt;/tt&gt; was deleted&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;handleDataDeleted&lt;/tt&gt;: wait on &lt;tt&gt;controllerLock&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;startup&lt;/tt&gt;: elect &amp;#8211; writes &lt;tt&gt;/controller&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;startup&lt;/tt&gt;: release &lt;tt&gt;controllerLock&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;handleDataDeleted&lt;/tt&gt;: acquire &lt;tt&gt;controllerLock&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;handleDataDeleted&lt;/tt&gt;: elect &amp;#8211; attempts to write &lt;tt&gt;/controller&lt;/tt&gt; and then gets into infinite loop as a result of conflict&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;tt&gt;createEphemeralPathExpectConflictHandleZKBug&lt;/tt&gt; assumes that the existing znode was written from different session, which is not true in this case; it was written from the same session. That adds to the confusion.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;SuggestedFix&quot;&gt;&lt;/a&gt;Suggested Fix&lt;/h3&gt;

&lt;p&gt;In &lt;tt&gt;ZookeeperLeaderElector.startup&lt;/tt&gt; first run &lt;tt&gt;elect&lt;/tt&gt; and then subscribe to data changes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12714147">KAFKA-1451</key>
            <summary>Broker stuck due to leader election race </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omkreddy">Manikumar</assignee>
                                    <reporter username="mmakowski">Maciek Makowski</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Wed, 14 May 2014 10:52:39 +0000</created>
                <updated>Thu, 19 Nov 2015 17:43:57 +0000</updated>
                            <resolved>Wed, 30 Jul 2014 15:15:11 +0000</resolved>
                                    <version>0.8.1.1</version>
                                    <fixVersion>0.8.2.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="14064976" author="kenmacd" created="Thu, 17 Jul 2014 14:47:08 +0000"  >&lt;p&gt;This can also be caused by restarting Kafka quickly after a sigkill. I had a supervisord config file with &apos;stopwaitsecs=1&apos; and it would pretty reliably create a hung Kafka process.&lt;/p&gt;</comment>
                            <comment id="14065055" author="junrao" created="Thu, 17 Jul 2014 16:04:56 +0000"  >&lt;p&gt;Thanks for reporting this. Very interesting. That does sound like a potential problem. The problem is that ZookeeperLeaderElector.elect assumes that no controller exists. However, this may not be true. One possible solution is to first check the existence of the controller from ZK before creating the ephemeral node. &lt;/p&gt;</comment>
                            <comment id="14066456" author="nehanarkhede" created="Fri, 18 Jul 2014 15:46:28 +0000"  >&lt;p&gt;Just checking the existence is not enough since there is a risk of not electing a controller at all if all brokers do the same and the node disappears. Following will work&lt;br/&gt;
1. Register watch&lt;br/&gt;
2. Check existence and elect if one does not exist&lt;/p&gt;

&lt;p&gt;#1 ensures that if the node disappears, an election will take place&lt;/p&gt;</comment>
                            <comment id="14068193" author="junrao" created="Mon, 21 Jul 2014 04:40:14 +0000"  >&lt;p&gt;Neha, I am not sure if #1 is need. We can get into elect from two paths (1) from startup or (2) from handleDeleted. If it&apos;s from startup, we already register the watcher before calling elect. If it&apos;s from handleDeleted, it means that the watcher must have already been registered. So, once in elect, we know the watcher is already registered. So if after we check the existence of the controller node and the controller node goes away immediately afterward, the watcher is guaranteed to be triggered.&lt;/p&gt;</comment>
                            <comment id="14075317" author="omkreddy" created="Sat, 26 Jul 2014 09:48:59 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23962/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23962/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14075321" author="omkreddy" created="Sat, 26 Jul 2014 10:02:39 +0000"  >&lt;p&gt;Uploaded a patch which checks controller existence in leader election process.&lt;br/&gt;
With this patch i am not able to reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="14076270" author="omkreddy" created="Mon, 28 Jul 2014 14:51:31 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23962/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23962/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14076274" author="omkreddy" created="Mon, 28 Jul 2014 14:57:13 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23983/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23983/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14076277" author="omkreddy" created="Mon, 28 Jul 2014 15:00:59 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23962/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23962/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14077385" author="omkreddy" created="Tue, 29 Jul 2014 04:46:28 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23962/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23962/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14079360" author="junrao" created="Wed, 30 Jul 2014 15:15:11 +0000"  >&lt;p&gt;Thanks for the latest patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14092051" author="joestein" created="Sun, 10 Aug 2014 08:09:09 +0000"  >&lt;p&gt;Hi, two issues so far where found with leader election &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1387?focusedCommentId=14087063&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14087063&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-1387?focusedCommentId=14087063&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14087063&lt;/a&gt; I don&apos;t know if the issues are related to each other or even to this just yet... the issues found were not happening on the 0.8.1 branch.... could be another 0.8.2 patch I supose but before I started trying to test on a 0.8.2 version without this patch (to isolate the root cause) I wanted to see if this type of scenario was tested or what thoughts were in general to this patch and how it might be affecting either of the two issues found in 0.8.2 trunk?  &lt;/p&gt;</comment>
                            <comment id="14092253" author="junrao" created="Sun, 10 Aug 2014 22:46:25 +0000"  >&lt;p&gt;Joe,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1387&quot; title=&quot;Kafka getting stuck creating ephemeral node it has already created when two zookeeper sessions are established in a very short period of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1387&quot;&gt;&lt;del&gt;KAFKA-1387&lt;/del&gt;&lt;/a&gt; seems to be related to broker registration and this jira only fixes how the controller is registered in ZK. So, I am not sure if they are related.&lt;/p&gt;</comment>
                            <comment id="14306753" author="sinewy" created="Thu, 5 Feb 2015 06:49:07 +0000"  >&lt;p&gt;I think the patch dose not RESOLVE the problem,it will be happen again when zk event notification request arrive long after the /controller   has  deleted.&lt;br/&gt;
kafkaController.onControllerResignation method has executed,but elect action is return when it find that &quot;/controller&quot; znode has already been created&lt;/p&gt;</comment>
                            <comment id="14346728" author="aseychell" created="Wed, 4 Mar 2015 10:47:26 +0000"  >&lt;p&gt;I just encountered this issue on version 0.8.2.0 after a period of slow PC performance and perhaps zookeeper and kafka were slow to communicate between each other (possibly the same issue highlighted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sinewy&quot; class=&quot;user-hover&quot; rel=&quot;sinewy&quot;&gt;sinewy&lt;/a&gt;.  This resulted in an infinite loop in attempting to created the ephemeral node.  The logs that were continously being written are as follows:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-03-03 13:48:19,831&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/0 data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1425386833617&quot;,&quot;host&quot;:&quot;MTDKP119.ix.com&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1425380575230&quot;,&quot;host&quot;:&quot;MTDKP119.ix.com&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-03-03 13:48:19,832&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1425386833617&quot;,&quot;host&quot;:&quot;MTDKP119.ix.com&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt;] at /brokers/ids/0 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-03-03 13:48:25,844&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/0 data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1425386833617&quot;,&quot;host&quot;:&quot;MTDKP119.ix.com&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1425380575230&quot;,&quot;host&quot;:&quot;MTDKP119.ix.com&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;/p&gt;</comment>
                            <comment id="14516532" author="marcusai" created="Tue, 28 Apr 2015 06:48:58 +0000"  >&lt;p&gt;I have also hit this issue on version 0.8.2.0. It occurred directly after Zookeeper got restarted:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-04-27 03:47:03,291&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1430038275477&quot;,&quot;host&quot;:&quot;ams5mdppdmsbacmq01b.markit.partners&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1430036480690&quot;,&quot;host&quot;:&quot;ams5mdppdmsbacmq01b.markit.partners&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-04-27 03:47:03,292&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:-1,&quot;timestamp&quot;:&quot;1430038275477&quot;,&quot;host&quot;:&quot;ams5mdppdmsbacmq01b.markit.partners&quot;,&quot;version&quot;:1,&quot;port&quot;:9092}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;/p&gt;</comment>
                            <comment id="14593515" author="rusty@2211" created="Fri, 19 Jun 2015 15:26:08 +0000"  >&lt;p&gt;Hit this issue on version 0.8.2.1 when twiiterstream generate the large data i have one topic with two broker and two partition&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:10,141&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:16,246&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726044184&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:16,796&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:22,965&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726044184&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:22,967&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:29,159&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726044184&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:29,161&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:35,219&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726044184&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:35,221&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:41,338&amp;#93;&lt;/span&gt; INFO conflict in /brokers/ids/2 data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; stored data: &lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726044184&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt; (kafka.utils.ZkUtils$)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-06-19 20:35:42,208&amp;#93;&lt;/span&gt; INFO I wrote this conflicted ephemeral node [&lt;/p&gt;
{&quot;jmx_port&quot;:10000,&quot;timestamp&quot;:&quot;1434726183806&quot;,&quot;host&quot;:&quot;localhost.localdomain&quot;,&quot;version&quot;:1,&quot;port&quot;:9093}
&lt;p&gt;] at /brokers/ids/2 a while back in a different session, hence I will backoff for this node to be deleted by Zookeeper and retry (kafka.utils.ZkUtils$)&lt;/p&gt;</comment>
                            <comment id="14713405" author="longtimer" created="Wed, 26 Aug 2015 13:27:10 +0000"  >&lt;p&gt;I too am seeing this issue in 0.8.2.1.&lt;/p&gt;</comment>
                            <comment id="14791763" author="dude9527" created="Thu, 17 Sep 2015 08:15:44 +0000"  >&lt;p&gt;Also occurred in 3 node kafka 0.8.2.1 cluster&lt;/p&gt;</comment>
                            <comment id="14944726" author="laxpio" created="Tue, 6 Oct 2015 08:50:37 +0000"  >&lt;p&gt;also hit in 0.8.2.1,and the /controller node in zk is lost.&lt;/p&gt;</comment>
                            <comment id="14945382" author="becket_qin" created="Tue, 6 Oct 2015 17:15:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=laxpio&quot; class=&quot;user-hover&quot; rel=&quot;laxpio&quot;&gt;laxpio&lt;/a&gt; May be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2437&quot; title=&quot;Controller does not handle zk node deletion correctly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2437&quot;&gt;&lt;del&gt;KAFKA-2437&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14945391" author="fpj" created="Tue, 6 Oct 2015 17:18:52 +0000"  >&lt;p&gt;Maybe related to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1387&quot; title=&quot;Kafka getting stuck creating ephemeral node it has already created when two zookeeper sessions are established in a very short period of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1387&quot;&gt;&lt;del&gt;KAFKA-1387&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15013883" author="zcox" created="Thu, 19 Nov 2015 17:01:41 +0000"  >&lt;p&gt;We experienced this yesterday on a 3-node 0.8.2.1 cluster, which caused a major outage for several hours. Restarting Kafka brokers several times, along with restarting Zookeeper nodes, did not resolve the issue. We identified one of the brokers that seemed to be going in/out of ISRs repeatedly, and ended up deleting all of its state on disk &amp;amp; restarting it. This was the only thing that finally resolved the issue. Maybe there was some corrupt state on that broker&apos;s disk? We still have that broker&apos;s state (moved its data dir, didn&apos;t actually delete) if that is helpful at all.&lt;/p&gt;</comment>
                            <comment id="15013983" author="fpj" created="Thu, 19 Nov 2015 17:33:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zcox&quot; class=&quot;user-hover&quot; rel=&quot;zcox&quot;&gt;zcox&lt;/a&gt; if you observed messages like the ones in this comment above&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1451?focusedCommentId=14593515&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14593515&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-1451?focusedCommentId=14593515&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14593515&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;then I suspect this will be resolved with the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1387&quot; title=&quot;Kafka getting stuck creating ephemeral node it has already created when two zookeeper sessions are established in a very short period of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1387&quot;&gt;&lt;del&gt;KAFKA-1387&lt;/del&gt;&lt;/a&gt;, which will be available in 0.9.&lt;/p&gt;</comment>
                            <comment id="15014006" author="zcox" created="Thu, 19 Nov 2015 17:43:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; Yes we saw the &quot;I wrote this conflicted ephemeral node&quot; error messages, we saw lots of partitions in/out of ISRs and a lot of this too:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-11-19 01:05:51,685] INFO Opening socket connection to server ip-10-10-1-35.ec2.internal/10.10.1.35:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,685] INFO Socket connection established to ip-10-10-1-35.ec2.internal/10.10.1.35:2181, initiating session (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,687] INFO Unable to reconnect to ZooKeeper service, session 0x54a0e5799a8195d has expired, closing socket connection (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,687] INFO zookeeper state changed (Expired) (org.I0Itec.zkclient.ZkClient)
[2015-11-19 01:05:51,687] INFO Initiating client connection, connectString=zookeeper1.production.redacted.com:2181,zookeeper2.production.redacted.com:2181,zookeeper3.production.redacted.com:2181/kafka sessionTimeout=6000 watcher=org.I0Itec.zkclient.ZkClient@ace1333 (org.apache.zookeeper.ZooKeeper)
[2015-11-19 01:05:51,701] INFO EventThread shut down (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,701] ERROR Error handling event ZkEvent[New session event sent to kafka.controller.KafkaController$SessionExpirationListener@2261adb8] (org.I0Itec.zkclient.ZkEventThread)
java.lang.IllegalStateException: Kafka scheduler has not been started
  at kafka.utils.KafkaScheduler.ensureStarted(KafkaScheduler.scala:114)
  at kafka.utils.KafkaScheduler.shutdown(KafkaScheduler.scala:86)
  at kafka.controller.KafkaController.onControllerResignation(KafkaController.scala:350)
  at kafka.controller.KafkaController$SessionExpirationListener$$anonfun$handleNewSession$1.apply$mcZ$sp(KafkaController.scala:1108)
  at kafka.controller.KafkaController$SessionExpirationListener$$anonfun$handleNewSession$1.apply(KafkaController.scala:1107)
  at kafka.controller.KafkaController$SessionExpirationListener$$anonfun$handleNewSession$1.apply(KafkaController.scala:1107)
  at kafka.utils.Utils$.inLock(Utils.scala:535)
  at kafka.controller.KafkaController$SessionExpirationListener.handleNewSession(KafkaController.scala:1107)
  at org.I0Itec.zkclient.ZkClient$4.run(ZkClient.java:472)
  at org.I0Itec.zkclient.ZkEventThread.run(ZkEventThread.java:71)
[2015-11-19 01:05:51,701] INFO re-registering broker info in ZK &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; broker 3 (kafka.server.KafkaHealthcheck)
[2015-11-19 01:05:51,701] INFO Opening socket connection to server ip-10-10-1-104.ec2.internal/10.10.1.104:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,702] INFO Socket connection established to ip-10-10-1-104.ec2.internal/10.10.1.104:2181, initiating session (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,713] INFO Session establishment complete on server ip-10-10-1-104.ec2.internal/10.10.1.104:2181, sessionid = 0x64a0e57972a1a85, negotiated timeout = 6000 (org.apache.zookeeper.ClientCnxn)
[2015-11-19 01:05:51,713] INFO zookeeper state changed (SyncConnected) (org.I0Itec.zkclient.ZkClient)
[2015-11-19 01:05:51,718] INFO Registered broker 3 at path /brokers/ids/3 with address mesos-slave3.production.redacted.com:9092. (kafka.utils.ZkUtils$)
[2015-11-19 01:05:51,718] INFO done re-registering broker (kafka.server.KafkaHealthcheck)
[2015-11-19 01:05:51,718] INFO Subscribing to /brokers/topics path to watch &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; topics (kafka.server.KafkaHealthcheck)
[2015-11-19 01:05:51,721] INFO New leader is 1 (kafka.server.ZookeeperLeaderElector$LeaderChangeListener)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12707778">KAFKA-1387</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12733091">KAFKA-1585</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12657983" name="KAFKA-1451.patch" size="2274" author="omkreddy" created="Sat, 26 Jul 2014 09:48:54 +0000"/>
                            <attachment id="12658141" name="KAFKA-1451_2014-07-28_20:27:32.patch" size="2529" author="omkreddy" created="Mon, 28 Jul 2014 15:00:37 +0000"/>
                            <attachment id="12658354" name="KAFKA-1451_2014-07-29_10:13:23.patch" size="2518" author="omkreddy" created="Tue, 29 Jul 2014 04:46:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vl5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392645</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>