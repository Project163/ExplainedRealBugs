<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-640] System Test Failures : kafka.common.InvalidClientIdException in broker log4j messages</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-640</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;ul&gt;
	&lt;li&gt;To reproduce the issue, download and build the latest Kafka 0.8 branch and execute this command: &quot;&amp;lt;kafka_home&amp;gt;/system_test $ python -B system_test_runner.py&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The following exception is found in the broker log4j messages in most System Test cases:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-11-29 09:06:21,322&amp;#93;&lt;/span&gt; WARN No previously checkpointed highwatermark value found for topic test_1 partition 1. Returning 0 as the highwatermark (kafka.server.HighwaterMarkCheckpoint)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-11-29 09:06:21,326&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Log on Broker 1&amp;#93;&lt;/span&gt;, Truncated log segment /tmp/kafka_server_1_logs/test_1-1/00000000000000000000.log to target offset 0 (kafka.log.Log)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-11-29 09:06:21,333&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 1: Error processing leaderAndISR request LeaderAndIsrRequest(1,,1000,Map((test_1,1) -&amp;gt; PartitionStateInfo(LeaderIsrAndControllerEpoch(&lt;/p&gt;
{ &quot;ISR&quot;:&quot;2,3,1&quot;,&quot;leader&quot;:&quot;2&quot;,&quot;leaderEpoch&quot;:&quot;0&quot; }
&lt;p&gt;,1),3), (test_1,0) -&amp;gt; PartitionStateInfo(LeaderIsrAndControllerEpoch(&lt;/p&gt;
{ &quot;ISR&quot;:&quot;1,2,3&quot;,&quot;leader&quot;:&quot;1&quot;,&quot;leaderEpoch&quot;:&quot;0&quot; }
&lt;p&gt;,1),3)),Set(id:2,creatorId:127.0.0.1-1354208764997,host:127.0.0.1,port:9092, id:1,creatorId:127.0.0.1-1354208760105,host:127.0.0.1,port:9091),1) (kafka.server.ReplicaManager)&lt;br/&gt;
kafka.common.InvalidClientIdException: ClientId replica-fetcher-host_127.0.0.1-port_9092 is illegal, contains a character other than ASCII alphanumerics, _ and -&lt;br/&gt;
        at kafka.utils.ClientId$.validate(ClientIdAndTopic.scala:36)&lt;br/&gt;
        at kafka.consumer.SimpleConsumer.&amp;lt;init&amp;gt;(SimpleConsumer.scala:81)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.&amp;lt;init&amp;gt;(AbstractFetcherThread.scala:44)&lt;br/&gt;
        at kafka.server.ReplicaFetcherThread.&amp;lt;init&amp;gt;(ReplicaFetcherThread.scala:26)&lt;br/&gt;
        at kafka.server.ReplicaFetcherManager.createFetcherThread(ReplicaFetcherManager.scala:26)&lt;br/&gt;
        at kafka.server.AbstractFetcherManager.addFetcher(AbstractFetcherManager.scala:44)&lt;br/&gt;
        at kafka.cluster.Partition.makeFollower(Partition.scala:190)&lt;br/&gt;
        at kafka.server.ReplicaManager.kafka$server$ReplicaManager$$makeFollower(ReplicaManager.scala:236)&lt;br/&gt;
        at kafka.server.ReplicaManager$$anonfun$becomeLeaderOrFollower$3.apply(ReplicaManager.scala:201)&lt;br/&gt;
        at kafka.server.ReplicaManager$$anonfun$becomeLeaderOrFollower$3.apply(ReplicaManager.scala:191)&lt;br/&gt;
        at scala.collection.immutable.Map$Map2.foreach(Map.scala:127)&lt;br/&gt;
        at kafka.server.ReplicaManager.becomeLeaderOrFollower(ReplicaManager.scala:191)&lt;br/&gt;
        at kafka.server.KafkaApis.handleLeaderAndIsrRequest(KafkaApis.scala:129)&lt;br/&gt;
        at kafka.server.KafkaApis.handle(KafkaApis.scala:60)&lt;br/&gt;
        at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:41)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618184">KAFKA-640</key>
            <summary>System Test Failures : kafka.common.InvalidClientIdException in broker log4j messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="jfung">John Fung</reporter>
                        <labels>
                            <label>replication-testing</label>
                    </labels>
                <created>Thu, 29 Nov 2012 17:22:47 +0000</created>
                <updated>Fri, 30 Nov 2012 17:50:13 +0000</updated>
                            <resolved>Fri, 30 Nov 2012 17:50:06 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13506861" author="swapnilghike" created="Thu, 29 Nov 2012 22:06:48 +0000"  >&lt;p&gt;This happened because ClientId.validate(clientId) in SimpleConsumer did not validate &quot;.&quot; in the clientId passed from ReplicaFetcherThread. &lt;/p&gt;

&lt;p&gt;This patch fixes another bug - AbstractFetcherThread would create SimpleConsumer and pass &quot;%s-host_%s-port_%s&quot; as the clientId to the SimpleConsumer. SimpleConsumer would append the host-port string again to the clientId while instantiating FetchRequestAndResponseStats. &lt;/p&gt;

&lt;p&gt;Changes: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The fix is to not include the host-port string while initializing AbstractFetcherThread.clientId in ReplicaFetcherThread, the host and port are already passed through the sourceBroker argument. This new clientId is passed to SimpleConsumer in AbstractFetcherThread and it should validate successfully.&lt;/li&gt;
	&lt;li&gt;Pass clientId + host-port string while instantiating *Stats in AbstractFetcherThread and SimpleConsumer. Since the host-port string gives information about the client, I think it should be ok to append it to clientId and not create a separate case class like ClientIdAndTopic.&lt;/li&gt;
	&lt;li&gt;Pass clientId + host-port string while instantiating FetchRequestBuilder in AbstractFetcherThread.&lt;/li&gt;
	&lt;li&gt;Pass clientId + host-port string to the constructors of ProducerRequestStats, FetchRequestAndResponseStats, FetcherStats and FetcherLagStats to maintain uniformity with passing clientId + host-port to FetchRequestBuilder in AbstractFetcherThread.doWork().&lt;/li&gt;
	&lt;li&gt;Removed a line in ClientIdTest.scala, it was redundant.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The validation criteria for clientId string that comes from the client is unchanged. Ideally I would like to validate the clientId that &lt;b&gt;includes&lt;/b&gt; the host-port string, but that would require an introduction of &apos;.&apos; in the legal characters set which would be inconsistent with legal chars for Topic. Instead, we can maintain the same legal chars set and take care that the host-port string doesn&apos;t change format within the code.&lt;/p&gt;</comment>
                            <comment id="13506985" author="jfung" created="Fri, 30 Nov 2012 00:36:47 +0000"  >&lt;p&gt;Thanks Swapnil for the patch. It is working with the latest 0.8 branch.&lt;/p&gt;</comment>
                            <comment id="13507483" author="nehanarkhede" created="Fri, 30 Nov 2012 17:39:14 +0000"  >&lt;p&gt;+1, LGTM&lt;/p&gt;</comment>
                            <comment id="13507495" author="nehanarkhede" created="Fri, 30 Nov 2012 17:50:06 +0000"  >&lt;p&gt;Thanks for the patch, just committed it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555413" name="kafka-640.patch" size="5692" author="swapnilghike" created="Thu, 29 Nov 2012 22:06:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sefj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163814</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>