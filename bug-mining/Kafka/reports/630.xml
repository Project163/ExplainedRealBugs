<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:42:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1988] org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1988</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers. The method only returns intended value for positive numbers. All negative numbers except the Integer.Min_Value will be returned an unsigned integer.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12778076">KAFKA-1988</key>
            <summary>org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tongli">Tong Li</assignee>
                                    <reporter username="tongli">Tong Li</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Feb 2015 00:18:30 +0000</created>
                <updated>Fri, 13 Mar 2015 00:19:40 +0000</updated>
                            <resolved>Wed, 4 Mar 2015 02:36:37 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14339478" author="tongli" created="Fri, 27 Feb 2015 00:45:44 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31517/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31517/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14339500" author="junrao" created="Fri, 27 Feb 2015 01:02:04 +0000"  >&lt;p&gt;Thanks for the patch. +1.&lt;/p&gt;

&lt;p&gt;We actually made the same mistake in the scala code before: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1469&quot; title=&quot;Util.abs function does not return correct absolute values for negative values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1469&quot;&gt;&lt;del&gt;KAFKA-1469&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14339502" author="junrao" created="Fri, 27 Feb 2015 01:03:34 +0000"  >&lt;p&gt;Since this affects how partitioning works in the new producer, we will have to fix this in 0.8.2.1. Marking this an an 0.8.2.1 blocker.&lt;/p&gt;</comment>
                            <comment id="14339751" author="junrao" created="Fri, 27 Feb 2015 05:42:26 +0000"  >&lt;p&gt;Actually, we can probably keep the same logic in determining the partition from key in Partitioner. We  can move the current code in abs() into Partitioner, and give it a new name like toPositive(). Then we can replace Utils.abs() with toPositive() it in the following code in Partitioner.&lt;/p&gt;

&lt;p&gt;            // hash the key to choose a partition&lt;br/&gt;
            return Utils.abs(Utils.murmur2(key)) % numPartitions;&lt;/p&gt;

&lt;p&gt;This way, we will preserve the key distribution of existing users of the new producer.&lt;/p&gt;

&lt;p&gt;Tong,&lt;/p&gt;

&lt;p&gt;Do you want to submit a new patch based on that?&lt;/p&gt;
</comment>
                            <comment id="14339921" author="tongli" created="Fri, 27 Feb 2015 09:18:15 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31533/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31533/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14339924" author="tongli" created="Fri, 27 Feb 2015 09:20:31 +0000"  >&lt;p&gt;Jun Rao,&lt;br/&gt;
	Thanks for taking time reviewing the patch. Would like to confirm here is what you suggested to do:&lt;/p&gt;

&lt;p&gt;	1. Utils.abs will be renamed to Utils.toPositive&lt;br/&gt;
	2. Make changes in these methods of class DefaultPartitioner and ByteArrayPartitioner so that toPositive gets called in partition method.&lt;/p&gt;

&lt;p&gt;		def partition(key: Any, numPartitions: Int): Int = &lt;/p&gt;
{
    			Utils.abs(key.hashCode) % numPartitions
  		}


&lt;p&gt;	I can certainly make the above changes.  however method abs gets used many other places and making the case worse is that there are two abs methods both in core and clients. I found this problem when I was in an effort of addressing issue 1926. For now, what if I keep that method in clients, remove the one in core Utils module and making changes to all other modules where abs method gets called so that all use of abs method will point to the clients Utils.abs instead of two locations?&lt;/p&gt;

&lt;p&gt;The patch set reflects the above thoughts is here &lt;a href=&quot;https://reviews.apache.org/r/31533/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31533/diff/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14340663" author="junrao" created="Fri, 27 Feb 2015 19:26:00 +0000"  >&lt;p&gt;Hi, Tong,&lt;/p&gt;

&lt;p&gt;My suggestion is slightly different. My point is that If we change the behavior of o.a.k.c.u.Utils.abs(), it will impact the following code in o.a.k.c.p.i.Partitioner since a given key will now be mapped to a different partition.&lt;/p&gt;

&lt;p&gt;            // hash the key to choose a partition&lt;br/&gt;
            return Utils.abs(Utils.murmur2(key)) % numPartitions;&lt;/p&gt;

&lt;p&gt;To preserve the current behavior, I was suggesting that we define a local method in o.a.k.c.p.i.Partitioner that looks like the following.&lt;/p&gt;

&lt;p&gt;    private static int toPositive(int n) &lt;/p&gt;
{
        return n &amp;amp; 0x7fffffff;
    }

&lt;p&gt;and change the partitioning code to&lt;/p&gt;

&lt;p&gt;            // hash the key to choose a partition&lt;br/&gt;
            return toPositive(Utils.murmur2(key)) % numPartitions;&lt;/p&gt;

&lt;p&gt;This will preserve the partitioning behavior of the producer in o.a.k.c.p. The rest of the changes will be the same as your original patch. We don&apos;t have to change the partitioning code in DefaultEventHandler. The scala producer already uses a different hash function from the java producer in o.a.k.c.p. So, the partitioning won&apos;t be consistent btw the scala and the java producer anyway. The replacing of k.u.Utils.abs() with o.a.k.c.u.Utils.abs() doesn&apos;t have to be done in this jira since you are already handling it in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1926&quot; title=&quot;Replace kafka.utils.Utils with o.a.k.common.utils.Utils&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1926&quot;&gt;&lt;del&gt;KAFKA-1926&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14340959" author="tongli" created="Fri, 27 Feb 2015 22:42:58 +0000"  >&lt;p&gt;Run Rao, I got the point now. Thanks so much for your very detailed explanation. A patch is coming in few minutes with only that.&lt;/p&gt;</comment>
                            <comment id="14340993" author="guozhang" created="Fri, 27 Feb 2015 23:08:53 +0000"  >&lt;p&gt;+1. Thanks Tong / Jun for fixing this and preserve compatibility at the same time.&lt;/p&gt;

&lt;p&gt;Is the current o.a.k.c.c.u.Utils.abs() used anywhere else?&lt;/p&gt;</comment>
                            <comment id="14341004" author="tongli" created="Fri, 27 Feb 2015 23:16:12 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31566/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31566/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14343109" author="tongli" created="Mon, 2 Mar 2015 12:22:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; Yes, the o.a.k.c.c.u.Utils.abs used in few places.  in patch set for issue 1926, I will consolidate both Utils modules from clients and core into one. So that we do not have name conflict all over the place. The patch set for issue 1926 will be quite big. I would like to get this thing fixed for coming up release first, then we can address issue 1926. Thanks.&lt;/p&gt;</comment>
                            <comment id="14346038" author="tongli" created="Wed, 4 Mar 2015 00:00:41 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31566/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31566/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14346045" author="tongli" created="Wed, 4 Mar 2015 00:03:50 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31566/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31566/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14346274" author="guozhang" created="Wed, 4 Mar 2015 02:36:32 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tongli&quot; class=&quot;user-hover&quot; rel=&quot;tongli&quot;&gt;tongli&lt;/a&gt;, +1 and committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14358613" author="noxis" created="Thu, 12 Mar 2015 12:57:39 +0000"  >&lt;p&gt;Why this fix is not included in 0.8.2.1 release?&lt;/p&gt;</comment>
                            <comment id="14359004" author="ewencp" created="Thu, 12 Mar 2015 17:19:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noxis&quot; class=&quot;user-hover&quot; rel=&quot;noxis&quot;&gt;noxis&lt;/a&gt; Because it wasn&apos;t a critical fix. It didn&apos;t change any behavior, the change only made it so the code wasn&apos;t misleading. There are only a couple of other uses of the Util.abs method and the change doesn&apos;t affect them.&lt;/p&gt;</comment>
                            <comment id="14359229" author="noxis" created="Thu, 12 Mar 2015 19:36:10 +0000"  >&lt;p&gt;Please update this issue. Currently it is a blocker fixed in 0.8.2.1.&lt;/p&gt;</comment>
                            <comment id="14359676" author="tongli" created="Fri, 13 Mar 2015 00:17:40 +0000"  >

&lt;p&gt;I thought this one was merged. Please let me know what I need to do with&lt;br/&gt;
it?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Sent from my iPhone&lt;/p&gt;

&lt;p&gt;wrote:&lt;br/&gt;
[ &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1988?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=14359229#comment-14359229&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-1988?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=14359229#comment-14359229&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;negative numbers.&lt;br/&gt;
----------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1988&quot; title=&quot;org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1988&quot;&gt;&lt;del&gt;KAFKA-1988&lt;/del&gt;&lt;/a&gt;.patch, &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1988&quot; title=&quot;org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1988&quot;&gt;&lt;del&gt;KAFKA-1988&lt;/del&gt;&lt;/a&gt;_2015-03-03_19:00:21.patch,&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1988&quot; title=&quot;org.apache.kafka.common.utils.Utils.abs method returns wrong value for negative numbers.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1988&quot;&gt;&lt;del&gt;KAFKA-1988&lt;/del&gt;&lt;/a&gt;_2015-03-03_19:03:31.patch&lt;br/&gt;
negative numbers. The method only returns intended value for positive&lt;br/&gt;
numbers. All negative numbers except the Integer.Min_Value will be returned&lt;br/&gt;
an unsigned integer.&lt;/p&gt;</comment>
                            <comment id="14359678" author="ewencp" created="Fri, 13 Mar 2015 00:19:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tongli&quot; class=&quot;user-hover&quot; rel=&quot;tongli&quot;&gt;tongli&lt;/a&gt; You&apos;re all good, it was merged. I just updated the fix version so it is accurate.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12701483" name="KAFKA-1988.patch" size="4656" author="tongli" created="Fri, 27 Feb 2015 23:16:11 +0000"/>
                            <attachment id="12701305" name="KAFKA-1988.patch" size="11048" author="tongli" created="Fri, 27 Feb 2015 09:18:15 +0000"/>
                            <attachment id="12701227" name="KAFKA-1988.patch" size="2104" author="tongli" created="Fri, 27 Feb 2015 00:45:44 +0000"/>
                            <attachment id="12702309" name="KAFKA-1988_2015-03-03_19:00:21.patch" size="4835" author="tongli" created="Wed, 4 Mar 2015 00:00:41 +0000"/>
                            <attachment id="12702310" name="KAFKA-1988_2015-03-03_19:03:31.patch" size="4827" author="tongli" created="Wed, 4 Mar 2015 00:03:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i264jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>