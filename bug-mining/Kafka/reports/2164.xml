<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:17:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7945] ExpiringCredentialRefreshingLogin - timeout value is negative</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7945</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There was an issue with one of our Kafka consumers no longer sending a valid OAuth token.&#160;Looking at the logs, there seems to be an error in some of the math in the timestamp calculation:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
14 Feb 2019 06:42:45,694 Expiring credential expires at 2019-02-14T06:48:21.000+0000, so buffer times of 60 and 300 seconds at the front and back, respectively, cannot be accommodated. We will refresh at 2019-02-14T06:01:39.078+0000.
14 Feb 2019 06:42:45,694 org.apache.kafka.common.utils.KafkaThread: Uncaught exception in thread
java.lang.IllegalArgumentException: timeout value is negative
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method) ~[?:1.8.0_202]
at org.apache.kafka.common.utils.SystemTime.sleep(SystemTime.java:45) ~[kafka-clients-2.x.jar:?]
at org.apache.kafka.common.security.oauthbearer.internals.expiring.ExpiringCredentialRefreshingLogin$Refresher.run(ExpiringCredentialRefreshingLogin.java:86) ~[kafka-clients-2.x.jar:?]
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_202]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;At this point the refresh logic would never recover and so the producer couldn&apos;t consume until we restarted the process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13216477">KAFKA-7945</key>
            <summary>ExpiringCredentialRefreshingLogin - timeout value is negative</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rndgstn">Ron Dagostino</assignee>
                                    <reporter username="deniogun">Denis Ogun</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Feb 2019 22:13:30 +0000</created>
                <updated>Wed, 20 Feb 2019 21:37:55 +0000</updated>
                            <resolved>Wed, 20 Feb 2019 21:37:55 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16771423" author="ijuma" created="Mon, 18 Feb 2019 22:56:30 +0000"  >&lt;p&gt;Cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16771424" author="ijuma" created="Mon, 18 Feb 2019 22:58:01 +0000"  >&lt;p&gt;Also cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rndgstn&quot; class=&quot;user-hover&quot; rel=&quot;rndgstn&quot;&gt;rndgstn&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16771526" author="hackerwin7" created="Tue, 19 Feb 2019 03:13:53 +0000"  >&lt;p&gt;It seems that &lt;em&gt;expiringCredential.startTimeMs()&lt;/em&gt; in &lt;em&gt;ExpiringCredentialRefreshingLogin.refreshMs()&lt;/em&gt; return an earlier time relative to current time. so returned &lt;em&gt;retvalRefreshMs&lt;/em&gt; maybe smaller than &lt;em&gt;nowMs&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Is there more relative logs like&#160;&quot;Expiring credential valid from {} to {}&quot; to see the &lt;em&gt;startMs&lt;/em&gt;?&lt;/p&gt;</comment>
                            <comment id="16771528" author="githubbot" created="Tue, 19 Feb 2019 03:22:11 +0000"  >&lt;p&gt;rondagostino commented on pull request #6288: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7945&quot; title=&quot;ExpiringCredentialRefreshingLogin - timeout value is negative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7945&quot;&gt;&lt;del&gt;KAFKA-7945&lt;/del&gt;&lt;/a&gt;: Calc refresh time correctly when token created in the past&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6288&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The token refresh point could potentially be calculated incorrectly when the token was created far enough in the past, possibly raising an exception and disabling the client.  Typically this is not the case &amp;#8211; when the client invokes &quot;login&quot; on the JAAS LoginModule the token that is returned is not a token that has been &quot;sitting on the shelf&quot; for a while; it is generally a token that has just been created, so its start time is very close to &quot;now&quot;.  The bug potentially exists for the case where the token has a start time far enough in the past such that the 80% point from that start time to the expiration time ends up being before the current time.  Even then, though, the minimum refresh time will generally kick in and cause the token to be refreshed after that minimum time.  The bug does exist for the special case where not only does the 80% point end up being calculated to be in the past, but also the remaining lifetime (the time between &quot;now&quot; and the expiration time) is small enough such that the minimum refresh time and the minimum buffer time at the end cannot both be accommodated.  For example, if the minimum refresh time is 1 minute and the minimum buffer time at the end is 5 minutes, but the token expires in less than 6 minutes &amp;#8211; then the bug condition can occur if the token start time is in the past.&lt;/p&gt;

&lt;p&gt;   Signed-off-by: Ron Dagostino &amp;lt;rndgstn@gmail.com&amp;gt;&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16773403" author="githubbot" created="Wed, 20 Feb 2019 21:26:44 +0000"  >&lt;p&gt;rajinisivaram commented on pull request #6288: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7945&quot; title=&quot;ExpiringCredentialRefreshingLogin - timeout value is negative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7945&quot;&gt;&lt;del&gt;KAFKA-7945&lt;/del&gt;&lt;/a&gt;: Calc refresh time correctly when token created in the past&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6288&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi13vs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rsivaram</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>