<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3949] Consumer topic subscription change may be ignored if a rebalance is in progress</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3949</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The consumer&apos;s regex subscription works by matching all topics fetched from a metadata update against the provided pattern. When a new topic is created or an old topic is deleted, we update the list of subscribed topics and request a rebalance by setting the &lt;tt&gt;needsPartitionAssignment&lt;/tt&gt; flag inside &lt;tt&gt;SubscriptionState&lt;/tt&gt;. On the next call to &lt;tt&gt;poll()&lt;/tt&gt;, the consumer will observe the flag and begin the rebalance by sending a JoinGroup. The problem is that it does not account for the fact that a rebalance could already be in progress at the time the metadata is updated. This causes the following sequence:&lt;/p&gt;

&lt;p&gt;1. Rebalance begins (needsPartitionAssignment is set True)&lt;br/&gt;
2. Metadata max age expires and and update is triggered&lt;br/&gt;
3. Update returns and causes a topic subscription change (needsPartitionAssignment set again to True).&lt;br/&gt;
4. Rebalance completes (needsPartitionAssignment is set False)&lt;/p&gt;

&lt;p&gt;In this situation, we will not request a new rebalance which will prevent us from receiving an assignment from any topics added to the consumer&apos;s subscription when the metadata was updated. This state will persist until another event causes the group to rebalance.&lt;/p&gt;

&lt;p&gt;A related problem may occur if a rebalance is interrupted with the wakeup() API, and the user calls subscribe(topics) with a change to the subscription set. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12988461">KAFKA-3949</key>
            <summary>Consumer topic subscription change may be ignored if a rebalance is in progress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                            <label>new-consumer-threading-should-fix</label>
                    </labels>
                <created>Mon, 11 Jul 2016 22:48:53 +0000</created>
                <updated>Fri, 11 Feb 2022 07:34:31 +0000</updated>
                            <resolved>Sat, 20 Aug 2016 05:00:14 +0000</resolved>
                                    <version>0.9.0.1</version>
                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15372139" author="guozhang" created="Tue, 12 Jul 2016 03:58:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, this is a good find!&lt;/p&gt;</comment>
                            <comment id="15427604" author="githubbot" created="Fri, 19 Aug 2016 04:28:12 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1762&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3949&quot; title=&quot;Consumer topic subscription change may be ignored if a rebalance is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3949&quot;&gt;&lt;del&gt;KAFKA-3949&lt;/del&gt;&lt;/a&gt;: Fix race condition when metadata update arrives during rebalance&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3949&quot; title=&quot;Consumer topic subscription change may be ignored if a rebalance is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3949&quot;&gt;&lt;del&gt;KAFKA-3949&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1762.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1762.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1762&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2ce2e1f354740f07899d452e5f2e086cee759ebf&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2016-08-19T04:26:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3949&quot; title=&quot;Consumer topic subscription change may be ignored if a rebalance is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3949&quot;&gt;&lt;del&gt;KAFKA-3949&lt;/del&gt;&lt;/a&gt;: Fix race condition when metadata update arrives during rebalance&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15429222" author="guozhang" created="Sat, 20 Aug 2016 05:00:14 +0000"  >&lt;p&gt;Issue resolved by pull request 1762&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1762&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15429223" author="githubbot" created="Sat, 20 Aug 2016 05:00:32 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1762&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30thz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>