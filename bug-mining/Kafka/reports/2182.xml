<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:17:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7974] KafkaAdminClient loses worker thread/enters zombie state when initial DNS lookup fails</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7974</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Version: kafka-clients-2.1.0&lt;/p&gt;

&lt;p&gt;I have some code that creates creates a KafkaAdminClient instance and then invokes listTopics(). I was seeing the following stacktrace in the logs, after which the KafkaAdminClient instance became unresponsive:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR [kafka-admin-client-thread | adminclient-1] 2019-02-18 01:00:45,597 KafkaThread.java:51 - Uncaught exception in thread &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka-admin-client-thread | adminclient-1&apos;&lt;/span&gt;:
java.lang.IllegalStateException: No entry found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connection 0
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.nodeState(ClusterConnectionStates.java:330)
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.disconnected(ClusterConnectionStates.java:134)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:921)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:287)
&#160;&#160; &#160;at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.sendEligibleCalls(KafkaAdminClient.java:898)
&#160;&#160; &#160;at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.run(KafkaAdminClient.java:1113)
&#160;&#160; &#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From looking at the code I was able to trace down a possible cause:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;NetworkClient.ready() invokes this.initiateConnect() as seen in the above stacktrace&lt;/li&gt;
	&lt;li&gt;NetworkClient.initiateConnect() invokes ClusterConnectionStates.connecting(), which internally invokes ClientUtils.resolve() to to resolve the host when creating an entry for the connection.&lt;/li&gt;
	&lt;li&gt;If this host lookup fails, a UnknownHostException can be thrown back to NetworkClient.initiateConnect() and the connection entry is not created in ClusterConnectionStates. This exception doesn&apos;t get logged so this is a guess on my part.&lt;/li&gt;
	&lt;li&gt;NetworkClient.initiateConnect() catches the exception and attempts to call ClusterConnectionStates.disconnected(), which throws an IllegalStateException because no entry had yet been created due to the lookup failure.&lt;/li&gt;
	&lt;li&gt;This IllegalStateException ends up killing the worker thread and KafkaAdminClient gets stuck, never returning from listTopics().&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13217323">KAFKA-7974</key>
            <summary>KafkaAdminClient loses worker thread/enters zombie state when initial DNS lookup fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nickbp">Nicholas Parker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Feb 2019 23:54:05 +0000</created>
                <updated>Mon, 14 Sep 2020 08:36:58 +0000</updated>
                            <resolved>Thu, 7 Mar 2019 08:12:23 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>admin</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16774661" author="githubbot" created="Fri, 22 Feb 2019 01:35:20 +0000"  >&lt;p&gt;nickbp commented on pull request #6305: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7974&quot; title=&quot;KafkaAdminClient loses worker thread/enters zombie state when initial DNS lookup fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7974&quot;&gt;&lt;del&gt;KAFKA-7974&lt;/del&gt;&lt;/a&gt;: Avoid calling disconnect() when not yet connecting&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6305&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   When attempting to get topic list via KafkaAdminClient against a server that isn&apos;t resolvable, the worker thread can get killed as follows, leading to a zombie KafkaAdminClient:&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-admin-client-thread | adminclient-1&amp;#93;&lt;/span&gt; 2019-02-18 01:00:45,597 KafkaThread.java:51 - Uncaught exception in thread &apos;kafka-admin-client-thread | adminclient-1&apos;:&lt;br/&gt;
   java.lang.IllegalStateException: No entry found for connection 0&lt;br/&gt;
       at org.apache.kafka.clients.ClusterConnectionStates.nodeState(ClusterConnectionStates.java:330)&lt;br/&gt;
       at org.apache.kafka.clients.ClusterConnectionStates.disconnected(ClusterConnectionStates.java:134)&lt;br/&gt;
       at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:921)&lt;br/&gt;
       at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:287)&lt;br/&gt;
       at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.sendEligibleCalls(KafkaAdminClient.java:898)&lt;br/&gt;
       at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.run(KafkaAdminClient.java:1113)&lt;br/&gt;
       at java.lang.Thread.run(Thread.java:748)&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   It looks like cause is a bug in state handling between `NetworkClient` and `ClusterConnectionStates`:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`NetworkClient.ready()` invokes `this.initiateConnect()` as seen in the above stacktrace&lt;/li&gt;
	&lt;li&gt;`NetworkClient.initiateConnect()` invokes `ClusterConnectionStates.connecting()`, which internally invokes `ClientUtils.resolve()` to resolve the host when creating an entry for the connection.&lt;/li&gt;
	&lt;li&gt;If this host lookup fails, a `UnknownHostException` can be thrown back to `NetworkClient.initiateConnect()` and the connection entry is not created in `ClusterConnectionStates`. This exception doesn&apos;t currently get logged so this is a guess on my part.&lt;/li&gt;
	&lt;li&gt;`NetworkClient.initiateConnect()` catches the exception and attempts to call `ClusterConnectionStates.disconnected()`, which throws an `IllegalStateException` because no entry had yet been created due to the lookup failure.&lt;/li&gt;
	&lt;li&gt;This `IllegalStateException` ends up killing the worker thread and `KafkaAdminClient` gets stuck, never returning from `listTopics()`.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   This PR includes a unit test which reproduces the original issue (matching stacktrace) and verifies the fix.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16774672" author="nickbp" created="Fri, 22 Feb 2019 01:48:21 +0000"  >&lt;p&gt;Happened to see a different version of the same issue in a Confluent Schema Registry instance just now. It appears the issue can affect a wide variety of kafka clients:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2019-02-22 01:38:33,560] ERROR [Producer clientId=producer-1] Uncaught error in kafka producer I/O thread:&#160; (org.apache.kafka.clients.producer.internals.Sender)
java.lang.IllegalStateException: No entry found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connection 0
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.nodeState(ClusterConnectionStates.java:330)
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.disconnected(ClusterConnectionStates.java:134)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:921)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:287)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.sendProducerData(Sender.java:335)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:308)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:233)
&#160;&#160; &#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[2019-02-22 01:38:33,560] ERROR [Producer clientId=producer-1] Uncaught error in kafka producer I/O thread:&#160; (org.apache.kafka.clients.producer.internals.Sender)
java.lang.IllegalStateException: No entry found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connection 0
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.nodeState(ClusterConnectionStates.java:330)
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.disconnected(ClusterConnectionStates.java:134)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:921)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:287)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.sendProducerData(Sender.java:335)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:308)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:233)
&#160;&#160; &#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[2019-02-22 01:38:33,560] ERROR [Producer clientId=producer-1] Uncaught error in kafka producer I/O thread:&#160; (org.apache.kafka.clients.producer.internals.Sender)
java.lang.IllegalStateException: No entry found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connection 0
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.nodeState(ClusterConnectionStates.java:330)
&#160;&#160; &#160;at org.apache.kafka.clients.ClusterConnectionStates.disconnected(ClusterConnectionStates.java:134)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:921)
&#160;&#160; &#160;at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:287)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.sendProducerData(Sender.java:335)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:308)
&#160;&#160; &#160;at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:233)
&#160;&#160; &#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
... keeps looping ..&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16786494" author="githubbot" created="Thu, 7 Mar 2019 08:07:26 +0000"  >&lt;p&gt;cmccabe commented on pull request #6305: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7974&quot; title=&quot;KafkaAdminClient loses worker thread/enters zombie state when initial DNS lookup fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7974&quot;&gt;&lt;del&gt;KAFKA-7974&lt;/del&gt;&lt;/a&gt;: Avoid zombie AdminClient when node host isn&apos;t resolvable&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6305&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13225530">KAFKA-8182</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi193c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>