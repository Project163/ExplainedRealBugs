<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:17:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7565] NPE in KafkaConsumer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7565</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The stacktrace is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
        at org.apache.kafka.clients.consumer.internals.Fetcher$1.onSuccess(Fetcher.java:221)
        at org.apache.kafka.clients.consumer.internals.Fetcher$1.onSuccess(Fetcher.java:202)
        at org.apache.kafka.clients.consumer.internals.RequestFuture.fireSuccess(RequestFuture.java:167)
        at org.apache.kafka.clients.consumer.internals.RequestFuture.complete(RequestFuture.java:127)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient$RequestFutureCompletionHandler.fireCompletion(ConsumerNetworkClient.java:563)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.firePendingCompletedRequests(ConsumerNetworkClient.java:390)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:244)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:233)
        at org.apache.kafka.clients.consumer.KafkaConsumer.pollOnce(KafkaConsumer.java:1171)
        at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Couldn&apos;t find minimal reproducer, but it happens quite often in our system. We use &lt;tt&gt;pause()&lt;/tt&gt; and &lt;tt&gt;wakeup()&lt;/tt&gt; methods quite extensively, maybe it is somehow related.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194918">KAFKA-7565</key>
            <summary>NPE in KafkaConsumer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="avakhrenev">Alexey Vakhrenev</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2018 17:47:33 +0000</created>
                <updated>Tue, 4 Jun 2019 23:04:15 +0000</updated>
                            <resolved>Tue, 21 May 2019 20:52:57 +0000</resolved>
                                    <version>1.1.1</version>
                                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16681595" author="rsivaram" created="Fri, 9 Nov 2018 15:31:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avakhrenev&quot; class=&quot;user-hover&quot; rel=&quot;avakhrenev&quot;&gt;avakhrenev&lt;/a&gt; Can you try with the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7280?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-7280?&lt;/a&gt; If you are able to use 2.0.1 RC0, it contains the fix. It will be good to know if you are running into the synchronization issue fixed in that JIRA or if this is a different issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="16681639" author="ijuma" created="Fri, 9 Nov 2018 16:01:30 +0000"  >&lt;p&gt;2.0.1 is already in Maven btw.&lt;/p&gt;</comment>
                            <comment id="16682850" author="avakhrenev" created="Sun, 11 Nov 2018 11:38:35 +0000"  >&lt;p&gt;I&apos;ll try it next week and report back. Thank you!&lt;/p&gt;</comment>
                            <comment id="16689243" author="avakhrenev" created="Fri, 16 Nov 2018 10:03:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; the issue seems to be fixed in 2.0.1, I didn&apos;t encounter this error anymore. So this can be closed I think.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="16689341" author="rsivaram" created="Fri, 16 Nov 2018 12:18:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avakhrenev&quot; class=&quot;user-hover&quot; rel=&quot;avakhrenev&quot;&gt;avakhrenev&lt;/a&gt; Thanks for testing, closing this issue.&lt;/p&gt;</comment>
                            <comment id="16693299" author="avakhrenev" created="Tue, 20 Nov 2018 14:19:46 +0000"  >&lt;p&gt;Whoops, seems like that was too early. Here is the new stacktrace from 2.0.1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
        at org.apache.kafka.clients.consumer.internals.Fetcher$1.onSuccess(Fetcher.java:239)
        at org.apache.kafka.clients.consumer.internals.Fetcher$1.onSuccess(Fetcher.java:219)
        at org.apache.kafka.clients.consumer.internals.RequestFuture.fireSuccess(RequestFuture.java:167)
        at org.apache.kafka.clients.consumer.internals.RequestFuture.complete(RequestFuture.java:127)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient$RequestFutureCompletionHandler.fireCompletion(ConsumerNetworkClient.java:586)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.firePendingCompletedRequests(ConsumerNetworkClient.java:400)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:253)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.pollNoWakeup(ConsumerNetworkClient.java:310)
        at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1197)
        at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1154)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16765452" author="mjsax" created="Mon, 11 Feb 2019 22:36:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&#160;This is marked as &quot;Critical&quot; for 2.2 release but it seems&#160;nobody picked it up. Comment? Should we remove fixed version&#160;and/or deprioritize?&lt;/p&gt;</comment>
                            <comment id="16766772" author="ijuma" created="Wed, 13 Feb 2019 04:54:17 +0000"  >&lt;p&gt;Any thoughts &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;? Maybe related &lt;a href=&quot;https://github.com/apache/kafka/pull/6221&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6221&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16767474" author="rsivaram" created="Wed, 13 Feb 2019 19:12:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I am not sure if this is covered by your PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7831&quot; title=&quot;Consumer SubscriptionState missing synchronization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7831&quot;&gt;&lt;del&gt;KAFKA-7831&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;We have a check for whether the partitions returned in a fetch response are still in the fetch session and we return if that is not the case: &lt;a href=&quot;https://github.com/apache/kafka/blob/b02b5b63a5d43ab552c6cec1237707b2edd1bb36/clients/src/main/java/org/apache/kafka/clients/consumer/internals/Fetcher.java#L234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/b02b5b63a5d43ab552c6cec1237707b2edd1bb36/clients/src/main/java/org/apache/kafka/clients/consumer/internals/Fetcher.java#L234&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Further down in the code, we assume that the partitions do exist in the session and access the partitions without checking for null: &lt;a href=&quot;https://github.com/apache/kafka/blob/b02b5b63a5d43ab552c6cec1237707b2edd1bb36/clients/src/main/java/org/apache/kafka/clients/consumer/internals/Fetcher.java#L243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/b02b5b63a5d43ab552c6cec1237707b2edd1bb36/clients/src/main/java/org/apache/kafka/clients/consumer/internals/Fetcher.java#L243&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Presumably fetch session partitions can change in between lines 234 aand 243 since the response could be processed on the heartbeat thread. With the changes from your PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7831&quot; title=&quot;Consumer SubscriptionState missing synchronization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7831&quot;&gt;&lt;del&gt;KAFKA-7831&lt;/del&gt;&lt;/a&gt;, can we guarantee that the session partitions wont change?&lt;/p&gt;</comment>
                            <comment id="16769204" author="avakhrenev" created="Fri, 15 Feb 2019 11:13:37 +0000"  >&lt;p&gt;One more data point: when we removed all the &lt;tt&gt;wakeup()&lt;/tt&gt; invocations, the issue has gone. Seems like throwing &lt;tt&gt;WakeupException&lt;/tt&gt; leaves the &lt;tt&gt;KafkaConsumer&lt;/tt&gt; in some inconsistent state.&lt;/p&gt;</comment>
                            <comment id="16770216" author="mjsax" created="Sat, 16 Feb 2019 20:45:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; What is the status? Because there are two unresolved blocker for 2.2, I would be willing to accept this for 2.2 if we can resolve it before the blockers are merged. Any time estimation for this ticket?&lt;/p&gt;</comment>
                            <comment id="16775953" author="mjsax" created="Sat, 23 Feb 2019 17:29:40 +0000"  >&lt;p&gt;Moving this out of `2.2`. No progress.&lt;/p&gt;</comment>
                            <comment id="16789868" author="githubbot" created="Mon, 11 Mar 2019 18:52:17 +0000"  >&lt;p&gt;jsancio commented on pull request #6427: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7565&quot; title=&quot;NPE in KafkaConsumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7565&quot;&gt;&lt;del&gt;KAFKA-7565&lt;/del&gt;&lt;/a&gt;: Better messaging for invalid fetch response&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6427&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Users have reported that when consumer poll wake up is used, it is&lt;br/&gt;
   possible to receive fetch responses that don&apos;t match the copied topic&lt;br/&gt;
   partitions collection for the session when the fetch request was created.&lt;/p&gt;

&lt;p&gt;   This commit improves the error handling here by throwing an&lt;br/&gt;
   IllegalStateException instead of a NullPointerException. And by&lt;br/&gt;
   generating a message for the exception that includes a bit of more&lt;br/&gt;
   information.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16789872" author="jsancio" created="Mon, 11 Mar 2019 19:00:29 +0000"  >&lt;p&gt;The PR/patch above doesn&apos;t address the issue but instead improves the messaging. It also provides slightly more information that would allow us to debug this better in the future.&lt;/p&gt;</comment>
                            <comment id="16791912" author="jagsancio" created="Wed, 13 Mar 2019 17:25:24 +0000"  >&lt;p&gt;The Github PR 6427 was merge to trunk. The next version of Kafka should replace the null pointer exception with an illegal state exception with more information what should help us debug the issue if it happens again.&lt;/p&gt;</comment>
                            <comment id="16819330" author="jagsancio" created="Tue, 16 Apr 2019 17:41:52 +0000"  >&lt;p&gt;It is likely that this issue is another side effect of the data race identified here: &lt;a href=&quot;https://github.com/apache/kafka/pull/6582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6582&lt;/a&gt;. What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13178524">KAFKA-7280</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13219927">KAFKA-8052</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zrm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>