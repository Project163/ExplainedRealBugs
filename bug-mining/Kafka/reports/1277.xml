<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:57:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3994] Deadlock between consumer heartbeat expiration and offset commit.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3994</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I got the following stacktraces from ConsumerBounceTest&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-quote&quot;&gt;&quot;Test worker&quot;&lt;/span&gt; #12 prio=5 os_prio=0 tid=0x00007fbb28b7f000 nid=0x427c runnable [0x00007fbb06445000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
        at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)
        at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)
        at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:79)
        at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)
        - locked &amp;lt;0x00000003d48bcbc0&amp;gt; (a sun.nio.ch.Util$2)
        - locked &amp;lt;0x00000003d48bcbb0&amp;gt; (a java.util.Collections$UnmodifiableSet)
        - locked &amp;lt;0x00000003d48bbd28&amp;gt; (a sun.nio.ch.EPollSelectorImpl)
        at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)
        at org.apache.kafka.common.network.Selector.select(Selector.java:454)
        at org.apache.kafka.common.network.Selector.poll(Selector.java:277)
        at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:260)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.clientPoll(ConsumerNetworkClient.java:360)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:224)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:192)
        at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:163)
        at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureCoordinatorReady(AbstractCoordinator.java:179)
        at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.commitOffsetsSync(ConsumerCoordinator.java:411)
        at org.apache.kafka.clients.consumer.KafkaConsumer.commitSync(KafkaConsumer.java:1086)
        at org.apache.kafka.clients.consumer.KafkaConsumer.commitSync(KafkaConsumer.java:1054)
        at kafka.api.ConsumerBounceTest.consumeWithBrokerFailures(ConsumerBounceTest.scala:103)
        at kafka.api.ConsumerBounceTest.testConsumptionWithBrokerFailures(ConsumerBounceTest.scala:70)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:483)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
        at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:105)
        at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:56)
        at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:64)
        at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:49)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:483)
        at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
        at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
        at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
        at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
...
Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;executor-Heartbeat&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007fb9b00fb028 (object 0x00000003d4fa0f48, a java.util.LinkedList),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-request-handler-7&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-request-handler-7&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007fba6c01e2f8 (object 0x00000003d4617a48, a kafka.coordinator.GroupMetadata),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;executor-Heartbeat&quot;&lt;/span&gt;

Java stack information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the threads listed above:
===================================================
&lt;span class=&quot;code-quote&quot;&gt;&quot;executor-Heartbeat&quot;&lt;/span&gt;:
        at kafka.server.DelayedOperationPurgatory$Watchers.watch(DelayedOperation.scala:301)
        - waiting to lock &amp;lt;0x00000003d4fa0f48&amp;gt; (a java.util.LinkedList)
        at kafka.server.DelayedOperationPurgatory$$anonfun$kafka$server$DelayedOperationPurgatory$$watchForOperation$1.apply$mcV$sp(DelayedOperation.scala:262)
        at kafka.server.DelayedOperationPurgatory$$anonfun$kafka$server$DelayedOperationPurgatory$$watchForOperation$1.apply(DelayedOperation.scala:260)
        at kafka.server.DelayedOperationPurgatory$$anonfun$kafka$server$DelayedOperationPurgatory$$watchForOperation$1.apply(DelayedOperation.scala:260)
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:231)
        at kafka.utils.CoreUtils$.inReadLock(CoreUtils.scala:237)
        at kafka.server.DelayedOperationPurgatory.kafka$server$DelayedOperationPurgatory$$watchForOperation(DelayedOperation.scala:260)
        at kafka.server.DelayedOperationPurgatory$$anonfun$tryCompleteElseWatch$2.apply(DelayedOperation.scala:199)
        at scala.collection.mutable.ResizableArray$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(ResizableArray.scala:59)
        at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)
        at kafka.server.DelayedOperationPurgatory.tryCompleteElseWatch(DelayedOperation.scala:195)
        at kafka.server.ReplicaManager.appendMessages(ReplicaManager.scala:353)
        at kafka.coordinator.GroupMetadataManager.store(GroupMetadataManager.scala:239)
        at kafka.coordinator.GroupCoordinator$$anonfun$onCompleteJoin$6.apply(GroupCoordinator.scala:701)
        at kafka.coordinator.GroupCoordinator$$anonfun$onCompleteJoin$6.apply(GroupCoordinator.scala:701)
        at scala.Option.foreach(Option.scala:236)
        at kafka.coordinator.GroupCoordinator.onCompleteJoin(GroupCoordinator.scala:701)
        at kafka.coordinator.DelayedJoin.onComplete(DelayedJoin.scala:39)
        at kafka.server.DelayedOperation.forceComplete(DelayedOperation.scala:70)
        at kafka.coordinator.DelayedJoin$$anonfun$tryComplete$1.apply$mcZ$sp(DelayedJoin.scala:37)
        at kafka.coordinator.GroupCoordinator.tryCompleteJoin(GroupCoordinator.scala:647)
        - locked &amp;lt;0x00000003d4617a48&amp;gt; (a kafka.coordinator.GroupMetadata)
        at kafka.coordinator.DelayedJoin.tryComplete(DelayedJoin.scala:37)
        at kafka.server.DelayedOperationPurgatory.tryCompleteElseWatch(DelayedOperation.scala:190)
        - locked &amp;lt;0x00000003d505b5b0&amp;gt; (a kafka.coordinator.DelayedJoin)
        at kafka.coordinator.GroupCoordinator.prepareRebalance(GroupCoordinator.scala:631)
        at kafka.coordinator.GroupCoordinator.kafka$coordinator$GroupCoordinator$$maybePrepareRebalance(GroupCoordinator.scala:616)
        - locked &amp;lt;0x00000003d4617a48&amp;gt; (a kafka.coordinator.GroupMetadata)
        at kafka.coordinator.GroupCoordinator.onMemberFailure(GroupCoordinator.scala:639)
        at kafka.coordinator.GroupCoordinator.onExpireHeartbeat(GroupCoordinator.scala:715)
        - locked &amp;lt;0x00000003d4617a48&amp;gt; (a kafka.coordinator.GroupMetadata)
        at kafka.coordinator.DelayedHeartbeat.onExpiration(DelayedHeartbeat.scala:33)
        at kafka.server.DelayedOperation.run(DelayedOperation.scala:107)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-request-handler-7&quot;&lt;/span&gt;:
        at kafka.coordinator.GroupMetadataManager.kafka$coordinator$GroupMetadataManager$$putCacheCallback$2(GroupMetadataManager.scala:288)
        - waiting to lock &amp;lt;0x00000003d4617a48&amp;gt; (a kafka.coordinator.GroupMetadata)
        at kafka.coordinator.GroupMetadataManager$$anonfun$prepareStoreOffsets$1.apply(GroupMetadataManager.scala:336)
        at kafka.coordinator.GroupMetadataManager$$anonfun$prepareStoreOffsets$1.apply(GroupMetadataManager.scala:336)
        at kafka.server.DelayedProduce.onComplete(DelayedProduce.scala:123)
        at kafka.server.DelayedOperation.forceComplete(DelayedOperation.scala:70)
        at kafka.server.DelayedProduce.tryComplete(DelayedProduce.scala:105)
        at kafka.server.DelayedOperationPurgatory$Watchers.tryCompleteWatched(DelayedOperation.scala:315)
        - locked &amp;lt;0x00000003d4fa0f80&amp;gt; (a kafka.server.DelayedProduce)
        - locked &amp;lt;0x00000003d4fa0f48&amp;gt; (a java.util.LinkedList)
        at kafka.server.DelayedOperationPurgatory.checkAndComplete(DelayedOperation.scala:234)
        at kafka.server.ReplicaManager.tryCompleteDelayedProduce(ReplicaManager.scala:201)
        at kafka.cluster.Partition.tryCompleteDelayedRequests(Partition.scala:374)
        at kafka.cluster.Partition.maybeExpandIsr(Partition.scala:293)
        at kafka.cluster.Partition.updateReplicaLogReadResult(Partition.scala:242)
        at kafka.server.ReplicaManager$$anonfun$updateFollowerLogReadResults$2.apply(ReplicaManager.scala:868)
        at kafka.server.ReplicaManager$$anonfun$updateFollowerLogReadResults$2.apply(ReplicaManager.scala:865)
        at scala.collection.immutable.Map$Map2.foreach(Map.scala:130)
        at kafka.server.ReplicaManager.updateFollowerLogReadResults(ReplicaManager.scala:865)
        at kafka.server.ReplicaManager.fetchMessages(ReplicaManager.scala:473)
        at kafka.server.KafkaApis.handleFetchRequest(KafkaApis.scala:503)
        at kafka.server.KafkaApis.handle(KafkaApis.scala:78)
        at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:60)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

Found 1 deadlock.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks the issue is that when a consumer heartbeat expired while a CommitOffsetRequest is received for the same group of that consumer, the DelayedHeartbeat and the DelayedProduce for the offset commit are grabbing the locks in different order.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12992699">KAFKA-3994</key>
            <summary>Deadlock between consumer heartbeat expiration and offset commit.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="becket_qin">Jiangjie Qin</reporter>
                        <labels>
                            <label>reliability</label>
                    </labels>
                <created>Tue, 26 Jul 2016 19:33:02 +0000</created>
                <updated>Thu, 25 May 2017 03:55:48 +0000</updated>
                            <resolved>Mon, 5 Dec 2016 20:44:13 +0000</resolved>
                                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.1.1</fixVersion>
                    <fixVersion>0.10.2.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15394836" author="ijuma" created="Wed, 27 Jul 2016 00:30:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;, are you intending to work on this? cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15394919" author="ijuma" created="Wed, 27 Jul 2016 01:45:52 +0000"  >&lt;p&gt;Also, did you see this issue with 0.10.0.0 or trunk?&lt;/p&gt;</comment>
                            <comment id="15394920" author="hachikuji" created="Wed, 27 Jul 2016 01:46:01 +0000"  >&lt;p&gt;Good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;. Just to clarify, this was not on trunk? I was wondering if this could have been caused by the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2720&quot; title=&quot;Periodic purging groups in the coordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2720&quot;&gt;&lt;del&gt;KAFKA-2720&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15395000" author="becket_qin" created="Wed, 27 Jul 2016 03:30:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; This is on the trunk. I will not be able to work on this for a while so please feel free to take the ticket.&lt;/p&gt;</comment>
                            <comment id="15395001" author="becket_qin" created="Wed, 27 Jul 2016 03:31:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; ^^&lt;/p&gt;</comment>
                            <comment id="15420573" author="githubbot" created="Mon, 15 Aug 2016 03:08:42 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1738&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;: Fix deadlock in Watchers by calling tryComplete without the lock&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1738.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1738.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1738&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2e4da1d92f3c6130e7e07e40d3e464ee12839b21&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2016-08-15T02:56:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;: Fix deadlock in Watchers by calling tryComplete without the lock&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15657721" author="mjuarez" created="Fri, 11 Nov 2016 18:22:59 +0000"  >&lt;p&gt;Just tried this patch against the stock 0.10.1.0 branch, and we&apos;re still seeing this deadlock in our staging clusters.  We don&apos;t have yet a thread dump while the deadlock was happening, but we&apos;ll be sure to add it to this ticket as soon as we get it.&lt;/p&gt;

&lt;p&gt;Relevant mailing list thread here: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/kafka-users/201611.mbox/%3cCALaekbxEs4GMp3Qvc4PJPHeanCtq4RSf1HZE7qf6OV=_jjDz1g@mail.gmail.com%3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/kafka-users/201611.mbox/%3cCALaekbxEs4GMp3Qvc4PJPHeanCtq4RSf1HZE7qf6OV=_jjDz1g@mail.gmail.com%3e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15678062" author="mjuarez" created="Fri, 18 Nov 2016 23:10:45 +0000"  >&lt;p&gt;Turns out I was wrong.  The deadlock we saw in our kafka cluster was because a single broker had been patched incorrectly, every other broker experienced no issues at all for roughly a week after we patched them.  After performing multiple tests, I&apos;d say we&apos;re 99% confident this patch will fix the deadlock issue we&apos;re seeing.&lt;/p&gt;</comment>
                            <comment id="15678587" author="becket_qin" created="Sat, 19 Nov 2016 04:36:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjuarez&quot; class=&quot;user-hover&quot; rel=&quot;mjuarez&quot;&gt;mjuarez&lt;/a&gt; Thanks for the update. Good to know. We are still working on the patch, though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15684271" author="mjuarez" created="Mon, 21 Nov 2016 18:06:24 +0000"  >&lt;p&gt;I&apos;ve been running the ConsumerBounceTest, both with and without the patch multiple times, but the test always succeeds for me.  &lt;/p&gt;

&lt;p&gt;How were you able to trigger the deadlock on this test?&lt;/p&gt;</comment>
                            <comment id="15709959" author="githubbot" created="Wed, 30 Nov 2016 22:09:50 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;: Fix deadlock in Watchers by calling tryComplete without any locks&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;-linked-queue&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2195.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2195.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2195&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 562f637d1caac547f059390f136eac4015cc734d&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2016-11-29T01:12:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3994&quot; title=&quot;Deadlock between consumer heartbeat expiration and offset commit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3994&quot;&gt;&lt;del&gt;KAFKA-3994&lt;/del&gt;&lt;/a&gt;: Fix deadlock in Watchers by calling tryComplete without the lock&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15709975" author="githubbot" created="Wed, 30 Nov 2016 22:16:10 +0000"  >&lt;p&gt;Github user hachikuji closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1738&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15723075" author="githubbot" created="Mon, 5 Dec 2016 19:12:56 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2195&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13025080">KAFKA-4478</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13029411">KAFKA-4562</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13020187">KAFKA-4399</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31j5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>