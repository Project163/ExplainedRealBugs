<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:58:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4529] tombstone may be removed earlier than it should</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4529</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As part of KIP-33, we introduced a regression on how tombstone is removed in a compacted topic. We want to delay the removal of a tombstone to avoid the case that a reader first reads a non-tombstone message on a key and then doesn&apos;t see the tombstone for the key because it&apos;s deleted too quickly. So, a tombstone is supposed to only be removed from a compacted topic after the tombstone is part of the cleaned portion of the log after delete.retention.ms.&lt;/p&gt;

&lt;p&gt;Before KIP-33, deleteHorizonMs in LogCleaner is calculated based on the last modified time, which is monotonically increasing from old to new segments. With KIP-33, deleteHorizonMs is calculated based on the message timestamp, which is not necessarily monotonically increasing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13027662">KAFKA-4529</key>
            <summary>tombstone may be removed earlier than it should</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="becket_qin">Jiangjie Qin</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Dec 2016 03:09:14 +0000</created>
                <updated>Mon, 26 Dec 2016 02:55:56 +0000</updated>
                            <resolved>Thu, 15 Dec 2016 18:05:59 +0000</resolved>
                                    <version>0.10.1.0</version>
                                    <fixVersion>0.10.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15743987" author="junrao" created="Tue, 13 Dec 2016 03:11:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;, do you think you have time to fix this issue? The easiest thing is to calculate deleteHorizonMs in the old way based on the last modified time of the segment?&lt;/p&gt;</comment>
                            <comment id="15744529" author="becket_qin" created="Tue, 13 Dec 2016 08:19:11 +0000"  >&lt;p&gt;Sure, I&apos;ll submit a patch.&lt;/p&gt;</comment>
                            <comment id="15745956" author="githubbot" created="Tue, 13 Dec 2016 19:03:51 +0000"  >&lt;p&gt;GitHub user becketqin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2251&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;; Fix the issue that tombstone can be deleted too early.&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/becketqin/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/becketqin/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2251.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2251.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2251&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 42f284bf0c1897899b4d620d18de9f66f65617f3&lt;br/&gt;
Author: Jiangjie Qin &amp;lt;becket.qin@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-13T19:02:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;; Fix the issue that tombstone can be deleted too early.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15748966" author="junrao" created="Wed, 14 Dec 2016 17:50:51 +0000"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;&apos;s patch to 0.10.1 branch. Leaving the jira open until trunk is fixed.&lt;/p&gt;</comment>
                            <comment id="15750478" author="githubbot" created="Thu, 15 Dec 2016 05:55:52 +0000"  >&lt;p&gt;GitHub user becketqin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;; LogCleaner should not delete the tombstone too early.&lt;/p&gt;

&lt;p&gt;    cc @junrao &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/becketqin/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/becketqin/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;-trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2260.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2260.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2260&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 681613bb7acd2df2a3abd1519dab1272a5b3c207&lt;br/&gt;
Author: Jiangjie Qin &amp;lt;becket.qin@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-15T05:53:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4529&quot; title=&quot;tombstone may be removed earlier than it should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4529&quot;&gt;&lt;del&gt;KAFKA-4529&lt;/del&gt;&lt;/a&gt;; LogCleaner should not delete the tombstone too early.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15752054" author="guozhang" created="Thu, 15 Dec 2016 18:05:59 +0000"  >&lt;p&gt;Marked as fixed for the 0.10.1.1 release process.&lt;/p&gt;</comment>
                            <comment id="15752230" author="githubbot" created="Thu, 15 Dec 2016 19:15:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2260&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15777443" author="githubbot" created="Mon, 26 Dec 2016 02:55:56 +0000"  >&lt;p&gt;Github user becketqin closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2251&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37inb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>