<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:43:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-19561] Request Timeout During SASL Reauthentication Due to Missed OP_WRITE  interest set </title>
                <link>https://issues.apache.org/jira/browse/KAFKA-19561</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We&apos;ve observed request timeouts occurring during SASL reauthentication, and analysis suggests the issue is caused by a race condition between request handling and SASL reauthentication on the broker side. Here&#8217;s the sequence:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Client sends a request (Req1) to the broker.&lt;/li&gt;
	&lt;li&gt;Client initiates SASL reauthentication.&lt;/li&gt;
	&lt;li&gt;Broker receives Req1.&lt;/li&gt;
	&lt;li&gt;Broker also begins SASL reauthentication.&lt;/li&gt;
	&lt;li&gt;While reauth is in progress:
	&lt;ul&gt;
		&lt;li&gt;Broker completes processing of Req1 and prepares a response (Res1).&lt;/li&gt;
		&lt;li&gt;Res1 is queued via KafkaChannel.send().&lt;/li&gt;
		&lt;li&gt;Broker sets SelectionKey.OP_WRITE to indicate write readiness.&lt;/li&gt;
		&lt;li&gt;However, Selector.attemptWrite() does not proceed because:
		&lt;ul&gt;
			&lt;li&gt;channel.hasSend() is true, but&lt;/li&gt;
			&lt;li&gt;channel.ready() is false (reauth is still in progress).&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Once reauthentication completes: Broker removes SelectionKey.OP_WRITE.&lt;/li&gt;
	&lt;li&gt;At this point:
	&lt;ul&gt;
		&lt;li&gt;channel.hasSend() and channel.ready() are now true,&lt;/li&gt;
		&lt;li&gt;But key.isWritable() is false, so the response (Res1) is never sent.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;The response remains stuck in the send buffer. Client eventually hits a request timeout.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The fix is to set write readiness using SelectionKey.OP_WRITE at the end of Step 6. This is similar to &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/security/authenticator/SaslClientAuthenticator.java#L422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;what we do on client side&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13624941">KAFKA-19561</key>
            <summary>Request Timeout During SASL Reauthentication Due to Missed OP_WRITE  interest set </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="omkreddy">Manikumar</assignee>
                                    <reporter username="omkreddy">Manikumar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jul 2025 19:01:14 +0000</created>
                <updated>Tue, 11 Nov 2025 16:18:15 +0000</updated>
                                                            <fixVersion>3.9.2</fixVersion>
                    <fixVersion>4.2.0</fixVersion>
                    <fixVersion>4.1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="18037487" author="JIRAUSER300229" created="Tue, 11 Nov 2025 15:32:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt;, the PRs are merged to trunk and 3.9 branch. Can we mark the issue as resolved? Thank you.&lt;/p&gt;

&lt;p&gt;3.9 commit: &lt;a href=&quot;https://github.com/apache/kafka/commit/d1a9255d4cba86541d0993c1464476fdf298a6c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/d1a9255d4cba86541d0993c1464476fdf298a6c1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18037496" author="omkreddy" created="Tue, 11 Nov 2025 16:18:15 +0000"  >&lt;p&gt;Hi, I&#8217;m waiting for the 4.1.1 release to be completed, so that I can merge the changes into the 4.1 branch as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 hour ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1x0ds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>