<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:09:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6592] NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6592</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When reading streams app&apos;s output topic with&#160;WindowedDeserializer deserilizer using kafka-console-consumer.sh,&#160;NullPointerException was thrown due to the fact that the inner deserializer was not initialized since there is no place in ConsoleConsumer to set this class.&lt;/p&gt;

&lt;p&gt;Complete stack trace is shown below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-02-26 14:56:04,736] ERROR Unknown error when running consumer:&#160; (kafka.tools.ConsoleConsumer$)

java.lang.NullPointerException

at org.apache.kafka.streams.kstream.internals.WindowedDeserializer.deserialize(WindowedDeserializer.java:89)

at org.apache.kafka.streams.kstream.internals.WindowedDeserializer.deserialize(WindowedDeserializer.java:35)

at kafka.tools.DefaultMessageFormatter.$anonfun$writeTo$2(ConsoleConsumer.scala:544)

at scala.Option.map(Option.scala:146)

at kafka.tools.DefaultMessageFormatter.write$1(ConsoleConsumer.scala:545)

at kafka.tools.DefaultMessageFormatter.writeTo(ConsoleConsumer.scala:560)

at kafka.tools.ConsoleConsumer$.process(ConsoleConsumer.scala:147)

at kafka.tools.ConsoleConsumer$.run(ConsoleConsumer.scala:84)

at kafka.tools.ConsoleConsumer$.main(ConsoleConsumer.scala:54)

at kafka.tools.ConsoleConsumer.main(ConsoleConsumer.scala)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13140847">KAFKA-6592</key>
            <summary>NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="huxi_2b">huxihx</assignee>
                                    <reporter username="huxi_2b">huxihx</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Feb 2018 07:07:18 +0000</created>
                <updated>Fri, 1 Mar 2019 21:53:24 +0000</updated>
                            <resolved>Fri, 1 Mar 2019 21:53:24 +0000</resolved>
                                    <version>1.0.0</version>
                                                    <component>streams</component>
                    <component>tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16376459" author="githubbot" created="Mon, 26 Feb 2018 07:13:11 +0000"  >&lt;p&gt;huxihx opened a new pull request #4620: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: ConsoleConsumer should support specifying inner deserializers&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4620&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   For those deserializers with inner deserializer such as WindowedDeserializer, user cannot directly specify the underlying inner class and NullPointerException would be thrown.&lt;/p&gt;

&lt;p&gt;   This patch adds two new properties named `key.deserializer.inner.class` and `value.deserializer.inner.class`.&lt;/p&gt;

&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16377255" author="mjsax" created="Mon, 26 Feb 2018 17:46:54 +0000"  >&lt;p&gt;Did you try to specify the inner deserializer using &lt;tt&gt;--consumer-property&lt;/tt&gt;&#160;?&lt;/p&gt;</comment>
                            <comment id="16383073" author="huxi_2b" created="Fri, 2 Mar 2018 02:57:59 +0000"  >&lt;p&gt;Seems it&apos;s a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4831&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;KAFKA-4831&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16394724" author="githubbot" created="Mon, 12 Mar 2018 01:04:57 +0000"  >&lt;p&gt;huxihx closed pull request #4620: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: ConsoleConsumer should support specifying inner deserializers&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4620&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
index 7d2d3710157..91eaf31aa0e 100755&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
@@ -330,6 +330,14 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
       .withRequiredArg&lt;br/&gt;
       .describedAs(&quot;deserializer for values&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+    val innerKeyDeserializerOpt = parser.accepts(&quot;key.deserializer.inner.class&quot;)&lt;br/&gt;
+      .withRequiredArg&lt;br/&gt;
+      .describedAs(&quot;inner deserializer for key&quot;)&lt;br/&gt;
+      .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+    val innerValueDeserializerOpt = parser.accepts(&quot;value.deserializer.inner.class&quot;)&lt;br/&gt;
+      .withRequiredArg&lt;br/&gt;
+      .describedAs(&quot;inner deserializer for values&quot;)&lt;br/&gt;
+      .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
     val enableSystestEventsLoggingOpt = parser.accepts(&quot;enable-systest-events&quot;,&lt;br/&gt;
                                                        &quot;Log lifecycle events of the consumer in addition to logging consumed &quot; +&lt;br/&gt;
                                                        &quot;messages. (This is specific for system tests.)&quot;)&lt;br/&gt;
@@ -374,6 +382,8 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     val bootstrapServer = options.valueOf(bootstrapServerOpt)&lt;br/&gt;
     val keyDeserializer = options.valueOf(keyDeserializerOpt)&lt;br/&gt;
     val valueDeserializer = options.valueOf(valueDeserializerOpt)&lt;br/&gt;
+    val innerKeyDeserializer = options.valueOf(innerKeyDeserializerOpt)&lt;br/&gt;
+    val innerValueDeserializer = options.valueOf(innerValueDeserializerOpt)&lt;br/&gt;
     val isolationLevel = options.valueOf(isolationLevelOpt).toString&lt;br/&gt;
     val formatter: MessageFormatter = messageFormatterClass.newInstance().asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;MessageFormatter&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;@@ -383,6 +393,12 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     if (valueDeserializer != null &amp;amp;&amp;amp; !valueDeserializer.isEmpty) &lt;/p&gt;
{
       formatterArgs.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, valueDeserializer)
     }
&lt;p&gt;+    if (innerKeyDeserializer != null &amp;amp;&amp;amp; !innerKeyDeserializer.isEmpty) &lt;/p&gt;
{
+      formatterArgs.setProperty(&quot;key.deserializer.inner.class&quot;, innerKeyDeserializer)
+    }
&lt;p&gt;+    if (innerValueDeserializer != null &amp;amp;&amp;amp; !innerValueDeserializer.isEmpty) &lt;/p&gt;
{
+      formatterArgs.setProperty(&quot;value.deserializer.inner.class&quot;, innerValueDeserializer)
+    }
&lt;p&gt;     formatter.init(formatterArgs)&lt;/p&gt;

&lt;p&gt;     if (useOldConsumer) {&lt;br/&gt;
@@ -523,11 +539,19 @@ class DefaultMessageFormatter extends MessageFormatter {&lt;br/&gt;
     if (props.containsKey(&quot;line.separator&quot;))&lt;br/&gt;
       lineSeparator = props.getProperty(&quot;line.separator&quot;).getBytes(StandardCharsets.UTF_8)&lt;br/&gt;
     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (props.containsKey(&quot;key.deserializer&quot;))&lt;br/&gt;
+    if (props.containsKey(&quot;key.deserializer&quot;)) 
{
       keyDeserializer = Some(Class.forName(props.getProperty(&quot;key.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
+      // Instantiate the inner key class if `key.deserializer.inner.class` is specified
+      if (props.containsKey(&quot;key.deserializer.inner.class&quot;))
+        keyDeserializer.get.configure(Map(&quot;key.deserializer.inner.class&quot; -&amp;gt; props.get(&quot;key.deserializer.inner.class&quot;)).asJava, true)
+    }
&lt;p&gt;     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (props.containsKey(&quot;value.deserializer&quot;))&lt;br/&gt;
+    if (props.containsKey(&quot;value.deserializer&quot;)) 
{
       valueDeserializer = Some(Class.forName(props.getProperty(&quot;value.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
+      // Instantiate the inner value class if `value.deserializer.inner.class` is specified
+      if (props.containsKey(&quot;value.deserializer.inner.class&quot;))
+        valueDeserializer.get.configure(Map(&quot;value.deserializer.inner.class&quot; -&amp;gt; props.get(&quot;value.deserializer.inner.class&quot;)).asJava, false)
+    }
&lt;p&gt;   }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def writeTo(consumerRecord: ConsumerRecord[Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;, Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;], output: PrintStream) {&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16399675" author="guozhang" created="Thu, 15 Mar 2018 00:36:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huxi_2b&quot; class=&quot;user-hover&quot; rel=&quot;huxi_2b&quot;&gt;huxi_2b&lt;/a&gt; Are you still working on this JIRA now?? Please note that it is not a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;, as that JIRA does not cover console consumer and hence we still need to have a PR for this ticket.&lt;/p&gt;</comment>
                            <comment id="16420029" author="huxi_2b" created="Fri, 30 Mar 2018 01:08:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-265%3A+Make+Windowed+Serde+to+public+APIs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-265&lt;/a&gt; says:&lt;br/&gt;
`And in ConsoleConsumer class, add the new StreamsConfigs names into its options: DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS and DEFAULT_WINDOWED_VALUE_SERDE_INNER_CLASS. `&lt;/p&gt;

&lt;p&gt;That&apos;s why I thought this KIP would cover this jira. However, I did not find those added confis in `ConsoleConsumer`. Is it as designed? &lt;/p&gt;</comment>
                            <comment id="16420165" author="guozhang" created="Fri, 30 Mar 2018 05:26:26 +0000"  >&lt;p&gt;Yes, the KIP is only for proposing the changes, after the proposal has been accepted, we still need to implement that. Note the KIP includes two JIRAs, this one and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4831&quot; title=&quot;Extract WindowedSerde to public APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4831&quot;&gt;&lt;del&gt;KAFKA-4831&lt;/del&gt;&lt;/a&gt;. Now that since the KIP has been accepted, I was thinking you are going to implement the proposed changes for this ticket &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16420252" author="githubbot" created="Fri, 30 Mar 2018 07:26:45 +0000"  >&lt;p&gt;huxihx opened a new pull request #4797: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: ConsoleConsumer should support WindowedSerdes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4797&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6592&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Have Console consumer support TimeWindowedDeserializer/SessionWindowedDeserializer by adding new parameters `default.windowed.key.serde.inner` and `default.windowed.value.serde.inner`.&lt;/p&gt;

&lt;p&gt;   An example would be like this:&lt;br/&gt;
   `... --property value.deserializer=org.apache.kafka.common.serialization.StringDeserializer --property key.deserializer=org.apache.kafka.streams.kstream.TimeWindowedDeserializer --default.windowed.key.serde.inner org.apache.kafka.common.serialization.Serdes\$StringSerde&lt;br/&gt;
   `&lt;/p&gt;

&lt;p&gt;   When key/value.deserializer is not TimeWindowedDeserializer or SessionWindowedDeserializer, specifying `default.windowed.key.serde.inner` or `default.windowed.value.serde.inner` takes no effect.&lt;/p&gt;

&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16435886" author="githubbot" created="Thu, 12 Apr 2018 16:35:40 +0000"  >&lt;p&gt;guozhangwang closed pull request #4797: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: ConsoleConsumer should support WindowedSerdes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4797&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
index 24fa583f1bb..9df4fb42070 100755&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
@@ -37,6 +37,7 @@ import org.apache.kafka.common.record.TimestampType&lt;br/&gt;
 import org.apache.kafka.common.serialization.&lt;/p&gt;
{ByteArrayDeserializer, Deserializer}
&lt;p&gt; import org.apache.kafka.common.utils.Utils&lt;/p&gt;

&lt;p&gt;+import scala.collection.JavaConversions&lt;br/&gt;
 import scala.collection.JavaConverters._&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -45,6 +46,11 @@ import scala.collection.JavaConverters._&lt;br/&gt;
 object ConsoleConsumer extends Logging {&lt;/p&gt;

&lt;p&gt;   var messageCount = 0&lt;br/&gt;
+  // Keep same names with StreamConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS&lt;br/&gt;
+  // and StreamConfig.DEFAULT_WINDOWED_VALUE_SERDE_INNER_CLASS&lt;br/&gt;
+  // visible for testing&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;tools&amp;#93;&lt;/span&gt; val innerKeySerdeName = &quot;default.windowed.key.serde.inner&quot;&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;tools&amp;#93;&lt;/span&gt; val innerValueSerdeName = &quot;default.windowed.value.serde.inner&quot;&lt;/p&gt;

&lt;p&gt;   private val shutdownLatch = new CountDownLatch(1)&lt;/p&gt;

&lt;p&gt;@@ -291,7 +297,17 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
       .describedAs(&quot;class&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
       .defaultsTo(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;DefaultMessageFormatter&amp;#93;&lt;/span&gt;.getName)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val messageFormatterArgOpt = parser.accepts(&quot;property&quot;, &quot;The properties to initialize the message formatter.&quot;)&lt;br/&gt;
+    val messageFormatterArgOpt = parser.accepts(&quot;property&quot;,&lt;br/&gt;
+      &quot;The properties to initialize the message formatter. Default properties include:\n&quot; +&lt;br/&gt;
+        &quot;\tprint.timestamp=true|false\n&quot; +&lt;br/&gt;
+        &quot;\tprint.key=true|false\n&quot; +&lt;br/&gt;
+        &quot;\tprint.value=true|false\n&quot; +&lt;br/&gt;
+        &quot;\tkey.separator=&amp;lt;key.separator&amp;gt;\n&quot; +&lt;br/&gt;
+        &quot;\tline.separator=&amp;lt;line.separator&amp;gt;\n&quot; +&lt;br/&gt;
+        &quot;\tkey.deserializer=&amp;lt;key.deserializer&amp;gt;\n&quot; +&lt;br/&gt;
+        &quot;\tvalue.deserializer=&amp;lt;value.deserializer&amp;gt;\n&quot; +&lt;br/&gt;
+        &quot;\tdefault.windowed.key.serde.inner=&amp;lt;windowed.key.serde.inner&amp;gt;\n&quot; +&lt;br/&gt;
+        &quot;\tdefault.windowed.value.serde.inner=&amp;lt;windowed.value.serde.inner&amp;gt;&quot;)&lt;br/&gt;
       .withRequiredArg&lt;br/&gt;
       .describedAs(&quot;prop&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
@@ -328,6 +344,18 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
       .withRequiredArg&lt;br/&gt;
       .describedAs(&quot;deserializer for values&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+    val innerKeyDeserializerOpt = parser.accepts(innerKeySerdeName,&lt;br/&gt;
+      &quot;inner serde for key when windowed deserialzier is used; would be ignored otherwise. &quot; +&lt;br/&gt;
+        &quot;For example: org.apache.kafka.common.serialization.Serdes&lt;br class=&quot;atl-forced-newline&quot; /&gt;$StringSerde&quot;)&lt;br/&gt;
+      .withRequiredArg&lt;br/&gt;
+      .describedAs(&quot;inner serde for key&quot;)&lt;br/&gt;
+      .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+    val innerValueDeserializerOpt = parser.accepts(innerValueSerdeName,&lt;br/&gt;
+      &quot;inner serde for value when windowed deserialzier is used; would be ignored otherwise. &quot; +&lt;br/&gt;
+        &quot;For example: org.apache.kafka.common.serialization.Serdes&lt;br class=&quot;atl-forced-newline&quot; /&gt;$StringSerde&quot;)&lt;br/&gt;
+      .withRequiredArg&lt;br/&gt;
+      .describedAs(&quot;inner serde for values&quot;)&lt;br/&gt;
+      .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
     val enableSystestEventsLoggingOpt = parser.accepts(&quot;enable-systest-events&quot;,&lt;br/&gt;
                                                        &quot;Log lifecycle events of the consumer in addition to logging consumed &quot; +&lt;br/&gt;
                                                        &quot;messages. (This is specific for system tests.)&quot;)&lt;br/&gt;
@@ -372,6 +400,8 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     val bootstrapServer = options.valueOf(bootstrapServerOpt)&lt;br/&gt;
     val keyDeserializer = options.valueOf(keyDeserializerOpt)&lt;br/&gt;
     val valueDeserializer = options.valueOf(valueDeserializerOpt)&lt;br/&gt;
+    val innerKeyDeserializer = options.valueOf(innerKeyDeserializerOpt)&lt;br/&gt;
+    val innerValueDeserializer = options.valueOf(innerValueDeserializerOpt)&lt;br/&gt;
     val isolationLevel = options.valueOf(isolationLevelOpt).toString&lt;br/&gt;
     val formatter: MessageFormatter = messageFormatterClass.newInstance().asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;MessageFormatter&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -381,6 +411,13 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     if (valueDeserializer != null &amp;amp;&amp;amp; !valueDeserializer.isEmpty) &lt;/p&gt;
{
       formatterArgs.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, valueDeserializer)
     }
&lt;p&gt;+    if (innerKeyDeserializer != null &amp;amp;&amp;amp; !innerKeyDeserializer.isEmpty) &lt;/p&gt;
{
+      formatterArgs.setProperty(innerKeySerdeName, innerKeyDeserializer)
+    }
&lt;p&gt;+    if (innerValueDeserializer != null &amp;amp;&amp;amp; !innerValueDeserializer.isEmpty) &lt;/p&gt;
{
+      formatterArgs.setProperty(innerValueSerdeName, innerValueDeserializer)
+    }
&lt;p&gt;+&lt;br/&gt;
     formatter.init(formatterArgs)&lt;/p&gt;

&lt;p&gt;     if (useOldConsumer) {&lt;br/&gt;
@@ -521,11 +558,15 @@ class DefaultMessageFormatter extends MessageFormatter {&lt;br/&gt;
     if (props.containsKey(&quot;line.separator&quot;))&lt;br/&gt;
       lineSeparator = props.getProperty(&quot;line.separator&quot;).getBytes(StandardCharsets.UTF_8)&lt;br/&gt;
     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (props.containsKey(&quot;key.deserializer&quot;))&lt;br/&gt;
+    if (props.containsKey(&quot;key.deserializer&quot;)) 
{
       keyDeserializer = Some(Class.forName(props.getProperty(&quot;key.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
+      keyDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(props).asJava, true)
+    }
&lt;p&gt;     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (props.containsKey(&quot;value.deserializer&quot;))&lt;br/&gt;
+    if (props.containsKey(&quot;value.deserializer&quot;)) 
{
       valueDeserializer = Some(Class.forName(props.getProperty(&quot;value.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
+      valueDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(props).asJava, false)
+    }
&lt;p&gt;   }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def writeTo(consumerRecord: ConsumerRecord[Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;, Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;], output: PrintStream) {&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala b/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
index 9ae8b966ac0..f5195c3cf76 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
@@ -25,6 +25,7 @@ import kafka.utils.&lt;/p&gt;
{Exit, TestUtils}
&lt;p&gt; import org.apache.kafka.clients.consumer.&lt;/p&gt;
{ConsumerRecord, MockConsumer, OffsetResetStrategy}
&lt;p&gt; import org.apache.kafka.common.TopicPartition&lt;br/&gt;
 import org.apache.kafka.clients.consumer.ConsumerConfig&lt;br/&gt;
+import org.apache.kafka.common.serialization.ByteArrayDeserializer&lt;br/&gt;
 import org.easymock.EasyMock&lt;br/&gt;
 import org.junit.Assert._&lt;br/&gt;
 import org.junit.&lt;/p&gt;
{Before, Test}
&lt;p&gt;@@ -537,4 +538,22 @@ class ConsoleConsumerTest &lt;/p&gt;
{
 
     Exit.resetExitProcedure()
   }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testCustomPropertyShouldBePassedToConfigureMethod(): Unit = &lt;/p&gt;
{
+    val args = Array(
+      &quot;--bootstrap-server&quot;, &quot;localhost:9092&quot;,
+      &quot;--topic&quot;, &quot;test&quot;,
+      &quot;--property&quot;, &quot;print.key=true&quot;,
+      &quot;--property&quot;, &quot;key.deserializer=org.apache.kafka.common.serialization.ByteArrayDeserializer&quot;,
+      &quot;--&quot; + ConsoleConsumer.innerKeySerdeName, &quot;org.apache.kafka.common.serialization.Serdes$StringSerde&quot;,
+      &quot;--property&quot;, &quot;my-test1=abc&quot;
+    )
+    val config = new ConsoleConsumer.ConsumerConfig(args)
+    assertTrue(config.formatter.isInstanceOf[DefaultMessageFormatter])
+    val formatter = config.formatter.asInstanceOf[DefaultMessageFormatter]
+    assertTrue(formatter.keyDeserializer.get.isInstanceOf[ByteArrayDeserializer])
+    assertTrue(config.formatterArgs.containsKey(&quot;my-test1&quot;))
+    assertTrue(config.formatterArgs.containsKey(ConsoleConsumer.innerKeySerdeName))
+  }
&lt;p&gt; }&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
index 4527c19b471..fc673d0258e 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
@@ -16,12 +16,14 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.kafka.streams.integration;&lt;/p&gt;

&lt;p&gt;+import kafka.tools.ConsoleConsumer;&lt;br/&gt;
 import kafka.utils.MockTime;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.ConsumerConfig;&lt;br/&gt;
 import org.apache.kafka.common.serialization.Deserializer;&lt;br/&gt;
 import org.apache.kafka.common.serialization.IntegerDeserializer;&lt;br/&gt;
 import org.apache.kafka.common.serialization.IntegerSerializer;&lt;br/&gt;
 import org.apache.kafka.common.serialization.LongDeserializer;&lt;br/&gt;
+import org.apache.kafka.common.serialization.Serde;&lt;br/&gt;
 import org.apache.kafka.common.serialization.Serdes;&lt;br/&gt;
 import org.apache.kafka.common.serialization.StringDeserializer;&lt;br/&gt;
 import org.apache.kafka.common.serialization.StringSerializer;&lt;br/&gt;
@@ -43,10 +45,14 @@&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Produced;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Reducer;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Serialized;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.SessionWindowedDeserializer;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.SessionWindows;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.TimeWindowedDeserializer;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.TimeWindows;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Windowed;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.WindowedSerdes;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.internals.SessionWindow;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.internals.TimeWindow;&lt;br/&gt;
 import org.apache.kafka.streams.state.KeyValueIterator;&lt;br/&gt;
 import org.apache.kafka.streams.state.QueryableStoreTypes;&lt;br/&gt;
 import org.apache.kafka.streams.state.ReadOnlySessionStore;&lt;br/&gt;
@@ -60,14 +66,18 @@&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 import org.junit.experimental.categories.Category;&lt;/p&gt;

&lt;p&gt;+import java.io.ByteArrayOutputStream;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
+import java.io.PrintStream;&lt;br/&gt;
 import java.util.Arrays;&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
 import java.util.Comparator;&lt;br/&gt;
 import java.util.HashMap;&lt;br/&gt;
+import java.util.HashSet;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
 import java.util.Properties;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
 import java.util.concurrent.CountDownLatch;&lt;br/&gt;
 import java.util.concurrent.TimeUnit;&lt;/p&gt;

&lt;p&gt;@@ -75,6 +85,7 @@&lt;br/&gt;
 import static org.hamcrest.MatcherAssert.assertThat;&lt;br/&gt;
 import static org.hamcrest.core.Is.is;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;/p&gt;

&lt;p&gt; @Category(&lt;/p&gt;
{IntegrationTest.class}
&lt;p&gt;)&lt;br/&gt;
 public class KStreamAggregationIntegrationTest {&lt;br/&gt;
@@ -205,32 +216,36 @@ public void shouldReduceWindowed() throws Exception {&lt;br/&gt;
         produceMessages(secondBatchTimestamp);&lt;br/&gt;
         produceMessages(secondBatchTimestamp);&lt;/p&gt;

&lt;p&gt;+        Serde&amp;lt;Windowed&amp;lt;String&amp;gt;&amp;gt; windowedSerde = WindowedSerdes.timeWindowedSerdeFrom(String.class);&lt;br/&gt;
         groupedStream&lt;br/&gt;
                 .windowedBy(TimeWindows.of(500L))&lt;br/&gt;
                 .reduce(reducer)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.toStream(new KeyValueMapper&amp;lt;Windowed&amp;lt;String&amp;gt;, String, String&amp;gt;() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public String apply(final Windowed&amp;lt;String&amp;gt; windowedKey, final String value) 
{
-                        return windowedKey.key() + &quot;@&quot; + windowedKey.window().start();
-                    }&lt;br/&gt;
-                })&lt;br/&gt;
-            .to(outputTopic, Produced.with(Serdes.String(), Serdes.String()));&lt;br/&gt;
-&lt;br/&gt;
+                .toStream()&lt;br/&gt;
+                .to(outputTopic, Produced.with(windowedSerde, Serdes.String()));&lt;br/&gt;
 &lt;br/&gt;
         startStreams();&lt;br/&gt;
 &lt;br/&gt;
-        final List&amp;lt;KeyValue&amp;lt;String, String&amp;gt;&amp;gt; windowedOutput = receiveMessages(&lt;br/&gt;
-            new StringDeserializer(),&lt;br/&gt;
+        final List&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt;&amp;gt; windowedOutput = receiveMessages(&lt;br/&gt;
+            new TimeWindowedDeserializer&amp;lt;String&amp;gt;(),&lt;br/&gt;
             new StringDeserializer(),&lt;br/&gt;
+            String.class,&lt;br/&gt;
             15);&lt;br/&gt;
 &lt;br/&gt;
-        final Comparator&amp;lt;KeyValue&amp;lt;String, String&amp;gt;&amp;gt;&lt;br/&gt;
+        // read from ConsoleConsumer&lt;br/&gt;
+        String resultFromConsoleConsumer = readWindowedKeyedMessagesViaConsoleConsumer(&lt;br/&gt;
+                new TimeWindowedDeserializer&amp;lt;String&amp;gt;(),&lt;br/&gt;
+                new StringDeserializer(),&lt;br/&gt;
+                String.class,&lt;br/&gt;
+                15);&lt;br/&gt;
+&lt;br/&gt;
+        final Comparator&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt;&amp;gt;&lt;br/&gt;
             comparator =&lt;br/&gt;
-            new Comparator&amp;lt;KeyValue&amp;lt;String, String&amp;gt;&amp;gt;() {&lt;br/&gt;
+            new Comparator&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt;&amp;gt;() {&lt;br/&gt;
                 @Override&lt;br/&gt;
-                public int compare(final KeyValue&amp;lt;String, String&amp;gt; o1,&lt;br/&gt;
-                                   final KeyValue&amp;lt;String, String&amp;gt; o2) {&lt;br/&gt;
-                    return KStreamAggregationIntegrationTest.compare(o1, o2);&lt;br/&gt;
+                public int compare(final KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt; o1,&lt;br/&gt;
+                                   final KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt; o2) {
+                    final int keyComparison = o1.key.key().compareTo(o2.key.key());
+                    return keyComparison == 0 ? o1.value.compareTo(o2.value) : keyComparison;
                 }&lt;br/&gt;
             };&lt;br/&gt;
 &lt;br/&gt;
@@ -238,25 +253,36 @@ public int compare(final KeyValue&amp;lt;String, String&amp;gt; o1,&lt;br/&gt;
         final long firstBatchWindow = firstBatchTimestamp / 500 * 500;&lt;br/&gt;
         final long secondBatchWindow = secondBatchTimestamp / 500 * 500;&lt;br/&gt;
 &lt;br/&gt;
-        assertThat(windowedOutput, is(&lt;br/&gt;
-            Arrays.asList(&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + firstBatchWindow, &quot;A&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + secondBatchWindow, &quot;A&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + secondBatchWindow, &quot;A:A&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + firstBatchWindow, &quot;B&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + secondBatchWindow, &quot;B&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + secondBatchWindow, &quot;B:B&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + firstBatchWindow, &quot;C&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + secondBatchWindow, &quot;C&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + secondBatchWindow, &quot;C:C&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + firstBatchWindow, &quot;D&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + secondBatchWindow, &quot;D&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + secondBatchWindow, &quot;D&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + firstBatchWindow, &quot;E&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + secondBatchWindow, &quot;E&quot;),&lt;br/&gt;
-                new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + secondBatchWindow, &quot;E:E&quot;)&lt;br/&gt;
-            )&lt;br/&gt;
-        ));&lt;br/&gt;
+        List&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt;&amp;gt; expectResult = Arrays.asList(&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(firstBatchWindow, Long.MAX_VALUE)), &quot;A&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;A&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;A:A&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(firstBatchWindow, Long.MAX_VALUE)), &quot;B&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;B&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;B:B&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(firstBatchWindow, Long.MAX_VALUE)), &quot;C&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;C&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;C:C&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(firstBatchWindow, Long.MAX_VALUE)), &quot;D&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;D&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;D&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(firstBatchWindow, Long.MAX_VALUE)), &quot;E&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;E&quot;),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(secondBatchWindow, Long.MAX_VALUE)), &quot;E:E&quot;)&lt;br/&gt;
+        );&lt;br/&gt;
+        assertThat(windowedOutput, is(expectResult));&lt;br/&gt;
+&lt;br/&gt;
+        Set&amp;lt;String&amp;gt; expectResultString = new HashSet&amp;lt;&amp;gt;(expectResult.size());&lt;br/&gt;
+        for (KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, String&amp;gt; eachRecord: expectResult) {
+            expectResultString.add(eachRecord.toString());
+        }&lt;br/&gt;
+&lt;br/&gt;
+        // check every message is contained in the expect result&lt;br/&gt;
+        String[] allRecords = resultFromConsoleConsumer.split(&quot;\n&quot;);&lt;br/&gt;
+        for (String record: allRecords) {
+            record = &quot;KeyValue(&quot; + record + &quot;)&quot;;
+            assertTrue(expectResultString.contains(record));
+        }&lt;br/&gt;
     }&lt;br/&gt;
 &lt;br/&gt;
     @SuppressWarnings(&quot;deprecation&quot;)&lt;br/&gt;
@@ -309,34 +335,39 @@ public void shouldAggregateWindowed() throws Exception {&lt;br/&gt;
         produceMessages(secondTimestamp);&lt;br/&gt;
         produceMessages(secondTimestamp);&lt;br/&gt;
 &lt;br/&gt;
+        Serde&amp;lt;Windowed&amp;lt;String&amp;gt;&amp;gt; windowedSerde = WindowedSerdes.timeWindowedSerdeFrom(String.class);&lt;br/&gt;
         groupedStream.windowedBy(TimeWindows.of(500L))&lt;br/&gt;
                 .aggregate(&lt;br/&gt;
                         initializer,&lt;br/&gt;
                         aggregator,&lt;br/&gt;
                         Materialized.&amp;lt;String, Integer, WindowStore&amp;lt;Bytes, byte[]&amp;gt;&amp;gt;with(null, Serdes.Integer())&lt;br/&gt;
                 )&lt;br/&gt;
-                .toStream(new KeyValueMapper&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer, String&amp;gt;() {&lt;br/&gt;
-                    @Override&lt;br/&gt;
-                    public String apply(final Windowed&amp;lt;String&amp;gt; windowedKey, final Integer value) {-                        return windowedKey.key() + &quot;@&quot; + windowedKey.window().start();-                    }&lt;/li&gt;
	&lt;li&gt;})&lt;/li&gt;
	&lt;li&gt;.to(outputTopic, Produced.with(Serdes.String(), Serdes.Integer()));&lt;br/&gt;
+                .toStream()&lt;br/&gt;
+                .to(outputTopic, Produced.with(windowedSerde, Serdes.Integer()));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         startStreams();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final List&amp;lt;KeyValue&amp;lt;String, Integer&amp;gt;&amp;gt; windowedMessages = receiveMessages(&lt;/li&gt;
	&lt;li&gt;new StringDeserializer(),&lt;br/&gt;
+        final List&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt;&amp;gt; windowedMessages = receiveMessages(&lt;br/&gt;
+            new TimeWindowedDeserializer&amp;lt;String&amp;gt;(),&lt;br/&gt;
             new IntegerDeserializer(),&lt;br/&gt;
+            String.class,&lt;br/&gt;
             15);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final Comparator&amp;lt;KeyValue&amp;lt;String, Integer&amp;gt;&amp;gt;&lt;br/&gt;
+        // read from ConsoleConsumer&lt;br/&gt;
+        String resultFromConsoleConsumer = readWindowedKeyedMessagesViaConsoleConsumer(&lt;br/&gt;
+                new TimeWindowedDeserializer&amp;lt;String&amp;gt;(),&lt;br/&gt;
+                new IntegerDeserializer(),&lt;br/&gt;
+                String.class,&lt;br/&gt;
+                15);&lt;br/&gt;
+&lt;br/&gt;
+        final Comparator&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt;&amp;gt;&lt;br/&gt;
             comparator =&lt;/li&gt;
	&lt;li&gt;new Comparator&amp;lt;KeyValue&amp;lt;String, Integer&amp;gt;&amp;gt;() {&lt;br/&gt;
+            new Comparator&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt;&amp;gt;() {&lt;br/&gt;
                 @Override&lt;/li&gt;
	&lt;li&gt;public int compare(final KeyValue&amp;lt;String, Integer&amp;gt; o1,&lt;/li&gt;
	&lt;li&gt;final KeyValue&amp;lt;String, Integer&amp;gt; o2) {&lt;/li&gt;
	&lt;li&gt;return KStreamAggregationIntegrationTest.compare(o1, o2);&lt;br/&gt;
+                public int compare(final KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt; o1,&lt;br/&gt;
+                                   final KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt; o2) 
{
+                    final int keyComparison = o1.key.key().compareTo(o2.key.key());
+                    return keyComparison == 0 ? o1.value.compareTo(o2.value) : keyComparison;
                 }
&lt;p&gt;             };&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -345,24 +376,37 @@ public int compare(final KeyValue&amp;lt;String, Integer&amp;gt; o1,&lt;br/&gt;
         final long firstWindow = firstTimestamp / 500 * 500;&lt;br/&gt;
         final long secondWindow = secondTimestamp / 500 * 500;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assertThat(windowedMessages, is(&lt;/li&gt;
	&lt;li&gt;Arrays.asList(&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + firstWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + secondWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;A@&quot; + secondWindow, 2),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + firstWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + secondWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;B@&quot; + secondWindow, 2),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + firstWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + secondWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;C@&quot; + secondWindow, 2),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + firstWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + secondWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;D@&quot; + secondWindow, 2),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + firstWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + secondWindow, 1),&lt;/li&gt;
	&lt;li&gt;new KeyValue&amp;lt;&amp;gt;(&quot;E@&quot; + secondWindow, 2)&lt;/li&gt;
	&lt;li&gt;)));&lt;br/&gt;
+        List&amp;lt;KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt;&amp;gt; expectResult = Arrays.asList(&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(firstWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;A&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 2),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(firstWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;B&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 2),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(firstWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;C&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 2),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(firstWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;D&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 2),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(firstWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 1),&lt;br/&gt;
+                new KeyValue&amp;lt;&amp;gt;(new Windowed&amp;lt;&amp;gt;(&quot;E&quot;, new TimeWindow(secondWindow, Long.MAX_VALUE)), 2));&lt;br/&gt;
+&lt;br/&gt;
+        assertThat(windowedMessages, is(expectResult));&lt;br/&gt;
+&lt;br/&gt;
+        Set&amp;lt;String&amp;gt; expectResultString = new HashSet&amp;lt;&amp;gt;(expectResult.size());&lt;br/&gt;
+        for (KeyValue&amp;lt;Windowed&amp;lt;String&amp;gt;, Integer&amp;gt; eachRecord: expectResult) 
{
+            expectResultString.add(eachRecord.toString());
+        }
&lt;p&gt;+&lt;br/&gt;
+        // check every message is contained in the expect result&lt;br/&gt;
+        String[] allRecords = resultFromConsoleConsumer.split(&quot;\n&quot;);&lt;br/&gt;
+        for (String record: allRecords) &lt;/p&gt;
{
+            record = &quot;KeyValue(&quot; + record + &quot;)&quot;;
+            assertTrue(expectResultString.contains(record));
+        }
&lt;p&gt;+&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private void shouldCountHelper() throws Exception {&lt;br/&gt;
@@ -685,26 +729,66 @@ private void startStreams() &lt;/p&gt;
{
         kafkaStreams.start();
     }

&lt;p&gt;-&lt;br/&gt;
     private &amp;lt;K, V&amp;gt; List&amp;lt;KeyValue&amp;lt;K, V&amp;gt;&amp;gt; receiveMessages(final Deserializer&amp;lt;K&amp;gt;&lt;br/&gt;
                                                             keyDeserializer,&lt;br/&gt;
                                                         final Deserializer&amp;lt;V&amp;gt;&lt;br/&gt;
                                                             valueDeserializer,&lt;br/&gt;
                                                         final int numMessages)&lt;br/&gt;
         throws InterruptedException &lt;/p&gt;
{
+        return receiveMessages(keyDeserializer, valueDeserializer, null, numMessages);
+    }
&lt;p&gt;+&lt;br/&gt;
+    private &amp;lt;K, V&amp;gt; List&amp;lt;KeyValue&amp;lt;K, V&amp;gt;&amp;gt; receiveMessages(final Deserializer&amp;lt;K&amp;gt;&lt;br/&gt;
+                                                                keyDeserializer,&lt;br/&gt;
+                                                        final Deserializer&amp;lt;V&amp;gt;&lt;br/&gt;
+                                                                valueDeserializer,&lt;br/&gt;
+                                                        final Class innerClass,&lt;br/&gt;
+                                                        final int numMessages) throws InterruptedException {&lt;br/&gt;
         final Properties consumerProperties = new Properties();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;consumerProperties&lt;/li&gt;
	&lt;li&gt;.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers());&lt;br/&gt;
+        consumerProperties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers());&lt;br/&gt;
         consumerProperties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, &quot;kgroupedstream-test-&quot; + testNo);&lt;br/&gt;
         consumerProperties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;);&lt;br/&gt;
         consumerProperties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, keyDeserializer.getClass().getName());&lt;br/&gt;
         consumerProperties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, valueDeserializer.getClass().getName());&lt;br/&gt;
+        if (keyDeserializer instanceof TimeWindowedDeserializer || keyDeserializer instanceof SessionWindowedDeserializer) 
{
+            consumerProperties.setProperty(StreamsConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS,
+                    Serdes.serdeFrom(innerClass).getClass().getName());
+        }
&lt;p&gt;         return IntegrationTestUtils.waitUntilMinKeyValueRecordsReceived(&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;consumerProperties,&lt;/li&gt;
	&lt;li&gt;outputTopic,&lt;/li&gt;
	&lt;li&gt;numMessages,&lt;/li&gt;
	&lt;li&gt;60 * 1000);&lt;br/&gt;
-&lt;br/&gt;
+                consumerProperties,&lt;br/&gt;
+                outputTopic,&lt;br/&gt;
+                numMessages,&lt;br/&gt;
+                60 * 1000);&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    private &amp;lt;K, V&amp;gt; String readWindowedKeyedMessagesViaConsoleConsumer(final Deserializer&amp;lt;K&amp;gt; keyDeserializer,&lt;br/&gt;
+                                                  final Deserializer&amp;lt;V&amp;gt; valueDeserializer,&lt;br/&gt;
+                                                  final Class innerClass,&lt;br/&gt;
+                                                  final int numMessages) {&lt;br/&gt;
+        ByteArrayOutputStream newConsole = new ByteArrayOutputStream();&lt;br/&gt;
+        PrintStream originalStream = System.out;&lt;br/&gt;
+        try (PrintStream newStream = new PrintStream(newConsole)) {&lt;br/&gt;
+            System.setOut(newStream);&lt;br/&gt;
+&lt;br/&gt;
+            String keySeparator = &quot;, &quot;;&lt;br/&gt;
+            // manually construct the console consumer argument array&lt;br/&gt;
+            String[] args = new String[] &lt;/p&gt;
{
+                &quot;--bootstrap-server&quot;, CLUSTER.bootstrapServers(),
+                &quot;--from-beginning&quot;,
+                &quot;--property&quot;, &quot;print.key=true&quot;,
+                &quot;--topic&quot;, outputTopic,
+                &quot;--max-messages&quot;, String.valueOf(numMessages),
+                &quot;--property&quot;, &quot;key.deserializer=&quot; + keyDeserializer.getClass().getName(),
+                &quot;--property&quot;, &quot;value.deserializer=&quot; + valueDeserializer.getClass().getName(),
+                &quot;--property&quot;, &quot;key.separator=&quot; + keySeparator,
+                &quot;--&quot; + StreamsConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS, Serdes.serdeFrom(innerClass).getClass().getName()
+            }
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+            ConsoleConsumer.messageCount_$eq(0); //reset the message count&lt;br/&gt;
+            ConsoleConsumer.run(new ConsoleConsumer.ConsumerConfig(args));&lt;br/&gt;
+            newStream.flush();&lt;br/&gt;
+            System.setOut(originalStream);&lt;br/&gt;
+            return newConsole.toString();&lt;br/&gt;
+        }&lt;br/&gt;
+    }&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16436132" author="githubbot" created="Thu, 12 Apr 2018 18:46:35 +0000"  >&lt;p&gt;guozhangwang opened a new pull request #4864: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: Follow-up&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4864&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Do not require ConsoleConsumer to specify inner serde as s special property, but just a normal property of the message formatter.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16438962" author="githubbot" created="Mon, 16 Apr 2018 03:51:57 +0000"  >&lt;p&gt;guozhangwang closed pull request #4864: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6592&quot; title=&quot;NullPointerException thrown when executing ConsoleCosumer with deserializer set to `WindowedDeserializer`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6592&quot;&gt;&lt;del&gt;KAFKA-6592&lt;/del&gt;&lt;/a&gt;: Follow-up&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4864&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/clients/src/test/java/org/apache/kafka/test/MockDeserializer.java b/clients/src/test/java/org/apache/kafka/test/MockDeserializer.java&lt;br/&gt;
index 99551f718a9..ac2865e9bb8 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/test/MockDeserializer.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/test/MockDeserializer.java&lt;br/&gt;
@@ -31,6 +31,9 @@&lt;br/&gt;
     public static ClusterResource noClusterId = new ClusterResource(&quot;no_cluster_id&quot;);&lt;br/&gt;
     public static AtomicReference&amp;lt;ClusterResource&amp;gt; clusterIdBeforeDeserialize = new AtomicReference&amp;lt;&amp;gt;(noClusterId);&lt;/p&gt;

&lt;p&gt;+    public boolean isKey;&lt;br/&gt;
+    public Map&amp;lt;String, ?&amp;gt; configs;&lt;br/&gt;
+&lt;br/&gt;
     public static void resetStaticVariables() {&lt;br/&gt;
         initCount = new AtomicInteger(0);&lt;br/&gt;
         closeCount = new AtomicInteger(0);&lt;br/&gt;
@@ -44,6 +47,8 @@ public MockDeserializer() {&lt;/p&gt;

&lt;p&gt;     @Override&lt;br/&gt;
     public void configure(Map&amp;lt;String, ?&amp;gt; configs, boolean isKey) &lt;/p&gt;
{
+        this.configs = configs;
+        this.isKey = isKey;
     }

&lt;p&gt;     @Override&lt;br/&gt;
diff --git a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
index 9df4fb42070..5139324ec17 100755&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/tools/ConsoleConsumer.scala&lt;br/&gt;
@@ -19,8 +19,9 @@ package kafka.tools&lt;/p&gt;

&lt;p&gt; import java.io.PrintStream&lt;br/&gt;
 import java.nio.charset.StandardCharsets&lt;br/&gt;
+import java.util&lt;br/&gt;
 import java.util.concurrent.CountDownLatch&lt;br/&gt;
-import java.util.&lt;/p&gt;
{Locale, Properties, Random}
&lt;p&gt;+import java.util.&lt;/p&gt;
{Locale, Map, Properties, Random}

&lt;p&gt; import com.typesafe.scalalogging.LazyLogging&lt;br/&gt;
 import joptsimple._&lt;br/&gt;
@@ -46,11 +47,6 @@ import scala.collection.JavaConverters._&lt;br/&gt;
 object ConsoleConsumer extends Logging {&lt;/p&gt;

&lt;p&gt;   var messageCount = 0&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Keep same names with StreamConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS&lt;/li&gt;
	&lt;li&gt;// and StreamConfig.DEFAULT_WINDOWED_VALUE_SERDE_INNER_CLASS&lt;/li&gt;
	&lt;li&gt;// visible for testing&lt;/li&gt;
	&lt;li&gt;private&lt;span class=&quot;error&quot;&gt;&amp;#91;tools&amp;#93;&lt;/span&gt; val innerKeySerdeName = &quot;default.windowed.key.serde.inner&quot;&lt;/li&gt;
	&lt;li&gt;private&lt;span class=&quot;error&quot;&gt;&amp;#91;tools&amp;#93;&lt;/span&gt; val innerValueSerdeName = &quot;default.windowed.value.serde.inner&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   private val shutdownLatch = new CountDownLatch(1)&lt;/p&gt;

&lt;p&gt;@@ -306,8 +302,8 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
         &quot;\tline.separator=&amp;lt;line.separator&amp;gt;\n&quot; +&lt;br/&gt;
         &quot;\tkey.deserializer=&amp;lt;key.deserializer&amp;gt;\n&quot; +&lt;br/&gt;
         &quot;\tvalue.deserializer=&amp;lt;value.deserializer&amp;gt;\n&quot; +&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;\tdefault.windowed.key.serde.inner=&amp;lt;windowed.key.serde.inner&amp;gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;\tdefault.windowed.value.serde.inner=&amp;lt;windowed.value.serde.inner&amp;gt;&quot;)&lt;br/&gt;
+        &quot;\nUsers can also pass in customized properties for their formatter; more specifically, users &quot; +&lt;br/&gt;
+        &quot;can pass in properties keyed with \&apos;key.deserializer.\&apos; and \&apos;value.deserializer.\&apos; prefixes to configure their deserializers.&quot;)&lt;br/&gt;
       .withRequiredArg&lt;br/&gt;
       .describedAs(&quot;prop&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
@@ -344,18 +340,6 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
       .withRequiredArg&lt;br/&gt;
       .describedAs(&quot;deserializer for values&quot;)&lt;br/&gt;
       .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;/li&gt;
	&lt;li&gt;val innerKeyDeserializerOpt = parser.accepts(innerKeySerdeName,&lt;/li&gt;
	&lt;li&gt;&quot;inner serde for key when windowed deserialzier is used; would be ignored otherwise. &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;For example: org.apache.kafka.common.serialization.Serdes&lt;br class=&quot;atl-forced-newline&quot; /&gt;$StringSerde&quot;)&lt;/li&gt;
	&lt;li&gt;.withRequiredArg&lt;/li&gt;
	&lt;li&gt;.describedAs(&quot;inner serde for key&quot;)&lt;/li&gt;
	&lt;li&gt;.ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;/li&gt;
	&lt;li&gt;val innerValueDeserializerOpt = parser.accepts(innerValueSerdeName,&lt;/li&gt;
	&lt;li&gt;&quot;inner serde for value when windowed deserialzier is used; would be ignored otherwise. &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;For example: org.apache.kafka.common.serialization.Serdes&lt;br class=&quot;atl-forced-newline&quot; /&gt;$StringSerde&quot;)&lt;/li&gt;
	&lt;li&gt;.withRequiredArg&lt;/li&gt;
	&lt;li&gt;.describedAs(&quot;inner serde for values&quot;)&lt;/li&gt;
	&lt;li&gt;.ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
     val enableSystestEventsLoggingOpt = parser.accepts(&quot;enable-systest-events&quot;,&lt;br/&gt;
                                                        &quot;Log lifecycle events of the consumer in addition to logging consumed &quot; +&lt;br/&gt;
                                                        &quot;messages. (This is specific for system tests.)&quot;)&lt;br/&gt;
@@ -400,8 +384,6 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     val bootstrapServer = options.valueOf(bootstrapServerOpt)&lt;br/&gt;
     val keyDeserializer = options.valueOf(keyDeserializerOpt)&lt;br/&gt;
     val valueDeserializer = options.valueOf(valueDeserializerOpt)&lt;/li&gt;
	&lt;li&gt;val innerKeyDeserializer = options.valueOf(innerKeyDeserializerOpt)&lt;/li&gt;
	&lt;li&gt;val innerValueDeserializer = options.valueOf(innerValueDeserializerOpt)&lt;br/&gt;
     val isolationLevel = options.valueOf(isolationLevelOpt).toString&lt;br/&gt;
     val formatter: MessageFormatter = messageFormatterClass.newInstance().asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;MessageFormatter&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -411,12 +393,6 @@ object ConsoleConsumer extends Logging {&lt;br/&gt;
     if (valueDeserializer != null &amp;amp;&amp;amp; !valueDeserializer.isEmpty) &lt;/p&gt;
{
       formatterArgs.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, valueDeserializer)
     }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (innerKeyDeserializer != null &amp;amp;&amp;amp; !innerKeyDeserializer.isEmpty) 
{
-      formatterArgs.setProperty(innerKeySerdeName, innerKeyDeserializer)
-    }&lt;/li&gt;
	&lt;li&gt;if (innerValueDeserializer != null &amp;amp;&amp;amp; !innerValueDeserializer.isEmpty) 
{
-      formatterArgs.setProperty(innerValueSerdeName, innerValueDeserializer)
-    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     formatter.init(formatterArgs)&lt;/p&gt;

&lt;p&gt;@@ -560,15 +536,29 @@ class DefaultMessageFormatter extends MessageFormatter {&lt;br/&gt;
     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;br/&gt;
     if (props.containsKey(&quot;key.deserializer&quot;)) &lt;/p&gt;
{
       keyDeserializer = Some(Class.forName(props.getProperty(&quot;key.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
-      keyDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(props).asJava, true)
+      keyDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(stripWithPrefix(&quot;key.deserializer.&quot;, props)).asJava, true)
     }
&lt;p&gt;     // Note that `toString` will be called on the instance returned by `Deserializer.deserialize`&lt;br/&gt;
     if (props.containsKey(&quot;value.deserializer&quot;)) &lt;/p&gt;
{
       valueDeserializer = Some(Class.forName(props.getProperty(&quot;value.deserializer&quot;)).newInstance().asInstanceOf[Deserializer[_]])
-      valueDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(props).asJava, false)
+      valueDeserializer.get.configure(JavaConversions.propertiesAsScalaMap(stripWithPrefix(&quot;value.deserializer.&quot;, props)).asJava, false)
     }
&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;+  def stripWithPrefix(prefix: String, props: Properties): Properties = {&lt;br/&gt;
+    val newProps = new Properties()&lt;br/&gt;
+    import scala.collection.JavaConversions._&lt;br/&gt;
+    for (entry &amp;lt;- props) &lt;/p&gt;
{
+      val key: String = entry._1
+      val value: String = entry._2
+
+      if (key.startsWith(prefix) &amp;amp;&amp;amp; key.length &amp;gt; prefix.length)
+        newProps.put(key.substring(prefix.length), value)
+    }
&lt;p&gt;+&lt;br/&gt;
+    newProps&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
   def writeTo(consumerRecord: ConsumerRecord[Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;, Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;], output: PrintStream) {&lt;/p&gt;

&lt;p&gt;     def writeSeparator(columnSeparator: Boolean): Unit = {&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala b/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
index f5195c3cf76..6f465557d7b 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/tools/ConsoleConsumerTest.scala&lt;br/&gt;
@@ -25,7 +25,7 @@ import kafka.utils.&lt;/p&gt;
{Exit, TestUtils}
&lt;p&gt; import org.apache.kafka.clients.consumer.&lt;/p&gt;
{ConsumerRecord, MockConsumer, OffsetResetStrategy}
&lt;p&gt; import org.apache.kafka.common.TopicPartition&lt;br/&gt;
 import org.apache.kafka.clients.consumer.ConsumerConfig&lt;br/&gt;
-import org.apache.kafka.common.serialization.ByteArrayDeserializer&lt;br/&gt;
+import org.apache.kafka.test.MockDeserializer&lt;br/&gt;
 import org.easymock.EasyMock&lt;br/&gt;
 import org.junit.Assert._&lt;br/&gt;
 import org.junit.&lt;/p&gt;
{Before, Test}
&lt;p&gt;@@ -545,15 +545,17 @@ class ConsoleConsumerTest &lt;/p&gt;
{
       &quot;--bootstrap-server&quot;, &quot;localhost:9092&quot;,
       &quot;--topic&quot;, &quot;test&quot;,
       &quot;--property&quot;, &quot;print.key=true&quot;,
-      &quot;--property&quot;, &quot;key.deserializer=org.apache.kafka.common.serialization.ByteArrayDeserializer&quot;,
-      &quot;--&quot; + ConsoleConsumer.innerKeySerdeName, &quot;org.apache.kafka.common.serialization.Serdes$StringSerde&quot;,
-      &quot;--property&quot;, &quot;my-test1=abc&quot;
+      &quot;--property&quot;, &quot;key.deserializer=org.apache.kafka.test.MockDeserializer&quot;,
+      &quot;--property&quot;, &quot;key.deserializer.my-props=abc&quot;
     )
     val config = new ConsoleConsumer.ConsumerConfig(args)
     assertTrue(config.formatter.isInstanceOf[DefaultMessageFormatter])
+    assertTrue(config.formatterArgs.containsKey(&quot;key.deserializer.my-props&quot;))
     val formatter = config.formatter.asInstanceOf[DefaultMessageFormatter]
-    assertTrue(formatter.keyDeserializer.get.isInstanceOf[ByteArrayDeserializer])
-    assertTrue(config.formatterArgs.containsKey(&quot;my-test1&quot;))
-    assertTrue(config.formatterArgs.containsKey(ConsoleConsumer.innerKeySerdeName))
+    assertTrue(formatter.keyDeserializer.get.isInstanceOf[MockDeserializer])
+    assertEquals(1, formatter.keyDeserializer.get.asInstanceOf[MockDeserializer].configs.size)
+    assertEquals(&quot;abc&quot;, formatter.keyDeserializer.get.asInstanceOf[MockDeserializer].configs.get(&quot;my-props&quot;))
+    assertTrue(formatter.keyDeserializer.get.asInstanceOf[MockDeserializer].isKey)
   }
&lt;p&gt;+&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
index fc673d0258e..52b9ee80915 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
@@ -781,7 +781,7 @@ private void startStreams() &lt;/p&gt;
{
                 &quot;--property&quot;, &quot;key.deserializer=&quot; + keyDeserializer.getClass().getName(),
                 &quot;--property&quot;, &quot;value.deserializer=&quot; + valueDeserializer.getClass().getName(),
                 &quot;--property&quot;, &quot;key.separator=&quot; + keySeparator,
-                &quot;--&quot; + StreamsConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS, Serdes.serdeFrom(innerClass).getClass().getName()
+                &quot;--property&quot;, &quot;key.deserializer.&quot; + StreamsConfig.DEFAULT_WINDOWED_KEY_SERDE_INNER_CLASS + &quot;=&quot; + Serdes.serdeFrom(innerClass).getClass().getName()
             }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;             ConsoleConsumer.messageCount_$eq(0); //reset the message count&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16445120" author="huxi_2b" created="Fri, 20 Apr 2018 01:55:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;Can this Jira issue be closed safely?&lt;/p&gt;</comment>
                            <comment id="16445233" author="guozhang" created="Fri, 20 Apr 2018 03:31:14 +0000"  >&lt;p&gt;Thanks for the reminder!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="13047439">KAFKA-4831</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qkzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>