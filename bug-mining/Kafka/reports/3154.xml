<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:29:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9279] Silent data loss in Kafka producer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9279</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;It appears that it is possible for a producer.commitTransaction() call to succeed even if an individual producer.send() call has failed. The following code demonstrates the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.example.dataloss;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.charset.StandardCharsets;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Properties;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Random;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.kafka.clients.producer.KafkaProducer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.kafka.clients.producer.ProducerConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.kafka.clients.producer.ProducerRecord;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.kafka.common.serialization.ByteArraySerializer;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Properties producerProps = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (args.length != 2) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid command-line arguments&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(1);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bootstrapServer = args[0];
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic = args[1];

        producerProps.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServer);
        producerProps.setProperty(ProducerConfig.BATCH_SIZE_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;500000&quot;&lt;/span&gt;);
        producerProps.setProperty(ProducerConfig.LINGER_MS_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;);
        producerProps.setProperty(ProducerConfig.MAX_REQUEST_SIZE_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000000&quot;&lt;/span&gt;);
        producerProps.setProperty(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
        producerProps.setProperty(ProducerConfig.CLIENT_ID_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;dataloss_01&quot;&lt;/span&gt;);
        producerProps.setProperty(ProducerConfig.TRANSACTIONAL_ID_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;dataloss_01&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KafkaProducer&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt; producer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaProducer&amp;lt;&amp;gt;(producerProps, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArraySerializer(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArraySerializer())) {
            producer.initTransactions();
            producer.beginTransaction();

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Random random = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Random();
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] largePayload = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[2000000];
            random.nextBytes(largePayload);
            producer.send(
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProducerRecord&amp;lt;&amp;gt;(
                    topic,
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;large&quot;&lt;/span&gt;.getBytes(StandardCharsets.UTF_8),
                    largePayload
                ),
                (metadata, e) -&amp;gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO: Large payload succeeded&quot;&lt;/span&gt;);
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR: Large payload failed: %s\n&quot;&lt;/span&gt;, e.getMessage());
                    }
                }
            );

            producer.commitTransaction();
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Commit succeeded&quot;&lt;/span&gt;);

        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exception e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;FATAL ERROR: %s&quot;&lt;/span&gt;, e.getMessage());
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code prints the following output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR: Large payload failed: The message is 2000093 bytes when serialized which is larger than the maximum request size you have configured with the max.request.size configuration.
Commit succeeded&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13272743">KAFKA-9279</key>
            <summary>Silent data loss in Kafka producer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="AndrewRK">Andrew Klopper</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Dec 2019 12:38:10 +0000</created>
                <updated>Sat, 5 Aug 2023 04:47:06 +0000</updated>
                            <resolved>Wed, 26 Jan 2022 10:51:29 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>5</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16989729" author="mbarbon" created="Fri, 6 Dec 2019 12:46:07 +0000"  >&lt;p&gt;This is affecting out team as well, with client version 2.3.0.&lt;/p&gt;</comment>
                            <comment id="16989894" author="bchen225242" created="Fri, 6 Dec 2019 15:37:37 +0000"  >&lt;p&gt;Hey there, what&apos;s the expected behavior in this case? You want to fail the entire transaction if there is any send failure?&lt;/p&gt;</comment>
                            <comment id="16991513" author="andrewrk" created="Mon, 9 Dec 2019 11:42:26 +0000"  >&lt;p&gt;The transaction is supposed to fail if any of the individual sends fails, which is clearly stated in the &lt;a href=&quot;https://kafka.apache.org/23/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Kafka Producer documentation&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;When used as part of a transaction, it is not necessary to define a callback or check the result of the future in order to detect errors from&#160;&lt;tt&gt;send&lt;/tt&gt;. If any of the send calls failed with an irrecoverable error, the final&#160;&lt;a href=&quot;https://kafka.apache.org/23/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html#commitTransaction--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;commitTransaction()&lt;/tt&gt;&lt;/a&gt;&#160;call will fail and throw the exception from the last failed send. When this happens, your application should call&#160;&lt;a href=&quot;https://kafka.apache.org/23/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html#abortTransaction--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;abortTransaction()&lt;/tt&gt;&lt;/a&gt;&#160;to reset the state and continue to send data.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The examples on that page also do not check the result of the individual producer send calls that form part of a transaction, which further reinforces the idea that failing the transaction on any send failure is the expected behaviour.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="16991553" author="amironov" created="Mon, 9 Dec 2019 12:49:30 +0000"  >&lt;p&gt;I agree that this behaviour is unexpected and clearly breaks the transactional contract. See `commitTransaction` javadoc for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
* Commits the ongoing transaction. This method will flush any unsent records before actually committing the transaction.
*
* Further, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any of the {@link #send(ProducerRecord)} calls which were part of the transaction hit irrecoverable
* errors, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; the last received exception immediately and the transaction will not be committed.
* So all {@link #send(ProducerRecord)} calls in a transaction must succeed in order &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method to succeed.
...
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void commitTransaction() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ProducerFencedException {&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13320388">KAFKA-10334</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13544980">KAFKA-15259</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09ddk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>