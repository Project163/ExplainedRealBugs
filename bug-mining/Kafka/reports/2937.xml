<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:27:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9189] Shutdown is blocked if connection to Zookeeper is lost</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9189</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We are using Kafka and Zookeeper in Docker swarm stacks. When we undeploy a stack, sometimes Kafka doesn&apos;t shutdown properly and is finally killed by Docker (thus leaving potentially corrupted files).&lt;/p&gt;

&lt;p&gt;Here are the steps to reproduce (simple Docker, no swarm):&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
docker network create test
docker run -d --network test --name zk --rm zookeeper:3.5.6
docker run --network test --name kf --rm -e &lt;span class=&quot;code-quote&quot;&gt;&quot;KAFKA_ZOOKEEPER_CONNECT=zk:2181&quot;&lt;/span&gt; -e &lt;span class=&quot;code-quote&quot;&gt;&quot;KAFKA_ADVERTISED_LISTENERS=INSIDE:&lt;span class=&quot;code-comment&quot;&gt;//:9091&quot;&lt;/span&gt; -e &lt;span class=&quot;code-quote&quot;&gt;&quot;KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT&quot;&lt;/span&gt; -e &lt;span class=&quot;code-quote&quot;&gt;&quot;KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE&quot;&lt;/span&gt; confluentinc/cp-kafka:5.3.1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In another shell:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
docker stop zk
docker stop kf
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Linux, Docker 19.03.4</environment>
        <key id="13268371">KAFKA-9189</key>
            <summary>Shutdown is blocked if connection to Zookeeper is lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="bgranvea">Boris Granveaud</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Nov 2019 16:41:18 +0000</created>
                <updated>Fri, 19 Mar 2021 18:57:36 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 18:57:36 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17082642" author="david.mao" created="Mon, 13 Apr 2020 20:28:56 +0000"  >&lt;p&gt;also observed this issue, took a thread-dump and found that controlledShutdown() can block indefinitely in zkClient.getControllerId&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-shutdown-hook&quot;&lt;/span&gt; #24 prio=5 os_prio=0 cpu=9.96ms elapsed=184687.63s tid=0x00007f3b20786000 nid=0x4e69 waiting on condition [0x00007f3a8559a000]
 java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (parking)
 at jdk.internal.misc.Unsafe.park(java.base@11.0.5/Native Method)
 - parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &amp;lt;0x00000006884f6808&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
 at java.util.concurrent.locks.LockSupport.parkNanos(java.base@11.0.5/LockSupport.java:234)
 at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(java.base@11.0.5/AbstractQueuedSynchronizer.java:2123)
 at kafka.zookeeper.ZooKeeperClient.$anonfun$waitUntilConnected$3(ZooKeeperClient.scala:264)
 at kafka.zookeeper.ZooKeeperClient.waitUntilConnected(ZooKeeperClient.scala:258)
 at kafka.zookeeper.ZooKeeperClient.$anonfun$waitUntilConnected$1(ZooKeeperClient.scala:252)
 at kafka.zookeeper.ZooKeeperClient.waitUntilConnected(ZooKeeperClient.scala:252)
 at kafka.zk.KafkaZkClient.retryRequestsUntilConnected(KafkaZkClient.scala:1783)
 at kafka.zk.KafkaZkClient.retryRequestsUntilConnected(KafkaZkClient.scala:1753)
 at kafka.zk.KafkaZkClient.retryRequestUntilConnected(KafkaZkClient.scala:1748)
 at kafka.zk.KafkaZkClient.getControllerId(KafkaZkClient.scala:1119)
 at kafka.server.KafkaServer.doControlledShutdown$1(KafkaServer.scala:688)
 at kafka.server.KafkaServer.controlledShutdown(KafkaServer.scala:772)
 at kafka.server.KafkaServer.$anonfun$shutdown$2(KafkaServer.scala:794)
 at kafka.server.KafkaServer$$Lambda$1583/0x0000000840924c40.apply$mcV$sp(Unknown Source)
 at kafka.utils.CoreUtils$.swallow(CoreUtils.scala:68)
 at kafka.server.KafkaServer.shutdown(KafkaServer.scala:794)
 at kafka.server.KafkaServerStartable.shutdown(KafkaServerStartable.scala:54)
 at kafka.Kafka$.$anonfun$main$3(Kafka.scala:80)
 at kafka.Kafka$$$Lambda$172/0x00000008402a1440.apply$mcV$sp(Unknown Source)
 at kafka.utils.Exit$.$anonfun$addShutdownHook$1(Exit.scala:38)
 at kafka.Kafka$$$Lambda$173/0x00000008402a7840.run(Unknown Source)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(java.base@11.0.5/&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17304909" author="ijuma" created="Fri, 19 Mar 2021 13:45:37 +0000"  >&lt;p&gt;Discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=david.mao&quot; class=&quot;user-hover&quot; rel=&quot;david.mao&quot;&gt;david.mao&lt;/a&gt;&#160;offline and he said he would not have time to do this soon, so we agreed I could pick it up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08mew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>