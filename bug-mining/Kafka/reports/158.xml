<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-633] AdminTest.testShutdownBroker fails</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-633</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;0m[ [31merror &lt;span class=&quot;error&quot;&gt;&amp;#91;0m&amp;#93;&lt;/span&gt;  [0mTest Failed: testShutdownBroker(kafka.admin.AdminTest) [0m&lt;br/&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;2&amp;gt; but was:&amp;lt;3&amp;gt;&lt;br/&gt;
	at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
	at junit.framework.Assert.failNotEquals(Assert.java:277)&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:64)&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:195)&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:201)&lt;br/&gt;
	at kafka.admin.AdminTest.testShutdownBroker(AdminTest.scala:381)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:110)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:128)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:113)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:228)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:223)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:228)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:223)&lt;br/&gt;
	at org.scalatest.junit.JUnit3Suite.run(JUnit3Suite.scala:309)&lt;br/&gt;
	at org.scalatest.tools.ScalaTestFramework$ScalaTestRunner.run(ScalaTestFramework.scala:40)&lt;br/&gt;
	at sbt.TestRunner.run(TestFramework.scala:53)&lt;br/&gt;
	at sbt.TestRunner.runTest$1(TestFramework.scala:67)&lt;br/&gt;
	at sbt.TestRunner.run(TestFramework.scala:76)&lt;br/&gt;
	at sbt.TestFramework$$anonfun$10$$anonfun$apply$11.runTest$2(TestFramework.scala:194)&lt;br/&gt;
	at sbt.TestFramework$$anonfun$10$$anonfun$apply$11$$anonfun$apply$12.apply(TestFramework.scala:205)&lt;br/&gt;
	at sbt.TestFramework$$anonfun$10$$anonfun$apply$11$$anonfun$apply$12.apply(TestFramework.scala:205)&lt;br/&gt;
	at sbt.NamedTestTask.run(TestFramework.scala:92)&lt;br/&gt;
	at sbt.ScalaProject$$anonfun$sbt$ScalaProject$$toTask$1.apply(ScalaProject.scala:193)&lt;br/&gt;
	at sbt.ScalaProject$$anonfun$sbt$ScalaProject$$toTask$1.apply(ScalaProject.scala:193)&lt;br/&gt;
	at sbt.TaskManager$Task.invoke(TaskManager.scala:62)&lt;br/&gt;
	at sbt.impl.RunTask.doRun$1(RunTask.scala:77)&lt;br/&gt;
	at sbt.impl.RunTask.runTask(RunTask.scala:85)&lt;br/&gt;
	at sbt.impl.RunTask.sbt$impl$RunTask$$runIfNotRoot(RunTask.scala:60)&lt;br/&gt;
	at sbt.impl.RunTask$$anonfun$runTasksExceptRoot$2.apply(RunTask.scala:48)&lt;br/&gt;
	at sbt.impl.RunTask$$anonfun$runTasksExceptRoot$2.apply(RunTask.scala:48)&lt;br/&gt;
	at sbt.Distributor$Run$Worker$$anonfun$2.apply(ParallelRunner.scala:131)&lt;br/&gt;
	at sbt.Distributor$Run$Worker$$anonfun$2.apply(ParallelRunner.scala:131)&lt;br/&gt;
	at sbt.Control$.trapUnit(Control.scala:19)&lt;br/&gt;
	at sbt.Distributor$Run$Worker.run(ParallelRunner.scala:131)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12617740">KAFKA-633</key>
            <summary>AdminTest.testShutdownBroker fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jjkoshy">Joel Jacob Koshy</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Nov 2012 05:43:14 +0000</created>
                <updated>Fri, 7 Dec 2012 01:10:20 +0000</updated>
                            <resolved>Fri, 7 Dec 2012 01:09:42 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13505095" author="jkreps" created="Wed, 28 Nov 2012 00:27:32 +0000"  >&lt;p&gt;Another annoying thing is that after AdminTest runs you often see bazillions of these errors on stdout:&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:599)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1146)&lt;/p&gt;

&lt;p&gt;Not sure what the cause is, something in the test harness is not shutting down cleanly but I couldn&apos;t figure it out.&lt;/p&gt;</comment>
                            <comment id="13506858" author="nehanarkhede" created="Thu, 29 Nov 2012 22:04:55 +0000"  >&lt;p&gt;That happens due to the test failure. If the test fails, it doesn&apos;t close down the zookeeper connections leading to these errors. Once we fix the root cause, these will disappear&lt;/p&gt;</comment>
                            <comment id="13506889" author="jjkoshy" created="Thu, 29 Nov 2012 22:29:56 +0000"  >&lt;p&gt;I&apos;ll take a look into this.&lt;/p&gt;</comment>
                            <comment id="13506917" author="jkreps" created="Thu, 29 Nov 2012 23:06:10 +0000"  >&lt;p&gt;But that&apos;s a problem, no? Those test harnesses are supposed to clean up after themselves robustly--even if the test fails.&lt;/p&gt;</comment>
                            <comment id="13506934" author="jjkoshy" created="Thu, 29 Nov 2012 23:27:12 +0000"  >&lt;p&gt;Yes it&apos;s definitely annoying (apart from the test failure itself). I remember seeing something similar with 0.7 a while ago and might have a fix for it lying around.&lt;/p&gt;</comment>
                            <comment id="13525983" author="jjkoshy" created="Thu, 6 Dec 2012 23:06:13 +0000"  >&lt;p&gt;This is a timing issue that affects low-volume topics (and in this case an empty topic). The issue is that the leader that is being shut down receives a leaderAndIsrRequest informing it is no longer the leader and thus starts up a follower which starts issuing fetch requests to the new leader. We then shrink the ISR and send a StopReplicaRequest to the shutting down broker. However, the new leader upon receiving the fetch request expands the ISR again.&lt;/p&gt;

&lt;p&gt;The shutdown itself is working correctly in that the leader has been successfully moved. This patch fixes the assertion by checking the controller&apos;s cached ISR instead of ZooKeeper. The patch also fixes the annoying zookeeper-related messages if the test fails - the problem was that the brokers were not getting shut down and were trying to talk to the torn down zookeeper.&lt;/p&gt;

&lt;p&gt;I think it would be better to fix the corner case in a separate non-blocker jira. One possible approach would be to use the callback feature in the ControllerBrokerRequestBatch and wait until the StopReplicaRequest has been processed by the shutting down broker before shrinking the ISR; and there are probably other ways as well.&lt;/p&gt;</comment>
                            <comment id="13526028" author="junrao" created="Fri, 7 Dec 2012 00:00:58 +0000"  >&lt;p&gt;Thanks for the patch. +1.&lt;/p&gt;</comment>
                            <comment id="13526064" author="jjkoshy" created="Fri, 7 Dec 2012 01:10:20 +0000"  >&lt;p&gt;Checked into 0.8. Will file separate jira to protect the ISR from re-expansion.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12559761" name="KAFKA-633-v1.patch" size="4047" author="jjkoshy" created="Thu, 6 Dec 2012 23:06:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rsuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>