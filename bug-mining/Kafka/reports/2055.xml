<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:15:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7409] Validate topic configs prior to topic creation</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7409</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There are some validation checks that we do on startup when constructing the &lt;tt&gt;LogConfig&lt;/tt&gt; object using &lt;tt&gt;fromProps&lt;/tt&gt; which we do not verify on topic creation. The message format version check is one of them. An invalid value, once set, can prevent broker startup. We should make the validation consistent.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13185034">KAFKA-7409</key>
            <summary>Validate topic configs prior to topic creation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huxi_2b">huxihx</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2018 23:48:04 +0000</created>
                <updated>Fri, 28 Sep 2018 05:45:28 +0000</updated>
                            <resolved>Fri, 28 Sep 2018 05:40:19 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16631373" author="githubbot" created="Fri, 28 Sep 2018 05:39:48 +0000"  >&lt;p&gt;hachikuji closed pull request #5651: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7409&quot; title=&quot;Validate topic configs prior to topic creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7409&quot;&gt;&lt;del&gt;KAFKA-7409&lt;/del&gt;&lt;/a&gt;: Validate topic configs prior to topic creation&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5651&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5651&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/api/ApiVersion.scala b/core/src/main/scala/kafka/api/ApiVersion.scala&lt;br/&gt;
index b145adfa11f..bc3602bd69a 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/api/ApiVersion.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/api/ApiVersion.scala&lt;br/&gt;
@@ -17,6 +17,8 @@&lt;/p&gt;

&lt;p&gt; package kafka.api&lt;/p&gt;

&lt;p&gt;+import org.apache.kafka.common.config.ConfigDef.Validator&lt;br/&gt;
+import org.apache.kafka.common.config.ConfigException&lt;br/&gt;
 import org.apache.kafka.common.record.RecordVersion&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -267,3 +269,14 @@ case object KAFKA_2_1_IV1 extends DefaultApiVersion &lt;/p&gt;
{
   val recordVersion = RecordVersion.V2
   val id: Int = 18
 }
&lt;p&gt;+&lt;br/&gt;
+object ApiVersionValidator extends Validator {&lt;br/&gt;
+&lt;br/&gt;
+  override def ensureValid(name: String, value: Any): Unit = {&lt;br/&gt;
+    try &lt;/p&gt;
{
+      ApiVersion(value.toString)
+    }
&lt;p&gt; catch &lt;/p&gt;
{
+      case e: IllegalArgumentException =&amp;gt; throw new ConfigException(name, value.toString, e.getMessage)
+    }
&lt;p&gt;+  }&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/core/src/main/scala/kafka/log/LogConfig.scala b/core/src/main/scala/kafka/log/LogConfig.scala&lt;br/&gt;
index bd4768eda25..d872e09ed79 100755&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/log/LogConfig.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/log/LogConfig.scala&lt;br/&gt;
@@ -20,7 +20,7 @@ package kafka.log&lt;br/&gt;
 import java.util.&lt;/p&gt;
{Collections, Locale, Properties}

&lt;p&gt; import scala.collection.JavaConverters._&lt;br/&gt;
-import kafka.api.ApiVersion&lt;br/&gt;
+import kafka.api.&lt;/p&gt;
{ApiVersion, ApiVersionValidator}
&lt;p&gt; import kafka.message.BrokerCompressionCodec&lt;br/&gt;
 import kafka.server.&lt;/p&gt;
{KafkaConfig, ThrottledReplicaListValidator}
&lt;p&gt; import kafka.utils.Implicits._&lt;br/&gt;
@@ -256,7 +256,7 @@ object LogConfig {&lt;br/&gt;
         MEDIUM, CompressionTypeDoc, KafkaConfig.CompressionTypeProp)&lt;br/&gt;
       .define(PreAllocateEnableProp, BOOLEAN, Defaults.PreAllocateEnable, MEDIUM, PreAllocateEnableDoc,&lt;br/&gt;
         KafkaConfig.LogPreAllocateProp)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.define(MessageFormatVersionProp, STRING, Defaults.MessageFormatVersion, MEDIUM, MessageFormatVersionDoc,&lt;br/&gt;
+      .define(MessageFormatVersionProp, STRING, Defaults.MessageFormatVersion, ApiVersionValidator, MEDIUM, MessageFormatVersionDoc,&lt;br/&gt;
         KafkaConfig.LogMessageFormatVersionProp)&lt;br/&gt;
       .define(MessageTimestampTypeProp, STRING, Defaults.MessageTimestampType, in(&quot;CreateTime&quot;, &quot;LogAppendTime&quot;), MEDIUM, MessageTimestampTypeDoc,&lt;br/&gt;
         KafkaConfig.LogMessageTimestampTypeProp)&lt;br/&gt;
diff --git a/core/src/main/scala/kafka/server/AdminManager.scala b/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
index e9598e365ab..f765f51a89a 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
@@ -26,7 +26,7 @@ import kafka.utils._&lt;br/&gt;
 import kafka.zk.
{AdminZkClient, KafkaZkClient}
&lt;p&gt; import org.apache.kafka.clients.admin.NewPartitions&lt;br/&gt;
 import org.apache.kafka.common.config.&lt;/p&gt;
{AbstractConfig, ConfigDef, ConfigException, ConfigResource}
&lt;p&gt;-import org.apache.kafka.common.errors.&lt;/p&gt;
{ApiException, InvalidPartitionsException, InvalidReplicaAssignmentException, InvalidRequestException, ReassignmentInProgressException, UnknownTopicOrPartitionException}
&lt;p&gt;+import org.apache.kafka.common.errors.&lt;/p&gt;
{ApiException, InvalidPartitionsException, InvalidReplicaAssignmentException, InvalidRequestException, ReassignmentInProgressException, UnknownTopicOrPartitionException, InvalidConfigurationException}
&lt;p&gt; import org.apache.kafka.common.internals.Topic&lt;br/&gt;
 import org.apache.kafka.common.metrics.Metrics&lt;br/&gt;
 import org.apache.kafka.common.network.ListenerName&lt;br/&gt;
@@ -131,6 +131,9 @@ class AdminManager(val config: KafkaConfig,&lt;br/&gt;
         case e: ApiException =&amp;gt;&lt;br/&gt;
           info(s&quot;Error processing create topic request for topic $topic with arguments $arguments&quot;, e)&lt;br/&gt;
           CreatePartitionsMetadata(topic, Map(), ApiError.fromThrowable(e))&lt;br/&gt;
+        case e: ConfigException =&amp;gt;&lt;br/&gt;
+          info(s&quot;Error processing create topic request for topic $topic with arguments $arguments&quot;, e)&lt;br/&gt;
+          CreatePartitionsMetadata(topic, Map(), ApiError.fromThrowable(new InvalidConfigurationException(e.getMessage, e.getCause)))&lt;br/&gt;
         case e: Throwable =&amp;gt;&lt;br/&gt;
           error(s&quot;Error processing create topic request for topic $topic with arguments $arguments&quot;, e)&lt;br/&gt;
           CreatePartitionsMetadata(topic, Map(), ApiError.fromThrowable(e))&lt;br/&gt;
diff --git a/core/src/main/scala/kafka/server/KafkaConfig.scala b/core/src/main/scala/kafka/server/KafkaConfig.scala&lt;br/&gt;
index 1bc9707fa0b..a3a83273ea8 100755&lt;/p&gt;&lt;/li&gt;
			&lt;li&gt;a/core/src/main/scala/kafka/server/KafkaConfig.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/server/KafkaConfig.scala&lt;br/&gt;
@@ -20,7 +20,7 @@ package kafka.server&lt;br/&gt;
 import java.util&lt;br/&gt;
 import java.util.
{Collections, Properties}&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import kafka.api.&lt;/p&gt;
{ApiVersion, KAFKA_0_10_0_IV1}
&lt;p&gt;+import kafka.api.&lt;/p&gt;
{ApiVersion, ApiVersionValidator, KAFKA_0_10_0_IV1}
&lt;p&gt; import kafka.cluster.EndPoint&lt;br/&gt;
 import kafka.coordinator.group.OffsetConfig&lt;br/&gt;
 import kafka.coordinator.transaction.&lt;/p&gt;
{TransactionLog, TransactionStateManager}
&lt;p&gt;@@ -870,7 +870,7 @@ object KafkaConfig {&lt;br/&gt;
       .define(NumRecoveryThreadsPerDataDirProp, INT, Defaults.NumRecoveryThreadsPerDataDir, atLeast(1), HIGH, NumRecoveryThreadsPerDataDirDoc)&lt;br/&gt;
       .define(AutoCreateTopicsEnableProp, BOOLEAN, Defaults.AutoCreateTopicsEnable, HIGH, AutoCreateTopicsEnableDoc)&lt;br/&gt;
       .define(MinInSyncReplicasProp, INT, Defaults.MinInSyncReplicas, atLeast(1), HIGH, MinInSyncReplicasDoc)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.define(LogMessageFormatVersionProp, STRING, Defaults.LogMessageFormatVersion, MEDIUM, LogMessageFormatVersionDoc)&lt;br/&gt;
+      .define(LogMessageFormatVersionProp, STRING, Defaults.LogMessageFormatVersion, ApiVersionValidator, MEDIUM, LogMessageFormatVersionDoc)&lt;br/&gt;
       .define(LogMessageTimestampTypeProp, STRING, Defaults.LogMessageTimestampType, in(&quot;CreateTime&quot;, &quot;LogAppendTime&quot;), MEDIUM, LogMessageTimestampTypeDoc)&lt;br/&gt;
       .define(LogMessageTimestampDifferenceMaxMsProp, LONG, Defaults.LogMessageTimestampDifferenceMaxMs, MEDIUM, LogMessageTimestampDifferenceMaxMsDoc)&lt;br/&gt;
       .define(CreateTopicPolicyClassNameProp, CLASS, null, LOW, CreateTopicPolicyClassNameDoc)&lt;br/&gt;
@@ -898,7 +898,7 @@ object KafkaConfig {&lt;br/&gt;
       .define(LeaderImbalanceCheckIntervalSecondsProp, LONG, Defaults.LeaderImbalanceCheckIntervalSeconds, HIGH, LeaderImbalanceCheckIntervalSecondsDoc)&lt;br/&gt;
       .define(UncleanLeaderElectionEnableProp, BOOLEAN, Defaults.UncleanLeaderElectionEnable, HIGH, UncleanLeaderElectionEnableDoc)&lt;br/&gt;
       .define(InterBrokerSecurityProtocolProp, STRING, Defaults.InterBrokerSecurityProtocol, MEDIUM, InterBrokerSecurityProtocolDoc)&lt;/li&gt;
	&lt;li&gt;.define(InterBrokerProtocolVersionProp, STRING, Defaults.InterBrokerProtocolVersion, MEDIUM, InterBrokerProtocolVersionDoc)&lt;br/&gt;
+      .define(InterBrokerProtocolVersionProp, STRING, Defaults.InterBrokerProtocolVersion, ApiVersionValidator, MEDIUM, InterBrokerProtocolVersionDoc)&lt;br/&gt;
       .define(InterBrokerListenerNameProp, STRING, null, MEDIUM, InterBrokerListenerNameDoc)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       /** ********* Controlled shutdown configuration ***********/&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/admin/TopicCommandTest.scala b/core/src/test/scala/unit/kafka/admin/TopicCommandTest.scala&lt;br/&gt;
index 13f23e69b53..a469f8efe04 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/admin/TopicCommandTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/admin/TopicCommandTest.scala&lt;br/&gt;
@@ -26,6 +26,7 @@ import kafka.admin.TopicCommand.TopicCommandOptions&lt;br/&gt;
 import kafka.utils.ZkUtils.getDeleteTopicPath&lt;br/&gt;
 import org.apache.kafka.common.errors.TopicExistsException&lt;br/&gt;
 import org.apache.kafka.common.internals.Topic&lt;br/&gt;
+import org.apache.kafka.common.config.ConfigException&lt;/p&gt;

&lt;p&gt; class TopicCommandTest extends ZooKeeperTestHarness with Logging with RackAwareTest &lt;/p&gt;
{
 
@@ -240,6 +241,17 @@ class TopicCommandTest extends ZooKeeperTestHarness with Logging with RackAwareT
     }
&lt;p&gt; catch &lt;/p&gt;
{
       case _: Exception =&amp;gt; // topic creation should fail due to the invalid config
     }
&lt;p&gt;+&lt;br/&gt;
+    // try to create the topic with another invalid config&lt;br/&gt;
+    try &lt;/p&gt;
{
+      val createOpts = new TopicCommandOptions(
+        Array(&quot;--partitions&quot;, &quot;1&quot;, &quot;--replication-factor&quot;, &quot;1&quot;, &quot;--topic&quot;, &quot;test&quot;,
+          &quot;--config&quot;, &quot;message.format.version=boom&quot;))
+      TopicCommand.createTopic(zkClient, createOpts)
+      fail(&quot;Expected exception on invalid topic-level config.&quot;)
+    }
&lt;p&gt; catch &lt;/p&gt;
{
+      case _: ConfigException =&amp;gt; // topic creation should fail due to the invalid config value
+    }
&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;   @Test&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/server/CreateTopicsRequestTest.scala b/core/src/test/scala/unit/kafka/server/CreateTopicsRequestTest.scala&lt;br/&gt;
index 13a2d23a91c..47c1765b4ad 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/server/CreateTopicsRequestTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/server/CreateTopicsRequestTest.scala&lt;br/&gt;
@@ -71,6 +71,12 @@ class CreateTopicsRequestTest extends AbstractCreateTopicsRequestTest {&lt;br/&gt;
     val invalidConfig = Map(&quot;not.a.property&quot; -&amp;gt; &quot;error&quot;).asJava&lt;br/&gt;
     validateErrorCreateTopicsRequests(new CreateTopicsRequest.Builder(Map(&quot;error-config&quot; -&amp;gt; new CreateTopicsRequest.TopicDetails(1, 1.toShort, invalidConfig)).asJava, timeout).build(),&lt;br/&gt;
       Map(&quot;error-config&quot; -&amp;gt; error(Errors.INVALID_CONFIG)), checkErrorMessage = false)&lt;br/&gt;
+&lt;br/&gt;
+    val config = Map(&quot;message.format.version&quot; -&amp;gt; &quot;invalid-value&quot;).asJava&lt;br/&gt;
+    validateErrorCreateTopicsRequests(new CreateTopicsRequest.Builder(&lt;br/&gt;
+      Map(&quot;error-config-value&quot; -&amp;gt; new CreateTopicsRequest.TopicDetails(1, 1.toShort, config)).asJava, timeout).build(),&lt;br/&gt;
+      Map(&quot;error-config-value&quot; -&amp;gt; error(Errors.INVALID_CONFIG)), checkErrorMessage = false)&lt;br/&gt;
+&lt;br/&gt;
     val invalidAssignments = replicaAssignmentToJava(Map(0 -&amp;gt; List(0, 1), 1 -&amp;gt; List(0)))&lt;br/&gt;
     validateErrorCreateTopicsRequests(new CreateTopicsRequest.Builder(Map(&quot;error-assignment&quot; -&amp;gt; new CreateTopicsRequest.TopicDetails(invalidAssignments)).asJava, timeout).build(),&lt;br/&gt;
       Map(&quot;error-assignment&quot; -&amp;gt; error(Errors.INVALID_REPLICA_ASSIGNMENT)), checkErrorMessage = false)&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y2wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>