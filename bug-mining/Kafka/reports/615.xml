<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:42:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1757] Can not delete Topic index on Windows</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1757</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When running the Kafka 0.8.2-Beta (Scala 2.10) on Windows, an attempt to delete the Topic throwed an error:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;KafkaApi-1&amp;#93;&lt;/span&gt; error when handling request Name: StopReplicaRequest; Version: 0; CorrelationId: 38; ClientId: ; DeletePartitions: true; ControllerId: 0; ControllerEpoch: 3; Partitions: &lt;span class=&quot;error&quot;&gt;&amp;#91;test,0&amp;#93;&lt;/span&gt; (kafka.server.KafkaApis)&lt;br/&gt;
kafka.common.KafkaStorageException: Delete of index 00000000000000000000.index failed.&lt;br/&gt;
        at kafka.log.LogSegment.delete(LogSegment.scala:283)&lt;br/&gt;
        at kafka.log.Log$$anonfun$delete$1.apply(Log.scala:608)&lt;br/&gt;
        at kafka.log.Log$$anonfun$delete$1.apply(Log.scala:608)&lt;br/&gt;
        at scala.collection.Iterator$class.foreach(Iterator.scala:727)&lt;br/&gt;
        at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)&lt;br/&gt;
        at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)&lt;br/&gt;
        at scala.collection.AbstractIterable.foreach(Iterable.scala:54)&lt;br/&gt;
        at kafka.log.Log.delete(Log.scala:608)&lt;br/&gt;
        at kafka.log.LogManager.deleteLog(LogManager.scala:375)&lt;br/&gt;
        at kafka.cluster.Partition$$anonfun$delete$1.apply$mcV$sp(Partition.scala:144)&lt;br/&gt;
        at kafka.cluster.Partition$$anonfun$delete$1.apply(Partition.scala:139)&lt;br/&gt;
        at kafka.cluster.Partition$$anonfun$delete$1.apply(Partition.scala:139)&lt;br/&gt;
        at kafka.utils.Utils$.inLock(Utils.scala:535)&lt;br/&gt;
        at kafka.utils.Utils$.inWriteLock(Utils.scala:543)&lt;br/&gt;
        at kafka.cluster.Partition.delete(Partition.scala:139)&lt;br/&gt;
        at kafka.server.ReplicaManager.stopReplica(ReplicaManager.scala:158)&lt;br/&gt;
        at kafka.server.ReplicaManager$$anonfun$stopReplicas$3.apply(ReplicaManager.scala:191)&lt;br/&gt;
        at kafka.server.ReplicaManager$$anonfun$stopReplicas$3.apply(ReplicaManager.scala:190)&lt;br/&gt;
        at scala.collection.immutable.Set$Set1.foreach(Set.scala:74)&lt;br/&gt;
        at kafka.server.ReplicaManager.stopReplicas(ReplicaManager.scala:190)&lt;br/&gt;
        at kafka.server.KafkaApis.handleStopReplicaRequest(KafkaApis.scala:96)&lt;br/&gt;
        at kafka.server.KafkaApis.handle(KafkaApis.scala:59)&lt;br/&gt;
        at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:59)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:744)&lt;/p&gt;



&lt;p&gt;When I have investigated the issue I figured out that the index file (in my environment it was C:\tmp\kafka-logs\00000000-0000-0000-0000-000000000014-0\00000000000000000000.index) was locked by the kafka process and the OS did not allow to delete that file.&lt;/p&gt;

&lt;p&gt;I tried to fix the problem in source codes and when I added close() method call into LogSegment.delete(), the Topic deletion started to work.&lt;/p&gt;

&lt;p&gt;I will add here (not sure how to upload the file during issue creation) a diff with the changes I have made so You can take a look on that whether it is reasonable or not. It would be perfect if it could make it into the product...&lt;/p&gt;

&lt;p&gt;In the end I would like to say that on Linux the deletion works just fine...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753416">KAFKA-1757</key>
            <summary>Can not delete Topic index on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sriharsha">Harsha</assignee>
                                    <reporter username="Lucky-V">Luk&#225;&#353; Vyhl&#237;dka</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Nov 2014 15:15:11 +0000</created>
                <updated>Tue, 24 Feb 2015 04:43:14 +0000</updated>
                            <resolved>Tue, 24 Feb 2015 04:43:14 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>log</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14200307" author="lucky-v" created="Thu, 6 Nov 2014 15:17:47 +0000"  >&lt;p&gt;A patch that looks like a fix for the issue.&lt;/p&gt;</comment>
                            <comment id="14213284" author="junrao" created="Sat, 15 Nov 2014 02:22:03 +0000"  >&lt;p&gt;Thanks for the patch. It&apos;s not clear to me if this really fixes the problem. OffsetIndex.close() doesn&apos;t really close any channels or handlers. It simply remaps the memory mapped file.&lt;/p&gt;</comment>
                            <comment id="14260488" author="nehanarkhede" created="Mon, 29 Dec 2014 22:23:13 +0000"  >&lt;p&gt;I&apos;m leaning towards pushing this out of 0.8.2. Let me know if anyone has concerns with this.&lt;/p&gt;</comment>
                            <comment id="14272675" author="sriharsha" created="Sat, 10 Jan 2015 20:16:32 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/29794/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/29794/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14272676" author="sriharsha" created="Sat, 10 Jan 2015 20:18:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; On windows MappedByteBuffer needs to be unmapped before deleting the file. The above patch tested on windows 8. &lt;/p&gt;</comment>
                            <comment id="14316454" author="sriharsha" created="Wed, 11 Feb 2015 16:21:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; Can you please review the patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="14334389" author="sriharsha" created="Tue, 24 Feb 2015 04:43:08 +0000"  >&lt;p&gt;patch merged by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt; closing this as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12691515" name="KAFKA-1757.patch" size="895" author="sriharsha" created="Sat, 10 Jan 2015 20:16:31 +0000"/>
                            <attachment id="12679855" name="lucky-v.patch" size="516" author="Lucky-V" created="Thu, 6 Nov 2014 15:17:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2227b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkreps</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>