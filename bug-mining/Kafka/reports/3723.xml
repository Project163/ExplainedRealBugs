<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:38:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16312] ConsumerRebalanceListener.onPartitionsAssigned() should be called after joining, even if empty</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16312</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There is a difference between the &lt;tt&gt;LegacyKafkaConsumer&lt;/tt&gt; and &lt;tt&gt;AsyncKafkaConsumer&lt;/tt&gt; respecting when the &lt;tt&gt;ConsumerRebalanceListener.onPartitionsAssigned()&lt;/tt&gt; method is invoked.&lt;/p&gt;

&lt;p&gt;For example, with&#160;&lt;tt&gt;onPartitionsAssigned()&lt;/tt&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;LegacyKafkaConsumer&lt;/tt&gt;: the listener method is invoked when the consumer joins the group, even if that consumer was not assigned any partitions. In this case it&apos;s passed an empty list.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;AsyncKafkaConsumer&lt;/tt&gt;: the listener method is only invoked after the consumer joins the group iff it has assigned partitions&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This difference is affecting the system tests. The system tests use a Java class named&#160;&lt;tt&gt;VerifiableConsumer&lt;/tt&gt; which uses a &lt;tt&gt;ConsumerRebalanceListener&lt;/tt&gt; that logs when the callbacks are invoked. The system tests then read from that log to determine when the callbacks are invoked. This coordination is used by the system tests to determine the lifecycle and status of the consumers.&lt;/p&gt;

&lt;p&gt;The system tests rely heavily on the listener behavior of the &lt;tt&gt;LegacyKafkaConsumer&lt;/tt&gt;. It invokes the &lt;tt&gt;onPartitionsAssigned()&lt;/tt&gt; method when the consumer joins the group, and the system tests use that to determine when the consumer is actively a member of the group. This validation of membership is used as an assertion throughout the consumer-related tests.&lt;/p&gt;

&lt;p&gt;In the system test I&apos;m executing from &lt;tt&gt;consumer_test.py&lt;/tt&gt;, there&apos;s a test that creates three consumers to read from a single topic with a single partition. It&apos;s a bit of an oddball test, but it demonstrates the issue.&lt;/p&gt;

&lt;p&gt;Here are the logs pulled from the test run when executed using the &lt;tt&gt;LegacyKafkaConsumer&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;Node 1:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2024-02-15 00:43:52,400] INFO Adding newly assigned partitions: &#160;(org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Node 2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2024-02-15 00:43:52,401] INFO Adding newly assigned partitions: test_topic-0 (org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Node 3:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2024-02-15 00:43:52,399] INFO Adding newly assigned partitions: &#160;(org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here are the logs when executing the same test using the &lt;tt&gt;AsyncKafkaConsumer&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;Node 1:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2024-02-15 01:15:46,576] INFO Adding newly assigned partitions: test_topic-0 (org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Node 2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;n/a&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Node 3:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;n/a&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a result of this change, the existing system tests do not work with the new consumer. However, even more importantly, this change in behavior may adversely affect existing users.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13570202">KAFKA-16312</key>
            <summary>ConsumerRebalanceListener.onPartitionsAssigned() should be called after joining, even if empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lucasbru">Lucas Brutschy</assignee>
                                    <reporter username="kirktrue">Kirk True</reporter>
                        <labels>
                            <label>kip-848-client-support</label>
                    </labels>
                <created>Wed, 28 Feb 2024 17:45:16 +0000</created>
                <updated>Mon, 29 Jul 2024 20:24:49 +0000</updated>
                            <resolved>Mon, 18 Mar 2024 10:54:19 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17821810" author="kirktrue" created="Wed, 28 Feb 2024 18:31:39 +0000"  >&lt;p&gt;Perhaps &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16185&quot; title=&quot;Fix client reconciliation of same assignment received in different epochs &quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16185&quot;&gt;&lt;del&gt;KAFKA-16185&lt;/del&gt;&lt;/a&gt; will resolve this, but in case it turns out to be a separate issue, we&apos;ll leave this Jira open for now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13565683">KAFKA-16185</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nojc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>