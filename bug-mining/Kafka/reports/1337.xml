<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:58:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4687] InvalidTopicException is possible for topic colliding with itself when concurrently created</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4687</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In our system we programmatically create the topic when data is first received from a data source prior to producing messages to that topic. Our Kafka producers run in a highly concurrent distributed environment (Storm), such that when a data feed is first enabled there may be multiple Storm bolt processes competing to create the topic. Occasionally, we see an InvalidTopicException for a topic colliding with itself due to a race condition where the initial zkUtils.zkClient.exists(topic) check returns false, but the subsequent zkUtils.getAllTopics() call includes the topic.&lt;/p&gt;

&lt;p&gt;Example stack trace,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: kafka.common.InvalidTopicException: Topic &quot;DATA.7b3fbbd4-4ecd-4521-aed4-0ccca371e573&quot; collides with existing topics: DATA.7b3fbbd4-4ecd-4521-aed4-0ccca371e573
	at kafka.admin.AdminUtils$.createOrUpdateTopicPartitionAssignmentPathInZK(AdminUtils.scala:258) ~[stormjar.jar:?]
	at kafka.admin.AdminUtils$.createTopic(AdminUtils.scala:237) ~[stormjar.jar:?]
	at kafka.admin.AdminUtils.createTopic(AdminUtils.scala) ~[stormjar.jar:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix this I believe we just need to update the &lt;tt&gt;Topic#hasCollision&lt;/tt&gt; method to disallow a topic from having a collision with itself (as &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2337&quot; title=&quot;Verify that metric names will not collide when creating new topics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2337&quot;&gt;&lt;del&gt;KAFKA-2337&lt;/del&gt;&lt;/a&gt; clearly did not intend for that condition to ever be possible), like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;def hasCollision(topicA: String, topicB: String): Boolean = {
  topicA != topicB &amp;amp;&amp;amp; topicA.replace(&apos;.&apos;, &apos;_&apos;) == topicB.replace(&apos;.&apos;, &apos;_&apos;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This bug affects version 0.9.0.0 and higher.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13037106">KAFKA-4687</key>
            <summary>InvalidTopicException is possible for topic colliding with itself when concurrently created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noslowerdna">Andrew Olson</assignee>
                                    <reporter username="noslowerdna">Andrew Olson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jan 2017 17:31:32 +0000</created>
                <updated>Tue, 24 Jan 2017 20:27:07 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 20:26:51 +0000</resolved>
                                    <version>0.9.0.0</version>
                                    <fixVersion>0.10.2.0</fixVersion>
                                    <component>admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15835322" author="githubbot" created="Mon, 23 Jan 2017 22:47:56 +0000"  >&lt;p&gt;GitHub user noslowerdna opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2425&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4687&quot; title=&quot;InvalidTopicException is possible for topic colliding with itself when concurrently created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4687&quot;&gt;&lt;del&gt;KAFKA-4687&lt;/del&gt;&lt;/a&gt;: Fix InvalidTopicException due to topic creation race condition&lt;/p&gt;

&lt;p&gt;    Pull request for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4687&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-4687&lt;/a&gt;, complete details can be found in the Jira.&lt;/p&gt;

&lt;p&gt;    With this change, instead of incorrectly throwing an InvalidTopicException, a TopicExistsException would be thrown &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/kafka/blob/0.10.1.1/core/src/main/scala/kafka/admin/AdminUtils.scala#L474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0.10.1.1/core/src/main/scala/kafka/admin/AdminUtils.scala#L474&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;    Note that an alternative (or possibly additional) change could be to proactively check if the retrieved topic inventory &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/kafka/blob/0.10.1.1/core/src/main/scala/kafka/admin/AdminUtils.scala#L432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0.10.1.1/core/src/main/scala/kafka/admin/AdminUtils.scala#L432&lt;/a&gt;) contains the topic being created, and throw a TopicExistsException at that point. Let me know if that would be preferred, and I&apos;ll update the code accordingly.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/noslowerdna/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/noslowerdna/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4687&quot; title=&quot;InvalidTopicException is possible for topic colliding with itself when concurrently created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4687&quot;&gt;&lt;del&gt;KAFKA-4687&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2425.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2425.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2425&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8d5ab380868d2be72992701174edf9ab26928ca5&lt;br/&gt;
Author: Andrew Olson &amp;lt;aolson1@cerner.com&amp;gt;&lt;br/&gt;
Date:   2017-01-23T22:40:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4687&quot; title=&quot;InvalidTopicException is possible for topic colliding with itself when concurrently created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4687&quot;&gt;&lt;del&gt;KAFKA-4687&lt;/del&gt;&lt;/a&gt;: Fix InvalidTopicException due to topic creation race condition&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15835324" author="noslowerdna" created="Mon, 23 Jan 2017 22:48:50 +0000"  >&lt;p&gt;Pull request: &lt;a href=&quot;https://github.com/apache/kafka/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15836582" author="ijuma" created="Tue, 24 Jan 2017 20:26:51 +0000"  >&lt;p&gt;Issue resolved by pull request 2425&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15836583" author="githubbot" created="Tue, 24 Jan 2017 20:27:07 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2425&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3933r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>