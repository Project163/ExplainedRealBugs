<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:39:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1074] Reassign partitions should delete the old replicas from disk</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1074</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, after reassigning replicas to other brokers, the old replicas are not removed from disk and have to be deleted manually.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672415">KAFKA-1074</key>
            <summary>Reassign partitions should delete the old replicas from disk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Oct 2013 21:37:07 +0000</created>
                <updated>Wed, 8 Jan 2014 06:38:26 +0000</updated>
                            <resolved>Wed, 8 Jan 2014 06:38:25 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.1</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13826647" author="junrao" created="Tue, 19 Nov 2013 16:28:42 +0000"  >&lt;p&gt;Removing the old replica log from the disk itself is simple. What we need to make sure is that all potential outstanding operations on the deleted log are handled properly. In particular, we don&apos;t want any potential IOException due to the missing log causes the broker to halt.&lt;/p&gt;

&lt;p&gt;1. All read operations are ok since we already handle unexpected exceptions in KafkaApi.&lt;/p&gt;

&lt;p&gt;2. Writing to the log by the producer request, the replica fetcher or the log flusher: We need to make sure that after the log is deleted, no more writes/flushes will be attempted on the log. This can be achieved by:&lt;br/&gt;
2.1 For producer requests, the delete partition operation will synchronize on the leaderAndIsrUpdate lock.&lt;br/&gt;
2.2 For replica fetcher, this is already handled since the fetcher is removed before the log is deleted.&lt;br/&gt;
2.3 For log flusher, the flush and the delete will now synchronize on a delete lock.&lt;/p&gt;</comment>
                            <comment id="13826648" author="junrao" created="Tue, 19 Nov 2013 16:29:25 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13839152" author="junrao" created="Wed, 4 Dec 2013 18:13:26 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13839154" author="junrao" created="Wed, 4 Dec 2013 18:15:30 +0000"  >&lt;p&gt;Summary of the new patch:&lt;br/&gt;
LogCleaner:&lt;br/&gt;
*added the logic to cancel an in-progress cleaning task&lt;br/&gt;
*made the cleaner thread a shutdownable, but not interruptible thread. Interrupting the cleaner may cause the file channel to be closed, which will fail other operations like log flushing during shutdown.&lt;/p&gt;

&lt;p&gt;LogManager:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;added the logic to wait until an in-progress flushing process complete&lt;/li&gt;
	&lt;li&gt;to delete a log do&lt;br/&gt;
  (1) take the log to be deleted from log lists so that log cleaner and log flusher won&apos;t see it in the future&lt;br/&gt;
  (2) cancel any in-progress cleaning task&lt;br/&gt;
  (3) wait until any in-progress flushing process to complete&lt;br/&gt;
  (4) at this moment, we know the log won&apos;t be touched by the cleaner or the flusher any more and we can delete the whole directory synchronously.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Todos:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the overall logic looks good, we can get rid of OptimisticLockFailureException in LogCleaner too by canceling any cleaner task before truncating the log. This can be done in a follow up jira.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13849375" author="junrao" created="Mon, 16 Dec 2013 17:42:00 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13849376" author="junrao" created="Mon, 16 Dec 2013 17:42:07 +0000"  >&lt;p&gt;Summary of changes since the previous patch.&lt;/p&gt;

&lt;p&gt;LogCleaner:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Added the logic to pause and resume the cleaning of a log. Canceling the cleaning is implemented as pausing, followed by resuming.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;LogManager:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Don&apos;t halt when background flush hits an IOException since the same IOException will be hit during log append, which will halt the broker. This removes the need to synchronize btw the flushing and the deleting of the log.&lt;/li&gt;
	&lt;li&gt;Removed OptimisticLockFailureException in LogCleaner. When a log needs to be truncated, first pause log cleaning, then truncate the log, and finally resume log cleaning.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13860313" author="junrao" created="Thu, 2 Jan 2014 16:33:33 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13860314" author="junrao" created="Thu, 2 Jan 2014 16:33:45 +0000"  >&lt;p&gt;Summary of changes since the previous patch.&lt;br/&gt;
LogCleaner:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;moved all variables and locks associated with state management into a separate class LogCleanerStates.&lt;/li&gt;
	&lt;li&gt;removed the semaphore for unit test and used a simpler approach to just keep retrying every 10ms. Will file a separate jira for improving the unit test.&lt;br/&gt;
Log:&lt;/li&gt;
	&lt;li&gt;limited the scope of a few methods to log.&lt;br/&gt;
LogManager:&lt;/li&gt;
	&lt;li&gt;forced checkpointing recovery points in truncateFullyAndStartAt() as well.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13861877" author="junrao" created="Fri, 3 Jan 2014 20:27:33 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13862343" author="junrao" created="Sat, 4 Jan 2014 16:37:44 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13864538" author="junrao" created="Tue, 7 Jan 2014 18:52:25 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15674/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15674/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13865135" author="junrao" created="Wed, 8 Jan 2014 06:38:26 +0000"  >&lt;p&gt;Thanks for the review. Committed to trunk.&lt;/p&gt;

&lt;p&gt;File a followup jira &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1201&quot; title=&quot;offset in LogCleaner.awaitCleaned is not enforced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1201&quot;&gt;&lt;del&gt;KAFKA-1201&lt;/del&gt;&lt;/a&gt; to address unit test issue for LogCleanTest.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12550245">KAFKA-330</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12614642" name="KAFKA-1074.patch" size="12640" author="junrao" created="Tue, 19 Nov 2013 16:29:17 +0000"/>
                            <attachment id="12617033" name="KAFKA-1074_2013-12-04_10:14:13.patch" size="30712" author="junrao" created="Wed, 4 Dec 2013 18:13:25 +0000"/>
                            <attachment id="12618940" name="KAFKA-1074_2013-12-16_09:43:53.patch" size="43197" author="junrao" created="Mon, 16 Dec 2013 17:42:00 +0000"/>
                            <attachment id="12621097" name="KAFKA-1074_2014-01-02_08:36:37.patch" size="50520" author="junrao" created="Thu, 2 Jan 2014 16:33:26 +0000"/>
                            <attachment id="12621382" name="KAFKA-1074_2014-01-03_12:30:47.patch" size="51305" author="junrao" created="Fri, 3 Jan 2014 20:27:25 +0000"/>
                            <attachment id="12621471" name="KAFKA-1074_2014-01-04_08:40:55.patch" size="51460" author="junrao" created="Sat, 4 Jan 2014 16:37:38 +0000"/>
                            <attachment id="12621829" name="KAFKA-1074_2014-01-07_10:55:08.patch" size="52611" author="junrao" created="Tue, 7 Jan 2014 18:52:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352042</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1op3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352330</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>