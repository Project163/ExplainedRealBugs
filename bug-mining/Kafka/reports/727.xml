<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:44:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2100] Client Error doesn&apos;t preserve or display original server error code when it is an unknown code</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2100</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When the java client receives an unfamiliar error code, it translates it into &lt;/p&gt;

&lt;p&gt;UNKNOWN(-1, new UnknownServerException(&quot;The server experienced an unexpected error when processing the request&quot;))&lt;/p&gt;

&lt;p&gt;This completely loses the original code, which makes troubleshooting from the client impossible. &lt;/p&gt;

&lt;p&gt;Will be better to preserve the original code and write it to the log when logging the error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819041">KAFKA-2100</key>
            <summary>Client Error doesn&apos;t preserve or display original server error code when it is an unknown code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dajac">David Jacot</assignee>
                                    <reporter username="gwenshap">Gwen Shapira</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 7 Apr 2015 19:50:10 +0000</created>
                <updated>Wed, 29 Jul 2015 17:40:51 +0000</updated>
                            <resolved>Wed, 29 Jul 2015 17:40:51 +0000</resolved>
                                                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14633066" author="dajac" created="Mon, 20 Jul 2015 05:17:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwenshap&quot; class=&quot;user-hover&quot; rel=&quot;gwenshap&quot;&gt;gwenshap&lt;/a&gt; Are you working on this one? I&apos;d like to take it to familiarize myself with the contributing process.&lt;/p&gt;</comment>
                            <comment id="14634435" author="gwenshap" created="Tue, 21 Jul 2015 02:36:51 +0000"  >&lt;p&gt;Go ahead, all yours &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14640448" author="dajac" created="Fri, 24 Jul 2015 13:26:10 +0000"  >&lt;p&gt;I have looked at how Errors are used in the java client and I see mainly two options for preserving original error code:&lt;/p&gt;

&lt;p&gt;1. We could modify Errors to not default to UNKNOWN and returns an error which preserves the original error code.&lt;br/&gt;
2. We could log a warning message when a lookup is made with an unknown error code.&lt;/p&gt;

&lt;p&gt;Option 1 requires a refactoring of the Errors enum as it is not possible to create an new entry at runtime. One way would be to replace the enum by a class which defines static constants for each error. I think that it is quite clean approach but it is a bit less readable. Also, I&apos;m wondering if not defaulting to UNKNOWN could impact logic of the client, for instance, if a retry is done based on an UNKNOWN error. I have attached a rough patch which show this. All tests pass with it.&lt;/p&gt;

&lt;p&gt;Option 2 doesn&apos;t require any changes in the code base and will warn the end user.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering how often this happens? Error codes are defined in the protocol so mapping between the client and the server (assuming they use the same version) should be one to one.&lt;/p&gt;

&lt;p&gt;I would be happy to have any feedback/advice on how to move forward with this. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwenshap&quot; class=&quot;user-hover&quot; rel=&quot;gwenshap&quot;&gt;gwenshap&lt;/a&gt; Is it what you had in mind?&lt;/p&gt;

&lt;p&gt;While reading the code of the client, I have noticed that few different ways are used to handle error codes. Mainly, the are keep as numerical values, and sometimes, they are converted to Errors. Would it be better to stay consistent and stick to one way or the other?&lt;/p&gt;</comment>
                            <comment id="14640654" author="gwenshap" created="Fri, 24 Jul 2015 16:01:07 +0000"  >&lt;p&gt;Regarding how often it happens: I believe its mostly an upgrade concern (i.e. we added new error codes to the server, but didn&apos;t upgrade the client so it can&apos;t translate them properly). However, its just very frustrating to troubleshoot because you see the UNKNOWN and simply have no clue as to what went wrong.&lt;/p&gt;

&lt;p&gt;I like option #2 since its short, simple and solves what I see as the main issue with UNKNOWN (that you have no clues at all). &lt;/p&gt;

&lt;p&gt;I agree that option #1 could impact client logic (although UNKNOWN is not retriable). I didn&apos;t dig deep into the code yet, but do you think it makes sense to keep the UNKNOWN code in the Error class, and just add the code to the message in the Exception? Will this get to the error log eventually?&lt;/p&gt;

&lt;p&gt;Since option #1 can have other implications on client-side, it will be awesome if others take a look too: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Regarding the inconsistent ways errors are handled, can you point out few examples?&lt;/p&gt;</comment>
                            <comment id="14640941" author="dajac" created="Fri, 24 Jul 2015 19:05:37 +0000"  >&lt;p&gt;I think that UNKNOWN must be kept in the Errors because UNKNOWN (-1) is part of the protocol and used in the code for checking its error code. Yes, exception will get to the log or get to the user.&lt;/p&gt;

&lt;p&gt;Thinking a bit more about it, would it be better to ensure that same errors are used in both the server and the client by sharing them? It might be already the objective of the common package, isn&apos;t it? Then, a warning in the log when a lookup is done might be enough to warn the user that he should check or update his client.&lt;/p&gt;

&lt;p&gt;Regarding the inconsistent ways, it is not a big deal but I have seen above ways. The first one is used almost everywhere except in the Sender class.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Coordinator.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; error = heartbeatResponse.errorCode();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (error == Errors.NONE.code()) {
...
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.raise(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected error in heartbeat response: &quot;&lt;/span&gt;
                        + Errors.forCode(error).exception().getMessage()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Sender.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Errors error = Errors.forCode(partResp.errorCode);
...
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (error != Errors.NONE &amp;amp;&amp;amp; canRetry(batch, error))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14640955" author="gwenshap" created="Fri, 24 Jul 2015 19:22:58 +0000"  >&lt;p&gt;We have &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1929&quot; title=&quot;Convert core kafka module to use the errors in org.apache.kafka.common.errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1929&quot;&gt;&lt;del&gt;KAFKA-1929&lt;/del&gt;&lt;/a&gt; for re-using the Errors package in the server side.&lt;/p&gt;</comment>
                            <comment id="14641118" author="guozhang" created="Fri, 24 Jul 2015 21:47:24 +0000"  >&lt;p&gt;I like option #2 as well, I think it is sufficient to bring user&apos;s attention with the preserved original error code.&lt;/p&gt;

&lt;p&gt;Regarding the inconsistency usage, it is mainly because they are written by two people (namely me and Jay &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) who did not really sync-up on the usage style. I do not have a strong preference either way, but Sender&apos;s way may be less characters?&lt;/p&gt;</comment>
                            <comment id="14642179" author="ewencp" created="Mon, 27 Jul 2015 02:33:45 +0000"  >&lt;p&gt;Option #2 looks good to me as well.&lt;/p&gt;

&lt;p&gt;As for when this can happen, the upgrade situation Gwen described is the one case I&apos;m aware of as well. Error code changes and changes in semantics of various protocol fields are the two ways I can think of where I don&apos;t think we can provide complete compatibility without introducing extra protocol versions that are only semantically (and not structurally) different. There was a discussion about this awhile ago (though I can&apos;t recall the context now) and I think the conclusion was that adding an error code despite it technically being incompatible is ok (especially if its a non-retriable error that ultimately has the same effect as UNKNOWN). Since that&apos;s the case, it&apos;s definitely valuable to have this information logged.&lt;/p&gt;</comment>
                            <comment id="14642296" author="dajac" created="Mon, 27 Jul 2015 05:42:43 +0000"  >&lt;p&gt;Thank you for your feedback. I just uploaded a patch which implements option #2.&lt;/p&gt;

&lt;p&gt;Regarding the inconsistency usage, I don&apos;t have a preference neither. Should we align them? Any way, I think that it must be handled in a separate JIRA.&lt;/p&gt;</comment>
                            <comment id="14642400" author="ewencp" created="Mon, 27 Jul 2015 07:38:49 +0000"  >&lt;p&gt;LGTM.&lt;/p&gt;

&lt;p&gt;wrt inconsistency: the example shown, canRetry, checks RetriableException. This info isn&apos;t available directly via the error code. It&apos;s true we could make the error checking consistent and convert to Error as needed to check the exception type, but this doesn&apos;t strike me as particularly egregious. I wouldn&apos;t worry about it.&lt;/p&gt;</comment>
                            <comment id="14644699" author="dajac" created="Tue, 28 Jul 2015 17:29:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwenshap&quot; class=&quot;user-hover&quot; rel=&quot;gwenshap&quot;&gt;gwenshap&lt;/a&gt; Could you review this one when you have time? Thanks!&lt;/p&gt;</comment>
                            <comment id="14646472" author="gwenshap" created="Wed, 29 Jul 2015 17:36:01 +0000"  >&lt;p&gt;+1 and pushed to trunk.&lt;/p&gt;

&lt;p&gt;Thank you for your contribution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt;, hope to see more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12747024" name="KAFKA-2100-1.patch" size="11023" author="dajac" created="Fri, 24 Jul 2015 13:26:36 +0000"/>
                            <attachment id="12747283" name="KAFKA-2100-2.patch" size="2174" author="dajac" created="Mon, 27 Jul 2015 05:39:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cxf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>gwenshap</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>