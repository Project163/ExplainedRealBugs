<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:00:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4791] Kafka Streams - unable to add state stores when using wildcard topics on the source</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4791</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I&apos;m trying to build up a topology (using TopologyBuilder) with following components :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopologyBuilder()
  .addSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;ingest&quot;&lt;/span&gt;, Pattern.compile( ... ))
  .addProcessor(&lt;span class=&quot;code-quote&quot;&gt;&quot;myprocessor&quot;&lt;/span&gt;, ..., &lt;span class=&quot;code-quote&quot;&gt;&quot;ingest&quot;&lt;/span&gt;)
  .addStateStore(dataStore, &lt;span class=&quot;code-quote&quot;&gt;&quot;myprocessor&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Somehow this does not seem to work.&lt;br/&gt;
When creating the topology with exact topic names, all works fine, but it seems not possible to attach state stores when using wildcard topics on the sources.&lt;/p&gt;

&lt;p&gt;Inside &lt;tt&gt;addStateStore&lt;/tt&gt;, the processor gets connected to the state store with &lt;tt&gt;connectProcessorAndStateStore&lt;/tt&gt;, and there it will try to connect the state store with the source topics from the processor: &lt;tt&gt;connectStateStoreNameToSourceTopics&lt;/tt&gt;  &lt;br/&gt;
Here lies the problem: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; findSourceTopicsForProcessorParents(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; [] parents) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; sourceTopics = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parent : parents) {
            NodeFactory nodeFactory = nodeFactories.get(parent);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nodeFactory &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; SourceNodeFactory) {
                sourceTopics.addAll(Arrays.asList(((SourceNodeFactory) nodeFactory).getTopics()));
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nodeFactory &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ProcessorNodeFactory) {
                sourceTopics.addAll(findSourceTopicsForProcessorParents(((ProcessorNodeFactory) nodeFactory).parents));
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; sourceTopics;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The call to &lt;tt&gt;sourceTopics.addAll(Arrays.asList(((SourceNodeFactory) nodeFactory).getTopics()))&lt;/tt&gt; will fail as there are no topics inside the &lt;tt&gt;SourceNodeFactory&lt;/tt&gt; object, only a pattern (&lt;tt&gt;.getTopics&lt;/tt&gt; returns null)&lt;/p&gt;

&lt;p&gt;I also tried to search for some unit tests inside the Kafka Streams project that cover this scenario, but alas, I was not able to find any.&lt;br/&gt;
Only some tests on state stores with exact topic names, and some tests on wildcard topics, but no combination of both ...&lt;/p&gt;
</description>
                <environment>Java 8</environment>
        <key id="13045664">KAFKA-4791</key>
            <summary>Kafka Streams - unable to add state stores when using wildcard topics on the source</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bbejeck">Bill Bejeck</assignee>
                                    <reporter username="clouTrix">Bart Vercammen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Feb 2017 16:01:21 +0000</created>
                <updated>Thu, 30 Mar 2017 22:48:39 +0000</updated>
                            <resolved>Thu, 30 Mar 2017 22:48:39 +0000</resolved>
                                    <version>0.10.1.1</version>
                    <version>0.10.2.0</version>
                                    <fixVersion>0.10.2.1</fixVersion>
                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15880782" author="bbejeck" created="Thu, 23 Feb 2017 16:28:00 +0000"  >&lt;p&gt;picking this one up.&lt;/p&gt;</comment>
                            <comment id="15880966" author="mjsax" created="Thu, 23 Feb 2017 18:20:29 +0000"  >&lt;p&gt;You should not call &lt;tt&gt;connectStateStoreNameToSourceTopics&lt;/tt&gt;. It&apos;s an leaking internal API that will be removed. Cf. &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-120%3A+Cleanup+Kafka+Streams+builder+API&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-120%3A+Cleanup+Kafka+Streams+builder+API&lt;/a&gt;&lt;br/&gt;
I would close this as &quot;not a problem&quot;. Right now, &lt;tt&gt;KStreamBuilder&lt;/tt&gt; uses this for source &lt;tt&gt;KTable&lt;/tt&gt; and a &lt;tt&gt;KTable&lt;/tt&gt; is always read from a single topic, so there is not need to all multiple topics or topic patterns. \cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15880971" author="mjsax" created="Thu, 23 Feb 2017 18:22:54 +0000"  >&lt;p&gt;\cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=damianguy&quot; class=&quot;user-hover&quot; rel=&quot;damianguy&quot;&gt;damianguy&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15881018" author="bbejeck" created="Thu, 23 Feb 2017 18:56:18 +0000"  >&lt;p&gt;Fair enough.  I did not look into the issue at all, at first blush it seemed like a bug that needed to be fixed asap.  But considering your comments and the forthcoming changes with KIP-120, I&apos;ll hold off.&lt;/p&gt;</comment>
                            <comment id="15881043" author="cloutrix" created="Thu, 23 Feb 2017 19:09:57 +0000"  >&lt;p&gt;This then means that &lt;tt&gt;addStateStore&lt;/tt&gt; should not be used from TopologyBuilder ?&lt;br/&gt;
So, in order to connect my stores to the processors I&apos;ll need to create them inside the processor&apos;s &lt;tt&gt;init&lt;/tt&gt; block and register them manually to the processor-context?&lt;br/&gt;
Or am I seeing this wrong?&lt;/p&gt;

&lt;p&gt;As I use the store as a &lt;tt&gt;QueryableStore&lt;/tt&gt; later on, I do need to fetch it from the topology builder, so it needs to be registered there with &lt;tt&gt;adStateStore&lt;/tt&gt;, no?&lt;/p&gt;</comment>
                            <comment id="15881280" author="damianguy" created="Thu, 23 Feb 2017 21:16:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; this is a bug. Bart is calling &lt;tt&gt;addStateStore&lt;/tt&gt; which is, and will remain, a public API. He has just kindly pointed out where the problem lies.&lt;/p&gt;</comment>
                            <comment id="15881456" author="mjsax" created="Thu, 23 Feb 2017 22:39:28 +0000"  >&lt;p&gt;Ack. My bad. I thought &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=clouTrix&quot; class=&quot;user-hover&quot; rel=&quot;clouTrix&quot;&gt;clouTrix&lt;/a&gt; calls &lt;tt&gt;connectStateStoreNameToSourceTopics&lt;/tt&gt;, but he doesn&apos;t... Calling &lt;tt&gt;addStateStore&lt;/tt&gt; is of course fine. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbejeck&quot; class=&quot;user-hover&quot; rel=&quot;bbejeck&quot;&gt;bbejeck&lt;/a&gt; feel free to start working on this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15889382" author="githubbot" created="Wed, 1 Mar 2017 02:33:28 +0000"  >&lt;p&gt;GitHub user bbejeck opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2618&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4791&quot; title=&quot;Kafka Streams - unable to add state stores when using wildcard topics on the source&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4791&quot;&gt;&lt;del&gt;KAFKA-4791&lt;/del&gt;&lt;/a&gt;: unable to add state store with regex matched topics&lt;/p&gt;

&lt;p&gt;    Fix for adding state stores with regex defined sources&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bbejeck/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bbejeck/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4791&quot; title=&quot;Kafka Streams - unable to add state stores when using wildcard topics on the source&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4791&quot;&gt;&lt;del&gt;KAFKA-4791&lt;/del&gt;&lt;/a&gt;_unable_to_add_statestore_regex_topics&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2618.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2618.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2618&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 828928905e393113e2a4f0148b8f1edc48d6e077&lt;br/&gt;
Author: bbejeck &amp;lt;bbejeck@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-01T02:27:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4791&quot; title=&quot;Kafka Streams - unable to add state stores when using wildcard topics on the source&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4791&quot;&gt;&lt;del&gt;KAFKA-4791&lt;/del&gt;&lt;/a&gt;: unable to add state store with regex matched topics&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15950005" author="githubbot" created="Thu, 30 Mar 2017 22:45:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2618&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15950010" author="guozhang" created="Thu, 30 Mar 2017 22:48:39 +0000"  >&lt;p&gt;Issue resolved by pull request 2618&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2618&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3aipb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>