<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-765] Corrupted messages in produce request could shutdown the broker</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-765</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In kafka.log.append(), we convert all IOException to KafkaStorageException. This will cause the caller to shutdown the broker. However, if there is a corrupted compressed message, validMessages.assignOffsets() in append() could also throw an IOException when decompressing the message. In this case, we shouldn&apos;t shut down the broker and should just fail this particular produce request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633244">KAFKA-765</key>
            <summary>Corrupted messages in produce request could shutdown the broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>p1</label>
                    </labels>
                <created>Wed, 20 Feb 2013 18:16:38 +0000</created>
                <updated>Mon, 25 Feb 2013 20:13:09 +0000</updated>
                            <resolved>Mon, 25 Feb 2013 08:14:43 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13582396" author="junrao" created="Wed, 20 Feb 2013 18:18:17 +0000"  >&lt;p&gt;One way to fix this is to only convert IOException from segment.append and maybeFlush to KafkaStorageException.&lt;/p&gt;</comment>
                            <comment id="13583886" author="sriramsub" created="Fri, 22 Feb 2013 03:52:28 +0000"  >&lt;p&gt;Assigning to Neha as per mail conversation&lt;/p&gt;</comment>
                            <comment id="13585573" author="nehanarkhede" created="Mon, 25 Feb 2013 02:24:26 +0000"  >&lt;p&gt;Fix is to catch the IOException for assignOffsets() and rethrow a KafkaException describing the validation error&lt;/p&gt;</comment>
                            <comment id="13585648" author="junrao" created="Mon, 25 Feb 2013 05:58:42 +0000"  >&lt;p&gt;Thanks for the patch. +1.&lt;/p&gt;</comment>
                            <comment id="13585652" author="sriramsub" created="Mon, 25 Feb 2013 06:19:43 +0000"  >&lt;p&gt;The change seems to cause a leak. The IOException during decompression now does not shutdown the broker (ByteBufferMessageSet.Scala). If the read below throws, close is never called on the input stream. You would need to wrap the code in try - finally.&lt;/p&gt;

&lt;p&gt;val compressed = CompressionFactory(message.compressionCodec, inputStream)&lt;br/&gt;
    Stream.continually(compressed.read(intermediateBuffer)).takeWhile(_ &amp;gt; 0).foreach &lt;/p&gt;
{ dataRead =&amp;gt;
      outputStream.write(intermediateBuffer, 0, dataRead)
    }
&lt;p&gt;compressed.close()&lt;/p&gt;</comment>
                            <comment id="13585710" author="nehanarkhede" created="Mon, 25 Feb 2013 08:14:43 +0000"  >&lt;p&gt;Thanks for the review, checked in after implementing Sriram&apos;s suggestion.&lt;/p&gt;</comment>
                            <comment id="13585929" author="junrao" created="Mon, 25 Feb 2013 15:27:59 +0000"  >&lt;p&gt;Shouldn&apos;t we do the same in the compressing logic too, i.e, always closes output?&lt;/p&gt;</comment>
                            <comment id="13586244" author="nehanarkhede" created="Mon, 25 Feb 2013 20:13:09 +0000"  >&lt;p&gt;Yes we should. Checked that in as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570704" name="KAFKA-765.patch" size="935" author="nehanarkhede" created="Mon, 25 Feb 2013 02:24:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i53j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>