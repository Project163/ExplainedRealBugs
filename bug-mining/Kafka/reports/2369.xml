<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:20:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8896] NoSuchElementException after coordinator move</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8896</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Caught this exception in the wild:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.NoSuchElementException: key not found: consumer-group-38981ebe-4361-44e7-b710-7d11f5d35639
	at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(MapLike.scala:235)
	at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;$(MapLike.scala:234)
	at scala.collection.AbstractMap.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(Map.scala:63)
	at scala.collection.mutable.HashMap.apply(HashMap.scala:69)
	at kafka.coordinator.group.GroupMetadata.get(GroupMetadata.scala:214)
	at kafka.coordinator.group.GroupCoordinator.$anonfun$tryCompleteHeartbeat$1(GroupCoordinator.scala:1008)
	at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:23)
	at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:253)
	at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:209)
	at kafka.coordinator.group.GroupCoordinator.tryCompleteHeartbeat(GroupCoordinator.scala:1001)
	at kafka.coordinator.group.DelayedHeartbeat.tryComplete(DelayedHeartbeat.scala:34)
	at kafka.server.DelayedOperation.maybeTryComplete(DelayedOperation.scala:122)
	at kafka.server.DelayedOperationPurgatory$Watchers.tryCompleteWatched(DelayedOperation.scala:391)
	at kafka.server.DelayedOperationPurgatory.checkAndComplete(DelayedOperation.scala:295)
	at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextExpiration(GroupCoordinator.scala:802)
	at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextHeartbeatExpiration(GroupCoordinator.scala:795)
	at kafka.coordinator.group.GroupCoordinator.$anonfun$handleHeartbeat$2(GroupCoordinator.scala:543)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:253)
	at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:209)
	at kafka.coordinator.group.GroupCoordinator.handleHeartbeat(GroupCoordinator.scala:516)
	at kafka.server.KafkaApis.handleHeartbeatRequest(KafkaApis.scala:1617)
	at kafka.server.KafkaApis.handle(KafkaApis.scala:155) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Looking at the logs, I see a coordinator change just prior to this exception. The group was first unloaded as the coordinator moved to another broker and then was loaded again as the coordinator was moved back. I am guessing that somehow the delayed heartbeat is retaining the reference to the old GroupMetadata instance. Not sure exactly how this can happen though.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13255996">KAFKA-8896</key>
            <summary>NoSuchElementException after coordinator move</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bchen225242">Boyang Chen</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Sep 2019 23:21:15 +0000</created>
                <updated>Tue, 3 Mar 2020 15:33:14 +0000</updated>
                            <resolved>Fri, 4 Oct 2019 20:19:03 +0000</resolved>
                                    <version>2.2.0</version>
                    <version>2.2.1</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16935998" author="githubbot" created="Mon, 23 Sep 2019 16:07:57 +0000"  >&lt;p&gt;abbccdda commented on pull request #7377: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8896&quot; title=&quot;NoSuchElementException after coordinator move&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8896&quot;&gt;&lt;del&gt;KAFKA-8896&lt;/del&gt;&lt;/a&gt;: Check group state before completing delayed heartbeat&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7377&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This PR is a defensive fix for reported bug 8896, which would cause group coordinator crash when the heartbeat member was not found.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16941822" author="githubbot" created="Tue, 1 Oct 2019 13:19:48 +0000"  >&lt;p&gt;mumrah commented on pull request #7377: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8896&quot; title=&quot;NoSuchElementException after coordinator move&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8896&quot;&gt;&lt;del&gt;KAFKA-8896&lt;/del&gt;&lt;/a&gt;: Check group state before completing delayed heartbeat&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7377&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16988654" author="francisco.juan" created="Thu, 5 Dec 2019 10:29:06 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, could you please provide the steps or scenario that triggers this error?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have a cluster running version 2.2.1 and it is throwing this same error &lt;ins&gt;sometimes&lt;/ins&gt; when there&apos;s a broker restart.&lt;/p&gt;

&lt;p&gt;We can correlate the error that you saw with an earlier error looking like &quot;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupMetadataManager brokerId=2&amp;#93;&lt;/span&gt; Error loading offsets from __consumer_offsets&quot;. This happen short after a broker restarts.&lt;/p&gt;

&lt;p&gt;We can&apos;t reproduce this error in a test environment, which we would like to do to verify if an upgrade would actually fix our issue (some consumer-groups losing their offsets)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Our cluster setup looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Kafka version: 2.2.1
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of brokers: 30
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of leader partitions: 15785
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of consumer-groups: 1150
inter.broker.protocol.version=1.1
min.insync.replicas=2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Errors stack trace detail:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2019-11-28 08:13:22,603] ERROR [KafkaApi-42] Error when handling request: clientId=enrichment-worker-kafka, correlationId=92, api=HEARTBEAT, body={group_id=enrichment-worker-importio-webhook-consumer-eu,generation_id=9877,member_id=enrichment-worker-kafka-25821b62-f36b-4e64-905b-92019e4a5493} (kafka.server.KafkaApis)
java.util.NoSuchElementException: key not found: consumer-name-25821b62-f36b-4e64-905b-92019e4a5493
 at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(MapLike.scala:235)
 at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;$(MapLike.scala:234)
 at scala.collection.AbstractMap.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(Map.scala:63)
 at scala.collection.mutable.HashMap.apply(HashMap.scala:69)
 at kafka.coordinator.group.GroupMetadata.get(GroupMetadata.scala:203)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$tryCompleteHeartbeat$1(GroupCoordinator.scala:927)
 at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:23)
 at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:251)
 at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:198)
 at kafka.coordinator.group.GroupCoordinator.tryCompleteHeartbeat(GroupCoordinator.scala:920)
 at kafka.coordinator.group.DelayedHeartbeat.tryComplete(DelayedHeartbeat.scala:34)
 at kafka.server.DelayedOperation.maybeTryComplete(DelayedOperation.scala:121)
 at kafka.server.DelayedOperationPurgatory$Watchers.tryCompleteWatched(DelayedOperation.scala:388)
 at kafka.server.DelayedOperationPurgatory.checkAndComplete(DelayedOperation.scala:294)
 at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextExpiration(GroupCoordinator.scala:737)
 at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextHeartbeatExpiration(GroupCoordinator.scala:730)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$handleHeartbeat$2(GroupCoordinator.scala:486)
 at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
 at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:251)
 at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:198)
 at kafka.coordinator.group.GroupCoordinator.handleHeartbeat(GroupCoordinator.scala:451)
 at kafka.server.KafkaApis.handleHeartbeatRequest(KafkaApis.scala:1336)
 at kafka.server.KafkaApis.handle(KafkaApis.scala:120)
 at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:69)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

[2019-11-28 08:13:18,175] ERROR [GroupMetadataManager brokerId=42] Error loading offsets from __consumer_offsets-24 (kafka.coordinator.group.GroupMetadataManager)
java.util.NoSuchElementException: key not found: consumer-name-de868651-3166-46df-98c5-6196b9ade526
 at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(MapLike.scala:235)
 at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(MapLike.scala:235)
 at scala.collection.MapLike.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;$(MapLike.scala:234)
 at scala.collection.AbstractMap.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(Map.scala:63)
 at scala.collection.mutable.HashMap.apply(HashMap.scala:69)
 at kafka.coordinator.group.GroupMetadata.get(GroupMetadata.scala:203)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$tryCompleteHeartbeat$1(GroupCoordinator.scala:927)
 at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:23)
 at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:251)
 at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:198)
 at kafka.coordinator.group.GroupCoordinator.tryCompleteHeartbeat(GroupCoordinator.scala:920)
 at kafka.coordinator.group.DelayedHeartbeat.tryComplete(DelayedHeartbeat.scala:34)
 at kafka.server.DelayedOperation.maybeTryComplete(DelayedOperation.scala:121)
 at kafka.server.DelayedOperationPurgatory$Watchers.tryCompleteWatched(DelayedOperation.scala:388)
 at kafka.server.DelayedOperationPurgatory.checkAndComplete(DelayedOperation.scala:294)
 at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextExpiration(GroupCoordinator.scala:737)
 at kafka.coordinator.group.GroupCoordinator.completeAndScheduleNextHeartbeatExpiration(GroupCoordinator.scala:730)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$onGroupLoaded$3(GroupCoordinator.scala:677)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$onGroupLoaded$3$adapted(GroupCoordinator.scala:677)
 at scala.collection.immutable.List.foreach(List.scala:392)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$onGroupLoaded$1(GroupCoordinator.scala:677)
 at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
 at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:251)
 at kafka.coordinator.group.GroupMetadata.inLock(GroupMetadata.scala:198)
 at kafka.coordinator.group.GroupCoordinator.onGroupLoaded(GroupCoordinator.scala:670)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$handleGroupImmigration$1(GroupCoordinator.scala:682)
 at kafka.coordinator.group.GroupCoordinator.$anonfun$handleGroupImmigration$1$adapted(GroupCoordinator.scala:682)
 at kafka.coordinator.group.GroupMetadataManager.$anonfun$doLoadGroupsAndOffsets$23(GroupMetadataManager.scala:646)
 at kafka.coordinator.group.GroupMetadataManager.$anonfun$doLoadGroupsAndOffsets$23$adapted(GroupMetadataManager.scala:641)
 at scala.collection.mutable.HashMap$$anon$2.$anonfun$foreach$3(HashMap.scala:158)
 at scala.collection.mutable.HashTable.foreachEntry(HashTable.scala:237)
 at scala.collection.mutable.HashTable.foreachEntry$(HashTable.scala:230)
 at scala.collection.mutable.HashMap.foreachEntry(HashMap.scala:44)
 at scala.collection.mutable.HashMap$$anon$2.foreach(HashMap.scala:158)
 at kafka.coordinator.group.GroupMetadataManager.doLoadGroupsAndOffsets(GroupMetadataManager.scala:641)
 at kafka.coordinator.group.GroupMetadataManager.loadGroupsAndOffsets(GroupMetadataManager.scala:500)
 at kafka.coordinator.group.GroupMetadataManager.$anonfun$scheduleLoadGroupAndOffsets$2(GroupMetadataManager.scala:491)
 at kafka.utils.KafkaScheduler.$anonfun$schedule$2(KafkaScheduler.scala:114)
 at kafka.utils.CoreUtils$$anon$1.run(CoreUtils.scala:63)
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
 at java.util.concurrent.FutureTask.run(FutureTask.java:266)
 at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
 at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17031170" author="hachikuji" created="Thu, 6 Feb 2020 01:12:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=francisco.juan&quot; class=&quot;user-hover&quot; rel=&quot;francisco.juan&quot;&gt;francisco.juan&lt;/a&gt; The fix version is 2.2.2. Can you upgrade and let us know if you continue seeing this? If so, we could be hitting a separate case.&lt;/p&gt;</comment>
                            <comment id="17050312" author="francisco.juan" created="Tue, 3 Mar 2020 15:33:14 +0000"  >&lt;p&gt;Upgrading the cluster to version 2.2.2 has fixed the issue. Thanks Jason for checking&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06ixk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>