<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:54:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3817] KTableRepartitionMap should handle null inputs</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3817</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When calling &lt;tt&gt;KTable.groupBy&lt;/tt&gt; on the result of a KTable-KTable join, NPEs are raised:&lt;/p&gt;

&lt;p&gt;{{org.apache.kafka.streams.kstream.internals.KTableRepartitionMap$&lt;br/&gt;
&amp;gt; KTableMapProcessor.process(KTableRepartitionMap.java:88)}}&lt;/p&gt;

&lt;p&gt;The root cause is that the join is expected to emit null values when no match is found, but KTableRepartitionMap is not set up to handle this case.&lt;/p&gt;

&lt;p&gt;On the users email list, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; described a plan of action:&lt;/p&gt;

&lt;p&gt;I think this is actually a bug in KTableRepartitionMap&lt;br/&gt;
that it actually should expect null grouped keys; this would be a&lt;br/&gt;
straight-forward fix for this operator, but I can make a pass over all the&lt;br/&gt;
repartition operators just to make sure they are all gracefully handling&lt;br/&gt;
null keys.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12977378">KAFKA-3817</key>
            <summary>KTableRepartitionMap should handle null inputs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="jeff.klukas@gmail.com">Jeff Klukas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2016 20:43:56 +0000</created>
                <updated>Fri, 5 Aug 2016 17:03:59 +0000</updated>
                            <resolved>Fri, 10 Jun 2016 20:14:33 +0000</resolved>
                                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.0.1</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15323535" author="githubbot" created="Thu, 9 Jun 2016 22:41:55 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1488&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3817&quot; title=&quot;KTableRepartitionMap should handle null inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3817&quot;&gt;&lt;del&gt;KAFKA-3817&lt;/del&gt;&lt;/a&gt;: handle null keys in KTableRepartitionMap&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K3817-handle-null-groupedkey&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1488.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1488.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1488&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7512dd0a03db2a62be469a3d2de0bf8f445ce8e6&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-09T22:41:01Z&lt;/p&gt;

&lt;p&gt;    handle null keys in KTable repartition map&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15325215" author="guozhang" created="Fri, 10 Jun 2016 20:14:33 +0000"  >&lt;p&gt;Issue resolved by pull request 1488&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1488&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15325216" author="githubbot" created="Fri, 10 Jun 2016 20:14:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1488&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15366589" author="githubbot" created="Thu, 7 Jul 2016 18:51:44 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1597&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3817&quot; title=&quot;KTableRepartitionMap should handle null inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3817&quot;&gt;&lt;del&gt;KAFKA-3817&lt;/del&gt;&lt;/a&gt; Follow-up: Avoid forwarding old value if it is null in KTableRepartition&lt;/p&gt;

&lt;p&gt;    Also handle Null value in SmokeTestUtil.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; KHotfix-check-null&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1597.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1597.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1597&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1b73da4110be9c233e7f20ea306a51b1448cbfa4&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-07T18:50:44Z&lt;/p&gt;

&lt;p&gt;    Do not forward old value if it is null in KTableRepartition; also handle Null value in SmokeTestUtil&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15367817" author="githubbot" created="Fri, 8 Jul 2016 15:36:57 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1597&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15405568" author="jfilipiak" created="Wed, 3 Aug 2016 08:30:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;So the ability to handle null values in the repartition map processor is really important. Nevertheless, I fear that this fix introduced a major problem regarding the ordering of the events. We talked about this &lt;a href=&quot;https://github.com/apache/kafka/blob/ba9456de2ebf1a34bdf5f6f62a701875822e1923/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableAggregate.java#L82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/ba9456de2ebf1a34bdf5f6f62a701875822e1923/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableAggregate.java#L82&lt;/a&gt; before, but with this change a downstream KTableAggregate does not stand a chance to keep this behaviour. The mapper might change the key of the record, but that is not guaranteed to happen. So the  KTableAggregate will not remove first and then add the new, but it will add the new and remove then. This is okay for counting (one might see negativ values(might be a problem when Serde only handles unsigned)) but its gameover for building complex type objects. &lt;/p&gt;

&lt;p&gt;I would propose to change the order of the 2 if clauses that are now present here: &lt;a href=&quot;https://github.com/apache/kafka/blob/730bf9a37a08b2ca41dcda52d2c70e92e85980f7/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableRepartitionMap.java#L83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/730bf9a37a08b2ca41dcda52d2c70e92e85980f7/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableRepartitionMap.java#L83&lt;/a&gt; that should fix it.&lt;/p&gt;</comment>
                            <comment id="15405982" author="guozhang" created="Wed, 3 Aug 2016 14:31:04 +0000"  >&lt;p&gt;Good point, mind filing a minor PR?&lt;/p&gt;</comment>
                            <comment id="15407425" author="githubbot" created="Thu, 4 Aug 2016 08:39:22 +0000"  >&lt;p&gt;GitHub user Kaiserchen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1705&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3817&quot; title=&quot;KTableRepartitionMap should handle null inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3817&quot;&gt;&lt;del&gt;KAFKA-3817&lt;/del&gt;&lt;/a&gt;: KTableRepartitionMap publish old Change first, for non-count aggregates&lt;/p&gt;

&lt;p&gt;    I affirm that the contribution is my original work and that I license the work to the project under the project&apos;s open source license. &lt;/p&gt;

&lt;p&gt;    This cleans up misbehaviour that was introduce while fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3817&quot; title=&quot;KTableRepartitionMap should handle null inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3817&quot;&gt;&lt;del&gt;KAFKA-3817&lt;/del&gt;&lt;/a&gt;. It is impossible for a non-count aggregate to be build, when the addition happens before the removal. IMHO making sure that these details are correct is very important. &lt;/p&gt;

&lt;p&gt;    This PR has local test errors. It somehow fails the ResetIntegrationTest. It doesn&apos;t quite appear to me why but it looks like this PR breaks it, especially because the error appears with the ordering of the events. Still I am unable to find where I could have broken it. Maybe not seems to fail on trunk aswell.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/Kaiserchen/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Kaiserchen/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3817&quot; title=&quot;KTableRepartitionMap should handle null inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3817&quot;&gt;&lt;del&gt;KAFKA-3817&lt;/del&gt;&lt;/a&gt;-preserve-order-for-aggreagators&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1705.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1705.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1705&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit efb8c4b9ff1dbef8bcf874b66a228756dd017c76&lt;br/&gt;
Author: jfilipiak &amp;lt;jan.filipiak@trivago.com&amp;gt;&lt;br/&gt;
Date:   2016-08-04T08:23:43Z&lt;/p&gt;

&lt;p&gt;    KTableRepartitionMap publish old Change first, for non-count aggregates&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15409730" author="githubbot" created="Fri, 5 Aug 2016 17:03:59 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1705&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12979171">KAFKA-3839</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 15 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z8yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>