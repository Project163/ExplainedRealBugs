<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:53:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3328] SimpleAclAuthorizer can lose ACLs with frequent add/remove calls</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3328</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently when adding or removing an ACL with the SimpleAclAuthorizer the following high level steps happen:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;read acls from cache&lt;/li&gt;
	&lt;li&gt;merge with the changes acls&lt;/li&gt;
	&lt;li&gt;update zookeeper&lt;/li&gt;
	&lt;li&gt;add a change notification&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Then the Authorizers listening for the change notification know to invalidate their cache and get the latest value. However that takes some time. In the time between the ACL change and the cache update, a new add or remove request could be made. This will follow the steps listed above, and if the cache is not correct all changes from the previous request are lost.&lt;/p&gt;

&lt;p&gt;This can be solved on a single node, by updating the cache at the same time you update zookeeper any time a change is made. However, because there can be multiple instances of the Authorizer, a request could come to a separate authorizer and overwrite the Zookeeper state again loosing changes from earlier requests.&lt;/p&gt;

&lt;p&gt;To solve this on multiple instances. The authorizer could always read/write state from zookeeper (instead of the cache) for add/remove requests and only leverage the cache for get/authorize requests. Or it could block until all the live instances have updated their cache. &lt;/p&gt;

&lt;p&gt;Below is a log from a failed test in the WIP &lt;a href=&quot;https://github.com/apache/kafka/pull/1005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3266&quot; title=&quot;Implement KIP-140 RPCs and APIs for creating, altering, and listing ACLs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3266&quot;&gt;&lt;del&gt;KAFKA-3266&lt;/del&gt;&lt;/a&gt; that shows this behavior:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[2016-03-03 11:09:20,714] DEBUG [KafkaApi-0] adding User:ANONYMOUS has Allow permission for operations: Describe from hosts: * for Cluster:kafka-cluster (kafka.server.KafkaApis:52)
[2016-03-03 11:09:20,726] DEBUG updatedAcls: Set(User:ANONYMOUS has Allow permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,738] DEBUG [KafkaApi-0] adding User:ANONYMOUS has Deny permission for operations: Describe from hosts: * for Cluster:kafka-cluster (kafka.server.KafkaApis:52)
[2016-03-03 11:09:20,739] DEBUG updatedAcls: Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,752] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,755] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,762] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,768] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,773] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
[2016-03-03 11:09:20,777] DEBUG Processing ACL change notification for Cluster:kafka-cluster and Set(User:ANONYMOUS has Deny permission for operations: Describe from hosts: *) (kafka.security.auth.SimpleAclAuthorizer:52)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12946618">KAFKA-3328</key>
            <summary>SimpleAclAuthorizer can lose ACLs with frequent add/remove calls</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="granthenke">Grant Henke</assignee>
                                    <reporter username="granthenke">Grant Henke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 17:27:25 +0000</created>
                <updated>Sun, 20 Mar 2016 07:46:40 +0000</updated>
                            <resolved>Sun, 20 Mar 2016 07:46:31 +0000</resolved>
                                                    <fixVersion>0.10.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15178501" author="granthenke" created="Thu, 3 Mar 2016 19:50:44 +0000"  >&lt;p&gt;I think I will work on this as it is affecting my KIP-4 work. Any thoughts on only using the cache for read operations and always communicating via Zookeeper for write operations? &lt;/p&gt;</comment>
                            <comment id="15178513" author="singhashish" created="Thu, 3 Mar 2016 20:03:15 +0000"  >&lt;p&gt;Sounds good, however can we do lazy writes to ZK? Basically, batch multiple acls CRUD in a single ZK write? Depending on use-case, it will be helpful.&lt;/p&gt;</comment>
                            <comment id="15178516" author="singhashish" created="Thu, 3 Mar 2016 20:04:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=parth.brahmbhatt&quot; class=&quot;user-hover&quot; rel=&quot;parth.brahmbhatt&quot;&gt;parth.brahmbhatt&lt;/a&gt; might have some thoughts as well.&lt;/p&gt;</comment>
                            <comment id="15178633" author="githubbot" created="Thu, 3 Mar 2016 21:11:36 +0000"  >&lt;p&gt;GitHub user granthenke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1006&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3328&quot; title=&quot;SimpleAclAuthorizer can lose ACLs with frequent add/remove calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3328&quot;&gt;&lt;del&gt;KAFKA-3328&lt;/del&gt;&lt;/a&gt;: SimpleAclAuthorizer can lose ACLs with frequent add/remov&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;e calls&lt;/p&gt;

&lt;p&gt;    Changes the SimpleAclAuthorizer to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Always read state from Zookeeper before updating acls&lt;/li&gt;
	&lt;li&gt;Update local cache when modifying acls&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/granthenke/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/granthenke/kafka&lt;/a&gt; simple-authorizer-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1006.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1006.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1006&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3483b759e1cf5e5a42ad3206eca41e8e75906b41&lt;br/&gt;
Author: Grant Henke &amp;lt;granthenke@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-03-03T20:59:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3328&quot; title=&quot;SimpleAclAuthorizer can lose ACLs with frequent add/remove calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3328&quot;&gt;&lt;del&gt;KAFKA-3328&lt;/del&gt;&lt;/a&gt;: SimpleAclAuthorizer can lose ACLs with frequent add/remove calls&lt;/p&gt;

&lt;p&gt;    Changes the SimpleAclAuthorizer to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Always read state from Zookeeper before updating acls&lt;/li&gt;
	&lt;li&gt;Update local cache when modifying acls&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="15203145" author="gwenshap" created="Sun, 20 Mar 2016 07:46:31 +0000"  >&lt;p&gt;Issue resolved by pull request 1006&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1006&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15203146" author="githubbot" created="Sun, 20 Mar 2016 07:46:40 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1006&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12950522">KAFKA-3403</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12941467">KAFKA-3266</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u3zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>fpj</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>