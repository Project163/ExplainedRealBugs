<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:22:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9390] Non-key joining of KTable not compatible with confluent avro serdes</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9390</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I was trying out the new one-to-many KTable joins against some CDC data in Avro format and kept getting serialisation errors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.kafka.common.errors.SerializationException: Error registering Avro schema: {&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Key&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;dbserver1.inventory.orders&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;:[

{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;order_number&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;}

],&lt;span class=&quot;code-quote&quot;&gt;&quot;connect.name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;dbserver1.inventory.orders.Key&quot;&lt;/span&gt;}
 Caused by: io.confluent.kafka.schemaregistry.client.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.exceptions.RestClientException: Schema being registered is incompatible with an earlier schema; error code: 409
 &#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Both tables have avro keys of different types (one is an order key, the other a customer key).&lt;/p&gt;

&lt;p&gt;This looks like it will cause issues.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/2.4/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/CombinedKeySchema.java#L57-L60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/2.4/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/CombinedKeySchema.java#L57-L60&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;They will both attempt to register schemas with the same subject to the schema registry which will fail a backward compatibility check.&lt;/p&gt;

&lt;p&gt;I also noticed in the schema registry there were some subjects that didn&apos;t have the application id prefix. This is probably caused by this...&lt;/p&gt;

&lt;p&gt;&#160;&lt;a href=&quot;https://github.com/apache/kafka/blob/2.4/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/ForeignJoinSubscriptionSendProcessorSupplier.java#L88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/2.4/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/ForeignJoinSubscriptionSendProcessorSupplier.java#L88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Where here &lt;tt&gt;repartitionTopicName&lt;/tt&gt; doesn&apos;t have the application prefix.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13278361">KAFKA-9390</key>
            <summary>Non-key joining of KTable not compatible with confluent avro serdes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vvcephei">John Roesler</assignee>
                                    <reporter username="kiwiandy">Andy Bryant</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jan 2020 05:20:17 +0000</created>
                <updated>Wed, 12 Feb 2020 00:30:04 +0000</updated>
                            <resolved>Wed, 12 Feb 2020 00:30:04 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>2.5.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17011426" author="kiwiandy" created="Thu, 9 Jan 2020 05:25:00 +0000"  >&lt;p&gt;Here&apos;s the code snippet. I&apos;m joining the orders table to the customers table using the customer key as the foreign key.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KTable&amp;lt;dbserver1.inventory.customers.Key, dbserver1.inventory.customers.Value&amp;gt; customersTable =
    CdcHelpers.valueTable(streams.customers(), &lt;span class=&quot;code-quote&quot;&gt;&quot;customersTable&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KTable&amp;lt;dbserver1.inventory.orders.Key, dbserver1.inventory.orders.Value&amp;gt; ordersTable =
    CdcHelpers.valueTable(streams.orders(), &lt;span class=&quot;code-quote&quot;&gt;&quot;ordersTable&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KTable&amp;lt;dbserver1.inventory.orders.Key, OrderView&amp;gt; enrichedOrders =
    ordersTable.join(
      customersTable,
      order -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; dbserver1.inventory.customers.Key(order.getPurchaser()),
      (order, customer) -&amp;gt;
          OrderView.newBuilder()
            .setCustomerName(customer.getFirstName() + &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt; + customer.getLastName())
            .setOrderId(order.getOrderNumber())
            .setOrderDate(LocalDate.fromDateFields(Date.valueOf(java.time.LocalDate.ofEpochDay(order.getOrderDate()))))
            .setOrderQuantity(order.getQuantity())
            .setProductName(&lt;span class=&quot;code-quote&quot;&gt;&quot;unknown&quot;&lt;/span&gt;)
            .setProductWeight(0.0d)
            .build(),
        Named.as(&lt;span class=&quot;code-quote&quot;&gt;&quot;wtf&quot;&lt;/span&gt;),
        AvroSerdes.materializedAs(&lt;span class=&quot;code-quote&quot;&gt;&quot;ordersWithCustomerxx&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17011427" author="kiwiandy" created="Thu, 9 Jan 2020 05:26:49 +0000"  >&lt;p&gt;Also I&apos;m using the 2.4 version of Kafka Streams with 5.3.2 version of confluent serdes (since 5.4 isn&apos;t out)&lt;/p&gt;</comment>
                            <comment id="17012167" author="guozhang" created="Thu, 9 Jan 2020 19:26:36 +0000"  >&lt;p&gt;There is a known issue I think since Confluent&apos;s SR do not allow nulls and hence we use a not-null dummy value. Not sure if there are still missing pieces out there. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbejeck&quot; class=&quot;user-hover&quot; rel=&quot;bbejeck&quot;&gt;bbejeck&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; could you take a look?&lt;/p&gt;</comment>
                            <comment id="17031928" author="githubbot" created="Thu, 6 Feb 2020 20:57:30 +0000"  >&lt;p&gt;vvcephei commented on pull request #8054: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9390&quot; title=&quot;Non-key joining of KTable not compatible with confluent avro serdes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9390&quot;&gt;&lt;del&gt;KAFKA-9390&lt;/del&gt;&lt;/a&gt;: Make serde pseudo-topics unique&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8054&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   During the discussion for KIP-213, we decided to pass &quot;pseudo-topics&quot;&lt;br/&gt;
   to the internal serdes we use to construct the wrapper serdes for&lt;br/&gt;
   CombinedKey and hashing the left-hand-side value. However, during&lt;br/&gt;
   the implementation, this strategy wasn&apos;t fully implemented, and we wound&lt;br/&gt;
   up using the same topic name for a few different data types.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17034931" author="githubbot" created="Tue, 11 Feb 2020 23:34:06 +0000"  >&lt;p&gt;vvcephei commented on pull request #8054: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9390&quot; title=&quot;Non-key joining of KTable not compatible with confluent avro serdes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9390&quot;&gt;&lt;del&gt;KAFKA-9390&lt;/del&gt;&lt;/a&gt;: Make serde pseudo-topics unique&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8054&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12968128">KAFKA-3705</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0abpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>