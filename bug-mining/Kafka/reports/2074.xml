<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:15:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7498] common.requests.CreatePartitionsRequest uses clients.admin.NewPartitions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7498</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;`org.apache.kafka.common.requests.CreatePartitionsRequest` currently uses `org.apache.kafka.clients.admin.NewPartitions`. We shouldn&apos;t have references from `common` to `clients`. Since `org.apache.kafka.clients.admin` is a public package, we cannot use a common class for Admin API and requests. So we should do something similar to CreateTopicsRequest for which we have `org.apache.kafka.clients.admin.NewTopic` class used for the admin API and an equivalent `org.apache.kafka.common.requests.CreateTopicsRequest.TopicDetails` class that doesn&apos;t refer to `clients.admin`.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13191028">KAFKA-7498</key>
            <summary>common.requests.CreatePartitionsRequest uses clients.admin.NewPartitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="rsivaram">Rajini Sivaram</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Oct 2018 18:55:31 +0000</created>
                <updated>Mon, 15 Oct 2018 12:31:54 +0000</updated>
                            <resolved>Mon, 15 Oct 2018 12:31:54 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16646962" author="githubbot" created="Thu, 11 Oct 2018 19:40:29 +0000"  >&lt;p&gt;rajinisivaram opened a new pull request #5784: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7498&quot; title=&quot;common.requests.CreatePartitionsRequest uses clients.admin.NewPartitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7498&quot;&gt;&lt;del&gt;KAFKA-7498&lt;/del&gt;&lt;/a&gt;: Remove references from `common.requests` to `clients`&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5784&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Add `CreatePartitionsRequest.PartitionDetails` similar to `CreateTopicsRequest.TopicDetails` to avoid references from `common.requests` to `clients`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16650131" author="githubbot" created="Mon, 15 Oct 2018 12:21:19 +0000"  >&lt;p&gt;rajinisivaram closed pull request #5784: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7498&quot; title=&quot;common.requests.CreatePartitionsRequest uses clients.admin.NewPartitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7498&quot;&gt;&lt;del&gt;KAFKA-7498&lt;/del&gt;&lt;/a&gt;: Remove references from `common.requests` to `clients`&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5784&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/checkstyle/import-control.xml b/checkstyle/import-control.xml&lt;br/&gt;
index 7810a3e8673..91d23f6424b 100644&lt;br/&gt;
&amp;#8212; a/checkstyle/import-control.xml&lt;br/&gt;
+++ b/checkstyle/import-control.xml&lt;br/&gt;
@@ -131,7 +131,6 @@&lt;br/&gt;
     &amp;lt;/subpackage&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;subpackage name=&quot;requests&quot;&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;allow pkg=&quot;org.apache.kafka.clients.admin&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;allow pkg=&quot;org.apache.kafka.common.acl&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;allow pkg=&quot;org.apache.kafka.common.protocol&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;allow pkg=&quot;org.apache.kafka.common.network&quot; /&amp;gt;&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java b/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
index 86e14476625..b4132840e4d 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
@@ -81,6 +81,7 @@&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateDelegationTokenRequest;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateDelegationTokenResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreatePartitionsRequest;&lt;br/&gt;
+import org.apache.kafka.common.requests.CreatePartitionsRequest.PartitionDetails;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreatePartitionsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateTopicsRequest;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateTopicsResponse;&lt;br/&gt;
@@ -142,6 +143,7 @@&lt;br/&gt;
 import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
 import java.util.concurrent.atomic.AtomicLong;&lt;br/&gt;
 import java.util.function.Predicate;&lt;br/&gt;
+import java.util.stream.Collectors;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import static org.apache.kafka.common.utils.Utils.closeQuietly;&lt;/p&gt;

&lt;p&gt;@@ -2083,7 +2085,8 @@ public CreatePartitionsResult createPartitions(Map&amp;lt;String, NewPartitions&amp;gt; newPar&lt;br/&gt;
         for (String topic : newPartitions.keySet()) &lt;/p&gt;
{
             futures.put(topic, new KafkaFutureImpl&amp;lt;&amp;gt;());
         }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final Map&amp;lt;String, NewPartitions&amp;gt; requestMap = new HashMap&amp;lt;&amp;gt;(newPartitions);&lt;br/&gt;
+        final Map&amp;lt;String, PartitionDetails&amp;gt; requestMap = newPartitions.entrySet().stream()&lt;br/&gt;
+                .collect(Collectors.toMap(Map.Entry::getKey, e -&amp;gt; partitionDetails(e.getValue())));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         final long now = time.milliseconds();&lt;br/&gt;
         runnable.call(new Call(&quot;createPartitions&quot;, calcDeadlineMs(now, options.timeoutMs()),&lt;br/&gt;
@@ -2482,6 +2485,10 @@ private boolean handleFindCoordinatorError(FindCoordinatorResponse response, Kaf&lt;br/&gt;
         return false;&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    private PartitionDetails partitionDetails(NewPartitions newPartitions) &lt;/p&gt;
{
+        return new PartitionDetails(newPartitions.totalCount(), newPartitions.assignments());
+    }
&lt;p&gt;+&lt;br/&gt;
     private final static class ListConsumerGroupsResults {&lt;br/&gt;
         private final List&amp;lt;Throwable&amp;gt; errors;&lt;br/&gt;
         private final HashMap&amp;lt;String, ConsumerGroupListing&amp;gt; listings;&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/common/requests/CreatePartitionsRequest.java b/clients/src/main/java/org/apache/kafka/common/requests/CreatePartitionsRequest.java&lt;br/&gt;
index 795a66a9ea6..7872cf9f8d0 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/common/requests/CreatePartitionsRequest.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/requests/CreatePartitionsRequest.java&lt;br/&gt;
@@ -17,7 +17,6 @@&lt;/p&gt;

&lt;p&gt; package org.apache.kafka.common.requests;&lt;/p&gt;

&lt;p&gt;-import org.apache.kafka.clients.admin.NewPartitions;&lt;br/&gt;
 import org.apache.kafka.common.protocol.ApiKeys;&lt;br/&gt;
 import org.apache.kafka.common.protocol.types.ArrayOf;&lt;br/&gt;
 import org.apache.kafka.common.protocol.types.Field;&lt;br/&gt;
@@ -72,17 +71,47 @@&lt;br/&gt;
     // It is an error for duplicate topics to be present in the request,&lt;br/&gt;
     // so track duplicates here to allow KafkaApis to report per-topic errors.&lt;br/&gt;
     private final Set&amp;lt;String&amp;gt; duplicates;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Map&amp;lt;String, NewPartitions&amp;gt; newPartitions;&lt;br/&gt;
+    private final Map&amp;lt;String, PartitionDetails&amp;gt; newPartitions;&lt;br/&gt;
     private final int timeout;&lt;br/&gt;
     private final boolean validateOnly;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    public static class PartitionDetails {&lt;br/&gt;
+&lt;br/&gt;
+        private final int totalCount;&lt;br/&gt;
+&lt;br/&gt;
+        private final List&amp;lt;List&amp;lt;Integer&amp;gt;&amp;gt; newAssignments;&lt;br/&gt;
+&lt;br/&gt;
+        public PartitionDetails(int totalCount) &lt;/p&gt;
{
+            this(totalCount, null);
+        }
&lt;p&gt;+&lt;br/&gt;
+        public PartitionDetails(int totalCount, List&amp;lt;List&amp;lt;Integer&amp;gt;&amp;gt; newAssignments) &lt;/p&gt;
{
+            this.totalCount = totalCount;
+            this.newAssignments = newAssignments;
+        }
&lt;p&gt;+&lt;br/&gt;
+        public int totalCount() &lt;/p&gt;
{
+            return totalCount;
+        }
&lt;p&gt;+&lt;br/&gt;
+        public List&amp;lt;List&amp;lt;Integer&amp;gt;&amp;gt; newAssignments() &lt;/p&gt;
{
+            return newAssignments;
+        }
&lt;p&gt;+&lt;br/&gt;
+        @Override&lt;br/&gt;
+        public String toString() &lt;/p&gt;
{
+            return &quot;(totalCount=&quot; + totalCount() + &quot;, newAssignments=&quot; + newAssignments() + &quot;)&quot;;
+        }
&lt;p&gt;+&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     public static class Builder extends AbstractRequest.Builder&amp;lt;CreatePartitionsRequest&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Map&amp;lt;String, NewPartitions&amp;gt; newPartitions;&lt;br/&gt;
+        private final Map&amp;lt;String, PartitionDetails&amp;gt; newPartitions;&lt;br/&gt;
         private final int timeout;&lt;br/&gt;
         private final boolean validateOnly;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public Builder(Map&amp;lt;String, NewPartitions&amp;gt; newPartitions, int timeout, boolean validateOnly) {&lt;br/&gt;
+        public Builder(Map&amp;lt;String, PartitionDetails&amp;gt; newPartitions, int timeout, boolean validateOnly) {&lt;br/&gt;
             super(ApiKeys.CREATE_PARTITIONS);&lt;br/&gt;
             this.newPartitions = newPartitions;&lt;br/&gt;
             this.timeout = timeout;&lt;br/&gt;
@@ -106,7 +135,7 @@ public String toString() {&lt;br/&gt;
         }&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CreatePartitionsRequest(Map&amp;lt;String, NewPartitions&amp;gt; newPartitions, int timeout, boolean validateOnly, short apiVersion) {&lt;br/&gt;
+    CreatePartitionsRequest(Map&amp;lt;String, PartitionDetails&amp;gt; newPartitions, int timeout, boolean validateOnly, short apiVersion) {&lt;br/&gt;
         super(ApiKeys.CREATE_PARTITIONS, apiVersion);&lt;br/&gt;
         this.newPartitions = newPartitions;&lt;br/&gt;
         this.duplicates = Collections.emptySet();&lt;br/&gt;
@@ -117,7 +146,7 @@ public String toString() {&lt;br/&gt;
     public CreatePartitionsRequest(Struct struct, short apiVersion) {&lt;br/&gt;
         super(ApiKeys.CREATE_PARTITIONS, apiVersion);&lt;br/&gt;
         Object[] topicCountArray = struct.getArray(TOPIC_PARTITIONS_KEY_NAME);&lt;/li&gt;
	&lt;li&gt;Map&amp;lt;String, NewPartitions&amp;gt; counts = new HashMap&amp;lt;&amp;gt;(topicCountArray.length);&lt;br/&gt;
+        Map&amp;lt;String, PartitionDetails&amp;gt; counts = new HashMap&amp;lt;&amp;gt;(topicCountArray.length);&lt;br/&gt;
         Set&amp;lt;String&amp;gt; dupes = new HashSet&amp;lt;&amp;gt;();&lt;br/&gt;
         for (Object topicPartitionCountObj : topicCountArray) {&lt;br/&gt;
             Struct topicPartitionCountStruct = (Struct) topicPartitionCountObj;&lt;br/&gt;
@@ -125,7 +154,7 @@ public CreatePartitionsRequest(Struct struct, short apiVersion) {&lt;br/&gt;
             Struct partitionCountStruct = topicPartitionCountStruct.getStruct(NEW_PARTITIONS_KEY_NAME);&lt;br/&gt;
             int count = partitionCountStruct.getInt(COUNT_KEY_NAME);&lt;br/&gt;
             Object[] assignmentsArray = partitionCountStruct.getArray(ASSIGNMENT_KEY_NAME);&lt;/li&gt;
	&lt;li&gt;NewPartitions newPartition;&lt;br/&gt;
+            PartitionDetails newPartition;&lt;br/&gt;
             if (assignmentsArray != null) {&lt;br/&gt;
                 List&amp;lt;List&amp;lt;Integer&amp;gt;&amp;gt; assignments = new ArrayList&amp;lt;&amp;gt;(assignmentsArray.length);&lt;br/&gt;
                 for (Object replicas : assignmentsArray) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {@@ -136,11 +165,11 @@ public CreatePartitionsRequest(Struct struct, short apiVersion) {
                         replicasList.add((Integer) broker);
                     }                 }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;newPartition = NewPartitions.increaseTo(count, assignments);&lt;br/&gt;
+                newPartition = new PartitionDetails(count, assignments);&lt;br/&gt;
             } else 
{
-                newPartition = NewPartitions.increaseTo(count);
+                newPartition = new PartitionDetails(count);
             }&lt;/li&gt;
	&lt;li&gt;NewPartitions dupe = counts.put(topic, newPartition);&lt;br/&gt;
+            PartitionDetails dupe = counts.put(topic, newPartition);&lt;br/&gt;
             if (dupe != null) 
{
                 dupes.add(topic);
             }
&lt;p&gt;@@ -155,7 +184,7 @@ public CreatePartitionsRequest(Struct struct, short apiVersion) &lt;/p&gt;
{
         return duplicates;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public Map&amp;lt;String, NewPartitions&amp;gt; newPartitions() {&lt;br/&gt;
+    public Map&amp;lt;String, PartitionDetails&amp;gt; newPartitions() 
{
         return newPartitions;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -171,17 +200,17 @@ public boolean validateOnly() {&lt;br/&gt;
     protected Struct toStruct() {&lt;br/&gt;
         Struct struct = new Struct(ApiKeys.CREATE_PARTITIONS.requestSchema(version()));&lt;br/&gt;
         List&amp;lt;Struct&amp;gt; topicPartitionsList = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (Map.Entry&amp;lt;String, NewPartitions&amp;gt; topicPartitionCount : this.newPartitions.entrySet()) {&lt;br/&gt;
+        for (Map.Entry&amp;lt;String, PartitionDetails&amp;gt; topicPartitionCount : this.newPartitions.entrySet()) {&lt;br/&gt;
             Struct topicPartitionCountStruct = struct.instance(TOPIC_PARTITIONS_KEY_NAME);&lt;br/&gt;
             topicPartitionCountStruct.set(TOPIC_NAME, topicPartitionCount.getKey());&lt;/li&gt;
	&lt;li&gt;NewPartitions count = topicPartitionCount.getValue();&lt;br/&gt;
+            PartitionDetails partitionDetails = topicPartitionCount.getValue();&lt;br/&gt;
             Struct partitionCountStruct = topicPartitionCountStruct.instance(NEW_PARTITIONS_KEY_NAME);&lt;/li&gt;
	&lt;li&gt;partitionCountStruct.set(COUNT_KEY_NAME, count.totalCount());&lt;br/&gt;
+            partitionCountStruct.set(COUNT_KEY_NAME, partitionDetails.totalCount());&lt;br/&gt;
             Object[][] assignments = null;&lt;/li&gt;
	&lt;li&gt;if (count.assignments() != null) {&lt;/li&gt;
	&lt;li&gt;assignments = new Object&lt;span class=&quot;error&quot;&gt;&amp;#91;count.assignments().size()&amp;#93;&lt;/span&gt;[];&lt;br/&gt;
+            if (partitionDetails.newAssignments() != null) {&lt;br/&gt;
+                assignments = new Object&lt;span class=&quot;error&quot;&gt;&amp;#91;partitionDetails.newAssignments().size()&amp;#93;&lt;/span&gt;[];&lt;br/&gt;
                 int i = 0;&lt;/li&gt;
	&lt;li&gt;for (List&amp;lt;Integer&amp;gt; partitionAssignment : count.assignments()) {&lt;br/&gt;
+                for (List&amp;lt;Integer&amp;gt; partitionAssignment : partitionDetails.newAssignments()) 
{
                     assignments[i] = partitionAssignment.toArray(new Object[0]);
                     i++;
                 }
&lt;p&gt;diff --git a/clients/src/test/java/org/apache/kafka/common/requests/RequestResponseTest.java b/clients/src/test/java/org/apache/kafka/common/requests/RequestResponseTest.java&lt;br/&gt;
index e34348a6da3..b7f39ef9d67 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/clients/src/test/java/org/apache/kafka/common/requests/RequestResponseTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/common/requests/RequestResponseTest.java&lt;br/&gt;
@@ -16,7 +16,6 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.kafka.common.requests;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import org.apache.kafka.clients.admin.NewPartitions;&lt;br/&gt;
 import org.apache.kafka.common.Node;&lt;br/&gt;
 import org.apache.kafka.common.TopicPartition;&lt;br/&gt;
 import org.apache.kafka.common.acl.AccessControlEntry;&lt;br/&gt;
@@ -44,6 +43,7 @@&lt;br/&gt;
 import org.apache.kafka.common.record.SimpleRecord;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateAclsRequest.AclCreation;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateAclsResponse.AclCreationResponse;&lt;br/&gt;
+import org.apache.kafka.common.requests.CreatePartitionsRequest.PartitionDetails;&lt;br/&gt;
 import org.apache.kafka.common.requests.DeleteAclsResponse.AclDeletionResult;&lt;br/&gt;
 import org.apache.kafka.common.requests.DeleteAclsResponse.AclFilterResponse;&lt;br/&gt;
 import org.apache.kafka.common.resource.PatternType;&lt;br/&gt;
@@ -1214,16 +1214,16 @@ private AlterConfigsResponse createAlterConfigsResponse() {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     private CreatePartitionsRequest createCreatePartitionsRequest() &lt;/p&gt;
{
-        Map&amp;lt;String, NewPartitions&amp;gt; assignments = new HashMap&amp;lt;&amp;gt;();
-        assignments.put(&quot;my_topic&quot;, NewPartitions.increaseTo(3));
-        assignments.put(&quot;my_other_topic&quot;, NewPartitions.increaseTo(3));
+        Map&amp;lt;String, PartitionDetails&amp;gt; assignments = new HashMap&amp;lt;&amp;gt;();
+        assignments.put(&quot;my_topic&quot;, new PartitionDetails(3));
+        assignments.put(&quot;my_other_topic&quot;, new PartitionDetails(3));
         return new CreatePartitionsRequest(assignments, 0, false, (short) 0);
     }

&lt;p&gt;     private CreatePartitionsRequest createCreatePartitionsRequestWithAssignments() &lt;/p&gt;
{
-        Map&amp;lt;String, NewPartitions&amp;gt; assignments = new HashMap&amp;lt;&amp;gt;();
-        assignments.put(&quot;my_topic&quot;, NewPartitions.increaseTo(3, asList(asList(2))));
-        assignments.put(&quot;my_other_topic&quot;, NewPartitions.increaseTo(3, asList(asList(2, 3), asList(3, 1))));
+        Map&amp;lt;String, PartitionDetails&amp;gt; assignments = new HashMap&amp;lt;&amp;gt;();
+        assignments.put(&quot;my_topic&quot;, new PartitionDetails(3, asList(asList(2))));
+        assignments.put(&quot;my_other_topic&quot;, new PartitionDetails(3, asList(asList(2, 3), asList(3, 1))));
         return new CreatePartitionsRequest(assignments, 0, false, (short) 0);
     }

&lt;p&gt;diff --git a/core/src/main/scala/kafka/server/AdminManager.scala b/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
index 2b481702c45..4ec083a5f14 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/server/AdminManager.scala&lt;br/&gt;
@@ -24,13 +24,13 @@ import kafka.log.LogConfig&lt;br/&gt;
 import kafka.metrics.KafkaMetricsGroup&lt;br/&gt;
 import kafka.utils._&lt;br/&gt;
 import kafka.zk.&lt;/p&gt;
{AdminZkClient, KafkaZkClient}
&lt;p&gt;-import org.apache.kafka.clients.admin.NewPartitions&lt;br/&gt;
 import org.apache.kafka.common.config.&lt;/p&gt;
{AbstractConfig, ConfigDef, ConfigException, ConfigResource}
&lt;p&gt; import org.apache.kafka.common.errors.&lt;/p&gt;
{ApiException, InvalidPartitionsException, InvalidReplicaAssignmentException, InvalidRequestException, ReassignmentInProgressException, UnknownTopicOrPartitionException, InvalidConfigurationException}
&lt;p&gt; import org.apache.kafka.common.internals.Topic&lt;br/&gt;
 import org.apache.kafka.common.metrics.Metrics&lt;br/&gt;
 import org.apache.kafka.common.network.ListenerName&lt;br/&gt;
 import org.apache.kafka.common.protocol.Errors&lt;br/&gt;
+import org.apache.kafka.common.requests.CreatePartitionsRequest.PartitionDetails&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateTopicsRequest._&lt;br/&gt;
 import org.apache.kafka.common.requests.DescribeConfigsResponse.ConfigSource&lt;br/&gt;
 import org.apache.kafka.common.requests.&lt;/p&gt;
{AlterConfigsRequest, ApiError, DescribeConfigsResponse}
&lt;p&gt;@@ -204,7 +204,7 @@ class AdminManager(val config: KafkaConfig,&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   def createPartitions(timeout: Int,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;newPartitions: Map&lt;span class=&quot;error&quot;&gt;&amp;#91;String, NewPartitions&amp;#93;&lt;/span&gt;,&lt;br/&gt;
+                       newPartitions: Map&lt;span class=&quot;error&quot;&gt;&amp;#91;String, PartitionDetails&amp;#93;&lt;/span&gt;,&lt;br/&gt;
                        validateOnly: Boolean,&lt;br/&gt;
                        listenerName: ListenerName,&lt;br/&gt;
                        callback: Map&lt;span class=&quot;error&quot;&gt;&amp;#91;String, ApiError&amp;#93;&lt;/span&gt; =&amp;gt; Unit): Unit = 
{
@@ -237,7 +237,7 @@ class AdminManager(val config: KafkaConfig,
           throw new InvalidPartitionsException(s&quot;Topic already has $oldNumPartitions partitions.&quot;)
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val reassignment = Option(newPartition.assignments).map(&lt;em&gt;.asScala.map(&lt;/em&gt;.asScala.map(_.toInt))).map { assignments =&amp;gt;&lt;br/&gt;
+        val reassignment = Option(newPartition.newAssignments).map(&lt;em&gt;.asScala.map(&lt;/em&gt;.asScala.map(_.toInt))).map { assignments =&amp;gt;&lt;br/&gt;
           val unknownBrokers = assignments.flatten.toSet &amp;#8211; allBrokerIds&lt;br/&gt;
           if (unknownBrokers.nonEmpty)&lt;br/&gt;
             throw new InvalidReplicaAssignmentException(&lt;br/&gt;
diff --git a/core/src/main/scala/kafka/server/KafkaApis.scala b/core/src/main/scala/kafka/server/KafkaApis.scala&lt;br/&gt;
index ecbbdb6f03f..6a99db31a14 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/core/src/main/scala/kafka/server/KafkaApis.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/server/KafkaApis.scala&lt;br/&gt;
@@ -31,8 +31,7 @@ import kafka.common.OffsetAndMetadata&lt;br/&gt;
 import kafka.controller.KafkaController&lt;br/&gt;
 import kafka.coordinator.group.
{GroupCoordinator, JoinGroupResult}
&lt;p&gt; import kafka.coordinator.transaction.&lt;/p&gt;
{InitProducerIdResult, TransactionCoordinator}
&lt;p&gt;-import kafka.log.&lt;/p&gt;
{Log, LogManager, TimestampOffset}
&lt;p&gt;-import kafka.message.&lt;/p&gt;
{CompressionCodec, NoCompressionCodec, ZStdCompressionCodec}
&lt;p&gt;+import kafka.message.ZStdCompressionCodec&lt;br/&gt;
 import kafka.network.RequestChannel&lt;br/&gt;
 import kafka.security.SecurityUtils&lt;br/&gt;
 import kafka.security.auth.&lt;/p&gt;
{Resource, _}
&lt;p&gt;@@ -49,6 +48,7 @@ import org.apache.kafka.common.network.&lt;/p&gt;
{ListenerName, Send}
&lt;p&gt; import org.apache.kafka.common.protocol.&lt;/p&gt;
{ApiKeys, Errors}
&lt;p&gt; import org.apache.kafka.common.record.&lt;/p&gt;
{BaseRecords, ControlRecordType, EndTransactionMarker, LazyDownConversionRecords, MemoryRecords, MultiRecordsSend, RecordBatch, RecordConversionStats, Records}
&lt;p&gt; import org.apache.kafka.common.requests.CreateAclsResponse.AclCreationResponse&lt;br/&gt;
+import org.apache.kafka.common.requests.CreateTopicsRequest.TopicDetails&lt;br/&gt;
 import org.apache.kafka.common.requests.DeleteAclsResponse.&lt;/p&gt;
{AclDeletionResult, AclFilterResponse}
&lt;p&gt; import org.apache.kafka.common.requests.DescribeLogDirsResponse.LogDirInfo&lt;br/&gt;
 import org.apache.kafka.common.requests.ProduceResponse.PartitionResponse&lt;br/&gt;
@@ -64,7 +64,6 @@ import scala.collection.JavaConverters._&lt;br/&gt;
 import scala.collection._&lt;br/&gt;
 import scala.collection.mutable.ArrayBuffer&lt;br/&gt;
 import scala.util.&lt;/p&gt;
{Failure, Success, Try}
&lt;p&gt;-import org.apache.kafka.common.requests.CreateTopicsRequest.TopicDetails&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Logic to handle the various Kafka requests&lt;br/&gt;
diff --git a/core/src/test/scala/integration/kafka/api/AuthorizerIntegrationTest.scala b/core/src/test/scala/integration/kafka/api/AuthorizerIntegrationTest.scala&lt;br/&gt;
index ae6273623ae..a2f10498666 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/core/src/test/scala/integration/kafka/api/AuthorizerIntegrationTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/integration/kafka/api/AuthorizerIntegrationTest.scala&lt;br/&gt;
@@ -324,7 +324,7 @@ class AuthorizerIntegrationTest extends BaseRequestTest {&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   private def createPartitionsRequest = &lt;/p&gt;
{
     new CreatePartitionsRequest.Builder(
-      Map(topic -&amp;gt; NewPartitions.increaseTo(10)).asJava, 10000, true
+      Map(topic -&amp;gt; new CreatePartitionsRequest.PartitionDetails(10)).asJava, 10000, true
     ).build()
   }

&lt;p&gt;diff --git a/core/src/test/scala/unit/kafka/server/RequestQuotaTest.scala b/core/src/test/scala/unit/kafka/server/RequestQuotaTest.scala&lt;br/&gt;
index 3604385f6ad..f2d3b4a1cad 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/server/RequestQuotaTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/server/RequestQuotaTest.scala&lt;br/&gt;
@@ -22,7 +22,6 @@ import kafka.log.LogConfig&lt;br/&gt;
 import kafka.network.RequestChannel.Session&lt;br/&gt;
 import kafka.security.auth._&lt;br/&gt;
 import kafka.utils.TestUtils&lt;br/&gt;
-import org.apache.kafka.clients.admin.NewPartitions&lt;br/&gt;
 import org.apache.kafka.common.acl.&lt;/p&gt;
{AccessControlEntry, AccessControlEntryFilter, AclBinding, AclBindingFilter, AclOperation, AclPermissionType}
&lt;p&gt; import org.apache.kafka.common.config.ConfigResource&lt;br/&gt;
 import org.apache.kafka.common.resource.&lt;/p&gt;
{PatternType, ResourcePattern, ResourcePatternFilter, ResourceType =&amp;gt; AdminResourceType}
&lt;p&gt;@@ -342,7 +341,7 @@ class RequestQuotaTest extends BaseRequestTest {&lt;/p&gt;

&lt;p&gt;         case ApiKeys.CREATE_PARTITIONS =&amp;gt;&lt;br/&gt;
           new CreatePartitionsRequest.Builder(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Collections.singletonMap(&quot;topic-2&quot;, NewPartitions.increaseTo(1)), 0, false&lt;br/&gt;
+            Collections.singletonMap(&quot;topic-2&quot;, new CreatePartitionsRequest.PartitionDetails(1)), 0, false&lt;br/&gt;
           )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         case ApiKeys.CREATE_DELEGATION_TOKEN =&amp;gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3z3pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ijuma</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>