<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2189] Snappy compression of message batches less efficient in 0.8.2.1</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2189</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We are using snappy compression and noticed a fairly substantial increase (about 2.25x) in log filesystem space consumption after upgrading a Kafka cluster from 0.8.1.1 to 0.8.2.1. We found that this is caused by messages being seemingly recompressed individually (or possibly with a much smaller buffer or dictionary?) instead of as a batch as sent by producers. We eventually tracked down the change in compression ratio/scope to this &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; commit that updated the snappy version from 1.0.5 to 1.1.1.3. The Kafka client version does not appear to be relevant as we can reproduce this with both the 0.8.1.1 and 0.8.2.1 Producer.&lt;/p&gt;

&lt;p&gt;Here are the log files from our troubleshooting that contain the same set of 1000 messages, for batch sizes of 1, 10, 100, and 1000. f9d9b was the last commit with 0.8.1.1-like behavior prior to f5ab8 introducing the issue.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-rw-rw-r-- 1 kafka kafka 404967 May 12 11:45 /var/kafka2/f9d9b-batch-1-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka 119951 May 12 11:45 /var/kafka2/f9d9b-batch-10-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka  89645 May 12 11:45 /var/kafka2/f9d9b-batch-100-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka  88279 May 12 11:45 /var/kafka2/f9d9b-batch-1000-0/00000000000000000000.log

-rw-rw-r-- 1 kafka kafka 402837 May 12 11:41 /var/kafka2/f5ab8-batch-1-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka 382437 May 12 11:41 /var/kafka2/f5ab8-batch-10-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka 364791 May 12 11:41 /var/kafka2/f5ab8-batch-100-0/00000000000000000000.log
-rw-rw-r-- 1 kafka kafka 380693 May 12 11:41 /var/kafka2/f5ab8-batch-1000-0/00000000000000000000.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/commit/f5ab8e1780cf80f267906e3259ad4f9278c32d28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/f5ab8e1780cf80f267906e3259ad4f9278c32d28&lt;/a&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12829259">KAFKA-2189</key>
            <summary>Snappy compression of message batches less efficient in 0.8.2.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="AOLSON1@CERNER.COM">Olson,Andrew</reporter>
                        <labels>
                            <label>trivial</label>
                    </labels>
                <created>Tue, 12 May 2015 17:27:55 +0000</created>
                <updated>Thu, 8 Oct 2015 17:01:39 +0000</updated>
                            <resolved>Thu, 28 May 2015 17:16:42 +0000</resolved>
                                    <version>0.8.2.1</version>
                                    <fixVersion>0.8.2.2</fixVersion>
                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>build</component>
                    <component>compression</component>
                    <component>log</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14540351" author="aolson1@cerner.com" created="Tue, 12 May 2015 17:57:28 +0000"  >&lt;p&gt;I have verified that the issue &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; was introduced in snappy-java 1.1.1.2 and has already been fixed &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;, in snappy-java 1.1.1.7.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/xerial/snappy-java/issues/100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/xerial/snappy-java/issues/100&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/xerial/snappy-java/commit/dc2dd27f85e5167961883f71ac2681b73b33e5df&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/xerial/snappy-java/commit/dc2dd27f85e5167961883f71ac2681b73b33e5df&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14541106" author="ijuma" created="Wed, 13 May 2015 00:37:47 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34144/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34144/diff/&lt;/a&gt;&lt;br/&gt;
 against branch upstream/trunk&lt;/p&gt;</comment>
                            <comment id="14541964" author="aolson1@cerner.com" created="Wed, 13 May 2015 14:12:40 +0000"  >&lt;p&gt;Everything looks good so far in our development environment, the log file sizes were returned back to the 0.8.1.1 baseline when we replaced 1.1.1.6 with 1.1.1.7 in the broker libs. Producer/broker performance was the same or in some cases better.&lt;/p&gt;

&lt;p&gt;Should be moving this change into production within the next couple of days to free up some disk space, will update again once we have been running 1.1.1.7 in prod for a few days.&lt;/p&gt;</comment>
                            <comment id="14551102" author="aolson1@cerner.com" created="Tue, 19 May 2015 19:54:51 +0000"  >&lt;p&gt;We&apos;ve been running with snappy-java 1.1.1.7 in production for four days now with no issues.&lt;/p&gt;</comment>
                            <comment id="14562470" author="ijuma" created="Thu, 28 May 2015 08:11:38 +0000"  >&lt;p&gt;Given the positive feedback, it seems like it would be good to get this merged so that more people can test it before the final release?&lt;/p&gt;</comment>
                            <comment id="14563273" author="junrao" created="Thu, 28 May 2015 17:16:42 +0000"  >&lt;p&gt;Thanks for the patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14695589" author="ottomata" created="Thu, 13 Aug 2015 17:13:00 +0000"  >&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;The Wikimedia Foundation had a serious production issue when we upgraded to 0.8.2.1 because of this bug.  Snappy compression doesn&apos;t work at scale in 0.8.2.1.  I know 0.8.3 is slated for release soon, maybe you should consider doing a 0.8.2.2 release just to get this out there in a stable tag, so that others don&apos;t run into this issue.&lt;/p&gt;</comment>
                            <comment id="14908553" author="jshaw86" created="Fri, 25 Sep 2015 19:30:02 +0000"  >&lt;p&gt;Hi all,&lt;br/&gt;
I was wondering if this affects only 0.8.2.1 or also 0.8.2? We are on 0.8.2 and just did a complete rebalance across our brokers and some brokers are at 70% disk utilization and some are at 30%. Thanks.&lt;/p&gt;</comment>
                            <comment id="14908770" author="junrao" created="Fri, 25 Sep 2015 22:27:33 +0000"  >&lt;p&gt;0.8.2.0 has the same problem since it depends on snappy-java 1.1.1.6.&lt;/p&gt;</comment>
                            <comment id="14948972" author="jbrosenberg@gmail.com" created="Thu, 8 Oct 2015 16:43:32 +0000"  >&lt;p&gt;quick question, I assume there should be no issues with upgrading brokers and/or producers/consumers independently with this change?  E.g. can snappy 1.1.1.6 and 1.1.1.7 interoperate without any compatibility issues?&lt;/p&gt;</comment>
                            <comment id="14948989" author="noslowerdna" created="Thu, 8 Oct 2015 17:01:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbrosenberg%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jbrosenberg@gmail.com&quot;&gt;jbrosenberg@gmail.com&lt;/a&gt; Yes your assumption is correct, this was only an efficiency/chunking issue and not any protocol incompatibility.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12732439" name="KAFKA-2189.patch" size="919" author="ijuma" created="Wed, 13 May 2015 00:37:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2emr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>