<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6503] Connect: Plugin scan is very slow</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6503</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Just upgraded to 1.0.0. It seems some plugin scan has been introduced. It is very slow - see logs from starting my Kafka-Connect instance at the bottom. It takes almost 4 minutes scanning. I am running Kafka-Connect in docker based on confluentinc/cp-kafka-connect:4.0.0. I set plugin.path to /usr/share/java. The only thing I have added is a 13MB jar in /usr/share/java/kafka-connect-file-streamer-client containing two connectors and a converter. That one alone seems to take 20 secs.&lt;/p&gt;

&lt;p&gt;If it was just scanning in the background, and everything was working it probably would not be a big issue. But it does not. Right after starting the Kafka-Connect instance I try to create a connector via the /connectors endpoint, but it will not succeed before the plugin scanning has finished (4 minutes)&lt;/p&gt;

&lt;p&gt;I am not even sure why scanning is necessary. Is it not always true that connectors, converters etc are mentioned by name, so to see if it exists, just try to load the class - the classloader will tell if it is available. Hmmm, there is probably a reason.&lt;/p&gt;

&lt;p&gt;Anyway, either it should be made much faster, or at least Kafka-Connect should be fully functional (or as functional as possible) while scanning is going on.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-01-30 13:52:26,834] INFO Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; plugin classes. This might take a moment ... (org.apache.kafka.connect.cli.ConnectDistributed)
[2018-01-30 13:52:27,218] INFO Loading plugin from: /usr/share/java/kafka-connect-file-streamer-client (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:43,037] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-file-streamer-client/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:43,038] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.OneTaskPerStreamSourceConnectorManager&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:43,039] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.OneTaskPerFilesStreamerServerSourceConnectorManager&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:43,040] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.KafkaConnectByteArrayConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:43,049] INFO Loading plugin from: /usr/share/java/kafka-connect-elasticsearch (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:47,595] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-elasticsearch/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:47,611] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.elasticsearch.ElasticsearchSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:47,651] INFO Loading plugin from: /usr/share/java/kafka-connect-jdbc (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:49,491] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-jdbc/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:49,491] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.jdbc.JdbcSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:49,492] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.jdbc.JdbcSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:52:49,663] INFO Loading plugin from: /usr/share/java/kafka-connect-s3 (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:53:51,055] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-s3/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:53:51,055] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.s3.S3SinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:53:51,061] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.storage.tools.SchemaSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:53:51,064] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.avro.AvroConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:53:52,745] INFO Loading plugin from: /usr/share/java/kafka-connect-storage-common (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:25,800] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-storage-common/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:26,402] INFO Loading plugin from: /usr/share/java/kafka-connect-hdfs (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:58,104] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-connect-hdfs/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:58,104] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.hdfs.tools.SchemaSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:58,104] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.hdfs.HdfsSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:54:58,508] INFO Loading plugin from: /usr/share/java/monitoring-interceptors (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:00,714] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/monitoring-interceptors/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:00,715] INFO Loading plugin from: /usr/share/java/kafka-serde-tools (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:03,900] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka-serde-tools/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:03,911] INFO Loading plugin from: /usr/share/java/confluent-rebalancer (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:11,702] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/confluent-rebalancer/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:11,722] INFO Loading plugin from: /usr/share/java/confluent-control-center (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,874] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/confluent-control-center/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,875] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,875] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.SchemaSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,876] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,876] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,876] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.VerifiableSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,877] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.VerifiableSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,878] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.converters.ByteArrayConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,878] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.storage.StringConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,879] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.json.JsonConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,879] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.Cast$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,879] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.Flatten$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,880] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.TimestampConverter$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,880] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.Cast$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,881] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.MaskField$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,881] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.TimestampRouter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,882] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ExtractField$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,882] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.TimestampConverter$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,896] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.MaskField$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,904] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ExtractField$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,904] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.Flatten$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,905] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ValueToKey&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,905] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.HoistField$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,905] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.HoistField$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,906] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ReplaceField$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,914] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.InsertField$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,914] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.InsertField$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,915] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.SetSchemaMetadata$Value&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,915] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.RegexRouter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,915] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.SetSchemaMetadata$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,915] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ReplaceField$Key&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:21,919] INFO Loading plugin from: /usr/share/java/confluent-common (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:23,165] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/confluent-common/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:23,175] INFO Loading plugin from: /usr/share/java/kafka (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:41,996] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/kafka/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:41,997] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.file.FileStreamSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:41,998] INFO Added plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.file.FileStreamSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:42,021] INFO Loading plugin from: /usr/share/java/confluent-serializers (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:44,081] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/confluent-serializers/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:44,089] INFO Loading plugin from: /usr/share/java/schema-registry (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:49,504] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/schema-registry/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:49,541] INFO Loading plugin from: /usr/share/java/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-utils (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:55:52,094] INFO Registered loader: PluginClassLoader{pluginLocation=file:/usr/share/java/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-utils/} (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,632] INFO Registered loader: sun.misc.Launcher$AppClassLoader@18b4aac2 (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,659] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;OneTaskPerFilesStreamerServerSourceConnectorManager&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;OneTaskPerFilesStreamerServerSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.OneTaskPerFilesStreamerServerSourceConnectorManager&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,663] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;OneTaskPerStreamSourceConnectorManager&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;OneTaskPerStreamSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.OneTaskPerStreamSourceConnectorManager&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,665] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;ElasticsearchSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;ElasticsearchSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.elasticsearch.ElasticsearchSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,667] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;HdfsSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;HdfsSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.hdfs.HdfsSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,668] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;JdbcSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;JdbcSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.jdbc.JdbcSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,670] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;JdbcSourceConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;JdbcSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.jdbc.JdbcSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,672] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;S3SinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;S3Sink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.s3.S3SinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,673] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;FileStreamSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;FileStreamSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.file.FileStreamSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,695] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;FileStreamSourceConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;FileStreamSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.file.FileStreamSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,697] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;MockConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;Mock&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,699] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;MockSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;MockSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,700] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;MockSourceConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;MockSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.MockSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,702] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;VerifiableSinkConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;VerifiableSink&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.VerifiableSinkConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,705] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;VerifiableSourceConnector&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;VerifiableSource&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.tools.VerifiableSourceConnector&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,706] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;KafkaConnectByteArrayConverter&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;KafkaConnectByteArray&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;com.tlt.common.files.streamer.client.kafka.connect.KafkaConnectByteArrayConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,711] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;AvroConverter&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;Avro&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;io.confluent.connect.avro.AvroConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,711] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;ByteArrayConverter&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;ByteArray&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.converters.ByteArrayConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,715] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;JsonConverter&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;Json&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.json.JsonConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,715] INFO Added aliases &lt;span class=&quot;code-quote&quot;&gt;&apos;StringConverter&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.storage.StringConverter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,727] INFO Added alias &lt;span class=&quot;code-quote&quot;&gt;&apos;RegexRouter&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.RegexRouter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,738] INFO Added alias &lt;span class=&quot;code-quote&quot;&gt;&apos;TimestampRouter&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.TimestampRouter&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
[2018-01-30 13:56:14,739] INFO Added alias &lt;span class=&quot;code-quote&quot;&gt;&apos;ValueToKey&apos;&lt;/span&gt; to plugin &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.connect.transforms.ValueToKey&apos;&lt;/span&gt; (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13134766">KAFKA-6503</key>
            <summary>Connect: Plugin scan is very slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rayokota">Robert Yokota</assignee>
                                    <reporter username="steff1193">Per Steffensen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jan 2018 14:20:06 +0000</created>
                <updated>Wed, 25 Apr 2018 09:42:10 +0000</updated>
                            <resolved>Thu, 15 Feb 2018 00:25:19 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16347021" author="rhauch" created="Wed, 31 Jan 2018 15:34:08 +0000"  >&lt;p&gt;Very similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6208&quot; title=&quot;Reduce startup time for Kafka Connect workers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6208&quot;&gt;&lt;del&gt;KAFKA-6208&lt;/del&gt;&lt;/a&gt;, but the latter actually proposes using the ServiceLoader mechanism that requires connector, transform, and converter implementations to supply an additional file in their JARs. That will take a number of releases to do, so this should be our long term directly.&lt;/p&gt;

&lt;p&gt;In the meantime, we should try to speed up or optimize scanning for a short term win.&lt;/p&gt;</comment>
                            <comment id="16347234" author="rhauch" created="Wed, 31 Jan 2018 17:30:27 +0000"  >&lt;p&gt;Specifically, we&apos;re not using an executor when scanning:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        ConfigurationBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationBuilder();
        builder.setClassLoaders(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;[]{loader});
        builder.addUrls(urls);
        Reflections reflections = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Reflections(builder);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When no executor is used, then scanning is done in a single thread. However, we are supplying more than a few URLs, so we should be able to parallelize this by providing an executor. Reflections actually has a method that will create an executor sized with the number of processors:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        ConfigurationBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationBuilder();
        builder.setClassLoaders(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;[]{loader});
        builder.addUrls(urls);
        builder.useParallelExecutor();
        Reflections reflections = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Reflections(builder);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The challenge is that on Docker with older JRE 8 releases, the JVM won&apos;t report the correct number of processors. We might just have to deal with that, though.&lt;/p&gt;</comment>
                            <comment id="16361616" author="githubbot" created="Tue, 13 Feb 2018 00:02:49 +0000"  >&lt;p&gt;rayokota opened a new pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is a one-liner to parallelize plugin scanning.  This may help in some environments where otherwise plugin scanning is slow.&lt;/p&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16361812" author="githubbot" created="Tue, 13 Feb 2018 04:40:39 +0000"  >&lt;p&gt;rayokota closed pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
index 345d7ef011d..c57caac9cba 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
@@ -269,6 +269,7 @@ private PluginScanResult scanPluginPath(&lt;br/&gt;
         ConfigurationBuilder builder = new ConfigurationBuilder();&lt;br/&gt;
         builder.setClassLoaders(new ClassLoader[]&lt;/p&gt;
{loader}
&lt;p&gt;);&lt;br/&gt;
         builder.addUrls(urls);&lt;br/&gt;
+        builder.useParallelExecutor();&lt;br/&gt;
         Reflections reflections = new Reflections(builder);&lt;/p&gt;

&lt;p&gt;         return new PluginScanResult(&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16362930" author="githubbot" created="Tue, 13 Feb 2018 19:39:00 +0000"  >&lt;p&gt;rayokota opened a new pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is a one-liner to parallelize plugin scanning.  This may help in some environments where otherwise plugin scanning is slow.&lt;/p&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16362931" author="githubbot" created="Tue, 13 Feb 2018 19:39:24 +0000"  >&lt;p&gt;rayokota closed pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
index 345d7ef011d..e4a54d621c5 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
@@ -20,7 +20,10 @@&lt;br/&gt;
 import org.apache.kafka.connect.storage.Converter;&lt;br/&gt;
 import org.apache.kafka.connect.storage.HeaderConverter;&lt;br/&gt;
 import org.apache.kafka.connect.transforms.Transformation;&lt;br/&gt;
+import org.reflections.Configuration;&lt;br/&gt;
 import org.reflections.Reflections;&lt;br/&gt;
+import org.reflections.ReflectionsException;&lt;br/&gt;
+import org.reflections.scanners.SubTypesScanner;&lt;br/&gt;
 import org.reflections.util.ClasspathHelper;&lt;br/&gt;
 import org.reflections.util.ConfigurationBuilder;&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
@@ -269,7 +272,10 @@ private PluginScanResult scanPluginPath(&lt;br/&gt;
         ConfigurationBuilder builder = new ConfigurationBuilder();&lt;br/&gt;
         builder.setClassLoaders(new ClassLoader[]&lt;/p&gt;
{loader}
&lt;p&gt;);&lt;br/&gt;
         builder.addUrls(urls);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Reflections reflections = new Reflections(builder);&lt;br/&gt;
+        builder.setScanners(new SubTypesScanner());&lt;br/&gt;
+        builder.setExpandSuperTypes(false);&lt;br/&gt;
+        builder.useParallelExecutor();&lt;br/&gt;
+        Reflections reflections = new InternalReflections(builder);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         return new PluginScanResult(&lt;br/&gt;
                 getPluginDesc(reflections, Connector.class, loader),&lt;br/&gt;
@@ -353,4 +359,24 @@ private void addAllAliases() {&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;br/&gt;
     }&lt;br/&gt;
+&lt;br/&gt;
+    private static class InternalReflections extends Reflections {&lt;br/&gt;
+&lt;br/&gt;
+        public InternalReflections(final Configuration configuration) &lt;/p&gt;
{
+            super(configuration);
+        }
&lt;p&gt;+&lt;br/&gt;
+        // When Reflections is used for parallel scans, it has a bug where it propagates ReflectionsException&lt;br/&gt;
+        // as RuntimeException.  Override the scan behavior to emulate the singled-threaded logic.&lt;br/&gt;
+        protected void scan(URL url) {&lt;br/&gt;
+            try &lt;/p&gt;
{
+                super.scan(url);
+            }
&lt;p&gt; catch (ReflectionsException e) {&lt;br/&gt;
+                Logger log = Reflections.log;&lt;br/&gt;
+                if (log != null &amp;amp;&amp;amp; log.isWarnEnabled()) &lt;/p&gt;
{
+                    log.warn(&quot;could not create Vfs.Dir from url. ignoring the exception and continuing&quot;, e);
+                }
&lt;p&gt;+            }&lt;br/&gt;
+        }&lt;br/&gt;
+    }&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16362933" author="githubbot" created="Tue, 13 Feb 2018 19:41:50 +0000"  >&lt;p&gt;rayokota opened a new pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is a one-liner to parallelize plugin scanning.  This may help in some environments where otherwise plugin scanning is slow.&lt;/p&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16363139" author="rayokota" created="Tue, 13 Feb 2018 22:21:03 +0000"  >&lt;p&gt;With my setup where plugin.path was pointing to share/java, the parallel scanning introduced with this change reduced worker initialization from 32s to 12s on my Mac, and from 38s to 14s on Docker/Linux.&lt;/p&gt;</comment>
                            <comment id="16364999" author="ewencp" created="Thu, 15 Feb 2018 00:25:19 +0000"  >&lt;p&gt;Issue resolved by pull request 4561&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16365002" author="githubbot" created="Thu, 15 Feb 2018 00:26:09 +0000"  >&lt;p&gt;ewencp closed pull request #4561: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6503&quot; title=&quot;Connect: Plugin scan is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6503&quot;&gt;&lt;del&gt;KAFKA-6503&lt;/del&gt;&lt;/a&gt;: Parallelize plugin scanning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4561&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
index 345d7ef011d..b21cdcbfab4 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/DelegatingClassLoader.java&lt;br/&gt;
@@ -20,7 +20,10 @@&lt;br/&gt;
 import org.apache.kafka.connect.storage.Converter;&lt;br/&gt;
 import org.apache.kafka.connect.storage.HeaderConverter;&lt;br/&gt;
 import org.apache.kafka.connect.transforms.Transformation;&lt;br/&gt;
+import org.reflections.Configuration;&lt;br/&gt;
 import org.reflections.Reflections;&lt;br/&gt;
+import org.reflections.ReflectionsException;&lt;br/&gt;
+import org.reflections.scanners.SubTypesScanner;&lt;br/&gt;
 import org.reflections.util.ClasspathHelper;&lt;br/&gt;
 import org.reflections.util.ConfigurationBuilder;&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
@@ -269,7 +272,10 @@ private PluginScanResult scanPluginPath(&lt;br/&gt;
         ConfigurationBuilder builder = new ConfigurationBuilder();&lt;br/&gt;
         builder.setClassLoaders(new ClassLoader[]&lt;/p&gt;
{loader}
&lt;p&gt;);&lt;br/&gt;
         builder.addUrls(urls);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Reflections reflections = new Reflections(builder);&lt;br/&gt;
+        builder.setScanners(new SubTypesScanner());&lt;br/&gt;
+        builder.setExpandSuperTypes(false);&lt;br/&gt;
+        builder.useParallelExecutor();&lt;br/&gt;
+        Reflections reflections = new InternalReflections(builder);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         return new PluginScanResult(&lt;br/&gt;
                 getPluginDesc(reflections, Connector.class, loader),&lt;br/&gt;
@@ -353,4 +359,25 @@ private void addAllAliases() {&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;br/&gt;
     }&lt;br/&gt;
+&lt;br/&gt;
+    private static class InternalReflections extends Reflections {&lt;br/&gt;
+&lt;br/&gt;
+        public InternalReflections(Configuration configuration) &lt;/p&gt;
{
+            super(configuration);
+        }
&lt;p&gt;+&lt;br/&gt;
+        // When Reflections is used for parallel scans, it has a bug where it propagates ReflectionsException&lt;br/&gt;
+        // as RuntimeException.  Override the scan behavior to emulate the singled-threaded logic.&lt;br/&gt;
+        @Override&lt;br/&gt;
+        protected void scan(URL url) {&lt;br/&gt;
+            try &lt;/p&gt;
{
+                super.scan(url);
+            }
&lt;p&gt; catch (ReflectionsException e) {&lt;br/&gt;
+                Logger log = Reflections.log;&lt;br/&gt;
+                if (log != null &amp;amp;&amp;amp; log.isWarnEnabled()) &lt;/p&gt;
{
+                    log.warn(&quot;could not create Vfs.Dir from url. ignoring the exception and continuing&quot;, e);
+                }
&lt;p&gt;+            }&lt;br/&gt;
+        }&lt;br/&gt;
+    }&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13118321">KAFKA-6208</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pji7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>