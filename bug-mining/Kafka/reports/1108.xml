<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3740] Enable configuration of RocksDBStores</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3740</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Today most of the rocksDB configs are hard written inside &lt;tt&gt;RocksDBStore&lt;/tt&gt;, or the default values are directly used. We need to make them configurable for advanced users. For example, some default values may not work perfectly for some scenarios: &lt;a href=&quot;https://github.com/HenryCaiHaiying/kafka/commit/ccc4e25b110cd33eea47b40a2f6bf17ba0924576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/HenryCaiHaiying/kafka/commit/ccc4e25b110cd33eea47b40a2f6bf17ba0924576&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;One way of doing that is to introduce a &quot;RocksDBStoreConfigs&quot; objects similar to &quot;StreamsConfig&quot;, which defines all related rocksDB options configs, that can be passed as key-value pairs to &quot;StreamsConfig&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12971600">KAFKA-3740</key>
            <summary>Enable configuration of RocksDBStores</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="damianguy">Damian Guy</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                            <label>api</label>
                            <label>newbie</label>
                    </labels>
                <created>Fri, 20 May 2016 18:19:11 +0000</created>
                <updated>Mon, 24 Oct 2016 14:37:03 +0000</updated>
                            <resolved>Thu, 21 Jul 2016 18:04:24 +0000</resolved>
                                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15293908" author="guozhang" created="Fri, 20 May 2016 18:19:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hcai%40pinterest.com&quot; class=&quot;user-hover&quot; rel=&quot;hcai@pinterest.com&quot;&gt;hcai@pinterest.com&lt;/a&gt; Are you interested in picking it up?&lt;/p&gt;</comment>
                            <comment id="15294204" author="hcai@pinterest.com" created="Fri, 20 May 2016 21:10:46 +0000"  >&lt;p&gt;You can assign this one to me.&lt;/p&gt;</comment>
                            <comment id="15294232" author="guozhang" created="Fri, 20 May 2016 21:18:06 +0000"  >&lt;p&gt;I have added you to the contributor list, so you should be able to assign it to yourself. Let me know if it doesn&apos;t work for you.&lt;/p&gt;</comment>
                            <comment id="15294270" author="hcai@pinterest.com" created="Fri, 20 May 2016 21:29:31 +0000"  >&lt;p&gt;Don&apos;t see that &apos;assign&apos; button&lt;/p&gt;</comment>
                            <comment id="15294302" author="guozhang" created="Fri, 20 May 2016 21:44:35 +0000"  >&lt;p&gt;That is because you can only assign to yourself, but not others.&lt;/p&gt;

&lt;p&gt;On the &quot;assignee&quot; tab, when you move your pointer to it, do you see it having the edit button, or if there is a &quot;Assign to me&quot; below it?&lt;/p&gt;</comment>
                            <comment id="15294310" author="hcai@pinterest.com" created="Fri, 20 May 2016 21:47:52 +0000"  >&lt;p&gt;Worked now.&lt;/p&gt;</comment>
                            <comment id="15303345" author="guozhang" created="Fri, 27 May 2016 02:15:13 +0000"  >&lt;p&gt;Some thoughts on the default config values:&lt;/p&gt;

&lt;p&gt;I think there are at least three use cases of RocksDB whose default configs need to be treated differentially:&lt;/p&gt;

&lt;p&gt;1. For pure key-value store with put / get / delete, this is used for KTable aggregation and KStream aggregation (note that for now windowed KStream aggregation is using a range query, which is sub-optimal, we should really change it to multiple gets to avoid flushing the cache).&lt;/p&gt;

&lt;p&gt;2. For append-only puts and range queries, used for windowed KStream joins.&lt;/p&gt;

&lt;p&gt;3. For update puts and range queries, non-key KTable-KTable joins: we are about to add this support and am writing up a design proposal for it.&lt;/p&gt;

&lt;p&gt;For example, for case 1) it should usually write-heavy, assuming we have a good cache hit rate on top of RocksDB, then we should consider setting smaller number of levels config to reduce write amplification; and for 2) and 3), we should turn off bloom filter by default since it does not help for range queries.&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://vimeo.com/album/2920922/video/98428203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://vimeo.com/album/2920922/video/98428203&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15303428" author="hcai@pinterest.com" created="Fri, 27 May 2016 03:54:24 +0000"  >&lt;p&gt;Looks like you want two sets of RocksDB settings, one for K/V store, one for range scan store.  I think for most of the small RocksDB (size &amp;lt; 5GB), those settings (target file size, or bloom filter) probably won&apos;t matter.&lt;/p&gt;

&lt;p&gt;To make it really flexible, you would need to provide per store rocksdb settings.  E.g. for A join B, if A has small-size records and B has big-size records you would want to set the targeFileSize smaller for RocksDB A and targetFileSize bigger for RocksDB B.  It seems it would have the following overlay config structures in StreamConfig:&lt;/p&gt;

&lt;p&gt;rocksdb.default.target_file_size_mb=16&lt;br/&gt;
rocksdb.default.use_bloom_filter=true&lt;br/&gt;
...&lt;br/&gt;
rocksdb.aggregation_style.target_file_size_mb=8&lt;br/&gt;
...&lt;br/&gt;
rocksdb.join_style.target_file_size_mb=32&lt;br/&gt;
...&lt;br/&gt;
rocksdb.custom1_style.target_file_size_mb=128&lt;/p&gt;

&lt;p&gt;System understands &apos;default&apos;, &apos;aggregation_style&apos;, &apos;join_style&apos; and will choose different style accordingly based on the context.&lt;/p&gt;

&lt;p&gt;Application can optionally associate a RocksDB with customer style e.g. custom1_style (need some API enhancement).&lt;/p&gt;

&lt;p&gt;This might get more complicated, I think for the initial version, as long as we can provide rocksdb.default.property this would be a big enhancement.&lt;/p&gt;</comment>
                            <comment id="15303531" author="guozhang" created="Fri, 27 May 2016 05:34:12 +0000"  >&lt;p&gt;Sounds good.&lt;/p&gt;</comment>
                            <comment id="15334812" author="theduderog" created="Thu, 16 Jun 2016 22:15:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hcai%40pinterest.com&quot; class=&quot;user-hover&quot; rel=&quot;hcai@pinterest.com&quot;&gt;hcai@pinterest.com&lt;/a&gt;, any update on this?  I&apos;m wondering if you have any idea when it might be available.&lt;/p&gt;</comment>
                            <comment id="15342979" author="guozhang" created="Tue, 21 Jun 2016 22:58:18 +0000"  >&lt;p&gt;Since we need to pass the StreamsConfig object to the storage layers anyways, one approach to do that is to expose the configs via `ProcessorContext`, by leveraging `AbstractConfig.originalsWithPrefix`. For example, users can specify configs like &quot;rocksdb.xx.xx&quot; and then with a new API:&lt;/p&gt;

&lt;p&gt;Map&amp;lt;String, Object&amp;gt; properties ProcessorContext.configs(&quot;prefix&quot;);&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hcai%40pinterest.com&quot; class=&quot;user-hover&quot; rel=&quot;hcai@pinterest.com&quot;&gt;hcai@pinterest.com&lt;/a&gt; If you are busy recently could myself or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=theduderog&quot; class=&quot;user-hover&quot; rel=&quot;theduderog&quot;&gt;theduderog&lt;/a&gt; pick this up?&lt;/p&gt;</comment>
                            <comment id="15343115" author="hcai@pinterest.com" created="Wed, 22 Jun 2016 00:44:27 +0000"  >&lt;p&gt;Yes, you or Roger can pick it up.&lt;/p&gt;</comment>
                            <comment id="15349772" author="githubbot" created="Sat, 25 Jun 2016 20:24:47 +0000"  >&lt;p&gt;GitHub user HenryCaiHaiying opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1553&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3740&quot; title=&quot;Enable configuration of RocksDBStores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3740&quot;&gt;&lt;del&gt;KAFKA-3740&lt;/del&gt;&lt;/a&gt;: Add configs for RocksDBStore&lt;/p&gt;

&lt;p&gt;    This is the part I of the work to add the StreamsConfig to ProcessorContext.&lt;/p&gt;

&lt;p&gt;    We need to access StreamsConfig in the ProcessorContext so other components (e.g. RocksDBWindowStore or LRUCache can retrieve config parameter from application)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/HenryCaiHaiying/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/HenryCaiHaiying/kafka&lt;/a&gt; config&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1553.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1553.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1553&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 12973c2d090268db416417b18dfbbe3d96f6a9d5&lt;br/&gt;
Author: Henry Cai &amp;lt;hcai@pinterest.com&amp;gt;&lt;br/&gt;
Date:   2016-06-25T20:19:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3740&quot; title=&quot;Enable configuration of RocksDBStores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3740&quot;&gt;&lt;del&gt;KAFKA-3740&lt;/del&gt;&lt;/a&gt;: Add configs for RocksDBStore&lt;/p&gt;

&lt;p&gt;    This is the part I of the work to add the StreamsConfig to ProcessorContext.&lt;/p&gt;

&lt;p&gt;    We need to access StreamsConfig in the ProcessorContext so other components (e.g. RocksDBWindowStore or LRUCache can retrieve config parameter from application)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15357598" author="githubbot" created="Thu, 30 Jun 2016 18:10:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1553&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15385061" author="githubbot" created="Tue, 19 Jul 2016 23:28:26 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1640&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3740&quot; title=&quot;Enable configuration of RocksDBStores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3740&quot;&gt;&lt;del&gt;KAFKA-3740&lt;/del&gt;&lt;/a&gt;: Enable configuration of RocksDBStores&lt;/p&gt;

&lt;p&gt;    Add new config StreamsConfig.ROCKSDB_CONFIG_SETTER_CLASS_CONFIG to enable advanced&lt;br/&gt;
    RocksDB users to override default RocksDB configuration&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kafka-3740-listener&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1640.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1640.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1640&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8c0f586336731f19ca472e74aacccdc86417a064&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-19T22:57:08Z&lt;/p&gt;

&lt;p&gt;    Add new config StreamsConfig.ROCKSDB_CONFIG_SETTER_CLASS_CONFIG to enable advanced&lt;br/&gt;
    RocksDB users to override default RocksDB configuration&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15388134" author="guozhang" created="Thu, 21 Jul 2016 18:04:24 +0000"  >&lt;p&gt;Issue resolved by pull request 1640&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1640&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15388136" author="githubbot" created="Thu, 21 Jul 2016 18:04:50 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1640&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12981574">KAFKA-3890</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13010575">KAFKA-4273</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yafr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>