<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:02:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5329] Replica list in the metadata cache on the broker may have different order from zookeeper</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5329</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;It looks that in &lt;tt&gt;PartitionStateInfo&lt;/tt&gt; we are storing the replicas in a set instead of a Seq. This causes the replica order to be lost. In most case it is fine, but in the context of preferred leader election, the replica order determines which replica is the preferred leader of a partition. It would be useful to make the order always be consistent with the order in zookeeper. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13075078">KAFKA-5329</key>
            <summary>Replica list in the metadata cache on the broker may have different order from zookeeper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="becket_qin">Jiangjie Qin</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Fri, 26 May 2017 05:13:28 +0000</created>
                <updated>Thu, 8 Jun 2017 02:32:25 +0000</updated>
                            <resolved>Thu, 8 Jun 2017 02:32:25 +0000</resolved>
                                    <version>0.10.2.1</version>
                                    <fixVersion>0.11.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16026049" author="ijuma" created="Fri, 26 May 2017 09:19:56 +0000"  >&lt;p&gt;Are you sure that this is an issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;? We rely on ControllerContext.partitionReplicaAssignment for the cases where the order matters and that does not use a Set. Also see &lt;a href=&quot;https://github.com/apache/kafka/pull/900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/900&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16026532" author="becket_qin" created="Fri, 26 May 2017 17:20:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; The ControllerContext is fine. This ticket is not about controller context, but the metadata cache in the brokers, which will be returned to the user in the TopicMetadataResponse. &lt;/p&gt;

&lt;p&gt;The issue is following. If user wants to assign one of the broker as the leader of a partition, they will first have to ensure that broker is the first replica in the replica array, then do a preferred leader election for that partition. In this case, user can either look into zkNode, or get the replica list from the TopicMetadataResponse from brokers. If users are designating a lot of leaders, using TopicMetadataResponse would be much more efficient. So it is useful to make sure the replica list in the TopicMetadataResponse is correct. Also given the metadata returned from broker represents replicas in an array, it is weird to not making it align with the actual replica order.&lt;/p&gt;</comment>
                            <comment id="16026753" author="wushujames" created="Fri, 26 May 2017 20:01:08 +0000"  >&lt;p&gt;I noticed this as well. &lt;a href=&quot;https://github.com/edenhill/kafkacat/issues/98&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/edenhill/kafkacat/issues/98&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I was using the results of &quot;kafkacat -L -J&quot; to calculate the preferred leader imbalance ratio of my cluster, and my calculation didn&apos;t match what the controller was doing. I eventually figured out it was because the the replica lists weren&apos;t in the same order as what was in zookeeper.&lt;/p&gt;</comment>
                            <comment id="16039836" author="ijuma" created="Tue, 6 Jun 2017 23:00:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;, I had not understood how it impacted preferred replica election. I now understand that the context is for an external tool that needs the information (Cruise Control, I&apos;m guessing). Yes, we should fix this.&lt;/p&gt;</comment>
                            <comment id="16040942" author="githubbot" created="Wed, 7 Jun 2017 14:06:32 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5329&quot; title=&quot;Replica list in the metadata cache on the broker may have different order from zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5329&quot;&gt;&lt;del&gt;KAFKA-5329&lt;/del&gt;&lt;/a&gt;: Fix order of replica list in metadata cache&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-5329-fix-order-of-replica-list-in-metadata-cache&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3257.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3257.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3257&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 126101d5df7c24f8a3ee720e95cb34e3e4df0efc&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-06-07T14:05:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5329&quot; title=&quot;Replica list in the metadata cache on the broker may have different order from zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5329&quot;&gt;&lt;del&gt;KAFKA-5329&lt;/del&gt;&lt;/a&gt;: Fix order of replica list in metadata cache&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16042097" author="githubbot" created="Thu, 8 Jun 2017 02:28:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3257&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16042099" author="ijuma" created="Thu, 8 Jun 2017 02:32:25 +0000"  >&lt;p&gt;Issue resolved by pull request 3257&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3257&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fi6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>