<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6101] Reconnecting to broker does not exponentially backoff</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6101</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I am using com.typesafe.akka:akka-stream-kafka:0.17 which relies on kafka-clients:0.11.0.0.&lt;/p&gt;

&lt;p&gt;I have set the reconnect.backoff.max.ms property to 60000.&lt;/p&gt;

&lt;p&gt;When I start the application without kafka running, I see a flood of the following log message:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;warn&amp;#93;&lt;/span&gt; o.a.k.c.NetworkClient - Connection to node -1 could not be established. Broker may not be available.&lt;/p&gt;

&lt;p&gt;The log messages occur several times a second and the frequency of these messages does not decrease over time as would be expected if exponential backoff was working properly.&lt;/p&gt;

&lt;p&gt;I set a breakpoint in the debugger in ClusterConnectionStates:188 and noticed that every time this breakpoint is hit, nodeState.failedAttempts is always 0. This is why the delay does not increase exponentially. It also appears that every time the breakpoint is hit, it is on a different instance, so even though the number of failedAttempts is incremented, we never get the breakpoint for the same instance more than one time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13111087">KAFKA-6101</key>
            <summary>Reconnecting to broker does not exponentially backoff</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tedyu">Zhihong Yu</assignee>
                                    <reporter username="srohead">Sean Rohead</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Oct 2017 20:11:56 +0000</created>
                <updated>Mon, 23 Oct 2017 15:35:00 +0000</updated>
                            <resolved>Mon, 23 Oct 2017 15:35:00 +0000</resolved>
                                    <version>0.11.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16213428" author="srohead" created="Fri, 20 Oct 2017 22:39:00 +0000"  >&lt;p&gt;I&apos;m fairly new to kafka so I&apos;m not in a state to easily apply a source patch and try your fix. I can try to get the code checked out and apply your patch.&lt;/p&gt;

&lt;p&gt;Your patch is pretty straightforward and I can tell you that the existing nodeState in the map has a ConnectionState.DISCONNECTED when it is being overwritten.&lt;/p&gt;

&lt;p&gt;ClusterConnectionStates.disconnected is being called from NetworkClient.poll &amp;#8211; the line that reads: handleDisconnections(responses, updatedNow)&lt;/p&gt;

&lt;p&gt;ClusterConnectionStates.connecting is called from the same method, but from the line that reads: long metadataTimeout = metadataUpdater.maybeUpdate(now)&lt;/p&gt;

&lt;p&gt;I don&apos;t know enough about how the code is supposed to work, but it seems like every call to poll() is trying to connect and then immediately disconnecting when it fails, which means that we are always starting back at the beginning in terms of the number of retries and exponential backoff.&lt;/p&gt;

&lt;p&gt;On Fri, Oct 20, 2017 at 3:56 PM, Ted Yu (JIRA) &amp;lt;jira@apache.org&amp;lt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:jira@apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jira@apache.org&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&amp;gt;&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;     [ &lt;a href=&quot;https://nam04.safelinks.protection.outlook.com/?url=https%3A%2F%2Fissues.apache.org%2Fjira%2Fbrowse%2FKAFKA-6101%3Fpage%3Dcom.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel&amp;amp;data=02%7C01%7Csean_rohead%40hotmail.com%7C5486392685454feaca9008d518055bee%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636441333645078302&amp;amp;sdata=MKtcjijEV%2Bm%2FFdeKci34ANYhNHqv1N7Z7Opx51CtShQ%3D&amp;amp;reserved=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://nam04.safelinks.protection.outlook.com/?url=https%3A%2F%2Fissues.apache.org%2Fjira%2Fbrowse%2FKAFKA-6101%3Fpage%3Dcom.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel&amp;amp;data=02%7C01%7Csean_rohead%40hotmail.com%7C5486392685454feaca9008d518055bee%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636441333645078302&amp;amp;sdata=MKtcjijEV%2Bm%2FFdeKci34ANYhNHqv1N7Z7Opx51CtShQ%3D&amp;amp;reserved=0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Ted Yu updated &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6101&quot; title=&quot;Reconnecting to broker does not exponentially backoff&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6101&quot;&gt;&lt;del&gt;KAFKA-6101&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
--------------------------&lt;br/&gt;
    Attachment: 6101.v1.txt&lt;/p&gt;




&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message was sent by Atlassian JIRA&lt;br/&gt;
(v6.4.14#64029)&lt;/p&gt;
</comment>
                            <comment id="16213531" author="srohead" created="Sat, 21 Oct 2017 00:00:25 +0000"  >&lt;p&gt;Looking at your patch strictly from a code review perspective (not having yet tested it), I see that the current implementation of disconnected() calls updateReconnectBackoff(nodeState) which modifies the value of nodeState.reconnectBackoffMs. This value is not being preserved when you are creating the new nodeState in connecting() so the value will be reset back to reconnectBackoffInitMs. I not 100% certain, but I think the new nodeState should preserve that value across connection attempts. I guess my other question would be if it is possible to just leave the existing nodeState instance in the map (if there is one) instead of creating a new one &amp;#8211; just update the state and lastConnectAttemptMs. This is what the disconnected() method does.&lt;/p&gt;</comment>
                            <comment id="16213670" author="githubbot" created="Sat, 21 Oct 2017 02:12:45 +0000"  >&lt;p&gt;GitHub user tedyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6101&quot; title=&quot;Reconnecting to broker does not exponentially backoff&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6101&quot;&gt;&lt;del&gt;KAFKA-6101&lt;/del&gt;&lt;/a&gt; Reconnecting to broker does not exponentially backoff&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tedyu/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tedyu/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4108.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4108.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4108&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16215148" author="githubbot" created="Mon, 23 Oct 2017 13:42:19 +0000"  >&lt;p&gt;Github user tedyu closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4108&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16215160" author="githubbot" created="Mon, 23 Oct 2017 13:50:52 +0000"  >&lt;p&gt;GitHub user tedyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4118&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6101&quot; title=&quot;Reconnecting to broker does not exponentially backoff&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6101&quot;&gt;&lt;del&gt;KAFKA-6101&lt;/del&gt;&lt;/a&gt; Reconnecting to broker does not exponentially backoff&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tedyu/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tedyu/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4118.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4118.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4118&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cd928d3867e42774bb167b3aaf11ca6a8dd8d48f&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-23T13:49:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6101&quot; title=&quot;Reconnecting to broker does not exponentially backoff&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6101&quot;&gt;&lt;del&gt;KAFKA-6101&lt;/del&gt;&lt;/a&gt; Reconnecting to broker does not exponentially backoff&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16215283" author="githubbot" created="Mon, 23 Oct 2017 15:16:29 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4118&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13111257">KAFKA-6104</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12893356" name="6101.v2.txt" size="2470" author="yuzhihong@gmail.com" created="Fri, 20 Oct 2017 22:55:27 +0000"/>
                            <attachment id="12893372" name="6101.v3.txt" size="1934" author="yuzhihong@gmail.com" created="Sat, 21 Oct 2017 00:20:32 +0000"/>
                            <attachment id="12893353" name="text.html" size="5311" author="srohead" created="Fri, 20 Oct 2017 22:39:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ljav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>