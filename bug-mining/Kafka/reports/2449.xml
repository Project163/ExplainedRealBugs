<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:21:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7925] Constant 100% cpu usage by all kafka brokers</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7925</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am seeing constant 100% cpu usage on all brokers in our kafka cluster even without any clients connected to any broker.&lt;/p&gt;

&lt;p&gt;This is a bug that we have seen multiple times in our kafka setup that is not yet open to clients. It is becoming a blocker for our deployment now.&lt;/p&gt;

&lt;p&gt;I am seeing lot of connections to other brokers in CLOSE_WAIT state (see below). In thread usage, I am seeing these threads &apos;kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-0,kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-1,kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-2&apos; taking up more than 90% of the cpu time in a 60s interval.&lt;/p&gt;

&lt;p&gt;I have attached a thread dump of one of the brokers in the cluster.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Java version:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;openjdk 11.0.2 2019-01-15&lt;br/&gt;
OpenJDK Runtime Environment 18.9 (build 11.0.2+9)&lt;br/&gt;
OpenJDK 64-Bit Server VM 18.9 (build 11.0.2+9, mixed mode)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Kafka verison:&lt;/b&gt; v2.1.0&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;connections:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;java 144319 kafkagod 88u IPv4 3063266 0t0 TCP *:35395 (LISTEN)&lt;br/&gt;
java 144319 kafkagod 89u IPv4 3063267 0t0 TCP *:9144 (LISTEN)&lt;br/&gt;
java 144319 kafkagod 104u IPv4 3064219 0t0 TCP mwkafka-prod-02.tbd:47292-&amp;gt;mwkafka-zk-prod-05.tbd:2181 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2003u IPv4 3055115 0t0 TCP *:9092 (LISTEN)&lt;br/&gt;
java 144319 kafkagod 2013u IPv4 7220110 0t0 TCP mwkafka-prod-02.tbd:60724-&amp;gt;mwkafka-zk-prod-04.dr:2181 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2020u IPv4 30012904 0t0 TCP mwkafka-prod-02.tbd:38988-&amp;gt;mwkafka-prod-02.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2021u IPv4 30012961 0t0 TCP mwkafka-prod-02.tbd:58420-&amp;gt;mwkafka-prod-01.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2027u IPv4 30015723 0t0 TCP mwkafka-prod-02.tbd:58398-&amp;gt;mwkafka-prod-01.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2028u IPv4 30015630 0t0 TCP mwkafka-prod-02.tbd:36248-&amp;gt;mwkafka-prod-02.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2030u IPv4 30015726 0t0 TCP mwkafka-prod-02.tbd:39012-&amp;gt;mwkafka-prod-02.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2031u IPv4 30013619 0t0 TCP mwkafka-prod-02.tbd:38986-&amp;gt;mwkafka-prod-02.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2032u IPv4 30015604 0t0 TCP mwkafka-prod-02.tbd:36246-&amp;gt;mwkafka-prod-02.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2033u IPv4 30012981 0t0 TCP mwkafka-prod-02.tbd:36924-&amp;gt;mwkafka-prod-01.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2034u IPv4 30012967 0t0 TCP mwkafka-prod-02.tbd:39036-&amp;gt;mwkafka-prod-02.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2035u IPv4 30012898 0t0 TCP mwkafka-prod-02.tbd:36866-&amp;gt;mwkafka-prod-01.dr:9092 (FIN_WAIT2)&lt;br/&gt;
java 144319 kafkagod 2036u IPv4 30004729 0t0 TCP mwkafka-prod-02.tbd:36882-&amp;gt;mwkafka-prod-01.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2037u IPv4 30004914 0t0 TCP mwkafka-prod-02.tbd:58426-&amp;gt;mwkafka-prod-01.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2038u IPv4 30015651 0t0 TCP mwkafka-prod-02.tbd:36884-&amp;gt;mwkafka-prod-01.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2039u IPv4 30012966 0t0 TCP mwkafka-prod-02.tbd:58422-&amp;gt;mwkafka-prod-01.nyc:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2040u IPv4 30005643 0t0 TCP mwkafka-prod-02.tbd:36252-&amp;gt;mwkafka-prod-02.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2041u IPv4 30012944 0t0 TCP mwkafka-prod-02.tbd:36286-&amp;gt;mwkafka-prod-02.dr:9092 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2042u IPv4 30012973 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51924 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2043u sock 0,7 0t0 30012463 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2044u IPv4 30012979 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39994 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2045u IPv4 30012899 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34548 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2046u sock 0,7 0t0 30003437 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2047u IPv4 30012980 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:38120 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2048u sock 0,7 0t0 30012546 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2049u IPv4 30005418 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39686 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2050u IPv4 30009977 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34552 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2060u sock 0,7 0t0 30003439 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2061u IPv4 30012906 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51862 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2069u IPv4 30005642 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34570 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2073u sock 0,7 0t0 30003440 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2086u IPv4 30005644 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51878 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2090u sock 0,7 0t0 30012553 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2093u sock 0,7 0t0 30012502 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2097u sock 0,7 0t0 30012531 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2104u IPv4 30005670 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34646 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2105u IPv4 30012933 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:38106 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2106u IPv4 30012565 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34366 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2114u IPv4 30012958 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39970 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2115u sock 0,7 0t0 30012569 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2117u sock 0,7 0t0 30012571 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2118u IPv4 30012959 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39972 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2120u IPv4 30012575 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37868 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2121u IPv4 30012960 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39974 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2122u IPv4 30012577 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39704 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2127u IPv4 29477410 0t0 TCP mwkafka-prod-02.tbd:58804-&amp;gt;u-sonar-sonarsec.sdlb:8826 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2128u IPv4 30012579 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39708 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2129u IPv4 30012962 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:38110 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2130u IPv4 30012582 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37872 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2132u IPv4 30012963 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:38112 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2133u IPv4 30012602 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51622 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2135u IPv4 30012964 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51916 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2136u IPv4 30012605 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51626 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2139u IPv4 30012965 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51918 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2140u IPv4 30012607 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39754 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2141u IPv4 30010735 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37878 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2144u IPv4 30010741 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34402 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2145u IPv4 30010742 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51648 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2149u IPv4 30012623 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51658 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2152u IPv4 30012625 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34416 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2155u IPv4 30012635 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39778 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2157u IPv4 30012636 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39780 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2162u IPv4 29630161 0t0 TCP mwkafka-prod-02.tbd:45254-&amp;gt;u-sonar-sonarpri.sdlb:8826 (ESTABLISHED)&lt;br/&gt;
java 144319 kafkagod 2165u IPv4 30012639 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37916 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2168u IPv4 30012640 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37918 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2169u sock 0,7 0t0 30006888 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2172u IPv4 30012656 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51714 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2173u IPv4 30012659 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51718 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2176u sock 0,7 0t0 30006891 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2179u sock 0,7 0t0 30012426 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2180u sock 0,7 0t0 30012427 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2183u sock 0,7 0t0 30012429 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2184u sock 0,7 0t0 30012432 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2186u sock 0,7 0t0 30012437 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2187u sock 0,7 0t0 30012459 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2188u sock 0,7 0t0 30012696 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2189u IPv4 30012718 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34436 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2191u sock 0,7 0t0 30012720 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2192u IPv4 30009662 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.nyc:34456 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2193u sock 0,7 0t0 30009663 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2195u sock 0,7 0t0 30012723 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2196u IPv4 30012727 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37958 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2197u sock 0,7 0t0 30012791 protocol: TCP&lt;br/&gt;
java 144319 kafkagod 2198u IPv4 30012808 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39818 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2199u IPv4 30012818 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39838 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2200u IPv4 30012836 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37980 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2201u IPv4 30012839 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:37986 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2202u IPv4 30012866 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51812 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2204u IPv4 30012867 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51814 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2205u IPv4 30012872 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.nyc:51846 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2206u IPv4 30012873 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-01.dr:39890 (CLOSE_WAIT)&lt;br/&gt;
java 144319 kafkagod 2207u IPv4 30012894 0t0 TCP mwkafka-prod-02.tbd:9092-&amp;gt;mwkafka-prod-02.dr:38000 (CLOSE_WAIT)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Java 11, Kafka v2.1.0, Kafka v2.1.1, Kafka v2.2.0</environment>
        <key id="13215454">KAFKA-7925</key>
            <summary>Constant 100% cpu usage by all kafka brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="xabhi">Abhi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Feb 2019 09:01:30 +0000</created>
                <updated>Thu, 12 Dec 2019 09:57:21 +0000</updated>
                            <resolved>Thu, 12 Dec 2019 09:57:21 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16768321" author="xabhi" created="Thu, 14 Feb 2019 14:29:49 +0000"  >&lt;p&gt;I keep seeing below exception in all server logs.  No clients are able to connect to kafka brokers and keep timing out. Could anyone please help with this issue or provide a workaround to avoid this?&lt;/p&gt;


&lt;p&gt;java.net.SocketTimeoutException: Failed to connect within 30000 ms&lt;br/&gt;
        at kafka.server.ReplicaFetcherBlockingSend.sendRequest(ReplicaFetcherBlockingSend.scala:93)&lt;br/&gt;
        at kafka.server.ReplicaFetcherThread.fetchFromLeader(ReplicaFetcherThread.scala:190)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.kafka$server$AbstractFetcherThread$$processFetchRequest(AbstractFetcherThread.scala:241)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$maybeFetch$1.apply(AbstractFetcherThread.scala:130)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$maybeFetch$1.apply(AbstractFetcherThread.scala:129)&lt;br/&gt;
        at scala.Option.foreach(Option.scala:257)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.maybeFetch(AbstractFetcherThread.scala:129)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:111)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:82)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-02-14 09:20:00,617&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcher replicaId=1, leaderId=6, fetcherId=0&amp;#93;&lt;/span&gt; Error sending fetch request (sessionId=841897464, epoch=INITIAL) to node 6: java.net.SocketTimeoutException: Failed to connect within 30000 ms. (org.apache.kafka.clients.FetchSessionHandler)&lt;/p&gt;</comment>
                            <comment id="16775061" author="xabhi" created="Fri, 22 Feb 2019 11:50:17 +0000"  >&lt;p&gt;Any updates on this?&lt;/p&gt;

&lt;p&gt;From the threaddump, I see has &apos;kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-0&apos; locked &apos;0x00000006ca1c9a80&apos; and doesn&apos;t seem to be making progress. The other network threads &apos;kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-1&apos; and  and &apos;kafka-network-thread-6-ListenerName(SASL_PLAINTEXT)-SASL_PLAINTEXT-2&apos; are waiting to lock &apos;0x00000006ca1c9a80&apos;.&lt;/p&gt;

&lt;p&gt;This is causing no new connection requests to be accepted. Can you please check this.&lt;/p&gt;
</comment>
                            <comment id="16779131" author="rsivaram" created="Wed, 27 Feb 2019 10:43:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; The three JIRAs (&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7925&quot; title=&quot;Constant 100% cpu usage by all kafka brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7925&quot;&gt;&lt;del&gt;KAFKA-7925&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7812&quot; title=&quot;Deadlock in SaslServerAuthenticator related threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7812&quot;&gt;KAFKA-7812&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8008&quot; title=&quot;Clients unable to connect and replicas are not able to connect to each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8008&quot;&gt;KAFKA-8008&lt;/a&gt;) look like the same issue. Can we close two and focus on one?&lt;/p&gt;

&lt;p&gt;I dont have a test environment to test with sun.security.jgss.native=true. But I will be happy to submit a PR if you can build locally and test it out. We can&apos;t merge the PR until it has been tested.&lt;/p&gt;</comment>
                            <comment id="16779305" author="githubbot" created="Wed, 27 Feb 2019 13:20:07 +0000"  >&lt;p&gt;rajinisivaram commented on pull request #6337: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7925&quot; title=&quot;Constant 100% cpu usage by all kafka brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7925&quot;&gt;&lt;del&gt;KAFKA-7925&lt;/del&gt;&lt;/a&gt; - Create credentials only once for sun.security.jgss.native&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6337&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   When `sun.security.jgss.native=true`, we currently create a new server credential for every new client connection and add to the private credential set of the server&apos;s Subject. This is expensive and can result in an unbounded number of private credentials in the Subject used by the broker. The PR creates a credential immediately after login so that a single credential can be reused.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16779307" author="rsivaram" created="Wed, 27 Feb 2019 13:21:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Will you be able to checkout the PR (&lt;a href=&quot;https://github.com/apache/kafka/pull/6337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6337&lt;/a&gt;) and test it out? Thanks.&lt;/p&gt;</comment>
                            <comment id="16781333" author="xabhi" created="Fri, 1 Mar 2019 06:26:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; Thanks Rajini for looking at this issue. Yes, you can close the other two JIRAs. I will be happy to test the PR. Can you tell how can i checkout the PR code into local kafka checkout. &lt;/p&gt;

&lt;p&gt;Should i cloned &lt;a href=&quot;https://github.com/apache/kafka.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka.git&lt;/a&gt; but here I am not sure how to checkout the pr code or should i go ahead and clone - &lt;a href=&quot;https://github.com/rajinisivaram/kafka.git?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka.git?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16781349" author="omkreddy" created="Fri, 1 Mar 2019 06:52:16 +0000"  >&lt;p&gt;You can use&#160; below steps to checkout the PR.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;git clone &lt;a href=&quot;https://github.com/apache/kafka.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka.git&lt;/a&gt;&lt;br/&gt;
 cd kafka&lt;br/&gt;
 git fetch origin pull/6337/head:&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7925&quot; title=&quot;Constant 100% cpu usage by all kafka brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7925&quot;&gt;&lt;del&gt;KAFKA-7925&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
 git checkout &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7925&quot; title=&quot;Constant 100% cpu usage by all kafka brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7925&quot;&gt;&lt;del&gt;KAFKA-7925&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
 gradle&lt;br/&gt;
 ./gradlew releaseTarGz -x signArchives&lt;/p&gt;

&lt;p&gt;The distribution can be found inside `kafka/core/build/distributions/`.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16784298" author="xabhi" created="Tue, 5 Mar 2019 10:33:55 +0000"  >&lt;p&gt;Hi, I deployed the patch in my setup but now I am getting below exception when trying to publish messages on 40 topics using same producer. This exception is received on client side. I did not see any error or warnings around this time (2019-03-05 04:16:25) in server logs.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 04:16:25,146&amp;#93;&lt;/span&gt; ERROR Uncaught exception in thread &apos;kafka-producer-network-thread | test_prod&apos;: (org.apache.kafka.common.utils.KafkaThread)&lt;br/&gt;
common.util.ApplicationDeath: org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request.&lt;br/&gt;
        at xxx.kafka.test.KafkaTestProducer$ProducerCallback.onCompletion(KafkaTestProducer.java:475)&lt;br/&gt;
        at org.apache.kafka.clients.producer.KafkaProducer$InterceptorCallback.onCompletion(KafkaProducer.java:1304)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.ProducerBatch.completeFutureAndFireCallbacks(ProducerBatch.java:230)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.ProducerBatch.done(ProducerBatch.java:196)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.failBatch(Sender.java:717)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.failBatch(Sender.java:685)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.completeBatch(Sender.java:635)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.handleProduceResponse(Sender.java:557)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.access$100(Sender.java:74)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender$1.onComplete(Sender.java:786)&lt;br/&gt;
        at org.apache.kafka.clients.ClientResponse.onComplete(ClientResponse.java:109)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.completeResponses(NetworkClient.java:557)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:549)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:311)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:235)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
Caused by: org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 04:17:25,144&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Producer clientId=test_prod&amp;#93;&lt;/span&gt; Exception occurred during message send: (org.apache.kafka.clients.producer.KafkaProducer)&lt;/p&gt;

&lt;p&gt;On a side note, after deploying this patch, I also observed lot of connection disconnects:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 01:23:39,553&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SocketServer brokerId=1&amp;#93;&lt;/span&gt; Connection with /10.219.26.10 disconnected (org.apache.kafka.common.network.Selector)&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.kafka.common.network.NetworkReceive.readFrom(NetworkReceive.java:96)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.receive(KafkaChannel.java:424)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.read(KafkaChannel.java:385)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.attemptRead(Selector.java:640)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:561)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.poll(Selector.java:472)&lt;br/&gt;
        at kafka.network.Processor.poll(SocketServer.scala:830)&lt;br/&gt;
        at kafka.network.Processor.run(SocketServer.scala:730)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 01:23:39,553&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SocketServer brokerId=1&amp;#93;&lt;/span&gt; Connection with /10.219.26.10 disconnected (org.apache.kafka.common.network.Selector)&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.kafka.common.network.NetworkReceive.readFrom(NetworkReceive.java:96)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.receive(KafkaChannel.java:424)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.read(KafkaChannel.java:385)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.attemptRead(Selector.java:640)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:561)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.poll(Selector.java:472)&lt;br/&gt;
        at kafka.network.Processor.poll(SocketServer.scala:830)&lt;br/&gt;
        at kafka.network.Processor.run(SocketServer.scala:730)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
....&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 01:27:57,386&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Controller id=1, targetBrokerId=4&amp;#93;&lt;/span&gt; Connection with mwkafka-prod-02.dr.xxx.com/10.218.247.23 disconnected (org.apache.kafka.common.network.Selector)&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.kafka.common.network.NetworkReceive.readFrom(NetworkReceive.java:96)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.receive(KafkaChannel.java:424)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.read(KafkaChannel.java:385)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.attemptRead(Selector.java:640)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:561)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.poll(Selector.java:472)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:535)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClientUtils.isReady(NetworkClientUtils.java:42)&lt;br/&gt;
        at kafka.controller.RequestSendThread.brokerReady(ControllerChannelManager.scala:281)&lt;br/&gt;
        at kafka.controller.RequestSendThread.doWork(ControllerChannelManager.scala:236)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:89)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 01:27:57,386&amp;#93;&lt;/span&gt; DEBUG Set SASL client state to SEND_APIVERSIONS_REQUEST (org.apache.kafka.common.security.authenticator.SaslClientAuthenticator)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 01:27:57,386&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Controller id=1, targetBrokerId=5&amp;#93;&lt;/span&gt; Connection with mwkafka-prod-01.tbd.xxx.com/10.236.30.30 disconnected (org.apache.kafka.common.network.Selector)&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.kafka.common.network.NetworkReceive.readFrom(NetworkReceive.java:96)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.receive(KafkaChannel.java:424)&lt;br/&gt;
        at org.apache.kafka.common.network.KafkaChannel.read(KafkaChannel.java:385)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.attemptRead(Selector.java:640)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:561)&lt;br/&gt;
        at org.apache.kafka.common.network.Selector.poll(Selector.java:472)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:535)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClientUtils.isReady(NetworkClientUtils.java:42)&lt;br/&gt;
        at kafka.controller.RequestSendThread.brokerReady(ControllerChannelManager.scala:281)&lt;br/&gt;
        at kafka.controller.RequestSendThread.doWork(ControllerChannelManager.scala:236)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:89)&lt;/p&gt;</comment>
                            <comment id="16784365" author="xabhi" created="Tue, 5 Mar 2019 12:19:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am also seeing a similar exception when running consumer group command (with the setup running your patch). I don&apos;t get this exception on the other kafka setup that is running with v2.1.1&lt;/p&gt;

&lt;p&gt;env KAFKA_LOG4J_CONFIG=log4j.properties KAFKA_OPTS=&quot;-Dsun.security.jgss.native=true -Dsun.security.jgss.lib=/usr/libexec/libgsswrap.so -Djavax.security.auth.useSubjectCredsOnly=false -Djava.security.auth.login.config=jaas.conf&quot; /proj/tools/infra/apache/kafka/kafka_2.12-2.1.1/bin/kafka-consumer-groups.sh --bootstrap-server mwkafka-prod-01.nyc:9092 --command-config command_config  --list  &lt;br/&gt;
Error: Executing consumer group command failed due to org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;br/&gt;
java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.wrapAndThrow(KafkaFutureImpl.java:45)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.access$000(KafkaFutureImpl.java:32)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl$SingleWaiter.await(KafkaFutureImpl.java:89)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:262)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand$ConsumerGroupService.listGroups(ConsumerGroupCommand.scala:132)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand$.main(ConsumerGroupCommand.scala:58)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand.main(ConsumerGroupCommand.scala)&lt;br/&gt;
Caused by: org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;/p&gt;</comment>
                            <comment id="16784387" author="rsivaram" created="Tue, 5 Mar 2019 12:47:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Thank you for trying out the PR. It looks like the solution I was attempting may be failing authentication. Can you attach the full client and broker logs at DEBUG level to the JIRA? It only needs to cover a short time, but the full set of logs and exceptions will be useful. I will have to see if I can set up a test environment before submitting a new PR.&lt;/p&gt;</comment>
                            <comment id="16784403" author="xabhi" created="Tue, 5 Mar 2019 13:02:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;br/&gt;
While look at the broker logs, I found multiple java.lang.NoClassDefFoundError exceptions in one of the server logs. I am not sure if this is related to this issue or totally separate issue. These exceptions started coming after the server was running fine for a day and I don&apos;t see such exceptions in other servers.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-03 03:25:33,167&amp;#93;&lt;/span&gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcher replicaId=4, leaderId=5, fetcherId=3&amp;#93;&lt;/span&gt; Error due to (kafka.server.ReplicaFetcherThread)&lt;br/&gt;
org.apache.kafka.common.KafkaException: Error processing data for partition fps.pese.desim_se-0 offset 202742&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$processFetchRequest$7(AbstractFetcherThread.scala:338)&lt;br/&gt;
        at scala.Option.foreach(Option.scala:274)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$processFetchRequest$6(AbstractFetcherThread.scala:296)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$processFetchRequest$6$adapted(AbstractFetcherThread.scala:295)&lt;br/&gt;
        at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)&lt;br/&gt;
        at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)&lt;br/&gt;
        at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$processFetchRequest$5(AbstractFetcherThread.scala:295)&lt;br/&gt;
        at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)&lt;br/&gt;
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:253)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.processFetchRequest(AbstractFetcherThread.scala:295)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$maybeFetch$3(AbstractFetcherThread.scala:132)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$maybeFetch$3$adapted(AbstractFetcherThread.scala:131)&lt;br/&gt;
        at scala.Option.foreach(Option.scala:274)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.maybeFetch(AbstractFetcherThread.scala:131)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:113)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:89)&lt;br/&gt;
Caused by: java.lang.NoClassDefFoundError: kafka/log/BatchMetadata&lt;br/&gt;
        at kafka.log.Log.$anonfun$append$2(Log.scala:925)&lt;br/&gt;
        at kafka.log.Log.maybeHandleIOException(Log.scala:2013)&lt;br/&gt;
        at kafka.log.Log.append(Log.scala:827)&lt;br/&gt;
        at kafka.log.Log.appendAsFollower(Log.scala:807)&lt;br/&gt;
        at kafka.cluster.Partition.$anonfun$doAppendRecordsToFollowerOrFutureReplica$1(Partition.scala:708)&lt;br/&gt;
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:253)&lt;br/&gt;
        at kafka.utils.CoreUtils$.inReadLock(CoreUtils.scala:259)&lt;br/&gt;
        at kafka.cluster.Partition.doAppendRecordsToFollowerOrFutureReplica(Partition.scala:699)&lt;br/&gt;
        at kafka.cluster.Partition.appendRecordsToFollowerOrFutureReplica(Partition.scala:715)&lt;br/&gt;
        at kafka.server.ReplicaFetcherThread.processPartitionData(ReplicaFetcherThread.scala:157)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.$anonfun$processFetchRequest$7(AbstractFetcherThread.scala:307)&lt;br/&gt;
        ... 16 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: kafka.log.BatchMetadata&lt;br/&gt;
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583)&lt;br/&gt;
        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)&lt;br/&gt;
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)&lt;br/&gt;
        ... 27 more&lt;/p&gt;

&lt;p&gt;Other such exceptions included java.lang.NoClassDefFoundError: kafka/common/LongRef, java.lang.NoClassDefFoundError: kafka/log/LogAppendInfo$, java.lang.NoClassDefFoundError: kafka/api/LeaderAndIsr, java.lang.NoClassDefFoundError: org/apache/zookeeper/proto/SetWatches etc.&lt;/p&gt;


&lt;p&gt;Do you need server logs for all brokers? The size is in &amp;gt;300MB for the logs is it okay to upload here on JIRA? I can upload client logs as they are small. I will try to extract out the logs for the test duration and upload here soon.&lt;/p&gt;



</comment>
                            <comment id="16784441" author="rsivaram" created="Tue, 5 Mar 2019 13:40:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Did you run a clean build using the instructions &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt; posted above? We want to make sure that all the jars you are running with came from that build to avoid NoClassDefFoundError. The client exceptions could be related to that.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&quot;These exceptions started coming after the server was running fine for a day and I don&apos;t see such exceptions in other servers.&quot;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Were all the brokers running with the build including the PR for a day? And during this time, were the clients always failing? Are the clients also running with the build including the PR?&lt;/p&gt;

&lt;p&gt;300MB would be too large to upload to the JIRA, so if it will be better to extract client and server logs for a shorter matching period of time.&lt;/p&gt;</comment>
                            <comment id="16784456" author="xabhi" created="Tue, 5 Mar 2019 13:53:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;br/&gt;
Did you run a clean build using the instructions Manikumar posted above? We want to make sure that all the jars you are running with came from that build to avoid NoClassDefFoundError. The client exceptions could be related to that.&lt;br/&gt;
&amp;gt;&amp;gt; All brokers were using JARs from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt;&apos;s build (using the instructions). There was no NoClassDefFoundError at the startup. Note that only one broker saw these exceptions and they all use same configuration and jars&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Were all the brokers running with the build including the PR for a day? And during this time, were the clients always failing? Are the clients also running with the build including the PR?&lt;br/&gt;
Yes the brokers ran fine with PR build. The client doesn&apos;t always fail. When I run producer with 1 or 2 topics for some time, it works as expected but when i go to 40 topics, it fails after sending messages to first 15 topics (this happens sequentially).&lt;/p&gt;

&lt;p&gt;The NoClassDefFoundError  exceptions went away with a restart of that particular broker.&lt;/p&gt;

&lt;p&gt;I will give this another go just to make sure no other issue is affecting the observations.&lt;/p&gt;</comment>
                            <comment id="16784669" author="xabhi" created="Tue, 5 Mar 2019 17:15:41 +0000"  >&lt;p&gt;I tried the test again. I started the producer application to publish messages on 40 topics using same producer sequentially. I got the org.apache.kafka.common.errors.UnknownServerException again. This time all the servers were running properly without any exceptions.&lt;br/&gt;
I have uploaded the producer and all brokers server.log at debug level in the issue.&lt;/p&gt;

&lt;p&gt;Getting the same exception when running consumer group command:&lt;br/&gt;
env KAFKA_LOG4J_CONFIG=/u/choudhab/kafka/log4j.properties KAFKA_OPTS=&quot;-Dsun.security.jgss.native=true -Dsun.security.jgss.lib=/usr/libexec/libgsswrap.so -Djavax.security.auth.useSubjectCredsOnly=false -Djava.security.auth.login.config=/u/bansalp/kafka/producer_jaas.conf&quot; /proj/tools/infra/apache/kafka/kafka_2.12-2.1.1/bin/kafka-consumer-groups.sh --bootstrap-server mwkafka-prod-01.nyc:9092 --command-config /u/choudhab/kafka/command_config  --list&lt;br/&gt;
Error: Executing consumer group command failed due to org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;br/&gt;
java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.wrapAndThrow(KafkaFutureImpl.java:45)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.access$000(KafkaFutureImpl.java:32)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl$SingleWaiter.await(KafkaFutureImpl.java:89)&lt;br/&gt;
	at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:262)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand$ConsumerGroupService.listGroups(ConsumerGroupCommand.scala:132)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand$.main(ConsumerGroupCommand.scala:58)&lt;br/&gt;
	at kafka.admin.ConsumerGroupCommand.main(ConsumerGroupCommand.scala)&lt;br/&gt;
Caused by: org.apache.kafka.common.errors.UnknownServerException: Error listing groups on mwkafka-prod-01.dr.xxx.com:9092 (id: 3 rack: dr.xxx.com)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-03-05 12:13:15,120&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;Principal=null&amp;#93;&lt;/span&gt;: TGT renewal thread has been interrupted and will exit. (org.apache.kafka.common.security.kerberos.KerberosLogin)&lt;/p&gt;</comment>
                            <comment id="16785591" author="rsivaram" created="Wed, 6 Mar 2019 12:53:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Thanks for the logs, they were very useful. The logs show that authentication succeeded, so the changes in the PR look ok. But there seems to an issue for the clients working with the new broker. What version of producers/consumers are you using? If you are able to use clients with the same version as the broker, it will be good in terms of testing the PR. But we should be able to use older clients as long as they are not using a very old version of Kafka. Since there are no server-side errors logged at ERROR level, it suggests that the server is failing client requests with error codes that are not known to the client. The simplest way to figure out what the error was would be turn on request logging on the broker. And then you can see the request and responses in detail. In config/log4j.properties, change this line to TRACE instead of WARN, and you should find the trace in kafka-request.log in the log directory.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log4j.logger.kafka.request.logger=WARN, requestAppender
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16785656" author="xabhi" created="Wed, 6 Mar 2019 14:00:53 +0000"  >&lt;p&gt;&amp;gt;&amp;gt; What version of producers/consumers are you using?&lt;br/&gt;
I am using this client jar for producer and consumer -  kafka_2.12-2.1.1/libs/kafka-clients-2.1.1.jar&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;The simplest way to figure out what the error was would be turn on request logging on the broker. And then you can see the request and responses in detail. In config/log4j.properties, change this line to TRACE instead of WARN, and you should find the trace in kafka-request.log in the log directory.&lt;br/&gt;
I will try this and update here soon.&lt;/p&gt;</comment>
                            <comment id="16787862" author="xabhi" created="Fri, 8 Mar 2019 12:58:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;br/&gt;
I am not seeing the  org.apache.kafka.common.errors.UnknownServerException with the producer anymore and haven&apos;t noticed the 100% cpu so far with the patch.&lt;br/&gt;
Can we please get this patch included in the v2.2.0 release? And when is v2.2.0 release scheduled?&lt;/p&gt;</comment>
                            <comment id="16787900" author="rsivaram" created="Fri, 8 Mar 2019 13:53:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Thank you for testing, that is good news.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; Are we likely to have another RC for 2.2.0? This is a critical issue, but not a regression (it has been this way since the code was first added in 0.9.0).&lt;/p&gt;</comment>
                            <comment id="16787978" author="ijuma" created="Fri, 8 Mar 2019 15:35:03 +0000"  >&lt;p&gt;We will need another RC, but not sure we want to include this fix if it&apos;s not a regression. We would have to evaluate the risk.&lt;/p&gt;</comment>
                            <comment id="16789251" author="xabhi" created="Mon, 11 Mar 2019 07:40:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; This issue is a blocker for our deployment. Can this be included in the next v2.2.0 release?&lt;/p&gt;</comment>
                            <comment id="16796961" author="xabhi" created="Wed, 20 Mar 2019 09:34:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; &lt;br/&gt;
Any updates on whether this will be available in Kafka v2.2.0 release ?&lt;/p&gt;</comment>
                            <comment id="16797611" author="rsivaram" created="Wed, 20 Mar 2019 22:14:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xabhi&quot; class=&quot;user-hover&quot; rel=&quot;xabhi&quot;&gt;xabhi&lt;/a&gt; Sorry, we couldn&apos;t meet the dates for the v2.2.0 release.&lt;/p&gt;</comment>
                            <comment id="16798931" author="xabhi" created="Fri, 22 Mar 2019 11:36:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; In what release can I expect the fix to be and what will be expected dates for it? I am asking this since it is a blocker for our deployment and will probably have to continue to use the local patched kafka version.&lt;/p&gt;</comment>
                            <comment id="16807854" author="enothereska" created="Tue, 2 Apr 2019 15:24:12 +0000"  >&lt;p&gt;So this applies to 2.2 as well right? Abhi do you want to change the affected versions to add 2.2? Thanks.&lt;/p&gt;</comment>
                            <comment id="16807858" author="xabhi" created="Tue, 2 Apr 2019 15:27:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enothereska&quot; class=&quot;user-hover&quot; rel=&quot;enothereska&quot;&gt;enothereska&lt;/a&gt; I added v2.2 as well in the description. Do you have any updates on when the next version is planned and if this fix will be available in it?&lt;/p&gt;</comment>
                            <comment id="16852787" author="xabhi" created="Fri, 31 May 2019 08:15:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enothereska&quot; class=&quot;user-hover&quot; rel=&quot;enothereska&quot;&gt;enothereska&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Is there any update on this? When will this patch be available in Kafka release?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Abhi&lt;/p&gt;</comment>
                            <comment id="16937461" author="bansalp" created="Wed, 25 Sep 2019 06:54:02 +0000"  >&lt;p&gt;Do you have any updates on when this fix will be available?&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="16988524" author="bansalp" created="Thu, 5 Dec 2019 06:43:24 +0000"  >&lt;p&gt;Is there any update. Seems like 2.3.0 and 2.3.1 are already out and they ddon&apos;t have this fix. Which version this fix will be available?&lt;/p&gt;</comment>
                            <comment id="16991524" author="rsivaram" created="Mon, 9 Dec 2019 11:58:33 +0000"  >&lt;p&gt;I have rebased the PR, added an unit test and tested broker with the fix locally. So the PR is now ready for review and hopefully we can merge it for the next release (not 2.4.0 since it is too late).&lt;/p&gt;</comment>
                            <comment id="16994463" author="githubbot" created="Thu, 12 Dec 2019 09:56:18 +0000"  >&lt;p&gt;rajinisivaram commented on pull request #6337: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7925&quot; title=&quot;Constant 100% cpu usage by all kafka brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7925&quot;&gt;&lt;del&gt;KAFKA-7925&lt;/del&gt;&lt;/a&gt; - Create credentials only once for sun.security.jgss.native&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6337&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12961208" name="jira-server.log-1" size="10367" author="xabhi" created="Tue, 5 Mar 2019 17:16:45 +0000"/>
                            <attachment id="12961209" name="jira-server.log-2" size="8700" author="xabhi" created="Tue, 5 Mar 2019 17:16:44 +0000"/>
                            <attachment id="12961210" name="jira-server.log-3" size="10587" author="xabhi" created="Tue, 5 Mar 2019 17:16:44 +0000"/>
                            <attachment id="12961211" name="jira-server.log-4" size="4888" author="xabhi" created="Tue, 5 Mar 2019 17:16:44 +0000"/>
                            <attachment id="12961212" name="jira-server.log-5" size="8734" author="xabhi" created="Tue, 5 Mar 2019 17:16:45 +0000"/>
                            <attachment id="12961213" name="jira-server.log-6" size="6506" author="xabhi" created="Tue, 5 Mar 2019 17:16:45 +0000"/>
                            <attachment id="12961207" name="jira_prod.producer.log" size="86119" author="xabhi" created="Tue, 5 Mar 2019 17:16:44 +0000"/>
                            <attachment id="12958532" name="threadump20190212.txt" size="98911" author="xabhi" created="Wed, 13 Feb 2019 08:59:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0xmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>