<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:23:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9568] Kstreams APPLICATION_SERVER_CONFIG is not updated with static membership</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9568</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;A kstreams application with static membership, and StreamsConfg.APPLICATION_SERVER_CONFIG set, will NOT update old server config upon restart of application on new host.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;start two kstreams applications (with same consumer group) and enable static membership (and set application server config to &amp;lt;ip-addr&amp;gt;:&amp;lt;port&amp;gt;)&lt;/li&gt;
	&lt;li&gt;kill one of the applications and restart it on a new host(with new ip) before timeout ends (so that rebalancing doesn&apos;t occur).&lt;/li&gt;
	&lt;li&gt;the other kstreams application will now have an invalid application_server_config&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Possible fix:&lt;/p&gt;

&lt;p&gt;If an application restarts with a new host/identity..etc, it could trigger a &quot;light-rebalance&quot; where the other applications in the consumer group don&apos;t change partition assignments ,but instead just get their configuration updated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13286029">KAFKA-9568</key>
            <summary>Kstreams APPLICATION_SERVER_CONFIG is not updated with static membership</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ableegoldman">A. Sophie Blee-Goldman</assignee>
                                    <reporter username="djchuy">David J. Garcia</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Feb 2020 16:36:48 +0000</created>
                <updated>Thu, 19 Mar 2020 01:53:19 +0000</updated>
                            <resolved>Thu, 19 Mar 2020 01:53:08 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>2.5.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17039505" author="bchen225242" created="Tue, 18 Feb 2020 22:09:29 +0000"  >&lt;p&gt;Thanks for reporting this, I&apos;m not sure I fully understood the question here. So let&apos;s suppose to have two instances A &amp;amp; B, we first migrate A to another host so that it&apos;s&#160;APPLICATION_SERVER_CONFIG would change, while instance B should still be using the same ip address and port as it is not restarting. So why would B get an invalid config in this case?&lt;/p&gt;</comment>
                            <comment id="17039685" author="djchuy" created="Wed, 19 Feb 2020 03:58:30 +0000"  >&lt;p&gt;B would have an incorrect A mapping.&#160; For example, suppose that there was a state-store with some data on A and other data on B.&#160; Here is some scala that I&apos;m using:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val keyHostInfo: Option[IQHost] = Option(streamsRef.metadataForKey(
  storeName,
  docId,
  Implicits.keySerde.serializer)).map(m =&amp;gt; IQHost(m.host(), m.port(), thisHost.IQConfig))

&lt;span class=&quot;code-comment&quot;&gt;//m is of type StreamsMetadata&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;StreamsMetadata has mappings that link the partition of docId to a host/port.&#160; Sometimes the host is the current machine, other times its on another machine (as reported by that machine to the controller)&lt;/p&gt;</comment>
                            <comment id="17040402" author="bchen225242" created="Wed, 19 Feb 2020 20:23:19 +0000"  >&lt;p&gt;I guess the purpose here was to trigger an explicit rebalance. Fortunately, we have an ongoing KIP:&#160;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-568%3A+Explicit+rebalance+triggering+on+the+Consumer&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-568%3A+Explicit+rebalance+triggering+on+the+Consumer&lt;/a&gt;&lt;br/&gt;
which could help triggering a rebalance from the client perspective. Feel free to check it out and see if this could help with the situation.&lt;/p&gt;</comment>
                            <comment id="17051503" author="o0oxid" created="Wed, 4 Mar 2020 18:25:50 +0000"  >&lt;p&gt;We run Kafka Streams application with &lt;em&gt;Static Membership&lt;/em&gt; and uses&#160;&lt;em&gt;Interactive Queries&lt;/em&gt; functionality. Say we have two instances A and B running on HOST_A and HOST_B correspondingly. Then A migrated to another HOST_C. The APPLICATION_SERVER_CONFIG changes to the IP of HOST_C.&#160; Issue appears when you need to query remote store on the instance A. In that case&#160;&lt;tt&gt;StreamsMetadata&lt;/tt&gt; doesn&apos;t get updated and returns ip address of HOST_A, even though A is already migrated to HOST_C.&lt;/p&gt;

&lt;p&gt;Let me try to explain the case we are dealing with on an example from kafka-streams-example project.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I added static group membership to&#160;WordCountInteractiveQueriesExample.java see &lt;a href=&quot;https://github.com/o0oxid/kafka-streams-examples/commit/54cb74f40ef3c659588dbedc496bc456123db215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/o0oxid/kafka-streams-examples/commit/54cb74f40ef3c659588dbedc496bc456123db215&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;Started confluent-platform:&#160;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;48a1ede4f588        confluentinc/cp-enterprise-kafka:5.4.0   &quot;/etc/confluent/dock&#8230;&quot;   2 hours ago         Up 2 hours          0.0.0.0:9092-&amp;gt;9092/tcp, 0.0.0.0:29092-&amp;gt;29092/tcp         kafka-streams-examples_kafka_1
bd6cf95c56b7        confluentinc/cp-zookeeper:5.4.0          &quot;/etc/confluent/dock&#8230;&quot;   2 hours ago         Up 2 hours          2181/tcp, 2888/tcp, 3888/tcp, 0.0.0.0:32181-&amp;gt;32181/tcp   kafka-streams-examples_zookeeper_1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Run first application in static group membership mode - group.instance.id &apos;client-1&apos; and port &apos;7070&apos;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt;  java -cp target/kafka-streams-examples-5.4.0-standalone.jar io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesExample 7070 localhost:9092 client-1
[2020-03-04 10:38:31,071] WARN [main] The configuration &apos;admin.retries&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
[2020-03-04 10:38:31,072] WARN [main] The configuration &apos;admin.retry.backoff.ms&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
Mar 04, 2020 10:38:31 AM org.glassfish.jersey.internal.inject.Providers checkProviderRuntime
WARNING: A provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService will be ignored.
[2020-03-04 10:38:49,717] WARN [interactive-queries-example-client-StreamThread-1] [Consumer instanceId=client-1-1, clientId=interactive-queries-example-client-StreamThread-1-consumer, groupId=interactive-queries-example] The following subscribed topics are not assigned to any members: [interactive-queries-example-word-count-repartition]  (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Run second application in different terminal - group.instance.id &apos;client-2&apos; and port &apos;7071&apos;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; java -cp target/kafka-streams-examples-5.4.0-standalone.jar io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesExample 7071 localhost:9092 client-2
[2020-03-04 10:39:05,188] WARN [main] The configuration &apos;admin.retries&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
[2020-03-04 10:39:05,189] WARN [main] The configuration &apos;admin.retry.backoff.ms&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
Mar 04, 2020 10:39:05 AM org.glassfish.jersey.internal.inject.Providers checkProviderRuntime
WARNING: A provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService will be ignored.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Querying StreamsMetadata returns two instances &apos;localhost:7070&apos; and &apos;localhost:7071&apos;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl -s localhost:7070/state/instances | jq
[
  {
    &quot;host&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 7070,
    &quot;storeNames&quot;: [
      &quot;windowed-word-count&quot;
    ]
  },
  {
    &quot;host&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 7071,
    &quot;storeNames&quot;: [
      &quot;word-count&quot;
    ]
  }
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Now let&apos;s re-run the second application with same group.instance.id &apos;client-2&apos;, but different port &apos;7072&apos;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt;java -cp target/kafka-streams-examples-5.4.0-standalone.jar io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesExample 7072 localhost:9092 client-2
[2020-03-04 10:39:05,188] WARN [main] The configuration &apos;admin.retries&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
[2020-03-04 10:39:05,189] WARN [main] The configuration &apos;admin.retry.backoff.ms&apos; was supplied but isn&apos;t a known config. (org.apache.kafka.clients.consumer.ConsumerConfig)
Mar 04, 2020 10:39:05 AM org.glassfish.jersey.internal.inject.Providers checkProviderRuntime
WARNING: A provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider io.confluent.examples.streams.interactivequeries.WordCountInteractiveQueriesRestService will be ignored.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Querying instance metadata returns stale data. Note the port is the same &apos;7071&apos;, while application is running on &apos;7072&apos;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; curl -s localhost:7070/state/instances | jq
[
  {
    &quot;host&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 7070,
    &quot;storeNames&quot;: [
      &quot;windowed-word-count&quot;
    ]
  },
  {
    &quot;host&quot;: &quot;localhost&quot;,
    &quot;port&quot;: 7071,
    &quot;storeNames&quot;: [
      &quot;word-count&quot;
    ]
  }
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So now it&apos;s impossible to perform interactive queries against remote machine because metadata points to the old port &apos;7071&apos;.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Issue is not reproducible with dynamic membership.&lt;/p&gt;</comment>
                            <comment id="17059069" author="bchen225242" created="Fri, 13 Mar 2020 20:54:55 +0000"  >&lt;p&gt;The current design of static membership will not kick-off rebalance as long as we maintain two members with group.instance.id `client-1` and `client-2`. You have to give another instance id like `client-3` to make it actually rebalance.&lt;/p&gt;

&lt;p&gt;There is another open ticket to add the command line support to force remove a static member from admin client:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9440&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-9440&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That would also help resolve the issue in upcoming 2.6&lt;/p&gt;</comment>
                            <comment id="17059081" author="vvcephei" created="Fri, 13 Mar 2020 21:17:11 +0000"  >&lt;p&gt;I think the idea is that the member is still logically the same, but has a new IP address, so the cluster metadata needs to be updated.&lt;/p&gt;

&lt;p&gt;The ticket description suggests doing a &#8220;light rebalance&#8221; so the members can still gossip the new metadata, but the assignment won&#8217;t change. It sounds promising to me, but I&#8217;m not that deep into static membership. &lt;/p&gt;

&lt;p&gt;Wdyt about that, Boyang?&lt;/p&gt;</comment>
                            <comment id="17059093" author="ableegoldman" created="Fri, 13 Mar 2020 21:38:04 +0000"  >&lt;p&gt;In KIP-568/&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9525&quot; title=&quot;Allow explicit rebalance triggering on the Consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9525&quot;&gt;&lt;del&gt;KAFKA-9525&lt;/del&gt;&lt;/a&gt;&#160;we added a new #enforceRebalance API to the consumer, in part to address the fact that we can&apos;t otherwise force static members to rebalance. This was a problem for version probing and the upcoming KIP-441, which rely on triggering rebalances for each member to send their new/updated metadata. This seems like a similar situation, so I think we can leverage #enforceRebalance here as well by having a &quot;new&quot; member check the host info in its returned assignment and trigger the group to rebalance if it doesn&apos;t match the current expected host info.&#160;&lt;/p&gt;

&lt;p&gt;Of course this doesn&apos;t help existing apps, anything older than 2.6 would still require manual intervention as Boyang described&lt;/p&gt;</comment>
                            <comment id="17059137" author="githubbot" created="Sat, 14 Mar 2020 00:18:38 +0000"  >&lt;p&gt;ableegoldman commented on pull request #8299: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9568&quot; title=&quot;Kstreams APPLICATION_SERVER_CONFIG is not updated with static membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9568&quot;&gt;&lt;del&gt;KAFKA-9568&lt;/del&gt;&lt;/a&gt;: enforce rebalance if client endpoint has changed&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8299&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17060313" author="o0oxid" created="Mon, 16 Mar 2020 15:44:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;&#160;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;&#160;thanks for explanations. Will be watching the work in scope of KIP-441 which is addressing our case with huge state store. ATM we just use workaround and assign static IP addresses to the static members.&lt;/p&gt;</comment>
                            <comment id="17062201" author="githubbot" created="Thu, 19 Mar 2020 01:37:43 +0000"  >&lt;p&gt;guozhangwang commented on pull request #8299: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9568&quot; title=&quot;Kstreams APPLICATION_SERVER_CONFIG is not updated with static membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9568&quot;&gt;&lt;del&gt;KAFKA-9568&lt;/del&gt;&lt;/a&gt;: enforce rebalance if client endpoint has changed&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8299&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bmcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>