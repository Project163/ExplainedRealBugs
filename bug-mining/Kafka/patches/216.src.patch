diff --git a/core/src/main/scala/kafka/log/Log.scala b/core/src/main/scala/kafka/log/Log.scala
index 9a5f053129..b2a7170de5 100644
--- a/core/src/main/scala/kafka/log/Log.scala
+++ b/core/src/main/scala/kafka/log/Log.scala
@@ -282,7 +282,11 @@ private[kafka] class Log(val dir: File,
             if(assignOffsets) {
               val offsetCounter = new AtomicLong(nextOffset.get)
               val firstOffset = offsetCounter.get
-              validMessages = validMessages.assignOffsets(offsetCounter, messageSetInfo.codec)
+              try {
+                validMessages = validMessages.assignOffsets(offsetCounter, messageSetInfo.codec)
+              } catch {
+                case e: IOException => throw new KafkaException("Error in validating messages while appending to log '%s'".format(name), e)
+              }
               val lastOffset = offsetCounter.get - 1
               (firstOffset, lastOffset)
             } else {
diff --git a/core/src/main/scala/kafka/message/ByteBufferMessageSet.scala b/core/src/main/scala/kafka/message/ByteBufferMessageSet.scala
index 873699ff7e..80d5fe3cbc 100644
--- a/core/src/main/scala/kafka/message/ByteBufferMessageSet.scala
+++ b/core/src/main/scala/kafka/message/ByteBufferMessageSet.scala
@@ -62,11 +62,13 @@ object ByteBufferMessageSet {
     val inputStream: InputStream = new ByteBufferBackedInputStream(message.payload)
     val intermediateBuffer = new Array[Byte](1024)
     val compressed = CompressionFactory(message.compressionCodec, inputStream)
-    Stream.continually(compressed.read(intermediateBuffer)).takeWhile(_ > 0).foreach { dataRead =>
-      outputStream.write(intermediateBuffer, 0, dataRead)
+    try {
+      Stream.continually(compressed.read(intermediateBuffer)).takeWhile(_ > 0).foreach { dataRead =>
+        outputStream.write(intermediateBuffer, 0, dataRead)
+      }
+    } finally {
+      compressed.close()
     }
-    compressed.close()
-
     val outputBuffer = ByteBuffer.allocate(outputStream.size)
     outputBuffer.put(outputStream.toByteArray)
     outputBuffer.rewind
