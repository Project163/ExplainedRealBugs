diff --git a/core/src/main/scala/kafka/utils/Os.scala b/clients/src/main/java/org/apache/kafka/common/Os.java
similarity index 60%
rename from core/src/main/scala/kafka/utils/Os.scala
rename to clients/src/main/java/org/apache/kafka/common/Os.java
index 0100a0ab69..ba4151613e 100644
--- a/core/src/main/scala/kafka/utils/Os.scala
+++ b/clients/src/main/java/org/apache/kafka/common/Os.java
@@ -1,11 +1,11 @@
-/**
+/*
  * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
+ * contributor license agreements. See the NOTICE file distributed with
  * this work for additional information regarding copyright ownership.
  * The ASF licenses this file to You under the Apache License, Version 2.0
  * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- * 
+ * the License. You may obtain a copy of the License at
+ *
  *    http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
@@ -14,12 +14,17 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
+package org.apache.kafka.common;
+
+import java.util.Locale;
 
-package kafka.utils
+public final class Os {
+    public static final String NAME;
 
-import java.util.Locale
+    public static final boolean IS_WINDOWS;
 
-object Os {
-  val name = System.getProperty("os.name").toLowerCase(Locale.ROOT)
-  val isWindows = name.startsWith("windows")
-}
\ No newline at end of file
+    static {
+        NAME = System.getProperty("os.name").toLowerCase(Locale.ROOT);
+        IS_WINDOWS = NAME.startsWith("windows");
+    }
+}
diff --git a/clients/src/main/java/org/apache/kafka/common/utils/Shell.java b/clients/src/main/java/org/apache/kafka/common/utils/Shell.java
index 0a7e1afd83..33bf3c1647 100644
--- a/clients/src/main/java/org/apache/kafka/common/utils/Shell.java
+++ b/clients/src/main/java/org/apache/kafka/common/utils/Shell.java
@@ -115,11 +115,6 @@ abstract public class Shell {
 
         try {
             parseExecResult(inReader); // parse the output
-            // clear the input stream buffer
-            String line = null;
-            while (line != null) {
-                line = inReader.readLine();
-            }
             // wait for the process to finish and check the exit code
             exitCode = process.waitFor();
             try {
diff --git a/clients/src/test/java/org/apache/kafka/common/utils/ShellTest.java b/clients/src/test/java/org/apache/kafka/common/utils/ShellTest.java
new file mode 100644
index 0000000000..72d05907fc
--- /dev/null
+++ b/clients/src/test/java/org/apache/kafka/common/utils/ShellTest.java
@@ -0,0 +1,45 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.kafka.common.utils;
+
+import org.apache.kafka.common.Os;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.rules.Timeout;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assume.assumeTrue;
+
+public class ShellTest {
+    @Rule
+    public final Timeout globalTimeout = Timeout.seconds(180);
+
+    @Test
+    public void testEchoHello() throws Exception {
+        assumeTrue(!Os.IS_WINDOWS);
+        String output = Shell.execCommand("echo", "hello");
+        assertEquals("hello\n", output);
+    }
+
+    @Test
+    public void testHeadDevZero() throws Exception {
+        assumeTrue(!Os.IS_WINDOWS);
+        final int length = 100000;
+        String output = Shell.execCommand("head", "-c", Integer.toString(length), "/dev/zero");
+        assertEquals(length, output.length());
+    }
+}
diff --git a/core/src/main/scala/kafka/log/AbstractIndex.scala b/core/src/main/scala/kafka/log/AbstractIndex.scala
index 6f850d54ec..53b2f74cfb 100644
--- a/core/src/main/scala/kafka/log/AbstractIndex.scala
+++ b/core/src/main/scala/kafka/log/AbstractIndex.scala
@@ -24,7 +24,8 @@ import java.util.concurrent.locks.{Lock, ReentrantLock}
 
 import kafka.log.IndexSearchType.IndexSearchEntity
 import kafka.utils.CoreUtils.inLock
-import kafka.utils.{CoreUtils, Logging, Os}
+import kafka.utils.{CoreUtils, Logging}
+import org.apache.kafka.common.Os
 import org.apache.kafka.common.utils.Utils
 import sun.nio.ch.DirectBuffer
 
@@ -104,8 +105,8 @@ abstract class AbstractIndex[K, V](@volatile var file: File, val baseOffset: Lon
       val position = mmap.position
 
       /* Windows won't let us modify the file length while the file is mmapped :-( */
-      if(Os.isWindows)
-        forceUnmap(mmap)
+      if(Os.IS_WINDOWS)
+        forceUnmap(mmap);
       try {
         raf.setLength(roundedNewSize)
         mmap = raf.getChannel().map(FileChannel.MapMode.READ_WRITE, 0, roundedNewSize)
@@ -216,12 +217,12 @@ abstract class AbstractIndex[K, V](@volatile var file: File, val baseOffset: Lon
    * and this requires synchronizing reads.
    */
   protected def maybeLock[T](lock: Lock)(fun: => T): T = {
-    if(Os.isWindows)
+    if(Os.IS_WINDOWS)
       lock.lock()
     try {
       fun
     } finally {
-      if(Os.isWindows)
+      if(Os.IS_WINDOWS)
         lock.unlock()
     }
   }
