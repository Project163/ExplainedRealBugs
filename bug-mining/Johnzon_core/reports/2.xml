<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:01:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JOHNZON-18] JsonStreamParserImpl not filling up buffer consistently</title>
                <link>https://issues.apache.org/jira/browse/JOHNZON-18</link>
                <project id="12315523" key="JOHNZON">Johnzon</project>
                    <description>&lt;p&gt;This is related to the issue discussed &lt;a href=&quot;https://issues.apache.org/jira/browse/JOHNZON-17&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;. Basically, the &quot;read&quot; method might not read all the bytes at once. We need to make sure to read at least one until we reach the value &quot;-1&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12752670">JOHNZON-18</key>
            <summary>JsonStreamParserImpl not filling up buffer consistently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="salyh">Hendrik Saly</assignee>
                                    <reporter username="tveronezi">Thiago Veronezi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Nov 2014 10:40:50 +0000</created>
                <updated>Wed, 5 Nov 2014 20:41:19 +0000</updated>
                            <resolved>Wed, 5 Nov 2014 20:41:19 +0000</resolved>
                                                    <fixVersion>0.2-incubating</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14195987" author="tveronezi" created="Tue, 4 Nov 2014 10:41:48 +0000"  >&lt;p&gt;Proposed patch here: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679194/12679194_JsonStreamParserImpl_not_filling_up_buffer_consistently.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14196442" author="salyh" created="Tue, 4 Nov 2014 17:48:16 +0000"  >&lt;p&gt;not sure if this is necessary here and if read(byte[], int, int) really will return 0 if there is still something to read from the stream. This code fragment is performance crucial so lets make sure that we really need to change it. Maybe we can have a look into some stream impls to get an impression.&lt;/p&gt;</comment>
                            <comment id="14196453" author="romain.manni-bucau" created="Tue, 4 Nov 2014 17:55:55 +0000"  >&lt;p&gt;saw it as well on slow inputstreams but we cansurely just have a retry mecanism (while == 0) instead of reading byte by byte&lt;/p&gt;</comment>
                            <comment id="14196604" author="tveronezi" created="Tue, 4 Nov 2014 18:56:37 +0000"  >&lt;p&gt;I thought about the retry too, but it may lead to multiple loops (infinite maybe for some obscure reason) or to exceptions in case we cannot load the char after a certain number of tries. The solution that I proposed makes sure that we have at least the next char; after retrieving it (if any), it tries to load the buffer for the next iteration. &lt;/p&gt;

&lt;p&gt;Maybe a good refactoring would be to try to load the buffer first; if the stream behaves, load the next char and try to load the buffer for the next iteration. This way, only slow buffers would suffer.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.
.
.
availableCharsInBuffer = in.read(buffer, 0, buffer.length);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(availableCharsInBuffer == -1) {
  availableCharsInBuffer = 0;
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; EOF;
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(availableCharsInBuffer == 0) {
  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; stream is slow and didn&apos;t have time to load the a single &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; into &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; buffer.
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// make sure that we have at least the next &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value = in.read();
  availableCharsInBuffer = in.read(buffer, 1, buffer.length - 1);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(availableCharsInBuffer == -1) {
    availableCharsInBuffer = 1; &lt;span class=&quot;code-comment&quot;&gt;// we have at least the &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt; above
&lt;/span&gt;  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    availableCharsInBuffer += 1; &lt;span class=&quot;code-comment&quot;&gt;// adding the &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt; above to the list of available chars
&lt;/span&gt;  }
  buffer[0] = (&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;) value;
}
.
.
.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14196626" author="tveronezi" created="Tue, 4 Nov 2014 19:11:06 +0000"  >&lt;p&gt;This is an extract of the java.io.BufferedReader class...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
  n = in.read(cb, dst, cb.length - dst);
} &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (n == 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If Sun/Oracle does it, we can do it too. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14196633" author="tveronezi" created="Tue, 4 Nov 2014 19:18:34 +0000"  >&lt;p&gt;New patch: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679283/12679283_JsonStreamParserImpl_not_filling_up_buffer_consistently_2.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_2.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Thanks Romain for this tip!&lt;/p&gt;</comment>
                            <comment id="14196670" author="tveronezi" created="Tue, 4 Nov 2014 19:36:52 +0000"  >&lt;p&gt;I forgot one small thing. The patch #3 does the trick for me.&lt;br/&gt;
&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679290/12679290_JsonStreamParserImpl_not_filling_up_buffer_consistently_3.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_3.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_3.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14196676" author="salyh" created="Tue, 4 Nov 2014 19:39:31 +0000"  >&lt;p&gt;second patch looks good but when i try to test this seems the ava.io.InputStreamReader cannot handle it&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;javax.json.stream.JsonParsingException: Unexpected IO exception on [lineNumber=1, columnNumber=1, streamOffset=0]
	at org.apache.johnzon.core.JsonStreamParserImpl.uexio(JsonStreamParserImpl.java:968)
	at org.apache.johnzon.core.JsonStreamParserImpl.readNextChar(JsonStreamParserImpl.java:278)
	at org.apache.johnzon.core.JsonStreamParserImpl.readNextNonWhitespaceChar(JsonStreamParserImpl.java:302)
	at org.apache.johnzon.core.JsonStreamParserImpl.next(JsonStreamParserImpl.java:337)
	at org.apache.johnzon.core.JsonParserTest.assertSimple(JsonParserTest.java:69)
	at org.apache.johnzon.core.JsonParserTest.simpleAttempting(JsonParserTest.java:248)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:483)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:675)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)
Caused by: java.io.IOException: Underlying input stream returned zero bytes
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:288)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
	at java.io.InputStreamReader.read(InputStreamReader.java:184)
	at org.apache.johnzon.core.JsonStreamParserImpl.readNextChar(JsonStreamParserImpl.java:270)
	... 27 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;tested wit something like this (try to simulate an inpustream with sometimes returns 0)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AttemptingInputStream &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ByteArrayInputStream {
        
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; flip = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; AttemptingInputStream(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buf) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(buf);
            
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; b[], &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; off, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; len) {
            
            flip = !flip;
            
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(flip) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
            }
            
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (b == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NullPointerException();
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (off &amp;lt; 0 || 1 &amp;gt; b.length - off) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IndexOutOfBoundsException();
            }
         
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pos &amp;gt;= count) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
            }

            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; avail = count - pos;
            
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (avail == 0) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
            }
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(buf, pos, b, off, 1);
            pos++;
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14196702" author="salyh" created="Tue, 4 Nov 2014 19:52:30 +0000"  >&lt;p&gt;Hehe, sun.nio.cs.StreamDecoder  is giving up when read returns 0&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/sun/nio/cs/StreamDecoder.java#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/sun/nio/cs/StreamDecoder.java#L287&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14196729" author="tveronezi" created="Tue, 4 Nov 2014 20:07:57 +0000"  >&lt;p&gt;Hendrik, thanks for making me add a test case for that. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679300/12679300_JsonStreamParserImpl_not_filling_up_buffer_consistently_4.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_4.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_4.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;It covers those new lines, but it does not throw that exception.&lt;/p&gt;</comment>
                            <comment id="14196747" author="salyh" created="Tue, 4 Nov 2014 20:21:18 +0000"  >&lt;p&gt;The testcase also passes for me without your modifications at JsonStreamParserImpl&lt;/p&gt;</comment>
                            <comment id="14196760" author="salyh" created="Tue, 4 Nov 2014 20:32:22 +0000"  >&lt;p&gt;try this &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;abcdef&quot;, Json.createReaderFactory(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).createReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SlowIs(), UTF_8).readArray().getString(0));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you specify the encoding the code is not running into the RFC4627AwareInputStreamReader which already fixed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14196768" author="salyh" created="Tue, 4 Nov 2014 20:36:46 +0000"  >&lt;p&gt;ok, got answer from the openjdk guys: &lt;a href=&quot;http://mail.openjdk.java.net/pipermail/core-libs-dev/2014-November/029493.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail.openjdk.java.net/pipermail/core-libs-dev/2014-November/029493.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;read(byte[], int, int) with result of 0 cannot happen if i read their answer correctly&lt;/p&gt;

&lt;p&gt;So the RFC4627AwareInputStreamReader fix (&lt;a href=&quot;https://issues.apache.org/jira/browse/JOHNZON-17&quot; title=&quot;RFC4627AwareInputStreamReader - Make sure that we read all the bytes before throwing an exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JOHNZON-17&quot;&gt;&lt;del&gt;JOHNZON-17&lt;/del&gt;&lt;/a&gt;) was necessary, this one i assume we can close?&lt;/p&gt;</comment>
                            <comment id="14196840" author="tveronezi" created="Tue, 4 Nov 2014 21:22:06 +0000"  >&lt;p&gt;Not really,&lt;/p&gt;

&lt;p&gt;This guy is breaking my TomEE tests locally (I run it in a VM). TomEE sends a &lt;a href=&quot;https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/sun/net/www/protocol/http/HttpURLConnection.java#L2932&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sun.net.www.protocol.http.HttpURLConnection$HttpInputStream&lt;/a&gt; to this reader. This stream extends FilterInputStream, which also might return 0 on &quot;read&quot;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/io/FilterInputStream.html#read(byte[],%20int,%20int)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/io/FilterInputStream.html#read(byte[],%20int,%20int)&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14196862" author="salyh" created="Tue, 4 Nov 2014 21:33:25 +0000"  >&lt;p&gt;Can you fix your testcase so that if fails on current HEAD and then get fixed when your patch is applied?&lt;br/&gt;
Then i will run the benchmarks &lt;a href=&quot;https://github.com/salyh/jsr353-benchmark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/salyh/jsr353-benchmark&lt;/a&gt; to get an impression of a possible perf impact.&lt;/p&gt;</comment>
                            <comment id="14196900" author="tveronezi" created="Tue, 4 Nov 2014 21:50:04 +0000"  >&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;Sure. I will check it out tomorrow. &lt;/p&gt;

&lt;p&gt;[]s,&lt;br/&gt;
Thiago&lt;/p&gt;</comment>
                            <comment id="14198316" author="tveronezi" created="Wed, 5 Nov 2014 12:13:56 +0000"  >&lt;p&gt;Ah! Managed to reproduce the error. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It turns out I need to work on this a bit more.&lt;/p&gt;

&lt;p&gt;I will propose a new patch shortly.&lt;/p&gt;

&lt;p&gt;[]s&lt;/p&gt;</comment>
                            <comment id="14198512" author="tveronezi" created="Wed, 5 Nov 2014 15:27:34 +0000"  >&lt;p&gt;Done,&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679544/12679544_JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; reproduces the issue. Basically, the stream is not completely loaded in one single shot.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679545/12679545_JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_fix.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_fix.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_fix.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; makes it possible to load the rest of the bytes.&lt;/p&gt;

&lt;p&gt;Thanks a lot for the code-review!&lt;/p&gt;

&lt;p&gt;[]s,&lt;br/&gt;
Thiago.&lt;/p&gt;</comment>
                            <comment id="14198518" author="tveronezi" created="Wed, 5 Nov 2014 15:31:25 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679546/12679546_JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_1.patch&quot; title=&quot;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_1.patch attached to JOHNZON-18&quot;&gt;JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_1.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; without the extra auto-reformmating.&lt;/p&gt;</comment>
                            <comment id="14198942" author="salyh" created="Wed, 5 Nov 2014 19:43:03 +0000"  >&lt;p&gt;applied, thanks a lot&lt;/p&gt;</comment>
                            <comment id="14199043" author="tveronezi" created="Wed, 5 Nov 2014 20:41:19 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12679194" name="JsonStreamParserImpl_not_filling_up_buffer_consistently.patch" size="1589" author="tveronezi" created="Tue, 4 Nov 2014 10:41:48 +0000"/>
                            <attachment id="12679283" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_2.patch" size="1019" author="tveronezi" created="Tue, 4 Nov 2014 19:18:34 +0000"/>
                            <attachment id="12679290" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_3.patch" size="1355" author="tveronezi" created="Tue, 4 Nov 2014 19:36:52 +0000"/>
                            <attachment id="12679300" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_4.patch" size="2950" author="tveronezi" created="Tue, 4 Nov 2014 20:07:57 +0000"/>
                            <attachment id="12679544" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase.patch" size="33551" author="tveronezi" created="Wed, 5 Nov 2014 15:27:34 +0000"/>
                            <attachment id="12679546" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_1.patch" size="1729" author="tveronezi" created="Wed, 5 Nov 2014 15:31:25 +0000"/>
                            <attachment id="12679545" name="JsonStreamParserImpl_not_filling_up_buffer_consistently_testcase_fix.patch" size="1688" author="tveronezi" created="Wed, 5 Nov 2014 15:27:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21xnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>