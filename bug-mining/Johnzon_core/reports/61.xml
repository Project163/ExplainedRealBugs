<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:01:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JOHNZON-312] JsonPatch&apos;s add operation updates unexpected fields</title>
                <link>https://issues.apache.org/jira/browse/JOHNZON-312</link>
                <project id="12315523" key="JOHNZON">Johnzon</project>
                    <description>&lt;p&gt;Recently we found an important bug with the Johnzon framework. It&apos;s easy to reproduce and the fix seems important. The add operation is not working 100% well for nested objects. (in my example for a map which contains a list in the value)&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;Data:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
...
  &lt;span class=&quot;code-quote&quot;&gt;&quot;caseDiscussionDailySchedule&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;schedule&quot;&lt;/span&gt;:{
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TUESDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;07:00+03:00&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;MONDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;07:00+03:00&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ]
    }
  },
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Operation:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ {&lt;span class=&quot;code-quote&quot;&gt;&quot;op&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;replace&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;/caseDiscussionDailySchedule/schedule/MONDAY/0/start&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;} ]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I expect that the result should be this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
...
  &lt;span class=&quot;code-quote&quot;&gt;&quot;caseDiscussionDailySchedule&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;schedule&quot;&lt;/span&gt;:{
      &lt;span class=&quot;code-quote&quot;&gt;&quot;MONDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &amp;lt;---------------------
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TUESDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;07:00+03:00&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ]
    }
  },
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;, but because of the mentioned bug the result is:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
...
  &lt;span class=&quot;code-quote&quot;&gt;&quot;caseDiscussionDailySchedule&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;schedule&quot;&lt;/span&gt;:{
      &lt;span class=&quot;code-quote&quot;&gt;&quot;MONDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &amp;lt;---------------------
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TUESDAY&quot;&lt;/span&gt;:[
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &amp;lt;---------------------
          &lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;08:00+03:00&quot;&lt;/span&gt;
        }
      ]
    }
  },
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It seems to me that the bug is in the &lt;b&gt;JsonPointerImpl&apos;s&lt;/b&gt; &lt;b&gt;isPositionToAdd&lt;/b&gt; method while it checks only the parent element&apos;s equivalence, instead of checking the whole path&apos;s equivalence.&lt;/p&gt;

&lt;p&gt;Could you fix somehow the mentioned problem ? It would be very important for us and I guess that for a lot of other people as well.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note: in the above example I reproduced the problem with a &quot;replace&quot; operation, but the bug is with the &quot;add&quot; operation. (while the replace makes a remove and then an add, the remove worked fine)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you so much,&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;have a nice day.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13303234">JOHNZON-312</key>
            <summary>JsonPatch&apos;s add operation updates unexpected fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ART515">Arnold Robert Turdean</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>patch</label>
                    </labels>
                <created>Wed, 6 May 2020 23:57:47 +0000</created>
                <updated>Tue, 19 May 2020 22:02:58 +0000</updated>
                            <resolved>Thu, 7 May 2020 17:22:15 +0000</resolved>
                                    <version>1.2.3</version>
                    <version>1.2.5</version>
                                    <fixVersion>1.2.6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17101289" author="art515" created="Thu, 7 May 2020 00:58:02 +0000"  >&lt;p&gt;I also created a possible fix for the problem and I also created a pull request for it.&#160;&lt;a href=&quot;https://github.com/apache/johnzon/pull/63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/johnzon/pull/63&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17101900" author="romain.manni-bucau" created="Thu, 7 May 2020 17:22:15 +0000"  >&lt;p&gt;master seems to match this need, closing for now&lt;/p&gt;</comment>
                            <comment id="17111576" author="art515" created="Tue, 19 May 2020 22:02:58 +0000"  >&lt;p&gt;The fix works perfectly in 1.2.6, thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0egeg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>