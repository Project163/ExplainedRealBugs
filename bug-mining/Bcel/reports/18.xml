<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:13:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BCEL-193] aastore instruction should not raise a verify error if an assignment compatiblity error is detected</title>
                <link>https://issues.apache.org/jira/browse/BCEL-193</link>
                <project id="12314220" key="BCEL">Commons BCEL</project>
                    <description>&lt;p&gt;The following valid code raises a verify error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestArrayAccess01 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; XTestArray01{
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void test(){
        XTestArray01[] array = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestArrayAccess01[1];
        array[0] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XTestArray01();
    }   
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XTestArray01 {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code above will throw an &lt;tt&gt;ArrayStoreException&lt;/tt&gt; at runtime but the generated bytecode is valid.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The Java Virtual Machine Specification Second Edition&lt;/em&gt; is ambigous about this kind of issue. It states in &#167;4.8.2 &lt;em&gt;Structural Constraints&lt;/em&gt; (&lt;a href=&quot;http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#9308):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#9308):&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The type of every value stored into an array of type reference by an aastore instruction must be assignment compatible (&#167;2.6.7) with the component type of the array.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But in the &lt;tt&gt;aastore&lt;/tt&gt; opcode description, there is no reference to any kind of linking or verification error. The assignment compatiblity error is a runtime exception.&lt;/p&gt;

&lt;p&gt;In the &lt;em&gt;Java SE 7 Edition&lt;/em&gt; of _&lt;em&gt;The Java Virtual Machine Specification&lt;/em&gt;, the &#167;4 has been modified (&lt;a href=&quot;http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.9.2):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.9.2):&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The type of every value stored into an array by an aastore instruction must be a reference type.&lt;br/&gt;
The component type of the array being stored into by the aastore instruction must also be a reference type. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The assignment compatibility check must not be done during the verification of the bytecode but during its execution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12767101">BCEL-193</key>
            <summary>aastore instruction should not raise a verify error if an assignment compatiblity error is detected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jejecool">J&#233;r&#244;me Leroux</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Jan 2015 11:32:44 +0000</created>
                <updated>Thu, 14 Jul 2016 12:48:34 +0000</updated>
                            <resolved>Sat, 7 Mar 2015 19:12:44 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>Verifier</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14275070" author="jejecool" created="Tue, 13 Jan 2015 11:36:24 +0000"  >&lt;p&gt;Attach patch with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-193&quot; title=&quot;aastore instruction should not raise a verify error if an assignment compatiblity error is detected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-193&quot;&gt;&lt;del&gt;BCEL-193&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Test for &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-193&quot; title=&quot;aastore instruction should not raise a verify error if an assignment compatiblity error is detected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-193&quot;&gt;&lt;del&gt;BCEL-193&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Attach zip with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Classfile for test for &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-193&quot; title=&quot;aastore instruction should not raise a verify error if an assignment compatiblity error is detected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-193&quot;&gt;&lt;del&gt;BCEL-193&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14275096" author="ebourg" created="Tue, 13 Jan 2015 11:53:19 +0000"  >&lt;p&gt;Interesting, but isn&apos;t it a good thing that the verifier is able to catch more errors than strict spec compliance issues?&lt;/p&gt;</comment>
                            <comment id="14275299" author="jejecool" created="Tue, 13 Jan 2015 14:57:43 +0000"  >&lt;p&gt;I don&apos;t think so. If the classfile is compliant with the specification, the verifier must not reject it.&lt;br/&gt;
The &lt;tt&gt;ArrayStoreException&lt;/tt&gt; is not an error (&lt;tt&gt;java.lang.Error&lt;/tt&gt;) and is a normal exception that can be caught by the application such as a &lt;tt&gt;NullPointerException&lt;/tt&gt; or a &lt;tt&gt;ClassCastException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In &#167;4.9 of &lt;em&gt;The Java Virtual Machine Specification Second Edition&lt;/em&gt; states:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It &lt;em&gt;(the bytecode verifier)&lt;/em&gt; should certify all code generated by Sun&apos;s compiler for the Java programming language&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here is the example defined in the &lt;tt&gt;ArrayStoreException&lt;/tt&gt; javadoc:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x[] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[3];
x[0] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If this code should be rejected by the verifier, then the following code defined in &lt;tt&gt;ClassCastException&lt;/tt&gt; should also:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(0);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)x);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This kind of checks does not concern the verifier, they may be made by code analyzer such as PMD.&lt;/p&gt;</comment>
                            <comment id="14351722" author="markt" created="Sat, 7 Mar 2015 18:07:52 +0000"  >&lt;p&gt;I agree with J&#233;r&#244;me. Being too strict is just as much of a bug as not being strict enough. I&apos;ll review the patch over the weekend with a view to getting it applied.&lt;/p&gt;</comment>
                            <comment id="14351738" author="markt" created="Sat, 7 Mar 2015 18:43:16 +0000"  >&lt;p&gt;It would be better if some sort of source code - worst case a description of what they contain - was provided for the class files in the zip.&lt;/p&gt;</comment>
                            <comment id="14351748" author="markt" created="Sat, 7 Mar 2015 19:12:44 +0000"  >&lt;p&gt;Patch applied with only trivial whitespace changes.&lt;/p&gt;

&lt;p&gt;Many thanks.&lt;/p&gt;

&lt;p&gt;My comment re source information for the class files still stands but I&apos;m happy to resolve this issue without it. (Worst case if we ever need to we can reverse engineer the class files).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12691928" name="BCEL-193.patch" size="8756" author="jejecool" created="Tue, 13 Jan 2015 11:36:24 +0000"/>
                            <attachment id="12691929" name="BCEL-193.zip" size="1725" author="jejecool" created="Tue, 13 Jan 2015 11:36:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24ay7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>