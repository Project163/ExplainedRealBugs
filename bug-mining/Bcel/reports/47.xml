<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:13:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BCEL-79] java.lang.ClassFormatError: LVTT entry for &apos;local&apos; in class file org/shiftone/jrat/test/dummy/CrashTestDummy does not match any LVT entry</title>
                <link>https://issues.apache.org/jira/browse/BCEL-79</link>
                <project id="12314220" key="BCEL">Commons BCEL</project>
                    <description>&lt;p&gt;I have tried both the release at &lt;a href=&quot;http://people.apache.org/~tcurdt/bcel/rc2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~tcurdt/bcel/rc2/&lt;/a&gt; , as&lt;br/&gt;
well as a build from head (410655).  I see the same ClassFormatError with both.&lt;/p&gt;

&lt;p&gt;I get this error when running a JRat test case.  This project and the test case&lt;br/&gt;
is avalible on sourceforge (&lt;a href=&quot;http://sourceforge.net/projects/jrat&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/projects/jrat&lt;/a&gt;) - or I can&lt;br/&gt;
provide it directly.  The test case uses BCEL to isntrument a class and then&lt;br/&gt;
tries to execute methods various methods on it.&lt;/p&gt;

&lt;p&gt;see org.shiftone.jrat.test.InjectorTestCase&lt;/p&gt;


&lt;p&gt;java.lang.ClassFormatError: LVTT entry for &apos;local&apos; in class file&lt;br/&gt;
org/shiftone/jrat/test/dummy/CrashTestDummy does not match any LVT entry&lt;br/&gt;
	at java.lang.ClassLoader.defineClass1(Native Method)&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:620)&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:465)&lt;br/&gt;
	at org.shiftone.jrat.test.TestClassLoader.loadClass(TestClassLoader.java:36)&lt;br/&gt;
	at org.shiftone.jrat.test.InjectorTestCase.setUp(InjectorTestCase.java:52)&lt;br/&gt;
	at com.intellij.rt.execution.junit2.JUnitStarter.main(JUnitStarter.java:32)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at&lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12619245">BCEL-79</key>
            <summary>java.lang.ClassFormatError: LVTT entry for &apos;local&apos; in class file org/shiftone/jrat/test/dummy/CrashTestDummy does not match any LVT entry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="issues@commons.apache.org">Apache Commons Developers</assignee>
                                    <reporter username="jeff@drost.com">Jeff Drost</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 May 2006 20:43:51 +0000</created>
                <updated>Mon, 18 Sep 2017 09:12:25 +0000</updated>
                            <resolved>Fri, 14 Aug 2015 22:25:47 +0000</resolved>
                                                    <fixVersion>6.1</fixVersion>
                                    <component>Main</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13511801" author="jeff@drost.com" created="Wed, 31 May 2006 20:55:24 +0000"  >&lt;p&gt;Compiling with -g:lines,source fixes the problem however this is not an&lt;br/&gt;
acceptable option for me since a user may want to profile code that they didn&apos;t&lt;br/&gt;
write or have the source for.&lt;/p&gt;</comment>
                            <comment id="13511802" author="tcurdt" created="Thu, 1 Jun 2006 00:25:02 +0000"  >&lt;p&gt;fair enough ...could you provide a patch? With some luck it could then still make it into 5.2&lt;/p&gt;</comment>
                            <comment id="13511803" author="johann.uhrmann@xpecto.com" created="Thu, 2 Nov 2006 00:10:28 +0000"  >&lt;p&gt;Changed the severity to &quot;critical&quot; because it renders BCEL useless on Java5 or&lt;br/&gt;
newer.&lt;/p&gt;</comment>
                            <comment id="13511804" author="tcurdt" created="Sat, 10 Mar 2007 07:36:00 +0000"  >&lt;p&gt;What&apos;s the status here? Did you try with trunk? Would be great if you could&lt;br/&gt;
attach the testcase.&lt;/p&gt;</comment>
                            <comment id="13511805" author="ebengtso" created="Tue, 27 Mar 2007 15:18:08 +0000"  >&lt;p&gt;Just tried with HEAD and does not work&lt;/p&gt;

&lt;p&gt;java.lang.ClassFormatError: LVTT entry for &apos;employees&apos; in class file&lt;/p&gt;</comment>
                            <comment id="13511806" author="ebengtso" created="Tue, 27 Mar 2007 15:22:07 +0000"  >&lt;p&gt;The classes I&apos;m using against trunk HEAD. Hope this helps&lt;/p&gt;

&lt;p&gt;class Department implements java.io.Serializable&lt;br/&gt;
{&lt;br/&gt;
    private Collection&amp;lt;Employee&amp;gt; employees;&lt;/p&gt;

&lt;p&gt;    public Collection&amp;lt;Employee&amp;gt; getEmployees()&lt;/p&gt;
    {
        return employees;
    }
&lt;p&gt;    public void setEmployees(Collection&amp;lt;Employee&amp;gt; employees)&lt;/p&gt;
    {
        this.employees = employees;
    }

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;class Employee implements java.io.Serializable&lt;br/&gt;
{&lt;br/&gt;
    private String name;&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="13511807" author="ebengtso" created="Wed, 28 Mar 2007 11:41:30 +0000"  >&lt;p&gt;This patch fixes this issue to me.&lt;/p&gt;

&lt;p&gt;The fix is with copying the LVTT entries from method to MethodGen.&lt;/p&gt;

&lt;p&gt;In addition, a cosmetic change in the MethodGen.toString method to output the&lt;br/&gt;
signature attributes, same as Method.toString does.&lt;/p&gt;</comment>
                            <comment id="13511810" author="ebengtso" created="Wed, 28 Mar 2007 11:41:30 +0000"  >&lt;p&gt;Attachment bcel-patch-method.txt has been added with description: copying the LVTT entries from method to MethodGen&lt;/p&gt;</comment>
                            <comment id="13511808" author="ebengtso" created="Wed, 28 Mar 2007 11:59:58 +0000"  >&lt;p&gt;I forgot to say that the patch attached (2007-03-28 11:41), fix the case where a&lt;br/&gt;
setter having a generic argument is bytecode modified using BCEL. I dont know if&lt;br/&gt;
there are other cases. The patch works for me, for several classes and several&lt;br/&gt;
scenarios.&lt;/p&gt;

&lt;p&gt;    public void setEmployees(Collection&amp;lt;Employee&amp;gt; employees)&lt;/p&gt;
    {
        this.employees = employees;
    }</comment>
                            <comment id="13511809" author="tcurdt" created="Sun, 1 Apr 2007 07:59:17 +0000"  >&lt;p&gt;Thanks! Applied!&lt;/p&gt;</comment>
                            <comment id="14305928" author="markro" created="Wed, 4 Feb 2015 20:52:51 +0000"  >&lt;p&gt;This bug fix is quite incorrect and I have no idea how it how it solved the original bug.  The key point is there is absolutely no requirement for there to be as many LocalVariableTypeTable entries as there are LocalVariables.  In fact, there will almost always be fewer.  Quoting from the JVM spec, section 4.7.14 &quot;The LocalVariableTypeTable attribute differs from the LocalVariableTable attribute (&#167;4.7.13) in that it provides signature information rather than descriptor information. This difference is only significant for variables whose type uses a type variable or parameterized type. Such variables will appear in both tables, while variables of other types will appear only in LocalVariableTable.&quot;&lt;br/&gt;
Thus deleting all the local variables and then reconstructing them from types is completely incorrect.  I have no idea what the bug fix intentions were -  Perhaps the test case had the same number of vars and types??  Our fix was to simply comment the entire fix out and we have not run into any problems since.   (As an aside, it appears to be quite a flaw in BCEL verification test suite not to have caught this.)&lt;/p&gt;</comment>
                            <comment id="14350865" author="sarahkm1972" created="Fri, 6 Mar 2015 20:46:15 +0000"  >&lt;p&gt;Mark, do you have a repro case or a unit test where the original bug fix does not work as intended? You said &quot;you have not run into any problems since&quot;, so it&apos;d be interesting to know what problem you ran into.&lt;/p&gt;</comment>
                            <comment id="14351448" author="sarahkm1972" created="Sat, 7 Mar 2015 07:01:12 +0000"  >&lt;p&gt;If I comment out the code added in the bug fix then the tests still pass. This will definitely need a test case that doesn&apos;t pass both with and without that section of code&lt;/p&gt;</comment>
                            <comment id="14353391" author="markro" created="Mon, 9 Mar 2015 18:56:40 +0000"  >&lt;p&gt;I have created a test case that demonstrates the failure of the current code.  (As noted above, most of the locals are incorrectly discarded; local var count goes from 4 to 1.)&lt;/p&gt;

&lt;p&gt;In the process, I realized that most of the implementation for LocalVariableTypeTable is just wrong.  It assumes that LocalVariables and LocalVariableTypes are equivalent, if you have one you don&apos;t need the other.  Also, it assumes that descriptors and signatures are equivalent.   If you uncomment out the indicated line in the test, you will see BCEL crash due to this fact.&lt;/p&gt;

&lt;p&gt;In addition, there is no way for a user to inspect the LocalVariableTypeTable.  The only getLocalVariableTypeTable() method is in LocalVariableTypeTable - pretty nifty Catch 22.&lt;/p&gt;</comment>
                            <comment id="14632281" author="charles_honton@intuit.com" created="Sat, 18 Jul 2015 05:12:37 +0000"  >&lt;p&gt;Please attach source for org.apache.bcel.data.PLSETestClass which is used by org.apache.bcel.PLSETestCase.&lt;/p&gt;</comment>
                            <comment id="14697281" author="markro" created="Fri, 14 Aug 2015 16:00:53 +0000"  >&lt;p&gt;I have updated the PLSE test case to demonstrate this problem: bug79.diff.&lt;/p&gt;</comment>
                            <comment id="14697471" author="sebb@apache.org" created="Fri, 14 Aug 2015 18:05:24 +0000"  >&lt;p&gt;I tried applying the two patches (bug79 and PLSETestCase) but the test runs without an error.&lt;br/&gt;
I thought bug79 was supposed to show the error?&lt;/p&gt;</comment>
                            <comment id="14697544" author="markro" created="Fri, 14 Aug 2015 18:52:40 +0000"  >&lt;p&gt;The PLSETestCase was just added to the trunk yesterday (as part of 208) so for 79 you should ignore the attached java file and just apply bug79.diff to the existing code.  (The other attached txt file was already been applied some time ago.)&lt;/p&gt;

&lt;p&gt;Mark&lt;/p&gt;
</comment>
                            <comment id="14697561" author="sebb@apache.org" created="Fri, 14 Aug 2015 19:07:05 +0000"  >&lt;p&gt;Huh?&lt;br/&gt;
The file PLSETestCase.java additionally contains the method testB79() which is not in trunk (yet).&lt;/p&gt;

&lt;p&gt;Also, I thought the bug79 update to the test data class was supposed to demonstrate the issue?&lt;br/&gt;
If so, I am not seeing any test errors resulting from the testdata update, even when testB79 is added.&lt;/p&gt;</comment>
                            <comment id="14697594" author="markro" created="Fri, 14 Aug 2015 19:27:11 +0000"  >&lt;p&gt;I have deleted the PLSETestCase.java attached to this bug report.&lt;/p&gt;

&lt;p&gt;Here are the steps i took:&lt;br/&gt;
svn info shows Last Changed Rev: 1695799&lt;br/&gt;
I then apply bug79.diff which adds a new test method testB79 to the existing PLSETestCase.java and adds a new method meth2 to PLSETestClass.java.&lt;br/&gt;
i then do mvn verify and here is a slice of the output:&lt;/p&gt;

&lt;p&gt;Running org.apache.commons.bcel6.PLSETestCase&lt;br/&gt;
Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.203 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.commons.bcel6.PLSETestCase&lt;br/&gt;
testB79(org.apache.commons.bcel6.PLSETestCase)  Time elapsed: 0.199 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.AssertionFailedError: number of locals expected:&amp;lt;5&amp;gt; but was:&amp;lt;1&amp;gt;&lt;br/&gt;
        at junit.framework.Assert.fail(Assert.java:57)&lt;br/&gt;
        at junit.framework.Assert.failNotEquals(Assert.java:329)&lt;br/&gt;
        at junit.framework.Assert.assertEquals(Assert.java:78)&lt;br/&gt;
        at junit.framework.Assert.assertEquals(Assert.java:234)&lt;br/&gt;
        at junit.framework.TestCase.assertEquals(TestCase.java:401)&lt;br/&gt;
        at org.apache.commons.bcel6.PLSETestCase.testB79(PLSETestCase.java:63)&lt;/p&gt;

&lt;p&gt;The fix is to remove the code added by the attached file bcel-patch-method.txt.&lt;/p&gt;</comment>
                            <comment id="14697866" author="sebb@apache.org" created="Fri, 14 Aug 2015 22:25:47 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1695997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1695997&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-79&quot; title=&quot;java.lang.ClassFormatError: LVTT entry for &amp;#39;local&amp;#39; in class file org/shiftone/jrat/test/dummy/CrashTestDummy does not match any LVT entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-79&quot;&gt;&lt;del&gt;BCEL-79&lt;/del&gt;&lt;/a&gt; - Add test to show the problem, and re-fix it&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/bcel/trunk/src/main/java/org/apache/commons/bcel6/generic/MethodGen.java&lt;br/&gt;
    commons/proper/bcel/trunk/src/test/java/org/apache/commons/bcel6/PLSETestCase.java&lt;br/&gt;
    commons/proper/bcel/trunk/src/test/java/org/apache/commons/bcel6/data/PLSETestClass.java&lt;/p&gt;</comment>
                            <comment id="14697867" author="sebb@apache.org" created="Fri, 14 Aug 2015 22:26:19 +0000"  >&lt;p&gt;Ah - now I see what the problem was.&lt;br/&gt;
I thought the patches were the same, but the latest patch uses gen.getMethodAt(2) in the testB79() method whereas the original used gen.getMethodAt(1).&lt;br/&gt;
Using index 2 causes the test failure as expected.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12556424" name="bcel-patch-method.txt" size="2854" author="ebengtso" created="Wed, 28 Mar 2007 11:41:30 +0000"/>
                            <attachment id="12750539" name="bug79.diff" size="2043" author="markro" created="Fri, 14 Aug 2015 15:59:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39695</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://issues.apache.org/bugzilla/show_bug.cgi?id=39695]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>306523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i19w1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>265827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>