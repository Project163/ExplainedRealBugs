<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:13:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BCEL-207] RemoveLocalVariable(s) doesn&apos;t remove the associated Targetters.</title>
                <link>https://issues.apache.org/jira/browse/BCEL-207</link>
                <project id="12314220" key="BCEL">Commons BCEL</project>
                    <description>&lt;p&gt;RemoveLocalVariable(s) doesn&apos;t remove the associated Targetters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12772725">BCEL-207</key>
            <summary>RemoveLocalVariable(s) doesn&apos;t remove the associated Targetters.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="markro">Mark Roberts</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Feb 2015 16:23:57 +0000</created>
                <updated>Thu, 14 Jul 2016 12:48:42 +0000</updated>
                            <resolved>Fri, 20 Feb 2015 14:53:43 +0000</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14328858" author="ebourg" created="Fri, 20 Feb 2015 12:06:40 +0000"  >&lt;p&gt;What about adding a &lt;tt&gt;dispose()&lt;/tt&gt; method in &lt;tt&gt;LocalVariableGen&lt;/tt&gt; performing this cleanup and also clearing the handlers defining the scope? Thus removing a local variable would make it ready to be reused elsewhere, if ever that could make sense.&lt;/p&gt;</comment>
                            <comment id="14328924" author="markro" created="Fri, 20 Feb 2015 13:44:12 +0000"  >&lt;p&gt;I&apos;m sorry, I don&apos;t follow you - how does that fix the removeLocalVariable problem?  If you don&apos;t delete the targeters and try to reuse the localVariable it would have to have the exact same live range as the previous one.  But before that problem, I think you run into null pointer issues with the method&apos;s StackMap.&lt;/p&gt;</comment>
                            <comment id="14328929" author="ebourg" created="Fri, 20 Feb 2015 13:49:58 +0000"  >&lt;p&gt;Actually the &lt;tt&gt;dispose()&lt;/tt&gt; method would call &lt;tt&gt;notifyTarget&lt;/tt&gt;, and &lt;tt&gt;removeLocalVariable&lt;/tt&gt; would call &lt;tt&gt;dispose()&lt;/tt&gt;. This avoids repeating the &lt;tt&gt;notifyTarget&lt;/tt&gt; in two methods for the same purpose.&lt;/p&gt;</comment>
                            <comment id="14328942" author="markro" created="Fri, 20 Feb 2015 14:05:09 +0000"  >&lt;p&gt;oh, I see - you are talking about re-factoring the code.  In that case, why not just have removeLocalVariables call removeLocalVariable within the loop instead of the notifyTarget(s).  Originially, I was worried about the performance of n variable_vec.remove(s) versus a single variable_vec.clear - but I suspect that in the vast majority of cases the number of locals would be fairly small.&lt;/p&gt;</comment>
                            <comment id="14329005" author="ebourg" created="Fri, 20 Feb 2015 14:53:43 +0000"  >&lt;p&gt;This is now fixed on the trunk and I added a test case. Thank you Mark.&lt;/p&gt;</comment>
                            <comment id="14700060" author="markro" created="Mon, 17 Aug 2015 19:11:51 +0000"  >&lt;p&gt;The dispose() change causes a problem with my existing code.  But I believe the real issue is the whole shallow vs deep copy thing.  MethodGen.getLocalVariables() returns a shallow copy.  My client code wants to rebuild the LocalVarableTable.  So it calls getLocalVariables to get a copy of the old table and then calls removeLocalVariables to prepare for creating the new table.  But, of course, the new table is a variation of the old so you need to copy some of the items from the old to the new table.  There is/was a subtle assumption that getLocalVariables returned a deep copy in order to do this properly.  It turned out even though the copy was shollow, it worked okay, because removeLocalVariables() didn&apos;t really remove anything, just reset the Targeters.  Now dispose really removes things so we have trouble.  I&apos;m not suggesting we remove the dispose stuff.  I would like to discuss just what we mean by a method called getFoo().  Does it return a shallow or deep copy of the Foo object?  I think I am arguing that it should be deep.  This issue gets even messier because some BCEL objects override clone() and some don&apos;t.  And some have a copy() method (which I assume is always deep?) and some don&apos;t.  (oh boy, now I&apos;m wondering if I should have sent this to the commons list instead.)&lt;/p&gt;

&lt;p&gt;Well. as usual, it&apos;s more complicated than that.  Turns out sometimes we want getFoo() to be shallow so we can modify the Foo object and sometimes we want getFoo() to be deep so we can create a new Foo from the copy.  So now I&apos;m thinking getFoo() should be shallow, and the user needs to say getFoo().copy() if he wants deep?  What do you think?  (Of course, very few of the BCEL objects have a copy() method....)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12619327">BCEL-161</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12696784" name="methodgen3.diff" size="727" author="markro" created="Thu, 5 Feb 2015 16:24:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i258q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>