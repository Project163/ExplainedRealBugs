<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:14:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BCEL-369] org.apache.bcel.verifier.exc.AssertionViolatedException from method return in subroutine</title>
                <link>https://issues.apache.org/jira/browse/BCEL-369</link>
                <project id="12314220" key="BCEL">Commons BCEL</project>
                    <description>&lt;p&gt;Verifier pass 3B fails due to a method return in a subroutine.&lt;br/&gt;
There is a comment in the associated code indicating that you are likely already aware of this issue:&lt;br/&gt;
&quot;// TODO: This is buggy, we check only the top-level return instructions this way.&lt;br/&gt;
// Maybe some maniac returns from a method when in a subroutine?&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The attached class file is what javac for the Java HotSpot SE Development Kit build 1.4.2_19-b04 produced for the program:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Test(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; i++;
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(i == 0) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; u = 7;
&#160; &#160; &#160; &#160; &#160; &#160; u += 9;
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; i++;
&#160; &#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Input: See attached file.&#160;&lt;/p&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Apache Commons BCEL
https:&lt;span class=&quot;code-comment&quot;&gt;//commons.apache.org/bcel
&lt;/span&gt;Now verifying: Test
Pass 1:
VERIFIED_OK
Passed verification.
Pass 2:
VERIFIED_OK
Passed verification.
Pass 3a, method number 0 [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void &amp;lt;init&amp;gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; arg1)&apos;&lt;/span&gt;]:
VERIFIED_OK
Passed verification.
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.bcel.verifier.exc.AssertionViolatedException: INTERNAL ERROR: Some RuntimeException occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; verify()ing class &lt;span class=&quot;code-quote&quot;&gt;&apos;Test&apos;&lt;/span&gt;, method &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void &amp;lt;init&amp;gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; arg1)&apos;&lt;/span&gt;. Original RuntimeException&apos;s stack trace:
---
org.apache.bcel.verifier.exc.AssertionViolatedException: INTERNAL ERROR: outFrame not set! This:
&#160; 24: &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &#160; &#160;[InstructionContext]
ExecutionChain: &#160; 24: &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &#160; &#160;[InstructionContext]
OutFrames: &apos;{ &#160; 7: jsr -&amp;gt; 19 &#160; &#160;[InstructionContext]=Local Variables:
0: Test
1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
2: &amp;lt;unknown object&amp;gt;
3: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; address targeting &#160; 10: &lt;span class=&quot;code-keyword&quot;&gt;goto&lt;/span&gt;[167](3) -&amp;gt; 34&amp;gt;
4: &amp;lt;unknown object&amp;gt;
OperandStack:
Slots used: 0 MaxStack: 1.
, &#160; 14: jsr -&amp;gt; 19 &#160; &#160; &#160; [InstructionContext]=Local Variables:
0: Test
1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
2: java.lang.Throwable
3: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; address targeting &#160; 17: aload_2[44](1)&amp;gt;
4: &amp;lt;unknown object&amp;gt;
OperandStack:
Slots used: 0 MaxStack: 1.
}&apos;.
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.ControlFlowGraph$InstructionContextImpl.getOutFrame(ControlFlowGraph.java:285)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.Pass3bVerifier.circulationPump(Pass3bVerifier.java:275)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.Pass3bVerifier.do_verify(Pass3bVerifier.java:386)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.PassVerifier.verify(PassVerifier.java:98)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.doPass3b(Verifier.java:166)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.verifyType(Verifier.java:90)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.main(Verifier.java:69)
---
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.Pass3bVerifier.do_verify(Pass3bVerifier.java:398)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.PassVerifier.verify(PassVerifier.java:98)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.doPass3b(Verifier.java:166)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.verifyType(Verifier.java:90)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.Verifier.main(Verifier.java:69)
Caused by: org.apache.bcel.verifier.exc.AssertionViolatedException: INTERNAL ERROR: outFrame not set! This:
&#160; 24: &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &#160; &#160;[InstructionContext]
ExecutionChain: &#160; 24: &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &#160; &#160;[InstructionContext]
OutFrames: &apos;{ &#160; 7: jsr -&amp;gt; 19 &#160; &#160;[InstructionContext]=Local Variables:
0: Test
1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
2: &amp;lt;unknown object&amp;gt;
3: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; address targeting &#160; 10: &lt;span class=&quot;code-keyword&quot;&gt;goto&lt;/span&gt;[167](3) -&amp;gt; 34&amp;gt;
4: &amp;lt;unknown object&amp;gt;
OperandStack:
Slots used: 0 MaxStack: 1.
, &#160; 14: jsr -&amp;gt; 19 &#160; &#160; &#160; [InstructionContext]=Local Variables:
0: Test
1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
2: java.lang.Throwable
3: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; address targeting &#160; 17: aload_2[44](1)&amp;gt;
4: &amp;lt;unknown object&amp;gt;
OperandStack:
Slots used: 0 MaxStack: 1.
}&apos;.
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.ControlFlowGraph$InstructionContextImpl.getOutFrame(ControlFlowGraph.java:285)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.Pass3bVerifier.circulationPump(Pass3bVerifier.java:275)
&#160; &#160; &#160; &#160; at org.apache.bcel.verifier.structurals.Pass3bVerifier.do_verify(Pass3bVerifier.java:386)
&#160; &#160; &#160; &#160; ... 4 more


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13538651">BCEL-369</key>
            <summary>org.apache.bcel.verifier.exc.AssertionViolatedException from method return in subroutine</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="katherine-hough">Katherine Hough</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Jun 2023 21:22:54 +0000</created>
                <updated>Sat, 17 Jun 2023 18:15:20 +0000</updated>
                                            <version>6.7.0</version>
                    <version>6.8.0</version>
                                                    <component>Verifier</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17729022" author="garydgregory" created="Sat, 3 Jun 2023 21:21:08 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=katherine-hough&quot; class=&quot;user-hover&quot; rel=&quot;katherine-hough&quot;&gt;katherine-hough&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I added &lt;tt&gt;org.apache.bcel.verifier.JiraBcel369TestCase&lt;/tt&gt; which passes. Please review this new test in git master.&lt;/p&gt;

&lt;p&gt;Can you try git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/bcel/bcel/6.8.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/bcel/bcel/6.8.0-SNAPSHOT/&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;The attached class file should be called &quot;issue369.Test&quot; instead of &quot;Test&quot; in order to fit in the BCEL test framework. See &lt;tt&gt;JiraBcel369TestCase&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17729361" author="JIRAUSER300711" created="Mon, 5 Jun 2023 15:37:38 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;^Test.class&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I have attached a copy of the class with your suggested class name. &lt;/p&gt;

&lt;p&gt;The same issue still manifests for git master. I would not expect this issue to occur for a class file created using a newer java compiler because it only manifests when returning from JSR-based local subroutines. My understanding is that JSR instructions are not allowed in Java 7+ class files which is why I used a Java 4 compiler to create a minimal example. This issue would only really be encountered when working with older class files or an older java compiler.&lt;/p&gt;</comment>
                            <comment id="17733757" author="garydgregory" created="Sat, 17 Jun 2023 12:35:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=katherine-hough&quot; class=&quot;user-hover&quot; rel=&quot;katherine-hough&quot;&gt;katherine-hough&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for the updated test fixture.&lt;/p&gt;

&lt;p&gt;I updated the test in git master (it&apos;s disabled).&lt;/p&gt;

&lt;p&gt;Do you have a suggestion for a change/fix?&lt;/p&gt;</comment>
                            <comment id="17733778" author="JIRAUSER300711" created="Sat, 17 Jun 2023 14:49:11 +0000"  >&lt;p&gt;A check to line 271 of Pass3bVerifier#circulationPump that the InstructionHandle ih is a top-level instruction.&lt;br/&gt;
I assume the best way to check this would be to add a method to ControlFlowGraph like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isTopLevel(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InstructionHandle i) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; subroutines.subroutineOf(i) == subroutines.getTopLevel();
&#160; &#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160; &#160;&#160;&lt;br/&gt;
Then, line 271 of Pass3bVerifier#circulationPump would be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ih.getInstruction() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ReturnInstruction &amp;amp;&amp;amp; !cfg.isDead(ih) &amp;amp;&amp;amp; cfg.isTopLevel(ih)) {&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160; &#160;&#160;&lt;br/&gt;
This should fix this specific crash and it would mean the code matches the comment on line 273 of Pass3bVerifier which says, &quot;TODO: This is buggy, we check only the top-level return instructions this way.&quot; However this change would not resolve that TODO. Return instructions in subroutines would still not be properly checked, but they would no longer produce an org.apache.bcel.verifier.exc.AssertionViolatedException. I am not sure what change would need to be made to properly check RETURN instructions in subroutines.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17733796" author="garydgregory" created="Sat, 17 Jun 2023 18:15:20 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=katherine-hough&quot; class=&quot;user-hover&quot; rel=&quot;katherine-hough&quot;&gt;katherine-hough&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for the details. We&apos;d welcome a PR on GitHub.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13058800" name="Test-1.class" size="283" author="katherine-hough" created="Mon, 5 Jun 2023 15:06:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ib80:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>