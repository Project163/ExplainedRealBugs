<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:14:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BCEL-289] Crash when parsing constructor of inner classes with parameters annotated</title>
                <link>https://issues.apache.org/jira/browse/BCEL-289</link>
                <project id="12314220" key="BCEL">Commons BCEL</project>
                    <description>&lt;p&gt;BCEL crashes when parsing the constructor of an inner class whose parameters are annotated. For instance, when parsing the jar obtained from the following classes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; @&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; A {}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; @&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; B {}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Inner {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Inner(@A &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; a, @B &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; b) {}
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In particular:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		ClassParser cp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassParser(args[0]);
		ClassGen cg = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassGen(cp.parse());
		MethodGen mg = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MethodGen(cg.getMethodAt(0), cg.getClassName(), cg.getConstantPool());
		mg.getAnnotationsOnParameter(0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(where args[0] points to Test$Inner.class)&lt;/p&gt;

&lt;p&gt;you get&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 2
	at org.apache.bcel.generic.MethodGen.ensureExistingParameterAnnotationsUnpacked(MethodGen.java:1120)
	at org.apache.bcel.generic.MethodGen.getAnnotationsOnParameter(MethodGen.java:1073)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13072478">BCEL-289</key>
            <summary>Crash when parsing constructor of inner classes with parameters annotated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="pferrara">Pietro Ferrara</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 May 2017 14:52:46 +0000</created>
                <updated>Mon, 18 Sep 2017 09:12:27 +0000</updated>
                            <resolved>Fri, 19 May 2017 06:43:57 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.1</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16013668" author="kinow" created="Wed, 17 May 2017 07:28:22 +0000"  >&lt;p&gt;Reproduced issue locally. Didn&apos;t have time to debug with latest from master branch, nor to investigate it very deeply. If anyone feels like jumping in and having a look, feel free (-: Noticed that removing the annotations the issue is gone. Not sure what&apos;s the problem.&lt;/p&gt;</comment>
                            <comment id="16013696" author="pferrara" created="Wed, 17 May 2017 08:04:01 +0000"  >&lt;p&gt;As far as I can understand (I&apos;m debugging with the code of release 6.0), it seems that there is a problem with the syntetic parameter of the inner constructor: at bytecode level, the signature of the constructor is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void &amp;lt;init&amp;gt;(Test arg0, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; arg1, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; arg2) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code raising the exception is the first line of the following for loop:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = 0; j &amp;lt; arg_types.length; j++) {
  &lt;span class=&quot;code-comment&quot;&gt;// This returns Annotation[] ...
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ParameterAnnotationEntry immutableArray = rpa
  .getParameterAnnotationEntries()[j];
  &lt;span class=&quot;code-comment&quot;&gt;// ... which needs transforming into an AnnotationGen[] ...
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;AnnotationEntryGen&amp;gt; mutable = makeMutableVersion(immutableArray.getAnnotationEntries());
  &lt;span class=&quot;code-comment&quot;&gt;// ... then add these to any we already know about
&lt;/span&gt;  param_annotations[j].addAll(mutable);
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I debug class MethodGen just before the exception is raisen, I see that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;arg_types is:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[Test, java.lang.Object, java.lang.Object]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;rpa.parameter_annotation_table (returned by getParameterAnnotationEntries) is:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[@LA;, @LB;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It looks like when rpa (RuntimeVisibleParameterAnnotations) is built it does not take into account the syntectic parameter.&lt;/p&gt;

&lt;p&gt;rpa comes from the field attribute_vect. If you don&apos;t have any annotation on parameters, I expect attribute_vect to be an empty collection, so the body of the for loop wrapping the code crashing is never executed.&lt;/p&gt;

&lt;p&gt;Hope this helps!&lt;/p&gt;</comment>
                            <comment id="16015434" author="kinow" created="Thu, 18 May 2017 08:42:54 +0000"  >&lt;p&gt;Reproduced with BCEL 6.1-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pferrara&quot; class=&quot;user-hover&quot; rel=&quot;pferrara&quot;&gt;pferrara&lt;/a&gt; thanks for the detailed report. Yesterday I didn&apos;t have much time to debug the issue. Will try to debug in the next days with the latest version from master branch (i.e. BCEL 6.1-SNAPSHOT) and see if there is an easy way to fix it.&lt;/p&gt;

&lt;p&gt;But if you find a way to fix it before, feel free to submit a pull request and/or update this ticket.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="16015482" author="pferrara" created="Thu, 18 May 2017 09:27:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kinow&quot; class=&quot;user-hover&quot; rel=&quot;kinow&quot;&gt;kinow&lt;/a&gt; honestly I do not think I&apos;m in position to propose a fix for this: I am not sure whether the problem is just in the for loop raising the exception (and the fix might be rather straightforward if one can know that a parameter is syntetic), or in how parameter_annotation_table is built (and here I would have no idea where to start).&lt;/p&gt;

&lt;p&gt;I think the best is if you can give a look and find out where the problem is (and obviously no problem at all if it will take some time!).&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="16015502" author="githubbot" created="Thu, 18 May 2017 09:42:30 +0000"  >&lt;p&gt;GitHub user kinow opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-bcel/pull/13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-bcel/pull/13&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-289&quot; title=&quot;Crash when parsing constructor of inner classes with parameters annotated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-289&quot;&gt;&lt;del&gt;BCEL-289&lt;/del&gt;&lt;/a&gt;: iterate through parameter annotation entries using the right limit&lt;/p&gt;

&lt;p&gt;    The code was iterating through the number of parameters (3 in this case, the Bar parent class, and the two annotated parameters, while looking for annotated parameters.&lt;/p&gt;

&lt;p&gt;    As the constructor method has two annotated parameters, it throws an ArrayIndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;    Found no pull requests with this fix, Maven site reports look OK, no new warnings/errors added, added a simple unit test.&lt;/p&gt;

&lt;p&gt;    As I never contributed to BCEL, will drop a message to the mailing list asking for someone to review it before I merge it.&lt;/p&gt;

&lt;p&gt;    Cheers&lt;br/&gt;
    Bruno&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kinow/commons-bcel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kinow/commons-bcel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-289&quot; title=&quot;Crash when parsing constructor of inner classes with parameters annotated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-289&quot;&gt;&lt;del&gt;BCEL-289&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-bcel/pull/13.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-bcel/pull/13.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #13&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d60291173e4d4a589873338547d968a540210507&lt;br/&gt;
Author: Bruno P. Kinoshita &amp;lt;brunodepaulak@yahoo.com.br&amp;gt;&lt;br/&gt;
Date:   2017-05-18T09:37:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BCEL-289&quot; title=&quot;Crash when parsing constructor of inner classes with parameters annotated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BCEL-289&quot;&gt;&lt;del&gt;BCEL-289&lt;/del&gt;&lt;/a&gt;: iterate through parameter annotation entries using the right limit&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16015511" author="kinow" created="Thu, 18 May 2017 09:47:59 +0000"  >&lt;p&gt;Pull request submitted &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pferrara&quot; class=&quot;user-hover&quot; rel=&quot;pferrara&quot;&gt;pferrara&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; feel free to give it a try and comment if that works for you. Included a test case based on your example.&lt;/p&gt;

&lt;p&gt;Will drop an e-mail to the mailing list as I never really used much BCEL, nor know the code base very well.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="16015701" author="pferrara" created="Thu, 18 May 2017 12:49:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kinow&quot; class=&quot;user-hover&quot; rel=&quot;kinow&quot;&gt;kinow&lt;/a&gt; The fix works, thank you very much!!!&lt;/p&gt;</comment>
                            <comment id="16016975" author="kinow" created="Fri, 19 May 2017 06:44:44 +0000"  >&lt;p&gt;Pull request merged in Subversion. The sync process takes a while normally, so we may have to wait minutes/hours till it is marked as closed in GitHub, and the ASF bot comments here. Should be included in BCEL 6.1.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="16016977" author="githubbot" created="Fri, 19 May 2017 06:45:44 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-bcel/pull/13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-bcel/pull/13&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16017559" author="garydgregory" created="Fri, 19 May 2017 15:38:59 +0000"  >&lt;p&gt;Time to migrate to Git then?&lt;/p&gt;</comment>
                            <comment id="16018180" author="kinow" created="Fri, 19 May 2017 23:50:09 +0000"  >&lt;p&gt;+1 that would be great &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f26f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>