{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514","repository_url":"https://api.github.com/repos/python-pillow/Pillow","labels_url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514/labels{/name}","comments_url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514/comments","events_url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514/events","html_url":"https://github.com/python-pillow/Pillow/issues/3514","id":394775535,"node_id":"MDU6SXNzdWUzOTQ3NzU1MzU=","number":3514,"title":"TestFileEps.test_emptyline fails on Windows","user":{"login":"cgohlke","id":483428,"node_id":"MDQ6VXNlcjQ4MzQyOA==","avatar_url":"https://avatars.githubusercontent.com/u/483428?v=4","gravatar_id":"","url":"https://api.github.com/users/cgohlke","html_url":"https://github.com/cgohlke","followers_url":"https://api.github.com/users/cgohlke/followers","following_url":"https://api.github.com/users/cgohlke/following{/other_user}","gists_url":"https://api.github.com/users/cgohlke/gists{/gist_id}","starred_url":"https://api.github.com/users/cgohlke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgohlke/subscriptions","organizations_url":"https://api.github.com/users/cgohlke/orgs","repos_url":"https://api.github.com/users/cgohlke/repos","events_url":"https://api.github.com/users/cgohlke/events{/privacy}","received_events_url":"https://api.github.com/users/cgohlke/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":227368490,"node_id":"MDU6TGFiZWwyMjczNjg0OTA=","url":"https://api.github.com/repos/python-pillow/Pillow/labels/Windows","name":"Windows","color":"00bcf2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-12-29T08:45:03Z","updated_at":"2018-12-30T05:59:44Z","closed_at":"2018-12-30T05:59:44Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using Pillow 5.4 from current master branch, `TestFileEps.test_emptyline` fails on Python 3.7.2, 64-bit, for Windows (have not tried other Python versions). This test used to pass with Pillow 5.3.  It seems `fp.readline()` no longer includes line endings `\\r\\n` (?).\r\n\r\n```\r\n================================== FAILURES ===================================\r\n_________________________ TestFileEps.test_emptyline __________________________\r\n\r\nself = <test_file_eps.TestFileEps testMethod=test_emptyline>\r\n\r\n    def test_emptyline(self):\r\n        # Test file includes an empty line in the header data\r\n        emptyline_file = \"Tests/images/zero_bb_emptyline.eps\"\r\n\r\n>       image = Image.open(emptyline_file)\r\n\r\nTests\\test_file_eps.py:240:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nsrc\\PIL\\Image.py:2666: in open\r\n    im = _open_core(fp, filename, prefix)\r\nsrc\\PIL\\Image.py:2652: in _open_core\r\n    im = factory(fp, filename)\r\nsrc\\PIL\\ImageFile.py:101: in __init__\r\n    self._open()\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <PIL.EpsImagePlugin.EpsImageFile image mode=RGB size=1x1 at 0x228F7066080>\r\n\r\n    def _open(self):\r\n        (length, offset) = self._find_offset(self.fp)\r\n\r\n        # Rewrap the open file pointer in something that will\r\n        # convert line endings and decode to latin-1.\r\n        fp = PSFile(self.fp)\r\n\r\n        # go to offset - start of \"%!PS\"\r\n        fp.seek(offset)\r\n\r\n        box = None\r\n\r\n        self.mode = \"RGB\"\r\n        self._size = 1, 1  # FIXME: huh?\r\n\r\n        #\r\n        # Load EPS header\r\n\r\n        s_raw = fp.readline()\r\n        s = s_raw.strip('\\r\\n')\r\n\r\n        while s_raw:\r\n            if s:\r\n                if len(s) > 255:\r\n                    raise SyntaxError(\"not an EPS file\")\r\n\r\n                try:\r\n                    m = split.match(s)\r\n                except re.error:\r\n                    raise SyntaxError(\"not an EPS file\")\r\n\r\n                if m:\r\n                    k, v = m.group(1, 2)\r\n                    self.info[k] = v\r\n                    if k == \"BoundingBox\":\r\n                        try:\r\n                            # Note: The DSC spec says that BoundingBox\r\n                            # fields should be integers, but some drivers\r\n                            # put floating point values there anyway.\r\n                            box = [int(float(i)) for i in v.split()]\r\n                            self._size = box[2] - box[0], box[3] - box[1]\r\n                            self.tile = [(\"eps\", (0, 0) + self.size, offset,\r\n                                          (length, box))]\r\n                        except Exception:\r\n                            pass\r\n\r\n                else:\r\n                    m = field.match(s)\r\n                    if m:\r\n                        k = m.group(1)\r\n\r\n                        if k == \"EndComments\":\r\n                            break\r\n                        if k[:8] == \"PS-Adobe\":\r\n                            self.info[k[:8]] = k[9:]\r\n                        else:\r\n                            self.info[k] = \"\"\r\n                    elif s[0] == '%':\r\n                        # handle non-DSC Postscript comments that some\r\n                        # tools mistakenly put in the Comments section\r\n                        pass\r\n                    else:\r\n                        raise IOError(\"bad EPS header\")\r\n\r\n            s_raw = fp.readline()\r\n            s = s_raw.strip('\\r\\n')\r\n\r\n            if s and s[:1] != \"%\":\r\n                break\r\n\r\n        #\r\n        # Scan for an \"ImageData\" descriptor\r\n\r\n        while s[:1] == \"%\":\r\n\r\n            if len(s) > 255:\r\n                raise SyntaxError(\"not an EPS file\")\r\n\r\n            if s[:11] == \"%ImageData:\":\r\n                # Encoded bitmapped image.\r\n                x, y, bi, mo = s[11:].split(None, 7)[:4]\r\n\r\n                if int(bi) != 8:\r\n                    break\r\n                try:\r\n                    self.mode = self.mode_map[int(mo)]\r\n                except ValueError:\r\n                    break\r\n\r\n                self._size = int(x), int(y)\r\n                return\r\n\r\n            s = fp.readline().strip('\\r\\n')\r\n            if not s:\r\n                break\r\n\r\n        if not box:\r\n>           raise IOError(\"cannot determine EPS bounding box\")\r\nE           OSError: cannot determine EPS bounding box\r\n\r\nsrc\\PIL\\EpsImagePlugin.py:305: OSError\r\n```","closed_by":{"login":"cgohlke","id":483428,"node_id":"MDQ6VXNlcjQ4MzQyOA==","avatar_url":"https://avatars.githubusercontent.com/u/483428?v=4","gravatar_id":"","url":"https://api.github.com/users/cgohlke","html_url":"https://github.com/cgohlke","followers_url":"https://api.github.com/users/cgohlke/followers","following_url":"https://api.github.com/users/cgohlke/following{/other_user}","gists_url":"https://api.github.com/users/cgohlke/gists{/gist_id}","starred_url":"https://api.github.com/users/cgohlke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgohlke/subscriptions","organizations_url":"https://api.github.com/users/cgohlke/orgs","repos_url":"https://api.github.com/users/cgohlke/repos","events_url":"https://api.github.com/users/cgohlke/events{/privacy}","received_events_url":"https://api.github.com/users/cgohlke/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-pillow/Pillow/issues/3514/timeline","performed_via_github_app":null,"state_reason":"completed"}