{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/513","repository_url":"https://api.github.com/repos/python-pillow/Pillow","labels_url":"https://api.github.com/repos/python-pillow/Pillow/issues/513/labels{/name}","comments_url":"https://api.github.com/repos/python-pillow/Pillow/issues/513/comments","events_url":"https://api.github.com/repos/python-pillow/Pillow/issues/513/events","html_url":"https://github.com/python-pillow/Pillow/issues/513","id":26748731,"node_id":"MDU6SXNzdWUyNjc0ODczMQ==","number":513,"title":"Converting P->RGB, modifying, and converting back to P results in incorrect palette","user":{"login":"gasman","id":85097,"node_id":"MDQ6VXNlcjg1MDk3","avatar_url":"https://avatars.githubusercontent.com/u/85097?v=4","gravatar_id":"","url":"https://api.github.com/users/gasman","html_url":"https://github.com/gasman","followers_url":"https://api.github.com/users/gasman/followers","following_url":"https://api.github.com/users/gasman/following{/other_user}","gists_url":"https://api.github.com/users/gasman/gists{/gist_id}","starred_url":"https://api.github.com/users/gasman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gasman/subscriptions","organizations_url":"https://api.github.com/users/gasman/orgs","repos_url":"https://api.github.com/users/gasman/repos","events_url":"https://api.github.com/users/gasman/events{/privacy}","received_events_url":"https://api.github.com/users/gasman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":10115804,"node_id":"MDU6TGFiZWwxMDExNTgwNA==","url":"https://api.github.com/repos/python-pillow/Pillow/labels/Bug","name":"Bug","color":"fef2c0","default":false,"description":"Any unexpected behavior, until confirmed feature."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2014-02-01T22:24:19Z","updated_at":"2014-03-17T13:49:00Z","closed_at":"2014-03-17T13:49:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Running this script (which converts a paletted image to RGB, resizes it with antialiasing enabled, and converts it back to paletted) on the provided in.gif results in an image with a broken palette.\n\nFrom git bisect, the offending commit is https://github.com/python-imaging/Pillow/commit/06301c9eba3904acf8a9b7b707caa71ba7b6a0d3 - this suggests that it's holding on to the image's original palette, which is no longer valid after the RGB data is modified by the resize operation. (The bug is avoided if you save and reopen the image while it is in RGB mode, immediately before or after the image.resize line.)\n\n```\nfrom PIL import Image\n\nimage = Image.open('in.gif')\nimage = image.convert('RGB')\nimage = image.resize((200, 150), Image.ANTIALIAS)\nimage = image.convert('P', palette=Image.ADAPTIVE, colors=256)\nimage.save('out.png')\n```\n\nin.gif:\n![in](https://f.cloud.github.com/assets/85097/2058925/55562ea0-8b8d-11e3-8d85-eda144316a85.gif)\n\nout.png with Pillow 2.2.2:\n![out-pillow 2 2 2](https://f.cloud.github.com/assets/85097/2058928/6bccd58a-8b8d-11e3-80f2-bc92e5333e85.png)\n\nout.png with Pillow 2.3.0:\n![out-pillow 2 3 0](https://f.cloud.github.com/assets/85097/2058929/77151cea-8b8d-11e3-90b4-4c0c69cda085.png)\n","closed_by":{"login":"wiredfool","id":19792,"node_id":"MDQ6VXNlcjE5Nzky","avatar_url":"https://avatars.githubusercontent.com/u/19792?v=4","gravatar_id":"","url":"https://api.github.com/users/wiredfool","html_url":"https://github.com/wiredfool","followers_url":"https://api.github.com/users/wiredfool/followers","following_url":"https://api.github.com/users/wiredfool/following{/other_user}","gists_url":"https://api.github.com/users/wiredfool/gists{/gist_id}","starred_url":"https://api.github.com/users/wiredfool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wiredfool/subscriptions","organizations_url":"https://api.github.com/users/wiredfool/orgs","repos_url":"https://api.github.com/users/wiredfool/repos","events_url":"https://api.github.com/users/wiredfool/events{/privacy}","received_events_url":"https://api.github.com/users/wiredfool/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-pillow/Pillow/issues/513/timeline","performed_via_github_app":null,"state_reason":"completed"}