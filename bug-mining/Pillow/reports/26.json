{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/452","repository_url":"https://api.github.com/repos/python-pillow/Pillow","labels_url":"https://api.github.com/repos/python-pillow/Pillow/issues/452/labels{/name}","comments_url":"https://api.github.com/repos/python-pillow/Pillow/issues/452/comments","events_url":"https://api.github.com/repos/python-pillow/Pillow/issues/452/events","html_url":"https://github.com/python-pillow/Pillow/issues/452","id":24541764,"node_id":"MDU6SXNzdWUyNDU0MTc2NA==","number":452,"title":"Reading and converting 16-bit pixels","user":{"login":"igg","id":1679619,"node_id":"MDQ6VXNlcjE2Nzk2MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1679619?v=4","gravatar_id":"","url":"https://api.github.com/users/igg","html_url":"https://github.com/igg","followers_url":"https://api.github.com/users/igg/followers","following_url":"https://api.github.com/users/igg/following{/other_user}","gists_url":"https://api.github.com/users/igg/gists{/gist_id}","starred_url":"https://api.github.com/users/igg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igg/subscriptions","organizations_url":"https://api.github.com/users/igg/orgs","repos_url":"https://api.github.com/users/igg/repos","events_url":"https://api.github.com/users/igg/events{/privacy}","received_events_url":"https://api.github.com/users/igg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":10115806,"node_id":"MDU6TGFiZWwxMDExNTgwNg==","url":"https://api.github.com/repos/python-pillow/Pillow/labels/Enhancement","name":"Enhancement","color":"84b6eb","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/python-pillow/Pillow/milestones/5","html_url":"https://github.com/python-pillow/Pillow/milestone/5","labels_url":"https://api.github.com/repos/python-pillow/Pillow/milestones/5/labels","id":524552,"node_id":"MDk6TWlsZXN0b25lNTI0NTUy","number":5,"title":"2.4.0","description":"","creator":{"login":"aclark4life","id":72164,"node_id":"MDQ6VXNlcjcyMTY0","avatar_url":"https://avatars.githubusercontent.com/u/72164?v=4","gravatar_id":"","url":"https://api.github.com/users/aclark4life","html_url":"https://github.com/aclark4life","followers_url":"https://api.github.com/users/aclark4life/followers","following_url":"https://api.github.com/users/aclark4life/following{/other_user}","gists_url":"https://api.github.com/users/aclark4life/gists{/gist_id}","starred_url":"https://api.github.com/users/aclark4life/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aclark4life/subscriptions","organizations_url":"https://api.github.com/users/aclark4life/orgs","repos_url":"https://api.github.com/users/aclark4life/repos","events_url":"https://api.github.com/users/aclark4life/events{/privacy}","received_events_url":"https://api.github.com/users/aclark4life/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":16,"state":"closed","created_at":"2014-01-01T21:37:39Z","updated_at":"2014-04-01T22:55:06Z","due_on":"2014-04-01T07:00:00Z","closed_at":"2014-04-01T22:55:06Z"},"comments":7,"created_at":"2013-12-19T07:58:04Z","updated_at":"2021-11-22T21:44:41Z","closed_at":"2014-01-31T21:50:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```\n>>> import PIL\n>>> PIL.PILLOW_VERSION\n'2.2.2'\n>>> from PIL import Image\n>>> im = Image.open('pil_pillow_16_bit_bug.tif')\n>>> im\n<PIL.TiffImagePlugin.TiffImageFile image mode=I;16B size=512x512 at 0x103125E60>\n```\n\nNote no 'S' in mode.\nThen,\n\n```\n>>> im.getpixel((0,0))\n-32768\n```\n\nTwo problems: Other than using the extended SampleFormat tag (339, 0x0153), there is no way to store a signed value in a tiff file.  The value stored in this image at 0,0 is 32768, and this file has no SampleFormat tag, so only unsigned integers are possible. Instead the value reported is the two's complement of the actual value.\nSecond problem unrelated to tiff peculiarities, you have an unsigned image mode with a signed pixel value.\nMoving on,\n\n```\n>>> im2 = im.convert('I')\n>>> im2.getpixel((0,0))\n32768\n```\n\nThis is the correct value.\nEven more surprising is when we convert this 32-bit, presumably unsigned image back to unsigned 16 bit:\n\n```\n>>> im3 = im2.convert('I;16')\n>>> im3.getpixel((0,0))\n32767\n```\n\n???. Even better, a pixel at 32,16 has a value of 32769:\n\n```\n>>> im2.getpixel((32,16))\n32769\n```\n\nCorrect in the 32-bit unsigned image (is it really unsigned, BTW?  didn't check), but in the 16-bit image converted from it, this pixel is still 32767!\n\n```\n>>> im3.getpixel((32,16))\n32767\n```\n\nIn fact, all of the pixels in the converted image are clipped to 32767.  In the image as-read, this value is -32767 (two's complement of 32769):\n\n```\n>>>> >>> im.getpixel((32,16))\n-32767\n```\n\nDoes the problem originate from the fact that we went over the signed 16-bit max even though we were supposed to be dealing with unsigned values?  Is the convert problem related to the tiff reader problem?\n\nSample file for the above: [pil_pillow_16_bit_bug.tif](https://drive.google.com/file/d/0B-x3kTkP-RShSjY1ZUVCZGNBMWc/edit?usp=sharing)\n","closed_by":{"login":"wiredfool","id":19792,"node_id":"MDQ6VXNlcjE5Nzky","avatar_url":"https://avatars.githubusercontent.com/u/19792?v=4","gravatar_id":"","url":"https://api.github.com/users/wiredfool","html_url":"https://github.com/wiredfool","followers_url":"https://api.github.com/users/wiredfool/followers","following_url":"https://api.github.com/users/wiredfool/following{/other_user}","gists_url":"https://api.github.com/users/wiredfool/gists{/gist_id}","starred_url":"https://api.github.com/users/wiredfool/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wiredfool/subscriptions","organizations_url":"https://api.github.com/users/wiredfool/orgs","repos_url":"https://api.github.com/users/wiredfool/repos","events_url":"https://api.github.com/users/wiredfool/events{/privacy}","received_events_url":"https://api.github.com/users/wiredfool/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-pillow/Pillow/issues/452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-pillow/Pillow/issues/452/timeline","performed_via_github_app":null,"state_reason":"completed"}