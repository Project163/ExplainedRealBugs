<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:54:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FILEUPLOAD-135] InputStream created with Streaming API returns EOF on first read() for short files uploaded from FireFox over HTTPS</title>
                <link>https://issues.apache.org/jira/browse/FILEUPLOAD-135</link>
                <project id="12310476" key="FILEUPLOAD">Commons FileUpload</project>
                    <description>&lt;p&gt;This problem happens only with files shorer then boundary string generated by browser and only with Firefox using HTTPS protocol.&lt;br/&gt;
For some reason in this particular environment inputStream.read() in MultipartStream.ItemInputStream.makeAvailable() reads not whole HTTP response body, but only file content before boundary string. &lt;br/&gt;
I&apos;ve created a patch fixing this issue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP&lt;br/&gt;
Browser: Firefox 1.5.0.11&lt;br/&gt;
Protocol: HTTPS&lt;/p&gt;
</environment>
        <key id="12370108">FILEUPLOAD-135</key>
            <summary>InputStream created with Streaming API returns EOF on first read() for short files uploaded from FireFox over HTTPS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jochen@apache.org">Jochen Wiedmann</assignee>
                                    <reporter username="bird_owl">Alexander Sova</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 May 2007 02:09:45 +0000</created>
                <updated>Tue, 6 Jun 2017 04:22:09 +0000</updated>
                            <resolved>Wed, 27 Jun 2007 01:03:31 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.2.1</version>
                                    <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12498456" author="bird_owl" created="Thu, 24 May 2007 02:12:05 +0000"  >&lt;p&gt;reading from inputStream until we get enough content to fit boundary string&lt;/p&gt;</comment>
                            <comment id="12499220" author="bird_owl" created="Fri, 25 May 2007 20:31:07 +0000"  >&lt;p&gt;my previous patch has a bug. please use new one&lt;/p&gt;</comment>
                            <comment id="12499448" author="jochen@apache.org" created="Sun, 27 May 2007 21:13:34 +0000"  >&lt;p&gt;Before applying your patch, I&apos;d like to understand the problem. Would it be possible for you to provide a test case, which fails with 1.2 and works with your patch? Preferrably a patch against the test suite, but a sample http body should do.&lt;/p&gt;</comment>
                            <comment id="12499862" author="bird_owl" created="Tue, 29 May 2007 17:46:03 +0000"  >&lt;p&gt;The problem is not with content of HTTP response, but with original InputStream behavior. InputStream.read() may read not whole buffer or whole content of input stream, but just part of it. If this part is shorter then boundary string (but still greater then 0) ItemInputStream.read() returns -1.&lt;/p&gt;

&lt;p&gt;I was able to reproduce it only with small file (10 bytes) using FireFox 1.5.0.11 and HTTPS. I think I can simulate this by developing custom InputStream, but it could take some time.&lt;/p&gt;

&lt;p&gt;Here is fragment of my code where I test the upload:&lt;/p&gt;

&lt;p&gt;    protected byte[] getBoundary(String contentType) &lt;br/&gt;
    {&lt;br/&gt;
        ParameterParser parser = new ParameterParser();&lt;br/&gt;
        parser.setLowerCaseNames(true);&lt;br/&gt;
        // Parameter parser can handle null input&lt;br/&gt;
        Map params = parser.parse(contentType, &apos;;&apos;);&lt;br/&gt;
        String boundaryStr = (String) params.get(&quot;boundary&quot;);&lt;/p&gt;

&lt;p&gt;        if (boundaryStr == null) &lt;/p&gt;
{
            return null;
        }
&lt;p&gt;        byte[] boundary;&lt;br/&gt;
        try &lt;/p&gt;
{
            boundary = boundaryStr.getBytes(&quot;ISO-8859-1&quot;);
        }
&lt;p&gt; catch (UnsupportedEncodingException e) &lt;/p&gt;
{
            boundary = boundaryStr.getBytes();
        }
&lt;p&gt;        return boundary;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    private void testFileUpload(HttpServletRequest req)&lt;br/&gt;
    {&lt;br/&gt;
        try &lt;br/&gt;
        {&lt;br/&gt;
            byte[] boundary = getBoundary(req.getHeader(&quot;Content-Type&quot;));&lt;br/&gt;
            System.out.println(&quot;Boundary: &quot; + new String(boundary));&lt;br/&gt;
            MultipartStream multipartStream = new MultipartStream(req.getInputStream(), boundary);&lt;br/&gt;
            boolean nextPart = multipartStream.skipPreamble();&lt;br/&gt;
            OutputStream output = System.out;&lt;br/&gt;
            while(nextPart) &lt;/p&gt;
            {
                //header = chunks.readHeader();
                System.out.println(&quot;!&quot; + multipartStream.readHeaders() + &quot;!&quot;);

                multipartStream.readBodyData(output);
                nextPart = multipartStream.readBoundary();
            }
&lt;p&gt;        }&lt;br/&gt;
        catch(Exception e) &lt;/p&gt;
        {
            e.printStackTrace();
        }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="12502147" author="jochen@apache.org" created="Wed, 6 Jun 2007 23:42:08 +0000"  >&lt;p&gt;This test case doesn&apos;t help me understand the problem. The important part is the multipart document, which triggers the problem. We&apos;d need a code sample that creates such a multipart document (compare, for example, the methid StreamingTest.newRequest; btw, note that this method creates file items which are clearly smaller than the boundary) or at least the multipart document itself, which you can catch with tools like tcpmon or Wireshark.&lt;/p&gt;</comment>
                            <comment id="12502527" author="bird_owl" created="Thu, 7 Jun 2007 21:17:26 +0000"  >&lt;p&gt;I&apos;ve added new test case to StreamingTest class. The key thing here is defining custom InputStream on top of ByteArrayInputStream which never read more then 3 bytes per call. If you change this number to something bigger then 10, the test will pass.&lt;/p&gt;

&lt;p&gt;BTW, with  MockHttpServletRequest.MyServletInputStream.read(byte[],int,int) method defined properly testIOException() start failing. Without this change the second read() method defined in testIOException() never been called.&lt;/p&gt;
</comment>
                            <comment id="12507942" author="rob.slifka@voltage.com" created="Mon, 25 Jun 2007 18:07:30 +0000"  >&lt;p&gt;Hello Jira,&lt;/p&gt;

&lt;p&gt;I&apos;ve run into this issue as well, very much looking forward to the&lt;br/&gt;
patch, thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Rob Slifka&lt;/p&gt;
</comment>
                            <comment id="12507943" author="rslifka" created="Mon, 25 Jun 2007 18:13:35 +0000"  >&lt;p&gt;&quot;Hello Jira&quot; yikes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Anyway, is there a way to see the progress on this issue?  I.e. if it&apos;s been submitted, scheduled, etc.?&lt;/p&gt;

&lt;p&gt;Just to verify, it is indeed a Firefox-only issue, and not reproducible on any other browser (IE6, IE7, Opera, Safari).&lt;/p&gt;</comment>
                            <comment id="12508373" author="jochen@apache.org" created="Wed, 27 Jun 2007 01:03:31 +0000"  >&lt;p&gt;Applied, thank you!&lt;/p&gt;</comment>
                            <comment id="12511187" author="rslifka" created="Mon, 9 Jul 2007 17:32:26 +0000"  >&lt;p&gt;Many thanks Jochen!  I see that another has verified the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/FILEUPLOAD-138&quot; title=&quot;Fail to upload small files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FILEUPLOAD-138&quot;&gt;&lt;del&gt;FILEUPLOAD-138&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Any idea when we&apos;ll see 1.2.1 released?&lt;/p&gt;</comment>
                            <comment id="12553191" author="cpopetz" created="Wed, 19 Dec 2007 01:35:43 +0000"  >&lt;p&gt;I&apos;d like to note that this is actually browser independent and not just an issue with short files...when data is coming via AJP (coyote / mod_jk) in tomcat, it comes in chunks, and if a chunk falls on a boundary, it triggers this bug (which it does for my web site a &lt;em&gt;lot&lt;/em&gt; and I&apos;ve been chasing it for weeks)  because the first read will just return what&apos;s left in that chunk (not enough for a boundary) and the second read would return the rest of the boundary.&lt;/p&gt;</comment>
                            <comment id="13187325" author="mgessel" created="Tue, 17 Jan 2012 00:05:53 +0000"  >&lt;p&gt;Incidentally, I started triggering this bug after updating to JRE 1.7 u1 on the &lt;b&gt;client&lt;/b&gt;. I have a standalone Java application that is uploading files to a Tomcat container via HTTPS/SSL. &lt;/p&gt;

&lt;p&gt;Reproduction requires: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HTTPS/SSL transmission&lt;/li&gt;
	&lt;li&gt;jdk1.7.0_u1 or later&lt;/li&gt;
	&lt;li&gt;commons-fileupload-1.2.0 or previous&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Fixed with commons-fileupload-1.2.1 or later&lt;/p&gt;</comment>
                            <comment id="16038100" author="chtompki" created="Tue, 6 Jun 2017 04:22:09 +0000"  >&lt;p&gt;1.2.1 released.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12376723">FILEUPLOAD-144</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12372501">FILEUPLOAD-138</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359214" name="FILEUPLOAD135.patch" size="5759" author="bird_owl" created="Thu, 7 Jun 2007 21:17:26 +0000"/>
                            <attachment id="12358053" name="commons-fileupload-1.1-bug-short-file-eof.patch" size="2558" author="bird_owl" created="Thu, 24 May 2007 02:12:05 +0000"/>
                            <attachment id="12358277" name="commons-fileupload-1.2-bug-short-file-eof.patch" size="3018" author="bird_owl" created="Fri, 25 May 2007 20:31:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0skt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>