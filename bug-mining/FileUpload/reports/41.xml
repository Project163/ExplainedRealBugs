<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:55:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FILEUPLOAD-202] org.apache.commons.fileupload.FileUploadBase$IOFileUploadException: Processing of multipart/form-data request failed. Stream ended unexpectedly</title>
                <link>https://issues.apache.org/jira/browse/FILEUPLOAD-202</link>
                <project id="12310476" key="FILEUPLOAD">Commons FileUpload</project>
                    <description>&lt;p&gt;I used this one to write the servlet&lt;br/&gt;
&lt;a href=&quot;http://www.servletworld.com/servlet-tutorials/servlet-file-upload-example.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.servletworld.com/servlet-tutorials/servlet-file-upload-example.html&lt;/a&gt;&lt;br/&gt;
I can successfully upload the file through localhost, however, when I use Jmeter to test the app server using 300 threads, it&lt;br/&gt;
will report this error:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} WebApp&lt;a href=&quot;http://localhost:8080/OrderFile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/OrderFile&lt;/a&gt; CommonsFileUploadServlet: Error encountered while parsing the request&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; org.apache.commons.fileupload.FileUploadBase$IOFileUploadException: Processing of multipart/form-data request failed. Stream ended unexpectedly&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at org.apache.commons.fileupload.FileUploadBase.parseRequest(FileUploadBase.java:371)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at org.apache.commons.fileupload.servlet.ServletFileUpload.parseRequest(ServletFileUpload.java:126)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at CommonsFileUploadServlet.doPost(CommonsFileUploadServlet.java:66)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at javax.servlet.http.HttpServlet.service(HttpServlet.java:153)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at javax.servlet.http.HttpServlet.service(HttpServlet.java:91)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at com.caucho.server.dispatch.ServletFilterChain.doFilter(ServletFilterChain.java:103)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:187)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:265)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:273)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at com.caucho.server.port.TcpConnection.run(TcpConnection.java:682)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at com.caucho.util.ThreadPool$Item.runTasks(ThreadPool.java:743)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at com.caucho.util.ThreadPool$Item.run(ThreadPool.java:662)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; Caused by: org.apache.commons.fileupload.MultipartStream$MalformedStreamException: Stream ended unexpectedly&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at org.apache.commons.fileupload.MultipartStream$ItemInputStream.makeAvailable(MultipartStream.java:982)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at org.apache.commons.fileupload.MultipartStream$ItemInputStream.read(MultipartStream.java:886)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at java.io.FilterInputStream.read(FilterInputStream.java:116)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at org.apache.commons.fileupload.util.LimitedInputStream.read(LimitedInputStream.java:125)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at java.io.FilterInputStream.read(FilterInputStream.java:90)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at org.apache.commons.fileupload.util.Streams.copy(Streams.java:96)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842} 	at org.apache.commons.fileupload.util.Streams.copy(Streams.java:66)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; {http--8080-244$1283730842}
&lt;p&gt; 	at org.apache.commons.fileupload.FileUploadBase.parseRequest(FileUploadBase.java:366)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;10:40:23.577&amp;#93;&lt;/span&gt; &lt;/p&gt;
{http--8080-244$1283730842}
&lt;p&gt; 	... 12 more&lt;/p&gt;

&lt;p&gt;Is it because of the size limit? the uploaded file size is 8KB.&lt;br/&gt;
Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533490">FILEUPLOAD-202</key>
            <summary>org.apache.commons.fileupload.FileUploadBase$IOFileUploadException: Processing of multipart/form-data request failed. Stream ended unexpectedly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tn">Thomas Neidhart</assignee>
                                    <reporter username="kakaxifly">tina</reporter>
                        <labels>
                            <label>fileupload</label>
                    </labels>
                <created>Thu, 1 Dec 2011 19:11:27 +0000</created>
                <updated>Tue, 6 Jun 2017 04:31:58 +0000</updated>
                            <resolved>Wed, 20 Mar 2013 08:04:30 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13161442" author="maurizio.cucchiara" created="Fri, 2 Dec 2011 05:58:21 +0000"  >&lt;p&gt;In order to exclude a thread-safety issue, did you try to run the jmeter test with just one thread?&lt;/p&gt;</comment>
                            <comment id="13161452" author="kakaxifly" created="Fri, 2 Dec 2011 06:46:16 +0000"  >&lt;p&gt;Yes. I did. only one thread works ok. If I set the threads count to 250, it works ok. But if I set count to 300,it will report that error. &lt;/p&gt;</comment>
                            <comment id="13161467" author="maurizio.cucchiara" created="Fri, 2 Dec 2011 07:23:53 +0000"  >&lt;p&gt;It could be interesting to know what application server you are using (Tomcat, JBoss, etc.)&lt;/p&gt;</comment>
                            <comment id="13161471" author="kakaxifly" created="Fri, 2 Dec 2011 07:58:31 +0000"  >&lt;p&gt;Now I am testing the scalability of resin and jetty. Both of them have the same issue.&lt;/p&gt;</comment>
                            <comment id="13161535" author="maurizio.cucchiara" created="Fri, 2 Dec 2011 10:33:35 +0000"  >&lt;p&gt;I could be wrong, but the numbers you provided make me guess that It could be a thread saturation, you should try to increase maxThreads on your web container&lt;/p&gt;</comment>
                            <comment id="13161777" author="kakaxifly" created="Fri, 2 Dec 2011 18:29:27 +0000"  >&lt;p&gt;It seems the maxThread in resin configuration doesn&apos;t work. Because I set it to 256, but when I run 350 thread, it can still run correctly. Before I thought it is because the first threads finish quickly, another threads reuse them.But I set the view result in table in Jmeter, and saw each request sent almost the same time, and the sample time plus the start time is after other sample&apos;s start time. I thought resin should stop processing the request when the number of threads exceeds the configured maxThread. Do you know the reason why it still can run correctly? &lt;/p&gt;</comment>
                            <comment id="13238919" author="bokken" created="Mon, 26 Mar 2012 22:33:27 +0000"  >&lt;p&gt;Many connectors have the ability to have a backlog of connections. This is in the &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/net/ServerSocket.html#ServerSocket(int,%20int)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ServerSocket constructor&lt;/a&gt; in java and the &lt;a href=&quot;http://httpd.apache.org/docs/2.2/mod/mpm_common.html#listenbacklog&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ListenBacklog&lt;/a&gt; directive in the apache httpd server.&lt;br/&gt;
I would not be surprised if the 350 concurrent requests simply caused 94 requests to go into backlog until threads freed up.&lt;/p&gt;</comment>
                            <comment id="13599802" author="tn" created="Tue, 12 Mar 2013 07:41:22 +0000"  >&lt;p&gt;Hi Tina,&lt;/p&gt;

&lt;p&gt;while doing tests for another issue we found out that it can happen that SizeExceptions due to given limits are not propagated correctly to the user. So in your case it is very likely that actually the uploaded request exceeded the fileSize or sizeMax limit.&lt;/p&gt;

&lt;p&gt;Could you test again without such a setting and see if the problem remains?&lt;br/&gt;
Issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FILEUPLOAD-212&quot; title=&quot;Insecure request size checking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FILEUPLOAD-212&quot;&gt;&lt;del&gt;FILEUPLOAD-212&lt;/del&gt;&lt;/a&gt; should fix this problem and propagate the correct Exception.&lt;/p&gt;</comment>
                            <comment id="13607380" author="simone.tripodi" created="Wed, 20 Mar 2013 08:04:30 +0000"  >&lt;p&gt;issued marked as resolved by resolving &lt;a href=&quot;https://issues.apache.org/jira/browse/FILEUPLOAD-212&quot; title=&quot;Insecure request size checking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FILEUPLOAD-212&quot;&gt;&lt;del&gt;FILEUPLOAD-212&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13966324" author="anilsk89" created="Fri, 11 Apr 2014 08:22:16 +0000"  >&lt;p&gt;Even I also facing the same exception while uploading a file in my project. And as commented above about maxSize, I have not maintained any maxSize for file. How to resolve this. Please do help me.&lt;/p&gt;</comment>
                            <comment id="16038118" author="chtompki" created="Tue, 6 Jun 2017 04:31:58 +0000"  >&lt;p&gt;1.3 released.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12598841">FILEUPLOAD-212</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219218</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sken:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>