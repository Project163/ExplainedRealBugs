{"url":"https://api.github.com/repos/redis/redis/issues/9926","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/9926/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/9926/comments","events_url":"https://api.github.com/repos/redis/redis/issues/9926/events","html_url":"https://github.com/redis/redis/issues/9926","id":1076904072,"node_id":"I_kwDOAAJhcs5AMECI","number":9926,"title":"Any command used in MULTI fails when used_memory > maxmemory","user":{"login":"markuszoeller","id":7761429,"node_id":"MDQ6VXNlcjc3NjE0Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/7761429?v=4","gravatar_id":"","url":"https://api.github.com/users/markuszoeller","html_url":"https://github.com/markuszoeller","followers_url":"https://api.github.com/users/markuszoeller/followers","following_url":"https://api.github.com/users/markuszoeller/following{/other_user}","gists_url":"https://api.github.com/users/markuszoeller/gists{/gist_id}","starred_url":"https://api.github.com/users/markuszoeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markuszoeller/subscriptions","organizations_url":"https://api.github.com/users/markuszoeller/orgs","repos_url":"https://api.github.com/users/markuszoeller/repos","events_url":"https://api.github.com/users/markuszoeller/events{/privacy}","received_events_url":"https://api.github.com/users/markuszoeller/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2359025022,"node_id":"MDU6TGFiZWwyMzU5MDI1MDIy","url":"https://api.github.com/repos/redis/redis/labels/state:help-wanted","name":"state:help-wanted","color":"56a7b7","default":false,"description":"No member is currently implementing this change"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/redis/redis/milestones/10","html_url":"https://github.com/redis/redis/milestone/10","labels_url":"https://api.github.com/repos/redis/redis/milestones/10/labels","id":5683881,"node_id":"MDk6TWlsZXN0b25lNTY4Mzg4MQ==","number":10,"title":"Next minor backlog","description":"","creator":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":37,"closed_issues":46,"state":"open","created_at":"2020-07-21T07:39:22Z","updated_at":"2025-10-28T08:50:19Z","due_on":null,"closed_at":null},"comments":32,"created_at":"2021-12-10T14:26:24Z","updated_at":"2024-01-25T09:17:42Z","closed_at":"2024-01-25T09:17:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Edit: see current conclusion in https://github.com/redis/redis/issues/9926#issuecomment-992833835\r\n\r\n**Describe the bug**\r\n\r\nI've created a scenario where `used_memory` is bigger than `maxmemory`\r\nand where `maxmemory-policy` is set to `noeviction`. When I use a command \r\nwrapped in MULTI, it behaves differently than when I use it standalone.\r\n\r\n**To reproduce**\r\n\r\n\r\n* `config set maxmemory-policy noeviction`\r\n* `config set maxmemory 12026784`\r\n* write keys until `OOM command not allowed when used memory > 'maxmemory'`\r\n* ignore that error and brute force to write even more keys (some go through) to make sure there's really memory > maxmemory\r\n* try to delete a key wrapped in multi:\r\n```\r\n> MULTI\r\nOK\r\n> DEL foobar\r\n(error) OOM command not allowed when used memory > 'maxmemory'.\r\n> EXEC\r\n(error) EXECABORT Transaction discarded because of previous errors.\r\n```\r\n\r\n**Expected behavior**\r\n\r\nI would expect any non-write command to work in MULTI. It only works without MULTI:\r\n```\r\n> DEL foobar\r\n(integer) 1\r\n```\r\n\r\nSame behavior with INFO. There are probably more commands where it would make sense to allow them in MULTI in that scenario (In my case CLIENT PAUSE was part of it, but given that it buffers requests, I can see why it wouldn't be allowed).\r\n\r\n**Additional information**\r\n\r\nTested in Redis 5.0.14\r\n","closed_by":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/9926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/9926/timeline","performed_via_github_app":null,"state_reason":"completed"}