{"url":"https://api.github.com/repos/redis/redis/issues/8134","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/8134/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/8134/comments","events_url":"https://api.github.com/repos/redis/redis/issues/8134/events","html_url":"https://github.com/redis/redis/issues/8134","id":756547550,"node_id":"MDU6SXNzdWU3NTY1NDc1NTA=","number":8134,"title":"[NEW] Include the plaintext or TLS ports in CLUSTER SLOTS depending on client connection","user":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"madolson","id":34459052,"node_id":"MDQ6VXNlcjM0NDU5MDUy","avatar_url":"https://avatars.githubusercontent.com/u/34459052?v=4","gravatar_id":"","url":"https://api.github.com/users/madolson","html_url":"https://github.com/madolson","followers_url":"https://api.github.com/users/madolson/followers","following_url":"https://api.github.com/users/madolson/following{/other_user}","gists_url":"https://api.github.com/users/madolson/gists{/gist_id}","starred_url":"https://api.github.com/users/madolson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/madolson/subscriptions","organizations_url":"https://api.github.com/users/madolson/orgs","repos_url":"https://api.github.com/users/madolson/repos","events_url":"https://api.github.com/users/madolson/events{/privacy}","received_events_url":"https://api.github.com/users/madolson/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"madolson","id":34459052,"node_id":"MDQ6VXNlcjM0NDU5MDUy","avatar_url":"https://avatars.githubusercontent.com/u/34459052?v=4","gravatar_id":"","url":"https://api.github.com/users/madolson","html_url":"https://github.com/madolson","followers_url":"https://api.github.com/users/madolson/followers","following_url":"https://api.github.com/users/madolson/following{/other_user}","gists_url":"https://api.github.com/users/madolson/gists{/gist_id}","starred_url":"https://api.github.com/users/madolson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/madolson/subscriptions","organizations_url":"https://api.github.com/users/madolson/orgs","repos_url":"https://api.github.com/users/madolson/repos","events_url":"https://api.github.com/users/madolson/events{/privacy}","received_events_url":"https://api.github.com/users/madolson/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":12,"created_at":"2020-12-03T20:08:00Z","updated_at":"2021-03-30T20:11:32Z","closed_at":"2021-03-30T20:11:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**The problem/use-case that the feature addresses**\r\n\r\nWhen the nodes in a cluster are configured with ports for *both TLS and plaintext simultaneously*, the CLUSTER SLOTS response only includes the TLS ports of the nodes in the cluster.\r\n\r\nClients which are still connecting to the cluster without TLS would need to get the plaintext port of each node somehow.\r\n\r\n**Description of the feature**\r\n\r\nLet CLUSTER SLOTS return the TLS ports of all the Redis Cluster nodes to clients connected over TLS and the plaintext ports to clients connected over plaintext.\r\n\r\n**Alternatives you've considered**\r\n\r\n* Extend the response of CLUSTER SLOTS to include the plaintext port as the 4th element (after IP, TLS-port and node ID) when both ports are used. The following warning from the CLUSTER SLOTS documentation opens for this kind of extension:\r\n\r\n    > Warning: Newer versions of Redis Cluster will output, for each Redis instance, not just the IP and port, but also the node ID as third element of the array. In future versions there could be more elements describing the node better. In general a client implementation should just rely on the fact that certain parameters are at fixed positions as specified, but more parameters may follow and should be ignored. Similarly a client library should try if possible to cope with the fact that older versions may just have the IP and port parameter.\r\n* Workarounds (not very good):\r\n  * Tweak the Redis Cluster clients to figure out the non-TLS port given the TLS port (for example hard-coded or using the convention TLS-port = plaintext-port + 1)\r\n  * Let some middleware intercept the Redis traffic and change the ports in the CLUSTER SLOTS responses, while forwarding other traffic as-is.\r\n  * Terminate TLS in the middleware.\r\n  * Avoid the problem by switching over the whole system to TLS at once. This is hard in a deployment with rolling upgrades of multiple components in different languages.\r\n\r\n**Additional information**\r\n\r\nI'm guessing the node-to-node protocol (Redis Cluster Bus?) doesn't include both ports of each node, so a node doesn't necessarily know both ports of the other nodes in the cluster. In that case, the node-to-node protocol would need to be extended.","closed_by":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/8134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/8134/timeline","performed_via_github_app":null,"state_reason":"completed"}