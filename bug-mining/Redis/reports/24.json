{"url":"https://api.github.com/repos/redis/redis/issues/6744","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/6744/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/6744/comments","events_url":"https://api.github.com/repos/redis/redis/issues/6744/events","html_url":"https://github.com/redis/redis/issues/6744","id":546148059,"node_id":"MDU6SXNzdWU1NDYxNDgwNTk=","number":6744,"title":"Stream: Inconsistency between master and replica some XCLAIM case","user":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-01-07T08:28:30Z","updated_at":"2020-01-13T13:27:03Z","closed_at":"2020-01-08T09:11:02Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When `XCLAIM` changes the ownership of an already pending message to the specified consumer, the consumer will be created if it does not exist.\r\n\r\nHowever, the master propagates `XCLAIM` command only if at least one of the ids was claimed. So,  if the consumer did not exist before, the consumer would be created **only** in master.\r\n\r\nfor example:\r\nmaster\r\n```\r\n127.0.0.1:6379> XGROUP CREATE s g $ MKSTREAM\r\nOK\r\n127.0.0.1:6379> XADD s * f v\r\n\"1578330523265-0\"\r\n127.0.0.1:6379> XREADGROUP GROUP g c1 STREAMS s >\r\n1) 1) \"s\"\r\n   2) 1) 1) \"1578330523265-0\"\r\n         2) 1) \"f\"\r\n            2) \"v\"\r\n127.0.0.1:6379> XINFO CONSUMERS s g\r\n1) 1) \"name\"\r\n   2) \"c1\"\r\n   3) \"pending\"\r\n   4) (integer) 1\r\n   5) \"idle\"\r\n   6) (integer) 35690\r\n127.0.0.1:6379> XCLAIM s g c2 100000 1578330523265-0\r\n(empty array)\r\n127.0.0.1:6379> XINFO CONSUMERS s g\r\n1) 1) \"name\"\r\n   2) \"c1\"\r\n   3) \"pending\"\r\n   4) (integer) 1\r\n   5) \"idle\"\r\n   6) (integer) 77355\r\n2) 1) \"name\"\r\n   2) \"c2\"\r\n   3) \"pending\"\r\n   4) (integer) 0\r\n   5) \"idle\"\r\n   6) (integer) 5208\r\n```\r\nreplica\r\n```\r\n127.0.0.1:6380> XINFO CONSUMERS s g\r\n1) 1) \"name\"\r\n   2) \"c1\"\r\n   3) \"pending\"\r\n   4) (integer) 1\r\n   5) \"idle\"\r\n   6) (integer) 91311\r\n```\r\n\r\nThere are 2 available options:\r\n1. Creates the consumer only if there is at least one claimed id\r\n2. Send `XCLAIM` with no ids to the replica\r\n\r\nI think that option 1 is more suited. \r\n@antirez what do you think? I can implement it and PR","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/6744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/6744/timeline","performed_via_github_app":null,"state_reason":"completed"}