[{"actor":{"login":"guybe7","id":19590683,"node_id":"MDQ6VXNlcjE5NTkwNjgz","avatar_url":"https://avatars.githubusercontent.com/u/19590683?v=4","gravatar_id":"","url":"https://api.github.com/users/guybe7","html_url":"https://github.com/guybe7","followers_url":"https://api.github.com/users/guybe7/followers","following_url":"https://api.github.com/users/guybe7/following{/other_user}","gists_url":"https://api.github.com/users/guybe7/gists{/gist_id}","starred_url":"https://api.github.com/users/guybe7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guybe7/subscriptions","organizations_url":"https://api.github.com/users/guybe7/orgs","repos_url":"https://api.github.com/users/guybe7/repos","events_url":"https://api.github.com/users/guybe7/events{/privacy}","received_events_url":"https://api.github.com/users/guybe7/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-07T07:38:12Z","updated_at":"2020-07-07T07:38:12Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/7475","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/7475/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/7475/comments","events_url":"https://api.github.com/repos/redis/redis/issues/7475/events","html_url":"https://github.com/redis/redis/issues/7475","id":651939025,"node_id":"MDU6SXNzdWU2NTE5MzkwMjU=","number":7475,"title":"Multi-key commands about lookupKeyWrite and lookupKeyRead","user":{"login":"yangbodong22011","id":13137470,"node_id":"MDQ6VXNlcjEzMTM3NDcw","avatar_url":"https://avatars.githubusercontent.com/u/13137470?v=4","gravatar_id":"","url":"https://api.github.com/users/yangbodong22011","html_url":"https://github.com/yangbodong22011","followers_url":"https://api.github.com/users/yangbodong22011/followers","following_url":"https://api.github.com/users/yangbodong22011/following{/other_user}","gists_url":"https://api.github.com/users/yangbodong22011/gists{/gist_id}","starred_url":"https://api.github.com/users/yangbodong22011/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yangbodong22011/subscriptions","organizations_url":"https://api.github.com/users/yangbodong22011/orgs","repos_url":"https://api.github.com/users/yangbodong22011/repos","events_url":"https://api.github.com/users/yangbodong22011/events{/privacy}","received_events_url":"https://api.github.com/users/yangbodong22011/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2215201938,"node_id":"MDU6TGFiZWwyMjE1MjAxOTM4","url":"https://api.github.com/repos/redis/redis/labels/state:needs-design","name":"state:needs-design","color":"10c9c9","default":false,"description":"the solution is not obvious and some effort should be made to design it"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/redis/redis/milestones/10","html_url":"https://github.com/redis/redis/milestone/10","labels_url":"https://api.github.com/repos/redis/redis/milestones/10/labels","id":5683881,"node_id":"MDk6TWlsZXN0b25lNTY4Mzg4MQ==","number":10,"title":"Next minor backlog","description":"","creator":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":37,"closed_issues":46,"state":"open","created_at":"2020-07-21T07:39:22Z","updated_at":"2025-10-28T08:50:19Z","due_on":null,"closed_at":null},"comments":7,"created_at":"2020-07-07T02:19:28Z","updated_at":"2021-11-28T09:26:29Z","closed_at":"2021-11-28T09:26:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-11-10T01:47:26Z","pushed_at":"2025-11-09T07:49:54Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":204997,"stargazers_count":71629,"watchers_count":71629,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24316,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2706,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24316,"open_issues":2706,"watchers":71629,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hi,\r\nIn Redis, when we operate the key, we need `lookupKeyWrite` or `lookupKeyRead`, but under the multi-key command, this flag is not strict.\r\n\r\nE.g:\r\n\r\n```\r\nvoid sunionDiffGenericCommand(client *c, robj **setkeys, int setnum,\r\n                              robj *dstkey, int op) {\r\n    ...\r\n\r\n    for (j = 0; j < setnum; j++) {\r\n        robj *setobj = dstkey ?\r\n            lookupKeyWrite(c->db,setkeys[j]) :\r\n            lookupKeyRead(c->db,setkeys[j]);\r\n        ...\r\n    }\r\n}\r\n```\r\nAccording to whether dstkey exists, use lookupKeyWrite or lookupKeyRead respectively, but should only use lookupKeyRead?\r\n\r\n```\r\nvoid zunionInterGenericCommand(client *c, robj *dstkey, int op) {\r\n    ...\r\n    /* read keys to be used for input */\r\n    src = zcalloc(sizeof(zsetopsrc) * setnum);\r\n    for (i = 0, j = 3; i < setnum; i++, j++) {\r\n        robj *obj = lookupKeyWrite(c->db,c->argv[j]);\r\n        \r\n        ...\r\n    }\r\n}\r\n```\r\nSimilarly, should lookupKeyRead also be used here?\r\n\r\nIf the judgment is based on the read and write attributes of the command itself, should georadius be modified to lookupKeyWrite?\r\n\r\n```\r\n{\"georadius\",georadiusCommand,-6,\r\n     \"write @geo\",\r\n     0,georadiusGetKeys,1,1,1,0,0,0},\r\n```\r\n\r\n```\r\nvoid georadiusGeneric(client *c, int flags) {\r\n    /* Look up the requested zset */\r\n    robj *zobj = NULL;\r\n    if ((zobj = lookupKeyReadOrReply(c, key, shared.emptyarray)) == NULL ||  // command is \"write @geo\"\r\n        checkType(c, zobj, OBJ_ZSET)) {\r\n        return;\r\n    }\r\n}\r\n```\r\n\r\nI think it should be decided according to the specific operation of this key, so the above should be changed to `lookupKeyRead`.","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/7475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/7475/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/redis/redis/issues/comments/654723973","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-654723973","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":654723973,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDcyMzk3Mw==","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-07T09:28:04Z","updated_at":"2020-07-07T09:28:04Z","body":"I now realize that the problem that's causing INCR and SUNIONSTORE to misbehave is actually not due to calling lookupKeyWrite or lookupKeyRead, it's actually the check for `CMD_READONLY` in lookupKeyRead.\r\ni think we may want to remove that check for CMD_READONLY, and then replicate that logic to lookupKeyWrite, or unify these to one function, so that write commands are also unable to use the expired data.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/654723973/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3575857398,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDM1NzU4NTczOTg=","url":"https://api.github.com/repos/redis/redis/issues/events/3575857398","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2020-07-22T13:46:38Z","milestone":{"title":"Redis 6.2"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/725424232","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-725424232","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":725424232,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNTQyNDIzMg==","user":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-11T13:31:04Z","updated_at":"2020-11-11T13:31:04Z","body":"It seems that the issue is with the definition of writing replica.\r\nAccording to the code, a writing replica can modify a key but does not \r\nlazy expire keys which are logically already expired when it accesses them.\r\nWhen we access a key for reading, and the key is logically expired it\r\nwill return with an indication that the key does not exist only if it is a read-only command.\r\nIn the case of write commands, it will retrieve the key from the DB dict.\r\n\r\nWe cannot just do the same as with read-only commands, because if\r\nwe will return NULL, the next call to `dbAdd` will hit the assertion\r\nbecause the key already exists (`INCR` command for example).\r\n\r\nWe have several options:\r\n1. writing replica would be able to lazy expire keys when accessing them.\r\n2. read-only commands would return data of already logically expired keys\r\n   so there will be symmetry between read and write commands.\r\n\r\nI think that option 1 is more suitable because it reflects the state as it is in the master. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/725424232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/725486347","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-725486347","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":725486347,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNTQ4NjM0Nw==","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-11T15:26:08Z","updated_at":"2020-11-11T15:26:08Z","body":"@valentinogeron in 1) do you mean that writing replica will lazy expire keys only when running a write command, right?\r\ni think i'm ok with such a change. either way since it's a writable replica doing a write command can cause inconsistency of data between the master and replica.\r\n\r\np.s. SUNION goes to great lengths to use lookupKeyWrite in the STORE mode, and use lookupKeyRead in the non-STORE mode.\r\nmaybe that's a mistake?\r\nmaybe when reading from a key (without the intent to modify it), it must use lookupKeyRead.\r\nor, after some refactoring planned in https://github.com/redis/redis/issues/7475, the return indication of the existence of a logically expired key should be the purpose of the lookup and not in what context it was performed.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/725486347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3984353765,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzk4NDM1Mzc2NQ==","url":"https://api.github.com/repos/redis/redis/issues/events/3984353765","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-11T15:26:08Z","performed_via_github_app":null},{"id":3984353769,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5ODQzNTM3Njk=","url":"https://api.github.com/repos/redis/redis/issues/events/3984353769","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-11T15:26:08Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/725659815","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-725659815","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":725659815,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNTY1OTgxNQ==","user":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-11T21:02:41Z","updated_at":"2020-11-11T21:02:41Z","body":"@oranagra - I agree with `when reading from a key (without the intent to modify it), it must use lookupKeyRead`.\r\nAnd regarding the issue, so do we want to go with the first option?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/725659815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3985643151,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzk4NTY0MzE1MQ==","url":"https://api.github.com/repos/redis/redis/issues/events/3985643151","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-11T21:02:42Z","performed_via_github_app":null},{"id":3985643155,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5ODU2NDMxNTU=","url":"https://api.github.com/repos/redis/redis/issues/events/3985643155","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-11T21:02:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/729652042","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-729652042","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":729652042,"node_id":"MDEyOklzc3VlQ29tbWVudDcyOTY1MjA0Mg==","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-18T12:41:31Z","updated_at":"2020-11-18T12:41:31Z","body":"i'm gonna move it to \"Next major backlog\" milestone.\r\ni think this requires a big refactoring effort and we're not entirely sure what are the consequences for the changes we'll make and what are the reasons the code behaves as it is today.\r\nso these changes are too dangerous to make now so close to an RC, and also if we'll want to change a behavior, doing it in a major version is better.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/729652042/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4010465261,"node_id":"MDE3OkRlbWlsZXN0b25lZEV2ZW50NDAxMDQ2NTI2MQ==","url":"https://api.github.com/repos/redis/redis/issues/events/4010465261","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"demilestoned","commit_id":null,"commit_url":null,"created_at":"2020-11-18T12:41:37Z","milestone":{"title":"Next minor backlog"},"performed_via_github_app":null},{"id":4010465265,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDQwMTA0NjUyNjU=","url":"https://api.github.com/repos/redis/redis/issues/events/4010465265","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2020-11-18T12:41:37Z","milestone":{"title":"Next major backlog"},"performed_via_github_app":null},{"actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T06:48:19Z","updated_at":"2021-02-02T06:48:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/8436","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/8436/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/8436/comments","events_url":"https://api.github.com/repos/redis/redis/issues/8436/events","html_url":"https://github.com/redis/redis/pull/8436","id":798882519,"node_id":"MDExOlB1bGxSZXF1ZXN0NTY1NjIxMTYw","number":8436,"title":"XINFO should use lookupKeyReadOrReply","user":{"login":"soloestoy","id":24804835,"node_id":"MDQ6VXNlcjI0ODA0ODM1","avatar_url":"https://avatars.githubusercontent.com/u/24804835?v=4","gravatar_id":"","url":"https://api.github.com/users/soloestoy","html_url":"https://github.com/soloestoy","followers_url":"https://api.github.com/users/soloestoy/followers","following_url":"https://api.github.com/users/soloestoy/following{/other_user}","gists_url":"https://api.github.com/users/soloestoy/gists{/gist_id}","starred_url":"https://api.github.com/users/soloestoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soloestoy/subscriptions","organizations_url":"https://api.github.com/users/soloestoy/orgs","repos_url":"https://api.github.com/users/soloestoy/repos","events_url":"https://api.github.com/users/soloestoy/events{/privacy}","received_events_url":"https://api.github.com/users/soloestoy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2219859425,"node_id":"MDU6TGFiZWwyMjE5ODU5NDI1","url":"https://api.github.com/repos/redis/redis/labels/release-notes","name":"release-notes","color":"b60205","default":false,"description":"indication that this issue needs to be mentioned in the release notes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-02-02T03:03:58Z","updated_at":"2021-02-21T14:12:58Z","closed_at":"2021-02-02T08:51:20Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-11-10T01:47:26Z","pushed_at":"2025-11-09T07:49:54Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":204997,"stargazers_count":71629,"watchers_count":71629,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24316,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2706,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24316,"open_issues":2706,"watchers":71629,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/redis/redis/pulls/8436","html_url":"https://github.com/redis/redis/pull/8436","diff_url":"https://github.com/redis/redis/pull/8436.diff","patch_url":"https://github.com/redis/redis/pull/8436.patch","merged_at":"2021-02-02T08:51:20Z"},"body":"now we support client pause write, in case of read command read stale data during write pausing.\r\n\r\nCOPY is a write command, but the source key is just read.","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/8436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/8436/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/redis/redis/issues/comments/927350508","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-927350508","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":927350508,"node_id":"IC_kwDOAAJhcs43Rj7s","user":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-26T18:36:37Z","updated_at":"2021-09-26T18:36:37Z","body":"I like idea 1 of @valentinogeron. I think the change is very simple:\r\n\r\n```diff\r\n int expireIfNeeded(redisDb *db, robj *key) {\r\n     if (!keyIsExpired(db,key)) return 0;\r\n \r\n     /* If we are running in the context of a slave, instead of\r\n      * evicting the expired key from the database, we return ASAP:\r\n      * the slave key expiration is controlled by the master that will\r\n      * send us synthesized DEL operations for expired keys.\r\n      *\r\n      * Still we try to return the right information to the caller,\r\n      * that is, 0 if we think the key should be still valid, 1 if\r\n      * we think the key is expired at this time. */\r\n-    if (server.masterhost != NULL) return 1;\r\n+    if (server.masterhost != NULL && server.repl_slave_ro) return 1;\r\n```\r\n\r\nThen, the rest will work as expected. I can fix this as part of #9547. If you like this solution, put a :+1:; else please comment.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/927350508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5361683813,"node_id":"MEE_lADOAAJhcs4hbWEgzwAAAAE_lM1l","url":"https://api.github.com/repos/redis/redis/issues/events/5361683813","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-26T18:36:37Z","performed_via_github_app":null},{"id":5361683816,"node_id":"SE_lADOAAJhcs4hbWEgzwAAAAE_lM1o","url":"https://api.github.com/repos/redis/redis/issues/events/5361683816","actor":{"login":"valentinogeron","id":38318576,"node_id":"MDQ6VXNlcjM4MzE4NTc2","avatar_url":"https://avatars.githubusercontent.com/u/38318576?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinogeron","html_url":"https://github.com/valentinogeron","followers_url":"https://api.github.com/users/valentinogeron/followers","following_url":"https://api.github.com/users/valentinogeron/following{/other_user}","gists_url":"https://api.github.com/users/valentinogeron/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinogeron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinogeron/subscriptions","organizations_url":"https://api.github.com/users/valentinogeron/orgs","repos_url":"https://api.github.com/users/valentinogeron/repos","events_url":"https://api.github.com/users/valentinogeron/events{/privacy}","received_events_url":"https://api.github.com/users/valentinogeron/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-26T18:36:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/927354520","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-927354520","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":927354520,"node_id":"IC_kwDOAAJhcs43Rk6Y","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-26T19:05:27Z","updated_at":"2021-09-26T19:05:27Z","body":"I'm OK with suggestion 1 (only in write commands). \r\nI.e. When a replica executes a read command on an expired key we keep it and return nil, but when it looks for it for a write command we behave the same as a master does and delete it on the spot. \r\n\r\nThis of course also means that a later command that's propagated from the master can seriously misbehave (either fail, or generate a different result than it did on the  master), but that's anyway the case of writable replicas. \r\n\r\nTo be honest, I never really understood the use case for writable replicas, and always preferred to ignore the implications of my changes on these since they're messed up anyway. But maybe we need to first learn better about the use cases before we make a decision. \r\n\r\n@itamarhaber do you happen to know, or can direct us to someone who  does?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/927354520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5361717141,"node_id":"MEE_lADOAAJhcs4hbWEgzwAAAAE_lU-V","url":"https://api.github.com/repos/redis/redis/issues/events/5361717141","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-26T19:05:27Z","performed_via_github_app":null},{"id":5361717143,"node_id":"SE_lADOAAJhcs4hbWEgzwAAAAE_lU-X","url":"https://api.github.com/repos/redis/redis/issues/events/5361717143","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-26T19:05:27Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/927366259","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-927366259","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":927366259,"node_id":"IC_kwDOAAJhcs43Rnxz","user":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-26T20:36:19Z","updated_at":"2021-09-26T20:36:19Z","body":"@oranagra Why only for writes? As you say, just one write would make it inconsistent with the primary and then it doesn't matter if the reads touch the expire or not, does it?\r\n\r\nOne scenario is that the replica is unintentionally writable (misconfigured), but is not used for writes anyway. I guess we wouldn't want to break this case.\r\n\r\nRegarding misbehaviour towards sub-replicas, I'd say we're safe if we make sure that writes propagated from the primary are propagated to sub-replicas even if they're deleted or changed on the writable replica. If we fulfil this, I can't see how it matters if the replica keeps expired keys or not.\r\n\r\nThere is a use case described under https://redis.io/topics/replication#read-only-replica:\r\n\r\n> You may wonder why it is possible to revert the read-only setting and have replica instances that can be targeted by write operations. While those writes will be discarded if the replica and the master resynchronize or if the replica is restarted, there are a few legitimate use case for storing ephemeral data in writable replicas.\r\n>\r\n> For example computing slow Set or Sorted set operations and storing them into local keys is an use case for writable replicas that was observed multiple times.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/927366259/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5361820140,"node_id":"MEE_lADOAAJhcs4hbWEgzwAAAAE_luHs","url":"https://api.github.com/repos/redis/redis/issues/events/5361820140","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-26T20:36:19Z","performed_via_github_app":null},{"id":5361820142,"node_id":"SE_lADOAAJhcs4hbWEgzwAAAAE_luHu","url":"https://api.github.com/repos/redis/redis/issues/events/5361820142","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-26T20:36:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/927562110","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-927562110","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":927562110,"node_id":"IC_kwDOAAJhcs43SXl-","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-27T06:11:30Z","updated_at":"2021-09-27T06:11:30Z","body":"> @oranagra Why only for writes? As you say, just one write would make it inconsistent with the primary and then it doesn't matter if the reads touch the expire or not, does it?\r\n\r\nI wanted to only mess up keys that are involved in write operations, and leave others (e.g. ones used by GET) consistent with the master.\r\n\r\n> Regarding misbehaviour towards sub-replicas, I'd say we're safe if we make sure that writes propagated from the primary are propagated to sub-replicas even if they're deleted or changed on the writable replica. If we fulfil this, I can't see how it matters if the replica keeps expired keys or not.\r\n\r\nthat's the way it's handled already, so we're good. but also, i'm not sure we care about a case where someone mixes both writable replicas and chained ones together.\r\n\r\n> For example computing slow Set or Sorted set operations and storing them into local keys is an use case for writable replicas that was observed multiple times.\r\n\r\nOk, good, now i understand it. @itamarhaber gave me another example yesterday:\r\nWhen someone needed an SINTERCARD and till now had to use SINTERSTORE, then SCARD and delete the key.\r\nOr the till recently missing ZINTER (user had to use ZINTERSTORE).\r\n\r\n**So bottom line, writable replica is used to write temporary keys (possibly using Lua), and then delete them.**\r\n\r\nIn that light, we don't even wanna have the writable replica mess up the keys it reads from (e.g. the source keys for ZINTERSTORE), just the ones it modifies.\r\n\r\nThis makes it even odder that Pieter [explicitly](https://github.com/redis/redis/issues/7475#issuecomment-654623795) accessed the source keys in SUNIONSTORE with lookupKeyWrite, which enabled it to read from expired keys.\r\n\r\nIdeally i would have wanted to create a new lookupKey that takes s purpose enum (READ / WRITE / MODIFY), and completely replace all the calls to these functions. i would have wanted that if we apply some old PR or merge this change to some fork, the use of the old functions would error. but there are far too many usages of these functions and the vast majority of them are ok and need no change (both for read and for write commands, e.g. HGET and HSET).\r\n\r\nso instead I suggest we only fix the multi-key commands, the ones that read from one key and write to another.\r\nI do think all the logic should be in lookupKey (taking some flags), and the various wrappers to it are used to pass the correct flags.\r\n\r\nwe can handle it as part of #9547, or as a preceding PR so that each has a clear purpose.\r\neither way, i'd very much like to sort out that mess for the next version.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/927562110/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5363140295,"node_id":"MEE_lADOAAJhcs4hbWEgzwAAAAE_qwbH","url":"https://api.github.com/repos/redis/redis/issues/events/5363140295","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-27T06:11:30Z","performed_via_github_app":null},{"id":5363140297,"node_id":"SE_lADOAAJhcs4hbWEgzwAAAAE_qwbJ","url":"https://api.github.com/repos/redis/redis/issues/events/5363140297","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-27T06:11:30Z","performed_via_github_app":null},{"id":5363140301,"node_id":"MEE_lADOAAJhcs4hbWEgzwAAAAE_qwbN","url":"https://api.github.com/repos/redis/redis/issues/events/5363140301","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-27T06:11:31Z","performed_via_github_app":null},{"id":5363140304,"node_id":"SE_lADOAAJhcs4hbWEgzwAAAAE_qwbQ","url":"https://api.github.com/repos/redis/redis/issues/events/5363140304","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-27T06:11:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/927864891","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-927864891","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":927864891,"node_id":"IC_kwDOAAJhcs43Thg7","user":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-27T13:16:11Z","updated_at":"2021-09-27T13:16:11Z","body":"Why is it so important to stay consistent with the master regarding the expired keys? Deleting logically expired keys is a form of garbage collection. These keys should never be visible to any user anyway. I think the replicas can just delete them when they're found. It makes the logic much simpler.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/927864891/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/928929491","html_url":"https://github.com/redis/redis/issues/6842#issuecomment-928929491","issue_url":"https://api.github.com/repos/redis/redis/issues/6842","id":928929491,"node_id":"IC_kwDOAAJhcs43XlbT","user":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-28T07:28:06Z","updated_at":"2021-09-28T07:28:06Z","body":"OK, so if we do it only for writes, the condition for returning 1 in expireIfNeeded without deleting the expired key needs to be the same as the condition in lookupKeyReadWithFlags which compensates for this, right? This is the condition in lookupKeyReadWithFlags:\r\n\r\n        if (server.current_client &&\r\n            server.current_client != server.master &&\r\n            server.current_client->cmd &&\r\n            server.current_client->cmd->flags & CMD_READONLY) return 1;\r\n\r\n... or we could do a negated check for CMD_WRITE instead, but it should be the same in both places. Does this make sense?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/928929491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zuiderkwast","id":273886,"node_id":"MDQ6VXNlcjI3Mzg4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/273886?v=4","gravatar_id":"","url":"https://api.github.com/users/zuiderkwast","html_url":"https://github.com/zuiderkwast","followers_url":"https://api.github.com/users/zuiderkwast/followers","following_url":"https://api.github.com/users/zuiderkwast/following{/other_user}","gists_url":"https://api.github.com/users/zuiderkwast/gists{/gist_id}","starred_url":"https://api.github.com/users/zuiderkwast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zuiderkwast/subscriptions","organizations_url":"https://api.github.com/users/zuiderkwast/orgs","repos_url":"https://api.github.com/users/zuiderkwast/repos","events_url":"https://api.github.com/users/zuiderkwast/events{/privacy}","received_events_url":"https://api.github.com/users/zuiderkwast/received_events","type":"User","user_view_type":"public","site_admin":false}}]