{"url":"https://api.github.com/repos/redis/redis/issues/8786","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/8786/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/8786/comments","events_url":"https://api.github.com/repos/redis/redis/issues/8786/events","html_url":"https://github.com/redis/redis/issues/8786","id":858034196,"node_id":"MDU6SXNzdWU4NTgwMzQxOTY=","number":8786,"title":"[BUG] Handling of known Sentinel Instances","user":{"login":"mbutlerw","id":17419288,"node_id":"MDQ6VXNlcjE3NDE5Mjg4","avatar_url":"https://avatars.githubusercontent.com/u/17419288?v=4","gravatar_id":"","url":"https://api.github.com/users/mbutlerw","html_url":"https://github.com/mbutlerw","followers_url":"https://api.github.com/users/mbutlerw/followers","following_url":"https://api.github.com/users/mbutlerw/following{/other_user}","gists_url":"https://api.github.com/users/mbutlerw/gists{/gist_id}","starred_url":"https://api.github.com/users/mbutlerw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbutlerw/subscriptions","organizations_url":"https://api.github.com/users/mbutlerw/orgs","repos_url":"https://api.github.com/users/mbutlerw/repos","events_url":"https://api.github.com/users/mbutlerw/events{/privacy}","received_events_url":"https://api.github.com/users/mbutlerw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"hwware","id":51993843,"node_id":"MDQ6VXNlcjUxOTkzODQz","avatar_url":"https://avatars.githubusercontent.com/u/51993843?v=4","gravatar_id":"","url":"https://api.github.com/users/hwware","html_url":"https://github.com/hwware","followers_url":"https://api.github.com/users/hwware/followers","following_url":"https://api.github.com/users/hwware/following{/other_user}","gists_url":"https://api.github.com/users/hwware/gists{/gist_id}","starred_url":"https://api.github.com/users/hwware/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hwware/subscriptions","organizations_url":"https://api.github.com/users/hwware/orgs","repos_url":"https://api.github.com/users/hwware/repos","events_url":"https://api.github.com/users/hwware/events{/privacy}","received_events_url":"https://api.github.com/users/hwware/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"hwware","id":51993843,"node_id":"MDQ6VXNlcjUxOTkzODQz","avatar_url":"https://avatars.githubusercontent.com/u/51993843?v=4","gravatar_id":"","url":"https://api.github.com/users/hwware","html_url":"https://github.com/hwware","followers_url":"https://api.github.com/users/hwware/followers","following_url":"https://api.github.com/users/hwware/following{/other_user}","gists_url":"https://api.github.com/users/hwware/gists{/gist_id}","starred_url":"https://api.github.com/users/hwware/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hwware/subscriptions","organizations_url":"https://api.github.com/users/hwware/orgs","repos_url":"https://api.github.com/users/hwware/repos","events_url":"https://api.github.com/users/hwware/events{/privacy}","received_events_url":"https://api.github.com/users/hwware/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2021-04-14T15:53:21Z","updated_at":"2021-07-29T09:32:52Z","closed_at":"2021-07-29T09:32:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi there,\r\n\r\nI was hoping for some clarification around how sentinel handles known sentinel instances. (Version 6.2.1)\r\n\r\nThe documentation for sentinel (https://redis.io/topics/sentinel#sentinels-and-replicas-auto-discovery) states the following.\r\n\r\n> Before adding a new sentinel to a master a Sentinel always checks if there is already a sentinel with the same runid or the same address (ip and port pair). In that case all the matching sentinels are removed, and the new added.\r\n\r\nI have a deployment setup wherein I overwrite the sentinel.conf and therefore a new runid is created. The documentation would lead me to believe that the new sentinel (due to having the same ip/port) would replace the old in the other sentinels config.\r\n\r\nHowever I was noticing that my sentinel count via `INFO SENTINEL` (from the view of the other sentinel) was 1 greater than expected and if I called `SENTINEL SENTINEL my-leader` I would see an entry for both the new and old run id.\r\n\r\nFollowing the +sentinel-invalid-addr in the logs, I came across this bit of source code and commit (https://github.com/redis/redis/commit/751b5666fbbe5c415f6fad64e7f59e24721996be) which states that if the port/ip of sentinel matches an existing one the old ones port is set to 0 (meaning its invalid).\r\n\r\nIts not entirely clear to me what the state of this old sentinel (identified by a run id) is, for example is it considered/counted in the total number of sentinels when trying to decide if you have a majority for failover.\r\n\r\nEither way there would seem to be a bug/inconsistency around how the documentation states new sentinels with matching addresses are handled and how they are actually handled (they do not replace the old entry).\r\n\r\nApologies for not following the standard format for bugs, I had originally intended to send this to the google group, but decided there might be a bug, or at least a lack of clarity in the documentation. Happy to move this to the google group if I'm mistaken in my belief. \r\n\r\nI can also try to provide a minimal example if that's helpful, although I hope my description is enough to reproduce.\r\n\r\nThanks,\r\n\r\nMatt","closed_by":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/8786/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/8786/timeline","performed_via_github_app":null,"state_reason":"completed"}