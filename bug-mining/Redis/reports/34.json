{"url":"https://api.github.com/repos/redis/redis/issues/7254","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/7254/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/7254/comments","events_url":"https://api.github.com/repos/redis/redis/issues/7254/events","html_url":"https://github.com/redis/redis/issues/7254","id":618415385,"node_id":"MDU6SXNzdWU2MTg0MTUzODU=","number":7254,"title":"make && make install compiles redis twice","user":{"login":"dgilman","id":398254,"node_id":"MDQ6VXNlcjM5ODI1NA==","avatar_url":"https://avatars.githubusercontent.com/u/398254?v=4","gravatar_id":"","url":"https://api.github.com/users/dgilman","html_url":"https://github.com/dgilman","followers_url":"https://api.github.com/users/dgilman/followers","following_url":"https://api.github.com/users/dgilman/following{/other_user}","gists_url":"https://api.github.com/users/dgilman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgilman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgilman/subscriptions","organizations_url":"https://api.github.com/users/dgilman/orgs","repos_url":"https://api.github.com/users/dgilman/repos","events_url":"https://api.github.com/users/dgilman/events{/privacy}","received_events_url":"https://api.github.com/users/dgilman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-05-14T17:35:20Z","updated_at":"2020-09-01T07:02:15Z","closed_at":"2020-09-01T07:02:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"There are two issues I've found with the makefile that is breaking `make && make install` on a fresh redis tarball.\r\n\r\nFirst, there is the Makefile.dep file. The file is getting created as expected but the following `persist-settings` target has a dependency on `distclean` which has a dependency on `clean` which deletes the file.  This means that any two invocations of `make all` will rebuild everything as you're creating a new Makefile.dep each run, dirtying the entire process.\r\n\r\nSecond, the `deps/Makefile` target for jemalloc calls `./configure`.  This means that any build that uses jemalloc gets a new `deps/jemalloc/Makefile` each time, dirtying the entire jemalloc build. This dirties all of the redis objects that depend on jemalloc.\r\n\r\nNote that this is going to mess with people trying to package redis with the new `BUILD_TLS` option in redis 6. If you ran make like `make BUILD_TLS=yes && make install` (which is what everyone is basically going to be doing) you are rebuilding redis *without* TLS the second time because it's triggering a rebuild and BUILD_TLS is not set.","closed_by":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/7254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/7254/timeline","performed_via_github_app":null,"state_reason":"completed"}