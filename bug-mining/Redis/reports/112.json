{"url":"https://api.github.com/repos/redis/redis/issues/14257","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/14257/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/14257/comments","events_url":"https://api.github.com/repos/redis/redis/issues/14257/events","html_url":"https://github.com/redis/redis/issues/14257","id":3293172258,"node_id":"I_kwDOAAJhcs7ESdIi","number":14257,"title":"[BUG] Negative lag when ENTRIESREAD specified externally","user":{"login":"mehmettokgoz","id":56408993,"node_id":"MDQ6VXNlcjU2NDA4OTkz","avatar_url":"https://avatars.githubusercontent.com/u/56408993?v=4","gravatar_id":"","url":"https://api.github.com/users/mehmettokgoz","html_url":"https://github.com/mehmettokgoz","followers_url":"https://api.github.com/users/mehmettokgoz/followers","following_url":"https://api.github.com/users/mehmettokgoz/following{/other_user}","gists_url":"https://api.github.com/users/mehmettokgoz/gists{/gist_id}","starred_url":"https://api.github.com/users/mehmettokgoz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehmettokgoz/subscriptions","organizations_url":"https://api.github.com/users/mehmettokgoz/orgs","repos_url":"https://api.github.com/users/mehmettokgoz/repos","events_url":"https://api.github.com/users/mehmettokgoz/events{/privacy}","received_events_url":"https://api.github.com/users/mehmettokgoz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-08-05T13:40:30Z","updated_at":"2025-09-01T00:36:39Z","closed_at":"2025-09-01T00:36:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\n\nThe `XGROUP CREATE` command's `ENTRIESREAD` parameter has two issues: \n1) It allows setting `entries_read` values higher than the stream's `entries_added`, resulting in impossible negative lag values, and \n2) The documentation incorrectly describes the parameter as accepting a stream ID for automatic calculation, when it actually accepts a direct numeric value with no calculation performed.\n\n\n[From Redis docs:](https://arc.net/l/quote/mrpssdrr)\n\n> To enable consumer group lag tracking, specify the optional entries_read named argument with an arbitrary ID. An arbitrary ID is any ID that isn't the ID of the stream's first entry, last entry, or zero (\"0-0\") ID. Use it to find out how many entries are between the arbitrary ID (excluding it) and the stream's last entry. Set the entries_read the stream's entries_added subtracted by the number of entries.\n\n**To reproduce**\n```\n127.0.0.1:6379> XADD mystream * field1 value1\n\"1754398908470-0\"\n127.0.0.1:6379> XGROUP CREATE mystream mygroup $ ENTRIESREAD 100\nOK\n127.0.0.1:6379> XINFO GROUPS mystream\n1)  1) \"name\"\n    2) \"mygroup\"\n    3) \"consumers\"\n    4) (integer) 0\n    5) \"pending\"\n    6) (integer) 0\n    7) \"last-delivered-id\"\n    8) \"1754398908470-0\"\n    9) \"entries-read\"\n   2) (integer) 100\n   3) \"lag\"\n   4) (integer) -99\n```\n**Expected behavior**\n\n```\n7) \"lag\"\n8) (integer) 0  # or -1, or error during creation\n```\n\nThe lag does not recover from this state, as far as I can see.\n\n**Additional information**\n\nThis also affects XGROUP SETID command which accepts the same ENTRIESREAD parameter.\n\nI'm curious whether this was the expected behavior and whether you expect valid values from the user, or should such requests be rejected or report invalid lag?","closed_by":{"login":"sundb","id":965798,"node_id":"MDQ6VXNlcjk2NTc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/965798?v=4","gravatar_id":"","url":"https://api.github.com/users/sundb","html_url":"https://github.com/sundb","followers_url":"https://api.github.com/users/sundb/followers","following_url":"https://api.github.com/users/sundb/following{/other_user}","gists_url":"https://api.github.com/users/sundb/gists{/gist_id}","starred_url":"https://api.github.com/users/sundb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sundb/subscriptions","organizations_url":"https://api.github.com/users/sundb/orgs","repos_url":"https://api.github.com/users/sundb/repos","events_url":"https://api.github.com/users/sundb/events{/privacy}","received_events_url":"https://api.github.com/users/sundb/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/14257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/14257/timeline","performed_via_github_app":null,"state_reason":"completed"}