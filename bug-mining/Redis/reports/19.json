{"url":"https://api.github.com/repos/redis/redis/issues/5326","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/5326/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/5326/comments","events_url":"https://api.github.com/repos/redis/redis/issues/5326/events","html_url":"https://github.com/redis/redis/issues/5326","id":357194784,"node_id":"MDU6SXNzdWUzNTcxOTQ3ODQ=","number":5326,"title":"Module API rdb loading limitations","user":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-09-05T11:57:09Z","updated_at":"2019-09-26T09:52:43Z","closed_at":"2019-09-26T09:52:43Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The module API does not support graceful recovery when RDB loading fails, and instead produces an error message and aborts Redis.  This will lead to unexpected process termination, e.g. in the future when diskless slaves drop a replication connection while reading the RDB (due to network issue, slave buffer exhausted on master, etc.)\r\n\r\nIdeally the Module API `RedisModule_Load*()` functions should return an error and let the module deal with it.  The module will be bound to free all resources allocated so far and propagate the error back.\r\n\r\nA possible backward compatible mechanism can look similar to this:\r\n\r\n1. Module indicates that the deserialization code can gracefully handle errors:\r\n   ```RedisModule_SetIOFlags(io, REDISMODULE_HANDLE_IO_ERRORS)```\r\n2. The return code of `RedisModule_Load*()` functions becomes undefined on IO errors.  As soon as an IO error occurs the ModuleIO context has an error flag set, the current IO function returns and any subsequent IO function becomes a no-op.\r\n3. The module can call ```RedisModule_IsIOError(io)``` at any time to check if an error has occurred.  If it does it should be responsible to free any resources claimed, undo any global state changes and return NULL to indicate it failed (failing the entire RDB loading).\r\n","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/5326/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/5326/timeline","performed_via_github_app":null,"state_reason":"completed"}