[{"url":"https://api.github.com/repos/redis/redis/issues/comments/825042604","html_url":"https://github.com/redis/redis/issues/8737#issuecomment-825042604","issue_url":"https://api.github.com/repos/redis/redis/issues/8737","id":825042604,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTA0MjYwNA==","user":{"login":"justinrush","id":24659243,"node_id":"MDQ6VXNlcjI0NjU5MjQz","avatar_url":"https://avatars.githubusercontent.com/u/24659243?v=4","gravatar_id":"","url":"https://api.github.com/users/justinrush","html_url":"https://github.com/justinrush","followers_url":"https://api.github.com/users/justinrush/followers","following_url":"https://api.github.com/users/justinrush/following{/other_user}","gists_url":"https://api.github.com/users/justinrush/gists{/gist_id}","starred_url":"https://api.github.com/users/justinrush/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinrush/subscriptions","organizations_url":"https://api.github.com/users/justinrush/orgs","repos_url":"https://api.github.com/users/justinrush/repos","events_url":"https://api.github.com/users/justinrush/events{/privacy}","received_events_url":"https://api.github.com/users/justinrush/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T17:23:00Z","updated_at":"2021-04-22T17:23:00Z","body":"I also have a need for this functionality with the use case being creating a k8s HPA that watches the queue depth and spins out or removes the # of pods acting as consumers on a queue.\r\n\r\nIt seems like the only way to implement this right now is to use xinfo group to get the last delivered id and then range over (last_delivered_id and + just to get a count. If the data is slim, like \"name=bob\", not a big deal. If the data is like 64k binary blobs... that feels super expensive.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/825042604/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinrush","id":24659243,"node_id":"MDQ6VXNlcjI0NjU5MjQz","avatar_url":"https://avatars.githubusercontent.com/u/24659243?v=4","gravatar_id":"","url":"https://api.github.com/users/justinrush","html_url":"https://github.com/justinrush","followers_url":"https://api.github.com/users/justinrush/followers","following_url":"https://api.github.com/users/justinrush/following{/other_user}","gists_url":"https://api.github.com/users/justinrush/gists{/gist_id}","starred_url":"https://api.github.com/users/justinrush/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinrush/subscriptions","organizations_url":"https://api.github.com/users/justinrush/orgs","repos_url":"https://api.github.com/users/justinrush/repos","events_url":"https://api.github.com/users/justinrush/events{/privacy}","received_events_url":"https://api.github.com/users/justinrush/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/826073742","html_url":"https://github.com/redis/redis/issues/8737#issuecomment-826073742","issue_url":"https://api.github.com/repos/redis/redis/issues/8737","id":826073742,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjA3Mzc0Mg==","user":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-24T10:48:17Z","updated_at":"2021-04-24T10:48:17Z","body":"Hi @deepaksood619 \r\n\r\nRight now streams do not support partial length queries as the internal data structure can't provide that with reasonable time complexity. We hope we'll be able to extend the internals with Redis 7 to include this capability (cc @guybe).\r\n\r\nAs an alternative is to index the stream with a sorted set. Consider the following Lua script as a replacement to calling `XADD`:\r\n\r\n```lua\r\n-- Perform an XADD and add the (0-padded) ID to a lexicographical sorted set.\r\nlocal stream, index = KEYS[1], KEYS[2]\r\nlocal id = redis.call(\"XADD\", stream, unpack(ARGV))\r\nlocal sep = id:find(\"-\")\r\nlocal ts, sq = id:sub(1,sep-1), id:sub(sep+1)\r\nlocal maxlen = 20  -- 2^64-1 string form\r\nlocal pad = \"0\"\r\nlocal el = pad:rep(maxlen-#ts) .. ts .. \"-\" .. pad:rep(maxlen-#sq) .. sq\r\nredis.call(\"ZADD\",index,0,el)\r\nreturn id\r\n```\r\n\r\nAnd this script to \"count\" the entries from a given ID to the stream's end:\r\n\r\n```lua\r\n-- Return the number of stream entries from a given ID from a zset index\r\nlocal index = KEYS[1]\r\nlocal id = ARGV[1]\r\nlocal sep = id:find(\"-\")\r\nlocal ts, sq = id:sub(1,sep-1), id:sub(sep+1)\r\nlocal maxlen = 20  -- 2^64-1 string form\r\nlocal pad = \"0\"\r\nlocal el = pad:rep(maxlen-#ts) .. ts .. \"-\" .. pad:rep(maxlen-#sq) .. sq\r\nlocal card = redis.call(\"ZCARD\",index)\r\nlocal rank = redis.call(\"ZRANK\",index,el)\r\nreturn card-(rank+1)\r\n```\r\n\r\nExample run:\r\n\r\n```txt\r\n❯ redis-cli --eval xaddindex.lua stream zset , \"*\" foo bar\r\n\"1619260831304-0\"\r\n❯ redis-cli --eval xaddindex.lua stream zset , \"*\" foo bar\r\n\"1619260837652-0\"\r\n❯ redis-cli --eval xaddindex.lua stream zset , \"*\" foo bar\r\n\"1619260841484-0\"\r\n❯ redis-cli --eval xlenindex.lua zset , \"1619260831304-0\"\r\n(integer) 2\r\n❯ redis-cli --eval xlenindex.lua zset , \"1619260837652-0\"\r\n(integer) 1\r\n❯ redis-cli --eval xlenindex.lua zset , \"1619260841484-0\"\r\n(integer) 0\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/826073742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4639820495,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzOTgyMDQ5NQ==","url":"https://api.github.com/repos/redis/redis/issues/events/4639820495","actor":{"login":"guybe","id":6429049,"node_id":"MDQ6VXNlcjY0MjkwNDk=","avatar_url":"https://avatars.githubusercontent.com/u/6429049?v=4","gravatar_id":"","url":"https://api.github.com/users/guybe","html_url":"https://github.com/guybe","followers_url":"https://api.github.com/users/guybe/followers","following_url":"https://api.github.com/users/guybe/following{/other_user}","gists_url":"https://api.github.com/users/guybe/gists{/gist_id}","starred_url":"https://api.github.com/users/guybe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guybe/subscriptions","organizations_url":"https://api.github.com/users/guybe/orgs","repos_url":"https://api.github.com/users/guybe/repos","events_url":"https://api.github.com/users/guybe/events{/privacy}","received_events_url":"https://api.github.com/users/guybe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-24T10:48:17Z","performed_via_github_app":null},{"id":4639820496,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2Mzk4MjA0OTY=","url":"https://api.github.com/repos/redis/redis/issues/events/4639820496","actor":{"login":"guybe","id":6429049,"node_id":"MDQ6VXNlcjY0MjkwNDk=","avatar_url":"https://avatars.githubusercontent.com/u/6429049?v=4","gravatar_id":"","url":"https://api.github.com/users/guybe","html_url":"https://github.com/guybe","followers_url":"https://api.github.com/users/guybe/followers","following_url":"https://api.github.com/users/guybe/following{/other_user}","gists_url":"https://api.github.com/users/guybe/gists{/gist_id}","starred_url":"https://api.github.com/users/guybe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guybe/subscriptions","organizations_url":"https://api.github.com/users/guybe/orgs","repos_url":"https://api.github.com/users/guybe/repos","events_url":"https://api.github.com/users/guybe/events{/privacy}","received_events_url":"https://api.github.com/users/guybe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-24T10:48:17Z","performed_via_github_app":null},{"id":4639820499,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzOTgyMDQ5OQ==","url":"https://api.github.com/repos/redis/redis/issues/events/4639820499","actor":{"login":"deepaksood619","id":13206612,"node_id":"MDQ6VXNlcjEzMjA2NjEy","avatar_url":"https://avatars.githubusercontent.com/u/13206612?v=4","gravatar_id":"","url":"https://api.github.com/users/deepaksood619","html_url":"https://github.com/deepaksood619","followers_url":"https://api.github.com/users/deepaksood619/followers","following_url":"https://api.github.com/users/deepaksood619/following{/other_user}","gists_url":"https://api.github.com/users/deepaksood619/gists{/gist_id}","starred_url":"https://api.github.com/users/deepaksood619/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepaksood619/subscriptions","organizations_url":"https://api.github.com/users/deepaksood619/orgs","repos_url":"https://api.github.com/users/deepaksood619/repos","events_url":"https://api.github.com/users/deepaksood619/events{/privacy}","received_events_url":"https://api.github.com/users/deepaksood619/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-24T10:48:17Z","performed_via_github_app":null},{"id":4639820500,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2Mzk4MjA1MDA=","url":"https://api.github.com/repos/redis/redis/issues/events/4639820500","actor":{"login":"deepaksood619","id":13206612,"node_id":"MDQ6VXNlcjEzMjA2NjEy","avatar_url":"https://avatars.githubusercontent.com/u/13206612?v=4","gravatar_id":"","url":"https://api.github.com/users/deepaksood619","html_url":"https://github.com/deepaksood619","followers_url":"https://api.github.com/users/deepaksood619/followers","following_url":"https://api.github.com/users/deepaksood619/following{/other_user}","gists_url":"https://api.github.com/users/deepaksood619/gists{/gist_id}","starred_url":"https://api.github.com/users/deepaksood619/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepaksood619/subscriptions","organizations_url":"https://api.github.com/users/deepaksood619/orgs","repos_url":"https://api.github.com/users/deepaksood619/repos","events_url":"https://api.github.com/users/deepaksood619/events{/privacy}","received_events_url":"https://api.github.com/users/deepaksood619/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-24T10:48:17Z","performed_via_github_app":null},{"actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-22T10:03:14Z","updated_at":"2021-06-22T10:03:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/9127","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/9127/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/9127/comments","events_url":"https://api.github.com/repos/redis/redis/issues/9127/events","html_url":"https://github.com/redis/redis/pull/9127","id":927058442,"node_id":"MDExOlB1bGxSZXF1ZXN0Njc1MjcwNjk2","number":9127,"title":"Add stream consumer group lag tracking and reporting","user":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2215208801,"node_id":"MDU6TGFiZWwyMjE1MjA4ODAx","url":"https://api.github.com/repos/redis/redis/labels/state:major-decision","name":"state:major-decision","color":"44f221","default":false,"description":"Requires core team consensus"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/redis/redis/milestones/10","html_url":"https://github.com/redis/redis/milestone/10","labels_url":"https://api.github.com/repos/redis/redis/milestones/10/labels","id":5683881,"node_id":"MDk6TWlsZXN0b25lNTY4Mzg4MQ==","number":10,"title":"Next minor backlog","description":"","creator":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":37,"closed_issues":46,"state":"open","created_at":"2020-07-21T07:39:22Z","updated_at":"2025-10-28T08:50:19Z","due_on":null,"closed_at":null},"comments":12,"created_at":"2021-06-22T10:03:14Z","updated_at":"2023-12-28T09:13:07Z","closed_at":"2022-02-23T20:34:58Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-11-10T01:47:26Z","pushed_at":"2025-11-09T07:49:54Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":204997,"stargazers_count":71629,"watchers_count":71629,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24316,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2706,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24316,"open_issues":2706,"watchers":71629,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/redis/redis/pulls/9127","html_url":"https://github.com/redis/redis/pull/9127","diff_url":"https://github.com/redis/redis/pull/9127.diff","patch_url":"https://github.com/redis/redis/pull/9127.patch","merged_at":"2022-02-23T20:34:58Z"},"body":"Adds the ability to track the lag of a consumer group (CG), that is, the number of entries yet-to-be-delivered from the stream.\r\n\r\nThe proposed constant-time solution is in the spirit of \"best-effort.\"\r\n\r\nPartially addresses #8737.\r\n\r\n## Description of approach\r\n\r\nWe add a new \"entries_added\" property to the stream. This starts at 0 for a new stream and is incremented by 1 with every `XADD`.  It is essentially an all-time counter of the entries added to the stream.\r\n\r\nGiven the stream's length and this counter value, we can trivially find the logical \"entries_added\" counter of the first ID if and only if the stream is contiguous. A fragmented stream contains one or more tombstones generated by `XDEL`s. The new \"xdel_max_id\" stream property tracks the latest tombstone.\r\n\r\nThe CG also tracks its last delivered ID's as an \"entries_read\" counter and increments it independently when delivering new messages, unless the this read counter is invalid (-1 means invalid offset). When the CG's counter is available, the reported lag is the difference between added and read counters.\r\n\r\nLastly, this also adds a \"first_id\" field to the stream structure in order to make looking it up cheaper in most cases.\r\n\r\n## Limitations\r\n\r\nThere are two cases in which the mechanism isn't able to track the lag. In these cases, `XINFO` replies with `null` in the \"lag\" field.\r\n\r\nThe first case is when a CG is created with an arbitrary last delivered ID, that isn't \"0-0\", nor the first or the last entries of the stream. In this case, it is impossible to obtain a valid read counter (short of an O(N) operation). The second case is when there are one or more tombstones fragmenting the stream's entries range.\r\n\r\nIn both cases, given enough time and assuming that the consumers are active (reading and lacking) and advancing, the CG should be able to catch up with the tip of the stream and report zero lag. Once that's achieved, lag tracking would resume as normal (until the next tombstone is set).\r\n\r\n## API changes\r\n\r\n* `XGROUP CREATE` added with the optional named argument `[ENTRIESREAD entries-read]` for explicitly specifying the new CG's counter.\r\n* `XGROUP SETID` added with an optional positional argument `[ENTRIESREAD entries-read]`for specifying the CG's counter.\r\n* `XINFO` reports the maximal tombstone ID, the recorded first entry ID, and total number of entries added to the stream.\r\n* `XINFO` reports the current lag and logical read counter of CGs.\r\n* `XSETID` is an internal command that's used in replication/aof. It has been added with the optional positional arguments `[ENTRIESADDED entries-added] [MAXDELETEDID max-deleted-entry-id]` for propagating the CG's offset and maximal tombstone ID of the stream.\r\n\r\n## The generic unsolved problem\r\n\r\nThe current stream implementation doesn't provide an efficient way to obtain the approximate/exact size of a range of entries. While it could've been nice to have that ability (#5813) in general, let alone specifically in the context of CGs, the risk and complexities involved in such implementation are in all likelihood prohibitive.\r\n\r\n## A refactoring note\r\n\r\nThe `streamGetEdgeID` has been refactored to accommodate both the existing seek of any entry as well as seeking non-deleted entries (the addition of the `skip_tombstones` argument). Furthermore, this refactoring also migrated the seek logic to use the `streamIterator` (rather than `raxIterator`) that was, in turn, extended with the `skip_tombstones` Boolean struct field to control the emission of these.\r\n\r\n## TODO\r\n\r\n- [ ] (reserved for future use)\r\n- [x] Rationalize about `uint64_t` overflow WRT `offset++`\r\n- [x] Rationalize about `uint64_t` to `long long` (replies) castings\r\n- [ ] Consider adding scan-like `XGROUP CREATE|SETID .... [COMPUTE-OFFSET cursor]` for arbitrary IDs at the cost of O(N)\r\n- [ ] Consider adding an `XGROUPLAG <key> [group ...]` command for reduced verbosity compared to `XINFO STREAM ... FULL` and `XINFO GROUPS`\r\n- [x] Handle RDB persistence\r\n- [x] Test migration from older persistence (rdb_ver < 10)\r\n- [x] See if the Module API needs attention: none at this point.\r\n- More tests:\r\n  - [ ] (reserved for future use)\r\n  - [x] The 'first_id' stream field isn't exposed so it isn't covered by tests - fixed.\r\n  - [x] AOF rewrite\r\n  - [x] `XGROUP SETID` extended form\r\n- [x] Documentation: https://github.com/redis/redis-doc/pull/1694","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/9127/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/9127/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":6127818868,"node_id":"REFE_lADOAAJhcs4ylMwbzwAAAAFtPxh0","url":"https://api.github.com/repos/redis/redis/issues/events/6127818868","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c81c7f51c38de6dff5ffc55b5184061b84c7ea5f","commit_url":"https://api.github.com/repos/redis/redis/commits/c81c7f51c38de6dff5ffc55b5184061b84c7ea5f","created_at":"2022-02-23T20:35:16Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/2364428636","html_url":"https://github.com/redis/redis/issues/8737#issuecomment-2364428636","issue_url":"https://api.github.com/repos/redis/redis/issues/8737","id":2364428636,"node_id":"IC_kwDOAAJhcs6M7lFc","user":{"login":"nantiferov","id":75987872,"node_id":"MDQ6VXNlcjc1OTg3ODcy","avatar_url":"https://avatars.githubusercontent.com/u/75987872?v=4","gravatar_id":"","url":"https://api.github.com/users/nantiferov","html_url":"https://github.com/nantiferov","followers_url":"https://api.github.com/users/nantiferov/followers","following_url":"https://api.github.com/users/nantiferov/following{/other_user}","gists_url":"https://api.github.com/users/nantiferov/gists{/gist_id}","starred_url":"https://api.github.com/users/nantiferov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nantiferov/subscriptions","organizations_url":"https://api.github.com/users/nantiferov/orgs","repos_url":"https://api.github.com/users/nantiferov/repos","events_url":"https://api.github.com/users/nantiferov/events{/privacy}","received_events_url":"https://api.github.com/users/nantiferov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-20T19:22:02Z","updated_at":"2024-09-20T19:22:02Z","body":"It seems this been released in Redis v7.0, I guess issue could be closed?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/2364428636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nantiferov","id":75987872,"node_id":"MDQ6VXNlcjc1OTg3ODcy","avatar_url":"https://avatars.githubusercontent.com/u/75987872?v=4","gravatar_id":"","url":"https://api.github.com/users/nantiferov","html_url":"https://github.com/nantiferov","followers_url":"https://api.github.com/users/nantiferov/followers","following_url":"https://api.github.com/users/nantiferov/following{/other_user}","gists_url":"https://api.github.com/users/nantiferov/gists{/gist_id}","starred_url":"https://api.github.com/users/nantiferov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nantiferov/subscriptions","organizations_url":"https://api.github.com/users/nantiferov/orgs","repos_url":"https://api.github.com/users/nantiferov/repos","events_url":"https://api.github.com/users/nantiferov/events{/privacy}","received_events_url":"https://api.github.com/users/nantiferov/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14351590522,"node_id":"CE_lADOAAJhcs4ylMwbzwAAAANXa-R6","url":"https://api.github.com/repos/redis/redis/issues/events/14351590522","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2024-09-22T06:43:31Z","state_reason":null,"performed_via_github_app":null}]