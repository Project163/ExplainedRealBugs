{"url":"https://api.github.com/repos/redis/redis/issues/8561","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/8561/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/8561/comments","events_url":"https://api.github.com/repos/redis/redis/issues/8561/events","html_url":"https://github.com/redis/redis/issues/8561","id":816528535,"node_id":"MDU6SXNzdWU4MTY1Mjg1MzU=","number":8561,"title":"[BUG] command line redis-cli --scan incorrectly returns binary keys","user":{"login":"farico","id":273184,"node_id":"MDQ6VXNlcjI3MzE4NA==","avatar_url":"https://avatars.githubusercontent.com/u/273184?v=4","gravatar_id":"","url":"https://api.github.com/users/farico","html_url":"https://github.com/farico","followers_url":"https://api.github.com/users/farico/followers","following_url":"https://api.github.com/users/farico/following{/other_user}","gists_url":"https://api.github.com/users/farico/gists{/gist_id}","starred_url":"https://api.github.com/users/farico/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farico/subscriptions","organizations_url":"https://api.github.com/users/farico/orgs","repos_url":"https://api.github.com/users/farico/repos","events_url":"https://api.github.com/users/farico/events{/privacy}","received_events_url":"https://api.github.com/users/farico/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-02-25T15:12:47Z","updated_at":"2021-03-04T13:03:49Z","closed_at":"2021-03-04T13:03:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nredis-cli --scan does not work correctly with binary keys:\r\n- binary data is not returned to terminal\r\n- scan operation yields no matches when MATCH pattern contains binary data\r\n\r\n**To reproduce**\r\nSet binary key\r\n```\r\n127.0.0.1:6379> set \"cp\\x00\\x01\\x15\\xc5\\x00\\x01\\x15\\xc5b64068ae-3d87-4d9a-b928-847adf4e22bf\" \"\\x00\\x02\"\r\nOK\r\n```\r\n\r\ncommand line scan with binary pattern yields no results\r\n```\r\n~ $ redis-cli --scan --pattern \"cp\\x00*\"\r\n~ $\r\n```\r\n\r\ncommand line scan without binary pattern (does not return binary part of the key)\r\n```\r\n~ $ redis-cli --scan --pattern \"cp*\"\r\ncp\r\n~ $\r\n```\r\n\r\n**Expected behavior**\r\n\r\nExpected to set key and retrieve in command line scan\r\n```\r\n127.0.0.1:6379> set \"cp\\x00\\x01\\x15\\xc5\\x00\\x01\\x15\\xc5b64068ae-3d87-4d9a-b928-847adf4e22bf\" \"\\x00\\x02\"\r\nOK\r\n```\r\n\r\ncommand line scan by with binary pattern\r\n```\r\n~ $ redis-cli --scan --pattern \"cp\\x00*\"\r\ncp\\x00\\x01\\x15\\xc5\\x00\\x01\\x15\\xc5b64068ae-3d87-4d9a-b928-847adf4e22bf\r\n~ $\r\n```\r\n\r\ncommand line scan without binary pattern \r\n```\r\n~ $ redis-cli --scan --pattern \"cp*\"\r\ncp\\x00\\x01\\x15\\xc5\\x00\\x01\\x15\\xc5b64068ae-3d87-4d9a-b928-847adf4e22bf\r\n~ $\r\n```\r\n\r\n**Additional information**\r\nrunning scan from the client works as expected:\r\n```\r\n127.0.0.1:6379> scan 0 match cp* count 10000\r\n1) \"0\"\r\n2) 1) \"cp\\x00\\x01\\x15\\xc5\\x00\\x01\\x15\\xc5b64068ae-3d87-4d9a-b928-847adf4e22bf\"\r\n```\r\n","closed_by":{"login":"yossigo","id":1481195,"node_id":"MDQ6VXNlcjE0ODExOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1481195?v=4","gravatar_id":"","url":"https://api.github.com/users/yossigo","html_url":"https://github.com/yossigo","followers_url":"https://api.github.com/users/yossigo/followers","following_url":"https://api.github.com/users/yossigo/following{/other_user}","gists_url":"https://api.github.com/users/yossigo/gists{/gist_id}","starred_url":"https://api.github.com/users/yossigo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yossigo/subscriptions","organizations_url":"https://api.github.com/users/yossigo/orgs","repos_url":"https://api.github.com/users/yossigo/repos","events_url":"https://api.github.com/users/yossigo/events{/privacy}","received_events_url":"https://api.github.com/users/yossigo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/8561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/8561/timeline","performed_via_github_app":null,"state_reason":"completed"}