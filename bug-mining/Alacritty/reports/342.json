{"url":"https://api.github.com/repos/alacritty/alacritty/issues/1485","repository_url":"https://api.github.com/repos/alacritty/alacritty","labels_url":"https://api.github.com/repos/alacritty/alacritty/issues/1485/labels{/name}","comments_url":"https://api.github.com/repos/alacritty/alacritty/issues/1485/comments","events_url":"https://api.github.com/repos/alacritty/alacritty/issues/1485/events","html_url":"https://github.com/alacritty/alacritty/issues/1485","id":346291738,"node_id":"MDU6SXNzdWUzNDYyOTE3Mzg=","number":1485,"title":"bring 24-bit (aka truecolor) support up to date","user":{"login":"dnkl","id":14031526,"node_id":"MDQ6VXNlcjE0MDMxNTI2","avatar_url":"https://avatars.githubusercontent.com/u/14031526?v=4","gravatar_id":"","url":"https://api.github.com/users/dnkl","html_url":"https://github.com/dnkl","followers_url":"https://api.github.com/users/dnkl/followers","following_url":"https://api.github.com/users/dnkl/following{/other_user}","gists_url":"https://api.github.com/users/dnkl/gists{/gist_id}","starred_url":"https://api.github.com/users/dnkl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnkl/subscriptions","organizations_url":"https://api.github.com/users/dnkl/orgs","repos_url":"https://api.github.com/users/dnkl/repos","events_url":"https://api.github.com/users/dnkl/events{/privacy}","received_events_url":"https://api.github.com/users/dnkl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":327960157,"node_id":"MDU6TGFiZWwzMjc5NjAxNTc=","url":"https://api.github.com/repos/alacritty/alacritty/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":750311104,"node_id":"MDU6TGFiZWw3NTAzMTExMDQ=","url":"https://api.github.com/repos/alacritty/alacritty/labels/B%20-%20missing%20feature","name":"B - missing feature","color":"c6071e","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2018-07-31T17:44:47Z","updated_at":"2020-08-07T22:37:25Z","closed_at":"2020-08-07T22:37:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Alacritty implements 24-bit colors through a semicolon-separated escape sequence (38;2;...). However, the preferred escape sequence is now colon-separated, with an optional color space argument prefixing the rgb arguments.\r\n\r\nThis is perhaps best described in the comment for the parse_extended_colors() function in xterm-333/charproc.c:\r\n\r\nNote that xterm actually supports *three* variants: semicolor-separated, colon-separated, and a mixed version. It's unclear to me why it supports the third variant.\r\n\r\n> Some background -\r\n> \r\n> Todd Larason provided the initial changes to support 256-colors in July 1999.\r\n> I pointed out that the description of SGR 38/48 in ECMA-48 was vague, and\r\n> was unsure if there would be some standard using those codes.  His response\r\n> was that this was documented (it turns out, in equally vague terms) in ITU\r\n> T.416\r\n> \r\n> Discussing this with Todd Larason in mid-1999, my point was that given the\r\n> high cost of obtaining ITU T.416 (ISO-8613-6), the standard was not going\r\n> to be effective (more than $100 then, more than $200 in 2012)\r\n> \r\n> We overlooked the detail about \":\" as a subparameter delimiter (documented\r\n> in 5.4.t2 in ECMA-48).  Some discussion in KDE in mid-2006 led Lars Doelle\r\n> to discuss the issue with me.  Lars' initial concern dealt with the fact\r\n> that a sequence such as\r\n>  CSI 38 ; 5 ; 1 m\r\n> violated the principle that SGR parameters could be used in any order.\r\n> Further discussion (see KDE #107487) resolved that the standard expected\r\n> that the sequence would look like\r\n>  CSI 38 ; 5 : 1 m\r\n> which still violates that principle, since the \"5:1\" parameter has to\r\n> follow the \"38\" to be useful.\r\n> \r\n> This function accepts either format (per request by Paul Leonerd Evans).\r\n> It also accepts\r\n>  CSI 38 : 5 : 1 m\r\n> according to Lars' original assumption.  While implementing that, I added\r\n> support for Konsole's interpretation of \"CSI 38 : 2\" as a 24-bit RGB value.\r\n> ISO-8613-6 documents that as \"direct color\".\r\n> \r\n> At the time in 2012, no one noticed (or commented) regarding ISO-8613-6's\r\n> quirk in the description of direct color:  it mentions a color space\r\n> identifier parameter which should follow the \"2\" (as parameter 1).  In the\r\n> same section, ISO-8613-6 mentions a parameter 6 which can be ignored, as\r\n> well as parameters 7 and 8.  Like parameter 1, parameters 7 and 8 are not\r\n> defined clearly in the standard, and a close reading indicates they are\r\n> optional, saying they \"may be used\".  This implementation ignores parameters\r\n> 6 (and above), and provides for the color space identifier by checking the\r\n> number of parameters:\r\n>  3 after \"2\" (no color space identifier)\r\n>  4 or more after \"2\" (color space identifier)\r\n> \r\n> By the way - all of the parameters are decimal integers, and missing\r\n> parameters represent a default value.  ISO-8613-6 is clear about that.\r\n\r\nFurthermore, as of ncurses 6.1, the correct way to tell applications that the terminal supports 24-bit colors is by setting the terminfo setaf/setab capabilities. The Tc option is, as far as I can tell, obsolete. It is not used at all in any terminfo entries in ncurses 6.1.\r\n\r\nThe terminfo database provided with ncurses 6.1 defines a couple of \"features\" related to this: *xterm+direct*, *xterm+direct2* and *xterm+indirect*.\r\n\r\n*indirect* corresponds to the escape sequence implemented by alacritty today, i.e. semicolon-separated.\r\n\r\n*direct2* corresponds to the colon-separated version *without* the color space argument, and *direct* corresponds to the colon-separated version *with* the (optional) color space argument.\r\n\r\nOne can \"use\" these features to get the correct setaf/setab capabilities.\r\n\r\nThe alacritty.info file could/should be updated to use one of these definitions. As a first step, use the indirect version, and switch to the direct one if/when the colon-separated escape sequence is implemented.\r\n\r\nFYI, I find the current alacritty.info to be a bit weird, in that it uses xterm-256color in the alacritty definition. If I set TERM to a non-256color entry, it's because _I don't want_ 256 colors...\r\n\r\nI've been using the following replacement for some time now, with success. 24-bit support works in both vim and emacs.\r\n\r\n```\r\nalacritty| alacritty,\r\n\tuse=xterm,\r\n\r\nalacritty-256color| alacritty with 256 colors,\r\n\tuse=xterm+256color, use=alacritty,\r\n\r\nalacritty-direct| alacritty with direct-color indexing,\r\n\tuse=xterm+indirect, use=alacritty,\r\n```","closed_by":{"login":"chrisduerr","id":8886672,"node_id":"MDQ6VXNlcjg4ODY2NzI=","avatar_url":"https://avatars.githubusercontent.com/u/8886672?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisduerr","html_url":"https://github.com/chrisduerr","followers_url":"https://api.github.com/users/chrisduerr/followers","following_url":"https://api.github.com/users/chrisduerr/following{/other_user}","gists_url":"https://api.github.com/users/chrisduerr/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisduerr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisduerr/subscriptions","organizations_url":"https://api.github.com/users/chrisduerr/orgs","repos_url":"https://api.github.com/users/chrisduerr/repos","events_url":"https://api.github.com/users/chrisduerr/events{/privacy}","received_events_url":"https://api.github.com/users/chrisduerr/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/alacritty/alacritty/issues/1485/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/alacritty/alacritty/issues/1485/timeline","performed_via_github_app":null,"state_reason":"completed"}