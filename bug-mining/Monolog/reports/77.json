{"url":"https://api.github.com/repos/Seldaek/monolog/issues/841","repository_url":"https://api.github.com/repos/Seldaek/monolog","labels_url":"https://api.github.com/repos/Seldaek/monolog/issues/841/labels{/name}","comments_url":"https://api.github.com/repos/Seldaek/monolog/issues/841/comments","events_url":"https://api.github.com/repos/Seldaek/monolog/issues/841/events","html_url":"https://github.com/Seldaek/monolog/issues/841","id":174079082,"node_id":"MDU6SXNzdWUxNzQwNzkwODI=","number":841,"title":"preg_split null value in SyslogUdpHandler.php","user":{"login":"pjuanda","id":2455533,"node_id":"MDQ6VXNlcjI0NTU1MzM=","avatar_url":"https://avatars.githubusercontent.com/u/2455533?v=4","gravatar_id":"","url":"https://api.github.com/users/pjuanda","html_url":"https://github.com/pjuanda","followers_url":"https://api.github.com/users/pjuanda/followers","following_url":"https://api.github.com/users/pjuanda/following{/other_user}","gists_url":"https://api.github.com/users/pjuanda/gists{/gist_id}","starred_url":"https://api.github.com/users/pjuanda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjuanda/subscriptions","organizations_url":"https://api.github.com/users/pjuanda/orgs","repos_url":"https://api.github.com/users/pjuanda/repos","events_url":"https://api.github.com/users/pjuanda/events{/privacy}","received_events_url":"https://api.github.com/users/pjuanda/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-08-30T17:34:00Z","updated_at":"2016-09-25T15:47:22Z","closed_at":"2016-09-25T15:47:22Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\n\nI have an issue when handling log with [SyslogUdpHandler.php](https://github.com/Seldaek/monolog/blob/master/src/Monolog/Handler/SyslogUdpHandler.php). In its method [splitIntoLines](https://github.com/Seldaek/monolog/blob/master/src/Monolog/Handler/SyslogUdpHandler.php#L56), it will split `$message` into 2 lines although `$message` is `NULL`.\n\n``` php\n    protected function write(array $record)\n    {\n        // var_dump($record['formatted']); result: NULL\n        $lines = $this->splitMessageIntoLines($record['formatted']);\n        // echo count($lines); result: 2\n\n        $header = $this->makeCommonSyslogHeader($this->logLevels[$record['level']]);\n\n        foreach ($lines as $line) {\n            $this->socket->write($line, $header);\n        }\n    }\n```\n\nI have checked it out, this problem is caused by [preg_split](https://github.com/Seldaek/monolog/blob/master/src/Monolog/Handler/SyslogUdpHandler.php#L62)\n\n``` php\n    private function splitMessageIntoLines($message)\n    {\n        if (is_array($message)) {\n            $message = implode(\"\\n\", $message);\n        }\n\n        return preg_split('/$\\R?^/m', $message);\n    }\n```\n\nTo solve the problem, we can pass `PREG_SPLIT_NO_EMPTY` flag as its 4<sup>th</sup> parameter\n\n``` php\n        return preg_split('/$\\R?^/m', $message, -1, PREG_SPLIT_NO_EMPTY);\n```\n\nIs this a bug ? or the `$record['formatted']` value must not `NULL` in the first place ?\n\nNote : I'm using custom Formatter that override some methods from `NormalizeFormatter`. Here is my custom formatter\n\n``` php\n<?php\n\nnamespace AppBundle\\Monolog\\Formatter;\n\nuse Exception;\nuse Monolog\\Formatter\\NormalizerFormatter;\nuse Symfony\\Component\\Debug\\Exception\\FlattenException;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\nclass IncludeStackTraceFormatter extends NormalizerFormatter\n{\n    /**\n     * {@inheritdoc}\n     */\n    public function format(array $record)\n    {\n        $exception = isset($record['context']['exception']) ? $record['context']['exception'] : null;\n\n        if ($exception && !$exception instanceof NotFoundHttpException) {\n            $additionalMessage = '';\n            $errorMessages = \"Message : \\n\". $record['message'];\n\n            if (isset($record['extra']['url'])) {\n                $additionalMessage .= \"URL : \". $record['extra']['url']. \"\\n\";\n            }\n\n            if (isset($record['extra']['ip'])) {\n                $additionalMessage .= \"IP Address : \". $record['extra']['ip']. \"\\n\";\n            }\n\n            $normalizedException = $this->normalizeException($exception);\n            $errorMessages .= $normalizedException;\n\n            return $additionalMessage. $errorMessages;\n        }\n\n        return;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    protected function normalizeException(Exception $e)\n    {\n        $stackTraces = \"\\nStack Traces :\\n\";\n        $flattenException = FlattenException::create($e);\n\n        foreach ($flattenException->getTrace() as $trace) {\n            $stackTraces .= sprintf(\" at file %s line %d \", $trace['file'], $trace['line']). \"\\n\";\n        }\n\n        return $stackTraces;\n    }\n}\n```\n","closed_by":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Seldaek/monolog/issues/841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Seldaek/monolog/issues/841/timeline","performed_via_github_app":null,"state_reason":"completed"}