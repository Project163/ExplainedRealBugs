{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1138","repository_url":"https://api.github.com/repos/Seldaek/monolog","labels_url":"https://api.github.com/repos/Seldaek/monolog/issues/1138/labels{/name}","comments_url":"https://api.github.com/repos/Seldaek/monolog/issues/1138/comments","events_url":"https://api.github.com/repos/Seldaek/monolog/issues/1138/events","html_url":"https://github.com/Seldaek/monolog/issues/1138","id":313223875,"node_id":"MDU6SXNzdWUzMTMyMjM4NzU=","number":1138,"title":"Sensitive data being exposed via __toString in NormalizerFormatter","user":{"login":"linaori","id":1754678,"node_id":"MDQ6VXNlcjE3NTQ2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1754678?v=4","gravatar_id":"","url":"https://api.github.com/users/linaori","html_url":"https://github.com/linaori","followers_url":"https://api.github.com/users/linaori/followers","following_url":"https://api.github.com/users/linaori/following{/other_user}","gists_url":"https://api.github.com/users/linaori/gists{/gist_id}","starred_url":"https://api.github.com/users/linaori/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linaori/subscriptions","organizations_url":"https://api.github.com/users/linaori/orgs","repos_url":"https://api.github.com/users/linaori/repos","events_url":"https://api.github.com/users/linaori/events{/privacy}","received_events_url":"https://api.github.com/users/linaori/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":87833823,"node_id":"MDU6TGFiZWw4NzgzMzgyMw==","url":"https://api.github.com/repos/Seldaek/monolog/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/Seldaek/monolog/milestones/5","html_url":"https://github.com/Seldaek/monolog/milestone/5","labels_url":"https://api.github.com/repos/Seldaek/monolog/milestones/5/labels","id":1854876,"node_id":"MDk6TWlsZXN0b25lMTg1NDg3Ng==","number":5,"title":"1.x","description":"","creator":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":2,"closed_issues":64,"state":"open","created_at":"2016-06-29T11:29:05Z","updated_at":"2022-07-22T11:21:04Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2018-04-11T08:34:36Z","updated_at":"2018-06-18T16:26:54Z","closed_at":"2018-06-18T15:27:45Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"There's a scenario where I have a callable, which is called via `call_user_func()`, which gets the Symfony Request object as argument. Due to this being a function call, the arguments are exposed in the stacktrace. This is something that PHP does, so we can't modify this.\r\n\r\n```php\r\n// snippet from my testcase\r\nclass TestFoo extends TestCase\r\n{\r\n    public function onSuccess(Request $request)\r\n    {\r\n        throw new \\LogicException('test');\r\n    }\r\n\r\n    public function testFormatBatch()\r\n    {\r\n        $args = [$request = Request::create('/tests', 'POST', ['passwird' => 'henk123!'])];\r\n        $f = [$this, 'onSuccess'];\r\n\r\n        $exception_callable = null;\r\n\r\n        try {\r\n            $f(...$args);\r\n        } catch (\\LogicException $e) {\r\n            $exception_callable = $e;\r\n        }\r\n\r\n        $exception_call_user_func = null;\r\n\r\n        try {\r\n            call_user_func($f, ...$args);\r\n        } catch (\\LogicException $e) {\r\n            $exception_call_user_func = $e;\r\n        }\r\n        // ... more\r\n    }\r\n}\r\n```\r\n\r\nIn this example, the only difference is the way the exception is called, but this results in a slightly different stacktrace. The stacktraces from my output in the HTML formatter:\r\n\r\n##### `call_user_func($f, ...$args)`\r\n```\r\n{\r\n    \"class\": \"LogicException\",\r\n    \"message\": \"test\",\r\n    \"code\": 0,\r\n    \"file\": \"/home/ivanderberg/projects/logging-bundle/test/Component/Logging/ContainerAwareHtmlFormatterTest.php:86\",\r\n    \"trace\": [\r\n        \"{\\\"function\\\":\\\"onSuccess\\\",\\\"class\\\":\\\"Hostnet\\\\\\\\Component\\\\\\\\Logging\\\\\\\\ContainerAwareHtmlFormatterTest\\\",\\\"type\\\":\\\"->\\\",\\\"args\\\":[\\\"[object] (Symfony\\\\\\\\Component\\\\\\\\HttpFoundation\\\\\\\\Request: POST /tests HTTP/1.1\\\\r\\\\nAccept:          text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\\\r\\\\nAccept-Charset:  ISO-8859-1,utf-8;q=0.7,*;q=0.7\\\\r\\\\nAccept-Language: en-us,en;q=0.5\\\\r\\\\nContent-Type:    application/x-www-form-urlencoded\\\\r\\\\nHost:            localhost\\\\r\\\\nUser-Agent:      Symfony\\\\r\\\\n\\\\r\\\\n)\\\"]}\",\r\n        \"/home/ivanderberg/projects/logging-bundle/test/Component/Logging/ContainerAwareHtmlFormatterTest.php:105\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:1143\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:840\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestResult.php:645\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:798\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestSuite.php:776\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestSuite.php:776\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/TestRunner.php:529\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/Command.php:198\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/Command.php:151\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/phpunit:53\"\r\n    ]\r\n}\r\n```\r\n\r\n##### `$f(...$args)`\r\n```\r\n{\r\n    \"class\": \"LogicException\",\r\n    \"message\": \"test\",\r\n    \"code\": 0,\r\n    \"file\": \"/home/ivanderberg/projects/logging-bundle/test/Component/Logging/ContainerAwareHtmlFormatterTest.php:86\",\r\n    \"trace\": [\r\n        \"/home/ivanderberg/projects/logging-bundle/test/Component/Logging/ContainerAwareHtmlFormatterTest.php:97\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:1143\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:840\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestResult.php:645\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestCase.php:798\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestSuite.php:776\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/Framework/TestSuite.php:776\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/TestRunner.php:529\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/Command.php:198\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/src/TextUI/Command.php:151\",\r\n        \"/home/ivanderberg/projects/logging-bundle/vendor/phpunit/phpunit/phpunit:53\"\r\n    ]\r\n}\r\n```\r\n\r\nAs you can see, it calls the `__toString` of the Symfony request, which outputs some information: https://github.com/symfony/http-foundation/blob/63d41b663b753dac65f6e41e9e02beff5e33dd41/Request.php#L493-L517\r\n\r\nIf the Request object contains some post information like passwords, this is now being added due to the stacktrace containing a function call argument for the Request. The code that causes this: https://github.com/Seldaek/monolog/blob/7b992836275e09ed63c63fe33ca9993e515e6c5d/src/Monolog/Formatter/NormalizerFormatter.php#L101-L121\r\n\r\nIt's debatable whether or not this is a Symfony issue or an issue in the formatter, but I'm uncomfortable with calling the `__toString` on an object that might contain sensitive data from a vendor that I cannot influence. ","closed_by":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Seldaek/monolog/issues/1138/timeline","performed_via_github_app":null,"state_reason":"completed"}