{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1927","repository_url":"https://api.github.com/repos/Seldaek/monolog","labels_url":"https://api.github.com/repos/Seldaek/monolog/issues/1927/labels{/name}","comments_url":"https://api.github.com/repos/Seldaek/monolog/issues/1927/comments","events_url":"https://api.github.com/repos/Seldaek/monolog/issues/1927/events","html_url":"https://github.com/Seldaek/monolog/issues/1927","id":2679298624,"node_id":"I_kwDOABUBmM6fstpA","number":1927,"title":"GelfHandler \"Message is invalid: additional key contains invalid characters\"","user":{"login":"ybelenko","id":5541023,"node_id":"MDQ6VXNlcjU1NDEwMjM=","avatar_url":"https://avatars.githubusercontent.com/u/5541023?v=4","gravatar_id":"","url":"https://api.github.com/users/ybelenko","html_url":"https://github.com/ybelenko","followers_url":"https://api.github.com/users/ybelenko/followers","following_url":"https://api.github.com/users/ybelenko/following{/other_user}","gists_url":"https://api.github.com/users/ybelenko/gists{/gist_id}","starred_url":"https://api.github.com/users/ybelenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ybelenko/subscriptions","organizations_url":"https://api.github.com/users/ybelenko/orgs","repos_url":"https://api.github.com/users/ybelenko/repos","events_url":"https://api.github.com/users/ybelenko/events{/privacy}","received_events_url":"https://api.github.com/users/ybelenko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":87833823,"node_id":"MDU6TGFiZWw4NzgzMzgyMw==","url":"https://api.github.com/repos/Seldaek/monolog/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/Seldaek/monolog/milestones/7","html_url":"https://github.com/Seldaek/monolog/milestone/7","labels_url":"https://api.github.com/repos/Seldaek/monolog/milestones/7/labels","id":7739999,"node_id":"MI_kwDOABUBmM4Adhpf","number":7,"title":"3.x","description":"","creator":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":10,"closed_issues":91,"state":"open","created_at":"2022-03-06T12:34:44Z","updated_at":"2025-11-04T12:15:28Z","due_on":null,"closed_at":null},"comments":2,"created_at":"2024-11-21T12:30:49Z","updated_at":"2025-02-05T08:38:03Z","closed_at":"2024-12-05T14:46:08Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Monolog version 1|2|3?\r\n```json\r\n{\r\n    \"name\": \"monolog/monolog\",\r\n    \"version\": \"3.8.0\",\r\n    \"source\": {\r\n        \"type\": \"git\",\r\n        \"url\": \"https://github.com/Seldaek/monolog.git\",\r\n        \"reference\": \"32e515fdc02cdafbe4593e30a9350d486b125b67\"\r\n    }\r\n}\r\n```\r\n\r\nWith the basic log call\r\n```php\r\n$logger->info('Hello World', ['invalid context' => 'test']);\r\n```\r\n```console\r\n[2024-11-21T12:21:39.764122+00:00] Cron.ERROR: Uncaught Exception RuntimeException: \"Message is invalid: additional key 'ctxt_invalid context' contains invalid characters\" at /Users/ybelenko/Sites/bdo_pay/vendor/graylog2/gelf-php/src/Gelf/Publisher.php line 58 {\"exception\":\"[object] (RuntimeException(code: 0): Message is invalid: additional key 'ctxt_invalid context' contains invalid characters at /Users/ybelenko/Sites/bdo_pay/vendor/graylog2/gelf-php/src/Gelf/Publisher.php:58)\"} []\r\n```\r\n\r\nI guess Monolog should prepare `$context` and `$extra` for `Publisher` and strip spaces.\r\nValdiation part in `vendor/graylog2/gelf-php/src/Gelf/MessageValidator.php`:\r\n```php\r\nforeach ($message->getAllAdditionals() as $key => $value) {\r\n    if (!preg_match('#^[\\w\\.\\-]*$#', $key)) {\r\n        $reason = sprintf(\r\n            \"additional key '%s' contains invalid characters\",\r\n            $key\r\n        );\r\n\r\n        return false;\r\n    }\r\n}\r\n```\r\n","closed_by":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1927/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Seldaek/monolog/issues/1927/timeline","performed_via_github_app":null,"state_reason":"completed"}