{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1669","repository_url":"https://api.github.com/repos/Seldaek/monolog","labels_url":"https://api.github.com/repos/Seldaek/monolog/issues/1669/labels{/name}","comments_url":"https://api.github.com/repos/Seldaek/monolog/issues/1669/comments","events_url":"https://api.github.com/repos/Seldaek/monolog/issues/1669/events","html_url":"https://github.com/Seldaek/monolog/issues/1669","id":1232852505,"node_id":"I_kwDOABUBmM5Je9YZ","number":1669,"title":"Monolog doesn't handle E_USER_ERROR as fatal error if registerErrorHandler is called with callPrevious === false","user":{"login":"WoZ","id":85790,"node_id":"MDQ6VXNlcjg1Nzkw","avatar_url":"https://avatars.githubusercontent.com/u/85790?v=4","gravatar_id":"","url":"https://api.github.com/users/WoZ","html_url":"https://github.com/WoZ","followers_url":"https://api.github.com/users/WoZ/followers","following_url":"https://api.github.com/users/WoZ/following{/other_user}","gists_url":"https://api.github.com/users/WoZ/gists{/gist_id}","starred_url":"https://api.github.com/users/WoZ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WoZ/subscriptions","organizations_url":"https://api.github.com/users/WoZ/orgs","repos_url":"https://api.github.com/users/WoZ/repos","events_url":"https://api.github.com/users/WoZ/events{/privacy}","received_events_url":"https://api.github.com/users/WoZ/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":87833823,"node_id":"MDU6TGFiZWw4NzgzMzgyMw==","url":"https://api.github.com/repos/Seldaek/monolog/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/Seldaek/monolog/milestones/6","html_url":"https://github.com/Seldaek/monolog/milestone/6","labels_url":"https://api.github.com/repos/Seldaek/monolog/milestones/6/labels","id":3833113,"node_id":"MDk6TWlsZXN0b25lMzgzMzExMw==","number":6,"title":"2.x","description":"","creator":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":5,"closed_issues":126,"state":"open","created_at":"2018-11-19T22:36:56Z","updated_at":"2025-03-20T09:28:01Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2022-05-11T15:41:24Z","updated_at":"2022-06-09T07:04:31Z","closed_at":"2022-06-09T07:04:31Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Monolog version 2.6\r\n\r\nExample:\r\n\r\n```\r\n$logger = new Monolog\\Logger('main');\r\n$logger->pushHandler(new Monolog\\Handler\\StreamHandler('php://stderr', Monolog\\Logger::DEBUG));\r\n$errorHandler = new ErrorHandler($logger);\r\n$errorHandler->registerErrorHandler([], false); // false is for callPrevious\r\n$errorHandler->registerExceptionHandler();\r\n\r\ntrigger_error('Error', E_USER_ERROR);\r\n```\r\n\r\nDescription:\r\n\r\n1. `$errorHandler->registerErrorHandler` sets `$this->previousErrorHandler` to `null`.\r\n2. `ErrorHandler::handleError()` doesn't log error, but sets trace into the `$this->lastFatalTrace`. `handleError` assumes that the  `handleFatalError()` will be called.\r\n3. `callPrevious` option prevents `ErrorHandler::handleError()` to start chaining, default PHP's error logger will not be called, `handleError` returns true. This prevents PHP from setting \"last error\" structure internally.\r\n4. `ErrorHandler::handleFatalError()` catches E_USER_ERROR and tries to receive `$lastError = error_get_last();`, but there's no last error.\r\n5. Both functions ignores error logging.\r\n\r\nScenario. I use official docker php image with error_log == 'php://stderr'. Also, I want to use Monolog with StreamHandler and write logs to stderr. Monolog logs errors twice with default settings (first time default PHP logger writes logs to stderr, second time Monolog does the same).\r\n","closed_by":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Seldaek/monolog/issues/1669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Seldaek/monolog/issues/1669/timeline","performed_via_github_app":null,"state_reason":"completed"}