{"url":"https://api.github.com/repos/Seldaek/monolog/issues/560","repository_url":"https://api.github.com/repos/Seldaek/monolog","labels_url":"https://api.github.com/repos/Seldaek/monolog/issues/560/labels{/name}","comments_url":"https://api.github.com/repos/Seldaek/monolog/issues/560/comments","events_url":"https://api.github.com/repos/Seldaek/monolog/issues/560/events","html_url":"https://github.com/Seldaek/monolog/issues/560","id":73632897,"node_id":"MDU6SXNzdWU3MzYzMjg5Nw==","number":560,"title":"Support for JsonSerializable","user":{"login":"UlrichEckhardt","id":8566055,"node_id":"MDQ6VXNlcjg1NjYwNTU=","avatar_url":"https://avatars.githubusercontent.com/u/8566055?v=4","gravatar_id":"","url":"https://api.github.com/users/UlrichEckhardt","html_url":"https://github.com/UlrichEckhardt","followers_url":"https://api.github.com/users/UlrichEckhardt/followers","following_url":"https://api.github.com/users/UlrichEckhardt/following{/other_user}","gists_url":"https://api.github.com/users/UlrichEckhardt/gists{/gist_id}","starred_url":"https://api.github.com/users/UlrichEckhardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UlrichEckhardt/subscriptions","organizations_url":"https://api.github.com/users/UlrichEckhardt/orgs","repos_url":"https://api.github.com/users/UlrichEckhardt/repos","events_url":"https://api.github.com/users/UlrichEckhardt/events{/privacy}","received_events_url":"https://api.github.com/users/UlrichEckhardt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/Seldaek/monolog/milestones/1","html_url":"https://github.com/Seldaek/monolog/milestone/1","labels_url":"https://api.github.com/repos/Seldaek/monolog/milestones/1/labels","id":338543,"node_id":"MDk6TWlsZXN0b25lMzM4NTQz","number":1,"title":"2.0","description":"BC breaks for 2.0","creator":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":78,"state":"closed","created_at":"2013-05-21T17:53:00Z","updated_at":"2019-09-05T11:31:55Z","due_on":null,"closed_at":"2019-09-05T11:31:55Z"},"comments":3,"created_at":"2015-05-06T14:09:17Z","updated_at":"2016-05-26T18:21:50Z","closed_at":"2016-05-26T18:21:50Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'd like to see support for objects that implement the JsonSerializable interface. At the moment, I have code like this:\n\n```\nclass Example implements \\JsonSerializable\n{\n    public function jsonSerialize()\n    {\n        return array('data' => 'structure');\n    }\n}\n\n$logger->info('mapped', array('bar' => new Example));\n$logger->info('array', array(new Example));\n```\n\nThe resulting output is this:\n\n```\n[2015-05-06 15:54:30] log.INFO: mapped {\"bar\":\"[object] (Example: {\\\"data\\\":\\\"structure\\\"})\"} []\n[2015-05-06 15:54:32] log.INFO: array [\"[object] (Example: {\\\"data\\\":\\\"structure\\\"})\"] []\n```\n\nThis isn't really readable due to the backslash-escaped double quotes. With a small change, you can get this output though:\n\n```\n[2015-05-06 15:56:05] log.INFO: mapped {\"bar\":{\"data\":\"structure\"}} []\n[2015-05-06 15:56:05] log.INFO: array [{\"data\":\"structure\"}] []\n```\n\nAll that you need to do is to check for the JsonSerializable interface in the normalize() function of class NormalizerFormatter (code based on 1.13.1):\n\n```\n    ....\n    if (is_object($data)) {\n        if ($data instanceof Exception) {\n            return $this->normalizeException($data);\n        }\n        if ($data instanceof \\JsonSerializable) {\n            return $this->normalize($data->jsonSerialize());\n        }\n        return sprintf(\"[object] (%s: %s)\", get_class($data), $this->toJson($data, true));\n    }\n    ...\n```\n\nI haven't tested this thoroughly, so please don't just apply that change. I just wanted to ask whether that was a worthwhile approach at all or for any other remarks.\n","closed_by":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Seldaek/monolog/issues/560/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Seldaek/monolog/issues/560/timeline","performed_via_github_app":null,"state_reason":"completed"}