[{"actor":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-07-04T17:02:45Z","updated_at":"2013-07-04T17:02:45Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/d3/d3/issues/1336","repository_url":"https://api.github.com/repos/d3/d3","labels_url":"https://api.github.com/repos/d3/d3/issues/1336/labels{/name}","comments_url":"https://api.github.com/repos/d3/d3/issues/1336/comments","events_url":"https://api.github.com/repos/d3/d3/issues/1336/events","html_url":"https://github.com/d3/d3/issues/1336","id":15880687,"node_id":"MDU6SXNzdWUxNTg4MDY4Nw==","number":1336,"title":"Transition timing could be more predictable and deterministic.","user":{"login":"scameron","id":984276,"node_id":"MDQ6VXNlcjk4NDI3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/984276?v=4","gravatar_id":"","url":"https://api.github.com/users/scameron","html_url":"https://github.com/scameron","followers_url":"https://api.github.com/users/scameron/followers","following_url":"https://api.github.com/users/scameron/following{/other_user}","gists_url":"https://api.github.com/users/scameron/gists{/gist_id}","starred_url":"https://api.github.com/users/scameron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scameron/subscriptions","organizations_url":"https://api.github.com/users/scameron/orgs","repos_url":"https://api.github.com/users/scameron/repos","events_url":"https://api.github.com/users/scameron/events{/privacy}","received_events_url":"https://api.github.com/users/scameron/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2013-06-22T06:12:35Z","updated_at":"2013-07-04T17:09:45Z","closed_at":"2013-06-23T14:49:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":943149,"node_id":"MDEwOlJlcG9zaXRvcnk5NDMxNDk=","name":"d3","full_name":"d3/d3","private":false,"owner":{"login":"d3","id":1562726,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1NjI3MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1562726?v=4","gravatar_id":"","url":"https://api.github.com/users/d3","html_url":"https://github.com/d3","followers_url":"https://api.github.com/users/d3/followers","following_url":"https://api.github.com/users/d3/following{/other_user}","gists_url":"https://api.github.com/users/d3/gists{/gist_id}","starred_url":"https://api.github.com/users/d3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d3/subscriptions","organizations_url":"https://api.github.com/users/d3/orgs","repos_url":"https://api.github.com/users/d3/repos","events_url":"https://api.github.com/users/d3/events{/privacy}","received_events_url":"https://api.github.com/users/d3/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/d3/d3","description":"Bring data to life with SVG, Canvas and HTML. :bar_chart::chart_with_upwards_trend::tada:","fork":false,"url":"https://api.github.com/repos/d3/d3","forks_url":"https://api.github.com/repos/d3/d3/forks","keys_url":"https://api.github.com/repos/d3/d3/keys{/key_id}","collaborators_url":"https://api.github.com/repos/d3/d3/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/d3/d3/teams","hooks_url":"https://api.github.com/repos/d3/d3/hooks","issue_events_url":"https://api.github.com/repos/d3/d3/issues/events{/number}","events_url":"https://api.github.com/repos/d3/d3/events","assignees_url":"https://api.github.com/repos/d3/d3/assignees{/user}","branches_url":"https://api.github.com/repos/d3/d3/branches{/branch}","tags_url":"https://api.github.com/repos/d3/d3/tags","blobs_url":"https://api.github.com/repos/d3/d3/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/d3/d3/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/d3/d3/git/refs{/sha}","trees_url":"https://api.github.com/repos/d3/d3/git/trees{/sha}","statuses_url":"https://api.github.com/repos/d3/d3/statuses/{sha}","languages_url":"https://api.github.com/repos/d3/d3/languages","stargazers_url":"https://api.github.com/repos/d3/d3/stargazers","contributors_url":"https://api.github.com/repos/d3/d3/contributors","subscribers_url":"https://api.github.com/repos/d3/d3/subscribers","subscription_url":"https://api.github.com/repos/d3/d3/subscription","commits_url":"https://api.github.com/repos/d3/d3/commits{/sha}","git_commits_url":"https://api.github.com/repos/d3/d3/git/commits{/sha}","comments_url":"https://api.github.com/repos/d3/d3/comments{/number}","issue_comment_url":"https://api.github.com/repos/d3/d3/issues/comments{/number}","contents_url":"https://api.github.com/repos/d3/d3/contents/{+path}","compare_url":"https://api.github.com/repos/d3/d3/compare/{base}...{head}","merges_url":"https://api.github.com/repos/d3/d3/merges","archive_url":"https://api.github.com/repos/d3/d3/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/d3/d3/downloads","issues_url":"https://api.github.com/repos/d3/d3/issues{/number}","pulls_url":"https://api.github.com/repos/d3/d3/pulls{/number}","milestones_url":"https://api.github.com/repos/d3/d3/milestones{/number}","notifications_url":"https://api.github.com/repos/d3/d3/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/d3/d3/labels{/name}","releases_url":"https://api.github.com/repos/d3/d3/releases{/id}","deployments_url":"https://api.github.com/repos/d3/d3/deployments","created_at":"2010-09-27T17:22:42Z","updated_at":"2025-11-09T18:23:06Z","pushed_at":"2025-07-27T11:30:40Z","git_url":"git://github.com/d3/d3.git","ssh_url":"git@github.com:d3/d3.git","clone_url":"https://github.com/d3/d3.git","svn_url":"https://github.com/d3/d3","homepage":"https://d3js.org","size":59341,"stargazers_count":111757,"watchers_count":111757,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":22847,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":25,"license":{"key":"isc","name":"ISC License","spdx_id":"ISC","url":"https://api.github.com/licenses/isc","node_id":"MDc6TGljZW5zZTEw"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["chart","charts","d3","data-visualization","svg","visualization"],"visibility":"public","forks":22847,"open_issues":25,"watchers":111757,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"There are a couple of issues I've noticed, both regarding the transition timing.\n\nThe first has to do with the fact that transition.time is set immediately in selection.transition() rather than being initialized the first time the timer fires.  As a result, code that runs after selection.transition() can cause the transition to be delayed or skipped entirely.\n\nHere's an example of what I mean:\n\n1)  New transition created with selection.transition() to run immediately with duration=500ms.  Call this timestamp=0.\n2)  Before returning control to browser, some subsequent miscellaneous code is executed.  Say this code does something performance intensive that takes 600ms.  So by the time control returns to browser, timestamp=600.\n3)  First animation frame is run shortly after this at say timestamp=610.\n4)  Transition timer determines elapsed time to be 610ms which is greater than 500ms so transition.end is fired and the interpolation jumps right to t=1.\n\nThis is obviously an extreme example but the point is that transition frame invocation is affected by code run immediately after scheduling (well before the transition even starts running).  My proposal is to initialize transition.time to the current time when the first timer is fired.  Doing this would at least let the animation run nicely even if there was a processing delay before the transition started.\n\nThe second issue has to do with transitions synchronization.  Currently, subtransitions are perfectly synchronized with one another but all other transitions will practically always be misaligned by some amount of time.  Even setting transition.time to the same value on multiple transitions doesn't solve the problem because each transition has its own timer that will be invoked sequentially relative to other timers on each animation frame.  So, depending on how expensive the interpolators are, each transition's \"elapsed\" will be different by some amount of time.\n\nUsing subtransitions everywhere is fine in simple cases but can potentially be difficult in more complex libraries that have code broken down into modules.  For example, maybe you have one module responsible for centroid position and other modules responsible for drawing different mark shapes around the centroids.  Passing around transitions between modules just to achieve synchronization can be potentially clumsy depending on the design of the library.\n\nCurrently, each transition gets its own separate timer but I'm wondering if this is actually necessary.  Since the timers rely on requestAnimationFrame to be run, they are all effectively synchronized by the animation frame scheduling.  Every timer is run at the identical theoretical \"frame\" time even though in practice it takes some time to invoke the list of callbacks.  \n\nI was wondering if it might work better to use a single shared timer for all transitions?  Instead of having the browser spin through a list of rAF callbacks with each callback calculating its own \"elapsed\", the browser would instead invoke a the single shared rAF callback so that \"elapsed\" would be calculated once and every active transition could be invoked with the same elapsed time value.\n\nCombine this with the change to have transition.time initialized when the timer first fires and the result would be that all transitions for the entire page would be perfectly synchronized with each other regardless of when or where they were scheduled!  I get goosebumps just thinking about it. :)\n","reactions":{"url":"https://api.github.com/repos/d3/d3/issues/1336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/d3/d3/issues/1336/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":55293616,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDU1MjkzNjE2","url":"https://api.github.com/repos/d3/d3/issues/events/55293616","actor":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6023d51d415afc04b6d606b0cedd20f33b08de7a","commit_url":"https://api.github.com/repos/d3/d3/commits/6023d51d415afc04b6d606b0cedd20f33b08de7a","created_at":"2013-07-04T17:14:57Z","performed_via_github_app":null},{"id":55293687,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDU1MjkzNjg3","url":"https://api.github.com/repos/d3/d3/issues/events/55293687","actor":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"14307a00ee781896ab5e0f99306957aa55e1202e","commit_url":"https://api.github.com/repos/d3/d3/commits/14307a00ee781896ab5e0f99306957aa55e1202e","created_at":"2013-07-04T17:15:42Z","performed_via_github_app":null},{"id":55448016,"node_id":"MDExOkNsb3NlZEV2ZW50NTU0NDgwMTY=","url":"https://api.github.com/repos/d3/d3/issues/events/55448016","actor":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"14307a00ee781896ab5e0f99306957aa55e1202e","commit_url":"https://api.github.com/repos/d3/d3/commits/14307a00ee781896ab5e0f99306957aa55e1202e","created_at":"2013-07-06T03:14:04Z","state_reason":null,"performed_via_github_app":null}]