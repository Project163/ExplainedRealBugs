{"url":"https://api.github.com/repos/d3/d3/issues/1536","repository_url":"https://api.github.com/repos/d3/d3","labels_url":"https://api.github.com/repos/d3/d3/issues/1536/labels{/name}","comments_url":"https://api.github.com/repos/d3/d3/issues/1536/comments","events_url":"https://api.github.com/repos/d3/d3/issues/1536/events","html_url":"https://github.com/d3/d3/issues/1536","id":19859572,"node_id":"MDU6SXNzdWUxOTg1OTU3Mg==","number":1536,"title":"Implicitly adding domain values to an ordinal scale does not trigger re-ranging, unless the scale is copied.","user":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":50044,"node_id":"MDU6TGFiZWw1MDA0NA==","url":"https://api.github.com/repos/d3/d3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn’t working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/d3/d3/milestones/28","html_url":"https://github.com/d3/d3/milestone/28","labels_url":"https://api.github.com/repos/d3/d3/milestones/28/labels","id":401944,"node_id":"MDk6TWlsZXN0b25lNDAxOTQ0","number":28,"title":"3.3.x","description":"","creator":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":71,"state":"closed","created_at":"2013-08-14T16:40:06Z","updated_at":"2015-02-06T15:46:48Z","due_on":null,"closed_at":"2014-01-10T18:32:42Z"},"comments":0,"created_at":"2013-09-21T17:04:00Z","updated_at":"2014-04-09T03:34:21Z","closed_at":"2013-09-21T18:51:12Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"An interesting side-effect of the axis inadvertently adding old tick values to the new scale’s domain (#1535) is that normally this does not trigger recomputing the range bands or range points, thus leaving the domain and the range of the ordinal scale temporarily inconsistent.\n\nHowever, if the scale is then copied via scale.copy, the range is recomputed! For example:\n\n``` js\nvar x = d3.scale.ordinal()\n    .domain([\"a\", \"b\", \"c\"])\n    .rangePoints([0, 1]);\n\nx.range(); // [0, 0.5, 1]\nx(\"d\"); // 0\nx(\"e\"); // 0.5\nx.domain(); // [\"a\", \"b\", \"c\", \"d\", \"e\"]\nx.range(); // [0, 0.5, 1]\n\nvar x2 = x.copy();\nx2.domain(); // [\"a\", \"b\", \"c\", \"d\", \"e\"]\nx2.range(); // [0, 0.25, 0.5, 0.75, 1]\n```\n\nThis behavior causes the axis to render the ticks differently than the specified scale. So, one of these fixes is necessary:\n1. Ordinal scales should recompute the range whenever the domain changes, including when a value is implicitly added.\n2. Ordinal scales should never implicitly add domain values.\n3. When an ordinal scale is copied, the range should not be recomputed, even if there are implicit domain values.\n\nThe first solution is tempting since that keeps the domain and range always consistent. And, in practice we only expect to recycle range values when using the ordinal scale as a categorical scale (such as a color palette). On the other hand, if rangeBands or rangePoints is used, then by implicitly adding values we change the behavior of the scale for earlier values; the scale is no longer internally consistent.\n\nThe second solution wouldn’t work in the case of categorical scales, obviously, since it’s a useful feature to build a color palette implicitly through the use of the scale rather than needing to precompute the domain explicitly. On the other hand, it’s never the case that you want to build the domain implicitly when using rangePoints or rangeBands, so it probably makes sense to implicitly add domain values only when a bare range (and not rangePoints or rangeBands) is in use.\n\nThe third solution would also fix the immediate problem, but still leaves the domain and range inconsistent, so the behavior of the scale would change when calling `x.domain(x.domain())`.\n\nSo I think we should start with plan 2.\n","closed_by":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/d3/d3/issues/1536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/d3/d3/issues/1536/timeline","performed_via_github_app":null,"state_reason":"completed"}