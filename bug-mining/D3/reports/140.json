{"url":"https://api.github.com/repos/d3/d3/issues/1164","repository_url":"https://api.github.com/repos/d3/d3","labels_url":"https://api.github.com/repos/d3/d3/issues/1164/labels{/name}","comments_url":"https://api.github.com/repos/d3/d3/issues/1164/comments","events_url":"https://api.github.com/repos/d3/d3/issues/1164/events","html_url":"https://github.com/d3/d3/issues/1164","id":12446825,"node_id":"MDU6SXNzdWUxMjQ0NjgyNQ==","number":1164,"title":"Mouse position is wrong when page is scrolled and default styles apply margin, padding or border to svg elements.","user":{"login":"eweitnauer","id":53043,"node_id":"MDQ6VXNlcjUzMDQz","avatar_url":"https://avatars.githubusercontent.com/u/53043?v=4","gravatar_id":"","url":"https://api.github.com/users/eweitnauer","html_url":"https://github.com/eweitnauer","followers_url":"https://api.github.com/users/eweitnauer/followers","following_url":"https://api.github.com/users/eweitnauer/following{/other_user}","gists_url":"https://api.github.com/users/eweitnauer/gists{/gist_id}","starred_url":"https://api.github.com/users/eweitnauer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eweitnauer/subscriptions","organizations_url":"https://api.github.com/users/eweitnauer/orgs","repos_url":"https://api.github.com/users/eweitnauer/repos","events_url":"https://api.github.com/users/eweitnauer/events{/privacy}","received_events_url":"https://api.github.com/users/eweitnauer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":50044,"node_id":"MDU6TGFiZWw1MDA0NA==","url":"https://api.github.com/repos/d3/d3/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isnâ€™t working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/d3/d3/milestones/25","html_url":"https://github.com/d3/d3/milestone/25","labels_url":"https://api.github.com/repos/d3/d3/milestones/25/labels","id":305932,"node_id":"MDk6TWlsZXN0b25lMzA1OTMy","number":25,"title":"3.2","description":"","creator":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":45,"state":"closed","created_at":"2013-04-08T15:17:39Z","updated_at":"2013-06-30T21:37:47Z","due_on":null,"closed_at":"2013-06-13T22:52:26Z"},"comments":1,"created_at":"2013-03-26T12:46:40Z","updated_at":"2013-05-30T21:48:17Z","closed_at":"2013-05-30T21:48:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Problem**\n\nI put an SVG element (with 1px border around it set in css file) with a rect inside on the page and draw a line where the user drags the mouse over the rect. To determine where to insert the new points in the line, I use d3.event.x and d3.event.y, which should be relative to the SVG element. On my mobile device (iPad) with current webkit browsers (Safari, Chrome), the relative positions are wrong when the page is scrolled.  \n\n**Reason**\n\nFor mouse events, `d3.event.{x,y}` should reflect the position of the mouse relative to the target element. Internally, the `d3_mousePoint(...)` method in _event/mouse.js_ is used to calculate the relative position. In this file, there is a test for the webkit bug 44083 (`getScreenCTM()` returns position relative to page, instead of relative to client view, which would be correct). The test works this way: It inserts an svg element at (0,0) into the body and then queries its `getScreenCTM()` after the page was scrolled. If the bug is present, the position should be (0,0) -- and this is what's tested for. This is where things go wrong: If the user set a padding, margin or border for svg's, the position will not be (0,0) but include the left/top margin, padding and border-width. I actually put a border of 1px around all svg's in my css file and the position of the test svg was (1,1). The `d3_mousePoint(...)` method therefore wrongly assumed the bug is not present. The reason why this only showed on the mobile device is that in the current version of desktop webkit browsers, the bug was already fixed.\n\n**Fix**\n\nSimply replace the old lines in _event/mouse_\n\n`svg = d3.select(d3_document.body).append(\"svg\")\n          .style(\"position\", \"absolute\")\n          .style(\"top\", 0)\n          .style(\"left\", 0);`\n\nwith\n\n`svg = d3.select(d3_document.body).append(\"svg\")\n          .style(\"position\", \"absolute\")\n          .style(\"top\", 0)\n          .style(\"left\", 0)\n          .style(\"margin\", 0)\n          .style(\"padding\", 0)\n          .style(\"border\", \"none\");`\n\nto prevent any padding, margin or border on the test svg element.\n","closed_by":{"login":"mbostock","id":230541,"node_id":"MDQ6VXNlcjIzMDU0MQ==","avatar_url":"https://avatars.githubusercontent.com/u/230541?v=4","gravatar_id":"","url":"https://api.github.com/users/mbostock","html_url":"https://github.com/mbostock","followers_url":"https://api.github.com/users/mbostock/followers","following_url":"https://api.github.com/users/mbostock/following{/other_user}","gists_url":"https://api.github.com/users/mbostock/gists{/gist_id}","starred_url":"https://api.github.com/users/mbostock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbostock/subscriptions","organizations_url":"https://api.github.com/users/mbostock/orgs","repos_url":"https://api.github.com/users/mbostock/repos","events_url":"https://api.github.com/users/mbostock/events{/privacy}","received_events_url":"https://api.github.com/users/mbostock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/d3/d3/issues/1164/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/d3/d3/issues/1164/timeline","performed_via_github_app":null,"state_reason":"completed"}