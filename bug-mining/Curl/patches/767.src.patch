diff --git a/lib/Makefile.am b/lib/Makefile.am
index 32dbb0754..f6ea5807d 100644
--- a/lib/Makefile.am
+++ b/lib/Makefile.am
@@ -162,7 +162,7 @@ CHECKSOURCES = checksrc
 endif
 endif
 
-all-local: $(CHECKSOURCES) $(UNITPROTOS)
+all-local: $(CHECKSOURCES)
 
 UNIT_V = $(UNITV_$(V))
 UNITV_0 = @echo "  UNITPR  " $@;
diff --git a/tests/unit/Makefile.am b/tests/unit/Makefile.am
index a83809595..32c2f3895 100644
--- a/tests/unit/Makefile.am
+++ b/tests/unit/Makefile.am
@@ -60,9 +60,12 @@ endif
 AM_CPPFLAGS += -DBUILDING_LIBCURL
 
 if BUILD_UNITTESTS
-$(BUNDLE).c: $(top_srcdir)/scripts/mk-unity.pl Makefile.inc $(FIRST_C) $(TESTS_C)
+$(BUNDLE).c: $(top_srcdir)/scripts/mk-unity.pl Makefile.inc $(FIRST_C) $(TESTS_C) $(top_builddir)/lib/unitprotos.h
 	@PERL@ $(top_srcdir)/scripts/mk-unity.pl --test $(TESTS_C) > $(BUNDLE).c
 
+$(top_builddir)/lib/unitprotos.h:
+	(cd $(top_builddir)/lib && $(MAKE) unitprotos.h)
+
 noinst_PROGRAMS = $(BUNDLE)
 LDADD = $(top_builddir)/lib/libcurlu.la
 CLEANFILES = $(BUNDLE).c
