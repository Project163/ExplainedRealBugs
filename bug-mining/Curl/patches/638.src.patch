diff --git a/CMakeLists.txt b/CMakeLists.txt
index 810dcbbc6..b2b443479 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1735,6 +1735,7 @@ check_function_exists("setmode"         HAVE_SETMODE)
 check_function_exists("setrlimit"       HAVE_SETRLIMIT)
 
 if(NOT WIN32)
+  check_function_exists("realpath"      HAVE_REALPATH)
   check_function_exists("sched_yield"   HAVE_SCHED_YIELD)
   check_symbol_exists("strcasecmp"      "string.h" HAVE_STRCASECMP)
   check_symbol_exists("stricmp"         "string.h" HAVE_STRICMP)
diff --git a/configure.ac b/configure.ac
index d492f9e94..a2879568e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -4080,7 +4080,10 @@ AC_CHECK_FUNCS([\
 ])
 
 if test "$curl_cv_native_windows" != 'yes'; then
-  AC_CHECK_FUNCS([sched_yield])
+  AC_CHECK_FUNCS([\
+  sched_yield \
+  realpath \
+  ])
   CURL_CHECK_FUNC_STRCASECMP
   CURL_CHECK_FUNC_STRCMPI
   CURL_CHECK_FUNC_STRICMP
diff --git a/lib/curl_config.h.cmake b/lib/curl_config.h.cmake
index a41af0c98..f4f3a186d 100644
--- a/lib/curl_config.h.cmake
+++ b/lib/curl_config.h.cmake
@@ -433,6 +433,9 @@
 /* If you have poll */
 #cmakedefine HAVE_POLL 1
 
+/* If you have realpath */
+#cmakedefine HAVE_REALPATH 1
+
 /* Define to 1 if you have the <poll.h> header file. */
 #cmakedefine HAVE_POLL_H 1
 
diff --git a/lib/vtls/vtls_scache.c b/lib/vtls/vtls_scache.c
index 9c04b7762..4250a6c69 100644
--- a/lib/vtls/vtls_scache.c
+++ b/lib/vtls/vtls_scache.c
@@ -359,7 +359,7 @@ static CURLcode cf_ssl_peer_key_add_path(struct dynbuf *buf,
     char abspath[_MAX_PATH];
     if(_fullpath(abspath, path, _MAX_PATH))
       return Curl_dyn_addf(buf, ":%s-%s", name, abspath);
-#else
+#elif defined(HAVE_REALPATH)
     if(path[0] != '/') {
       char *abspath = realpath(path, NULL);
       if(abspath) {
