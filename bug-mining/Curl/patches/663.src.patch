diff --git a/lib/hostip.c b/lib/hostip.c
index 99da27403..e335ca0fc 100644
--- a/lib/hostip.c
+++ b/lib/hostip.c
@@ -747,7 +747,7 @@ enum resolve_t Curl_resolv(struct Curl_easy *data,
       int st;
       Curl_set_in_callback(data, TRUE);
       st = data->set.resolver_start(
-#ifdef USE_CURL_ASYNC
+#ifdef CURLRES_ASYNCH
         data->state.async.resolver,
 #else
         NULL,
diff --git a/lib/multi.c b/lib/multi.c
index f34758070..b5bb9fd50 100644
--- a/lib/multi.c
+++ b/lib/multi.c
@@ -2087,7 +2087,7 @@ static CURLMcode state_resolving(struct Curl_multi *multi,
   dns = Curl_fetch_addr(data, hostname, conn->primary.remote_port);
 
   if(dns) {
-#ifdef CURLRES_ASYNCH
+#ifdef USE_CURL_ASYNC
     data->state.async.dns = dns;
     data->state.async.done = TRUE;
 #endif
diff --git a/lib/socks.c b/lib/socks.c
index cb198df1c..0ef6b140a 100644
--- a/lib/socks.c
+++ b/lib/socks.c
@@ -344,7 +344,7 @@ static CURLproxycode do_SOCKS4(struct Curl_cfilter *cf,
     dns = Curl_fetch_addr(data, sx->hostname, conn->primary.remote_port);
 
     if(dns) {
-#ifdef CURLRES_ASYNCH
+#ifdef USE_CURL_ASYNC
       data->state.async.dns = dns;
       data->state.async.done = TRUE;
 #endif
@@ -814,7 +814,7 @@ CONNECT_REQ_INIT:
     dns = Curl_fetch_addr(data, sx->hostname, sx->remote_port);
 
     if(dns) {
-#ifdef CURLRES_ASYNCH
+#ifdef USE_CURL_ASYNC
       data->state.async.dns = dns;
       data->state.async.done = TRUE;
 #endif
diff --git a/lib/urldata.h b/lib/urldata.h
index f22903f64..889d6029e 100644
--- a/lib/urldata.h
+++ b/lib/urldata.h
@@ -569,9 +569,9 @@ struct Curl_async {
   struct Curl_dns_entry *dns;
 #ifdef CURLRES_ASYNCH
   struct thread_data thdata;
-#endif
   void *resolver; /* resolver state, if it is used in the URL state -
                      ares_channel e.g. */
+#endif
   int port;
   BIT(done);  /* set TRUE when the lookup is complete */
 };
