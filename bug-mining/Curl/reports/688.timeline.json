[{"id":17132780568,"node_id":"AE_lADOAAiu0c6xL9a7zwAAAAP9MXwY","url":"https://api.github.com/repos/curl/curl/issues/events/17132780568","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2025-04-04T16:09:32Z","assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":17132813564,"node_id":"REFE_lADOAAiu0c6xL9a7zwAAAAP9Mfz8","url":"https://api.github.com/repos/curl/curl/issues/events/17132813564","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b111e8674d8174ffd1400caf7d90133bfa17e6df","commit_url":"https://api.github.com/repos/icing/curl/commits/b111e8674d8174ffd1400caf7d90133bfa17e6df","created_at":"2025-04-04T16:11:45Z","performed_via_github_app":null},{"actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-04T16:12:01Z","updated_at":"2025-04-04T16:12:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/curl/curl/issues/16968","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/16968/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/16968/comments","events_url":"https://api.github.com/repos/curl/curl/issues/16968/events","html_url":"https://github.com/curl/curl/pull/16968","id":2972841678,"node_id":"PR_kwDOAAiu0c6RbtJT","number":16968,"title":"https-connect, fix httpsrr target check","user":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118243,"node_id":"MDU6TGFiZWwxODQxMTgyNDM=","url":"https://api.github.com/repos/curl/curl/labels/HTTP","name":"HTTP","color":"207de5","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-04-04T16:12:00Z","updated_at":"2025-04-04T19:31:15Z","closed_at":"2025-04-04T19:31:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":569041,"node_id":"MDEwOlJlcG9zaXRvcnk1NjkwNDE=","name":"curl","full_name":"curl/curl","private":false,"owner":{"login":"curl","id":16928085,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2OTI4MDg1","avatar_url":"https://avatars.githubusercontent.com/u/16928085?v=4","gravatar_id":"","url":"https://api.github.com/users/curl","html_url":"https://github.com/curl","followers_url":"https://api.github.com/users/curl/followers","following_url":"https://api.github.com/users/curl/following{/other_user}","gists_url":"https://api.github.com/users/curl/gists{/gist_id}","starred_url":"https://api.github.com/users/curl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/curl/subscriptions","organizations_url":"https://api.github.com/users/curl/orgs","repos_url":"https://api.github.com/users/curl/repos","events_url":"https://api.github.com/users/curl/events{/privacy}","received_events_url":"https://api.github.com/users/curl/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/curl/curl","description":"A command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTMPS, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET, TFTP, WS and WSS. libcurl offers a myriad of powerful features","fork":false,"url":"https://api.github.com/repos/curl/curl","forks_url":"https://api.github.com/repos/curl/curl/forks","keys_url":"https://api.github.com/repos/curl/curl/keys{/key_id}","collaborators_url":"https://api.github.com/repos/curl/curl/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/curl/curl/teams","hooks_url":"https://api.github.com/repos/curl/curl/hooks","issue_events_url":"https://api.github.com/repos/curl/curl/issues/events{/number}","events_url":"https://api.github.com/repos/curl/curl/events","assignees_url":"https://api.github.com/repos/curl/curl/assignees{/user}","branches_url":"https://api.github.com/repos/curl/curl/branches{/branch}","tags_url":"https://api.github.com/repos/curl/curl/tags","blobs_url":"https://api.github.com/repos/curl/curl/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/curl/curl/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/curl/curl/git/refs{/sha}","trees_url":"https://api.github.com/repos/curl/curl/git/trees{/sha}","statuses_url":"https://api.github.com/repos/curl/curl/statuses/{sha}","languages_url":"https://api.github.com/repos/curl/curl/languages","stargazers_url":"https://api.github.com/repos/curl/curl/stargazers","contributors_url":"https://api.github.com/repos/curl/curl/contributors","subscribers_url":"https://api.github.com/repos/curl/curl/subscribers","subscription_url":"https://api.github.com/repos/curl/curl/subscription","commits_url":"https://api.github.com/repos/curl/curl/commits{/sha}","git_commits_url":"https://api.github.com/repos/curl/curl/git/commits{/sha}","comments_url":"https://api.github.com/repos/curl/curl/comments{/number}","issue_comment_url":"https://api.github.com/repos/curl/curl/issues/comments{/number}","contents_url":"https://api.github.com/repos/curl/curl/contents/{+path}","compare_url":"https://api.github.com/repos/curl/curl/compare/{base}...{head}","merges_url":"https://api.github.com/repos/curl/curl/merges","archive_url":"https://api.github.com/repos/curl/curl/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/curl/curl/downloads","issues_url":"https://api.github.com/repos/curl/curl/issues{/number}","pulls_url":"https://api.github.com/repos/curl/curl/pulls{/number}","milestones_url":"https://api.github.com/repos/curl/curl/milestones{/number}","notifications_url":"https://api.github.com/repos/curl/curl/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/curl/curl/labels{/name}","releases_url":"https://api.github.com/repos/curl/curl/releases{/id}","deployments_url":"https://api.github.com/repos/curl/curl/deployments","created_at":"2010-03-18T22:32:22Z","updated_at":"2025-11-10T12:40:38Z","pushed_at":"2025-11-10T12:40:38Z","git_url":"git://github.com/curl/curl.git","ssh_url":"git@github.com:curl/curl.git","clone_url":"https://github.com/curl/curl.git","svn_url":"https://github.com/curl/curl","homepage":"https://curl.se/","size":118458,"stargazers_count":39830,"watchers_count":39830,"language":"C","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":6941,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["c","client","curl","ftp","gopher","hacktoberfest","http","https","imaps","ldap","libcurl","library","mqtt","pop3","scp","sftp","transfer-data","transferring-data","user-agent","websocket"],"visibility":"public","forks":6941,"open_issues":40,"watchers":39830,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/curl/curl/pulls/16968","html_url":"https://github.com/curl/curl/pull/16968","diff_url":"https://github.com/curl/curl/pull/16968.diff","patch_url":"https://github.com/curl/curl/pull/16968.patch","merged_at":null},"body":"Stupidly, the HTTPSRR check on the record's target was not working as it used the wrong index on the NUL byte if the target was not NULL.\r\n\r\nrefs #16966","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/16968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/16968/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2779203586","html_url":"https://github.com/curl/curl/issues/16966#issuecomment-2779203586","issue_url":"https://api.github.com/repos/curl/curl/issues/16966","id":2779203586,"node_id":"IC_kwDOAAiu0c6lp0gC","user":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-04T16:12:54Z","updated_at":"2025-04-04T16:12:54Z","body":"@pkropachev, oh my. there was a silly mistake when checking the target of the httpsrr record. Fixed in #16968.\n\nWould be nice if you could verify. Thanks!","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2779203586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17132830027,"node_id":"MEE_lADOAAiu0c6xL9a7zwAAAAP9Mj1L","url":"https://api.github.com/repos/curl/curl/issues/events/17132830027","actor":{"login":"pkropachev","id":34160907,"node_id":"MDQ6VXNlcjM0MTYwOTA3","avatar_url":"https://avatars.githubusercontent.com/u/34160907?v=4","gravatar_id":"","url":"https://api.github.com/users/pkropachev","html_url":"https://github.com/pkropachev","followers_url":"https://api.github.com/users/pkropachev/followers","following_url":"https://api.github.com/users/pkropachev/following{/other_user}","gists_url":"https://api.github.com/users/pkropachev/gists{/gist_id}","starred_url":"https://api.github.com/users/pkropachev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkropachev/subscriptions","organizations_url":"https://api.github.com/users/pkropachev/orgs","repos_url":"https://api.github.com/users/pkropachev/repos","events_url":"https://api.github.com/users/pkropachev/events{/privacy}","received_events_url":"https://api.github.com/users/pkropachev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-04-04T16:12:55Z","performed_via_github_app":null},{"id":17132830043,"node_id":"SE_lADOAAiu0c6xL9a7zwAAAAP9Mj1b","url":"https://api.github.com/repos/curl/curl/issues/events/17132830043","actor":{"login":"pkropachev","id":34160907,"node_id":"MDQ6VXNlcjM0MTYwOTA3","avatar_url":"https://avatars.githubusercontent.com/u/34160907?v=4","gravatar_id":"","url":"https://api.github.com/users/pkropachev","html_url":"https://github.com/pkropachev","followers_url":"https://api.github.com/users/pkropachev/followers","following_url":"https://api.github.com/users/pkropachev/following{/other_user}","gists_url":"https://api.github.com/users/pkropachev/gists{/gist_id}","starred_url":"https://api.github.com/users/pkropachev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkropachev/subscriptions","organizations_url":"https://api.github.com/users/pkropachev/orgs","repos_url":"https://api.github.com/users/pkropachev/repos","events_url":"https://api.github.com/users/pkropachev/events{/privacy}","received_events_url":"https://api.github.com/users/pkropachev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-04-04T16:12:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2779256570","html_url":"https://github.com/curl/curl/issues/16966#issuecomment-2779256570","issue_url":"https://api.github.com/repos/curl/curl/issues/16966","id":2779256570,"node_id":"IC_kwDOAAiu0c6lqBb6","user":{"login":"pkropachev","id":34160907,"node_id":"MDQ6VXNlcjM0MTYwOTA3","avatar_url":"https://avatars.githubusercontent.com/u/34160907?v=4","gravatar_id":"","url":"https://api.github.com/users/pkropachev","html_url":"https://github.com/pkropachev","followers_url":"https://api.github.com/users/pkropachev/followers","following_url":"https://api.github.com/users/pkropachev/following{/other_user}","gists_url":"https://api.github.com/users/pkropachev/gists{/gist_id}","starred_url":"https://api.github.com/users/pkropachev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkropachev/subscriptions","organizations_url":"https://api.github.com/users/pkropachev/orgs","repos_url":"https://api.github.com/users/pkropachev/repos","events_url":"https://api.github.com/users/pkropachev/events{/privacy}","received_events_url":"https://api.github.com/users/pkropachev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-04T16:39:04Z","updated_at":"2025-04-04T16:39:04Z","body":"@icing, fix works for me! Thanks!\n\nHTTPS RR is advertised by DoH for HTTP server1.\n\n```\ndig +https @dns.testdomain.com caddy.testdomain.com -t ANY\n...\n;; ANSWER SECTION:\ncaddy.testdomain.com.\t172800\tIN\tHTTPS\t1 . alpn=\"h3,h2\"\ncaddy.testdomain.com.\t172800\tIN\tA\t192.168.222.100\n\n;; Query time: 0 msec\n;; SERVER: 192.168.222.3#443(dns.testdomain.com) (HTTPS)\n;; WHEN: Fri Apr 04 19:33:30 MSK 2025\n;; MSG SIZE  rcvd: 118\n```\n\nIn result, `curl` uses `h3` to connect to server1.\n\n```\ncurl -v --doh-insecure --doh-url https://dns.testdomain.com/dns-query https://caddy.testdomain.com -k --trace-config dns\n* [DNS] asyn-ares: fire off query for HTTPSRR\n* [DNS] Connection #1 is not open enough, cannot reuse\n* [DNS] Found pending candidate for reuse and CURLOPT_PIPEWAIT is set\n* [DNS] No connections available.\n* [DNS] Connection #1 is not open enough, cannot reuse\n* [DNS] Found pending candidate for reuse and CURLOPT_PIPEWAIT is set\n* [DNS] No connections available.\n* [DNS] Host dns.testdomain.com:443 was resolved.\n* [DNS] IPv6: (none)\n* [DNS] IPv4: 192.168.222.3\n* [DNS]   Trying 192.168.222.3:443...\n* [DNS] ALPN: curl offers h2,http/1.1\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):\n* TLSv1.3 (IN), TLS handshake, Certificate (11):\n* TLSv1.3 (IN), TLS handshake, CERT verify (15):\n* TLSv1.3 (IN), TLS handshake, Finished (20):\n* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.3 (OUT), TLS handshake, Finished (20):\n* [DNS] SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519 / RSASSA-PSS\n* [DNS] ALPN: server accepted h2\n* [DNS] Server certificate:\n...\n* [DNS]   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\n* [DNS] Connected to dns.testdomain.com (192.168.222.3) port 443\n* [DNS] using HTTP/2\n* [DNS] [HTTP/2] [1] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [1] [:method: POST]\n* [DNS] [HTTP/2] [1] [:scheme: https]\n* [DNS] [HTTP/2] [1] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [1] [:path: /dns-query]\n* [DNS] [HTTP/2] [1] [accept: */*]\n* [DNS] [HTTP/2] [1] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [1] [content-length: 38]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 38\n> \n* [DNS] upload completely sent off: 38 bytes\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* [DNS] Multiplexed connection found\n* [DNS] Re-using existing https: connection with host dns.testdomain.com\n* [DNS] [HTTP/2] [3] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [3] [:method: POST]\n* [DNS] [HTTP/2] [3] [:scheme: https]\n* [DNS] [HTTP/2] [3] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [3] [:path: /dns-query]\n* [DNS] [HTTP/2] [3] [accept: */*]\n* [DNS] [HTTP/2] [3] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [3] [content-length: 38]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 38\n> \n* [DNS] upload completely sent off: 38 bytes\n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 54\n< cache-control: max-age=172800\n< \n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 89\n< cache-control: max-age=7200\n< \n* [DNS] a DoH request is completed, 2 to go\n* [DNS] Connection #1 to host dns.testdomain.com left intact\n* [DNS] a DoH request is completed, 1 to go\n* [DNS] Re-using existing https: connection with host dns.testdomain.com\n* [DNS] [HTTP/2] [5] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [5] [:method: POST]\n* [DNS] [HTTP/2] [5] [:scheme: https]\n* [DNS] [HTTP/2] [5] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [5] [:path: /dns-query]\n* [DNS] [HTTP/2] [5] [accept: */*]\n* [DNS] [HTTP/2] [5] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [5] [content-length: 38]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 38\n> \n* [DNS] upload completely sent off: 38 bytes\n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 79\n< cache-control: max-age=172800\n< \n* [DNS] Connection #1 to host dns.testdomain.com left intact\n* [DNS] a DoH request is completed, 0 to go\n* [DNS] hostname: caddy.testdomain.com\n* [DoH] TTL: 172800 seconds\n* [DoH] A: 192.168.222.100\n* DoH HTTPS RR: length 13\n* [DNS] HTTPS RR ALPN: 32 16 0 0\n* Some HTTPS RR to process\n* Host caddy.testdomain.com:443 was resolved.\n* IPv6: (none)\n* IPv4: 192.168.222.100\n*   Trying 192.168.222.100:443...\n* Server certificate:\n...\n*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\n*   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\n* Connected to caddy.testdomain.com (192.168.222.100) port 443\n* using HTTP/3\n* [HTTP/3] [0] OPENED stream for https://caddy.testdomain.com/\n* [HTTP/3] [0] [:method: GET]\n* [HTTP/3] [0] [:scheme: https]\n* [HTTP/3] [0] [:authority: caddy.testdomain.com]\n* [HTTP/3] [0] [:path: /]\n* [HTTP/3] [0] [user-agent: curl/8.13.1-DEV]\n* [HTTP/3] [0] [accept: */*]\n> GET / HTTP/3\n> Host: caddy.testdomain.com\n> User-Agent: curl/8.13.1-DEV\n> Accept: */*\n> \n* Request completely sent off\n< HTTP/3 200 \n< date: Fri, 04 Apr 2025 16:35:09 GMT\n< content-length: 36\n< server: Caddy\n< content-type: text/plain; charset=utf-8\n< \n* Connection #0 to host caddy.testdomain.com left intact\nHello, world! you are using HTTP/3.0\n```\n\nHTTPS RR is not advertised by DoH for HTTP server2.\n\n```\ndig +https @dns.testdomain.com httpbin.testdomain.com -t ANY\n...\n;; ANSWER SECTION:\nhttpbin.testdomain.com.\t172800\tIN\tA\t192.168.222.2\n\n;; Query time: 0 msec\n;; SERVER: 192.168.222.3#443(dns.testdomain.com) (HTTPS)\n;; WHEN: Fri Apr 04 19:35:52 MSK 2025\n;; MSG SIZE  rcvd: 95\n```\n\nSo, `curl` uses `h2` by default.\n\n```\ncurl -v --doh-insecure --doh-url https://dns.testdomain.com/dns-query https://httpbin.testdomain.com/headers -k --trace-config dns\n* [DNS] asyn-ares: fire off query for HTTPSRR\n* [DNS] Connection #1 is not open enough, cannot reuse\n* [DNS] Found pending candidate for reuse and CURLOPT_PIPEWAIT is set\n* [DNS] No connections available.\n* [DNS] Connection #1 is not open enough, cannot reuse\n* [DNS] Found pending candidate for reuse and CURLOPT_PIPEWAIT is set\n* [DNS] No connections available.\n* [DNS] Host dns.testdomain.com:443 was resolved.\n* [DNS] IPv6: (none)\n* [DNS] IPv4: 192.168.222.3\n* [DNS]   Trying 192.168.222.3:443...\n* [DNS] ALPN: curl offers h2,http/1.1\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):\n* TLSv1.3 (IN), TLS handshake, Certificate (11):\n* TLSv1.3 (IN), TLS handshake, CERT verify (15):\n* TLSv1.3 (IN), TLS handshake, Finished (20):\n* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.3 (OUT), TLS handshake, Finished (20):\n* [DNS] SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519 / RSASSA-PSS\n* [DNS] ALPN: server accepted h2\n* [DNS] Server certificate:\n...\n* [DNS]   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\n* [DNS] Connected to dns.testdomain.com (192.168.222.3) port 443\n* [DNS] using HTTP/2\n* [DNS] [HTTP/2] [1] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [1] [:method: POST]\n* [DNS] [HTTP/2] [1] [:scheme: https]\n* [DNS] [HTTP/2] [1] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [1] [:path: /dns-query]\n* [DNS] [HTTP/2] [1] [accept: */*]\n* [DNS] [HTTP/2] [1] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [1] [content-length: 40]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 40\n> \n* [DNS] upload completely sent off: 40 bytes\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 56\n< cache-control: max-age=172800\n< \n* [DNS] Connection #1 to host dns.testdomain.com left intact\n* [DNS] a DoH request is completed, 2 to go\n* [DNS] Re-using existing https: connection with host dns.testdomain.com\n* [DNS] [HTTP/2] [3] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [3] [:method: POST]\n* [DNS] [HTTP/2] [3] [:scheme: https]\n* [DNS] [HTTP/2] [3] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [3] [:path: /dns-query]\n* [DNS] [HTTP/2] [3] [accept: */*]\n* [DNS] [HTTP/2] [3] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [3] [content-length: 40]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 40\n> \n* [DNS] upload completely sent off: 40 bytes\n* [DNS] Multiplexed connection found\n* [DNS] Re-using existing https: connection with host dns.testdomain.com\n* [DNS] [HTTP/2] [5] OPENED stream for https://dns.testdomain.com/dns-query\n* [DNS] [HTTP/2] [5] [:method: POST]\n* [DNS] [HTTP/2] [5] [:scheme: https]\n* [DNS] [HTTP/2] [5] [:authority: dns.testdomain.com]\n* [DNS] [HTTP/2] [5] [:path: /dns-query]\n* [DNS] [HTTP/2] [5] [accept: */*]\n* [DNS] [HTTP/2] [5] [content-type: application/dns-message]\n* [DNS] [HTTP/2] [5] [content-length: 40]\n> POST /dns-query HTTP/2\n> Host: dns.testdomain.com\n> Accept: */*\n> Content-Type: application/dns-message\n> Content-Length: 40\n> \n* [DNS] upload completely sent off: 40 bytes\n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 91\n< cache-control: max-age=7200\n< \n< HTTP/2 200 \n< content-type: application/dns-message\n< content-length: 91\n< cache-control: max-age=7200\n< \n* [DNS] a DoH request is completed, 1 to go\n* [DNS] Connection #1 to host dns.testdomain.com left intact\n* [DNS] a DoH request is completed, 0 to go\n* [DNS] hostname: httpbin.testdomain.com\n* [DoH] TTL: 172800 seconds\n* [DoH] A: 192.168.222.2\n* Host httpbin.testdomain.com:443 was resolved.\n* IPv6: (none)\n* IPv4: 192.168.222.2\n*   Trying 192.168.222.2:443...\n* ALPN: curl offers h2,http/1.1\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):\n* TLSv1.3 (IN), TLS handshake, Certificate (11):\n* TLSv1.3 (IN), TLS handshake, CERT verify (15):\n* TLSv1.3 (IN), TLS handshake, Finished (20):\n* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.3 (OUT), TLS handshake, Finished (20):\n* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519 / RSASSA-PSS\n* ALPN: server accepted h2\n* Server certificate:\n...\n*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\n*   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\n* Connected to httpbin.testdomain.com (192.168.222.2) port 443\n* using HTTP/2\n* [HTTP/2] [1] OPENED stream for https://httpbin.testdomain.com/headers\n* [HTTP/2] [1] [:method: GET]\n* [HTTP/2] [1] [:scheme: https]\n* [HTTP/2] [1] [:authority: httpbin.testdomain.com]\n* [HTTP/2] [1] [:path: /headers]\n* [HTTP/2] [1] [user-agent: curl/8.13.1-DEV]\n* [HTTP/2] [1] [accept: */*]\n> GET /headers HTTP/2\n> Host: httpbin.testdomain.com\n> User-Agent: curl/8.13.1-DEV\n> Accept: */*\n> \n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* Request completely sent off\n< HTTP/2 200 \n< server: nginx/1.22.1\n< date: Fri, 04 Apr 2025 16:37:07 GMT\n< content-type: application/json\n< content-length: 118\n< access-control-allow-origin: *\n< access-control-allow-credentials: true\n< \n{\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Host\": \"httpbin.testdomain.com\",\n    \"User-Agent\": \"curl/8.13.1-DEV\"\n  }\n}\n* Connection #0 to host httpbin.testdomain.com left intact\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2779256570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pkropachev","id":34160907,"node_id":"MDQ6VXNlcjM0MTYwOTA3","avatar_url":"https://avatars.githubusercontent.com/u/34160907?v=4","gravatar_id":"","url":"https://api.github.com/users/pkropachev","html_url":"https://github.com/pkropachev","followers_url":"https://api.github.com/users/pkropachev/followers","following_url":"https://api.github.com/users/pkropachev/following{/other_user}","gists_url":"https://api.github.com/users/pkropachev/gists{/gist_id}","starred_url":"https://api.github.com/users/pkropachev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkropachev/subscriptions","organizations_url":"https://api.github.com/users/pkropachev/orgs","repos_url":"https://api.github.com/users/pkropachev/repos","events_url":"https://api.github.com/users/pkropachev/events{/privacy}","received_events_url":"https://api.github.com/users/pkropachev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17133158596,"node_id":"MEE_lADOAAiu0c6xL9a7zwAAAAP9N0DE","url":"https://api.github.com/repos/curl/curl/issues/events/17133158596","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-04-04T16:39:05Z","performed_via_github_app":null},{"id":17133158619,"node_id":"SE_lADOAAiu0c6xL9a7zwAAAAP9N0Db","url":"https://api.github.com/repos/curl/curl/issues/events/17133158619","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-04-04T16:39:05Z","performed_via_github_app":null},{"id":17134958606,"node_id":"CE_lADOAAiu0c6xL9a7zwAAAAP9UrgO","url":"https://api.github.com/repos/curl/curl/issues/events/17134958606","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"4f3c22d77d752fea6ff9ab2706f70d58882ea466","commit_url":"https://api.github.com/repos/curl/curl/commits/4f3c22d77d752fea6ff9ab2706f70d58882ea466","created_at":"2025-04-04T19:31:14Z","state_reason":null,"performed_via_github_app":null},{"id":17135192295,"node_id":"REFE_lADOAAiu0c6xL9a7zwAAAAP9Vkjn","url":"https://api.github.com/repos/curl/curl/issues/events/17135192295","actor":{"login":"clayne","id":2467434,"node_id":"MDQ6VXNlcjI0Njc0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/2467434?v=4","gravatar_id":"","url":"https://api.github.com/users/clayne","html_url":"https://github.com/clayne","followers_url":"https://api.github.com/users/clayne/followers","following_url":"https://api.github.com/users/clayne/following{/other_user}","gists_url":"https://api.github.com/users/clayne/gists{/gist_id}","starred_url":"https://api.github.com/users/clayne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clayne/subscriptions","organizations_url":"https://api.github.com/users/clayne/orgs","repos_url":"https://api.github.com/users/clayne/repos","events_url":"https://api.github.com/users/clayne/events{/privacy}","received_events_url":"https://api.github.com/users/clayne/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4f3c22d77d752fea6ff9ab2706f70d58882ea466","commit_url":"https://api.github.com/repos/clayne/curl/commits/4f3c22d77d752fea6ff9ab2706f70d58882ea466","created_at":"2025-04-04T19:55:11Z","performed_via_github_app":null},{"id":17162102592,"node_id":"SE_lADOAAiu0c6xL9a7zwAAAAP-8OdA","url":"https://api.github.com/repos/curl/curl/issues/events/17162102592","actor":{"login":"MichalPetryka","id":35800402,"node_id":"MDQ6VXNlcjM1ODAwNDAy","avatar_url":"https://avatars.githubusercontent.com/u/35800402?v=4","gravatar_id":"","url":"https://api.github.com/users/MichalPetryka","html_url":"https://github.com/MichalPetryka","followers_url":"https://api.github.com/users/MichalPetryka/followers","following_url":"https://api.github.com/users/MichalPetryka/following{/other_user}","gists_url":"https://api.github.com/users/MichalPetryka/gists{/gist_id}","starred_url":"https://api.github.com/users/MichalPetryka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MichalPetryka/subscriptions","organizations_url":"https://api.github.com/users/MichalPetryka/orgs","repos_url":"https://api.github.com/users/MichalPetryka/repos","events_url":"https://api.github.com/users/MichalPetryka/events{/privacy}","received_events_url":"https://api.github.com/users/MichalPetryka/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-04-08T00:22:24Z","performed_via_github_app":null}]