{"url":"https://api.github.com/repos/curl/curl/issues/11242","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11242/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11242/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11242/events","html_url":"https://github.com/curl/curl/issues/11242","id":1738968295,"node_id":"I_kwDOAAiu0c5npozn","number":11242,"title":"curl consumes 100% CPU when sending a file with -F","user":{"login":"l29ah","id":31852,"node_id":"MDQ6VXNlcjMxODUy","avatar_url":"https://avatars.githubusercontent.com/u/31852?v=4","gravatar_id":"","url":"https://api.github.com/users/l29ah","html_url":"https://github.com/l29ah","followers_url":"https://api.github.com/users/l29ah/followers","following_url":"https://api.github.com/users/l29ah/following{/other_user}","gists_url":"https://api.github.com/users/l29ah/gists{/gist_id}","starred_url":"https://api.github.com/users/l29ah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/l29ah/subscriptions","organizations_url":"https://api.github.com/users/l29ah/orgs","repos_url":"https://api.github.com/users/l29ah/repos","events_url":"https://api.github.com/users/l29ah/events{/privacy}","received_events_url":"https://api.github.com/users/l29ah/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":192515830,"node_id":"MDU6TGFiZWwxOTI1MTU4MzA=","url":"https://api.github.com/repos/curl/curl/labels/needs-info","name":"needs-info","color":"fbca04","default":false,"description":""},{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2023-06-03T00:04:59Z","updated_at":"2023-06-20T07:10:32Z","closed_at":"2023-06-20T07:10:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Only file bugs here! Ask questions on the mailing lists https://curl.se/mail/\r\n\r\n     SECURITY RELATED? Post it here: https://hackerone.com/curl\r\n\r\n     There are collections of known issues to be aware of:\r\n     https://curl.se/docs/knownbugs.html\r\n     https://curl.se/docs/todo.html       -->\r\n\r\n### I did this\r\n`curl -Ffile=@\"VID_20230603_010956.mp4\" https://0x0.st`\r\n\r\n### I expected the following\r\nTiny CPU consumption appropriate for the pathetic ~200kB/s transfer speed on my i7 CPU.\r\n\r\n### curl/libcurl version\r\n```\r\ncurl 8.1.2 (x86_64-pc-linux-gnu) libcurl/8.1.2 GnuTLS/3.8.0 (OpenSSL/1.1.1u) zlib/1.2.13 c-ares/1.19.1 libidn2/2.3.4 nghttp2/1.52.0 librtmp/2.3\r\nRelease-Date: 2023-05-30\r\nProtocols: dict file ftp ftps http https imap imaps mqtt pop3 pop3s rtmp rtsp smtp smtps tftp\r\nFeatures: AsynchDNS HTTP2 HTTPS-proxy IDN IPv6 Largefile libz MultiSSL NTLM SSL threadsafe TLS-SRP UnixSockets\r\n```\r\n\r\n### operating system\r\nGentoo Lignux\r\n`Linux l29ah-x201 6.2.5+ #238 SMP PREEMPT_DYNAMIC Mon Mar 13 02:40:28 CET 2023 x86_64 Intel(R) Core(TM) i7-8550U CPU @ 1.80GHz GenuineIntel GNU/Linux`\r\n\r\n### top of perf report\r\n```\r\n# Children      Self  Command  Shared Object          Symbol                                          \r\n# ........  ........  .......  .....................  ................................................\r\n#\r\n    27.96%     0.00%  curl     [unknown]              [.] 0x0000000000020003\r\n            |\r\n            ---0x20003\r\n               |          \r\n               |--4.68%--pthread_mutex_lock@@GLIBC_2.2.5\r\n               |          \r\n               |--3.98%--_gnutls_io_write_flush\r\n               |          \r\n               |--3.81%--_gnutls_record_overhead\r\n               |          \r\n               |--3.61%--_gnutls_epoch_get\r\n               |          \r\n               |--3.18%--record_overhead_rt\r\n               |          \r\n               |--2.50%--__GI___pthread_mutex_unlock_usercnt\r\n               |          \r\n               |--1.47%--gnutls_system_mutex_lock\r\n               |          \r\n               |--1.35%--_mbuffer_head_get_first\r\n               |          \r\n               |--1.06%--gnutls_system_mutex_unlock\r\n               |          \r\n                --0.91%--_gnutls_writev_emu.constprop.0\r\n\r\n    12.93%     5.91%  curl     libc.so.6              [.] __send\r\n            |          \r\n            |--7.02%--__send\r\n            |          \r\n            |--0.60%--0x3c668934bc4645c5\r\n            |          0x6a8\r\n            |          |          \r\n            |           --0.60%--__send\r\n            |          \r\n            |--0.53%--0x83df1832731fb4aa\r\n            |          0x3e52\r\n            |          |          \r\n            |           --0.52%--__send\r\n            |          \r\n             --0.50%--0x7734ab5ea3b468f0\r\n                       0x35ac\r\n                       |          \r\n                        --0.50%--__send\r\n\r\n    10.99%     0.00%  curl     [unknown]              [.] 0000000000000000\r\n            |\r\n            ---0\r\n               |          \r\n                --10.99%--0x5575fc882990\r\n                          |          \r\n                          |--5.02%--nghttp2_session_send\r\n                          |          \r\n                          |--1.86%--send_callback\r\n                          |          \r\n                          |--1.15%--nghttp2_session_mem_send_internal\r\n                          |          \r\n                          |--1.14%--Curl_bufq_write_pass\r\n                          |          \r\n                          |--1.07%--nghttp2_session_adjust_idle_stream\r\n                          |          \r\n                           --0.58%--nghttp2_is_fatal\r\n```","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11242/timeline","performed_via_github_app":null,"state_reason":"completed"}