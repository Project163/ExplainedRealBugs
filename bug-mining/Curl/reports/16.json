{"url":"https://api.github.com/repos/curl/curl/issues/8974","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/8974/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/8974/comments","events_url":"https://api.github.com/repos/curl/curl/issues/8974/events","html_url":"https://github.com/curl/curl/issues/8974","id":1263602224,"node_id":"I_kwDOAAiu0c5LUQow","number":8974,"title":"`--path-as-is` doesn't work when authentication is required","user":{"login":"llamasoft","id":4632450,"node_id":"MDQ6VXNlcjQ2MzI0NTA=","avatar_url":"https://avatars.githubusercontent.com/u/4632450?v=4","gravatar_id":"","url":"https://api.github.com/users/llamasoft","html_url":"https://github.com/llamasoft","followers_url":"https://api.github.com/users/llamasoft/followers","following_url":"https://api.github.com/users/llamasoft/following{/other_user}","gists_url":"https://api.github.com/users/llamasoft/gists{/gist_id}","starred_url":"https://api.github.com/users/llamasoft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llamasoft/subscriptions","organizations_url":"https://api.github.com/users/llamasoft/orgs","repos_url":"https://api.github.com/users/llamasoft/repos","events_url":"https://api.github.com/users/llamasoft/events{/privacy}","received_events_url":"https://api.github.com/users/llamasoft/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118243,"node_id":"MDU6TGFiZWwxODQxMTgyNDM=","url":"https://api.github.com/repos/curl/curl/labels/HTTP","name":"HTTP","color":"207de5","default":false,"description":null},{"id":538402904,"node_id":"MDU6TGFiZWw1Mzg0MDI5MDQ=","url":"https://api.github.com/repos/curl/curl/labels/authentication","name":"authentication","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2022-06-07T16:58:42Z","updated_at":"2022-06-08T08:31:09Z","closed_at":"2022-06-08T08:31:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\nUsed the `--path-as-is` flag with `--anyauth` `--user`.\r\n\r\n### I expected the following\r\nBoth the initial unauthorized request and the retried authorized request would use the same URL.\r\n\r\n### curl/libcurl version\r\n\r\n```\r\ncurl 7.64.1 (x86_64-apple-darwin19.0) libcurl/7.64.1 (SecureTransport) LibreSSL/2.8.3 zlib/1.2.11 nghttp2/1.39.2\r\nRelease-Date: 2019-03-27\r\nProtocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp \r\nFeatures: AsynchDNS GSS-API HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz MultiSSL NTLM NTLM_WB SPNEGO SSL UnixSockets\r\n```\r\n\r\n### Steps to reproduce\r\n\r\nSave the following as `auth-server.py`:\r\n```\r\nimport http.server\r\nimport random\r\n\r\nclass DummyAuthHandler(http.server.BaseHTTPRequestHandler):\r\n    def do_GET(self):\r\n        if self.headers.get(\"Authorization\") == None:\r\n            self.send_response(401)\r\n            self.send_header(\"WWW-Authenticate\", f'Digest qop=\"auth\", realm=\"dummy\", nonce=\"{random.randint(1, 65535)}\"')\r\n            self.end_headers()\r\n            self.wfile.write(b\"Unauthorized\")\r\n        else:\r\n            # We don't actually care if the auth header is correct.\r\n            # We just need cURL to send one.\r\n            self.send_response(200)\r\n            self.send_header('Content-Type', 'text/html')\r\n            self.end_headers()\r\n            self.wfile.write(b\"OK\")\r\n\r\nif __name__ == \"__main__\":\r\n    server = http.server.HTTPServer((\"localhost\", 8080), DummyAuthHandler)\r\n    server.serve_forever()\r\n```\r\n\r\nRun the dummy auth server with `python3 auth-server.py`.\r\n\r\nRun the following command: `curl -v --path-as-is --anyauth --user dummy:pass 'http://localhost:8080/../../anything'`\r\n\r\nNote that the initial request used the desired path:\r\n```\r\n> GET /../../anything HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.64.1\r\n> Accept: */*\r\n```\r\n\r\nBut that the authorized request doesn't:\r\n```\r\n> GET /anything HTTP/1.0\r\n> Host: localhost:8080\r\n> Authorization: Digest username=\"user\", realm=\"dummy\", nonce=\"32680\", uri=\"/anything\", cnonce=\"N2IxMDk1MzMxZDEyYjZmMDdjMTJhZTM1OGE5ZWFjNzM=\", nc=00000001, qop=auth, response=\"108b1cdb11fefbb1ae8a2744294aaad1\"\r\n> User-Agent: curl/7.64.1\r\n> Accept: */*\r\n```\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/8974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/8974/timeline","performed_via_github_app":null,"state_reason":"completed"}