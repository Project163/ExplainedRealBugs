{"url":"https://api.github.com/repos/curl/curl/issues/17420","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17420/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17420/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17420/events","html_url":"https://github.com/curl/curl/issues/17420","id":3084121626,"node_id":"I_kwDOAAiu0c630_Ya","number":17420,"title":"AUTH=XOAUTH2 shows No known authentication mechanisms supported with CURLOPT_LOGIN_OPTIONS when trying to authenticate to IMAP","user":{"login":"AdityaGarg8","id":85610623,"node_id":"MDQ6VXNlcjg1NjEwNjIz","avatar_url":"https://avatars.githubusercontent.com/u/85610623?v=4","gravatar_id":"","url":"https://api.github.com/users/AdityaGarg8","html_url":"https://github.com/AdityaGarg8","followers_url":"https://api.github.com/users/AdityaGarg8/followers","following_url":"https://api.github.com/users/AdityaGarg8/following{/other_user}","gists_url":"https://api.github.com/users/AdityaGarg8/gists{/gist_id}","starred_url":"https://api.github.com/users/AdityaGarg8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdityaGarg8/subscriptions","organizations_url":"https://api.github.com/users/AdityaGarg8/orgs","repos_url":"https://api.github.com/users/AdityaGarg8/repos","events_url":"https://api.github.com/users/AdityaGarg8/events{/privacy}","received_events_url":"https://api.github.com/users/AdityaGarg8/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":282653573,"node_id":"MDU6TGFiZWwyODI2NTM1NzM=","url":"https://api.github.com/repos/curl/curl/labels/IMAP","name":"IMAP","color":"f7c6c7","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2025-05-22T17:44:03Z","updated_at":"2025-05-23T20:56:23Z","closed_at":"2025-05-23T20:56:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\n`git imap-send` is a feature in git that allows users to send emails to any folder using IMAP. It uses two ways, one is libcurl, and other is openssl. Currently, while implementing support for OAuth2.0 in it, I came across a bug, it was not working with curl!. I tried to trace a bit, and I believe, it failed at the line here:\n\nhttps://github.com/AdityaGarg8/git/blob/8b47a6bd67135fc33f736a1c509d00553decb339/imap-send.c#L1579\n\nI also ran the verbose output, with this being on my terminal:\n\n```\nlibcurl version: libcurl/8.12.1 Schannel zlib/1.3.1 brotli/1.1.0 zstd/1.5.7 libidn2/2.3.7 libpsl/0.21.5 libssh2/1.11.1\ncurl auth options: AUTH=XOAUTH2\nsending 2 messages\n21:40:10.378590 http.c:889              == Info: Host outlook.office365.com:993 was resolved.\n21:40:10.379593 http.c:889              == Info: IPv6: 2603:1046:c04:1048::2, 2603:1046:c04:141d::2, 2603:1046:c04:141e::2, 2603:1046:c04:80d::2\n21:40:10.379593 http.c:889              == Info: IPv4: 40.104.68.82, 40.104.77.18, 40.104.77.98, 40.104.77.34\n21:40:10.379593 http.c:889              == Info:   Trying [2603:1046:c04:1048::2]:993...\n21:40:10.447028 http.c:889              == Info: schannel: disabled automatic use of client certificate\n21:40:10.579267 http.c:889              == Info: Connected to outlook.office365.com (2603:1046:c04:1048::2) port 993\n21:40:10.640715 http.c:836              <= Recv header, 0000000160 bytes (0x000000a0)\n21:40:10.640715 http.c:848              <= Recv header: * OK The Microsoft Exchange IMAP4 service is ready. [UABOADMAUABSADAAMQBDAEEAMAAxADkAMQAuAEkATgBEAFAAUgBEADAAMQAuAFAAUgBPAEQALgBPAFUAVABMAE8ATwBLAC4AQwBPAE0A]\n21:40:10.640715 http.c:836              => Send header, 0000000017 bytes (0x00000011)\n21:40:10.640715 http.c:848              => Send header: A001 CAPABILITY\n21:40:10.701997 http.c:836              <= Recv header, 0000000115 bytes (0x00000073)\n21:40:10.701997 http.c:848              <= Recv header: * CAPABILITY IMAP4 IMAP4rev1 AUTH=PLAIN AUTH=XOAUTH2 SASL-IR UIDPLUS ID UNSELECT CHILDREN IDLE NAMESPACE LITERAL+\n21:40:10.701997 http.c:836              <= Recv header, 0000000031 bytes (0x0000001f)\n21:40:10.701997 http.c:848              <= Recv header: A001 OK CAPABILITY completed.\n21:40:10.701997 http.c:889              == Info: No known authentication mechanisms supported\n21:40:10.701997 http.c:889              == Info: closing connection #0\ncurl_easy_perform() failed: Login denied\n```\n\n### I expected the following\n\nI expected the login to work. Currently only `AUTH=PLAIN` seem to be working properly, rest methods like `CRAM-MD5` and `OAUTHBEARER` seem to be broken\n\n### curl/libcurl version\n\ncurl 8.12.1 (x86_64-w64-mingw32) libcurl/8.12.1 Schannel zlib/1.3.1 brotli/1.1.0 zstd/1.5.7 libidn2/2.3.7 libpsl/0.21.5 libssh2/1.11.1\nRelease-Date: 2025-02-13\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss\nFeatures: alt-svc AsynchDNS brotli HSTS HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL SSPI threadsafe UnixSockets zstd\n\n### operating system\n\nWindows 11 24H2","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17420/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17420/timeline","performed_via_github_app":null,"state_reason":"completed"}