{"url":"https://api.github.com/repos/curl/curl/issues/14280","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/14280/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/14280/comments","events_url":"https://api.github.com/repos/curl/curl/issues/14280/events","html_url":"https://github.com/curl/curl/issues/14280","id":2432397900,"node_id":"I_kwDOAAiu0c6Q-3JM","number":14280,"title":"socket_function callbacks for unrelated sockets that are never removed","user":{"login":"JulesRapanga","id":19490002,"node_id":"MDQ6VXNlcjE5NDkwMDAy","avatar_url":"https://avatars.githubusercontent.com/u/19490002?v=4","gravatar_id":"","url":"https://api.github.com/users/JulesRapanga","html_url":"https://github.com/JulesRapanga","followers_url":"https://api.github.com/users/JulesRapanga/followers","following_url":"https://api.github.com/users/JulesRapanga/following{/other_user}","gists_url":"https://api.github.com/users/JulesRapanga/gists{/gist_id}","starred_url":"https://api.github.com/users/JulesRapanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JulesRapanga/subscriptions","organizations_url":"https://api.github.com/users/JulesRapanga/orgs","repos_url":"https://api.github.com/users/JulesRapanga/repos","events_url":"https://api.github.com/users/JulesRapanga/events{/privacy}","received_events_url":"https://api.github.com/users/JulesRapanga/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2024-07-26T14:44:22Z","updated_at":"2024-07-29T12:54:16Z","closed_at":"2024-07-29T12:54:16Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nWe use libcurl in our software via the multi API driven with libev. After updating from 8.7.1 to 8.9.0 our program would start using 100% cpu after a couple of minutes. On boot we make HTTP requests a several hosts and (when idle) make a single request to one host every minute. It seems that when we make the second request to this host we get callbacks to the function provided to `CURLMOPT_SOCKETFUNCTION` telling us to monitor several sockets that are connected to different hosts. Subsequently `libev` constantly tells us there is activity on these sockets and we call `curl_multi_socket_action` but to no effect or error. After the request finishes we are told to stop monitoring the socket that was actually used for the request but not for the spurious ones, so we continue to spin.\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\ncurl 8.9.0\n\n### operating system\n\nUbuntu Focal","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/14280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/14280/timeline","performed_via_github_app":null,"state_reason":"completed"}