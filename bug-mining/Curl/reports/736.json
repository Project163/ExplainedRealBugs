{"url":"https://api.github.com/repos/curl/curl/issues/17513","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17513/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17513/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17513/events","html_url":"https://github.com/curl/curl/issues/17513","id":3108595391,"node_id":"I_kwDOAAiu0c65SWa_","number":17513,"title":"-T/--file-upload . does not read from STDIN on 8.14","user":{"login":"denandz","id":5291556,"node_id":"MDQ6VXNlcjUyOTE1NTY=","avatar_url":"https://avatars.githubusercontent.com/u/5291556?v=4","gravatar_id":"","url":"https://api.github.com/users/denandz","html_url":"https://github.com/denandz","followers_url":"https://api.github.com/users/denandz/followers","following_url":"https://api.github.com/users/denandz/following{/other_user}","gists_url":"https://api.github.com/users/denandz/gists{/gist_id}","starred_url":"https://api.github.com/users/denandz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/denandz/subscriptions","organizations_url":"https://api.github.com/users/denandz/orgs","repos_url":"https://api.github.com/users/denandz/repos","events_url":"https://api.github.com/users/denandz/events{/privacy}","received_events_url":"https://api.github.com/users/denandz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":192912238,"node_id":"MDU6TGFiZWwxOTI5MTIyMzg=","url":"https://api.github.com/repos/curl/curl/labels/cmdline%20tool","name":"cmdline tool","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":15,"created_at":"2025-06-02T05:16:05Z","updated_at":"2025-06-04T13:10:10Z","closed_at":"2025-06-04T13:10:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\n`curl --file-upload . --trace - https://pipeto.me/asdf` should read from stdin in a non-blocking way, writing data to the server as it's read from STDIN. This does not happen on 8.14. Versions 8.8 to 8.13 work; however, the reading from STDIN is delayed. Version 8.7.1 functions as expected. The following was performed on a Fedora linux machine after compiling each release with `./configure --with-openssl --without-libpsl ; make -j$(nproc)`. In each case, I started the command and typed `asdf<ENTER>` as fast as I could.\n\nVersion 8.14 - this does not read from STDIN at all and wont send data to the server:\n\n```\ndoi@koplje:~/tmp/curls/curl-8.14.0/src$ ./curl --trace - -T . -N https://pipeto.me/asdf\n== Info: Host pipeto.me:443 was resolved.\n== Info: IPv6: (none)\n== Info: IPv4: 146.190.74.113\n== Info:   Trying 146.190.74.113:443...\n== Info: ALPN: curl offers http/1.1\n=> Send SSL data, 5 bytes (0x5)\n0000: 16 03 01 02 00                                  .....\n== Info: TLSv1.3 (OUT), TLS handshake, Client hello (1):\n=> Send SSL data, 512 bytes (0x200)\n...yoink...\n=> Send header, 127 bytes (0x7f)\n0000: 50 55 54 20 2f 61 73 64 66 20 48 54 54 50 2f 31 PUT /asdf HTTP/1\n0010: 2e 31 0d 0a 48 6f 73 74 3a 20 70 69 70 65 74 6f .1..Host: pipeto\n0020: 2e 6d 65 0d 0a 55 73 65 72 2d 41 67 65 6e 74 3a .me..User-Agent:\n0030: 20 63 75 72 6c 2f 38 2e 31 34 2e 30 0d 0a 41 63  curl/8.14.0..Ac\n0040: 63 65 70 74 3a 20 2a 2f 2a 0d 0a 54 72 61 6e 73 cept: */*..Trans\n0050: 66 65 72 2d 45 6e 63 6f 64 69 6e 67 3a 20 63 68 fer-Encoding: ch\n0060: 75 6e 6b 65 64 0d 0a 45 78 70 65 63 74 3a 20 31 unked..Expect: 1\n0070: 30 30 2d 63 6f 6e 74 69 6e 75 65 0d 0a 0d 0a    00-continue....\n<= Recv SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 4a                                  ....J\n<= Recv SSL data, 1 bytes (0x1)\n0000: 16                                              .\n== Info: TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n<= Recv SSL data, 57 bytes (0x39)\n0000: 04 00 00 35 00 01 51 80 72 96 16 24 08 00 00 00 ...5..Q.r..$....\n0010: 00 00 00 00 00 00 20 ea a6 79 7d 29 2f fe 49 7a ...... ..y})/.Iz\n0020: d8 7e f0 19 01 6a 72 76 d7 c0 29 fd 09 e4 dd 81 .~...jrv..).....\n0030: a2 1c 56 c1 20 dc 76 00 00                      ..V. .v..\n<= Recv SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 4a                                  ....J\n<= Recv SSL data, 1 bytes (0x1)\n0000: 16                                              .\n== Info: TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n<= Recv SSL data, 57 bytes (0x39)\n0000: 04 00 00 35 00 01 51 80 92 a3 66 6b 08 00 00 00 ...5..Q...fk....\n0010: 00 00 00 00 01 00 20 e8 01 76 78 f5 8e d7 a6 b8 ...... ..vx.....\n0020: c3 30 00 7d 49 d4 96 db 68 6a 2c c1 5e 9c f0 86 .0.}I...hj,.^...\n0030: 57 41 55 6f 4c d1 ca 00 00                      WAUoL....\n<= Recv SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 2a                                  ....*\n<= Recv SSL data, 1 bytes (0x1)\n0000: 17                                              .\n<= Recv header, 23 bytes (0x17)\n0000: 48 54 54 50 2f 31 2e 31 20 31 30 30 20 43 6f 6e HTTP/1.1 100 Con\n0010: 74 69 6e 75 65 0d 0a                            tinue..\n<= Recv header, 2 bytes (0x2)\n0000: 0d 0a                                           ..\nasdf\nasd\nfasdf\nasd\nfasdf\nasdf\nasdf\nasdf\nasdf\nasdf\nasdf\nasdf\nasdf\n^C\n```\n\nCurl 8.13 below, note the delay and multiple entries before data being sent. Have confirmed this behavior down to version 8.8, too.\n\n```\ndoi@koplje:~/tmp/curls/curl-8.13.0/src$ ./curl --trace - -T . -N https://pipeto.me/asdf\n== Info: Host pipeto.me:443 was resolved.\n== Info: IPv6: (none)\n== Info: IPv4: 146.190.74.113\n...yoink...\n<= Recv header, 23 bytes (0x17)\n0000: 48 54 54 50 2f 31 2e 31 20 31 30 30 20 43 6f 6e HTTP/1.1 100 Con\n0010: 74 69 6e 75 65 0d 0a                            tinue..\n<= Recv header, 2 bytes (0x2)\n0000: 0d 0a                                           ..\nasd\nasdf\nasdf\nasdf\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1a                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 9 bytes (0x9)\n0000: 34 0d 0a 61 73 64 0a 0d 0a                      4..asd...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\nasdf=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n\nasdf\nasdf\nasdf\nasd\nfasd=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1a                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 9 bytes (0x9)\n0000: 34 0d 0a 61 73 64 0a 0d 0a                      4..asd...\n```\n\nAnd 8.7.1 - working as expected. Data is read on STDIN immediately and sent to the server:\n\n```\ndoi@koplje:~/tmp/curls/curl-8.7.1/src$ ./curl --trace - -T . -N https://pipeto.me/asdf\n== Info: Host pipeto.me:443 was resolved.\n== Info: IPv6: (none)\n== Info: IPv4: 146.190.74.113\n...yoink...\n<= Recv header, 23 bytes (0x17)\n0000: 48 54 54 50 2f 31 2e 31 20 31 30 30 20 43 6f 6e HTTP/1.1 100 Con\n0010: 74 69 6e 75 65 0d 0a                            tinue..\n<= Recv header, 2 bytes (0x2)\n0000: 0d 0a                                           ..\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\nasdf\n=> Send SSL data, 5 bytes (0x5)\n0000: 17 03 03 00 1b                                  .....\n=> Send SSL data, 1 bytes (0x1)\n0000: 17                                              .\n=> Send data, 10 bytes (0xa)\n0000: 35 0d 0a 61 73 64 66 0a 0d 0a                   5..asdf...\n^C\n```\n\n### I expected the following\n\nExpected all versions to behave like 8.7.1, reading data from STDIN promptly and sending this to the server.\n\n### curl/libcurl version\n\nNot working at all - 8.14:\n\n```\n$ ./curl -V\ncurl 8.14.0 (aarch64-unknown-linux-gnu) libcurl/8.14.0 OpenSSL/3.2.4 zlib/1.3.1.zlib-ng brotli/1.1.0 zstd/1.5.7\nRelease-Date: 2025-05-28\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp ws wss\nFeatures: alt-svc AsynchDNS brotli HSTS HTTPS-proxy IPv6 Largefile libz NTLM SSL threadsafe TLS-SRP UnixSockets zstd\n```\n\nWorking, but slow - 8.8 to 8.13\n\n```\ncurl 8.13.0 (aarch64-unknown-linux-gnu) libcurl/8.13.0 OpenSSL/3.2.4 zlib/1.3.1.zlib-ng brotli/1.1.0 zstd/1.5.7\nRelease-Date: 2025-04-02\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp ws wss\nFeatures: alt-svc AsynchDNS brotli HSTS HTTPS-proxy IPv6 Largefile libz NTLM SSL threadsafe TLS-SRP UnixSockets zstd\n```\n\nworking as expected - 8.7.1 and below:\n\n```\ncurl 8.7.1 (aarch64-unknown-linux-gnu) libcurl/8.7.1 OpenSSL/3.2.4 zlib/1.3.1.zlib-ng brotli/1.1.0 zstd/1.5.7\nRelease-Date: 2024-03-27\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp\nFeatures: alt-svc AsynchDNS brotli HSTS HTTPS-proxy IPv6 Largefile libz NTLM SSL threadsafe TLS-SRP UnixSockets zstd\n```\n\n### operating system\n\nFedora Linux 40","closed_by":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17513/timeline","performed_via_github_app":null,"state_reason":"completed"}