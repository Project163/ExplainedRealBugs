[{"id":7273994005,"node_id":"LE_lADOAAiu0c5QqiX2zwAAAAGxkFcV","url":"https://api.github.com/repos/curl/curl/issues/events/7273994005","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-08-28T20:59:31Z","label":{"name":"TLS","color":"bfdadc"},"performed_via_github_app":null},{"id":7273994006,"node_id":"LE_lADOAAiu0c5QqiX2zwAAAAGxkFcW","url":"https://api.github.com/repos/curl/curl/issues/events/7273994006","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-08-28T20:59:31Z","label":{"name":"performance","color":"d306dd"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1232160812","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1232160812","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1232160812,"node_id":"IC_kwDOAAiu0c5JcUgs","user":{"login":"dfandrich","id":228259,"node_id":"MDQ6VXNlcjIyODI1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/228259?v=4","gravatar_id":"","url":"https://api.github.com/users/dfandrich","html_url":"https://github.com/dfandrich","followers_url":"https://api.github.com/users/dfandrich/followers","following_url":"https://api.github.com/users/dfandrich/following{/other_user}","gists_url":"https://api.github.com/users/dfandrich/gists{/gist_id}","starred_url":"https://api.github.com/users/dfandrich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dfandrich/subscriptions","organizations_url":"https://api.github.com/users/dfandrich/orgs","repos_url":"https://api.github.com/users/dfandrich/repos","events_url":"https://api.github.com/users/dfandrich/events{/privacy}","received_events_url":"https://api.github.com/users/dfandrich/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-30T20:58:06Z","updated_at":"2022-08-30T20:58:06Z","body":"I assumed at first this was merely some NetSurf inefficiency, so I left that out of the equation by trying a similar test using just the curl command-line. stracing curl and giving it a handful of URLs on the command line (to simulate a browser loading the main page and some images), I found that the certificate bundle is parsed once per host, even in a single curl process. This makes some sense, since multiple URLs on a single host would reuse an existing kept-alive connection where the TLS handshake is already complete.\r\n\r\nIt would be interesting to see the performance difference if you switched from a certificate bundle to a one-file-per-certificate method (see `c_rehash(1)`). I would expect the performance problem to go away, although it would be nice to minimize it using a bundle, too. I'm not sure if OpenSSL provides a way to fix this. since the parsing is handled by it. If so, then there would need to be a way to force the file to be parsed again when it changes so long-running processes will still pick up new certificates. I'm not familiar enough with the OpenSSL API to know if this is possible.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1232160812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dfandrich","id":228259,"node_id":"MDQ6VXNlcjIyODI1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/228259?v=4","gravatar_id":"","url":"https://api.github.com/users/dfandrich","html_url":"https://github.com/dfandrich","followers_url":"https://api.github.com/users/dfandrich/followers","following_url":"https://api.github.com/users/dfandrich/following{/other_user}","gists_url":"https://api.github.com/users/dfandrich/gists{/gist_id}","starred_url":"https://api.github.com/users/dfandrich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dfandrich/subscriptions","organizations_url":"https://api.github.com/users/dfandrich/orgs","repos_url":"https://api.github.com/users/dfandrich/repos","events_url":"https://api.github.com/users/dfandrich/events{/privacy}","received_events_url":"https://api.github.com/users/dfandrich/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1238100738","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1238100738","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1238100738,"node_id":"IC_kwDOAAiu0c5Jy-sC","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T12:44:40Z","updated_at":"2022-09-06T12:44:40Z","body":"We also have this known bug noted: [Store TLS context per transfer instead of per connection](https://curl.se/docs/knownbugs.html#Store_TLS_context_per_transfer_i) - this is a known area that is suitable for improving.\r\n\r\nAnother option to consider is using [CURLOPT_CAINFO_BLOB](https://curl.se/libcurl/c/CURLOPT_CAINFO_BLOB.html).\r\n\r\nThis is not considered a bug though, which will make us not keep this issue open unless someone seems to be working on a fix short term.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1238100738/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7413363562,"node_id":"LE_lADOAAiu0c5QqiX2zwAAAAG53vNq","url":"https://api.github.com/repos/curl/curl/issues/events/7413363562","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-09-19T12:51:17Z","label":{"name":"enhancement","color":"FCFD96"},"performed_via_github_app":null},{"id":7413405624,"node_id":"REFE_lADOAAiu0c5QqiX2zwAAAAG535e4","url":"https://api.github.com/repos/curl/curl/issues/events/7413405624","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"dc620d8dbea4d8f4938e2066ffbf11265f345bca","commit_url":"https://api.github.com/repos/curl/curl/commits/dc620d8dbea4d8f4938e2066ffbf11265f345bca","created_at":"2022-09-19T12:56:38Z","performed_via_github_app":null},{"actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-19T12:57:40Z","updated_at":"2022-09-19T12:57:40Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/curl/curl/issues/9538","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/9538/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/9538/comments","events_url":"https://api.github.com/repos/curl/curl/issues/9538/events","html_url":"https://github.com/curl/curl/pull/9538","id":1377917532,"node_id":"PR_kwDOAAiu0c4_Mokn","number":9538,"title":"TODO: Reduce CA certificate bundle reparsing","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":200869765,"node_id":"MDU6TGFiZWwyMDA4Njk3NjU=","url":"https://api.github.com/repos/curl/curl/labels/documentation","name":"documentation","color":"f7c6c7","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-09-19T12:57:40Z","updated_at":"2022-09-20T06:36:08Z","closed_at":"2022-09-20T06:36:04Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":569041,"node_id":"MDEwOlJlcG9zaXRvcnk1NjkwNDE=","name":"curl","full_name":"curl/curl","private":false,"owner":{"login":"curl","id":16928085,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2OTI4MDg1","avatar_url":"https://avatars.githubusercontent.com/u/16928085?v=4","gravatar_id":"","url":"https://api.github.com/users/curl","html_url":"https://github.com/curl","followers_url":"https://api.github.com/users/curl/followers","following_url":"https://api.github.com/users/curl/following{/other_user}","gists_url":"https://api.github.com/users/curl/gists{/gist_id}","starred_url":"https://api.github.com/users/curl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/curl/subscriptions","organizations_url":"https://api.github.com/users/curl/orgs","repos_url":"https://api.github.com/users/curl/repos","events_url":"https://api.github.com/users/curl/events{/privacy}","received_events_url":"https://api.github.com/users/curl/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/curl/curl","description":"A command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTMPS, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET, TFTP, WS and WSS. libcurl offers a myriad of powerful features","fork":false,"url":"https://api.github.com/repos/curl/curl","forks_url":"https://api.github.com/repos/curl/curl/forks","keys_url":"https://api.github.com/repos/curl/curl/keys{/key_id}","collaborators_url":"https://api.github.com/repos/curl/curl/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/curl/curl/teams","hooks_url":"https://api.github.com/repos/curl/curl/hooks","issue_events_url":"https://api.github.com/repos/curl/curl/issues/events{/number}","events_url":"https://api.github.com/repos/curl/curl/events","assignees_url":"https://api.github.com/repos/curl/curl/assignees{/user}","branches_url":"https://api.github.com/repos/curl/curl/branches{/branch}","tags_url":"https://api.github.com/repos/curl/curl/tags","blobs_url":"https://api.github.com/repos/curl/curl/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/curl/curl/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/curl/curl/git/refs{/sha}","trees_url":"https://api.github.com/repos/curl/curl/git/trees{/sha}","statuses_url":"https://api.github.com/repos/curl/curl/statuses/{sha}","languages_url":"https://api.github.com/repos/curl/curl/languages","stargazers_url":"https://api.github.com/repos/curl/curl/stargazers","contributors_url":"https://api.github.com/repos/curl/curl/contributors","subscribers_url":"https://api.github.com/repos/curl/curl/subscribers","subscription_url":"https://api.github.com/repos/curl/curl/subscription","commits_url":"https://api.github.com/repos/curl/curl/commits{/sha}","git_commits_url":"https://api.github.com/repos/curl/curl/git/commits{/sha}","comments_url":"https://api.github.com/repos/curl/curl/comments{/number}","issue_comment_url":"https://api.github.com/repos/curl/curl/issues/comments{/number}","contents_url":"https://api.github.com/repos/curl/curl/contents/{+path}","compare_url":"https://api.github.com/repos/curl/curl/compare/{base}...{head}","merges_url":"https://api.github.com/repos/curl/curl/merges","archive_url":"https://api.github.com/repos/curl/curl/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/curl/curl/downloads","issues_url":"https://api.github.com/repos/curl/curl/issues{/number}","pulls_url":"https://api.github.com/repos/curl/curl/pulls{/number}","milestones_url":"https://api.github.com/repos/curl/curl/milestones{/number}","notifications_url":"https://api.github.com/repos/curl/curl/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/curl/curl/labels{/name}","releases_url":"https://api.github.com/repos/curl/curl/releases{/id}","deployments_url":"https://api.github.com/repos/curl/curl/deployments","created_at":"2010-03-18T22:32:22Z","updated_at":"2025-11-10T09:41:55Z","pushed_at":"2025-11-10T12:18:24Z","git_url":"git://github.com/curl/curl.git","ssh_url":"git@github.com:curl/curl.git","clone_url":"https://github.com/curl/curl.git","svn_url":"https://github.com/curl/curl","homepage":"https://curl.se/","size":118458,"stargazers_count":39830,"watchers_count":39830,"language":"C","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":6941,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":43,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["c","client","curl","ftp","gopher","hacktoberfest","http","https","imaps","ldap","libcurl","library","mqtt","pop3","scp","sftp","transfer-data","transferring-data","user-agent","websocket"],"visibility":"public","forks":6941,"open_issues":43,"watchers":39830,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/curl/curl/pulls/9538","html_url":"https://github.com/curl/curl/pull/9538","diff_url":"https://github.com/curl/curl/pull/9538.diff","patch_url":"https://github.com/curl/curl/pull/9538.patch","merged_at":null},"body":"By adding some sort of cache.\r\n\r\nReported-by: Michael Drake\r\nCloses #9379\r\n\r\nAdd this issue to the `TODO` document because it would be a good idea but nobody is working at it for the moment.","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/9538/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/9538/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":7419111319,"node_id":"CE_lADOAAiu0c5QqiX2zwAAAAG6NqeX","url":"https://api.github.com/repos/curl/curl/issues/events/7419111319","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"e9a85c46233029617d2de4e1e78f3b18f5ae3829","commit_url":"https://api.github.com/repos/curl/curl/commits/e9a85c46233029617d2de4e1e78f3b18f5ae3829","created_at":"2022-09-20T06:36:04Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256344153","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1256344153","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1256344153,"node_id":"IC_kwDOAAiu0c5K4kpZ","user":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-23T15:12:27Z","updated_at":"2022-09-23T15:12:27Z","body":"> stracing curl and giving it a handful of URLs on the command line (to simulate a browser loading the main page and some images), I found that the certificate bundle is parsed once per host, even in a single curl process\r\n\r\nIt's once per fetch, even from the *same* host, if you have parallel fetches (`-Z`):\r\n\r\n```bash\r\nstrace -o log -eopenat curl -Z \\\r\n        https://www.netsurf-browser.org/index.html \\\r\n        https://www.netsurf-browser.org/netsurf.png \\\r\n        https://www.netsurf-browser.org/netsurf.css > /dev/null\r\n```\r\n\r\nThat causes the certificates file to be opened/parsed three times:\r\n\r\n```bash\r\ngrep \"certificates\" log\r\nopenat(AT_FDCWD, \"/etc/ssl/certs/ca-certificates.crt\", O_RDONLY) = 6\r\nopenat(AT_FDCWD, \"/etc/ssl/certs/ca-certificates.crt\", O_RDONLY) = 8\r\nopenat(AT_FDCWD, \"/etc/ssl/certs/ca-certificates.crt\", O_RDONLY) = 8\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256344153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256347937","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1256347937","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1256347937,"node_id":"IC_kwDOAAiu0c5K4lkh","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-23T15:15:24Z","updated_at":"2022-09-23T15:15:24Z","body":"It's once per *connection*.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256347937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256399394","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1256399394","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1256399394,"node_id":"IC_kwDOAAiu0c5K4yIi","user":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-23T16:06:46Z","updated_at":"2022-09-23T16:06:46Z","body":"@bagder I'm looking into fixing it at the moment.\r\n\r\nIt seems that the `SSL_CTX_new` is added to the curl `struct connectdata`. The `cafile` is added to the `SSL_CTX` via [SSL_CTX_load_verify_file](https://www.openssl.org/docs/man3.0/man3/SSL_CTX_load_verify_file.html). We can then get the `X509_STORE` with [SSL_CTX_get_cert_store](https://www.openssl.org/docs/man3.0/man3/SSL_CTX_get_cert_store.html).\r\n\r\nMy plan is  we could ref the `X509_STORE` with [X509_STORE_up_ref](https://www.openssl.org/docs/man3.0/man3/X509_STORE_up_ref.html), and store it in the `struct Curl_easy`, and invalidate it if any options are set to set the cafile/path/etc on that easy handle. Then when new connections are made, if the easy handle the connection is being made for already has a X509_STORE, we can call [SSL_CTX_set1_cert_store](https://www.openssl.org/docs/man3.0/man3/SSL_CTX_set1_cert_store.html) to set the `X509_STORE`, instead of `SSL_CTX_load_verify_file` (or similar).\r\n\r\nDo you have any thoughts on this? I'll go ahead if that makes sense to you!","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1256399394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7448618403,"node_id":"MEE_lADOAAiu0c5QqiX2zwAAAAG7-OWj","url":"https://api.github.com/repos/curl/curl/issues/events/7448618403","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-23T16:06:47Z","performed_via_github_app":null},{"id":7448618412,"node_id":"SE_lADOAAiu0c5QqiX2zwAAAAG7-OWs","url":"https://api.github.com/repos/curl/curl/issues/events/7448618412","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-23T16:06:47Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/1261133417","html_url":"https://github.com/curl/curl/issues/9379#issuecomment-1261133417","issue_url":"https://api.github.com/repos/curl/curl/issues/9379","id":1261133417,"node_id":"IC_kwDOAAiu0c5LK15p","user":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-28T16:07:15Z","updated_at":"2022-09-28T16:07:42Z","body":"Actually, it's cleaner to create a new `X509_STORE` than to get one from a `SSL_CTX`. So that's what I'm doing. I'll open a draft pull request in a day or so.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/1261133417/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tlsa","id":8228915,"node_id":"MDQ6VXNlcjgyMjg5MTU=","avatar_url":"https://avatars.githubusercontent.com/u/8228915?v=4","gravatar_id":"","url":"https://api.github.com/users/tlsa","html_url":"https://github.com/tlsa","followers_url":"https://api.github.com/users/tlsa/followers","following_url":"https://api.github.com/users/tlsa/following{/other_user}","gists_url":"https://api.github.com/users/tlsa/gists{/gist_id}","starred_url":"https://api.github.com/users/tlsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlsa/subscriptions","organizations_url":"https://api.github.com/users/tlsa/orgs","repos_url":"https://api.github.com/users/tlsa/repos","events_url":"https://api.github.com/users/tlsa/events{/privacy}","received_events_url":"https://api.github.com/users/tlsa/received_events","type":"User","user_view_type":"public","site_admin":false}}]