{"url":"https://api.github.com/repos/curl/curl/issues/17222","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17222/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17222/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17222/events","html_url":"https://github.com/curl/curl/issues/17222","id":3027729136,"node_id":"I_kwDOAAiu0c60d3rw","number":17222,"title":"curl does not retry on IPv4 if the SOCKS5 proxy rejects IPv6","user":{"login":"TopSoftdeveloper","id":132154906,"node_id":"U_kgDOB-CGGg","avatar_url":"https://avatars.githubusercontent.com/u/132154906?v=4","gravatar_id":"","url":"https://api.github.com/users/TopSoftdeveloper","html_url":"https://github.com/TopSoftdeveloper","followers_url":"https://api.github.com/users/TopSoftdeveloper/followers","following_url":"https://api.github.com/users/TopSoftdeveloper/following{/other_user}","gists_url":"https://api.github.com/users/TopSoftdeveloper/gists{/gist_id}","starred_url":"https://api.github.com/users/TopSoftdeveloper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TopSoftdeveloper/subscriptions","organizations_url":"https://api.github.com/users/TopSoftdeveloper/orgs","repos_url":"https://api.github.com/users/TopSoftdeveloper/repos","events_url":"https://api.github.com/users/TopSoftdeveloper/events{/privacy}","received_events_url":"https://api.github.com/users/TopSoftdeveloper/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":228248612,"node_id":"MDU6TGFiZWwyMjgyNDg2MTI=","url":"https://api.github.com/repos/curl/curl/labels/enhancement","name":"enhancement","color":"FCFD96","default":true,"description":null},{"id":352090567,"node_id":"MDU6TGFiZWwzNTIwOTA1Njc=","url":"https://api.github.com/repos/curl/curl/labels/KNOWN_BUGS%20material","name":"KNOWN_BUGS material","color":"d93f0b","default":false,"description":null},{"id":370011580,"node_id":"MDU6TGFiZWwzNzAwMTE1ODA=","url":"https://api.github.com/repos/curl/curl/labels/connecting%20&%20proxies","name":"connecting & proxies","color":"c2e0c6","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-04-29T09:50:04Z","updated_at":"2025-05-12T14:34:54Z","closed_at":"2025-05-12T14:34:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\n\n# SOCKS5 Proxy IPv6 Compatibility Issue\n\n## Issue Summary\n\nWhen using the `curl` command with a SOCKS5 proxy on an IPv6 device, users experience an issue when trying to access services like `https://api.ipify.io`. Specifically, the following sequence of events occurs:\n\n1. The device queries the DNS to obtain the IPv6 address of `api.ipify.io` (note: the query bypasses the proxy DNS).\n2. If the SOCKS5 proxy supports only IPv4, it responds with an error as defined by **RFC 1928, Section 6**:\n   ```\n   X'08' Address type not supported.\n   ```\n3. Upon receiving this response, the `curl` command should ideally attempt to retry the connection using IPv4. However, instead of this fallback behavior, `curl` exits with an error code, without attempting the IPv4 connection.\n\nThis leads to a situation where users must either:\n- Manually specify the `-4` flag to force IPv4 usage.\n- Or, configure the proxy to provide DNS resolution.\n\n## Expected Behavior\n\nThe expected behavior is that when an IPv6 address is requested and the SOCKS5 proxy cannot handle it, `curl` should automatically attempt to resolve and connect using IPv4 instead. This fallback mechanism should be implemented either within the proxy server or within the client behavior.\n\n## Steps to Reproduce\n\n1. Use the following `curl` command with a SOCKS5 proxy:\n   ```bash\n   curl -x socks5://username:password000@ip:port https://api.ipify.io\n   ```\n2. On an IPv6-only device, the proxy responds with an error indicating that the address type is not supported.\n3. Instead of retrying with IPv4, the command exits with an error code.\n\n## Workaround\n\nTo circumvent this issue, users must:\n- Specify the `-4` flag in the `curl` command to force IPv4 resolution, or\n- Ensure that the proxy DNS is configured to handle the resolution.\n\n## Proposed Solution\n\nIt is recommended to implement automatic fallback behavior for SOCKS5 proxies when dealing with mixed IPv4 and IPv6 requests. Specifically:\n- The proxy should detect an unsupported address type and automatically retry the request using IPv4.\n- Alternatively, this functionality could be integrated into the `curl` client to trigger the fallback mechanism.\n\n## References\n\n- RFC 1928 - **SOCKS Protocol Version 5**: https://tools.ietf.org/html/rfc1928\n- `curl` documentation: https://curl.se/docs/\n\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\nall version.\n\n### operating system\n\nall os.","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17222/timeline","performed_via_github_app":null,"state_reason":"completed"}