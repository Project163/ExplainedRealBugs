{"url":"https://api.github.com/repos/curl/curl/issues/12691","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/12691/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/12691/comments","events_url":"https://api.github.com/repos/curl/curl/issues/12691/events","html_url":"https://github.com/curl/curl/issues/12691","id":2080415158,"node_id":"I_kwDOAAiu0c58AJ22","number":12691,"title":"curl_multi_fdset does not accept NULL sets","user":{"login":"sfan5","id":1042418,"node_id":"MDQ6VXNlcjEwNDI0MTg=","avatar_url":"https://avatars.githubusercontent.com/u/1042418?v=4","gravatar_id":"","url":"https://api.github.com/users/sfan5","html_url":"https://github.com/sfan5","followers_url":"https://api.github.com/users/sfan5/followers","following_url":"https://api.github.com/users/sfan5/following{/other_user}","gists_url":"https://api.github.com/users/sfan5/gists{/gist_id}","starred_url":"https://api.github.com/users/sfan5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sfan5/subscriptions","organizations_url":"https://api.github.com/users/sfan5/orgs","repos_url":"https://api.github.com/users/sfan5/repos","events_url":"https://api.github.com/users/sfan5/events{/privacy}","received_events_url":"https://api.github.com/users/sfan5/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":200869765,"node_id":"MDU6TGFiZWwyMDA4Njk3NjU=","url":"https://api.github.com/repos/curl/curl/labels/documentation","name":"documentation","color":"f7c6c7","default":true,"description":null},{"id":1117926199,"node_id":"MDU6TGFiZWwxMTE3OTI2MTk5","url":"https://api.github.com/repos/curl/curl/labels/libcurl%20API","name":"libcurl API","color":"fef2c0","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-01-13T17:56:37Z","updated_at":"2024-01-14T13:53:53Z","closed_at":"2024-01-14T13:53:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\n```cpp\r\n\tint max_fd;\r\n\tmres = curl_multi_fdset(m_multi, nullptr, nullptr, nullptr, &max_fd);\r\n```\r\n\r\nThe context here is that I am attempting to emulate `curl_multi_poll` on libcurl older than 7.66.0.\r\nThe idea I had is:\r\n* check if libcurl has any fds it waits for\r\n* if yes, just call `curl_multi_wait`\r\n* if no, sleep for the wanted timeout\r\n\r\nThis actually means reporting this bug is pointless since the fallback code I am writing can never make use of a fix. Maybe you still want to update the docs :shrug: \n\n### I expected the following\n\nNo crash.\r\n\r\nThe [documentation for curl_multi_fdset](https://curl.se/libcurl/c/curl_multi_fdset.html) says (emphasis mine):\r\n\r\n> **If the read_fd_set argument is not a null pointer**, it points to an object of type fd_set that on returns specifies the file descriptors to be checked for being ready to read.\r\n> **If the write_fd_set argument is not a null pointer**, it points to an object of type fd_set that on return specifies the file descriptors to be checked for being ready to write.\r\n> **If the exc_fd_set argument is not a null pointer**, it points to an object of type fd_set that on return specifies the file descriptors to be checked for error conditions pending. \r\n\r\nChecking the code reveals no attempt is made to check the sets against null:\r\nhttps://github.com/curl/curl/blob/d7b6ce64ce0ad787ad2ed3ee05c94938a6b4f551/lib/multi.c#L1178-L1189\r\nAs far as I know `FD_SET(..., NULL)` is not specified to be safe either.\r\n\r\n\n\n### curl/libcurl version\n\ncurl 8.5.0 (x86_64-pc-linux-gnu) libcurl/8.5.0 OpenSSL/3.2.0 zlib/1.3 brotli/1.1.0 zstd/1.5.5 libidn2/2.3.4 libpsl/0.21.2 (+libidn2/2.3.4) libssh2/1.11.0 nghttp2/1.58.0\r\n\n\n### operating system\n\nArch Linux x86_64","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/12691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/12691/timeline","performed_via_github_app":null,"state_reason":"completed"}