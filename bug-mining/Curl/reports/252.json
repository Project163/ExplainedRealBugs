{"url":"https://api.github.com/repos/curl/curl/issues/11152","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11152/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11152/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11152/events","html_url":"https://github.com/curl/curl/issues/11152","id":1716884886,"node_id":"I_kwDOAAiu0c5mVZWW","number":11152,"title":"curl 8.1.0: tests 1467 1468 failing with 'socket path too long'","user":{"login":"citrus-it","id":29426693,"node_id":"MDQ6VXNlcjI5NDI2Njkz","avatar_url":"https://avatars.githubusercontent.com/u/29426693?v=4","gravatar_id":"","url":"https://api.github.com/users/citrus-it","html_url":"https://github.com/citrus-it","followers_url":"https://api.github.com/users/citrus-it/followers","following_url":"https://api.github.com/users/citrus-it/following{/other_user}","gists_url":"https://api.github.com/users/citrus-it/gists{/gist_id}","starred_url":"https://api.github.com/users/citrus-it/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/citrus-it/subscriptions","organizations_url":"https://api.github.com/users/citrus-it/orgs","repos_url":"https://api.github.com/users/citrus-it/repos","events_url":"https://api.github.com/users/citrus-it/events{/privacy}","received_events_url":"https://api.github.com/users/citrus-it/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":887227423,"node_id":"MDU6TGFiZWw4ODcyMjc0MjM=","url":"https://api.github.com/repos/curl/curl/labels/tests","name":"tests","color":"a7a8e8","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2023-05-19T08:53:00Z","updated_at":"2023-06-02T21:32:50Z","closed_at":"2023-06-02T21:32:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When running the testsuite after updating from curl 8.0.1 to 8.1.0, tests 1467 and 1468 are failing, with this message on stderr:\r\n\r\n```\r\ncurl: (6) Unix socket path too long: '/data/omnios-build/omniosorg/bloody/_build/curl-8.1.0/curl-8.1.0-build/build.i386/tests/log/server/socks.sock'\r\n```\r\n\r\nOn my build system, that path is indeed > 107 characters (the size of `sockaddr_un.sun_path` being 108).\r\n\r\nThis seems to be a result of https://github.com/curl/curl/commit/89ede3953b8b64d8bf0d15d10989d003d2b30a12\r\n\r\n```\r\nCMD (0): ../src/curl --version 1>log/curlverout.log 2>log/curlvererr.log\r\n********* System characteristics ********\r\n* curl 8.1.0 (x86_64-pc-solaris2.11)\r\n* libcurl/8.1.0 OpenSSL/3.0.8 zlib/1.2.13 brotli/1.0.9 zstd/1.5.5 nghttp2/1.52.0\r\n* Features: alt-svc AsynchDNS brotli HSTS HTTP2 HTTPS-proxy IPv6 Largefile libz NTLM NTLM_WB SSL threadsafe TLS-SRP UnixSockets zstd\r\n* Disabled: xattr\r\n* Host: bloody\r\n* System: SunOS bloody 5.11 omnios-master-42fe848aa52 i86pc i386 i86pc\r\n* OS: solaris\r\n* Env:\r\n* Seed: 214771\r\n* Servers: HTTP-IPv6 HTTP-unix FTP-IPv6\r\n*****************************************\r\nDISABLED: test 323\r\nDISABLED: test 594\r\nDISABLED: test 836\r\nDISABLED: test 882\r\nDISABLED: test 938\r\nDISABLED: test 1182\r\nDISABLED: test 1184\r\nDISABLED: test 1209\r\nDISABLED: test 1211\r\nDISABLED: test 1307\r\nDISABLED: test 1316\r\nDISABLED: test 1510\r\nDISABLED: test 1512\r\nDISABLED: test 1801\r\nDISABLED: test 2086\r\nDISABLED: test 2043\r\nstartnew: perl -I../../../src/tests ../../../src/tests/http-server.pl --keepalive 30 --pidfile \"log/server/http_server.pid\" --logfile \"log/http_server.log\" --logdir \"log\" --portfile log/server/http_server.port --config log/ftpserver.cmd --ipv4 --port 0 --srcdir \"../../../src/tests\"\r\nRUN: ../src/curl --max-time 13 --output log/http_verify.out --silent --verbose --globoff \"http://127.0.0.1:38366/verifiedserver\" 2>log/http_verify.log\r\nCMD (0): ../src/curl --max-time 13 --output log/http_verify.out --silent --verbose --globoff \"http://127.0.0.1:38366/verifiedserver\" 2>log/http_verify.log\r\nRUN: HTTP server is on PID 149 port 38366\r\n* pid http => 149 149\r\nstartnew: server/socksd --pidfile log/server/socks2_server.pid --reqfile log/socksd-request.log --logfile log/socks2_server.log --unix-socket log/server/socks.sock --backend 127.0.0.1 --config log/ftpserver.cmd\r\nRUN: SOCKS2 server is now running PID 158\r\n* pid socks5unix => 158 158\r\ntest 1467...[HTTP GET via SOCKS5 proxy via unix sockets]\r\n../src/curl --output log/curl1467.out  --include --trace-ascii log/trace1467 --trace-time --socks5 localhostlog/server/socks.sock http://127.0.0.1:38366/1467 > log/stdout1467 2> log/stderr1467\r\nCMD (1536): ../src/curl --output log/curl1467.out  --include --trace-ascii log/trace1467 --trace-time --socks5 localhostlog/server/socks.sock http://127.0.0.1:38366/1467 > log/stdout1467 2> log/stderr1467\r\n\r\n 1467: protocol FAILED!\r\n There was no content at all in the file log/server.input.\r\n Server glitch? Total curl failure? Returned: 6\r\n\r\n - abort tests\r\n* kill pid for socks5unix => 158\r\n* kill pid for http => 149\r\nRUN: Process with pid 149 signalled to die\r\nRUN: Process with pid 158 signalled to die\r\n\r\nRUN: Process with pid 149 forced to die with SIGKILL\r\nRUN: Process with pid 158 forced to die with SIGKILL\r\nTESTDONE: 1 tests were considered during 2 seconds.\r\nTESTDONE: 0 tests out of 1 reported OK: 0%\r\n\r\nTESTFAIL: These test cases failed: 1467\r\n```\r\n\r\n\r\n```\r\nbloody:omnios:% uname -a\r\nSunOS bloody 5.11 omnios-master-42fe848aa52 i86pc i386 i86pc\r\n\r\nbloody:omnios:% rg -A3 sockaddr_un /usr/include/sys/un.h\r\n53:struct     sockaddr_un {\r\n54-   sa_family_t     sun_family;             /* AF_UNIX */\r\n55-   char            sun_path[108];          /* path name (gag) */\r\n56-};\r\n```","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11152/timeline","performed_via_github_app":null,"state_reason":"completed"}