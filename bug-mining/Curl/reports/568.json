{"url":"https://api.github.com/repos/curl/curl/issues/15316","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15316/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15316/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15316/events","html_url":"https://github.com/curl/curl/issues/15316","id":2593977429,"node_id":"I_kwDOAAiu0c6anPRV","number":15316,"title":"HTTP/2 upload too large request does not immediately end","user":{"login":"jkamp-aws","id":111963998,"node_id":"U_kgDOBqxvXg","avatar_url":"https://avatars.githubusercontent.com/u/111963998?v=4","gravatar_id":"","url":"https://api.github.com/users/jkamp-aws","html_url":"https://github.com/jkamp-aws","followers_url":"https://api.github.com/users/jkamp-aws/followers","following_url":"https://api.github.com/users/jkamp-aws/following{/other_user}","gists_url":"https://api.github.com/users/jkamp-aws/gists{/gist_id}","starred_url":"https://api.github.com/users/jkamp-aws/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkamp-aws/subscriptions","organizations_url":"https://api.github.com/users/jkamp-aws/orgs","repos_url":"https://api.github.com/users/jkamp-aws/repos","events_url":"https://api.github.com/users/jkamp-aws/events{/privacy}","received_events_url":"https://api.github.com/users/jkamp-aws/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2024-10-17T08:13:16Z","updated_at":"2024-10-17T21:03:56Z","closed_at":"2024-10-17T21:03:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nCreate a request where the server is going to reply `HTTP/2 413`. Using curl cli to make the request:\r\n\r\n```\r\ncurl --http2 -X POST -d @./too-large-request -s -i $URL\r\n```\r\n\n\n### I expected the following\n\ncurl to end quickly without an error code, but instead curl waits for the server as if it wants to upload the full data or another request. The server closes the connection (for me 5 minutes) and then curl ends with error 18.\r\n\r\n```\r\n< HTTP/2 413 \r\n< date: Thu, 17 Oct 2024 07:19:20 GMT\r\n< content-type: text/xml\r\n< content-length: 635\r\n< server: Server\r\n* HTTP error before end of send, stop sending\r\n* abort upload after having sent 212992 bytes\r\n< \r\n* received GOAWAY, error=0, last_stream=1\r\n* TLSv1.3 (IN), TLS alert, close notify (256):\r\n* closing connection #0\r\ncurl: (18) Transferred a partial file\r\n\r\n```\r\n\r\nSame output but from curl 7.81.0 (reported 8.6.1 should have been good too)\r\n```\r\n< HTTP/2 413 \r\n< date: Thu, 17 Oct 2024 08:12:15 GMT\r\n< content-type: text/xml\r\n< content-length: 635\r\n< server: Server\r\n* HTTP error before end of send, stop sending\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n< \r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n* Connection #0 to host hostname left intact\r\n```\n\n### curl/libcurl version\n\ncurl 8.10.1 (x86_64-pc-linux-gnu) libcurl/8.10.1 OpenSSL/3.0.2 zlib/1.2.11 zstd/1.4.8 libpsl/0.21.0 nghttp2/1.43.0 OpenLDAP/2.5.18\r\nRelease-Date: 2024-09-18\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS HSTS HTTP2 HTTPS-proxy IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP UnixSockets zstd\r\n\n\n### operating system\n\nLinux ip-192-168-10-106 6.8.0-1015-aws #16~22.04.1-Ubuntu SMP Mon Aug 19 19:38:17 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15316/timeline","performed_via_github_app":null,"state_reason":"completed"}