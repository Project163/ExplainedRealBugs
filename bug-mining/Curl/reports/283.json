{"url":"https://api.github.com/repos/curl/curl/issues/11502","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11502/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11502/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11502/events","html_url":"https://github.com/curl/curl/issues/11502","id":1817073459,"node_id":"I_kwDOAAiu0c5sTlcz","number":11502,"title":"dyld: lazy symbol binding failed: Symbol not found: _SCDynamicStoreCopyProxies","user":{"login":"ryandesign","id":429209,"node_id":"MDQ6VXNlcjQyOTIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/429209?v=4","gravatar_id":"","url":"https://api.github.com/users/ryandesign","html_url":"https://github.com/ryandesign","followers_url":"https://api.github.com/users/ryandesign/followers","following_url":"https://api.github.com/users/ryandesign/following{/other_user}","gists_url":"https://api.github.com/users/ryandesign/gists{/gist_id}","starred_url":"https://api.github.com/users/ryandesign/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryandesign/subscriptions","organizations_url":"https://api.github.com/users/ryandesign/orgs","repos_url":"https://api.github.com/users/ryandesign/repos","events_url":"https://api.github.com/users/ryandesign/events{/privacy}","received_events_url":"https://api.github.com/users/ryandesign/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":657824945,"node_id":"MDU6TGFiZWw2NTc4MjQ5NDU=","url":"https://api.github.com/repos/curl/curl/labels/help%20wanted","name":"help wanted","color":"fbca04","default":true,"description":null},{"id":5766238564,"node_id":"LA_kwDOAAiu0c8AAAABV7HRZA","url":"https://api.github.com/repos/curl/curl/labels/appleOS","name":"appleOS","color":"5319e7","default":false,"description":"specific to an Apple operating system"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2023-07-23T10:20:27Z","updated_at":"2023-07-29T21:43:31Z","closed_at":"2023-07-29T21:43:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nInstall curl 8.2.0 on OS X 10.8 (or on any Mac OS X or OS X version where curl was compiled with the macOS 10.11 SDK or earlier)\n\n### I expected the following\n\ncurl compiles but fails to run, for example:\r\n\r\n```\r\n$ curl --version\r\ndyld: lazy symbol binding failed: Symbol not found: _SCDynamicStoreCopyProxies\r\n  Referenced from: /opt/local/lib/libcurl.4.dylib\r\n  Expected in: flat namespace\r\n\r\ndyld: Symbol not found: _SCDynamicStoreCopyProxies\r\n  Referenced from: /opt/local/lib/libcurl.4.dylib\r\n  Expected in: flat namespace\r\n\r\nTrace/BPT trap: 5\r\n```\r\n\r\nThis was reported to MacPorts here: https://trac.macports.org/ticket/67803\r\n\r\nThe problem seems to be that curl always wants to use `SCDynamicStoreCopyProxies` on macOS, and this is part of the SystemConfiguration framework, and has been ever since Mac OS X 10.1. However, curl only links with that framework when building against the macOS 10.12 SDK or later.\r\n\r\nNormally a missing symbol would be a link-time error but by using the flags `-Wl,-undefined -Wl,dynamic_lookup` you're telling the linker to ignore the problem and that the symbol will exist at runtime. It doesn't, though, because you haven't linked in the framework that has the symbol.\r\n\r\nThis configure test is faulty:\r\n\r\n```\r\nchecking whether to link macOS CoreFoundation and SystemConfiguration framework... no\r\n```\r\n\r\nIt is checking whether `TARGET_OS_OSX` is defined. That define was newly added in the macOS 10.12 SDK.\r\n\r\nIt looks like an attempt to fix this issue was made in #11417 but it didn't fix it in m4/curl-sysconfig.m4.\r\n\r\n`TARGET_OS_OSX` was introduced to help developers distinguish between macOS and other Darwin-derived operating systems (iOS, tvOS, watchOS). Is that distinction necessary here? If not, you can use `TARGET_OS_MAC` which encompasses all of them. Another way to identify any Darwin-based Apple OS is to check if both `__APPLE__` and `__MACH__` are defined.\n\n### curl/libcurl version\n\n8.2.0\n\n### operating system\n\nDarwin redacted 12.6.0 Darwin Kernel Version 12.6.0: Wed Mar 18 16:23:48 PDT 2015; root:xnu-2050.48.19~1/RELEASE_X86_64 x86_64","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11502/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11502/timeline","performed_via_github_app":null,"state_reason":"completed"}