{"url":"https://api.github.com/repos/curl/curl/issues/11680","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11680/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11680/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11680/events","html_url":"https://github.com/curl/curl/issues/11680","id":1852740689,"node_id":"I_kwDOAAiu0c5ubpRR","number":11680,"title":"Using curl_formadd to post file could not rewind correctly when redirection happens","user":{"login":"yushicheng7788","id":52878843,"node_id":"MDQ6VXNlcjUyODc4ODQz","avatar_url":"https://avatars.githubusercontent.com/u/52878843?v=4","gravatar_id":"","url":"https://api.github.com/users/yushicheng7788","html_url":"https://github.com/yushicheng7788","followers_url":"https://api.github.com/users/yushicheng7788/followers","following_url":"https://api.github.com/users/yushicheng7788/following{/other_user}","gists_url":"https://api.github.com/users/yushicheng7788/gists{/gist_id}","starred_url":"https://api.github.com/users/yushicheng7788/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yushicheng7788/subscriptions","organizations_url":"https://api.github.com/users/yushicheng7788/orgs","repos_url":"https://api.github.com/users/yushicheng7788/repos","events_url":"https://api.github.com/users/yushicheng7788/events{/privacy}","received_events_url":"https://api.github.com/users/yushicheng7788/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":184118243,"node_id":"MDU6TGFiZWwxODQxMTgyNDM=","url":"https://api.github.com/repos/curl/curl/labels/HTTP","name":"HTTP","color":"207de5","default":false,"description":null},{"id":1117926199,"node_id":"MDU6TGFiZWwxMTE3OTI2MTk5","url":"https://api.github.com/repos/curl/curl/labels/libcurl%20API","name":"libcurl API","color":"fef2c0","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":10,"created_at":"2023-08-16T08:14:50Z","updated_at":"2023-08-17T21:50:21Z","closed_at":"2023-08-17T21:50:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nI am using curl_formadd to post MIME data to server, and server replies redirection.  But it seems libcurl didn't rewind correctly. \r\nI think this phenomenon was cause by this commit 1b3973180b6b7f1023240a67d3acdb11b534bf03\r\nIn the version before 7.87.0, libcurl will do rewind immediately, but in version 7.87.0, libcurl will only make a mark, and then do the rewind operation in the next round of state machine driving. But at that time, the cached **req** member seems to be reinitialized again, causing **http->sendit** to be empty, and when sending data with curl_formadd, mimepost is also empty, and rewind is not executed correctly.\r\n\r\n### I expected the following\r\n\r\nI'm wondering if my understanding is correct or not. Would like get your confirmation.\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.1.2\r\n\r\n### operating system\r\n\r\nWindows x86_64","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11680/timeline","performed_via_github_app":null,"state_reason":"completed"}