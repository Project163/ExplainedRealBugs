{"url":"https://api.github.com/repos/curl/curl/issues/13242","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13242/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13242/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13242/events","html_url":"https://github.com/curl/curl/issues/13242","id":2216697170,"node_id":"I_kwDOAAiu0c6EIB1S","number":13242,"title":"Curl fails to build reproducibly","user":{"login":"charles2910","id":34252251,"node_id":"MDQ6VXNlcjM0MjUyMjUx","avatar_url":"https://avatars.githubusercontent.com/u/34252251?v=4","gravatar_id":"","url":"https://api.github.com/users/charles2910","html_url":"https://github.com/charles2910","followers_url":"https://api.github.com/users/charles2910/followers","following_url":"https://api.github.com/users/charles2910/following{/other_user}","gists_url":"https://api.github.com/users/charles2910/gists{/gist_id}","starred_url":"https://api.github.com/users/charles2910/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/charles2910/subscriptions","organizations_url":"https://api.github.com/users/charles2910/orgs","repos_url":"https://api.github.com/users/charles2910/repos","events_url":"https://api.github.com/users/charles2910/events{/privacy}","received_events_url":"https://api.github.com/users/charles2910/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3405978577,"node_id":"LA_kwDOAAiu0c7LAxvR","url":"https://api.github.com/repos/curl/curl/labels/script","name":"script","color":"379DD5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-03-30T23:16:20Z","updated_at":"2024-03-31T20:48:02Z","closed_at":"2024-03-31T19:26:40Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nWe have in debian a [CI pipeline running for each commit in our repo](https://salsa.debian.org/debian/curl/-/pipelines/659492) (hosted in Debian's gitlab instance). We do have reprotest which builds the package twice changing the build environment and checks if they are bit by bit the same. Though they aren't the same because of the autogenerated manpages:\r\n\r\n```\r\n charles  …  debian  output  reprotest  2  SIGINT  diffoscope control/source-root/curl_8.7.1-1+salsaci+20240330+129_amd64.deb experiment-1/source-root/curl_8.7.1-1+salsaci+20240330+129_amd64.deb\r\n--- control/source-root/curl_8.7.1-1+salsaci+20240330+129_amd64.deb\r\n+++ experiment-1/source-root/curl_8.7.1-1+salsaci+20240330+129_amd64.deb\r\n├── file list\r\n│ @@ -1,3 +1,3 @@\r\n│  -rw-r--r--   0        0        0        4 2024-03-27 19:02:14.000000 debian-binary\r\n│  -rw-r--r--   0        0        0     1028 2024-03-27 19:02:14.000000 control.tar.xz\r\n│ --rw-r--r--   0        0        0   344140 2024-03-27 19:02:14.000000 data.tar.xz\r\n│ +-rw-r--r--   0        0        0   344172 2024-03-27 19:02:14.000000 data.tar.xz\r\n├── control.tar.xz\r\n│ ├── control.tar\r\n│ │ ├── ./md5sums\r\n│ │ │ ├── ./md5sums\r\n│ │ │ │┄ Files differ\r\n├── data.tar.xz\r\n│ ├── data.tar\r\n│ │ ├── file list\r\n│ │ │ @@ -7,11 +7,11 @@\r\n│ │ │  drwxr-xr-x   0 root         (0) root         (0)        0 2024-03-27 19:02:14.000000 ./usr/share/doc/curl/\r\n│ │ │  -rw-r--r--   0 root         (0) root         (0)      573 2024-03-27 19:02:14.000000 ./usr/share/doc/curl/README.Debian\r\n│ │ │  -rw-r--r--   0 root         (0) root         (0)     8731 2024-03-27 19:02:14.000000 ./usr/share/doc/curl/changelog.Debian.gz\r\n│ │ │  -rw-r--r--   0 root         (0) root         (0)   113339 2024-03-27 08:03:42.000000 ./usr/share/doc/curl/changelog.gz\r\n│ │ │  -rw-r--r--   0 root         (0) root         (0)    21639 2024-03-27 19:02:14.000000 ./usr/share/doc/curl/copyright\r\n│ │ │  drwxr-xr-x   0 root         (0) root         (0)        0 2024-03-27 19:02:14.000000 ./usr/share/man/\r\n│ │ │  drwxr-xr-x   0 root         (0) root         (0)        0 2024-03-27 19:02:14.000000 ./usr/share/man/man1/\r\n│ │ │ --rw-r--r--   0 root         (0) root         (0)    63973 2024-03-27 19:02:14.000000 ./usr/share/man/man1/curl.1.gz\r\n│ │ │ +-rw-r--r--   0 root         (0) root         (0)    63982 2024-03-27 19:02:14.000000 ./usr/share/man/man1/curl.1.gz\r\n│ │ │  drwxr-xr-x   0 root         (0) root         (0)        0 2024-03-27 19:02:14.000000 ./usr/share/zsh/\r\n│ │ │  drwxr-xr-x   0 root         (0) root         (0)        0 2024-03-27 19:02:14.000000 ./usr/share/zsh/vendor-completions/\r\n│ │ │  -rw-r--r--   0 root         (0) root         (0)    15680 2024-03-27 19:02:14.000000 ./usr/share/zsh/vendor-completions/_curl\r\n│ │ ├── ./usr/share/man/man1/curl.1.gz\r\n│ │ │ ├── curl.1\r\n│ │ │ │ @@ -20,15 +20,15 @@\r\n│ │ │ │  .\\\" *\r\n│ │ │ │  .\\\" * SPDX-License-Identifier: curl\r\n│ │ │ │  .\\\" *\r\n│ │ │ │  .\\\" **************************************************************************\r\n│ │ │ │  .\\\"\r\n│ │ │ │  .\\\" DO NOT EDIT. Generated by the curl project managen man page generator.\r\n│ │ │ │  .\\\"\r\n│ │ │ │ -.TH curl 1 \"March 27 2024\" \"curl 8.7.1\" \"curl Manual\"\r\n│ │ │ │ +.TH curl 1 \"märts 28 2024\" \"curl 8.7.1\" \"curl Manual\"\r\n│ │ │ │  .SH NAME\r\n│ │ │ │  curl \\- transfer a URL\r\n│ │ │ │  .SH SYNOPSIS\r\n│ │ │ │  \\fBcurl [options / URLs]\\fP\r\n│ │ │ │  .SH DESCRIPTION\r\n│ │ │ │  \\fBcurl\\fP is a tool for transferring data from or to a server using URLs. It\r\n│ │ │ │  supports these protocols: DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS,\r\n│ │ │ │ ├── encoding\r\n│ │ │ │ │ @@ -1 +1 @@\r\n│ │ │ │ │ -us-ascii\r\n│ │ │ │ │ +utf-8\r\n```\r\n\r\nThe cd2nroff script is correctly using SOURCE_DATE_EPOCH, but it's failing for 2 reasons, timezone variation and language variation:\r\n\r\n```\r\nINFO:reprotest.build:TIMEZONE variation: TZ=GMT+12\r\n```\r\nMakes the day change from 27 to 28.\r\n\r\n```\r\nINFO:reprotest.build:LOCALE variation: LC_ALL = et_EE.UTF-8 LANGUAGE = et_EE.UTF-8:fr\r\n```\r\n\r\nIs making the month different (english vs estonian).\n\n### I expected the following\n\nTo pass reprotest test and be reproducible.\n\n### curl/libcurl version\n\ncurl 8.7.1 (x86_64-pc-linux-gnu) libcurl/8.7.1 OpenSSL/3.1.5 zlib/1.2.13 brotli/1.1.0 zstd/1.5.5 libidn2/2.3.4 libpsl/0.21.2 libssh2/1.11.0 nghttp2/1.60.0 librtmp/2.3 OpenLDAP/2.5.16\r\nRelease-Date: 2024-03-27, security patched: 8.7.1-2\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\n\n### operating system\n\nDebian unstable","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13242/timeline","performed_via_github_app":null,"state_reason":"completed"}