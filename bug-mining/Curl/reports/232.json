{"url":"https://api.github.com/repos/curl/curl/issues/11114","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11114/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11114/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11114/events","html_url":"https://github.com/curl/curl/issues/11114","id":1709906386,"node_id":"I_kwDOAAiu0c5l6xnS","number":11114,"title":"Problematic check for run-time libs availability in autoconf scripts","user":{"login":"jbulow","id":167394,"node_id":"MDQ6VXNlcjE2NzM5NA==","avatar_url":"https://avatars.githubusercontent.com/u/167394?v=4","gravatar_id":"","url":"https://api.github.com/users/jbulow","html_url":"https://github.com/jbulow","followers_url":"https://api.github.com/users/jbulow/followers","following_url":"https://api.github.com/users/jbulow/following{/other_user}","gists_url":"https://api.github.com/users/jbulow/gists{/gist_id}","starred_url":"https://api.github.com/users/jbulow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbulow/subscriptions","organizations_url":"https://api.github.com/users/jbulow/orgs","repos_url":"https://api.github.com/users/jbulow/repos","events_url":"https://api.github.com/users/jbulow/events{/privacy}","received_events_url":"https://api.github.com/users/jbulow/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118182,"node_id":"MDU6TGFiZWwxODQxMTgxODI=","url":"https://api.github.com/repos/curl/curl/labels/build","name":"build","color":"bfdadc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2023-05-15T11:34:05Z","updated_at":"2023-05-18T18:57:55Z","closed_at":"2023-05-18T18:57:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"https://github.com/curl/curl/blob/f157610d30e981b2f5553c0f212adfdc75881ab5/m4/curl-functions.m4#L5856-L5876\r\n\r\nWhen compiling a projects and its dependencies (curl) with custom compiler flags (such as enabling address sanitizers) this autoconf macro will also test that the compiler can run with the libraries found on the path(s) set in `LD_LIBRARY_PATH`. This will result in a failure when a library used by both the compiler and curl is used. `libz` is such a library.\r\n\r\nThis is how configure fails:\r\n\r\n```\r\nchecking for sys/time.h... (cached) yes\r\nchecking for sys/socket.h... (cached) yes\r\nchecking for struct timeval... yes\r\nchecking run-time libs availability... failed\r\nconfigure: error: one or more libs available at link-time are not available run-time. Libs used at link-time: -lpsl -lssl -lcrypto -lssl -lcrypto -lz\r\n```\r\n\r\nLooking in `config.log` the error is seen:\r\n\r\n```\r\nclang: symbol lookup error: /my_projects_sysroots/lib/libz.so.1: undefined symbol: __asan_option_detect_stack_use_after_return\r\n```\r\n\r\nRunning from command line the problem can be reproduced by:\r\n\r\n```\r\nLD_LIBRARY_PATH=/my_projects_sysroots/lib clang\r\nclang: symbol lookup error: /my_projects_sysroots/lib/libz.so.1: undefined symbol: __asan_option_detect_stack_use_after_return\r\n```\r\n\r\nTo summarize: `LD_LIBRARY_PATH` should not be set when compiling `conftest.c` in the configure script. It should only be set when running the resulting program.","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11114/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11114/timeline","performed_via_github_app":null,"state_reason":"completed"}