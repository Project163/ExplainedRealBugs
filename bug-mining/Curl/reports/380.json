{"url":"https://api.github.com/repos/curl/curl/issues/12655","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/12655/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/12655/comments","events_url":"https://api.github.com/repos/curl/curl/issues/12655/events","html_url":"https://github.com/curl/curl/issues/12655","id":2069588566,"node_id":"I_kwDOAAiu0c57W2pW","number":12655,"title":"tftp upload doesn't convert LF to CRLF for `;mode=netascii`","user":{"login":"m-shibata","id":998856,"node_id":"MDQ6VXNlcjk5ODg1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/998856?v=4","gravatar_id":"","url":"https://api.github.com/users/m-shibata","html_url":"https://github.com/m-shibata","followers_url":"https://api.github.com/users/m-shibata/followers","following_url":"https://api.github.com/users/m-shibata/following{/other_user}","gists_url":"https://api.github.com/users/m-shibata/gists{/gist_id}","starred_url":"https://api.github.com/users/m-shibata/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/m-shibata/subscriptions","organizations_url":"https://api.github.com/users/m-shibata/orgs","repos_url":"https://api.github.com/users/m-shibata/repos","events_url":"https://api.github.com/users/m-shibata/events{/privacy}","received_events_url":"https://api.github.com/users/m-shibata/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":228248612,"node_id":"MDU6TGFiZWwyMjgyNDg2MTI=","url":"https://api.github.com/repos/curl/curl/labels/enhancement","name":"enhancement","color":"FCFD96","default":true,"description":null},{"id":352090567,"node_id":"MDU6TGFiZWwzNTIwOTA1Njc=","url":"https://api.github.com/repos/curl/curl/labels/KNOWN_BUGS%20material","name":"KNOWN_BUGS material","color":"d93f0b","default":false,"description":null},{"id":387504337,"node_id":"MDU6TGFiZWwzODc1MDQzMzc=","url":"https://api.github.com/repos/curl/curl/labels/TFTP","name":"TFTP","color":"1d76db","default":false,"description":null},{"id":534486041,"node_id":"MDU6TGFiZWw1MzQ0ODYwNDE=","url":"https://api.github.com/repos/curl/curl/labels/URL","name":"URL","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-01-08T03:55:56Z","updated_at":"2024-01-13T15:26:50Z","closed_at":"2024-01-13T15:26:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\n```\r\n# 1. create test file using LF as newline\r\n$ echo -e \"abc\\ndef\" > ~/test\r\n$ hd ~/test\r\n00000000  61 62 63 0a 64 65 66 0a                           |abc.def.|\r\n00000008\r\n\r\n# 2. upload file via tftp with ascii\r\n$ LD_LIBRARY_PATH=/usr/local/lib curl -T ~/test \"tftp://tftp.lxd/test;mode=ascii\"\r\n\r\n# 3. check sent packet by curl\r\n$ tcpdump -r ~/test.pcap -XXX\r\nreading from file /home/ubuntu/test.pcap, link-type EN10MB (Ethernet), snapshot length 262144\r\n10:24:09.890720 IP6 curl.lxd.60800 > tftp.lxd.tftp: TFTP, length 46, WRQ \"test\" netascii tsize 8 blksize 512 timeout 6\r\n        0x0000:  0016 3e90 9dbd 0016 3ec8 1158 86dd 600e  ..>.....>..X..`.\r\n        0x0010:  2b74 0036 1140 fd42 0bb5 fbbe ed8d 0216  +t.6.@.B........\r\n        0x0020:  3eff fec8 1158 fd42 0bb5 fbbe ed8d 0216  >....X.B........\r\n        0x0030:  3eff fe90 9dbd ed80 0045 0036 136b 0002  >........E.6.k..\r\n        0x0040:  7465 7374 006e 6574 6173 6369 6900 7473  test.netascii.ts\r\n        0x0050:  697a 6500 3800 626c 6b73 697a 6500 3531  ize.8.blksize.51  <- should  be tsize to 0x10 or 0\r\n        0x0060:  3200 7469 6d65 6f75 7400 3600            2.timeout.6.\r\n10:24:09.891971 IP6 tftp.lxd.52698 > curl.lxd.60800: UDP, length 32\r\n        0x0000:  0016 3ec8 1158 0016 3e90 9dbd 86dd 6008  ..>..X..>.....`.\r\n        0x0010:  9345 0028 1140 fd42 0bb5 fbbe ed8d 0216  .E.(.@.B........\r\n        0x0020:  3eff fe90 9dbd fd42 0bb5 fbbe ed8d 0216  >......B........\r\n        0x0030:  3eff fec8 1158 cdda ed80 0028 135d 0006  >....X.....(.]..\r\n        0x0040:  7473 697a 6500 3800 626c 6b73 697a 6500  tsize.8.blksize.\r\n        0x0050:  3531 3200 7469 6d65 6f75 7400 3600       512.timeout.6.\r\n10:24:09.892022 IP6 curl.lxd.60800 > tftp.lxd.52698: UDP, length 12\r\n        0x0000:  0016 3e90 9dbd 0016 3ec8 1158 86dd 600c  ..>.....>..X..`.\r\n        0x0010:  afab 0014 1140 fd42 0bb5 fbbe ed8d 0216  .....@.B........\r\n        0x0020:  3eff fec8 1158 fd42 0bb5 fbbe ed8d 0216  >....X.B........\r\n        0x0030:  3eff fe90 9dbd ed80 cdda 0014 1349 0003  >............I..\r\n        0x0040:  0001 6162 630a 6465 660a                 ..abc.def.       <- should be \"0x0a\" to \"0x0d 0x0a\"\r\n10:24:09.892086 IP6 tftp.lxd.52698 > curl.lxd.60800: UDP, length 4\r\n        0x0000:  0016 3ec8 1158 0016 3e90 9dbd 86dd 6008  ..>..X..>.....`.\r\n        0x0010:  9345 000c 1140 fd42 0bb5 fbbe ed8d 0216  .E...@.B........\r\n        0x0020:  3eff fe90 9dbd fd42 0bb5 fbbe ed8d 0216  >......B........\r\n        0x0030:  3eff fec8 1158 cdda ed80 000c 1341 0004  >....X.......A..\r\n        0x0040:  0001\r\n```\r\n\r\n### I expected the following\r\n\r\nThe LF line ending code is expected to be converted to CRLF before transmission and then converted to the appropriate line ending code on the server side.\r\n\r\nHowever, curl sends LF as is in netascii mode, so it cannot convert the line ending code.\r\n\r\n[RFC 1350](https://datatracker.ietf.org/doc/html/rfc1350)\r\n\r\n> Three modes of transfer are currently supported: netascii (This is ascii as defined in \"USA Standard Code for Information Interchange\" [[1](https://datatracker.ietf.org/doc/html/rfc1350#ref-1)] with the modifications specified in \"Telnet Protocol Specification\" [[3](https://datatracker.ietf.org/doc/html/rfc1350#ref-3)].)\r\n\r\n[RFC 854](https://datatracker.ietf.org/doc/html/rfc854)\r\n\r\n>       The sequence \"CR LF\", as defined, will cause the NVT to be\r\n>       positioned at the left margin of the next print line (as would,\r\n>       for example, the sequence \"LF CR\").  However, many systems and\r\n>       terminals do not treat CR and LF independently, and will have to\r\n>       go to some effort to simulate their effect.  (For example, some\r\n>       terminals do not have a CR independent of the LF, but on such\r\n>       terminals it may be possible to simulate a CR by backspacing.)\r\n>       Therefore, the sequence \"CR LF\" must be treated as a single \"new\r\n>       line\" character and used whenever their combined action is\r\n>       intended; the sequence \"CR NUL\" must be used where a carriage\r\n>       return alone is actually desired; and the CR character must be\r\n>       avoided in other contexts.  This rule gives assurance to systems\r\n>       which must decide whether to perform a \"new line\" function or a\r\n>       multiple-backspace that the TELNET stream contains a character\r\n>       following a CR that will allow a rational decision.\r\n\r\n### curl/libcurl version\r\n\r\n```\r\n$ LD_LIBRARY_PATH=/usr/local/lib curl --version\r\ncurl 8.6.0-DEV (x86_64-pc-linux-gnu) libcurl/8.6.0-DEV\r\nRelease-Date: [unreleased]\r\nProtocols: dict file ftp gopher http imap ipfs ipns mqtt pop3 rtsp smtp telnet tftp\r\nFeatures: alt-svc AsynchDNS IPv6 Largefile threadsafe UnixSockets\r\n$ git log --oneline -1\r\n8edcfedc1 (HEAD -> master, origin/master, origin/HEAD, master) ftp: use memdup0 to store the OS from a SYST 215 response\r\n```\r\n\r\n### operating system\r\n\r\nUbuntu 22.04 LTS","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/12655/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/12655/timeline","performed_via_github_app":null,"state_reason":"completed"}