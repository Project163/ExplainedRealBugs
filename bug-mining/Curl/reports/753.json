{"url":"https://api.github.com/repos/curl/curl/issues/17819","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17819/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17819/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17819/events","html_url":"https://github.com/curl/curl/issues/17819","id":3203265812,"node_id":"I_kwDOAAiu0c6-7fUU","number":17819,"title":"strange sftp memory leak w/ v. 8.14.1 (possible regression from 7.88.1?)","user":{"login":"albrechtd","id":22217289,"node_id":"MDQ6VXNlcjIyMjE3Mjg5","avatar_url":"https://avatars.githubusercontent.com/u/22217289?v=4","gravatar_id":"","url":"https://api.github.com/users/albrechtd","html_url":"https://github.com/albrechtd","followers_url":"https://api.github.com/users/albrechtd/followers","following_url":"https://api.github.com/users/albrechtd/following{/other_user}","gists_url":"https://api.github.com/users/albrechtd/gists{/gist_id}","starred_url":"https://api.github.com/users/albrechtd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albrechtd/subscriptions","organizations_url":"https://api.github.com/users/albrechtd/orgs","repos_url":"https://api.github.com/users/albrechtd/repos","events_url":"https://api.github.com/users/albrechtd/events{/privacy}","received_events_url":"https://api.github.com/users/albrechtd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":182083182,"node_id":"MDU6TGFiZWwxODIwODMxODI=","url":"https://api.github.com/repos/curl/curl/labels/memory-leak","name":"memory-leak","color":"c7def8","default":false,"description":null},{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":269086135,"node_id":"MDU6TGFiZWwyNjkwODYxMzU=","url":"https://api.github.com/repos/curl/curl/labels/SCP/SFTP","name":"SCP/SFTP","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-07-04T16:34:29Z","updated_at":"2025-07-07T10:02:00Z","closed_at":"2025-07-07T10:02:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nRunning the Whitebox tests of an application using libcurl for sftp on Debian Trixie (libcurl version 8.14.1), Valgrind reports memory leaks which do not occur on Debian Bookworm (libcurl version 7.88.1).  The issue seems to occur only if at least one sftp transaction fails (not sure, though).\n\nPlease see the file `curl-test-sftp.c` in the attached package [curl-sftp-issue.tar.gz](https://github.com/user-attachments/files/21061809/curl-sftp-issue.tar.gz) for a minimal test case; I *think* the function `do_transfer()` uses the easy API properly â€“ please correct me if I'm wrong!\n\nTo simplify the test, the package includes a shell script which\n1. creates a dummy user (beware â€“ requires `sudo`!),\n2. runs a dummy sftp daemon at port 65022 (beware â€“ `sudo` again!),\n3. runs the aforementioned test application in Valgrind, producing one failed, one good, and again one failed transfer, and\n4. cleans up steps 1 and 2.\n\nNote that (on Debian) the packages `openssh-server`, `valgrind` and `libcurl4-gnutls-dev` are required.\n\nThis produces the following output:\n- on Bookworm/7.88.1: [Bookworm.log](https://github.com/user-attachments/files/21061818/Bookworm.log) â€“ everything is fine\n- on Trixie/8.14.1: [Trixie.log](https://github.com/user-attachments/files/21061820/Trixie.log) â€“ the memory leak.\n\n### I expected the following\n\nâ€¦no memory leak on Trixie, as on Bookworm ðŸ˜‰ \n\nDid I miss something in my code, or is this an issue in libcurl?\n\nTIA, Albrecht.\n\n### curl/libcurl version\n\n- Bookworm: libcurl 7.88.1\n- Trixie: libcurl 8.14.1\n\n### operating system\n\nDebian Bookworm and Trixie, respectively, with all updates as of today installed.","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17819/timeline","performed_via_github_app":null,"state_reason":"completed"}