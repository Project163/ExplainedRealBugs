{"url":"https://api.github.com/repos/curl/curl/issues/16084","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/16084/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/16084/comments","events_url":"https://api.github.com/repos/curl/curl/issues/16084/events","html_url":"https://github.com/curl/curl/issues/16084","id":2810496033,"node_id":"I_kwDOAAiu0c6nhMQh","number":16084,"title":"Is short bursts of busyloop normal with HTTP/2 despite no activity?","user":{"login":"denizsokmen","id":3472444,"node_id":"MDQ6VXNlcjM0NzI0NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3472444?v=4","gravatar_id":"","url":"https://api.github.com/users/denizsokmen","html_url":"https://github.com/denizsokmen","followers_url":"https://api.github.com/users/denizsokmen/followers","following_url":"https://api.github.com/users/denizsokmen/following{/other_user}","gists_url":"https://api.github.com/users/denizsokmen/gists{/gist_id}","starred_url":"https://api.github.com/users/denizsokmen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/denizsokmen/subscriptions","organizations_url":"https://api.github.com/users/denizsokmen/orgs","repos_url":"https://api.github.com/users/denizsokmen/repos","events_url":"https://api.github.com/users/denizsokmen/events{/privacy}","received_events_url":"https://api.github.com/users/denizsokmen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2025-01-24T22:33:49Z","updated_at":"2025-01-27T14:46:41Z","closed_at":"2025-01-27T14:46:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\n### Discussed in https://github.com/curl/curl/discussions/16080\n\n<div type='discussions-op-text'>\n\n<sup>Originally posted by **denizsokmen** January 24, 2025</sup>\nI wasn't sure to create this as an issue, as I also haven't dived into it myself. I use multi interface with libcurl 8.9.1 and nghttp2 1.63.0, I have a typical loop in a thread that takes requests, does curl_multi_perform, processes messages, calls curl_multi_poll to avoid busyloop. I noticed that in some of the HTTP/2 requests, curl_multi_poll returns immediately with no numfds set, hundreds of times just to send 80KB of data at the end. There's simply no activity on any sockets until the last step where 80KB data is finally sent:\r\n```\r\n STATE: DO => DID handle 0x12ea30a00; line 2237\r\n STATE: DID => PERFORMING handle 0x12ea30a00; line 2355\r\n curl_multi_perform running handles: 1, numfd after multi_poll: 1, timeout: 1000\r\n multi changed, check CONNECT_PEND queue\r\n\r\n...\r\nhundreds of these spammed in just a few milliseconds:\r\n curl_multi_perform running handles: 1, numfd after multi_poll: 0, timeout: 0\r\n...\r\n\r\nfinally:\r\n curl_multi_perform running handles: 1, numfd after multi_poll: 1, timeout: 1000\r\n upload completely sent off: 83671 bytes\r\n```\r\n\r\n\r\nIn summary, something is setting the timeout to 0 in http/2 requests, turning the downloader thread into a busyloop. Is this normal?</div>","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/16084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/16084/timeline","performed_via_github_app":null,"state_reason":"completed"}