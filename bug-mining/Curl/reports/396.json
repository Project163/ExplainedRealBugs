{"url":"https://api.github.com/repos/curl/curl/issues/12885","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/12885/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/12885/comments","events_url":"https://api.github.com/repos/curl/curl/issues/12885/events","html_url":"https://github.com/curl/curl/issues/12885","id":2121336930,"node_id":"I_kwDOAAiu0c5-cQhi","number":12885,"title":"curl-8.6.0 does not exit after retrieving web page from openssl s_server but curl-8.5.0 does","user":{"login":"salahcoronya","id":46760879,"node_id":"MDQ6VXNlcjQ2NzYwODc5","avatar_url":"https://avatars.githubusercontent.com/u/46760879?v=4","gravatar_id":"","url":"https://api.github.com/users/salahcoronya","html_url":"https://github.com/salahcoronya","followers_url":"https://api.github.com/users/salahcoronya/followers","following_url":"https://api.github.com/users/salahcoronya/following{/other_user}","gists_url":"https://api.github.com/users/salahcoronya/gists{/gist_id}","starred_url":"https://api.github.com/users/salahcoronya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/salahcoronya/subscriptions","organizations_url":"https://api.github.com/users/salahcoronya/orgs","repos_url":"https://api.github.com/users/salahcoronya/repos","events_url":"https://api.github.com/users/salahcoronya/events{/privacy}","received_events_url":"https://api.github.com/users/salahcoronya/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-02-06T17:29:27Z","updated_at":"2024-02-07T16:06:03Z","closed_at":"2024-02-07T13:51:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\n~~~\r\ngentoo-test ~ # cat > testcert.conf << EOF\r\n[ req ]\r\ndefault_bits        = 2048\r\ndefault_keyfile     = testkey.pem\r\nencrypt_key         = no\r\nprompt              = no\r\n\r\ndistinguished_name  = cert_dn\r\nx509_extensions     = cert_ext\r\n\r\n[ cert_dn ]\r\ncountryName         = GB\r\ncommonName          = Common Name\r\n\r\n[ cert_ext ]\r\nbasicConstraints    = critical, CA:FALSE\r\nsubjectAltName      = @alt_names\r\n\r\n[ alt_names ]\r\nDNS.1               = localhost\r\nEOF\r\ngentoo-test ~ # openssl req -provider default\\\r\n            -x509 -config testcert.conf -out testcert.pem\r\ngentoo-test ~ # openssl s_server -provider default  \\\r\n                 -accept 4431 -www -key testkey.pem -cert testcert.pem &\r\ncurl --retry 5 --retry-connrefused --cacert testcert.pem https://localhost:4431/\r\n~~~\r\n\r\n### I expected the following\r\n\r\nThe program prints out:\r\n```\r\n<HTML><BODY BGCOLOR=\"#ffffff\">\r\n<pre>\r\n\r\ns_server -provider default -accept 4431 -www -key testkey.pem -cert testcert.pem \r\nSecure Renegotiation IS supported\r\nCiphers supported in s_server binary\r\nTLSv1.3    :TLS_AES_256_GCM_SHA384    TLSv1.3    :TLS_CHACHA20_POLY1305_SHA256 \r\nTLSv1.3    :TLS_AES_128_GCM_SHA256    TLSv1.2    :ECDHE-ECDSA-AES256-GCM-SHA384 \r\nTLSv1.2    :ECDHE-RSA-AES256-GCM-SHA384 TLSv1.2    :DHE-RSA-AES256-GCM-SHA384 \r\nTLSv1.2    :ECDHE-ECDSA-CHACHA20-POLY1305 TLSv1.2    :ECDHE-RSA-CHACHA20-POLY1305 \r\nTLSv1.2    :DHE-RSA-CHACHA20-POLY1305 TLSv1.2    :ECDHE-ECDSA-AES128-GCM-SHA256 \r\nTLSv1.2    :ECDHE-RSA-AES128-GCM-SHA256 TLSv1.2    :DHE-RSA-AES128-GCM-SHA256 \r\nTLSv1.2    :ECDHE-ECDSA-AES256-SHA384 TLSv1.2    :ECDHE-RSA-AES256-SHA384   \r\nTLSv1.2    :DHE-RSA-AES256-SHA256     TLSv1.2    :ECDHE-ECDSA-AES128-SHA256 \r\nTLSv1.2    :ECDHE-RSA-AES128-SHA256   TLSv1.2    :DHE-RSA-AES128-SHA256     \r\nTLSv1.0    :ECDHE-ECDSA-AES256-SHA    TLSv1.0    :ECDHE-RSA-AES256-SHA      \r\nSSLv3      :DHE-RSA-AES256-SHA        TLSv1.0    :ECDHE-ECDSA-AES128-SHA    \r\nTLSv1.0    :ECDHE-RSA-AES128-SHA      SSLv3      :DHE-RSA-AES128-SHA        \r\nTLSv1.2    :RSA-PSK-AES256-GCM-SHA384 TLSv1.2    :DHE-PSK-AES256-GCM-SHA384 \r\nTLSv1.2    :RSA-PSK-CHACHA20-POLY1305 TLSv1.2    :DHE-PSK-CHACHA20-POLY1305 \r\nTLSv1.2    :ECDHE-PSK-CHACHA20-POLY1305 TLSv1.2    :AES256-GCM-SHA384         \r\nTLSv1.2    :PSK-AES256-GCM-SHA384     TLSv1.2    :PSK-CHACHA20-POLY1305     \r\nTLSv1.2    :RSA-PSK-AES128-GCM-SHA256 TLSv1.2    :DHE-PSK-AES128-GCM-SHA256 \r\nTLSv1.2    :AES128-GCM-SHA256         TLSv1.2    :PSK-AES128-GCM-SHA256     \r\nTLSv1.2    :AES256-SHA256             TLSv1.2    :AES128-SHA256             \r\nTLSv1.0    :ECDHE-PSK-AES256-CBC-SHA384 TLSv1.0    :ECDHE-PSK-AES256-CBC-SHA  \r\nSSLv3      :SRP-RSA-AES-256-CBC-SHA   SSLv3      :SRP-AES-256-CBC-SHA       \r\nTLSv1.0    :RSA-PSK-AES256-CBC-SHA384 TLSv1.0    :DHE-PSK-AES256-CBC-SHA384 \r\nSSLv3      :RSA-PSK-AES256-CBC-SHA    SSLv3      :DHE-PSK-AES256-CBC-SHA    \r\nSSLv3      :AES256-SHA                TLSv1.0    :PSK-AES256-CBC-SHA384     \r\nSSLv3      :PSK-AES256-CBC-SHA        TLSv1.0    :ECDHE-PSK-AES128-CBC-SHA256 \r\nTLSv1.0    :ECDHE-PSK-AES128-CBC-SHA  SSLv3      :SRP-RSA-AES-128-CBC-SHA   \r\nSSLv3      :SRP-AES-128-CBC-SHA       TLSv1.0    :RSA-PSK-AES128-CBC-SHA256 \r\nTLSv1.0    :DHE-PSK-AES128-CBC-SHA256 SSLv3      :RSA-PSK-AES128-CBC-SHA    \r\nSSLv3      :DHE-PSK-AES128-CBC-SHA    SSLv3      :AES128-SHA                \r\nTLSv1.0    :PSK-AES128-CBC-SHA256     SSLv3      :PSK-AES128-CBC-SHA        \r\n---\r\nCiphers common between both SSL end points:\r\nTLS_AES_256_GCM_SHA384     TLS_CHACHA20_POLY1305_SHA256 TLS_AES_128_GCM_SHA256    \r\nECDHE-ECDSA-AES256-GCM-SHA384 ECDHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES256-GCM-SHA384 \r\nECDHE-ECDSA-CHACHA20-POLY1305 ECDHE-RSA-CHACHA20-POLY1305 DHE-RSA-CHACHA20-POLY1305 \r\nECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES128-GCM-SHA256 \r\nECDHE-ECDSA-AES256-SHA384  ECDHE-RSA-AES256-SHA384    DHE-RSA-AES256-SHA256     \r\nECDHE-ECDSA-AES128-SHA256  ECDHE-RSA-AES128-SHA256    DHE-RSA-AES128-SHA256     \r\nECDHE-ECDSA-AES256-SHA     ECDHE-RSA-AES256-SHA       DHE-RSA-AES256-SHA        \r\nECDHE-ECDSA-AES128-SHA     ECDHE-RSA-AES128-SHA       DHE-RSA-AES128-SHA        \r\nAES256-GCM-SHA384          AES128-GCM-SHA256          AES256-SHA256             \r\nAES128-SHA256              AES256-SHA                 AES128-SHA\r\nSignature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:RSA+SHA224:DSA+SHA224:DSA+SHA256:DSA+SHA384:DSA+SHA512\r\nShared Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:RSA+SHA224\r\nSupported groups: x25519:secp256r1:x448:secp521r1:secp384r1:ffdhe2048:ffdhe3072:ffdhe4096:ffdhe6144:ffdhe8192\r\nShared groups: x25519:secp256r1:x448:secp521r1:secp384r1:ffdhe2048:ffdhe3072:ffdhe4096:ffdhe6144:ffdhe8192\r\n---\r\nNew, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384\r\nSSL-Session:\r\n    Protocol  : TLSv1.3\r\n    Cipher    : TLS_AES_256_GCM_SHA384\r\n    Session-ID: F2B0371A1A7124114427B32018A3B3AA80031580D152F82A016BAAFE7F0473D0\r\n    Session-ID-ctx: 01000000\r\n    Resumption PSK: 3884E08956098DDBDC76319DBC13752CBF2E172B7F0A40308BCDC09C936F8C27482E1D0CFD9B69F35F1FF63320D20D1E\r\n    PSK identity: None\r\n    PSK identity hint: None\r\n    SRP username: None\r\n    Start Time: 1707238488\r\n    Timeout   : 7200 (sec)\r\n    Verify return code: 0 (ok)\r\n    Extended master secret: no\r\n    Max Early Data: 0\r\n---\r\n   0 items in the session cache\r\n   0 client connects (SSL_connect())\r\n   0 client renegotiates (SSL_connect())\r\n   0 client connects that finished\r\n   1 server accepts (SSL_accept())\r\n   0 server renegotiates (SSL_accept())\r\n   1 server accepts that finished\r\n   0 session cache hits\r\n   0 session cache misses\r\n   0 session cache timeouts\r\n   0 callback cache hits\r\n   0 cache full overflows (128 allowed)\r\n---\r\nno client certificate available\r\n</pre></BODY></HTML>\r\n```\r\nand terminates\r\n\r\n### curl/libcurl version\r\n\r\n```\r\ncurl 8.6.0 (x86_64-pc-linux-gnu) libcurl/8.6.0 OpenSSL/3.0.12 zlib/1.3 c-ares/1.25.0 libpsl/0.21.2 nghttp2/1.57.0 OpenLDAP/2.6.4\r\nRelease-Date: 2024-01-31\r\nProtocols: dict file ftp ftps http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp smtp smtps tftp\r\nFeatures: alt-svc AsynchDNS GSS-API HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets\r\n```\r\n\r\n### operating system\r\n\r\nGentoo Linux (~amd64)","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/12885/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/12885/timeline","performed_via_github_app":null,"state_reason":"completed"}