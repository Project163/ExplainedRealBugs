{"url":"https://api.github.com/repos/curl/curl/issues/17101","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17101/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17101/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17101/events","html_url":"https://github.com/curl/curl/issues/17101","id":3006146225,"node_id":"I_kwDOAAiu0c6zLiax","number":17101,"title":"Statically linking ngtcp2 and quictls/openssl on Windows","user":{"login":"jixinqi","id":4635756,"node_id":"MDQ6VXNlcjQ2MzU3NTY=","avatar_url":"https://avatars.githubusercontent.com/u/4635756?v=4","gravatar_id":"","url":"https://api.github.com/users/jixinqi","html_url":"https://github.com/jixinqi","followers_url":"https://api.github.com/users/jixinqi/followers","following_url":"https://api.github.com/users/jixinqi/following{/other_user}","gists_url":"https://api.github.com/users/jixinqi/gists{/gist_id}","starred_url":"https://api.github.com/users/jixinqi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jixinqi/subscriptions","organizations_url":"https://api.github.com/users/jixinqi/orgs","repos_url":"https://api.github.com/users/jixinqi/repos","events_url":"https://api.github.com/users/jixinqi/events{/privacy}","received_events_url":"https://api.github.com/users/jixinqi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""},{"id":184123162,"node_id":"MDU6TGFiZWwxODQxMjMxNjI=","url":"https://api.github.com/repos/curl/curl/labels/cmake","name":"cmake","color":"d4c5f9","default":false,"description":null},{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"}],"state":"closed","locked":false,"assignee":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2025-04-19T03:55:18Z","updated_at":"2025-04-20T07:42:05Z","closed_at":"2025-04-20T07:42:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nTo compile curl on Windows with MSVC and statically link all dependencies, I used these steps:\n\n1. Build quictls/openssl\n\nBuild Command:\n\n````\ngit reset --hard\ngit clean -fdx\nperl Configure VC-WIN64A Debug no-shared \\\n    --prefix=[path to ssl install] \\\n    --openssldir=[path to ssl install]/ssl\nperl configdata.pm --dump\nnmake\nnmake test\nnmake install\n````\n\n2. Build ngtcp2\n\nBuild Command:\n\n````\ncmake -B build/ngtcp2\n    -DCMAKE_INSTALL_PREFIX=[path to ngtcp2 install]\n    -DCMAKE_BUILD_TYPE=DEBUG\n    -DENABLE_OPENSSL=ON\n    -DOPENSSL_ROOT_DIR=[path to ssl install]\n    -DLIBNGHTTP3_INCLUDE_DIR=[path to libngtcp3 install]/include\n    -DLIBNGHTTP3_LIBRARY=[path to libngtcp3 install]/lib\n    -DENABLE_STATIC_LIB=ON\n    -DENABLE_SHARED_LIB=OFF\n    -DBUILD_TESTING=OFF\ncmake --build   [path to ngtcp2 install] --config=DEBUG\ncmake --install [path to ngtcp2 install] --config=DEBUG\n````\n\n3. Build curl\n\nBuild Command:\n\n````\ncmake -B [path to curl install]\n    -DCMAKE_INSTALL_PREFIX=    [path to curl install] \\\n    -DCMAKE_BUILD_TYPE=        Debug \\\n    -DBUILD_SHARED_LIBS=       OFF \\\n    -DBUILD_STATIC_LIBS=       ON \\\n    -DBUILD_TESTING=           OFF \\\n\n    -DCURL_CA_BUNDLE=          \"./cacert.pem_path\" \\\n    -DCURL_USE_OPENSSL=        ON \\\n    -DOPENSSL_ROOT_DIR=        [path to ssl install] \\\n\n    -DCURL_USE_LIBPSL=         ON \\\n    -DLIBPSL_INCLUDE_DIR=      [path to libpsl install]/include \\\n    -DLIBPSL_LIBRARY=          [path to libpsl install]/lib/psl.lib \\\n    -DLIBPSL_CFLAGS=           -DPSL_API= \\\n\n    -DNGHTTP3_INCLUDE_DIR=     [path to nghttp3 install]/include \\\n    -DNGHTTP3_LIBRARY=         [path to nghttp3 install]/lib/nghttp3.lib \\\n    -DNGHTTP3_CFLAGS=          -DNGHTTP3_STATICLIB= \\\n\n    -DUSE_NGTCP2=              ON \\\n    -DNGTCP2_INCLUDE_DIR=      [path to ngtcp2 install]/include \\\n    -DNGTCP2_LIBRARY=          [path to ngtcp2 install]/lib/ngtcp2.lib \\\n    -DNGTCP2_CFLAGS=           -DNGTCP2_STATICLIB=\n````\n\nIssue Explanation\n\nThe curl_openssl_check_quic function in CMakeLists.txt fails during compilation because crypt32.lib is not linked. This occurs when:\n\nngtcp2 and curl are both statically linked to quictls/openssl.\n    Static linking does not automatically resolve Windows-specific dependencies like crypt32, which provides cryptographic APIs (e.g. SSL_set_quic_use_legacy_codepoint)\n\nI fixed this probrem:\n\nCommit: https://github.com/jixinqi/curl/commit/f9252a6b94715e915359a2854e5888030ff48ead\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\nPS Z:\\curl-builder> Z:\\curl-builder\\__install\\curl\\Debug\\bin\\curl.exe -V\ncurl 8.13.1-DEV (Windows) libcurl/8.13.1-DEV quictls/3.1.7 zlib/1.3.1.1-motley libpsl/0.21.5 nghttp2/1.65.90 ngtcp2/1.11.90 nghttp3/1.8.90\nRelease-Date: [unreleased]\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp ws wss\nFeatures: alt-svc AsynchDNS HSTS HTTP2 HTTP3 HTTPS-proxy IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP UnixSockets\n\n### operating system\n\nwindows 11","closed_by":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17101/timeline","performed_via_github_app":null,"state_reason":"completed"}