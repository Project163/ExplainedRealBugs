{"url":"https://api.github.com/repos/curl/curl/issues/9982","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/9982/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/9982/comments","events_url":"https://api.github.com/repos/curl/curl/issues/9982/events","html_url":"https://github.com/curl/curl/issues/9982","id":1464933536,"node_id":"I_kwDOAAiu0c5XURyg","number":9982,"title":"Crash creating quic connection (nghttp3/ngtcp2 backend)","user":{"login":"Fullmetal5","id":3742968,"node_id":"MDQ6VXNlcjM3NDI5Njg=","avatar_url":"https://avatars.githubusercontent.com/u/3742968?v=4","gravatar_id":"","url":"https://api.github.com/users/Fullmetal5","html_url":"https://github.com/Fullmetal5","followers_url":"https://api.github.com/users/Fullmetal5/followers","following_url":"https://api.github.com/users/Fullmetal5/following{/other_user}","gists_url":"https://api.github.com/users/Fullmetal5/gists{/gist_id}","starred_url":"https://api.github.com/users/Fullmetal5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fullmetal5/subscriptions","organizations_url":"https://api.github.com/users/Fullmetal5/orgs","repos_url":"https://api.github.com/users/Fullmetal5/repos","events_url":"https://api.github.com/users/Fullmetal5/events{/privacy}","received_events_url":"https://api.github.com/users/Fullmetal5/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118205,"node_id":"MDU6TGFiZWwxODQxMTgyMDU=","url":"https://api.github.com/repos/curl/curl/labels/crash","name":"crash","color":"bfe5bf","default":false,"description":null},{"id":1141438010,"node_id":"MDU6TGFiZWwxMTQxNDM4MDEw","url":"https://api.github.com/repos/curl/curl/labels/HTTP/3","name":"HTTP/3","color":"97fceb","default":false,"description":"h3 or quic related"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-11-25T21:17:52Z","updated_at":"2022-11-26T15:58:58Z","closed_at":"2022-11-26T15:58:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\nBuilding using the instructions at https://curl.se/docs/http3.html (plus --enable-debug) for ngtcp2 then attempting to make a http3/quic connection crashes.\r\nThis didn't use to crash just a few commits ago but I haven't bisected to find the offending commit.\r\nEDIT: Commit af22c2a546ab862ab577c8d9d3609af0de178974 appears to have introduced the problem.\r\nBuilt on current master (280cbeee2789749fa9b2267ce7a07813645897de)\r\n\r\n```\r\n./curl -v -4 --http3 https://example.com/\r\n* STATE: INIT => CONNECT handle 0x55d6e888f038; line 1909 (connection #-5000)\r\n* HTTP/3 direct conn setup(conn #-1, index=0)\r\nSegmentation fault (core dumped)\r\n```\r\n\r\nBacktrace from gdb:\r\n```\r\n(gdb) r -v -4 --http3 https://example.com/\r\nStarting program: /test/pre4/bin/curl -v -4 --http3 https://example.com/\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/usr/lib/libthread_db.so.1\".\r\n* STATE: INIT => CONNECT handle 0x5555555e8038; line 1909 (connection #-5000)\r\n* HTTP/3 direct conn setup(conn #-1, index=0)\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x00007ffff7ec503b in Curl_conn_socket_set (data=0x5555555e8038, sockindex=0) at connect.c:1838\r\n1838      DEBUGASSERT(!data->conn->cfilter[sockindex]);\r\n(gdb) bt\r\n#0  0x00007ffff7ec503b in Curl_conn_socket_set (data=0x5555555e8038, sockindex=0) at connect.c:1838\r\n#1  0x00007ffff7eec98c in h3_setup_conn (data=0x5555555e8038, conn=0x5555555e6d28) at http.c:246\r\n#2  0x00007ffff7eeca6b in http_setup_conn (data=0x5555555e8038, conn=0x5555555e6d28) at http.c:276\r\n#3  0x00007ffff7f48df4 in setup_connection_internals (data=0x5555555e8038, conn=0x5555555e6d28) at url.c:2177\r\n#4  0x00007ffff7f4c4b0 in create_conn (data=0x5555555e8038, in_connect=0x7fffffffdee0, async=0x7fffffffdf28) at url.c:3711\r\n#5  0x00007ffff7f4d1a5 in Curl_connect (data=0x5555555e8038, asyncp=0x7fffffffdf28, protocol_done=0x7fffffffdf27) at url.c:4067\r\n#6  0x00007ffff7f137e2 in multi_runsingle (multi=0x5555555e3d78, nowp=0x7fffffffdfe0, data=0x5555555e8038) at multi.c:1934\r\n#7  0x00007ffff7f1524f in curl_multi_perform (multi=0x5555555e3d78, running_handles=0x7fffffffe0d0) at multi.c:2690\r\n#8  0x00007ffff7ed5233 in easy_transfer (multi=0x5555555e3d78) at easy.c:662\r\n#9  0x00007ffff7ed54b1 in easy_perform (data=0x5555555e8038, events=false) at easy.c:752\r\n#10 0x00007ffff7ed5518 in curl_easy_perform (data=0x5555555e8038) at easy.c:771\r\n#11 0x000055555557ab49 in serial_transfers (global=0x7fffffffe330, share=0x5555555e07f8) at tool_operate.c:2422\r\n#12 0x000055555557b12b in run_all_transfers (global=0x7fffffffe330, share=0x5555555e07f8, result=CURLE_OK) at tool_operate.c:2610\r\n#13 0x000055555557b4c9 in operate (global=0x7fffffffe330, argc=5, argv=0x7fffffffe4d8) at tool_operate.c:2723\r\n#14 0x0000555555571775 in main (argc=5, argv=0x7fffffffe4d8) at tool_main.c:283\r\n```\r\n\r\n### curl/libcurl version\r\n\r\n```\r\ncurl 7.87.0-DEV (x86_64-pc-linux-gnu) libcurl/7.87.0-DEV OpenSSL/3.0.7 zlib/1.2.13 brotli/1.0.9 zstd/1.5.2 libidn2/2.3.4 libpsl/0.21.1 (+libidn2/2.3.4) libssh2/1.10.0 nghttp2/1.51.0 ngtcp2/0.12.0-DEV nghttp3/0.8.0-DEV librtmp/2.3\r\nRelease-Date: [unreleased]\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli Debug GSS-API HSTS HTTP2 HTTP3 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL threadsafe TLS-SRP TrackMemory UnixSockets zstd\r\n```\r\n\r\n### operating system\r\n\r\nArch `(Linux 6.0.9-arch1-1 #1 SMP PREEMPT_DYNAMIC Wed, 16 Nov 2022 17:01:17 +0000 x86_64 GNU/Linux)`\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/9982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/9982/timeline","performed_via_github_app":null,"state_reason":"completed"}