{"url":"https://api.github.com/repos/curl/curl/issues/17256","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17256/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17256/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17256/events","html_url":"https://github.com/curl/curl/issues/17256","id":3042158729,"node_id":"I_kwDOAAiu0c61U6iJ","number":17256,"title":"crash iOS and Android curl 8.13.0","user":{"login":"Wizermil","id":700192,"node_id":"MDQ6VXNlcjcwMDE5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/700192?v=4","gravatar_id":"","url":"https://api.github.com/users/Wizermil","html_url":"https://github.com/Wizermil","followers_url":"https://api.github.com/users/Wizermil/followers","following_url":"https://api.github.com/users/Wizermil/following{/other_user}","gists_url":"https://api.github.com/users/Wizermil/gists{/gist_id}","starred_url":"https://api.github.com/users/Wizermil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wizermil/subscriptions","organizations_url":"https://api.github.com/users/Wizermil/orgs","repos_url":"https://api.github.com/users/Wizermil/repos","events_url":"https://api.github.com/users/Wizermil/events{/privacy}","received_events_url":"https://api.github.com/users/Wizermil/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118205,"node_id":"MDU6TGFiZWwxODQxMTgyMDU=","url":"https://api.github.com/repos/curl/curl/labels/crash","name":"crash","color":"bfe5bf","default":false,"description":null},{"id":975635480,"node_id":"MDU6TGFiZWw5NzU2MzU0ODA=","url":"https://api.github.com/repos/curl/curl/labels/name%20lookup","name":"name lookup","color":"0052cc","default":false,"description":"DNS and related tech"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2025-05-06T09:30:06Z","updated_at":"2025-05-12T15:18:00Z","closed_at":"2025-05-12T15:18:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nHi,\nSince the upgrade to curl 8.13.0 we are facing new crashes in our game related to curl that we wanted to share with the community.\nI hope that a maintainer of the project will have an idea on how to fix it (sorry we don't include debug symbols in our prod build).\nYou will find bellow the stacks:\n* android\n  ```\n            Crashed: Thread: SIGABRT  0x0000000000000000\n  #00 pc 0x94184 libc.so (BuildId: 4fef1ccb99423ab569f445482dbe524a)\n  #01 pc 0x94154 libc.so (BuildId: 4fef1ccb99423ab569f445482dbe524a)\n  #02 pc 0x4f4b0 libc.so (BuildId: 4fef1ccb99423ab569f445482dbe524a)\n  #03 pc 0x1b2cd34 libelixir_android.so (destroy_thread_sync_data) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #04 pc 0x1b2cde4 libelixir_android.so (getaddrinfo_thread) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #05 pc 0x1b2cf04 libelixir_android.so (curl_thread_create_thunk) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #06 pc 0x101e5c libc.so (BuildId: 4fef1ccb99423ab569f445482dbe524a)\n  #07 pc 0x95ae0 libc.so (BuildId: 4fef1ccb99423ab569f445482dbe524a)\n  ```\n  ```\n            Crashed: Thread: SIGSEGV  0x0072616c756003c0\n  #00 pc 0x92624 libc.so (BuildId: cafe80c5d1de3e1b8ff95fe7ea83f0c6)\n  #01 pc 0x92b78 libc.so (BuildId: cafe80c5d1de3e1b8ff95fe7ea83f0c6)\n  #02 pc 0x92b78 libc.so (BuildId: cafe80c5d1de3e1b8ff95fe7ea83f0c6)\n  #03 pc 0x1b2cd34 libelixir_android.so (destroy_thread_sync_data) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #04 pc 0x1b2cde4 libelixir_android.so (getaddrinfo_thread) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #05 pc 0x1b2cf04 libelixir_android.so (curl_thread_create_thunk) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #06 pc 0x67d04 libc.so (BuildId: cafe80c5d1de3e1b8ff95fe7ea83f0c6)\n  #07 pc 0x1f348 libc.so (BuildId: cafe80c5d1de3e1b8ff95fe7ea83f0c6)\n  ```\n  ```\n            Crashed: Thread: SIGSEGV  0x000000746a268000\n  #00 pc 0x1b9fe60 libelixir_android.so (ssl3_read_bytes) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #01 pc 0x1bbbf0c libelixir_android.so (tls_get_message_header) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #02 pc 0x1bbbf0c libelixir_android.so (tls_get_message_header) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #03 pc 0x1bb1820 libelixir_android.so (state_machine) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #04 pc 0x1b89334 libelixir_android.so (SSL_do_handshake) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #05 pc 0x1b751d4 libelixir_android.so (ossl_connect) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #06 pc 0x1b70518 libelixir_android.so (ssl_cf_connect) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #07 pc 0x1b2e1c0 libelixir_android.so (cf_setup_connect) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #08 pc 0x1b32c5c libelixir_android.so (cf_hc_connect) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #09 pc 0x1b3139c libelixir_android.so (Curl_conn_connect) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #10 pc 0x1b56404 libelixir_android.so (multi_runsingle) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #11 pc 0x1b55dbc libelixir_android.so (curl_multi_perform) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  ```\n  ```\n            Crashed: Thread: SIGABRT  0x0000000000000000\n  #00 pc 0x94fd0 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #01 pc 0x94fa0 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #02 pc 0x96f04 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #03 pc 0xfe148 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #04 pc 0xfdfc8 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #05 pc 0x1b2cdcc libelixir_android.so (getaddrinfo_thread) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #06 pc 0x1b2cf04 libelixir_android.so (curl_thread_create_thunk) (BuildId: 46c38d3f9130677ea8497368c61cc1c0a29e4323)\n  #07 pc 0xfcf74 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  #08 pc 0x96924 libc.so (BuildId: 284d65da9c7eadcb4f58fe07ba016b9f)\n  ```\n* iOS\n  ```\n            Crashed: Thread\n  0  libsystem_platform.dylib       0x665c _os_unfair_lock_corruption_abort + 88\n  1  libsystem_platform.dylib       0x32a0 _os_unfair_lock_lock_slow + 332\n  2  libsystem_pthread.dylib        0x4cb8 pthread_mutex_destroy + 64\n  3  elixir                         0xc656a4 destroy_thread_sync_data + 392404\n  4  elixir                         0xc657b8 getaddrinfo_thread + 392680\n  5  elixir                         0xc743dc curl_thread_create_thunk + 453132\n  6  libsystem_pthread.dylib        0x1afc _pthread_start + 136\n  7  libsystem_pthread.dylib        0x1a04 thread_start + 8\n  ```\n  ```\n            Crashed: Thread\n  0  libsystem_kernel.dylib         0xb1dc __pthread_kill + 8\n  1  libsystem_pthread.dylib        0x7b40 pthread_kill + 268\n  2  libsystem_c.dylib              0x772d0 abort + 124\n  3  libsystem_malloc.dylib         0x16cfc malloc_vreport + 892\n  4  libsystem_malloc.dylib         0x16974 malloc_report + 64\n  5  libsystem_malloc.dylib         0x108b4 ___BUG_IN_CLIENT_OF_LIBMALLOC_POINTER_BEING_FREED_WAS_NOT_ALLOCATED + 32\n  6  elixir                         0xc656b8 destroy_thread_sync_data + 392424\n  7  elixir                         0xc657b8 getaddrinfo_thread + 392680\n  8  elixir                         0xc743dc curl_thread_create_thunk + 453132\n  9  libsystem_pthread.dylib        0x1afc _pthread_start + 136\n  10 libsystem_pthread.dylib        0x1a04 thread_start + 8\n  ```\nYou will find most of the opts we are using:\n```\n    curl_easy_setopt(easy_handle, CURLOPT_BUFFERSIZE, 1024L * 1024L);\n    curl_easy_setopt(easy_handle, CURLOPT_CAINFO, FileUtils::getFilenameForDocument(\"cacert.pem\").c_str());\n    curl_easy_setopt(easy_handle, CURLOPT_SSL_VERIFYPEER, 1);\n    curl_easy_setopt(easy_handle, CURLOPT_SSL_VERIFYHOST, 2);\n\n    curl_easy_setopt(easy_handle, CURLOPT_URL, request->url.c_str());\n    curl_easy_setopt(easy_handle, CURLOPT_WRITEFUNCTION, HttpRequest::HttpRequestImpl::curlWriteCallback);\n    curl_easy_setopt(easy_handle, CURLOPT_HEADERFUNCTION, HttpRequest::HttpRequestImpl::curlHeaderCallback);\n    curl_easy_setopt(easy_handle, CURLOPT_WRITEDATA, request.get());\n    curl_easy_setopt(easy_handle, CURLOPT_HEADERDATA, request.get());\n    curl_easy_setopt(easy_handle, CURLOPT_PRIVATE, request.get());\n    curl_easy_setopt(easy_handle, CURLOPT_QUICK_EXIT, 1);\n```\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\ncurl 8.13.0\n\nnghttp2 1.65.0\nnghttp3 1.8.0\nngtcp2 1.11.0\nopenssl 3.3.0 (from https://github.com/quictls/openssl)\n\nhere are the compile flags we used:\n```\n--enable-static --disable-shared\n--disable-ares --enable-threaded-resolver --disable-manual\n--disable-ipv6 --enable-openssl-auto-load-config --disable-verbose\n--enable-tls-srp --enable-proxy --enable-http\n--disable-rtsp --disable-ftp --disable-file --disable-ntlm\n--disable-ldap --disable-ldaps --disable-rtsp\n--disable-dict --disable-telnet --disable-tftp\n--disable-pop3 --disable-imap --disable-smb\n--disable-smtp --disable-mqtt --disable-gopher\n--with-ssl --without-libssh2 --without-librtmp\n--without-libidn2 --without-libpsl --without-ca-bundle --without-ca-path --without-winidn\n--with-nghttp2 --with-ngtcp2 --with-nghttp3\n--enable-alt-svc --without-cyassl--without-polarssl\n--without-gnutls --without-winssl --without-zlib\n--without-darwin-ssl --without-ca-fallback\n```\n\n### operating system\n\niOS: 15, 17, 18\nAndroid: 11, 12, 13, 14","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17256/timeline","performed_via_github_app":null,"state_reason":"completed"}