{"url":"https://api.github.com/repos/curl/curl/issues/13200","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13200/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13200/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13200/events","html_url":"https://github.com/curl/curl/issues/13200","id":2210596743,"node_id":"I_kwDOAAiu0c6DwweH","number":13200,"title":"Regression in rustls pkg-config detection","user":{"login":"kpcyrd","id":7763184,"node_id":"MDQ6VXNlcjc3NjMxODQ=","avatar_url":"https://avatars.githubusercontent.com/u/7763184?v=4","gravatar_id":"","url":"https://api.github.com/users/kpcyrd","html_url":"https://github.com/kpcyrd","followers_url":"https://api.github.com/users/kpcyrd/followers","following_url":"https://api.github.com/users/kpcyrd/following{/other_user}","gists_url":"https://api.github.com/users/kpcyrd/gists{/gist_id}","starred_url":"https://api.github.com/users/kpcyrd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpcyrd/subscriptions","organizations_url":"https://api.github.com/users/kpcyrd/orgs","repos_url":"https://api.github.com/users/kpcyrd/repos","events_url":"https://api.github.com/users/kpcyrd/events{/privacy}","received_events_url":"https://api.github.com/users/kpcyrd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118182,"node_id":"MDU6TGFiZWwxODQxMTgxODI=","url":"https://api.github.com/repos/curl/curl/labels/build","name":"build","color":"bfdadc","default":false,"description":null},{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2024-03-27T11:49:43Z","updated_at":"2024-04-10T05:34:31Z","closed_at":"2024-03-30T21:42:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nI tried to compile the latest curl release with the rustls TLS backend.\r\n\r\nThis is the error I get during configure:\r\n\r\n```\r\n[...]\r\nchecking for mit-krb5-gssapi options with pkg-config... found\r\nchecking for gss.h... no\r\nchecking for gssapi/gssapi.h... yes\r\nchecking for gssapi/gssapi_generic.h... yes\r\nchecking for gssapi/gssapi_krb5.h... yes\r\nchecking if GSS-API headers declare GSS_C_NT_HOSTBASED_SERVICE... yes\r\nchecking for pkg-config... (cached) /usr/bin/pkg-config\r\nchecking for mit-krb5-gssapi options with pkg-config... found\r\nchecking if we can link against GSS-API library... yes\r\nchecking whether to enable Windows native SSL/TLS... no\r\nchecking whether to enable Secure Transport... no\r\nchecking whether to enable Amiga native SSL/TLS (AmiSSL v5)... no\r\nchecking for pkg-config... (cached) /usr/bin/pkg-config\r\nchecking for rustls options with pkg-config... found\r\nconfigure: pkg-config: SSL_LIBS: \"-lrustls\"\r\nconfigure: pkg-config: SSL_LDFLAGS: \"\"\r\nconfigure: pkg-config: SSL_CPPFLAGS: \"\"\r\nconfigure: detected rustls\r\nconfigure: error: TLS not detected, you will not be able to use HTTPS, FTPS, NTLM and more.\r\nUse --with-openssl, --with-gnutls, --with-wolfssl, --with-mbedtls, --with-schannel, --with-secure-transport, --with-amissl, --with-bearssl or --with-rustls to address this.\r\n```\r\n\r\npkg-config is correctly setup for librustls:\r\n\r\n```\r\n% pacman -Ql librustls\r\nlibrustls /usr/\r\nlibrustls /usr/include/\r\nlibrustls /usr/include/rustls.h\r\nlibrustls /usr/lib/\r\nlibrustls /usr/lib/librustls.so\r\nlibrustls /usr/lib/librustls.so.0.12.1\r\nlibrustls /usr/lib/pkgconfig/\r\nlibrustls /usr/lib/pkgconfig/rustls.pc\r\nlibrustls /usr/share/\r\nlibrustls /usr/share/licenses/\r\nlibrustls /usr/share/licenses/librustls/\r\nlibrustls /usr/share/licenses/librustls/LICENSE-APACHE\r\nlibrustls /usr/share/licenses/librustls/LICENSE-ISC\r\nlibrustls /usr/share/licenses/librustls/LICENSE-MIT\r\n```\r\n\r\nThe configure options used are:\r\n\r\n```\r\n--prefix='/usr'\r\n--mandir='/usr/share/man'\r\n--disable-ldap\r\n--disable-ldaps\r\n--disable-manual\r\n--enable-ipv6\r\n--enable-threaded-resolver\r\n--with-gssapi\r\n--with-libssh2\r\n--with-random='/dev/urandom'\r\n--with-ca-bundle='/etc/ssl/certs/ca-certificates.crt'\r\n--with-rustls\r\n--without-openssl\r\n--disable-shared\r\n```\r\n\r\nI noticed this is due to #13179, reverting 647e86a3efe1eea7a2a456c009cfe1eb55fe48eb fixes the build.\r\n\r\n**Full configure output:**\r\n\r\n<details>\r\n\r\n```\r\nchecking whether to enable maintainer-specific portions of Makefiles... no\r\nchecking whether make supports nested variables... yes\r\nchecking whether to enable debug build options... no\r\nchecking whether to enable compiler optimizer... (assumed) yes\r\nchecking whether to enable strict compiler warnings... no\r\nchecking whether to enable compiler warnings as errors... no\r\nchecking whether to enable curl debug memory tracking... no\r\nchecking whether to enable hiding of library internal symbols... yes\r\nchecking whether to enable c-ares for DNS lookups... no\r\nchecking whether to disable dependency on -lrt... (assumed no)\r\nchecking whether to enable ECH support... no\r\nchecking for path separator... :\r\nchecking for sed... /usr/bin/sed\r\nchecking for grep... /usr/bin/grep\r\nchecking that grep -E works... yes\r\nchecking for ar... /usr/bin/ar\r\nchecking for a BSD-compatible install... /usr/bin/install -c\r\nchecking for gcc... gcc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether the compiler supports GNU C... yes\r\nchecking whether gcc accepts -g... yes\r\nchecking for gcc option to enable C11 features... none needed\r\nchecking whether gcc understands -c and -o together... yes\r\nchecking how to run the C preprocessor... gcc -E\r\nchecking for stdio.h... yes\r\nchecking for stdlib.h... yes\r\nchecking for string.h... yes\r\nchecking for inttypes.h... yes\r\nchecking for stdint.h... yes\r\nchecking for strings.h... yes\r\nchecking for sys/stat.h... yes\r\nchecking for sys/types.h... yes\r\nchecking for unistd.h... yes\r\nchecking for stdatomic.h... yes\r\nchecking if _Atomic is available... yes\r\nchecking for a sed that does not truncate output... (cached) /usr/bin/sed\r\nchecking for code coverage support... no\r\nchecking whether build environment is sane... yes\r\nchecking for a race-free mkdir -p... /usr/bin/mkdir -p\r\nchecking for gawk... gawk\r\nchecking whether make sets $(MAKE)... yes\r\nchecking whether make supports the include directive... yes (GNU style)\r\nchecking dependency style of gcc... gcc3\r\nchecking curl version... 8.7.1\r\nchecking for httpd... no\r\nchecking for apache2... no\r\nchecking for apachectl... no\r\nchecking for apxs... no\r\nconfigure: httpd/apache2 not in PATH, http tests disabled\r\nconfigure: apxs not in PATH, http tests disabled\r\nchecking for nghttpx... no\r\nchecking for caddy... no\r\nchecking build system type... x86_64-pc-linux-gnu\r\nchecking host system type... x86_64-pc-linux-gnu\r\nchecking for egrep -e... /usr/bin/grep -E\r\nchecking if OS is AIX (to define _ALL_SOURCE)... no\r\nchecking if _THREAD_SAFE is already defined... no\r\nchecking if _THREAD_SAFE is actually needed... no\r\nchecking if _THREAD_SAFE is onwards defined... no\r\nchecking if _REENTRANT is already defined... no\r\nchecking if _REENTRANT is actually needed... no\r\nchecking if _REENTRANT is onwards defined... no\r\nchecking for gcc option to enable large file support... none needed\r\nchecking how to print strings... printf\r\nchecking for a sed that does not truncate output... (cached) /usr/bin/sed\r\nchecking for grep that handles long lines and -e... (cached) /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for fgrep... /usr/bin/grep -F\r\nchecking for ld used by gcc... /usr/bin/ld\r\nchecking if the linker (/usr/bin/ld) is GNU ld... yes\r\nchecking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B\r\nchecking the name lister (/usr/bin/nm -B) interface... BSD nm\r\nchecking whether ln -s works... yes\r\nchecking the maximum length of command line arguments... 1572864\r\nchecking how to convert x86_64-pc-linux-gnu file names to x86_64-pc-linux-gnu format... func_convert_file_noop\r\nchecking how to convert x86_64-pc-linux-gnu file names to toolchain format... func_convert_file_noop\r\nchecking for /usr/bin/ld option to reload object files... -r\r\nchecking for file... file\r\nchecking for objdump... objdump\r\nchecking how to recognize dependent libraries... pass_all\r\nchecking for dlltool... no\r\nchecking how to associate runtime and link libraries... printf %s\\n\r\nchecking for archiver @FILE support... @\r\nchecking for strip... strip\r\nchecking for ranlib... ranlib\r\nchecking command to parse /usr/bin/nm -B output from gcc object... ok\r\nchecking for sysroot... no\r\nchecking for a working dd... /usr/bin/dd\r\nchecking how to truncate binary pipes... /usr/bin/dd bs=4096 count=1\r\nchecking for mt... no\r\nchecking if : is a manifest tool... no\r\nchecking for dlfcn.h... yes\r\nchecking for objdir... .libs\r\nchecking if gcc supports -fno-rtti -fno-exceptions... no\r\nchecking for gcc option to produce PIC... -fPIC -DPIC\r\nchecking if gcc PIC flag -fPIC -DPIC works... yes\r\nchecking if gcc static flag -static works... yes\r\nchecking if gcc supports -c -o file.o... yes\r\nchecking if gcc supports -c -o file.o... (cached) yes\r\nchecking whether the gcc linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking dynamic linker characteristics... GNU/Linux ld.so\r\nchecking how to hardcode library paths into programs... immediate\r\nchecking whether stripping libraries is possible... yes\r\nchecking if libtool supports shared libraries... yes\r\nchecking whether to build shared libraries... no\r\nchecking whether to build static libraries... yes\r\nchecking whether to build shared libraries with -version-info... yes\r\nchecking whether to build shared libraries with -no-undefined... no\r\nchecking whether to build shared libraries with -mimpure-text... no\r\nchecking whether to build shared libraries with PIC... yes\r\nchecking whether to build static libraries with PIC... yes\r\nchecking whether to build shared libraries only... no\r\nchecking whether to build static libraries only... yes\r\nchecking for windres... no\r\nchecking for inline... inline\r\nchecking if cpp -P is needed... yes\r\nchecking if cpp -P works... yes\r\nchecking if compiler is DEC/Compaq/HP C... no\r\nchecking if compiler is HP-UX C... no\r\nchecking if compiler is IBM C... no\r\nchecking if compiler is Intel C... no\r\nchecking if compiler is clang... no\r\nchecking if compiler is GNU C... yes\r\nchecking compiler version... gcc '1302' (raw: '13.2.1')\r\nchecking if compiler is SGI MIPSpro C... no\r\nchecking if compiler is SGI MIPS C... no\r\nchecking if compiler is SunPro C... no\r\nchecking if compiler is Tiny C... no\r\nchecking whether build target is a native Windows one... no\r\nchecking if compiler accepts some basic options... yes\r\nconfigure: compiler options added: -Werror-implicit-function-declaration \r\nchecking if compiler optimizer assumed setting might be used... no\r\nchecking if compiler accepts strict warning options... yes\r\nconfigure: compiler options added: -Wno-system-headers \r\nchecking if compiler halts on compilation errors... yes\r\nchecking if compiler halts on negative sized arrays... yes\r\nchecking if compiler halts on function prototype mismatch... yes\r\nchecking if compiler supports hiding library internal symbols... yes\r\nchecking whether build target supports WIN32 file API... no\r\nchecking whether build target supports WIN32 crypto API... no\r\nchecking for good-to-use Darwin CFLAGS... no\r\nchecking whether to link macOS CoreFoundation, CoreServices, and SystemConfiguration frameworks... no\r\nchecking to see if the compiler supports __builtin_available()... no\r\nchecking whether to support http... yes\r\nchecking whether to support ftp... yes\r\nchecking whether to support file... yes\r\nchecking whether to support ldap... no\r\nchecking whether to support ldaps... no\r\nchecking whether to support rtsp... yes\r\nchecking whether to support proxies... yes\r\nchecking whether to support dict... yes\r\nchecking whether to support telnet... yes\r\nchecking whether to support tftp... yes\r\nchecking whether to support pop3... yes\r\nchecking whether to support imap... yes\r\nchecking whether to support smb... yes\r\nchecking whether to support smtp... yes\r\nchecking whether to support gopher... yes\r\nchecking whether to support mqtt... no\r\nchecking whether to build documentation... yes\r\nchecking whether to provide built-in manual... no\r\nchecking whether to enable generation of C code... yes\r\nchecking whether to use libgcc... no\r\nchecking if X/Open network library is required... no\r\nchecking for gethostbyname... yes\r\nchecking whether build target is a native Windows one... (cached) no\r\nchecking for proto/bsdsocket.h... no\r\nchecking for connect in libraries... yes\r\nchecking for sys/types.h... (cached) yes\r\nchecking for sys/time.h... yes\r\nchecking for monotonic clock_gettime... yes\r\nchecking for clock_gettime in libraries... no additional lib required\r\nchecking if monotonic clock_gettime works... yes\r\nchecking for sys/types.h... (cached) yes\r\nchecking for sys/time.h... (cached) yes\r\nchecking for raw monotonic clock_gettime... yes\r\nchecking for pkg-config... /usr/bin/pkg-config\r\nchecking for zlib options with pkg-config... found\r\nchecking for zlib.h... yes\r\nconfigure: found both libz and libz.h header\r\nchecking for BrotliDecoderDecompress in -lbrotlidec... yes\r\nchecking for brotli/decode.h... yes\r\nchecking for ZSTD_createDStream in -lzstd... yes\r\nchecking for zstd.h... yes\r\nchecking whether to enable IPv6... yes\r\nchecking if struct sockaddr_in6 has sin6_scope_id member... yes\r\nchecking if argv can be written to... yes\r\nchecking if GSS-API support is requested... yes\r\nchecking for pkg-config... (cached) /usr/bin/pkg-config\r\nchecking for mit-krb5-gssapi options with pkg-config... found\r\nchecking for gss.h... no\r\nchecking for gssapi/gssapi.h... yes\r\nchecking for gssapi/gssapi_generic.h... yes\r\nchecking for gssapi/gssapi_krb5.h... yes\r\nchecking if GSS-API headers declare GSS_C_NT_HOSTBASED_SERVICE... yes\r\nchecking for pkg-config... (cached) /usr/bin/pkg-config\r\nchecking for mit-krb5-gssapi options with pkg-config... found\r\nchecking if we can link against GSS-API library... yes\r\nchecking whether to enable Windows native SSL/TLS... no\r\nchecking whether to enable Secure Transport... no\r\nchecking whether to enable Amiga native SSL/TLS (AmiSSL v5)... no\r\nchecking for pkg-config... (cached) /usr/bin/pkg-config\r\nchecking for rustls options with pkg-config... found\r\nconfigure: pkg-config: SSL_LIBS: \"-lrustls\"\r\nconfigure: pkg-config: SSL_LDFLAGS: \"\"\r\nconfigure: pkg-config: SSL_CPPFLAGS: \"\"\r\nconfigure: detected rustls\r\nconfigure: error: TLS not detected, you will not be able to use HTTPS, FTPS, NTLM and more.\r\nUse --with-openssl, --with-gnutls, --with-wolfssl, --with-mbedtls, --with-schannel, --with-secure-transport, --with-amissl, --with-bearssl or --with-rustls to address this.\r\n```\r\n\r\n</details>\n\n### I expected the following\n\nThe build passes without reverting any commits.\n\n### curl/libcurl version\n\ncurl 8.7.1\n\n### operating system\n\nArch Linux","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13200/timeline","performed_via_github_app":null,"state_reason":"completed"}