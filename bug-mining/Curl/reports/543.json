{"url":"https://api.github.com/repos/curl/curl/issues/14879","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/14879/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/14879/comments","events_url":"https://api.github.com/repos/curl/curl/issues/14879/events","html_url":"https://github.com/curl/curl/issues/14879","id":2522007641,"node_id":"I_kwDOAAiu0c6WUshZ","number":14879,"title":"cURL 8.10.0 --with-ca-bundle not work","user":{"login":"rampageX","id":994081,"node_id":"MDQ6VXNlcjk5NDA4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/994081?v=4","gravatar_id":"","url":"https://api.github.com/users/rampageX","html_url":"https://github.com/rampageX","followers_url":"https://api.github.com/users/rampageX/followers","following_url":"https://api.github.com/users/rampageX/following{/other_user}","gists_url":"https://api.github.com/users/rampageX/gists{/gist_id}","starred_url":"https://api.github.com/users/rampageX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rampageX/subscriptions","organizations_url":"https://api.github.com/users/rampageX/orgs","repos_url":"https://api.github.com/users/rampageX/repos","events_url":"https://api.github.com/users/rampageX/events{/privacy}","received_events_url":"https://api.github.com/users/rampageX/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":192912238,"node_id":"MDU6TGFiZWwxOTI5MTIyMzg=","url":"https://api.github.com/repos/curl/curl/labels/cmdline%20tool","name":"cmdline tool","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2024-09-12T10:35:04Z","updated_at":"2024-09-12T23:39:17Z","closed_at":"2024-09-12T17:58:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nI cross compile cURL 8.10.0 on alpine for armv5 device, configuire:\r\n\r\n```\r\n    CC=${host}-gcc CXX=${host}-g++ CPPFLAGS=\"${CPPFLAGS}\" LDFLAGS=\"${LDFLAGS}\" \\\r\n    LDFLAGS=\"--static -static -Wl,--no-as-needed -L${lib_dir}\" LIBS=\"-lpthread\" \\\r\n    LD_LIBRARY_PATH=\"-L${lib_dir}\" PKG_CONFIG_PATH=\"${lib_dir}/pkgconfig\" \\\r\n    ./configure \\\r\n    --build=\"x86_64-alpine-linux-musl\" \\\r\n    --host=\"${host}\" \\\r\n    --target=\"${host}\" \\\r\n    --prefix=\"${install_dir}\" \\\r\n    --enable-static --disable-shared \\\r\n    --with-openssl \"${with_openssl_quic}\" --with-brotli --with-zstd \\\r\n    --with-nghttp2 --with-nghttp3 \\\r\n    --with-libidn2 --with-libssh2 \\\r\n    --enable-hsts --enable-mime --enable-cookies \\\r\n    --enable-http-auth --enable-manual \\\r\n    --enable-proxy --enable-file --enable-http \\\r\n    --enable-ftp --enable-telnet --enable-tftp \\\r\n    --enable-pop3 --enable-imap --enable-smtp \\\r\n    --enable-gopher --enable-mqtt \\\r\n    --enable-doh --enable-dateparse --enable-verbose \\\r\n    --enable-alt-svc --enable-websockets \\\r\n    --enable-ipv6 --enable-unix-sockets --enable-socketpair \\\r\n    --enable-headers-api --enable-versioned-symbols \\\r\n    --enable-threaded-resolver --enable-optimize --enable-pthreads \\\r\n    --enable-warnings --enable-werror \\\r\n    --enable-curldebug --enable-dict --enable-netrc \\\r\n    --enable-bearer-auth --enable-tls-srp --enable-dnsshuffle \\\r\n    --enable-get-easy-options --enable-progress-meter \\\r\n    --enable-ares --disable-ldap --disable-ldaps \\\r\n    --with-ca-embed=/root/src/curl-ca-bundle.crt \\\r\n    --with-ca-bundle=/etc/ssl/certs/ca-certificates.crt \\\r\n    --with-ca-path=/etc/ssl/certs \\\r\n    --with-ca-fallback\r\n```\r\n\r\nI got the result:\r\n\r\n```\r\n/tmp/curl -V\r\ncurl 8.10.0 (arm-unknown-linux-musleabi) libcurl/8.10.0 quictls/3.1.5 zlib/1.3.1 brotli/1.1.0 zstd/1.5.6 c-ares/1.32.3 libpsl/0.21.5 libssh2/1.11.0 nghttp2/1.62.1 ngtcp2/1.6.0 nghttp3/1.4.0\r\nRelease-Date: 2024-09-11\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss\r\nFeatures: alt-svc AsynchDNS brotli CAcert HSTS HTTP2 HTTP3 HTTPS-proxy IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP TrackMemory UnixSockets zstd\r\n```\r\n\r\nBut when i run  `/tmp/curl --dump-ca-embed`, nothing output, and failed to connect https site:\r\n\r\n```\r\n/tmp/curl -Iv https://www.msn.com\r\nNote: Using embedded CA bundle (0 bytes)\r\nNote: Using embedded CA bundle, for proxies (0 bytes)\r\n* Host www.msn.com:443 was resolved.\r\n* IPv6: (none)\r\n* IPv4: 204.79.197.203\r\n*   Trying 204.79.197.203:443...\r\n* Connected to www.msn.com () port 443\r\n* ALPN: curl offers h2,http/1.1\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n* error importing CA certificate blob\r\n* error importing CA certificate blob\r\n* closing connection #0\r\ncurl: (77) error importing CA certificate blob\r\n```\n\n### I expected the following\n\ncURL should success use embedded CA.\n\n### curl/libcurl version\n\ncurl 8.10.0 (arm-unknown-linux-musleabi) libcurl/8.10.0 quictls/3.1.5 zlib/1.3.1 brotli/1.1.0 zstd/1.5.6 c-ares/1.32.3 libpsl/0.21.5 libssh2/1.11.0 nghttp2/1.62.1 ngtcp2/1.6.0 nghttp3/1.4.0\r\nRelease-Date: 2024-09-11\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss\r\nFeatures: alt-svc AsynchDNS brotli CAcert HSTS HTTP2 HTTP3 HTTPS-proxy IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP TrackMemory UnixSockets zstd\n\n### operating system\n\nLinux rt-ac5300 2.6.36.4brcmarm #8 SMP PREEMPT Thu Aug 1 21:48:58 CEST 2024 armv7l GNU/Linux","closed_by":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/14879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/14879/timeline","performed_via_github_app":null,"state_reason":"completed"}