{"url":"https://api.github.com/repos/curl/curl/issues/14761","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/14761/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/14761/comments","events_url":"https://api.github.com/repos/curl/curl/issues/14761/events","html_url":"https://github.com/curl/curl/issues/14761","id":2501274057,"node_id":"I_kwDOAAiu0c6VFmnJ","number":14761,"title":"IPv4 prioritized over IPv6 for local server with custom DNS server","user":{"login":"janedenone","id":81964406,"node_id":"MDQ6VXNlcjgxOTY0NDA2","avatar_url":"https://avatars.githubusercontent.com/u/81964406?v=4","gravatar_id":"","url":"https://api.github.com/users/janedenone","html_url":"https://github.com/janedenone","followers_url":"https://api.github.com/users/janedenone/followers","following_url":"https://api.github.com/users/janedenone/following{/other_user}","gists_url":"https://api.github.com/users/janedenone/gists{/gist_id}","starred_url":"https://api.github.com/users/janedenone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janedenone/subscriptions","organizations_url":"https://api.github.com/users/janedenone/orgs","repos_url":"https://api.github.com/users/janedenone/repos","events_url":"https://api.github.com/users/janedenone/events{/privacy}","received_events_url":"https://api.github.com/users/janedenone/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":13,"created_at":"2024-09-02T16:02:21Z","updated_at":"2024-09-12T19:14:29Z","closed_at":"2024-09-03T14:26:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nIn my dual-stack LAN, a bind server resolves local domains (`*.something.internal`) for both A and AAAA records, and all LAN webservers listen on IPv4 and IPv6. When accessing the servers, IPv6 gets prioritized (as expected) for all webservers except for my local client (which also acts as a webserver):\r\n\r\n```\r\n# This is my local client and webserver\r\ncurl -Iv https://static.something.internal/\r\n* Host static.something.internal:443 was resolved.\r\n* IPv6: 2001:908:45a1:bca0:10e0:6db1:72f1:9c2f\r\n* IPv4: 192.168.78.55\r\n*   Trying 192.168.78.55:443...\r\n* Connected to static.something.internal (192.168.78.55) port 443\r\n\r\n# This is another webserver on the LAN\r\ncurl -Iv https://nuc.something.internal/\r\n* Host nuc.something.internal:443 was resolved.\r\n* IPv6: 2001:908:45a1:bca0:1e69:7aff:feaf:7455\r\n* IPv4: 192.168.78.42\r\n*   Trying [2001:908:45a1:bca0:1e69:7aff:feaf:7455]:443...\r\n* Connected to nuc.something.internal (2001:908:45a1:bca0:1e69:7aff:feaf:7455) port 443\r\n```\r\n\r\nFirefox and Safari behave exactly the same, while Chrome uses IPv6 addresses for all servers. I used the Network tab of the developer tools in all three browsers to compare and verify the behavior.\r\n\r\nIf I populate `/etc/hosts` on the local machine (using 127.0.0.1 and ::1 for its domains) instead of using my DNS server, all applications (including Firefox and Safari) prioritize IPv6:\r\n\r\n```\r\ncurl -Iv https://static.something.internal/\r\n* Host static.something.internal:443 was resolved.\r\n* IPv6: ::1\r\n* IPv4: 127.0.0.1\r\n*   Trying [::1]:443...\r\n* Connected to static.something.internal (::1) port 443\r\n```\n\n### I expected the following\n\nI would expect curl to always prioritize IPv6, especially since #11465 was solved in September 2023.\n\n### curl/libcurl version\n\ncurl 8.9.1 (aarch64-apple-darwin23.4.0) libcurl/8.9.1 OpenSSL/3.3.1 (SecureTransport) zlib/1.2.12 brotli/1.1.0 zstd/1.5.6 libidn2/2.3.7 libssh2/1.11.0 nghttp2/1.61.0 librtmp/2.3\r\nRelease-Date: 2024-07-31\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz MultiSSL NTLM SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\n\n### operating system\n\nmacOS 14.6.1","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/14761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/14761/timeline","performed_via_github_app":null,"state_reason":"completed"}