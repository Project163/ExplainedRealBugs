{"url":"https://api.github.com/repos/curl/curl/issues/17042","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17042/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17042/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17042/events","html_url":"https://github.com/curl/curl/issues/17042","id":2990606304,"node_id":"I_kwDOAAiu0c6yQQfg","number":17042,"title":"Use generator expressions for variables instead of branching ifs, which don't work on multi-config generators.","user":{"login":"Please-just-dont","id":149666358,"node_id":"U_kgDOCOu6Ng","avatar_url":"https://avatars.githubusercontent.com/u/149666358?v=4","gravatar_id":"","url":"https://api.github.com/users/Please-just-dont","html_url":"https://github.com/Please-just-dont","followers_url":"https://api.github.com/users/Please-just-dont/followers","following_url":"https://api.github.com/users/Please-just-dont/following{/other_user}","gists_url":"https://api.github.com/users/Please-just-dont/gists{/gist_id}","starred_url":"https://api.github.com/users/Please-just-dont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Please-just-dont/subscriptions","organizations_url":"https://api.github.com/users/Please-just-dont/orgs","repos_url":"https://api.github.com/users/Please-just-dont/repos","events_url":"https://api.github.com/users/Please-just-dont/events{/privacy}","received_events_url":"https://api.github.com/users/Please-just-dont/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184123162,"node_id":"MDU6TGFiZWwxODQxMjMxNjI=","url":"https://api.github.com/repos/curl/curl/labels/cmake","name":"cmake","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-04-12T17:54:08Z","updated_at":"2025-04-14T00:08:38Z","closed_at":"2025-04-14T00:08:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nMSVC and XCode are what are known as multi-config generators, and it's not possible to branch on CMAKE_BUILD_TYPE using if statements. Meaning, that if in Curl CMakeLists the condition of whether to enable LTO (interprocedural optimization) looks like this:\n\n`if (USE_LTO) `\n\nThen it can never work with MSVC or XCode, is my understanding. I guess this is a limitation of CMake.\n\nIn my code I want to enable LTO in Debug mode, so I do:\n`\nset(CURL_LTO $<$<CONFIG:DEBUG>:TRUE> CACHE BOOL \"\")`\n\nBut then when Curl checks this variable to decide whether to enable LTO, it's too early, as generator expressions don't work in if statements.\n\n\nSuggestion:\n\nAs far as I know, generator expressions work with multi-config and non multi-config generators. The relevant part in CMakeLists.txt is:\n\n```\nif(CURL_LTO)\n  if(CMAKE_VERSION VERSION_LESS 3.9)\n    message(FATAL_ERROR \"LTO has been requested, but your cmake version ${CMAKE_VERSION} is to old. You need at least 3.9\")\n  endif()\n\n  cmake_policy(SET CMP0069 NEW)\n\n  include(CheckIPOSupported)\n  check_ipo_supported(RESULT CURL_HAS_LTO OUTPUT _lto_error LANGUAGES C)\n  if(CURL_HAS_LTO)\n    message(STATUS \"LTO supported and enabled\")\n  else()\n    message(FATAL_ERROR \"LTO has been requested, but the compiler does not support it\\n${_lto_error}\")\n  endif()\nendif()\n```\n\nThe user sets CURL_LTO with a generator expression, or a simple set, both should work. And then in the lib CMakeLists.txt:\n\nchange:\n```\n  if(CURL_HAS_LTO)\n    set_target_properties(${LIB_OBJECT} PROPERTIES INTERPROCEDURAL_OPTIMIZATION TRUE)\n  endif()\n```\n\nto \n\n\n`set_target_properties(${LIB_OBJECT} PROPERTIES INTERPROCEDURAL_OPTIMIZATION $<CURL_LTO:TRUE>)`\n\nThis should work on CURL_LTO variables set through normal 'set' and set through generator expressions, and will get rid of inconsistent settings at build time (I got warnings on MSVC that that LTCG wasn't set, or something like that.) Someone who knows CMake better can come up with something better. Just to reiterate, it's my belief that this won't change behaviour with users who have already set CURL_LTO through a simple variable (non-generator-expression) variable, I think.\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\nLatest, linking from source code.\n\n### operating system\n\nWindows, Linux.","closed_by":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17042/timeline","performed_via_github_app":null,"state_reason":"completed"}