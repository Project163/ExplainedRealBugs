{"url":"https://api.github.com/repos/curl/curl/issues/18190","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/18190/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/18190/comments","events_url":"https://api.github.com/repos/curl/curl/issues/18190/events","html_url":"https://github.com/curl/curl/issues/18190","id":3294356816,"node_id":"I_kwDOAAiu0c7EW-VQ","number":18190,"title":"`--ca-native`/`CURLSSLOPT_NATIVE_CA` break when cert store contains invalid certs","user":{"login":"MichalPetryka","id":35800402,"node_id":"MDQ6VXNlcjM1ODAwNDAy","avatar_url":"https://avatars.githubusercontent.com/u/35800402?v=4","gravatar_id":"","url":"https://api.github.com/users/MichalPetryka","html_url":"https://github.com/MichalPetryka","followers_url":"https://api.github.com/users/MichalPetryka/followers","following_url":"https://api.github.com/users/MichalPetryka/following{/other_user}","gists_url":"https://api.github.com/users/MichalPetryka/gists{/gist_id}","starred_url":"https://api.github.com/users/MichalPetryka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MichalPetryka/subscriptions","organizations_url":"https://api.github.com/users/MichalPetryka/orgs","repos_url":"https://api.github.com/users/MichalPetryka/repos","events_url":"https://api.github.com/users/MichalPetryka/events{/privacy}","received_events_url":"https://api.github.com/users/MichalPetryka/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""},{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":37,"created_at":"2025-08-05T20:32:34Z","updated_at":"2025-08-09T10:55:48Z","closed_at":"2025-08-08T18:09:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nEnabling `--ca-native`/`CURLSSLOPT_NATIVE_CA` while using OpenSSL (backends other than OpenSSL and SChannel untested) and having invalid certs in Windows cert store makes CURL (both exe and libCurl) error out with:\n```\ncurl: (35) TLS connect error: error:068000DD:asn1 encoding routines::illegal padding\n```\n\nThis causes Serbian users to be unable to use OpenSSL based Curl since for whatever reason the Serbian government has their citizens add invalid certificates to their Windows cert store to access their services.\n\nThis has many other sources referencing the issue with either OpenSSL itself or software related to it:\nhttps://github.com/openssl/openssl/issues/16701\nhttps://github.com/openssl/openssl/issues/25023\nhttps://www.dropboxforum.com/discussions/101001016/installation-fails-for-people-from-serbia-due-to-certificates---solution-windows/490440\nhttps://bugs.python.org/issue45312\nhttps://github.com/python/cpython/issues/79846\n\nSince the linked OpenSSL issues indicate they have no intention of allowing such invalid certs (which some APIs like SChannel seem to do) and suggest filtering off and ignoring such certs on application level, I believe CURL should do so either by default with `--ca-native`/`CURLSSLOPT_NATIVE_CA` or when provided with some new flags since Curl does the cert store loading by itself in:\nhttps://github.com/curl/curl/blob/41fe621ae13616893512df1226025c60f3b148b9/lib/vtls/openssl.c#L3214\n\nAs far as I believe ignoring such certs brings no security implications since not adding them can only cause TLS rejections, not improper acceptances so I'd propose doing it automatically with the current options.\n\nReproduction:\n1. Build Curl with OpenSSL backend\n2. Add the cert from http://crl.mup.gov.rs/MUPCARoot.crt to Windows cert store\n3. curl.exe --ca-native https://api.ipify.org\n\n### I expected the following\n\nCurl is working and ignoring invalid certs that are not necessary to complete the request.\n\n### curl/libcurl version\n\ncurl 8.15.0-DEV (Windows) libcurl/8.15.0-DEV OpenSSL/3.5.1 (Schannel) zlib/1.3.1 brotli/1.1.0 zstd/1.5.7 nghttp2/1.66.0\nRelease-Date: [unreleased]\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp\nFeatures: alt-svc AsynchDNS brotli HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz MultiSSL NTLM SPNEGO SSL SSPI threadsafe TLS-SRP Unicode UnixSockets zstd\n\n### operating system\n\nWindows 10/11","closed_by":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/18190/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/18190/timeline","performed_via_github_app":null,"state_reason":"completed"}