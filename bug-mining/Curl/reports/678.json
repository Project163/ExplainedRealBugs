{"url":"https://api.github.com/repos/curl/curl/issues/16881","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/16881/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/16881/comments","events_url":"https://api.github.com/repos/curl/curl/issues/16881/events","html_url":"https://github.com/curl/curl/issues/16881","id":2959232124,"node_id":"I_kwDOAAiu0c6wYkx8","number":16881,"title":"Rustls: test_09_02_h2_push frequent SIGSEGV in CI","user":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null},{"id":887227423,"node_id":"MDU6TGFiZWw4ODcyMjc0MjM=","url":"https://api.github.com/repos/curl/curl/labels/tests","name":"tests","color":"a7a8e8","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":8,"created_at":"2025-03-31T00:58:17Z","updated_at":"2025-04-01T12:29:28Z","closed_at":"2025-04-01T12:19:35Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nStarted seeing this on Linux in the Rustls job's pytests:\r\n```\r\n=================================== FAILURES ===================================\r\n_________________________ TestPush.test_09_02_h2_push __________________________\r\n\r\nself = <test_09_push.TestPush object at 0x7f2f1c44e330>\r\nenv = <testenv.env.Env object at 0x7f2f1c479d60>\r\nhttpd = <testenv.httpd.Httpd object at 0x7f2f1c479e20>\r\n\r\n    def test_09_02_h2_push(self, env: Env, httpd):\r\n        # use localhost as we do not have resolve support in local client\r\n        url = f'https://localhost:{env.https_port}/push/data1'\r\n        client = LocalClient(name='h2-serverpush', env=env)\r\n        if not client.exists():\r\n            pytest.skip(f'example client not built: {client.name}')\r\n        r = client.run(args=[url])\r\n>       r.check_exit_code(0)\r\n\r\n../../tests/http/test_09_push.py:82: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = ExecResult[code=-11, exception=None, args=['/home/runner/work/curl/curl/bld/tests/../tests/http/clients/h2-serverpush'...tes (0x2f)\\n', '0000: server: Apache/2.4.58 (Ubuntu) OpenSSL/3.0.13\\n', '<= Recv header, 2 bytes (0x2)\\n', '0000: \\n']]\r\ncode = 0\r\n\r\n    def check_exit_code(self, code: Union[int, bool]):\r\n        if code is True:\r\n            assert self.exit_code == 0, f'expected exit code {code}, '\\\r\n                                        f'got {self.exit_code}\\n{self.dump_logs()}'\r\n        elif code is False:\r\n            assert self.exit_code != 0, f'expected exit code {code}, '\\\r\n                                                f'got {self.exit_code}\\n{self.dump_logs()}'\r\n        else:\r\n>           assert self.exit_code == code, f'expected exit code {code}, '\\\r\n                                           f'got {self.exit_code}\\n{self.dump_logs()}'\r\nE           AssertionError: expected exit code 0, got -11\r\nE             >>--stdout ----------------------------------------------\r\nE             >>--stderr ----------------------------------------------\r\nE             == Info: !!! WARNING !!!\r\nE             == Info: This is a debug build of libcurl, do not use in production.\r\nE             == Info: Host localhost:44991 was resolved.\r\nE             == Info: IPv6: ::1\r\nE             == Info: IPv4: 127.0.0.1\r\nE             == Info:   Trying [::1]:44991...\r\nE             == Info: ALPN: curl offers h2,http/1.1\r\nE             == Info: ALPN: server accepted h2\r\nE             == Info: rustls: handshake complete, TLSv1.3, cipher: TLS_AES_256_GCM_SHA384\r\nE             == Info: Connected to localhost (::1) port 44991\r\nE             == Info: using HTTP/2\r\nE             == Info: sending last upload chunk of 62 bytes\r\nE             == Info: [HTTP/2] [1] OPENED stream for https://localhost:44991/push/data1\r\nE             == Info: [HTTP/2] [1] [:method: GET]\r\nE             == Info: [HTTP/2] [1] [:scheme: https]\r\nE             == Info: [HTTP/2] [1] [:authority: localhost:44991]\r\nE             == Info: [HTTP/2] [1] [:path: /push/data1]\r\nE             == Info: [HTTP/2] [1] [accept: */*]\r\nE             == Info: Curl_xfer_send(len=62, eos=1) -> 0, 62\r\nE             => Send header, 62 bytes (0x3e)\r\nE             0000: GET /push/data1 HTTP/2\r\nE             0018: Host: localhost:44991\r\nE             002f: Accept: */*\r\nE             003c: \r\nE             == Info: Request completely sent off\r\nE             **** push callback approves stream 1, got 6 headers!\r\nE             **** header 0: :scheme:https\r\nE             **** header 1: :authority:localhost:44991\r\nE             **** header 2: :path:/push/data2\r\nE             **** header 3: :method:GET\r\nE             **** header 4: accept:*/*\r\nE             **** header 5: host:localhost:44991\r\nE             **** The PATH is /push/data2\r\nE             == Info: HTTP/2 found, allow multiplexing\r\nE             <= Recv header, 13 bytes (0xd)\r\nE             0000: HTTP/2 103 \r\nE             <= Recv header, 34 bytes (0x22)\r\nE             0000: link: </push/data2>; rel=preload\r\nE             <= Recv header, 22 bytes (0x16)\r\nE             0000: push-policy: default\r\nE             <= Recv header, 2 bytes (0x2)\r\nE             0000: \r\nE             == Info: http/2 recv on a transfer never opened or already cleared, mid=1\r\nE             == Info: sendrecv_dl() -> 16\r\nE             == Info: Curl_sendrecv() -> 16\r\nE             == Info: HTTP/2 found, allow multiplexing\r\nE             <= Recv header, 13 bytes (0xd)\r\nE             0000: HTTP/2 200 \r\nE             <= Recv header, 46 bytes (0x2e)\r\nE             0000: last-modified: Sun, 30 Mar 2025 21:35:23 GMT\r\nE             <= Recv header, 29 bytes (0x1d)\r\nE             0000: etag: W/\"400-6319614c9dd17\"\r\nE             <= Recv header, 22 bytes (0x16)\r\nE             0000: accept-ranges: bytes\r\nE             <= Recv header, 22 bytes (0x16)\r\nE             0000: content-length: 1024\r\nE             <= Recv header, 37 bytes (0x25)\r\nE             0000: date: Sun, 30 Mar 2025 21:35:23 GMT\r\nE             <= Recv header, 47 bytes (0x2f)\r\nE             0000: server: Apache/2.4.58 (Ubuntu) OpenSSL/3.0.13\r\nE             <= Recv header, 2 bytes (0x2)\r\nE             0000: \r\nE             <<-------------------------------------------------------\r\nE             \r\nE           assert -11 == 0\r\nE            +  where -11 = ExecResult[code=-11, exception=None, args=['/home/runner/work/curl/curl/bld/tests/../tests/http/clients/h2-serverpush', 'https://localhost:44991/push/data1'], stdout=[], stderr=['== Info: !!! WARNING !!!\\n', '== Info: This is a debug build of libcurl, do not use in production.\\n', '== Info: Host localhost:44991 was resolved.\\n', '== Info: IPv6: ::1\\n', '== Info: IPv4: 127.0.0.1\\n', '== Info:   Trying [::1]:44991...\\n', '== Info: ALPN: curl offers h2,http/1.1\\n', '== Info: ALPN: server accepted h2\\n', '== Info: rustls: handshake complete, TLSv1.3, cipher: TLS_AES_256_GCM_SHA384\\n', '== Info: Connected to localhost (::1) port 44991\\n', '== Info: using HTTP/2\\n', '== Info: sending last upload chunk of 62 bytes\\n', '== Info: [HTTP/2] [1] OPENED stream for https://localhost:44991/push/data1\\n', '== Info: [HTTP/2] [1] [:method: GET]\\n', '== Info: [HTTP/2] [1] [:scheme: https]\\n', '== Info: [HTTP/2] [1] [:authority: localhost:44991]\\n', '== Info: [HTTP/2] [1] [:path: /push/data1]\\n', '== Info: [HTTP/2] [1] [accept: */*]\\n', '== Info: Curl_xfer_send(len=62, eos=1) -> 0, 62\\n', '=> Send header, 62 bytes (0x3e)\\n', '0000: GET /push/data1 HTTP/2\\n', '0018: Host: localhost:44991\\n', '002f: A...', '**** header 4: accept:*/*\\n', '**** header 5: host:localhost:44991\\n', '**** The PATH is /push/data2\\n', '== Info: HTTP/2 found, allow multiplexing\\n', '<= Recv header, 13 bytes (0xd)\\n', '0000: HTTP/2 103 \\n', '<= Recv header, 34 bytes (0x22)\\n', '0000: link: </push/data2>; rel=preload\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: push-policy: default\\n', '<= Recv header, 2 bytes (0x2)\\n', '0000: \\n', '== Info: http/2 recv on a transfer never opened or already cleared, mid=1\\n', '== Info: sendrecv_dl() -> 16\\n', '== Info: Curl_sendrecv() -> 16\\n', '== Info: HTTP/2 found, allow multiplexing\\n', '<= Recv header, 13 bytes (0xd)\\n', '0000: HTTP/2 200 \\n', '<= Recv header, 46 bytes (0x2e)\\n', '0000: last-modified: Sun, 30 Mar 2025 21:35:23 GMT\\n', '<= Recv header, 29 bytes (0x1d)\\n', '0000: etag: W/\"400-6319614c9dd17\"\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: accept-ranges: bytes\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: content-length: 1024\\n', '<= Recv header, 37 bytes (0x25)\\n', '0000: date: Sun, 30 Mar 2025 21:35:23 GMT\\n', '<= Recv header, 47 bytes (0x2f)\\n', '0000: server: Apache/2.4.58 (Ubuntu) OpenSSL/3.0.13\\n', '<= Recv header, 2 bytes (0x2)\\n', '0000: \\n']].exit_code\r\n\r\n../../tests/http/testenv/curl.py:326: AssertionError\r\n=========================== short test summary info ============================\r\nFAILED ../../tests/http/test_09_push.py::TestPush::test_09_02_h2_push - AssertionError: expected exit code 0, got -11\r\n  >>--stdout ----------------------------------------------\r\n  >>--stderr ----------------------------------------------\r\n  == Info: !!! WARNING !!!\r\n  == Info: This is a debug build of libcurl, do not use in production.\r\n  == Info: Host localhost:44991 was resolved.\r\n  == Info: IPv6: ::1\r\n  == Info: IPv4: 127.0.0.1\r\n  == Info:   Trying [::1]:44991...\r\n  == Info: ALPN: curl offers h2,http/1.1\r\n  == Info: ALPN: server accepted h2\r\n  == Info: rustls: handshake complete, TLSv1.3, cipher: TLS_AES_256_GCM_SHA384\r\n  == Info: Connected to localhost (::1) port 44991\r\n  == Info: using HTTP/2\r\n  == Info: sending last upload chunk of 62 bytes\r\n  == Info: [HTTP/2] [1] OPENED stream for https://localhost:44991/push/data1\r\n  == Info: [HTTP/2] [1] [:method: GET]\r\n  == Info: [HTTP/2] [1] [:scheme: https]\r\n  == Info: [HTTP/2] [1] [:authority: localhost:44991]\r\n  == Info: [HTTP/2] [1] [:path: /push/data1]\r\n  == Info: [HTTP/2] [1] [accept: */*]\r\n  == Info: Curl_xfer_send(len=62, eos=1) -> 0, 62\r\n  => Send header, 62 bytes (0x3e)\r\n  0000: GET /push/data1 HTTP/2\r\n  0018: Host: localhost:44991\r\n  002f: Accept: */*\r\n  003c: \r\n  == Info: Request completely sent off\r\n  **** push callback approves stream 1, got 6 headers!\r\n  **** header 0: :scheme:https\r\n  **** header 1: :authority:localhost:44991\r\n  **** header 2: :path:/push/data2\r\n  **** header 3: :method:GET\r\n  **** header 4: accept:*/*\r\n  **** header 5: host:localhost:44991\r\n  **** The PATH is /push/data2\r\n  == Info: HTTP/2 found, allow multiplexing\r\n  <= Recv header, 13 bytes (0xd)\r\n  0000: HTTP/2 103 \r\n  <= Recv header, 34 bytes (0x22)\r\n  0000: link: </push/data2>; rel=preload\r\n  <= Recv header, 22 bytes (0x16)\r\n  0000: push-policy: default\r\n  <= Recv header, 2 bytes (0x2)\r\n  0000: \r\n  == Info: http/2 recv on a transfer never opened or already cleared, mid=1\r\n  == Info: sendrecv_dl() -> 16\r\n  == Info: Curl_sendrecv() -> 16\r\n  == Info: HTTP/2 found, allow multiplexing\r\n  <= Recv header, 13 bytes (0xd)\r\n  0000: HTTP/2 200 \r\n  <= Recv header, 46 bytes (0x2e)\r\n  0000: last-modified: Sun, 30 Mar 2025 21:35:23 GMT\r\n  <= Recv header, 29 bytes (0x1d)\r\n  0000: etag: W/\"400-6319614c9dd17\"\r\n  <= Recv header, 22 bytes (0x16)\r\n  0000: accept-ranges: bytes\r\n  <= Recv header, 22 bytes (0x16)\r\n  0000: content-length: 1024\r\n  <= Recv header, 37 bytes (0x25)\r\n  0000: date: Sun, 30 Mar 2025 21:35:23 GMT\r\n  <= Recv header, 47 bytes (0x2f)\r\n  0000: server: Apache/2.4.58 (Ubuntu) OpenSSL/3.0.13\r\n  <= Recv header, 2 bytes (0x2)\r\n  0000: \r\n  <<-------------------------------------------------------\r\n  \r\nassert -11 == 0\r\n +  where -11 = ExecResult[code=-11, exception=None, args=['/home/runner/work/curl/curl/bld/tests/../tests/http/clients/h2-serverpush', 'https://localhost:44991/push/data1'], stdout=[], stderr=['== Info: !!! WARNING !!!\\n', '== Info: This is a debug build of libcurl, do not use in production.\\n', '== Info: Host localhost:44991 was resolved.\\n', '== Info: IPv6: ::1\\n', '== Info: IPv4: 127.0.0.1\\n', '== Info:   Trying [::1]:44991...\\n', '== Info: ALPN: curl offers h2,http/1.1\\n', '== Info: ALPN: server accepted h2\\n', '== Info: rustls: handshake complete, TLSv1.3, cipher: TLS_AES_256_GCM_SHA384\\n', '== Info: Connected to localhost (::1) port 44991\\n', '== Info: using HTTP/2\\n', '== Info: sending last upload chunk of 62 bytes\\n', '== Info: [HTTP/2] [1] OPENED stream for https://localhost:44991/push/data1\\n', '== Info: [HTTP/2] [1] [:method: GET]\\n', '== Info: [HTTP/2] [1] [:scheme: https]\\n', '== Info: [HTTP/2] [1] [:authority: localhost:44991]\\n', '== Info: [HTTP/2] [1] [:path: /push/data1]\\n', '== Info: [HTTP/2] [1] [accept: */*]\\n', '== Info: Curl_xfer_send(len=62, eos=1) -> 0, 62\\n', '=> Send header, 62 bytes (0x3e)\\n', '0000: GET /push/data1 HTTP/2\\n', '0018: Host: localhost:44991\\n', '002f: A...', '**** header 4: accept:*/*\\n', '**** header 5: host:localhost:44991\\n', '**** The PATH is /push/data2\\n', '== Info: HTTP/2 found, allow multiplexing\\n', '<= Recv header, 13 bytes (0xd)\\n', '0000: HTTP/2 103 \\n', '<= Recv header, 34 bytes (0x22)\\n', '0000: link: </push/data2>; rel=preload\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: push-policy: default\\n', '<= Recv header, 2 bytes (0x2)\\n', '0000: \\n', '== Info: http/2 recv on a transfer never opened or already cleared, mid=1\\n', '== Info: sendrecv_dl() -> 16\\n', '== Info: Curl_sendrecv() -> 16\\n', '== Info: HTTP/2 found, allow multiplexing\\n', '<= Recv header, 13 bytes (0xd)\\n', '0000: HTTP/2 200 \\n', '<= Recv header, 46 bytes (0x2e)\\n', '0000: last-modified: Sun, 30 Mar 2025 21:35:23 GMT\\n', '<= Recv header, 29 bytes (0x1d)\\n', '0000: etag: W/\"400-6319614c9dd17\"\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: accept-ranges: bytes\\n', '<= Recv header, 22 bytes (0x16)\\n', '0000: content-length: 1024\\n', '<= Recv header, 37 bytes (0x25)\\n', '0000: date: Sun, 30 Mar 2025 21:35:23 GMT\\n', '<= Recv header, 47 bytes (0x2f)\\n', '0000: server: Apache/2.4.58 (Ubuntu) OpenSSL/3.0.13\\n', '<= Recv header, 2 bytes (0x2)\\n', '0000: \\n']].exit_code\r\n============ 1 failed, 500 passed, 226 skipped in 96.49s (0:01:36) =============\r\nFAILED: tests/CMakeFiles/curl-pytest-ci /home/runner/work/curl/curl/bld/tests/CMakeFiles/curl-pytest-ci \r\ncd /home/runner/work/curl/curl/bld/tests && pytest -v /home/runner/work/curl/curl/tests/http\r\nninja: build stopped: subcommand failed.\r\n\r\nError: Process completed with exit code 1.\r\n```\r\nhttps://github.com/curl/curl/actions/runs/14160172286/job/39664557285#step:43:803\r\nhttps://github.com/curl/curl/actions/runs/14149632958/job/39641190739\r\nhttps://github.com/curl/curl/actions/runs/14145043858/job/39631366961\r\nhttps://github.com/curl/curl/actions/runs/14145958822/job/39633296953\r\nhttps://github.com/curl/curl/actions/runs/14162991213/job/39671406439#step:43:1\r\n\r\n### I expected the following\r\n\r\nClean pytest run.\r\n\r\n\r\n### curl/libcurl version\r\n\r\nmaster\r\n\r\n\r\n### operating system\r\n\r\nLinux","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/16881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/16881/timeline","performed_via_github_app":null,"state_reason":"completed"}