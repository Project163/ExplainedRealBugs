{"url":"https://api.github.com/repos/curl/curl/issues/18017","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/18017/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/18017/comments","events_url":"https://api.github.com/repos/curl/curl/issues/18017/events","html_url":"https://github.com/curl/curl/issues/18017","id":3262663091,"node_id":"I_kwDOAAiu0c7CeEmz","number":18017,"title":"Multi performance regression 8.13.0 -> 8.14.1","user":{"login":"rm-rmonaghan","id":202635340,"node_id":"U_kgDODBP4TA","avatar_url":"https://avatars.githubusercontent.com/u/202635340?v=4","gravatar_id":"","url":"https://api.github.com/users/rm-rmonaghan","html_url":"https://github.com/rm-rmonaghan","followers_url":"https://api.github.com/users/rm-rmonaghan/followers","following_url":"https://api.github.com/users/rm-rmonaghan/following{/other_user}","gists_url":"https://api.github.com/users/rm-rmonaghan/gists{/gist_id}","starred_url":"https://api.github.com/users/rm-rmonaghan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rm-rmonaghan/subscriptions","organizations_url":"https://api.github.com/users/rm-rmonaghan/orgs","repos_url":"https://api.github.com/users/rm-rmonaghan/repos","events_url":"https://api.github.com/users/rm-rmonaghan/events{/privacy}","received_events_url":"https://api.github.com/users/rm-rmonaghan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":865591047,"node_id":"MDU6TGFiZWw4NjU1OTEwNDc=","url":"https://api.github.com/repos/curl/curl/labels/performance","name":"performance","color":"d306dd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2025-07-25T09:53:52Z","updated_at":"2025-07-28T20:58:27Z","closed_at":"2025-07-28T20:58:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nI have a test that adds 500 handles to a multi handle and then drives the transfers using \"multi socket\" api.\nThe transfers are simple HTTP1.1 GET requests to a localhost server, the responses are 200 with no payload.\nThere is no TLS.\nThe multi is limited to creating 6 connections using `CURLMOPT_MAX_HOST_CONNECTIONS`,\n\nWhen the test is run with curl 8.13.0 it completes in about **0.4s**.\nWhen the test is run with curl 8.14.1 is completes in about **6s**\n\nI see the same behaviour on linux and windows.\n\nAttached are the curl info text logs from running the test with 50 handles added to the multi.\nThey seem to show that in 8.13.0 when a connection becomes available, only a single transfer transitions `[PENDING] -> [CONNECT]`. However in 8.14.1 every pending transfer transitions to the connect state.\n\n[curl_8_13_0_good_multi.log](https://github.com/user-attachments/files/21428688/curl_8_13_0_good_multi.log)\n[curl_8_14_1_bad_multi.log](https://github.com/user-attachments/files/21428687/curl_8_14_1_bad_multi.log)\n\n### I expected the following\n\nI expected similar performance between curl versions\n\n### curl/libcurl version\n\nRegression in curl/8.14.1\n\n### operating system\n\nLinux DESKTOP-L7IDC5E 5.15.167.4-microsoft-standard-WSL2 #1 SMP Tue Nov 5 00:21:55 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\n\nWindows 11 Enterprise 24H2","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/18017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/18017/timeline","performed_via_github_app":null,"state_reason":"completed"}