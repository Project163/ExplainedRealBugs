{"url":"https://api.github.com/repos/curl/curl/issues/15267","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15267/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15267/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15267/events","html_url":"https://github.com/curl/curl/issues/15267","id":2581398633,"node_id":"I_kwDOAAiu0c6Z3QRp","number":15267,"title":"curl ngtcp2 performance regression on fast links","user":{"login":"vranem1","id":56112001,"node_id":"MDQ6VXNlcjU2MTEyMDAx","avatar_url":"https://avatars.githubusercontent.com/u/56112001?v=4","gravatar_id":"","url":"https://api.github.com/users/vranem1","html_url":"https://github.com/vranem1","followers_url":"https://api.github.com/users/vranem1/followers","following_url":"https://api.github.com/users/vranem1/following{/other_user}","gists_url":"https://api.github.com/users/vranem1/gists{/gist_id}","starred_url":"https://api.github.com/users/vranem1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vranem1/subscriptions","organizations_url":"https://api.github.com/users/vranem1/orgs","repos_url":"https://api.github.com/users/vranem1/repos","events_url":"https://api.github.com/users/vranem1/events{/privacy}","received_events_url":"https://api.github.com/users/vranem1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":865591047,"node_id":"MDU6TGFiZWw4NjU1OTEwNDc=","url":"https://api.github.com/repos/curl/curl/labels/performance","name":"performance","color":"d306dd","default":false,"description":""},{"id":1141438010,"node_id":"MDU6TGFiZWwxMTQxNDM4MDEw","url":"https://api.github.com/repos/curl/curl/labels/HTTP/3","name":"HTTP/3","color":"97fceb","default":false,"description":"h3 or quic related"}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":23,"created_at":"2024-10-11T13:35:31Z","updated_at":"2024-11-01T07:20:12Z","closed_at":"2024-10-31T22:42:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nStarting from this change: https://github.com/curl/curl/commit/97c0f89bd I observe slight performance improvement on slower links, but also a significant performance regression on fast links when downloading an http/3 resource.\r\n\r\nSteps to reproduce:\r\n1) Build curl with http/3 support from these component version:\r\n  OpenSSL: OpenSSL_1_1_1w-37-g612d8e44d6\r\n  nghttp3: v1.6.0-1-g7f40779\r\n  ngtcp2: v1.8.0-1-g8d5ab787\r\n  nghttp2: v1.63.0-15-g4202608e\r\n  curl: curl-8_10_1-146-g97c0f89bd\r\n2) Build a second binary from the same components, but with previous curl git commit\r\n\r\n3) Setup a http3 server and a bandwith limit using netem with the following params:\r\nrate=1Gbit ,rtt=2ms, loss=0 , jitter=0\r\n4) download 100MB file and measure the time \n\n### I expected the following\n\nThe download duration with older binary is approximatly 3s, but 100s with the newer one.\r\n\r\nThe faster the emulated link is the bigger regression we get. for example on 1.5GBit line the regression is 1000% !\n\n### curl/libcurl version\n\ncurl 8.10 and newer (tested with the main branch today)\n\n### operating system\n\nUbuntu 22.04","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15267/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15267/timeline","performed_via_github_app":null,"state_reason":"completed"}