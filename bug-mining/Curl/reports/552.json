{"url":"https://api.github.com/repos/curl/curl/issues/14843","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/14843/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/14843/comments","events_url":"https://api.github.com/repos/curl/curl/issues/14843/events","html_url":"https://github.com/curl/curl/issues/14843","id":2515751311,"node_id":"I_kwDOAAiu0c6V81GP","number":14843,"title":"curl_easy_perform() in curl 8.9.1 fails with OPERATION_TIMEOUT","user":{"login":"rmja","id":2112306,"node_id":"MDQ6VXNlcjIxMTIzMDY=","avatar_url":"https://avatars.githubusercontent.com/u/2112306?v=4","gravatar_id":"","url":"https://api.github.com/users/rmja","html_url":"https://github.com/rmja","followers_url":"https://api.github.com/users/rmja/followers","following_url":"https://api.github.com/users/rmja/following{/other_user}","gists_url":"https://api.github.com/users/rmja/gists{/gist_id}","starred_url":"https://api.github.com/users/rmja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmja/subscriptions","organizations_url":"https://api.github.com/users/rmja/orgs","repos_url":"https://api.github.com/users/rmja/repos","events_url":"https://api.github.com/users/rmja/events{/privacy}","received_events_url":"https://api.github.com/users/rmja/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2024-09-10T08:22:04Z","updated_at":"2025-10-27T10:31:42Z","closed_at":"2024-09-20T21:44:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nI am uploading a file to a Microsoft FTP Service using libcurl from C#. This has worked fine, but after updating to libcurl 8.9.1 it seems as if `curl_easy_perform()` now returns `OPERATION_TIMEOUT`. The call is going through a socks proxy (needed for me to access the FTP server due to firewall restrictions).\r\n\r\nI hope that you can use my description below, even though it is from C#. It is the the verbose output obtained through the `CURLoption.DEBUGFUNCTION` handler.\r\nNote that the file is actually uploaded - but, if I specify a `POSTQUOTE` to be run after the upload, then it is not executed.\r\n\r\n> CURLINFO_TEXT: 09.56.39.337   Trying 52.29.67.170:1080...\r\nCURLINFO_TEXT: 09.56.39.363 Connected to 52.29.67.170 (52.29.67.170) port 1080\r\nCURLINFO_TEXT: 09.56.39.454 Host kamanaftps01.westeurope.cloudapp.azure.com:21 was resolved.\r\nCURLINFO_TEXT: 09.56.39.457 IPv6: (none)\r\nCURLINFO_TEXT: 09.56.39.459 IPv4: 52.174.49.89\r\nCURLINFO_TEXT: 09.56.39.461 SOCKS5 connect to 52.174.49.89:21 (locally resolved)\r\nCURLINFO_TEXT: 09.56.39.495 SOCKS5 request granted.\r\nCURLINFO_TEXT: 09.56.39.497 Connected to 52.29.67.170 (52.29.67.170) port 1080\r\nCURLINFO_HEADER_IN: 09.56.39.504 220 Microsoft FTP Service\r\nCURLINFO_HEADER_OUT: 09.56.39.506 AUTH SSL\r\nCURLINFO_HEADER_IN: 09.56.39.537 234 AUTH command ok. Expecting TLS Negotiation.\r\nCURLINFO_TEXT: 09.56.39.540 TLSv1.2 (OUT), TLS handshake, Client hello (1):\r\nCURLINFO_SSL_DATA_OUT: 09.56.39.542 \u0001CURLINFO_TEXT: 09.56.39.573 TLSv1.2 (IN), TLS handshake, Server hello (2):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.575 \u0002CURLINFO_TEXT: 09.56.39.577 TLSv1.2 (IN), TLS handshake, Certificate (11):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.579 \u000BCURLINFO_TEXT: 09.56.39.581 TLSv1.2 (IN), TLS handshake, Server key exchange (12):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.583 \fCURLINFO_TEXT: 09.56.39.585 TLSv1.2 (IN), TLS handshake, Server finished (14):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.586 \u000ECURLINFO_TEXT: 09.56.39.588 TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\r\nCURLINFO_SSL_DATA_OUT: 09.56.39.589 \u0010CURLINFO_TEXT: 09.56.39.591 TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\nCURLINFO_SSL_DATA_OUT: 09.56.39.592 \u0001\r\nCURLINFO_TEXT: 09.56.39.594 TLSv1.2 (OUT), TLS handshake, Finished (20):\r\nCURLINFO_SSL_DATA_OUT: 09.56.39.596 \u0014CURLINFO_TEXT: 09.56.39.629 TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.631 \u0001\r\nCURLINFO_TEXT: 09.56.39.633 TLSv1.2 (IN), TLS handshake, Finished (20):\r\nCURLINFO_SSL_DATA_IN: 09.56.39.635 \u0014CURLINFO_TEXT: 09.56.39.636 SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384 / [blank] / UNDEF\r\nCURLINFO_TEXT: 09.56.39.638 Server certificate:\r\nCURLINFO_TEXT: 09.56.39.639  subject: CN=kamanaftps01.westeurope.cloudapp.azure.com\r\nCURLINFO_TEXT: 09.56.39.641  start date: Sep 12 05:59:33 2023 GMT\r\nCURLINFO_TEXT: 09.56.39.642  expire date: Oct 13 05:59:33 2024 GMT\r\nCURLINFO_TEXT: 09.56.39.644  subjectAltName: host \"kamanaftps01.westeurope.cloudapp.azure.com\" matched cert's \"kamanaftps01.westeurope.cloudapp.azure.com\"\r\nCURLINFO_TEXT: 09.56.39.646  issuer: C=US; ST=Arizona; L=Scottsdale; O=GoDaddy.com, Inc.; OU=http://certs.godaddy.com/repository/; CN=Go Daddy Secure Certificate Authority - G2\r\nCURLINFO_TEXT: 09.56.39.647  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\r\nCURLINFO_TEXT: 09.56.39.649   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\r\nCURLINFO_TEXT: 09.56.39.651   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\r\nCURLINFO_HEADER_OUT: 09.56.39.653 USER username\r\nCURLINFO_HEADER_IN: 09.56.39.685 331 Password required\r\nCURLINFO_HEADER_OUT: 09.56.39.687 PASS password\r\nCURLINFO_HEADER_IN: 09.56.39.734 230 User logged in.\r\nCURLINFO_HEADER_OUT: 09.56.39.736 PBSZ 0\r\nCURLINFO_HEADER_IN: 09.56.39.768 200 PBSZ command successful.\r\nCURLINFO_HEADER_OUT: 09.56.39.770 PROT P\r\nCURLINFO_HEADER_IN: 09.56.39.802 200 PROT command successful.\r\nCURLINFO_HEADER_OUT: 09.56.39.805 PWD\r\nCURLINFO_HEADER_IN: 09.56.39.837 257 \"/\" is current directory.\r\nCURLINFO_TEXT: 09.56.39.840 Entry path is '/'\r\nCURLINFO_TEXT: 09.56.39.842 Request has same path as previous transfer\r\nCURLINFO_HEADER_OUT: 09.56.39.844 EPSV\r\nCURLINFO_TEXT: 09.56.39.846 Connect data stream passively\r\nCURLINFO_HEADER_IN: 09.56.39.876 229 Entering Extended Passive Mode (|||16897|)\r\nCURLINFO_TEXT: 09.56.39.878 Hostname 52.29.67.170 was found in DNS cache\r\nCURLINFO_TEXT: 09.56.39.880 Connecting to kamanaftps01.westeurope.cloudapp.azure.com (52.29.67.170) port 1080\r\nCURLINFO_TEXT: 09.56.39.882   Trying 52.29.67.170:1080...\r\nCURLINFO_TEXT: 09.56.39.907 Connected 2nd connection to 52.29.67.170 port 1080\r\nCURLINFO_TEXT: 09.56.39.968 Host kamanaftps01.westeurope.cloudapp.azure.com:16897 was resolved.\r\nCURLINFO_TEXT: 09.56.39.970 IPv6: (none)\r\nCURLINFO_TEXT: 09.56.39.972 IPv4: 52.174.49.89\r\nCURLINFO_TEXT: 09.56.39.974 SOCKS5 connect to 52.174.49.89:16897 (locally resolved)\r\nCURLINFO_TEXT: 09.56.40.007 SOCKS5 request granted.\r\nCURLINFO_TEXT: 09.56.40.010 Connected 2nd connection to 52.29.67.170 port 1080\r\nCURLINFO_TEXT: 09.56.40.012 SSL reusing session ID\r\nCURLINFO_TEXT: 09.56.40.015 TLSv1.2 (OUT), TLS handshake, Client hello (1):\r\nCURLINFO_SSL_DATA_OUT: 09.56.40.017 \u0001CURLINFO_HEADER_OUT: 09.56.40.019 TYPE I\r\nCURLINFO_HEADER_IN: 09.56.40.050 200 Type set to I.\r\nCURLINFO_HEADER_OUT: 09.56.40.053 STOR upload-testfile-5e047ec0-0bc6-4eab-854d-9c5a70f2ae61.txt.tmp\r\nCURLINFO_HEADER_IN: 09.56.40.125 125 Data connection already open; Transfer starting.\r\nCURLINFO_TEXT: 09.56.40.128 TLSv1.2 (IN), TLS handshake, Server hello (2):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.130 \u0002CURLINFO_TEXT: 09.56.40.132 TLSv1.2 (IN), TLS handshake, Certificate (11):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.134 \u000BCURLINFO_TEXT: 09.56.40.136 TLSv1.2 (IN), TLS handshake, Server key exchange (12):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.138 \fCURLINFO_TEXT: 09.56.40.140 TLSv1.2 (IN), TLS handshake, Server finished (14):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.142 \u000ECURLINFO_TEXT: 09.56.40.145 TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\r\nCURLINFO_SSL_DATA_OUT: 09.56.40.146 \u0010CURLINFO_TEXT: 09.56.40.149 TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\nCURLINFO_SSL_DATA_OUT: 09.56.40.150 \u0001\r\nCURLINFO_TEXT: 09.56.40.153 TLSv1.2 (OUT), TLS handshake, Finished (20):\r\nCURLINFO_SSL_DATA_OUT: 09.56.40.154 \u0014CURLINFO_TEXT: 09.56.40.188 TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.190 \u0001\r\nCURLINFO_TEXT: 09.56.40.192 TLSv1.2 (IN), TLS handshake, Finished (20):\r\nCURLINFO_SSL_DATA_IN: 09.56.40.194 \u0014CURLINFO_TEXT: 09.56.40.196 SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384 / [blank] / UNDEF\r\nCURLINFO_TEXT: 09.56.40.198 Server certificate:\r\nCURLINFO_TEXT: 09.56.40.200  subject: CN=kamanaftps01.westeurope.cloudapp.azure.com\r\nCURLINFO_TEXT: 09.56.40.202  start date: Sep 12 05:59:33 2023 GMT\r\nCURLINFO_TEXT: 09.56.40.204  expire date: Oct 13 05:59:33 2024 GMT\r\nCURLINFO_TEXT: 09.56.40.206  subjectAltName: host \"kamanaftps01.westeurope.cloudapp.azure.com\" matched cert's \"kamanaftps01.westeurope.cloudapp.azure.com\"\r\nCURLINFO_TEXT: 09.56.40.208  issuer: C=US; ST=Arizona; L=Scottsdale; O=GoDaddy.com, Inc.; OU=http://certs.godaddy.com/repository/; CN=Go Daddy Secure Certificate Authority - G2\r\nCURLINFO_TEXT: 09.56.40.210  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\r\nCURLINFO_TEXT: 09.56.40.212   Certificate level 0: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\r\nCURLINFO_TEXT: 09.56.40.214   Certificate level 1: Public key type ? (2048/112 Bits/secBits), signed using sha256WithRSAEncryption\r\nCURLINFO_DATA_OUT: 09.56.40.217 This is a testfile\r\nCURLINFO_TEXT: 09.56.40.219 TLSv1.2 (OUT), TLS alert, close notify (256):\r\nCURLINFO_SSL_DATA_OUT: 09.56.40.221 \u0001CURLINFO_TEXT: 09.56.42.234 SSL shutdown timeout\r\nCURLINFO_TEXT: 09.56.42.236 closing connection #0\r\n\r\nLet me know if there is some `CURLOption` that I can specify to help with diagnosing the issue further.\r\nI can do the same uploads to a `vsftpd` server without any issues.\r\nI believe this is related to #13904.\r\n\n\n### I expected the following\n\nI expect the perform operation to not return an error, and if a `POSTQUOTE` is specified, to have it be executed.\n\n### curl/libcurl version\n\nlibcurl 8.9.1 (this worked in libcurl 8.8.0)\n\n### operating system\n\nI have tried both on Windows and alpine linux with verified libcurl 8.9.1","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/14843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/14843/timeline","performed_via_github_app":null,"state_reason":"completed"}