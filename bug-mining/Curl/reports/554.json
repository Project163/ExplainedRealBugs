{"url":"https://api.github.com/repos/curl/curl/issues/14941","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/14941/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/14941/comments","events_url":"https://api.github.com/repos/curl/curl/issues/14941/events","html_url":"https://github.com/curl/curl/issues/14941","id":2530920240,"node_id":"I_kwDOAAiu0c6W2scw","number":14941,"title":"--dump-header doesn't make use of the --create-dirs option","user":{"login":"Montg0mery","id":88062966,"node_id":"MDQ6VXNlcjg4MDYyOTY2","avatar_url":"https://avatars.githubusercontent.com/u/88062966?v=4","gravatar_id":"","url":"https://api.github.com/users/Montg0mery","html_url":"https://github.com/Montg0mery","followers_url":"https://api.github.com/users/Montg0mery/followers","following_url":"https://api.github.com/users/Montg0mery/following{/other_user}","gists_url":"https://api.github.com/users/Montg0mery/gists{/gist_id}","starred_url":"https://api.github.com/users/Montg0mery/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Montg0mery/subscriptions","organizations_url":"https://api.github.com/users/Montg0mery/orgs","repos_url":"https://api.github.com/users/Montg0mery/repos","events_url":"https://api.github.com/users/Montg0mery/events{/privacy}","received_events_url":"https://api.github.com/users/Montg0mery/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":192912238,"node_id":"MDU6TGFiZWwxOTI5MTIyMzg=","url":"https://api.github.com/repos/curl/curl/labels/cmdline%20tool","name":"cmdline tool","color":"006b75","default":false,"description":null},{"id":228248612,"node_id":"MDU6TGFiZWwyMjgyNDg2MTI=","url":"https://api.github.com/repos/curl/curl/labels/enhancement","name":"enhancement","color":"FCFD96","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2024-09-17T11:38:30Z","updated_at":"2024-11-29T18:58:47Z","closed_at":"2024-09-22T19:27:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\n```\r\ncurl --verbose --create-dirs --head --dump-header ./test/headers.txt https://www.example.com/\r\n```\r\n\r\nResult:\r\n```\r\nWarning: Failed to open ./test/headers.txt\r\ncurl: (23) Failed writing received data to disk/application\r\n```\r\n\r\n### I expected the following\r\n\r\nHeaders to be saved in the directory specified, even if it doesn't already exist, due to the `--create-dirs` option.\r\n\r\nObviously for a simple example like this, the directory can be manually created first. However, when used in a large config file with thousands of URLs, it is not possible to automatically save headers and responses into a custom directory per-URL (without first creating every single directory required, which defeats the value of `--create-dirs`).\r\n\r\nE.g., in a config file such as this:\r\n\r\n```\r\nfail-early\r\n\r\nnext\r\nurl = \"https://files.example.com/download?id=abc123\"\r\nfail\r\ncreate-dirs\r\noutput-dir = \"abc123\"\r\nremote-name\r\nremote-header-name\r\ndump-header = \"abc123/headers.txt\"\r\n\r\nnext\r\nurl = \"https://files.example.com/download?id=def456\"\r\nfail\r\ncreate-dirs\r\noutput-dir = \"def456\"\r\nremote-name\r\nremote-header-name\r\ndump-header \"def456/headers.txt\"\r\n```\r\n\r\n(The use of `--next` is needed in order to reset `--output-dir` per URL. Different directories are needed per URL in this use case as different download IDs can have the same filename in the `Content-Disposition` header and both the download ID and filename need to be preserved in the resulting structure).\r\n\r\nWithout the `dump-header` lines, curl correctly uses the `--create-dirs` option and creates the directories when it comes to saving the actual response bodies. But because the headers come before the body, the directory does not exist at the time the headers are written, and curl errors out.\r\n\r\nWithout the `dump-header` lines, the rest of the config works really well for this use case. Thanks!\r\n\r\nSuggested change:\r\n\r\nIn the `dump-header` code, if the provided value contains leading directories and they don't exist, before returning an error, first check if the `--create-dirs` option has been provided, and then first try to create the required directory tree (in the same way that `--create-dirs` works with `--output`). Only if that fails, then return an error, otherwise continue with the rest of the command.\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.10.0\r\n\r\n### operating system\r\n\r\nUbuntu 22.04","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/14941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/14941/timeline","performed_via_github_app":null,"state_reason":"completed"}