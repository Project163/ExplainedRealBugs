{"url":"https://api.github.com/repos/curl/curl/issues/13292","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13292/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13292/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13292/events","html_url":"https://github.com/curl/curl/issues/13292","id":2227624649,"node_id":"I_kwDOAAiu0c6ExtrJ","number":13292,"title":"HTTP/2 libcurl regression","user":{"login":"CkNoSFeRaTU","id":2136776,"node_id":"MDQ6VXNlcjIxMzY3NzY=","avatar_url":"https://avatars.githubusercontent.com/u/2136776?v=4","gravatar_id":"","url":"https://api.github.com/users/CkNoSFeRaTU","html_url":"https://github.com/CkNoSFeRaTU","followers_url":"https://api.github.com/users/CkNoSFeRaTU/followers","following_url":"https://api.github.com/users/CkNoSFeRaTU/following{/other_user}","gists_url":"https://api.github.com/users/CkNoSFeRaTU/gists{/gist_id}","starred_url":"https://api.github.com/users/CkNoSFeRaTU/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CkNoSFeRaTU/subscriptions","organizations_url":"https://api.github.com/users/CkNoSFeRaTU/orgs","repos_url":"https://api.github.com/users/CkNoSFeRaTU/repos","events_url":"https://api.github.com/users/CkNoSFeRaTU/events{/privacy}","received_events_url":"https://api.github.com/users/CkNoSFeRaTU/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-04-05T10:11:37Z","updated_at":"2024-04-08T13:50:17Z","closed_at":"2024-04-08T13:50:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nArchLinux's pacman which is using libcurl through libalpm started to timeout on mirror synchronization if this mirror have http/2 enabled. Bisect is pointing to commit 0dc036225b3013bf994da81fa44571bcfcecbe92.\r\nI also hacked a bit libalpm and here is an output:\r\n\r\n```\r\n== Info: using HTTP/2\r\n== Info: [HTTP/2] [1] OPENED stream for https://mirror.kraski.tv/linux/archlinux/core/os/x86_64/core.db\r\n== Info: [HTTP/2] [1] [:method: GET]\r\n== Info: [HTTP/2] [1] [:scheme: https]\r\n== Info: [HTTP/2] [1] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [1] [:path: /linux/archlinux/core/os/x86_64/core.db]\r\n== Info: [HTTP/2] [1] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: Connection #0 to host mirror.kraski.tv left intact                                         15.9 KiB  0.00   B/s --:-- [#########--------------------------------------------------------------------]  12%\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults                    128.4 KiB  4.18 MiB/s 00:00 [#############################################################################] 100%\r\n== Info: Found bundle for host: 0x64c5f2a95bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [3] OPENED stream for https://mirror.kraski.tv/linux/archlinux/core/os/x86_64/core.db.sig\r\n== Info: [HTTP/2] [3] [:method: GET]\r\n== Info: [HTTP/2] [3] [:scheme: https]\r\n== Info: [HTTP/2] [3] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [3] [:path: /linux/archlinux/core/os/x86_64/core.db.sig]\r\n== Info: [HTTP/2] [3] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: [HTTP/2] [3] [accept: */*]\r\n== Info: Exceeded the maximum allowed file size (16384) with 16384 bytes\r\n== Info: process_pending_input: nghttp2_session_mem_recv() returned -902:The user callback function failed\r\n== Info: Connection #0 to host mirror.kraski.tv left intact\r\n extra\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults\r\n== Info: Found bundle for host: 0x64c5f2a95bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [5] OPENED stream for https://mirror.kraski.tv/linux/archlinux/extra/os/x86_64/extra.db\r\n== Info: [HTTP/2] [5] [:method: GET]\r\n== Info: [HTTP/2] [5] [:scheme: https]\r\n== Info: [HTTP/2] [5] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [5] [:path: /linux/archlinux/extra/os/x86_64/extra.db]\r\n== Info: [HTTP/2] [5] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: [HTTP/2] [5] [accept: */*]\r\n== Info: Operation too slow. Less than 1 bytes/sec transferred the last 10 seconds\r\n== Info: Closing connection\r\n extra.db failed to download\r\nerror: failed retrieving file 'extra.db' from mirror.kraski.tv : Operation too slow. Less than 1 bytes/sec transferred the last 10 seconds\r\nerror: failed to synchronize all databases (download library error)\r\n```\r\n\r\nIt seems there is some trouble with client callbacks (according to \"nghttp2_session_mem_recv() returned -902:The user callback function failed\") when some file is not present on server (core.db.sig in the case above). Which then prevents downloading subsequent files.\n\n### I expected the following\n\nLog with build before aformentioned commit:\r\n```\r\n== Info: using HTTP/2\r\n== Info: [HTTP/2] [1] OPENED stream for https://mirror.kraski.tv/linux/archlinux/core/os/x86_64/core.db\r\n== Info: [HTTP/2] [1] [:method: GET]\r\n== Info: [HTTP/2] [1] [:scheme: https]\r\n== Info: [HTTP/2] [1] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [1] [:path: /linux/archlinux/core/os/x86_64/core.db]\r\n== Info: [HTTP/2] [1] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: Connection #0 to host mirror.kraski.tv left intact                                          0.0   B  0.00   B/s --:-- [-----------------------------------------------------------------------------]   0%\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults                    128.4 KiB  4.82 MiB/s 00:00 [#############################################################################] 100%\r\n== Info: Found bundle for host: 0x650a688f0bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [3] OPENED stream for https://mirror.kraski.tv/linux/archlinux/core/os/x86_64/core.db.sig\r\n== Info: [HTTP/2] [3] [:method: GET]\r\n== Info: [HTTP/2] [3] [:scheme: https]\r\n== Info: [HTTP/2] [3] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [3] [:path: /linux/archlinux/core/os/x86_64/core.db.sig]\r\n== Info: [HTTP/2] [3] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: [HTTP/2] [3] [accept: */*]\r\n== Info: Exceeded the maximum allowed file size (16384) with 16384 bytes\r\n== Info: Connection #0 to host mirror.kraski.tv left intact\r\n extra\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults\r\n== Info: Found bundle for host: 0x650a688f0bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [5] OPENED stream for https://mirror.kraski.tv/linux/archlinux/extra/os/x86_64/extra.db\r\n== Info: [HTTP/2] [5] [:method: GET]\r\n== Info: [HTTP/2] [5] [:scheme: https]\r\n== Info: [HTTP/2] [5] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [5] [:path: /linux/archlinux/extra/os/x86_64/extra.db]\r\n== Info: [HTTP/2] [5] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: Connection #0 to host mirror.kraski.tv left intact                                         15.9 KiB  0.00   B/s --:-- [-----------------------------------------------------------------------------]   0%\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults                      8.1 MiB  67.4 MiB/s 00:00 [#############################################################################] 100%\r\n== Info: Found bundle for host: 0x650a688f0bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [7] OPENED stream for https://mirror.kraski.tv/linux/archlinux/extra/os/x86_64/extra.db.sig\r\n== Info: [HTTP/2] [7] [:method: GET]\r\n== Info: [HTTP/2] [7] [:scheme: https]\r\n== Info: [HTTP/2] [7] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [7] [:path: /linux/archlinux/extra/os/x86_64/extra.db.sig]\r\n== Info: [HTTP/2] [7] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: [HTTP/2] [7] [accept: */*]\r\n== Info: Exceeded the maximum allowed file size (16384) with 16384 bytes\r\n== Info: Connection #0 to host mirror.kraski.tv left intact\r\n multilib\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults\r\n== Info: Found bundle for host: 0x650a688f0bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [9] OPENED stream for https://mirror.kraski.tv/linux/archlinux/multilib/os/x86_64/multilib.db\r\n== Info: [HTTP/2] [9] [:method: GET]\r\n== Info: [HTTP/2] [9] [:scheme: https]\r\n== Info: [HTTP/2] [9] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [9] [:path: /linux/archlinux/multilib/os/x86_64/multilib.db]\r\n== Info: [HTTP/2] [9] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: Connection #0 to host mirror.kraski.tv left intact                                         15.9 KiB  0.00   B/s --:-- [########---------------------------------------------------------------------]  11%\r\n== Info: Couldn't find host mirror.kraski.tv in the .netrc file; using defaults                    138.8 KiB  33.9 MiB/s 00:00 [#############################################################################] 100%\r\n== Info: Found bundle for host: 0x650a688f0bc0 [can multiplex]\r\n== Info: Re-using existing connection with host mirror.kraski.tv\r\n== Info: [HTTP/2] [11] OPENED stream for https://mirror.kraski.tv/linux/archlinux/multilib/os/x86_64/multilib.db.sig\r\n== Info: [HTTP/2] [11] [:method: GET]\r\n== Info: [HTTP/2] [11] [:scheme: https]\r\n== Info: [HTTP/2] [11] [:authority: mirror.kraski.tv]\r\n== Info: [HTTP/2] [11] [:path: /linux/archlinux/multilib/os/x86_64/multilib.db.sig]\r\n== Info: [HTTP/2] [11] [user-agent: pacman/6.1.0 (Linux x86_64) libalpm/14.0.0]\r\n== Info: [HTTP/2] [11] [accept: */*]\r\n== Info: Exceeded the maximum allowed file size (16384) with 16384 bytes\r\n== Info: Connection #0 to host mirror.kraski.tv left intact\r\n```\n\n### curl/libcurl version\n\ncurl 8.7.1 and current master branch\n\n### operating system\n\nArchlinux\r\nLinux xxx.xxx.xxx 6.8.1-arch1-1 #1 SMP PREEMPT_DYNAMIC Sat, 16 Mar 2024 17:15:35 +0000 x86_64 GNU/Linux","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13292/timeline","performed_via_github_app":null,"state_reason":"completed"}