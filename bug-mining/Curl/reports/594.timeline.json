[{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493018250","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493018250","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493018250,"node_id":"IC_kwDOAAiu0c6UmHCK","user":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T07:07:07Z","updated_at":"2024-11-22T07:47:45Z","body":"I tried to add a check in rtsp_done() in curl/lib/rtsp.c.\r\nThrough gdb, I found that `eos_written`, `upload_done`, `upload_aborted` under the `data->req` structure are set after the connection is broken. So I added the following code:\r\n```c\r\nstatic CURLcode rtsp_done(struct Curl_easy *data,\r\n                          CURLcode status, bool premature)\r\n{\r\n  struct RTSP *rtsp = data->req.p.rtsp;\r\n  CURLcode httpStatus;\r\n\r\n  /* Bypass HTTP empty-reply checks on receive */\r\n  if(data->set.rtspreq == RTSPREQ_RECEIVE)\r\n    premature = TRUE;\r\n\r\n  httpStatus = Curl_http_done(data, status, premature);\r\n\r\n  if(rtsp && !status && !httpStatus) {\r\n    /* Check the sequence numbers */\r\n    long CSeq_sent = rtsp->CSeq_sent;\r\n    long CSeq_recv = rtsp->CSeq_recv;\r\n    if((data->set.rtspreq != RTSPREQ_RECEIVE) && (CSeq_sent != CSeq_recv)) {\r\n      failf(data,\r\n            \"The CSeq of this request %ld did not match the response %ld\",\r\n            CSeq_sent, CSeq_recv);\r\n      return CURLE_RTSP_CSEQ_ERROR;\r\n    }\r\n    if(data->set.rtspreq == RTSPREQ_RECEIVE &&\r\n       (data->conn->proto.rtspc.rtp_channel == -1)) {\r\n      infof(data, \"Got an RTP Receive with a CSeq of %ld\", CSeq_recv);\r\n    }\r\n\r\n    /* Here is the added code */\r\n    if(data->set.rtspreq == RTSPREQ_RECEIVE &&\r\n       data->req.eos_written) {\r\n      failf(data, \"The req.eos_written  bit is set in the Receive request\");\r\n      return CURLE_RECV_ERROR;\r\n    }\r\n  }\r\n\r\n  return httpStatus;\r\n}\r\n```\r\nThis change works. Is it OK to check via `data->req.eos_written`? Can it be merged into this project?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493018250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T09:18:49Z","updated_at":"2024-11-22T09:18:49Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/curl/curl/issues/15626","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15626/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15626/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15626/events","html_url":"https://github.com/curl/curl/pull/15626","id":2682529104,"node_id":"PR_kwDOAAiu0c6CyZD8","number":15626,"title":"rtsp: Check eos in the rtsp receive and return an error code","user":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1568154016,"node_id":"MDU6TGFiZWwxNTY4MTU0MDE2","url":"https://api.github.com/repos/curl/curl/labels/RTSP","name":"RTSP","color":"c2e0c6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-11-22T09:18:47Z","updated_at":"2024-11-25T17:39:31Z","closed_at":"2024-11-25T17:38:03Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":569041,"node_id":"MDEwOlJlcG9zaXRvcnk1NjkwNDE=","name":"curl","full_name":"curl/curl","private":false,"owner":{"login":"curl","id":16928085,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2OTI4MDg1","avatar_url":"https://avatars.githubusercontent.com/u/16928085?v=4","gravatar_id":"","url":"https://api.github.com/users/curl","html_url":"https://github.com/curl","followers_url":"https://api.github.com/users/curl/followers","following_url":"https://api.github.com/users/curl/following{/other_user}","gists_url":"https://api.github.com/users/curl/gists{/gist_id}","starred_url":"https://api.github.com/users/curl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/curl/subscriptions","organizations_url":"https://api.github.com/users/curl/orgs","repos_url":"https://api.github.com/users/curl/repos","events_url":"https://api.github.com/users/curl/events{/privacy}","received_events_url":"https://api.github.com/users/curl/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/curl/curl","description":"A command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTMPS, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET, TFTP, WS and WSS. libcurl offers a myriad of powerful features","fork":false,"url":"https://api.github.com/repos/curl/curl","forks_url":"https://api.github.com/repos/curl/curl/forks","keys_url":"https://api.github.com/repos/curl/curl/keys{/key_id}","collaborators_url":"https://api.github.com/repos/curl/curl/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/curl/curl/teams","hooks_url":"https://api.github.com/repos/curl/curl/hooks","issue_events_url":"https://api.github.com/repos/curl/curl/issues/events{/number}","events_url":"https://api.github.com/repos/curl/curl/events","assignees_url":"https://api.github.com/repos/curl/curl/assignees{/user}","branches_url":"https://api.github.com/repos/curl/curl/branches{/branch}","tags_url":"https://api.github.com/repos/curl/curl/tags","blobs_url":"https://api.github.com/repos/curl/curl/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/curl/curl/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/curl/curl/git/refs{/sha}","trees_url":"https://api.github.com/repos/curl/curl/git/trees{/sha}","statuses_url":"https://api.github.com/repos/curl/curl/statuses/{sha}","languages_url":"https://api.github.com/repos/curl/curl/languages","stargazers_url":"https://api.github.com/repos/curl/curl/stargazers","contributors_url":"https://api.github.com/repos/curl/curl/contributors","subscribers_url":"https://api.github.com/repos/curl/curl/subscribers","subscription_url":"https://api.github.com/repos/curl/curl/subscription","commits_url":"https://api.github.com/repos/curl/curl/commits{/sha}","git_commits_url":"https://api.github.com/repos/curl/curl/git/commits{/sha}","comments_url":"https://api.github.com/repos/curl/curl/comments{/number}","issue_comment_url":"https://api.github.com/repos/curl/curl/issues/comments{/number}","contents_url":"https://api.github.com/repos/curl/curl/contents/{+path}","compare_url":"https://api.github.com/repos/curl/curl/compare/{base}...{head}","merges_url":"https://api.github.com/repos/curl/curl/merges","archive_url":"https://api.github.com/repos/curl/curl/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/curl/curl/downloads","issues_url":"https://api.github.com/repos/curl/curl/issues{/number}","pulls_url":"https://api.github.com/repos/curl/curl/pulls{/number}","milestones_url":"https://api.github.com/repos/curl/curl/milestones{/number}","notifications_url":"https://api.github.com/repos/curl/curl/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/curl/curl/labels{/name}","releases_url":"https://api.github.com/repos/curl/curl/releases{/id}","deployments_url":"https://api.github.com/repos/curl/curl/deployments","created_at":"2010-03-18T22:32:22Z","updated_at":"2025-11-10T12:39:01Z","pushed_at":"2025-11-10T12:39:41Z","git_url":"git://github.com/curl/curl.git","ssh_url":"git@github.com:curl/curl.git","clone_url":"https://github.com/curl/curl.git","svn_url":"https://github.com/curl/curl","homepage":"https://curl.se/","size":118458,"stargazers_count":39830,"watchers_count":39830,"language":"C","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":6941,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":41,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["c","client","curl","ftp","gopher","hacktoberfest","http","https","imaps","ldap","libcurl","library","mqtt","pop3","scp","sftp","transfer-data","transferring-data","user-agent","websocket"],"visibility":"public","forks":6941,"open_issues":41,"watchers":39830,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/curl/curl/pulls/15626","html_url":"https://github.com/curl/curl/pull/15626","diff_url":"https://github.com/curl/curl/pull/15626.diff","patch_url":"https://github.com/curl/curl/pull/15626.patch","merged_at":null},"body":"This helps the caller detect disconnection events.\r\n\r\nfix #15624 ","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15626/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493314518","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493314518","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493314518,"node_id":"IC_kwDOAAiu0c6UnPXW","user":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T09:30:12Z","updated_at":"2024-11-22T09:30:12Z","body":"Thanks for your report. If I understand the issue correctly, the transfer ends prematurely. I wonder if `data->req.eos_written` is the best test here. What is the value of the `premature` parameter in such an invocation of `rtsp_done()`?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493314518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15394786808,"node_id":"AE_lADOAAiu0c6f287HzwAAAAOVmc34","url":"https://api.github.com/repos/curl/curl/issues/events/15394786808","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-11-22T09:30:16Z","assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493686030","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493686030","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493686030,"node_id":"IC_kwDOAAiu0c6UoqEO","user":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T12:48:22Z","updated_at":"2024-11-22T12:48:22Z","body":"The value of the `premature` is FALSE. \r\nIt is called by `multi_runsingle()`->`multi_done(data, result, FALSE)`->`conn->handler->done(data, status, premature)`\r\n![截图 2024-11-22 20-47-36](https://github.com/user-attachments/assets/3b84c162-3e26-421e-b980-9925c6cf39d8)\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493686030/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493741231","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493741231","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493741231,"node_id":"IC_kwDOAAiu0c6Uo3iv","user":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T13:13:43Z","updated_at":"2024-11-22T13:13:43Z","body":"Thanks @dengjfzh. Lacking a *real* RTSP server, I am not sure what I am looking at. In `RTSPREQ_RECEIVE` mode, there should be a Content-Length set, right? If the server closes the connection early, this should be detected. The bug might lurk in another place than your proposed fix.\r\n\r\nCould you run this with a `curl_global_trace(\"all\")` after the global curl init? May that trace will help us to see where things go wrong. Thanks!","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493741231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15397363143,"node_id":"MEE_lADOAAiu0c6f287HzwAAAAOVwR3H","url":"https://api.github.com/repos/curl/curl/issues/events/15397363143","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-11-22T13:13:44Z","performed_via_github_app":null},{"id":15397363157,"node_id":"SE_lADOAAiu0c6f287HzwAAAAOVwR3V","url":"https://api.github.com/repos/curl/curl/issues/events/15397363157","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-11-22T13:13:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493920463","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493920463","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493920463,"node_id":"IC_kwDOAAiu0c6UpjTP","user":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T14:43:08Z","updated_at":"2024-11-22T14:43:08Z","body":"`RTSPREQ_RECEIVE` is a special request because it does not send any data to the server. The application may call this function in order to receive interleaved RTP data. [https://curl.se/libcurl/c/CURLOPT_RTSP_REQUEST.html](https://curl.se/libcurl/c/CURLOPT_RTSP_REQUEST.html)\r\nI think it may be because of this reason that the server disconnection is not detected when calling RTSPREQ_RECEIVE.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493920463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493970757","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2493970757","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2493970757,"node_id":"IC_kwDOAAiu0c6UpvlF","user":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T15:07:03Z","updated_at":"2024-11-22T15:07:03Z","body":"Ok, learning about this protocol a bit. As I understand now, `RTSPREQ_RECEIVE` is to do a receive of intermediary data the server might send. When the server sends, it returns that data. However, when the connection closes, it curl considers the transfer done, without error. That is what you want to change.\r\n\r\nReading the RTSP RFC, this protocol looks like HTTP but is not. Especially when it comes to *RTSP sessions*. Opening one introduces a state in the connection. If the server closes the connection before the client issues a `TEARDOWN`, the RTSP session is broken and that should error, as you say.  Did I get that right?\r\n\r\nIf so, I understand your proposed fix. It implies that a client never does `RTSPREQ_RECEIVE` out of the blue, but while things are ongoing and should continue to do so. The PR is fine then.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2493970757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2494019385","html_url":"https://github.com/curl/curl/issues/15624#issuecomment-2494019385","issue_url":"https://api.github.com/repos/curl/curl/issues/15624","id":2494019385,"node_id":"IC_kwDOAAiu0c6Up7c5","user":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-22T15:26:35Z","updated_at":"2024-11-22T15:32:36Z","body":">Ok, learning about this protocol a bit. As I understand now, RTSPREQ_RECEIVE is to do a receive of intermediary data the server might send. When the server sends, it returns that data. However, when the connection closes, it curl considers the transfer done, without error. That is what you want to change.\r\n\r\n>Reading the RTSP RFC, this protocol looks like HTTP but is not. Especially when it comes to RTSP sessions. Opening one introduces a state in the connection. If the server closes the connection before the client issues a TEARDOWN, the RTSP session is broken and that should error, as you say. Did I get that right?\r\n\r\n>If so, I understand your proposed fix. It implies that a client never does RTSPREQ_RECEIVE out of the blue, but while things are ongoing and should continue to do so. The PR is fine then.\r\n\r\n\r\n**That's right.**\r\n\r\nThis is my test data:\r\n(I've added the curl_global_trace(\"all\") call before the program starts. Also, I've recompiled curl with ENABLE_CURLDEBUG and ENABLE_DEBUG turned on.)\r\n\r\nlog file:\r\n[log.txt](https://github.com/user-attachments/files/17872200/log.txt)\r\nThe connection is broken here:\r\n![The connection is broken here.](https://github.com/user-attachments/assets/6d412c1a-eb6d-4a0c-a555-ae6a04460f6a)\r\n\r\nNetwork capture file:\r\n[Network capture file rtsp.pcap.tar.gz](https://github.com/user-attachments/files/17872274/rtsp.pcap.tar.gz)\r\n![截图 2024-11-22 23-02-40](https://github.com/user-attachments/assets/5a6bdfdb-13dd-4fb1-b24f-df81c1895595)\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2494019385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dengjfzh","id":76604422,"node_id":"MDQ6VXNlcjc2NjA0NDIy","avatar_url":"https://avatars.githubusercontent.com/u/76604422?v=4","gravatar_id":"","url":"https://api.github.com/users/dengjfzh","html_url":"https://github.com/dengjfzh","followers_url":"https://api.github.com/users/dengjfzh/followers","following_url":"https://api.github.com/users/dengjfzh/following{/other_user}","gists_url":"https://api.github.com/users/dengjfzh/gists{/gist_id}","starred_url":"https://api.github.com/users/dengjfzh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dengjfzh/subscriptions","organizations_url":"https://api.github.com/users/dengjfzh/orgs","repos_url":"https://api.github.com/users/dengjfzh/repos","events_url":"https://api.github.com/users/dengjfzh/events{/privacy}","received_events_url":"https://api.github.com/users/dengjfzh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15424375733,"node_id":"CE_lADOAAiu0c6f287HzwAAAAOXXUu1","url":"https://api.github.com/repos/curl/curl/issues/events/15424375733","actor":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"e243e733632d76eae2cd2eced35fe95411e0a68f","commit_url":"https://api.github.com/repos/curl/curl/commits/e243e733632d76eae2cd2eced35fe95411e0a68f","created_at":"2024-11-25T17:38:02Z","state_reason":null,"performed_via_github_app":null},{"id":15424512997,"node_id":"REFE_lADOAAiu0c6f287HzwAAAAOXX2Pl","url":"https://api.github.com/repos/curl/curl/issues/events/15424512997","actor":{"login":"MarcelRaad","id":5967138,"node_id":"MDQ6VXNlcjU5NjcxMzg=","avatar_url":"https://avatars.githubusercontent.com/u/5967138?v=4","gravatar_id":"","url":"https://api.github.com/users/MarcelRaad","html_url":"https://github.com/MarcelRaad","followers_url":"https://api.github.com/users/MarcelRaad/followers","following_url":"https://api.github.com/users/MarcelRaad/following{/other_user}","gists_url":"https://api.github.com/users/MarcelRaad/gists{/gist_id}","starred_url":"https://api.github.com/users/MarcelRaad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MarcelRaad/subscriptions","organizations_url":"https://api.github.com/users/MarcelRaad/orgs","repos_url":"https://api.github.com/users/MarcelRaad/repos","events_url":"https://api.github.com/users/MarcelRaad/events{/privacy}","received_events_url":"https://api.github.com/users/MarcelRaad/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e243e733632d76eae2cd2eced35fe95411e0a68f","commit_url":"https://api.github.com/repos/MarcelRaad/curl/commits/e243e733632d76eae2cd2eced35fe95411e0a68f","created_at":"2024-11-25T17:47:54Z","performed_via_github_app":null},{"id":17419000255,"node_id":"REFE_lADOAAiu0c6f287HzwAAAAQOQNm_","url":"https://api.github.com/repos/curl/curl/issues/events/17419000255","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"db271e120cef50f350f59922f64be3bf6607af94","commit_url":"https://api.github.com/repos/pps83/curl/commits/db271e120cef50f350f59922f64be3bf6607af94","created_at":"2025-04-26T22:33:08Z","performed_via_github_app":null}]