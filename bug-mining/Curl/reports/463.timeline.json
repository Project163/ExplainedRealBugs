[{"id":12784126837,"node_id":"LE_lADOAAiu0c6IoP6lzwAAAAL5_kt1","url":"https://api.github.com/repos/curl/curl/issues/events/12784126837","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-05-13T09:22:38Z","label":{"name":"Windows","color":"0e8a16"},"performed_via_github_app":null},{"id":12784126846,"node_id":"LE_lADOAAiu0c6IoP6lzwAAAAL5_kt-","url":"https://api.github.com/repos/curl/curl/issues/events/12784126846","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-05-13T09:22:38Z","label":{"name":"name lookup","color":"0052cc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2107087421","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2107087421","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2107087421,"node_id":"IC_kwDOAAiu0c59l5o9","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-13T09:28:52Z","updated_at":"2024-05-13T09:28:52Z","body":"> GetAddrInfoExW() keeps returning WSATRY_AGAIN and never succeeds even after many retries.\r\n\r\nHow many retries/over how long time did you retry? I found some other references to this problem but they seem to fix it by retrying again a little later.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2107087421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2107102262","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2107102262","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2107102262,"node_id":"IC_kwDOAAiu0c59l9Q2","user":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-13T09:36:01Z","updated_at":"2024-05-13T09:36:01Z","body":"Retries are every 5 seconds and unlimited, but each call to curl returns `Host not Found` error (11002). ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2107102262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2112316720","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2112316720","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2112316720,"node_id":"IC_kwDOAAiu0c5952Uw","user":{"login":"edmcln","id":151375304,"node_id":"U_kgDOCQXNyA","avatar_url":"https://avatars.githubusercontent.com/u/151375304?v=4","gravatar_id":"","url":"https://api.github.com/users/edmcln","html_url":"https://github.com/edmcln","followers_url":"https://api.github.com/users/edmcln/followers","following_url":"https://api.github.com/users/edmcln/following{/other_user}","gists_url":"https://api.github.com/users/edmcln/gists{/gist_id}","starred_url":"https://api.github.com/users/edmcln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edmcln/subscriptions","organizations_url":"https://api.github.com/users/edmcln/orgs","repos_url":"https://api.github.com/users/edmcln/repos","events_url":"https://api.github.com/users/edmcln/events{/privacy}","received_events_url":"https://api.github.com/users/edmcln/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-15T11:47:07Z","updated_at":"2024-05-15T11:47:07Z","body":"A simple approach is to verify whether the thread is impersonating. If it is, we don't invoke the `GetAddrInfoExW` function.\r\n\r\n``` C\r\nBOOL WINAPI IsImpersonating()\r\n{\r\n\tHANDLE hToken = NULL;\r\n\tBOOL bRes = FALSE;\r\n\tif ( OpenThreadToken( GetCurrentThread(), TOKEN_QUERY, TRUE, &hToken ) )\r\n\t{\r\n\t\tCloseHandle( hToken );\r\n\t\tbRes = TRUE;\r\n\t}\r\n\r\n\t// failure means the thread is not impersonating or OpenThreadToken has failed.\r\n\r\n\treturn bRes;\r\n}\r\n```\r\nAdd `&& ( !IsImpersonating() )` to the `if` statement:\r\n\r\nhttps://github.com/curl/curl/blob/17fbed20088a4f76985521f851e5a09c89f0d872/lib/asyn-thread.c#L639-L642\r\n\r\nI didn't have time to test this, but in theory it should fix the issue.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2112316720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edmcln","id":151375304,"node_id":"U_kgDOCQXNyA","avatar_url":"https://avatars.githubusercontent.com/u/151375304?v=4","gravatar_id":"","url":"https://api.github.com/users/edmcln","html_url":"https://github.com/edmcln","followers_url":"https://api.github.com/users/edmcln/followers","following_url":"https://api.github.com/users/edmcln/following{/other_user}","gists_url":"https://api.github.com/users/edmcln/gists{/gist_id}","starred_url":"https://api.github.com/users/edmcln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edmcln/subscriptions","organizations_url":"https://api.github.com/users/edmcln/orgs","repos_url":"https://api.github.com/users/edmcln/repos","events_url":"https://api.github.com/users/edmcln/events{/privacy}","received_events_url":"https://api.github.com/users/edmcln/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116858597","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2116858597","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2116858597,"node_id":"IC_kwDOAAiu0c5-LLLl","user":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T06:40:19Z","updated_at":"2024-05-17T06:40:19Z","body":"Would this always be true of impersonation? Is it possible the reporter is impersonating without the appropriate permissions in the token which is why winsock consistently returns WSATRY_AGAIN?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116858597/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116869439","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2116869439","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2116869439,"node_id":"IC_kwDOAAiu0c5-LN0_","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T06:48:24Z","updated_at":"2024-05-17T06:48:24Z","body":"> Would this always be true of impersonation?\r\n\r\nAnd the other way around: isn't there a risk that it returns WSATRY_AGAIN even when not impersonating?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116869439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116869760","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2116869760","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2116869760,"node_id":"IC_kwDOAAiu0c5-LN6A","user":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T06:48:39Z","updated_at":"2024-05-17T06:48:39Z","body":"/cc @pps83 ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116869760/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12843550507,"node_id":"MEE_lADOAAiu0c6IoP6lzwAAAAL9iQcr","url":"https://api.github.com/repos/curl/curl/issues/events/12843550507","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-05-17T06:48:40Z","performed_via_github_app":null},{"id":12843550522,"node_id":"SE_lADOAAiu0c6IoP6lzwAAAAL9iQc6","url":"https://api.github.com/repos/curl/curl/issues/events/12843550522","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-05-17T06:48:40Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116885082","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2116885082","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2116885082,"node_id":"IC_kwDOAAiu0c5-LRpa","user":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T07:00:35Z","updated_at":"2024-05-17T07:08:51Z","body":"> And the other way around: isn't there a risk that it returns WSATRY_AGAIN even when not impersonating?\r\n\r\nPossibly but I don't think that's something we need to address. According to the doc [WSATRY_AGAIN](https://learn.microsoft.com/en-us/windows/win32/winsock/windows-sockets-error-codes-2#WSATRY_AGAIN) \"usually\" means the host was not found because the authoritative DNS server did not reply. \r\n\r\nedit: WSATRY_AGAIN is the winsock equivalent of EAGAIN. Like how getaddrinfo can return EAGAIN to indicate temporary failure. So it's definitely possible but I think we continue to treat it as an error just like we do for getaddrinfo.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2116885082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2118761039","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2118761039","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2118761039,"node_id":"IC_kwDOAAiu0c5-SbpP","user":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-18T10:14:10Z","updated_at":"2024-05-18T12:48:19Z","body":"Not sure if it's some sort of winapi or the user's code issue, perhaps, we can add an option to disable use of GetAddrInfoExW.\r\nIf it's some sort of winapi issue, a minimal example with GetAddrInfoExW wrapped to a synchronous call vs regular getaddrinfo should be reported to MS (this would also rule out if it's winapi vs user's code issue).\r\n@timmaraju perhaps, as a workaround, you can build with [c-ares](https://github.com/c-ares/c-ares) for now.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2118761039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12855409351,"node_id":"MEE_lADOAAiu0c6IoP6lzwAAAAL-PfrH","url":"https://api.github.com/repos/curl/curl/issues/events/12855409351","actor":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-05-18T10:14:12Z","performed_via_github_app":null},{"id":12855409353,"node_id":"SE_lADOAAiu0c6IoP6lzwAAAAL-PfrJ","url":"https://api.github.com/repos/curl/curl/issues/events/12855409353","actor":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-05-18T10:14:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2119015159","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2119015159","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2119015159,"node_id":"IC_kwDOAAiu0c5-TZr3","user":{"login":"edmcln","id":151375304,"node_id":"U_kgDOCQXNyA","avatar_url":"https://avatars.githubusercontent.com/u/151375304?v=4","gravatar_id":"","url":"https://api.github.com/users/edmcln","html_url":"https://github.com/edmcln","followers_url":"https://api.github.com/users/edmcln/followers","following_url":"https://api.github.com/users/edmcln/following{/other_user}","gists_url":"https://api.github.com/users/edmcln/gists{/gist_id}","starred_url":"https://api.github.com/users/edmcln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edmcln/subscriptions","organizations_url":"https://api.github.com/users/edmcln/orgs","repos_url":"https://api.github.com/users/edmcln/repos","events_url":"https://api.github.com/users/edmcln/events{/privacy}","received_events_url":"https://api.github.com/users/edmcln/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-18T22:09:09Z","updated_at":"2024-05-18T22:09:09Z","body":"Hi all, today I spent some time on this issue, and wrote a simple Windows service that reproduces it. I used two different methods to reproduce it, using `LogonUser` & `ImpersonateLoggedOnUser`, and `WTSQueryUserToken`& `ImpersonateLoggedOnUser`, but my tests are based on the second method, that impersonates the logged-on user.\r\n\r\nThe service tries to resolve an address (**localhost** in this case) every 5 seconds, and it succeeds `without impersonation` (it runs as LOCAL SYSTEM), but it `fails with impersonation` **if UAC is enabled**, and `succeeds with impersonation` **if UAC is disabled**.\r\n\r\nPlease note that my test user belongs to the Administrators group, and UAC is enabled, which is the default behavior.\r\n\r\nHere is the code:\r\n\r\n``` C\r\n// stdafx.h : include file for standard system include files,\r\n// or project specific include files that are used frequently, but\r\n// are changed infrequently\r\n//\r\n\r\n#pragma once\r\n\r\n//#include \"targetver.h\"\r\n\r\n#include <stdio.h>\r\n#include <winsock2.h>\r\n#include <ws2tcpip.h>\r\n#include <tchar.h>\r\n#include <WtsApi32.h>\r\n#include <UserEnv.h>\r\n#pragma comment( lib, \"ws2_32.lib\" )\r\n#pragma comment( lib, \"wtsapi32.lib\" )\r\n\r\n#define MAX_ADDRESS_STRING_LENGTH   64\r\n#define SERVICE_NAME TEXT( \"IMP DNS Service\" )\r\n\r\ntypedef struct _QueryContext\r\n{\r\n\tOVERLAPPED      QueryOverlapped;\r\n\tPADDRINFOEX     QueryResults;\r\n\tHANDLE          CompleteEvent;\r\n} QUERY_CONTEXT, *PQUERY_CONTEXT;\r\n\r\n```\r\n\r\n``` C\r\n// ImpSrv.cpp : Defines the entry point for the console application.\r\n//\r\n\r\n#include \"stdafx.h\"\r\n\r\nSERVICE_STATUS g_ServiceStatus;\r\nSERVICE_STATUS_HANDLE g_StatusHandle;\r\nHANDLE g_ServiceStopEvent;\r\n\r\n/*BOOL WINAPI IsImpersonating()\r\n{\r\n\tHANDLE hToken = NULL;\r\n\tBOOL bRes = FALSE;\r\n\tif ( OpenThreadToken( GetCurrentThread(), TOKEN_QUERY, TRUE, &hToken ) )\r\n\t{\r\n\t\tCloseHandle( hToken );\r\n\t\tbRes = TRUE;\r\n\t}\r\n\r\n\t// failure means the thread is not impersonating or OpenThreadToken has failed.\r\n\r\n\treturn bRes;\r\n}*/\r\n\r\nBOOL WINAPI PrintUserInfo()\r\n{\r\n\tTCHAR szInfo [MAX_PATH] = { 0 }, szMsg [MAX_PATH] = { 0 };\r\n\tDWORD dwSize = _countof( szInfo );\r\n\tBOOL Ret = FALSE;\r\n\r\n\tif ( !GetUserName( szInfo, &dwSize ) )\r\n\t\tOutputDebugString( TEXT( \"GetUserName failed.\\n\" ) );\r\n\telse\r\n\t{\r\n\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"User name: %s\\n\" ), szInfo );\r\n\t\tOutputDebugString( szMsg );\r\n\t\tRet = TRUE;\r\n\t}\r\n\r\n\treturn Ret;\r\n}\r\n\r\nBOOL WINAPI Impersonate( PHANDLE hToken )\r\n{\r\n\tBOOL Status = FALSE;\r\n\t//\r\n\t__try {\r\n\t\tDWORD dwSessionID = WTSGetActiveConsoleSessionId();\r\n\t\tif ( dwSessionID == 0xFFFFFFFF )\r\n\t\t{\r\n\t\t\tOutputDebugString( TEXT( \"WTSGetActiveConsoleSessionId failed.\\n\" ) );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\tif ( !WTSQueryUserToken( dwSessionID, hToken ) )\r\n\t\t{\r\n\t\t\tOutputDebugString( TEXT( \"WTSQueryUserToken failed.\\n\" ) );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\tif ( !ImpersonateLoggedOnUser( *hToken ) )\r\n\t\t{\r\n\t\t\tOutputDebugString( TEXT( \"ImpersonateLoggedOnUser failed.\\n\" ) );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\tStatus = TRUE;\r\n\t}\r\n\r\n\t__finally {\r\n\t\t//\r\n\t}\r\n\r\n\treturn Status;\r\n}\r\n\r\nVOID\r\nWINAPI\r\nQueryCompleteCallback(\r\n_In_ DWORD Error,\r\n_In_ DWORD Bytes,\r\n_In_ LPOVERLAPPED Overlapped\r\n)\r\n{\r\n\tPQUERY_CONTEXT  QueryContext = NULL;\r\n\tPADDRINFOEX     QueryResults = NULL;\r\n\tWCHAR           AddrString [MAX_ADDRESS_STRING_LENGTH];\r\n\tDWORD           AddressStringLength;\r\n\tTCHAR           szMsg[MAX_PATH] = { 0 };\r\n\r\n\tUNREFERENCED_PARAMETER( Bytes );\r\n\r\n\t__try {\r\n\t\tQueryContext = CONTAINING_RECORD( Overlapped,\r\n\t\t\tQUERY_CONTEXT,\r\n\t\t\tQueryOverlapped );\r\n\r\n\t\tif ( Error != ERROR_SUCCESS )\r\n\t\t{\r\n\t\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"ResolveName failed with %d\\n\" ), Error );\r\n\t\t\tOutputDebugString( szMsg );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\tOutputDebugString( TEXT( \"ResolveName succeeded. Query Results:\\n\" ) );\r\n\r\n\t\tQueryResults = QueryContext->QueryResults;\r\n\r\n\t\twhile ( QueryResults )\r\n\t\t{\r\n\t\t\tAddressStringLength = MAX_ADDRESS_STRING_LENGTH;\r\n\r\n\t\t\tWSAAddressToString( QueryResults->ai_addr,\r\n\t\t\t\t( DWORD ) QueryResults->ai_addrlen,\r\n\t\t\t\tNULL,\r\n\t\t\t\tAddrString,\r\n\t\t\t\t&AddressStringLength );\r\n\r\n\t\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"Ip Address: %s\\n\" ), AddrString );\r\n\t\t\tOutputDebugString( szMsg );\r\n\t\t\tQueryResults = QueryResults->ai_next;\r\n\t\t}\r\n\t}\r\n\r\n\t__finally {\r\n\t\tif ( QueryContext->QueryResults )\r\n\t\t\tFreeAddrInfoEx( QueryContext->QueryResults );\r\n\r\n\t\t//\r\n\t\t//  Notify caller that the query completed\r\n\t\t//\r\n\r\n\t\tSetEvent( QueryContext->CompleteEvent );\r\n\t}\r\n\r\n\treturn;\r\n}\r\n\r\nINT WINAPI DNSCore()\r\n{\r\n\tINT                 Error = ERROR_SUCCESS;\r\n\tWSADATA             wsaData;\r\n\tBOOL                IsWSAStartupCalled = FALSE;\r\n\tADDRINFOEX          Hints;\r\n\tQUERY_CONTEXT       QueryContext;\r\n\tHANDLE              CancelHandle = NULL;\r\n\tDWORD               QueryTimeout = 4 * 1000; // 4 seconds\r\n\tTCHAR               szMsg [MAX_PATH] = { 0 };\r\n\r\n\t__try {\r\n\t\tZeroMemory( &QueryContext, sizeof( QueryContext ) );\r\n\r\n\t\tPrintUserInfo();\r\n\r\n\t\t//\r\n\t\t//  All Winsock functions require WSAStartup() to be called first\r\n\t\t//\r\n\r\n\t\tError = WSAStartup( MAKEWORD( 2, 2 ), &wsaData );\r\n\t\tif ( Error != 0 )\r\n\t\t{\r\n\t\t\t//\r\n\t\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"WSAStartup failed with %d\\n\" ), Error );\r\n\t\t\tOutputDebugString( szMsg );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\tIsWSAStartupCalled = TRUE;\r\n\r\n\t\tZeroMemory( &Hints, sizeof( Hints ) );\r\n\t\tHints.ai_family = AF_UNSPEC;\r\n\r\n\t\t//\r\n\t\t//  Note that this is a simple sample that waits/cancels a single\r\n\t\t//  asynchronous query. The reader may extend this to support\r\n\t\t//  multiple asynchronous queries.\r\n\t\t//\r\n\r\n\t\tQueryContext.CompleteEvent = CreateEvent( NULL, TRUE, FALSE, NULL );\r\n\r\n\t\tif ( QueryContext.CompleteEvent == NULL )\r\n\t\t{\r\n\t\t\tError = GetLastError();\r\n\t\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"Failed to create completion event: Error %d\\n\" ), Error );\r\n\t\t\tOutputDebugString( szMsg );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t//  Initiate asynchronous GetAddrInfoExW.\r\n\t\t//\r\n\t\t//  Note GetAddrInfoEx can also be invoked asynchronously using an event\r\n\t\t//  in the overlapped object (Just set hEvent in the Overlapped object\r\n\t\t//  and set NULL as completion callback.)\r\n\t\t//\r\n\t\t//  This sample uses the completion callback method.\r\n\t\t//\r\n\r\n\t\tError = GetAddrInfoExW( TEXT( \"localhost\" ),\r\n\t\t\tNULL,\r\n\t\t\tNS_DNS,\r\n\t\t\tNULL,\r\n\t\t\t&Hints,\r\n\t\t\t&QueryContext.QueryResults,\r\n\t\t\tNULL,\r\n\t\t\t&QueryContext.QueryOverlapped,\r\n\t\t\tQueryCompleteCallback,\r\n\t\t\t&CancelHandle );\r\n\r\n\t\t//\r\n\t\t//  If GetAddrInfoExW() returns  WSA_IO_PENDING, GetAddrInfoExW will invoke\r\n\t\t//  the completion routine. If GetAddrInfoExW returned anything else we must\r\n\t\t//  invoke the completion directly.\r\n\t\t//\r\n\r\n\t\tif ( Error != WSA_IO_PENDING )\r\n\t\t{\r\n\t\t\tQueryCompleteCallback( Error, 0, &QueryContext.QueryOverlapped );\r\n\t\t\t__leave;\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t//  Wait for query completion for 5 seconds and cancel the query if it has\r\n\t\t//  not yet completed.\r\n\t\t//\r\n\r\n\t\tif ( WaitForSingleObject( QueryContext.CompleteEvent,\r\n\t\t\tQueryTimeout ) == WAIT_TIMEOUT )\r\n\t\t{\r\n\r\n\t\t\t//\r\n\t\t\t//  Cancel the query: Note that the GetAddrInfoExCancelcancel call does\r\n\t\t\t//  not block, so we must wait for the completion routine to be invoked.\r\n\t\t\t//  If we fail to wait, WSACleanup() could be called while an\r\n\t\t\t//  asynchronous query is still in progress, possibly causing a crash.\r\n\t\t\t//\r\n\r\n\t\t\t_stprintf_s( szMsg, _countof( szMsg ), TEXT( \"The query took longer than %d seconds to complete; cancelling the query...\\n\" ), QueryTimeout / 1000 );\r\n\t\t\tOutputDebugString( szMsg );\r\n\r\n\t\t\tGetAddrInfoExCancel( &CancelHandle );\r\n\r\n\t\t\tWaitForSingleObject( QueryContext.CompleteEvent,\r\n\t\t\t\tINFINITE );\r\n\t\t}\r\n\t}\r\n\r\n\t__finally {\r\n\t\tif ( IsWSAStartupCalled )\r\n\t\t{\r\n\t\t\tWSACleanup();\r\n\t\t}\r\n\r\n\t\tif ( QueryContext.CompleteEvent )\r\n\t\t{\r\n\t\t\tCloseHandle( QueryContext.CompleteEvent );\r\n\t\t}\r\n\t}\r\n\r\n\treturn Error;\r\n}\r\n\r\nVOID WINAPI ServiceControlHandler( DWORD CtrlCode )\r\n{\r\n\tswitch ( CtrlCode )\r\n\t{\r\n\t\tcase SERVICE_CONTROL_INTERROGATE:\r\n\t\t\tbreak;\r\n\r\n\t\tcase SERVICE_CONTROL_SHUTDOWN:\r\n\t\tcase SERVICE_CONTROL_STOP:\r\n\t\t\tg_ServiceStatus.dwCurrentState = SERVICE_STOP_PENDING;\r\n\t\t\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n\r\n\t\t\tSetEvent( g_ServiceStopEvent );\r\n\t\t\treturn;\r\n\r\n\t\tcase SERVICE_CONTROL_PAUSE:\r\n\t\t\tbreak;\r\n\r\n\t\tcase SERVICE_CONTROL_CONTINUE:\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tif ( CtrlCode >= 128 && CtrlCode <= 255 )\r\n\t\t\t\t// user defined control code\r\n\t\t\t\tbreak;\r\n\t\t\telse\r\n\t\t\t\t// unrecognised control code\r\n\t\t\t\tbreak;\r\n\t}\r\n\r\n\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n}\r\n\r\nVOID WINAPI ServiceMain( DWORD argc, TCHAR* argv[] )\r\n{\r\n\t// Init\r\n\tg_ServiceStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS;\r\n\tg_ServiceStatus.dwCurrentState = SERVICE_START_PENDING;\r\n\tg_ServiceStatus.dwControlsAccepted = 0;\r\n\tg_ServiceStatus.dwWin32ExitCode = NO_ERROR;\r\n\tg_ServiceStatus.dwServiceSpecificExitCode = NO_ERROR;\r\n\tg_ServiceStatus.dwCheckPoint = 0;\r\n\tg_ServiceStatus.dwWaitHint = 0;\r\n\r\n\tg_StatusHandle = RegisterServiceCtrlHandler( SERVICE_NAME, ServiceControlHandler );\r\n\r\n\tif ( g_StatusHandle )\r\n\t{\r\n\t\t// service is starting\r\n\t\tg_ServiceStatus.dwCurrentState = SERVICE_START_PENDING;\r\n\t\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n\r\n\t\t// do initialisation here\r\n\t\tg_ServiceStopEvent = CreateEvent( NULL, FALSE, FALSE, NULL );\r\n\r\n\t\t// running\r\n\t\tg_ServiceStatus.dwControlsAccepted |= ( SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_SHUTDOWN );\r\n\t\tg_ServiceStatus.dwCurrentState = SERVICE_RUNNING;\r\n\t\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n\r\n\t\t/*HANDLE hToken = NULL;\r\n\t\tImpersonate( &hToken );*/\r\n\r\n\t\tdo\r\n\t\t{\r\n\t\t\t//\r\n\t\t\tDNSCore();\r\n\t\t} while ( WaitForSingleObject( g_ServiceStopEvent, 5000 ) == WAIT_TIMEOUT );\r\n\r\n\t\t//\r\n\t\t//RevertToSelf();\r\n\t\t\r\n\t\t//if ( hToken ) CloseHandle( hToken );\r\n\r\n\t\tg_ServiceStatus.dwCurrentState = SERVICE_STOP_PENDING;\r\n\t\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n\r\n\t\t//\r\n\t\tCloseHandle( g_ServiceStopEvent );\r\n\t\tg_ServiceStopEvent = NULL;\r\n\t\t//\r\n\r\n\t\t//\r\n\t\tg_ServiceStatus.dwControlsAccepted &= ~( SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_SHUTDOWN );\r\n\t\tg_ServiceStatus.dwCurrentState = SERVICE_STOPPED;\r\n\t\tSetServiceStatus( g_StatusHandle, &g_ServiceStatus );\r\n\t}\r\n}\r\n\r\nVOID WINAPI RunService()\r\n{\r\n\tSERVICE_TABLE_ENTRY serviceTable[] =\r\n\t{\r\n\t\t{ SERVICE_NAME, ServiceMain },\r\n\t\t{ NULL, NULL }\r\n\t};\r\n\r\n\tStartServiceCtrlDispatcher( serviceTable );\r\n}\r\n\r\nVOID WINAPI InstallService()\r\n{\r\n\tSC_HANDLE hSrvCtrlMgr = OpenSCManager( NULL, NULL, SC_MANAGER_CREATE_SERVICE );\r\n\r\n\tif ( hSrvCtrlMgr )\r\n\t{\r\n\t\tTCHAR szPath[ MAX_PATH + 1 ];\r\n\t\tif ( GetModuleFileName( NULL, szPath, sizeof( szPath ) / sizeof( szPath [0] ) ) > 0 )\r\n\t\t{\r\n\t\t\tSC_HANDLE hService = CreateService( hSrvCtrlMgr,\r\n\t\t\t\tSERVICE_NAME, SERVICE_NAME, SERVICE_ALL_ACCESS, SERVICE_WIN32_OWN_PROCESS, \r\n\t\t\t\tSERVICE_DEMAND_START, SERVICE_ERROR_IGNORE, szPath, NULL, NULL, NULL, NULL, NULL );\r\n\t\t\tif ( hService )\r\n\t\t\t\tCloseServiceHandle( hService );\r\n\t\t}\r\n\r\n\t\tCloseServiceHandle( hSrvCtrlMgr );\r\n\t}\r\n}\r\n\r\nVOID WINAPI UninstallService()\r\n{\r\n\tSC_HANDLE hSrvCtrlMgr = OpenSCManager( NULL, NULL, SC_MANAGER_CONNECT );\r\n\r\n\tif ( hSrvCtrlMgr )\r\n\t{\r\n\t\tSC_HANDLE hService = OpenService( hSrvCtrlMgr,\r\n\t\t\tSERVICE_NAME, SERVICE_QUERY_STATUS | DELETE );\r\n\t\tif ( hService )\r\n\t\t{\r\n\t\t\tSERVICE_STATUS Status;\r\n\t\t\tif ( QueryServiceStatus( hService, &Status ) )\r\n\t\t\t{\r\n\t\t\t\tif ( Status.dwCurrentState == SERVICE_STOPPED )\r\n\t\t\t\t\tDeleteService( hService );\r\n\t\t\t}\r\n\r\n\t\t\tCloseServiceHandle( hService );\r\n\t\t}\r\n\r\n\t\tCloseServiceHandle( hSrvCtrlMgr );\r\n\t}\r\n}\r\n\r\nint _tmain( int argc, TCHAR* argv[] )\r\n{\r\n\tif ( argc > 1 && _tcsicmp( argv[1], TEXT(\"install\") ) == 0 )\r\n\t{\r\n\t\tInstallService();\r\n\t}\r\n\telse if ( argc > 1 && _tcsicmp( argv [1], TEXT( \"uninstall\" ) ) == 0 )\r\n\t{\r\n\t\tUninstallService();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRunService();\r\n\t}\r\n\r\n\treturn 0;\r\n}\r\n```\r\n\r\nSteps to reproduce (after compiling the code):\r\n- Run `ImpSrv.exe install` to install the service, and `ImpSrv.exe uninstall` to uninstall it.\r\n- Download _DebugView_ from [Microsoft](https://learn.microsoft.com/en-us/sysinternals/downloads/debugview) to monitor the debug output (it requires Admin privileges, and don't forget to **Enable** `Capture Global Win32`).\r\n- Start the service and view the service output in _DebugView_, you should get something like this:\r\n\r\n![Svc](https://github.com/curl/curl/assets/151375304/267370bd-2827-4724-8b9f-2d244cef464e)\r\n\r\n```\r\n00000001\t0.00000000\t[4688] User name: SYSTEM\t\r\n00000002\t0.02582780\t[4688] ResolveName succeeded. Query Results:\t\r\n00000003\t0.02587420\t[4688] Ip Address: ::1\t\r\n00000004\t0.02637750\t[4688] Ip Address: 127.0.0.1\t\r\n00000005\t5.02249575\t[4688] User name: SYSTEM\t\r\n00000006\t5.04618120\t[4688] ResolveName succeeded. Query Results:\t\r\n00000007\t5.04635906\t[4688] Ip Address: ::1\t\r\n00000008\t5.04654169\t[4688] Ip Address: 127.0.0.1\r\n```\r\n- Stop the service, and enable impersonation by uncommenting four line of the code, and recompiling it.\r\n``` C\r\nHANDLE hToken = NULL;\r\nImpersonate( &hToken );\r\nRevertToSelf();\r\nif ( hToken ) CloseHandle( hToken );\r\n```\r\n\r\n- Restart the service and view the debug output, which should look like this (UAC is enabled, also note that the username is redacted here):\r\n\r\n![LogFail](https://github.com/curl/curl/assets/151375304/438d05be-6cf3-41c1-9543-7892433951aa)\r\n\r\n- Stop the service, launch the RegistryEditor and Disable the UAC by setting `EnableLUA` to `0` (located at `HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System` - also note that I set the `ConsentPromptBehaviorAdmin` to `0`, which is **not** necessary)\r\n\r\n![UAC_REG](https://github.com/curl/curl/assets/151375304/d645c66b-d131-43ce-98b7-1433281b2441)\r\n\r\nAfter rebooting the system and restarting the service, the debug output should look like this:\r\n\r\n![LogSuccess](https://github.com/curl/curl/assets/151375304/e3abb273-0e13-44e1-a7d2-b815f31d4f15)\r\n\r\nThe research still continues, and I'm trying to find the root cause of the issue to fix it properly.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2119015159/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edmcln","id":151375304,"node_id":"U_kgDOCQXNyA","avatar_url":"https://avatars.githubusercontent.com/u/151375304?v=4","gravatar_id":"","url":"https://api.github.com/users/edmcln","html_url":"https://github.com/edmcln","followers_url":"https://api.github.com/users/edmcln/followers","following_url":"https://api.github.com/users/edmcln/following{/other_user}","gists_url":"https://api.github.com/users/edmcln/gists{/gist_id}","starred_url":"https://api.github.com/users/edmcln/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edmcln/subscriptions","organizations_url":"https://api.github.com/users/edmcln/orgs","repos_url":"https://api.github.com/users/edmcln/repos","events_url":"https://api.github.com/users/edmcln/events{/privacy}","received_events_url":"https://api.github.com/users/edmcln/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2122701517","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2122701517","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2122701517,"node_id":"IC_kwDOAAiu0c5-hdrN","user":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T13:56:48Z","updated_at":"2024-05-21T14:02:25Z","body":"> Would this always be true of impersonation? Is it possible the reporter is impersonating without the appropriate permissions in the token which is why winsock consistently returns WSATRY_AGAIN?\r\n\r\nI checked all the necessary permissions on the token and they are as recommended and even then winsock consistently responds `WSATRY_AGAIN`. Apparently the impersonation and the async operations don't work together. There are multiple issues in .NET repo for a similar problem. \r\n\r\nhttps://github.com/dotnet/runtime/issues/29351 (The thread is long and the information is dispersed all over)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2122701517/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T23:24:14Z","updated_at":"2024-05-21T23:24:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/curl/curl/issues/13738","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13738/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13738/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13738/events","html_url":"https://github.com/curl/curl/pull/13738","id":2309275314,"node_id":"PR_kwDOAAiu0c5wIt_L","number":13738,"title":"Avoid using GetAddrInfoExW when impersonation is used","user":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"},{"id":975635480,"node_id":"MDU6TGFiZWw5NzU2MzU0ODA=","url":"https://api.github.com/repos/curl/curl/labels/name%20lookup","name":"name lookup","color":"0052cc","default":false,"description":"DNS and related tech"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-05-21T23:24:14Z","updated_at":"2024-05-26T09:30:02Z","closed_at":"2024-05-23T21:58:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":569041,"node_id":"MDEwOlJlcG9zaXRvcnk1NjkwNDE=","name":"curl","full_name":"curl/curl","private":false,"owner":{"login":"curl","id":16928085,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2OTI4MDg1","avatar_url":"https://avatars.githubusercontent.com/u/16928085?v=4","gravatar_id":"","url":"https://api.github.com/users/curl","html_url":"https://github.com/curl","followers_url":"https://api.github.com/users/curl/followers","following_url":"https://api.github.com/users/curl/following{/other_user}","gists_url":"https://api.github.com/users/curl/gists{/gist_id}","starred_url":"https://api.github.com/users/curl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/curl/subscriptions","organizations_url":"https://api.github.com/users/curl/orgs","repos_url":"https://api.github.com/users/curl/repos","events_url":"https://api.github.com/users/curl/events{/privacy}","received_events_url":"https://api.github.com/users/curl/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/curl/curl","description":"A command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTMPS, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET, TFTP, WS and WSS. libcurl offers a myriad of powerful features","fork":false,"url":"https://api.github.com/repos/curl/curl","forks_url":"https://api.github.com/repos/curl/curl/forks","keys_url":"https://api.github.com/repos/curl/curl/keys{/key_id}","collaborators_url":"https://api.github.com/repos/curl/curl/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/curl/curl/teams","hooks_url":"https://api.github.com/repos/curl/curl/hooks","issue_events_url":"https://api.github.com/repos/curl/curl/issues/events{/number}","events_url":"https://api.github.com/repos/curl/curl/events","assignees_url":"https://api.github.com/repos/curl/curl/assignees{/user}","branches_url":"https://api.github.com/repos/curl/curl/branches{/branch}","tags_url":"https://api.github.com/repos/curl/curl/tags","blobs_url":"https://api.github.com/repos/curl/curl/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/curl/curl/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/curl/curl/git/refs{/sha}","trees_url":"https://api.github.com/repos/curl/curl/git/trees{/sha}","statuses_url":"https://api.github.com/repos/curl/curl/statuses/{sha}","languages_url":"https://api.github.com/repos/curl/curl/languages","stargazers_url":"https://api.github.com/repos/curl/curl/stargazers","contributors_url":"https://api.github.com/repos/curl/curl/contributors","subscribers_url":"https://api.github.com/repos/curl/curl/subscribers","subscription_url":"https://api.github.com/repos/curl/curl/subscription","commits_url":"https://api.github.com/repos/curl/curl/commits{/sha}","git_commits_url":"https://api.github.com/repos/curl/curl/git/commits{/sha}","comments_url":"https://api.github.com/repos/curl/curl/comments{/number}","issue_comment_url":"https://api.github.com/repos/curl/curl/issues/comments{/number}","contents_url":"https://api.github.com/repos/curl/curl/contents/{+path}","compare_url":"https://api.github.com/repos/curl/curl/compare/{base}...{head}","merges_url":"https://api.github.com/repos/curl/curl/merges","archive_url":"https://api.github.com/repos/curl/curl/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/curl/curl/downloads","issues_url":"https://api.github.com/repos/curl/curl/issues{/number}","pulls_url":"https://api.github.com/repos/curl/curl/pulls{/number}","milestones_url":"https://api.github.com/repos/curl/curl/milestones{/number}","notifications_url":"https://api.github.com/repos/curl/curl/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/curl/curl/labels{/name}","releases_url":"https://api.github.com/repos/curl/curl/releases{/id}","deployments_url":"https://api.github.com/repos/curl/curl/deployments","created_at":"2010-03-18T22:32:22Z","updated_at":"2025-11-10T09:41:55Z","pushed_at":"2025-11-10T12:18:24Z","git_url":"git://github.com/curl/curl.git","ssh_url":"git@github.com:curl/curl.git","clone_url":"https://github.com/curl/curl.git","svn_url":"https://github.com/curl/curl","homepage":"https://curl.se/","size":118458,"stargazers_count":39830,"watchers_count":39830,"language":"C","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":6941,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":43,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["c","client","curl","ftp","gopher","hacktoberfest","http","https","imaps","ldap","libcurl","library","mqtt","pop3","scp","sftp","transfer-data","transferring-data","user-agent","websocket"],"visibility":"public","forks":6941,"open_issues":43,"watchers":39830,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/curl/curl/pulls/13738","html_url":"https://github.com/curl/curl/pull/13738","diff_url":"https://github.com/curl/curl/pull/13738.diff","patch_url":"https://github.com/curl/curl/pull/13738.patch","merged_at":null},"body":"Multiple reports suggest that GetAddrInfoExW fails when impersonation is used. This PR checks if thread is impersonating and avoids using GetAddrInfoExW api.\r\n\r\nfixes #13612","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13738/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13738/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":12886450146,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMAF5_i","url":"https://api.github.com/repos/curl/curl/issues/events/12886450146","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"27a178afb8b43b0b1ae962b1b7f996f19f979dd8","commit_url":"https://api.github.com/repos/pps83/curl/commits/27a178afb8b43b0b1ae962b1b7f996f19f979dd8","created_at":"2024-05-21T23:24:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2123586857","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2123586857","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2123586857,"node_id":"IC_kwDOAAiu0c5-k10p","user":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T23:25:15Z","updated_at":"2024-05-21T23:25:15Z","body":"> [dotnet/runtime#29351](https://github.com/dotnet/runtime/issues/29351) (The thread is long and the information is dispersed all over)\r\n\r\nIt does seem like winapi bug. Let me know if [the fix works](https://github.com/curl/curl/pull/13738) for you","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2123586857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12886469594,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMAF-va","url":"https://api.github.com/repos/curl/curl/issues/events/12886469594","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ec98e8a76731c15bd1b274935fa81a1a55d8ce04","commit_url":"https://api.github.com/repos/pps83/curl/commits/ec98e8a76731c15bd1b274935fa81a1a55d8ce04","created_at":"2024-05-21T23:28:02Z","performed_via_github_app":null},{"id":12886500614,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMAGGUG","url":"https://api.github.com/repos/curl/curl/issues/events/12886500614","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5137b66554c69b628f1397bd66ca69770216a056","commit_url":"https://api.github.com/repos/pps83/curl/commits/5137b66554c69b628f1397bd66ca69770216a056","created_at":"2024-05-21T23:33:48Z","performed_via_github_app":null},{"id":12886684239,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMAGzJP","url":"https://api.github.com/repos/curl/curl/issues/events/12886684239","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ee490d5a5806ca0dbc2fe9639305533610f6ee66","commit_url":"https://api.github.com/repos/pps83/curl/commits/ee490d5a5806ca0dbc2fe9639305533610f6ee66","created_at":"2024-05-22T00:07:43Z","performed_via_github_app":null},{"id":12903718712,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMBHx84","url":"https://api.github.com/repos/curl/curl/issues/events/12903718712","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b50dd6cf47e72416bb6db12d58e5f243bf6212e0","commit_url":"https://api.github.com/repos/pps83/curl/commits/b50dd6cf47e72416bb6db12d58e5f243bf6212e0","created_at":"2024-05-23T05:44:24Z","performed_via_github_app":null},{"id":12903737135,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMBH2cv","url":"https://api.github.com/repos/curl/curl/issues/events/12903737135","actor":{"login":"pps83","id":1614246,"node_id":"MDQ6VXNlcjE2MTQyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/1614246?v=4","gravatar_id":"","url":"https://api.github.com/users/pps83","html_url":"https://github.com/pps83","followers_url":"https://api.github.com/users/pps83/followers","following_url":"https://api.github.com/users/pps83/following{/other_user}","gists_url":"https://api.github.com/users/pps83/gists{/gist_id}","starred_url":"https://api.github.com/users/pps83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pps83/subscriptions","organizations_url":"https://api.github.com/users/pps83/orgs","repos_url":"https://api.github.com/users/pps83/repos","events_url":"https://api.github.com/users/pps83/events{/privacy}","received_events_url":"https://api.github.com/users/pps83/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2bf247d8e64cfc2d7507e355442d4cb22f7450b8","commit_url":"https://api.github.com/repos/pps83/curl/commits/2bf247d8e64cfc2d7507e355442d4cb22f7450b8","created_at":"2024-05-23T05:46:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/curl/curl/issues/comments/2127486802","html_url":"https://github.com/curl/curl/issues/13612#issuecomment-2127486802","issue_url":"https://api.github.com/repos/curl/curl/issues/13612","id":2127486802,"node_id":"IC_kwDOAAiu0c5-zt9S","user":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T15:53:26Z","updated_at":"2024-05-23T15:53:51Z","body":"> It does seem like winapi bug. Let me know if [the fix works](https://github.com/curl/curl/pull/13738) for you\r\n\r\nYes, the fix works, now the Windows service can resolve the DNS addresses even with impersonation!  ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/curl/curl/issues/comments/2127486802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12915648278,"node_id":"CE_lADOAAiu0c6IoP6lzwAAAAMB1ScW","url":"https://api.github.com/repos/curl/curl/issues/events/12915648278","actor":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"0caadc1f24d20514eed2bf6e5ef0adc140f122c3","commit_url":"https://api.github.com/repos/curl/curl/commits/0caadc1f24d20514eed2bf6e5ef0adc140f122c3","created_at":"2024-05-23T21:58:28Z","state_reason":null,"performed_via_github_app":null},{"id":12916990423,"node_id":"REFE_lADOAAiu0c6IoP6lzwAAAAMB6aHX","url":"https://api.github.com/repos/curl/curl/issues/events/12916990423","actor":{"login":"dyhkwong","id":50692134,"node_id":"MDQ6VXNlcjUwNjkyMTM0","avatar_url":"https://avatars.githubusercontent.com/u/50692134?v=4","gravatar_id":"","url":"https://api.github.com/users/dyhkwong","html_url":"https://github.com/dyhkwong","followers_url":"https://api.github.com/users/dyhkwong/followers","following_url":"https://api.github.com/users/dyhkwong/following{/other_user}","gists_url":"https://api.github.com/users/dyhkwong/gists{/gist_id}","starred_url":"https://api.github.com/users/dyhkwong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dyhkwong/subscriptions","organizations_url":"https://api.github.com/users/dyhkwong/orgs","repos_url":"https://api.github.com/users/dyhkwong/repos","events_url":"https://api.github.com/users/dyhkwong/events{/privacy}","received_events_url":"https://api.github.com/users/dyhkwong/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0caadc1f24d20514eed2bf6e5ef0adc140f122c3","commit_url":"https://api.github.com/repos/dyhkwong/curl/commits/0caadc1f24d20514eed2bf6e5ef0adc140f122c3","created_at":"2024-05-24T01:17:02Z","performed_via_github_app":null}]