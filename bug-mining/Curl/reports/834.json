{"url":"https://api.github.com/repos/curl/curl/issues/19334","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/19334/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/19334/comments","events_url":"https://api.github.com/repos/curl/curl/issues/19334/events","html_url":"https://github.com/curl/curl/issues/19334","id":3582108794,"node_id":"I_kwDOAAiu0c7VgqR6","number":19334,"title":"curl 8.16 breaks http2 transfers with writefunc pausing","user":{"login":"pennae","id":82953136,"node_id":"MDQ6VXNlcjgyOTUzMTM2","avatar_url":"https://avatars.githubusercontent.com/u/82953136?v=4","gravatar_id":"","url":"https://api.github.com/users/pennae","html_url":"https://github.com/pennae","followers_url":"https://api.github.com/users/pennae/followers","following_url":"https://api.github.com/users/pennae/following{/other_user}","gists_url":"https://api.github.com/users/pennae/gists{/gist_id}","starred_url":"https://api.github.com/users/pennae/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennae/subscriptions","organizations_url":"https://api.github.com/users/pennae/orgs","repos_url":"https://api.github.com/users/pennae/repos","events_url":"https://api.github.com/users/pennae/events{/privacy}","received_events_url":"https://api.github.com/users/pennae/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icing","id":15102,"node_id":"MDQ6VXNlcjE1MTAy","avatar_url":"https://avatars.githubusercontent.com/u/15102?v=4","gravatar_id":"","url":"https://api.github.com/users/icing","html_url":"https://github.com/icing","followers_url":"https://api.github.com/users/icing/followers","following_url":"https://api.github.com/users/icing/following{/other_user}","gists_url":"https://api.github.com/users/icing/gists{/gist_id}","starred_url":"https://api.github.com/users/icing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icing/subscriptions","organizations_url":"https://api.github.com/users/icing/orgs","repos_url":"https://api.github.com/users/icing/repos","events_url":"https://api.github.com/users/icing/events{/privacy}","received_events_url":"https://api.github.com/users/icing/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2025-11-03T13:38:40Z","updated_at":"2025-11-03T15:11:24Z","closed_at":"2025-11-03T15:11:04Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nthe [Lix transfer code](https://git.lix.systems/lix-project/lix/src/branch/main/lix/libstore/filetransfer.cc) uses curl with http2 at very high concurrency for transfers. with the curl 8.16 release we've seen transfers fail with `CURLE_WRITE_ERROR` when using http2 as the transport. we've bisected this to https://github.com/curl/curl/commit/fa9151b41ad986e0514d99dd3fe149f26a7a57a3: with this patch applied our code sees transfers die with write errors when they try to pause themselves. using the commit prior to fa9151b41ad986e0514d99dd3fe149f26a7a57a3 resolves the issue, not pausing any transfers also resolves the issue. curl 8.15 and earlier work fine.\n\nwe haven't managed to extract a reliable reproducer from our code. the only reliable reproducer we have so far is to download many things concurrently under rr chaos mode. since it's related to pausing of transfers we'd guess that it's caused by the refactor returning `CURLE_AGAIN` internally rather than the previous `CURLE_OK` when transfers are paused, but we haven't verified that.\n\n### I expected the following\n\ntransfers to not die with write errors when paused\n\n### curl/libcurl version\n\ncurl 8.16.0, or anything past fa9151b41ad986e0514d99dd3fe149f26a7a57a3\n\n### operating system\n\nNixOS unstable","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/19334/reactions","total_count":6,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":6,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/19334/timeline","performed_via_github_app":null,"state_reason":"completed"}