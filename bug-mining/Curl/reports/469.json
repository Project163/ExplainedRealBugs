{"url":"https://api.github.com/repos/curl/curl/issues/13782","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13782/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13782/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13782/events","html_url":"https://github.com/curl/curl/issues/13782","id":2317315200,"node_id":"I_kwDOAAiu0c6KH2yA","number":13782,"title":"8.8.0: Test 1553 (IMAP cleanup before a connection was created) appears flaky on some Gentoo systems","user":{"login":"Kangie","id":9733178,"node_id":"MDQ6VXNlcjk3MzMxNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9733178?v=4","gravatar_id":"","url":"https://api.github.com/users/Kangie","html_url":"https://github.com/Kangie","followers_url":"https://api.github.com/users/Kangie/followers","following_url":"https://api.github.com/users/Kangie/following{/other_user}","gists_url":"https://api.github.com/users/Kangie/gists{/gist_id}","starred_url":"https://api.github.com/users/Kangie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kangie/subscriptions","organizations_url":"https://api.github.com/users/Kangie/orgs","repos_url":"https://api.github.com/users/Kangie/repos","events_url":"https://api.github.com/users/Kangie/events{/privacy}","received_events_url":"https://api.github.com/users/Kangie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":282653573,"node_id":"MDU6TGFiZWwyODI2NTM1NzM=","url":"https://api.github.com/repos/curl/curl/labels/IMAP","name":"IMAP","color":"f7c6c7","default":false,"description":null},{"id":887227423,"node_id":"MDU6TGFiZWw4ODcyMjc0MjM=","url":"https://api.github.com/repos/curl/curl/labels/tests","name":"tests","color":"a7a8e8","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2024-05-25T23:45:10Z","updated_at":"2024-05-30T06:29:06Z","closed_at":"2024-05-30T06:29:06Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am unable to have test 1553 pass consistently on Gentoo in 8.8.0, however we have not had this issue with previous versions.\r\n\r\nI raised this briefly during the 8.8.0-older-mbedtls testing, but Stefan and Daniel were unable to reproduce so I put it down to a weird failure as it'd already passed on another of my dev machines with a very similar configuration. One of the Gentoo automated build machines (tinderboxes) and a Gentoo developer have noted this issue to me, so I figured it worth raising here.\r\n\r\nI have one workstation where this test consistently passes. I have another where it passes if I run the tests as my user or if I run them with the portage `network-sandbox` feature disabled (fine for testing, but not sustainable).\r\n\r\nWe can disable this test in the Gentoo ebuild however I'm interested in why this was not an issue for us in the past and appears inconsistent.\r\n\r\n[build.log](https://github.com/curl/curl/files/15445469/build.log)\r\n\r\n### See also\r\n\r\n- https://bugs.gentoo.org/932660\r\n\r\n### I did this\r\n\r\n```\r\nsrcdir=/var/tmp/portage/net-misc/curl-8.8.0/work/curl-8.8.0/tests /usr/bin/perl -I/var/tmp/portage/net-misc/cu\r\nrl-8.8.0/work/curl-8.8.0/tests /var/tmp/portage/net-misc/curl-8.8.0/work/curl-8.8.0/tests/runtests.pl -a -s -n\r\n -v -a -k -am -p -j64 !241 !1083\r\nUsing curl: ../src/curl\r\nCMD (0): ../src/curl --version 1>log/curlverout.log 2>log/curlvererr.log\r\n********* System characteristics ******** \r\n* curl 8.8.0 (x86_64-pc-linux-gnu) \r\n* libcurl/8.8.0 OpenSSL/3.2.1 zlib/1.3.1 c-ares/1.28.1 libpsl/0.21.5 nghttp2/1.62.0\r\n* Features: alt-svc AsynchDNS HSTS HTTP2 HTTPS-proxy IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP UnixS\r\nockets\r\n* Disabled: \r\n* Host: localhost\r\n* System: Linux localhost 6.8.8-gentoo--bouncy-mouse #1 SMP PREEMPT_DYNAMIC Wed May  8 14:03:09 AEST 2024 x86_\r\n64 AMD Ryzen 9 5950X 16-Core Processor AuthenticAMD GNU/Linux\r\n* OS: linux\r\n* Jobs: 64\r\n* Env: \r\n* Seed: 241509\r\n* Servers: HTTP-IPv6 HTTP-unix FTP-IPv6 \r\n*****************************************\r\n\r\n. . .\r\n\r\n./libtest/lib1553 imap://non-existing-host.haxx.se:43035/1553 > log/4/stdout1553 2> log/4/stderr1553\r\n 1553: exit FAILED\r\n== Contents of files in the log/4/ dir after test 1553\r\n=== Start of file server.cmd\r\n Testnum 1553\r\n=== End of file server.cmd\r\n=== Start of file stderr1553\r\n URL: imap://non-existing-host.haxx.se:43035/1553\r\n /var/tmp/portage/net-misc/curl-8.8.0/work/curl-8.8.0/tests/libtest/lib1553.c:93 ABORTING TEST, since it seems that it would have run forever (60057 ms > 60000 ms)\r\n```\r\n\r\n### I expected the following\r\n\r\n```\r\nTESTDONE: 1700 tests were considered during 39 seconds.\r\nTESTDONE: 1365 tests out of 1365 reported OK: 100%\r\n```\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.8.0\r\n\r\n### operating system\r\n\r\nGentoo Linux","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13782/timeline","performed_via_github_app":null,"state_reason":"completed"}