{"url":"https://api.github.com/repos/curl/curl/issues/11720","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/11720/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/11720/comments","events_url":"https://api.github.com/repos/curl/curl/issues/11720/events","html_url":"https://github.com/curl/curl/issues/11720","id":1863446160,"node_id":"I_kwDOAAiu0c5vEe6Q","number":11720,"title":"Implicit FTPS upload timeout since curl 7.88.1","user":{"login":"AnonTester","id":40003252,"node_id":"MDQ6VXNlcjQwMDAzMjUy","avatar_url":"https://avatars.githubusercontent.com/u/40003252?v=4","gravatar_id":"","url":"https://api.github.com/users/AnonTester","html_url":"https://github.com/AnonTester","followers_url":"https://api.github.com/users/AnonTester/followers","following_url":"https://api.github.com/users/AnonTester/following{/other_user}","gists_url":"https://api.github.com/users/AnonTester/gists{/gist_id}","starred_url":"https://api.github.com/users/AnonTester/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnonTester/subscriptions","organizations_url":"https://api.github.com/users/AnonTester/orgs","repos_url":"https://api.github.com/users/AnonTester/repos","events_url":"https://api.github.com/users/AnonTester/events{/privacy}","received_events_url":"https://api.github.com/users/AnonTester/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""},{"id":184118265,"node_id":"MDU6TGFiZWwxODQxMTgyNjU=","url":"https://api.github.com/repos/curl/curl/labels/FTP","name":"FTP","color":"bfd4f2","default":false,"description":null},{"id":352090567,"node_id":"MDU6TGFiZWwzNTIwOTA1Njc=","url":"https://api.github.com/repos/curl/curl/labels/KNOWN_BUGS%20material","name":"KNOWN_BUGS material","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-08-23T14:24:20Z","updated_at":"2024-02-27T23:21:35Z","closed_at":"2024-02-27T23:21:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nThis is possibly related to the report here: https://github.com/curl/curl/issues/11534\r\n\r\nImplicit FTPS file uploads time out since upgrade of my system to Debian 12.1 with curl 7.88.1. I don't fully understand the logs, but it looks as if the TLS session gets closed and not reopened for the file transfer. This was working fine on Debian 11.\r\nI tried installing the curl 8.2.1 from Debian sid and also the 7.88.1 version for Debian 11 but the same happens. I tried an ubuntu system which worked fine. This one used curl version 7.81.0.\r\n\r\nVerbose log of the connection attempt and timeout:\r\n```\r\n# curl -v -T test.txt ftps://host/folder/ --user user:pass --insecure\r\n* processing: ftps://host/folder/test.txt\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying xxxxx:990...\r\n* Connected to xxxxx port 990\r\n} [5 bytes data]\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n} [512 bytes data]\r\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\r\n{ [89 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\r\n{ [1013 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\r\n{ [333 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\r\n{ [4 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\r\n} [70 bytes data]\r\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\n} [1 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\r\n} [16 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Finished (20):\r\n{ [16 bytes data]\r\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\r\n* Server certificate:\r\n*  subject: CN=*.xxxxxxxxxxxxxxx\r\n*  start date: Jul 27 18:04:16 2020 GMT\r\n*  expire date: Jul 25 18:04:16 2030 GMT\r\n*  issuer: CN=*.xxxxxxxxxxxxxxxxxxxx\r\n*  SSL certificate verify result: self-signed certificate (18), continuing anyway.\r\n{ [5 bytes data]\r\n< 220 Wing FTP Server ready...\r\n} [5 bytes data]\r\n> USER user\r\n{ [5 bytes data]\r\n< 331 Password required for xxxxx\r\n} [5 bytes data]\r\n> PASS xxxxx\r\n{ [5 bytes data]\r\n< 230 User xxxxx logged in.\r\n} [5 bytes data]\r\n> PBSZ 0\r\n{ [5 bytes data]\r\n< 200 Command okay. PBSZ=0.\r\n} [5 bytes data]\r\n> PROT P\r\n{ [5 bytes data]\r\n< 200 Data channel will be encrypted.\r\n} [5 bytes data]\r\n> PWD\r\n{ [5 bytes data]\r\n< 257 \"/\" is current directory.\r\n* Entry path is '/'\r\n} [5 bytes data]\r\n> CWD folder\r\n* ftp_perform ends with SECONDARY: 0\r\n{ [5 bytes data]\r\n< 250 CWD command ok. \"/folder\" is current directory.\r\n} [5 bytes data]\r\n> EPSV\r\n* Connect data stream passively\r\n{ [5 bytes data]\r\n< 229 Entering Extended Passive Mode (|||50051|)\r\n* Connecting to xxxxxport 50051\r\n*   Trying xxxxx:50051...\r\n* Connected to xxxxx port 990\r\n* SSL re-using session ID\r\n} [5 bytes data]\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n} [512 bytes data]\r\n> TYPE I\r\n{ [5 bytes data]\r\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\r\n{ [89 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Finished (20):\r\n{ [16 bytes data]\r\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\n} [1 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\r\n} [16 bytes data]\r\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\r\n* Server certificate:\r\n*  subject: CN=*.xxxxx\r\n*  start date: Jul 27 18:04:16 2020 GMT\r\n*  expire date: Jul 25 18:04:16 2030 GMT\r\n*  issuer: CN=*.xxxxx\r\n*  SSL certificate verify result: self-signed certificate (18), continuing anyway.\r\n{ [5 bytes data]\r\n< 200 Type is set.\r\n} [5 bytes data]\r\n> STOR test.txt\r\n{ [5 bytes data]\r\n< 150 Opening BINARY mode data connection for file transfer.\r\n} [5 bytes data]\r\n* We are completely uploaded and fine\r\n* Remembering we are in dir \"folder/\"\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS alert, close notify (256):\r\n} [2 bytes data]\r\n100    25    0     0    0    25      0      0 --:--:--  0:01:00 --:--:--     0* FTP response timeout\r\n* control connection looks dead\r\n100    25    0     0    0    25      0      0 --:--:--  0:01:00 --:--:--     0\r\n* Closing connection\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS alert, close notify (256):\r\n} [2 bytes data]\r\ncurl: (28) FTP response timeout\r\n```\r\n\r\n```\r\n# curl --version\r\ncurl 8.2.1 (x86_64-pc-linux-gnu) libcurl/8.2.1 OpenSSL/3.0.9 zlib/1.2.13 brotli/1.0.9 zstd/1.5.5 libidn2/2.3.3 libpsl/0.21.2 (+libidn2/2.3.3) libssh2/1.11.0 nghttp2/1.52.0 librtmp/2.3 OpenLDAP/2.5.13\r\nRelease-Date: 2023-07-26\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\r\n```\r\n\r\n\r\n\r\n\r\nInstalled the ubuntu packages onto Debian 12.1 and now it's working again on the Debian12.1 system and marked as hold to prevent updates for the time being:\r\n```\r\nwget http://archive.ubuntu.com/ubuntu/pool/main/c/curl/libcurl4_7.81.0-1ubuntu1.13_amd64.deb\r\nwget http://archive.ubuntu.com/ubuntu/pool/main/c/curl/curl_7.81.0-1ubuntu1.13_amd64.deb\r\nwget http://archive.ubuntu.com/ubuntu/pool/main/libs/libssh/libssh-4_0.9.6-2build1_amd64.deb\r\ndpkg -i libssh-4_0.9.6-2build1_amd64.deb \r\ndpkg -i libcurl4_7.81.0-1ubuntu1.13_amd64.deb\r\ndpkg -i curl_7.81.0-1ubuntu1.13_amd64.deb \r\napt-mark hold curl libcurl4 libssh-4\r\n```\r\n\r\n\r\n\r\n### I expected the following\r\n\r\nExpectation is the same behaviour as in curl v7.81.0\r\n\r\nlog of working:\r\n```\r\ncurl -v -T test.txt ftps://host/folder/ --user user:password --insecure\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying ********:990...\r\n* Connected to ******** port 990 (#0)\r\n* TLSv1.0 (OUT), TLS header, Certificate Status (22):\r\n} [5 bytes data]\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n} [512 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\r\n{ [89 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\r\n{ [1013 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\r\n{ [333 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\r\n{ [4 bytes data]\r\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\r\n} [70 bytes data]\r\n* TLSv1.2 (OUT), TLS header, Finished (20):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\n} [1 bytes data]\r\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\r\n} [16 bytes data]\r\n* TLSv1.2 (IN), TLS header, Finished (20):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Finished (20):\r\n{ [16 bytes data]\r\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\r\n* Server certificate:\r\n*  subject: CN=*.********\r\n*  start date: Jul 27 18:04:16 2020 GMT\r\n*  expire date: Jul 25 18:04:16 2030 GMT\r\n*  issuer: CN=*.********\r\n*  SSL certificate verify result: self-signed certificate (18), continuing anyway.\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 220 Wing FTP Server ready...\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> USER user\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 331 Password required for user\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> PASS ********\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 230 User user logged in.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> PBSZ 0\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 200 Command okay. PBSZ=0.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> PROT P\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 200 Data channel will be encrypted.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> PWD\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 257 \"/\" is current directory.\r\n* Entry path is '/'\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> CWD folder\r\n* ftp_perform ends with SECONDARY: 0\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 250 CWD command ok. \"/folder\" is current directory.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> EPSV\r\n* Connect data stream passively\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 229 Entering Extended Passive Mode (|||50052|)\r\n*   Trying ********:50052...\r\n* Connecting to ********port 50052\r\n* Connected to ********port 990 (#0)\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> TYPE I\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 200 Type is set.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n> STOR test.txt\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 150 Opening BINARY mode data connection for file transfer.\r\n* Doing the SSL/TLS handshake on the data stream\r\n* SSL re-using session ID\r\n* TLSv1.0 (OUT), TLS header, Certificate Status (22):\r\n} [5 bytes data]\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n} [512 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\r\n{ [89 bytes data]\r\n* TLSv1.2 (IN), TLS header, Finished (20):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS header, Certificate Status (22):\r\n{ [5 bytes data]\r\n* TLSv1.2 (IN), TLS handshake, Finished (20):\r\n{ [16 bytes data]\r\n* TLSv1.2 (OUT), TLS header, Finished (20):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\n} [1 bytes data]\r\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\r\n} [16 bytes data]\r\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\r\n* Server certificate:\r\n*  subject: CN=*.********\r\n*  start date: Jul 27 18:04:16 2020 GMT\r\n*  expire date: Jul 25 18:04:16 2030 GMT\r\n*  issuer: CN=*.********\r\n*  SSL certificate verify result: self-signed certificate (18), continuing anyway.\r\n* TLSv1.2 (OUT), TLS header, Supplemental data (23):\r\n} [5 bytes data]\r\n* We are completely uploaded and fine\r\n* Remembering we are in dir \"folder/\"\r\n* TLSv1.2 (OUT), TLS header, Unknown (21):\r\n} [5 bytes data]\r\n* TLSv1.2 (OUT), TLS alert, close notify (256):\r\n} [2 bytes data]\r\n* TLSv1.2 (IN), TLS header, Supplemental data (23):\r\n{ [5 bytes data]\r\n< 226 File received ok. Transferred:25Bytes;Average speed is:1.526KB/s\r\n100    25    0     0  100    25      0    155 --:--:-- --:--:-- --:--:--   156\r\n* Connection #0 to host host left intact\r\n```\r\n\r\n```\r\n# curl --version\r\ncurl 7.81.0 (x86_64-pc-linux-gnu) libcurl/7.81.0 OpenSSL/3.0.9 zlib/1.2.13 brotli/1.0.9 zstd/1.5.4 libidn2/2.3.3 libpsl/0.21.2 (+libidn2/2.3.3) libssh/0.9.6/openssl/zlib nghttp2/1.52.0 librtmp/2.3 OpenLDAP/2.5.13\r\nRelease-Date: 2022-01-05\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp \r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL TLS-SRP UnixSockets zstd\r\n\r\n```\r\n\r\n\r\n### curl/libcurl version\r\n\r\nnot working:\r\n```\r\n# curl --version\r\ncurl 8.2.1 (x86_64-pc-linux-gnu) libcurl/8.2.1 OpenSSL/3.0.9 zlib/1.2.13 brotli/1.0.9 zstd/1.5.5 libidn2/2.3.3 libpsl/0.21.2 (+libidn2/2.3.3) libssh2/1.11.0 nghttp2/1.52.0 librtmp/2.3 OpenLDAP/2.5.13\r\nRelease-Date: 2023-07-26\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\r\n```\r\n\r\nnot working:\r\n```\r\n# curl --version\r\ncurl 7.88.1 (x86_64-pc-linux-gnu) libcurl/7.88.1 OpenSSL/3.0.9 zlib/1.2.13 brotli/1.0.9 zstd/1.5.4 libidn2/2.3.3 libpsl/0.21.2 (+libidn2/2.3.3) libssh2/1.10.0 nghttp2/1.52.0 librtmp/2.3\r\nRelease-Date: 2023-02-20\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\r\n```\r\n\r\nworking:\r\n```\r\n# curl --version\r\ncurl 7.81.0 (x86_64-pc-linux-gnu) libcurl/7.81.0 OpenSSL/3.0.9 zlib/1.2.13 brotli/1.0.9 zstd/1.5.4 libidn2/2.3.3 libpsl/0.21.2 (+libidn2/2.3.3) libssh/0.9.6/openssl/zlib nghttp2/1.52.0 librtmp/2.3 OpenLDAP/2.5.13\r\nRelease-Date: 2022-01-05\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp \r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL TLS-SRP UnixSockets zstd\r\n```\r\n\r\n### operating system\r\n\r\nDebian 12.1\r\nLinux ******* 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64 GNU/Linux\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/11720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/11720/timeline","performed_via_github_app":null,"state_reason":"completed"}