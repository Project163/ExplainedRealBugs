{"url":"https://api.github.com/repos/curl/curl/issues/9930","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/9930/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/9930/comments","events_url":"https://api.github.com/repos/curl/curl/issues/9930/events","html_url":"https://github.com/curl/curl/issues/9930","id":1452639551,"node_id":"I_kwDOAAiu0c5WlYU_","number":9930,"title":"curl doesn't expire cookies with negative Max-Age","user":{"login":"godmar","id":486389,"node_id":"MDQ6VXNlcjQ4NjM4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/486389?v=4","gravatar_id":"","url":"https://api.github.com/users/godmar","html_url":"https://github.com/godmar","followers_url":"https://api.github.com/users/godmar/followers","following_url":"https://api.github.com/users/godmar/following{/other_user}","gists_url":"https://api.github.com/users/godmar/gists{/gist_id}","starred_url":"https://api.github.com/users/godmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/godmar/subscriptions","organizations_url":"https://api.github.com/users/godmar/orgs","repos_url":"https://api.github.com/users/godmar/repos","events_url":"https://api.github.com/users/godmar/events{/privacy}","received_events_url":"https://api.github.com/users/godmar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":4809646275,"node_id":"LA_kwDOAAiu0c8AAAABHq1gww","url":"https://api.github.com/repos/curl/curl/labels/cookies","name":"cookies","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2022-11-17T03:34:31Z","updated_at":"2022-11-17T12:47:48Z","closed_at":"2022-11-17T12:47:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I noticed that when curl receives a `Set-Cookie` header with `Max-Age=-1` (or any negative number) it will not immediately expire the cookie.  Rather, the cookie will stay in the cookie jar when curl exits.\r\n\r\nI believe that this is related to c3fdecad which works only for `Max-Age=0`, see Issue #3351.\r\n\r\nHowever, @badger quotes RFC6265 in [this comment](https://github.com/curl/curl/issues/3351#issuecomment-445470627) as stating that: \r\n\r\n> If delta-seconds is less than or equal to zero (0) ....\r\n\r\nIn my opinion, patch c3fdecad may work only if delta-seconds is equal to zero and not if it is less than.  I have verified this with a server: when I send `Max-Age: 0`, the cookie is immediately removed from the cookie jar, whereas if I set `Max-Age: -1` it is not removed until the next time I run `curl -c ...`\r\n\r\nMy output with `Max-Age: -1`\r\n```\r\n* Added cookie auth_token=\"\" for domain localhost, path /, expire 0\r\n< Set-Cookie: auth_token=; Path=/; Max-Age=-1; HttpOnly\r\n...\r\n```\r\nnext invocation:\r\n```\r\n> Cookie: auth_token=\r\n```\r\nand the cookie jar contains:\r\n```\r\n#HttpOnly_localhost\tFALSE\t/\tFALSE\t0\tauth_token\t\r\n```\r\n\r\nBy contrast, `Max-Age=0` yields:\r\n```\r\n* Added cookie auth_token=\"\" for domain localhost, path /, expire 1\r\n< Set-Cookie: auth_token=; Path=/; Max-Age=0; HttpOnly\r\n```\r\nand the cookie is gone from the cookie jar. \r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/9930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/9930/timeline","performed_via_github_app":null,"state_reason":"completed"}