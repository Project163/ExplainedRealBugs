{"url":"https://api.github.com/repos/curl/curl/issues/19301","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/19301/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/19301/comments","events_url":"https://api.github.com/repos/curl/curl/issues/19301/events","html_url":"https://github.com/curl/curl/issues/19301","id":3575460214,"node_id":"I_kwDOAAiu0c7VHTF2","number":19301,"title":"HTTPS-RR not using custom port in query","user":{"login":"Gunni","id":358099,"node_id":"MDQ6VXNlcjM1ODA5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/358099?v=4","gravatar_id":"","url":"https://api.github.com/users/Gunni","html_url":"https://github.com/Gunni","followers_url":"https://api.github.com/users/Gunni/followers","following_url":"https://api.github.com/users/Gunni/following{/other_user}","gists_url":"https://api.github.com/users/Gunni/gists{/gist_id}","starred_url":"https://api.github.com/users/Gunni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gunni/subscriptions","organizations_url":"https://api.github.com/users/Gunni/orgs","repos_url":"https://api.github.com/users/Gunni/repos","events_url":"https://api.github.com/users/Gunni/events{/privacy}","received_events_url":"https://api.github.com/users/Gunni/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":8110723874,"node_id":"LA_kwDOAAiu0c8AAAAB42_TIg","url":"https://api.github.com/repos/curl/curl/labels/HTTPS-RR","name":"HTTPS-RR","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-10-31T15:42:54Z","updated_at":"2025-11-01T22:13:44Z","closed_at":"2025-11-01T22:13:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nWhen connecting to `https://example.com:4444` and using HTTPS-RR, the client should request the `HTTPS` type DNS record at `_4444._https.example.com`, not `example.com`.\n\nhttps://datatracker.ietf.org/doc/html/rfc9460#appendix-B\n\nusing `resolvectl monitor` i see the query:\n\n```\n← A: example.com IN HTTPS 1 . alpn=\"h3,h2\" no-default-alpn ipv4hint=<redacted> ech=\"<redacted>\" ipv6hint=<redacted>\n```\n\nfor `curl https://example.com:4444` with httpsrr amongst others (see below) compiled in:\n\n<details>\n  <description>build scripts for my curl</description>\n\nNote, relevant environment variables:\n\n| key | value |\n| --- | ----- |\n| `CFLAGS` | `'-O3 -march=native -flto'` |\n| `PKG_CONFIG_PATH` | `~/.local/share/nghttp3/lib/pkgconfig:~/.local/share/openssl/lib64/pkgconfig:$PKG_CONFIG_PATH` |\n| `LD_LIBRARY_PATH` | `~/.local/share/nghttp3/lib:~/.local/share/openssl/lib64:$LD_LIBRARY_PATH` |\n| `NGHTTP3_LIBS` | `\"-L/home/<redacted>/.local/share/nghttp3\"` |\n| `OPENSSL_LIBS` | `\"-L/home/<redacted>/.local/share/openssl\"` |\n| `PATH` | `~/.local/share/openssl/bin:~/.local/share/curl/bin:$PATH` |\n\n<table>\n<tr>\n<th>`curl`</th>\n<td>\n\n```bash\n#!/bin/bash\n\nIFS=$'\\n\\t'\nset -euo pipefail\n\nunset -v LD_PRELOAD\nLD_PRELOAD=/usr/lib64/libeatmydata.so\n\nset -x\n\nmake uninstall && \\\nmake clean && \\\nLDFLAGS=\"-Wl,-rpath,$HOME/.local/share/curl/lib\" \\\n./configure \\\n        --prefix=$HOME/.local/share/curl \\\n        --with-openssl \\\n        --with-openssl-quic \\\n        --disable-docs \\\n        --enable-httpsrr \\\n        --enable-ares \\\n        --enable-threaded-resolver \\\n        --with-zlib \\\n        --with-zstd \\\n        --with-libidn2 \\\n        --enable-ech \\\n        --enable-debug \\\n        && \\\nread && \\\nmake -j $(nproc) && \\\nrm -rf $HOME/.local/share/curl && \\\nmake install\n```\n\n</td>\n</tr>\n\n<tr>\n<th>`nghttp3`</th>\n<td>\n\n```bash\n#!/bin/bash\n\nIFS=$'\\n\\t'\nset -euo pipefail\n\nLD_PRELOAD=/usr/lib64/libeatmydata.so\n\nset -x\n\nmake uninstall && \\\nmake clean && \\\n./configure --prefix=$HOME/.local/share/nghttp3 --enable-lib-only && \\\nread && \\\nmake && \\\nmake install\n```\n\n</td>\n</tr>\n\n<tr>\n<th>\n`openssl`\n(branch feature/ech)\n</th>\n<td>\n\n```bash\n#!/bin/bash\n\nIFS=$'\\n\\t'\nset -euo pipefail\n\nLD_PRELOAD=/usr/lib64/libeatmydata.so\n\nset -x\n\nmake uninstall && \\\nmake clean && \\\n./config \\\n        --prefix=$HOME/.local/share/openssl \\\n        enable-quic \\\n        enable-ech \\\n        no-docs \\\n        no-tests \\\n        && \\\nperl configdata.pm --dump && \\\nread && \\\nmake -j $(nproc) && \\\nmake install\n```\n\n<tr>\n<th>`other`</th>\n<td>Other libraries are installed via dnf on my Fedora 43 system.\n</td>\n</tr>\n\n</table>\n\n</details>\n\n### I expected the following\n\nA DNS query for `_4444._https.example.com`\n\n```\n← A: _4444._https.example.com IN HTTPS 1 . alpn=\"h3\" no-default-alpn ipv4hint=<redacted> ech=\"<redacted>\" ipv6hint=<redacted>\n```\n\n### curl/libcurl version\n\n> WARNING: this libcurl is Debug-enabled, do not use in production\n> \n> curl 8.17.0-DEV (x86_64-pc-linux-gnu) libcurl/8.17.0-DEV OpenSSL/3.6.0 zlib/1.3.1.zlib-ng zstd/1.5.7 c-ares/1.34.5 libidn2/2.3.8 libpsl/0.21.5 nghttp2/1.66.0 nghttp3/1.13.0-DEV OpenLDAP/2.6.10\n> Release-Date: [unreleased]\n> Protocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp ws wss\n> Features: alt-svc asyn-rr AsynchDNS Debug ECH HSTS HTTP2 HTTP3 HTTPS-proxy HTTPSRR IDN IPv6 Largefile libz NTLM PSL SSL threadsafe TLS-SRP TrackMemory UnixSockets zstd\n\n### operating system\n\n> Linux <redacted> 6.6.87.2-microsoft-standard-WSL2 #1 SMP PREEMPT_DYNAMIC Thu Jun  5 18:30:46 UTC 2025 x86_64 GNU/Linux\n> \n> * Fedora Linux 43 (Container Image)","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/19301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/19301/timeline","performed_via_github_app":null,"state_reason":"completed"}