{"url":"https://api.github.com/repos/curl/curl/issues/13803","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13803/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13803/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13803/events","html_url":"https://github.com/curl/curl/issues/13803","id":2319866352,"node_id":"I_kwDOAAiu0c6KRlnw","number":13803,"title":"manpage paragraph incorrect indentation","user":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":200869765,"node_id":"MDU6TGFiZWwyMDA4Njk3NjU=","url":"https://api.github.com/repos/curl/curl/labels/documentation","name":"documentation","color":"f7c6c7","default":true,"description":null},{"id":3405978577,"node_id":"LA_kwDOAAiu0c7LAxvR","url":"https://api.github.com/repos/curl/curl/labels/script","name":"script","color":"379DD5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-05-27T22:58:32Z","updated_at":"2024-05-29T18:09:27Z","closed_at":"2024-05-29T10:50:28Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The manpages display correctly in [curldown](https://github.com/curl/curl/blob/curl-8_8_0/docs/CURLDOWN.md) format but paragraphs may have incorrect indentation when converted to [nroff format](https://manpages.ubuntu.com/manpages/jammy/en/man7/groff_man.7.html#description) (via [cd2nroff](https://github.com/curl/curl/blob/curl-8_8_0/scripts/cd2nroff)) and then further to html (via [roffit](https://github.com/bagder/roffit)). The incorrect indentation is visible in a few places in the libcurl option website documentation.\r\n\r\nThe problem seems to be `## header` in curldown format starts indented paragraph format (`.IP`) for nroff but there's no way to stop the indentation for future paragraphs in the same section. [CURLOPT_SSLVERSION](https://curl.se/libcurl/c/CURLOPT_SSLVERSION.html) for example:\r\n\r\nhttps://github.com/curl/curl/blob/fd567d4f06857f4fc8e2f64ea727b1318f76ad33/docs/libcurl/opts/CURLOPT_SSLVERSION.md?plain=1#L66-L82\r\n\r\nIn this example `## CURL_SSLVERSION_TLSv1_3` will be converted by [cd2nroff](https://github.com/curl/curl/blob/curl-8_8_0/scripts/cd2nroff) as `.IP CURL_SSLVERSION_TLSv1_3` and then subsequent paragraphs are all indented so says nroff format. However that is not desired because the second paragraph that starts \"The maximum TLS version...\" is not supposed to be indented. In the pictures below I used a red arrow to indicate where the paragraph should be.\r\n\r\n`scripts/cd2nroff < docs/libcurl/opts/CURLOPT_SSLVERSION.md | nroff -Tascii -man | grep \"\"`\r\n\r\n![nroff2](https://github.com/curl/curl/assets/965580/b066c710-da0e-47f5-9088-2f2190351ace)\r\n\r\n[website version](https://curl.se/libcurl/c/CURLOPT_SSLVERSION.html#CURLSSLVERSIONTLSv13) after roffit conversion of nroff generated by cd2nroff:\r\n\r\n![website2](https://github.com/curl/curl/assets/965580/6189ac48-668f-4dd9-8a2c-4b2928f107a5)\r\n\r\nOlder versions of curl used the nroff manpage format and so they had .RS/.RE for relative start/end of indentation, and roffit knew to end the indentation. For example this from 8.5.0:\r\n\r\nhttps://github.com/curl/curl/blob/7161cb17c01dcff1dc5bf89a18437d9d729f1ecd/docs/libcurl/opts/CURLOPT_SSLVERSION.3#L57-L70\r\n\r\n---\r\n\r\nI tried for some time to fix this but nothing worked well enough that I want to build on it. The simplest fix I tried was resetting subsequent paragraph style via `.PP` rather than processing .RS .RE. Though that works for nroff to reset the indentation it does not work for roffit. Also- I'm not sure if this does what I intend in nroff anyway albeit it seems to work visually, at the cost of ending all indented paragraphs after a single paragraph.\r\n\r\n~~~diff\r\n--- a/scripts/cd2nroff\r\n+++ b/scripts/cd2nroff\r\n@@ -459,7 +459,7 @@ sub single {\r\n         else {\r\n             # don't output newlines if this is the first content after a\r\n             # header\r\n-            push @desc, \"\\n\" if($blankline && !$header);\r\n+            push @desc, \".PP\\n\" if($blankline && !$header);\r\n             $blankline = 0;\r\n             $header = 0;\r\n ~~~\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13803/timeline","performed_via_github_app":null,"state_reason":"completed"}