{"url":"https://api.github.com/repos/curl/curl/issues/9209","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/9209/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/9209/comments","events_url":"https://api.github.com/repos/curl/curl/issues/9209/events","html_url":"https://github.com/curl/curl/issues/9209","id":1318126576,"node_id":"I_kwDOAAiu0c5OkQPw","number":9209,"title":"HTTP/3: Busy loop due to IP_RECVERR","user":{"login":"tatsuhiro-t","id":404610,"node_id":"MDQ6VXNlcjQwNDYxMA==","avatar_url":"https://avatars.githubusercontent.com/u/404610?v=4","gravatar_id":"","url":"https://api.github.com/users/tatsuhiro-t","html_url":"https://github.com/tatsuhiro-t","followers_url":"https://api.github.com/users/tatsuhiro-t/followers","following_url":"https://api.github.com/users/tatsuhiro-t/following{/other_user}","gists_url":"https://api.github.com/users/tatsuhiro-t/gists{/gist_id}","starred_url":"https://api.github.com/users/tatsuhiro-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tatsuhiro-t/subscriptions","organizations_url":"https://api.github.com/users/tatsuhiro-t/orgs","repos_url":"https://api.github.com/users/tatsuhiro-t/repos","events_url":"https://api.github.com/users/tatsuhiro-t/events{/privacy}","received_events_url":"https://api.github.com/users/tatsuhiro-t/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141438010,"node_id":"MDU6TGFiZWwxMTQxNDM4MDEw","url":"https://api.github.com/repos/curl/curl/labels/HTTP/3","name":"HTTP/3","color":"97fceb","default":false,"description":"h3 or quic related"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-07-26T11:50:12Z","updated_at":"2022-07-27T22:35:05Z","closed_at":"2022-07-27T22:35:05Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Only file bugs here! Ask questions on the mailing lists https://curl.se/mail/\r\n\r\n     SECURITY RELATED? Post it here: https://hackerone.com/curl\r\n\r\n     There are collections of known issues to be aware of:\r\n     https://curl.se/docs/knownbugs.html\r\n     https://curl.se/docs/todo.html       -->\r\n\r\n### I did this\r\n\r\nUpload a large file with HTTP/3.\r\nLots of POLLIN event occurs but recvfrom read nothing.\r\n\r\nIt is caused by IP_RECVERR socket option [1] set for UDP socket.  ngtcp2 does UDP Path MTU Discovery and it might send larger packet than the path can sustain.  In this case ICMP message is received, it is resulted in POLLERR, which is translated into POLLIN by curl code.  Because IP_RECVERR, the normal recvfrom call does not clear error queue, thus poll keeps returning POLLERR.\r\nIt is only cleared by recvmsg with MSG_ERRQUEUE.  But it looks like there is no code in curl to do this.\r\n\r\n[1] https://github.com/curl/curl/blob/e28edb6678cd02aea7fc73340c223f26dba8f5b7/lib/connect.c#L1670-L1682\r\n\r\n### I expected the following\r\n\r\n\r\n### curl/libcurl version\r\n\r\ncurl master branch with ngtcp2 QUIC backend\r\n[curl -V output]\r\n\r\n### operating system\r\n\r\nLinux\r\n<!-- On Unix please post the output of \"uname -a\" -->\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/9209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/9209/timeline","performed_via_github_app":null,"state_reason":"completed"}