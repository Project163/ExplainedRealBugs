{"url":"https://api.github.com/repos/curl/curl/issues/15522","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15522/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15522/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15522/events","html_url":"https://github.com/curl/curl/issues/15522","id":2644063890,"node_id":"I_kwDOAAiu0c6dmTaS","number":15522,"title":"Incompability with libssh 0.10.6","user":{"login":"henrikjehgmti","id":34092030,"node_id":"MDQ6VXNlcjM0MDkyMDMw","avatar_url":"https://avatars.githubusercontent.com/u/34092030?v=4","gravatar_id":"","url":"https://api.github.com/users/henrikjehgmti","html_url":"https://github.com/henrikjehgmti","followers_url":"https://api.github.com/users/henrikjehgmti/followers","following_url":"https://api.github.com/users/henrikjehgmti/following{/other_user}","gists_url":"https://api.github.com/users/henrikjehgmti/gists{/gist_id}","starred_url":"https://api.github.com/users/henrikjehgmti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henrikjehgmti/subscriptions","organizations_url":"https://api.github.com/users/henrikjehgmti/orgs","repos_url":"https://api.github.com/users/henrikjehgmti/repos","events_url":"https://api.github.com/users/henrikjehgmti/events{/privacy}","received_events_url":"https://api.github.com/users/henrikjehgmti/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":269086135,"node_id":"MDU6TGFiZWwyNjkwODYxMzU=","url":"https://api.github.com/repos/curl/curl/labels/SCP/SFTP","name":"SCP/SFTP","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-11-08T13:30:50Z","updated_at":"2024-11-11T06:57:06Z","closed_at":"2024-11-09T09:34:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nI have:\r\n# curl --version\r\ncurl 8.10.1 (arm-unknown-none) libcurl/8.10.1 OpenSSL/3.0.15 zlib/1.2.11 libssh/0.10.6/openssl/zlib\r\nRelease-Date: 2024-09-18\r\n\r\nI want to do a sftp download from an IPv6 server, but get the following output:\r\ncurl -u test:password -k sftp://[fd4d:5449:7400:111:626d:3cff:fedf:4d39]/file -o file\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r\ncurl: (2) Could not set remote host\r\n\r\nI analyzed the LibSsh code, and found that LibSsh was not happy about the host name due to missing brackets around the IPv6 address.\r\n\r\nI did a workaround in curl/src/lib/vssh/libssh.c to reinsert the brackets. \r\n[curl_ip6_libssh0_10_6.patch](https://github.com/user-attachments/files/17679182/curl_ip6_libssh0_10_6.patch)\r\n\r\n~~~diff\r\nIndex: ../sw_apps_linux/curl/src/lib/vssh/libssh.c\r\n===================================================================\r\n--- ../sw_apps_linux/curl/src/lib/vssh/libssh.c (revision 5373)\r\n+++ ../sw_apps_linux/curl/src/lib/vssh/libssh.c (working copy)\r\n@@ -2186,7 +2186,22 @@\r\n     return CURLE_FAILED_INIT;\r\n   }\r\n\r\n+  struct in6_addr ip6result;\r\n+\r\n+  if (inet_pton(AF_INET6, conn->host.name, &ip6result) == 1) // success!\r\n+  {\r\n+      char newIp6[64];\r\n+      sprintf(newIp6, \"[%s]\", conn->host.name);\r\n+      rc = ssh_options_set(ssh->ssh_session, SSH_OPTIONS_HOST, newIp6);\r\n+  }\r\n+  else\r\n+  {\r\n+      rc = ssh_options_set(ssh->ssh_session, SSH_OPTIONS_HOST, conn->host.name);\r\n+  }\r\n~~~\r\n\r\nI ended up doing it here as I fear that host.name is used for e.g. TLS name verification, but I could not see if that was the case. \r\n\r\nDo you already have a better solution for this, or can you use it (it should be under LIBSSH version flags perhaps)? I was not able to find any existing bugs that mentions this configuration, so I hope that this is not a duplicate.\r\n\r\n### I expected the following\r\n\r\n_No response_\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.10.1 (arm-unknown-none) libcurl/8.10.1 OpenSSL/3.0.15 zlib/1.2.11 libssh/0.10.6/openssl/zlib\r\n\r\n### operating system\r\n\r\nLinux mti-ru 5.15.0 #79 SMP PREEMPT Fri Jul 5 14:00:08 CEST 2024 aarch64 GNU/Linux","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15522/timeline","performed_via_github_app":null,"state_reason":"completed"}