{"url":"https://api.github.com/repos/curl/curl/issues/13612","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/13612/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/13612/comments","events_url":"https://api.github.com/repos/curl/curl/issues/13612/events","html_url":"https://github.com/curl/curl/issues/13612","id":2292252325,"node_id":"I_kwDOAAiu0c6IoP6l","number":13612,"title":"Windows DNS resolution fails when impersonation is used","user":{"login":"timmaraju","id":14213363,"node_id":"MDQ6VXNlcjE0MjEzMzYz","avatar_url":"https://avatars.githubusercontent.com/u/14213363?v=4","gravatar_id":"","url":"https://api.github.com/users/timmaraju","html_url":"https://github.com/timmaraju","followers_url":"https://api.github.com/users/timmaraju/followers","following_url":"https://api.github.com/users/timmaraju/following{/other_user}","gists_url":"https://api.github.com/users/timmaraju/gists{/gist_id}","starred_url":"https://api.github.com/users/timmaraju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmaraju/subscriptions","organizations_url":"https://api.github.com/users/timmaraju/orgs","repos_url":"https://api.github.com/users/timmaraju/repos","events_url":"https://api.github.com/users/timmaraju/events{/privacy}","received_events_url":"https://api.github.com/users/timmaraju/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"},{"id":975635480,"node_id":"MDU6TGFiZWw5NzU2MzU0ODA=","url":"https://api.github.com/repos/curl/curl/labels/name%20lookup","name":"name lookup","color":"0052cc","default":false,"description":"DNS and related tech"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2024-05-13T09:10:14Z","updated_at":"2024-05-23T21:58:28Z","closed_at":"2024-05-23T21:58:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nOur windows service calls `ImpersonateLoggedOnUser` before any curl calls so that the proxy calls can be authenticated using the logged on user's token and not from the system. \r\n\r\nDNS resolution fails when this is called because of the change in commit a6bbc87f9e9ffb46a1801dfb983e7534825ed56b to use `GetAddrInfoExW`. `GetAddrInfoExW()` keeps returning `WSATRY_AGAIN` and never succeeds even after many retries.\r\n\r\n### I expected the following\r\n\r\nDNS resolution works even with impersonation. \r\n\r\n### curl/libcurl version\r\n\r\nlibcurl 8.7.1\r\n\r\n### operating system\r\n\r\nWindows","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/13612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/13612/timeline","performed_via_github_app":null,"state_reason":"completed"}