{"url":"https://api.github.com/repos/curl/curl/issues/12578","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/12578/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/12578/comments","events_url":"https://api.github.com/repos/curl/curl/issues/12578/events","html_url":"https://github.com/curl/curl/issues/12578","id":2052686619,"node_id":"I_kwDOAAiu0c56WYMb","number":12578,"title":"windows curl crash with libuv & multi","user":{"login":"calvin2021y","id":85545400,"node_id":"MDQ6VXNlcjg1NTQ1NDAw","avatar_url":"https://avatars.githubusercontent.com/u/85545400?v=4","gravatar_id":"","url":"https://api.github.com/users/calvin2021y","html_url":"https://github.com/calvin2021y","followers_url":"https://api.github.com/users/calvin2021y/followers","following_url":"https://api.github.com/users/calvin2021y/following{/other_user}","gists_url":"https://api.github.com/users/calvin2021y/gists{/gist_id}","starred_url":"https://api.github.com/users/calvin2021y/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calvin2021y/subscriptions","organizations_url":"https://api.github.com/users/calvin2021y/orgs","repos_url":"https://api.github.com/users/calvin2021y/repos","events_url":"https://api.github.com/users/calvin2021y/events{/privacy}","received_events_url":"https://api.github.com/users/calvin2021y/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118205,"node_id":"MDU6TGFiZWwxODQxMTgyMDU=","url":"https://api.github.com/repos/curl/curl/labels/crash","name":"crash","color":"bfe5bf","default":false,"description":null},{"id":194601710,"node_id":"MDU6TGFiZWwxOTQ2MDE3MTA=","url":"https://api.github.com/repos/curl/curl/labels/HTTP/2","name":"HTTP/2","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-12-21T15:59:39Z","updated_at":"2023-12-21T22:17:38Z","closed_at":"2023-12-21T22:17:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\ntest 8.50, `5d2b0faec219db1cea07ef0ca6c804c4f172f93d`.   test with patch 12562, 12563. get same error.\r\n\r\nlibcurl multi with http2, tls and libuv.\r\n\r\n\r\n\r\n### I expected the following\r\n\r\nexpect it work.  (used to work, recent upgrade get a lot problem)\r\n\r\n### curl/libcurl version\r\n\r\n8.50, and master branch.  and try a few patchs.\r\n\r\n### operating system\r\n\r\nwindows.\r\n\r\n```sh\r\n* thread #1, stop reason = Exception 0x80000003 encountered at address 0x7ffae3905871\r\n  * frame #0: 0x00007ffae3905872 libclang_rt.asan_dynamic-x86_64.dll`__sanitizer::internal__exit(int) at sanitizer_win.cpp:847:20\r\n    frame #1: 0x00007ffae3906b37 libclang_rt.asan_dynamic-x86_64.dll`__sanitizer::Die() at sanitizer_termination.cpp:59:3\r\n    frame #2: 0x00007ffae393bdad libclang_rt.asan_dynamic-x86_64.dll`::~ScopedInErrorReport() at asan_report.cpp:192:7\r\n    frame #3: 0x00007ffae393ad84 libclang_rt.asan_dynamic-x86_64.dll`::ReportGenericError() at asan_report.cpp:497:1\r\n    frame #4: 0x00007ffae3932b6e libclang_rt.asan_dynamic-x86_64.dll`::__asan_memcpy() at asan_interceptors_memintrinsics.cpp:63:3\r\n    frame #5: 0x00007ff78b518f69 test.exe`Curl_strerror\r\n    frame #6: 0x00007ff78bbacdcb test.exe`cf_socket_send\r\n    frame #7: 0x00007ff78bbf2093 test.exe`ossl_bio_cf_out_write\r\n    frame #8: 0x00007ff78bc37396 test.exe`bwrite_conv\r\n    frame #9: 0x00007ff78b778d62 test.exe`bio_write_intern\r\n    frame #10: 0x00007ff78b778ac3 test.exe`BIO_write\r\n    frame #11: 0x00007ff78bc4dd6a test.exe`ssl3_write_pending\r\n    frame #12: 0x00007ff78bc506b9 test.exe`do_ssl3_write\r\n    frame #13: 0x00007ff78be92745 test.exe`ssl3_dispatch_alert\r\n    frame #14: 0x00007ff78bd5c948 test.exe`ssl3_shutdown\r\n    frame #15: 0x00007ff78b7634e0 test.exe`SSL_shutdown\r\n    frame #16: 0x00007ff78bbeaff9 test.exe`ossl_close\r\n    frame #17: 0x00007ff78b6f264b test.exe`ssl_cf_close\r\n    frame #18: 0x00007ff78b6d93e2 test.exe`cf_setup_close\r\n    frame #19: 0x00007ff78bbdecec test.exe`cf_hc_close\r\n    frame #20: 0x00007ff78b6bcfe2 test.exe`Curl_disconnect\r\n    frame #21: 0x00007ff78b6c621b test.exe`prune_dead_connections\r\n    frame #22: 0x00007ff78b6c1f51 test.exe`Curl_connect\r\n    frame #23: 0x00007ff78b504d0b test.exe`multi_runsingle\r\n    frame #24: 0x00007ff78b50cf22 test.exe`multi_socket\r\n    frame #25: 0x00007ff78b50d49d test.exe`curl_multi_socket_action\r\n    frame #26: 0x00007ff78b34735d test.exe`curl_perform\r\n    frame #27: 0x00007ff78b4a48b4 test.exe`uv__run_timers\r\n```\r\n\r\n\r\n```sh\r\n AddressSanitizer: global-buffer-overflow on address 0x7ff78c28ac37 at pc 0x7ffae3932b44 bp 0x00e78f4f98b0 sp 0x00e78f4f98f8\r\n\r\n0x7ff78c28ac37 is located 41 bytes before global variable '.str.161' defined in 'curl/lib/strerror.c' (0x7ff78c28ac60) of size 21\r\n  '.str.161' is ascii string 'Connection was reset'\r\n0x7ff78c28ac37 is located 0 bytes after global variable '.str.160' defined in 'curl/lib/strerror.c' (0x7ff78c28ac20) of size 23\r\n  '.str.160' is ascii string 'Connection was aborted'\r\n```\r\n\r\n\r\nwhen test with http2 (without ssl),  I get no problem.  build with openssl 1.1.1w.\r\n\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/12578/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/12578/timeline","performed_via_github_app":null,"state_reason":"completed"}