{"url":"https://api.github.com/repos/curl/curl/issues/9799","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/9799/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/9799/comments","events_url":"https://api.github.com/repos/curl/curl/issues/9799/events","html_url":"https://github.com/curl/curl/issues/9799","id":1423001501,"node_id":"I_kwDOAAiu0c5U0Ued","number":9799,"title":"Documentation about CURL_POLL_REMOVE is a bit misleading","user":{"login":"lultimouomo","id":109914,"node_id":"MDQ6VXNlcjEwOTkxNA==","avatar_url":"https://avatars.githubusercontent.com/u/109914?v=4","gravatar_id":"","url":"https://api.github.com/users/lultimouomo","html_url":"https://github.com/lultimouomo","followers_url":"https://api.github.com/users/lultimouomo/followers","following_url":"https://api.github.com/users/lultimouomo/following{/other_user}","gists_url":"https://api.github.com/users/lultimouomo/gists{/gist_id}","starred_url":"https://api.github.com/users/lultimouomo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lultimouomo/subscriptions","organizations_url":"https://api.github.com/users/lultimouomo/orgs","repos_url":"https://api.github.com/users/lultimouomo/repos","events_url":"https://api.github.com/users/lultimouomo/events{/privacy}","received_events_url":"https://api.github.com/users/lultimouomo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":200869765,"node_id":"MDU6TGFiZWwyMDA4Njk3NjU=","url":"https://api.github.com/repos/curl/curl/labels/documentation","name":"documentation","color":"f7c6c7","default":true,"description":null},{"id":1117926199,"node_id":"MDU6TGFiZWwxMTE3OTI2MTk5","url":"https://api.github.com/repos/curl/curl/labels/libcurl%20API","name":"libcurl API","color":"fef2c0","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-10-25T20:02:25Z","updated_at":"2022-10-26T09:24:22Z","closed_at":"2022-10-26T09:24:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am using a hiper-style integration of curl with asio. To do this, I set a socket callback using CURLMOPT_SOCKETFUNCTION and a pair of socket open/close callbacks using CURLOPT_OPENSOCKETFUNCTION and CURLOPT_CLOSESOCKETFUNCTION.\r\n\r\nI noticed that when sending several requests to an HTTP/1.1 server only a couple of sockets are opened with my OPENSOCKETFUNCTION, which are then used for multiple requests. For each socket I receive several times a socket callback with the `what` parameter set to `CURL_POLL_REMOVE`. I believe what is happening is that after each request is completed cURL invokes the socket callback with `CURL_POLL_REMOVE`, then puts the socket in an idle connection pool, then reuses it for the next request to the same server. This makes sense, but is not what I was expecting from the documentation of CURLMOPT_SOCKETFUNCTION, which says:\r\n\r\n> CURL_POLL_REMOVE The specified socket/file descriptor is no longer used by libcurl. \r\n\r\nNow, the documentation does not say that it won't ever be used again, but it kind of gives that impression. Maybe the documentation could be clarified a bit by saying that cURL might not close that socket and try to use it again later on? Unfortunately there isn't any code example using both CURLMOPT_SOCKETFUNCTION and CURLOPT_OPENSOCKETFUNCTION, and there is not much documentation about their interaction. I was under the impression that a socket would always be closed after CURL_POLL_REMOVE, while clearly this is not the case.\r\n\r\n","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/9799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/9799/timeline","performed_via_github_app":null,"state_reason":"completed"}