{"url":"https://api.github.com/repos/curl/curl/issues/17262","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/17262/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/17262/comments","events_url":"https://api.github.com/repos/curl/curl/issues/17262/events","html_url":"https://github.com/curl/curl/issues/17262","id":3043367817,"node_id":"I_kwDOAAiu0c61ZhuJ","number":17262,"title":"SIGSEGV on exit on cygwin","user":{"login":"Berrysoft","id":37586447,"node_id":"MDQ6VXNlcjM3NTg2NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/37586447?v=4","gravatar_id":"","url":"https://api.github.com/users/Berrysoft","html_url":"https://github.com/Berrysoft","followers_url":"https://api.github.com/users/Berrysoft/followers","following_url":"https://api.github.com/users/Berrysoft/following{/other_user}","gists_url":"https://api.github.com/users/Berrysoft/gists{/gist_id}","starred_url":"https://api.github.com/users/Berrysoft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Berrysoft/subscriptions","organizations_url":"https://api.github.com/users/Berrysoft/orgs","repos_url":"https://api.github.com/users/Berrysoft/repos","events_url":"https://api.github.com/users/Berrysoft/events{/privacy}","received_events_url":"https://api.github.com/users/Berrysoft/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118205,"node_id":"MDU6TGFiZWwxODQxMTgyMDU=","url":"https://api.github.com/repos/curl/curl/labels/crash","name":"crash","color":"bfe5bf","default":false,"description":null},{"id":184118221,"node_id":"MDU6TGFiZWwxODQxMTgyMjE=","url":"https://api.github.com/repos/curl/curl/labels/TLS","name":"TLS","color":"bfdadc","default":false,"description":""},{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2025-05-06T16:20:36Z","updated_at":"2025-06-03T18:35:11Z","closed_at":"2025-06-03T18:35:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nIt's hard to get a MWE. I'll discribe what I've done:\n* I'm the maintainer of cygwin target of rust, and recently I've managed to compile `cargo` targeting MSYS2 (a variant of cygwin), linking libcurl 8.13.0 and openssl 3.5.0 (dynamically).\n* `cargo` fail silently with SIGSEGV on an anoymous thread exits. Backtrace:\n```\n#0  0x0000000000000000 in ?? ()\n#1  0x00000001800b2827 in pthread_testcancel () at /d/S/B/src/msys2-runtime/winsup/cygwin/thread.cc:399\n#2  pthread_rwlock_wrlock (rwlock=0xa000b73b0) at /d/S/B/src/msys2-runtime/winsup/cygwin/thread.cc:4352\n#3  0x000000018019ce44 in _sigfe () at sigfe.s:35\n#4  0x0000000435849299 in CRYPTO_THREAD_write_lock () from /usr/bin/msys-crypto-3.dll\n#5  0x0000000435835702 in init_thread_remove_handlers () from /usr/bin/msys-crypto-3.dll\n#6  0x0000000435835b43 in OPENSSL_thread_stop () from /usr/bin/msys-crypto-3.dll\n#7  0x00000005d24bbfdd in DllMain (hinstDLL=<optimized out>, fdwReason=<optimized out>, lpvReserved=<optimized out>) at dllmain.c:74\n#8  0x00007ff869351e53 in ntdll!RtlDeactivateActivationContext () from /c/WINDOWS/SYSTEM32/ntdll.dll\n#9  0x00007ff8692f2294 in ntdll!LdrShutdownThread () from /c/WINDOWS/SYSTEM32/ntdll.dll\n#10 0x00007ff8692f1da6 in ntdll!RtlExitUserThread () from /c/WINDOWS/SYSTEM32/ntdll.dll\n#11 0x00000001800c4eb0 in exit_thread (res=res@entry=0) at /d/S/B/src/msys2-runtime/winsup/cygwin/sigproc.cc:587\n#12 0x00000001800ab540 in pthread::exit (this=0xa001e6b60, value_ptr=0x0) at /d/S/B/src/msys2-runtime/winsup/cygwin/thread.cc:584\n#13 0x00000001800ab333 in pthread::thread_init_wrapper (arg=0xa001e6b60) at /d/S/B/src/msys2-runtime/winsup/cygwin/thread.cc:2016\n#14 0x0000000180044841 in pthread_wrapper (arg=<optimized out>) at /d/S/B/src/msys2-runtime/winsup/cygwin/create_posix_thread.cc:79\n#15 pthread_wrapper (arg=<optimized out>) at /d/S/B/src/msys2-runtime/winsup/cygwin/create_posix_thread.cc:39\n```\n* It turns out that a thread exits and libcurl is detached. It calls OPENSSL_thread_stop and crashes.\n* So I looked into the source code and the comment says that it is for statically linked openssl, so I removed this call and compiled again. Now `cargo` works fine.\n\n### I expected the following\n\nWell, as it's very hard to construct a MWE, I'm asking experts for help. Could someone explain that whether it is necessary to call `OPENSSL_thread_stop` if openssl is dynamically linked?\n\nOr, could someone help me to get the clue that, why libcurl is detached when `cargo` is running?\n\n### curl/libcurl version\n\ncurl 8.13.0\n\n### operating system\n\nMSYS2","closed_by":{"login":"jay","id":965580,"node_id":"MDQ6VXNlcjk2NTU4MA==","avatar_url":"https://avatars.githubusercontent.com/u/965580?v=4","gravatar_id":"","url":"https://api.github.com/users/jay","html_url":"https://github.com/jay","followers_url":"https://api.github.com/users/jay/followers","following_url":"https://api.github.com/users/jay/following{/other_user}","gists_url":"https://api.github.com/users/jay/gists{/gist_id}","starred_url":"https://api.github.com/users/jay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay/subscriptions","organizations_url":"https://api.github.com/users/jay/orgs","repos_url":"https://api.github.com/users/jay/repos","events_url":"https://api.github.com/users/jay/events{/privacy}","received_events_url":"https://api.github.com/users/jay/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/17262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/17262/timeline","performed_via_github_app":null,"state_reason":"completed"}