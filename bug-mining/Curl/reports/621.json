{"url":"https://api.github.com/repos/curl/curl/issues/15842","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15842/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15842/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15842/events","html_url":"https://github.com/curl/curl/issues/15842","id":2761378298,"node_id":"I_kwDOAAiu0c6kl0n6","number":15842,"title":"curl_easy_perform() fails if a nested mime_handle was already used in a transfer","user":{"login":"Qriist","id":26832022,"node_id":"MDQ6VXNlcjI2ODMyMDIy","avatar_url":"https://avatars.githubusercontent.com/u/26832022?v=4","gravatar_id":"","url":"https://api.github.com/users/Qriist","html_url":"https://github.com/Qriist","followers_url":"https://api.github.com/users/Qriist/followers","following_url":"https://api.github.com/users/Qriist/following{/other_user}","gists_url":"https://api.github.com/users/Qriist/gists{/gist_id}","starred_url":"https://api.github.com/users/Qriist/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qriist/subscriptions","organizations_url":"https://api.github.com/users/Qriist/orgs","repos_url":"https://api.github.com/users/Qriist/repos","events_url":"https://api.github.com/users/Qriist/events{/privacy}","received_events_url":"https://api.github.com/users/Qriist/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1117926199,"node_id":"MDU6TGFiZWwxMTE3OTI2MTk5","url":"https://api.github.com/repos/curl/curl/labels/libcurl%20API","name":"libcurl API","color":"fef2c0","default":false,"description":""},{"id":2895664385,"node_id":"MDU6TGFiZWwyODk1NjY0Mzg1","url":"https://api.github.com/repos/curl/curl/labels/MIME","name":"MIME","color":"A458D7","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":26,"created_at":"2024-12-28T01:00:46Z","updated_at":"2025-04-06T16:50:25Z","closed_at":"2025-01-06T13:07:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nTo clarify on the title, nesting a `mime_handle` via `curl_mime_subparts()` technically works (returns 0) but the subsequent `curl_easy_perform()` fails.\r\n\r\nBascially, In the process of writing a [usage example](https://github.com/Qriist/LibQurl/blob/master/tests/18%20-%20using%20the%20mime%20interface.ahk#L47), I discovered that I cannot use a `mime_handle` if that handle had a newly nested `mime_part` that had previously been used in a `curl_easy_perform()` (and presumably in `curl_multi_perform()` as well but I didn't test).\r\n\r\nAttempting to `perform` under this condition would always return `CURLE_READ_ERROR (26)`. As I can freely reuse the `mime_handle` in other ways _and_ embed it as a subpart if freshly made, this seems to suggest something internal to curl.\r\n\r\nI recognize that this may be intended behavior, but I didn't see a note about it on the documentation so I figured I'd raise the flag. If it's intended please feel free to close the ticket. :)\r\n\r\n\r\n\r\n### I expected the following\r\n\r\nto add the `mime_handle` as a `mime_part`\r\n\r\n### curl/libcurl version\r\n\r\ncustom built libcurl from vcpkg with all supported features enabled: `libcurl/8.11.1-DEV wolfSSL/5.7.4 (GnuTLS/3.8.7) (mbedTLS/3.6.1) (LibreSSL/4.0.0) (Schannel) zlib/1.3.1 brotli/1.1.0 zstd/1.5.6 c-ares/1.34.3 WinIDN libpsl/0.21.5 libssh2/1.11.1_DEV nghttp2/1.64.0`\r\n\r\n### operating system\r\n\r\nWin10","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15842/timeline","performed_via_github_app":null,"state_reason":"completed"}