{"url":"https://api.github.com/repos/curl/curl/issues/16216","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/16216/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/16216/comments","events_url":"https://api.github.com/repos/curl/curl/issues/16216/events","html_url":"https://github.com/curl/curl/issues/16216","id":2835744088,"node_id":"I_kwDOAAiu0c6pBgVY","number":16216,"title":"Curl 8.12 access violation with c-ares when HTTPS-RR enabled","user":{"login":"nono303","id":2869665,"node_id":"MDQ6VXNlcjI4Njk2NjU=","avatar_url":"https://avatars.githubusercontent.com/u/2869665?v=4","gravatar_id":"","url":"https://api.github.com/users/nono303","html_url":"https://github.com/nono303","followers_url":"https://api.github.com/users/nono303/followers","following_url":"https://api.github.com/users/nono303/following{/other_user}","gists_url":"https://api.github.com/users/nono303/gists{/gist_id}","starred_url":"https://api.github.com/users/nono303/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nono303/subscriptions","organizations_url":"https://api.github.com/users/nono303/orgs","repos_url":"https://api.github.com/users/nono303/repos","events_url":"https://api.github.com/users/nono303/events{/privacy}","received_events_url":"https://api.github.com/users/nono303/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":940032249,"node_id":"MDU6TGFiZWw5NDAwMzIyNDk=","url":"https://api.github.com/repos/curl/curl/labels/Windows","name":"Windows","color":"0e8a16","default":false,"description":"Windows-specific"},{"id":975635480,"node_id":"MDU6TGFiZWw5NzU2MzU0ODA=","url":"https://api.github.com/repos/curl/curl/labels/name%20lookup","name":"name lookup","color":"0052cc","default":false,"description":"DNS and related tech"},{"id":8110723874,"node_id":"LA_kwDOAAiu0c8AAAAB42_TIg","url":"https://api.github.com/repos/curl/curl/labels/HTTPS-RR","name":"HTTPS-RR","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2025-02-06T14:47:29Z","updated_at":"2025-02-09T10:30:14Z","closed_at":"2025-02-09T10:30:14Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\nI've just compiled and tested curl 8.12 and have an Access violation related to c-ares.\n\n**This issue was not present on 8.11.1**\n\n## ‚è© use case : \n`curl -v https://www.google.com/` \n  and\n`<?php curl_exec(curl_init(\"https://www.google.com/\")); ?>`\n\n### ‚úÖ  when compiling with `-DENABLE_ARES=OFF`: all works\n### üî¥  when compiling with `-DENABLE_ARES=ON` : I have this exception\n\n```\nlibcurl!init_resolve_thread+0x2de\nlibcurl!Curl_resolv+0x9a8\nlibcurl!resolve_server+0x121\nlibcurl!create_conn+0xc26\nlibcurl!state_connect+0x49\nlibcurl!multi_runsingle+0x42f\nlibcurl!curl_multi_perform+0x11e\nlibcurl!easy_perform+0x1d5\n\nFAULTING_SOURCE_FILE:  C:\\sdk\\src\\curl\\lib\\asyn-thread.c\nFAULTING_SOURCE_CODE:  \n   387:     struct Curl_easy *data = td->tsd.data;\n   388: #endif\n   389: \n   390: #ifdef USE_HTTPSRR_ARES\n>  391:     ares_destroy(data->state.async.tdata->channel);\n   392: #endif\n   393:     /*\n   394:      * if the thread is still blocking in the resolve syscall, detach it and\n   395:      * let the thread do the cleanup...\n   396:      */\nIMAGE_NAME:  libcurl.dll\nFAILURE_BUCKET_ID:  NULL_CLASS_PTR_READ_c0000005_libcurl.dll!init_resolve_thread\nOS_VERSION:  10.0.26100.1\nBUILDLAB_STR:  ge_release\nOSPLATFORM_TYPE:  x64\nIMAGE_VERSION:  8.12.0.0\n```\n\n - my [CMake C-Ares](https://github.com/nono303/win-build-scripts/blob/master/modules/cares.bat#L7)\n - my [CMake Curl](https://github.com/nono303/win-build-scripts/blob/master/modules/curl.bat#L31)\n\n```\n...\n-- Found Cares: C:/sdk/release/vs17_x64-avx2/include (found version \"1.34.4\")\n...\n-- LTO supported and enabled\n-- Protocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss\n-- Features: alt-svc asyn-rr AsynchDNS brotli HSTS HTTP2 HTTPS-proxy HTTPSRR IDN IPv6 Kerberos Largefile libz MultiSSL NTLM SPNEGO SSL SSPI threadsafe TLS-SRP Unicode UnixSockets zstd\n-- Enabled SSL backends: OpenSSL v3+ Schannel\n```\n\n\n### I expected the following\n\n_No response_\n\n### curl/libcurl version\n\n8.12.0\n\n### operating system\n\nWindows 11 24h2 x64\n-- Using CMake version 3.31.5\n-- curl version=[8.12.0-DEV]\n-- The C compiler identification is MSVC 19.42.34438.0","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/16216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/16216/timeline","performed_via_github_app":null,"state_reason":"completed"}