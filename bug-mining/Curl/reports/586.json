{"url":"https://api.github.com/repos/curl/curl/issues/15525","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15525/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15525/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15525/events","html_url":"https://github.com/curl/curl/issues/15525","id":2644560243,"node_id":"I_kwDOAAiu0c6doMlz","number":15525,"title":"_fseeki64 incorrectly detected as found when cross-compiling for iOS.","user":{"login":"lhunath","id":36948,"node_id":"MDQ6VXNlcjM2OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/36948?v=4","gravatar_id":"","url":"https://api.github.com/users/lhunath","html_url":"https://github.com/lhunath","followers_url":"https://api.github.com/users/lhunath/followers","following_url":"https://api.github.com/users/lhunath/following{/other_user}","gists_url":"https://api.github.com/users/lhunath/gists{/gist_id}","starred_url":"https://api.github.com/users/lhunath/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lhunath/subscriptions","organizations_url":"https://api.github.com/users/lhunath/orgs","repos_url":"https://api.github.com/users/lhunath/repos","events_url":"https://api.github.com/users/lhunath/events{/privacy}","received_events_url":"https://api.github.com/users/lhunath/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184123162,"node_id":"MDU6TGFiZWwxODQxMjMxNjI=","url":"https://api.github.com/repos/curl/curl/labels/cmake","name":"cmake","color":"d4c5f9","default":false,"description":null},{"id":5766238564,"node_id":"LA_kwDOAAiu0c8AAAABV7HRZA","url":"https://api.github.com/repos/curl/curl/labels/appleOS","name":"appleOS","color":"5319e7","default":false,"description":"specific to an Apple operating system"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-11-08T16:44:04Z","updated_at":"2024-11-12T15:32:44Z","closed_at":"2024-11-11T13:27:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nIt appears the change introduced by #15164 caused an issue cross-compiling curl for iOS/aarch64.\r\n\r\nWith the following in `CMakeLists.txt`:\r\n```\r\ncheck_function_exists(\"_fseeki64\"     HAVE__FSEEKI64)\r\n```\r\nRunning the following:\r\n```\r\ncmake -B libcurl-iphoneos -S libcurl -DCMAKE_OSX_ARCHITECTURES=arm64 -DCMAKE_OSX_DEPLOYMENT_TARGET=12.0 -DCMAKE_TOOLCHAIN_FILE=/Users/hubstaff/Developer/hubstaff/ios/hubstaff-core/toolchains/ios.toolchain.cmake -DCMAKE_INSTALL_PREFIX=/Users/hubstaff/Developer/hubstaff/ios/hubstaff-core/build/__third_party__/curl/distro/ios/ -DBUILD_CURL_EXE=OFF -DBUILD_SHARED_LIBS=OFF -GXcode -DBUILD_EXAMPLES=OFF -DBUILD_LIBCURL_DOCS=OFF -DBUILD_MISC_DOCS=OFF -DENABLE_CURL_MANUAL=OFF -DCURL_USE_SECTRANSP=ON -DUSE_APPLE_IDN=ON -DUSE_NGHTTP2=OFF -DCURL_USE_LIBPSL=OFF\r\n```\r\nResults in:\r\n```\r\n-- Looking for _fseeki64\r\n-- Looking for _fseeki64 - found\r\n```\r\nAnd a failed build:\r\n```\r\n/Users/hubstaff/Developer/hubstaff/ios/hubstaff-core/build/__third_party__/curl/libcurl/lib/formdata.c:797:10: error: call to undeclared function '_fseeki64'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]\r\n  797 |   return _fseeki64(stream, (__int64)offset, whence);\r\n      |          ^\r\n/Users/hubstaff/Developer/hubstaff/ios/hubstaff-core/build/__third_party__/curl/libcurl/lib/formdata.c:797:29: error: use of undeclared identifier '__int64'\r\n  797 |   return _fseeki64(stream, (__int64)offset, whence);\r\n      |                             ^\r\n/Users/hubstaff/Developer/hubstaff/ios/hubstaff-core/build/__third_party__/curl/libcurl/lib/formdata.c:794:52: warning: unused parameter 'offset' [-Wunused-parameter]\r\n  794 | static int fseeko_wrapper(void *stream, curl_off_t offset, int whence)\r\n      |                                                    ^\r\n1 warning and 2 errors generated.\r\n```\r\n\r\nWhile reverting the `CMakeLists.txt` back to using:\r\n```\r\ncheck_symbol_exists(\"_fseeki64\"       \"${CURL_INCLUDES};stdio.h\" HAVE__FSEEKI64)\r\n```\r\nYields:\r\n```\r\n-- Looking for _fseeki64\r\n-- Looking for _fseeki64 - not found\r\n```\r\nAnd a successful build.\n\n### I expected the following\n\nFor `HAVE__FSEEKI64` to be correctly detected as `0` rather than `1` when the symbol is unavailable during build time.\n\n### curl/libcurl version\n\ncurl-8_11_0\n\n### operating system\n\nCross-compiling for iPhoneOS18.1.sdk from macOS 15.0.1 (24A348).\r\n","closed_by":{"login":"vszakats","id":1446897,"node_id":"MDQ6VXNlcjE0NDY4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1446897?v=4","gravatar_id":"","url":"https://api.github.com/users/vszakats","html_url":"https://github.com/vszakats","followers_url":"https://api.github.com/users/vszakats/followers","following_url":"https://api.github.com/users/vszakats/following{/other_user}","gists_url":"https://api.github.com/users/vszakats/gists{/gist_id}","starred_url":"https://api.github.com/users/vszakats/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vszakats/subscriptions","organizations_url":"https://api.github.com/users/vszakats/orgs","repos_url":"https://api.github.com/users/vszakats/repos","events_url":"https://api.github.com/users/vszakats/events{/privacy}","received_events_url":"https://api.github.com/users/vszakats/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15525/timeline","performed_via_github_app":null,"state_reason":"completed"}