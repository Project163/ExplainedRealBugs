{"url":"https://api.github.com/repos/curl/curl/issues/12356","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/12356/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/12356/comments","events_url":"https://api.github.com/repos/curl/curl/issues/12356/events","html_url":"https://github.com/curl/curl/issues/12356","id":2000870730,"node_id":"I_kwDOAAiu0c53Qt1K","number":12356,"title":"heap-use-after-free with HTTP3","user":{"login":"lemourin","id":11277986,"node_id":"MDQ6VXNlcjExMjc3OTg2","avatar_url":"https://avatars.githubusercontent.com/u/11277986?v=4","gravatar_id":"","url":"https://api.github.com/users/lemourin","html_url":"https://github.com/lemourin","followers_url":"https://api.github.com/users/lemourin/followers","following_url":"https://api.github.com/users/lemourin/following{/other_user}","gists_url":"https://api.github.com/users/lemourin/gists{/gist_id}","starred_url":"https://api.github.com/users/lemourin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lemourin/subscriptions","organizations_url":"https://api.github.com/users/lemourin/orgs","repos_url":"https://api.github.com/users/lemourin/repos","events_url":"https://api.github.com/users/lemourin/events{/privacy}","received_events_url":"https://api.github.com/users/lemourin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118205,"node_id":"MDU6TGFiZWwxODQxMTgyMDU=","url":"https://api.github.com/repos/curl/curl/labels/crash","name":"crash","color":"bfe5bf","default":false,"description":null},{"id":1141438010,"node_id":"MDU6TGFiZWwxMTQxNDM4MDEw","url":"https://api.github.com/repos/curl/curl/labels/HTTP/3","name":"HTTP/3","color":"97fceb","default":false,"description":"h3 or quic related"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2023-11-19T14:19:32Z","updated_at":"2023-11-21T06:56:26Z","closed_at":"2023-11-21T06:56:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\n\nI've built my app with curl + HTTP3 (via quictls + ngtcp2 + nghttp3). On windows (built with MSVC) it crashes 100% of times, on macOS or Android it is very hard to repro the crash (easy to repro with curl 8.4.0). ASAN dump:\r\n\r\nNB. the app works fine when built with HTTP2 only\r\n\r\n```\r\n=================================================================\r\n==3448==ERROR: AddressSanitizer: heap-use-after-free on address 0x1209f13a7aa8 at pc 0x7ff7929a4eb3 bp 0x00a6674e9fb0 sp 0x00a6674e9fb8\r\nREAD of size 8 at 0x1209f13a7aa8 thread T0\r\n==3448==WARNING: Failed to use and restart external symbolizer!\r\n    #0 0x7ff7929a4eb2 in cb_h3_recv_data C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:1235\r\n    #1 0x7ff7933576f3 in nghttp3_conn_on_data C:\\src\\vcpkg\\buildtrees\\nghttp3\\src\\v1.0.0-b55f3d7380.clean\\lib\\nghttp3_conn.c:1540\r\n    #2 0x7ff793353e1d in nghttp3_conn_read_bidi C:\\src\\vcpkg\\buildtrees\\nghttp3\\src\\v1.0.0-b55f3d7380.clean\\lib\\nghttp3_conn.c:1355\r\n    #3 0x7ff79334e16a in nghttp3_conn_read_stream C:\\src\\vcpkg\\buildtrees\\nghttp3\\src\\v1.0.0-b55f3d7380.clean\\lib\\nghttp3_conn.c:488\r\n    #4 0x7ff7929a2552 in cb_recv_stream_data C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:838\r\n    #5 0x7ff79327cff0 in conn_call_recv_stream_data C:\\src\\vcpkg\\buildtrees\\ngtcp2\\src\\v1.0.1-2d9b978f1f.clean\\lib\\ngtcp2_conn.c:124\r\n    #6 0x7ff7932ad075 in conn_recv_stream C:\\src\\vcpkg\\buildtrees\\ngtcp2\\src\\v1.0.1-2d9b978f1f.clean\\lib\\ngtcp2_conn.c:7225\r\n    #7 0x7ff7932a5f28 in conn_recv_pkt C:\\src\\vcpkg\\buildtrees\\ngtcp2\\src\\v1.0.1-2d9b978f1f.clean\\lib\\ngtcp2_conn.c:9311    #8 0x7ff7932b7605 in conn_recv_cpkt C:\\src\\vcpkg\\buildtrees\\ngtcp2\\src\\v1.0.1-2d9b978f1f.clean\\lib\\ngtcp2_conn.c:9725\r\n    #9 0x7ff793265117 in ngtcp2_conn_read_pkt_versioned C:\\src\\vcpkg\\buildtrees\\ngtcp2\\src\\v1.0.1-2d9b978f1f.clean\\lib\\ngtcp2_conn.c:10106\r\n    #10 0x7ff7929a9881 in recv_pkt C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:1990\r\n    #11 0x7ff7929b0e45 in recvfrom_packets C:\\src\\curl\\lib\\vquic\\vquic.c:518\r\n    #12 0x7ff7929afd14 in vquic_recv_packets C:\\src\\curl\\lib\\vquic\\vquic.c:544\r\n    #13 0x7ff79299ec0a in cf_progress_ingress C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:2044\r\n    #14 0x7ff7929ae8e9 in cf_ngtcp2_conn_is_alive C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:2741\r\n    #15 0x7ff7928c5533 in Curl_cf_def_conn_is_alive C:\\src\\curl\\lib\\cfilters.c:111\r\n    #16 0x7ff7928c5533 in Curl_cf_def_conn_is_alive C:\\src\\curl\\lib\\cfilters.c:111\r\n    #17 0x7ff7928c5533 in Curl_cf_def_conn_is_alive C:\\src\\curl\\lib\\cfilters.c:111\r\n    #18 0x7ff7928c97fe in Curl_conn_is_alive C:\\src\\curl\\lib\\cfilters.c:640\r\n    #19 0x7ff7928b1683 in extract_if_dead C:\\src\\curl\\lib\\url.c:807\r\n    #20 0x7ff7928b1897 in call_extract_if_dead C:\\src\\curl\\lib\\url.c:845\r\n    #21 0x7ff792899321 in Curl_conncache_foreach C:\\src\\curl\\lib\\conncache.c:332\r\n    #22 0x7ff7928b1cf6 in prune_dead_connections C:\\src\\curl\\lib\\url.c:874\r\n    #23 0x7ff7928c0b74 in create_conn C:\\src\\curl\\lib\\url.c:3649\r\n    #24 0x7ff7928ad0b6 in Curl_connect C:\\src\\curl\\lib\\url.c:3915\r\n    #25 0x7ff792878601 in multi_runsingle C:\\src\\curl\\lib\\multi.c:1927\r\n    #26 0x7ff79287bb85 in multi_socket C:\\src\\curl\\lib\\multi.c:3212\r\n    #27 0x7ff79286cce4 in curl_multi_socket_action C:\\src\\curl\\lib\\multi.c:3334\r\n    #28 0x7ff7909fe1c5 in coro::http::`anonymous namespace'::CurlHttpImpl::TimeoutEvent C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:540\r\n    #29 0x7ff790efd2ee in event_process_active_single_queue C:\\src\\vcpkg\\buildtrees\\libevent\\src\\757b64d6d1-bfa17b9727.clean\\event.c:1727\r\n    #30 0x7ff790ef3dfe in event_process_active C:\\src\\vcpkg\\buildtrees\\libevent\\src\\757b64d6d1-bfa17b9727.clean\\event.c:1819\r\n    #31 0x7ff790ede5c0 in event_base_loop C:\\src\\vcpkg\\buildtrees\\libevent\\src\\757b64d6d1-bfa17b9727.clean\\event.c:2068\r\n    #32 0x7ff7909c4950 in coro::util::EventLoop::EnterLoop C:\\src\\coro-http\\src\\coro\\util\\event_loop.cc:159\r\n    #33 0x7ff78faeb932 in main C:\\src\\coro-cloudstorage\\examples\\cloudstorage.cc:100\r\n    #34 0x7ff793503fa8 in invoke_main D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl:78\r\n    #35 0x7ff793503efd in __scrt_common_main_seh D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl:288    #36 0x7ff793503dbd in __scrt_common_main D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl:330\r\n    #37 0x7ff79350401d in mainCRTStartup D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_main.cpp:16\r\n    #38 0x7ff90a0d257c in BaseThreadInitThunk+0x1c (C:\\WINDOWS\\System32\\KERNEL32.DLL+0x18001257c)\r\n    #39 0x7ff90ac4aa57 in RtlUserThreadStart+0x27 (C:\\WINDOWS\\SYSTEM32\\ntdll.dll+0x18005aa57)\r\n\r\n0x1209f13a7aa8 is located 424 bytes inside of 5136-byte region [0x1209f13a7900,0x1209f13a8d10)\r\nfreed by thread T0 here:\r\n    #0 0x7ff78fb1ce15 in free D:\\a\\_work\\1\\s\\src\\vctools\\asan\\llvm\\compiler-rt\\lib\\asan\\asan_malloc_win_thunk.cpp:69\r\n    #1 0x7ff7928acd7d in Curl_close C:\\src\\curl\\lib\\url.c:343\r\n    #2 0x7ff792855983 in curl_easy_cleanup C:\\src\\curl\\lib\\easy.c:804\r\n    #3 0x7ff7909f58b6 in coro::http::`anonymous namespace'::CurlHandleDeleter::operator() C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:81\r\n    #4 0x7ff7909fa079 in std::unique_ptr<void,coro::http::`anonymous namespace'::CurlHandleDeleter>::~unique_ptr<void,coro::http::`anonymous namespace'::CurlHandleDeleter> C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3290\r\n    #5 0x7ff7909fabe0 in coro::http::`anonymous namespace'::CurlHandle::~CurlHandle+0x70 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411aabe0)\r\n    #6 0x7ff7909fac06 in coro::http::`anonymous namespace'::CurlHandle::`scalar deleting destructor'+0x16 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411aac06)\r\n    #7 0x7ff7909fb94e in std::default_delete<coro::http::`anonymous namespace'::CurlHandle>::operator() C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3180\r\n    #8 0x7ff7909fba51 in std::unique_ptr<coro::http::`anonymous namespace'::CurlHandle,std::default_delete<coro::http::`anonymous namespace'::CurlHandle> >::~unique_ptr<coro::http::`anonymous namespace'::CurlHandle,std::default_delete<coro::http::`anonymous namespace'::CurlHandle> > C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3290\r\n    #9 0x7ff7909fbc9b in coro::http::`anonymous namespace'::CurlHttpBodyGenerator::~CurlHttpBodyGenerator+0x1b (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411abc9b)\r\n    #10 0x7ff7909ffa39 in coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator>::~Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator>+0x19 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411afa39)\r\n    #11 0x7ff7909ffa76 in coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator>::`scalar deleting destructor'+0x16 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411afa76)\r\n    #12 0x7ff7909ff6ee in std::default_delete<coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator> >::operator() C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3180    #13 0x7ff7909ff7f1 in std::unique_ptr<coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator>,std::default_delete<coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator> > >::~unique_ptr<coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator>,std::default_delete<coro::http::Response<coro::http::`anonymous namespace'::CurlHttpBodyGenerator> > > C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3290\r\n    #14 0x7ff790a00a85 in `coro::http::`anonymous namespace'::ToBody'::`21'::<parameters>::~<parameters>+0x15 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1411b0a85)\r\n    #15 0x7ff790a0400f in coro::http::`anonymous namespace'::ToBody$_ResumeCoro$1 C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:654\r\n    #16 0x7ff790a02ec4 in coro::http::`anonymous namespace'::ToBody$_DestroyCoro$3 C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:15732480\r\n    #17 0x7ff78fb160d8 in std::coroutine_handle<coro::detail::async_generator_promise<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >::destroy C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:145\r\n    #18 0x7ff78fafec99 in coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > >::~Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > C:\\src\\coro-http\\src\\coro\\generator.h:288\r\n    #19 0x7ff78fafee69 in coro::http::Response<coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >::~Response<coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >+0x19 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x1402aee69)\r\n    #20 0x7ff7902a534e in coro::cloudstorage::GoogleDrive::GetFileContent$_ResumeCoro$1 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\providers\\google_drive.cc:196\r\n    #21 0x7ff7902a3d96 in coro::cloudstorage::GoogleDrive::GetFileContent$_DestroyCoro$3 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\providers\\google_drive.cc:15732480\r\n    #22 0x7ff78fb160d8 in std::coroutine_handle<coro::detail::async_generator_promise<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >::destroy C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:145\r\n    #23 0x7ff78fafec99 in coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > >::~Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > C:\\src\\coro-http\\src\\coro\\generator.h:288\r\n    #24 0x7ff7900aabf5 in `coro::cloudstorage::util::internal::GetFileContentResponseBody'::`5'::<parameters>::~<parameters>+0x15 (C:\\src\\coro-cloudstorage\\out\\build\\x64-AddressSanitizer\\examples\\cloudstorage.exe+0x14085abf5)\r\n    #25 0x7ff7900ab6c6 in coro::cloudstorage::util::internal::GetFileContentResponseBody$_ResumeCoro$1 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\util\\handler_utils.cc:18\r\n    #26 0x7ff7900aac44 in coro::cloudstorage::util::internal::GetFileContentResponseBody$_DestroyCoro$3 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\util\\handler_utils.cc:15732480\r\n    #27 0x7ff78fb160d8 in std::coroutine_handle<coro::detail::async_generator_promise<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >::destroy C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:145\r\n    #28 0x7ff78fafec99 in coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > >::~Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > C:\\src\\coro-http\\src\\coro\\generator.h:288\r\n\r\npreviously allocated by thread T0 here:\r\n    #0 0x7ff78fb1cd9a in calloc D:\\a\\_work\\1\\s\\src\\vctools\\asan\\llvm\\compiler-rt\\lib\\asan\\asan_malloc_win_thunk.cpp:101\r\n    #1 0x7ff7928aa907 in Curl_open C:\\src\\curl\\lib\\url.c:508\r\n    #2 0x7ff7928557f1 in curl_easy_init C:\\src\\curl\\lib\\easy.c:368\r\n    #3 0x7ff7909f5ee0 in coro::http::`anonymous namespace'::CurlHandle::CurlHandle C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:361\r\n    #4 0x7ff790a0c8b6 in std::make_unique<coro::http::`anonymous namespace'::CurlHandle,void * &,event_base * &,coro::http::Request<coro::Generator<std::basic_string<char,std::char_traits<char>,std::allocator<char> > > >,std::basic_string<char,std::char_traits<char>,std::allocator<char> > const * &,coro::stdx::stop_token,coro::http::A0x7b97c9cd::CurlHttpOperation *,0> C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\memory:3477\r\n    #5 0x7ff7909fc076 in coro::http::`anonymous namespace'::CurlHttpOperation::CurlHttpOperation C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:488\r\n    #6 0x7ff7909fd953 in coro::http::`anonymous namespace'::CurlHttpImpl::Fetch C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:643\r\n    #7 0x7ff790a024c6 in coro::http::CurlHttpBase::Fetch$_ResumeCoro$1 C:\\src\\coro-http\\src\\coro\\http\\curl_http.cc:672\r\n    #8 0x7ff78fb1a2fa in std::coroutine_handle<void>::resume C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:85\r\n    #9 0x7ff790097a01 in coro::detail::ReturnValue<coro::detail::Task<coro::cloudstorage::util::VersionedItem>::promise_type,coro::cloudstorage::util::VersionedItem>::return_value<coro::cloudstorage::util::VersionedItem> C:\\src\\coro-http\\src\\coro\\task.h:67\r\n    #10 0x7ff79007a0cd in coro::cloudstorage::util::CloudProviderAccount::GetItemById$_ResumeCoro$1 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\util\\cloud_provider_account.cc:136\r\n    #11 0x7ff78fb1a2fa in std::coroutine_handle<void>::resume C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:85\r\n    #12 0x7ff78fbe0f31 in coro::detail::ReturnValue<coro::detail::Task<std::optional<coro::cloudstorage::util::CacheManager::ItemData> >::promise_type,std::optional<coro::cloudstorage::util::CacheManager::ItemData> >::return_value<coro::cloudstorage::util::CacheManager::ItemData> C:\\src\\coro-http\\src\\coro\\task.h:67\r\n    #13 0x7ff78fb53d42 in coro::cloudstorage::util::CacheManager::Get$_ResumeCoro$1 C:\\src\\coro-cloudstorage\\src\\coro\\cloudstorage\\util\\cache_manager.cc:316\r\n    #14 0x7ff78fb1a2fa in std::coroutine_handle<void>::resume C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:85\r\n    #15 0x7ff78fbe10d1 in coro::detail::ReturnValue<coro::detail::Task<std::optional<coro::cloudstorage::util::`anonymous namespace'::DbItem> >::promise_type,std::optional<coro::cloudstorage::util::`anonymous namespace'::DbItem> >::return_value<std::optional<coro::cloudstorage::util::`anonymous namespace'::DbItem> > C:\\src\\coro-http\\src\\coro\\task.h:67\r\n    #16 0x7ff78fb7dcd5 in coro::util::ThreadPool::Do$_ResumeCoro$1<`coro::cloudstorage::util::CacheManager::Get'::`2'::<lambda_1> > C:\\src\\coro-http\\src\\coro\\util\\thread_pool.h:60\r\n    #17 0x7ff78fb1a2fa in std::coroutine_handle<void>::resume C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:85\r\n    #18 0x7ff78fb1a3b8 in coro::detail::ReturnValue<coro::detail::Task<void>::promise_type,void>::return_void C:\\src\\coro-http\\src\\coro\\task.h:76\r\n    #19 0x7ff7909cbb4a in coro::util::ThreadPool::SwitchToEventLoop$_ResumeCoro$1 C:\\src\\coro-http\\src\\coro\\util\\thread_pool.cc:129\r\n    #20 0x7ff78fb1a2fa in std::coroutine_handle<void>::resume C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\coroutine:85\r\n    #21 0x7ff7909caf95 in ``coro::util::ThreadPool::SwitchToEventLoop'::`2'::Awaiter::await_suspend'::`2'::<lambda_1>::operator() C:\\src\\coro-http\\src\\coro\\util\\thread_pool.cc:124\r\n    #22 0x7ff7909cb135 in `coro::util::EventLoop::RunOnEventLoop<``coro::util::ThreadPool::SwitchToEventLoop'::`2'::Awaiter::await_suspend'::`2'::<lambda_1> >'::`2'::<lambda_1>::operator() C:\\src\\coro-http\\src\\coro\\util\\event_loop.h:49\r\n    #23 0x7ff7909cdf32 in std::invoke<`coro::util::EventLoop::RunOnEventLoop<``coro::util::ThreadPool::SwitchToEventLoop'::`2'::Awaiter::await_suspend'::`2'::<lambda_1> >'::`2'::<lambda_1> &> C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.37.32822\\include\\type_traits:1752\r\n    #24 0x7ff7909cb2f5 in coro::stdx::any_detail::handler_traits<void>::small_handler<`coro::util::EventLoop::RunOnEventLoop<``coro::util::ThreadPool::SwitchToEventLoop'::`2'::Awaiter::await_suspend'::`2'::<lambda_1> >'::`2'::<lambda_1> >::call C:\\src\\coro-http\\src\\coro\\stdx\\any_invocable.h:97\r\n    #25 0x7ff7909c8f2b in coro::stdx::any_detail::any_invocable_impl<void,0>::call C:\\src\\coro-http\\src\\coro\\stdx\\any_invocable.h:212\r\n    #26 0x7ff7909c8df2 in coro::stdx::any_invocable<void __cdecl(void)&& >::operator() C:\\src\\coro-http\\src\\coro\\stdx\\any_invocable.h:323\r\n    #27 0x7ff7909c64f4 in `coro::util::EventLoop::RunOnce'::`3'::<lambda_1>::operator() C:\\src\\coro-http\\src\\coro\\util\\event_loop.cc:93\r\n    #28 0x7ff7909c65fc in `coro::util::EventLoop::RunOnce'::`3'::<lambda_1>::<lambda_invoker_cdecl> C:\\src\\coro-http\\src\\coro\\util\\event_loop.cc:94\r\n\r\nSUMMARY: AddressSanitizer: heap-use-after-free C:\\src\\curl\\lib\\vquic\\curl_ngtcp2.c:1235 in cb_h3_recv_data\r\nShadow bytes around the buggy address:\r\n  0x04072f5f4f00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x04072f5f4f10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x04072f5f4f20: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n=>0x04072f5f4f50: fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f80: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4f90: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x04072f5f4fa0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07\r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n```\r\n\r\nIf needed I can provide curl debug logs as well.\r\n\r\n\n\n### I expected the following\n\nNo crash.\n\n### curl/libcurl version\n\ncurl head (https://github.com/curl/curl/commit/fa714830e92cba7b16b9d3f2cc92a72ee9d821fa) with quictls ([openssl-3.1.4+quic](https://github.com/quictls/openssl/tree/openssl-3.1.4%2Bquic)), ngtcp2 ([v1.0.1](https://github.com/ngtcp2/ngtcp2/tree/v1.0.1)), nghttp3 ([v1.0.0](https://github.com/ngtcp2/nghttp3/tree/v1.0.0)).\n\n### operating system\n\nWindows 11","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/12356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/12356/timeline","performed_via_github_app":null,"state_reason":"completed"}