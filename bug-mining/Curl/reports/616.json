{"url":"https://api.github.com/repos/curl/curl/issues/15767","repository_url":"https://api.github.com/repos/curl/curl","labels_url":"https://api.github.com/repos/curl/curl/issues/15767/labels{/name}","comments_url":"https://api.github.com/repos/curl/curl/issues/15767/comments","events_url":"https://api.github.com/repos/curl/curl/issues/15767/events","html_url":"https://github.com/curl/curl/issues/15767","id":2745532750,"node_id":"I_kwDOAAiu0c6jpYFO","number":15767,"title":"curl CLI v8.11.1 fails to offer HTTP Basic auth specified in .netrc when invoked with --netrc-optional","user":{"login":"bzanin-wdc","id":98898629,"node_id":"U_kgDOBeUSxQ","avatar_url":"https://avatars.githubusercontent.com/u/98898629?v=4","gravatar_id":"","url":"https://api.github.com/users/bzanin-wdc","html_url":"https://github.com/bzanin-wdc","followers_url":"https://api.github.com/users/bzanin-wdc/followers","following_url":"https://api.github.com/users/bzanin-wdc/following{/other_user}","gists_url":"https://api.github.com/users/bzanin-wdc/gists{/gist_id}","starred_url":"https://api.github.com/users/bzanin-wdc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bzanin-wdc/subscriptions","organizations_url":"https://api.github.com/users/bzanin-wdc/orgs","repos_url":"https://api.github.com/users/bzanin-wdc/repos","events_url":"https://api.github.com/users/bzanin-wdc/events{/privacy}","received_events_url":"https://api.github.com/users/bzanin-wdc/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":184118197,"node_id":"MDU6TGFiZWwxODQxMTgxOTc=","url":"https://api.github.com/repos/curl/curl/labels/regression","name":"regression","color":"33aa3f","default":false,"description":null},{"id":538402904,"node_id":"MDU6TGFiZWw1Mzg0MDI5MDQ=","url":"https://api.github.com/repos/curl/curl/labels/authentication","name":"authentication","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2024-12-17T17:13:20Z","updated_at":"2025-02-06T01:58:27Z","closed_at":"2024-12-18T07:17:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### I did this\r\n\r\nGiven an executable test script with the following contents named `test-curl` ***which will ruthlessly shove aside any existing `~/.netrc` file***..:\r\n\r\n```sh\r\n#!/usr/bin/env bash\r\nif ((BASH_VERSINFO < 4)); then\r\n\tprintf '%s\\n' 'we need at least bash 4.x (arrays) to function'\r\n\texit 1\r\nfi\r\ncase=${case:-'fail'}\r\n  # change this value to 'pass' to demonstrate expected behaviour,\r\n  # or set and export the environment variable \"$case\" to 'pass' or 'fail'\r\n[[ ! \"$case\" == @(pass|fail) ]] && exit 1\r\n  # no unsanitized input ever\r\nprintf '%s\\n' 'machine api.github.com' 'password fake' > .netrc.case-pass\r\nprintf '%s\\n' 'machine api.github.com' 'password fake' '' 'machine example.com' > .netrc.case-fail\r\nmv -v .netrc \".netrc.bak.$$.$EPOCHSECONDS\"\r\nln -v .netrc.case-\"${case}\" .netrc\r\nopts_curl=( \\\r\n  '--url'    'https://api.github.com/meta'\r\n    # Just a convenient endpoint that will answer whether or not it is\r\n    # given a valid Authorization: HTTP header.\r\n  '--output' '/dev/null'\r\n    # Not really necessary, but arguably good form?\r\n  '--disable'\r\n    # ignore any existing ~/.curlrc file\r\n  '--verbose'\r\n    # make sure we can look for the Authorization: header we care about\r\n    # in the stdout/stderr generated by curl\r\n  '--head'\r\n    # don't actually ask GitHub to send us the file contents since we\r\n    # only care about the headers.  Is it worth saving like 147KB of\r\n    # network data transfer?  Arguably.  Is it worth being polite about\r\n    # requesting the transfer of data we won't use?  Yes, it is.\r\n  '--netrc-optional'\r\n    # key invocation flag for replicating this error case.  Specifying\r\n    # a netrc file explicitly with --netrc .netrc.case-pass does not\r\n    # replicate the failure behaviour.\r\n)\r\ncurl \"${opts_curl[@]}\" 2>&1 | grep -E '^> Authorization:'\r\n```\r\n\r\n...then invoking this script with `case='pass' ./test-curl` replicates the expected and desired behaviour, whereas invoking it with `case='fail' ./test-curl` replicates the failure case.\r\n\r\n### I expected the following\r\n\r\nDesired outcome with `case='pass'`, with the `Authorization: Basic ...` header being sent with the HTTP request:\r\n```\r\nrenamed '.netrc' -> '.netrc.bak.52898.1734455278'\r\n'.netrc' => '.netrc.case-pass'\r\n> Authorization: Basic OmZha2U=\r\n```\r\n\r\nSurprising outcome with `case='fail'`, with the `Authorization: Basic ...` header absent from the HTTP request:\r\n```\r\nrenamed '.netrc' -> '.netrc.bak.53651.1734455299'\r\n'.netrc' => '.netrc.case-fail'\r\n```\r\n\r\n### curl/libcurl version\r\n\r\ncurl 8.11.1 (aarch64-apple-darwin23.6.0) libcurl/8.11.1 OpenSSL/3.4.0 (SecureTransport) zlib/1.2.12 brotli/1.1.0 zstd/1.5.6 AppleIDN libssh2/1.11.1 nghttp2/1.64.0 librtmp/2.3\r\nRelease-Date: 2024-12-11\r\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss\r\nFeatures: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz MultiSSL NTLM SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\r\n\r\n### operating system\r\n\r\nDarwin P2XYX6PHVX 23.6.0 Darwin Kernel Version 23.6.0: Wed Jul 31 20:49:39 PDT 2024; root:xnu-10063.141.1.700.5~1/RELEASE_ARM64_T6000 arm64 arm Darwin","closed_by":{"login":"bagder","id":177011,"node_id":"MDQ6VXNlcjE3NzAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/177011?v=4","gravatar_id":"","url":"https://api.github.com/users/bagder","html_url":"https://github.com/bagder","followers_url":"https://api.github.com/users/bagder/followers","following_url":"https://api.github.com/users/bagder/following{/other_user}","gists_url":"https://api.github.com/users/bagder/gists{/gist_id}","starred_url":"https://api.github.com/users/bagder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bagder/subscriptions","organizations_url":"https://api.github.com/users/bagder/orgs","repos_url":"https://api.github.com/users/bagder/repos","events_url":"https://api.github.com/users/bagder/events{/privacy}","received_events_url":"https://api.github.com/users/bagder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/curl/curl/issues/15767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/curl/curl/issues/15767/timeline","performed_via_github_app":null,"state_reason":"completed"}