{"url":"https://api.github.com/repos/remix-run/react-router/issues/4443","repository_url":"https://api.github.com/repos/remix-run/react-router","labels_url":"https://api.github.com/repos/remix-run/react-router/issues/4443/labels{/name}","comments_url":"https://api.github.com/repos/remix-run/react-router/issues/4443/comments","events_url":"https://api.github.com/repos/remix-run/react-router/issues/4443/events","html_url":"https://github.com/remix-run/react-router/issues/4443","id":204973574,"node_id":"MDU6SXNzdWUyMDQ5NzM1NzQ=","number":4443,"title":"Need to remove basename from location for StaticRouter","user":{"login":"justin808","id":1118459,"node_id":"MDQ6VXNlcjExMTg0NTk=","avatar_url":"https://avatars.githubusercontent.com/u/1118459?v=4","gravatar_id":"","url":"https://api.github.com/users/justin808","html_url":"https://github.com/justin808","followers_url":"https://api.github.com/users/justin808/followers","following_url":"https://api.github.com/users/justin808/following{/other_user}","gists_url":"https://api.github.com/users/justin808/gists{/gist_id}","starred_url":"https://api.github.com/users/justin808/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justin808/subscriptions","organizations_url":"https://api.github.com/users/justin808/orgs","repos_url":"https://api.github.com/users/justin808/repos","events_url":"https://api.github.com/users/justin808/events{/privacy}","received_events_url":"https://api.github.com/users/justin808/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":100166615,"node_id":"MDU6TGFiZWwxMDAxNjY2MTU=","url":"https://api.github.com/repos/remix-run/react-router/labels/bug","name":"bug","color":"F44250","default":true,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/remix-run/react-router/milestones/18","html_url":"https://github.com/remix-run/react-router/milestone/18","labels_url":"https://api.github.com/repos/remix-run/react-router/milestones/18/labels","id":1961834,"node_id":"MDk6TWlsZXN0b25lMTk2MTgzNA==","number":18,"title":"v4.0.0","description":"","creator":{"login":"timdorr","id":17882,"node_id":"MDQ6VXNlcjE3ODgy","avatar_url":"https://avatars.githubusercontent.com/u/17882?v=4","gravatar_id":"","url":"https://api.github.com/users/timdorr","html_url":"https://github.com/timdorr","followers_url":"https://api.github.com/users/timdorr/followers","following_url":"https://api.github.com/users/timdorr/following{/other_user}","gists_url":"https://api.github.com/users/timdorr/gists{/gist_id}","starred_url":"https://api.github.com/users/timdorr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timdorr/subscriptions","organizations_url":"https://api.github.com/users/timdorr/orgs","repos_url":"https://api.github.com/users/timdorr/repos","events_url":"https://api.github.com/users/timdorr/events{/privacy}","received_events_url":"https://api.github.com/users/timdorr/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":105,"state":"closed","created_at":"2016-08-24T22:46:03Z","updated_at":"2017-10-03T22:59:51Z","due_on":"2017-03-09T08:00:00Z","closed_at":"2017-10-03T22:59:51Z"},"comments":3,"created_at":"2017-02-02T19:35:18Z","updated_at":"2019-01-20T23:28:53Z","closed_at":"2017-02-03T01:45:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Version\r\n    \"react-router\": \"4.0.0-beta.3\",\r\n\r\n## Test Case\r\nServer Rendering with a nested Route\r\n\r\n## Steps to reproduce\r\nUse React on Rails and server rendering as shown in the below file for the app. This SPA with react-router is rendered under Rails routes that start with `/browse`. So that is the \"basename\". The problem is that the location has to strip the basename.\r\n\r\n```js\r\nimport React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { StaticRouter } from 'react-router';\r\n\r\nimport BrowseRoutes from './components/BrowseRoutes';\r\n\r\nconst basename = '/browse';\r\nconst basenameRegexp = new RegExp(`^${basename}`);\r\n\r\nconst BrowseApp = (props, railsContext) => {\r\n  const { location: loc } = railsContext;\r\n  const context = {};\r\n\r\n  let relativeLocation = loc.replace(basenameRegexp, '');\r\n  if (relativeLocation.length === 0) {\r\n    relativeLocation = '/';\r\n  }\r\n\r\n  const markup = renderToString(\r\n    <StaticRouter\r\n      location={relativeLocation}\r\n      context={context}\r\n      basename={basename}\r\n    >\r\n      <BrowseRoutes {...props} />\r\n    </StaticRouter>,\r\n  );\r\n\r\n  // the result will tell you if it redirected, if so, we ignore\r\n  // the markup and send a proper redirect.\r\n  if (context.url) {\r\n    return { redirectLocation: context.url };\r\n  }\r\n  return { renderedHtml: markup };\r\n};\r\n\r\nexport default BrowseApp;\r\n```\r\n\r\n## Expected Behavior\r\n\r\nYou should not have to remove the basename from the location every time. In other words, the location should contain the basename.\r\n\r\n\r\n## Actual Behavior\r\n\r\nI have to remove the basename from the location every time.\r\n","closed_by":{"login":"mjackson","id":92839,"node_id":"MDQ6VXNlcjkyODM5","avatar_url":"https://avatars.githubusercontent.com/u/92839?v=4","gravatar_id":"","url":"https://api.github.com/users/mjackson","html_url":"https://github.com/mjackson","followers_url":"https://api.github.com/users/mjackson/followers","following_url":"https://api.github.com/users/mjackson/following{/other_user}","gists_url":"https://api.github.com/users/mjackson/gists{/gist_id}","starred_url":"https://api.github.com/users/mjackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mjackson/subscriptions","organizations_url":"https://api.github.com/users/mjackson/orgs","repos_url":"https://api.github.com/users/mjackson/repos","events_url":"https://api.github.com/users/mjackson/events{/privacy}","received_events_url":"https://api.github.com/users/mjackson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/remix-run/react-router/issues/4443/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/remix-run/react-router/issues/4443/timeline","performed_via_github_app":null,"state_reason":"completed"}