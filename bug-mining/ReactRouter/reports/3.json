{"url":"https://api.github.com/repos/remix-run/react-router/issues/3316","repository_url":"https://api.github.com/repos/remix-run/react-router","labels_url":"https://api.github.com/repos/remix-run/react-router/issues/3316/labels{/name}","comments_url":"https://api.github.com/repos/remix-run/react-router/issues/3316/comments","events_url":"https://api.github.com/repos/remix-run/react-router/issues/3316/events","html_url":"https://github.com/remix-run/react-router/issues/3316","id":148485633,"node_id":"MDU6SXNzdWUxNDg0ODU2MzM=","number":3316,"title":"Provide component middleware helper and documentation","user":{"login":"ryanflorence","id":100200,"node_id":"MDQ6VXNlcjEwMDIwMA==","avatar_url":"https://avatars.githubusercontent.com/u/100200?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanflorence","html_url":"https://github.com/ryanflorence","followers_url":"https://api.github.com/users/ryanflorence/followers","following_url":"https://api.github.com/users/ryanflorence/following{/other_user}","gists_url":"https://api.github.com/users/ryanflorence/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanflorence/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanflorence/subscriptions","organizations_url":"https://api.github.com/users/ryanflorence/orgs","repos_url":"https://api.github.com/users/ryanflorence/repos","events_url":"https://api.github.com/users/ryanflorence/events{/privacy}","received_events_url":"https://api.github.com/users/ryanflorence/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":100166617,"node_id":"MDU6TGFiZWwxMDAxNjY2MTc=","url":"https://api.github.com/repos/remix-run/react-router/labels/feature-request","name":"feature-request","color":"84b6eb","default":false,"description":"Used to close PRs that haven't gone through/been accepted the Proposal process yet"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2016-04-14T21:22:53Z","updated_at":"2019-01-22T03:25:04Z","closed_at":"2016-04-16T02:08:13Z","author_association":"MEMBER","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I cooked this up a little bit ago and I really like it:\n\nhttps://github.com/ryanflorence/react-router-apply-middleware\n\nRouter middleware can be really powerful, but it's tricky to build it in a way that makes it composable with other middleware because you have to compose both the `render` prop and the `createElement` prop, for example, to compose just three middleware together it would look like this:\n\n``` js\n<Router\n  render={(props) => (\n    <AsyncPropsRootContainer {...props}\n      render={(props) => (\n        <NamedRoutesRootContainer {...props}\n          render={(props) => (\n            <RelativeLinksRootContainer {...props}\n              createElement={(Component, props) => (\n                <AsyncPropsContainer Component={Component} routerProps={props} loadContext={token}\n                  createElement={(Component, props) => (\n                    <RelativeLinksContainer Component={Component} routerProps={props}/>\n                  )}\n                />\n              )}\n            />\n          )}\n        />\n      )}\n    />\n  )}\n/>\n```\n\nAll the `renders` go first, then all the `createElements` go into the last `render` in the chain, and each has to work as the first, last, or middle in the chain. And so you have to hope that the authors of all three did everything right w/ their own `render` and `createElement` props. They'd all have to do the exact same thing.\n\nThis API looks a little crazy when used like this, but I don't think that means the router has a bad extension API--I think it's solid--but we can definitely clean up the front-door to it.\n\n`applyRouterMiddleware` makes middleware composable by default and much simpler for both the authors and consumers:\n\nConsumers have way less to do now:\n\n``` js\nconst render = applyMiddleware(\n  useAsyncProps({ loadContext: { token } }),\n  useNamedRoutes(),\n  useRelativeLinks()\n)\n<Router render={render}/>\n```\n\nIt's also pretty easy for middleware authors. A middleware is just a function that provides an object with two render methods, one for `render` and one for `createElement`.\n\n``` js\nconst useFoo = () => ({\n  // same signature as Router.props.render\n  renderRootContainer: (renderProps) => (\n    <FooRootContainer {...renderProps}/>\n  ),\n\n  // same signature as Router.props.createElement\n  renderContainer: (Component, props) => (  \n    <FooContainer Component={Component} routerProps={props}/>\n  )\n})\n```\n\nThen `applyMiddleware` takes all of those elements and creates that mess from earlier. Authors no longer have to provide `render` and `createElement` props or even think about how to compose w/ others, they just have to worry about what their components do.\n\nI'm undecided on the method names. I picked `renderRootContainer` and `renderContainer` because when I author middleware I usually use a `RootContainer` in `render` and a `Container` in `createElement`, maybe they should be `render` and `createElement` so they map exactly to the Router's names for these methods.\n\nI'd like to bring this into core and then document how to author middleware so folks can add whatever middleware they need and have it compose with everybody else's.\n\nThis is a follow up from #2376 \n","closed_by":{"login":"ryanflorence","id":100200,"node_id":"MDQ6VXNlcjEwMDIwMA==","avatar_url":"https://avatars.githubusercontent.com/u/100200?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanflorence","html_url":"https://github.com/ryanflorence","followers_url":"https://api.github.com/users/ryanflorence/followers","following_url":"https://api.github.com/users/ryanflorence/following{/other_user}","gists_url":"https://api.github.com/users/ryanflorence/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanflorence/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanflorence/subscriptions","organizations_url":"https://api.github.com/users/ryanflorence/orgs","repos_url":"https://api.github.com/users/ryanflorence/repos","events_url":"https://api.github.com/users/ryanflorence/events{/privacy}","received_events_url":"https://api.github.com/users/ryanflorence/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/remix-run/react-router/issues/3316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/remix-run/react-router/issues/3316/timeline","performed_via_github_app":null,"state_reason":"completed"}