{"url":"https://api.github.com/repos/nunit/nunit/issues/3215","repository_url":"https://api.github.com/repos/nunit/nunit","labels_url":"https://api.github.com/repos/nunit/nunit/issues/3215/labels{/name}","comments_url":"https://api.github.com/repos/nunit/nunit/issues/3215/comments","events_url":"https://api.github.com/repos/nunit/nunit/issues/3215/events","html_url":"https://github.com/nunit/nunit/issues/3215","id":436385148,"node_id":"MDU6SXNzdWU0MzYzODUxNDg=","number":3215,"title":"Better error message for generic test where type parameter cannot be determined","user":{"login":"mikkelbu","id":1007631,"node_id":"MDQ6VXNlcjEwMDc2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/1007631?v=4","gravatar_id":"","url":"https://api.github.com/users/mikkelbu","html_url":"https://github.com/mikkelbu","followers_url":"https://api.github.com/users/mikkelbu/followers","following_url":"https://api.github.com/users/mikkelbu/following{/other_user}","gists_url":"https://api.github.com/users/mikkelbu/gists{/gist_id}","starred_url":"https://api.github.com/users/mikkelbu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikkelbu/subscriptions","organizations_url":"https://api.github.com/users/mikkelbu/orgs","repos_url":"https://api.github.com/users/mikkelbu/repos","events_url":"https://api.github.com/users/mikkelbu/events{/privacy}","received_events_url":"https://api.github.com/users/mikkelbu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":61608514,"node_id":"MDU6TGFiZWw2MTYwODUxNA==","url":"https://api.github.com/repos/nunit/nunit/labels/is:bug","name":"is:bug","color":"fc2929","default":false,"description":null},{"id":62115649,"node_id":"MDU6TGFiZWw2MjExNTY0OQ==","url":"https://api.github.com/repos/nunit/nunit/labels/good%20first%20issue","name":"good first issue","color":"0052cc","default":true,"description":null},{"id":80842138,"node_id":"MDU6TGFiZWw4MDg0MjEzOA==","url":"https://api.github.com/repos/nunit/nunit/labels/pri:low","name":"pri:low","color":"fef2c0","default":false,"description":null},{"id":634563351,"node_id":"MDU6TGFiZWw2MzQ1NjMzNTE=","url":"https://api.github.com/repos/nunit/nunit/labels/help%20wanted","name":"help wanted","color":"009800","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/nunit/nunit/milestones/38","html_url":"https://github.com/nunit/nunit/milestone/38","labels_url":"https://api.github.com/repos/nunit/nunit/milestones/38/labels","id":5401447,"node_id":"MDk6TWlsZXN0b25lNTQwMTQ0Nw==","number":38,"title":"4.0","description":"The next major version of NUnit.","creator":{"login":"jnm2","id":8040367,"node_id":"MDQ6VXNlcjgwNDAzNjc=","avatar_url":"https://avatars.githubusercontent.com/u/8040367?v=4","gravatar_id":"","url":"https://api.github.com/users/jnm2","html_url":"https://github.com/jnm2","followers_url":"https://api.github.com/users/jnm2/followers","following_url":"https://api.github.com/users/jnm2/following{/other_user}","gists_url":"https://api.github.com/users/jnm2/gists{/gist_id}","starred_url":"https://api.github.com/users/jnm2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnm2/subscriptions","organizations_url":"https://api.github.com/users/jnm2/orgs","repos_url":"https://api.github.com/users/jnm2/repos","events_url":"https://api.github.com/users/jnm2/events{/privacy}","received_events_url":"https://api.github.com/users/jnm2/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":174,"state":"closed","created_at":"2020-05-09T16:22:20Z","updated_at":"2025-02-17T09:44:35Z","due_on":"2023-11-18T08:00:00Z","closed_at":"2023-11-27T08:46:33Z"},"comments":10,"created_at":"2019-04-23T20:53:17Z","updated_at":"2023-10-08T09:15:27Z","closed_at":"2023-05-05T16:14:27Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a corner case that I only ran into in due to work on the analyzers in nunit/nunit.analyzers#54, and my guess is that very few will run into this problem. Nevertheless, I think we could improve the error message, and fix seems simple and safe.\r\n\r\nGiven a generic test method with no parameters we get a failure that is difficult to interpret for the users (see last example below for more detail). E.g. the test\r\n```csharp\r\n        [Test]\r\n        public void TestWithGenericTypeThatFailsWithUnusableMessage<T>()\r\n        {\r\n        }\r\n```\r\nfails with `System.InvalidOperationException : Late bound operations cannot be performed on types or methods for which ContainsGenericParameters is true`.\r\n\r\nI propose that we change the code at https://github.com/nunit/nunit/blob/db5bee0f8bb74d68202377917f6d958c0e139bfd/src/NUnitFramework/framework/Internal/Builders/NUnitTestCaseBuilder.cs#L221-L229 so that we also return ` MarkAsNotRunnable(testMethod, \"Unable to determine type arguments for method\")` if `arglist == null` instead of failing hard later on.\r\n\r\n**Context**\r\nThe following test is executed without problem, as NUnit determines that `int` can be used as `T`.\r\n```csharp\r\n        [TestCase(1, ExpectedResult = 1)]\r\n        public T TestWithGenericTypeThatWorks<T>(T arg1)\r\n        {\r\n            return arg1;\r\n        }\r\n```\r\nBut if we cannot determine the type of `T` using the parameters of the method\r\n```csharp\r\n        [TestCase(1, ExpectedResult = 1)]\r\n        public T TestWithGenericTypeThatFailsWithUsableMessage<T>(int arg1)\r\n        {\r\n            return default(T);\r\n        }\r\n```\r\nthen we mark the test as not runnable with the message `Unable to determine type arguments for method`.\r\n\r\nHowever, if the method does not have any parameters\r\n```csharp\r\n        [Test]\r\n        public void TestWithGenericTypeThatFailsWithUnusableMessage<T>()\r\n        {\r\n        }\r\n```\r\nthen we fail with the message `System.InvalidOperationException : Late bound operations cannot be performed on types or methods for which ContainsGenericParameters is true.` and a stacktrace\r\n```\r\nat System.Reflection.RuntimeMethodInfo.ThrowNoInvokeException()\r\n   at System.Reflection.RuntimeMethodInfo.InvokeArgumentsCheck(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)\r\n   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)\r\n   at NUnit.Framework.Internal.Reflect.InvokeMethod(MethodInfo method, Object fixture, Object[] args) in C:\\src\\nunit\\nunit\\src\\NUnitFramework\\framework\\Internal\\Reflect.cs:line 266\r\n```","closed_by":{"login":"OsirisTerje","id":203432,"node_id":"MDQ6VXNlcjIwMzQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/203432?v=4","gravatar_id":"","url":"https://api.github.com/users/OsirisTerje","html_url":"https://github.com/OsirisTerje","followers_url":"https://api.github.com/users/OsirisTerje/followers","following_url":"https://api.github.com/users/OsirisTerje/following{/other_user}","gists_url":"https://api.github.com/users/OsirisTerje/gists{/gist_id}","starred_url":"https://api.github.com/users/OsirisTerje/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OsirisTerje/subscriptions","organizations_url":"https://api.github.com/users/OsirisTerje/orgs","repos_url":"https://api.github.com/users/OsirisTerje/repos","events_url":"https://api.github.com/users/OsirisTerje/events{/privacy}","received_events_url":"https://api.github.com/users/OsirisTerje/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nunit/nunit/issues/3215/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nunit/nunit/issues/3215/timeline","performed_via_github_app":null,"state_reason":"completed"}