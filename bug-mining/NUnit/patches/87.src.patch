diff --git a/src/NUnitEngine/nunit.engine.tests/ResultHelperTests.cs b/src/NUnitEngine/nunit.engine.tests/ResultHelperTests.cs
index b40eb0b74..835fef2b5 100644
--- a/src/NUnitEngine/nunit.engine.tests/ResultHelperTests.cs
+++ b/src/NUnitEngine/nunit.engine.tests/ResultHelperTests.cs
@@ -113,26 +113,5 @@ namespace NUnit.Engine.Internal.Tests
             Assert.That(combined.Attributes["skipped"].Value, Is.EqualTo("2"));
             Assert.That(combined.Attributes["asserts"].Value, Is.EqualTo("93"));
         }
-
-        [Test]
-        public void InsertEnvironmentElement()
-        {
-            result1.Xml.InsertEnvironmentElement();
-
-            var env = result1.Xml.SelectSingleNode("environment");
-            Assert.NotNull(env);
-
-            Assert.NotNull(env.GetAttribute("nunit-version"));
-            Assert.NotNull(env.GetAttribute("clr-version"));
-            Assert.NotNull(env.GetAttribute("os-version"));
-            Assert.NotNull(env.GetAttribute("platform"));
-            Assert.NotNull(env.GetAttribute("cwd"));
-            Assert.NotNull(env.GetAttribute("machine-name"));
-            Assert.NotNull(env.GetAttribute("user"));
-            Assert.NotNull(env.GetAttribute("user-domain"));
-            Assert.NotNull(env.GetAttribute("culture"));
-            Assert.NotNull(env.GetAttribute("uiculture"));
-            Assert.NotNull(env.GetAttribute("os-architecture"));
-        }
     }
 }
\ No newline at end of file
diff --git a/src/NUnitEngine/nunit.engine/Internal/ResultHelper.cs b/src/NUnitEngine/nunit.engine/Internal/ResultHelper.cs
index 2db94249f..56e5a65a0 100644
--- a/src/NUnitEngine/nunit.engine/Internal/ResultHelper.cs
+++ b/src/NUnitEngine/nunit.engine/Internal/ResultHelper.cs
@@ -104,77 +104,6 @@ namespace NUnit.Engine.Internal
 
         #endregion
 
-        #region XmlNode extension methods
-
-        /// <summary>
-        /// Insert an environment element as a child of the node provided.
-        /// </summary>
-        /// <param name="resultNode">The node under which the environment element is placed.</param>
-        public static void InsertEnvironmentElement(this XmlNode resultNode)
-        {
-            XmlNode env = resultNode.OwnerDocument.CreateElement("environment");
-            resultNode.InsertAfter(env, null);
-            env.AddAttribute("nunit-version", Assembly.GetExecutingAssembly().GetName().Version.ToString());
-            env.AddAttribute("clr-version", Environment.Version.ToString());
-            env.AddAttribute("os-version", Environment.OSVersion.ToString());
-            env.AddAttribute("platform", Environment.OSVersion.Platform.ToString());
-            env.AddAttribute("cwd", Environment.CurrentDirectory);
-            env.AddAttribute("machine-name", Environment.MachineName);
-            env.AddAttribute("user", Environment.UserName);
-            env.AddAttribute("user-domain", Environment.UserDomainName);
-            env.AddAttribute("culture", CultureInfo.CurrentCulture.ToString());
-            env.AddAttribute("uiculture", CultureInfo.CurrentUICulture.ToString());
-            env.AddAttribute("os-architecture", GetProcessorArchitecture());
-        }
-
-        private static string GetProcessorArchitecture() {
-            return IntPtr.Size == 8 ? "x64" : "x86";
-        }
-
-        public static void InsertCommandLineElement(this XmlNode resultNode)
-        {
-            var doc = resultNode.OwnerDocument;
-
-            XmlNode cmd = doc.CreateElement("command-line");
-            resultNode.InsertAfter(cmd, null);
-
-            var cdata = doc.CreateCDataSection(Environment.CommandLine);
-            cmd.AppendChild(cdata);
-        }
-
-        public static void InsertSettingsElement(this XmlNode resultNode, IDictionary<string,object> settings)
-        {
-            var doc = resultNode.OwnerDocument;
-
-            XmlNode settingsNode = doc.CreateElement("settings");
-            resultNode.InsertAfter(settingsNode, null);
-
-            foreach (string name in settings.Keys)
-            {
-                string value = settings[name].ToString();
-                XmlNode settingNode = doc.CreateElement("setting");
-                settingNode.AddAttribute("name", name);
-                settingNode.AddAttribute("value", value);
-                settingsNode.AppendChild(settingNode);
-            }
-        }
-
-        public static void InsertFilterElement(this XmlNode resultNode, TestFilter filter)
-        {
-            // Convert the filter to an XmlNode
-            var tempNode = XmlHelper.CreateXmlNode(filter.Text);
-
-            // Don't include it if it's an empty filter
-            if (tempNode.ChildNodes.Count > 0)
-            {
-                var doc = resultNode.OwnerDocument;
-                var filterElement = doc.ImportNode(tempNode, true);
-                resultNode.InsertAfter(filterElement, null);
-            }
-        }
-
-        #endregion
-
         #region Methods that operate on a list of XmlNodes
 
         /// <summary>
diff --git a/src/NUnitEngine/nunit.engine/Runners/MasterTestRunner.cs b/src/NUnitEngine/nunit.engine/Runners/MasterTestRunner.cs
index e288e9691..406e2e1e4 100644
--- a/src/NUnitEngine/nunit.engine/Runners/MasterTestRunner.cs
+++ b/src/NUnitEngine/nunit.engine/Runners/MasterTestRunner.cs
@@ -25,6 +25,7 @@ using System;
 using System.Collections.Generic;
 using System.Diagnostics;
 using System.Globalization;
+using System.Reflection;
 using System.Xml;
 using NUnit.Common;
 using NUnit.Engine.Internal;
@@ -39,45 +40,6 @@ namespace NUnit.Engine.Runners
 
         public bool IsTestRunning { get; private set; }
 
-        /// <summary>
-        /// Gets a dictionary of the package settings with defaults resolved by the engine.
-        /// </summary>
-        public IDictionary<string, object> EffectiveSettings
-        {
-            get 
-            {
-                if (_effectiveSettings == null)
-                {
-                    _effectiveSettings = new Dictionary<string, object>();
-                    foreach (string key in TestPackage.Settings.Keys)
-                        _effectiveSettings.Add(key, TestPackage.Settings[key]);
-
-                    bool processModelSpecified = _effectiveSettings.ContainsKey(PackageSettings.ProcessModel);
-                    string processModel = processModelSpecified
-                        ? (string)_effectiveSettings[PackageSettings.ProcessModel]
-                        : TestPackage.SubPackages.Count > 1
-                            ? "Multiple"
-                            : "Separate";
-
-                    if (!processModelSpecified)
-                        _effectiveSettings.Add(PackageSettings.ProcessModel, processModel);
-
-                    if (!_effectiveSettings.ContainsKey(PackageSettings.DomainUsage))
-                    {
-                        string domainUsage = processModel == "Multiple" || TestPackage.SubPackages.Count <= 1 ? "Single" : "Multiple";
-                        _effectiveSettings.Add(PackageSettings.DomainUsage, domainUsage);
-                    }
-
-                    // This incorporates knowledge of the NUNit 3.0 frameowrk.
-                    if (!_effectiveSettings.ContainsKey(PackageSettings.NumberOfTestWorkers))
-                        _effectiveSettings.Add(PackageSettings.NumberOfTestWorkers, Math.Max(Environment.ProcessorCount, 2));
-                }
-
-                return _effectiveSettings; 
-            }
-        }
-        private Dictionary<string, object> _effectiveSettings;
-
         #region AbstractTestRunner Overrides
 
         /// <summary>
@@ -146,10 +108,11 @@ namespace NUnit.Engine.Runners
             TestEngineResult result = _realRunner.Run(listener, filter).Aggregate("test-run", TestPackage.Name, TestPackage.FullName);
 
             // These are inserted in reverse order, since each is added as the first child.
-            result.Xml.InsertFilterElement(filter);
-            result.Xml.InsertSettingsElement(EffectiveSettings);
-            result.Xml.InsertCommandLineElement();
-            result.Xml.InsertEnvironmentElement();
+            InsertFilterElement(result.Xml, filter);
+            InsertCommandLineElement(result.Xml);
+
+            result.Xml.AddAttribute("engine-version", Assembly.GetExecutingAssembly().GetName().Version.ToString());
+            result.Xml.AddAttribute("clr-version", Environment.Version.ToString());
 
             double duration = (double)(Stopwatch.GetTimestamp() - startTicks) / Stopwatch.Frequency;
             result.Xml.AddAttribute("start-time", XmlConvert.ToString(startTime, "u"));
@@ -280,6 +243,48 @@ namespace NUnit.Engine.Runners
             }
         }
 
+        private static void InsertCommandLineElement(XmlNode resultNode)
+        {
+            var doc = resultNode.OwnerDocument;
+
+            XmlNode cmd = doc.CreateElement("command-line");
+            resultNode.InsertAfter(cmd, null);
+
+            var cdata = doc.CreateCDataSection(Environment.CommandLine);
+            cmd.AppendChild(cdata);
+        }
+
+        private static void InsertSettingsElement(XmlNode resultNode, IDictionary<string, object> settings)
+        {
+            var doc = resultNode.OwnerDocument;
+
+            XmlNode settingsNode = doc.CreateElement("settings");
+            resultNode.InsertAfter(settingsNode, null);
+
+            foreach (string name in settings.Keys)
+            {
+                string value = settings[name].ToString();
+                XmlNode settingNode = doc.CreateElement("setting");
+                settingNode.AddAttribute("name", name);
+                settingNode.AddAttribute("value", value);
+                settingsNode.AppendChild(settingNode);
+            }
+        }
+
+        private static void InsertFilterElement(XmlNode resultNode, TestFilter filter)
+        {
+            // Convert the filter to an XmlNode
+            var tempNode = XmlHelper.CreateXmlNode(filter.Text);
+
+            // Don't include it if it's an empty filter
+            if (tempNode.ChildNodes.Count > 0)
+            {
+                var doc = resultNode.OwnerDocument;
+                var filterElement = doc.ImportNode(tempNode, true);
+                resultNode.InsertAfter(filterElement, null);
+            }
+        }
+
         #endregion
     }
 }
diff --git a/src/NUnitFramework/framework/Api/FrameworkController.cs b/src/NUnitFramework/framework/Api/FrameworkController.cs
index 9e2c56a11..9adf6f65c 100644
--- a/src/NUnitFramework/framework/Api/FrameworkController.cs
+++ b/src/NUnitFramework/framework/Api/FrameworkController.cs
@@ -23,7 +23,9 @@
 
 using System;
 using System.Collections;
+using System.Collections.Generic;
 using System.Diagnostics;
+using System.Globalization;
 using System.IO;
 using System.Reflection;
 using System.Web.UI;
@@ -203,13 +205,19 @@ namespace NUnit.Framework.Api
         {
             Guard.ArgumentNotNull(filter, "filter");
 
-            ITestResult result = Runner.Run(new TestProgressReporter(handler), TestFilter.FromXml(filter));
+            TNode result = Runner.Run(new TestProgressReporter(handler), TestFilter.FromXml(filter)).ToXml(true);
+
+            // Insert elements as first child in reverse order
+            InsertSettingsElement(result);
+#if !PORTABLE && !SILVERLIGHT
+            InsertEnvironmentElement(result);
+#endif
 
             // Ensure that the CallContext of the thread is not polluted
             // by our TestExecutionContext, which is not serializable.
             TestExecutionContext.ClearCurrentContext();
 
-            handler.RaiseCallbackEvent(result.ToXml(true).OuterXml);
+            handler.RaiseCallbackEvent(result.OuterXml);
         }
 
         private void RunAsync(ICallbackEventHandler handler, string filter)
@@ -232,6 +240,63 @@ namespace NUnit.Framework.Api
             handler.RaiseCallbackEvent(count.ToString());
         }
 
+#if !PORTABLE && !SILVERLIGHT
+        private TNode InsertEnvironmentElement(TNode targetNode)
+        {
+            TNode env = new TNode("environment");
+            targetNode.ChildNodes.Insert(0, env);
+
+            env.AddAttribute("framework-version", Assembly.GetExecutingAssembly().GetName().Version.ToString());
+            env.AddAttribute("clr-version", Environment.Version.ToString());
+            env.AddAttribute("os-version", Environment.OSVersion.ToString());
+            env.AddAttribute("platform", Environment.OSVersion.Platform.ToString());
+#if !NETCF
+            env.AddAttribute("cwd", Environment.CurrentDirectory);
+            env.AddAttribute("machine-name", Environment.MachineName);
+            env.AddAttribute("user", Environment.UserName);
+            env.AddAttribute("user-domain", Environment.UserDomainName);
+#endif
+            env.AddAttribute("culture", CultureInfo.CurrentCulture.ToString());
+            env.AddAttribute("uiculture", CultureInfo.CurrentUICulture.ToString());
+            env.AddAttribute("os-architecture", GetProcessorArchitecture());
+
+            return env;
+        }
+
+        private static string GetProcessorArchitecture()
+        {
+            return IntPtr.Size == 8 ? "x64" : "x86";
+        }
+#endif
+
+        private TNode InsertSettingsElement(TNode targetNode)
+        {
+            TNode settingsNode = new TNode("settings");
+            targetNode.ChildNodes.Insert(0, settingsNode);
+
+            foreach (string key in Settings.Keys)
+                AddSetting(settingsNode, key, Settings[key]);
+
+            // Add default values for display
+            if (!Settings.Contains(PackageSettings.NumberOfTestWorkers))
+#if NETCF
+                AddSetting(settingsNode, PackageSettings.NumberOfTestWorkers, 2);
+#else
+                AddSetting(settingsNode, PackageSettings.NumberOfTestWorkers, Math.Max(Environment.ProcessorCount, 2));
+#endif
+
+                return settingsNode;
+        }
+
+        private void AddSetting(TNode settingsNode, string name, object value)
+        {
+            TNode setting = new TNode("setting");
+            setting.AddAttribute("name", name);
+            setting.AddAttribute("value", value.ToString());
+
+            settingsNode.ChildNodes.Add(setting);
+        }
+
         #endregion
 
         #region Nested Action Classes
