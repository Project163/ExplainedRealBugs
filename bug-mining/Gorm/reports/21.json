{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3432","repository_url":"https://api.github.com/repos/go-gorm/gorm","labels_url":"https://api.github.com/repos/go-gorm/gorm/issues/3432/labels{/name}","comments_url":"https://api.github.com/repos/go-gorm/gorm/issues/3432/comments","events_url":"https://api.github.com/repos/go-gorm/gorm/issues/3432/events","html_url":"https://github.com/go-gorm/gorm/issues/3432","id":696195079,"node_id":"MDU6SXNzdWU2OTYxOTUwNzk=","number":3432,"title":"AutoMigrate does not close sql.Rows when retrieving the schema","user":{"login":"jsternberg","id":1212129,"node_id":"MDQ6VXNlcjEyMTIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/1212129?v=4","gravatar_id":"","url":"https://api.github.com/users/jsternberg","html_url":"https://github.com/jsternberg","followers_url":"https://api.github.com/users/jsternberg/followers","following_url":"https://api.github.com/users/jsternberg/following{/other_user}","gists_url":"https://api.github.com/users/jsternberg/gists{/gist_id}","starred_url":"https://api.github.com/users/jsternberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jsternberg/subscriptions","organizations_url":"https://api.github.com/users/jsternberg/orgs","repos_url":"https://api.github.com/users/jsternberg/repos","events_url":"https://api.github.com/users/jsternberg/events{/privacy}","received_events_url":"https://api.github.com/users/jsternberg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2173942900,"node_id":"MDU6TGFiZWwyMTczOTQyOTAw","url":"https://api.github.com/repos/go-gorm/gorm/labels/type:with%20reproduction%20steps","name":"type:with reproduction steps","color":"00ff00","default":false,"description":"with reproduction steps"}],"state":"closed","locked":false,"assignee":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2020-09-08T21:39:25Z","updated_at":"2020-09-09T03:04:30Z","closed_at":"2020-09-09T03:04:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## GORM Playground Link\r\n\r\n<!--\r\nYour issue *have to* include a GORM Playground Pull Request Link that can reproduce the bug, refer: https://github.com/go-gorm/playground\r\n\r\nChange following URL to your link\r\n-->\r\n\r\nhttps://github.com/go-gorm/playground/pull/122\r\n\r\n## Description\r\n\r\n<!-- Your use case -->\r\n\r\nThis happens when `AutoMigrate()` is run on a database that already has data. The `AutoMigrate()` function attempts to discover the schema and it runs a `select * from <table>` query and then reads the column tables. It never reads any of the data and does not close the rows. The database drivers keep this connection open indefinitely until the application is shutdown. This causes an application that uses `AutoMigrate()` to keep open `N+1` connections at a minimum with `N` being the number of tables in the database. The `N` connections are never recycled.\r\n\r\nThis only appears to be an issue if there is data present in the database. When no data is present, the connection immediately closes and the connection is not leaked.","closed_by":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gorm/gorm/issues/3432/timeline","performed_via_github_app":null,"state_reason":"completed"}