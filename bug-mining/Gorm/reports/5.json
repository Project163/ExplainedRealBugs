{"url":"https://api.github.com/repos/go-gorm/gorm/issues/723","repository_url":"https://api.github.com/repos/go-gorm/gorm","labels_url":"https://api.github.com/repos/go-gorm/gorm/issues/723/labels{/name}","comments_url":"https://api.github.com/repos/go-gorm/gorm/issues/723/comments","events_url":"https://api.github.com/repos/go-gorm/gorm/issues/723/events","html_url":"https://github.com/go-gorm/gorm/issues/723","id":116773041,"node_id":"MDU6SXNzdWUxMTY3NzMwNDE=","number":723,"title":"Race condition in Find","user":{"login":"bodhi","id":28731,"node_id":"MDQ6VXNlcjI4NzMx","avatar_url":"https://avatars.githubusercontent.com/u/28731?v=4","gravatar_id":"","url":"https://api.github.com/users/bodhi","html_url":"https://github.com/bodhi","followers_url":"https://api.github.com/users/bodhi/followers","following_url":"https://api.github.com/users/bodhi/following{/other_user}","gists_url":"https://api.github.com/users/bodhi/gists{/gist_id}","starred_url":"https://api.github.com/users/bodhi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bodhi/subscriptions","organizations_url":"https://api.github.com/users/bodhi/orgs","repos_url":"https://api.github.com/users/bodhi/repos","events_url":"https://api.github.com/users/bodhi/events{/privacy}","received_events_url":"https://api.github.com/users/bodhi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-11-13T13:59:27Z","updated_at":"2015-12-24T00:22:40Z","closed_at":"2015-12-24T00:22:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Seen on 611e613459953787a01c2afc82835aa0ba01a045. With `users` table on local Postgres (but actually happens with any struct, backing SQL table not required).\n\n`t.go`:\n\n``` go\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    _ \"github.com/lib/pq\"\n\n    \"github.com/jinzhu/gorm\"\n)\n\nvar db gorm.DB\n\ntype User struct{}\n\nfunc find() {\n    var u User\n    fmt.Println(db.Find(&u, 1).Error)\n}\n\nfunc main() {\n    var err error\n    db, err = gorm.Open(\"postgres\", os.Getenv(\"DB\"))\n    if err != nil {\n        panic(err)\n    }\n\n    go find()\n    find()\n}\n```\n\n```\nbodhi$ ./e_d go run -race t.go \n==================\nWARNING: DATA RACE\nWrite by main goroutine:\n  github.com/jinzhu/gorm.(*Scope).GetModelStruct()\n      $GOPATH/src/github.com/jinzhu/gorm/model_struct.go:393 +0x13d3\n  github.com/jinzhu/gorm.(*Scope).TableName()\n      $GOPATH/src/github.com/jinzhu/gorm/scope.go:282 +0x2a6\n  github.com/jinzhu/gorm.(*Scope).QuotedTableName()\n      $GOPATH/src/github.com/jinzhu/gorm/scope.go:292 +0x1e2\n  github.com/jinzhu/gorm.(*Scope).prepareQuerySql()\n      $GOPATH/src/github.com/jinzhu/gorm/scope_private.go:305 +0x19a\n  github.com/jinzhu/gorm.Query()\n      $GOPATH/src/github.com/jinzhu/gorm/callback_query.go:44 +0x6c3\n  github.com/jinzhu/gorm.(*Scope).callCallbacks()\n      $GOPATH/src/github.com/jinzhu/gorm/scope_private.go:319 +0x98\n  github.com/jinzhu/gorm.(*DB).Find()\n      $GOPATH/src/github.com/jinzhu/gorm/main.go:215 +0x102\n  main.find()\n      $GOPATH/src/github.com/theplant/hsm2-backend/t.go:18 +0x165\n  main.main()\n      $GOPATH/src/github.com/theplant/hsm2-backend/t.go:29 +0x252\n\nPrevious read by goroutine 7:\n  github.com/jinzhu/gorm.(*Scope).TableName()\n      $GOPATH/src/github.com/jinzhu/gorm/scope.go:282 +0x323\n  github.com/jinzhu/gorm.(*Scope).QuotedTableName()\n      $GOPATH/src/github.com/jinzhu/gorm/scope.go:292 +0x1e2\n  github.com/jinzhu/gorm.(*Scope).prepareQuerySql()\n      $GOPATH/src/github.com/jinzhu/gorm/scope_private.go:305 +0x19a\n  github.com/jinzhu/gorm.Query()\n      $GOPATH/src/github.com/jinzhu/gorm/callback_query.go:44 +0x6c3\n  github.com/jinzhu/gorm.(*Scope).callCallbacks()\n      $GOPATH/src/github.com/jinzhu/gorm/scope_private.go:319 +0x98\n  github.com/jinzhu/gorm.(*DB).Find()\n      $GOPATH/src/github.com/jinzhu/gorm/main.go:215 +0x102\n  main.find()\n      $GOPATH/src/github.com/theplant/hsm2-backend/t.go:18 +0x165\n\nGoroutine 7 (running) created at:\n  main.main()\n      $GOPATH/src/github.com/theplant/hsm2-backend/t.go:28 +0x24c\n==================\npq: zero-length delimited identifier at or near \"\"\"\"\n\n(pq: zero-length delimited identifier at or near \"\"\"\") \n[2015-11-14 00:52:52]  \npq: zero-length delimited identifier at or near \"\"\"\"\nFound 1 data race(s)\nexit status 66\n```\n","closed_by":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gorm/gorm/issues/723/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gorm/gorm/issues/723/timeline","performed_via_github_app":null,"state_reason":"completed"}