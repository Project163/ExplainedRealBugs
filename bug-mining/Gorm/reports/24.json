{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3720","repository_url":"https://api.github.com/repos/go-gorm/gorm","labels_url":"https://api.github.com/repos/go-gorm/gorm/issues/3720/labels{/name}","comments_url":"https://api.github.com/repos/go-gorm/gorm/issues/3720/comments","events_url":"https://api.github.com/repos/go-gorm/gorm/issues/3720/events","html_url":"https://github.com/go-gorm/gorm/issues/3720","id":736176126,"node_id":"MDU6SXNzdWU3MzYxNzYxMjY=","number":3720,"title":"Soft delete with Where and without PK updating soft deleted records","user":{"login":"Hellysonrp","id":5438762,"node_id":"MDQ6VXNlcjU0Mzg3NjI=","avatar_url":"https://avatars.githubusercontent.com/u/5438762?v=4","gravatar_id":"","url":"https://api.github.com/users/Hellysonrp","html_url":"https://github.com/Hellysonrp","followers_url":"https://api.github.com/users/Hellysonrp/followers","following_url":"https://api.github.com/users/Hellysonrp/following{/other_user}","gists_url":"https://api.github.com/users/Hellysonrp/gists{/gist_id}","starred_url":"https://api.github.com/users/Hellysonrp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hellysonrp/subscriptions","organizations_url":"https://api.github.com/users/Hellysonrp/orgs","repos_url":"https://api.github.com/users/Hellysonrp/repos","events_url":"https://api.github.com/users/Hellysonrp/events{/privacy}","received_events_url":"https://api.github.com/users/Hellysonrp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2173942900,"node_id":"MDU6TGFiZWwyMTczOTQyOTAw","url":"https://api.github.com/repos/go-gorm/gorm/labels/type:with%20reproduction%20steps","name":"type:with reproduction steps","color":"00ff00","default":false,"description":"with reproduction steps"}],"state":"closed","locked":false,"assignee":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-11-04T14:50:08Z","updated_at":"2020-11-05T03:20:30Z","closed_at":"2020-11-05T03:20:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## GORM Playground Link\r\n\r\n<!--\r\nYour issue *have to* include a GORM Playground Pull Request Link that can reproduce the bug, which is important to help others understand your issue effectively and make sure the issue hasn't been fixed on latest master, refer: https://github.com/go-gorm/playground\r\n\r\nChange following URL to your link\r\n-->\r\n\r\nhttps://github.com/go-gorm/playground/pull/199\r\n\r\n## Description\r\n\r\nIf we want to delete, for example, every `Pet` from a `User`, we'd do something like this:\r\n\r\n```go\r\nDB.Where(Pet{UserID: &user.ID}).Delete(Pet{})\r\n```\r\n\r\nThe resulting SQL would be something like this:\r\n\r\n```sql\r\nUPDATE `pets` SET `deleted_at`=\"2020-11-04 11:28:09.499\" WHERE `pets`.`user_id` = 1\r\n```\r\n\r\nNote that ALL pets with `user_id = 1` will have its `deleted_at` field updated, including already soft deleted records.\r\nMy suggestion is to add the `DeletedAt` in the `WHERE` clause, resulting in something like this:\r\n\r\n```sql\r\nUPDATE `pets` SET `deleted_at`=\"2020-11-04 11:28:09.499\" WHERE `pets`.`user_id` = 1 AND `deleted_at` IS NULL\r\n```\r\n\r\nIn my opinion, even if the primary key is informed, if the record is already soft deleted, the `deleted_at` field must not be updated.","closed_by":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gorm/gorm/issues/3720/timeline","performed_via_github_app":null,"state_reason":"completed"}