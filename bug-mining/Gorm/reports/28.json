{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3890","repository_url":"https://api.github.com/repos/go-gorm/gorm","labels_url":"https://api.github.com/repos/go-gorm/gorm/issues/3890/labels{/name}","comments_url":"https://api.github.com/repos/go-gorm/gorm/issues/3890/comments","events_url":"https://api.github.com/repos/go-gorm/gorm/issues/3890/events","html_url":"https://github.com/go-gorm/gorm/issues/3890","id":775088779,"node_id":"MDU6SXNzdWU3NzUwODg3Nzk=","number":3890,"title":"GORM doesn't fill the foreign key id when doing an insert into","user":{"login":"invasionofsmallcubes","id":2406829,"node_id":"MDQ6VXNlcjI0MDY4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/2406829?v=4","gravatar_id":"","url":"https://api.github.com/users/invasionofsmallcubes","html_url":"https://github.com/invasionofsmallcubes","followers_url":"https://api.github.com/users/invasionofsmallcubes/followers","following_url":"https://api.github.com/users/invasionofsmallcubes/following{/other_user}","gists_url":"https://api.github.com/users/invasionofsmallcubes/gists{/gist_id}","starred_url":"https://api.github.com/users/invasionofsmallcubes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/invasionofsmallcubes/subscriptions","organizations_url":"https://api.github.com/users/invasionofsmallcubes/orgs","repos_url":"https://api.github.com/users/invasionofsmallcubes/repos","events_url":"https://api.github.com/users/invasionofsmallcubes/events{/privacy}","received_events_url":"https://api.github.com/users/invasionofsmallcubes/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2346753561,"node_id":"MDU6TGFiZWwyMzQ2NzUzNTYx","url":"https://api.github.com/repos/go-gorm/gorm/labels/type:invalid%20question","name":"type:invalid question","color":"CF2E1F","default":false,"description":"invalid question (not related to GORM or described in document or not enough information provided)"}],"state":"closed","locked":false,"assignee":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":11,"created_at":"2020-12-27T18:44:17Z","updated_at":"2022-02-24T11:18:22Z","closed_at":"2020-12-28T09:58:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Your Question\r\n\r\nI'm having some issues with GORM.\r\nI have the following structs:\r\n\r\n```\r\ntype Player struct {\r\n\tID                       uint `gorm:\"primarykey\"`\r\n\tClubID                   uint\r\n\tClub                     Club\r\n}\r\ntype Club struct {\r\n\tID   uint `gorm:\"primarykey\"`\r\n\tName string `gorm:\"unique\"`\r\n}\r\n```\r\n\r\nI'm loading this info from a file, something like:\r\n\r\n```\r\nfunc TestSQLite(t *testing.T) {\r\n\r\n\tpr, err := db.Init(\"file:memdb1?mode=memory&cache=shared\")\r\n\tif err != nil {\r\n\t\tfmt.Println(\"Error on Init: \" + err.Error())\r\n\t\tt.Fail()\r\n\t}\r\n\r\n\tp := domain.Player{\r\n\t\tClub: domain.Club{Name: \"Hello\"},\r\n\t\tShooting: 23,\r\n\t\tPlayerPositions: []domain.Position{\r\n\t\t\t{\r\n\t\t\t\tName: \"SM\",\r\n\t\t\t},\r\n\t\t},\r\n\t}\r\n\tif err := pr.Create(&p); err != nil {\r\n\t\tfmt.Println(\"Error creating player: \" + err.Error())\r\n\t\tt.Fail()\r\n\t}\r\n\tc := domain.Player{\r\n\t\tClub: domain.Club{Name: \"Hello\"},\r\n\t\tShooting: 23,\r\n\t\tPlayerPositions: []domain.Position{\r\n\t\t\t{\r\n\t\t\t\tName: \"SM\",\r\n\t\t\t},\r\n\t\t},\r\n\t}\r\n\tif err := pr.Create(&c); err != nil {\r\n\t\tfmt.Println(\"Error creating player: \" + err.Error())\r\n\t\tt.Fail()\r\n\t}\r\n\r\n\tt.Logf(\"%d\", p.ClubID)\r\n\tt.Logf(\"%d\", c.ClubID)\r\n\tif c.ClubID != p.ClubID {\r\n\t\tt.Fail()\r\n\t}\r\n}\r\n```\r\n\r\nand as result I have:\r\n\r\n```\r\n    db_test.go:45: 1\r\n    db_test.go:46: 0\r\n```\r\n\r\nCode for Create is \r\n```\r\n\treturn pr.preload().Debug().Create(&p).Error\r\n```\r\n\r\nand preload is\r\n```\r\nfunc (pr *PlayerRepository) preload() *gorm.DB {\r\n\treturn pr.connection.\r\n\t\tPreload(\"Club\")\r\n}\r\n```\r\n\r\nI'm not sure what I'm doing wrong.\r\n\r\nI forgot to add debug information:\r\n\r\n```\r\n=== RUN   TestSQLite\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.059ms] [rows:1] INSERT INTO `clubs` (`name`) VALUES (\"Hello\") ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.032ms] [rows:1] INSERT INTO `positions` (`name`) VALUES (\"KM\") ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.026ms] [rows:1] INSERT INTO `player_positions` (`player_id`,`position_id`) VALUES (1,1) ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.659ms] [rows:1] INSERT INTO `players` (`player_url`,`short_name`,`long_name`,`age`,`date_of_birth`,`height`,`weight`,`nationality_id`,`club_id`,`league_id`,`league_rank`,`overall`,`potential`,`value`,`wage`,`preferred_foot`,`international_reputation`,`weak_foot`,`skill_moves`,`work_rate`,`body_type`,`real_face`,`release_clause_eur`,`team_position_id`,`team_jersey_number`,`loaned_from`,`joined`,`contract_valid_until`,`nation_position_id`,`nation_jersey_number`,`pace`,`shooting`,`passing`,`dribbling`,`defending`,`physic`,`goal_keeper_diving`,`goal_keeper_handling`,`goal_keeper_kicking`,`goal_keeper_reflexes`,`goal_keeper_speed`,`goal_keeper_positioning`,`attacking_crossing`,`attacking_finishing`,`attacking_heading_accuracy`,`attacking_short_passing`,`attacking_volleys`,`skill_dribbling`,`skill_curve`,`skill_fk_accuracy`,`skill_long_passing`,`skill_ball_control`,`movement_acceleration`,`movement_sprint_speed`,`movement_agility`,`movement_reactions`,`movement_balance`,`power_shot_power`,`power_jumping`,`power_stamina`,`power_strength`,`power_long_shots`,`mentality_aggression`,`mentality_interceptions`,`mentality_positioning`,`mentality_vision`,`mentality_penalties`,`mentality_composure`,`defending_marking`,`defending_standing_tackle`,`defending_sliding_tackle`,`goal_keeping_diving`,`goal_keeping_handling`,`goal_keeping_kicking`,`goal_keeping_positioning`,`goal_keeping_reflexes`,`left_striker`,`striker`,`right_striker`,`left_winger`,`left_forward`,`center_forward`,`right_forward`,`right_winger`,`left_attacking_midfielder`,`central_attacking_midfielder`,`right_attacking_midfielder`,`left_midfielder`,`left_centre_midfielder`,`central_midfielder`,`right_centre_midfielder`,`right_midfielder`,`left_wing_back`,`left_defensive_midfielder`,`central_defensive_midfielder`,`right_defensive_midfielder`,`right_wing_back`,`left_back`,`left_center_attack`,`centre_back`,`right_centre_back`,`right_back`) VALUES (\"\",\"\",\"\",0,\"\",0,0,0,1,0,0,0,0,0,0,\"\",\"\",0,0,\"\",\"\",\"\",0,0,0,\"\",\"\",\"\",0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.024ms] [rows:0] INSERT INTO `clubs` (`name`) VALUES (\"Hello\") ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.023ms] [rows:1] INSERT INTO `positions` (`name`) VALUES (\"SM\") ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.026ms] [rows:1] INSERT INTO `player_positions` (`player_id`,`position_id`) VALUES (2,2) ON CONFLICT DO NOTHING\r\n\r\n2020/12/27 19:39:56 /Users/emanuele/personal/roadmap/io/db/db.go:41\r\n[0.396ms] [rows:1] INSERT INTO `players` (`player_url`,`short_name`,`long_name`,`age`,`date_of_birth`,`height`,`weight`,`nationality_id`,`club_id`,`league_id`,`league_rank`,`overall`,`potential`,`value`,`wage`,`preferred_foot`,`international_reputation`,`weak_foot`,`skill_moves`,`work_rate`,`body_type`,`real_face`,`release_clause_eur`,`team_position_id`,`team_jersey_number`,`loaned_from`,`joined`,`contract_valid_until`,`nation_position_id`,`nation_jersey_number`,`pace`,`shooting`,`passing`,`dribbling`,`defending`,`physic`,`goal_keeper_diving`,`goal_keeper_handling`,`goal_keeper_kicking`,`goal_keeper_reflexes`,`goal_keeper_speed`,`goal_keeper_positioning`,`attacking_crossing`,`attacking_finishing`,`attacking_heading_accuracy`,`attacking_short_passing`,`attacking_volleys`,`skill_dribbling`,`skill_curve`,`skill_fk_accuracy`,`skill_long_passing`,`skill_ball_control`,`movement_acceleration`,`movement_sprint_speed`,`movement_agility`,`movement_reactions`,`movement_balance`,`power_shot_power`,`power_jumping`,`power_stamina`,`power_strength`,`power_long_shots`,`mentality_aggression`,`mentality_interceptions`,`mentality_positioning`,`mentality_vision`,`mentality_penalties`,`mentality_composure`,`defending_marking`,`defending_standing_tackle`,`defending_sliding_tackle`,`goal_keeping_diving`,`goal_keeping_handling`,`goal_keeping_kicking`,`goal_keeping_positioning`,`goal_keeping_reflexes`,`left_striker`,`striker`,`right_striker`,`left_winger`,`left_forward`,`center_forward`,`right_forward`,`right_winger`,`left_attacking_midfielder`,`central_attacking_midfielder`,`right_attacking_midfielder`,`left_midfielder`,`left_centre_midfielder`,`central_midfielder`,`right_centre_midfielder`,`right_midfielder`,`left_wing_back`,`left_defensive_midfielder`,`central_defensive_midfielder`,`right_defensive_midfielder`,`right_wing_back`,`left_back`,`left_center_attack`,`centre_back`,`right_centre_back`,`right_back`) VALUES (\"\",\"\",\"\",0,\"\",0,0,0,0,0,0,0,0,0,0,\"\",\"\",0,0,\"\",\"\",\"\",0,0,0,\"\",\"\",\"\",0,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)\r\n--- FAIL: TestSQLite (0.01s)\r\n```\r\n\r\n## The document you expected this should be explained\r\n\r\nhttps://gorm.io/docs/belongs_to.html\r\nor\r\nhttps://gorm.io/docs/create.html\r\n\r\n## Expected answer\r\n\r\nWhat I need to fix to get the expected test to pass.\r\n","closed_by":{"login":"jinzhu","id":6843,"node_id":"MDQ6VXNlcjY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6843?v=4","gravatar_id":"","url":"https://api.github.com/users/jinzhu","html_url":"https://github.com/jinzhu","followers_url":"https://api.github.com/users/jinzhu/followers","following_url":"https://api.github.com/users/jinzhu/following{/other_user}","gists_url":"https://api.github.com/users/jinzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/jinzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinzhu/subscriptions","organizations_url":"https://api.github.com/users/jinzhu/orgs","repos_url":"https://api.github.com/users/jinzhu/repos","events_url":"https://api.github.com/users/jinzhu/events{/privacy}","received_events_url":"https://api.github.com/users/jinzhu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gorm/gorm/issues/3890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gorm/gorm/issues/3890/timeline","performed_via_github_app":null,"state_reason":"completed"}