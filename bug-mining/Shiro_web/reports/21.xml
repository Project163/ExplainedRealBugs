<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:35:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHIRO-312] DefaultSecurityManager.setSessionManager can get out of sync with DefaultSecurityManager.setSessionMode</title>
                <link>https://issues.apache.org/jira/browse/SHIRO-312</link>
                <project id="12310950" key="SHIRO">Shiro</project>
                    <description>&lt;p&gt;So, I&apos;ve run into a bit of a pickle with DefaultWebSecurityManager and&lt;br/&gt;
native vs http sessions.&lt;/p&gt;

&lt;p&gt;The DefaultWebSecurityManager exposes two methods, ostensibly for the&lt;br/&gt;
purposes of determining how sessions are managed:&lt;/p&gt;

&lt;p&gt;setSessionManager(SessionManager)&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;setSessionMode(String)&lt;/p&gt;

&lt;p&gt;However, it would appear that if I call:&lt;/p&gt;

&lt;p&gt;setSessionManager(new MyCustomSessionManager())&lt;/p&gt;

&lt;p&gt;and then&lt;/p&gt;

&lt;p&gt;setSessionMode(&quot;native&quot;)&lt;/p&gt;

&lt;p&gt;the SessionManager is overridden. &lt;/p&gt;

&lt;p&gt;This is a bit of a gotcha, but can be easily avoided by not calling&lt;br/&gt;
setSessionMode.  (calling them in the reverse order seems contrary to&lt;br/&gt;
the nature of setters)  The problem with not calling setSessionMode is&lt;br/&gt;
that it appears to actually matter - if I leave it to it&apos;s default&lt;br/&gt;
(http), but set a DefaultWebSessionManager, then things break horribly&lt;br/&gt;
(apparently due to the use of isHttpSessionMode by AbstractShiroFilter&lt;br/&gt;
for redirect rewriting).  Sessions get forgotten, etc.  This also seems&lt;br/&gt;
contrary to the nature of setters. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12514740">SHIRO-312</key>
            <summary>DefaultSecurityManager.setSessionManager can get out of sync with DefaultSecurityManager.setSessionMode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhazlewood">Les Hazlewood</assignee>
                                    <reporter username="deraj123">Jared Bunting</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2011 03:27:45 +0000</created>
                <updated>Tue, 24 Jan 2012 01:11:42 +0000</updated>
                            <resolved>Fri, 16 Sep 2011 14:54:04 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13068145" author="deraj123" created="Wed, 20 Jul 2011 03:29:17 +0000"  >&lt;p&gt;After discussion on the dev list, I will be adding a new WebSessionManager interface that a web-specific SessionManager can optionally implement, with a method, &quot;isServletContainerSessions&quot;.  DefaultSecurityManager&apos;s isHttpMode will then use this method to return it&apos;s value, and will not use the saved sessionMode string.&lt;/p&gt;</comment>
                            <comment id="13068147" author="deraj123" created="Wed, 20 Jul 2011 03:47:35 +0000"  >&lt;p&gt;Adds the WebSessionManager interface with a usesServletContainerSessions method.  This interfaces is not required to be implemented, and if the SessionManager does not implement it, the behavior is the same as previously when the sessionMode was null.&lt;/p&gt;

&lt;p&gt;I have not deprecated the setSessionMode convenience method, but I have deprecated use of that field in an attempt to avoid it being used for any logic outside of the &quot;setSessionMode&quot; method.  &lt;/p&gt;

&lt;p&gt;I have also added a test case to ensure that isHttpSessionMode is actually using the return value of the WebSessionManager&apos;s method.&lt;/p&gt;</comment>
                            <comment id="13069653" author="lhazlewood" created="Fri, 22 Jul 2011 18:05:58 +0000"  >&lt;p&gt;Hi Jared,&lt;/p&gt;

&lt;p&gt;I can&apos;t apply the patch - I believe I&apos;m having errors due to recent changes in the ServletContainerSessionManager class.  Would you mind updating to the latest trunk and applying a new patch?&lt;/p&gt;

&lt;p&gt;My apologies!&lt;/p&gt;</comment>
                            <comment id="13069668" author="deraj123" created="Fri, 22 Jul 2011 18:31:24 +0000"  >&lt;p&gt;Sure thing.  This is against svn revision 1149681.&lt;/p&gt;</comment>
                            <comment id="13069701" author="lhazlewood" created="Fri, 22 Jul 2011 20:01:48 +0000"  >&lt;p&gt;Thanks Jared - this one worked.&lt;/p&gt;

&lt;p&gt;I applied the patch with some minor adjustments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I moved the WebSessionManager to the org.apache.shiro.web.session.mgt package to be with the other web session management interfaces/components&lt;/li&gt;
	&lt;li&gt;I changed the WebSessionManager&apos;s method to be isServletContainerSessions() to be JavaBeans compatible (in case any tools introspect the API).&lt;/li&gt;
	&lt;li&gt;Minor JavaDoc additions.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please feel free to review and offer any further suggestions/adjustments.&lt;/p&gt;</comment>
                            <comment id="13069702" author="lhazlewood" created="Fri, 22 Jul 2011 20:03:51 +0000"  >&lt;p&gt;I also added some more Deprecation notices and one log message.  The &apos;sessionMode&apos; property was added as a convenience to automagically set the SessionManager based on which session mechanism one wanted to use.  However, this property has caused more than enough problems due to configuration out-of-order problems based on when you set the property - not nice.  It&apos;s better to just remove it alltogether, so maybe we can do that in 1.3 or 2.0.&lt;/p&gt;</comment>
                            <comment id="13069709" author="lhazlewood" created="Fri, 22 Jul 2011 20:21:21 +0000"  >&lt;p&gt;I had to make one final adjustment.  I changed the implementation of isHttpSessionMode() to be the following:&lt;/p&gt;

&lt;p&gt;SessionManager sessionManager = getSessionManager();&lt;br/&gt;
return sessionManager instanceof WebSessionManager &amp;amp;&amp;amp; ((WebSessionManager)sessionManager).isServletContainerSessions();&lt;/p&gt;

&lt;p&gt;If the end-user configures something that is not a WebSessionManager, we can&apos;t assume that Servlet Container sessions are being used.  So this method will return &apos;false&apos; in that case.&lt;/p&gt;</comment>
                            <comment id="13069722" author="deraj123" created="Fri, 22 Jul 2011 20:32:34 +0000"  >&lt;p&gt;Works for me.  I had named it &quot;uses&quot; b/c it &quot;is&quot; just doesn&apos;t make sense to me, but for the purposes of JavaBeans introspection, that seems reasonable. &lt;/p&gt;

&lt;p&gt;As far as the isHttpSessionMode, I agree with that logic...makes more sense - I was just trying to maintain current behavior, where anything other than &quot;native&quot; returned true.  &lt;/p&gt;</comment>
                            <comment id="13069796" author="lhazlewood" created="Fri, 22 Jul 2011 21:50:12 +0000"  >&lt;p&gt;Sounds good - thanks for the review.&lt;/p&gt;</comment>
                            <comment id="13191752" author="lhazlewood" created="Tue, 24 Jan 2012 01:11:42 +0000"  >&lt;p&gt;Closing with the 1.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487102" name="SessionManager_SHIRO-312.patch" size="7257" author="deraj123" created="Wed, 20 Jul 2011 03:47:35 +0000"/>
                            <attachment id="12487462" name="SessionManager_SHIRO-312_b.patch" size="7189" author="deraj123" created="Fri, 22 Jul 2011 18:31:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i102kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>208552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>