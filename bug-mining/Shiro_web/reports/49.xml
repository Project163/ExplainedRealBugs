<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:35:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHIRO-678] Strings garbled when POST without JSESSIONID cookie</title>
                <link>https://issues.apache.org/jira/browse/SHIRO-678</link>
                <project id="12310950" key="SHIRO">Shiro</project>
                    <description>&lt;p&gt;Dear all,&lt;/p&gt;

&lt;p&gt;I created a login endpoint using jaxrs-2.1 and a simple form based authentication.&lt;/p&gt;

&lt;p&gt;If I supply a password with German Umlauts (&#228;&#246;&#252; etc.) and do NOT supply any JSESSIONID (any invalid would do), the received string will be mojibake.&lt;/p&gt;

&lt;p&gt;However, if I supply a JSESSIONID (even an invalid JSESSIONID would do), the received String will be just fine.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Exampleservlet&quot;&gt;&lt;/a&gt;Example servlet&lt;/h2&gt;

&lt;p&gt;Here&apos;s an example endpoint:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/api&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JaxRsEndpoint {

  @POST
  @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/login&quot;&lt;/span&gt;)
  @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
  @Produces(MediaType.APPLICATION_JSON)
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response doLogin(
      @DefaultValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;) @FormParam(&quot;&lt;/span&gt;l_username&quot;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; username, &lt;span class=&quot;code-comment&quot;&gt;// login username
&lt;/span&gt;      @DefaultValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;) @FormParam(&quot;&lt;/span&gt;l_password&quot;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; password &lt;span class=&quot;code-comment&quot;&gt;// login password
&lt;/span&gt;  ) {
    Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; receivedData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&amp;gt;();
    receivedData.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;l_username&quot;&lt;/span&gt;, username);
    receivedData.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;l_password&quot;&lt;/span&gt;, password);

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Response.ok()
        .entity(unmodifiableMap(receivedData))
        .build();
  }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;web.xml&quot;&gt;&lt;/a&gt;web.xml&lt;/h2&gt;

&lt;p&gt;Here&apos;s the required web.xml configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&amp;lt;web-app id=&lt;span class=&quot;code-quote&quot;&gt;&quot;WebApp_ID&quot;&lt;/span&gt;
				 version=&lt;span class=&quot;code-quote&quot;&gt;&quot;3.1&quot;&lt;/span&gt;
				 xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;&lt;/span&gt;
				 &lt;span class=&quot;code-keyword&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
				 xsi:schemaLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&lt;/span&gt;&amp;gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;display-name&amp;gt;&lt;/span&gt;jaxrs-multipart-encoding&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/display-name&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;javax.ws.rs.core.Application&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;load-on-startup&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/load-on-startup&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-mapping&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;javax.ws.rs.core.Application&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/*&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/span&gt;

	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;listener&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;listener-class&amp;gt;&lt;/span&gt;org.apache.shiro.web.env.EnvironmentLoaderListener&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/listener-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/listener&amp;gt;&lt;/span&gt;

	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;ShiroFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-class&amp;gt;&lt;/span&gt;org.apache.shiro.web.servlet.ShiroFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;

	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;ShiroFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/*&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;REQUEST&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;FORWARD&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;INCLUDE&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;ERROR&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/web-app&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Test1%28NOTworking%29%3A&quot;&gt;&lt;/a&gt;Test 1 (NOT working):&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ curl -i -XPOST --url &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9080/formdata/api/login&quot;&lt;/span&gt; -d &lt;span class=&quot;code-quote&quot;&gt;&apos;l_username=user&amp;amp;l_password=&#228;&#246;&#252;&apos;&lt;/span&gt;; echo &quot;&quot;
&lt;/span&gt;HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 05 Mar 2019 08:59:32 GMT
Content-Language: en-EN
Content-Length: 49

{&lt;span class=&quot;code-quote&quot;&gt;&quot;l_username&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;l_password&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&#195;&#164;&#195;&#182;&#195;&#188;&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;&lt;a name=&quot;Test2%28workingasexpected%29%3A&quot;&gt;&lt;/a&gt;Test 2 (working as expected):&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ curl -i -XPOST --cookie &lt;span class=&quot;code-quote&quot;&gt;&apos;JSESSIONID=0&apos;&lt;/span&gt;  --url &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9080/formdata/api/login&quot;&lt;/span&gt; -d &lt;span class=&quot;code-quote&quot;&gt;&apos;l_username=user&amp;amp;l_password=&#228;&#246;&#252;&apos;&lt;/span&gt;; echo &quot;&quot; 
&lt;/span&gt;HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 05 Mar 2019 08:57:51 GMT
Content-Language: en-EN
Content-Length: 43

{&lt;span class=&quot;code-quote&quot;&gt;&quot;l_username&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;l_password&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&#228;&#246;&#252;&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;shiro.ini&quot;&gt;&lt;/a&gt;shiro.ini&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
shiro.loginUrl = /api/login
shiro.successUrl = /overview
shiro.usernameParam = l_username
shiro.passwordParam = l_password
shiro.rememberMeParam = rememberMe


# Session handling.
sessionManager = org.apache.shiro.web.session.mgt.DefaultWebSessionManager
# 3,600,000 milliseconds = 1 hour
# 7200000 = 2h
sessionManager.globalSessionTimeout = 7200000

# Use the configured &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; session manager:
securityManager.sessionManager = $sessionManager

# Cache
sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
securityManager.sessionManager.sessionDAO = $sessionDAO

# URL Configuration
[urls]
/* = anon
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have looked through the source code but was unable to find a reason why this may occur.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This bug does not occur when NOT using Shiro. This means the shiro filter seems to do some damage, but only when the jsessionid cookie is NOT supplied.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>OS: Linux (SLES Enterprise 11SP4, Ubuntu 18.04.x), Windows 10.&lt;br/&gt;
ApplicationServers: LibertyProfile 18.0.0.2, 18.0.04, 19.0.01 and OpenLiberty 19.0.0.1.&lt;br/&gt;
</environment>
        <key id="13219504">SHIRO-678</key>
            <summary>Strings garbled when POST without JSESSIONID cookie</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bmarwell">Benjamin Marwell</assignee>
                                    <reporter username="bmarwell">Benjamin Marwell</reporter>
                        <labels>
                            <label>easyfix</label>
                    </labels>
                <created>Tue, 5 Mar 2019 09:30:58 +0000</created>
                <updated>Wed, 18 Aug 2021 11:14:23 +0000</updated>
                            <resolved>Wed, 18 Aug 2021 11:14:23 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.7.1</version>
                                    <fixVersion>2.0.0-alpha</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>jax-rs</component>
                    <component>Session Management</component>
                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="16784330" author="mampf86" created="Tue, 5 Mar 2019 11:06:43 +0000"  >&lt;p&gt;I consider this critical, because Users get irritating error messages (cannot authenticate) and lock their ldap accounts a lot.&lt;/p&gt;</comment>
                            <comment id="16784331" author="jbonofre" created="Tue, 5 Mar 2019 11:08:06 +0000"  >&lt;p&gt;I can work on this one.&lt;/p&gt;</comment>
                            <comment id="16784346" author="mampf86" created="Tue, 5 Mar 2019 11:46:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt; thanks! I&apos;ll try to lock it down further using a JUnit test.&lt;/p&gt;</comment>
                            <comment id="16784622" author="mampf86" created="Tue, 5 Mar 2019 16:26:27 +0000"  >&lt;p&gt;I just found the same behaviour on&#160;tomcat embedded,&#160;adding cxf&#160;manually. I&#160;cannot say that CXF may or may not be the cause. I just suspected SHIRO because this behaviour is only observeable if using the SHIRO filter.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;HTH&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If you need the JUnit test case, please tell me.&lt;/p&gt;</comment>
                            <comment id="16784631" author="mampf86" created="Tue, 5 Mar 2019 16:40:25 +0000"  >&lt;p&gt;I just tested Tomcat with a manual Jersey setup with the very same result.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To recap:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Container&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;JAX-RS implementation&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Shiro enabled&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cookie JSESSIONID&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;(Open)Liberty&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CXF (bundled)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;(Open)Liberty&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CXF&#160;(bundled)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Tomcat Embedded 8.5.x&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CXF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Tomcat Embedded 8.5.x&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CXF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Tomcat Embedded 8.5.x&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Jersey&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Tomcat Embedded 8.5.x&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Jersey&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;With cookie JSESSIONID enabled, it will also work with SHIRO.&lt;/p&gt;

&lt;p&gt;HTH&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16986998" author="mampf86" created="Tue, 3 Dec 2019 15:28:34 +0000"  >&lt;p&gt;Any progress on this?&lt;/p&gt;</comment>
                            <comment id="16987002" author="fpapon" created="Tue, 3 Dec 2019 15:33:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mampf86&quot; class=&quot;user-hover&quot; rel=&quot;mampf86&quot;&gt;mampf86&lt;/a&gt;Hi, sorry I didn&apos;t check. Can you have a patch (github PR) for this? If not I will try next week.&lt;/p&gt;</comment>
                            <comment id="16987656" author="mampf86" created="Wed, 4 Dec 2019 08:46:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpapon&quot; class=&quot;user-hover&quot; rel=&quot;fpapon&quot;&gt;fpapon&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;while I did dig into the code, I haven&apos;t found a location in the code which could cause this behaviour. My current workaround is to set an empty JSESSIONID cookie before showing the login page.&lt;/p&gt;</comment>
                            <comment id="17020270" author="mampf86" created="Tue, 21 Jan 2020 14:35:48 +0000"  >&lt;p&gt;I am not very good at tomcat, but I could possibly set up an integration test using the maven-invoker-plugin and OpenLiberty.&lt;/p&gt;</comment>
                            <comment id="17027008" author="bdemers" created="Thu, 30 Jan 2020 21:23:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmarwell&quot; class=&quot;user-hover&quot; rel=&quot;bmarwell&quot;&gt;bmarwell&lt;/a&gt;&#160;This is an interesting one.&#160; I tracked this down here:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/tomcat/blob/8.5.50/java/org/apache/tomcat/util/buf/ByteChunk.java#L121-L128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tomcat/blob/8.5.50/java/org/apache/tomcat/util/buf/ByteChunk.java#L121-L128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which mean setting the character set in the request &lt;em&gt;fixes&lt;/em&gt; the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl -i -POST -H &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type: application/x-www-form-urlencoded; charset=utf-8&quot;&lt;/span&gt; --url &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/api/login&quot;&lt;/span&gt; -d &lt;span class=&quot;code-quote&quot;&gt;&apos;l_username=user&amp;amp;l_password=&#228;&#246;&#252;&apos;&lt;/span&gt;; echo &quot;&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I just double-checked, and this is still valid in 4.0: &lt;a href=&quot;https://javaee.github.io/servlet-spec/downloads/servlet-4.0/servlet-4_0_FINAL.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://javaee.github.io/servlet-spec/downloads/servlet-4.0/servlet-4_0_FINAL.pdf&lt;/a&gt; (see section 3.12)&lt;/p&gt;

&lt;p&gt;IMHO, Shiro is handling this &lt;em&gt;correctly&lt;/em&gt; (this is all delegated to the servlet container, specifically &lt;tt&gt;ServletRequestWrapper&lt;/tt&gt;),&lt;/p&gt;

&lt;p&gt;but... I would expect the behavior to remain the same with or without Shiro.&lt;br/&gt;
 I&apos;m not sure where to go from here, any chance you can publish your test cases somewhere? That might help us figure out what is going on.&lt;/p&gt;</comment>
                            <comment id="17028013" author="mampf86" created="Sat, 1 Feb 2020 08:57:24 +0000"  >&lt;p&gt;There is enough code in the description to reproduce it. But I could copy it to a github repository if you like&lt;/p&gt;</comment>
                            <comment id="17028112" author="bdemers" created="Sat, 1 Feb 2020 14:56:50 +0000"  >&lt;p&gt;I&#8217;m actually more interested in your non-Shiro example more (I was able to reproduce from you code above), but, it was &#8220;expected behavior&#8221; based on the Servlet spec. &lt;/p&gt;

&lt;p&gt;That said, Shiro shouldn&#8217;t be changing this behavior in the container.&lt;/p&gt;</comment>
                            <comment id="17028860" author="mampf86" created="Mon, 3 Feb 2020 10:46:05 +0000"  >&lt;p&gt;I am still trying to figure out where shiro uses &apos;JSESSIONID&apos;, but I have not found anyusages where the use of this cookie would have impact on the password token (&lt;tt&gt;UsernamePasswordToken.java&lt;/tt&gt;) or default encoding.&lt;/p&gt;</comment>
                            <comment id="17054809" author="mampf86" created="Mon, 9 Mar 2020 09:42:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdemers&quot; class=&quot;user-hover&quot; rel=&quot;bdemers&quot;&gt;bdemers&lt;/a&gt;&#160;here you go:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/bmhm/SHIRO-678&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bmhm/SHIRO-678&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;just &lt;font color=&quot;#0747a6&quot;&gt;&lt;tt&gt;git clone&lt;/tt&gt;&lt;/font&gt;, then &lt;font color=&quot;#0747a6&quot;&gt;&lt;tt&gt;mvn clean liberty:dev&lt;/tt&gt;&lt;/font&gt; to see the test results. Also see &lt;font color=&quot;#0747a6&quot;&gt;&lt;tt&gt;README.adoc&lt;/tt&gt;&lt;/font&gt;.&lt;/p&gt;</comment>
                            <comment id="17058116" author="bdemers" created="Thu, 12 Mar 2020 17:18:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmarwell&quot; class=&quot;user-hover&quot; rel=&quot;bmarwell&quot;&gt;bmarwell&lt;/a&gt; I added a pull request to that repo that &lt;em&gt;fixes&lt;/em&gt; the problem, I didn&apos;t do much testing other than running the existing tests.&lt;br/&gt;
&lt;a href=&quot;https://github.com/bmhm/SHIRO-678/pull/1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bmhm/SHIRO-678/pull/1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve copied my findings below so we can keep the thread here.&lt;/p&gt;

&lt;p&gt;TL;DR Servlets still use ISO-8859-1, Servlet filters will use the container&apos;s default charset, change the container, or use the Shiro&apos;s JAX-RS support instead.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;ll add this to the related JIRA too, but here is what I found (I&apos;m making a few assumptions here too)&lt;/p&gt;

&lt;p&gt;Containers use `ISO-8859-1` per the servlet spec&lt;br/&gt;
It looks like JAX-RS implementations use UTF-8 (assumption)&lt;/p&gt;

&lt;p&gt;When using a servlet filter, the character set is getting picked up by the container (as the servlet filter is processed before the JAX-RS implementation)&lt;/p&gt;

&lt;p&gt;Switching to using the ShiroFeature, fixes the problem as that &lt;em&gt;should&lt;/em&gt; be processed from the contains of the JAX-RS implementation.&lt;/p&gt;

&lt;p&gt;If you want to continue to use the ServletFitler, you can, but you would need to change the container&apos;s default encoding.&lt;/p&gt;

&lt;p&gt;Tomcat has a great writeup on the topic and instructions on how to use UTF-8 instead:&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/TOMCAT/Character+Encoding&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/TOMCAT/Character+Encoding&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;NOTE:&lt;/b&gt;* adding `; charset=utf-8` to request content-type also &lt;em&gt;fixes&lt;/em&gt; this, but would be less intuitive for anyone using UTF-8 and just want it to &lt;em&gt;work&lt;/em&gt;&lt;/p&gt;


&lt;p&gt;Again, I&apos;m making a few assumptions here, so let me know if you think I&apos;m off&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17058150" author="mampf86" created="Thu, 12 Mar 2020 18:07:11 +0000"  >&lt;p&gt;Oh, that&apos;s interesting!&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Sadly, it does not fix&#160; the problem! The login endpoint is not a servlet, running your code will still yield the same error. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&#160;Just run mvn liberty:dev to see the tests being executed.&lt;/p&gt;</comment>
                            <comment id="17058162" author="bdemers" created="Thu, 12 Mar 2020 18:33:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmarwell&quot; class=&quot;user-hover&quot; rel=&quot;bmarwell&quot;&gt;bmarwell&lt;/a&gt; is setting the container&apos;s default character set an option for you?&lt;/p&gt;

&lt;p&gt;If that doesn&apos;t work let us know!&lt;/p&gt;</comment>
                            <comment id="17058456" author="mampf86" created="Fri, 13 Mar 2020 06:38:46 +0000"  >&lt;p&gt;I just figured out it does work! Well, this (not using servlet-filter) or setting the container charset to UTF-8 will work, but what if a web application uses both Servlets and JAX-RS? If the user cannot change the default encoding?&lt;/p&gt;</comment>
                            <comment id="17058465" author="mampf86" created="Fri, 13 Mar 2020 06:58:59 +0000"  >&lt;p&gt;The example uses servlet-4.0. You can add `request-character-encoding` and `response-character-encoding` to the web.xml, see&#160;&lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/cwlp_servlet40.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/cwlp_servlet40.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think this would even be better than setting it per application server. However, the former question remains: Are users possibly affected using both servlet and jaxrs? If not, we could just close this probably.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For me, this is fixed (we will add both ;charset=utf-8 to the form/javascript sending the login and add the web.xml parameters as well).&lt;/p&gt;</comment>
                            <comment id="17058784" author="bdemers" created="Fri, 13 Mar 2020 14:31:55 +0000"  >&lt;p&gt;Cool!&lt;/p&gt;

&lt;p&gt;I&apos;m not sure there is anything Shiro can do on this.  I&apos;m still a little surprised that JAX-RS implementations use `UTF-8` by default (but my googling failed me and I couldn&apos;t find it in the spec).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For me, this is fixed (we will add both ;charset=utf-8 to the form/javascript sending the login and add the web.xml parameters as well).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is your best bet.  We could add a doc note about this.&lt;/p&gt;</comment>
                            <comment id="17058906" author="mampf86" created="Fri, 13 Mar 2020 16:32:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m still a little surprised that JAX-RS implementations use `UTF-8` by default (but my googling failed me and I couldn&apos;t find it in the spec).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Actually, JSON defaults to UTF-8 (in fact, MUST use UTF-8). In my example on the other hand I am using form data as a content type- which does not default to UTF-8, but rather ISO-8859-1. So actually this shouldn&apos;t be a suprise (I think), but can be very confusing.&lt;/p&gt;</comment>
                            <comment id="17059251" author="fpapon" created="Sat, 14 Mar 2020 07:28:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmarwell&quot; class=&quot;user-hover&quot; rel=&quot;bmarwell&quot;&gt;bmarwell&lt;/a&gt; Thanks for the report &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;Can we tag this issue as &quot;won&apos;t be fixed&quot;?&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdemers&quot; class=&quot;user-hover&quot; rel=&quot;bdemers&quot;&gt;bdemers&lt;/a&gt; said, I&apos;m not shure we can handle this in Shiro.&lt;/p&gt;</comment>
                            <comment id="17059310" author="mampf86" created="Sat, 14 Mar 2020 11:40:45 +0000"  >&lt;p&gt;Either won&apos;t fix, or make this a documentation issue instead. I&apos;d be willing to contribute.&lt;/p&gt;</comment>
                            <comment id="17059329" author="fpapon" created="Sat, 14 Mar 2020 12:31:56 +0000"  >&lt;p&gt;Good point for documentation, feel free to make a PR on the shiro-site.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17068689" author="mampf86" created="Fri, 27 Mar 2020 13:21:18 +0000"  >&lt;p&gt;Can you point me where this would have to be included?&lt;/p&gt;</comment>
                            <comment id="17068694" author="fpapon" created="Fri, 27 Mar 2020 13:25:32 +0000"  >&lt;p&gt;I think here could be a good place:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://shiro.apache.org/web.html#configuration&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://shiro.apache.org/web.html#configuration&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17396219" author="romain.manni-bucau" created="Mon, 9 Aug 2021 18:50:44 +0000"  >&lt;p&gt;In&#160;DefaultWebSessionManager#getReferencedSessionId shiro does&#160;&lt;br/&gt;
request.getParameter(name);&lt;br/&gt;
which will trigger the payload parsing, I assume getParameter is a servlet API abuse?&lt;/p&gt;</comment>
                            <comment id="17400975" author="mampf86" created="Wed, 18 Aug 2021 11:14:13 +0000"  >&lt;p&gt;merged and cherry-picked into 1.8.x-branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 12 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00c54:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>