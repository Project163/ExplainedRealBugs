<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:35:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHIRO-766] ArrayIndexOutOfBoundsException in Base64#decode</title>
                <link>https://issues.apache.org/jira/browse/SHIRO-766</link>
                <project id="12310950" key="SHIRO">Shiro</project>
                    <description>&lt;p&gt;While investigating a bug in our application, I stumbled upon this mail thread:&lt;br/&gt;
&lt;a href=&quot;https://www.mail-archive.com/user@shiro.apache.org/msg05654.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@shiro.apache.org/msg05654.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We have encountered the same issue.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;org.apache.shiro.web.mgt.CookieRememberMeManager#getRememberedSerializedIdentity&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; base64 = getCookie().readValue(request, response);
base64 = ensurePadding(base64);
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] decoded = Base64.decode(base64);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the cookie value contains characters that are not valid base64, the call to &lt;tt&gt;Base64.decode&lt;/tt&gt;, fails with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ArrayIndexOutOfBoundsException: Index 30 out of bounds for length 30
	at org.apache.shiro.codec.Base64.decode(Base64.java:470)
	at org.apache.shiro.codec.Base64.decode(Base64.java:414)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It can be reproduced like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Base64.decode(ensurePadding(&lt;span class=&quot;code-quote&quot;&gt;&quot;383078EE-A226-47B8-9798-8DDF9E361A9A%%ldapRealm&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the same value is passed to guavas base64 encoder, it fails with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;com.google.common.io.BaseEncoding$DecodingException: Unrecognized character: -
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13302824">SHIRO-766</key>
            <summary>ArrayIndexOutOfBoundsException in Base64#decode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eiden">Christoffer Eide</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 May 2020 08:42:16 +0000</created>
                <updated>Wed, 12 Aug 2020 06:04:45 +0000</updated>
                            <resolved>Tue, 5 May 2020 15:05:36 +0000</resolved>
                                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                    <fixVersion>2.0.0-alpha</fixVersion>
                                    <component>RememberMe</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17099945" author="bdemers" created="Tue, 5 May 2020 14:22:42 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eiden&quot; class=&quot;user-hover&quot; rel=&quot;eiden&quot;&gt;eiden&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Are the requests failing for you? Or is it log spam? (I&apos;m assuming the former)&lt;/p&gt;

&lt;p&gt;I&apos;d also like to understand what caused this.&#160; Do you have two different shiro applications configured on the same domain (and sharing cookies)?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If so can you provide examples of the two cookies (anonymized)?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17100200" author="mampf86" created="Tue, 5 May 2020 19:15:14 +0000"  >&lt;p&gt;Since this code is inside the Cookie Manager, I assumed they might either fail the request or just create log spam if they were catched later, but I did not verify that. In any case, deleting an invalid cookie should be fine (tampering attempt?) and logging it directly at its source is better in any case.&lt;/p&gt;

&lt;p&gt;If you have other needs, do not hesitate to ask!&lt;/p&gt;</comment>
                            <comment id="17100557" author="eiden" created="Wed, 6 May 2020 07:59:02 +0000"  >&lt;p&gt;Hi. Sorry, I should have provided more details when creating the issue.&lt;/p&gt;

&lt;p&gt;Yes, this is mostly log spam. But this error doesn&apos;t occur that often. &lt;br/&gt;
In addition to the log spam, requests started failing, but that was caused by us using the &lt;tt&gt;CookieRememberMeManager&lt;/tt&gt; directly. &lt;/p&gt;

&lt;p&gt;We were doing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cookieRememberMeManager.getRememberedPrincipals(context);
}&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ShiroException e){

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;ArrayIndexOutOfBoundsException&lt;/tt&gt; caught me by surprise. &lt;/p&gt;

&lt;p&gt;We don&apos;t have two applications running on the same domain. We noticed this problem when a client tried to use an incorrectly url encoded rememberMe cookie.&lt;/p&gt;

&lt;p&gt;Here is the cookie value causing the problem:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cmVmcmVzaC10b2tlbi25D9%2Bdf8P%2Fa9ehyy7lV3j0MdQ7nd9BFecA4tmOAF%2BuN4VdiYaMfSrb7yb3mmxyxUGjsQnWzfe8H52We%2BrGmL%2F0I63yxF7hE7o9jd%2B43NEaWh5WBiCkNRg5Bl2r9QT1od8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17100827" author="bdemers" created="Wed, 6 May 2020 13:57:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eiden&quot; class=&quot;user-hover&quot; rel=&quot;eiden&quot;&gt;eiden&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have a fix, I just wanted to make sure there wasn&apos;t some sort of secondary issue that was causing the client to send an incorrect cookie.&lt;/p&gt;</comment>
                            <comment id="17176034" author="mampf86" created="Wed, 12 Aug 2020 06:04:45 +0000"  >&lt;p&gt;The PR did not get linked due to a infrastructure hickup. Here it is:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/shiro/commit/fdddd7cb982d9be69ea6b74bbe183fa47a22e5ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/shiro/commit/fdddd7cb982d9be69ea6b74bbe183fa47a22e5ee&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0edvk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>