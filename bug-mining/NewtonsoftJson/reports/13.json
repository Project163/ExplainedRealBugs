{"url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984","repository_url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json","labels_url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984/labels{/name}","comments_url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984/comments","events_url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984/events","html_url":"https://github.com/JamesNK/Newtonsoft.Json/issues/1984","id":411130000,"node_id":"MDU6SXNzdWU0MTExMzAwMDA=","number":1984,"title":"Deserializing a null JSON property to a nullable ImmutableArray throws an exception","user":{"login":"Galad","id":2237019,"node_id":"MDQ6VXNlcjIyMzcwMTk=","avatar_url":"https://avatars.githubusercontent.com/u/2237019?v=4","gravatar_id":"","url":"https://api.github.com/users/Galad","html_url":"https://github.com/Galad","followers_url":"https://api.github.com/users/Galad/followers","following_url":"https://api.github.com/users/Galad/following{/other_user}","gists_url":"https://api.github.com/users/Galad/gists{/gist_id}","starred_url":"https://api.github.com/users/Galad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Galad/subscriptions","organizations_url":"https://api.github.com/users/Galad/orgs","repos_url":"https://api.github.com/users/Galad/repos","events_url":"https://api.github.com/users/Galad/events{/privacy}","received_events_url":"https://api.github.com/users/Galad/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-02-17T00:09:35Z","updated_at":"2019-03-30T04:01:45Z","closed_at":"2019-03-30T04:01:45Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nIf you have questions about how to use Json.NET, please read the Json.NET documentation or ask on Stack Overflow.\r\n\r\nhttps://www.newtonsoft.com/json/help\r\nhttps://stackoverflow.com/questions/tagged/json.net\r\n\r\nThere are thousands of Json.NET questions on Stack Overflow with the json.net tag.\r\n\r\nGitHub issues are only for reporting bugs, not questions or help.\r\n\r\n-->\r\n\r\nTo generalize, the exception is thrown when there is a nullable value type that implements IEnumerable.\r\nI believe it related to #1512 (and it is perhaps a regression from its fix).\r\n\r\nThe issue occurs in the version *12.0.1* while it was not present in *10.0.3*\r\n\r\n### Destination types\r\n\r\n```csharp\r\npublic class A\r\n{\r\n      public ImmutableArray<string>? Values { get; set; }\r\n}\r\n```\r\n\r\n### Source JSON\r\n```javascript\r\n{ Values: null}\r\n```\r\n\r\n### Expected behavior\r\n\r\nTest pass (`actual.Values` is null).\r\n\r\n### Actual behavior\r\n\r\nAn exception with the following message is thrown;\r\n```\r\nNewtonsoft.Json.JsonSerializationException : Error converting value {null} to type 'System.Nullable`1[System.Collections.Immutable.ImmutableArray`1[System.String]]'. Path 'Values', line 1, position 14.\r\n  ----> System.ArgumentException : Could not cast or convert from {null} to System.Collections.Immutable.ImmutableArray`1[System.String].\r\n```\r\n\r\n### Steps to reproduce\r\nPaste the following test in the Newtonsoft.Json solution:\r\n\r\n```csharp\r\n\r\n#if !(NET20 || NET35 || NET40)\r\nusing System.Collections;\r\nusing System.Collections.Generic;\r\nusing System.Collections.Immutable;\r\n#if DNXCORE50\r\nusing Xunit;\r\nusing Test = Xunit.FactAttribute;\r\nusing Assert = Newtonsoft.Json.Tests.XUnitAssert;\r\n#else\r\nusing NUnit.Framework;\r\n#endif\r\n\r\nnamespace Newtonsoft.Json.Tests.Issues\r\n{\r\n    public class IssueNullableStructImplementingIEnumerable\r\n    {\r\n        [Test]\r\n        public void Test()\r\n        {\r\n            var actual = JsonConvert.DeserializeObject<A>(\"{ Values: null}\");\r\n            Assert.IsNotNull(actual);\r\n            Assert.IsNull(actual.Values);\r\n        }\r\n        \r\n        public class A\r\n        {\r\n            public ImmutableArray<string>? Values { get; set; }\r\n        }\r\n    }\r\n}\r\n#endif\r\n```\r\n","closed_by":{"login":"JamesNK","id":303201,"node_id":"MDQ6VXNlcjMwMzIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/303201?v=4","gravatar_id":"","url":"https://api.github.com/users/JamesNK","html_url":"https://github.com/JamesNK","followers_url":"https://api.github.com/users/JamesNK/followers","following_url":"https://api.github.com/users/JamesNK/following{/other_user}","gists_url":"https://api.github.com/users/JamesNK/gists{/gist_id}","starred_url":"https://api.github.com/users/JamesNK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JamesNK/subscriptions","organizations_url":"https://api.github.com/users/JamesNK/orgs","repos_url":"https://api.github.com/users/JamesNK/repos","events_url":"https://api.github.com/users/JamesNK/events{/privacy}","received_events_url":"https://api.github.com/users/JamesNK/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/JamesNK/Newtonsoft.Json/issues/1984/timeline","performed_via_github_app":null,"state_reason":"completed"}