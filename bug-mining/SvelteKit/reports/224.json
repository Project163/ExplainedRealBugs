{"url":"https://api.github.com/repos/sveltejs/kit/issues/6709","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6709/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6709/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6709/events","html_url":"https://github.com/sveltejs/kit/issues/6709","id":1368157217,"node_id":"I_kwDOEiPr8c5RjGwh","number":6709,"title":"Load function should re-run if it was prefetched with an error","user":{"login":"alialaa","id":324106,"node_id":"MDQ6VXNlcjMyNDEwNg==","avatar_url":"https://avatars.githubusercontent.com/u/324106?v=4","gravatar_id":"","url":"https://api.github.com/users/alialaa","html_url":"https://github.com/alialaa","followers_url":"https://api.github.com/users/alialaa/followers","following_url":"https://api.github.com/users/alialaa/following{/other_user}","gists_url":"https://api.github.com/users/alialaa/gists{/gist_id}","starred_url":"https://api.github.com/users/alialaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alialaa/subscriptions","organizations_url":"https://api.github.com/users/alialaa/orgs","repos_url":"https://api.github.com/users/alialaa/repos","events_url":"https://api.github.com/users/alialaa/events{/privacy}","received_events_url":"https://api.github.com/users/alialaa/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":4812324547,"node_id":"LA_kwDOEiPr8c8AAAABHtY-ww","url":"https://api.github.com/repos/sveltejs/kit/labels/prefetch","name":"prefetch","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":0,"created_at":"2022-09-09T18:00:05Z","updated_at":"2022-11-17T20:54:13Z","closed_at":"2022-11-11T14:56:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\n\nI am having a situation where I am calling an API in my load functions and storing an access token and a refresh token in http cookies. When an endpoint returns 401 I redirect to a refresh token endpoint, update the cookies and redirect back to the original request. Anyways the problem happens when multiple requests are sent at the same time. Because the refresh token can only be used once. If multiple requests are sent with an expired access token, some of them will return 401 because the refresh token will no longer be valid. I can get around this in load functions by calling 1 endpoint first and the followed by others:\r\n```\r\nconst res1 = await fetch(...);\r\nconst [res2, res3] = await fetch();\r\n```\r\n\r\nBut what I can't control is when having links with prefetch enabled and a user hovers over multiple of them at the same time. If the token is expired, some of the load functions will fail (401). But the token will actually be refreshed in another request. So now when I open a prefetched link that failed, I get the 401 error although the token was refreshed. Does it make sense that a load function re-runs if an error was thrown during prefetching?\r\n\n\n### Describe the proposed solution\n\nIf an error was thrown in a load function during prefetching, it should re-run wen visiting the actual page instead of showing the error.\n\n### Alternatives considered\n\n_No response_\n\n### Importance\n\nnice to have\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6709/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6709/timeline","performed_via_github_app":null,"state_reason":"completed"}