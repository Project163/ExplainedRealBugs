{"url":"https://api.github.com/repos/sveltejs/kit/issues/8775","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8775/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8775/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8775/events","html_url":"https://github.com/sveltejs/kit/issues/8775","id":1561231921,"node_id":"I_kwDOEiPr8c5dDoIx","number":8775,"title":"Restrict external navigation with `goto` by default","user":{"login":"efstajas","id":1018218,"node_id":"MDQ6VXNlcjEwMTgyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/1018218?v=4","gravatar_id":"","url":"https://api.github.com/users/efstajas","html_url":"https://github.com/efstajas","followers_url":"https://api.github.com/users/efstajas/followers","following_url":"https://api.github.com/users/efstajas/following{/other_user}","gists_url":"https://api.github.com/users/efstajas/gists{/gist_id}","starred_url":"https://api.github.com/users/efstajas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/efstajas/subscriptions","organizations_url":"https://api.github.com/users/efstajas/orgs","repos_url":"https://api.github.com/users/efstajas/repos","events_url":"https://api.github.com/users/efstajas/events{/privacy}","received_events_url":"https://api.github.com/users/efstajas/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3229669367,"node_id":"MDU6TGFiZWwzMjI5NjY5MzY3","url":"https://api.github.com/repos/sveltejs/kit/labels/breaking%20change","name":"breaking change","color":"F859C7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/5","html_url":"https://github.com/sveltejs/kit/milestone/5","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/5/labels","id":8950942,"node_id":"MI_kwDOEiPr8c4AiJSe","number":5,"title":"2.0","description":"","creator":{"login":"benmccann","id":322311,"node_id":"MDQ6VXNlcjMyMjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/322311?v=4","gravatar_id":"","url":"https://api.github.com/users/benmccann","html_url":"https://github.com/benmccann","followers_url":"https://api.github.com/users/benmccann/followers","following_url":"https://api.github.com/users/benmccann/following{/other_user}","gists_url":"https://api.github.com/users/benmccann/gists{/gist_id}","starred_url":"https://api.github.com/users/benmccann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benmccann/subscriptions","organizations_url":"https://api.github.com/users/benmccann/orgs","repos_url":"https://api.github.com/users/benmccann/repos","events_url":"https://api.github.com/users/benmccann/events{/privacy}","received_events_url":"https://api.github.com/users/benmccann/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":71,"state":"open","created_at":"2023-01-22T00:37:21Z","updated_at":"2023-12-14T16:34:50Z","due_on":null,"closed_at":null},"comments":12,"created_at":"2023-01-29T10:52:35Z","updated_at":"2023-12-09T01:23:46Z","closed_at":"2023-12-09T01:23:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\r\n\r\nCurrently, you can pass an absolute external path (e.g. \"https://wikipedia.com\") to the `goto` function, and it will happily navigate away to outside the SvelteKit app.\r\n\r\nGenerally, this makes sense of course, but it caught me off-guard. Having used Nuxt before, where the `router.navigateTo` function forbids external navigation unless you explicitly set `external` to `true` in its options, I implemented a mechanism that allows our sign-in page to push the user back to a route-guarded page using a `backTo` URL parameter that would get appended to the sign-in page URL. Once the user signed in, the page would check whether `backTo` is set to a path, and if yes pass its value to `goto`.\r\n\r\nRecently, it was found that it was in fact possible to set this parameter to an absolute external URL, and it would happily push the user to that external page. Consequently, even `javascript:` URLs were possible, resulting in an XSS vulnerability.\r\n\r\nI understand that passing any user-editable string to `goto` was probably foolish on my part, but I didn't even consider the fact that external navigation would be possible at the time. Luckily, we caught this before going live on production, but I feel like this could be a common pitfall (especially given at least one other popular framework protects against it), with potentially severe consequences.\r\n\r\n### Describe the proposed solution\r\n\r\nAdd a new paremeter `external` to `goto`'s options object, which is set to `false` by default. If `false`, the function should ensure that the navigation would not push the user outside the current application, and throw an error if it would. If `true`, the current behavior should apply. \r\n\r\nSee Nuxt.js' `navigateTo` function. https://nuxt.com/docs/api/utils/navigate-to\r\n\r\n### Alternatives considered\r\n\r\nAdd the `external` parameter, but set it to `true` by default, so developers can opt-in to blocking external URLs when passing user-editable strings to `goto` while avoiding a breaking change.\r\n\r\n### Importance\r\n\r\nwould make my life easier\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8775/timeline","performed_via_github_app":null,"state_reason":"completed"}