{"url":"https://api.github.com/repos/sveltejs/kit/issues/5123","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5123/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5123/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5123/events","html_url":"https://github.com/sveltejs/kit/issues/5123","id":1253206425,"node_id":"I_kwDOEiPr8c5KsmmZ","number":5123,"title":"Auto adapter should download other adapters on demand","user":{"login":"Conduitry","id":16696352,"node_id":"MDQ6VXNlcjE2Njk2MzUy","avatar_url":"https://avatars.githubusercontent.com/u/16696352?v=4","gravatar_id":"","url":"https://api.github.com/users/Conduitry","html_url":"https://github.com/Conduitry","followers_url":"https://api.github.com/users/Conduitry/followers","following_url":"https://api.github.com/users/Conduitry/following{/other_user}","gists_url":"https://api.github.com/users/Conduitry/gists{/gist_id}","starred_url":"https://api.github.com/users/Conduitry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Conduitry/subscriptions","organizations_url":"https://api.github.com/users/Conduitry/orgs","repos_url":"https://api.github.com/users/Conduitry/repos","events_url":"https://api.github.com/users/Conduitry/events{/privacy}","received_events_url":"https://api.github.com/users/Conduitry/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470046,"node_id":"MDU6TGFiZWwyNDI4NDcwMDQ2","url":"https://api.github.com/repos/sveltejs/kit/labels/feature%20/%20enhancement","name":"feature / enhancement","color":"a2eeef","default":false,"description":"New feature or request"},{"id":2433668090,"node_id":"MDU6TGFiZWwyNDMzNjY4MDkw","url":"https://api.github.com/repos/sveltejs/kit/labels/adapters%20-%20general","name":"adapters - general","color":"0a63a8","default":false,"description":"Support for functionality general to all adapters"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":3,"created_at":"2022-05-31T00:25:28Z","updated_at":"2022-11-15T16:45:21Z","closed_at":"2022-11-15T16:45:20Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\n\nCurrently, `adapter-auto` has the other official serverless adapters as prod dependencies, so it can delegate to the correct one at runtime based on the current environment variables. This used to be an acceptable inefficiency, but the recent addition of `@vercel/nft` to the Vercel adapter (and thus to the auto adapter) added a lot of dependencies.\r\n\r\nIn the barest SvelteKit starter template, two thirds of the dependencies that get installed are only used by the auto adapter.\n\n### Describe the proposed solution\n\nTo make builds reproducible, each version of the auto adapter should pull in specific fixed versions of all of the other adapters, rather than pull in the latest one. Each time any other dependency has a new version cut, the auto adapter should also get a new release, which installs that new version.\r\n\r\nIt would be nice to be able to use pnpm/changesets to automate the release of the auto adapter whenever another adapter is getting released. We might be able to use peerdeps on the other adapters at version `workspace:*` and have this automatically handled, like `workspace:*` prod deps do. If we do this, we should use `peerDependenciesMeta` to make sure that installing the auto adapter doesn't install the other adapters, which would defeat the whole purpose here.\n\n### Alternatives considered\n\n_No response_\n\n### Importance\n\nnice to have\n\n### Additional Information\n\nIf we are only installing these dependencies on-demand and as part of the build happening in the cloud provider's remote build servers, I'm not sure whether it matters a ton whether we use the same package manager as was used to install the rest of the project's dependencies. If you run `npm install something` in a package that had previously used pnpm, does that remove any of the previous dependencies?\r\n\r\nShould the selected adapter be installed as a dependency of the SvelteKit app or of the auto adapter? Since the ESM analogues of the `require.resolve` API aren't all in place yet, would one make our job harder when trying to delegate to the appropriate underlying adapter?","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5123/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5123/timeline","performed_via_github_app":null,"state_reason":"completed"}