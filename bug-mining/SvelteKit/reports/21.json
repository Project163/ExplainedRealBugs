{"url":"https://api.github.com/repos/sveltejs/kit/issues/4406","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/4406/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/4406/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/4406/events","html_url":"https://github.com/sveltejs/kit/issues/4406","id":1174793201,"node_id":"I_kwDOEiPr8c5GBevx","number":4406,"title":"Error page handling does not respect ssr: false in handle() hook","user":{"login":"johndunderhill","id":25628891,"node_id":"MDQ6VXNlcjI1NjI4ODkx","avatar_url":"https://avatars.githubusercontent.com/u/25628891?v=4","gravatar_id":"","url":"https://api.github.com/users/johndunderhill","html_url":"https://github.com/johndunderhill","followers_url":"https://api.github.com/users/johndunderhill/followers","following_url":"https://api.github.com/users/johndunderhill/following{/other_user}","gists_url":"https://api.github.com/users/johndunderhill/gists{/gist_id}","starred_url":"https://api.github.com/users/johndunderhill/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johndunderhill/subscriptions","organizations_url":"https://api.github.com/users/johndunderhill/orgs","repos_url":"https://api.github.com/users/johndunderhill/repos","events_url":"https://api.github.com/users/johndunderhill/events{/privacy}","received_events_url":"https://api.github.com/users/johndunderhill/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229642339,"node_id":"MDU6TGFiZWwzMjI5NjQyMzM5","url":"https://api.github.com/repos/sveltejs/kit/labels/p2-nice-to-have","name":"p2-nice-to-have","color":"A7463B","default":false,"description":"SvelteKit cannot be used by a small number of people, quality of life improvements, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":0,"created_at":"2022-03-21T02:03:59Z","updated_at":"2022-04-05T17:22:32Z","closed_at":"2022-04-05T17:22:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI have a handle() function in my hooks.js which always returns ssr: false to the resolve function.  This works.\r\n\r\nBut if I browse to a non-existent page, SvelteKit appears to import my __layout.svelte, then import __error.svelte, then call the load() function in both files, on the server.  On the client, I see the same, then it runs the client side script block.\r\n\r\n### Reproduction\r\n\r\n```\r\n// hooks.js\r\nexport async function handle({ event, resolve }): Promise<Response> {\r\n\tconsole.log('handle.js: Invoked');\r\n\tconst response = await resolve(event, {\r\n\t\tssr: false\r\n\t});\r\n\treturn response;\r\n}\r\n\r\n// __error.svelte\r\n<script context=\"module\" lang=\"ts\">\r\n\timport type { ErrorLoadInput, LoadOutput } from '@sveltejs/kit/types/private';\r\n\tconsole.log('module: __error.svelte');\r\n\r\n\t// https://kit.svelte.dev/docs/loading\r\n\texport function load({ error, status }: ErrorLoadInput): LoadOutput {\r\n\t\tconsole.log('module: __error.svelte/load()');\r\n\t\treturn {\r\n\t\t\tprops: { error, status }\r\n\t\t};\r\n\t}\r\n</script>\r\n\r\n<script lang=\"ts\">\r\n\tconsole.log('script: __error.svelte');\r\n\timport '/src/app.css';\r\n\timport { dev } from '$app/env';\r\n\texport let error: Error;\r\n\texport let status: number;\r\n</script>\r\n\r\n<div>\r\n\t<h1>Error {status}</h1>\r\n\r\n\t<p>{error.message}</p>\r\n\r\n\t{#if dev && error.stack}\r\n\t\t<pre>{error.stack}</pre>\r\n\t{/if}\r\n</div>\r\n```\r\n\r\n### Logs\r\n\r\n```shell\r\nServer\r\n------\r\nSvelteKit v1.0.0-next.301\r\n\r\nlocal:   http://localhost:3000\r\nnetwork: not exposed\r\n...\r\n\r\nhandle.js: Invoked\r\nmodule: __layout.svelte\r\nmodule: __error.svelte\r\nmodule: __layout.svelte/load()\r\nmodule: __error.svelte/load()\r\n\r\nClient\r\n------\r\nclient.ts:22 [vite] connecting...\r\nclient.ts:58 [vite] connected.\r\nGET https://3000-costvine-costvineclients-ex4ocymp30d.ws-us38.gitpod.io/banana 404\r\n__error.svelte? [sm]:3 module: __error.svelte\r\n__layout.svelte? [sm]:3 module: __layout.svelte\r\n__layout.svelte? [sm]:7 module: __layout.svelte/load()\r\n__error.svelte? [sm]:7 module: __error.svelte/load()\r\n__layout.svelte? [sm]:15 script: __layout.svelte\r\n__error.svelte? [sm]:15 script: __error.svelte\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: Linux 5.16 Ubuntu 20.04.4 LTS (Focal Fossa)\r\n    CPU: (16) x64 Intel(R) Xeon(R) CPU @ 2.80GHz\r\n    Memory: 2.53 GB / 62.80 GB\r\n    Container: Yes\r\n    Shell: 5.0.17 - /bin/bash\r\n  Binaries:\r\n    Node: 16.13.2 - ~/.nvm/versions/node/v16.13.2/bin/node\r\n    Yarn: 1.22.17 - ~/.nvm/versions/node/v16.13.2/bin/yarn\r\n    npm: 8.1.2 - ~/.nvm/versions/node/v16.13.2/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.33 \r\n    @sveltejs/adapter-static: next => 1.0.0-next.29 \r\n    @sveltejs/kit: next => 1.0.0-next.301 \r\n    svelte: ^3.46.4 => 3.46.4\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\nYes, it's an SPA (sorry, Rich).  This app is specifically designed to talk to back end services directly from the browser; I don't need SSR here, and in fact it won't work for this use case.  I'm using SvelteKit for the routing, and because the app is written in Svelte.  Smooth support for SPAs is important to me.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/4406/timeline","performed_via_github_app":null,"state_reason":"completed"}