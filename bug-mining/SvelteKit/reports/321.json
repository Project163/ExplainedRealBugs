{"url":"https://api.github.com/repos/sveltejs/kit/issues/8646","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8646/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8646/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8646/events","html_url":"https://github.com/sveltejs/kit/issues/8646","id":1551789440,"node_id":"I_kwDOEiPr8c5cfm2A","number":8646,"title":"As of @sveltejs/kit@1.0.13, getting build errors loading JSON from environmental variables","user":{"login":"nstuyvesant","id":5770938,"node_id":"MDQ6VXNlcjU3NzA5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/5770938?v=4","gravatar_id":"","url":"https://api.github.com/users/nstuyvesant","html_url":"https://github.com/nstuyvesant","followers_url":"https://api.github.com/users/nstuyvesant/followers","following_url":"https://api.github.com/users/nstuyvesant/following{/other_user}","gists_url":"https://api.github.com/users/nstuyvesant/gists{/gist_id}","starred_url":"https://api.github.com/users/nstuyvesant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nstuyvesant/subscriptions","organizations_url":"https://api.github.com/users/nstuyvesant/orgs","repos_url":"https://api.github.com/users/nstuyvesant/repos","events_url":"https://api.github.com/users/nstuyvesant/events{/privacy}","received_events_url":"https://api.github.com/users/nstuyvesant/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3147046323,"node_id":"MDU6TGFiZWwzMTQ3MDQ2MzIz","url":"https://api.github.com/repos/sveltejs/kit/labels/awaiting%20submitter","name":"awaiting submitter","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-01-21T12:37:20Z","updated_at":"2023-01-21T22:23:11Z","closed_at":"2023-01-21T22:23:11Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nAfter bumping @sveltejs/kit from 1.0.12 to 1.0.13 (with no other code changes), running `rpm run build` started throwing errors toward the end of outputting chunks (see logs below). Reverting to 1.0.12 causes the build to work again.\r\n\r\n### Reproduction\r\n\r\nThe error referenced is the third line here:\r\n```javascript\r\nimport { e as env } from \"./env-private.js\";\r\nconst { GOOGLE_RECAPTCHA_SECRET } = env;\r\nconst BRAINTREE_DESCRIPTOR = JSON.parse(env.BRAINTREE_DESCRIPTOR || \"\");\r\n```\r\n\r\nThis is what that environmental variable looks like:\r\n```\r\nBRAINTREE_DESCRIPTOR={\"name\": \"SH YYYY*Class Workshop\", \"phone\": \"212-555-1212\", \"url\": \"example.com\"}\r\n```\r\n\r\nThe first line of the code above in the original source is:\r\n```typescript\r\nimport { env } from '$env/dynamic/private'\r\n```\r\n\r\n### Logs\r\n\r\n```Shell\r\n> shy-svelte@3.0.4 build\r\n> vite build\r\n\r\n\r\nvite v4.0.4 building for production...\r\n\r\n✓ 1784 modules transformed.\r\n7:31:48 AM [vite-plugin-svelte] dom compile done.\r\npackage   \tfiles\t time\t   avg\r\nshy-svelte\t   94\t1.50s\t16.0ms\r\n\r\nvite v4.0.4 building SSR bundle for production...\r\n✓ 435 modules transformed.\r\n7:16:32 AM [vite-plugin-svelte] ssr compile done.\r\npackage   \tfiles\t time\t  avg\r\nshy-svelte\t   94\t0.29s\t3.1ms\r\n.svelte-kit/output/server/vite-manifest.json                                             25.42 kB\r\n.svelte-kit/output/server/chunks/prod-ssr.js                                              0.12 kB │ map:     0.23 kB\r\n.svelte-kit/output/server/entries/pages/auth/reset/_token_/_page.ts.js                    0.14 kB │ map:     0.38 kB\r\n.svelte-kit/output/server/entries/pages/_layout.server.ts.js                              0.15 kB │ map:     0.48 kB\r\n.svelte-kit/output/server/entries/pages/classes/_locationId_/_page.ts.js                  0.15 kB │ map:     0.41 kB\r\n.svelte-kit/output/server/chunks/env-private.js                                           0.16 kB │ map:     0.38 kB\r\n.svelte-kit/output/server/internal.js                                                     0.18 kB │ map:     0.09 kB\r\n.svelte-kit/output/server/entries/endpoints/api/announcement/active.json/_server.ts.js    0.20 kB │ map:     0.47 kB\r\n.svelte-kit/output/server/entries/pages/register/_page.server.ts.js                       0.21 kB │ map:     0.50 kB\r\n.svelte-kit/output/server/entries/endpoints/api/class/_server.ts.js                       0.22 kB │ map:     0.49 kB\r\n.svelte-kit/output/server/entries/endpoints/api/product/_server.ts.js                     0.22 kB │ map:     0.50 kB\r\n.svelte-kit/output/server/entries/endpoints/api/user/_id_/_server.ts.js                   0.22 kB │ map:     0.49 kB\r\n.svelte-kit/output/server/entries/endpoints/api/location/_server.ts.js                    0.23 kB │ map:     0.51 kB\r\n.svelte-kit/output/server/entries/endpoints/api/workshop/_server.ts.js                    0.23 kB │ map:     0.51 kB\r\n.svelte-kit/output/server/entries/endpoints/api/class/_id_/_server.ts.js                  0.23 kB │ map:     0.50 kB\r\n.svelte-kit/output/server/entries/endpoints/api/product/_id_/_server.ts.js                0.23 kB │ map:     0.50 kB\r\n.svelte-kit/output/server/entries/endpoints/api/location/_id_/_server.ts.js               0.23 kB │ map:     0.51 kB\r\n.svelte-kit/output/server/entries/endpoints/api/workshop/_id_/_server.ts.js               0.23 kB │ map:     0.51 kB\r\n.svelte-kit/output/server/entries/endpoints/api/announcement/_server.ts.js                0.23 kB │ map:     0.52 kB\r\n.svelte-kit/output/server/entries/pages/checkout/_page.ts.js                              0.23 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/payment/order/_server.ts.js               0.24 kB │ map:     0.55 kB\r\n.svelte-kit/output/server/entries/endpoints/api/schedule/_server.ts.js                    0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/_server.ts.js                     0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/announcement/_id_/_server.ts.js           0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/product/_id_.json/_server.ts.js           0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/location/_id_.json/_server.ts.js          0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/user/_id_.json/_server.ts.js              0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/workshop/_id_.json/_server.ts.js          0.24 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/schedule/_id_/_server.ts.js               0.24 kB │ map:     0.52 kB\r\n.svelte-kit/output/server/entries/endpoints/api/class/_id_.json/_server.ts.js             0.25 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/schedule/_id_.json/_server.ts.js          0.25 kB │ map:     0.54 kB\r\n.svelte-kit/output/server/entries/endpoints/api/announcement/_id_.json/_server.ts.js      0.25 kB │ map:     0.56 kB\r\n.svelte-kit/output/server/entries/pages/reserve/_page.server.ts.js                        0.26 kB │ map:     0.53 kB\r\n.svelte-kit/output/server/entries/endpoints/api/payment/_id_.json/_server.ts.js           0.28 kB │ map:     0.56 kB\r\n.svelte-kit/output/server/entries/pages/_page.ts.js                                       0.33 kB │ map:     0.69 kB\r\n.svelte-kit/output/server/chunks/db.js                                                    0.34 kB │ map:     0.90 kB\r\n.svelte-kit/output/server/entries/pages/profile/_page.server.ts.js                        0.38 kB │ map:     0.78 kB\r\n.svelte-kit/output/server/entries/pages/_layout.ts.js                                     0.39 kB │ map:     0.88 kB\r\n.svelte-kit/output/server/entries/pages/classes/_page.svelte.js                           0.39 kB │ map:     0.10 kB\r\n.svelte-kit/output/server/entries/pages/shynet/_page.ts.js                                0.42 kB │ map:     0.80 kB\r\n.svelte-kit/output/server/entries/pages/admin/_page.ts.js                                 0.44 kB │ map:     0.84 kB\r\n.svelte-kit/output/server/chunks/history.js                                               0.44 kB │ map:     0.72 kB\r\n.svelte-kit/output/server/entries/endpoints/api/teacher/current.json/_server.ts.js        0.47 kB │ map:     0.85 kB\r\n.svelte-kit/output/server/entries/endpoints/api/unsubscribe/_email_/_server.ts.js         0.49 kB │ map:     0.86 kB\r\n.svelte-kit/output/server/entries/endpoints/api/master/admin.json/_server.ts.js           0.50 kB │ map:     0.90 kB\r\n.svelte-kit/output/server/chunks/stores.js                                                0.50 kB │ map:     1.80 kB\r\n.svelte-kit/output/server/entries/pages/_error.svelte.js                                  0.52 kB │ map:     0.33 kB\r\n.svelte-kit/output/server/entries/endpoints/api/user/merge/_server.ts.js                  0.53 kB │ map:     1.01 kB\r\n.svelte-kit/output/server/entries/endpoints/api/master/active.json/_server.ts.js          0.54 kB │ map:     0.89 kB\r\n.svelte-kit/output/server/entries/endpoints/api/subscribe/_server.ts.js                   0.54 kB │ map:     0.92 kB\r\n.svelte-kit/output/server/entries/endpoints/api/payment/search.json/_server.ts.js         0.56 kB │ map:     1.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/class/search.json/_server.ts.js           0.56 kB │ map:     1.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/product/search.json/_server.ts.js         0.56 kB │ map:     1.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/location/search.json/_server.ts.js        0.56 kB │ map:     1.06 kB\r\n.svelte-kit/output/server/entries/endpoints/api/workshop/search.json/_server.ts.js        0.56 kB │ map:     1.06 kB\r\n.svelte-kit/output/server/entries/endpoints/api/announcement/search.json/_server.ts.js    0.56 kB │ map:     1.07 kB\r\n.svelte-kit/output/server/entries/pages/classes/_locationId_/_page.svelte.js              0.56 kB │ map:     0.42 kB\r\n.svelte-kit/output/server/entries/endpoints/api/schedule/search.json/_server.ts.js        0.56 kB │ map:     1.07 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/_what_-_id_.json/_server.ts.js    0.57 kB │ map:     1.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/_what_-_id_/_server.ts.js         0.57 kB │ map:     1.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/user/search.json/_server.ts.js            0.58 kB │ map:     1.08 kB\r\n.svelte-kit/output/server/chunks/config.js                                                0.58 kB │ map:     0.61 kB\r\n.svelte-kit/output/server/chunks/hooks.server.js                                          0.61 kB │ map:     1.45 kB\r\n.svelte-kit/output/server/entries/endpoints/api/file/_server.ts.js                        0.62 kB │ map:     1.14 kB\r\n.svelte-kit/output/server/entries/endpoints/api/file/_filenum_/_server.ts.js              0.66 kB │ map:     1.21 kB\r\n.svelte-kit/output/server/chunks/user.js                                                  0.67 kB │ map:     1.22 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/me.json/_server.ts.js             0.68 kB │ map:     1.26 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/search.json/_server.ts.js         0.73 kB │ map:     1.34 kB\r\n.svelte-kit/output/server/entries/endpoints/api/message/_server.ts.js                     0.77 kB │ map:     1.39 kB\r\n.svelte-kit/output/server/entries/endpoints/auth/reset/_server.ts.js                      0.82 kB │ map:     1.50 kB\r\n.svelte-kit/output/server/entries/endpoints/auth/forgot/_server.ts.js                     1.11 kB │ map:     2.05 kB\r\n.svelte-kit/output/server/entries/endpoints/api/attendance/search.json/_server.ts.js      1.18 kB │ map:     2.08 kB\r\n.svelte-kit/output/server/chunks/enums.js                                                 1.28 kB │ map:     1.32 kB\r\n.svelte-kit/output/server/chunks/stores2.js                                               1.30 kB │ map:     3.09 kB\r\n.svelte-kit/output/server/chunks/index2.js                                                1.35 kB │ map:     4.32 kB\r\n.svelte-kit/output/server/entries/pages/teachers/_page.svelte.js                          1.39 kB │ map:     1.31 kB\r\n.svelte-kit/output/server/chunks/sendgrid.js                                              1.41 kB │ map:     2.52 kB\r\n.svelte-kit/output/server/chunks/AddToCart.js                                             1.57 kB │ map:     1.56 kB\r\n.svelte-kit/output/server/entries/endpoints/api/user/_server.ts.js                        1.61 kB │ map:     2.90 kB\r\n.svelte-kit/output/server/entries/pages/forgot/_page.svelte.js                            1.64 kB │ map:     2.75 kB\r\n.svelte-kit/output/server/entries/pages/merge/_page.svelte.js                             1.96 kB │ map:     3.01 kB\r\n.svelte-kit/output/server/entries/endpoints/auth/google/_server.ts.js                     1.97 kB │ map:     3.64 kB\r\n.svelte-kit/output/server/entries/endpoints/auth/_operation_/_server.ts.js                1.99 kB │ map:     3.74 kB\r\n.svelte-kit/output/server/chunks/datetime.extensions.js                                   2.05 kB │ map:     4.48 kB\r\n.svelte-kit/output/server/chunks/index.js                                                 2.19 kB │ map:     5.67 kB\r\n.svelte-kit/output/server/entries/pages/auth/reset/_token_/_page.svelte.js                2.34 kB │ map:     3.83 kB\r\n.svelte-kit/output/server/chunks/crud.js                                                  2.45 kB │ map:     4.64 kB\r\n.svelte-kit/output/server/chunks/Paginator.js                                             2.56 kB │ map:     3.15 kB\r\n.svelte-kit/output/server/entries/endpoints/api/history/reservation/_server.ts.js         2.65 kB │ map:     4.72 kB\r\n.svelte-kit/output/server/entries/pages/teachertraining/_page.svelte.js                   2.77 kB │ map:     2.61 kB\r\n.svelte-kit/output/server/entries/pages/history/_page.svelte.js                           2.92 kB │ map:     3.95 kB\r\n.svelte-kit/output/server/entries/pages/login/_page.svelte.js                             3.13 kB │ map:     5.25 kB\r\n.svelte-kit/output/server/chunks/CartEditor.js                                            3.18 kB │ map:    11.40 kB\r\n.svelte-kit/output/server/entries/pages/reserve/_page.svelte.js                           3.19 kB │ map:     5.43 kB\r\n.svelte-kit/output/server/entries/pages/register/_page.svelte.js                          3.58 kB │ map:     6.41 kB\r\n.svelte-kit/output/server/entries/pages/confirmation/_page.svelte.js                      3.61 kB │ map:     4.43 kB\r\n.svelte-kit/output/server/entries/pages/leta/_page.svelte.js                              3.61 kB │ map:     0.13 kB\r\n.svelte-kit/output/server/entries/pages/privacy/_page.svelte.js                           3.69 kB │ map:     0.16 kB\r\n.svelte-kit/output/server/entries/pages/profile/_page.svelte.js                           4.22 kB │ map:     6.35 kB\r\n.svelte-kit/output/server/chunks/AddToCalendar.js                                         5.33 kB │ map:     5.83 kB\r\n.svelte-kit/output/server/entries/pages/shynet/_page.svelte.js                            5.93 kB │ map:     8.52 kB\r\n.svelte-kit/output/server/entries/pages/workshops/_page.svelte.js                         7.28 kB │ map:    10.41 kB\r\n.svelte-kit/output/server/chunks/index3.js                                                8.07 kB │ map:    86.24 kB\r\n.svelte-kit/output/server/entries/pages/terms/_page.svelte.js                             8.98 kB │ map:     0.24 kB\r\n.svelte-kit/output/server/entries/pages/_page.svelte.js                                   9.12 kB │ map:     6.87 kB\r\n.svelte-kit/output/server/entries/pages/checkout/_page.svelte.js                          9.31 kB │ map:    26.50 kB\r\n.svelte-kit/output/server/chunks/payment.js                                              11.37 kB │ map:    18.59 kB\r\n.svelte-kit/output/server/chunks/server-internal.js                                      18.81 kB │ map:    27.44 kB\r\n.svelte-kit/output/server/entries/pages/_layout.svelte.js                                23.21 kB │ map:    28.32 kB\r\n.svelte-kit/output/server/chunks/Users.js                                                29.91 kB │ map:    45.56 kB\r\n.svelte-kit/output/server/chunks/Classes.js                                              37.04 kB │ map:    55.54 kB\r\n.svelte-kit/output/server/index.js                                                       76.12 kB │ map:   174.92 kB\r\n.svelte-kit/output/server/entries/pages/admin/_page.svelte.js                           811.10 kB │ map: 1,628.12 kB\r\nundefined:1\r\n\r\n\r\nSyntaxError: Unexpected end of JSON input\r\n    at JSON.parse (<anonymous>)\r\n    at file:///Users/nates/dev/shy-svelte/.svelte-kit/output/server/chunks/payment.js:7:35\r\n    at ModuleJob.run (node:internal/modules/esm/module_job:194:25)\r\n\r\nNode.js v18.13.0\r\n[vite-plugin-sveltekit-compile] Prerendering failed with code 1\r\nerror during build:\r\nError: Prerendering failed with code 1\r\n    at ChildProcess.<anonymous> (file:///Users/nates/dev/shy-svelte/node_modules/@sveltejs/kit/src/exports/vite/index.js:629:15)\r\n    at ChildProcess.emit (node:events:513:28)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:291:12)\r\n```\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: macOS 13.1\r\n    CPU: (10) arm64 Apple M1 Pro\r\n    Memory: 386.08 MB / 32.00 GB\r\n    Shell: 5.8.1 - /bin/zsh\r\n  Binaries:\r\n    Node: 18.13.0 - /opt/homebrew/bin/node\r\n    Yarn: 1.22.19 - /opt/homebrew/bin/yarn\r\n    npm: 9.3.1 - /opt/homebrew/bin/npm\r\n  Browsers:\r\n    Chrome: 109.0.5414.87\r\n    Firefox: 108.0.2\r\n    Safari: 16.2\r\n  npmPackages:\r\n    @sveltejs/adapter-node: ^1.1.4 => 1.1.4 \r\n    @sveltejs/kit: 1.2.2 => 1.2.2 \r\n    svelte: ^3.55.1 => 3.55.1 \r\n    vite: ^4.0.4 => 4.0.4\r\n```\r\n\r\n\r\n### Severity\r\n\r\nblocking an upgrade\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8646/timeline","performed_via_github_app":null,"state_reason":"completed"}