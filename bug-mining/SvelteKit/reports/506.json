{"url":"https://api.github.com/repos/sveltejs/kit/issues/11578","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/11578/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/11578/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/11578/events","html_url":"https://github.com/sveltejs/kit/issues/11578","id":2074066253,"node_id":"I_kwDOEiPr8c57n71N","number":11578,"title":"`import-meta-resolve` dependency breaks Yarn 4 Plug'n'Play/Zero-installs","user":{"login":"maximdeclercq","id":33176664,"node_id":"MDQ6VXNlcjMzMTc2NjY0","avatar_url":"https://avatars.githubusercontent.com/u/33176664?v=4","gravatar_id":"","url":"https://api.github.com/users/maximdeclercq","html_url":"https://github.com/maximdeclercq","followers_url":"https://api.github.com/users/maximdeclercq/followers","following_url":"https://api.github.com/users/maximdeclercq/following{/other_user}","gists_url":"https://api.github.com/users/maximdeclercq/gists{/gist_id}","starred_url":"https://api.github.com/users/maximdeclercq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maximdeclercq/subscriptions","organizations_url":"https://api.github.com/users/maximdeclercq/orgs","repos_url":"https://api.github.com/users/maximdeclercq/repos","events_url":"https://api.github.com/users/maximdeclercq/events{/privacy}","received_events_url":"https://api.github.com/users/maximdeclercq/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-01-10T10:31:37Z","updated_at":"2025-01-15T13:15:42Z","closed_at":"2025-01-15T13:15:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nYarn 4 Plug'n'Play/Zero-installs were supported up until SvelteKit 2.0.7.\r\n\r\nDowngrading with yarn add -D @sveltejs/kit@2.0.7 resolves any issue with Yarn 4 Plug'n'Play/Zero-installs.\r\n\r\nEver since SvelteKit 2.0.8, Plug'n'Play/Zero-installs are no longer supported due to the incompatibility with `import-meta-resolve`.\r\n\r\n### Reproduction\r\n\r\n1. Create a new project with `create-svelte`\r\n\r\n```sh\r\n$ yarn create svelte example && cd example\r\nyarn create v1.22.21\r\n[1/4] Resolving packages...\r\n⠁ (node:2276661) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.\r\n(Use `node --trace-deprecation ...` to show where the warning was created)\r\n[2/4] Fetching packages...\r\n[3/4] Linking dependencies...\r\n[4/4] Building fresh packages...\r\nsuccess Installed \"create-svelte@6.0.6\" with binaries:\r\n      - create-svelte\r\n[#######] 7/7\r\ncreate-svelte version 6.0.6\r\n\r\n┌  Welcome to SvelteKit!\r\n│\r\n◇  Which Svelte app template?\r\n│  Skeleton project\r\n│\r\n◇  Add type checking with TypeScript?\r\n│  Yes, using TypeScript syntax\r\n│\r\n◇  Select additional options (use arrow keys/space bar)\r\n│  none\r\n│\r\n└  Your project is ready!\r\n\r\n✔ Typescript\r\n  Inside Svelte components, use <script lang=\"ts\">\r\n\r\nInstall community-maintained integrations:\r\n  https://github.com/svelte-add/svelte-add\r\n\r\nNext steps:\r\n  1: cd platform\r\n  2: yarn install\r\n  3: git init && git add -A && git commit -m \"Initial commit\" (optional)\r\n  4: yarn run dev -- --open\r\n\r\nTo close the dev server, hit Ctrl-C\r\n\r\nStuck? Visit us at https://svelte.dev/chat\r\nDone in 6.44s.\r\n```\r\n\r\n2. Enable Yarn 4 Plug'n'Play/Zero-install and install packages\r\n```sh\r\n$ corepack enable\r\n$ yarn set version stable\r\n$ yarn config set nodeLinker pnp\r\n$ yarn install\r\n```\r\n\r\n3. Run development server\r\n```sh\r\n$ yarn dev\r\n```\r\n\r\n### Logs\r\n\r\n```Shell\r\nerror when starting dev server:\r\nError: Cannot find package '@sveltejs/vite-plugin-svelte' imported from /home/user/example/dummy.js\r\n    at __node_internal_ (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/lib/errors.js:431:11)\r\n    at new NodeError (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/lib/errors.js:374:5)\r\n    at packageResolve (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/lib/resolve.js:1038:9)\r\n    at moduleResolve (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/lib/resolve.js:1101:20)\r\n    at defaultResolve (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/lib/resolve.js:1266:15)\r\n    at Module.resolve (file:///home/user/.yarn/berry/cache/import-meta-resolve-npm-4.0.0-13a6ef4fd3-10c0.zip/node_modules/import-meta-resolve/index.js:32:12)\r\n    at resolve_peer_dependency (file:///home/user/example/.yarn/unplugged/@sveltejs-kit-virtual-93c8ce76c9/node_modules/@sveltejs/kit/src/exports/vite/index.js:132:29)\r\n    at sveltekit (file:///home/user/example/.yarn/unplugged/@sveltejs-kit-virtual-93c8ce76c9/node_modules/@sveltejs/kit/src/exports/vite/index.js:167:27)\r\n    at async Promise.all (index 0)\r\n    at async asyncFlatten (file:///home/user/example/.yarn/__virtual__/vite-virtual-75c9d0056a/4/.yarn/berry/cache/vite-npm-5.0.11-d5457a8b86-10c0.zip/node_modules/vite/dist/node/chunks/dep-V3BH7oO1.js:12894:16)\r\n    at async resolveConfig (file:///home/user/example/.yarn/__virtual__/vite-virtual-75c9d0056a/4/.yarn/berry/cache/vite-npm-5.0.11-d5457a8b86-10c0.zip/node_modules/vite/dist/node/chunks/dep-V3BH7oO1.js:67863:29)\r\n    at async _createServer (file:///home/user/example/.yarn/__virtual__/vite-virtual-75c9d0056a/4/.yarn/berry/cache/vite-npm-5.0.11-d5457a8b86-10c0.zip/node_modules/vite/dist/node/chunks/dep-V3BH7oO1.js:60327:20)\r\n    at async CAC.<anonymous> (file:///home/user/example/.yarn/__virtual__/vite-virtual-75c9d0056a/4/.yarn/berry/cache/vite-npm-5.0.11-d5457a8b86-10c0.zip/node_modules/vite/dist/node/cli.js:764:24)\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 6.6 CachyOS Linux\r\n    CPU: (20) x64 13th Gen Intel(R) Core(TM) i9-13900H\r\n    Memory: 20.99 GB / 30.98 GB\r\n    Container: Yes\r\n    Shell: 3.7.0 - /bin/fish\r\n  Binaries:\r\n    Node: 21.5.0 - /tmp/xfs-6a97206b/node\r\n    Yarn: 4.0.2 - /tmp/xfs-6a97206b/yarn\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^3.0.0 => 3.1.0\r\n    @sveltejs/kit: ^2.0.0 => 2.2.0\r\n    @sveltejs/vite-plugin-svelte: ^3.0.0 => 3.0.1\r\n    svelte: ^4.2.7 => 4.2.8\r\n    vite: ^5.0.3 => 5.0.11\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/11578/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/11578/timeline","performed_via_github_app":null,"state_reason":"completed"}