{"url":"https://api.github.com/repos/sveltejs/kit/issues/3732","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/3732/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/3732/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/3732/events","html_url":"https://github.com/sveltejs/kit/issues/3732","id":1124503474,"node_id":"I_kwDOEiPr8c5DBo-y","number":3732,"title":"page props are re-set whenever the `session` store is updated, and the `load` function is re-run the first time","user":{"login":"ponderingexistence","id":96596709,"node_id":"U_kgDOBcHy5Q","avatar_url":"https://avatars.githubusercontent.com/u/96596709?v=4","gravatar_id":"","url":"https://api.github.com/users/ponderingexistence","html_url":"https://github.com/ponderingexistence","followers_url":"https://api.github.com/users/ponderingexistence/followers","following_url":"https://api.github.com/users/ponderingexistence/following{/other_user}","gists_url":"https://api.github.com/users/ponderingexistence/gists{/gist_id}","starred_url":"https://api.github.com/users/ponderingexistence/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ponderingexistence/subscriptions","organizations_url":"https://api.github.com/users/ponderingexistence/orgs","repos_url":"https://api.github.com/users/ponderingexistence/repos","events_url":"https://api.github.com/users/ponderingexistence/events{/privacy}","received_events_url":"https://api.github.com/users/ponderingexistence/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229640667,"node_id":"MDU6TGFiZWwzMjI5NjQwNjY3","url":"https://api.github.com/repos/sveltejs/kit/labels/p1-important","name":"p1-important","color":"2C3488","default":false,"description":"SvelteKit cannot be used by a large number of people, basic functionality is missing, etc."},{"id":4348376112,"node_id":"LA_kwDOEiPr8c8AAAABAy70MA","url":"https://api.github.com/repos/sveltejs/kit/labels/load%20/%20layout","name":"load / layout","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":10,"created_at":"2022-02-04T18:41:27Z","updated_at":"2022-07-25T15:47:29Z","closed_at":"2022-07-25T15:47:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nIn the docs, in the section about the `load` function, it's stated that:\r\n> ...if url, session or stuff are used in the function, they will be re-run whenever their value changes... [(here)](https://kit.svelte.dev/docs#:~:text=if%20url%2C%20session%20or%20stuff%20are%20used%20in%20the%20function%2C%20they%20will%20be%20re%2Drun%20whenever%20their%20value%20changes)\r\n\r\nBut this doesn't seem to be the case. I have the following page in my SvelteKit app:\r\n`index.svelte`:\r\n\r\n```svelte\r\n<script lang=\"ts\" context=\"module\">\r\n    import type { Load } from '@sveltejs/kit';\r\n\r\n    export const load: Load = () => {\r\n        console.warn('index load function');\r\n        return {};\r\n    }\r\n</script>\r\n\r\n<script lang=\"ts\">\r\n    import { session } from '$app/stores';\r\n\r\n    function changeSession() {\r\n        $session.someField = Math.random();\r\n    }\r\n</script>\r\n\r\n<pre>{JSON.stringify($session, null, 4)}</pre>\r\n\r\n<button on:click={changeSession}>\r\n    Change $session\r\n</button>\r\n```\r\n\r\nIf you click on the \"Change $session\" button, you'll see the message \"index load function\" appearing in the console, which obviously means the load function is re-run, even though `session` isn't used in the `load` function. This is inconsistent with the behavior described in the docs.\r\n\r\nThe strange thing, however, is that from the second time onwards, when the value of the '$session' store changes, the `load` function is no longer re-run. This is confusing.\r\n\r\n**The more severe bug**, however, which seems to be related to this one, is that every time the `$session` store changes, the page's props are apparently re-set, which means reactivity is re-triggered throughout the entire page, potentially causing massive problems.\r\n\r\nConsider the following:\r\n```svelte\r\n<script lang=\"ts\" context=\"module\">\r\n    import type { Load } from '@sveltejs/kit';\r\n\r\n    export const load: Load = () => {\r\n        console.warn('index load function');\r\n        return {\r\n            props: {\r\n                userBasicInfo: {\r\n                    id: 2,\r\n                }\r\n            }\r\n        };\r\n    }\r\n</script>\r\n\r\n<script lang=\"ts\">\r\n    import { browser } from '$app/env';\r\n    import { session } from '$app/stores';\r\n\r\n    export let userBasicInfo;\r\n\r\n    function changeSession() {\r\n        $session.someField = Math.random();\r\n    }\r\n\r\n    $: console.log('userBasicInfo changed:', userBasicInfo);\r\n</script>\r\n\r\n<pre>{JSON.stringify($session, null, 4)}</pre>\r\n\r\n<button on:click={changeSession}>\r\n    Change Ssession\r\n</button>\r\n\r\n<hr />\r\n\r\n{#if browser}\r\n    {#await fetch(`https://reqres.in/api/users/${userBasicInfo.id}`).then(r => r.json())}\r\n        Loading...\r\n    {:then result}\r\n        <pre>{JSON.stringify(result, null, 4)}</pre>\r\n    {/await}\r\n{/if}\r\n```\r\n\r\nIn this setup, whenever you click on the \"Change $session\" button — which is to say whenever you update the `$session` store — the `fetch` request in the markup, which uses the `userBaicInfo` prop, is re-triggered, even though it obviously shouldn't. And you can see the `userBasicInfo changed: ...` message in the console which proves that it's because of the `userBasicInfo` prop getting re-set.\r\n\r\n### Reproduction\r\n\r\nYou can create an empty SvelteKit skeleton project and then copy-paste the two code snippets above into the `index.svelte` file, and then `npm run dev` => open your browser and see the behavior for yourself.\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: Windows 10 10.0.19042\r\n    CPU: (4) x64 Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz\r\n    Memory: 1.09 GB / 7.89 GB\r\n  Binaries:\r\n    Node: 14.15.0 - C:\\Program Files\\nodejs\\node.EXE     \r\n    Yarn: 1.22.10 - ~\\AppData\\Roaming\\npm\\yarn.CMD       \r\n    npm: 6.14.8 - C:\\Program Files\\nodejs\\npm.CMD        \r\n  Browsers:\r\n    Edge: Spartan (44.19041.1266.0), Chromium (97.0.1072.76)\r\n    Internet Explorer: 11.0.19041.1202\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.17\r\n    @sveltejs/kit: next => 1.0.0-next.260\r\n    svelte: ^3.44.0 => 3.46.4\r\n```\r\n\r\n\r\n### Severity\r\n\r\nblocking all usage of SvelteKit\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/3732/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/3732/timeline","performed_via_github_app":null,"state_reason":"completed"}