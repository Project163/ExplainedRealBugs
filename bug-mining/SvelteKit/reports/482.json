{"url":"https://api.github.com/repos/sveltejs/kit/issues/12510","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/12510/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/12510/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/12510/events","html_url":"https://github.com/sveltejs/kit/issues/12510","id":2433697602,"node_id":"I_kwDOEiPr8c6RD0dC","number":12510,"title":"The preload function of a page is called even if preventDefault is called on `onclick`, `onmousedown` and `ontouchstart` on a data-sveltekit-preload-data=\"tap\" anchor","user":{"login":"kran6a","id":15054534,"node_id":"MDQ6VXNlcjE1MDU0NTM0","avatar_url":"https://avatars.githubusercontent.com/u/15054534?v=4","gravatar_id":"","url":"https://api.github.com/users/kran6a","html_url":"https://github.com/kran6a","followers_url":"https://api.github.com/users/kran6a/followers","following_url":"https://api.github.com/users/kran6a/following{/other_user}","gists_url":"https://api.github.com/users/kran6a/gists{/gist_id}","starred_url":"https://api.github.com/users/kran6a/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kran6a/subscriptions","organizations_url":"https://api.github.com/users/kran6a/orgs","repos_url":"https://api.github.com/users/kran6a/repos","events_url":"https://api.github.com/users/kran6a/events{/privacy}","received_events_url":"https://api.github.com/users/kran6a/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-07-28T02:29:25Z","updated_at":"2024-10-28T09:46:46Z","closed_at":"2024-10-28T09:46:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nI found this odd behaviour when using an anchor element that included a child that should not trigger navigation. Tried doing `event.preventDefault` on the child as it prevents the navigation but still calls the preload function.\r\n\r\nI don't think it is the intended behaviour as the fetched data is not used for the (cancelled) navigation and might be stale if a later navigation happens.\r\n\r\nIt is a one line fix. Just checking `event.defaultPrevented` [here](https://github.com/sveltejs/kit/blob/e9c84a0bb1edf4f4a8f47827ea26458216811789/packages/kit/src/runtime/client/client.js#L1513) would prevent the preloading.\n\n### Reproduction\n\nWas not able to run the https://node.new/sveltekit with the latest svelte v5 and sveltekit versions but I think the bug is obvious as the mousedown and touchstart listeners are attached just a few lines below the `tap()` function and there is no `event.defaultPrevented` check on any of them, unlike the click event, which is checking it [here]( https://github.com/sveltejs/kit/blob/e9c84a0bb1edf4f4a8f47827ea26458216811789/packages/kit/src/runtime/client/client.js#L2027).\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: Windows 11 10.0.22631\r\n    CPU: (12) x64 AMD Ryzen 5 3600XT 6-Core Processor\r\n    Memory: 19.54 GB / 63.93 GB\r\n  Binaries:\r\n    Node: 22.5.1 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 10.8.2 - C:\\Program Files\\nodejs\\npm.CMD\r\n    pnpm: 9.6.0 - C:\\Program Files\\nodejs\\pnpm.CMD\r\n    bun: 1.1.21 - ~\\.bun\\bin\\bun.EXE\r\n  Browsers:\r\n    Edge: Chromium (127.0.2651.74)\r\n    Internet Explorer: 11.0.22621.3527\r\n  npmPackages:\r\n    @sveltejs/adapter-static: ^3.0.2 => 3.0.2\r\n    @sveltejs/kit: ^2.5.18 => 2.5.18\r\n    @sveltejs/vite-plugin-svelte: ^3.1.1 => 3.1.1\r\n    svelte: 5.0.0-next.200 => 5.0.0-next.200\r\n    vite: ^5.3.5 => 5.3.5\n```\n\n\n### Severity\n\nannoyance\n\n### Additional Information\n\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/12510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/12510/timeline","performed_via_github_app":null,"state_reason":"completed"}