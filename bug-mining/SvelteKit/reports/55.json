{"url":"https://api.github.com/repos/sveltejs/kit/issues/5349","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5349/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5349/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5349/events","html_url":"https://github.com/sveltejs/kit/issues/5349","id":1293305888,"node_id":"I_kwDOEiPr8c5NFkgg","number":5349,"title":"multipart parsing monkey-patch not working for installPolyfills()","user":{"login":"vekunz","id":5724298,"node_id":"MDQ6VXNlcjU3MjQyOTg=","avatar_url":"https://avatars.githubusercontent.com/u/5724298?v=4","gravatar_id":"","url":"https://api.github.com/users/vekunz","html_url":"https://github.com/vekunz","followers_url":"https://api.github.com/users/vekunz/followers","following_url":"https://api.github.com/users/vekunz/following{/other_user}","gists_url":"https://api.github.com/users/vekunz/gists{/gist_id}","starred_url":"https://api.github.com/users/vekunz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vekunz/subscriptions","organizations_url":"https://api.github.com/users/vekunz/orgs","repos_url":"https://api.github.com/users/vekunz/repos","events_url":"https://api.github.com/users/vekunz/events{/privacy}","received_events_url":"https://api.github.com/users/vekunz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-07-04T15:19:30Z","updated_at":"2022-07-20T00:45:38Z","closed_at":"2022-07-20T00:45:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nIn this pull request https://github.com/sveltejs/kit/pull/5292 you \"added\" support for multipart parsing into undici. But it seems that this does not work, if I install polyfills with `installPolyfills()`.\r\n\r\n### Reproduction\r\n\r\n```typescript\r\nconst formData = new FormData();\r\nformData.set('email', 'email@domain.de');\r\n\r\nconst request = new Request('https://domain.de/my/path', {\r\n  method: 'POST',\r\n  headers: {},\r\n  body: formData\r\n});\r\n\r\nawait event.request.formData(); // <-- this failes\r\n```\r\n\r\n### Logs\r\n\r\n```shell\r\nNotSupportedError: multipart/form-data not supported\r\n ❯ Request$2.formData ../../../../../../../../../C:/path/to/poject/node_modules/@sveltejs/kit/dist/node/polyfills.js:1921:13\r\n ❯ src/routes/signup/_index.spec.ts:97:26\r\n     95|       };\r\n     96| \r\n     97|       await event.request.formData();\r\n       |                          ^\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:                                                    \r\n    OS: Windows 10 10.0.19044                                \r\n    CPU: (12) x64 Intel(R) Core(TM) i7-9850H CPU @ 2.60GHz   \r\n    Memory: 13.04 GB / 31.79 GB                              \r\n  Binaries:                                                  \r\n    Node: 16.15.1 - C:\\Program Files\\nodejs\\node.EXE         \r\n    npm: 8.13.2 - C:\\Program Files\\nodejs\\npm.CMD            \r\n  Browsers:                                                  \r\n    Chrome: 103.0.5060.66                                    \r\n    Edge: Spartan (44.19041.1266.0), Chromium (103.0.1264.44)\r\n    Internet Explorer: 11.0.19041.1566                       \r\n  npmPackages:                                               \r\n    @sveltejs/adapter-node: 1.0.0-next.78 => 1.0.0-next.78   \r\n    @sveltejs/kit: 1.0.0-next.357 => 1.0.0-next.357          \r\n    svelte: 3.48.0 => 3.48.0\r\n```\r\n\r\n\r\n### Severity\r\n\r\nblocking all usage of SvelteKit\r\n\r\n### Additional Information\r\n\r\nCurrently, this is one problem of at least two problems with undici, that block an update of SvelteKit (the other problem is that mswjs currently has no support for undici).","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5349/timeline","performed_via_github_app":null,"state_reason":"completed"}