{"url":"https://api.github.com/repos/sveltejs/kit/issues/5110","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5110/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5110/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5110/events","html_url":"https://github.com/sveltejs/kit/issues/5110","id":1251982883,"node_id":"I_kwDOEiPr8c5Kn74j","number":5110,"title":"Adapters throw typescript errors on import when `moduleResolution` is set to \"NodeNext\" or \"ESNext\"","user":{"login":"adam-coster","id":28758057,"node_id":"MDQ6VXNlcjI4NzU4MDU3","avatar_url":"https://avatars.githubusercontent.com/u/28758057?v=4","gravatar_id":"","url":"https://api.github.com/users/adam-coster","html_url":"https://github.com/adam-coster","followers_url":"https://api.github.com/users/adam-coster/followers","following_url":"https://api.github.com/users/adam-coster/following{/other_user}","gists_url":"https://api.github.com/users/adam-coster/gists{/gist_id}","starred_url":"https://api.github.com/users/adam-coster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adam-coster/subscriptions","organizations_url":"https://api.github.com/users/adam-coster/orgs","repos_url":"https://api.github.com/users/adam-coster/repos","events_url":"https://api.github.com/users/adam-coster/events{/privacy}","received_events_url":"https://api.github.com/users/adam-coster/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2433668090,"node_id":"MDU6TGFiZWwyNDMzNjY4MDkw","url":"https://api.github.com/repos/sveltejs/kit/labels/adapters%20-%20general","name":"adapters - general","color":"0a63a8","default":false,"description":"Support for functionality general to all adapters"},{"id":2539682476,"node_id":"MDU6TGFiZWwyNTM5NjgyNDc2","url":"https://api.github.com/repos/sveltejs/kit/labels/types%20/%20typescript","name":"types / typescript","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-05-29T20:22:04Z","updated_at":"2022-05-30T12:56:49Z","closed_at":"2022-05-30T12:56:49Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nThe `index.d.ts` file of each adapter has its export like so:\r\n\r\nhttps://github.com/sveltejs/kit/blob/ec7b804c18c7a7bb50573c16006bb699d68157d9/packages/adapter-auto/index.d.ts#L3-L4\r\n\r\nBut when Typescript (4.7+) is set to have `moduleResolution` of `NodeNext` or `ESNext` the import statement throws a compiler error. This can be fixed by changing the export to the following:\r\n\r\n```ts\r\nexport default function plugin(): Adapter;\r\n```\r\n\r\n### Reproduction\r\n\r\nImporting with `NodeNext` module resolution (should see the error):\r\n\r\nhttps://www.typescriptlang.org/play?target=99&moduleResolution=99&ts=4.7.0-beta#code/JYWwDg9gTgLgBAQwCYLDAplAyjBNgDGcAZlBCHAOQACAzgG7oA2GAVrQPTKoZQC0CAK4wIlANxA\r\n\r\nSame deal with `ESNext`:\r\n\r\nhttps://www.typescriptlang.org/play?target=99&ts=4.7.0-beta#code/JYWwDg9gTgLgBAQwCYLDAplAyjBNgDGcAZlBCHAOQACAzgG7oA2GAVrQPTKoZQC0CAK4wIlANxA\r\n\r\n\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: Linux 5.10 Ubuntu 20.04.2 LTS (Focal Fossa)\r\n    CPU: (20) x64 12th Gen Intel(R) Core(TM) i7-12700KF\r\n    Memory: 21.52 GB / 31.26 GB\r\n    Container: Yes\r\n    Shell: 5.0.17 - /bin/bash\r\n  Binaries:\r\n    Node: 16.13.1 - ~/.volta/tools/image/node/16.13.1/bin/node\r\n    npm: 8.9.0 - ~/.volta/tools/image/npm/8.9.0/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^1.0.0-next.48 => 1.0.0-next.48 \r\n    @sveltejs/kit: ^1.0.0-next.345 => 1.0.0-next.345 \r\n    typescript: 4.8.0-dev.20220529\r\n```\r\n\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\nAs far as I can guess, there aren't backwards compatibility problems if the export is changed to:\r\n\r\n```ts\r\nexport default function plugin(): Adapter;\r\n```\r\n\r\nSince the packages are already set up as ESM.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5110/timeline","performed_via_github_app":null,"state_reason":"completed"}