{"url":"https://api.github.com/repos/sveltejs/kit/issues/9796","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/9796/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/9796/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/9796/events","html_url":"https://github.com/sveltejs/kit/issues/9796","id":1688276780,"node_id":"I_kwDOEiPr8c5koQ8s","number":9796,"title":"`data` and `$page.data` get out of sync when using `use:enhance`","user":{"login":"danieldiekmeier","id":2098462,"node_id":"MDQ6VXNlcjIwOTg0NjI=","avatar_url":"https://avatars.githubusercontent.com/u/2098462?v=4","gravatar_id":"","url":"https://api.github.com/users/danieldiekmeier","html_url":"https://github.com/danieldiekmeier","followers_url":"https://api.github.com/users/danieldiekmeier/followers","following_url":"https://api.github.com/users/danieldiekmeier/following{/other_user}","gists_url":"https://api.github.com/users/danieldiekmeier/gists{/gist_id}","starred_url":"https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danieldiekmeier/subscriptions","organizations_url":"https://api.github.com/users/danieldiekmeier/orgs","repos_url":"https://api.github.com/users/danieldiekmeier/repos","events_url":"https://api.github.com/users/danieldiekmeier/events{/privacy}","received_events_url":"https://api.github.com/users/danieldiekmeier/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-04-28T10:04:03Z","updated_at":"2023-05-05T19:17:02Z","closed_at":"2023-05-05T11:19:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nHello!\r\n\r\nI'm using an action to change server side state. My expectation is that SvelteKit will reload all the data for the page, so that my UI automatically is up to date.\r\n\r\nI noticed that this does not work if I use the `$page` store. The `data` prop of the `+page.svelte` is correctly refreshed, but the new value is not reflected in `$page.data`.\r\n\r\nhttps://user-images.githubusercontent.com/2098462/235118410-3bc21afe-4cb7-42b4-b068-66c30025b8f0.mp4\r\n\r\nThis seems very weird to me. I feel like these values should always be in sync? Am I doing something wrong?\n\n### Reproduction\n\nRepo: https://github.com/danieldiekmeier/reproduction-page-store-out-of-sync\r\n\r\n1. Start with `pnpm i && pnpm dev`\r\n2. Open `http://localhost:5173/`\r\n3. Click the \"Increase via use:enhance\" button\r\n\r\nYou should see that the `data.state` value increases, but the `$page.data.state` value does not.\r\n\r\nIn the console, you can see that the `$page` store is updated, but reset to the initial value immediately after.\r\n\r\n```\r\ndata.state: 0 / $page.data.state: 0\r\n// click button\r\ndata.state: 1 / $page.data.state: 0\r\ndata.state: 1 / $page.data.state: 1\r\ndata.state: 1 / $page.data.state: 0\r\n```\r\n\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: macOS 13.3.1\r\n    CPU: (10) arm64 Apple M1 Max\r\n    Memory: 4.97 GB / 64.00 GB\r\n    Shell: 5.9 - /bin/zsh\r\n  Binaries:\r\n    Node: 18.13.0 - ~/.asdf/installs/nodejs/18.13.0/bin/node\r\n    Yarn: 1.22.19 - ~/.asdf/installs/nodejs/18.13.0/bin/yarn\r\n    npm: 8.19.3 - ~/.asdf/plugins/nodejs/shims/npm\r\n  Browsers:\r\n    Chrome: 112.0.5615.137\r\n    Edge: 112.0.1722.58\r\n    Firefox: 103.0.2\r\n    Firefox Developer Edition: 113.0\r\n    Safari: 16.4\r\n    Safari Technology Preview: 16.4\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^2.0.1 => 2.0.1\r\n    @sveltejs/kit: ^1.15.9 => 1.15.9\r\n    svelte: ^3.58.0 => 3.58.0\r\n    vite: ^4.3.3 => 4.3.3\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/9796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/9796/timeline","performed_via_github_app":null,"state_reason":"completed"}