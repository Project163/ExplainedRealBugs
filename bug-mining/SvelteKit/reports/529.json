{"url":"https://api.github.com/repos/sveltejs/kit/issues/13322","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/13322/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/13322/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/13322/events","html_url":"https://github.com/sveltejs/kit/issues/13322","id":2791718798,"node_id":"I_kwDOEiPr8c6mZj-O","number":13322,"title":"Load functions are not always re-run on user changes to URL with hash-based router","user":{"login":"stephenlrandall","id":41397226,"node_id":"MDQ6VXNlcjQxMzk3MjI2","avatar_url":"https://avatars.githubusercontent.com/u/41397226?v=4","gravatar_id":"","url":"https://api.github.com/users/stephenlrandall","html_url":"https://github.com/stephenlrandall","followers_url":"https://api.github.com/users/stephenlrandall/followers","following_url":"https://api.github.com/users/stephenlrandall/following{/other_user}","gists_url":"https://api.github.com/users/stephenlrandall/gists{/gist_id}","starred_url":"https://api.github.com/users/stephenlrandall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephenlrandall/subscriptions","organizations_url":"https://api.github.com/users/stephenlrandall/orgs","repos_url":"https://api.github.com/users/stephenlrandall/repos","events_url":"https://api.github.com/users/stephenlrandall/events{/privacy}","received_events_url":"https://api.github.com/users/stephenlrandall/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":5682210466,"node_id":"LA_kwDOEiPr8c8AAAABUq-mog","url":"https://api.github.com/repos/sveltejs/kit/labels/needs-decision","name":"needs-decision","color":"ADCB95","default":false,"description":"Not sure if we want to do this yet, also design work needed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-01-16T05:09:31Z","updated_at":"2025-03-04T11:45:54Z","closed_at":"2025-03-04T11:45:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWhen using `router.type === 'pathname'`, all `load` functions are re-run if a user edits what would be part of `$page.url.pathname` (the page appears to reload).\n\nWhen using `router.type === 'hash'`, all `load` functions are not guaranteed to re-run when a user edits the URL. If the search params are modified, the page reloads and all `load` functions run. But when any part of the path (now following the hash) is edited, selective invalidation seems to be applied. This leads to inconsistent behavior between the two router types.\n\nI don't know if this distinction between \"reload on pathname change, don't reload on hash change\" is just a browser thing that SvelteKit has no control over, but it would be nice to have full invalidation on *hash* changes when using the hash-based router, to mirror what happens with pathname changes and the pathname router.\n\nI can work around this with something like:\n\n```svelte\n<svelte:window on:hashchange={invalidateAll}/>\n```\n\nbut this obviously ends up running some load functions twice.\n\n### Reproduction\n\nOpen the console when running https://github.com/stephenlrandall/kit-inline-test. Visit `http://localhost:5173/?q=svelte#/search`, then modify the URL to `http://localhost:5173/?q=svelte#/v2/search`. Note that in the console, only the `search` route's load function has been re-run.\n\n### Logs\n\n```Shell\n\n```\n\n### System Info\n\n```Shell\nSystem:\n    OS: macOS 15.2\n    CPU: (16) x64 Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz\n    Memory: 401.48 MB / 16.00 GB\n    Shell: 5.9 - /bin/zsh\n  Binaries:\n    Node: 20.8.0 - /usr/local/bin/node\n    npm: 10.1.0 - /usr/local/bin/npm\n    pnpm: 9.15.4 - ~/Library/pnpm/pnpm\n  Browsers:\n    Chrome: 131.0.6778.265\n    Edge: 131.0.2903.147\n    Safari: 18.2\n  npmPackages:\n    @sveltejs/adapter-auto: ^3.3.1 => 3.3.1 \n    @sveltejs/adapter-static: ^3.0.8 => 3.0.8 \n    @sveltejs/kit: ^2.15.3 => 2.15.3 \n    @sveltejs/vite-plugin-svelte: ^4.0.4 => 4.0.4 \n    svelte: ^5.18.0 => 5.18.0\n```\n\n### Severity\n\nannoyance\n\n### Additional Information\n\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/13322/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/13322/timeline","performed_via_github_app":null,"state_reason":"completed"}