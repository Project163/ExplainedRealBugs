{"url":"https://api.github.com/repos/sveltejs/kit/issues/8559","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8559/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8559/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8559/events","html_url":"https://github.com/sveltejs/kit/issues/8559","id":1535566733,"node_id":"I_kwDOEiPr8c5bhuON","number":8559,"title":"Base hrefs are not supported in prerendering","user":{"login":"tontonsb","id":16481303,"node_id":"MDQ6VXNlcjE2NDgxMzAz","avatar_url":"https://avatars.githubusercontent.com/u/16481303?v=4","gravatar_id":"","url":"https://api.github.com/users/tontonsb","html_url":"https://github.com/tontonsb","followers_url":"https://api.github.com/users/tontonsb/followers","following_url":"https://api.github.com/users/tontonsb/following{/other_user}","gists_url":"https://api.github.com/users/tontonsb/gists{/gist_id}","starred_url":"https://api.github.com/users/tontonsb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tontonsb/subscriptions","organizations_url":"https://api.github.com/users/tontonsb/orgs","repos_url":"https://api.github.com/users/tontonsb/repos","events_url":"https://api.github.com/users/tontonsb/events{/privacy}","received_events_url":"https://api.github.com/users/tontonsb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":4343790735,"node_id":"LA_kwDOEiPr8c8AAAABAuj8jw","url":"https://api.github.com/repos/sveltejs/kit/labels/low%20hanging%20fruit","name":"low hanging fruit","color":"0e8a16","default":false,"description":""},{"id":5086744039,"node_id":"LA_kwDOEiPr8c8AAAABLzGN5w","url":"https://api.github.com/repos/sveltejs/kit/labels/ready%20to%20implement","name":"ready to implement","color":"fbca04","default":false,"description":"please submit PRs for these issues!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/4","html_url":"https://github.com/sveltejs/kit/milestone/4","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/4/labels","id":6613611,"node_id":"MDk6TWlsZXN0b25lNjYxMzYxMQ==","number":4,"title":"soon","description":"stuff we want to do as soon as time allows","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":78,"closed_issues":167,"state":"open","created_at":"2021-03-31T19:50:44Z","updated_at":"2025-10-03T13:11:43Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2023-01-16T22:45:26Z","updated_at":"2023-03-06T10:14:37Z","closed_at":"2023-03-06T10:14:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nIt appears that base hrefs (e.g. `<base href=\"/en/\">`) are not supported at the moment. I stumbled against two issues.\r\n\r\nOne issue is that the prerenderer/crawler grabs all hrefs and resolves the relative references against the current path. The result is something like this:\r\n\r\n- `subsection` resolved from `/en/section` => `/section/subsection`\r\n- `section` resolved from `/en/section/subsection` => `/section/section`\r\n\r\nNote that this works fine in the browser, the problem is only with the prerenderer. I tinkered around with the code and managed to fix it by resolving against `base` in [this line](https://github.com/sveltejs/kit/blob/a47b55aa6fc5211674b205f8a3a59b2c7b0af6e8/packages/kit/src/core/postbuild/prerender.js#L241) and the `base` itself is fairly easy to obtain in the `crawl()` that's called above.\r\n\r\nThe second issue is that the asset paths are relative. And the base href screws up all of them as `./_app` gets resolved to `/en/_app` in the browser. This could be solved by allowing to turn off the asset relativity. It might be as simple as allowing `/` in `config.kit.paths.assets`. Currently it is refused by a param check with the `Error: config.kit.paths.assets option must be an absolute path, if specified.` and `Error: config.kit.paths.assets option must not end with '/'.` checks.\r\n\r\n### Reproduction\r\n\r\nhttps://github.com/tontonsb/sveltekit-base-prerendering\r\n\r\nTry `npm run dev` and visit `http://localhost:5173/en` to observe that you can either follow links or directly visit `/en`, `/en/section` and `/en/section/subsection`.\r\n\r\nTo observe the problem with the crawler:\r\n1. Execute `npm run build` and you'll see `Not found: /section/subsection`\r\n2. OK, let's make the language prefix optional. Try `git checkout lang-optional` and `npm run build`. Now `/section/subsection` will work (as the `[[lang=lang]]` prefix is optional in this branch), but you'll stumble against `Not found: /section/section` when it tries to resolve `section` from `/section/subsection`.\r\n3. In case you want more fun, setting `config.kit.prerender.handleHttpError = 'warn'` will throw you into infinite `404 /section/section/section/sect...` :)\r\n\r\nTo observe the problem with assets:\r\n\r\n1. Do `git checkout assets` and `npm run build && npm run preview`.\r\n2. Browse around `http://localhost:4173/en`.\r\n3. Observe the errors in your console that report things like `Not found: /en/_app/immutable/start-c96f4d66.js`.\r\n\r\n### Logs\r\n\r\nExample of the crawler error when running `npm run build`:\r\n\r\n```Shell\r\nError: Not found: /section/subsection\r\n    at resolve (file:///path/to/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2493:18)\r\n    at resolve (file:///path/to/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2358:34)\r\n    at Object.#options.hooks.handle (file:///path/to/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2537:59)\r\n    at respond (file:///path/to/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2356:43)\r\nfile:///path/to/sveltekit-base-prerendering/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:27\r\n                                throw new Error(format(details));\r\n                                      ^\r\n\r\nError: 404 /section/subsection (linked from /en)\r\n    at file:///path/to/sveltekit-base-prerendering/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:27:11\r\n    at save (file:///path/to/sveltekit-base-prerendering/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:346:4)\r\n    at visit (file:///path/to/sveltekit-base-prerendering/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:195:3)\r\n[vite-plugin-sveltekit-compile] Prerendering failed with code 1\r\nerror during build:\r\nError: Prerendering failed with code 1\r\n    at ChildProcess.<anonymous> (file:///path/to/sveltekit-base-prerendering/node_modules/@sveltejs/kit/src/exports/vite/index.js:599:15)\r\n    at ChildProcess.emit (node:events:513:28)\r\n    at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12)\r\n```\r\n\r\nExample of the asset errors after `npm run build && npm run preview` in branch `assets`:\r\n```Shell\r\nError: Not found: /en/_app/immutable/start-c96f4d66.js\r\n    at resolve (file:///home/juris/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2493:18)\r\n    at resolve (file:///home/juris/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2358:34)\r\n    at Object.#options.hooks.handle (file:///home/juris/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2537:59)\r\n    at respond (file:///home/juris/sveltekit-base-prerendering/.svelte-kit/output/server/index.js:2356:43)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n```\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 5.10 Ubuntu 22.04.1 LTS 22.04.1 LTS (Jammy Jellyfish)\r\n    CPU: (8) x64 11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz\r\n    Memory: 4.66 GB / 7.61 GB\r\n    Container: Yes\r\n    Shell: 3.6.0 - /usr/bin/fish\r\n  Binaries:\r\n    Node: 16.17.0 - ~/.local/share/nvm/v16.17.0/bin/node\r\n    npm: 8.15.0 - ~/.local/share/nvm/v16.17.0/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-static: ^1.0.0 => 1.0.4 \r\n    @sveltejs/kit: ^1.0.0 => 1.1.1 \r\n    svelte: ^3.54.0 => 3.55.1 \r\n    vite: ^4.0.0 => 4.0.4 \r\n```\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\nIt seems that localization with a path prefix is not really possible unless one is willing to manually import a lang store and add a `/{$lang}/` prefix to all internal links.\r\n\r\nWhile some workarounds could be done as outlined above, the best solution would be official support for path prefixes. Be it with base href or other method of prepending the prefix to internal links.\r\n\r\nOn a related note it would be good to support something like a set of prerendering param values. E.g. I would like to render all my pages for `lang in ['', 'en']` even if no internal link points to some of them. Something like the `['*']` in `config.kit.prerender.entries`, but with fixed param values. In the case of prefix param it might even be something like `['/*', '/en/*']` in the same config param.","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8559/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8559/timeline","performed_via_github_app":null,"state_reason":"completed"}