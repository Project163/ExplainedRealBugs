{"url":"https://api.github.com/repos/sveltejs/kit/issues/8643","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8643/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8643/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8643/events","html_url":"https://github.com/sveltejs/kit/issues/8643","id":1551700436,"node_id":"I_kwDOEiPr8c5cfRHU","number":8643,"title":"Cookies API doesn't work with redirect helper in hooks","user":{"login":"peng-devs","id":37236002,"node_id":"MDQ6VXNlcjM3MjM2MDAy","avatar_url":"https://avatars.githubusercontent.com/u/37236002?v=4","gravatar_id":"","url":"https://api.github.com/users/peng-devs","html_url":"https://github.com/peng-devs","followers_url":"https://api.github.com/users/peng-devs/followers","following_url":"https://api.github.com/users/peng-devs/following{/other_user}","gists_url":"https://api.github.com/users/peng-devs/gists{/gist_id}","starred_url":"https://api.github.com/users/peng-devs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peng-devs/subscriptions","organizations_url":"https://api.github.com/users/peng-devs/orgs","repos_url":"https://api.github.com/users/peng-devs/repos","events_url":"https://api.github.com/users/peng-devs/events{/privacy}","received_events_url":"https://api.github.com/users/peng-devs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-01-21T05:23:14Z","updated_at":"2023-01-24T10:56:14Z","closed_at":"2023-01-24T10:56:14Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI have an auth token stored in cookies, and use hooks to validate the token.\r\nWhen the token expires, it should clear the cookie and then redirect to the login page.\r\nBut it does not, the redirect is successful but the cookies still exist.\r\n```\r\nif (token_is_expired(token) {\r\n  event.cookies.delete('auth');  // doesn't work\r\n  event.cookies.set('auth', '', { maxAge: 0 });  // doesn't work either\r\n  throw redirect(303, '/login');\r\n}\r\n```\r\n\r\n### Reproduction\r\n\r\nhttps://github.com/peng-devs/sveltekit-hooks-issue\r\n1. `npm run dev` and visit `http://localhost:5173/login`\r\n2. Click the login button\r\n3. You'll be automatically returned to the login page (to simulate the token expired situation).\r\n4. If the cookie is deleted, you'll see the login button, otherwise you'll only see the text 'already logged in'.\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 5.15 Ubuntu 20.04.4 LTS (Focal Fossa)\r\n    CPU: (6) x64 Intel(R) Core(TM) i5-8400 CPU @ 2.80GHz\r\n    Memory: 6.69 GB / 7.72 GB\r\n    Container: Yes\r\n    Shell: 5.8 - /usr/bin/zsh\r\n  Binaries:\r\n    Node: 16.15.0 - /usr/local/bin/node\r\n    npm: 9.2.0 - /usr/local/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^1.0.0 => 1.0.2\r\n    @sveltejs/kit: ^1.0.0 => 1.2.2\r\n    svelte: ^3.54.0 => 3.55.1\r\n    vite: ^4.0.0 => 4.0.4\r\n```\r\n\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8643/timeline","performed_via_github_app":null,"state_reason":"completed"}