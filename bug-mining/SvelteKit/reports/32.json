{"url":"https://api.github.com/repos/sveltejs/kit/issues/3731","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/3731/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/3731/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/3731/events","html_url":"https://github.com/sveltejs/kit/issues/3731","id":1124433945,"node_id":"I_kwDOEiPr8c5DBYAZ","number":3731,"title":"Make it clearer when client-side load is re-fetching data because the server-side load didn't use its wrapped fetch function","user":{"login":"Conduitry","id":16696352,"node_id":"MDQ6VXNlcjE2Njk2MzUy","avatar_url":"https://avatars.githubusercontent.com/u/16696352?v=4","gravatar_id":"","url":"https://api.github.com/users/Conduitry","html_url":"https://github.com/Conduitry","followers_url":"https://api.github.com/users/Conduitry/followers","following_url":"https://api.github.com/users/Conduitry/following{/other_user}","gists_url":"https://api.github.com/users/Conduitry/gists{/gist_id}","starred_url":"https://api.github.com/users/Conduitry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Conduitry/subscriptions","organizations_url":"https://api.github.com/users/Conduitry/orgs","repos_url":"https://api.github.com/users/Conduitry/repos","events_url":"https://api.github.com/users/Conduitry/events{/privacy}","received_events_url":"https://api.github.com/users/Conduitry/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470046,"node_id":"MDU6TGFiZWwyNDI4NDcwMDQ2","url":"https://api.github.com/repos/sveltejs/kit/labels/feature%20/%20enhancement","name":"feature / enhancement","color":"a2eeef","default":false,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":6,"created_at":"2022-02-04T17:18:01Z","updated_at":"2022-05-20T17:01:16Z","closed_at":"2022-05-20T17:01:16Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\n\nWhen using an external SDK in a `load` function without telling it what `fetch` to use (or if it doesn't have the ability to be told what `fetch` to use), the network response is not serialized into the server-rendered DOM, and on the client-side, the browser's native `fetch` doesn't know to first look for these serialized responses before making a network call. This results in degraded performance, because the same request is then performed again in the browser.\r\n\r\nThe solution here is for people to call the SDK on the server in an endpoint (preferably a shadow endpoint for this page, which will make this very easy), or to make sure they only call it client-side in `onMount`, say. However, there's no currently obvious way for people to know that this undesirable thing is even happening.\n\n### Describe the proposed solution\n\nIn dev mode, we could override the browser's `window.fetch` with our own version that we can configure to complain when it is called (and then call the underlying native `fetch`). We could enable this during the `load` for the initial hydration of the page.\r\n\r\nFor bonus points, the `load`'s `fetch` could call this patched `window.fetch` function in such a way as to tell it that it _shouldn't_ complain during this request. This would reduce false positives where there is (for whatever reason) a genuine reason to request additional data in the client's `load` that wasn't requested in the server's `load`, as long as it is done via the appropriate `fetch` function.\n\n### Alternatives considered\n\nWe could just document this, but that doesn't seem very discoverable. If someone's doing something that's probably wrong, we would like to tell them about it, rather than assuming that they've read the documentation and are keeping this in the back of their mind all the time.\n\n### Importance\n\nnice to have\n\n### Additional Information\n\nThis proposal arose from a conversation in the maintainers' chat about #3729.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/3731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/3731/timeline","performed_via_github_app":null,"state_reason":"completed"}