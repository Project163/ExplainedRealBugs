{"url":"https://api.github.com/repos/sveltejs/kit/issues/7514","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/7514/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/7514/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/7514/events","html_url":"https://github.com/sveltejs/kit/issues/7514","id":1437031575,"node_id":"I_kwDOEiPr8c5Vp1yX","number":7514,"title":"Using fetch from PageEvent results in the wrong content being cached in certain circumstances","user":{"login":"tedsteen","id":805034,"node_id":"MDQ6VXNlcjgwNTAzNA==","avatar_url":"https://avatars.githubusercontent.com/u/805034?v=4","gravatar_id":"","url":"https://api.github.com/users/tedsteen","html_url":"https://github.com/tedsteen","followers_url":"https://api.github.com/users/tedsteen/followers","following_url":"https://api.github.com/users/tedsteen/following{/other_user}","gists_url":"https://api.github.com/users/tedsteen/gists{/gist_id}","starred_url":"https://api.github.com/users/tedsteen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tedsteen/subscriptions","organizations_url":"https://api.github.com/users/tedsteen/orgs","repos_url":"https://api.github.com/users/tedsteen/repos","events_url":"https://api.github.com/users/tedsteen/events{/privacy}","received_events_url":"https://api.github.com/users/tedsteen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":2,"created_at":"2022-11-05T13:24:26Z","updated_at":"2022-11-15T21:17:01Z","closed_at":"2022-11-07T17:13:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWhen fetching from f.ex a graphql endpoint, most of the time the URL is the same but the body (query) is different. This causes the fetch provided by the PageLoad event to use the wrong cached data during hydration.\n\n### Reproduction\n\nHere's an example and description of the problem.\r\nhttps://github.com/tedsteen/reproducables/pull/1\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: macOS 13.0\r\n    CPU: (10) arm64 Apple M1 Pro\r\n    Memory: 1.08 GB / 32.00 GB\r\n    Shell: 5.9 - /opt/homebrew/bin/zsh\r\n  Binaries:\r\n    Node: 18.11.0 - /opt/homebrew/bin/node\r\n    npm: 8.19.2 - /opt/homebrew/bin/npm\r\n  Browsers:\r\n    Brave Browser: 107.1.45.116\r\n    Safari: 16.1\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.87\r\n    @sveltejs/kit: next => 1.0.0-next.535\r\n    svelte: ^3.44.0 => 3.52.0\r\n    vite: ^3.1.0 => 3.2.2\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\nI fixed this by creating a hash of the body sent to fetch and add it as a query parameter. Not sure if I'm missing something or this is a viable way to fix this.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/7514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/7514/timeline","performed_via_github_app":null,"state_reason":"completed"}