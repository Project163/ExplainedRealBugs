{"url":"https://api.github.com/repos/sveltejs/kit/issues/10142","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/10142/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/10142/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/10142/events","html_url":"https://github.com/sveltejs/kit/issues/10142","id":1751812928,"node_id":"I_kwDOEiPr8c5oaotA","number":10142,"title":"The `invalidate` function calls makes SvelteKit to send fetch request twice","user":{"login":"codercms","id":4526911,"node_id":"MDQ6VXNlcjQ1MjY5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/4526911?v=4","gravatar_id":"","url":"https://api.github.com/users/codercms","html_url":"https://github.com/codercms","followers_url":"https://api.github.com/users/codercms/followers","following_url":"https://api.github.com/users/codercms/following{/other_user}","gists_url":"https://api.github.com/users/codercms/gists{/gist_id}","starred_url":"https://api.github.com/users/codercms/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codercms/subscriptions","organizations_url":"https://api.github.com/users/codercms/orgs","repos_url":"https://api.github.com/users/codercms/repos","events_url":"https://api.github.com/users/codercms/events{/privacy}","received_events_url":"https://api.github.com/users/codercms/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-06-12T03:15:27Z","updated_at":"2023-06-23T07:58:24Z","closed_at":"2023-06-23T07:58:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nWhen the `depends` argument is used in the `load` function and the `invalidate` function is called more than once, but with different arguments it makes SvelteKit to send fetch request twice.\r\n\r\nHere is small example:\r\n```js\r\n// load function\r\n** @type {import('./$types').PageLoad} */\r\nexport async function load({ depends, fetch }) {\r\n        console.log('load called');\r\n\r\n\tdepends('button:clicked');\r\n\r\n\tconst resp = await fetch('...some resource');\r\n\tconst json = await resp.json();\r\n\r\n\treturn {\r\n\t\tsomeData: json\r\n\t};\r\n}\r\n\r\n// and now try to invalidate somewhere in route/component like this:\r\ninvalidate('something:else');\r\ninvalidate('button:clicked');\r\n```\r\n\r\n### Reproduction\r\n\r\nhttps://stackblitz.com/edit/stackblitz-starters-pxex3p?file=src%2Froutes%2F%2Bpage.js,src%2Froutes%2F%2Bpage.svelte\r\n\r\nOpen DevTools, Network tab and click on the \"Invalidate\" button\r\n\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 5.0 undefined\r\n    CPU: (8) x64 Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz\r\n    Memory: 0 Bytes / 0 Bytes\r\n    Shell: 1.0 - /bin/jsh\r\n  Binaries:\r\n    Node: 16.14.2 - /usr/local/bin/node\r\n    Yarn: 1.22.19 - /usr/local/bin/yarn\r\n    npm: 9.4.2 - /usr/local/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^2.0.0 => 2.1.0 \r\n    @sveltejs/kit: ^1.5.0 => 1.20.2 \r\n    svelte: ^3.54.0 => 3.59.1 \r\n    vite: ^4.3.0 => 4.3.9\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/10142/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/10142/timeline","performed_via_github_app":null,"state_reason":"completed"}