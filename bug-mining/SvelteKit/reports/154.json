{"url":"https://api.github.com/repos/sveltejs/kit/issues/6458","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6458/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6458/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6458/events","html_url":"https://github.com/sveltejs/kit/issues/6458","id":1356823278,"node_id":"I_kwDOEiPr8c5Q33ru","number":6458,"title":"Cache problem with client-side navigation: the response is now __data.js instead of __data.json","user":{"login":"kristjanmar","id":22234692,"node_id":"MDQ6VXNlcjIyMjM0Njky","avatar_url":"https://avatars.githubusercontent.com/u/22234692?v=4","gravatar_id":"","url":"https://api.github.com/users/kristjanmar","html_url":"https://github.com/kristjanmar","followers_url":"https://api.github.com/users/kristjanmar/followers","following_url":"https://api.github.com/users/kristjanmar/following{/other_user}","gists_url":"https://api.github.com/users/kristjanmar/gists{/gist_id}","starred_url":"https://api.github.com/users/kristjanmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kristjanmar/subscriptions","organizations_url":"https://api.github.com/users/kristjanmar/orgs","repos_url":"https://api.github.com/users/kristjanmar/repos","events_url":"https://api.github.com/users/kristjanmar/events{/privacy}","received_events_url":"https://api.github.com/users/kristjanmar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":4,"created_at":"2022-08-31T05:55:34Z","updated_at":"2022-09-20T09:16:08Z","closed_at":"2022-09-20T09:16:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI believe the recent change where client-side navigation responds with __data.js instead of __data.json can be problematic.\r\n\r\nI have Cloudflare on my site and I just realized that the __data.js files that are returned when navigating between pages are being cached on the edge and possibly also in the browser cache. I don't have any custom page rules for .js files in Cloudflare, this is the default behavior.\r\n\r\nIn some cases, the \"age\" in the response headers is showing very high numbers, much higher than what I have in my s-max-age cache-control headers in hooks.js (which used to cache on Vercel edge only, not Cloudflare).\r\n\r\n![681e4b3be00bfa462433bc8450004e6b](https://user-images.githubusercontent.com/22234692/187604022-d8085af7-1ebe-4a9a-a157-5d79be60fd98.png)\r\n\r\nThis means that many users are potentially seeing very old and outdated info for pages that are supposed to be highly dynamic.\r\n\r\n### Reproduction\r\n\r\nI don't think I can set up a reproduction since it would require a custom domain and adding it to Cloudflare.\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: Windows 10 10.0.22000\r\n    CPU: (32) x64 AMD Ryzen 9 5950X 16-Core Processor\r\n    Memory: 50.08 GB / 63.91 GB\r\n  Binaries:\r\n    Node: 16.16.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 8.11.0 - C:\\Program Files\\nodejs\\npm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.22000.120.0), Chromium (104.0.1293.70)\r\n    Internet Explorer: 11.0.22000.120\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: 1.0.0-next.69 => 1.0.0-next.70\r\n    @sveltejs/kit: 1.0.0-next.454 => 1.0.0-next.456\r\n    svelte: ^3.49.0 => 3.49.0\r\n    vite: 3.1.0-beta.1 => 3.1.0-beta.1\r\n```\r\n\r\n\r\n### Severity\r\n\r\nBlocking an upgrade\r\n\r\n### Additional Information\r\n\r\nUpdate: I rolled back to 446 for now since the 447 update seems to also have introduced a bunch of weird issues with both Sentry and Plausible Analytics.","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6458/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6458/timeline","performed_via_github_app":null,"state_reason":"completed"}