{"url":"https://api.github.com/repos/sveltejs/kit/issues/5951","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5951/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5951/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5951/events","html_url":"https://github.com/sveltejs/kit/issues/5951","id":1340903538,"node_id":"I_kwDOEiPr8c5P7JBy","number":5951,"title":"Introduce a feature for bottom-up page-to-layout communication","user":{"login":"aradalvand","id":26527405,"node_id":"MDQ6VXNlcjI2NTI3NDA1","avatar_url":"https://avatars.githubusercontent.com/u/26527405?v=4","gravatar_id":"","url":"https://api.github.com/users/aradalvand","html_url":"https://github.com/aradalvand","followers_url":"https://api.github.com/users/aradalvand/followers","following_url":"https://api.github.com/users/aradalvand/following{/other_user}","gists_url":"https://api.github.com/users/aradalvand/gists{/gist_id}","starred_url":"https://api.github.com/users/aradalvand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aradalvand/subscriptions","organizations_url":"https://api.github.com/users/aradalvand/orgs","repos_url":"https://api.github.com/users/aradalvand/repos","events_url":"https://api.github.com/users/aradalvand/events{/privacy}","received_events_url":"https://api.github.com/users/aradalvand/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2539682476,"node_id":"MDU6TGFiZWwyNTM5NjgyNDc2","url":"https://api.github.com/repos/sveltejs/kit/labels/types%20/%20typescript","name":"types / typescript","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":42,"created_at":"2022-08-16T21:31:52Z","updated_at":"2022-08-25T15:49:23Z","closed_at":"2022-08-25T15:49:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\r\n\r\nPrior to the recent API overhaul (#5748), I used to have a `Meta.svelte` component that was rendered by my root layout. This component would read from `$page.stuff` — which I had typed in `app.d.ts` — and set various page-level head tags such as `<title>`, `<meta name=\"description\">` and so on based on those `stuff` values. Every page would then have to provide this information in its `load` function, like so:\r\n```ts\r\nexport function load() {\r\n  return {\r\n    stuff: {\r\n      meta: {\r\n        title: 'Home page',\r\n        titleSuffix: 'long',\r\n        description: 'Blah blah blah'\r\n      }\r\n    }\r\n  };\r\n}\r\n```\r\n\r\nMy `app.d.ts` file looked something like:\r\n```ts\r\ndeclare namespace App {\r\n  interface Stuff {\r\n    meta: {\r\n      title: string;\r\n      titleSuffix?: 'short' | 'long' | 'none';\r\n      description?: string;\r\n    };\r\n  }\r\n}\r\n```\r\n\r\nAnd the `<Meta>` component:\r\n```svelte\r\n<script lang=\"ts\">\r\n  import { page } from '$app/stores';\r\n\r\n  const titleSuffixes = new Map<TitleSuffix, string>([\r\n    ['short', ' | Foo'],\r\n    ['long', ' | Foo Bar Buzz'],\r\n    ['none', '']\r\n  ]);\r\n\r\n  $: ({\r\n    title,\r\n    titleSuffix = 'short',\r\n    description,\r\n  } = $page.stuff.meta);\r\n</script>\r\n\r\n<svelte:head>\r\n  <title>{title + titleSuffixes.get(titleSuffix)}</title>\r\n\r\n  {#if description}\r\n    <meta name=\"description\" content={description} />\r\n  {/if}\r\n</svelte:head>\r\n```\r\n\r\nNow, ever since the API has been re-designed and the `stuff` thing has been removed, I've been struggling to re-create this properly.\r\nAsking questions on the Discord server and reading [this part](https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693:~:text=The%20data%20from%20all%20your%20load%20functions%20(or%20%2Blayout.server.js/%2Bpage.server.js%20files)%20is%20merged%20into%20a%20single%20object%20that%20can%20be%20used%20anywhere%20in%20your%20app%20via%20%24page.data%2C%20which%20replaces%20%24page.stuff.) of the migration guide lead me to think that returning this information as part of the data returned by each load function is apparently the way things like this are meant to be handled now. But I find that this is an almost unacceptable alternative, for two major reasons + a more minor one:\r\n1. No type-safety while providing the values in the load functions:\r\n```ts\r\nexport const load: PageLoad = () => {\r\n  return {\r\n    meta: {\r\n      title: true, // Nothing's preventing me from doing this\r\n      titleSuffix: 'somenonsense', // or this\r\n      descriptititoitnotintotn: 'Blah blah blah', // or this \r\n    }\r\n  };\r\n};\r\n```\r\n2. No type-safety while reading the values in the `<Meta>` component\r\n\r\n`Meta.svelte`:\r\n```svelte\r\n<script lang=\"ts\">\r\n    import { page } from '$app/stores';\r\n</script>\r\n\r\n<svelte:head>\r\n    <!-- Absolutely no type-safety here, `meta` is `any` -->\r\n    <title>{$page.data.meta.title}</title>\r\n</svelte:head>\r\n```\r\n3. These values will be visible from the `+page.svelte` file included as part of its `data` prop, which is weird since it's actually none of its business.\r\n\r\n![image](https://user-images.githubusercontent.com/26527405/184986989-6fc15e7c-b041-4c39-b2a6-330e676527a0.png)\r\n`meta` isn't really something that this page is concerned with, so this is slightly awkward.\r\n\r\nThis (particularly the lack of type-safety) clearly yields a drastically poorer developer experience compared to the previous API. I sense that not enough thought has been put into this particular requirement when re-designing the API, namely bottom-up communication between pages and layouts. Page data isn't really fit for this use case at all.\r\n\r\n### Describe the proposed solution\r\n\r\nI don't have a clear-cut proposal here, the general idea is that perhaps you could consider introducing a new construct designed specifically for bottom-up page-to-layout communication, in order to properly accommodate use cases like this, which are by no means uncommon or unusual, or niche. It actually gets more complex in a real-world app where there are typically multiple levels of layouts, and each of them receives a different set of configurations/settings; which is why I believe this is something that deserves a dedicated feature, so to speak.\r\n\r\n### Importance\r\n\r\ncrucial\r\n\r\n### Additional Information\r\n\r\nPlease don't just hand wave this away, thanks. I know it's annoying that literally dozens of issues get created on this repo every single day and naturally it's almost impossible to give each and every single one of them a lot of attention, but this one is a real problem, I think, and one that is in need of a response from your side.\r\n\r\nAnd tell me if I'm missing something, because I certainly raised an eyebrow while trying to do this but failing to find a satisfying solution, so it's possible that I'm unaware of something here.","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5951/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5951/timeline","performed_via_github_app":null,"state_reason":"completed"}