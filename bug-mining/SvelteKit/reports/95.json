{"url":"https://api.github.com/repos/sveltejs/kit/issues/6243","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6243/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6243/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6243/events","html_url":"https://github.com/sveltejs/kit/issues/6243","id":1350040150,"node_id":"I_kwDOEiPr8c5Qd_pW","number":6243,"title":"Page with +page.server.ts but SSR disabled breaks site (__data.json not found, infinite redirection loop)","user":{"login":"aloker","id":140714,"node_id":"MDQ6VXNlcjE0MDcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/140714?v=4","gravatar_id":"","url":"https://api.github.com/users/aloker","html_url":"https://github.com/aloker","followers_url":"https://api.github.com/users/aloker/followers","following_url":"https://api.github.com/users/aloker/following{/other_user}","gists_url":"https://api.github.com/users/aloker/gists{/gist_id}","starred_url":"https://api.github.com/users/aloker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aloker/subscriptions","organizations_url":"https://api.github.com/users/aloker/orgs","repos_url":"https://api.github.com/users/aloker/repos","events_url":"https://api.github.com/users/aloker/events{/privacy}","received_events_url":"https://api.github.com/users/aloker/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-08-24T21:27:43Z","updated_at":"2022-08-25T06:31:43Z","closed_at":"2022-08-25T01:36:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe following scenario:\r\n- A route with +page.svelte and +page.server.ts\r\n- SSR disabled for said route via hooks.ts\r\n\r\nDuring dev this works fine:\r\nNo matter whether the route is invoked directly or visited through client side routing, the loads its __data.json and renders fine (if called directly, no server side rendering takes place as expected)\r\n\r\nHowever, in production mode (tested with Vercel, node and Azure SWA) visiting the route causes an infinite redirection loop in the browser. The request for __data.json causes a 404. \r\n\r\nThe same behavior occurs when there's a +layout.server.ts involved. \n\n### Reproduction\n\nExample repo: https://github.com/aloker/kit-non-ssr-data-issue\r\nThe main branch uses adapter-auto, the [adapter-node](https://github.com/aloker/kit-non-ssr-data-issue/tree/adapter-node) branch uses adapter-node\r\n\r\nNotice that this runs fine in dev-mode and when running tests. \r\n\r\nVercel-deployment: https://kit-non-ssr-data-issue.vercel.app/\r\n\r\nNode deployment: check out adapter-node branch, build project and run `node build`. Visiting `http://localhost:3000` exposes the issue.\r\n\n\n### Logs\n\n_No response_\n\n### System Info\n\n```shell\nSystem:\r\n    OS: Linux 5.19 Pop!_OS 22.04 LTS\r\n    CPU: (24) x64 AMD Ryzen 9 5900X 12-Core Processor\r\n    Memory: 11.47 GB / 31.27 GB\r\n    Container: Yes\r\n    Shell: 5.8.1 - /usr/bin/zsh\r\n  Binaries:\r\n    Node: 16.13.1 - ~/.nvm/versions/node/v16.13.1/bin/node\r\n    npm: 8.12.2 - ~/.nvm/versions/node/v16.13.1/bin/npm\r\n  Browsers:\r\n    Brave Browser: 104.1.42.97\r\n    Chrome: 104.0.5112.79\r\n    Firefox: 103.0\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.66 \r\n    @sveltejs/adapter-node: 1.0.0-next.87 => 1.0.0-next.87 \r\n    @sveltejs/kit: next => 1.0.0-next.435 \r\n    svelte: ^3.44.0 => 3.49.0 \r\n    vite: ^3.0.4 => 3.0.9\n```\n\n\n### Severity\n\nblocking an upgrade\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6243/timeline","performed_via_github_app":null,"state_reason":"completed"}