{"url":"https://api.github.com/repos/sveltejs/kit/issues/8272","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8272/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8272/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8272/events","html_url":"https://github.com/sveltejs/kit/issues/8272","id":1512565611,"node_id":"I_kwDOEiPr8c5aJ-tr","number":8272,"title":"client side navigation incorrectly re-uses `data` from previous request ","user":{"login":"ivanhofer","id":21335119,"node_id":"MDQ6VXNlcjIxMzM1MTE5","avatar_url":"https://avatars.githubusercontent.com/u/21335119?v=4","gravatar_id":"","url":"https://api.github.com/users/ivanhofer","html_url":"https://github.com/ivanhofer","followers_url":"https://api.github.com/users/ivanhofer/followers","following_url":"https://api.github.com/users/ivanhofer/following{/other_user}","gists_url":"https://api.github.com/users/ivanhofer/gists{/gist_id}","starred_url":"https://api.github.com/users/ivanhofer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivanhofer/subscriptions","organizations_url":"https://api.github.com/users/ivanhofer/orgs","repos_url":"https://api.github.com/users/ivanhofer/repos","events_url":"https://api.github.com/users/ivanhofer/events{/privacy}","received_events_url":"https://api.github.com/users/ivanhofer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-12-28T08:53:40Z","updated_at":"2023-02-07T16:30:35Z","closed_at":"2023-02-07T16:30:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe `load_route` function re-uses data from a previous result if `loaders` array does not have any data to load at a specific index. In my case I first load data where 5 different `loaders` are involved. On the next page (which includes a layout reset) only 3 loaders are involved. The last one does not provide any data and `SvelteKit` uses the `data` from the previous request, which is wrong since that data should not be involved in the rendering process becasue of the layout reset.\r\n\r\n![image](https://user-images.githubusercontent.com/21335119/209779843-b8caff59-8991-4112-9ec1-e55646833e31.png)\r\n\r\n> those logs were created by adding `console.log(1, url.pathname, branch.map(({ data }) => data));` [here](https://github.com/sveltejs/kit/blob/master/packages/kit/src/runtime/client/client.js#L417).\r\n\r\nMarked in red is the `data` at the specific index that causes the issue. The first log comes from the initial page load. The second log is a client-side navigation and the third on is a page reload. Marked in orange is the `data` that get's set incorrectly from the previous response. It should actully be `null` like in log line nr 3.\r\n\r\nMy specific use case works if I delete [this line](https://github.com/sveltejs/kit/blob/master/packages/kit/src/runtime/client/client.js#L715). But I don't fully understand everything that happens here. Something in this invalidation logic is wrong. Or maybe the code where `branch_promises` gets set.\r\n\r\nThe whole `data` logic seems really buggy (see #8157).\n\n### Reproduction\n\nI'm sorry, I was not able to reproduce this in a fresh repo in the limited time I had.\r\n\r\nLet me know if the description isn't enough and I will try to find some time to create a stackblitz example.\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: Linux 5.15 Ubuntu 20.04.5 LTS (Focal Fossa)\r\n    CPU: (8) x64 11th Gen Intel(R) Core(TM) i7-11370H @ 3.30GHz\r\n    Memory: 1.48 GB / 9.72 GB\r\n    Container: Yes\r\n    Shell: 5.8 - /usr/bin/zsh\r\n  Binaries:\r\n    Node: 16.18.1 - ~/.volta/tools/image/node/16.18.1/bin/node\r\n    Yarn: 1.22.17 - ~/.volta/tools/image/yarn/1.22.17/bin/yarn\r\n    npm: 8.19.2 - ~/.volta/tools/image/node/16.18.1/bin/npm\r\n  Browsers:\r\n    Chrome: 108.0.5359.98\r\n  npmPackages:\r\n    @sveltejs/adapter-node: 1.0.0 => 1.0.0 \r\n    @sveltejs/kit: 1.0.0 => 1.0.0 \r\n    svelte: 3.55.0 => 3.55.0 \r\n    vite: ^4.0.1 => 4.0.1\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\nMy current workaround is it to create an empty `+page.server.ts`. The file does not need to export a `load` function. The simple presence of that file is enough (see #7967).","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8272/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8272/timeline","performed_via_github_app":null,"state_reason":"completed"}