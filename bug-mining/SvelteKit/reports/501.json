{"url":"https://api.github.com/repos/sveltejs/kit/issues/13255","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/13255/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/13255/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/13255/events","html_url":"https://github.com/sveltejs/kit/issues/13255","id":2762649025,"node_id":"I_kwDOEiPr8c6kqq3B","number":13255,"title":"Setting `trailingSlash = \"always\"` in layout with a `srr = false` page causes 404 errors in prod","user":{"login":"peterreeves","id":14709906,"node_id":"MDQ6VXNlcjE0NzA5OTA2","avatar_url":"https://avatars.githubusercontent.com/u/14709906?v=4","gravatar_id":"","url":"https://api.github.com/users/peterreeves","html_url":"https://github.com/peterreeves","followers_url":"https://api.github.com/users/peterreeves/followers","following_url":"https://api.github.com/users/peterreeves/following{/other_user}","gists_url":"https://api.github.com/users/peterreeves/gists{/gist_id}","starred_url":"https://api.github.com/users/peterreeves/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterreeves/subscriptions","organizations_url":"https://api.github.com/users/peterreeves/orgs","repos_url":"https://api.github.com/users/peterreeves/repos","events_url":"https://api.github.com/users/peterreeves/events{/privacy}","received_events_url":"https://api.github.com/users/peterreeves/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-12-30T04:57:13Z","updated_at":"2025-01-06T10:42:53Z","closed_at":"2025-01-06T10:42:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI have a project using `adapter-static`. I've set up the following in my `src/+layout.server.js` file:\r\n```js\r\nexport const prerender = true;\r\nexport const trailingSlash = \"always\";\r\n```\r\n(Unfortunately the hosting setup I'm using requires `trailingSlash` set to `\"always\"`)\r\n\r\nIf I have a route `src/foo/+page.svelte` that isn't able to be server side rendered, creating a `src/foo/+page.js` file and filling it with:\r\n```js\r\nexport const ssr = false;\r\n```\r\nwill work fine in dev. But in prod (or using Vite's preview mode) the page 404s. The network inspector says it's failing to fetch something at:\r\n```\r\n/foo/__data.json?x-sveltekit-trailing-slash=1&x-sveltekit-invalidated=10\r\n```\r\nThis file doesn't exist in the build output, but for some reason the site is asking for it.\r\n\r\nTo my surprise, this also works for the route page, if it also disables SSR.\r\n\r\nRemoving the `trailingSlash = \"always\"` or the `ssr = false` options makes the site work again.\r\n\r\n### Reproduction\r\n\r\nCreate a blank SvelteKit Project using `adapter-static` as it's output.\r\n\r\nCreate a `src/+layout.server.js` file:\r\n```js\r\nexport const prerender = true;\r\nexport const trailingSlash = \"always\";\r\n```\r\n\r\nCreate a `src/+page.js` file:\r\n```js\r\nexport const ssr = false;\r\n```\r\n\r\nRun `npm run dev`. Observe that the page works fine in dev.\r\n\r\nRun `npm run build` and `npm run preview`. Observe that the page shows a 404 error.\r\n\r\nI have created a [StackBliz project showing the effect](https://stackblitz.com/edit/trailing-slash-bug)\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Windows 11 10.0.26100\r\n    CPU: (24) x64 AMD Ryzen 9 5900X 12-Core Processor\r\n    Memory: 16.80 GB / 31.91 GB\r\n  Binaries:\r\n    Node: 22.5.1 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 10.9.0 - C:\\Program Files\\nodejs\\npm.CMD\r\n    pnpm: 8.15.5 - ~\\AppData\\Local\\pnpm\\pnpm.CMD\r\n  Browsers:\r\n    Edge: Chromium (131.0.2903.86)\r\n    Internet Explorer: 11.0.26100.1882\r\n  npmPackages:\r\n    @sveltejs/adapter-static: ^3.0.8 => 3.0.8\r\n    @sveltejs/kit: ^2.15.1 => 2.15.1\r\n    @sveltejs/vite-plugin-svelte: ^4.0.0 => 4.0.4\r\n    svelte: ^5.16.0 => 5.16.0\r\n    vite: ^5.0.0 => 5.4.11\r\n```\r\n\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/13255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/13255/timeline","performed_via_github_app":null,"state_reason":"completed"}