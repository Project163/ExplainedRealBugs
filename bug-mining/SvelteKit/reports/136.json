{"url":"https://api.github.com/repos/sveltejs/kit/issues/6558","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6558/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6558/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6558/events","html_url":"https://github.com/sveltejs/kit/issues/6558","id":1361018554,"node_id":"I_kwDOEiPr8c5RH366","number":6558,"title":"Conditional request handling makes output caching difficult","user":{"login":"CaptainCodeman","id":304910,"node_id":"MDQ6VXNlcjMwNDkxMA==","avatar_url":"https://avatars.githubusercontent.com/u/304910?v=4","gravatar_id":"","url":"https://api.github.com/users/CaptainCodeman","html_url":"https://github.com/CaptainCodeman","followers_url":"https://api.github.com/users/CaptainCodeman/followers","following_url":"https://api.github.com/users/CaptainCodeman/following{/other_user}","gists_url":"https://api.github.com/users/CaptainCodeman/gists{/gist_id}","starred_url":"https://api.github.com/users/CaptainCodeman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CaptainCodeman/subscriptions","organizations_url":"https://api.github.com/users/CaptainCodeman/orgs","repos_url":"https://api.github.com/users/CaptainCodeman/repos","events_url":"https://api.github.com/users/CaptainCodeman/events{/privacy}","received_events_url":"https://api.github.com/users/CaptainCodeman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3229669367,"node_id":"MDU6TGFiZWwzMjI5NjY5MzY3","url":"https://api.github.com/repos/sveltejs/kit/labels/breaking%20change","name":"breaking change","color":"F859C7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":3,"created_at":"2022-09-04T03:04:34Z","updated_at":"2022-09-07T12:50:15Z","closed_at":"2022-09-07T12:50:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\n\nSvelteKit has built-in [support for conditional request handling](https://github.com/sveltejs/kit/blob/164cddb9577335ef08a0fe1ed2d492f6b60db0f4/packages/kit/src/runtime/server/index.js#L278), to provide a \"304 Not Modified\" response if the client already has the resource requested. This is great, and can save bandwidth and reduce TTLB.\r\n\r\nHowever, if you want to use output caching (either in-memory or via Redis or Memcached) in order to avoid the complete render + data-access part and improve TTFB, it is a little awkward to work around.\r\n\r\nUnless you remove the `if-none-match` header and re-create how it is handled _after_ the `resolve(event)` call the response you get may have already been turned into a \"304 Not Modified\" response, denying the ability to cache it. On a site with mostly static content and lots of repeat visitors, this might negatively affect cache-hit ratios.\r\n\r\nAlso, because the handling of it is done inside of `resolve(event)`, if you _have_ a cached response to return, you now miss out on sending the \"304 Not Modified\" response (unless you have re-created the code, in your own `handle` method).\n\n### Describe the proposed solution\n\nIf the conditional handling was _after_ the hooks handle call it would be more straight-forward to return a cached response and also have _that_ response be evaluated.\n\n### Alternatives considered\n\nUsing a custom server with the node-adapter and some caching middleware, but it may be something that non-node deploys would benefit from too.\n\n### Importance\n\nnice to have\n\n### Additional Information\n\nRemoving the http header and re-implementing the conditional handling works, but feels kludgy.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6558/timeline","performed_via_github_app":null,"state_reason":"completed"}