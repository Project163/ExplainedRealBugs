{"url":"https://api.github.com/repos/sveltejs/kit/issues/5028","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5028/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5028/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5028/events","html_url":"https://github.com/sveltejs/kit/issues/5028","id":1244305935,"node_id":"I_kwDOEiPr8c5KKpoP","number":5028,"title":"Typescript cannot find types when using `NodeNext` or `Node16` modules","user":{"login":"adam-coster","id":28758057,"node_id":"MDQ6VXNlcjI4NzU4MDU3","avatar_url":"https://avatars.githubusercontent.com/u/28758057?v=4","gravatar_id":"","url":"https://api.github.com/users/adam-coster","html_url":"https://github.com/adam-coster","followers_url":"https://api.github.com/users/adam-coster/followers","following_url":"https://api.github.com/users/adam-coster/following{/other_user}","gists_url":"https://api.github.com/users/adam-coster/gists{/gist_id}","starred_url":"https://api.github.com/users/adam-coster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adam-coster/subscriptions","organizations_url":"https://api.github.com/users/adam-coster/orgs","repos_url":"https://api.github.com/users/adam-coster/repos","events_url":"https://api.github.com/users/adam-coster/events{/privacy}","received_events_url":"https://api.github.com/users/adam-coster/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2539682476,"node_id":"MDU6TGFiZWwyNTM5NjgyNDc2","url":"https://api.github.com/repos/sveltejs/kit/labels/types%20/%20typescript","name":"types / typescript","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":0,"created_at":"2022-05-22T16:36:16Z","updated_at":"2022-05-24T15:13:55Z","closed_at":"2022-05-24T15:13:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nTypescript 4.7+ includes new the new `\"Node16\"`/`\"NodeNext\"` options for configuration options `\"module\"` and `\"moduleResolution\"`. These adhere strictly to Node's `package.json` `\"exports\"` fields rules -- when that field is set the other root fields (like `\"types\"`) are ignored.\r\n\r\nThe `package.json` for `@sveltejs/adapter-static`, and presumably other SvelteKit packages, does not list types in its `\"exports\"` field, causing Typescript to be unable to find types when using `NodeNext` module strategies.\r\n\r\nIt's an easy fix, and Typescript 4.7 is still in beta so the impact of this will slowly grow as adoption of latest Typescript versions increases.\r\n\r\nHere's the diff generated via `patch-package` for `@sveltejs/adapter-static`:\r\n\r\n```diff\r\ndiff --git a/node_modules/@sveltejs/adapter-static/package.json b/node_modules/@sveltejs/adapter-static/package.json\r\nindex c3f39a0..6c0dac8 100644\r\n--- a/node_modules/@sveltejs/adapter-static/package.json\r\n+++ b/node_modules/@sveltejs/adapter-static/package.json\r\n@@ -12,6 +12,7 @@\r\n   \"main\": \"index.js\",\r\n   \"exports\": {\r\n     \".\": {\r\n+      \"types\": \"./index.d.ts\",\r\n       \"import\": \"./index.js\"\r\n     },\r\n     \"./package.json\": \"./package.json\"\r\n```\r\n\r\n### Reproduction\r\n\r\nWith Typescript 4.7-beta and \"module\" set to \"ESNext\" or \"NodeNext\", we get an error finding the types:\r\n\r\nhttps://www.typescriptlang.org/play?moduleResolution=99&target=99&jsx=0&allowSyntheticDefaultImports=true&ts=4.7.0-beta#code/JYWwDg9gTgLgBAQwCYLDAplAyjBNgDGcAZlBCHAOQACAzgG7oA2GAVrQPTKoZQC0tXPgKUA3EA\r\n\r\nIf we change the \"module\" to \"CommonJs\", the types are found successfully (ignore the newly-revealed error, it's unrelated to this issue):\r\n\r\nhttps://www.typescriptlang.org/play?target=99&ts=4.7.0-beta&jsx=0&module=1&allowSyntheticDefaultImports=true#code/JYWwDg9gTgLgBAQwCYLDAplAyjBNgDGcAZlBCHAOQACAzgG7oA2GAVrQPTKoZQC0tXPgKUA3EA\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n  OS: Windows 10 10.0.22000\r\n  CPU: (20) x64 12th Gen Intel(R) Core(TM) i7-12700KF\r\n  Memory: 43.34 GB / 63.82 GB\r\nBinaries:\r\n  Node: 16.14.2 - ~\\AppData\\Local\\Volta\\tools\\image\\node\\16.14.2\\node.EXE\r\n  npm: 8.10.0 - ~\\AppData\\Local\\Volta\\tools\\image\\npm\\8.10.0\\bin\\npm.CMD\r\nBrowsers:\r\n  Edge: Spartan (44.22000.), Chromium (101.0.121)\r\n  Internet Explorer: 11.0.22000.120\r\nnpmPackages:\r\n  @sveltejs/adapter-static: ^1.0.0-next.31 => 1.0.0-next.31 \r\n  @sveltejs/kit: ^1.0.0-next.338 => 1.0.0-next.338\r\n```\r\n\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5028/timeline","performed_via_github_app":null,"state_reason":"completed"}