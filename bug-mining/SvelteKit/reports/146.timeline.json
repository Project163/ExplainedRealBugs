[{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1247890963","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1247890963","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1247890963,"node_id":"IC_kwDOEiPr8c5KYU4T","user":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T10:13:58Z","updated_at":"2022-09-15T10:13:58Z","body":"Could you clarify if this is a typing issue (the types are incorrect) or a runtime issue (something isn't showing up in `export let form` as you would expect)?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1247890963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1247891860","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1247891860","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1247891860,"node_id":"IC_kwDOEiPr8c5KYVGU","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T10:14:47Z","updated_at":"2022-09-15T10:14:47Z","body":"> Could you clarify if this is a typing issue (the types are incorrect) or a runtime issue (something isn't showing up in `export let form` as you would expect)?\r\n\r\nThis is a typing issue","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1247891860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7393570837,"node_id":"LE_lADOEiPr8c5R6WHnzwAAAAG4sPAV","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7393570837","actor":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-09-15T10:18:13Z","label":{"name":"types / typescript","color":"bfdadc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248258561","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248258561","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248258561,"node_id":"IC_kwDOEiPr8c5KZuoB","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T15:25:19Z","updated_at":"2022-09-15T15:25:19Z","body":"I am experiencing the same.\r\n\r\nI would much more prefer having the ActionData type to be:\r\n\r\n```ts\r\ntype ActionData = {\r\n    first: string | undefined,\r\n    second: string | undefined,\r\n    third: string | undefined,\r\n    fourth: string |undefined\r\n}\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248258561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248292629","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248292629","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248292629,"node_id":"IC_kwDOEiPr8c5KZ28V","user":{"login":"aloker","id":140714,"node_id":"MDQ6VXNlcjE0MDcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/140714?v=4","gravatar_id":"","url":"https://api.github.com/users/aloker","html_url":"https://github.com/aloker","followers_url":"https://api.github.com/users/aloker/followers","following_url":"https://api.github.com/users/aloker/following{/other_user}","gists_url":"https://api.github.com/users/aloker/gists{/gist_id}","starred_url":"https://api.github.com/users/aloker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aloker/subscriptions","organizations_url":"https://api.github.com/users/aloker/orgs","repos_url":"https://api.github.com/users/aloker/repos","events_url":"https://api.github.com/users/aloker/events{/privacy}","received_events_url":"https://api.github.com/users/aloker/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T15:53:13Z","updated_at":"2022-09-15T15:53:13Z","body":"> I am experiencing the same.\r\n> \r\n> I would much more prefer having the ActionData type to be:\r\n> \r\n> ```ts\r\n> type ActionData = {\r\n>     first: string | undefined,\r\n>     second: string | undefined,\r\n>     third: string | undefined,\r\n>     fourth: string |undefined\r\n> }\r\n> ```\r\n\r\nI very much prefer the unions as they are now. While the auto generated types are useful, you'll have a way better experience if you add a little bit of typing yourself. E.g., you could type the payload of invalid responses as `{ status: \"invalid\"; } & Model & { errors: { [k in keyof Model]?: string}}` and valid responses as `{ status: \"ok\"; } & Model` or so. Than you can use status as a discriminator for type narrowing and you'll have nice typing on the page. I'd you have more actions, add another discriminator (e.g. action) and you can handle pretty much any situation smoothly.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248292629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aloker","id":140714,"node_id":"MDQ6VXNlcjE0MDcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/140714?v=4","gravatar_id":"","url":"https://api.github.com/users/aloker","html_url":"https://github.com/aloker","followers_url":"https://api.github.com/users/aloker/followers","following_url":"https://api.github.com/users/aloker/following{/other_user}","gists_url":"https://api.github.com/users/aloker/gists{/gist_id}","starred_url":"https://api.github.com/users/aloker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aloker/subscriptions","organizations_url":"https://api.github.com/users/aloker/orgs","repos_url":"https://api.github.com/users/aloker/repos","events_url":"https://api.github.com/users/aloker/events{/privacy}","received_events_url":"https://api.github.com/users/aloker/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248359588","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248359588","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248359588,"node_id":"IC_kwDOEiPr8c5KaHSk","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T16:49:01Z","updated_at":"2022-09-15T16:51:45Z","body":"My current use case:\n\n```ts\ntype ActionData = \n| { target: 'email', message: 'incorrect format'}\n| { target: 'email', message: 'not exist'}\n| { target: 'trials', message: 'requested too many times', remaining: '30'} // indicating needed to wait 30 seconds to try again\n```\n\nBut with current sveltekit version, the `remaining` property is missing.\n\nSo I suspect it is a bug as it 'eats up' some types. And that occurs at the return type of the default.\n\nI do like the idea of discriminative union as it would be handled beautifully as we use it with conditionals.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248359588/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248395518","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248395518","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248395518,"node_id":"IC_kwDOEiPr8c5KaQD-","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T17:24:51Z","updated_at":"2022-09-15T17:24:51Z","body":"> > I am experiencing the same.\r\n> > I would much more prefer having the ActionData type to be:\r\n> > ```ts\r\n> > type ActionData = {\r\n> >     first: string | undefined,\r\n> >     second: string | undefined,\r\n> >     third: string | undefined,\r\n> >     fourth: string |undefined\r\n> > }\r\n> > ```\r\n> \r\n> I very much prefer the unions as they are now. While the auto generated types are useful, you'll have a way better experience if you add a little bit of typing yourself. E.g., you could type the payload of invalid responses as `{ status: \"invalid\"; } & Model & { errors: { [k in keyof Model]?: string}}` and valid responses as `{ status: \"ok\"; } & Model` or so. Than you can use status as a discriminator for type narrowing and you'll have nice typing on the page. I'd you have more actions, add another discriminator (e.g. action) and you can handle pretty much any situation smoothly.\r\n\r\nWould you happen to have an example of how to use the unions as they are now?\r\n\r\nThe example from the docs will not pass typing checks when the unions are the way they are.\r\n\r\nhttps://kit.svelte.dev/docs/form-actions#anatomy-of-an-action-validation-errors\r\n\r\nAttached below the errors from running the docs example.\r\n\r\n![image](https://user-images.githubusercontent.com/22855292/190469452-801113bd-d0d3-43df-b3bd-12a2181afaaa.png)\r\n\r\n![image](https://user-images.githubusercontent.com/22855292/190469604-504c11fb-f0f2-4a59-a8ca-ff7123aa87a8.png)\r\n\r\n![image](https://user-images.githubusercontent.com/22855292/190469703-e2a66dc0-78b3-441a-ac4f-eb2e6c647f76.png)\r\n\r\n![image](https://user-images.githubusercontent.com/22855292/190470431-0770bc14-cd3c-476f-8851-daea2965c3ec.png)\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248395518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248399128","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248399128","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248399128,"node_id":"IC_kwDOEiPr8c5KaQ8Y","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T17:28:44Z","updated_at":"2022-09-15T17:28:44Z","body":"> > > I am experiencing the same.\r\n> > > I would much more prefer having the ActionData type to be:\r\n> > > ```ts\r\n> > > type ActionData = {\r\n> > >     first: string | undefined,\r\n> > >     second: string | undefined,\r\n> > >     third: string | undefined,\r\n> > >     fourth: string |undefined\r\n> > > }\r\n> > > ```\r\n> > \r\n> > \r\n> > I very much prefer the unions as they are now. While the auto generated types are useful, you'll have a way better experience if you add a little bit of typing yourself. E.g., you could type the payload of invalid responses as `{ status: \"invalid\"; } & Model & { errors: { [k in keyof Model]?: string}}` and valid responses as `{ status: \"ok\"; } & Model` or so. Than you can use status as a discriminator for type narrowing and you'll have nice typing on the page. I'd you have more actions, add another discriminator (e.g. action) and you can handle pretty much any situation smoothly.\r\n> \r\n> Would you happen to have an example of how to use the unions as they are now?\r\n> \r\n> The example from the docs will not pass typing checks when the unions are the way they are.\r\n> \r\n> https://kit.svelte.dev/docs/form-actions#anatomy-of-an-action-validation-errors\r\n> \r\n> Attached below the errors from running the docs example.\r\n> \r\n> ![image](https://user-images.githubusercontent.com/22855292/190469452-801113bd-d0d3-43df-b3bd-12a2181afaaa.png)\r\n> \r\n> ![image](https://user-images.githubusercontent.com/22855292/190469604-504c11fb-f0f2-4a59-a8ca-ff7123aa87a8.png)\r\n> \r\n> ![image](https://user-images.githubusercontent.com/22855292/190469703-e2a66dc0-78b3-441a-ac4f-eb2e6c647f76.png)\r\n> \r\n> ![image](https://user-images.githubusercontent.com/22855292/190470431-0770bc14-cd3c-476f-8851-daea2965c3ec.png)\r\n\r\nI think this should have worked. They arenâ€™t working only because maybe there is a bug. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248399128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248478011","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248478011","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248478011,"node_id":"IC_kwDOEiPr8c5KakM7","user":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T18:51:24Z","updated_at":"2022-09-15T20:17:56Z","body":"Here is a workaround i got from https://fettblog.eu/typescript-union-to-intersection/\r\n\r\n_src/lib/types.ts_\r\n```ts\r\nexport type UnionToIntersection<T> = (T extends any ? (x: T) => any : never) extends (x: infer R) => any\r\n\t\t? R\r\n\t\t: never;\r\n```\r\n\r\n_src/routes/+page.svelte_\r\n```html\r\n<script lang=\"ts\">\r\n\timport type { ActionData } from './$types';\r\n\timport type { UnionToIntersection } from '$lib/types';\r\n\r\n\texport let form: UnionToIntersection<ActionData>;\r\n</script>\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248478011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248524407","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248524407","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248524407,"node_id":"IC_kwDOEiPr8c5Kavh3","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T19:31:21Z","updated_at":"2022-09-15T19:31:21Z","body":"It would seem that PageData types are handling this correctly when data of different types could be passed.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248524407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248930712","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1248930712","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1248930712,"node_id":"IC_kwDOEiPr8c5KcSuY","user":{"login":"TheRealUnicorns","id":30137067,"node_id":"MDQ6VXNlcjMwMTM3MDY3","avatar_url":"https://avatars.githubusercontent.com/u/30137067?v=4","gravatar_id":"","url":"https://api.github.com/users/TheRealUnicorns","html_url":"https://github.com/TheRealUnicorns","followers_url":"https://api.github.com/users/TheRealUnicorns/followers","following_url":"https://api.github.com/users/TheRealUnicorns/following{/other_user}","gists_url":"https://api.github.com/users/TheRealUnicorns/gists{/gist_id}","starred_url":"https://api.github.com/users/TheRealUnicorns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheRealUnicorns/subscriptions","organizations_url":"https://api.github.com/users/TheRealUnicorns/orgs","repos_url":"https://api.github.com/users/TheRealUnicorns/repos","events_url":"https://api.github.com/users/TheRealUnicorns/events{/privacy}","received_events_url":"https://api.github.com/users/TheRealUnicorns/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T05:22:24Z","updated_at":"2022-09-16T05:22:24Z","body":"Types aren't missing. ActionData is an union so you'll need to typeguard \r\n```ts\r\ntype ActionData = \r\n| { target: 'email', message: 'incorrect format'}\r\n| { target: 'email', message: 'not exist'}\r\n| { target: 'trials', message: 'requested too many times', remaining: '30'};\r\n\r\nfunction action(): ActionData | undefined {\r\n    return { target: 'trials', message: 'requested too many times', remaining: '30' };\r\n}\r\n\r\nconst form = action();\r\nconsole.log(form?.target, form?.message); // This works as they're common in all types of union\r\n// console.log(form?.remaining); // This will throw an error.\r\nif (form?.target == 'trials') {\r\n    // This works.\r\n    console.log(form.remaining);\r\n}\r\n```\r\n\r\nThe docs don't use typeguards so it throws type errors as well.\r\nthis (not typesafe but works)\r\n```svelte\r\n{#if form?.missing}<p class=\"error\">No user found with this email</p>{/if}\r\n```\r\nvs (is typesafe but verbose)\r\n```svelte\r\n#{if form && 'missing' in form && form.missing}....\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1248930712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"TheRealUnicorns","id":30137067,"node_id":"MDQ6VXNlcjMwMTM3MDY3","avatar_url":"https://avatars.githubusercontent.com/u/30137067?v=4","gravatar_id":"","url":"https://api.github.com/users/TheRealUnicorns","html_url":"https://github.com/TheRealUnicorns","followers_url":"https://api.github.com/users/TheRealUnicorns/followers","following_url":"https://api.github.com/users/TheRealUnicorns/following{/other_user}","gists_url":"https://api.github.com/users/TheRealUnicorns/gists{/gist_id}","starred_url":"https://api.github.com/users/TheRealUnicorns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheRealUnicorns/subscriptions","organizations_url":"https://api.github.com/users/TheRealUnicorns/orgs","repos_url":"https://api.github.com/users/TheRealUnicorns/repos","events_url":"https://api.github.com/users/TheRealUnicorns/events{/privacy}","received_events_url":"https://api.github.com/users/TheRealUnicorns/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249002857","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1249002857","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1249002857,"node_id":"IC_kwDOEiPr8c5KckVp","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T07:12:11Z","updated_at":"2022-09-16T07:12:11Z","body":"> Types aren't missing. ActionData is an union so you'll need to typeguard\r\n> \r\n> ```ts\r\n> type ActionData = \r\n> | { target: 'email', message: 'incorrect format'}\r\n> | { target: 'email', message: 'not exist'}\r\n> | { target: 'trials', message: 'requested too many times', remaining: '30'};\r\n> \r\n> function action(): ActionData | undefined {\r\n>     return { target: 'trials', message: 'requested too many times', remaining: '30' };\r\n> }\r\n> \r\n> const form = action();\r\n> console.log(form?.target, form?.message); // This works as they're common in all types of union\r\n> // console.log(form?.remaining); // This will throw an error.\r\n> if (form?.target == 'trials') {\r\n>     // This works.\r\n>     console.log(form.remaining);\r\n> }\r\n> ```\r\n> \r\n> The docs don't use typeguards so it throws type errors as well. this (not typesafe but works)\r\n> \r\n> ```svelte\r\n> {#if form?.missing}<p class=\"error\">No user found with this email</p>{/if}\r\n> ```\r\n> \r\n> vs (is typesafe but verbose)\r\n> \r\n> ```svelte\r\n> #{if form && 'missing' in form && form.missing}....\r\n> ```\r\n\r\nBut how would it work in the action in +page.server.ts ?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249002857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249777598","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1249777598","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1249777598,"node_id":"IC_kwDOEiPr8c5Kfhe-","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T20:20:49Z","updated_at":"2022-09-16T20:20:49Z","body":"I've tried to make a better example to highlight the issue.\r\n\r\nIf I have a form Action with this code:\r\n\r\n```js\r\nif (condition)\r\n\treturn { message: \"123\", info: \"abc\" }\r\nelse\r\n\treturn { message: \"123\", something: 123 }\r\n```\r\nI get the following type (correct):\r\n\r\n```ts\r\n(alias) type ActionData = {\r\n    message: string;\r\n    info: string;\r\n    something?: undefined;\r\n} | {\r\n    message: string;\r\n    something: number;\r\n    info?: undefined;\r\n}\r\n```\r\n\r\nBut using the invalid helper function:\r\n\r\n```js\r\nif (condition)\r\n\treturn invalid(400,{ message: \"123\", info: \"abc\" })\r\nelse\r\n\treturn invalid(400,{ message: \"123\", something: 123 })\r\n```\r\n\r\nI get this type which is harder to work with and inconsistent with how the load function return types are generated as well:\r\n\r\n```ts\r\n(alias) type ActionData = {\r\n    message: string;\r\n    info: string;\r\n} | {\r\n    message: string;\r\n    something: number;\r\n}\r\n```\r\n\r\nAre there perks to this or is it a bug?\r\n\r\nIn the case where it's intended, would it be easy to opt out of it by let's say not using the invalid helper function?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249777598/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249781817","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1249781817","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1249781817,"node_id":"IC_kwDOEiPr8c5Kfig5","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T20:26:41Z","updated_at":"2022-09-16T20:26:41Z","body":"> I've tried to make a better example to highlight the issue.\r\n> \r\n> If I have a form Action with this code:\r\n> \r\n> ```js\r\n> if (condition)\r\n> \treturn { message: \"123\", info: \"abc\" }\r\n> else\r\n> \treturn { message: \"123\", something: 123 }\r\n> ```\r\n> \r\n> I get the following type (correct):\r\n> \r\n> ```ts\r\n> (alias) type ActionData = {\r\n>     message: string;\r\n>     info: string;\r\n>     something?: undefined;\r\n> } | {\r\n>     message: string;\r\n>     something: number;\r\n>     info?: undefined;\r\n> }\r\n> ```\r\n> \r\n> But using the invalid helper function:\r\n> \r\n> ```js\r\n> if (condition)\r\n> \treturn invalid(400,{ message: \"123\", info: \"abc\" })\r\n> else\r\n> \treturn invalid(400,{ message: \"123\", something: 123 })\r\n> ```\r\n> \r\n> I get this type which is harder to work with and inconsistent with how the load function return types are generated as well:\r\n> \r\n> ```ts\r\n> (alias) type ActionData = {\r\n>     message: string;\r\n>     info: string;\r\n> } | {\r\n>     message: string;\r\n>     something: number;\r\n> }\r\n> ```\r\n> \r\n> Are there perks to this or is it a bug?\r\n> \r\n> In the case where it's intended, would it be easy to opt out of it by let's say not using the invalid helper function?\r\n\r\nAs you said the invalid is a helper function and you may opt out of it. The reason to use it is to differentiate from successful submit or invalid submit thus better dev experience. For the typings, both cases are not bug as they are computed by typescript. The bug I am illustrating in the issue is instead a property being missing completely from the generated ActionData type. You may clone the repo I posted and try to see the type with vscode.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1249781817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250110504","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250110504","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250110504,"node_id":"IC_kwDOEiPr8c5Kgywo","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T17:29:34Z","updated_at":"2022-09-17T17:29:34Z","body":"@harrylaulau\r\n\r\nI cloned your repo and had a look and I realize we are trying to highlight two separate issues. Your issue is that some potential return types are missing entirely in the generated types description.\r\n\r\nMy issue is that the algorithm for generating return types behaves differently on objects returned using the invalid helper function, compared to successfully returned objects.\r\n\r\nI **am now certain these are related issues**\r\n\r\nI cloned your repo and if I do this instead:\r\n\r\n```js\r\nif (url.searchParams.get('v') === '0') return { first: '1' };\r\nif (url.searchParams.get('v') === '1') return  { first: 1, second: 'second' };\r\nif (url.searchParams.get('v') === '2') return  { first: '3', second: 'second' };\r\nif (url.searchParams.get('v') === '3') return { first: {}, second: 'second' };\r\nif (url.searchParams.get('v') === '4') return  { third: 3 };\r\nif (url.searchParams.get('v') === '5') return  { third: 'third' };\r\nif (url.searchParams.get('v') === '6') return { fourth: 'fourth' };\r\n```\r\n\r\nThe types **are** properly generated.\r\n\r\nIf I do this:\r\n\r\n```js\r\nif (url.searchParams.get('v') === '0') return invalid(400, { first: '1' });\r\nif (url.searchParams.get('v') === '1') return invalid(400, { first: 1, second: 'second' });\r\nif (url.searchParams.get('v') === '2') return invalid(400, { first: '3', second: 'second' });\r\nif (url.searchParams.get('v') === '3') return invalid(400, { first: {}, second: 'second' });\r\nif (url.searchParams.get('v') === '4') return invalid(400, { third: 3 });\r\nif (url.searchParams.get('v') === '5') return invalid(400, { third: 'third' });\r\nif (url.searchParams.get('v') === '6') return invalid(400, { fourth: 'fourth' });\r\n```\r\n\r\nThey **are not** .\r\n\r\nI believe the issue you are seeing when mixing both successful and invalid errors are due to the invalid errors not being handled properly. If types were generated for the invalid returns in the same matter the regular return objects have their types returned, both of our issues would be resolved.\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250110504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7407920662,"node_id":"MEE_lADOEiPr8c5R6WHnzwAAAAG5i-YW","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7407920662","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-17T17:29:34Z","performed_via_github_app":null},{"id":7407920664,"node_id":"SE_lADOEiPr8c5R6WHnzwAAAAG5i-YY","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7407920664","actor":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-17T17:29:34Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250115157","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250115157","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250115157,"node_id":"IC_kwDOEiPr8c5Kgz5V","user":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T17:58:21Z","updated_at":"2022-09-17T17:58:21Z","body":"I'm having pretty much the same general set of issues. I can get the generated types to work, but it (a) requires the same amount of \"custom\" typing on my part as if the generated types were not a thing, or (b) even more \"custom\" typing (unions and so on to handle the different cases.)\r\n\r\nI'm wondering what the use case is for generated action types. For `PageData` there's a tree to analyze and create the merged type.  Actions (as far as I can imagine) are pretty much standalone, not related to other code.  Maybe the notion is that the type can be inferred from the `Action` function, without custom typing in typescript (or JSDoc annotations in javascript.) But if so it isn't working for me. \r\n\r\nNet: as of now, the generated types are just getting in the way. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250115157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250118654","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250118654","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250118654,"node_id":"IC_kwDOEiPr8c5Kg0v-","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T18:20:31Z","updated_at":"2022-09-17T18:20:54Z","body":"> I'm having pretty much the same general set of issues. I can get the generated types to work, but it (a) requires the same amount of \"custom\" typing on my part as if the generated types were not a thing, or (b) even more \"custom\" typing (unions and so on to handle the different cases.)\r\n> \r\n> I'm wondering what the use case is for generated action types. For `PageData` there's a tree to analyze and create the merged type. Actions (as far as I can imagine) are pretty much standalone, not related to other code. Maybe the notion is that the type can be inferred from the `Action` function, without custom typing in typescript (or JSDoc annotations in javascript.) But if so it isn't working for me.\r\n> \r\n> Net: as of now, the generated types are just getting in the way.\r\n\r\nIf you enjoy the PageData object, it seems to me like you'll should find that you'll enjoy the same for ActionData if you simply omit the existence of the `invalid()` function","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250118654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250130745","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250130745","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250130745,"node_id":"IC_kwDOEiPr8c5Kg3s5","user":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T19:47:14Z","updated_at":"2022-09-17T19:47:14Z","body":"> simply omit the existence of the invalid() function\r\n\r\n@williamviktorsson Thanks. I understand.\r\n\r\nBut Kit is relying on the (private, unexported) `ValidationError` class  (which `invalid` creates) to divine what it should return to the client...\r\n\r\nhttps://github.com/sveltejs/kit/blob/177a5a9f8219f3f9633d8f8dc879f8472f74d6a2/packages/kit/src/runtime/server/page/actions.js#L43\r\n\r\nIn turn, the status code set on `ValidationError`  is used by `applyAction`...\r\n\r\nhttps://github.com/sveltejs/kit/blob/e512ddb7b9db9ad0362aa16f3a4d4f89146931df/packages/kit/src/runtime/client/client.js#L1205\r\n\r\n...which is both used by `enhance` itself and recommended to be used when you write a function to pass to `enhance`. So it looks like your solution would break `enhance` as it is now.\r\n\r\n> If you enjoy the PageData object, it seems to me like you'll should find that you'll enjoy the same for ActionData\r\n\r\nThere's a strong case for generating `PageData`. There isn't one (or at least not a strong one) for the actions API types.\r\n\r\n- It requires just as much or more manual typing (in my experience, maybe I'm doing it wrong.)\r\n- The egregiously terrible \"_throw (certain flavors of) success, return errors, return (certain other flavors of) success_\" semantic is driven by the \"need\" to analyze the action's return value to get the shape. (That's my understanding from recently trying and failing to persuade the maintainers to \"throw errors, return success\" in the manner of our righteous forebears.) \r\n\r\nEven if the generated types could be fixed and/or documented, I'd much rather create my own types to share between the `Action` and the page. Here's what I'm returning from the action; here's what I can expect on the page (or as the result of a fetch.) The generated types are just a distraction from that.\r\n\r\n\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250130745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7408051113,"node_id":"MEE_lADOEiPr8c5R6WHnzwAAAAG5jeOp","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7408051113","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-17T19:47:15Z","performed_via_github_app":null},{"id":7408051114,"node_id":"SE_lADOEiPr8c5R6WHnzwAAAAG5jeOq","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7408051114","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-17T19:47:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250133109","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250133109","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250133109,"node_id":"IC_kwDOEiPr8c5Kg4R1","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T20:06:01Z","updated_at":"2022-09-17T20:10:04Z","body":"Yep, I've been looking at the code and types for ValidationError class for the past few hours and the only solution I can see is to go back to the previous return {status, data} but I'm certain there's a middle ground. \r\n\r\nA large issue now is that the super simple example from the form actions docs doesn't even work with the current types being generated using `invalid`","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250133109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250136548","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250136548","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250136548,"node_id":"IC_kwDOEiPr8c5Kg5Hk","user":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T20:33:58Z","updated_at":"2022-09-17T20:33:58Z","body":"> * The egregiously terrible \"_throw (certain flavors of) success, return errors, return (certain other flavors of) success_\" semantic is driven by the \"need\" to analyze the action's return value to get the shape. (That's my understanding from recently trying and failing to persuade the maintainers to \"throw errors, return success\" in the manner of our righteous forebears.)\r\n\r\nThere actually is a way to solve it without the need of throwing errors and redirects.\r\n\r\nThe symbol is needed to differentiate between a `KitRedirect` and a return type of `{ status: number, location: string  }`\r\n\r\n```ts\r\nimport type { ServerLoadEvent } from '@sveltejs/kit';\r\n\r\nconst redirectSymbol: unique symbol = Symbol.for('REDIRECT');\r\nclass KitRedirect {\r\n\treadonly [redirectSymbol] = true;\r\n\treadonly status: number;\r\n\treadonly location: string;\r\n\r\n\tconstructor(status: number, location: string) {\r\n\t\tthis.status = status;\r\n\t\tthis.location = location;\r\n\t}\r\n}\r\n\r\nconst errorSymbol: unique symbol = Symbol.for('ERROR');\r\nclass KitError {\r\n\treadonly [errorSymbol] = true;\r\n\treadonly status: number;\r\n\treadonly message: string;\r\n\r\n\tconstructor(status: number, message: string) {\r\n\t\tthis.status = status;\r\n\t\tthis.message = message;\r\n\t}\r\n}\r\n\r\nfunction redirect(status: number, location: string) {\r\n\treturn new KitRedirect(status, location);\r\n}\r\nfunction error(status: number, message: string) {\r\n\treturn new KitError(status, message);\r\n}\r\n\r\nconst load = async ({ locals, params }: ServerLoadEvent) => {\r\n\tif (params.id !== 'a' && params.id !== 'b') {\r\n\t\treturn error(404, 'Not found');\r\n\t}\r\n\r\n\tif (!locals.user) {\r\n\t\treturn redirect(303, '/signin');\r\n\t}\r\n\r\n\treturn {\r\n\t\tposts: [\r\n\t\t\t{ id: 1, title: 'Test 1' },\r\n\t\t\t{ id: 2, title: 'Test 2' }\r\n\t\t]\r\n\t};\r\n};\r\n\r\ntype LoadData = Exclude<Awaited<ReturnType<typeof load>>, KitRedirect | KitError>;\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250136548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250144432","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250144432","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250144432,"node_id":"IC_kwDOEiPr8c5Kg7Cw","user":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T21:39:16Z","updated_at":"2022-09-17T21:57:05Z","body":"IÂ´ve found a way to _correctly_ extract the types from actions:\r\n\r\n```ts\r\nconst actions = {\r\n\tdefault: async ({ request }: RequestEvent) => {\r\n\t\tconst formData = await request.formData();\r\n\t\tconst email = formData.get('email');\r\n\r\n\t\tif (!email) {\r\n\t\t\treturn invalid(400, {\r\n\t\t\t\temailMissing: true\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttest: 1\r\n\t\t};\r\n\t}\r\n};\r\n\r\ntype UnpackValidationError<T> = T extends KitInvalid<infer X> ? X : T;\r\n\r\ntype UnionToIntersection<T> = (T extends any ? (x: T) => any : never) extends (x: infer R) => any\r\n\t? R\r\n\t: never;\r\n\r\ntype OptionalUnion<U, A = Partial<Record<keyof UnionToIntersection<U>, never>>> = U extends unknown\r\n\t? Omit<A, keyof U> & U\r\n\t: never;\r\n\r\ntype ExtractActionReturnType<T extends (...args: any) => any> = OptionalUnion<\r\n\tUnpackValidationError<Awaited<ReturnType<T>>>\r\n>;\r\n\r\ntype ExtractActionData<T extends Record<string, (...args: any) => any>> = {\r\n\t[Key in keyof T]: ExtractActionReturnType<T[Key]>;\r\n}[keyof T];\r\n\r\n// this is now 'correctly' typed\r\ntype ActionData = ExtractActionData<typeof actions>;\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250144432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250144674","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250144674","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250144674,"node_id":"IC_kwDOEiPr8c5Kg7Gi","user":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T21:41:23Z","updated_at":"2022-09-17T21:41:56Z","body":"@david-plugge That's interesting and great. It might make things less confusing.\r\n\r\nBut I would want something DRY-er, where one doesn't have to repeatedly wrap `return`s in `if`s. That's only doable if one abstracts out common logic to shared functions, which themselves throw.\r\n\r\n```ts \r\n// src/routes/profile/edit/+page.server.ts\r\nexport const load = async (event) => {\r\n   // returns user, throws redirect\r\n   const user = await gateAuthenticated(event);\r\n   return { user };\r\n}\r\n\r\nexport const actions = {\r\n  default: async (event) => {\r\n    // returns user, throws redirect\r\n    const user = await gateAuthenticated(event);\r\n    // etc...\r\n  }\r\n}\r\n```\r\n\r\nThis is a really well-known, useful, testable, DRY pattern.  In SvelteKit, though, it's been turned on its head, IMO to suit the needs of the framework rather than the needs of the developer. I like SvelteKit enough not to run away, and I know I can roll my own wrapper(s) to allow me to write code as above. Other folks may not feel the same.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250144674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7408141211,"node_id":"MEE_lADOEiPr8c5R6WHnzwAAAAG5j0Ob","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7408141211","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-17T21:41:23Z","performed_via_github_app":null},{"id":7408141212,"node_id":"SE_lADOEiPr8c5R6WHnzwAAAAG5j0Oc","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7408141212","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-17T21:41:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250146130","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250146130","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250146130,"node_id":"IC_kwDOEiPr8c5Kg7dS","user":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T21:55:03Z","updated_at":"2022-09-17T22:03:51Z","body":"Good point, that would end up in a if-return hell since you canÂ´t redirect or error directly from a helper method.\r\n\r\n> suit the needs of the framework rather than the needs of the developer.\r\n\r\nWhat exactly don't you like about the current approach and how do you think it can be improved?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250146130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"david-plugge","id":59972093,"node_id":"MDQ6VXNlcjU5OTcyMDkz","avatar_url":"https://avatars.githubusercontent.com/u/59972093?v=4","gravatar_id":"","url":"https://api.github.com/users/david-plugge","html_url":"https://github.com/david-plugge","followers_url":"https://api.github.com/users/david-plugge/followers","following_url":"https://api.github.com/users/david-plugge/following{/other_user}","gists_url":"https://api.github.com/users/david-plugge/gists{/gist_id}","starred_url":"https://api.github.com/users/david-plugge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-plugge/subscriptions","organizations_url":"https://api.github.com/users/david-plugge/orgs","repos_url":"https://api.github.com/users/david-plugge/repos","events_url":"https://api.github.com/users/david-plugge/events{/privacy}","received_events_url":"https://api.github.com/users/david-plugge/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250147479","html_url":"https://github.com/sveltejs/kit/issues/6823#issuecomment-1250147479","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/6823","id":1250147479,"node_id":"IC_kwDOEiPr8c5Kg7yX","user":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-17T22:06:26Z","updated_at":"2022-09-17T22:10:11Z","body":"> IÂ´ve found a way to _correctly_ extract the types from actions:\r\n> \r\n> ```ts\r\n>    //....\r\n> ```\r\n\r\nThis **works!** Happy to see it. Allows using the invalid function whilst also returning the proper types.\r\n\r\nI see no real reason not to make a PR out of it. Solves my issue and @harrylaulau and the broken examples from the docs.\r\n\r\nThis is how I adapted your code to `@sveltejs\\kit\\types\\index.d.ts`\r\n\r\n```ts\r\nexport type AwaitedActions<T extends Record<string, (...args: any) => any>> = {\r\n\t[Key in keyof T]: OptionalUnion<\r\n\t\tUnpackValidationError<Awaited<ReturnType<T[Key]>>>\r\n\t>\r\n}[keyof T];\r\n\r\n\r\ntype OptionalUnion<U, A = Partial<Record<keyof UnionToIntersection<U>, never>>> = U extends unknown\r\n\t? Omit<A, keyof U> & U\r\n\t: never;\r\n\r\ntype UnionToIntersection<T> = (T extends any ? (x: T) => any : never) extends (x: infer R) => any\r\n\t? R\r\n\t: never;\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1250147479/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"williamviktorsson","id":22855292,"node_id":"MDQ6VXNlcjIyODU1Mjky","avatar_url":"https://avatars.githubusercontent.com/u/22855292?v=4","gravatar_id":"","url":"https://api.github.com/users/williamviktorsson","html_url":"https://github.com/williamviktorsson","followers_url":"https://api.github.com/users/williamviktorsson/followers","following_url":"https://api.github.com/users/williamviktorsson/following{/other_user}","gists_url":"https://api.github.com/users/williamviktorsson/gists{/gist_id}","starred_url":"https://api.github.com/users/williamviktorsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamviktorsson/subscriptions","organizations_url":"https://api.github.com/users/williamviktorsson/orgs","repos_url":"https://api.github.com/users/williamviktorsson/repos","events_url":"https://api.github.com/users/williamviktorsson/events{/privacy}","received_events_url":"https://api.github.com/users/williamviktorsson/received_events","type":"User","user_view_type":"public","site_admin":false}}]