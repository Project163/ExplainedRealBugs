{"url":"https://api.github.com/repos/sveltejs/kit/issues/8061","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8061/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8061/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8061/events","html_url":"https://github.com/sveltejs/kit/issues/8061","id":1488619324,"node_id":"I_kwDOEiPr8c5Yuoc8","number":8061,"title":"[hooks] `sequence` helper function doesn't account for `preload`","user":{"login":"kelvindecosta","id":38982451,"node_id":"MDQ6VXNlcjM4OTgyNDUx","avatar_url":"https://avatars.githubusercontent.com/u/38982451?v=4","gravatar_id":"","url":"https://api.github.com/users/kelvindecosta","html_url":"https://github.com/kelvindecosta","followers_url":"https://api.github.com/users/kelvindecosta/followers","following_url":"https://api.github.com/users/kelvindecosta/following{/other_user}","gists_url":"https://api.github.com/users/kelvindecosta/gists{/gist_id}","starred_url":"https://api.github.com/users/kelvindecosta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kelvindecosta/subscriptions","organizations_url":"https://api.github.com/users/kelvindecosta/orgs","repos_url":"https://api.github.com/users/kelvindecosta/repos","events_url":"https://api.github.com/users/kelvindecosta/events{/privacy}","received_events_url":"https://api.github.com/users/kelvindecosta/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/3","html_url":"https://github.com/sveltejs/kit/milestone/3","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/3/labels","id":6045098,"node_id":"MDk6TWlsZXN0b25lNjA0NTA5OA==","number":3,"title":"non-urgent","description":"stuff that's not time-sensitive","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":121,"closed_issues":235,"state":"open","created_at":"2020-10-29T02:28:56Z","updated_at":"2025-10-03T09:31:01Z","due_on":null,"closed_at":null},"comments":19,"created_at":"2022-12-10T15:59:48Z","updated_at":"2023-05-04T02:49:50Z","closed_at":"2023-05-04T02:49:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nThe [`sequence`](https://kit.svelte.dev/docs/modules#sveltejs-kit-hooks-sequence) helper funciton doesn't seem to call the `preload` function specified in [`handle`](https://kit.svelte.dev/docs/hooks#server-hooks-handle) hooks.\r\n\r\n### Reproduction\r\n\r\n[Reproduction on StackBlitz](https://stackblitz.com/edit/sveltejs-kit-template-default-8y7mrs?file=src/hooks.server.js&view=editor)\r\n\r\nPlease find the `hooks.server.js` file as such:\r\n\r\n```js\r\nimport { sequence } from '@sveltejs/kit/hooks';\r\n\r\nconst preloadFonts = async ({ event, resolve }) =>\r\n\tawait resolve(event, {\r\n\t\tpreload: ({ type, path }) => {\r\n\t\t\tif (type === 'font') {\r\n\t\t\t\tconsole.log(type, path);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\nexport const handle = sequence(preloadFonts);\r\n\r\n// export const handle = preloadFonts;\r\n```\r\n\r\nRun `npm run build`.\r\n\r\nThe following log output is seen when `handle` is set to `preloadFonts`, but not when it is set to `sequence(preloadFonts)`.\r\n\r\n\r\n\r\n### Logs\r\n\r\n```Shell\r\nvite v4.0.0 building SSR bundle for production...\r\nâœ“ 63 modules transformed.\r\n6:51:28 PM [vite-plugin-svelte] ssr compile done.\r\npackage                 files    time      avg\r\nkit-template-default        7   0.14s   20.1ms\r\n.svelte-kit/output/server/vite-manifest.json                    2.71 kB\r\n.svelte-kit/output/server/entries/pages/_page.js                0.05 kB\r\n.svelte-kit/output/server/entries/pages/about/_page.js          0.09 kB\r\n.svelte-kit/output/server/chunks/hooks.server.js                0.27 kB\r\n.svelte-kit/output/server/entries/fallbacks/error.svelte.js     0.62 kB\r\n.svelte-kit/output/server/entries/pages/about/_page.svelte.js   0.93 kB\r\n.svelte-kit/output/server/chunks/stores.js                      1.02 kB\r\n.svelte-kit/output/server/chunks/index2.js                      1.32 kB\r\n.svelte-kit/output/server/chunks/index.js                       4.15 kB\r\n.svelte-kit/output/server/entries/pages/_layout.svelte.js       4.40 kB\r\n.svelte-kit/output/server/entries/pages/_page.svelte.js         7.45 kB\r\n.svelte-kit/output/server/index.js                             80.79 kB\r\nfont ./_app/immutable/assets/fira-mono-cyrillic-ext-400-normal-3df7909e.woff2\r\nfont ./_app/immutable/assets/fira-mono-all-400-normal-1e3b098c.woff\r\nfont ./_app/immutable/assets/fira-mono-cyrillic-400-normal-c7d433fd.woff2\r\nfont ./_app/immutable/assets/fira-mono-greek-ext-400-normal-9e2fe623.woff2\r\nfont ./_app/immutable/assets/fira-mono-greek-400-normal-a8be01ce.woff2\r\nfont ./_app/immutable/assets/fira-mono-latin-ext-400-normal-6bfabd30.woff2\r\nfont ./_app/immutable/assets/fira-mono-latin-400-normal-e43b3538.woff2\r\nfont ./_app/immutable/assets/fira-mono-cyrillic-ext-400-normal-3df7909e.woff2\r\nfont ./_app/immutable/assets/fira-mono-all-400-normal-1e3b098c.woff\r\nfont ./_app/immutable/assets/fira-mono-cyrillic-400-normal-c7d433fd.woff2\r\nfont ./_app/immutable/assets/fira-mono-greek-ext-400-normal-9e2fe623.woff2\r\nfont ./_app/immutable/assets/fira-mono-greek-400-normal-a8be01ce.woff2\r\nfont ./_app/immutable/assets/fira-mono-latin-ext-400-normal-6bfabd30.woff2\r\nfont ./_app/immutable/assets/fira-mono-latin-400-normal-e43b3538.woff2\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 5.0 undefined\r\n    CPU: (8) x64 Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz\r\n    Memory: 0 Bytes / 0 Bytes\r\n    Shell: 1.0 - /bin/jsh\r\n  Binaries:\r\n    Node: 16.14.2 - /usr/local/bin/node\r\n    Yarn: 1.22.19 - /usr/local/bin/yarn\r\n    npm: 7.17.0 - /usr/local/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.90 \r\n    @sveltejs/kit: next => 1.0.0-next.579 \r\n    svelte: ^3.54.0 => 3.54.0 \r\n    vite: ^4.0.0 => 4.0.0\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8061/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8061/timeline","performed_via_github_app":null,"state_reason":"completed"}