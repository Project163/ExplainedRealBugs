{"url":"https://api.github.com/repos/sveltejs/kit/issues/11099","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/11099/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/11099/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/11099/events","html_url":"https://github.com/sveltejs/kit/issues/11099","id":2005446392,"node_id":"I_kwDOEiPr8c53iK74","number":11099,"title":"SPA Mode: Redirect from +layout.ts doesn't work on 404","user":{"login":"dimfeld","id":1369558,"node_id":"MDQ6VXNlcjEzNjk1NTg=","avatar_url":"https://avatars.githubusercontent.com/u/1369558?v=4","gravatar_id":"","url":"https://api.github.com/users/dimfeld","html_url":"https://github.com/dimfeld","followers_url":"https://api.github.com/users/dimfeld/followers","following_url":"https://api.github.com/users/dimfeld/following{/other_user}","gists_url":"https://api.github.com/users/dimfeld/gists{/gist_id}","starred_url":"https://api.github.com/users/dimfeld/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimfeld/subscriptions","organizations_url":"https://api.github.com/users/dimfeld/orgs","repos_url":"https://api.github.com/users/dimfeld/repos","events_url":"https://api.github.com/users/dimfeld/events{/privacy}","received_events_url":"https://api.github.com/users/dimfeld/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":5086744039,"node_id":"LA_kwDOEiPr8c8AAAABLzGN5w","url":"https://api.github.com/repos/sveltejs/kit/labels/ready%20to%20implement","name":"ready to implement","color":"fbca04","default":false,"description":"please submit PRs for these issues!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/4","html_url":"https://github.com/sveltejs/kit/milestone/4","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/4/labels","id":6613611,"node_id":"MDk6TWlsZXN0b25lNjYxMzYxMQ==","number":4,"title":"soon","description":"stuff we want to do as soon as time allows","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":78,"closed_issues":167,"state":"open","created_at":"2021-03-31T19:50:44Z","updated_at":"2025-10-03T13:11:43Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2023-11-22T02:27:54Z","updated_at":"2025-01-13T12:31:22Z","closed_at":"2025-01-13T12:31:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWith the following conditions:\r\n- SPA mode enabled (ssr = false in +layout.ts)\r\n- A redirect from the load function in +layout.ts\r\n- An unknown route (e.g. '/bad_route`) \r\n\r\nExpected Behavior: It either redirects or the error page shows up.\r\nActual Behavior: Neither the error page nor the redirect works. Instead nothing loads at all. \r\n\r\n## Notes\r\n\r\nIn the actual case where I encountered this, the redirect was to a login page when we detect that the user is not logged in.\r\n\r\nThis behavior happens either on initial load or from a client-side navigation, but only when SSR is disabled.\r\n\r\nThe redirect shows up in the console as an uncaught rejection, which hints at it maybe starting the layout load function but not actually awaiting it once it can't find a page? I haven't looked into it more yet though.\r\n\r\n## Workaround\r\n\r\nAvoid throwing the redirect if `route.id` is empty. Might not work for unexpected errors though?\n\n### Reproduction\n\nhttps://github.com/dimfeld/sveltekit-redirect-on-404\r\n\r\nLoad the app at `http://localhost:5173/bad_route` or click the bad route link from the login page, and see that nothing shows up at all.\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: macOS 14.1\r\n    CPU: (16) arm64 Apple M3 Max\r\n    Memory: 58.39 GB / 128.00 GB\r\n    Shell: 5.9 - /bin/zsh\r\n  Binaries:\r\n    Node: 20.9.0 - /opt/homebrew/bin/node\r\n    Yarn: 1.22.21 - ~/.pnpm/yarn\r\n    npm: 10.1.0 - /opt/homebrew/bin/npm\r\n    pnpm: 8.10.5 - ~/.pnpm/pnpm\r\n    bun: 1.0.13 - /opt/homebrew/bin/bun\r\n  Browsers:\r\n    Brave Browser: 119.1.60.118\r\n    Safari: 17.1\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^1.0.0-next.90 => 1.0.3\r\n    @sveltejs/kit: ^1.0.0-next.587 => 1.27.6\r\n    svelte: ^3.54.0 => 3.59.2\r\n    vite: ^4.0.0 => 4.5.0\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/11099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/11099/timeline","performed_via_github_app":null,"state_reason":"completed"}