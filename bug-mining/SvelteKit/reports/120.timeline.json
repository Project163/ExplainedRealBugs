[{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115545988","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1115545988","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1115545988,"node_id":"IC_kwDOEiPr8c5CfeGE","user":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T02:03:56Z","updated_at":"2022-05-03T02:03:56Z","body":"I found a viable workaround. Looks like the `handleError()` method always gets called regardless so I can do cleanup in there. But IMO that shouldn't be the longterm solution since control flow in `handle()` is now dependent on how the method was called (i.e. via `__data.json` or ssr).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115545988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115555153","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1115555153","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1115555153,"node_id":"IC_kwDOEiPr8c5CfgVR","user":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T02:29:59Z","updated_at":"2022-05-03T02:29:59Z","body":"Is `handleError` not called in both cases?\r\n\r\nI don't think you're supposed to be trying to catch endpoint errors from `resolve` (I can't find any references to doing so in the docs). It may be more of a bug that errors _do_ bubble up to `resolve` than that they don't -- that's what `handleError` is for.\r\n\r\nBased on a couple of things I see in those logs, I think this may fall somewhere between \"rough-edged intended behavior\" and \"logical result of design choice\" -- it looks like one of them is being handled by the router as a navigation (which could be caught with __error.svelte) and the other is being handled by the server \"outside\" of the router -- but I can't prove it right now, 'cause ya didn't provide a full repro and I don't have time to write yet another full Kit repro. ‚òπÔ∏è \r\n\r\nPost a GitHub link to a working repro and I'll take a look at it further.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115555153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115565336","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1115565336","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1115565336,"node_id":"IC_kwDOEiPr8c5Cfi0Y","user":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T02:58:17Z","updated_at":"2022-05-03T02:58:17Z","body":"Here ya go. I figured a full repo was less easy to understand. ü§∑üèª \r\n\r\nhttps://github.com/coryvirok/svelte-exception-bug\r\n\r\nRelevant changes to the demo app are:\r\n* https://github.com/coryvirok/svelte-exception-bug/blob/main/src/hooks.ts\r\n* https://github.com/coryvirok/svelte-exception-bug/blob/main/src/routes/todos/index.ts\r\n\r\nTo repro, load the todos page directly (causes SSR to be returned.) Notice the console logs do not contain the `@@@` line. Next, load the todos page by clicking on the link in the top nav, (causes the page to load via shadow endpoint.) Notice the console logs the '@@@' line.\r\n\r\nIf this is a design decision, it definitely needs some documentation since wrapping `resolve(event)` in a try/catch is a pretty reasonable thing to expect folks to attempt. And the fact that it works sometimes is going to add more confusion.\r\n\r\nLemme know if there's anything else I can provide. Thanks!","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115565336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115817961","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1115817961","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1115817961,"node_id":"IC_kwDOEiPr8c5Cggfp","user":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T07:37:33Z","updated_at":"2022-05-03T07:37:33Z","body":"Okay, [check this out](https://github.com/tcc-sejohnson/kit-exception-bug-rero). I _think_ everything that's going on here is normal behavior.\r\n\r\nFirst, I don't think you're meant to catch and deal with errors caused by `resolve` in this way... in fact, your `handle` function doesn't even have the correct type. Handle _must_ return a `MaybePromise<Response>`. (Fun fact, if you do what you're doing and don't rethrow the error, it will actually change the error code from a 500 to a 404.) If you type your `handle` correctly (`import type { Handle } from '@sveltejs/kit';`), it'll give you red squiggles telling you as much. Regardless, if I try to catch rendering errors from `resolve`, I'm catching them both on shadow endpoint requests and on page navigations \r\n\r\nSecond, if you catch the error in `handle`, it will _not_ propagate to `handleError`.\r\n\r\nThird, I think the strategy SvelteKit wants you to use here is to abstract your database error handling logic out into the `lib` folder. Internalize its error handling. Then, import that library into your endpoints and use it there, handling the errors that may occur inside the library (or in the endpoint). If there _is_ an actual unhandled exception, it will propagate to `handleError` (where you can log it) and cause your nearest ancestored `__error.svelte` to render. Think about it: Why handle a database error caused in who-knows-what endpoint in `handle`? By that point, you're way past the point of being able to recover from the error and way far away from its source -- the error in `handle` could be caused by any number of things, your database being only one of them. If you need to be able to roll back transactions on errors, bake that behavior into your `query` function. :)\r\n\r\nI did notice one bug, though, which I'll file a separate issue for...\r\n\r\nHopefully some other helpful souls will stop by and provide some other input, but I can't actually find any behavior with this that isn't intended.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115817961/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115863545","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1115863545","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1115863545,"node_id":"IC_kwDOEiPr8c5Cgrn5","user":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T08:41:01Z","updated_at":"2022-05-03T08:41:38Z","body":"Thanks for putting this together. I set up your repo and verified what you said about not being able to catch the error in `handle()`. However, if you change your `index.ts` endpoint to be `async`, you'll see that you do catch the error in `handle()` but only for the shadow endpoint request.\r\n\r\nRegarding the DB transaction handling - the pattern I'm using is what I've been used to in Flask, Django, Pyramid, and other web app frameworks over the years. Creating a new transaction per request is the safest way to guarantee ACID properties for your routes. \r\n\r\nHere's a pretty common scenario that requires transaction setup and management in the `handle()` function:\r\n\r\n1. Handle is called\r\n2. In `handle()` the user ID is parsed from the auth cookie\r\n3. In `handle()` a DB transaction is created (and will later by rolled back or committed on successful `await resolve(event)`\r\n4. In `handle()` the user ID is queried in the DB using the transaction and the user profile is loaded and saved to `event.locals` for the endpoint to handle, along with the DB transaction\r\n5. The endpoint executes a bunch of library code that requires a transaction so the state of the DB, (REPEATABLE READ most likely) guarantees that the user profile info queried from `handle()` is accurate wrt the other queries being made\r\n6. The endpoint finishes its work and returns some JSON\r\n7. The `await resolve(event)` function returns successfully and the DB transaction is committed.\r\n\r\nIn the above scenario, if the transaction logic were pushed into the endpoint, there would be no way to check the auth credentials in the DB based on the auth cookie in 1 place across the entire app. Also, it would lead to tons of boilerplate `try/catch` in every endpoint. \r\n\r\nOr, if 2 transactions were made, (one in `handle()` and the other in the endpoint) then we've broken transactionality and the app could do bad things, (like let in a user that was actually deleted between the initial auth check and the endpoint execution.)\r\n\r\n**TL;DR** Is this a pattern that we want to support in SvelteKit? \r\n\r\nThe docs suggest that it is and folks are going to expect that if there's a way to wrap the call to `resolve(event)` that it handles errors in a straightforward and consistent way.\r\n\r\n```js\r\n// hooks.js\r\n\r\nasync function handle(event) {\r\n  event.locals.foo = 'some custom data to pass to endpoints, e.g. a DB transaction'\r\n\r\n  // Handle any exceptions from endpoint and render\r\n  try {\r\n    // Execute endpoint and render\r\n    return await resolve(event)\r\n  } catch (err) {\r\n    // do something, like rollback the DB transaction\r\n    throw err\r\n  }\r\n}\r\n```\r\n\r\nAs always, much appreciation for your time and for this project. The promise of fully server-rendered modern web apps is so, so close! ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1115863545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T17:33:30Z","updated_at":"2022-05-03T17:33:30Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4802","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/4802/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/4802/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/4802/events","html_url":"https://github.com/sveltejs/kit/issues/4802","id":1223783938,"node_id":"I_kwDOEiPr8c5I8XYC","number":4802,"title":"Failure in page endpoint results in incorrect message when navigated to client-side, but not when hard reloaded","user":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2575933385,"node_id":"MDU6TGFiZWwyNTc1OTMzMzg1","url":"https://api.github.com/repos/sveltejs/kit/labels/error%20handling","name":"error handling","color":"aff99a","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":5,"created_at":"2022-05-03T07:45:32Z","updated_at":"2022-07-07T22:08:10Z","closed_at":"2022-07-07T22:08:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":304344049,"node_id":"MDEwOlJlcG9zaXRvcnkzMDQzNDQwNDk=","name":"kit","full_name":"sveltejs/kit","private":false,"owner":{"login":"sveltejs","id":23617963,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNjE3OTYz","avatar_url":"https://avatars.githubusercontent.com/u/23617963?v=4","gravatar_id":"","url":"https://api.github.com/users/sveltejs","html_url":"https://github.com/sveltejs","followers_url":"https://api.github.com/users/sveltejs/followers","following_url":"https://api.github.com/users/sveltejs/following{/other_user}","gists_url":"https://api.github.com/users/sveltejs/gists{/gist_id}","starred_url":"https://api.github.com/users/sveltejs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sveltejs/subscriptions","organizations_url":"https://api.github.com/users/sveltejs/orgs","repos_url":"https://api.github.com/users/sveltejs/repos","events_url":"https://api.github.com/users/sveltejs/events{/privacy}","received_events_url":"https://api.github.com/users/sveltejs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sveltejs/kit","description":"web development, streamlined","fork":false,"url":"https://api.github.com/repos/sveltejs/kit","forks_url":"https://api.github.com/repos/sveltejs/kit/forks","keys_url":"https://api.github.com/repos/sveltejs/kit/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sveltejs/kit/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sveltejs/kit/teams","hooks_url":"https://api.github.com/repos/sveltejs/kit/hooks","issue_events_url":"https://api.github.com/repos/sveltejs/kit/issues/events{/number}","events_url":"https://api.github.com/repos/sveltejs/kit/events","assignees_url":"https://api.github.com/repos/sveltejs/kit/assignees{/user}","branches_url":"https://api.github.com/repos/sveltejs/kit/branches{/branch}","tags_url":"https://api.github.com/repos/sveltejs/kit/tags","blobs_url":"https://api.github.com/repos/sveltejs/kit/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sveltejs/kit/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sveltejs/kit/git/refs{/sha}","trees_url":"https://api.github.com/repos/sveltejs/kit/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sveltejs/kit/statuses/{sha}","languages_url":"https://api.github.com/repos/sveltejs/kit/languages","stargazers_url":"https://api.github.com/repos/sveltejs/kit/stargazers","contributors_url":"https://api.github.com/repos/sveltejs/kit/contributors","subscribers_url":"https://api.github.com/repos/sveltejs/kit/subscribers","subscription_url":"https://api.github.com/repos/sveltejs/kit/subscription","commits_url":"https://api.github.com/repos/sveltejs/kit/commits{/sha}","git_commits_url":"https://api.github.com/repos/sveltejs/kit/git/commits{/sha}","comments_url":"https://api.github.com/repos/sveltejs/kit/comments{/number}","issue_comment_url":"https://api.github.com/repos/sveltejs/kit/issues/comments{/number}","contents_url":"https://api.github.com/repos/sveltejs/kit/contents/{+path}","compare_url":"https://api.github.com/repos/sveltejs/kit/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sveltejs/kit/merges","archive_url":"https://api.github.com/repos/sveltejs/kit/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sveltejs/kit/downloads","issues_url":"https://api.github.com/repos/sveltejs/kit/issues{/number}","pulls_url":"https://api.github.com/repos/sveltejs/kit/pulls{/number}","milestones_url":"https://api.github.com/repos/sveltejs/kit/milestones{/number}","notifications_url":"https://api.github.com/repos/sveltejs/kit/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sveltejs/kit/labels{/name}","releases_url":"https://api.github.com/repos/sveltejs/kit/releases{/id}","deployments_url":"https://api.github.com/repos/sveltejs/kit/deployments","created_at":"2020-10-15T14:00:23Z","updated_at":"2025-11-09T20:00:19Z","pushed_at":"2025-11-09T16:24:14Z","git_url":"git://github.com/sveltejs/kit.git","ssh_url":"git@github.com:sveltejs/kit.git","clone_url":"https://github.com/sveltejs/kit.git","svn_url":"https://github.com/sveltejs/kit","homepage":"https://svelte.dev/docs/kit","size":31752,"stargazers_count":19933,"watchers_count":19933,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1029,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","svelte"],"visibility":"public","forks":2150,"open_issues":1029,"watchers":19933,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Describe the bug\r\n\r\nThe error passed to the `load` function of `__error.svelte` is a generic `500: Failed to load data` when navigating client-side to a page with a page endpoint. However, refreshing the page or visiting it directly (causing it to be fetched directly from the server) results in the correct error. \r\n\r\n### Reproduction\r\n\r\n1. Go here: https://github.com/tcc-sejohnson/kit-exception-bug-rero (yes, there's a typo...)\r\n2. Read the README\r\n3. See the error\r\n\r\n### Logs\r\n\r\n```shell\r\nYou asked for it.\r\n\r\nOh noooooo\r\nOh noooooo\r\nOh noooooo\r\nOh noooooo\r\nOh noooooo\r\nOh noooooo\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: Linux 5.16 Pop!_OS 22.04 LTS\r\n    CPU: (12) x64 AMD Ryzen 5 5600X 6-Core Processor\r\n    Memory: 26.11 GB / 31.32 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 18.0.0 - ~/.nvm/versions/node/v18.0.0/bin/node\r\n    Yarn: 1.22.17 - ~/.yarn/bin/yarn\r\n    npm: 8.6.0 - ~/.nvm/versions/node/v18.0.0/bin/npm\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.40 \r\n    @sveltejs/kit: next => 1.0.0-next.324 \r\n    svelte: ^3.44.0 => 3.48.0\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\nSeems like the error code is always correct at least... :)","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4802/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/4802/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1116371488","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1116371488","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1116371488,"node_id":"IC_kwDOEiPr8c5Cinog","user":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T17:40:58Z","updated_at":"2022-05-03T17:40:58Z","body":"Ooh, good catch on the behavior inconsistency with async methods. I wonder where that's getting lost.\n\nNow that we've nailed down the case and had some good discussion on the details, I'll probably step back and wait for some maintainer discussion. Hopefully the info we've worked out is enough to make it easy on 'em. üôÇ It seems clear that this is one fuzzy aspect of an error handling framework that has some rough edges overall and needs some thought from an overall design perspective (there's an interesting PR referenced in the issue I filed related to this one), especially around what error handling we should be doing in `handle`. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1116371488/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T17:55:28Z","updated_at":"2022-05-03T17:55:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4032","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/4032/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/4032/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/4032/events","html_url":"https://github.com/sveltejs/kit/pull/4032","id":1146020074,"node_id":"PR_kwDOEiPr8c4zPXFa","number":4032,"title":"Expose error message from shadow endpoint errors in __error.svelte","user":{"login":"georgecrawford","id":84737,"node_id":"MDQ6VXNlcjg0NzM3","avatar_url":"https://avatars.githubusercontent.com/u/84737?v=4","gravatar_id":"","url":"https://api.github.com/users/georgecrawford","html_url":"https://github.com/georgecrawford","followers_url":"https://api.github.com/users/georgecrawford/followers","following_url":"https://api.github.com/users/georgecrawford/following{/other_user}","gists_url":"https://api.github.com/users/georgecrawford/gists{/gist_id}","starred_url":"https://api.github.com/users/georgecrawford/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgecrawford/subscriptions","organizations_url":"https://api.github.com/users/georgecrawford/orgs","repos_url":"https://api.github.com/users/georgecrawford/repos","events_url":"https://api.github.com/users/georgecrawford/events{/privacy}","received_events_url":"https://api.github.com/users/georgecrawford/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2022-02-21T16:39:39Z","updated_at":"2022-07-07T20:23:47Z","closed_at":"2022-07-07T20:23:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":304344049,"node_id":"MDEwOlJlcG9zaXRvcnkzMDQzNDQwNDk=","name":"kit","full_name":"sveltejs/kit","private":false,"owner":{"login":"sveltejs","id":23617963,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNjE3OTYz","avatar_url":"https://avatars.githubusercontent.com/u/23617963?v=4","gravatar_id":"","url":"https://api.github.com/users/sveltejs","html_url":"https://github.com/sveltejs","followers_url":"https://api.github.com/users/sveltejs/followers","following_url":"https://api.github.com/users/sveltejs/following{/other_user}","gists_url":"https://api.github.com/users/sveltejs/gists{/gist_id}","starred_url":"https://api.github.com/users/sveltejs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sveltejs/subscriptions","organizations_url":"https://api.github.com/users/sveltejs/orgs","repos_url":"https://api.github.com/users/sveltejs/repos","events_url":"https://api.github.com/users/sveltejs/events{/privacy}","received_events_url":"https://api.github.com/users/sveltejs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sveltejs/kit","description":"web development, streamlined","fork":false,"url":"https://api.github.com/repos/sveltejs/kit","forks_url":"https://api.github.com/repos/sveltejs/kit/forks","keys_url":"https://api.github.com/repos/sveltejs/kit/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sveltejs/kit/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sveltejs/kit/teams","hooks_url":"https://api.github.com/repos/sveltejs/kit/hooks","issue_events_url":"https://api.github.com/repos/sveltejs/kit/issues/events{/number}","events_url":"https://api.github.com/repos/sveltejs/kit/events","assignees_url":"https://api.github.com/repos/sveltejs/kit/assignees{/user}","branches_url":"https://api.github.com/repos/sveltejs/kit/branches{/branch}","tags_url":"https://api.github.com/repos/sveltejs/kit/tags","blobs_url":"https://api.github.com/repos/sveltejs/kit/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sveltejs/kit/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sveltejs/kit/git/refs{/sha}","trees_url":"https://api.github.com/repos/sveltejs/kit/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sveltejs/kit/statuses/{sha}","languages_url":"https://api.github.com/repos/sveltejs/kit/languages","stargazers_url":"https://api.github.com/repos/sveltejs/kit/stargazers","contributors_url":"https://api.github.com/repos/sveltejs/kit/contributors","subscribers_url":"https://api.github.com/repos/sveltejs/kit/subscribers","subscription_url":"https://api.github.com/repos/sveltejs/kit/subscription","commits_url":"https://api.github.com/repos/sveltejs/kit/commits{/sha}","git_commits_url":"https://api.github.com/repos/sveltejs/kit/git/commits{/sha}","comments_url":"https://api.github.com/repos/sveltejs/kit/comments{/number}","issue_comment_url":"https://api.github.com/repos/sveltejs/kit/issues/comments{/number}","contents_url":"https://api.github.com/repos/sveltejs/kit/contents/{+path}","compare_url":"https://api.github.com/repos/sveltejs/kit/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sveltejs/kit/merges","archive_url":"https://api.github.com/repos/sveltejs/kit/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sveltejs/kit/downloads","issues_url":"https://api.github.com/repos/sveltejs/kit/issues{/number}","pulls_url":"https://api.github.com/repos/sveltejs/kit/pulls{/number}","milestones_url":"https://api.github.com/repos/sveltejs/kit/milestones{/number}","notifications_url":"https://api.github.com/repos/sveltejs/kit/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sveltejs/kit/labels{/name}","releases_url":"https://api.github.com/repos/sveltejs/kit/releases{/id}","deployments_url":"https://api.github.com/repos/sveltejs/kit/deployments","created_at":"2020-10-15T14:00:23Z","updated_at":"2025-11-09T20:00:19Z","pushed_at":"2025-11-09T16:24:14Z","git_url":"git://github.com/sveltejs/kit.git","ssh_url":"git@github.com:sveltejs/kit.git","clone_url":"https://github.com/sveltejs/kit.git","svn_url":"https://github.com/sveltejs/kit","homepage":"https://svelte.dev/docs/kit","size":31752,"stargazers_count":19933,"watchers_count":19933,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1029,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","svelte"],"visibility":"public","forks":2150,"open_issues":1029,"watchers":19933,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/sveltejs/kit/pulls/4032","html_url":"https://github.com/sveltejs/kit/pull/4032","diff_url":"https://github.com/sveltejs/kit/pull/4032.diff","patch_url":"https://github.com/sveltejs/kit/pull/4032.patch","merged_at":null},"body":"Fixes #3715 \r\n\r\nWhen a shadow endpoint throws an error (or returns a status code > 400, with an `error` property in the body), it is useful for the `__error.svelte` handler to have access to that error message. This could be obfuscated in non-dev environments, if that's what the maintainers would advise.\r\n\r\nIdeally, we'd find a way to transfer the full error object. This is super useful in local development - in the past I've used https://www.npmjs.com/package/serialize-error to serialize/deserialize the whole error object over JSON so that the `__error.svelte` handler can print the stack trace.\r\n\r\nNB: I haven't written a new test yet, but will do so if this approach is acceptable. \r\n\r\n### Please don't delete this checklist! Before submitting the PR, please make sure you do the following:\r\n- [x] It's really useful if your PR references an issue where it is discussed ahead of time. In many cases, features are absent for a reason. For large changes, please create an RFC: https://github.com/sveltejs/rfcs\r\n- [x] This message body should clearly illustrate what problems it solves.\r\n- [ ] Ideally, include a test that fails without this PR but passes with it.\r\n\r\n### Tests\r\n- [ ] Run the tests with `pnpm test` and lint the project with `pnpm lint` and `pnpm check`\r\n\r\n### Changesets\r\n- [ ] If your PR makes a change that should be noted in one or more packages' changelogs, generate a changeset by running `pnpx changeset` and following the prompts. All changesets should be `patch` until SvelteKit 1.0\r\n","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4032/reactions","total_count":4,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/4032/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1116384896","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1116384896","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1116384896,"node_id":"IC_kwDOEiPr8c5Ciq6A","user":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T17:56:18Z","updated_at":"2022-05-03T17:56:18Z","body":"Ooo, thanks for pointing me at that @tcc-sejohnson! More threads to pull on... :) ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1116384896/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6542720524,"node_id":"MEE_lADOEiPr8c5I7Z47zwAAAAGF-f4M","url":"https://api.github.com/repos/sveltejs/kit/issues/events/6542720524","actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-05-03T17:56:19Z","performed_via_github_app":null},{"id":6542720527,"node_id":"SE_lADOEiPr8c5I7Z47zwAAAAGF-f4P","url":"https://api.github.com/repos/sveltejs/kit/issues/events/6542720527","actor":{"login":"elliott-with-the-longest-name-on-github","id":76245373,"node_id":"MDQ6VXNlcjc2MjQ1Mzcz","avatar_url":"https://avatars.githubusercontent.com/u/76245373?v=4","gravatar_id":"","url":"https://api.github.com/users/elliott-with-the-longest-name-on-github","html_url":"https://github.com/elliott-with-the-longest-name-on-github","followers_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/followers","following_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/following{/other_user}","gists_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/gists{/gist_id}","starred_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/subscriptions","organizations_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/orgs","repos_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/repos","events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/events{/privacy}","received_events_url":"https://api.github.com/users/elliott-with-the-longest-name-on-github/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-05-03T17:56:19Z","performed_via_github_app":null},{"actor":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-04T21:04:52Z","updated_at":"2022-05-04T21:04:52Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4822","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/4822/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/4822/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/4822/events","html_url":"https://github.com/sveltejs/kit/issues/4822","id":1225969426,"node_id":"I_kwDOEiPr8c5JEs8S","number":4822,"title":"Enable top-level wrapping of all user (i.e. not Kit) code","user":{"login":"coryvirok","id":769323,"node_id":"MDQ6VXNlcjc2OTMyMw==","avatar_url":"https://avatars.githubusercontent.com/u/769323?v=4","gravatar_id":"","url":"https://api.github.com/users/coryvirok","html_url":"https://github.com/coryvirok","followers_url":"https://api.github.com/users/coryvirok/followers","following_url":"https://api.github.com/users/coryvirok/following{/other_user}","gists_url":"https://api.github.com/users/coryvirok/gists{/gist_id}","starred_url":"https://api.github.com/users/coryvirok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coryvirok/subscriptions","organizations_url":"https://api.github.com/users/coryvirok/orgs","repos_url":"https://api.github.com/users/coryvirok/repos","events_url":"https://api.github.com/users/coryvirok/events{/privacy}","received_events_url":"https://api.github.com/users/coryvirok/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2575933385,"node_id":"MDU6TGFiZWwyNTc1OTMzMzg1","url":"https://api.github.com/repos/sveltejs/kit/labels/error%20handling","name":"error handling","color":"aff99a","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-05-04T21:04:52Z","updated_at":"2022-09-06T16:13:42Z","closed_at":"2022-09-06T15:34:50Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":304344049,"node_id":"MDEwOlJlcG9zaXRvcnkzMDQzNDQwNDk=","name":"kit","full_name":"sveltejs/kit","private":false,"owner":{"login":"sveltejs","id":23617963,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNjE3OTYz","avatar_url":"https://avatars.githubusercontent.com/u/23617963?v=4","gravatar_id":"","url":"https://api.github.com/users/sveltejs","html_url":"https://github.com/sveltejs","followers_url":"https://api.github.com/users/sveltejs/followers","following_url":"https://api.github.com/users/sveltejs/following{/other_user}","gists_url":"https://api.github.com/users/sveltejs/gists{/gist_id}","starred_url":"https://api.github.com/users/sveltejs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sveltejs/subscriptions","organizations_url":"https://api.github.com/users/sveltejs/orgs","repos_url":"https://api.github.com/users/sveltejs/repos","events_url":"https://api.github.com/users/sveltejs/events{/privacy}","received_events_url":"https://api.github.com/users/sveltejs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sveltejs/kit","description":"web development, streamlined","fork":false,"url":"https://api.github.com/repos/sveltejs/kit","forks_url":"https://api.github.com/repos/sveltejs/kit/forks","keys_url":"https://api.github.com/repos/sveltejs/kit/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sveltejs/kit/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sveltejs/kit/teams","hooks_url":"https://api.github.com/repos/sveltejs/kit/hooks","issue_events_url":"https://api.github.com/repos/sveltejs/kit/issues/events{/number}","events_url":"https://api.github.com/repos/sveltejs/kit/events","assignees_url":"https://api.github.com/repos/sveltejs/kit/assignees{/user}","branches_url":"https://api.github.com/repos/sveltejs/kit/branches{/branch}","tags_url":"https://api.github.com/repos/sveltejs/kit/tags","blobs_url":"https://api.github.com/repos/sveltejs/kit/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sveltejs/kit/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sveltejs/kit/git/refs{/sha}","trees_url":"https://api.github.com/repos/sveltejs/kit/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sveltejs/kit/statuses/{sha}","languages_url":"https://api.github.com/repos/sveltejs/kit/languages","stargazers_url":"https://api.github.com/repos/sveltejs/kit/stargazers","contributors_url":"https://api.github.com/repos/sveltejs/kit/contributors","subscribers_url":"https://api.github.com/repos/sveltejs/kit/subscribers","subscription_url":"https://api.github.com/repos/sveltejs/kit/subscription","commits_url":"https://api.github.com/repos/sveltejs/kit/commits{/sha}","git_commits_url":"https://api.github.com/repos/sveltejs/kit/git/commits{/sha}","comments_url":"https://api.github.com/repos/sveltejs/kit/comments{/number}","issue_comment_url":"https://api.github.com/repos/sveltejs/kit/issues/comments{/number}","contents_url":"https://api.github.com/repos/sveltejs/kit/contents/{+path}","compare_url":"https://api.github.com/repos/sveltejs/kit/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sveltejs/kit/merges","archive_url":"https://api.github.com/repos/sveltejs/kit/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sveltejs/kit/downloads","issues_url":"https://api.github.com/repos/sveltejs/kit/issues{/number}","pulls_url":"https://api.github.com/repos/sveltejs/kit/pulls{/number}","milestones_url":"https://api.github.com/repos/sveltejs/kit/milestones{/number}","notifications_url":"https://api.github.com/repos/sveltejs/kit/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sveltejs/kit/labels{/name}","releases_url":"https://api.github.com/repos/sveltejs/kit/releases{/id}","deployments_url":"https://api.github.com/repos/sveltejs/kit/deployments","created_at":"2020-10-15T14:00:23Z","updated_at":"2025-11-09T20:00:19Z","pushed_at":"2025-11-09T16:24:14Z","git_url":"git://github.com/sveltejs/kit.git","ssh_url":"git@github.com:sveltejs/kit.git","clone_url":"https://github.com/sveltejs/kit.git","svn_url":"https://github.com/sveltejs/kit","homepage":"https://svelte.dev/docs/kit","size":31752,"stargazers_count":19933,"watchers_count":19933,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1029,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","svelte"],"visibility":"public","forks":2150,"open_issues":1029,"watchers":19933,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Describe the problem\n\nI've been struggling with a way to wrap my endpoint code in such a way that any exception thrown will be handled by a single piece of logic in order to clean up various resources after an endpoint executes.\r\n\r\nSome things I've tried:\r\n1. wrap `await resolve(event)` in hooks.ts `handle()` function\r\n2. create a wrapper for every endpoint export that wraps the call to the endpoint function\r\n\r\n## First approach: Top-level `resolve(event)` wrapper\r\n\r\nThe first doesn't work due to strange and unsupported exception dynamics. E.g. sometimes the try/catch will catch the error and sometimes it won't. See https://github.com/sveltejs/kit/issues/4801 for more details. Also, @Rich-Harris suggests to use a wrapper function - https://github.com/sveltejs/kit/pull/4712#issuecomment-1107648871. Hence the second approach.\r\n\r\n## Second approach: Endpoint wrappers\r\n\r\nThe second option isn't working because of the timing of the call to `getSession()`. This one is a bit more nuanced and I don't see a way around fixing it with the current design.\r\n\r\nLet's take a step back and describe how a request should be fulfilled:\r\n\r\n1. request comes into the server\r\n2. an auth token is found and a user ID is parsed out of it\r\n3. since we have a request that looks like it should be authenticated, (due to the presence of the userId) we query the database to make sure this is in fact a valid request. E.g. we check to see if the user hasn't been deleted.\r\n4. we pass the user **and the database transaction set up to fetch the user** to the endpoint so it can execute all of its logic within the same DB transaction. This is important because we don't want to create a race condition by using 2 different transactions to capture the auth info + the endpoint's queries.\r\n5. the endpoint runs and throws an `Error` for whatever reason, which causes the endpoint wrapper to catch the error and rolls the transaction back before re-throwing the error so that SvelteKit can handle it in whatever manner it needs to.\r\n\r\nNow, the issue I mentioned with `getSession()` is that this is the thing that needs to look the user up in the DB in order to pass the user object to the browser. Which means it's the thing that needs to create the DB transaction. **But** since it is called before the endpoint wrapper code that has the try/catch logic, it will not be able to manage failure cases that require a rollback.\r\n\r\nFwiw, I tried moving the logic out of `getSession()` that fetches from the DB and put it into the endpoint wrapper. But apparently the `session` object from `$app/stores` is read-only on the server which means I wasn't able to modify the session before the endpoint had access to it.\r\n\r\n----\r\n\r\nSo, the fundamental question is - How do you wrap *all* of your domain logic in a try/catch? This includes `getSession()` and every line of code in your endpoints and ideally all of the rendering for templates on the server. \n\n### Describe the proposed solution\n\nListed in order of effort I think would be required to implement (high to low.)\r\n\r\n## Option 1: Simplify `handle()` so every exception bubbles up to it\r\n\r\nIMO, the most straightforward and elegant way to achieve this is to support it in the `handle()` function. This requires that exceptions thrown by endpoints or `getSession()`, (and I'm assuming `load()` as well) bubble up to `handle()` in a consistent way. (See the description above for examples of when that doesn't happen.)\r\n\r\n## Option 2: Provide a wrapper method for endpoints that is called before `getSession()` or is provided a way to mutate the session before executing the wrapped endpoint.\r\n\r\nIn this option, there is some sort of SvelteKit provided \"wrap my endpoint\" method that is called by `resolve(event)` inside `handle()`. This wrapper would be able to implement a try/catch around all endpoint + `getSession()` logic. Or, it would be provided the result of `getSession()` and be able to mutate it before calling the endpoint or rendering the template.\r\n\r\n## Option 3: Enable server-side mutation of the `session` object from `$app/stores`\r\n\r\nThis is probably the quickest way to implement what I'm looking for. It would allow all domain logic, (i.e. the code I write) to be wrapped by endpoint wrappers, (i.e. the second approach in the description I tried and the one proposed by @Rich-Harris.) Leaving `getSession()` to almost be a no-op since the wrappers or endpoint could update the `session` store as they saw fit.\r\n\r\nI'm sure there are dragons with this approach...\n\n### Alternatives considered\n\n1. wrap `await resolve(event)` in hooks.ts `handle()` function\r\n2. create a wrapper for every endpoint export that wraps the call to the endpoint function\n\n### Importance\n\ni cannot use SvelteKit without it\n\n### Additional Information\n\nThanks to all of the creators and maintainers on this project. Seriously, it's magical and I can't wait to get it into production!","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/4822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/4822/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":6594356820,"node_id":"MIE_lADOEiPr8c5I7Z47zwAAAAGJDeZU","url":"https://api.github.com/repos/sveltejs/kit/issues/events/6594356820","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2022-05-12T00:34:43Z","milestone":{"title":"1.0"},"performed_via_github_app":null},{"id":7022175807,"node_id":"LE_lADOEiPr8c5I7Z47zwAAAAGijeY_","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7022175807","actor":{"login":"benmccann","id":322311,"node_id":"MDQ6VXNlcjMyMjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/322311?v=4","gravatar_id":"","url":"https://api.github.com/users/benmccann","html_url":"https://github.com/benmccann","followers_url":"https://api.github.com/users/benmccann/followers","following_url":"https://api.github.com/users/benmccann/following{/other_user}","gists_url":"https://api.github.com/users/benmccann/gists{/gist_id}","starred_url":"https://api.github.com/users/benmccann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benmccann/subscriptions","organizations_url":"https://api.github.com/users/benmccann/orgs","repos_url":"https://api.github.com/users/benmccann/repos","events_url":"https://api.github.com/users/benmccann/events{/privacy}","received_events_url":"https://api.github.com/users/benmccann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T16:16:51Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":7022175809,"node_id":"LE_lADOEiPr8c5I7Z47zwAAAAGijeZB","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7022175809","actor":{"login":"benmccann","id":322311,"node_id":"MDQ6VXNlcjMyMjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/322311?v=4","gravatar_id":"","url":"https://api.github.com/users/benmccann","html_url":"https://github.com/benmccann","followers_url":"https://api.github.com/users/benmccann/followers","following_url":"https://api.github.com/users/benmccann/following{/other_user}","gists_url":"https://api.github.com/users/benmccann/gists{/gist_id}","starred_url":"https://api.github.com/users/benmccann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benmccann/subscriptions","organizations_url":"https://api.github.com/users/benmccann/orgs","repos_url":"https://api.github.com/users/benmccann/repos","events_url":"https://api.github.com/users/benmccann/events{/privacy}","received_events_url":"https://api.github.com/users/benmccann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T16:16:52Z","label":{"name":"p1-important","color":"2C3488"},"performed_via_github_app":null},{"id":7022176340,"node_id":"LE_lADOEiPr8c5I7Z47zwAAAAGijehU","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7022176340","actor":{"login":"benmccann","id":322311,"node_id":"MDQ6VXNlcjMyMjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/322311?v=4","gravatar_id":"","url":"https://api.github.com/users/benmccann","html_url":"https://github.com/benmccann","followers_url":"https://api.github.com/users/benmccann/followers","following_url":"https://api.github.com/users/benmccann/following{/other_user}","gists_url":"https://api.github.com/users/benmccann/gists{/gist_id}","starred_url":"https://api.github.com/users/benmccann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benmccann/subscriptions","organizations_url":"https://api.github.com/users/benmccann/orgs","repos_url":"https://api.github.com/users/benmccann/repos","events_url":"https://api.github.com/users/benmccann/events{/privacy}","received_events_url":"https://api.github.com/users/benmccann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-07-19T16:16:56Z","label":{"name":"error handling","color":"aff99a"},"performed_via_github_app":null},{"id":7272130573,"node_id":"LE_lADOEiPr8c5I7Z47zwAAAAGxc-gN","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7272130573","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-08-27T14:00:19Z","label":{"name":"breaking change","color":"F859C7"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1229198039","html_url":"https://github.com/sveltejs/kit/issues/4801#issuecomment-1229198039","issue_url":"https://api.github.com/repos/sveltejs/kit/issues/4801","id":1229198039,"node_id":"IC_kwDOEiPr8c5JRBLX","user":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-27T14:02:14Z","updated_at":"2022-08-27T14:02:14Z","body":"Without checking the repros in this thread (just doing some quick triaging for now, will circle back later), I'll just say this: `await resolve(...)` should _never_ throw. If an error occurs while resolving the page/endpoint, it should invoke `handleError` then return a `Response` with the appropriate status code, meaning any cleanup can happen after the resolve.\r\n\r\nIf that's not happening, then it's a bug, but fixing it might be a breaking change for people who are relying on that bug so I've added the appropriate label.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/comments/1229198039/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7287782106,"node_id":"REFE_lADOEiPr8c5I7Z47zwAAAAGyYrra","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7287782106","actor":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0cb18cd97e7d74ed00b9502940a0d499926ef287","commit_url":"https://api.github.com/repos/sveltejs/kit/commits/0cb18cd97e7d74ed00b9502940a0d499926ef287","created_at":"2022-08-30T13:46:53Z","performed_via_github_app":null},{"actor":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-30T13:48:14Z","updated_at":"2022-08-30T13:48:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6434","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6434/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6434/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6434/events","html_url":"https://github.com/sveltejs/kit/pull/6434","id":1355803467,"node_id":"PR_kwDOEiPr8c4-DLd7","number":6434,"title":"[breaking] render raw response when unexpected error occurs in endpoint","user":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2575933385,"node_id":"MDU6TGFiZWwyNTc1OTMzMzg1","url":"https://api.github.com/repos/sveltejs/kit/labels/error%20handling","name":"error handling","color":"aff99a","default":false,"description":""},{"id":3229669367,"node_id":"MDU6TGFiZWwzMjI5NjY5MzY3","url":"https://api.github.com/repos/sveltejs/kit/labels/breaking%20change","name":"breaking change","color":"F859C7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-08-30T13:48:13Z","updated_at":"2022-08-31T16:37:04Z","closed_at":"2022-08-31T16:37:03Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":304344049,"node_id":"MDEwOlJlcG9zaXRvcnkzMDQzNDQwNDk=","name":"kit","full_name":"sveltejs/kit","private":false,"owner":{"login":"sveltejs","id":23617963,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNjE3OTYz","avatar_url":"https://avatars.githubusercontent.com/u/23617963?v=4","gravatar_id":"","url":"https://api.github.com/users/sveltejs","html_url":"https://github.com/sveltejs","followers_url":"https://api.github.com/users/sveltejs/followers","following_url":"https://api.github.com/users/sveltejs/following{/other_user}","gists_url":"https://api.github.com/users/sveltejs/gists{/gist_id}","starred_url":"https://api.github.com/users/sveltejs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sveltejs/subscriptions","organizations_url":"https://api.github.com/users/sveltejs/orgs","repos_url":"https://api.github.com/users/sveltejs/repos","events_url":"https://api.github.com/users/sveltejs/events{/privacy}","received_events_url":"https://api.github.com/users/sveltejs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sveltejs/kit","description":"web development, streamlined","fork":false,"url":"https://api.github.com/repos/sveltejs/kit","forks_url":"https://api.github.com/repos/sveltejs/kit/forks","keys_url":"https://api.github.com/repos/sveltejs/kit/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sveltejs/kit/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sveltejs/kit/teams","hooks_url":"https://api.github.com/repos/sveltejs/kit/hooks","issue_events_url":"https://api.github.com/repos/sveltejs/kit/issues/events{/number}","events_url":"https://api.github.com/repos/sveltejs/kit/events","assignees_url":"https://api.github.com/repos/sveltejs/kit/assignees{/user}","branches_url":"https://api.github.com/repos/sveltejs/kit/branches{/branch}","tags_url":"https://api.github.com/repos/sveltejs/kit/tags","blobs_url":"https://api.github.com/repos/sveltejs/kit/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sveltejs/kit/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sveltejs/kit/git/refs{/sha}","trees_url":"https://api.github.com/repos/sveltejs/kit/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sveltejs/kit/statuses/{sha}","languages_url":"https://api.github.com/repos/sveltejs/kit/languages","stargazers_url":"https://api.github.com/repos/sveltejs/kit/stargazers","contributors_url":"https://api.github.com/repos/sveltejs/kit/contributors","subscribers_url":"https://api.github.com/repos/sveltejs/kit/subscribers","subscription_url":"https://api.github.com/repos/sveltejs/kit/subscription","commits_url":"https://api.github.com/repos/sveltejs/kit/commits{/sha}","git_commits_url":"https://api.github.com/repos/sveltejs/kit/git/commits{/sha}","comments_url":"https://api.github.com/repos/sveltejs/kit/comments{/number}","issue_comment_url":"https://api.github.com/repos/sveltejs/kit/issues/comments{/number}","contents_url":"https://api.github.com/repos/sveltejs/kit/contents/{+path}","compare_url":"https://api.github.com/repos/sveltejs/kit/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sveltejs/kit/merges","archive_url":"https://api.github.com/repos/sveltejs/kit/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sveltejs/kit/downloads","issues_url":"https://api.github.com/repos/sveltejs/kit/issues{/number}","pulls_url":"https://api.github.com/repos/sveltejs/kit/pulls{/number}","milestones_url":"https://api.github.com/repos/sveltejs/kit/milestones{/number}","notifications_url":"https://api.github.com/repos/sveltejs/kit/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sveltejs/kit/labels{/name}","releases_url":"https://api.github.com/repos/sveltejs/kit/releases{/id}","deployments_url":"https://api.github.com/repos/sveltejs/kit/deployments","created_at":"2020-10-15T14:00:23Z","updated_at":"2025-11-09T20:00:19Z","pushed_at":"2025-11-09T16:24:14Z","git_url":"git://github.com/sveltejs/kit.git","ssh_url":"git@github.com:sveltejs/kit.git","clone_url":"https://github.com/sveltejs/kit.git","svn_url":"https://github.com/sveltejs/kit","homepage":"https://svelte.dev/docs/kit","size":31752,"stargazers_count":19933,"watchers_count":19933,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1029,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","svelte"],"visibility":"public","forks":2150,"open_issues":1029,"watchers":19933,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/sveltejs/kit/pulls/6434","html_url":"https://github.com/sveltejs/kit/pull/6434","diff_url":"https://github.com/sveltejs/kit/pull/6434.diff","patch_url":"https://github.com/sveltejs/kit/pull/6434.patch","merged_at":"2022-08-31T16:37:03Z"},"body":"..instead of failing completely. Also catch possible fetch error (which would occur when network fails).\r\nCloses #4801\r\nRelated to #1931 (maybe even closing it? Can't tell from reading the issue)\r\n\r\nThere are still some code paths which would bubble up to the handler, but these are of the kind \"you use a wrong SvelteKit option\" or during prerendering (\"cannot use mutative methods ..\"). The other all look like they have a try-catch around code paths where errors could occur.\r\n\r\nNot sure if a test is needed here. We could theoretically do one for the endpoint error.\r\n\r\nThis is a breaking change insofar as people could have relied on this behavior somehow.\r\n\r\n### Please don't delete this checklist! Before submitting the PR, please make sure you do the following:\r\n- [x] It's really useful if your PR references an issue where it is discussed ahead of time. In many cases, features are absent for a reason. For large changes, please create an RFC: https://github.com/sveltejs/rfcs\r\n- [x] This message body should clearly illustrate what problems it solves.\r\n- [ ] Ideally, include a test that fails without this PR but passes with it.\r\n\r\n### Tests\r\n- [x] Run the tests with `pnpm test` and lint the project with `pnpm lint` and `pnpm check`\r\n\r\n### Changesets\r\n- [x] If your PR makes a change that should be noted in one or more packages' changelogs, generate a changeset by running `pnpm changeset` and following the prompts. All changesets should be `patch` until SvelteKit 1.0\r\n","reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6434/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":7298040153,"node_id":"CE_lADOEiPr8c5I7Z47zwAAAAGy_0FZ","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7298040153","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-08-31T16:37:04Z","state_reason":null,"performed_via_github_app":null},{"id":7298040390,"node_id":"REFE_lADOEiPr8c5I7Z47zwAAAAGy_0JG","url":"https://api.github.com/repos/sveltejs/kit/issues/events/7298040390","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"eb24cf5f6fa8331316b61bab1c7daf15f207b182","commit_url":"https://api.github.com/repos/sveltejs/kit/commits/eb24cf5f6fa8331316b61bab1c7daf15f207b182","created_at":"2022-08-31T16:37:06Z","performed_via_github_app":null}]