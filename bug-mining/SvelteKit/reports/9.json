{"url":"https://api.github.com/repos/sveltejs/kit/issues/3638","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/3638/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/3638/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/3638/events","html_url":"https://github.com/sveltejs/kit/issues/3638","id":1118990990,"node_id":"I_kwDOEiPr8c5CsnKO","number":3638,"title":"\"TypeError: Line must be greater than or equal to 1, got 0\" when cross-fetching endpoints","user":{"login":"danawoodman","id":157695,"node_id":"MDQ6VXNlcjE1NzY5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/157695?v=4","gravatar_id":"","url":"https://api.github.com/users/danawoodman","html_url":"https://github.com/danawoodman","followers_url":"https://api.github.com/users/danawoodman/followers","following_url":"https://api.github.com/users/danawoodman/following{/other_user}","gists_url":"https://api.github.com/users/danawoodman/gists{/gist_id}","starred_url":"https://api.github.com/users/danawoodman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danawoodman/subscriptions","organizations_url":"https://api.github.com/users/danawoodman/orgs","repos_url":"https://api.github.com/users/danawoodman/repos","events_url":"https://api.github.com/users/danawoodman/events{/privacy}","received_events_url":"https://api.github.com/users/danawoodman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-01-31T05:26:48Z","updated_at":"2022-02-23T20:15:43Z","closed_at":"2022-02-23T20:15:43Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nWhen attempting to help a user on Discord who was trying to fetch from one endpoint (say `src/routes/foo.json.js`) from another (say `src/routes/bar.json.js`). I attempted this locally with the latest version of Kit and received a somewhat confusing error message:\r\n\r\n```\r\nTypeError: Line must be greater than or equal to 1, got 0\r\n```\r\n\r\nI'm not actually clear if doing such a thing is intended to be supported. If so, I would assume it should do what would be expected, if not, then perhaps it could present a clearer error to the user?\r\n\r\n### Reproduction\r\n\r\nCreate two endpoints, one `src/routes/bar.json.js`:\r\n\r\n```js\r\nexport async function get() {\r\n  return {\r\n    body: { bar: true },\r\n    headers: { \"content-type\": \"application/json\" },\r\n  };\r\n}\r\n```\r\n\r\n... and `src/routes/foo.json.js`:\r\n\r\n```js\r\nexport async function get() {\r\n  const resp = await fetch(\"/bar.json\");\r\n  const bar = await resp.json();\r\n  return {\r\n    body: { bar },\r\n    headers: { \"content-type\": \"application/json\" },\r\n  };\r\n}\r\n```\r\n\r\nThen attempt to access `/foo.json` and receive the above error.\r\n\r\n### Logs\r\n\r\n```shell\r\nTypeError: Line must be greater than or equal to 1, got 0\r\n    at BasicSourceMapConsumer.SourceMapConsumer_findMapping [as _findMapping] (/Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:58887:13)\r\n    at BasicSourceMapConsumer.SourceMapConsumer_originalPositionFor [as originalPositionFor] (/Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:58956:22)\r\n    at /Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:59897:34\r\n    at String.replace (<anonymous>)\r\n    at /Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:59885:21\r\n    at Array.map (<anonymous>)\r\n    at ssrRewriteStacktrace (/Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:59884:10)\r\n    at Object.ssrFixStacktrace (/Users/danawoodman/code/webdev/node_modules/.pnpm/vite@2.7.13/node_modules/vite/dist/node/chunks/dep-f5552faa.js:60382:36)\r\n    at Object.get_stack (file:///Users/danawoodman/code/webdev/node_modules/.pnpm/@sveltejs+kit@1.0.0-next.249_svelte@3.46.3/node_modules/@sveltejs/kit/dist/chunks/index.js:2472:14)\r\n    at render_response (file:///Users/danawoodman/code/webdev/node_modules/.pnpm/@sveltejs+kit@1.0.0-next.249_svelte@3.46.3/node_modules/@sveltejs/kit/dist/chunks/index.js:1004:25)\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: macOS 11.6\r\n    CPU: (8) arm64 Apple M1\r\n    Memory: 151.55 MB / 16.00 GB\r\n    Shell: 5.8 - /bin/zsh\r\n  Binaries:\r\n    Node: 17.2.0 - /var/folders/j4/3_1h9_mn6w5g4p438nym2vl40000gn/T/fnm_multishells/16984_1643228350745/bin/node\r\n    npm: 8.1.4 - /var/folders/j4/3_1h9_mn6w5g4p438nym2vl40000gn/T/fnm_multishells/16984_1643228350745/bin/npm\r\n  Browsers:\r\n    Brave Browser: 97.1.34.80\r\n    Chrome: 97.0.4692.99\r\n    Firefox: 91.0.2\r\n    Safari: 15.0\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: 1.0.0-next.17 => 1.0.0-next.17 \r\n    @sveltejs/kit: 1.0.0-next.249 => 1.0.0-next.249 \r\n    svelte: 3.46.3 => 3.46.3\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/3638/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/3638/timeline","performed_via_github_app":null,"state_reason":"completed"}