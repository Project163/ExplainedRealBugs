{"url":"https://api.github.com/repos/sveltejs/kit/issues/6792","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6792/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6792/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6792/events","html_url":"https://github.com/sveltejs/kit/issues/6792","id":1372604215,"node_id":"I_kwDOEiPr8c5R0Ec3","number":6792,"title":"Can't set or delete cookies if you also throw an error or redirect","user":{"login":"kevinrenskers","id":229384,"node_id":"MDQ6VXNlcjIyOTM4NA==","avatar_url":"https://avatars.githubusercontent.com/u/229384?v=4","gravatar_id":"","url":"https://api.github.com/users/kevinrenskers","html_url":"https://github.com/kevinrenskers","followers_url":"https://api.github.com/users/kevinrenskers/followers","following_url":"https://api.github.com/users/kevinrenskers/following{/other_user}","gists_url":"https://api.github.com/users/kevinrenskers/gists{/gist_id}","starred_url":"https://api.github.com/users/kevinrenskers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevinrenskers/subscriptions","organizations_url":"https://api.github.com/users/kevinrenskers/orgs","repos_url":"https://api.github.com/users/kevinrenskers/repos","events_url":"https://api.github.com/users/kevinrenskers/events{/privacy}","received_events_url":"https://api.github.com/users/kevinrenskers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229640667,"node_id":"MDU6TGFiZWwzMjI5NjQwNjY3","url":"https://api.github.com/repos/sveltejs/kit/labels/p1-important","name":"p1-important","color":"2C3488","default":false,"description":"SvelteKit cannot be used by a large number of people, basic functionality is missing, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-09-14T08:49:55Z","updated_at":"2022-09-17T11:00:01Z","closed_at":"2022-09-16T15:52:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWhen you call an internal endpoint to set or delete a cookie, this doesn't work if you also throw an error or redirect afterwards.\n\n### Reproduction\n\nhttps://github.com/kevinrenskers/sk-cookie-problem.\r\n\r\nWhen you first open the homepage there is a button to login, it just sets a cookie. Then refresh the website. The cookie _should_ be deleted and then it should redirect, but instead the cookie isn't deleted and that causes an endless redirect loop.\r\n\r\nWhen you remove the `throw`, the cookie _does_ get deleted. It seems that for some reason the cookie isn't deleted if you throw something as well. Same goes if you throw an error, not only when you throw a redirect.\n\n### Logs\n\n_No response_\n\n### System Info\n\n```shell\nSystem:\r\n    OS: macOS 12.6\r\n    CPU: (10) arm64 Apple M1 Max\r\n    Memory: 1.34 GB / 32.00 GB\r\n    Shell: 3.5.1 - /opt/homebrew/bin/fish\r\n  Binaries:\r\n    Node: 16.17.0 - ~/Library/pnpm/node\r\n    npm: 8.15.0 - ~/Library/pnpm/npm\r\n  Browsers:\r\n    Safari: 16.0\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.73\r\n    @sveltejs/kit: next => 1.0.0-next.481\r\n    svelte: ^3.44.0 => 3.50.1\r\n    vite: ^3.1.0 => 3.1.0\n```\n\n\n### Severity\n\nblocking an upgrade\n\n### Additional Information\n\nThis is blocking me from handling 401 errors. What I need to do is remove the token cookie and redirect the user back to the safety of the homepage, but I can either delete the cookie or redirect, not both.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6792/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6792/timeline","performed_via_github_app":null,"state_reason":"completed"}