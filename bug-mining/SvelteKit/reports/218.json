{"url":"https://api.github.com/repos/sveltejs/kit/issues/7586","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/7586/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/7586/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/7586/events","html_url":"https://github.com/sveltejs/kit/issues/7586","id":1444169727,"node_id":"I_kwDOEiPr8c5WFEf_","number":7586,"title":"Cannot prerender pages with actions","user":{"login":"LowArmour","id":36611062,"node_id":"MDQ6VXNlcjM2NjExMDYy","avatar_url":"https://avatars.githubusercontent.com/u/36611062?v=4","gravatar_id":"","url":"https://api.github.com/users/LowArmour","html_url":"https://github.com/LowArmour","followers_url":"https://api.github.com/users/LowArmour/followers","following_url":"https://api.github.com/users/LowArmour/following{/other_user}","gists_url":"https://api.github.com/users/LowArmour/gists{/gist_id}","starred_url":"https://api.github.com/users/LowArmour/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LowArmour/subscriptions","organizations_url":"https://api.github.com/users/LowArmour/orgs","repos_url":"https://api.github.com/users/LowArmour/repos","events_url":"https://api.github.com/users/LowArmour/events{/privacy}","received_events_url":"https://api.github.com/users/LowArmour/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470032,"node_id":"MDU6TGFiZWwyNDI4NDcwMDMy","url":"https://api.github.com/repos/sveltejs/kit/labels/documentation","name":"documentation","color":"0075ca","default":true,"description":"Improvements or additions to documentation"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-11-10T16:06:01Z","updated_at":"2022-11-10T17:55:15Z","closed_at":"2022-11-10T17:55:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI have a simple form that once it submits, the default action consoles log the data and returns {success: true}. In production, it will take the data, send an e-mail and return success: true.\r\n\r\nAccording to the docs: \"When not to prerender\", \"The basic rule is this: for a page to be prerenderable, any two users hitting it directly must get the same content from the server.\" and \"Not all pages are suitable for prerendering. Any content that is prerendered will be seen by all users.\"\r\n\r\nIn my case, both requirements are true, the submitted form data does not change the content of the page.\r\n\r\nIf I create a +page.server.ts, and include the default action, then when I hit the page in dev or production, it errors out with \"Cannot prerender pages with actions\".\r\n\r\nAlternatively, I can try the API route with +server.ts, but docs recommend against it, in the section \"Receiving data\": \"In general, form actions are a better way to submit data from the browser to the server.\"\r\n\r\nSomething has to give, either this error is unintended behavior, or the docs have to be changed, to include the pages with actions as not prerenderable and that the API route with +server.ts can be the only way to prerender pages with form elements.\r\n\r\nAlso an explanation in the docs regarding why the pages with actions cannot be prerendered, even if they do not change the content of the page, would be ideal.\r\n\r\nThanks in advance.\r\n\r\n### Reproduction\r\n\r\n+page.svelte\r\n```\r\n<form\r\n\t\t\tclass=\"contact\"\r\n\t\t\tmethod=\"POST\"\r\n\t\t\tautocomplete=\"off\"\r\n\t\t\tuse:enhance={({ form, data, action, cancel }) => {\r\n\t\t\t\tcontactFormStore.validateAll()\r\n\t\t\t\tif ($contactFormStore.fields.some((x) => x.errors[$langStore])) cancel()\r\n\t\t\t\tconsole.log('form', form)\r\n\t\t\t\tconsole.log('data', data)\r\n\t\t\t\tconsole.log('action', action)\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<TextInput label={f.name.label} name=\"name\" placeholder={f.name.placeholder} store={contactFormStore} />\r\n\t\t\t<ActionButton type=\"submit\">{f.submission.send}</ActionButton>\r\n</form>\r\n```\r\n\r\n+page.server.ts\r\n```\r\nimport type { Actions } from '@sveltejs/kit'\r\n\r\nexport const actions: Actions = {\r\n\tdefault: async ({ request }) => {\r\n\t\tconst data = await request.formData()\r\n\t\tconsole.log(data)\r\n\t\treturn { success: true `}`\r\n\t},\r\n}\r\n```\r\n\r\nsvelte.config.js\r\n```\r\nimport adapter from '@sveltejs/adapter-node'\r\nimport preprocess from 'svelte-preprocess'\r\n\r\n/** @type {import('@sveltejs/kit').Config} */\r\nconst config = {\r\n\t// Consult https://github.com/sveltejs/svelte-preprocess\r\n\t// for more information about preprocessors\r\n\tpreprocess: preprocess({\r\n\t\tscss: {\r\n\t\t\tprependData: \"@import './src/styles/variables.scss';\",\r\n\t\t},\r\n\t}),\r\n\r\n\tkit: {\r\n\t\tadapter: adapter({\r\n\t\t\tout: 'build',\r\n\t\t\tprecompress: true,\r\n\t\t\tenvPrefix: '',\r\n\t\t}),\r\n\t\talias: {\r\n\t\t\t$components: 'src/lib/components',\r\n\t\t\t'$components/*': 'src/lib/components/*',\r\n\t\t\t$stores: 'src/lib/stores',\r\n\t\t\t'$stores/*': 'src/lib/stores/*',\r\n\t\t\t$types: 'src/lib/types',\r\n\t\t\t'$types/*': 'src/lib/types/*',\r\n\t\t\t$utils: 'src/lib/utils',\r\n\t\t\t'$utils/*': 'src/lib/utils/*',\r\n\t\t\t$icons: 'src/lib/icons',\r\n\t\t\t'$icons/*': 'src/lib/icons/*',\r\n\t\t},\r\n\t},\r\n}\r\n\r\nexport default config\r\n```\r\n\r\n### Logs\r\n\r\n```Shell\r\nCannot prerender pages with actions\r\nError: Cannot prerender pages with actions\r\n    at render_page (file:///home/bt/counselor-website-2/node_modules/@sveltejs/kit/src/runtime/server/page/index.js:88:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async resolve (file:///home/bt/counselor-website-2/node_modules/@sveltejs/kit/src/runtime/server/index.js:235:17)\r\n    at async respond (file:///home/bt/counselor-website-2/node_modules/@sveltejs/kit/src/runtime/server/index.js:287:20)\r\n    at async file:///home/bt/counselor-website-2/node_modules/@sveltejs/kit/src/exports/vite/dev/index.js:410:22\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```Shell\r\nSystem:\r\n    OS: Linux 5.15 Ubuntu 22.04.1 LTS 22.04.1 LTS (Jammy Jellyfish)\r\n    CPU: (8) x64 11th Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz\r\n    Memory: 27.27 GB / 30.99 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 18.12.0 - ~/.nvm/versions/node/v18.12.0/bin/node\r\n    npm: 8.19.2 - ~/.nvm/versions/node/v18.12.0/bin/npm\r\n  Browsers:\r\n    Chrome: 107.0.5304.110\r\n    Firefox: 106.0.5\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.84 \r\n    @sveltejs/adapter-node: ^1.0.0-next.100 => 1.0.0-next.100 \r\n    @sveltejs/adapter-static: ^1.0.0-next.46 => 1.0.0-next.46 \r\n    @sveltejs/kit: next => 1.0.0-next.525 \r\n    svelte: ^3.44.0 => 3.52.0 \r\n    vite: ^3.1.0 => 3.1.8\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\nI have used both adapter-static and adapter-node, same error.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/7586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/7586/timeline","performed_via_github_app":null,"state_reason":"completed"}