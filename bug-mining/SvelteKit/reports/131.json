{"url":"https://api.github.com/repos/sveltejs/kit/issues/6538","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6538/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6538/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6538/events","html_url":"https://github.com/sveltejs/kit/issues/6538","id":1360703278,"node_id":"I_kwDOEiPr8c5RGq8u","number":6538,"title":"prerendering with static-adapter doesn't work with next.455 changes","user":{"login":"mprather","id":25933462,"node_id":"MDQ6VXNlcjI1OTMzNDYy","avatar_url":"https://avatars.githubusercontent.com/u/25933462?v=4","gravatar_id":"","url":"https://api.github.com/users/mprather","html_url":"https://github.com/mprather","followers_url":"https://api.github.com/users/mprather/followers","following_url":"https://api.github.com/users/mprather/following{/other_user}","gists_url":"https://api.github.com/users/mprather/gists{/gist_id}","starred_url":"https://api.github.com/users/mprather/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mprather/subscriptions","organizations_url":"https://api.github.com/users/mprather/orgs","repos_url":"https://api.github.com/users/mprather/repos","events_url":"https://api.github.com/users/mprather/events{/privacy}","received_events_url":"https://api.github.com/users/mprather/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3147046323,"node_id":"MDU6TGFiZWwzMTQ3MDQ2MzIz","url":"https://api.github.com/repos/sveltejs/kit/labels/awaiting%20submitter","name":"awaiting submitter","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2022-09-03T00:31:25Z","updated_at":"2022-09-07T23:42:38Z","closed_at":"2022-09-05T10:57:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nPrior to the release of https://github.com/sveltejs/kit/blob/master/packages/kit/CHANGELOG.md#100-next455, static prerendering was working with what I would consider an ordinary site. With the changes, the build step will not complete. \r\n\r\nExisting config:\r\n\r\n- in svelte.config, \r\n  - prerender.default=true.\r\n  - use @sveltejs/adapter-static with no parameters when initializing\r\n  - specify set of prerender.entries to 2 values ('*', '/sitemap.xml')\r\n- set of non-dynamic pages and 2 +server endpoints\r\n  - 1 endpoint aggregates pages into a list to be consumed by a page that renders the list\r\n  - 1 endpoint produced a sitemap\r\n- leverage mdsvex plugin to create pages from markdown\r\n- only 2 layouts\r\n  - 1 layout at root\r\n  - 1 layout in folder used by md files \r\n\r\nInstructions to accommodate breaking changes were implemented but no luck. \r\n\r\nRelated side note: docs still mention the prerender.default option as valid.\r\n\r\nRelated note to design change: I understand the intent to make it easier to tweak what goes through prerender and what does not. however, the inability to set a global value and forcing a decision into each file and layout is not ideal.\n\n### Reproduction\n\nTo accommodate breaking changes the following changes were made:\r\n- removed config prerender.default setting\r\n- added export of prerender to all layouts\r\n- added export to +server files\r\n\r\nBuild results in the following error:\r\n\r\n``\r\n @sveltejs/adapter-static: all routes must be fully prerenderable (unless using the 'fallback' option — see https://github.com/sveltejs/kit/tree/master/packages/adapter-static#spa-mode). Try adding `export const prerender = true` to your root layout — see https://kit.svelte.dev/docs/page-options#prerender for more details\r\n    - src\\routes\r\nerror during build:\r\n``\r\n\r\nNo additional information is provided. I've gone through the breaking change docs several times and confirmed expected changes exist in layouts and server pages. The error message is unfortunately not great. \r\n\r\nNote: I took at quick look at the code for the static adapter and I'm not sure that I understand the logic in index.js, lines 17 and 27 (https://github.com/sveltejs/kit/blob/e365633c29e3c94a37f7e11fc344d480b842887d/packages/adapter-static/index.js#L17).  Doesn't the call to builder.createEntries always push a value into the string array on line 17, then the check in line 27 will always be true. Am I reading that right? \r\n\r\nOr have I missed something in the upgrade?\r\n\n\n### Logs\n\n_No response_\n\n### System Info\n\n```shell\nSystem:\r\n    OS: Windows 10 10.0.19044\r\n    CPU: (8) x64 Intel(R) Core(TM) i7-1065G7 CPU @ 1.30GHz\r\n    Memory: 15.99 GB / 31.59 GB\r\n  Binaries:\r\n    Node: 16.15.1 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 8.11.0 - C:\\Program Files\\nodejs\\npm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.19041.1266.0), Chromium (104.0.1293.70), ChromiumDev (106.0.1363.0)\r\n  npmPackages:\r\n    @sveltejs/adapter-static: next => 1.0.0-next.41\r\n    @sveltejs/kit: next => 1.0.0-next.464\r\n    svelte: ^3.48.0 => 3.50.0\r\n    vite: ^3.1.0-beta.1 => 3.1.0-beta.2\n```\n\n\n### Severity\n\nblocking an upgrade\n\n### Additional Information\n\nNot sure if this is a user error (misunderstanding documentation or lack of documentation) or a product bug. Will need to stay on release 420 in the meantime.","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6538/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6538/timeline","performed_via_github_app":null,"state_reason":"completed"}