{"url":"https://api.github.com/repos/sveltejs/kit/issues/11780","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/11780/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/11780/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/11780/events","html_url":"https://github.com/sveltejs/kit/issues/11780","id":2113874280,"node_id":"I_kwDOEiPr8c59_ylo","number":11780,"title":"Provide utilities to satisfy `LessThan` and `NumericRange`","user":{"login":"NatoBoram","id":10495562,"node_id":"MDQ6VXNlcjEwNDk1NTYy","avatar_url":"https://avatars.githubusercontent.com/u/10495562?v=4","gravatar_id":"","url":"https://api.github.com/users/NatoBoram","html_url":"https://github.com/NatoBoram","followers_url":"https://api.github.com/users/NatoBoram/followers","following_url":"https://api.github.com/users/NatoBoram/following{/other_user}","gists_url":"https://api.github.com/users/NatoBoram/gists{/gist_id}","starred_url":"https://api.github.com/users/NatoBoram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NatoBoram/subscriptions","organizations_url":"https://api.github.com/users/NatoBoram/orgs","repos_url":"https://api.github.com/users/NatoBoram/repos","events_url":"https://api.github.com/users/NatoBoram/events{/privacy}","received_events_url":"https://api.github.com/users/NatoBoram/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2539682476,"node_id":"MDU6TGFiZWwyNTM5NjgyNDc2","url":"https://api.github.com/repos/sveltejs/kit/labels/types%20/%20typescript","name":"types / typescript","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-02-02T01:58:17Z","updated_at":"2024-02-02T16:12:10Z","closed_at":"2024-02-02T16:12:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\r\n\r\nSo there's these new fun and interesting types we have to satisfy to use `error(status, body)`:\r\n\r\n```ts\r\n/**\r\n * @template {number} TNumber\r\n * @template {any[]} [TArray=[]]\r\n * @typedef {TNumber extends TArray['length'] ? TArray[number] : LessThan<TNumber, [...TArray, TArray['length']]>} LessThan\r\n */\r\n\r\n/**\r\n * @template {number} TStart\r\n * @template {number} TEnd\r\n * @typedef {Exclude<TEnd | LessThan<TEnd>, LessThan<TStart>>} NumericRange\r\n */\r\n```\r\n\r\nHowever, TypeScript wasn't exactly made with these use cases in mind. For example, doing `if (x < 5)` doesn't change the type of `x` from `number` to `number < 5`.\r\n\r\nNormally, if I wanted to implement a type guard to satisfy these new types, it could look something like this:\r\n\r\n```ts\r\nimport type { LessThan, NumericRange } from '@sveltejs/kit'\r\n\r\nexport function isLessThan<Max extends number>(input: number, max: Max): input is LessThan<Max> {\r\n\treturn input < max\r\n}\r\n\r\nexport function toLessThan<Max extends number>(input: number, max: Max): LessThan<Max> {\r\n\tif (isLessThan(input, max)) return input\r\n\treturn (max - 1) as LessThan<Max>\r\n}\r\n\r\nexport function isNumericRange<Min extends number, Max extends number>(\r\n\tinput: number,\r\n\tmin: Min,\r\n\tmax: Max,\r\n): input is NumericRange<Min, Max> {\r\n\treturn min <= input && input <= max\r\n}\r\n\r\nexport function toNumericRange<Min extends number, Max extends number>(\r\n\tinput: number,\r\n\tmin: Min,\r\n\tmax: Max,\r\n): NumericRange<Min, Max> {\r\n\tif (isLessThan(input, min)) return min as NumericRange<Min, Max>\r\n\tif (isLessThan(input, max)) return input as NumericRange<Min, Max>\r\n\treturn max as NumericRange<Min, Max>\r\n}\r\n```\r\n\r\nHowever, this is exceedingly hard to achieve if you have a strict codebase.\r\n\r\n```ts\r\n/home/nato/Code/github.com/NatoBoram/Leanish/src/lib/utils/adapters.ts:3:74\r\nError: Type instantiation is excessively deep and possibly infinite. \r\n\r\nexport function isLessThan<Max extends number>(input: number, max: Max): input is LessThan<Max> {\r\n        return input < max\r\n\r\n\r\n/home/nato/Code/github.com/NatoBoram/Leanish/src/lib/utils/adapters.ts:8:37\r\nError: Type instantiation is excessively deep and possibly infinite. \r\nexport function toLessThan<Max extends number>(input: number, max: Max): LessThan<Max> {\r\n        if (isLessThan(input, max)) return input\r\n        return (max - 1) as LessThan<Max>\r\n\r\n\r\n====================================\r\nsvelte-check found 2 errors and 0 warnings in 1 file\r\n```\r\n```ts\r\n/home/nato/Code/github.com/NatoBoram/Leanish/src/lib/utils/adapters.ts\r\n   8:30  error  Unsafe return of type `any` from function with return type `LessThan<Max>`           @typescript-eslint/no-unsafe-return\r\n   9:2   error  Unsafe return of type `any` from function with return type `LessThan<Max>`           @typescript-eslint/no-unsafe-return\r\n  25:30  error  Unsafe return of type `any` from function with return type `NumericRange<Min, Max>`  @typescript-eslint/no-unsafe-return\r\n  26:30  error  Unsafe return of type `any` from function with return type `NumericRange<Min, Max>`  @typescript-eslint/no-unsafe-return\r\n  27:2   error  Unsafe return of type `any` from function with return type `NumericRange<Min, Max>`  @typescript-eslint/no-unsafe-return\r\n\r\nâœ– 5 problems (5 errors, 0 warnings)\r\n```\r\nThe amount of rules you have to break to achieve this is impractical.\r\n\r\n### Describe the proposed solution\r\n\r\nIf these types are to stay, then it would be very useful to *also* provide type guards and adapters to easily satisfy them.\r\n\r\n* `isLessThan`\r\n* `toLessThan`\r\n* `toNumericRange`\r\n* `isNumericRange`\r\n\r\n### Alternatives considered\r\n\r\n\r\n### Importance\r\n\r\nwould make my life easier\r\n\r\n### Additional Information\r\n\r\n","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/11780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/11780/timeline","performed_via_github_app":null,"state_reason":"completed"}