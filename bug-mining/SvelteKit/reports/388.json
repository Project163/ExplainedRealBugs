{"url":"https://api.github.com/repos/sveltejs/kit/issues/9341","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/9341/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/9341/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/9341/events","html_url":"https://github.com/sveltejs/kit/issues/9341","id":1611974047,"node_id":"I_kwDOEiPr8c5gFMWf","number":9341,"title":"SvelteKit 1.9 and 1.10 using \"base\" config parameter and static adapter creates wrong imports (falsely prependended by \".\"). ","user":{"login":"mdi22","id":12232700,"node_id":"MDQ6VXNlcjEyMjMyNzAw","avatar_url":"https://avatars.githubusercontent.com/u/12232700?v=4","gravatar_id":"","url":"https://api.github.com/users/mdi22","html_url":"https://github.com/mdi22","followers_url":"https://api.github.com/users/mdi22/followers","following_url":"https://api.github.com/users/mdi22/following{/other_user}","gists_url":"https://api.github.com/users/mdi22/gists{/gist_id}","starred_url":"https://api.github.com/users/mdi22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdi22/subscriptions","organizations_url":"https://api.github.com/users/mdi22/orgs","repos_url":"https://api.github.com/users/mdi22/repos","events_url":"https://api.github.com/users/mdi22/events{/privacy}","received_events_url":"https://api.github.com/users/mdi22/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2023-03-06T18:15:15Z","updated_at":"2023-04-19T21:13:44Z","closed_at":"2023-04-17T17:43:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nUsing the static adapter (sveltejs/adapter-static), Sveltekit builds wrong links in the created HTML files. \r\nThe \"base\" parameter ist set to \"build\" so that the application is found in a sub-path \"/build\".\r\nSee \"base\" parameter under https://kit.svelte.dev/docs/configuration#paths\r\n\r\nIn sveltejs/kit Version 1.8.8 a typical link in a created index.html looks like that:\r\n\r\n```html\r\n<link rel=\"modulepreload\" href=\"/build/_app/immutable/entry/start.84521e90.js\">\r\n```\r\n\r\nIn sveltejs/kit Version 1.10.0 and 1.9.0 it looks like that:\r\n```html\r\n<link rel=\"modulepreload\" href=\"./build/_app/immutable/entry/start.84521e90.js\">\r\n```\r\n\r\nA dot (\".\") is prepended the created href, leading to a wrong path:\r\nwhen accessing \"http://localhost/build/index.html\", the dot leads to a path reference to \"http://localhost/build/build/_app/immutable/entry/start.84521e90.js\"\r\n\r\n\r\nIt seems this behavior makes the \"base\" parameter obsolete, as the sveltekit app is always accessible in any sub directory without any further need of configuration, because no absolute paths are used anymore.\r\n\r\nThat new behaviour is great!\r\nBut only if the base parameter is not set, otherwise the site is broken.\r\n\r\nStill, in the documentation \r\nhttps://kit.svelte.dev/docs/configuration#paths\r\nthere is written to use the \"base\" parameter in the case of non-root-paths.\r\n\r\nIf I understand everything right, the solution can simply be to update the documentation, that no base parameter is needed anymore (remove it from documentation).\r\nAlso, an existing base parameter must be ignored and marked deprecated, or lead to an error with the message, that this parameter is not available/allowed anymore.\n\n### Reproduction\n\nI am using sveltejs/kit 1.9.0 or 1.10.0 and sveltejs/adapter-static 2.0.1\r\n\r\nThe vite config is:\r\n\r\n```js\r\nimport { sveltekit } from '@sveltejs/kit/vite'\r\n\r\nconst config = {\r\n\tplugins: [sveltekit(),],\r\n\tserver: {\r\n\t\tport: 3000,\r\n\t\tfs: {\r\n\t\t\t// Allow serving files from one level up to the project root\r\n\t\t\tallow: ['..']\r\n\t\t},\r\n\t\tbase: \"/build\"\r\n\t},\r\n\tpreview: {\r\n\t\tport: 3000\r\n\t},\r\n\ttest: {\r\n\t\tglobals: true\r\n\t}\r\n}\r\nexport default config\r\n```\r\n\r\nThe Svelte configuration is:\r\n```js\r\nimport adapter_static from '@sveltejs/adapter-static'\r\nimport preprocess from 'svelte-preprocess'\r\n\r\nconst config = {\r\n\tpreprocess: preprocess(),\r\n\tonwarn(warning, defaultHandler) {\r\n\t\tdefaultHandler(warning)\r\n\t},\r\n\tkit: {\r\n\t\tadapter: adapter_static(),\r\n\t\tpaths: {\r\n\t\t\tbase: \"/build\"\r\n\t\t}\r\n\t}\r\n}\r\nexport default config\r\n```\n\n### Logs\n\n_No response_\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: Linux 6.1 Ubuntu 22.10 22.10 (Kinetic Kudu)\r\n    CPU: (16) x64 AMD Ryzen 7 6800U with Radeon Graphics\r\n    Memory: 2.17 GB / 13.33 GB\r\n    Container: Yes\r\n    Shell: 5.2.2 - /bin/bash\r\n  Binaries:\r\n    Node: 19.7.0 - /usr/bin/node\r\n    npm: 9.5.0 - /usr/bin/npm\r\n  Browsers:\r\n    Chrome: 110.0.5481.177\r\n    Firefox: 110.0.1\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^2.0 => 2.0.0 \r\n    @sveltejs/adapter-node: ^1.2 => 1.2.1 \r\n    @sveltejs/adapter-static: ^2.0 => 2.0.1 \r\n    @sveltejs/kit: 1.9.0 => 1.9.0 \r\n    svelte: ^3.55 => 3.55.1\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/9341/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/9341/timeline","performed_via_github_app":null,"state_reason":"completed"}