{"url":"https://api.github.com/repos/sveltejs/kit/issues/6826","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6826/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6826/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6826/events","html_url":"https://github.com/sveltejs/kit/issues/6826","id":1374360980,"node_id":"I_kwDOEiPr8c5R6xWU","number":6826,"title":"Netlify builds fail when split functions for layout group endpoints are generated ","user":{"login":"Conceptiks","id":48089451,"node_id":"MDQ6VXNlcjQ4MDg5NDUx","avatar_url":"https://avatars.githubusercontent.com/u/48089451?v=4","gravatar_id":"","url":"https://api.github.com/users/Conceptiks","html_url":"https://github.com/Conceptiks","followers_url":"https://api.github.com/users/Conceptiks/followers","following_url":"https://api.github.com/users/Conceptiks/following{/other_user}","gists_url":"https://api.github.com/users/Conceptiks/gists{/gist_id}","starred_url":"https://api.github.com/users/Conceptiks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Conceptiks/subscriptions","organizations_url":"https://api.github.com/users/Conceptiks/orgs","repos_url":"https://api.github.com/users/Conceptiks/repos","events_url":"https://api.github.com/users/Conceptiks/events{/privacy}","received_events_url":"https://api.github.com/users/Conceptiks/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2882287497,"node_id":"MDU6TGFiZWwyODgyMjg3NDk3","url":"https://api.github.com/repos/sveltejs/kit/labels/pkg:adapter-netlify","name":"pkg:adapter-netlify","color":"d4c5f9","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-09-15T11:16:51Z","updated_at":"2022-10-11T15:43:01Z","closed_at":"2022-10-11T15:43:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nAfter migrating to the latest svelte version and following [this guide](https://github.com/sveltejs/kit/discussions/5774) to do so, I have noticed that all builds using [adapter-netlify](https://www.npmjs.com/package/@sveltejs/adapter-netlify) fail if the adapter is configured like so:\r\n```js\r\nkit: {\r\n    adapter: adapter({\r\n      edge: false,\r\n      split: true\r\n    })\r\n  }\r\n```\r\nI must use `split` as my render function generated by the adapter exceeds the 50MB size limit for Netlify functions. This way, I have come across the following error in the Netlify build log.\r\n>Packaging Functions from .netlify/functions-internal directory:\r\n1:07:35 PM:  - (layoutgroup)-demo.mjs\r\n1:07:35 PM:  - index.mjs\r\n---\r\n>Deploy did not succeed: [PUT /sites/{site_id}/deploys/{deploy_id}][422] updateSiteDeploy default  &{Code:422 Message:Incorrect function names. Name should consist of only alphanumeric characters, hyphen & underscores}\r\n\r\nThis error clearly states that Netlify doesn't support the brackets \"()\" as characters inside function names. This issue is reproducible, and I have provided a minimal repo to test this out. Note that you must deploy to Netlify to see the build fail.\r\n---\n\n### Reproduction\n\nMinimal repo to reproduce can be found below. **Note:** You will have to deploy to Netlify to see the error.\r\nhttps://github.com/Conceptiks/netlify-layout-group-bug\n\n### Logs\n\n```shell\n1:07:35 PM: ────────────────────────────────────────────────────────────────\r\n1:07:35 PM:   2. Functions bundling                                         \r\n1:07:35 PM: ────────────────────────────────────────────────────────────────\r\n1:07:35 PM: ​\r\n1:07:35 PM: Packaging Functions from .netlify/functions-internal directory:\r\n1:07:35 PM:  - (layoutgroup)-demo.mjs\r\n1:07:35 PM:  - index.mjs\r\n1:07:35 PM: ​\r\n1:07:36 PM: ​\r\n1:07:36 PM: (Functions bundling completed in 758ms)\r\n1:07:36 PM: ​\r\n1:07:36 PM: ────────────────────────────────────────────────────────────────\r\n1:07:36 PM:   3. Deploy site                                                \r\n1:07:36 PM: ────────────────────────────────────────────────────────────────\r\n1:07:36 PM: ​\r\n1:07:36 PM: Starting to deploy site from 'build'\r\n1:07:36 PM: Creating deploy tree \r\n1:07:37 PM: ​\r\n1:07:37 PM: ────────────────────────────────────────────────────────────────\r\n1:07:37 PM:   Configuration error                                           \r\n1:07:37 PM: ────────────────────────────────────────────────────────────────\r\n1:07:37 PM: ​\r\n1:07:37 PM:   Error message\r\n1:07:37 PM:   Deploy did not succeed: [PUT /sites/{site_id}/deploys/{deploy_id}][422] updateSiteDeploy default  &{Code:422 Message:Incorrect function names. Name should consist of only alphanumeric characters, hyphen & underscores}\r\n1:07:37 PM: ​\r\n1:07:37 PM:   Resolved config\r\n1:07:37 PM:   build:\r\n1:07:37 PM:     command: npm run build\r\n1:07:37 PM:     commandOrigin: ui\r\n1:07:37 PM:     publish: /opt/build/repo/build\r\n1:07:37 PM:     publishOrigin: ui\r\n1:07:37 PM:   headers:\r\n1:07:37 PM:     - for: /_app/immutable/*\r\n      values:\r\n        cache-control: public, immutable, max-age=31536000\r\n  redirects:\r\n    - from: /\r\n      status: 200\r\n      to: /.netlify/functions/index\r\n    - from: //__data.js\r\n      status: 200\r\n      to: /.netlify/functions/index\r\n    - from: /(layoutgroup)/demo\r\n      status: 200\r\n      to: /.netlify/functions/(layoutgroup)-demo\r\n    - from: /(layoutgroup)/demo/__data.js\r\n      status: 200\r\n      to: /.netlify/functions/(layoutgroup)-demo\r\n1:07:37 PM: Execution cancelled\r\n1:07:37 PM: Error running command: Command was cancelled\r\n1:07:37 PM: Failing build: Failed to build site\r\n1:07:37 PM: Finished processing build request in 16.833005617s\n```\n\n\n### System Info\n\n```shell\nSystem:\r\n    OS: Linux 5.15 Ubuntu 22.04 LTS 22.04 (Jammy Jellyfish)\r\n    CPU: (16) x64 Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz\r\n    Memory: 23.69 GB / 31.28 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 16.16.0 - /usr/local/bin/node\r\n    npm: 8.11.0 - /usr/local/bin/npm\r\n  Browsers:\r\n    Chrome: 104.0.5112.79\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.74 \r\n    @sveltejs/adapter-netlify: ^1.0.0-next.77 => 1.0.0-next.77 \r\n    @sveltejs/kit: next => 1.0.0-next.483 \r\n    svelte: ^3.44.0 => 3.50.1 \r\n    vite: ^3.1.0 => 3.1.1\n```\n\n\n### Severity\n\nblocking an upgrade\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6826/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6826/timeline","performed_via_github_app":null,"state_reason":"completed"}