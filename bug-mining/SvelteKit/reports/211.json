{"url":"https://api.github.com/repos/sveltejs/kit/issues/7510","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/7510/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/7510/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/7510/events","html_url":"https://github.com/sveltejs/kit/issues/7510","id":1436751108,"node_id":"I_kwDOEiPr8c5VoxUE","number":7510,"title":"`cookies.get` incorrectly logs a warning when a cookie was removed from the browser instead of `cookies.delete`","user":{"login":"ptlthg","id":24925519,"node_id":"MDQ6VXNlcjI0OTI1NTE5","avatar_url":"https://avatars.githubusercontent.com/u/24925519?v=4","gravatar_id":"","url":"https://api.github.com/users/ptlthg","html_url":"https://github.com/ptlthg","followers_url":"https://api.github.com/users/ptlthg/followers","following_url":"https://api.github.com/users/ptlthg/following{/other_user}","gists_url":"https://api.github.com/users/ptlthg/gists{/gist_id}","starred_url":"https://api.github.com/users/ptlthg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptlthg/subscriptions","organizations_url":"https://api.github.com/users/ptlthg/orgs","repos_url":"https://api.github.com/users/ptlthg/repos","events_url":"https://api.github.com/users/ptlthg/events{/privacy}","received_events_url":"https://api.github.com/users/ptlthg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-11-05T00:40:17Z","updated_at":"2022-11-07T15:23:00Z","closed_at":"2022-11-07T15:23:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nContext provided by @dummdidumm in Discord:\r\n> Some context about this warning and how the logic is to surface it:\r\nWhy this warning: Cookies have a path. This means they are only available at this path and below. So a path of /foo means your cookie is available at /foo, /foo/bar etc, but not / or /sthelse. Not setting the path value means the cookie's path is set to where the cookie is set on. This is a source of confusion (\"why is my cookie not deleted/set/available?\") so we added that warning. That said, that warning could probably use some love, at least a link to some more in-depth explanation what this is about.\r\n> \r\n> Logic to surface it: Whenever you call cookies.set in dev mode, that cookie's name and its path are stored in a map, and whenever you call cookies.get and it turns up nothing, it prints a warning if a cookie with that name exists in that map. False positives could occur if you remove a cookie through another method - and writing this I just realized that session cookies are probably also false positives: If you set a cookie, close the browser tab and open it again, a session cookie is removed from the browser, but not from the map. Maybe that's something that happens here?\r\n\r\nIt seems that these proposed false positives are correct, when a cookie is removed via exterior means but still expected to be there via `cookies.get` this warning is thrown. However, the warning says \"`did you mean to set its 'path' to '/'?`\" even when the path is set correctly. \r\n\r\nI propose that this warning is only logged when the path isn't `/`, and print the path(s) associated with the cookie. If it is already set to `/`, then these cookies should be removed from the map to align with the lack of them in the browser. I'll attempt to submit a PR to fix this myself shortly, but I'm not super familiar with the inner workings of the project, so it might not be perfect.\n\n### Reproduction\n\nA simple reproduction can be found in [CookiesGetWarningRepro](https://github.com/ptlthg/CookiesGetWarningRepro), but it's a simple thing to check. Just remove a cookie from your browser in dev tools, then refresh or try to access it via `cookies.get` afterwards. The warning should then be logged.\n\n### Logs\n\n```Shell\nCookie with name 'session-cookie' was not found, but a cookie with that name exists at a sub path. Did you mean to set its 'path' to '/'?\r\nCookie with name 'normal-cookie' was not found, but a cookie with that name exists at a sub path. Did you mean to set its 'path' to '/'? \r\nCookie with name 'expires-cookie' was not found, but a cookie with that name exists at a sub path. Did you mean to set its 'path' to '/'?\n```\n\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: Windows 10 10.0.19044\r\n    CPU: (16) x64 AMD Ryzen 7 5800H with Radeon Graphics\r\n    Memory: 45.67 GB / 59.86 GB\r\n  Binaries:\r\n    Node: 18.8.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 8.18.0 - C:\\Program Files\\nodejs\\npm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.19041.1266.0), Chromium (107.0.1418.35)\r\n    Internet Explorer: 11.0.19041.1566\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.87\r\n    @sveltejs/kit: next => 1.0.0-next.535\r\n    svelte: ^3.44.0 => 3.52.0\r\n    vite: ^3.1.0 => 3.2.2\n```\n\n\n### Severity\n\nannoyance\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/7510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/7510/timeline","performed_via_github_app":null,"state_reason":"completed"}