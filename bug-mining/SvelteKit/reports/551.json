{"url":"https://api.github.com/repos/sveltejs/kit/issues/13532","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/13532/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/13532/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/13532/events","html_url":"https://github.com/sveltejs/kit/issues/13532","id":2891592860,"node_id":"I_kwDOEiPr8c6sWjSc","number":13532,"title":"Path alias resolution breaks for certain paths in @sveltejs/package 2.3.8+","user":{"login":"hkjens","id":63708149,"node_id":"MDQ6VXNlcjYzNzA4MTQ5","avatar_url":"https://avatars.githubusercontent.com/u/63708149?v=4","gravatar_id":"","url":"https://api.github.com/users/hkjens","html_url":"https://github.com/hkjens","followers_url":"https://api.github.com/users/hkjens/followers","following_url":"https://api.github.com/users/hkjens/following{/other_user}","gists_url":"https://api.github.com/users/hkjens/gists{/gist_id}","starred_url":"https://api.github.com/users/hkjens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hkjens/subscriptions","organizations_url":"https://api.github.com/users/hkjens/orgs","repos_url":"https://api.github.com/users/hkjens/repos","events_url":"https://api.github.com/users/hkjens/events{/privacy}","received_events_url":"https://api.github.com/users/hkjens/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":2850376265,"node_id":"MDU6TGFiZWwyODUwMzc2MjY1","url":"https://api.github.com/repos/sveltejs/kit/labels/help%20wanted","name":"help wanted","color":"D625D9","default":true,"description":"PRs welcomed. The implementation details are unlikely to cause debate"},{"id":3181909772,"node_id":"MDU6TGFiZWwzMTgxOTA5Nzcy","url":"https://api.github.com/repos/sveltejs/kit/labels/pkg:svelte-package","name":"pkg:svelte-package","color":"972760","default":false,"description":"Issues related to svelte-package"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-03-03T15:37:26Z","updated_at":"2025-09-12T14:52:44Z","closed_at":"2025-09-12T14:52:44Z","author_association":"NONE","type":{"id":4885414,"node_id":"IT_kwDOAWhhq84ASoum","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-29T23:39:46Z","updated_at":"2024-07-26T11:19:25Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\n## Description\nIn version 2.3.8 and above of `@sveltejs/package`, certain path aliases are not being properly resolved during the packaging process. This worked correctly in version 2.3.7.\n\nThe issue affects `.svelte.js` files, but is selective in which imports are transformed. Specifically, it appears that imports of files that re-export Svelte components are not being properly transformed to relative paths.\n\n\n### Reproduction\n\n## Reproduction\nWhen packaging a library with `svelte-package`, certain import paths in `.svelte.js` files are not properly transformed to relative paths in the output.\n\n### Source file (.svelte.js file):\n```javascript\nimport { toSingleImageMeta } from '$lib/util/image/index.js';\nimport {\n  NetworkLoader\n  // ERROR_NOT_LOADED\n  // ERROR_TRANSFERRED\n} from '$lib/classes/svkit/network-loader/index.js';\n```\n\n### Output with version 2.3.7 (works correctly):\n```javascript\nimport { toSingleImageMeta } from '../../../util/image/index.js';\nimport {\n  NetworkLoader\n  // ERROR_NOT_LOADED\n  // ERROR_TRANSFERRED\n} from '../network-loader/index.js';\n```\n\n### Output with version 2.3.8 or higher (broken):\n```javascript\nimport { toSingleImageMeta } from '../../../util/image/index.js';\nimport {\n  NetworkLoader\n  // ERROR_NOT_LOADED\n  // ERROR_TRANSFERRED\n} from '$lib/classes/svkit/network-loader/index.js';\n```\n\nNote that in the same file, some imports are correctly resolved while others are not.\n\n## Key Observation\n- The `toSingleImageMeta` function is directly defined in the imported file, and its path is correctly transformed\n- The `NetworkLoader` import refers to a file that re-exports a Svelte component:\n  ```javascript\n  // Contents of '$lib/classes/svkit/network-loader/index.js'\n  export { default as NetworkLoader } from './NetworkLoader.svelte';\n  ```\n- Only the path that leads to a re-exported Svelte component fails to transform\n\nThis suggests the issue might be related to how the package build tool traces dependencies through re-exports that involve Svelte components.\n\n## Environment\n- Node.js: 23.9.0\n- `@sveltejs/package`: tested with 2.3.7 (working) vs 2.3.8+ (broken)\n- SvelteKit: 2.15.2 (peer dependency)\n- Svelte: 5.20.5\n\n## Configuration\n```json\n{\n  \"devDependencies\": {\n    \"@sveltejs/adapter-auto\": \"^4.0.0\",\n    \"@sveltejs/package\": \"2.3.7\",\n    \"@sveltejs/vite-plugin-svelte\": \"^5.0.3\",\n    \"svelte\": \"^5.20.5\",\n    \"vite\": \"^6.2.0\"\n  },\n  \"peerDependencies\": {\n    \"@sveltejs/kit\": \"^2.15.2\",\n    \"svelte\": \"^5.0.0\"\n  }\n}\n```\n\n## Workaround\nFor now, I've pinned my dependency to version 2.3.7:\n```json\n\"@sveltejs/package\": \"2.3.7\"\n```\n\nI suspect this might be related to how paths that ultimately lead to Svelte components (even through re-exports) are handled differently in version 2.3.8+.\n\n### Logs\n\n```Shell\n\n```\n\n### System Info\n\n```Shell\nSystem:\n    OS: macOS 14.6.1\n    CPU: (12) x64 Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz\n    Memory: 85.91 MB / 32.00 GB\n    Shell: 5.9 - /bin/zsh\n  Binaries:\n    Node: 23.9.0 - /usr/local/bin/node\n    Yarn: 1.22.19 - /usr/local/bin/yarn\n    npm: 10.9.2 - /usr/local/bin/npm\n    pnpm: 10.5.2 - ~/Library/pnpm/pnpm\n  Browsers:\n    Chrome: 133.0.6943.142\n    Safari: 18.3\n  npmPackages:\n    @sveltejs/adapter-auto: ^4.0.0 => 4.0.0\n    @sveltejs/package: 2.3.8 => 2.3.8\n    @sveltejs/vite-plugin-svelte: ^5.0.3 => 5.0.3\n    svelte: ^5.20.5 => 5.20.5\n    vite: ^6.2.0 => 6.2.0\n```\n\n### Severity\n\nannoyance\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/13532/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/13532/timeline","performed_via_github_app":null,"state_reason":"completed"}