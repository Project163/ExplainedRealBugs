{"url":"https://api.github.com/repos/sveltejs/kit/issues/6113","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6113/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6113/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6113/events","html_url":"https://github.com/sveltejs/kit/issues/6113","id":1345077469,"node_id":"I_kwDOEiPr8c5QLEDd","number":6113,"title":"Migrate tool passing unescaped shell commands?","user":{"login":"bmschmidt","id":1110758,"node_id":"MDQ6VXNlcjExMTA3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/1110758?v=4","gravatar_id":"","url":"https://api.github.com/users/bmschmidt","html_url":"https://github.com/bmschmidt","followers_url":"https://api.github.com/users/bmschmidt/followers","following_url":"https://api.github.com/users/bmschmidt/following{/other_user}","gists_url":"https://api.github.com/users/bmschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/bmschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmschmidt/subscriptions","organizations_url":"https://api.github.com/users/bmschmidt/orgs","repos_url":"https://api.github.com/users/bmschmidt/repos","events_url":"https://api.github.com/users/bmschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/bmschmidt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229640667,"node_id":"MDU6TGFiZWwzMjI5NjQwNjY3","url":"https://api.github.com/repos/sveltejs/kit/labels/p1-important","name":"p1-important","color":"2C3488","default":false,"description":"SvelteKit cannot be used by a large number of people, basic functionality is missing, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-08-20T06:58:52Z","updated_at":"2022-08-20T22:50:15Z","closed_at":"2022-08-20T22:50:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThank you for providing the migrate tool, I'm excited about the new routing strategy.\r\n\r\nMigrating a project that reproduces some internet archive URLs that include the character \"$\" in them, I noticed that if a route path in the old format includes special characters, something odd happens that could looks like it could conceivably involve unescaped shell commands. I don't know how the large the scope is, but this seems like the sort of thing that could cause issues if someone has a route at `src/routes/page$[rm -rf /]` or possibly something remotely plausible.\r\n\r\nI had a route at `src/routes/pages/[id]$[pagenum]/index.svelte`. (The format with `$` reproduces Internet Archive URLs).\r\nMigrating throws an error `Command failed: git mv \"src/routes/pages/[id]$[pagenum]/index.svelte\"`  because `fatal: bad source, source=src/routes/pages/[id]0/index.svelte, destination=src/routes/pages/[id]0/+page.svelte`.  That is, the dollar sign triggers an [old bash syntax](https://unix.stackexchange.com/questions/209833/what-does-a-dollar-sign-followed-by-a-square-bracket-mean-in-bash) I've never heard of where `$[foo]` evaluates to '0'. Not the end of the world for me, but this seems like the sort of thing that in rare edge cases might be able cause some havoc on someone's machine, so I wanted to bring it to your attention.\n\n### Reproduction\n\nCreate a path at `src/routes/pages/[id]$[pagenum]/index.svelte` in an old sveltekit project, and run npx svelte-migrate routes \r\n\r\nSorry for not providing a full reprex, which is tricky because it requires forking an old thing.\n\n### Logs\n\n```shell\n(base) benschmidt@Bens-MBP-2 ads % npx svelte-migrate routes\r\n\r\nThis will overwrite files in the current directory!\r\n\r\nYour git working directory is dirty — we recommend committing your changes before running this migration.\r\n\r\n✔ Continue? … yes\r\nfatal: bad source, source=src/routes/pages/[id]0/index.svelte, destination=src/routes/pages/[id]0/+page.svelte\r\nnode:internal/errors:856\r\n  const err = new Error(message);\r\n              ^\r\n\r\nError: Command failed: git mv \"src/routes/pages/[id]$[pagenum]/index.svelte\" \"src/routes/pages/[id]$[pagenum]/+page.svelte\"\r\nfatal: bad source, source=src/routes/pages/[id]0/index.svelte, destination=src/routes/pages/[id]0/+page.svelte\r\n\r\n    at checkExecSyncError (node:child_process:820:11)\r\n    at execSync (node:child_process:891:15)\r\n    at move_file (file:///Users/benschmidt/.npm/_npx/ca732f115159e57c/node_modules/svelte-migrate/migrations/routes/utils.js:49:3)\r\n    at migrate (file:///Users/benschmidt/.npm/_npx/ca732f115159e57c/node_modules/svelte-migrate/migrations/routes/index.js:163:4)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {\r\n  status: 128,\r\n  signal: null,\r\n  output: [\r\n    null,\r\n    Buffer(0) [Uint8Array] [],\r\n    Buffer(111) [Uint8Array] [\r\n      102,  97, 116,  97, 108,  58,  32,  98,  97, 100,  32, 115,\r\n      111, 117, 114,  99, 101,  44,  32, 115, 111, 117, 114,  99,\r\n      101,  61, 115, 114,  99,  47, 114, 111, 117, 116, 101, 115,\r\n       47, 112,  97, 103, 101, 115,  47,  91, 105, 100,  93,  48,\r\n       47, 105, 110, 100, 101, 120,  46, 115, 118, 101, 108, 116,\r\n      101,  44,  32, 100, 101, 115, 116, 105, 110,  97, 116, 105,\r\n      111, 110,  61, 115, 114,  99,  47, 114, 111, 117, 116, 101,\r\n      115,  47, 112,  97, 103, 101, 115,  47,  91, 105, 100,  93,\r\n       48,  47,  43, 112,\r\n      ... 11 more items\r\n    ]\r\n  ],\r\n  pid: 94878,\r\n  stdout: Buffer(0) [Uint8Array] [],\r\n  stderr: Buffer(111) [Uint8Array] [\r\n    102,  97, 116,  97, 108,  58,  32,  98,  97, 100,  32, 115,\r\n    111, 117, 114,  99, 101,  44,  32, 115, 111, 117, 114,  99,\r\n    101,  61, 115, 114,  99,  47, 114, 111, 117, 116, 101, 115,\r\n     47, 112,  97, 103, 101, 115,  47,  91, 105, 100,  93,  48,\r\n     47, 105, 110, 100, 101, 120,  46, 115, 118, 101, 108, 116,\r\n    101,  44,  32, 100, 101, 115, 116, 105, 110,  97, 116, 105,\r\n    111, 110,  61, 115, 114,  99,  47, 114, 111, 117, 116, 101,\r\n    115,  47, 112,  97, 103, 101, 115,  47,  91, 105, 100,  93,\r\n     48,  47,  43, 112,\r\n    ... 11 more items\r\n  ]\r\n}\r\n\r\nNode.js v18.4.0\r\n```\n```\n\n\n### System Info\n\n```shell\nSystem:\r\n    OS: macOS 11.6.1\r\n    CPU: (8) arm64 Apple M1\r\n    Memory: 183.20 MB / 16.00 GB\r\n    Shell: 5.8 - /bin/zsh\r\n  Binaries:\r\n    Node: 18.4.0 - /opt/homebrew/bin/node\r\n    npm: 8.12.1 - /opt/homebrew/bin/npm\r\n  Browsers:\r\n    Chrome: 104.0.5112.101\r\n    Edge: 104.0.1293.63\r\n    Firefox: 100.0.2\r\n    Safari: 15.1\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: ^1.0.0-next.64 => 1.0.0-next.64 \r\n    @sveltejs/adapter-vercel: ^1.0.0-next.66 => 1.0.0-next.66 \r\n    @sveltejs/kit: ^1.0.0-next.405 => 1.0.0-next.405 \r\n    svelte: ^3.49.0 => 3.49.0\n```\n\n\n### Severity\n\nserious, but I can work around it\n\n### Additional Information\n\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6113/timeline","performed_via_github_app":null,"state_reason":"completed"}