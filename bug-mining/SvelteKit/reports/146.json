{"url":"https://api.github.com/repos/sveltejs/kit/issues/6823","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6823/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6823/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6823/events","html_url":"https://github.com/sveltejs/kit/issues/6823","id":1374249447,"node_id":"I_kwDOEiPr8c5R6WHn","number":6823,"title":"some properties in type of object returned from ActionData is missing","user":{"login":"harrylaulau","id":32997810,"node_id":"MDQ6VXNlcjMyOTk3ODEw","avatar_url":"https://avatars.githubusercontent.com/u/32997810?v=4","gravatar_id":"","url":"https://api.github.com/users/harrylaulau","html_url":"https://github.com/harrylaulau","followers_url":"https://api.github.com/users/harrylaulau/followers","following_url":"https://api.github.com/users/harrylaulau/following{/other_user}","gists_url":"https://api.github.com/users/harrylaulau/gists{/gist_id}","starred_url":"https://api.github.com/users/harrylaulau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harrylaulau/subscriptions","organizations_url":"https://api.github.com/users/harrylaulau/orgs","repos_url":"https://api.github.com/users/harrylaulau/repos","events_url":"https://api.github.com/users/harrylaulau/events{/privacy}","received_events_url":"https://api.github.com/users/harrylaulau/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2539682476,"node_id":"MDU6TGFiZWwyNTM5NjgyNDc2","url":"https://api.github.com/repos/sveltejs/kit/labels/types%20/%20typescript","name":"types / typescript","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":25,"created_at":"2022-09-15T09:50:16Z","updated_at":"2022-09-19T07:41:52Z","closed_at":"2022-09-19T07:41:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nThis issue is quite hard to explain by words, I would try my best to describe it precisely. But it think it would be the best to look at the screenshots / code below or the repo.\r\n\r\n**Issue:**\r\nWhen the invalid function is used as a return of multiple conditionals, AND if they share properties of the same type, the other properties that they don't share would be missing. It is even stranger when an object is the value of the property.\r\n\r\n`+page.server.ts`\r\n\r\n```ts\r\nimport { invalid, redirect } from '@sveltejs/kit';\r\nimport type { Actions } from './$types';\r\nexport const actions: Actions = {\r\n\tdefault: async ({ request, url }) => {\r\n\t\tif (url.searchParams.get('v') === '0') return invalid(400, { first: '1' });\r\n\t\tif (url.searchParams.get('v') === '1') return invalid(400, { first: 1, second: 'second' });\r\n\t\tif (url.searchParams.get('v') === '2') return invalid(400, { first: '3', second: 'second' });\r\n\t\tif (url.searchParams.get('v') === '3') return invalid(400, { first: {}, second: 'second' });\r\n\t\tif (url.searchParams.get('v') === '4') return { third: 3 };\r\n\t\tif (url.searchParams.get('v') === '5') return { third: 'third' };\r\n\t\tif (url.searchParams.get('v') === '6') return { fourth: 'fourth' };\r\n\t}\r\n};\r\n```\r\n\r\n![CleanShot 2022-09-15 at 10 29 13](https://user-images.githubusercontent.com/32997810/190368723-8b341ea7-785b-49fa-927c-cd3faa703304.png)\r\n\r\n\r\n`+page.svelte`\r\n\r\n```html\r\n<script lang=\"ts\">\r\n\timport type { ActionData } from './$types';\r\n\texport let form: ActionData;\r\n\t$: console.log(form ?? 'undefined');\r\n</script>\r\n\r\n{#each [0, 1, 2, 3, 4, 5, 6] as x}\r\n\t<div>\r\n\t\t<a href={'/?v=' + x}>to {x}</a>\r\n\t</div>\r\n{/each}\r\n<form method=\"POST\">\r\n\t<button>print action output</button>\r\n</form>\r\n```\r\n\r\n![CleanShot 2022-09-15 at 10 30 13](https://user-images.githubusercontent.com/32997810/190368918-259dc730-1450-40f2-a75a-4c39bddb3c77.png)\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Reproduction\r\n\r\nhttps://github.com/harrylaulau/sveltekittest\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: macOS 12.6\r\n    CPU: (10) arm64 Apple M1 Max\r\n    Memory: 324.70 MB / 32.00 GB\r\n    Shell: 5.8.1 - /bin/zsh\r\n  Binaries:\r\n    Node: 16.15.0 - ~/.nvm/versions/node/v16.15.0/bin/node\r\n    Yarn: 1.22.19 - ~/Library/pnpm/yarn\r\n    npm: 8.12.1 - ~/.nvm/versions/node/v16.15.0/bin/npm\r\n    Watchman: 2022.08.15.00 - /opt/homebrew/bin/watchman\r\n  Browsers:\r\n    Chrome: 105.0.5195.125\r\n    Safari: 16.0\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.74 \r\n    @sveltejs/kit: next => 1.0.0-next.483 \r\n    svelte: ^3.44.0 => 3.50.1 \r\n    vite: ^3.1.0 => 3.1.0\r\n```\r\n\r\n\r\n### Severity\r\n\r\nserious, but I can work around it\r\n\r\n### Additional Information\r\n\r\nIt seems to me that the bug occurs from the return type of `default`.\r\n\r\n`+page.server.ts`\r\n![CleanShot 2022-09-15 at 10 38 15](https://user-images.githubusercontent.com/32997810/190370795-b703edd3-2b6e-4d6e-926c-d0e3e76559ac.png)\r\n\r\n`proxy+page.server.ts`\r\n![CleanShot 2022-09-15 at 10 50 36](https://user-images.githubusercontent.com/32997810/190373701-115c4a1a-ac85-4783-a57b-aa700fa029ac.png)\r\n\r\n","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6823/timeline","performed_via_github_app":null,"state_reason":"completed"}