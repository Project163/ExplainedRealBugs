{"url":"https://api.github.com/repos/sveltejs/kit/issues/8769","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/8769/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/8769/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/8769/events","html_url":"https://github.com/sveltejs/kit/issues/8769","id":1561069344,"node_id":"I_kwDOEiPr8c5dDAcg","number":8769,"title":"`process.env` overwritten with `{ SVELTEKIT_FORK: true }` on Netlify","user":{"login":"james-camilleri","id":3172781,"node_id":"MDQ6VXNlcjMxNzI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3172781?v=4","gravatar_id":"","url":"https://api.github.com/users/james-camilleri","html_url":"https://github.com/james-camilleri","followers_url":"https://api.github.com/users/james-camilleri/followers","following_url":"https://api.github.com/users/james-camilleri/following{/other_user}","gists_url":"https://api.github.com/users/james-camilleri/gists{/gist_id}","starred_url":"https://api.github.com/users/james-camilleri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/james-camilleri/subscriptions","organizations_url":"https://api.github.com/users/james-camilleri/orgs","repos_url":"https://api.github.com/users/james-camilleri/repos","events_url":"https://api.github.com/users/james-camilleri/events{/privacy}","received_events_url":"https://api.github.com/users/james-camilleri/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2023-01-29T00:44:24Z","updated_at":"2023-01-29T15:46:29Z","closed_at":"2023-01-29T14:41:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nEver since version 1.3.1  the entirety of `process.env` is being overwritten with an object containing a single key, `{ SVELTEKIT_FORK: true }`. Using SvelteKit's `$env/static/private` handling works, but process.env is still totally overwritten. I'm not sure if this is by design.\r\n\r\n### Reproduction\r\n\r\nhttps://stackblitz.com/edit/sveltejs-kit-template-default-u765us?file=package.json\r\n\r\nThis repo does not show the entire `process.env` being overwritten, probably due to the different functioning of WebContainers to Netlify's environment. You can still notice env variables being overwritten by changing between versions 1.3.0 and 1.3.1.\r\n\r\nv1.3.0:\r\n```\r\nprocess.env {\r\n  COLORTERM: 'truecolor',\r\n  TERM: 'xterm-256color',\r\n  LSCOLORS: 'ExGxBxDxCxEgEdxbxgExEx',\r\n  PATH: '/home/projects/sveltejs-kit-template-default-u765us/node_modules/.bin:/home/projects/node_modules/.bin:/home/node_modules/.bin:/node_modules/.bin:/bin:/usr/bin:/usr/local/bin',\r\n  HOME: '/home',\r\n  SHELL: '/bin/jsh',\r\n  HISTFILE: '/home/.jsh_history',\r\n  TMPDIR: '/tmp',\r\n  CHROME_BIN: '/usr/local/bin/google-chrome',\r\n  GIT_PROXY: 'https://p.stackblitz.com',\r\n  PWD: '/home/projects/sveltejs-kit-template-default-u765us',\r\n  NEXT_TELEMETRY_DISABLED: '1',\r\n  ASTRO_TELEMETRY_DISABLED: '1',\r\n  __NEXT_DISABLE_MEMORY_WATCHER: '1',\r\n  NG_CLI_ANALYTICS: 'false',\r\n  EDITOR: 'code',\r\n  PKG_MANAGER: 'npm',\r\n  NODE_ENV: 'production'\r\n}\r\n```\r\n\r\nv1.3.1\r\n```\r\nprocess.env {\r\n  COLORTERM: 'truecolor',\r\n  TERM: 'xterm-256color',\r\n  LSCOLORS: 'ExGxBxDxCxEgEdxbxgExEx',\r\n  PATH: '/bin:/usr/bin:/usr/local/bin',\r\n  HOME: '/home',\r\n  SHELL: '/bin/jsh',\r\n  HISTFILE: '/home/.jsh_history',\r\n  TMPDIR: '/tmp',\r\n  CHROME_BIN: '/usr/local/bin/google-chrome',\r\n  GIT_PROXY: 'https://p.stackblitz.com',\r\n  PWD: '/home/projects/sveltejs-kit-template-default-u765us',\r\n  SVELTEKIT_FORK: 'true'\r\n}\r\n```\r\n\r\n### Logs\r\n\r\n```Shell\r\n12:21:09 AM:   Netlify Build                                                 \r\n12:21:09 AM: ────────────────────────────────────────────────────────────────\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Version\r\n12:21:09 AM:   @netlify/build 29.5.1\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Flags\r\n12:21:09 AM:   baseRelDir: true\r\n12:21:09 AM:   buildId: 63d5bbde011c720008ba785d\r\n12:21:09 AM:   deployId: 63d5bbde011c720008ba785f\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Current directory\r\n12:21:09 AM:   /opt/build/repo/sites/web\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Config file\r\n12:21:09 AM:   /opt/build/repo/sites/web/netlify.toml\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Context\r\n12:21:09 AM:   production\r\n12:21:09 AM: ​\r\n12:21:09 AM: ❯ Loading plugins\r\n12:21:09 AM:    - @netlify/plugin-lighthouse@4.0.7 from Netlify app\r\n12:21:11 AM: ​\r\n12:21:11 AM:   1. build.command from netlify.toml                            \r\n12:21:11 AM: ────────────────────────────────────────────────────────────────\r\n12:21:11 AM: ​\r\n12:21:11 AM: $ npm run build\r\n12:21:11 AM: > tickets@0.0.1 build\r\n12:21:11 AM: > vite build\r\n12:21:11 AM: ▲ [WARNING] Cannot find base config file \"./.svelte-kit/tsconfig.json\" [tsconfig.json]\r\n12:21:11 AM:     tsconfig.json:2:13:\r\n12:21:11 AM:       2 │   \"extends\": \"./.svelte-kit/tsconfig.json\",\r\n12:21:11 AM:         ╵              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n12:21:12 AM: vite v4.0.4 building SSR bundle for production...\r\n12:21:12 AM: transforming...\r\n12:21:14 AM: ../assets/fonts/font.woff2 referenced in /opt/build/repo/sites/web/src/styles/global.scss didn't resolve at build time, it will remain unchanged to be resolved at runtime\r\n✓ 115 modules transformed.\r\n12:21:14 AM: 12:21:14 AM [vite-plugin-svelte] ssr compile done.\r\n12:21:14 AM: package             \tfiles\t  time\t   avg\r\n12:21:14 AM: tickets             \t   11\t 0.32s\t28.7ms\r\n12:21:14 AM: @portabletext/svelte\t   15\t51.6ms\t 3.4ms\r\n12:21:14 AM: @sveltejs/kit       \t    2\t21.4ms\t10.7ms\r\n12:21:14 AM: Generated an empty chunk: \"entries/endpoints/api/booking/_server.ts\".\r\n12:21:14 AM: rendering chunks...\r\n\r\n... CHUNKS BEING RENDERED HERE\r\n\r\n12:21:15 AM: .svelte-kit/output/client/_app/immutable/components/pages/(public)/_page.svelte-9b90a5a9.js    84.67 kB │ gzip: 13.23 kB\r\n12:21:16 AM: { SVELTEKIT_FORK: 'true' } <-- This is just me writing `console.log(process.env)` in a file imported by a +server.ts file\r\n```\r\n\r\n\r\n\r\n### System Info\r\n\r\n\r\nThis was observed on a standard Netlify deployment with `adapter-auto`, however the only changes in the package-lock file between a system with a successful build and one with a failed one are with `'@sveltejs/kit': 1.3.1`, so I would assume the issue is not in the Netlify or auto adapters.\r\n\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/8769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/8769/timeline","performed_via_github_app":null,"state_reason":"completed"}