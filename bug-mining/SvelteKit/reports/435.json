{"url":"https://api.github.com/repos/sveltejs/kit/issues/11031","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/11031/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/11031/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/11031/events","html_url":"https://github.com/sveltejs/kit/issues/11031","id":1991032516,"node_id":"I_kwDOEiPr8c52rL7E","number":11031,"title":"Problem in static site (ssr=false, prerender=true) after upgrade to 1.27.5","user":{"login":"FabrizioFerrari-ILS","id":121181547,"node_id":"U_kgDOBzkVaw","avatar_url":"https://avatars.githubusercontent.com/u/121181547?v=4","gravatar_id":"","url":"https://api.github.com/users/FabrizioFerrari-ILS","html_url":"https://github.com/FabrizioFerrari-ILS","followers_url":"https://api.github.com/users/FabrizioFerrari-ILS/followers","following_url":"https://api.github.com/users/FabrizioFerrari-ILS/following{/other_user}","gists_url":"https://api.github.com/users/FabrizioFerrari-ILS/gists{/gist_id}","starred_url":"https://api.github.com/users/FabrizioFerrari-ILS/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FabrizioFerrari-ILS/subscriptions","organizations_url":"https://api.github.com/users/FabrizioFerrari-ILS/orgs","repos_url":"https://api.github.com/users/FabrizioFerrari-ILS/repos","events_url":"https://api.github.com/users/FabrizioFerrari-ILS/events{/privacy}","received_events_url":"https://api.github.com/users/FabrizioFerrari-ILS/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229640667,"node_id":"MDU6TGFiZWwzMjI5NjQwNjY3","url":"https://api.github.com/repos/sveltejs/kit/labels/p1-important","name":"p1-important","color":"2C3488","default":false,"description":"SvelteKit cannot be used by a large number of people, basic functionality is missing, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-11-13T16:40:31Z","updated_at":"2023-11-14T09:31:17Z","closed_at":"2023-11-14T09:31:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nIt seems that fix https://github.com/sveltejs/kit/pull/10988 breaks imports and libraries which use browser objects. The example provided is self contained, but the problem happens also when including external libraries, on which there is no control.\r\nThe problem is not present using version 1.27.3\n\n### Reproduction\n\nThis repo contains a simple example https://github.com/ff-ils/ssr-prerender\n\n### Logs\n\n```Shell\nnpm run build\r\n\r\n> ssr-prerender@0.0.1 build\r\n> vite build\r\n\r\n\r\nvite v4.5.0 building SSR bundle for production...\r\n✓ 74 modules transformed.\r\n\r\nvite v4.5.0 building for production...\r\n✓ 63 modules transformed.\r\n.svelte-kit/output/client/_app/version.json                              0.03 kB │ gzip: 0.05 kB\r\n.svelte-kit/output/client/.vite/manifest.json                            2.12 kB │ gzip: 0.40 kB\r\n.svelte-kit/output/client/_app/immutable/nodes/2.cde87348.js             0.43 kB │ gzip: 0.30 kB\r\n.svelte-kit/output/client/_app/immutable/nodes/0.f700f867.js             0.74 kB │ gzip: 0.48 kB\r\n.svelte-kit/output/client/_app/immutable/nodes/1.b30bcfe0.js             1.03 kB │ gzip: 0.60 kB\r\n.svelte-kit/output/client/_app/immutable/chunks/scheduler.e108d1fd.js    2.16 kB │ gzip: 1.02 kB\r\n.svelte-kit/output/client/_app/immutable/chunks/singletons.94c07e86.js   2.85 kB │ gzip: 1.46 kB\r\n.svelte-kit/output/client/_app/immutable/chunks/index.79a65843.js        5.40 kB │ gzip: 2.30 kB\r\n.svelte-kit/output/client/_app/immutable/entry/app.0fc24b8e.js           5.84 kB │ gzip: 2.32 kB\r\n.svelte-kit/output/client/_app/immutable/entry/start.5c119207.js        24.89 kB │ gzip: 9.80 kB\r\n✓ built in 308ms\r\nReferenceError: window is not defined\r\n    at file:///C:/Test/ssr-prerender/.svelte-kit/output/server/entries/pages/_page.svelte.js:3:11\r\n    at ModuleJob.run (node:internal/modules/esm/module_job:217:25)\r\n    at async ModuleLoader.import (node:internal/modules/esm/loader:316:24)\r\n    at async Module.component (file:///C:/Test/ssr-prerender/.svelte-kit/output/server/nodes/2.js:5:59)\r\n    at async Promise.all (index 1)\r\n    at async render_response (file:///C:/Test/ssr-prerender/.svelte-kit/output/server/index.js:1369:21)\r\n    at async render_page (file:///C:/Test/ssr-prerender/.svelte-kit/output/server/index.js:2209:12)\r\n    at async resolve (file:///C:/Test/ssr-prerender/.svelte-kit/output/server/index.js:2790:24)\r\n    at async respond (file:///C:/Test/ssr-prerender/.svelte-kit/output/server/index.js:2676:22)\r\n    at async visit (file:///C:/Test/ssr-prerender/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:203:20)\r\n\r\nnode:internal/event_target:1083\r\n  process.nextTick(() => { throw err; });\r\n                           ^\r\nError: 500 /\r\nTo suppress or handle this error, implement `handleHttpError` in https://kit.svelte.dev/docs/configuration#prerender\r\n    at file:///C:/Test/ssr-prerender/node_modules/@sveltejs/kit/src/core/config/options.js:212:13\r\n    at file:///C:/Test/ssr-prerender/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:64:25\r\n    at save (file:///C:/Test/ssr-prerender/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:403:4)\r\n    at visit (file:///C:/Test/ssr-prerender/node_modules/@sveltejs/kit/src/core/postbuild/prerender.js:236:3)\r\nEmitted 'error' event on Worker instance at:\r\n    at [kOnErrorMessage] (node:internal/worker:326:10)\r\n    at [kOnMessage] (node:internal/worker:337:37)\r\n    at MessagePort.<anonymous> (node:internal/worker:232:57)\r\n    at [nodejs.internal.kHybridDispatch] (node:internal/event_target:807:20)\r\n    at exports.emitMessage (node:internal/per_context/messageport:23:28)\r\n\r\nNode.js v20.9.0\n```\n\n\n### System Info\n\n```Shell\nSystem:\r\n    OS: Windows 10 10.0.19045\r\n    CPU: (20) x64 12th Gen Intel(R) Core(TM) i7-12700\r\n    Memory: 10.13 GB / 31.68 GB\r\n  Binaries:\r\n    Node: 20.9.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 10.2.3 - C:\\Program Files\\nodejs\\npm.CMD\r\n    pnpm: 8.0.0 - ~\\AppData\\Roaming\\npm\\pnpm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.19041.3570.0), Chromium (119.0.2151.58)\r\n    Internet Explorer: 11.0.19041.3570\r\n  npmPackages:\r\n    @sveltejs/adapter-static: 2.0.3 => 2.0.3\r\n    @sveltejs/kit: 1.27.4 => 1.27.4\r\n    svelte: 4.2.3 => 4.2.3\r\n    vite: 4.5.0 => 4.5.0\n```\n\n\n### Severity\n\nblocking an upgrade\n\n### Additional Information\n\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/11031/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/11031/timeline","performed_via_github_app":null,"state_reason":"completed"}