{"url":"https://api.github.com/repos/sveltejs/kit/issues/5749","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/5749/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/5749/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/5749/events","html_url":"https://github.com/sveltejs/kit/issues/5749","id":1321564710,"node_id":"I_kwDOEiPr8c5OxXom","number":5749,"title":"Way to access the response body size in the hook","user":{"login":"acarl005","id":8334252,"node_id":"MDQ6VXNlcjgzMzQyNTI=","avatar_url":"https://avatars.githubusercontent.com/u/8334252?v=4","gravatar_id":"","url":"https://api.github.com/users/acarl005","html_url":"https://github.com/acarl005","followers_url":"https://api.github.com/users/acarl005/followers","following_url":"https://api.github.com/users/acarl005/following{/other_user}","gists_url":"https://api.github.com/users/acarl005/gists{/gist_id}","starred_url":"https://api.github.com/users/acarl005/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/acarl005/subscriptions","organizations_url":"https://api.github.com/users/acarl005/orgs","repos_url":"https://api.github.com/users/acarl005/repos","events_url":"https://api.github.com/users/acarl005/events{/privacy}","received_events_url":"https://api.github.com/users/acarl005/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470046,"node_id":"MDU6TGFiZWwyNDI4NDcwMDQ2","url":"https://api.github.com/repos/sveltejs/kit/labels/feature%20/%20enhancement","name":"feature / enhancement","color":"a2eeef","default":false,"description":"New feature or request"},{"id":3229646350,"node_id":"MDU6TGFiZWwzMjI5NjQ2MzUw","url":"https://api.github.com/repos/sveltejs/kit/labels/p3-edge-case","name":"p3-edge-case","color":"0D4F0E","default":false,"description":"SvelteKit cannot be used in an uncommon way"},{"id":4343790735,"node_id":"LA_kwDOEiPr8c8AAAABAuj8jw","url":"https://api.github.com/repos/sveltejs/kit/labels/low%20hanging%20fruit","name":"low hanging fruit","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/4","html_url":"https://github.com/sveltejs/kit/milestone/4","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/4/labels","id":6613611,"node_id":"MDk6TWlsZXN0b25lNjYxMzYxMQ==","number":4,"title":"soon","description":"stuff we want to do as soon as time allows","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":78,"closed_issues":167,"state":"open","created_at":"2021-03-31T19:50:44Z","updated_at":"2025-10-03T13:11:43Z","due_on":null,"closed_at":null},"comments":5,"created_at":"2022-07-28T22:39:03Z","updated_at":"2023-01-19T23:13:59Z","closed_at":"2023-01-19T23:13:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\r\n\r\nI want to set up logging in my sveltekit hook. One of the things I want to log is the number of bytes in the response body. It would be nice if the `Response` exposed the body length so that we can access it. Something like this...\r\n\r\n```js\r\nexport async function handle({ event, resolve }) {\r\n    response = await resolve(event)\r\n    // these don't actually work, they are undefined. But something LIKE this would be nice\r\n    console.log(response.body.length)\r\n    console.log(response.headers.get(\"content-length\"))\r\n    return response\r\n}\r\n```\r\n\r\nI notice that the length is somewhere on the object if I just `console.log(response)` when returning JSON...\r\n\r\n```\r\nResponse {\r\n  [Symbol(realm)]: { settingsObject: {} },\r\n  [Symbol(state)]: {\r\n    aborted: false,\r\n    rangeRequested: false,\r\n    timingAllowPassed: false,\r\n    requestIncludesCredentials: false,\r\n    type: 'default',\r\n    status: 200,\r\n    timingInfo: null,\r\n    cacheState: '',\r\n    statusText: '',\r\n    headersList: HeadersList {\r\n      [Symbol(headers map)]: [Map],\r\n      [Symbol(headers map sorted)]: null\r\n    },\r\n    urlList: [],\r\n    body: {\r\n      stream: undefined,\r\n      source: '{\"result\":{\"rows\":[[\"to become more autonomous in data analysis\"],[\"to better structure your thoughts\"],[\"to develop a useful professional skill\"]],\"columns\":[{\"name\":\"reason\",\"type\":\"VARCHAR\"}],\"moreRows\":false}}',\r\n      length: 213\r\n    }\r\n  },\r\n  [Symbol(headers)]: HeadersList {\r\n    [Symbol(headers map)]: Map(2) {\r\n      'content-type' => 'application/json; charset=utf-8',\r\n      'etag' => '\"1ba7x9x\"'\r\n    },\r\n    [Symbol(headers map sorted)]: null\r\n  }\r\n}\r\n```\r\n\r\n...but that piece of data is private (attached to a symbol) and I can't access it.\r\n\r\nIn my opinion, being able to observe information like this in my hook is important to building debuggable, observable web services. Response payload size is an important metric to monitor. Putting that logging logic in the hook seems to be the only way to make sure it is reliably logged.\r\n\r\n### Describe the proposed solution\r\n\r\nThe workaround I have right now is `await response.clone().text()`, but that is not ideal because I have to consume the stream. This is wasteful especially if I only want the length.\r\n\r\n\r\n### Alternatives considered\r\n\r\nI suppose I could do something with `Object.getOwnPropertySymbols()`, but I think that's frowned upon?\r\n\r\n### Importance\r\n\r\nwould make my life easier\r\n\r\n### Additional Information\r\n\r\nAs I understand it (may be wrong), the content length isn't necessarily always known without reading the stream, but there are many cases where the length is known at the time of the response instantiation, like when JSON or HTML are being returned from a string in memory. Sveltekit should be able to set the length in cases where length is known.\r\n\r\nHere is a simple case where content length is known but not exposed: https://stackblitz.com/edit/sveltejs-kit-template-default-9ydsbu?file=src%2Fhooks.js&terminal=dev","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/5749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/5749/timeline","performed_via_github_app":null,"state_reason":"completed"}