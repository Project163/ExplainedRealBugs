{"url":"https://api.github.com/repos/sveltejs/kit/issues/6568","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6568/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6568/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6568/events","html_url":"https://github.com/sveltejs/kit/issues/6568","id":1361238968,"node_id":"I_kwDOEiPr8c5RItu4","number":6568,"title":"prerender = true in /+layout.server.ts breaks the route after deployment to netlify / vercel","user":{"login":"StephenGunn","id":7240548,"node_id":"MDQ6VXNlcjcyNDA1NDg=","avatar_url":"https://avatars.githubusercontent.com/u/7240548?v=4","gravatar_id":"","url":"https://api.github.com/users/StephenGunn","html_url":"https://github.com/StephenGunn","followers_url":"https://api.github.com/users/StephenGunn/followers","following_url":"https://api.github.com/users/StephenGunn/following{/other_user}","gists_url":"https://api.github.com/users/StephenGunn/gists{/gist_id}","starred_url":"https://api.github.com/users/StephenGunn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/StephenGunn/subscriptions","organizations_url":"https://api.github.com/users/StephenGunn/orgs","repos_url":"https://api.github.com/users/StephenGunn/repos","events_url":"https://api.github.com/users/StephenGunn/events{/privacy}","received_events_url":"https://api.github.com/users/StephenGunn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sveltejs/kit/milestones/2","html_url":"https://github.com/sveltejs/kit/milestone/2","labels_url":"https://api.github.com/repos/sveltejs/kit/milestones/2/labels","id":6044960,"node_id":"MDk6TWlsZXN0b25lNjA0NDk2MA==","number":2,"title":"1.0","description":"stuff we need to nail down before launch","creator":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":628,"state":"closed","created_at":"2020-10-29T01:17:50Z","updated_at":"2022-12-19T11:47:29Z","due_on":null,"closed_at":"2022-12-19T11:47:29Z"},"comments":31,"created_at":"2022-09-04T19:57:07Z","updated_at":"2022-11-08T09:37:39Z","closed_at":"2022-11-08T09:37:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI found this bug in one of my bigger projects after migrating to the new routing configuration. It took me a while to pinpoint that it was the `prerender = true` setting in `/+layout.server.ts` that was causing the bug. The project runs fine locally using pnpm dev || pnpm build || pnpm preview. The project also has no problem building once deployed to Netlify / Vercel. It's only after publishing that it breaks.\r\n\r\nI created a new project from scratch and was able to recreate the bug when deployed to both netlify and vercel.\r\n\r\n- The repo for the scratch project is here: https://github.com/StephenGunn/layoutprerender\r\n\r\n- The deployment on Netlify is here: https://glittering-mermaid-5b82d2.netlify.app\r\n\r\n- The deployment on Vercel is here: https://layoutprerender.vercel.app\r\n\r\nYou'll be able to see the 500 error on both Netlify and Vercel using the above links. I also have examples of the exact same code but with prerendering not set and the routes work as intended.\r\n\r\nI tried to make the code and example as clear as possible, let me know if you have any questions.\r\n\r\nEDIT: prerender = true works on normal /+page.server.ts powered routes from my testing\r\n\r\n### Reproduction\r\n\r\n- clone https://github.com/StephenGunn/layoutprerender and deploy to netlify or vercel\r\n\r\n### Logs\r\n\r\n```shell\r\nNetlify doesn't seem to log any error in the render.js function logs.\r\n\r\nVercel logs this: [GET] /episodes-3/__data.js?__invalid=nyn&__id=1\r\n\r\nThe error on the frontend is this:\r\n500\r\nFailed to fetch dynamically imported module: https://layoutprerender.vercel.app/episodes-3/__data.js?__invalid=nyn&__id=1\r\nTypeError: Failed to fetch dynamically imported module: https://layoutprerender.vercel.app/episodes-3/__data.js?__invalid=nyn&__id=1\r\n```\r\n\r\n\r\n### System Info\r\n\r\n```shell\r\nNetlify / Vercel\r\n```\r\n\r\n\r\n### Severity\r\n\r\nannoyance\r\n\r\n### Additional Information\r\n\r\nMarked as an annoyance because I can just turn off prerendering for my /+layout.server.ts and the site works.\r\n\r\nBut I would like to be able to turn this feature back on since it does slow down certain routes and puts added stress on my backend.","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6568/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6568/timeline","performed_via_github_app":null,"state_reason":"completed"}