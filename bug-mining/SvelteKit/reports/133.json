{"url":"https://api.github.com/repos/sveltejs/kit/issues/6610","repository_url":"https://api.github.com/repos/sveltejs/kit","labels_url":"https://api.github.com/repos/sveltejs/kit/issues/6610/labels{/name}","comments_url":"https://api.github.com/repos/sveltejs/kit/issues/6610/comments","events_url":"https://api.github.com/repos/sveltejs/kit/issues/6610/events","html_url":"https://github.com/sveltejs/kit/issues/6610","id":1363702223,"node_id":"I_kwDOEiPr8c5RSHHP","number":6610,"title":"actions: generated `Action` type is unknown and `export let form` is not populated","user":{"login":"cdcarson","id":78032,"node_id":"MDQ6VXNlcjc4MDMy","avatar_url":"https://avatars.githubusercontent.com/u/78032?v=4","gravatar_id":"","url":"https://api.github.com/users/cdcarson","html_url":"https://github.com/cdcarson","followers_url":"https://api.github.com/users/cdcarson/followers","following_url":"https://api.github.com/users/cdcarson/following{/other_user}","gists_url":"https://api.github.com/users/cdcarson/gists{/gist_id}","starred_url":"https://api.github.com/users/cdcarson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdcarson/subscriptions","organizations_url":"https://api.github.com/users/cdcarson/orgs","repos_url":"https://api.github.com/users/cdcarson/repos","events_url":"https://api.github.com/users/cdcarson/events{/privacy}","received_events_url":"https://api.github.com/users/cdcarson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2428470026,"node_id":"MDU6TGFiZWwyNDI4NDcwMDI2","url":"https://api.github.com/repos/sveltejs/kit/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":3229640667,"node_id":"MDU6TGFiZWwzMjI5NjQwNjY3","url":"https://api.github.com/repos/sveltejs/kit/labels/p1-important","name":"p1-important","color":"2C3488","default":false,"description":"SvelteKit cannot be used by a large number of people, basic functionality is missing, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-09-06T19:07:33Z","updated_at":"2022-09-07T12:00:33Z","closed_at":"2022-09-06T20:18:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nNot sure whether this is just me missing something. But a couple of things seem not to be working in a route with actions. \r\n\r\nIn the page component: \r\n\r\n1. The generated `ActionData` type seems stubbornly `unknown`.  I tried restarting the typescript and svelte language servers, stopping and restarting `npm run dev`, `npm run check` and restarting VSCode, all to no avail.\r\n2. The `export let form: ActionData` never seems to get populated after an invalid submission. ~~The form does work when it  is valid, however.~~ The action does work as I wrote it, however, redirecting on success and staying on the same page when I return `invalid(...)`.\r\n\r\nHere's what I'd expect to happen:\r\n\r\nFor (1) I'd assume that the generated `ActionData` would be inferred from the return type of my `default` action.\r\n\r\nFor (2) note that I've only gotten so far as trying a plain POST request, with no enhancement. I'd expect that `export let form` would contain something other than `undefined` after an invalid submission. Without resolving (1) it's hard to know what that something should be.\r\n\r\n\r\nAnyway, I think I've read the docs correctly, but let me know if I've missed something.  Thanks.\r\n\r\n### Reproduction\r\n\r\nhttps://github.com/cdcarson/issue-sveltekit-generated-actiondata-type-undefined.git\r\n\r\nThe relevant route is in `src/routes/prefs`.\r\n\r\nTo see that `ActionData` is `unknown`:\r\n- Run the app to generate types\r\n- Open `src/routes/prefs/+page.svelte`\r\n- Hover over `form` to get the type\r\n\r\nTo see that `form` never gets populated:\r\n- Run the app and navigate to http://localhost:5173/prefs\r\n- Enter \"kapoor black\" as your favorite color and submit. This is a forbidden color, so the action returns `invalid(...)`. But somehow nothing is getting into the template, AFAICT.\r\n- Enter \"blue\" and submit. This will work and you will be redirected to the home page.\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n### System Info\r\n\r\n```shell\r\nSystem:\r\n    OS: macOS 12.5.1\r\n    CPU: (8) arm64 Apple M1\r\n    Memory: 148.02 MB / 8.00 GB\r\n    Shell: 5.8.1 - /bin/zsh\r\n  Binaries:\r\n    Node: 16.17.0 - ~/.nvm/versions/node/v16.17.0/bin/node\r\n    npm: 8.15.0 - ~/.nvm/versions/node/v16.17.0/bin/npm\r\n  Browsers:\r\n    Chrome: 105.0.5195.52\r\n    Safari: 15.6.1\r\n  npmPackages:\r\n    @sveltejs/adapter-auto: next => 1.0.0-next.71 \r\n    @sveltejs/kit: next => 1.0.0-next.472 \r\n    svelte: ^3.44.0 => 3.50.0 \r\n    vite: ^3.1.0 => 3.1.0\r\n```\r\n\r\n\r\n### Severity\r\n\r\nblocking an upgrade\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"dummdidumm","id":5968653,"node_id":"MDQ6VXNlcjU5Njg2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5968653?v=4","gravatar_id":"","url":"https://api.github.com/users/dummdidumm","html_url":"https://github.com/dummdidumm","followers_url":"https://api.github.com/users/dummdidumm/followers","following_url":"https://api.github.com/users/dummdidumm/following{/other_user}","gists_url":"https://api.github.com/users/dummdidumm/gists{/gist_id}","starred_url":"https://api.github.com/users/dummdidumm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dummdidumm/subscriptions","organizations_url":"https://api.github.com/users/dummdidumm/orgs","repos_url":"https://api.github.com/users/dummdidumm/repos","events_url":"https://api.github.com/users/dummdidumm/events{/privacy}","received_events_url":"https://api.github.com/users/dummdidumm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sveltejs/kit/issues/6610/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sveltejs/kit/issues/6610/timeline","performed_via_github_app":null,"state_reason":"completed"}