{"url":"https://api.github.com/repos/assertj/assertj/issues/2599","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/2599/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/2599/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/2599/events","html_url":"https://github.com/assertj/assertj/issues/2599","id":1225664371,"node_id":"I_kwDOAIX3Vs5JDidz","number":2599,"title":"isUnmodifiable() fails with Collections.singleton and Collections.singletonList although they are unmodifiable","user":{"login":"glhez","id":10855953,"node_id":"MDQ6VXNlcjEwODU1OTUz","avatar_url":"https://avatars.githubusercontent.com/u/10855953?v=4","gravatar_id":"","url":"https://api.github.com/users/glhez","html_url":"https://github.com/glhez","followers_url":"https://api.github.com/users/glhez/followers","following_url":"https://api.github.com/users/glhez/following{/other_user}","gists_url":"https://api.github.com/users/glhez/gists{/gist_id}","starred_url":"https://api.github.com/users/glhez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glhez/subscriptions","organizations_url":"https://api.github.com/users/glhez/orgs","repos_url":"https://api.github.com/users/glhez/repos","events_url":"https://api.github.com/users/glhez/events{/privacy}","received_events_url":"https://api.github.com/users/glhez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/assertj/assertj/milestones/63","html_url":"https://github.com/assertj/assertj/milestone/63","labels_url":"https://api.github.com/repos/assertj/assertj/milestones/63/labels","id":7421574,"node_id":"MI_kwDOAIX3Vs4AcT6G","number":63,"title":"3.23.0","description":"","creator":{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":34,"state":"closed","created_at":"2021-11-23T09:28:57Z","updated_at":"2024-04-17T06:38:09Z","due_on":"2022-04-30T07:00:00Z","closed_at":"2022-05-31T17:11:02Z"},"comments":2,"created_at":"2022-05-04T17:22:13Z","updated_at":"2022-05-04T22:04:17Z","closed_at":"2022-05-04T21:56:36Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"AssertJ version: 3.22.0\r\n\r\nThe various implementation of `Collections.singleton`, `Collections.singletonList`, `Collections.singletonMap` all extends respectively `java.util.AbstractSet`, `java.util.AbstractList` and `java.util.AbstractMap` and are all being immutable.\r\n\r\nThe `org.assertj.core.api.AbstractCollectionAssert.assertIsUnmodifiable()` fails with the following assertions:\r\n\r\n        assertThat(singleton(\"A\")).isUnmodifiable();\r\n        assertThat(singletonList(\"A\")).isUnmodifiable();\r\n\r\nThe failure is fairly simple:\r\n\r\n```\r\njava.lang.AssertionError:\r\nExpecting actual to be unmodifiable, but invoking\r\n  \"Collection.addAll(emptyCollection())\"\r\nsucceeded instead of throwing java.lang.UnsupportedOperationException\r\n\tat\r\n```\r\n\r\nThe reason behind the failure is due to default implementation of `addAll` in case of `AbstractList` (in fact `AbstractCollection`) which simply do a \"add\" and which does nothing with an empty collection.\r\n\r\nI think it would be best to pass a collection of some element (a collection containing only null ?) rather than trying to pry on the collection concrete type, especially when some implementations may also exhibit the same problem, for example Guava `ImmutableList` do extends `AbstractCollection` : https://guava.dev/releases/23.0/api/docs/com/google/common/collect/ImmutableList.html\r\n\r\nI can do a PR with that in mind, except if there is a better way.\r\n\r\nThere is no \"isUnmodifiable\" for map but I've seen #2381, so this would also apply to.\r\n\r\n","closed_by":{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/2599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/2599/timeline","performed_via_github_app":null,"state_reason":"completed"}