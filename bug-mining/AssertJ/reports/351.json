{"url":"https://api.github.com/repos/assertj/assertj/issues/1569","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/1569/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/1569/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/1569/events","html_url":"https://github.com/assertj/assertj/issues/1569","id":475506996,"node_id":"MDU6SXNzdWU0NzU1MDY5OTY=","number":1569,"title":"Composable SoftAssertions entry-point classes","user":{"login":"kriegfrj","id":7224087,"node_id":"MDQ6VXNlcjcyMjQwODc=","avatar_url":"https://avatars.githubusercontent.com/u/7224087?v=4","gravatar_id":"","url":"https://api.github.com/users/kriegfrj","html_url":"https://github.com/kriegfrj","followers_url":"https://api.github.com/users/kriegfrj/followers","following_url":"https://api.github.com/users/kriegfrj/following{/other_user}","gists_url":"https://api.github.com/users/kriegfrj/gists{/gist_id}","starred_url":"https://api.github.com/users/kriegfrj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kriegfrj/subscriptions","organizations_url":"https://api.github.com/users/kriegfrj/orgs","repos_url":"https://api.github.com/users/kriegfrj/repos","events_url":"https://api.github.com/users/kriegfrj/events{/privacy}","received_events_url":"https://api.github.com/users/kriegfrj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-08-01T06:57:04Z","updated_at":"2020-04-06T10:23:42Z","closed_at":"2020-04-06T10:23:42Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\r\n\r\nSoft assertions are good.\r\n\r\nI like being able to use soft assertions with my custom exceptions in my code.\r\n\r\nOne of the selling points of AssertJ is the single entry point, which makes it easy to simply type assertThat() in your IDE and have it automatically give you the list of applicable assertions.\r\n\r\nI'd like to be able to easily combine soft assertions entry classes from multiple sources. This is not currently possible as Java doesn't support multiple inheritance for classes. The workaround is clunky - each project must maintain its own soft assertions entry point with all of the assertThats in it that they want.\r\n\r\nSwitching to a model based on interfaces and Java 8 default methods would make multiple inheritance possible.\r\n\r\n### Example\r\n\r\n#### Current situation\r\n\r\n```java\r\npublic class Project1SoftAssertions extends SoftAssertions {\r\n    public MyCustomAssert assertThat(MyCustom a) {\r\n        return proxy(MyCustomAssert.class, MyCustom.class, a);\r\n    }\r\n}\r\n\r\npublic class Project2SoftAssertions extends SoftAssertions {\r\n    public MyCustom2Assert assertThat(MyCustom2 a) {\r\n        return proxy(MyCustom2Assert.class, MyCustom2.class, a);\r\n    }\r\n}\r\n\r\n// Can't do this - multiple inheritance not permitted for classes\r\npublic class UberSoftAssertions extends Project1SoftAssertions, Project2SoftAssertions {\r\n}\r\n\r\n// Have to do this - lots of repetition if you've got lots of assertions!\r\npublic class UberSoftAssertions extends SoftAssertions {\r\n    public MyCustomAssert assertThat(MyCustom a) {\r\n        return proxy(MyCustomAssert.class, MyCustom.class, a);\r\n    }\r\n    public MyCustom2Assert assertThat(MyCustom2 a) {\r\n        return proxy(MyCustom2Assert.class, MyCustom2.class, a);\r\n    }\r\n}\r\n\r\n// Also can't do this:\r\npublic class JUnitJupiterUberSoftAssertions\r\n    extends JUnitJupiterSoftAssertions,\r\n        Project1SoftAssertions, Project2SoftAssertions {}\r\n```\r\n#### Proposed\r\n\r\nThere will be a single functional interface that all soft assertions classes must implement. This has one default method that is used to generate the proxy classes. Then subinterfaces of this interface can call this method in their `default assertThat()` implementations. Because the soft assertion entry points can be interfaces, you can combine several of them into a single class.\r\n\r\n```java\r\n\r\npublic interface SoftAssertionsBase {\r\n    <V extends Assert<V, T>, T> V proxy(Class<V> assertClass, Class<T> actualClass, T actual);\r\n}\r\n\r\n// Existing implementation with the SoftAssertionsBase implementation added\r\npublic class AbstractSoftAssertions implements SoftAssertionsBase {\r\n    // Note that there is also a TODO in the source for proxy() that adds the bound on V,\r\n    // as per below.\r\n    public <V extends Assert<V, T>, T> V proxy(Class<V> assertClass, Class<T> actualClass, T actual) {\r\n        return proxies.createSoftAssertionProxy(assertClass, actualClass, actual);\r\n    }\r\n    ....\r\n}\r\n\r\npublic interface StandardSoftAssertions extends SoftAssertionsBase {\r\n    // All of the standard assertThat assertions go in here as default methods.\r\n}\r\n\r\npublic interface Project1SoftAssertions extends SoftAssertionsBase {\r\n    default MyCustomAssert assertThat(MyCustom a) {\r\n        return proxy(MyCustomAssert.class, MyCustom.class, a);\r\n    }\r\n}\r\n\r\npublic class Project2SoftAssertions extends SoftAssertionsBase {\r\n    public MyCustom2Assert assertThat(MyCustom2 a) {\r\n        return proxy(MyCustom2Assert.class, MyCustom2.class, a);\r\n    }\r\n}\r\n\r\n// Now we can do this\r\npublic class UberSoftAssertions extends AbstractStandardSoftAssertions\r\n    implements Project1SoftAssertions, Project2SoftAssertions {\r\n}\r\n\r\n// And this\r\npublic class JUnitJupiterUberSoftAssertions\r\n    extends JUnitJupiterSoftAssertions\r\n    implements Project1SoftAssertions, Project2SoftAssertions {}\r\n\r\n// And this, which allows us to get rid of that annoying \"softly.\" prefix on all assertions:\r\npublic class MyTest extends SoftAssertions implements Project1SoftAssertions, Project2SoftAssertions {\r\n\r\n    @AfterAll\r\n    public void after() {\r\n        assertAll();\r\n    }\r\n}\r\n```\r\n\r\nPlease note that, although JDK < 1.8 is dying rapidly, nonetheless the above is still JDK <1.8 compatible because it's only the custom extension entry points that need to be interfaces with default methods. If you're pre JDK 1.8, simply define your custom extension entry points as classes (as you always have) and you're back where we started.","closed_by":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/1569/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/1569/timeline","performed_via_github_app":null,"state_reason":"completed"}