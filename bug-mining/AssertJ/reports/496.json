{"url":"https://api.github.com/repos/assertj/assertj/issues/2678","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/2678/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/2678/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/2678/events","html_url":"https://github.com/assertj/assertj/issues/2678","id":1279513433,"node_id":"I_kwDOAIX3Vs5MQ9NZ","number":2678,"title":"Assertion with `java.awt.Path2D` object `usingRecursiveComparison().isEqualsTo()` fails in `3.23.0+`","user":{"login":"dinox0r","id":2560573,"node_id":"MDQ6VXNlcjI1NjA1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/2560573?v=4","gravatar_id":"","url":"https://api.github.com/users/dinox0r","html_url":"https://github.com/dinox0r","followers_url":"https://api.github.com/users/dinox0r/followers","following_url":"https://api.github.com/users/dinox0r/following{/other_user}","gists_url":"https://api.github.com/users/dinox0r/gists{/gist_id}","starred_url":"https://api.github.com/users/dinox0r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dinox0r/subscriptions","organizations_url":"https://api.github.com/users/dinox0r/orgs","repos_url":"https://api.github.com/users/dinox0r/repos","events_url":"https://api.github.com/users/dinox0r/events{/privacy}","received_events_url":"https://api.github.com/users/dinox0r/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":734184708,"node_id":"MDU6TGFiZWw3MzQxODQ3MDg=","url":"https://api.github.com/repos/assertj/assertj/labels/theme:%20recursive%20comparison","name":"theme: recursive comparison","color":"FEF2C0","default":false,"description":"An issue related to the recursive comparison"}],"state":"closed","locked":false,"assignee":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/assertj/assertj/milestones/67","html_url":"https://github.com/assertj/assertj/milestone/67","labels_url":"https://api.github.com/repos/assertj/assertj/milestones/67/labels","id":8654259,"node_id":"MI_kwDOAIX3Vs4AhA2z","number":67,"title":"3.25.0","description":"","creator":{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":77,"state":"closed","created_at":"2022-11-14T21:55:21Z","updated_at":"2024-01-02T23:13:09Z","due_on":null,"closed_at":"2023-12-31T16:16:47Z"},"comments":4,"created_at":"2022-06-22T04:45:37Z","updated_at":"2023-12-29T10:07:32Z","closed_at":"2023-07-09T13:19:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nThe following assertion passes for versions `â‰¤ 3.22.0`:\r\n\r\n```java\r\nimport java.awt.geom.Path2D;\r\n\r\nimport static org.assertj.core.api.Assertions.assertThat;\r\n\r\npublic class Main {\r\n  @SuppressWarnings(\"DuplicatedCode\")\r\n  public static void main(String... args) {\r\n    var path1 = new Path2D.Float();\r\n    path1.moveTo(0, 0);\r\n    path1.lineTo(10, 0);\r\n    path1.curveTo(13, 2, 13, 5, 10, 7);\r\n    path1.lineTo(0, 7);\r\n    path1.curveTo(-3, 5, -3, 2, 0, 0);\r\n    path1.closePath();\r\n\r\n    var path2 = new Path2D.Float();\r\n    path2.moveTo(0, 0);\r\n    path2.lineTo(10, 0);\r\n    path2.curveTo(13, 2, 13, 5, 10, 7);\r\n    path2.lineTo(0, 7);\r\n    path2.curveTo(-3, 5, -3, 2, 0, 0);\r\n    path2.closePath();\r\n\r\n    assertThat(path1)\r\n        .usingRecursiveComparison()\r\n        .isEqualTo(path2);\r\n  }\r\n}\r\n```\r\n\r\nBut from version `3.23.0+`, we get the following instead:\r\n\r\n```none\r\nException in thread \"main\" java.lang.AssertionError: \r\nExpecting actual:\r\n  java.awt.geom.Path2D$Float@6325a3ee\r\nto be equal to:\r\n  java.awt.geom.Path2D$Float@1d16f93d\r\nwhen recursively comparing field by field, but found the following difference:\r\n\r\nTop level actual and expected objects differ:\r\n- actual value  : java.awt.geom.Path2D$Float@6325a3ee\r\n- expected value: java.awt.geom.Path2D$Float@1d16f93d\r\n\r\nThe recursive comparison was performed with this configuration:\r\n- no overridden equals methods were used in the comparison (except for java types)\r\n- these types were compared with the following comparators:\r\n  - java.lang.Double -> DoubleComparator[precision=1.0E-15]\r\n  - java.lang.Float -> FloatComparator[precision=1.0E-6]\r\n  - java.nio.file.Path -> lexicographic comparator (Path natural order)\r\n- actual and expected objects and their fields were compared field by field recursively even if they were not of the same type, this allows for example to compare a Person to a PersonDto (call strictTypeChecking(true) to change that behavior).\r\n\r\n\tat Main.main(Main.java:26)\r\n``` \r\n\r\n**Additional context**\r\n\r\nAfter debugging a bit, it seems that the problem is in the `RecursiveComparisonDifferenceCalculator.mustCompareFieldsRecursively()`:\r\n\r\n```java\r\nprivate boolean mustCompareFieldsRecursively(DualValue dualValue) {\r\n\r\n  return !recursiveComparisonConfiguration.hasCustomComparator(dualValue)   // <- evals to 'true'\r\n         && !shouldHonorEquals(dualValue, recursiveComparisonConfiguration) // <- evals to 'true'\r\n         && dualValue.hasNoContainerValues(); \r\n         //            ^\r\n         //            | \r\n         //  This evaluates to 'false'. I believe is because the class Path2D.Float\r\n         //  has its data in arrays and not in java collection type containers.\r\n\r\n}\r\n``` \r\n\r\n* assertj core version: 3.22.0+\r\n* java version: Java 11\r\n* test framework version: JUnit 4\r\n\r\n**Test case reproducing the bug**\r\n\r\nAdd a test case showing the bug that we can run\r\n\r\n```java\r\npublic class SomeTest {\r\n  @Test\r\n  public void test() {\r\n    var path1 = new Path2D.Float();\r\n    path1.moveTo(0, 0);\r\n    path1.lineTo(10, 0);\r\n    path1.curveTo(13, 2, 13, 5, 10, 7);\r\n    path1.lineTo(0, 7);\r\n    path1.curveTo(-3, 5, -3, 2, 0, 0);\r\n    path1.closePath();\r\n\r\n    var path2 = new Path2D.Float();\r\n    path2.moveTo(0, 0);\r\n    path2.lineTo(10, 0);\r\n    path2.curveTo(13, 2, 13, 5, 10, 7);\r\n    path2.lineTo(0, 7);\r\n    path2.curveTo(-3, 5, -3, 2, 0, 0);\r\n    path2.closePath();\r\n\r\n    assertThat(path1)\r\n        .usingRecursiveComparison()\r\n        .isEqualTo(path2);\r\n  }\r\n}\r\n```","closed_by":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/2678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/2678/timeline","performed_via_github_app":null,"state_reason":"completed"}