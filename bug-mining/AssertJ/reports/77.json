{"url":"https://api.github.com/repos/assertj/assertj/issues/278","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/278/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/278/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/278/events","html_url":"https://github.com/assertj/assertj/issues/278","id":49695366,"node_id":"MDU6SXNzdWU0OTY5NTM2Ng==","number":278,"title":"isEqualToIgnoringGivenFields now verifies that the fields to ignore exist on the type of objects to compare","user":{"login":"kryger","id":1566028,"node_id":"MDQ6VXNlcjE1NjYwMjg=","avatar_url":"https://avatars.githubusercontent.com/u/1566028?v=4","gravatar_id":"","url":"https://api.github.com/users/kryger","html_url":"https://github.com/kryger","followers_url":"https://api.github.com/users/kryger/followers","following_url":"https://api.github.com/users/kryger/following{/other_user}","gists_url":"https://api.github.com/users/kryger/gists{/gist_id}","starred_url":"https://api.github.com/users/kryger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kryger/subscriptions","organizations_url":"https://api.github.com/users/kryger/orgs","repos_url":"https://api.github.com/users/kryger/repos","events_url":"https://api.github.com/users/kryger/events{/privacy}","received_events_url":"https://api.github.com/users/kryger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/assertj/assertj/milestones/10","html_url":"https://github.com/assertj/assertj/milestone/10","labels_url":"https://api.github.com/repos/assertj/assertj/milestones/10/labels","id":782768,"node_id":"MDk6TWlsZXN0b25lNzgyNzY4","number":10,"title":"2.0","description":null,"creator":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":26,"state":"closed","created_at":"2014-09-08T21:36:13Z","updated_at":"2015-09-29T03:52:57Z","due_on":null,"closed_at":"2015-03-15T03:46:15Z"},"comments":4,"created_at":"2014-11-21T13:24:12Z","updated_at":"2015-03-09T16:14:21Z","closed_at":"2014-11-30T09:59:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I was surprised to see that passing non-existent fields to  `assertIsEqualToIgnoringGivenFields()` is quietly ignored. In my case I made a typo: I wanted to exclude `dateVerified` but I mistyped it as `dateVerfied`. The test failed for an unexpected reason and it took me a little bit of time to realise what happened.\nI felt that a situation like this would always indicate user error, so I patched this behaviour:\n\nNew test case in `Objects_assertIsLenientEqualsToByIgnoringNullFields_Test`:\n\n```\n  @Test\n  public void should_fail_when_asked_to_ignore_non_existent_fields() {\n    thrown.expect(SomeYetToBeNamedException.class, \"Declared fields to ignore not found on the target object\");\n\n    AssertionInfo info = someInfo();\n    Jedi actual = new Jedi(\"Yoda\", \"Green\");\n    Jedi other = new Jedi(\"Yoda\", \"Green\");\n    objects.assertIsEqualToIgnoringGivenFields(info, actual, other, \"no-such-field\");\n  }\n```\n\nNew implementation of `Objects.assertIsEqualToIgnoringGivenFields`:\n\n```\n  private <A> ByFieldsComparison isEqualToIgnoringGivenFields(A actual, A other, String[] fields) {\n    List<String> fieldsNames = new LinkedList<String>();\n    List<Object> expectedValues = new LinkedList<Object>();\n    List<Object> rejectedValues = new LinkedList<Object>();\n    Set<String> ignoredFields = newLinkedHashSet(fields);\n    for (Field field : getDeclaredFieldsIncludingInherited(actual.getClass())) {\n      try {\n        if (!ignoredFields.contains(field.getName())) {\n          Object actualFieldValue = getFieldOrPropertyValue(actual, field);\n          Object otherFieldValue = getFieldOrPropertyValue(other, field);\n          if (!org.assertj.core.util.Objects.areEqual(actualFieldValue, otherFieldValue)) {\n            fieldsNames.add(field.getName());\n            rejectedValues.add(actualFieldValue);\n            expectedValues.add(otherFieldValue);\n          }\n          // ADDITION 1\n          ignoredFields.remove(field.getName());\n        }\n      } catch (IntrospectionError e) {\n        // Not readable field, skip.\n      }\n    }\n\n    // ADDITION 2\n    if (!ignoredFields.isEmpty()) {\n      throw new SomeYetToBeNamedException(\"Declared fields to ignore not found on the target object:\" + ignoredFields);\n    }\n    return new ByFieldsComparison(fieldsNames, expectedValues, rejectedValues);\n  }\n```\n\nThis change, however, breaks 6/10 tests in `Objects_assertIsLenientEqualsToByIgnoringFields_Test` which obviously suggests that the \"silently ignore invalid fields\" behaviour was actually intended.\nWhy would anyone ever need this to work this way in practice? Are there any edge cases I'm forgetting about? Would it be worth changing this behaviour? (i.e. apply the change suggested and adapt the failing tests to the new behaviour)\n","closed_by":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/278/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/278/timeline","performed_via_github_app":null,"state_reason":"completed"}