{"url":"https://api.github.com/repos/assertj/assertj/issues/1898","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/1898/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/1898/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/1898/events","html_url":"https://github.com/assertj/assertj/issues/1898","id":629685553,"node_id":"MDU6SXNzdWU2Mjk2ODU1NTM=","number":1898,"title":"Performance regression in 3.16.0: assertThat(byte[]).containsExactly(byte[])","user":{"login":"AlexLandau","id":5733346,"node_id":"MDQ6VXNlcjU3MzMzNDY=","avatar_url":"https://avatars.githubusercontent.com/u/5733346?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexLandau","html_url":"https://github.com/AlexLandau","followers_url":"https://api.github.com/users/AlexLandau/followers","following_url":"https://api.github.com/users/AlexLandau/following{/other_user}","gists_url":"https://api.github.com/users/AlexLandau/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexLandau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexLandau/subscriptions","organizations_url":"https://api.github.com/users/AlexLandau/orgs","repos_url":"https://api.github.com/users/AlexLandau/repos","events_url":"https://api.github.com/users/AlexLandau/events{/privacy}","received_events_url":"https://api.github.com/users/AlexLandau/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/assertj/assertj/milestones/51","html_url":"https://github.com/assertj/assertj/milestone/51","labels_url":"https://api.github.com/repos/assertj/assertj/milestones/51/labels","id":5284266,"node_id":"MDk6TWlsZXN0b25lNTI4NDI2Ng==","number":51,"title":"3.17.0","description":null,"creator":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":41,"state":"closed","created_at":"2020-04-07T10:19:00Z","updated_at":"2020-08-23T11:22:35Z","due_on":null,"closed_at":"2020-08-23T11:22:35Z"},"comments":1,"created_at":"2020-06-03T04:38:49Z","updated_at":"2020-07-20T11:11:08Z","closed_at":"2020-07-20T11:11:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Summary\r\n\r\nWhile upgrading our codebase from AssertJ 3.15.0 to 3.16.1, one of our tests hung until a 40 minute timeout expired. It turned out that this test was calling assertThat(byte[]).containsExactly(byte[]) on some byte arrays with 20 million elements.\r\n\r\nIt appears that this assertion had linear performance characteristics in 3.15.0, but quadratic performance in 3.16.0, specifically changing at commit 3dc400426359866bfef0c65c5e4cbd6d4eeaf9fb. For example, it now takes about two minutes to run this assertion on an array of size one million, vs. less than a second previously.\r\n\r\nMy current workaround is to just assert the truth of Arrays.equals().\r\n\r\n#### Example\r\n\r\n```java\r\n  @Test\r\n  public void testScaleRegression() {\r\n    // Times taken at assertj-core-3.16.1:\r\n    // 8k: 15 ms\r\n    // 16k: 39 ms\r\n    // 32k: 101 ms\r\n    // 64k: 371 ms\r\n    // 128k: 1616 ms\r\n    // 256k: 7398 ms\r\n    // 512k: 31654 ms\r\n    // 1024k: 118472 ms\r\n\r\n    // Times taken at assertj-core-3.15.0:\r\n    // 8k: 4 ms\r\n    // 16k: 8 ms\r\n    // 32k: 14 ms\r\n    // 64k: 25 ms\r\n    // 128k: 44 ms\r\n    // 256k: 92 ms\r\n    // 512k: 166 ms\r\n    // 1024k: 339 ms\r\n    for (int length : Arrays.asList(8_000, 8_000, 8_000, 16_000, 32_000, 64_000, 128_000, 256_000, 512_000, 1_024_000)) {\r\n      byte[] data = new byte[length];\r\n      Arrays.fill(data, (byte) 0x42);\r\n      byte[] data2 = new byte[length];\r\n      Arrays.fill(data2, (byte) 0x42);\r\n      System.out.println(\"Testing for length \" + length + \"...\");\r\n      long startTime2 = System.currentTimeMillis();\r\n      assertThat(data).containsExactly(data2);\r\n      System.out.println(\"Done testing \" + length + \", took \" + (System.currentTimeMillis() - startTime2) + \" ms\");\r\n    }\r\n  }\r\n```\r\n","closed_by":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/1898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/1898/timeline","performed_via_github_app":null,"state_reason":"completed"}