{"url":"https://api.github.com/repos/assertj/assertj/issues/1854","repository_url":"https://api.github.com/repos/assertj/assertj","labels_url":"https://api.github.com/repos/assertj/assertj/issues/1854/labels{/name}","comments_url":"https://api.github.com/repos/assertj/assertj/issues/1854/comments","events_url":"https://api.github.com/repos/assertj/assertj/issues/1854/events","html_url":"https://github.com/assertj/assertj/issues/1854","id":607884718,"node_id":"MDU6SXNzdWU2MDc4ODQ3MTg=","number":1854,"title":"Issue recursively comparing nested collections while ignoring collection order","user":{"login":"jkuester","id":8441903,"node_id":"MDQ6VXNlcjg0NDE5MDM=","avatar_url":"https://avatars.githubusercontent.com/u/8441903?v=4","gravatar_id":"","url":"https://api.github.com/users/jkuester","html_url":"https://github.com/jkuester","followers_url":"https://api.github.com/users/jkuester/followers","following_url":"https://api.github.com/users/jkuester/following{/other_user}","gists_url":"https://api.github.com/users/jkuester/gists{/gist_id}","starred_url":"https://api.github.com/users/jkuester/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkuester/subscriptions","organizations_url":"https://api.github.com/users/jkuester/orgs","repos_url":"https://api.github.com/users/jkuester/repos","events_url":"https://api.github.com/users/jkuester/events{/privacy}","received_events_url":"https://api.github.com/users/jkuester/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/assertj/assertj/milestones/50","html_url":"https://github.com/assertj/assertj/milestone/50","labels_url":"https://api.github.com/repos/assertj/assertj/milestones/50/labels","id":5003055,"node_id":"MDk6TWlsZXN0b25lNTAwMzA1NQ==","number":50,"title":"3.16.0","description":null,"creator":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":19,"state":"closed","created_at":"2020-01-14T09:49:00Z","updated_at":"2021-02-14T15:05:19Z","due_on":null,"closed_at":"2020-05-05T21:16:33Z"},"comments":3,"created_at":"2020-04-27T22:03:27Z","updated_at":"2020-05-02T03:06:13Z","closed_at":"2020-05-02T03:06:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Summary\r\n\r\nThere seems to be an issue when trying to recursively compare nested collections when the collections contain the same elements in different order.  If I am comparing two lists where each contains two more lists, the order of the top level lists is correctly ignored.  Additionally, the order of the bottom level lists is correctly ignored.  However, if the bottom level lists actually contain the same values AND the values in the expected lists are ALL ordered differently from the values in the actual lists, the the assertion fails (even though the expected lists contain the same values as the actual lists).  \r\n\r\nUsing **org.assertj:assertj-core:3.15.0**.\r\n\r\n#### Example\r\n\r\n```java\r\n// Original Lists\r\nList<Integer> listA = Arrays.asList(1 , 2);\r\nList<Integer> listB = Arrays.asList(1 , 2);\r\n\r\n//--------------------------------------------------------------------------------------------------------------\r\n// Base test case - compare against exact copies of the original lists\r\nList<Integer> listACopy = Arrays.asList(1 , 2);\r\nList<Integer> listBCopy = Arrays.asList(1 , 2);\r\n// The lists themselves are equal to each other.\r\nassertThat(listA).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(listACopy);\r\nassertThat(listB).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(listBCopy);\r\n// Also, nested lists are still considered equal (regardless of the order of the top-level list)\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listACopy, listBCopy));\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listBCopy, listACopy));\r\n\r\n//--------------------------------------------------------------------------------------------------------------\r\n// Reversed test case - compare against reversed copies of the original lists\r\nList<Integer> listAReverse = Arrays.asList(2, 1);\r\nList<Integer> listBReverse = Arrays.asList(2, 1);\r\n// The lists themselves are still equal to each other. So far so good.\r\nassertThat(listA).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(listAReverse);\r\nassertThat(listB).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(listBReverse);\r\n// Also, comparing a list with one reversed and one copy works!\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listACopy, listBReverse));\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listAReverse, listBCopy));\r\n\r\n// <<<<<<<<<<<<<<<<<<<<<<<< HERE IS THE PROBLEM >>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n// Comparing the original lists against two reversed lists fails!\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listAReverse, listBReverse));\r\nassertThat(Arrays.asList(listA, listB)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listBReverse, listAReverse));\r\n\r\n//--------------------------------------------------------------------------------------------------------------\r\n// Bonus test case - compare against reversed copies of lists with different core elements\r\nList<Integer> listC = Arrays.asList(3 , 4);\r\nList<Integer> listCReverse = Arrays.asList(4 , 3);\r\n// The lists themselves are equal to each other.\r\nassertThat(listC).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(listCReverse);\r\n\r\n// Interestingly, both of these assertions work fine!\r\nassertThat(Arrays.asList(listA, listC)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listAReverse, listCReverse));\r\nassertThat(Arrays.asList(listA, listC)).usingRecursiveComparison().ignoringCollectionOrder().isEqualTo(Arrays.asList(listCReverse, listAReverse));\r\n```\r\n\r\nThis test case fails for me with the following message:\r\n\r\n```txt\r\njava.lang.AssertionError: \r\nExpecting:\r\n  <[[1, 2], [1, 2]]>\r\nto be equal to:\r\n  <[[2, 1], [2, 1]]>\r\nwhen recursively comparing field by field, but found the following difference:\r\n\r\nTop level actual and expected objects differ:\r\n- actual value   : [[1, 2], [1, 2]]\r\n- expected value : [[2, 1], [2, 1]]\r\n\r\nThe recursive comparison was performed with this configuration:\r\n- overridden equals methods were used in the comparison\r\n- collection order was ignored in all fields in the comparison\r\n- these types were compared with the following comparators:\r\n  - java.lang.Double -> DoubleComparator[precision=1.0E-15]\r\n  - java.lang.Float -> FloatComparator[precision=1.0E-6]\r\n- actual and expected objects and their fields were compared field by field recursively even if they were not of the same type, this allows for example to compare a Person to a PersonDto (call strictTypeChecking(true) to change that behavior).\r\n```\r\n","closed_by":{"login":"joel-costigliola","id":382613,"node_id":"MDQ6VXNlcjM4MjYxMw==","avatar_url":"https://avatars.githubusercontent.com/u/382613?v=4","gravatar_id":"","url":"https://api.github.com/users/joel-costigliola","html_url":"https://github.com/joel-costigliola","followers_url":"https://api.github.com/users/joel-costigliola/followers","following_url":"https://api.github.com/users/joel-costigliola/following{/other_user}","gists_url":"https://api.github.com/users/joel-costigliola/gists{/gist_id}","starred_url":"https://api.github.com/users/joel-costigliola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joel-costigliola/subscriptions","organizations_url":"https://api.github.com/users/joel-costigliola/orgs","repos_url":"https://api.github.com/users/joel-costigliola/repos","events_url":"https://api.github.com/users/joel-costigliola/events{/privacy}","received_events_url":"https://api.github.com/users/joel-costigliola/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assertj/assertj/issues/1854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assertj/assertj/issues/1854/timeline","performed_via_github_app":null,"state_reason":"completed"}