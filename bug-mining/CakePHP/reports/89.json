{"url":"https://api.github.com/repos/cakephp/cakephp/issues/13249","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/13249/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/13249/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/13249/events","html_url":"https://github.com/cakephp/cakephp/issues/13249","id":445285696,"node_id":"MDU6SXNzdWU0NDUyODU2OTY=","number":13249,"title":"Controller::afterFilter() as no access to the response returned from an action","user":{"login":"hmic","id":876917,"node_id":"MDQ6VXNlcjg3NjkxNw==","avatar_url":"https://avatars.githubusercontent.com/u/876917?v=4","gravatar_id":"","url":"https://api.github.com/users/hmic","html_url":"https://github.com/hmic","followers_url":"https://api.github.com/users/hmic/followers","following_url":"https://api.github.com/users/hmic/following{/other_user}","gists_url":"https://api.github.com/users/hmic/gists{/gist_id}","starred_url":"https://api.github.com/users/hmic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hmic/subscriptions","organizations_url":"https://api.github.com/users/hmic/orgs","repos_url":"https://api.github.com/users/hmic/repos","events_url":"https://api.github.com/users/hmic/events{/privacy}","received_events_url":"https://api.github.com/users/hmic/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ADmad","id":142658,"node_id":"MDQ6VXNlcjE0MjY1OA==","avatar_url":"https://avatars.githubusercontent.com/u/142658?v=4","gravatar_id":"","url":"https://api.github.com/users/ADmad","html_url":"https://github.com/ADmad","followers_url":"https://api.github.com/users/ADmad/followers","following_url":"https://api.github.com/users/ADmad/following{/other_user}","gists_url":"https://api.github.com/users/ADmad/gists{/gist_id}","starred_url":"https://api.github.com/users/ADmad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ADmad/subscriptions","organizations_url":"https://api.github.com/users/ADmad/orgs","repos_url":"https://api.github.com/users/ADmad/repos","events_url":"https://api.github.com/users/ADmad/events{/privacy}","received_events_url":"https://api.github.com/users/ADmad/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ADmad","id":142658,"node_id":"MDQ6VXNlcjE0MjY1OA==","avatar_url":"https://avatars.githubusercontent.com/u/142658?v=4","gravatar_id":"","url":"https://api.github.com/users/ADmad","html_url":"https://github.com/ADmad","followers_url":"https://api.github.com/users/ADmad/followers","following_url":"https://api.github.com/users/ADmad/following{/other_user}","gists_url":"https://api.github.com/users/ADmad/gists{/gist_id}","starred_url":"https://api.github.com/users/ADmad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ADmad/subscriptions","organizations_url":"https://api.github.com/users/ADmad/orgs","repos_url":"https://api.github.com/users/ADmad/repos","events_url":"https://api.github.com/users/ADmad/events{/privacy}","received_events_url":"https://api.github.com/users/ADmad/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/197","html_url":"https://github.com/cakephp/cakephp/milestone/197","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/197/labels","id":4256264,"node_id":"MDk6TWlsZXN0b25lNDI1NjI2NA==","number":197,"title":"3.7.8","description":"Bugfixes for 3.7","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":36,"state":"closed","created_at":"2019-04-24T17:28:26Z","updated_at":"2019-05-30T02:39:18Z","due_on":"2019-05-29T07:00:00Z","closed_at":"2019-05-30T02:39:18Z"},"comments":2,"created_at":"2019-05-17T06:32:32Z","updated_at":"2019-05-17T08:10:52Z","closed_at":"2019-05-17T08:10:52Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"[x] enhancement\r\n* CakePHP Version: master\r\n\r\n**AController.php:**\r\n```\r\n...\r\npublic function some() {\r\n    return $this->response->withStringBody('empty');\r\n}\r\npublic afterFilter($event) {\r\n    return $this->response->withHeader('additional', 'stuff');\r\n}\r\n...\r\n```\r\n\r\nI expected a response with the string 'empty' as the body and the header 'additional' set to 'stuff'. I got a response with the header, but not the string body.\r\n\r\nFROM IRC:\r\n\r\n> hmic: Is there a way to access the resposne returned from an action in a afterFilter callback? - Of course I can access $this->response from it, but that does not (necessarily) reflect whats returned from the controller action. - Or any other solution on how to change the response of any action (i just want to add additional headers) in the afterFilter callback?\r\nIt's just weird that it (afterFilter) has no access to the response object that has been returned by an action, but is able to return a response that will be send...\r\n\r\n> admad: hmm.. yeah Controller::$response never get's updated if an action explicitly return response.  It's updated only when render() is called.\r\n\r\n> hmic: Either i need that be accurate in the afterFilter callback, or I need access to the response object that has been returned from the action in the $event data, somehow.\r\n\r\n> admad: Fix is easy, ActionDispatcher::_invoke() should check and set return value of invokeAction() call.\r\n","closed_by":{"login":"dereuromark","id":39854,"node_id":"MDQ6VXNlcjM5ODU0","avatar_url":"https://avatars.githubusercontent.com/u/39854?v=4","gravatar_id":"","url":"https://api.github.com/users/dereuromark","html_url":"https://github.com/dereuromark","followers_url":"https://api.github.com/users/dereuromark/followers","following_url":"https://api.github.com/users/dereuromark/following{/other_user}","gists_url":"https://api.github.com/users/dereuromark/gists{/gist_id}","starred_url":"https://api.github.com/users/dereuromark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dereuromark/subscriptions","organizations_url":"https://api.github.com/users/dereuromark/orgs","repos_url":"https://api.github.com/users/dereuromark/repos","events_url":"https://api.github.com/users/dereuromark/events{/privacy}","received_events_url":"https://api.github.com/users/dereuromark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/13249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/13249/timeline","performed_via_github_app":null,"state_reason":"completed"}