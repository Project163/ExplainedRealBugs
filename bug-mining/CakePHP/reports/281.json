{"url":"https://api.github.com/repos/cakephp/cakephp/issues/17461","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/17461/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/17461/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/17461/events","html_url":"https://github.com/cakephp/cakephp/issues/17461","id":2020935334,"node_id":"I_kwDOAAoEbs54dQam","number":17461,"title":"Marshalling Chronos Date into Datetime Field leads to Deprecation","user":{"login":"ravage84","id":625761,"node_id":"MDQ6VXNlcjYyNTc2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/625761?v=4","gravatar_id":"","url":"https://api.github.com/users/ravage84","html_url":"https://github.com/ravage84","followers_url":"https://api.github.com/users/ravage84/followers","following_url":"https://api.github.com/users/ravage84/following{/other_user}","gists_url":"https://api.github.com/users/ravage84/gists{/gist_id}","starred_url":"https://api.github.com/users/ravage84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravage84/subscriptions","organizations_url":"https://api.github.com/users/ravage84/orgs","repos_url":"https://api.github.com/users/ravage84/repos","events_url":"https://api.github.com/users/ravage84/events{/privacy}","received_events_url":"https://api.github.com/users/ravage84/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""},{"id":366710731,"node_id":"MDU6TGFiZWwzNjY3MTA3MzE=","url":"https://api.github.com/repos/cakephp/cakephp/labels/database","name":"database","color":"ffffff","default":false,"description":null},{"id":742268651,"node_id":"MDU6TGFiZWw3NDIyNjg2NTE=","url":"https://api.github.com/repos/cakephp/cakephp/labels/deprecations","name":"deprecations","color":"0e0566","default":false,"description":null},{"id":1052787317,"node_id":"MDU6TGFiZWwxMDUyNzg3MzE3","url":"https://api.github.com/repos/cakephp/cakephp/labels/dependencies","name":"dependencies","color":"5b67ea","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/307","html_url":"https://github.com/cakephp/cakephp/milestone/307","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/307/labels","id":10191708,"node_id":"MI_kwDOAAoEbs4Am4Nc","number":307,"title":"4.5.2","description":"Bugfixes for 4.5.x","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":11,"state":"closed","created_at":"2023-11-15T15:24:03Z","updated_at":"2023-12-15T03:46:59Z","due_on":"2023-12-15T08:00:00Z","closed_at":"2023-12-15T03:46:59Z"},"comments":0,"created_at":"2023-12-01T13:58:44Z","updated_at":"2023-12-01T14:18:07Z","closed_at":"2023-12-01T14:18:07Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nCakePHP 4.4.12\r\nCakePHP Chronos 2.4.4\r\n\r\nBecause `ChronosDate` implements the `DateTimeInterfacce` because it extends `DateTimeImmutable` https://github.com/cakephp/chronos/blob/329733e0f9f9dffcb3d0298d9978292b2d65b5fc/src/ChronosDate.php#L55 and `DateTimeImmutable` implements `DateTimeInterface` https://www.php.net/manual/de/class.datetimeimmutable.php.\r\n\r\nIt also uses the `FrozenTimeTrait` https://github.com/cakephp/chronos/blob/329733e0f9f9dffcb3d0298d9978292b2d65b5fc/src/ChronosDate.php#L61\r\n\r\nWhen one tries to marshall a `ChronosDate` (or Chronos previous `Date`) into a Datetime field, the `DateTimeType` tries to set the timezone on it https://github.com/cakephp/cakephp/blob/4.5.1/src/Database/Type/DateTimeType.php#L321-L328, which leads to a  `2.5 setTimezone() will be removed in 3.x.` deprecation message in the aforementioned `FrozenTimeTrait` https://github.com/cakephp/chronos/blob/2.4.4/src/Traits/FrozenTimeTrait.php#L159-L175.\r\n\r\nThe related workaround https://github.com/cakephp/chronos/commit/b9cb164fe1b220234dd2d048f0b6d1ae91d96876 from @markstory does not apply here, as it is neither a PHPUnit `Assertion` nor an `IsEqual` comparison.\r\n\r\nIf possible, I think it would be best not to set the timezone on the `$value` in `DateTimeType::marshall()` when it is a `ChronosDaate`.\n\n### CakePHP Version\n\n4.4.12\n\n### PHP Version\n\n_No response_","closed_by":{"login":"othercorey","id":24221186,"node_id":"MDQ6VXNlcjI0MjIxMTg2","avatar_url":"https://avatars.githubusercontent.com/u/24221186?v=4","gravatar_id":"","url":"https://api.github.com/users/othercorey","html_url":"https://github.com/othercorey","followers_url":"https://api.github.com/users/othercorey/followers","following_url":"https://api.github.com/users/othercorey/following{/other_user}","gists_url":"https://api.github.com/users/othercorey/gists{/gist_id}","starred_url":"https://api.github.com/users/othercorey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/othercorey/subscriptions","organizations_url":"https://api.github.com/users/othercorey/orgs","repos_url":"https://api.github.com/users/othercorey/repos","events_url":"https://api.github.com/users/othercorey/events{/privacy}","received_events_url":"https://api.github.com/users/othercorey/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/17461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/17461/timeline","performed_via_github_app":null,"state_reason":"completed"}