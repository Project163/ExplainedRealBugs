{"url":"https://api.github.com/repos/cakephp/cakephp/issues/14784","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/14784/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/14784/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/14784/events","html_url":"https://github.com/cakephp/cakephp/issues/14784","id":654927668,"node_id":"MDU6SXNzdWU2NTQ5Mjc2Njg=","number":14784,"title":"Timestamps missing for Org/Plugin assets","user":{"login":"luke3butler","id":8517289,"node_id":"MDQ6VXNlcjg1MTcyODk=","avatar_url":"https://avatars.githubusercontent.com/u/8517289?v=4","gravatar_id":"","url":"https://api.github.com/users/luke3butler","html_url":"https://github.com/luke3butler","followers_url":"https://api.github.com/users/luke3butler/followers","following_url":"https://api.github.com/users/luke3butler/following{/other_user}","gists_url":"https://api.github.com/users/luke3butler/gists{/gist_id}","starred_url":"https://api.github.com/users/luke3butler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luke3butler/subscriptions","organizations_url":"https://api.github.com/users/luke3butler/orgs","repos_url":"https://api.github.com/users/luke3butler/repos","events_url":"https://api.github.com/users/luke3butler/events{/privacy}","received_events_url":"https://api.github.com/users/luke3butler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/232","html_url":"https://github.com/cakephp/cakephp/milestone/232","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/232/labels","id":5618175,"node_id":"MDk6TWlsZXN0b25lNTYxODE3NQ==","number":232,"title":"4.1.1","description":"Bug fixes for 4.1.0","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":26,"state":"closed","created_at":"2020-07-05T02:52:18Z","updated_at":"2020-07-19T02:39:08Z","due_on":"2020-07-18T07:00:00Z","closed_at":"2020-07-19T02:39:08Z"},"comments":0,"created_at":"2020-07-10T17:27:51Z","updated_at":"2020-07-13T16:50:37Z","closed_at":"2020-07-13T16:50:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"* [x] bug\r\n* [ ] enhancement\r\n* [ ] feature-discussion (RFC)\r\n\r\n* CakePHP Version: 4.1.0, and 4.0.x\r\n* Platform and Target: Ubuntu, PHP 7.2, Apache, MySQL\r\n\r\n### What you did\r\nWhen configuration for asset timestamps is enabled\r\n```\r\n'Asset' => [\r\n    'timestamp' => true,\r\n],\r\n```\r\nand including assets\r\n```\r\n$this->Html->script(\r\n    [\r\n        'MyPlugin.assetname',\r\n        'Org/MyOtherPlugin.assetname'\r\n    ],\r\n    ['block' => 'extra-scripts']\r\n);\r\n$this->Html->css(\r\n    [\r\n        'MyPlugin.assetname',\r\n        'Org/MyOtherPlugin.assetname'\r\n    ],\r\n    ['block' => 'css']\r\n);\r\n```\r\n\r\n### What happened\r\nHTML output only assigns timestamps to plugins that aren't org name-spaced\r\n```\r\n<link rel=\"stylesheet\" href=\"/my_plugin/css/assetname.css?1583177993\">\r\n<link rel=\"stylesheet\" href=\"/org/my_other_plugin/css/assetname.css\">\r\n...\r\n<script src=\"/my_plugin/js/assetname.js?1583177993\"></script>\r\n<script src=\"/org/my_other_plugin/js/assetname.js\"></script>\r\n```\r\n\r\n### What you expected to happen\r\nI expect both HTML outputs to contain the asset timestamp\r\n\r\n### Initial findings\r\n\r\nThe code [here in Asset.php](https://github.com/cakephp/cakephp/blob/166e8f7b9d036880aebb8783db0a5f2b06f0f812/src/Routing/Asset.php#L256) only checks the first segment split by \"/\", so `Plugin::isLoaded()` is only checking against the org instead of the full plugin name.\r\n\r\nAdding the following (right before the if statement) will correctly identify that the plugin has been loaded, but then the assets are expected to live in `<plugin-folder>/webroot/plugin_name/{css,js}/asset.ext` instead of `<plugin-folder>/webroot/{css,js}/asset.ext`, breaking a consistent file structure.\r\n```\r\nif (!Plugin::isLoaded($plugin) && count($segments) > 1) {\r\n    $plugin = implode('/', [$plugin, Inflector::camelize($segments[1])]);\r\n}\r\n```\r\n\r\n","closed_by":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/14784/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/14784/timeline","performed_via_github_app":null,"state_reason":"completed"}