{"url":"https://api.github.com/repos/cakephp/cakephp/issues/12081","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/12081/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/12081/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/12081/events","html_url":"https://github.com/cakephp/cakephp/issues/12081","id":322966280,"node_id":"MDU6SXNzdWUzMjI5NjYyODA=","number":12081,"title":"Empty OR conditions in Query::where() cause invalid SQL","user":{"login":"burzum","id":162789,"node_id":"MDQ6VXNlcjE2Mjc4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/162789?v=4","gravatar_id":"","url":"https://api.github.com/users/burzum","html_url":"https://github.com/burzum","followers_url":"https://api.github.com/users/burzum/followers","following_url":"https://api.github.com/users/burzum/following{/other_user}","gists_url":"https://api.github.com/users/burzum/gists{/gist_id}","starred_url":"https://api.github.com/users/burzum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burzum/subscriptions","organizations_url":"https://api.github.com/users/burzum/orgs","repos_url":"https://api.github.com/users/burzum/repos","events_url":"https://api.github.com/users/burzum/events{/privacy}","received_events_url":"https://api.github.com/users/burzum/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""},{"id":60525626,"node_id":"MDU6TGFiZWw2MDUyNTYyNg==","url":"https://api.github.com/repos/cakephp/cakephp/labels/need%20more%20info","name":"need more info","color":"eb6420","default":false,"description":""},{"id":83815438,"node_id":"MDU6TGFiZWw4MzgxNTQzOA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/ORM","name":"ORM","color":"0ed189","default":false,"description":""},{"id":366710731,"node_id":"MDU6TGFiZWwzNjY3MTA3MzE=","url":"https://api.github.com/repos/cakephp/cakephp/labels/database","name":"database","color":"ffffff","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/171","html_url":"https://github.com/cakephp/cakephp/milestone/171","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/171/labels","id":3342335,"node_id":"MDk6TWlsZXN0b25lMzM0MjMzNQ==","number":171,"title":"3.6.4","description":"Bugfixes for 3.6","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":16,"state":"closed","created_at":"2018-05-13T23:21:41Z","updated_at":"2018-05-21T02:31:07Z","due_on":"2018-06-01T07:00:00Z","closed_at":"2018-05-21T02:31:07Z"},"comments":8,"created_at":"2018-05-14T20:21:10Z","updated_at":"2018-05-15T23:17:05Z","closed_at":"2018-05-15T23:17:05Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a (multiple allowed):\r\n\r\n* [x] bug\r\n* [ ] enhancement\r\n* [ ] feature-discussion (RFC)\r\n\r\n* CakePHP Version: 3.6\r\n\r\n### What you did\r\n\r\nAfter upgrading to Cake 3.6 I've got a fatal with a query that had nothing after the WHERE and was invalid SQL because of that. Debugged it and found out that an empty OR is generated by the marshaller when using the append strategy for many.\r\n\r\n@lorenzo guess is that the cause is this commit: https://github.com/cakephp/cakephp/commit/bf25c4c25ce283b6e6f81c08f3753d612f343a71\r\n\r\nTest case, you can copy and paste this into the Table test of CakePHP to reproduce it.\r\n\r\n```php\r\n    /**\r\n     * Testing that a find with an empty OR won't cause a problem\r\n     *\r\n     * @return void\r\n     */\r\n    public function testFindWithEmptyOr()\r\n    {\r\n        $table = $this->getTableLocator()->get('users');\r\n        $result = $table->find()->where(['OR' => []])->all();\r\n\r\n        $this->assertInstanceOf(ResultSet::class, $result);\r\n    }\r\n```\r\n\r\n### What happened\r\n\r\n```sh\r\n1) Cake\\Test\\TestCase\\ORM\\TableTest::testFindWithEmptyOr\r\nPDOException: SQLSTATE[HY000]: General error: 1 near \" \": syntax error\r\n\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Driver\\Sqlite.php:107\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Connection.php:275\r\nC:\\xampp\\htdocs\\cakephp\\src\\Core\\Retry\\CommandRetry.php:68\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Connection.php:282\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Connection.php:332\r\nC:\\xampp\\htdocs\\cakephp\\src\\Core\\Retry\\CommandRetry.php:68\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Connection.php:337\r\nC:\\xampp\\htdocs\\cakephp\\src\\Database\\Query.php:219\r\nC:\\xampp\\htdocs\\cakephp\\src\\ORM\\Query.php:1125\r\nC:\\xampp\\htdocs\\cakephp\\src\\Datasource\\QueryTrait.php:309\r\nC:\\xampp\\htdocs\\cakephp\\src\\ORM\\Query.php:1073\r\nC:\\xampp\\htdocs\\cakephp\\tests\\TestCase\\ORM\\TableTest.php:6839\r\n```\r\n\r\n### What you expected to happen\r\n\r\nA valid query. :)","closed_by":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/12081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/12081/timeline","performed_via_github_app":null,"state_reason":"completed"}