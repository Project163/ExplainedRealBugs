{"url":"https://api.github.com/repos/cakephp/cakephp/issues/13138","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/13138/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/13138/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/13138/events","html_url":"https://github.com/cakephp/cakephp/issues/13138","id":434672480,"node_id":"MDU6SXNzdWU0MzQ2NzI0ODA=","number":13138,"title":"4.0.0 - Transliterate return type is invalid","user":{"login":"davidyell","id":49889,"node_id":"MDQ6VXNlcjQ5ODg5","avatar_url":"https://avatars.githubusercontent.com/u/49889?v=4","gravatar_id":"","url":"https://api.github.com/users/davidyell","html_url":"https://github.com/davidyell","followers_url":"https://api.github.com/users/davidyell/followers","following_url":"https://api.github.com/users/davidyell/following{/other_user}","gists_url":"https://api.github.com/users/davidyell/gists{/gist_id}","starred_url":"https://api.github.com/users/davidyell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidyell/subscriptions","organizations_url":"https://api.github.com/users/davidyell/orgs","repos_url":"https://api.github.com/users/davidyell/repos","events_url":"https://api.github.com/users/davidyell/events{/privacy}","received_events_url":"https://api.github.com/users/davidyell/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/105","html_url":"https://github.com/cakephp/cakephp/milestone/105","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/105/labels","id":2023366,"node_id":"MDk6TWlsZXN0b25lMjAyMzM2Ng==","number":105,"title":"4.0.0","description":"4.0.0 is an *API breaking* release. It will:\r\n\r\n* Remove the features deprecated in 3.x.\r\n\r\nCode that works in the latest 3.x with no deprecation warnings should work in 4.0.0 as well.\r\n\r\nSee the roadmap for more information https://github.com/cakephp/cakephp/wiki/4.0-Roadmap","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":770,"state":"closed","created_at":"2016-09-23T01:51:53Z","updated_at":"2019-12-16T03:03:25Z","due_on":"2019-12-15T08:00:00Z","closed_at":"2019-12-16T03:03:25Z"},"comments":4,"created_at":"2019-04-18T09:21:59Z","updated_at":"2019-11-21T13:14:22Z","closed_at":"2019-04-18T14:40:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a (multiple allowed):\r\n\r\n* [x] bug\r\n* [ ] enhancement\r\n* [ ] feature-discussion (RFC)\r\n\r\n* CakePHP Version: 4.0.0-alpha1\r\n* Platform and Target: PHP 7.3.2\r\n\r\n### What you did\r\nI created a basic method in my entity for slugs.\r\n```php\r\n/**\r\n * When setting the title, automatically create a basic slug\r\n *\r\n * @param string $title Title to be sluggified\r\n * @return string\r\n */\r\nprotected function _setTitle(string $title): string\r\n{\r\n    if (empty($this->get('slug'))) {\r\n        $this->set('slug',Text::slug(strtolower($title)) . '-' . rand(1000, 9999));\r\n    }\r\n\r\n    return $title;\r\n}\r\n```\r\n\r\nI wanted to see how it behaved, so I created a unit test for the method. \r\n```php\r\npublic function providerSlugs()\r\n{\r\n    return [\r\n        'Basic title' => ['An example question', '/an-example-question-[\\d]+/'],\r\n        'Title with accents' => ['Das Pferd fährt nicht', '/question-with-accents-[\\d]+/'],\r\n        'Non latin title' => ['马不开车', '/ma-bu-kai-che-[\\d]+/']\r\n    ];\r\n}\r\n\r\n/**\r\n * @dataProvider providerSlugs\r\n */\r\npublic function testSlugGeneration($title, $expectedPattern)\r\n{\r\n    $question = new Question([\r\n        'title' => $title,\r\n        'user_id' => 1\r\n    ]);\r\n\r\n    $this->assertNotEmpty($question->get('slug'));\r\n    $this->assertRegExp($expectedPattern, $question->get('slug'));\r\n}\r\n```\r\n\r\n### What happened\r\nThe test failed, due to a return type error.\r\n```bash\r\nThere was 1 error:\r\n\r\n1) App\\Test\\TestCase\\Model\\Entity\\QuestionTest::testSlugGeneration with data set \"Title with accents\" ('Das Pferd fährt nicht', '/question-with-accents-[\\d]+/')\r\nTypeError: Return value of Cake\\Utility\\Text::transliterate() must be of the type string, bool returned\r\n\r\n/Users/davidyell/Sites/CakePHP4/vendor/cakephp/cakephp/src/Utility/Text.php:1108\r\n/Users/davidyell/Sites/CakePHP4/vendor/cakephp/cakephp/src/Utility/Text.php:1144\r\n/Users/davidyell/Sites/CakePHP4/src/Model/Entity/Question.php:53\r\n/Users/davidyell/Sites/CakePHP4/vendor/cakephp/cakephp/src/Datasource/EntityTrait.php:257\r\n/Users/davidyell/Sites/CakePHP4/vendor/cakephp/cakephp/src/ORM/Entity.php:76\r\n/Users/davidyell/Sites/CakePHP4/tests/TestCase/Model/Entity/QuestionTest.php:58\r\n```\r\n\r\n### What you expected to happen\r\nI expected that the transliterate method would return a string rather than bool. I presume it might have failed to transliterate my string, and returned false to indicate failure.\r\n","closed_by":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/13138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/13138/timeline","performed_via_github_app":null,"state_reason":"completed"}