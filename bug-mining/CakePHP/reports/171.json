{"url":"https://api.github.com/repos/cakephp/cakephp/issues/14902","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/14902/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/14902/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/14902/events","html_url":"https://github.com/cakephp/cakephp/issues/14902","id":678756268,"node_id":"MDU6SXNzdWU2Nzg3NTYyNjg=","number":14902,"title":".json ext giving Missing Method","user":{"login":"ukkpower","id":1074922,"node_id":"MDQ6VXNlcjEwNzQ5MjI=","avatar_url":"https://avatars.githubusercontent.com/u/1074922?v=4","gravatar_id":"","url":"https://api.github.com/users/ukkpower","html_url":"https://github.com/ukkpower","followers_url":"https://api.github.com/users/ukkpower/followers","following_url":"https://api.github.com/users/ukkpower/following{/other_user}","gists_url":"https://api.github.com/users/ukkpower/gists{/gist_id}","starred_url":"https://api.github.com/users/ukkpower/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ukkpower/subscriptions","organizations_url":"https://api.github.com/users/ukkpower/orgs","repos_url":"https://api.github.com/users/ukkpower/repos","events_url":"https://api.github.com/users/ukkpower/events{/privacy}","received_events_url":"https://api.github.com/users/ukkpower/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60505876,"node_id":"MDU6TGFiZWw2MDUwNTg3Ng==","url":"https://api.github.com/repos/cakephp/cakephp/labels/routing","name":"routing","color":"FFFFFF","default":false,"description":null},{"id":60600135,"node_id":"MDU6TGFiZWw2MDYwMDEzNQ==","url":"https://api.github.com/repos/cakephp/cakephp/labels/support","name":"support","color":"207de5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/235","html_url":"https://github.com/cakephp/cakephp/milestone/235","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/235/labels","id":5747106,"node_id":"MDk6TWlsZXN0b25lNTc0NzEwNg==","number":235,"title":"4.1.3","description":"Bugfixes for 4.1.x","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":16,"state":"closed","created_at":"2020-08-09T01:39:21Z","updated_at":"2020-08-15T23:54:58Z","due_on":"2020-08-29T07:00:00Z","closed_at":"2020-08-15T23:54:58Z"},"comments":5,"created_at":"2020-08-13T21:53:54Z","updated_at":"2020-08-16T21:53:26Z","closed_at":"2020-08-15T23:19:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a (multiple allowed):\r\n\r\n* [x] bug\r\n* [ ] enhancement\r\n* [ ] feature-discussion (RFC)\r\n\r\n* CakePHP Version:4.0.9\r\n* Platform and Target: MAMP, PHP 7, MYSQL\r\n\r\n### What you did\r\nI have a relatively clean install of CakePHP 4. I have read all the docs related to JSON routing with an extension and using accept header in the AJAX call `\"Accept\", \"application/json\"`. Both methods give me a 404 missing method. I have posted the issue on both StackOverflow and CakePHP support forum but the help unfortunately didn't solve the issue. I am beginning to think it is an issue with CakePHP because I have done all in the docs.\r\n\r\nhttps://discourse.cakephp.org/t/json-ext-giving-missing-method/8211\r\n\r\nhttps://stackoverflow.com/questions/63282271/cakephp-json-ext-giving-missing-method\r\n\r\n    Missing Method in StrategiesConditionsController\r\n    Cake\\Controller\\Exception\\MissingActionException\r\n    \r\n    Error The action conditions.json is not defined in StrategiesConditionsController\r\n    \r\n    Create StrategiesConditionsController::conditions.json() in file: src/Controller/StrategiesConditionsController.php.\r\n\r\nFrom reading the doc a couple of times I am sure I have the routes correct.\r\n\r\nroutes.php\r\n\r\n    <?php\r\n    /**\r\n     * Routes configuration.\r\n     *\r\n     * In this file, you set up routes to your controllers and their actions.\r\n     * Routes are very important mechanism that allows you to freely connect\r\n     * different URLs to chosen controllers and their actions (functions).\r\n     *\r\n     * It's loaded within the context of `Application::routes()` method which\r\n     * receives a `RouteBuilder` instance `$routes` as method argument.\r\n     *\r\n     * CakePHP(tm) : Rapid Development Framework (https://cakephp.org)\r\n     * Copyright (c) Cake Software Foundation, Inc. (https://cakefoundation.org)\r\n     *\r\n     * Licensed under The MIT License\r\n     * For full copyright and license information, please see the LICENSE.txt\r\n     * Redistributions of files must retain the above copyright notice.\r\n     *\r\n     * @copyright     Copyright (c) Cake Software Foundation, Inc. (https://cakefoundation.org)\r\n     * @link          https://cakephp.org CakePHP(tm) Project\r\n     * @license       https://opensource.org/licenses/mit-license.php MIT License\r\n     */\r\n    \r\n    use Cake\\Http\\Middleware\\CsrfProtectionMiddleware;\r\n    use Cake\\Routing\\Route\\DashedRoute;\r\n    use Cake\\Routing\\RouteBuilder;\r\n    use Cake\\Routing\\Router;\r\n    \r\n    /*\r\n     * The default class to use for all routes\r\n     *\r\n     * The following route classes are supplied with CakePHP and are appropriate\r\n     * to set as the default:\r\n     *\r\n     * - Route\r\n     * - InflectedRoute\r\n     * - DashedRoute\r\n     *\r\n     * If no call is made to `Router::defaultRouteClass()`, the class used is\r\n     * `Route` (`Cake\\Routing\\Route\\Route`)\r\n     *\r\n     * Note that `Route` does not do any inflections on URLs which will result in\r\n     * inconsistently cased URLs when used with `:plugin`, `:controller` and\r\n     * `:action` markers.\r\n     */\r\n    /** @var \\Cake\\Routing\\RouteBuilder $routes */\r\n    $routes->setRouteClass(DashedRoute::class);\r\n    \r\n    $routes->scope('/', function (RouteBuilder $routes) {\r\n        $routes->setExtensions(['json']);\r\n        $routes->resources('StrategiesConditions', [\r\n            'map' => [\r\n                'conditions' => [\r\n                    'action' => 'conditions',\r\n                    'method' => 'post'\r\n                ]\r\n            ],\r\n            'only' => ['conditions']\r\n         ]);\r\n    });\r\n    \r\n    $routes->scope('/', function (RouteBuilder $builder) {\r\n        // Register scoped middleware for in scopes.\r\n        $builder->registerMiddleware('csrf', new CsrfProtectionMiddleware([\r\n            'httpOnly' => true,\r\n        ]));\r\n    \r\n        /*\r\n         * Apply a middleware to the current route scope.\r\n         * Requires middleware to be registered through `Application::routes()` with `registerMiddleware()`\r\n         */\r\n        $builder->applyMiddleware('csrf');\r\n    \r\n        /*\r\n         * Here, we are connecting '/' (base path) to a controller called 'Pages',\r\n         * its action called 'display', and we pass a param to select the view file\r\n         * to use (in this case, templates/Pages/home.php)...\r\n         */\r\n        $builder->connect('/', ['controller' => 'Pages', 'action' => 'display', 'home']);\r\n    \r\n        /*\r\n         * ...and connect the rest of 'Pages' controller's URLs.\r\n         */\r\n        $builder->connect('/pages/*', ['controller' => 'Pages', 'action' => 'display']);\r\n    \r\n        /*\r\n         * Connect catchall routes for all controllers.\r\n         *\r\n         * The `fallbacks` method is a shortcut for\r\n         *\r\n         * ```\r\n         * $builder->connect('/:controller', ['action' => 'index']);\r\n         * $builder->connect('/:controller/:action/*', []);\r\n         * ```\r\n         *\r\n         * You can remove these routes once you've connected the\r\n         * routes you want in your application.\r\n         */\r\n        $builder->fallbacks();\r\n    });\r\n    \r\n    Router::prefix('admin', function (RouteBuilder $routes) {\r\n        $routes->connect('/', ['controller' => 'Users', 'action' => 'index']);\r\n        $routes->fallbacks(DashedRoute::class);\r\n    });\r\n    \r\n    /*\r\n     * If you need a different set of middleware or none at all,\r\n     * open new scope and define routes there.\r\n     *\r\n     * ```\r\n     * $routes->scope('/api', function (RouteBuilder $builder) {\r\n     *     // No $builder->applyMiddleware() here.\r\n     *     // Connect API actions here.\r\n     * });\r\n     * ```\r\n     */\r\n\r\nstrategiesConditionsController\r\n\r\n    public function conditions()\r\n    {\r\n        $this->request->allowMethod(['post']);\r\n\r\n        if ($this->request->is('ajax')) {\r\n            $this->response = $this->response->withDisabledCache();\r\n        }\r\n\r\n        $strategy_id = $this->request->getData('strategy_id');\r\n        \r\n        $strategiesConditions = $this->StrategiesConditions->find('all', [\r\n            'where' => ['strategy_id' => $strategy_id],\r\n        ]);\r\n        $this->viewBuilder()->setOption('serialize', ['strategiesConditions']);\r\n    }\r\n\r\nCakephp console has 8 routes showing\r\n\r\n    Route name\tURI template\tDefaults\r\n    pages:display\t/\t\r\n    {\r\n        \"controller\": \"Pages\",\r\n        \"action\": \"display\",\r\n        \"0\": \"home\",\r\n        \"plugin\": null\r\n    }\r\n    pages:display\t/pages/*\t\r\n    {\r\n        \"controller\": \"Pages\",\r\n        \"action\": \"display\",\r\n        \"plugin\": null\r\n    }\r\n    _controller:index\t/{controller}\t\r\n    {\r\n        \"action\": \"index\",\r\n        \"plugin\": null\r\n    }\r\n    _controller:_action\t/{controller}/{action}/*\t\r\n    {\r\n        \"plugin\": null,\r\n        \"action\": \"index\"\r\n    }\r\n    admin:users:index\t/admin\t\r\n    {\r\n        \"controller\": \"Users\",\r\n        \"action\": \"index\",\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null\r\n    }\r\n    admin:_controller:index\t/admin/{controller}\t\r\n    {\r\n        \"action\": \"index\",\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null\r\n    }\r\n    admin:_controller:_action\t/admin/{controller}/{action}/*\t\r\n    {\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null,\r\n        \"action\": \"index\"\r\n    }\r\n    strategiesconditions:conditions\t/strategies-conditions/conditions\t\r\n    {\r\n        \"controller\": \"StrategiesConditions\",\r\n        \"action\": \"conditions\",\r\n        \"_method\": \"post\",\r\n        \"plugin\": null\r\n    }\r\n\r\nUpdate from the history tab in debug kit\r\n\r\n    Request\r\n    Routing Params\r\n    controller StrategiesConditions\r\n    action conditions.json\r\n    pass (empty)\r\n    plugin (null)\r\n    _matchedRoute /{controller}/{action}/*\r\n    _ext (null)\r\n    Post data\r\n    strategy_id 11\r\n    Query string\r\n    No querystring data.\r\n    \r\n    Cookie\r\n    csrfToken dd12f852560a384d39206e511f1857f77f71da2eadb023a6c67ae346\r\n    PHPSESSID 3d2jt7dgpo09af8b1908quljpn\r\n    Matched Route\r\n    template /{controller}/{action}/*\r\n\r\nand the routes tab:\r\n\r\n    Routes\r\n    Toggle debugkit internal routes\r\n    Route name\tURI template\tDefaults\r\n    pages:display\t/\t\r\n    {\r\n        \"controller\": \"Pages\",\r\n        \"action\": \"display\",\r\n        \"0\": \"home\",\r\n        \"plugin\": null\r\n    }\r\n    pages:display\t/pages/*\t\r\n    {\r\n        \"controller\": \"Pages\",\r\n        \"action\": \"display\",\r\n        \"plugin\": null\r\n    }\r\n    _controller:index\t/{controller}\t\r\n    {\r\n        \"action\": \"index\",\r\n        \"plugin\": null\r\n    }\r\n    _controller:_action\t/{controller}/{action}/*\t\r\n    {\r\n        \"plugin\": null,\r\n        \"action\": \"index\"\r\n    }\r\n    admin:users:index\t/admin\t\r\n    {\r\n        \"controller\": \"Users\",\r\n        \"action\": \"index\",\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null\r\n    }\r\n    admin:_controller:index\t/admin/{controller}\t\r\n    {\r\n        \"action\": \"index\",\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null\r\n    }\r\n    admin:_controller:_action\t/admin/{controller}/{action}/*\t\r\n    {\r\n        \"prefix\": \"Admin\",\r\n        \"plugin\": null,\r\n        \"action\": \"index\"\r\n    }\r\n    strategiesconditions:conditions\t/strategies-conditions/conditions\t\r\n    {\r\n        \"controller\": \"StrategiesConditions\",\r\n        \"action\": \"conditions\",\r\n        \"_method\": \"post\",\r\n        \"plugin\": null\r\n    }\r\n\r\nRequest URL\r\n\r\nhttp://localhost:8888/trading-journal/strategies-conditions/conditions.json\r\n\r\nApplication.php\r\n\r\n            // Add routing middleware.\r\n            // If you have a large number of routes connected, turning on routes\r\n            // caching in production could improve performance. For that when\r\n            // creating the middleware instance specify the cache config name by\r\n            // using it's second constructor argument:\r\n            // `new RoutingMiddleware($this, '_cake_routes_')`\r\n            ->add(new RoutingMiddleware($this))\r\n\r\nThanks\r\n\r\n","closed_by":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/14902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/14902/timeline","performed_via_github_app":null,"state_reason":"completed"}