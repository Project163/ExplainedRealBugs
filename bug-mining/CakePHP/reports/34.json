{"url":"https://api.github.com/repos/cakephp/cakephp/issues/11572","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/11572/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/11572/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/11572/events","html_url":"https://github.com/cakephp/cakephp/issues/11572","id":284361560,"node_id":"MDU6SXNzdWUyODQzNjE1NjA=","number":11572,"title":"BC breaks with deprecations","user":{"login":"dereuromark","id":39854,"node_id":"MDQ6VXNlcjM5ODU0","avatar_url":"https://avatars.githubusercontent.com/u/39854?v=4","gravatar_id":"","url":"https://api.github.com/users/dereuromark","html_url":"https://github.com/dereuromark","followers_url":"https://api.github.com/users/dereuromark/followers","following_url":"https://api.github.com/users/dereuromark/following{/other_user}","gists_url":"https://api.github.com/users/dereuromark/gists{/gist_id}","starred_url":"https://api.github.com/users/dereuromark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dereuromark/subscriptions","organizations_url":"https://api.github.com/users/dereuromark/orgs","repos_url":"https://api.github.com/users/dereuromark/repos","events_url":"https://api.github.com/users/dereuromark/events{/privacy}","received_events_url":"https://api.github.com/users/dereuromark/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/140","html_url":"https://github.com/cakephp/cakephp/milestone/140","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/140/labels","id":2671072,"node_id":"MDk6TWlsZXN0b25lMjY3MTA3Mg==","number":140,"title":"3.6.0","description":"New major features that are backwards compatible with 3.x. See the [roadmap](https://github.com/cakephp/cakephp/wiki/3.6-Roadmap) for more details.","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":265,"state":"closed","created_at":"2017-07-31T11:30:05Z","updated_at":"2018-04-15T02:18:59Z","due_on":"2018-04-14T07:00:00Z","closed_at":"2018-04-15T02:18:59Z"},"comments":9,"created_at":"2017-12-24T13:03:18Z","updated_at":"2017-12-25T00:56:17Z","closed_at":"2017-12-24T21:13:16Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I think we discussed this a while back, but it just took me by surprise again in a few cases.\r\nIf we do not follow the inheritance principle here closely, we will have soon a lot of broken user apps due to this issue.\r\n\r\nIn my case I have a contact form and a validator:\r\n```\r\n\t/**\r\n\t * @param \\Cake\\Validation\\Validator $validator\r\n\t * @return \\Cake\\Validation\\Validator\r\n\t */\r\n\tprotected function _buildValidator(Validator $validator) { ... }\r\n```\r\nWith 3.6 this would now break silently and can be a security issue (no validation anymore at all for all forms!) as the core code internally shortcuts it due to the deprecation refactor:\r\n```\r\n     * @deprecated 3.6.0 Use Form::getValidator()/setValidator() instead.\r\n     */\r\n    public function validator(Validator $validator = null)\r\n    {\r\n        deprecationWarning(\r\n            'Form::validator() is deprecated. ' .\r\n            'Use Form::getValidator()/setValidator() instead.'\r\n        );\r\n\r\n        if ($validator === null && empty($this->_validator)) {\r\n            $validator = $this->_buildValidator(new $this->_validatorClass);\r\n        }\r\n        if ($validator) {\r\n            $this->_validator = $validator;\r\n            $this->setValidator('default', $validator);\r\n        }\r\n\r\n        return $this->getValidator();\r\n    }\r\n```\r\nBut the actual code is never calling this old one which would set the ones as CakePHP 3.x so far depended on.\r\nIt directly goes to getValidator().\r\n\r\n## So to sum things up\r\nWe must always call internally the old methods still and only from the outside of core are allowed to replace our own old method calls with new ones. Even in plugins this is already quite dangerous and can lead to side effects in apps depending on the plugins. But this is sure worse with the core code here and apps depending on the functionality behind protected methods being overwritten as designed to be done.\r\n\r\nNot sure how we can still have deprecation warnings then, though. How to distinguish outside vs inside usage.\r\n\r\nThere are lots of other places where core-internal using the new methods will shortcut the user land methods. We should probably revert those where it could be also critical in terms of functionality BC breaks.","closed_by":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/11572/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/11572/timeline","performed_via_github_app":null,"state_reason":"completed"}