{"url":"https://api.github.com/repos/cakephp/cakephp/issues/17759","repository_url":"https://api.github.com/repos/cakephp/cakephp","labels_url":"https://api.github.com/repos/cakephp/cakephp/issues/17759/labels{/name}","comments_url":"https://api.github.com/repos/cakephp/cakephp/issues/17759/comments","events_url":"https://api.github.com/repos/cakephp/cakephp/issues/17759/events","html_url":"https://github.com/cakephp/cakephp/issues/17759","id":2444621987,"node_id":"I_kwDOAAoEbs6Rtfij","number":17759,"title":"PHPStan regex failure","user":{"login":"dereuromark","id":39854,"node_id":"MDQ6VXNlcjM5ODU0","avatar_url":"https://avatars.githubusercontent.com/u/39854?v=4","gravatar_id":"","url":"https://api.github.com/users/dereuromark","html_url":"https://github.com/dereuromark","followers_url":"https://api.github.com/users/dereuromark/followers","following_url":"https://api.github.com/users/dereuromark/following{/other_user}","gists_url":"https://api.github.com/users/dereuromark/gists{/gist_id}","starred_url":"https://api.github.com/users/dereuromark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dereuromark/subscriptions","organizations_url":"https://api.github.com/users/dereuromark/orgs","repos_url":"https://api.github.com/users/dereuromark/repos","events_url":"https://api.github.com/users/dereuromark/events{/privacy}","received_events_url":"https://api.github.com/users/dereuromark/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60504544,"node_id":"MDU6TGFiZWw2MDUwNDU0NA==","url":"https://api.github.com/repos/cakephp/cakephp/labels/defect","name":"defect","color":"e50f2c","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/cakephp/cakephp/milestones/320","html_url":"https://github.com/cakephp/cakephp/milestone/320","labels_url":"https://api.github.com/repos/cakephp/cakephp/milestones/320/labels","id":11371372,"node_id":"MI_kwDOAAoEbs4ArYNs","number":320,"title":"5.0.11","description":"Bug fixes for 5.0","creator":{"login":"markstory","id":24086,"node_id":"MDQ6VXNlcjI0MDg2","avatar_url":"https://avatars.githubusercontent.com/u/24086?v=4","gravatar_id":"","url":"https://api.github.com/users/markstory","html_url":"https://github.com/markstory","followers_url":"https://api.github.com/users/markstory/followers","following_url":"https://api.github.com/users/markstory/following{/other_user}","gists_url":"https://api.github.com/users/markstory/gists{/gist_id}","starred_url":"https://api.github.com/users/markstory/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markstory/subscriptions","organizations_url":"https://api.github.com/users/markstory/orgs","repos_url":"https://api.github.com/users/markstory/repos","events_url":"https://api.github.com/users/markstory/events{/privacy}","received_events_url":"https://api.github.com/users/markstory/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":18,"state":"closed","created_at":"2024-07-28T17:08:13Z","updated_at":"2024-09-13T02:16:01Z","due_on":"2024-09-12T07:00:00Z","closed_at":"2024-09-13T02:16:01Z"},"comments":1,"created_at":"2024-08-02T10:11:05Z","updated_at":"2024-08-02T20:44:04Z","closed_at":"2024-08-02T20:44:03Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nThe current builds are red - the regexp issue comes from\r\nhttps://github.com/phpstan/phpstan/releases/tag/1.11.9\r\n\r\n>   128    Regex pattern is invalid: Compilation failed: lookbehind assertion is not fixed length at offset 0 in pattern:  \r\n         /(?<!.*)\\{([a-z0-9-_]+)\\}/i    \r\n\r\n```php\r\n        preg_match_all(\r\n            '/(?<!' . preg_quote('\\\\', '/') . ')\\{([a-z0-9-_]+)\\}/i',\r\n            $message,\r\n            $matches\r\n        );\r\n```\r\n\r\nAccording to chatGTP:\r\n\r\n\r\nThe issue arises from the lookbehind assertion in your regex pattern, which is not of fixed length. In PHP, lookbehind assertions need to have a fixed length, but your pattern `(?<!.*)\\{([a-z0-9-_]+)\\}` has a variable length `.*` in the lookbehind, which is not allowed.\r\n\r\nTo fix this, you can use an alternative approach that avoids lookbehind assertions with variable lengths. One common method is to use a negative lookahead assertion instead.\r\n\r\nHere is the modified code:\r\n\r\n```php\r\npreg_match_all(\r\n    '/(?<!\\\\\\\\)\\{([a-z0-9-_]+)\\}/i',\r\n    $message,\r\n    $matches\r\n);\r\n```\r\n\r\nIn this code:\r\n\r\n- `(?<!\\\\\\\\)` ensures that the curly braces `{` and `}` are not preceded by a single backslash `\\`. The backslash itself is escaped in the regex pattern and in the PHP string, resulting in four backslashes.\r\n- The rest of the pattern `\\{([a-z0-9-_]+)\\}` remains unchanged, matching the placeholders `{...}`.\r\n\r\nAlternatively, you can achieve the same goal using a negative lookahead approach:\r\n\r\n```php\r\npreg_match_all(\r\n    '/\\\\\\{([a-z0-9-_]+)\\}(?!\\\\\\)/i',\r\n    $message,\r\n    $matches\r\n);\r\n```\r\n\r\nIn this code:\r\n\r\n- `\\\\\\{([a-z0-9-_]+)\\}` matches the placeholders `{...}`.\r\n- `(?!\\\\\\)` ensures that the curly braces `{` and `}` are not followed by a single backslash `\\`.\r\n\r\nChoose the approach that best fits your needs. The first approach is usually preferred for checking what comes before the matched text, while the second approach is better for checking what comes after.\n\n### CakePHP Version\n\n5.x\n\n### PHP Version\n\n_No response_","closed_by":{"login":"dereuromark","id":39854,"node_id":"MDQ6VXNlcjM5ODU0","avatar_url":"https://avatars.githubusercontent.com/u/39854?v=4","gravatar_id":"","url":"https://api.github.com/users/dereuromark","html_url":"https://github.com/dereuromark","followers_url":"https://api.github.com/users/dereuromark/followers","following_url":"https://api.github.com/users/dereuromark/following{/other_user}","gists_url":"https://api.github.com/users/dereuromark/gists{/gist_id}","starred_url":"https://api.github.com/users/dereuromark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dereuromark/subscriptions","organizations_url":"https://api.github.com/users/dereuromark/orgs","repos_url":"https://api.github.com/users/dereuromark/repos","events_url":"https://api.github.com/users/dereuromark/events{/privacy}","received_events_url":"https://api.github.com/users/dereuromark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/cakephp/cakephp/issues/17759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/cakephp/cakephp/issues/17759/timeline","performed_via_github_app":null,"state_reason":"completed"}