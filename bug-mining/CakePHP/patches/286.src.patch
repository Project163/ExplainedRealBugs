diff --git a/src/Error/Debugger.php b/src/Error/Debugger.php
index 9aed1ee2da..f5eec290b0 100644
--- a/src/Error/Debugger.php
+++ b/src/Error/Debugger.php
@@ -514,9 +514,6 @@ class Debugger
      */
     protected static function _highlight(string $str): string
     {
-        if (function_exists('hphp_log') || function_exists('hphp_gettid')) {
-            return htmlentities($str);
-        }
         $added = false;
         if (!str_contains($str, '<?php')) {
             $added = true;
@@ -525,7 +522,7 @@ class Debugger
         $highlight = highlight_string($str, true);
         if ($added) {
             $highlight = str_replace(
-                ['&lt;?php&nbsp;<br/>', '&lt;?php&nbsp;<br />'],
+                ['&lt;?php&nbsp;<br/>', '&lt;?php&nbsp;<br />', '&lt;?php '],
                 '',
                 $highlight
             );
diff --git a/templates/layout/dev_error.php b/templates/layout/dev_error.php
index 1bcbe5c3d0..2f7eeffb8b 100644
--- a/templates/layout/dev_error.php
+++ b/templates/layout/dev_error.php
@@ -292,6 +292,12 @@ use function Cake\Core\h;
     .excerpt-line {
         padding: 0;
     }
+    /* php 8.3 adds pre around highlighted code */
+    .code-highlight > pre,
+    .excerpt-line > pre {
+        padding: 0;
+        background: none;
+    }
     .excerpt-line > code {
         padding-left: 4px;
     }
