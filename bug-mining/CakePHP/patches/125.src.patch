diff --git a/src/Routing/Route/Route.php b/src/Routing/Route/Route.php
index 8a350ab450..936c24472d 100644
--- a/src/Routing/Route/Route.php
+++ b/src/Routing/Route/Route.php
@@ -714,6 +714,14 @@ class Route
         }
         $url += $hostOptions;
 
+        // Ensure controller/action keys are not null.
+        if (
+            (isset($keyNames['controller']) && !isset($url['controller'])) ||
+            (isset($keyNames['action']) && !isset($url['action']))
+        ) {
+            return null;
+        }
+
         return $this->_writeUrl($url, $pass, $query);
     }
 
@@ -759,12 +767,10 @@ class Route
 
         $search = $replace = [];
         foreach ($this->keys as $key) {
-            $string = null;
-            if (isset($params[$key])) {
-                $string = $params[$key];
-            } elseif (strpos($out, $key) !== strlen($out) - strlen($key)) {
-                $key .= '/';
+            if (!array_key_exists($key, $params)) {
+                throw new InvalidArgumentException("Missing required route key `{$key}`");
             }
+            $string = $params[$key];
             if ($this->braceKeys) {
                 $search[] = "{{$key}}";
             } else {
diff --git a/tests/TestCase/Routing/Route/RouteTest.php b/tests/TestCase/Routing/Route/RouteTest.php
index addbc7952b..5598fa98c3 100644
--- a/tests/TestCase/Routing/Route/RouteTest.php
+++ b/tests/TestCase/Routing/Route/RouteTest.php
@@ -1444,6 +1444,34 @@ class RouteTest extends TestCase
         $this->assertEquals($expected, $result);
     }
 
+    /**
+     * Test match handles optional keys
+     *
+     * @return void
+     */
+    public function testMatchNullValueOptionalKey()
+    {
+        $route = new Route('/path/:optional/fixed');
+        $this->assertSame('/path/fixed', $route->match(['optional' => null]));
+
+        $route = new Route('/path/{optional}/fixed');
+        $this->assertSame('/path/fixed', $route->match(['optional' => null]));
+    }
+
+    /**
+     * Test matching fails on required keys (controller/action)
+     *
+     * @return void
+     */
+    public function testMatchControllerRequiredKeys()
+    {
+        $route = new Route('/:controller/', ['action' => 'index']);
+        $this->assertNull($route->match(['controller' => null, 'action' => 'index']));
+
+        $route = new Route('/test/:action', ['controller' => 'thing']);
+        $this->assertNull($route->match(['action' => null, 'controller' => 'thing']));
+    }
+
     /**
      * Test restructuring args with pass key
      *
diff --git a/tests/TestCase/Routing/RouterTest.php b/tests/TestCase/Routing/RouterTest.php
index 4e9c0b0721..d39c946261 100644
--- a/tests/TestCase/Routing/RouterTest.php
+++ b/tests/TestCase/Routing/RouterTest.php
@@ -68,7 +68,7 @@ class RouterTest extends TestCase
         });
         $this->assertRegExp('/^http(s)?:\/\//', Router::url('/', true));
         $this->assertRegExp('/^http(s)?:\/\//', Router::url(null, true));
-        $this->assertRegExp('/^http(s)?:\/\//', Router::url(['_full' => true]));
+        $this->assertRegExp('/^http(s)?:\/\//', Router::url(['controller' => 'test', '_full' => true]));
     }
 
     /**
@@ -173,17 +173,6 @@ class RouterTest extends TestCase
         $this->assertSame('http://cake.local', Router::fullBaseUrl());
     }
 
-    /**
-     * testRouteDefaultParams method
-     *
-     * @return void
-     */
-    public function testRouteDefaultParams()
-    {
-        Router::connect('/:controller', ['controller' => 'posts']);
-        $this->assertEquals(Router::url(['action' => 'index']), '/');
-    }
-
     /**
      * testRouteExists method
      *
@@ -191,8 +180,8 @@ class RouterTest extends TestCase
      */
     public function testRouteExists()
     {
-        Router::connect('/:controller/:action', ['controller' => 'posts']);
-        $this->assertTrue(Router::routeExists(['action' => 'view']));
+        Router::connect('/posts/:action', ['controller' => 'posts']);
+        $this->assertTrue(Router::routeExists(['controller' => 'posts', 'action' => 'view']));
 
         $this->assertFalse(Router::routeExists(['action' => 'view', 'controller' => 'users', 'plugin' => 'test']));
     }
diff --git a/tests/TestCase/View/Helper/HtmlHelperTest.php b/tests/TestCase/View/Helper/HtmlHelperTest.php
index 2ded331df0..ac31dbec8f 100644
--- a/tests/TestCase/View/Helper/HtmlHelperTest.php
+++ b/tests/TestCase/View/Helper/HtmlHelperTest.php
@@ -107,7 +107,9 @@ class HtmlHelperTest extends TestCase
     public function testLink()
     {
         Router::reload();
+        Router::connect('/:controller', ['action' => 'index']);
         Router::connect('/:controller/:action/*');
+        Router::setRequest(new ServerRequest());
 
         $this->View->setRequest($this->View->getRequest()->withAttribute('webroot', ''));
 
@@ -115,19 +117,14 @@ class HtmlHelperTest extends TestCase
         $expected = ['a' => ['href' => '/home'], 'preg:/\/home/', '/a'];
         $this->assertHtml($expected, $result);
 
-        $result = $this->Html->link(['action' => 'login', '<[You]>']);
+        $result = $this->Html->link(['controller' => 'users', 'action' => 'login', '<[You]>']);
         $expected = [
-            'a' => ['href' => '/login/%3C%5BYou%5D%3E'],
-            'preg:/\/login\/&lt;\[You\]&gt;/',
+            'a' => ['href' => '/users/login/%3C%5BYou%5D%3E'],
+            'preg:/\/users\/login\/&lt;\[You\]&gt;/',
             '/a',
         ];
         $this->assertHtml($expected, $result);
 
-        Router::reload();
-        Router::setRequest(new ServerRequest());
-        Router::connect('/:controller', ['action' => 'index']);
-        Router::connect('/:controller/:action/*');
-
         $result = $this->Html->link('Posts', ['controller' => 'posts', 'action' => 'index', '_full' => true]);
         $expected = ['a' => ['href' => Router::fullBaseUrl() . '/posts'], 'Posts', '/a'];
         $this->assertHtml($expected, $result);
diff --git a/tests/TestCase/View/Helper/PaginatorHelperTest.php b/tests/TestCase/View/Helper/PaginatorHelperTest.php
index 760edf4259..c6145673d0 100644
--- a/tests/TestCase/View/Helper/PaginatorHelperTest.php
+++ b/tests/TestCase/View/Helper/PaginatorHelperTest.php
@@ -56,6 +56,11 @@ class PaginatorHelperTest extends TestCase
         Configure::write('Config.language', 'eng');
         $request = new ServerRequest([
             'url' => '/',
+            'params' => [
+                'plugin' => null,
+                'controller' => '',
+                'action' => 'index',
+            ]
         ]);
         $request = $request->withAttribute('paging', [
             'Article' => [
@@ -76,6 +81,7 @@ class PaginatorHelperTest extends TestCase
         Router::reload();
         Router::connect('/:controller/:action/*');
         Router::connect('/:plugin/:controller/:action/*');
+        Router::setRequest($request);
 
         $this->locale = I18n::getLocale();
     }
@@ -1877,41 +1883,50 @@ class PaginatorHelperTest extends TestCase
     {
         Router::reload();
         Router::connect('/:controller/:action/:page');
-
-        $this->View->setRequest($this->View->getRequest()->withAttribute('paging', [
-            'Client' => [
-                'page' => 8,
-                'current' => 3,
-                'count' => 30,
-                'prevPage' => false,
-                'nextPage' => 2,
-                'pageCount' => 15,
-            ],
-        ]));
+        $request = $this->View
+            ->getRequest()
+            ->withAttribute('params', [
+                'plugin' => null,
+                'controller' => 'clients',
+                'action' => 'index',
+            ])
+            ->withAttribute('paging', [
+                'Client' => [
+                    'page' => 8,
+                    'current' => 3,
+                    'count' => 30,
+                    'prevPage' => false,
+                    'nextPage' => 2,
+                    'pageCount' => 15,
+                ],
+            ]);
+        $this->View->setRequest($request);
+        Router::setRequest($request);
 
         $this->Paginator->options(['routePlaceholders' => ['page']]);
 
         $result = $this->Paginator->numbers();
         $expected = [
-            ['li' => []], ['a' => ['href' => '/index/4']], '4', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/5']], '5', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/6']], '6', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/7']], '7', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/4']], '4', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/5']], '5', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/6']], '6', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/7']], '7', '/a', '/li',
             ['li' => ['class' => 'active']], '<a href=""', '8', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/9']], '9', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/10']], '10', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/11']], '11', '/a', '/li',
-            ['li' => []], ['a' => ['href' => '/index/12']], '12', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/9']], '9', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/10']], '10', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/11']], '11', '/a', '/li',
+            ['li' => []], ['a' => ['href' => '/clients/index/12']], '12', '/a', '/li',
         ];
         $this->assertHtml($expected, $result);
 
         Router::reload();
         Router::connect('/:controller/:action/:sort/:direction');
+        Router::setRequest($request);
 
         $this->Paginator->options(['routePlaceholders' => ['sort', 'direction']]);
         $result = $this->Paginator->sort('title');
         $expected = [
-            'a' => ['href' => '/index/title/asc'],
+            'a' => ['href' => '/clients/index/title/asc'],
             'Title',
             '/a',
         ];
