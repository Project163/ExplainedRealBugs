diff --git a/src/Core/TestSuite/ContainerStubTrait.php b/src/Core/TestSuite/ContainerStubTrait.php
index 173062efb0..34173bc60e 100644
--- a/src/Core/TestSuite/ContainerStubTrait.php
+++ b/src/Core/TestSuite/ContainerStubTrait.php
@@ -19,6 +19,7 @@ use Cake\Core\Configure;
 use Cake\Core\ContainerInterface;
 use Cake\Event\EventInterface;
 use Closure;
+use League\Container\Exception\NotFoundException;
 use LogicException;
 
 /**
@@ -144,7 +145,11 @@ trait ContainerStubTrait
         }
         foreach ($this->containerServices as $key => $factory) {
             if ($container->has($key)) {
-                $container->extend($key)->setConcrete($factory);
+                try {
+                    $container->extend($key)->setConcrete($factory);
+                } catch (NotFoundException $e) {
+                    $container->add($key, $factory);
+                }
             } else {
                 $container->add($key, $factory);
             }
diff --git a/tests/TestCase/TestSuite/IntegrationTestTraitTest.php b/tests/TestCase/TestSuite/IntegrationTestTraitTest.php
index 5fe504b30e..91e97fc5b2 100644
--- a/tests/TestCase/TestSuite/IntegrationTestTraitTest.php
+++ b/tests/TestCase/TestSuite/IntegrationTestTraitTest.php
@@ -37,6 +37,7 @@ use LogicException;
 use OutOfBoundsException;
 use PHPUnit\Framework\AssertionFailedError;
 use stdClass;
+use TestApp\ReflectionDependency;
 
 /**
  * Self test of the IntegrationTestTrait
@@ -1692,6 +1693,19 @@ class IntegrationTestTraitTest extends TestCase
         $this->assertResponseContains('"mock":true', 'Contains the data from the stdClass mock container.');
     }
 
+    /**
+     * Test that mockService() injects into controllers.
+     */
+    public function testHandleWithMockServicesFromReflectionContainer(): void
+    {
+        $this->mockService(ReflectionDependency::class, function () {
+            return new ReflectionDependency();
+        });
+        $this->get('/dependencies/reflectionDep');
+        $this->assertResponseOk();
+        $this->assertResponseContains('{"dep":{}}', 'Contains the data from the reflection container');
+    }
+
     /**
      * Test that mockService() injects into controllers.
      */
diff --git a/tests/test_app/TestApp/Application.php b/tests/test_app/TestApp/Application.php
index c336e1658d..77395d1452 100644
--- a/tests/test_app/TestApp/Application.php
+++ b/tests/test_app/TestApp/Application.php
@@ -17,6 +17,7 @@ declare(strict_types=1);
 namespace TestApp;
 
 use Cake\Console\CommandCollection;
+use Cake\Controller\ComponentRegistry;
 use Cake\Core\Configure;
 use Cake\Core\ContainerInterface;
 use Cake\Error\Middleware\ErrorHandlerMiddleware;
@@ -25,6 +26,7 @@ use Cake\Http\MiddlewareQueue;
 use Cake\Routing\Exception\DuplicateNamedRouteException;
 use Cake\Routing\Middleware\RoutingMiddleware;
 use Cake\Routing\RouteBuilder;
+use League\Container\ReflectionContainer;
 use stdClass;
 use TestApp\Command\AbortCommand;
 use TestApp\Command\DependencyCommand;
@@ -96,5 +98,7 @@ class Application extends BaseApplication
         $container->add(stdClass::class, json_decode('{"key":"value"}'));
         $container->add(DependencyCommand::class)
             ->addArgument(stdClass::class);
+        $container->add(ComponentRegistry::class);
+        $container->delegate(new ReflectionContainer());
     }
 }
diff --git a/tests/test_app/TestApp/Controller/DependenciesController.php b/tests/test_app/TestApp/Controller/DependenciesController.php
index b029d37255..feb130a966 100644
--- a/tests/test_app/TestApp/Controller/DependenciesController.php
+++ b/tests/test_app/TestApp/Controller/DependenciesController.php
@@ -70,6 +70,15 @@ class DependenciesController extends Controller
         return $this->response->withStringBody(json_encode(compact('dep', 'any', 'str')));
     }
 
+    /**
+     * @param \TestApp\ReflectionDependency $dep
+     * @return \Cake\Http\Response
+     */
+    public function reflectionDep(\TestApp\ReflectionDependency $dep)
+    {
+        return $this->response->withStringBody(json_encode(compact('dep')));
+    }
+
     /**
      * @param mixed $any
      * @return \Cake\Http\Response
diff --git a/tests/test_app/TestApp/ReflectionDependency.php b/tests/test_app/TestApp/ReflectionDependency.php
new file mode 100644
index 0000000000..3ff199da8c
--- /dev/null
+++ b/tests/test_app/TestApp/ReflectionDependency.php
@@ -0,0 +1,11 @@
+<?php
+declare(strict_types=1);
+
+namespace TestApp;
+
+class ReflectionDependency
+{
+    public function __construct()
+    {
+    }
+}
