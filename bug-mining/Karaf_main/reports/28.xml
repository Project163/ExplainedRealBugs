<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:13:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KARAF-689] Karaf instance can wrongly obtain a lock when the locking table is empty on a Oracle DB</title>
                <link>https://issues.apache.org/jira/browse/KARAF-689</link>
                <project id="12311140" key="KARAF">Karaf</project>
                    <description>&lt;p&gt;When running Karaf in Master/Slave mode a Karaf instance can wrongly obtain a lock when the locking table is empty on a Oracle DB.&lt;br/&gt;
Karaf creates a lock table and a lock record in de OracleDB upon first usage. When the lock record is removed afterwards without dropping the table then the locking mechanisme does not work anymore and any instance can wrongly obtain a lock.&lt;/p&gt;

&lt;p&gt;This is not an issue for other database systems, because the implementation for other DB systems periodically tries to update the lock record and verify how many records are updated. According to the documentation in the code the &quot;update&quot; functionality has been removed for Oracle because it can exhaust the Oracle UNDO log.&lt;/p&gt;

&lt;p&gt;I created a patch which does not use the &quot;update&quot; functionality, but executes an extra check after we acquired the lock. It checks if the SELECT FOR UPDATE used for the lock has not been executed on an empty selection, because when the selection is empty then the locking functionality will not work as expected.&lt;/p&gt;

&lt;p&gt;Can you apply this patch to the branches karaf-2.1.x and karaf-2.2.x and the trunk. I looked at the SVN history of the files I have modified and noticed that they are the same in both branches and the trunk.&lt;br/&gt;
The patch has been created against the karaf-2.1.x branch.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production&lt;/p&gt;</environment>
        <key id="12511626">KARAF-689</key>
            <summary>Karaf instance can wrongly obtain a lock when the locking table is empty on a Oracle DB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jgoodyear">Jamie Mark Goodyear</assignee>
                                    <reporter username="tonswieb">Ton Swieb</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jun 2011 11:03:58 +0000</created>
                <updated>Fri, 14 Sep 2018 08:37:44 +0000</updated>
                            <resolved>Mon, 27 Jun 2011 20:40:33 +0000</resolved>
                                    <version>2.1.3</version>
                                    <fixVersion>2.1.6</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13055468" author="tonswieb" created="Mon, 27 Jun 2011 11:05:15 +0000"  >&lt;p&gt;Attached patch based on the branch karaf 2.1.x&lt;/p&gt;</comment>
                            <comment id="13055474" author="jgoodyear" created="Mon, 27 Jun 2011 11:18:26 +0000"  >&lt;p&gt;Thanks for the patch Ton. I&apos;ll take a look at it.&lt;/p&gt;</comment>
                            <comment id="13055476" author="jgoodyear" created="Mon, 27 Jun 2011 11:25:36 +0000"  >&lt;p&gt;Hi Ton,&lt;/p&gt;

&lt;p&gt;In order to use your patch we&apos;re going to need an ASF grant on the file.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Jamie&lt;/p&gt;</comment>
                            <comment id="13055477" author="tonswieb" created="Mon, 27 Jun 2011 11:28:37 +0000"  >&lt;p&gt;Attached the patch with the ASF grant.&lt;/p&gt;</comment>
                            <comment id="13055478" author="jgoodyear" created="Mon, 27 Jun 2011 11:31:01 +0000"  >&lt;p&gt;Awesome, thanks again Ton &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13055709" author="jgoodyear" created="Mon, 27 Jun 2011 19:22:28 +0000"  >&lt;p&gt;Checked in to 2.1.x branch, with thanks to Ton Swieb for the patch.&lt;/p&gt;

&lt;p&gt;$ svn ci &lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/OracleJDBCLock.java&lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/Statements.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockIntegrationTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/OracleJDBCLockTest.java&lt;br/&gt;
Transmitting file data .....&lt;br/&gt;
Committed revision 1140285.&lt;/p&gt;</comment>
                            <comment id="13055717" author="jgoodyear" created="Mon, 27 Jun 2011 19:50:29 +0000"  >&lt;p&gt;Checked into 2.2.x branch with thanks to Ton Swieb for the patch.&lt;/p&gt;

&lt;p&gt;$ svn ci&lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/OracleJDBCLock.java&lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/Statements.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockIntegrationTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/OracleJDBCLockTest.java&lt;br/&gt;
Transmitting file data .....&lt;br/&gt;
Committed revision 1140291.&lt;/p&gt;</comment>
                            <comment id="13055738" author="jgoodyear" created="Mon, 27 Jun 2011 20:39:47 +0000"  >&lt;p&gt;Checked in to trunk with thanks to Ton Swieb for the patch.&lt;/p&gt;

&lt;p&gt;$ svn ci&lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/OracleJDBCLock.java&lt;br/&gt;
Sending        main/src/main/java/org/apache/karaf/main/Statements.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockIntegrationTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/BaseJDBCLockTest.java&lt;br/&gt;
Sending        main/src/test/java/org/apache/karaf/main/OracleJDBCLockTest.java&lt;br/&gt;
Transmitting file data .....&lt;br/&gt;
Committed revision 1140306.&lt;/p&gt;</comment>
                            <comment id="13055740" author="jgoodyear" created="Mon, 27 Jun 2011 20:40:33 +0000"  >&lt;p&gt;Applied patch to 2.1.x, 2.2.x, and trunk, with thanks to Ton Swieb for the patch.&lt;/p&gt;</comment>
                            <comment id="13059566" author="jgoodyear" created="Mon, 4 Jul 2011 18:57:25 +0000"  >&lt;p&gt;Fixed in Apache Karaf 2.2.2.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483935" name="patch.txt" size="9383" author="tonswieb" created="Mon, 27 Jun 2011 11:28:37 +0000"/>
                            <attachment id="12483930" name="patch.txt" size="9383" author="tonswieb" created="Mon, 27 Jun 2011 11:05:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>69280</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0at9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61015</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>