<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:13:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KARAF-5327] Threads not stopped on karaf.restart + bundle(0).stop()</title>
                <link>https://issues.apache.org/jira/browse/KARAF-5327</link>
                <project id="12311140" key="KARAF">Karaf</project>
                    <description>&lt;p&gt;I was looking at:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; system:property karaf.restart true
karaf@root()&amp;gt; stop 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I expected OSGi/Felix to be stopped, start-level go to 0 and all components/services/threads be stopped.&lt;/p&gt;

&lt;p&gt;However when Karaf came to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;main@7301&quot; prio=5 tid=0x1 nid=NA runnable
  java.lang.Thread.State: RUNNABLE
	  at org.apache.karaf.main.Main.main(Main.java:170)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i.e., when Karaf decided to loop instead of System.exit() (because of karaf.restart=true), I saw the following threads remaining:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;jline
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;JLine terminal non blocking reader thread@7394&quot; daemon prio=5 tid=0x5e nid=NA runnable
  java.lang.Thread.State: RUNNABLE
	  at java.io.FileInputStream.readBytes(FileInputStream.java:-1)
	  at java.io.FileInputStream.read(FileInputStream.java:255)
	  at org.jline.utils.InputStreamReader.read(InputStreamReader.java:270)
	  - locked &amp;lt;0x1ce3&amp;gt; (a java.io.FileInputStream)
	  at org.jline.utils.InputStreamReader.read(InputStreamReader.java:200)
	  at org.jline.utils.NonBlockingReader.run(NonBlockingReader.java:276)
	  at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;shutdown socket thread
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Karaf Shutdown Socket Thread@7393&quot; daemon prio=5 tid=0x18 nid=NA runnable
  java.lang.Thread.State: RUNNABLE
	  at java.net.PlainSocketImpl.socketAccept(PlainSocketImpl.java:-1)
	  at java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)
	  at java.net.ServerSocket.implAccept(ServerSocket.java:545)
	  at java.net.ServerSocket.accept(ServerSocket.java:513)
	  at org.apache.karaf.main.ShutdownSocketThread.run(ShutdownSocketThread.java:57)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(In fabric8v1 I also saw jetty threads running, but it&apos;s pax-web fault).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13098476">KARAF-5327</key>
            <summary>Threads not stopped on karaf.restart + bundle(0).stop()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="ggrzybek">Grzegorz Grzybek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Aug 2017 06:22:59 +0000</created>
                <updated>Thu, 19 Dec 2019 17:36:31 +0000</updated>
                            <resolved>Wed, 30 Aug 2017 15:23:31 +0000</resolved>
                                    <version>4.2.0.M1</version>
                                    <fixVersion>4.2.0.M1</fixVersion>
                                    <component>karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16146704" author="gzres" created="Wed, 30 Aug 2017 06:28:47 +0000"  >&lt;p&gt;on each restart I have another server socket opened for shutdown thread:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ggrzybek@everfree] ~/sources/github.com/apache/karaf 
$ ss -lntp|grep 13813
LISTEN     0      1            *:5005                     *:*                   users:((&quot;java&quot;,pid=13813,fd=37))
LISTEN     0      1         ::ffff:127.0.0.1:46817                   :::*                   users:((&quot;java&quot;,pid=13813,fd=54))
LISTEN     0      1         ::ffff:127.0.0.1:34211                   :::*                   users:((&quot;java&quot;,pid=13813,fd=118))
LISTEN     0      50          :::8101                    :::*                   users:((&quot;java&quot;,pid=13813,fd=132))
LISTEN     0      1         ::ffff:127.0.0.1:41317                   :::*                   users:((&quot;java&quot;,pid=13813,fd=115))
LISTEN     0      50        ::ffff:127.0.0.1:1099                    :::*                   users:((&quot;java&quot;,pid=13813,fd=123))
LISTEN     0      50          :::32849                   :::*                   users:((&quot;java&quot;,pid=13813,fd=31))
LISTEN     0      1         ::ffff:127.0.0.1:45879                   :::*                   users:((&quot;java&quot;,pid=13813,fd=105))
LISTEN     0      50        ::ffff:127.0.0.1:44444                   :::*                   users:((&quot;java&quot;,pid=13813,fd=125))
LISTEN     0      1         ::ffff:127.0.0.1:37053                   :::*                   users:((&quot;java&quot;,pid=13813,fd=114))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16146799" author="gnt" created="Wed, 30 Aug 2017 07:18:56 +0000"  >&lt;p&gt;The jline thread is blocked waiting on an  &lt;tt&gt;InputStream#read()&lt;/tt&gt; call to finish.  It can&apos;t be unblocked and should be destroyed as soon as the user hits a key.&lt;/p&gt;

&lt;p&gt;The shutdown thread is a problem because the code does not seem to ever shut it down.&lt;/p&gt;</comment>
                            <comment id="16146893" author="gzres" created="Wed, 30 Aug 2017 08:34:03 +0000"  >&lt;p&gt;confirmed - jline thread is not an issue here.&lt;/p&gt;</comment>
                            <comment id="16147256" author="jira-bot" created="Wed, 30 Aug 2017 13:53:47 +0000"  >&lt;p&gt;Commit 447f36e2921c4bf4d7b2e40ca09eb0c43e6840be in karaf&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=karaf.git;h=447f36e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=karaf.git;h=447f36e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KARAF-5327&quot; title=&quot;Threads not stopped on karaf.restart + bundle(0).stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KARAF-5327&quot;&gt;&lt;del&gt;KARAF-5327&lt;/del&gt;&lt;/a&gt; Threads not stopped on karaf.restart + bundle(0).stop()&lt;/p&gt;</comment>
                            <comment id="16147262" author="gzres" created="Wed, 30 Aug 2017 13:57:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt; for the fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jfrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>