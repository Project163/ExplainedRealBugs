[{"url":"https://api.github.com/repos/forem/forem/issues/comments/814926257","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-814926257","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":814926257,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDkyNjI1Nw==","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T13:44:50Z","updated_at":"2021-04-07T13:44:50Z","body":"Thanks for the issue, we will take it into consideration! Our team of engineers is busy working on many types of features, please give us time to get back to you.\n\nFeature requests that require more discussion may be closed. Read more about our [feature request process](https://forem.dev/foremteam/internal-rfc-process-and-forem-dev-discussions-3gl4) on forem.dev.\n\nTo our amazing contributors: issues labeled `type: bug` are always up for grabs, but for feature requests, please wait until we add a `ready for dev` before starting to work on it.\n\nTo claim an issue to work on, please leave a comment. If you've claimed the issue and need help, please ping @forem/oss. The OSS Community Manager or the engineers on OSS rotation will follow up.\n\nFor full info on how to contribute, please check out our [contributors guide](https://github.com/forem/forem/blob/master/CONTRIBUTING.md).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/814926257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"id":4562708470,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ1NjI3MDg0NzA=","url":"https://api.github.com/repos/forem/forem/issues/events/4562708470","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-04-07T14:01:59Z","label":{"name":"area: api-v0","color":"2a75b2"},"performed_via_github_app":null},{"id":4562708472,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ1NjI3MDg0NzI=","url":"https://api.github.com/repos/forem/forem/issues/events/4562708472","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-04-07T14:01:59Z","label":{"name":"area: caching","color":"2a75b2"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/forem/forem/issues/comments/814946548","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-814946548","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":814946548,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDk0NjU0OA==","user":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T14:10:02Z","updated_at":"2021-04-07T14:10:02Z","body":"> I think I'm suggesting EdgeCache::Bust.call(\"/api/users/#{user.id}\") be triggered on create but I might not understand what's in play here.\r\n\r\nIt's probably enough.\r\n\r\nI think it might be due to the fact that we're not setting a surrogate key in the `API::V0::UsersController#show` endpoint, mistakenly assuming that that endpoint is never cached but as you noticed, it's cached with a default expiration of an hour. \r\n\r\nMaybe we can implement it the same way we do for `articles`:\r\n\r\nhttps://github.com/forem/forem/blob/5ab3b02de4498d4f89c89d3efa66518b7c564bf7/app/controllers/api/v0/articles_controller.rb#L10\r\n\r\nthis sets the cache control headers\r\n\r\nhttps://github.com/forem/forem/blob/5ab3b02de4498d4f89c89d3efa66518b7c564bf7/app/controllers/api/v0/articles_controller.rb#L49\r\n\r\nI think we're moving away from surrogate keys for portability though.\r\n\r\ncc @atsmith813 for possible additional context","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/814946548/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4562756157,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU2Mjc1NjE1Nw==","url":"https://api.github.com/repos/forem/forem/issues/events/4562756157","actor":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-07T14:10:02Z","performed_via_github_app":null},{"id":4562756165,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1NjI3NTYxNjU=","url":"https://api.github.com/repos/forem/forem/issues/events/4562756165","actor":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-07T14:10:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/forem/forem/issues/comments/814952930","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-814952930","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":814952930,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDk1MjkzMA==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T14:17:58Z","updated_at":"2021-04-07T14:17:58Z","body":"Just to clarify - I don't believe the 200 responses are being cached - only the 404 response.\r\n\r\nhttps://github.com/forem/forem/blob/master/app/controllers/api/v0/api_controller.rb#L32-L34 I think it's _actually_ this action via the inherited rescue https://github.com/forem/forem/blob/master/app/controllers/api/v0/api_controller.rb#L18 that's handling the response, not the users controller? \r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/814952930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/forem/forem/issues/comments/814955595","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-814955595","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":814955595,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDk1NTU5NQ==","user":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T14:21:31Z","updated_at":"2021-04-07T14:21:31Z","body":"Ohh got it! Yeah, that's rendered from that block. Maybe we could add `Cache-Control: no-store, max-age=0` to the 404 response...","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/814955595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/forem/forem/issues/comments/814957521","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-814957521","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":814957521,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDk1NzUyMQ==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T14:24:01Z","updated_at":"2021-04-07T15:11:43Z","body":"I'm not opposed to caching 404's, but the risk of not caching them seems low (so no harm in serving them fresh until we see it become a problem).\r\n\r\nI've definitely seen CMS systems self-destruct when a scanner hit too many urls giving 404's in a short time, and they rendered beautifully themed error pages dynamically, though I admit api db lookup by id is probably not the same severity.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/814957521/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/forem/forem/issues/comments/815090763","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-815090763","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":815090763,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNTA5MDc2Mw==","user":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T17:26:41Z","updated_at":"2021-04-07T17:26:41Z","body":"Very interesting ðŸ¤” \r\n\r\nI think your idea of busting the cache after creating a user would fix it @djuber. Depending on how we bust it (sync or async) it's possible there's a teeny tiny delay still in that endpoint refreshing (maybe?). Admittedly, I don't think this potential delay has been an issue on the other endpoints. Most of it is Fastly which is super fast ðŸ˜… ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/815090763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4563846843,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU2Mzg0Njg0Mw==","url":"https://api.github.com/repos/forem/forem/issues/events/4563846843","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-07T17:26:41Z","performed_via_github_app":null},{"id":4563846846,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1NjM4NDY4NDY=","url":"https://api.github.com/repos/forem/forem/issues/events/4563846846","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-07T17:26:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/forem/forem/issues/comments/815091274","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-815091274","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":815091274,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNTA5MTI3NA==","user":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T17:27:30Z","updated_at":"2021-04-07T17:27:30Z","body":"And âž•  to @rhymes's point\r\n\r\n> I think we're moving away from surrogate keys for portability though.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/815091274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"atsmith813","id":15987080,"node_id":"MDQ6VXNlcjE1OTg3MDgw","avatar_url":"https://avatars.githubusercontent.com/u/15987080?v=4","gravatar_id":"","url":"https://api.github.com/users/atsmith813","html_url":"https://github.com/atsmith813","followers_url":"https://api.github.com/users/atsmith813/followers","following_url":"https://api.github.com/users/atsmith813/following{/other_user}","gists_url":"https://api.github.com/users/atsmith813/gists{/gist_id}","starred_url":"https://api.github.com/users/atsmith813/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atsmith813/subscriptions","organizations_url":"https://api.github.com/users/atsmith813/orgs","repos_url":"https://api.github.com/users/atsmith813/repos","events_url":"https://api.github.com/users/atsmith813/events{/privacy}","received_events_url":"https://api.github.com/users/atsmith813/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4563850558,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU2Mzg1MDU1OA==","url":"https://api.github.com/repos/forem/forem/issues/events/4563850558","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-07T17:27:30Z","performed_via_github_app":null},{"id":4563850562,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1NjM4NTA1NjI=","url":"https://api.github.com/repos/forem/forem/issues/events/4563850562","actor":{"login":"rhymes","id":146201,"node_id":"MDQ6VXNlcjE0NjIwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/146201?v=4","gravatar_id":"","url":"https://api.github.com/users/rhymes","html_url":"https://github.com/rhymes","followers_url":"https://api.github.com/users/rhymes/followers","following_url":"https://api.github.com/users/rhymes/following{/other_user}","gists_url":"https://api.github.com/users/rhymes/gists{/gist_id}","starred_url":"https://api.github.com/users/rhymes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhymes/subscriptions","organizations_url":"https://api.github.com/users/rhymes/orgs","repos_url":"https://api.github.com/users/rhymes/repos","events_url":"https://api.github.com/users/rhymes/events{/privacy}","received_events_url":"https://api.github.com/users/rhymes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-07T17:27:30Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/forem/forem/issues/comments/817863394","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-817863394","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":817863394,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNzg2MzM5NA==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-12T14:32:51Z","updated_at":"2021-04-12T14:32:51Z","body":"> Depending on how we bust it (sync or async) it's possible there's a teeny tiny delay still in that endpoint refreshing (maybe?).\r\n\r\nI don't think that's an issue - the use case is a 3rd party requesting the user show action a few minutes apart, not a user created via the api getting redirected to their own page and seeing the 404 - delay is acceptable here.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/817863394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/forem/forem/issues/comments/823359343","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-823359343","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":823359343,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMzM1OTM0Mw==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-20T15:17:52Z","updated_at":"2021-04-20T15:17:52Z","body":"Coming back to this - it looks like User has an `after_save :bust_cache` callback registered, that would be assumed to have triggered here? Unless either `after_create` and `after_save` are exclusive (we don't clear cache on create, assuming we didn't cache), or the created object's id only exists in the transaction and is not visible to sidekiq (and the cache busting job runs while the outermost wrapping AR transaction is still uncommitted so the id is not found?)\r\n\r\nRe-reading the AR callbacks docs to see if we want to make that an after-commit hook rather than after-save, or if a second hook needs to be added after create commit specially.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/823359343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-20T17:18:59Z","updated_at":"2021-04-20T17:18:59Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/forem/forem/issues/13455","repository_url":"https://api.github.com/repos/forem/forem","labels_url":"https://api.github.com/repos/forem/forem/issues/13455/labels{/name}","comments_url":"https://api.github.com/repos/forem/forem/issues/13455/comments","events_url":"https://api.github.com/repos/forem/forem/issues/13455/events","html_url":"https://github.com/forem/forem/pull/13455","id":863043499,"node_id":"MDExOlB1bGxSZXF1ZXN0NjE5NTE0OTYx","number":13455,"title":"Bust cache after commit, rather than after save","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1123882148,"node_id":"MDU6TGFiZWwxMTIzODgyMTQ4","url":"https://api.github.com/repos/forem/forem/labels/PR:%20merged","name":"PR: merged","color":"6a737d","default":false,"description":"bot applied label for PR's that are merged"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-04-20T17:18:59Z","updated_at":"2022-07-06T22:21:10Z","closed_at":"2021-04-21T15:54:20Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":73648678,"node_id":"MDEwOlJlcG9zaXRvcnk3MzY0ODY3OA==","name":"forem","full_name":"forem/forem","private":false,"owner":{"login":"forem","id":65030610,"node_id":"MDEyOk9yZ2FuaXphdGlvbjY1MDMwNjEw","avatar_url":"https://avatars.githubusercontent.com/u/65030610?v=4","gravatar_id":"","url":"https://api.github.com/users/forem","html_url":"https://github.com/forem","followers_url":"https://api.github.com/users/forem/followers","following_url":"https://api.github.com/users/forem/following{/other_user}","gists_url":"https://api.github.com/users/forem/gists{/gist_id}","starred_url":"https://api.github.com/users/forem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/forem/subscriptions","organizations_url":"https://api.github.com/users/forem/orgs","repos_url":"https://api.github.com/users/forem/repos","events_url":"https://api.github.com/users/forem/events{/privacy}","received_events_url":"https://api.github.com/users/forem/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/forem/forem","description":"For empowering community ðŸŒ±","fork":false,"url":"https://api.github.com/repos/forem/forem","forks_url":"https://api.github.com/repos/forem/forem/forks","keys_url":"https://api.github.com/repos/forem/forem/keys{/key_id}","collaborators_url":"https://api.github.com/repos/forem/forem/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/forem/forem/teams","hooks_url":"https://api.github.com/repos/forem/forem/hooks","issue_events_url":"https://api.github.com/repos/forem/forem/issues/events{/number}","events_url":"https://api.github.com/repos/forem/forem/events","assignees_url":"https://api.github.com/repos/forem/forem/assignees{/user}","branches_url":"https://api.github.com/repos/forem/forem/branches{/branch}","tags_url":"https://api.github.com/repos/forem/forem/tags","blobs_url":"https://api.github.com/repos/forem/forem/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/forem/forem/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/forem/forem/git/refs{/sha}","trees_url":"https://api.github.com/repos/forem/forem/git/trees{/sha}","statuses_url":"https://api.github.com/repos/forem/forem/statuses/{sha}","languages_url":"https://api.github.com/repos/forem/forem/languages","stargazers_url":"https://api.github.com/repos/forem/forem/stargazers","contributors_url":"https://api.github.com/repos/forem/forem/contributors","subscribers_url":"https://api.github.com/repos/forem/forem/subscribers","subscription_url":"https://api.github.com/repos/forem/forem/subscription","commits_url":"https://api.github.com/repos/forem/forem/commits{/sha}","git_commits_url":"https://api.github.com/repos/forem/forem/git/commits{/sha}","comments_url":"https://api.github.com/repos/forem/forem/comments{/number}","issue_comment_url":"https://api.github.com/repos/forem/forem/issues/comments{/number}","contents_url":"https://api.github.com/repos/forem/forem/contents/{+path}","compare_url":"https://api.github.com/repos/forem/forem/compare/{base}...{head}","merges_url":"https://api.github.com/repos/forem/forem/merges","archive_url":"https://api.github.com/repos/forem/forem/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/forem/forem/downloads","issues_url":"https://api.github.com/repos/forem/forem/issues{/number}","pulls_url":"https://api.github.com/repos/forem/forem/pulls{/number}","milestones_url":"https://api.github.com/repos/forem/forem/milestones{/number}","notifications_url":"https://api.github.com/repos/forem/forem/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/forem/forem/labels{/name}","releases_url":"https://api.github.com/repos/forem/forem/releases{/id}","deployments_url":"https://api.github.com/repos/forem/forem/deployments","created_at":"2016-11-13T23:02:13Z","updated_at":"2025-11-10T03:30:54Z","pushed_at":"2025-11-08T23:08:51Z","git_url":"git://github.com/forem/forem.git","ssh_url":"git@github.com:forem/forem.git","clone_url":"https://github.com/forem/forem.git","svn_url":"https://github.com/forem/forem","homepage":"https://forem.com","size":1724987,"stargazers_count":22508,"watchers_count":22508,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":606,"license":{"key":"agpl-3.0","name":"GNU Affero General Public License v3.0","spdx_id":"AGPL-3.0","url":"https://api.github.com/licenses/agpl-3.0","node_id":"MDc6TGljZW5zZTE="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["community","discussion","feedback","hacktoberfest","open-source","rails","ruby"],"visibility":"public","forks":4150,"open_issues":606,"watchers":22508,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/forem/forem/pulls/13455","html_url":"https://github.com/forem/forem/pull/13455","diff_url":"https://github.com/forem/forem/pull/13455.diff","patch_url":"https://github.com/forem/forem/pull/13455.patch","merged_at":"2021-04-21T15:54:20Z"},"body":"## What type of PR is this? (check all applicable)\r\n\r\n- [ ] Refactor\r\n- [ ] Feature\r\n- [x] Bug Fix\r\n- [ ] Optimization\r\n- [ ] Documentation Update\r\n\r\n## Description\r\nThere's a (tiny) race condition where if an enclosing transaction\r\nhas not yet been committed when a user is created, and a sidekiq\r\nworker begins find(:id) and fails, that the job is enqueued, started,\r\nand skipped.\r\n\r\nThis changes the after_save hook on User to after_commit, ensuring the\r\nuser's assigned id is visible to other processes.\r\n\r\n## Related Tickets & Documents\r\n\r\n#13293 (does not fix)\r\n\r\n## QA Instructions, Screenshots, Recordings\r\n\r\nNot sure how effectively we can test this outside of an environment where edge caching is live. \r\n- create, update, and destroy a user.\r\n- edge cache should be busted in each case via an enqueued sidekiq job\r\n\r\nFitness for task check:\r\n since the original context was \"a new user is created after a 404 was returned, but the 404 response is cached, and the user is not accessible to the api\" the post deploy acceptance check would be something like:\r\n- find `SELECT MAX(id) FROM users` \r\n- check https://dev.to/api/users/(id + 1) and receive a (fresh) 404 response\r\n- wait a few minutes for a sign-up, such that user (id + 1) is created, and the cache busting has occurred \r\n- reload the api request and observe a 200 with the user json in it \r\n\r\nA 404 with x-cache: miss/hit headers would indicate this change was not effective.\r\n\r\n### UI accessibility concerns?\r\n\r\nNone, backend only change.\r\n\r\n## Added tests?\r\n\r\n- [ ] Yes\r\n- [x] No, and this is why: change in mechanism, not behavior\r\n- [ ] I need help with writing tests\r\n\r\n## [Forem core team only] How will this change be communicated?\r\n\r\n_Will this PR introduce a change that impacts Forem members or creators, the\r\ndevelopment process, or any of our internal teams? If so, please note how you\r\nwill share this change with the people who need to know about it._\r\n\r\n- [ ] I've updated the [Developer Docs](https://docs.forem.com) and/or\r\n      [Admin Guide](https://forem.gitbook.io/forem-admin-guide/), or\r\n      [Storybook](https://storybook.forem.com/) (for Crayons components)\r\n- [ ] I've updated the README or added inline documentation\r\n- [ ] I will share this change in a [Changelog](https://forem.dev/t/changelog)\r\n      or in a [forem.dev](http://forem.dev) post\r\n- [ ] I will share this change internally with the appropriate teams\r\n- [ ] I'm not sure how best to communicate this change and need help\r\n- [x] This change does not need to be communicated, and this is why not: change in implementation, not behavior\r\n\r\n## [optional] Are there any post deployment tasks we need to perform?\r\n\r\nNone\r\n\r\n## [optional] What gif best describes this PR or how it makes you feel?\r\n\r\n![stairs](https://user-images.githubusercontent.com/1237369/115438068-90d4c780-a1d2-11eb-9734-7cacc0a88fd4.jpeg)\r\n","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/13455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/forem/forem/issues/13455/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4625928516,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2MjU5Mjg1MTY=","url":"https://api.github.com/repos/forem/forem/issues/events/4625928516","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f783cb95045ca3695bc3a0090084841269a78e3a","commit_url":"https://api.github.com/repos/forem/forem/commits/f783cb95045ca3695bc3a0090084841269a78e3a","created_at":"2021-04-21T15:59:24Z","performed_via_github_app":null},{"actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-21T16:11:02Z","updated_at":"2021-04-21T16:11:02Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/forem/forem/issues/13465","repository_url":"https://api.github.com/repos/forem/forem","labels_url":"https://api.github.com/repos/forem/forem/issues/13465/labels{/name}","comments_url":"https://api.github.com/repos/forem/forem/issues/13465/comments","events_url":"https://api.github.com/repos/forem/forem/issues/13465/events","html_url":"https://github.com/forem/forem/pull/13465","id":864051935,"node_id":"MDExOlB1bGxSZXF1ZXN0NjIwMzQ5MDc5","number":13465,"title":"When busting user cache, also clear the api response","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1123882148,"node_id":"MDU6TGFiZWwxMTIzODgyMTQ4","url":"https://api.github.com/repos/forem/forem/labels/PR:%20merged","name":"PR: merged","color":"6a737d","default":false,"description":"bot applied label for PR's that are merged"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-04-21T16:11:02Z","updated_at":"2022-07-06T22:21:10Z","closed_at":"2021-04-22T14:16:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":73648678,"node_id":"MDEwOlJlcG9zaXRvcnk3MzY0ODY3OA==","name":"forem","full_name":"forem/forem","private":false,"owner":{"login":"forem","id":65030610,"node_id":"MDEyOk9yZ2FuaXphdGlvbjY1MDMwNjEw","avatar_url":"https://avatars.githubusercontent.com/u/65030610?v=4","gravatar_id":"","url":"https://api.github.com/users/forem","html_url":"https://github.com/forem","followers_url":"https://api.github.com/users/forem/followers","following_url":"https://api.github.com/users/forem/following{/other_user}","gists_url":"https://api.github.com/users/forem/gists{/gist_id}","starred_url":"https://api.github.com/users/forem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/forem/subscriptions","organizations_url":"https://api.github.com/users/forem/orgs","repos_url":"https://api.github.com/users/forem/repos","events_url":"https://api.github.com/users/forem/events{/privacy}","received_events_url":"https://api.github.com/users/forem/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/forem/forem","description":"For empowering community ðŸŒ±","fork":false,"url":"https://api.github.com/repos/forem/forem","forks_url":"https://api.github.com/repos/forem/forem/forks","keys_url":"https://api.github.com/repos/forem/forem/keys{/key_id}","collaborators_url":"https://api.github.com/repos/forem/forem/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/forem/forem/teams","hooks_url":"https://api.github.com/repos/forem/forem/hooks","issue_events_url":"https://api.github.com/repos/forem/forem/issues/events{/number}","events_url":"https://api.github.com/repos/forem/forem/events","assignees_url":"https://api.github.com/repos/forem/forem/assignees{/user}","branches_url":"https://api.github.com/repos/forem/forem/branches{/branch}","tags_url":"https://api.github.com/repos/forem/forem/tags","blobs_url":"https://api.github.com/repos/forem/forem/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/forem/forem/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/forem/forem/git/refs{/sha}","trees_url":"https://api.github.com/repos/forem/forem/git/trees{/sha}","statuses_url":"https://api.github.com/repos/forem/forem/statuses/{sha}","languages_url":"https://api.github.com/repos/forem/forem/languages","stargazers_url":"https://api.github.com/repos/forem/forem/stargazers","contributors_url":"https://api.github.com/repos/forem/forem/contributors","subscribers_url":"https://api.github.com/repos/forem/forem/subscribers","subscription_url":"https://api.github.com/repos/forem/forem/subscription","commits_url":"https://api.github.com/repos/forem/forem/commits{/sha}","git_commits_url":"https://api.github.com/repos/forem/forem/git/commits{/sha}","comments_url":"https://api.github.com/repos/forem/forem/comments{/number}","issue_comment_url":"https://api.github.com/repos/forem/forem/issues/comments{/number}","contents_url":"https://api.github.com/repos/forem/forem/contents/{+path}","compare_url":"https://api.github.com/repos/forem/forem/compare/{base}...{head}","merges_url":"https://api.github.com/repos/forem/forem/merges","archive_url":"https://api.github.com/repos/forem/forem/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/forem/forem/downloads","issues_url":"https://api.github.com/repos/forem/forem/issues{/number}","pulls_url":"https://api.github.com/repos/forem/forem/pulls{/number}","milestones_url":"https://api.github.com/repos/forem/forem/milestones{/number}","notifications_url":"https://api.github.com/repos/forem/forem/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/forem/forem/labels{/name}","releases_url":"https://api.github.com/repos/forem/forem/releases{/id}","deployments_url":"https://api.github.com/repos/forem/forem/deployments","created_at":"2016-11-13T23:02:13Z","updated_at":"2025-11-10T03:30:54Z","pushed_at":"2025-11-08T23:08:51Z","git_url":"git://github.com/forem/forem.git","ssh_url":"git@github.com:forem/forem.git","clone_url":"https://github.com/forem/forem.git","svn_url":"https://github.com/forem/forem","homepage":"https://forem.com","size":1724987,"stargazers_count":22508,"watchers_count":22508,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":606,"license":{"key":"agpl-3.0","name":"GNU Affero General Public License v3.0","spdx_id":"AGPL-3.0","url":"https://api.github.com/licenses/agpl-3.0","node_id":"MDc6TGljZW5zZTE="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["community","discussion","feedback","hacktoberfest","open-source","rails","ruby"],"visibility":"public","forks":4150,"open_issues":606,"watchers":22508,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/forem/forem/pulls/13465","html_url":"https://github.com/forem/forem/pull/13465","diff_url":"https://github.com/forem/forem/pull/13465.diff","patch_url":"https://github.com/forem/forem/pull/13465.patch","merged_at":"2021-04-22T14:16:15Z"},"body":"\r\n## What type of PR is this? (check all applicable)\r\n\r\n- [ ] Refactor\r\n- [ ] Feature\r\n- [x] Bug Fix\r\n- [ ] Optimization\r\n- [ ] Documentation Update\r\n\r\n## Description\r\n\r\nWhen we clear the cached responses about a user, also clear the api response. This mirrors what we do for [Articles](https://github.com/forem/forem/blob/main/app/services/edge_cache/bust_article.rb#L28) already\r\n\r\n## Related Tickets & Documents\r\n\r\n#13293 \r\n\r\n## QA Instructions, Screenshots, Recordings\r\n\r\n\r\n### UI accessibility concerns?\r\n\r\nNone\r\n\r\n## Added tests?\r\n\r\n- [x] Yes\r\n- [ ] No, and this is why: _please replace this line with details on why tests\r\n      have not been included_\r\n- [ ] I need help with writing tests\r\n\r\n## [Forem core team only] How will this change be communicated?\r\n\r\n_Will this PR introduce a change that impacts Forem members or creators, the\r\ndevelopment process, or any of our internal teams? If so, please note how you\r\nwill share this change with the people who need to know about it._\r\n\r\n- [ ] I've updated the [Developer Docs](https://docs.forem.com) and/or\r\n      [Admin Guide](https://forem.gitbook.io/forem-admin-guide/), or\r\n      [Storybook](https://storybook.forem.com/) (for Crayons components)\r\n- [ ] I've updated the README or added inline documentation\r\n- [ ] I will share this change in a [Changelog](https://forem.dev/t/changelog)\r\n      or in a [forem.dev](http://forem.dev) post\r\n- [ ] I will share this change internally with the appropriate teams\r\n- [ ] I'm not sure how best to communicate this change and need help\r\n- [x] This change does not need to be communicated, and this is why not: bugfix. Will comment in the related issue.\r\n\r\n## [optional] Are there any post deployment tasks we need to perform?\r\n\r\nI can test this post deploy to confirm it behaves \r\n\r\n## [optional] What gif best describes this PR or how it makes you feel?\r\n\r\n![image](https://user-images.githubusercontent.com/1237369/115586122-e1f7c080-a291-11eb-9c4e-e1e6b0434e9f.png)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/13465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/forem/forem/issues/13465/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4631151454,"node_id":"MDExOkNsb3NlZEV2ZW50NDYzMTE1MTQ1NA==","url":"https://api.github.com/repos/forem/forem/issues/events/4631151454","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"3e432c9047a34a23a1bc0782f6a881efe08f81a9","commit_url":"https://api.github.com/repos/forem/forem/commits/3e432c9047a34a23a1bc0782f6a881efe08f81a9","created_at":"2021-04-22T14:16:20Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/forem/forem/issues/comments/824881871","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-824881871","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":824881871,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDg4MTg3MQ==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T14:17:13Z","updated_at":"2021-04-22T14:17:13Z","body":"For posterity - the underlying cause appeared to be that the bust cache callback cleared all of the UI paths, but not the api path, causing the stale 404 response.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/824881871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/forem/forem/issues/comments/825785422","html_url":"https://github.com/forem/forem/issues/13293#issuecomment-825785422","issue_url":"https://api.github.com/repos/forem/forem/issues/13293","id":825785422,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTc4NTQyMg==","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T16:50:22Z","updated_at":"2021-04-23T16:50:22Z","body":"Reopening since it looks like the cached 404 page did not get cleared (checked /users/619751 which did not exist when I started - then waited 3 minutes for the user to be created, and confirmed changing the url showed the user's page). \r\n\r\nWaited another minute or two for the cache to clear in case the update didn't run and confirmed the sidekiq queues were empty (if it had been requested it would have run).\r\n\r\nStill getting a cached response, still seeing a 404. \r\n\r\nTrivial url changes like adding a second (redundant) slash to the path were sufficient to work around this but the repeated request fails repeatably.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/825785422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4637922367,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0NjM3OTIyMzY3","url":"https://api.github.com/repos/forem/forem/issues/events/4637922367","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2021-04-23T16:50:26Z","state_reason":null,"performed_via_github_app":null}]