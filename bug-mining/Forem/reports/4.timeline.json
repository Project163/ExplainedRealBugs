[{"url":"https://api.github.com/repos/forem/forem/issues/comments/800438976","html_url":"https://github.com/forem/forem/issues/13008#issuecomment-800438976","issue_url":"https://api.github.com/repos/forem/forem/issues/13008","id":800438976,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDQzODk3Ng==","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:58:41Z","updated_at":"2021-03-16T16:58:41Z","body":"Thanks for the issue, we will take it into consideration! Our team of engineers is busy working on many types of features, please give us time to get back to you.\n\nFeature requests that require more discussion may be closed. Read more about our [feature request process](https://forem.dev/foremteam/internal-rfc-process-and-forem-dev-discussions-3gl4) on forem.dev.\n\nTo our amazing contributors: issues labeled `type: bug` are always up for grabs, but for feature requests, please wait until we add a `ready for dev` before starting to work on it.\n\nTo claim an issue to work on, please leave a comment. If you've claimed the issue and need help, please ping @forem/oss. The OSS Community Manager or the engineers on OSS rotation will follow up.\n\nFor full info on how to contribute, please check out our [contributors guide](https://github.com/forem/forem/blob/master/CONTRIBUTING.md).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/comments/800438976/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"id":4465803890,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDQ2NTgwMzg5MA==","url":"https://api.github.com/repos/forem/forem/issues/events/4465803890","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-03-16T16:58:42Z","rename":{"from":"rescoring articles sends the old score, not the new score, to the blackbox","to":"Scoring articles sends the current score, not the new score, to the blackbox"},"performed_via_github_app":null},{"actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:59:01Z","updated_at":"2021-03-16T16:59:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/forem/forem/issues/12983","repository_url":"https://api.github.com/repos/forem/forem","labels_url":"https://api.github.com/repos/forem/forem/issues/12983/labels{/name}","comments_url":"https://api.github.com/repos/forem/forem/issues/12983/comments","events_url":"https://api.github.com/repos/forem/forem/issues/12983/events","html_url":"https://github.com/forem/forem/pull/12983","id":830311845,"node_id":"MDExOlB1bGxSZXF1ZXN0NTkxODQzMjQx","number":12983,"title":"reenable article rescoring when moderators flag users ","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1902308505,"node_id":"MDU6TGFiZWwxOTAyMzA4NTA1","url":"https://api.github.com/repos/forem/forem/labels/PR:%20partially-approved","name":"PR: partially-approved","color":"6a737d","default":false,"description":"bot applied label for PR's where a single reviewer approves changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-03-12T17:21:03Z","updated_at":"2022-07-06T22:21:00Z","closed_at":"2021-03-16T19:04:13Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":73648678,"node_id":"MDEwOlJlcG9zaXRvcnk3MzY0ODY3OA==","name":"forem","full_name":"forem/forem","private":false,"owner":{"login":"forem","id":65030610,"node_id":"MDEyOk9yZ2FuaXphdGlvbjY1MDMwNjEw","avatar_url":"https://avatars.githubusercontent.com/u/65030610?v=4","gravatar_id":"","url":"https://api.github.com/users/forem","html_url":"https://github.com/forem","followers_url":"https://api.github.com/users/forem/followers","following_url":"https://api.github.com/users/forem/following{/other_user}","gists_url":"https://api.github.com/users/forem/gists{/gist_id}","starred_url":"https://api.github.com/users/forem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/forem/subscriptions","organizations_url":"https://api.github.com/users/forem/orgs","repos_url":"https://api.github.com/users/forem/repos","events_url":"https://api.github.com/users/forem/events{/privacy}","received_events_url":"https://api.github.com/users/forem/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/forem/forem","description":"For empowering community ðŸŒ±","fork":false,"url":"https://api.github.com/repos/forem/forem","forks_url":"https://api.github.com/repos/forem/forem/forks","keys_url":"https://api.github.com/repos/forem/forem/keys{/key_id}","collaborators_url":"https://api.github.com/repos/forem/forem/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/forem/forem/teams","hooks_url":"https://api.github.com/repos/forem/forem/hooks","issue_events_url":"https://api.github.com/repos/forem/forem/issues/events{/number}","events_url":"https://api.github.com/repos/forem/forem/events","assignees_url":"https://api.github.com/repos/forem/forem/assignees{/user}","branches_url":"https://api.github.com/repos/forem/forem/branches{/branch}","tags_url":"https://api.github.com/repos/forem/forem/tags","blobs_url":"https://api.github.com/repos/forem/forem/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/forem/forem/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/forem/forem/git/refs{/sha}","trees_url":"https://api.github.com/repos/forem/forem/git/trees{/sha}","statuses_url":"https://api.github.com/repos/forem/forem/statuses/{sha}","languages_url":"https://api.github.com/repos/forem/forem/languages","stargazers_url":"https://api.github.com/repos/forem/forem/stargazers","contributors_url":"https://api.github.com/repos/forem/forem/contributors","subscribers_url":"https://api.github.com/repos/forem/forem/subscribers","subscription_url":"https://api.github.com/repos/forem/forem/subscription","commits_url":"https://api.github.com/repos/forem/forem/commits{/sha}","git_commits_url":"https://api.github.com/repos/forem/forem/git/commits{/sha}","comments_url":"https://api.github.com/repos/forem/forem/comments{/number}","issue_comment_url":"https://api.github.com/repos/forem/forem/issues/comments{/number}","contents_url":"https://api.github.com/repos/forem/forem/contents/{+path}","compare_url":"https://api.github.com/repos/forem/forem/compare/{base}...{head}","merges_url":"https://api.github.com/repos/forem/forem/merges","archive_url":"https://api.github.com/repos/forem/forem/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/forem/forem/downloads","issues_url":"https://api.github.com/repos/forem/forem/issues{/number}","pulls_url":"https://api.github.com/repos/forem/forem/pulls{/number}","milestones_url":"https://api.github.com/repos/forem/forem/milestones{/number}","notifications_url":"https://api.github.com/repos/forem/forem/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/forem/forem/labels{/name}","releases_url":"https://api.github.com/repos/forem/forem/releases{/id}","deployments_url":"https://api.github.com/repos/forem/forem/deployments","created_at":"2016-11-13T23:02:13Z","updated_at":"2025-11-10T03:30:54Z","pushed_at":"2025-11-08T23:08:51Z","git_url":"git://github.com/forem/forem.git","ssh_url":"git@github.com:forem/forem.git","clone_url":"https://github.com/forem/forem.git","svn_url":"https://github.com/forem/forem","homepage":"https://forem.com","size":1724987,"stargazers_count":22508,"watchers_count":22508,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":606,"license":{"key":"agpl-3.0","name":"GNU Affero General Public License v3.0","spdx_id":"AGPL-3.0","url":"https://api.github.com/licenses/agpl-3.0","node_id":"MDc6TGljZW5zZTE="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["community","discussion","feedback","hacktoberfest","open-source","rails","ruby"],"visibility":"public","forks":4150,"open_issues":606,"watchers":22508,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/forem/forem/pulls/12983","html_url":"https://github.com/forem/forem/pull/12983","diff_url":"https://github.com/forem/forem/pull/12983.diff","patch_url":"https://github.com/forem/forem/pull/12983.patch","merged_at":"2021-03-16T19:04:13Z"},"body":"## What type of PR is this? (check all applicable)\r\n\r\n- [ ] Refactor\r\n- [ ] Feature\r\n- [x] Bug Fix\r\n- [ ] Optimization\r\n- [ ] Documentation Update\r\n\r\n## Description\r\n\r\nThe user moderation is expected to rescore (downward) all articles for a user when a vomit reaction is added. Additionally the articles should rescore upward when user moderation reactions are removed. This was disabled last year because it caused some unexpected problems (one users articles were clogging the feed for everyone after everything they had written was given the same, very high, score). The underlying cause was the score calculation, which assigned the same total to all articles.\r\n\r\nThis PR changes the logic to process each articles score one by one when user moderation is being added or removed. Rather than setting all articles' scores to the sum of the reaction points for all articles, set the score equal to the sum of the reaction points of that one article plus the sum of the user reactions (from moderation). \r\n\r\nInitially I was going to just map a score adjustment (like score = score - 25)  against each of the articles, but realized that there were reasons this was the way it was initially. The main change now is breaking apart the article scoring to be per-article rather than a bulk update, which gains correctness (articles are correctly adjusted up or down) at the potential cost of many round trips to the database. I don't know _how_ frequently user moderation is happening to know if we need to worry about optimizing this as a special bulk query, this is already running in a background process when user vomit reactions are added or removed (which are moderator actions so not publicly available).\r\n\r\n## Related Tickets & Documents\r\n\r\nhttps://github.com/forem/forem/pull/9237\r\nhttps://github.com/forem/forem/pull/6006\r\nhttps://github.com/forem/forem/pull/6182\r\n\r\nFixes https://github.com/forem/forem/issues/12965\r\n\r\n## QA Instructions, Screenshots, Recordings\r\n\r\n- As a moderator\r\n- add a vomit reaction to a user\r\n![moderator-flag-user](https://user-images.githubusercontent.com/1237369/110996932-485bfb80-8342-11eb-92d7-9f6c8269d065.png)\r\n\r\n- observe worker is started\r\n![sidekiq-logs](https://user-images.githubusercontent.com/1237369/110997097-848f5c00-8342-11eb-83de-97067c0cee22.png)\r\n\r\n- verify user's articles' scores have adjusted downward\r\n![articles-scored](https://user-images.githubusercontent.com/1237369/110997159-9e30a380-8342-11eb-9e4b-db4db105f636.png)\r\n\r\n- remove the vomit reaction from the user\r\nUI was unclear, but resubmitting the \"Flag user\" form does trigger the destroy action,  Response from server: {\"result\":\"destroy\",\"category\":\"vomit\"}\r\n\r\n- verify worker is started\r\n![sidekiq-logs](https://user-images.githubusercontent.com/1237369/110997105-878a4c80-8342-11eb-8d81-4ff15c024a44.png)\r\n\r\n- verify the user's articles scores have adjusted upward (removing the negative feedback)\r\n![score-reset](https://user-images.githubusercontent.com/1237369/110997257-c5877080-8342-11eb-97ee-0321fa6b8b5a.png)\r\n\r\n\r\n\r\n### UI accessibility concerns?\r\n\r\nNone\r\n\r\n## Added tests?\r\n\r\n- [x] Yes\r\n- [ ] No, and this is why: _please replace this line with details on why tests\r\n      have not been included_\r\n- [ ] I need help with writing tests\r\n\r\n## [Forem core team only] How will this change be communicated?\r\n\r\n_Will this PR introduce a change that impacts Forem members or creators, the\r\ndevelopment process, or any of our internal teams? If so, please note how you\r\nwill share this change with the people who need to know about it._\r\n\r\n- [ ] I've updated the [Developer Docs](https://docs.forem.com) and/or\r\n      [Admin Guide](https://forem.gitbook.io/forem-admin-guide/), or\r\n      [Storybook](https://storybook.forem.com/) (for Crayons components)\r\n- [ ] I've updated the README or added inline documentation\r\n- [ ] I will share this change in a [Changelog](https://forem.dev/t/changelog)\r\n      or in a [forem.dev](http://forem.dev) post\r\n- [ ] I will share this change internally with the appropriate teams\r\n- [x] I'm not sure how best to communicate this change and need help\r\n- [ ] This change does not need to be communicated, and this is why not: _please\r\n      replace this line with details on why this change doesn't need to be\r\n      shared_\r\n\r\n## [optional] Are there any post deployment tasks we need to perform?\r\n\r\n## [optional] What gif best describes this PR or how it makes you feel?\r\n\r\n![moderators keeping abuse in check](https://user-images.githubusercontent.com/1237369/110995621-485afc00-8340-11eb-9607-88c3d3e1f351.gif)\r\n","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/12983/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/forem/forem/issues/12983/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4465848767,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQ0NDY1ODQ4NzY3","url":"https://api.github.com/repos/forem/forem/issues/events/4465848767","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2021-03-16T17:06:56Z","assignee":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":4465849641,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ0NjU4NDk2NDE=","url":"https://api.github.com/repos/forem/forem/issues/events/4465849641","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-03-16T17:07:05Z","label":{"name":"Forem team","color":"D4C5F9"},"performed_via_github_app":null},{"id":4465862083,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ0NjU4NjIwODM=","url":"https://api.github.com/repos/forem/forem/issues/events/4465862083","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4d304b32b9332539fd141639dcf0c9c1996d7e37","commit_url":"https://api.github.com/repos/forem/forem/commits/4d304b32b9332539fd141639dcf0c9c1996d7e37","created_at":"2021-03-16T17:09:33Z","performed_via_github_app":null},{"actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T17:09:50Z","updated_at":"2021-03-16T17:09:50Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/forem/forem/issues/13009","repository_url":"https://api.github.com/repos/forem/forem","labels_url":"https://api.github.com/repos/forem/forem/issues/13009/labels{/name}","comments_url":"https://api.github.com/repos/forem/forem/issues/13009/comments","events_url":"https://api.github.com/repos/forem/forem/issues/13009/events","html_url":"https://github.com/forem/forem/pull/13009","id":833024773,"node_id":"MDExOlB1bGxSZXF1ZXN0NTk0MDkyNzY5","number":13009,"title":"When updating article scores, use new score for blackbox","user":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1123882148,"node_id":"MDU6TGFiZWwxMTIzODgyMTQ4","url":"https://api.github.com/repos/forem/forem/labels/PR:%20merged","name":"PR: merged","color":"6a737d","default":false,"description":"bot applied label for PR's that are merged"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-03-16T17:09:50Z","updated_at":"2022-07-06T22:21:00Z","closed_at":"2021-03-18T19:20:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":73648678,"node_id":"MDEwOlJlcG9zaXRvcnk3MzY0ODY3OA==","name":"forem","full_name":"forem/forem","private":false,"owner":{"login":"forem","id":65030610,"node_id":"MDEyOk9yZ2FuaXphdGlvbjY1MDMwNjEw","avatar_url":"https://avatars.githubusercontent.com/u/65030610?v=4","gravatar_id":"","url":"https://api.github.com/users/forem","html_url":"https://github.com/forem","followers_url":"https://api.github.com/users/forem/followers","following_url":"https://api.github.com/users/forem/following{/other_user}","gists_url":"https://api.github.com/users/forem/gists{/gist_id}","starred_url":"https://api.github.com/users/forem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/forem/subscriptions","organizations_url":"https://api.github.com/users/forem/orgs","repos_url":"https://api.github.com/users/forem/repos","events_url":"https://api.github.com/users/forem/events{/privacy}","received_events_url":"https://api.github.com/users/forem/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/forem/forem","description":"For empowering community ðŸŒ±","fork":false,"url":"https://api.github.com/repos/forem/forem","forks_url":"https://api.github.com/repos/forem/forem/forks","keys_url":"https://api.github.com/repos/forem/forem/keys{/key_id}","collaborators_url":"https://api.github.com/repos/forem/forem/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/forem/forem/teams","hooks_url":"https://api.github.com/repos/forem/forem/hooks","issue_events_url":"https://api.github.com/repos/forem/forem/issues/events{/number}","events_url":"https://api.github.com/repos/forem/forem/events","assignees_url":"https://api.github.com/repos/forem/forem/assignees{/user}","branches_url":"https://api.github.com/repos/forem/forem/branches{/branch}","tags_url":"https://api.github.com/repos/forem/forem/tags","blobs_url":"https://api.github.com/repos/forem/forem/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/forem/forem/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/forem/forem/git/refs{/sha}","trees_url":"https://api.github.com/repos/forem/forem/git/trees{/sha}","statuses_url":"https://api.github.com/repos/forem/forem/statuses/{sha}","languages_url":"https://api.github.com/repos/forem/forem/languages","stargazers_url":"https://api.github.com/repos/forem/forem/stargazers","contributors_url":"https://api.github.com/repos/forem/forem/contributors","subscribers_url":"https://api.github.com/repos/forem/forem/subscribers","subscription_url":"https://api.github.com/repos/forem/forem/subscription","commits_url":"https://api.github.com/repos/forem/forem/commits{/sha}","git_commits_url":"https://api.github.com/repos/forem/forem/git/commits{/sha}","comments_url":"https://api.github.com/repos/forem/forem/comments{/number}","issue_comment_url":"https://api.github.com/repos/forem/forem/issues/comments{/number}","contents_url":"https://api.github.com/repos/forem/forem/contents/{+path}","compare_url":"https://api.github.com/repos/forem/forem/compare/{base}...{head}","merges_url":"https://api.github.com/repos/forem/forem/merges","archive_url":"https://api.github.com/repos/forem/forem/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/forem/forem/downloads","issues_url":"https://api.github.com/repos/forem/forem/issues{/number}","pulls_url":"https://api.github.com/repos/forem/forem/pulls{/number}","milestones_url":"https://api.github.com/repos/forem/forem/milestones{/number}","notifications_url":"https://api.github.com/repos/forem/forem/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/forem/forem/labels{/name}","releases_url":"https://api.github.com/repos/forem/forem/releases{/id}","deployments_url":"https://api.github.com/repos/forem/forem/deployments","created_at":"2016-11-13T23:02:13Z","updated_at":"2025-11-10T03:30:54Z","pushed_at":"2025-11-08T23:08:51Z","git_url":"git://github.com/forem/forem.git","ssh_url":"git@github.com:forem/forem.git","clone_url":"https://github.com/forem/forem.git","svn_url":"https://github.com/forem/forem","homepage":"https://forem.com","size":1724987,"stargazers_count":22508,"watchers_count":22508,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4150,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":606,"license":{"key":"agpl-3.0","name":"GNU Affero General Public License v3.0","spdx_id":"AGPL-3.0","url":"https://api.github.com/licenses/agpl-3.0","node_id":"MDc6TGljZW5zZTE="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["community","discussion","feedback","hacktoberfest","open-source","rails","ruby"],"visibility":"public","forks":4150,"open_issues":606,"watchers":22508,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/forem/forem/pulls/13009","html_url":"https://github.com/forem/forem/pull/13009","diff_url":"https://github.com/forem/forem/pull/13009.diff","patch_url":"https://github.com/forem/forem/pull/13009.patch","merged_at":"2021-03-18T19:20:28Z"},"body":"\r\n## What type of PR is this? (check all applicable)\r\n\r\n- [ ] Refactor\r\n- [ ] Feature\r\n- [x] Bug Fix\r\n- [ ] Optimization\r\n- [ ] Documentation Update\r\n\r\n## Description\r\n\r\nWhen we call update_score on Articles, we want to mutate the instance before calling the blackbox methods, since the calculations there use `article.score` as input. Saving `self.score=` before then ensures the newly calculated value is factored in to the hotness and spaminess ratings being persisted.\r\n\r\nFixes #13008\r\n\r\n## Related Tickets & Documents\r\n\r\n\r\n\r\n## QA Instructions, Screenshots, Recordings\r\n\r\n_Please replace this line with instructions on how to test your changes, as well\r\nas any relevant images for UI changes._\r\n\r\n### UI accessibility concerns?\r\n\r\n_If your PR includes UI changes, please replace this line with details on how\r\naccessibility is impacted and tested. For more info, check out the\r\n[Forem Accessibility Docs](https://docs.forem.com/frontend/accessibility)._\r\n\r\n## Added tests?\r\n\r\n- [x] Yes\r\n- [ ] No, and this is why: _please replace this line with details on why tests\r\n      have not been included_\r\n- [ ] I need help with writing tests\r\n\r\n## [Forem core team only] How will this change be communicated?\r\n\r\n_Will this PR introduce a change that impacts Forem members or creators, the\r\ndevelopment process, or any of our internal teams? If so, please note how you\r\nwill share this change with the people who need to know about it._\r\n\r\n- [ ] I've updated the [Developer Docs](https://docs.forem.com) and/or\r\n      [Admin Guide](https://forem.gitbook.io/forem-admin-guide/), or\r\n      [Storybook](https://storybook.forem.com/) (for Crayons components)\r\n- [ ] I've updated the README or added inline documentation\r\n- [ ] I will share this change in a [Changelog](https://forem.dev/t/changelog)\r\n      or in a [forem.dev](http://forem.dev) post\r\n- [ ] I will share this change internally with the appropriate teams\r\n- [ ] I'm not sure how best to communicate this change and need help\r\n- [x] This change does not need to be communicated, and this is why not: Bugfix around behavior that was \"eventually consistent\", this only impacts the ratings on articles when they're rescored, subsequent rescorings would have corrected and stabilized on the right values.\r\n\r\n## [optional] Are there any post deployment tasks we need to perform?\r\n\r\nNone\r\n\r\n## [optional] What gif best describes this PR or how it makes you feel?\r\n\r\n![old caclulator](https://user-images.githubusercontent.com/1237369/111351189-ea385c80-8650-11eb-9384-c4d5a89a5c7c.png)\r\n","reactions":{"url":"https://api.github.com/repos/forem/forem/issues/13009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/forem/forem/issues/13009/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4470741292,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ0NzA3NDEyOTI=","url":"https://api.github.com/repos/forem/forem/issues/events/4470741292","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a5851c68fab7f6694fb603c3e159cb4bc9fc28a0","commit_url":"https://api.github.com/repos/forem/forem/commits/a5851c68fab7f6694fb603c3e159cb4bc9fc28a0","created_at":"2021-03-17T14:53:03Z","performed_via_github_app":null},{"id":4478146354,"node_id":"MDExOkNsb3NlZEV2ZW50NDQ3ODE0NjM1NA==","url":"https://api.github.com/repos/forem/forem/issues/events/4478146354","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-03-18T19:20:28Z","state_reason":null,"performed_via_github_app":null},{"id":4478146523,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ0NzgxNDY1MjM=","url":"https://api.github.com/repos/forem/forem/issues/events/4478146523","actor":{"login":"djuber","id":1237369,"node_id":"MDQ6VXNlcjEyMzczNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1237369?v=4","gravatar_id":"","url":"https://api.github.com/users/djuber","html_url":"https://github.com/djuber","followers_url":"https://api.github.com/users/djuber/followers","following_url":"https://api.github.com/users/djuber/following{/other_user}","gists_url":"https://api.github.com/users/djuber/gists{/gist_id}","starred_url":"https://api.github.com/users/djuber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djuber/subscriptions","organizations_url":"https://api.github.com/users/djuber/orgs","repos_url":"https://api.github.com/users/djuber/repos","events_url":"https://api.github.com/users/djuber/events{/privacy}","received_events_url":"https://api.github.com/users/djuber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d6b4e831906bb9ec3cdeab8aec30f70a26fbee03","commit_url":"https://api.github.com/repos/forem/forem/commits/d6b4e831906bb9ec3cdeab8aec30f70a26fbee03","created_at":"2021-03-18T19:20:30Z","performed_via_github_app":null}]