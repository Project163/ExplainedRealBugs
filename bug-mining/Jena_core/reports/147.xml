<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:58:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JENA-1941] Parsed query cannot get serialized</title>
                <link>https://issues.apache.org/jira/browse/JENA-1941</link>
                <project id="12311220" key="JENA">Apache Jena</project>
                    <description>&lt;p&gt;The following query can be parsed, but cannot be serialized back:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.jena.query.Query;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.jena.query.QueryFactory;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MinimalTest {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryString = &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT ?a WHERE { &amp;lt;%s&amp;gt; &amp;lt;http:&lt;span class=&quot;code-comment&quot;&gt;//ex.com&amp;gt; &amp;lt;http://ex.com&amp;gt; }&quot;&lt;/span&gt;;
&lt;/span&gt;		Query q = QueryFactory.create(queryString);
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; serialized = q.serialize();
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(serialized);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.StringIndexOutOfBoundsException: begin 0, end 51, length 50
	at java.base/java.lang.String.checkBoundsBeginEnd(String.java:3756)
	at java.base/java.lang.String.substring(String.java:1902)
	at org.apache.jena.shared.impl.PrefixMappingImpl.qnameFor(PrefixMappingImpl.java:235)
	at org.apache.jena.sparql.util.FmtUtils.prefixFor(FmtUtils.java:494)
	at org.apache.jena.sparql.util.FmtUtils.stringForURI(FmtUtils.java:448)
	at org.apache.jena.sparql.util.FmtUtils.stringForURI(FmtUtils.java:431)
	at org.apache.jena.sparql.util.FmtUtils.stringForNode(FmtUtils.java:374)
	at org.apache.jena.sparql.util.FmtUtils.stringForNode(FmtUtils.java:348)
	at org.apache.jena.sparql.serializer.FormatterBase.slotToString(FormatterBase.java:57)
	at org.apache.jena.sparql.serializer.FormatterElement.setWidths(FormatterElement.java:615)
	at org.apache.jena.sparql.serializer.FormatterElement.formatTriples(FormatterElement.java:503)
	at org.apache.jena.sparql.serializer.FormatterElement.flush(FormatterElement.java:558)
	at org.apache.jena.sparql.serializer.FormatterElement.visit(FormatterElement.java:165)
	at org.apache.jena.sparql.syntax.ElementPathBlock.visit(ElementPathBlock.java:94)
	at org.apache.jena.sparql.serializer.FormatterElement.visit(FormatterElement.java:321)
	at org.apache.jena.sparql.syntax.ElementGroup.visit(ElementGroup.java:120)
	at org.apache.jena.sparql.serializer.FormatterElement.visitAsGroup(FormatterElement.java:453)
	at org.apache.jena.sparql.serializer.QuerySerializer.visitQueryPattern(QuerySerializer.java:207)
	at org.apache.jena.query.Query.visit(Query.java:770)
	at org.apache.jena.query.Query.serialize(Query.java:928)
	at org.apache.jena.query.Query.serialize(Query.java:905)
	at org.apache.jena.query.Query.serialize(Query.java:895)
	at org.apache.jena.query.Query.serialize(Query.java:856)
	at MinimalTest.main(MinimalTest.java:10)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not entirely sure whether it is &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The query which is invalid, in which case there is a bug in the parser&lt;/li&gt;
	&lt;li&gt;The serialization which should not fail, in which case the serializer has a bug.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;p&gt;Oracle&#160;jdk-14.0.1&lt;/p&gt;</environment>
        <key id="13320238">JENA-1941</key>
            <summary>Parsed query cannot get serialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andy">Andy Seaborne</assignee>
                                    <reporter username="michaelcochez">Michael Cochez</reporter>
                        <labels>
                            <label>Serializer</label>
                            <label>parser</label>
                    </labels>
                <created>Thu, 30 Jul 2020 16:54:57 +0000</created>
                <updated>Tue, 1 Dec 2020 14:32:01 +0000</updated>
                            <resolved>Mon, 10 Aug 2020 13:09:31 +0000</resolved>
                                    <version>Jena 3.16.0</version>
                                    <fixVersion>Jena 3.17.0</fixVersion>
                                    <component>ARQ</component>
                    <component>Jena</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17169278" author="andy.seaborne" created="Sat, 1 Aug 2020 11:18:34 +0000"  >&lt;p&gt;Ho &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michaelcochez&quot; class=&quot;user-hover&quot; rel=&quot;michaelcochez&quot;&gt;michaelcochez&lt;/a&gt; - thanks for the report.&lt;/p&gt;

&lt;p&gt;There are two issues here - the illgeal relative &lt;tt&gt;&amp;lt;%s&amp;gt;&lt;/tt&gt; isn&apos;t causing a WARN message (&lt;tt&gt;&amp;lt;x:%s&amp;gt;&lt;/tt&gt; does). It should emit:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Bad IRI: &amp;lt;...%s&amp;gt; Code: 30/ILLEGAL_PERCENT_ENCODING in PATH: The host component a percent occurred without two following hexadecimal digits.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;While strictly bad syntax,i.e. error, the SPARQL parser isn&apos;t strict on URIs because the real world has bad URIs in published data. It only emits WARN and continues.&lt;/p&gt;

&lt;p&gt;In a URI &lt;tt&gt;%&lt;/tt&gt; should followed by 2 hex digits.&lt;/p&gt;

&lt;p&gt;Regardless, &lt;tt&gt;PrefixMappingImpl.qnameFor&lt;/tt&gt; should be defensive and not return an out of bounds index.&lt;/p&gt;
</comment>
                            <comment id="17174315" author="jira-bot" created="Mon, 10 Aug 2020 13:08:50 +0000"  >&lt;p&gt;Commit 1b47fefdcffeba24ec162c23a65e25518b1845c7 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=1b47fef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=1b47fef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1941&quot; title=&quot;Parsed query cannot get serialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1941&quot;&gt;&lt;del&gt;JENA-1941&lt;/del&gt;&lt;/a&gt;: Handle setBase and setPrefix in ParserBase&lt;/p&gt;</comment>
                            <comment id="17174316" author="jira-bot" created="Mon, 10 Aug 2020 13:08:51 +0000"  >&lt;p&gt;Commit e5752a427add2478cb6f0e97b3523fd129b65c2d in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=e5752a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=e5752a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1941&quot; title=&quot;Parsed query cannot get serialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1941&quot;&gt;&lt;del&gt;JENA-1941&lt;/del&gt;&lt;/a&gt;: Check BASE URI&lt;/p&gt;</comment>
                            <comment id="17174317" author="jira-bot" created="Mon, 10 Aug 2020 13:08:53 +0000"  >&lt;p&gt;Commit 9534f6b33832ccc09e6ddacfd3571ebdf5d2cf25 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=9534f6b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=9534f6b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1941&quot; title=&quot;Parsed query cannot get serialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1941&quot;&gt;&lt;del&gt;JENA-1941&lt;/del&gt;&lt;/a&gt;: Protect against bad split&lt;/p&gt;</comment>
                            <comment id="17174318" author="jira-bot" created="Mon, 10 Aug 2020 13:08:54 +0000"  >&lt;p&gt;Commit 2d4dea395b453a65a6900681fd34b475c77bbb8d in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=2d4dea3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=2d4dea3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #778 from afs/jena1941-uri&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1941&quot; title=&quot;Parsed query cannot get serialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1941&quot;&gt;&lt;del&gt;JENA-1941&lt;/del&gt;&lt;/a&gt;: Handle bad BASE URI&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hcnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>