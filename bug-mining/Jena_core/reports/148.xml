<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:58:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JENA-1936] Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT</title>
                <link>https://issues.apache.org/jira/browse/JENA-1936</link>
                <project id="12311220" key="JENA">Apache Jena</project>
                    <description>&lt;p&gt;This query returns results with 3.0.1 but not with 3.16.0-SNAPSHOT:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;PREFIX cert: &amp;lt;http://www.w3.org/ns/auth/cert#&amp;gt;

SELECT *
{
 ?webid cert:key [
 cert:modulus &quot;a0a15887e44bab6c36862c54771324604d55bda36d2c015cbad2dc6528b5c33e01103cfbeb9c8b8a22e7d74c66fc950f0f82616412fc8c5028e9384651d4f40c7c1d40c9b861191894537d719a5098c1eea5521d2273613cdd91563205fa3e25f99ecacc04824b07449087499a6a53a81a6b1d838406a97a0f7d691257fd4cd10662afbdebdbddacb9631a255930470e866949b5e8684b38d82141263f5c6c029f716a026c31f139b3f1164cfc1865283256f75cad0ee23318ca2323bc37704124f4d17f77763314c2ed92a71b2df5a960be83acb83285e1eda6bfb5af6f3f1342487ef961cc96b3680f544626f88c611fbcb2e03c06b261b838f72ecac59831&quot;^^&amp;lt;http://www.w3.org/2001/XMLSchema#hexBinary&amp;gt; 
 ] .
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reproducible test case:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/namedgraph/jena-test/blob/master/src/test/java/WebIDCertTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/namedgraph/jena-test/blob/master/src/test/java/WebIDCertTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This might or might not be related to another issue that affects both 3.0.1 and 3.16.0-SNAPSHOT - it seems that&#160;&lt;tt&gt;xsd:hexBinary&lt;/tt&gt; literals are not matched in a BGP:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/namedgraph/jena-test/blob/master/src/test/java/SPARQLTest.java#L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/namedgraph/jena-test/blob/master/src/test/java/SPARQLTest.java#L55&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13315853">JENA-1936</key>
            <summary>Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andy">Andy Seaborne</assignee>
                                    <reporter username="graphity">Martynas Jusevi&#269;ius</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2020 10:00:16 +0000</created>
                <updated>Tue, 1 Dec 2020 14:32:20 +0000</updated>
                            <resolved>Fri, 28 Aug 2020 16:45:15 +0000</resolved>
                                    <version>Jena 3.16.0</version>
                                    <fixVersion>Jena 3.17.0</fixVersion>
                                    <component>ARQ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17154956" author="graphity" created="Thu, 9 Jul 2020 21:55:11 +0000"  >&lt;p&gt;I&apos;m walking in the dark here, not familiar with Jena&apos;s query execution internals at all, but while debugging the test case on 3.16.0-SNAPSHOT I get to this point:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/jena/blob/master/jena-core/src/main/java/org/apache/jena/mem/NodeToTriplesMapMem.java#L129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jena/blob/master/jena-core/src/main/java/org/apache/jena/mem/NodeToTriplesMapMem.java#L129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;where I can watch the&#160;&lt;tt&gt;Node index&lt;/tt&gt; value being &lt;tt&gt;&quot;a0&quot;^^&lt;a href=&quot;http://www.w3.org/2001/XMLSchema#hexBinary&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2001/XMLSchema#hexBinary&lt;/a&gt;&lt;/tt&gt;, but the &lt;tt&gt;bunchMap.get( indexValue )&lt;/tt&gt; call returns &lt;tt&gt;null&lt;/tt&gt; after which the execution starts closing down and eventually &lt;tt&gt;resultSet.hasNext()&lt;/tt&gt; returns &lt;tt&gt;false&lt;/tt&gt;. It looks like if &lt;tt&gt;bunchMap.get( indexValue )&lt;/tt&gt; returned a value, there would be a triple match and I&apos;m guessing this would lead to a result being returned.&lt;/p&gt;</comment>
                            <comment id="17154961" author="graphity" created="Thu, 9 Jul 2020 22:14:13 +0000"  >&lt;p&gt;The &lt;tt&gt;Object indexValue&lt;/tt&gt; equals -96 which is decoded from &lt;tt&gt;&quot;a0&quot;&lt;/tt&gt;&#160;by the Xerces&apos;&#160;&lt;tt&gt;HexBin.decode()&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="17155286" author="graphity" created="Fri, 10 Jul 2020 09:24:42 +0000"  >&lt;p&gt;What happens with 3.0.1 is that &lt;tt&gt;&quot;a0&quot;^^xsd:hexBinary&lt;/tt&gt; value is passed to that &lt;tt&gt;iterator()&lt;/tt&gt; method as the &lt;tt&gt;Node n3&lt;/tt&gt; argument, rather than&#160;as&#160;&lt;tt&gt;Node index&lt;/tt&gt; as with 3.16.0-SNAPSHOT. &lt;tt&gt;Node index&lt;/tt&gt; is instead the &lt;tt&gt;Node_Blank&lt;/tt&gt;. Subsequently &lt;tt&gt;bunchMap.get()&lt;/tt&gt; returns a &lt;tt&gt;TripleBunch&lt;/tt&gt; successfully.&lt;/p&gt;

&lt;p&gt;So that is one clear difference I&apos;ve discovered &#8211; arguments passed to&#160; &lt;tt&gt;NodeToTriplesMapMem.iterator( Node index, Node n2, Node n3 )&lt;/tt&gt; in a different order, which leads to different &lt;tt&gt;bunchMap.get( indexValue )&lt;/tt&gt; results.&lt;/p&gt;</comment>
                            <comment id="17155471" author="andy.seaborne" created="Fri, 10 Jul 2020 13:24:20 +0000"  >&lt;p&gt;SPARQL isn&apos;t a factor though I guess the execution order was different in 3.0.1, but I can&apos;t remember why that might be.&lt;/p&gt;

&lt;p&gt;The value if hexBinary or base64binary is a &lt;tt&gt;byte[]&lt;/tt&gt; and two &lt;tt&gt;byte[]&lt;/tt&gt; with the same bytes are not &lt;tt&gt;equals&lt;/tt&gt;. For every other datatype the value is value-equality. &lt;/p&gt;

&lt;p&gt;For nodes which do not conform to the lexical space of the datatype, the index is the lexical form (so &apos;A&apos; works). &lt;/p&gt;

&lt;p&gt;This is only about default graphmem. All other storage graphs are term-based. (And the command line SPARQL query tool uses &lt;tt&gt;DatasetGraphInMemory&lt;/tt&gt;.)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    static
    public void binary() {
        String DT = &quot;hexBinary&quot;;
        Node s = SSE.parseNode(&quot;:s&quot;);
        Node p = SSE.parseNode(&quot;:p&quot;);
        Node n1 = SSE.parseNode(&quot;&apos;&apos;^^xsd:&quot;+DT);
        Node n2 = SSE.parseNode(&quot;&apos;&apos;^^xsd:&quot;+DT);
        Graph graph = GraphFactory.createDefaultGraph();
        //Graph graph = DatasetFactory.createTxnMem().getDefaultModel().getGraph();
        graph.add(Triple.create(s, p, n1));

        // find will choose the o index if object set or if predicate-object set.

        System.out.println(&quot;? ? ?  :: &quot;+graph.find(null, null, null).toList());
        System.out.println(&quot;? ? n1 :: &quot;+graph.find(null, null, n1).toList());
        System.out.println(&quot;? ? n2 :: &quot;+graph.find(null, null, n2).toList());

        System.out.println(&quot;? p n1 :: &quot;+graph.find(null, p, n1).toList());
        System.out.println(&quot;? p n2 :: &quot;+graph.find(null, p, n2).toList());
        // Subject set - will use subject index and succeed.
//        System.out.println(&quot;s ? n1 :: &quot;+graph.find(s, null, n1).toList());
//        System.out.println(&quot;s ? n2 :: &quot;+graph.find(s, null, n2).toList());
//        System.out.println(&quot;s p n1 :: &quot;+graph.find(s, p, n1).toList());
//        System.out.println(&quot;s p n2 :: &quot;+graph.find(s, p, n2).toList());
    }
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17155709" author="graphity" created="Fri, 10 Jul 2020 20:19:25 +0000"  >&lt;p&gt;I&apos;m not quite sure - are you saying you&apos;ve identified the problem? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;And it&apos;s in the in-memory storage and not in SPARQL execution?&lt;/p&gt;</comment>
                            <comment id="17155932" author="andy.seaborne" created="Sat, 11 Jul 2020 09:35:33 +0000"  >&lt;p&gt;The behaviour illustrated above would explain it; where n1 is the data node and n2 the pattern node, it doesn&apos;t match for graphmem. Presumably &quot;a0&quot; did not work.&lt;/p&gt;

&lt;p&gt;Note the &quot;wellformed&quot; at&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/jena/blob/master/jena-core/src/main/java/org/apache/jena/graph/impl/LiteralLabelImpl.java#L311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jena/blob/master/jena-core/src/main/java/org/apache/jena/graph/impl/LiteralLabelImpl.java#L311&lt;/a&gt;&lt;br/&gt;
which explains &quot;A&quot; working. But the fix would be elsewhere, maybe according to the TODO at line 308 in some way, but that may be too large if done for all datatypes.&lt;/p&gt;

&lt;p&gt;And the command line does not use graphmem these days.&lt;/p&gt;</comment>
                            <comment id="17178458" author="graphity" created="Sun, 16 Aug 2020 11:25:53 +0000"  >&lt;p&gt;So there&apos;s no quick fix here or is it just a matter of priorities?&lt;/p&gt;

&lt;p&gt;I&apos;m using &lt;tt&gt;FILTER (?certMod = ?mod)&lt;/tt&gt; as a workaround, but it&apos;s not as elegant as it used to be.&lt;/p&gt;</comment>
                            <comment id="17186668" author="jira-bot" created="Fri, 28 Aug 2020 16:43:28 +0000"  >&lt;p&gt;Commit 72a6ec6b26d6740f1096c521d22d33327899b084 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=72a6ec6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=72a6ec6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1936&quot; title=&quot;Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1936&quot;&gt;&lt;del&gt;JENA-1936&lt;/del&gt;&lt;/a&gt;: Value-equality indexing for binary datatypes&lt;/p&gt;</comment>
                            <comment id="17186669" author="jira-bot" created="Fri, 28 Aug 2020 16:43:30 +0000"  >&lt;p&gt;Commit fc024ee3f91c7ebca222003c7f12aa41b6382049 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=fc024ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=fc024ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #785 from afs/byte-array&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1936&quot; title=&quot;Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1936&quot;&gt;&lt;del&gt;JENA-1936&lt;/del&gt;&lt;/a&gt;: Value-equality indexing for binary datatypes&lt;/p&gt;</comment>
                            <comment id="17186672" author="jira-bot" created="Fri, 28 Aug 2020 16:43:38 +0000"  >&lt;p&gt;Commit 72a6ec6b26d6740f1096c521d22d33327899b084 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=72a6ec6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=72a6ec6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1936&quot; title=&quot;Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1936&quot;&gt;&lt;del&gt;JENA-1936&lt;/del&gt;&lt;/a&gt;: Value-equality indexing for binary datatypes&lt;/p&gt;</comment>
                            <comment id="17186673" author="jira-bot" created="Fri, 28 Aug 2020 16:43:40 +0000"  >&lt;p&gt;Commit fc024ee3f91c7ebca222003c7f12aa41b6382049 in jena&apos;s branch refs/heads/master from Andy Seaborne&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=jena.git;h=fc024ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=jena.git;h=fc024ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #785 from afs/byte-array&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1936&quot; title=&quot;Query returned results with 3.0.1, does not return with 3.16.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1936&quot;&gt;&lt;del&gt;JENA-1936&lt;/del&gt;&lt;/a&gt;: Value-equality indexing for binary datatypes&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0glm8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>