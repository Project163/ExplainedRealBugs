<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:57:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JENA-362] model.listStatements(s,p,o,lang) has problems when o or lang is null</title>
                <link>https://issues.apache.org/jira/browse/JENA-362</link>
                <project id="12311220" key="JENA">Apache Jena</project>
                    <description>&lt;p&gt;1) model.listStatements(s,p,null,lang) doesn&apos;t filter on lang param&lt;br/&gt;
2) model.listStatements(s,p,o,null) only returns statements whose object has lang &quot;&quot; (when o != null)&lt;/p&gt;

&lt;p&gt;TEST 1&lt;br/&gt;
import org.junit.Test;&lt;br/&gt;
import com.hp.hpl.jena.rdf.model.*;&lt;br/&gt;
public class LstStmt1 {&lt;br/&gt;
	@Test&lt;br/&gt;
	public final void test() {&lt;br/&gt;
		Model m = ModelFactory.createDefaultModel();&lt;br/&gt;
		Resource s = m.createResource(&quot;http://www.a.com/s&quot;);&lt;br/&gt;
		Property p = m.createProperty(&quot;http://www.a.com/p&quot;);&lt;/p&gt;

&lt;p&gt;		m.add(s,p,m.createResource(&quot;http://www.a.com/o&quot;));&lt;br/&gt;
		m.add(s,p,&quot;texte&quot;,&quot;fr&quot;);&lt;br/&gt;
		m.add(s,p,&quot;text&quot;,&quot;en&quot;);&lt;/p&gt;

&lt;p&gt;		StmtIterator it = m.listStatements(s, p, null,&quot;en&quot;);&lt;br/&gt;
		// list all the statements - not what one can expect&lt;br/&gt;
		for (;it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;
{
			System.out.println(it.next());
		}&lt;br/&gt;
	}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
TEST2&lt;br/&gt;
&lt;br/&gt;
public class LstStmt2 {&lt;br/&gt;
	@Test&lt;br/&gt;
	public final void test() {&lt;br/&gt;
		Model m = ModelFactory.createDefaultModel();&lt;br/&gt;
		Resource s = m.createResource(&quot;http://www.a.com/s&quot;);&lt;br/&gt;
		Property p = m.createProperty(&quot;http://www.a.com/p&quot;);&lt;br/&gt;
&lt;br/&gt;
		m.add(s,p,&quot;text&quot;,&quot;en&quot;);&lt;br/&gt;
		m.add(s,p,&quot;text&quot;);&lt;br/&gt;
		&lt;br/&gt;
		StmtIterator it = m.listStatements(s, p,&quot;text&quot;,null);&lt;br/&gt;
		// should list the 2 statements, but doesn&apos;t: only the one without lang&lt;br/&gt;
		for (;it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {			System.out.println(it.next());		}
&lt;p&gt;	}&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12622998">JENA-362</key>
            <summary>model.listStatements(s,p,o,lang) has problems when o or lang is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andy">Andy Seaborne</assignee>
                                    <reporter username="fps61">Fran&#231;ois-Paul Servant</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Dec 2012 01:02:04 +0000</created>
                <updated>Sat, 19 Sep 2015 00:26:40 +0000</updated>
                            <resolved>Wed, 12 Dec 2012 11:07:02 +0000</resolved>
                                    <version>Jena 2.7.4</version>
                                    <fixVersion>Jena 2.10.0</fixVersion>
                                    <component>Jena</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13526951" author="fps61" created="Sat, 8 Dec 2012 01:09:44 +0000"  >&lt;p&gt;Here&apos;s a modification to com.hp.hpl.jena.rdf.model.impl.ModelCom that seems to patch the problem:&lt;/p&gt;


&lt;p&gt;    @Override&lt;br/&gt;
    public StmtIterator listStatements( Resource S, Property P, String O, String L ) {&lt;br/&gt;
// these 2 lines are the code of jena 2.7.4&lt;br/&gt;
//        return O == null ? listStatements(S, P, Node.ANY) &lt;br/&gt;
//                :  listStatements( S, P, Node.createLiteral( O, L, false ) ); &lt;br/&gt;
    	if (O != null) &lt;/p&gt;
{
    		// this is not OK when L is null: returns only the statements whose lang is &quot;&quot;
    		// return listStatements( S, P, Node.createLiteral( O, L, false ) );
    		if (L != null) return listStatements( S, P, Node.createLiteral( O, L, false ) );
    		// there&apos;s maybe a better way!
    		return new StringFilteredStmtIterator(O, listStatements(S, P, Node.ANY));
    	}
&lt;p&gt; else &lt;/p&gt;
{
    		return new LangFilteredStmtIterator(L, listStatements(S, P, Node.ANY));
    	}
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    private class StringFilteredStmtIterator extends FilterKeepIterator&amp;lt;Statement&amp;gt; implements StmtIterator {&lt;br/&gt;
	    public StringFilteredStmtIterator(final String str, Iterator&amp;lt;Statement&amp;gt; it ) {&lt;br/&gt;
	    	super(&lt;br/&gt;
	    			new Filter&amp;lt;Statement&amp;gt;() {&lt;br/&gt;
	      				@Override public boolean accept(Statement s) {&lt;br/&gt;
	      					RDFNode o = s.getObject();&lt;br/&gt;
	      					if (o instanceof Literal) &lt;/p&gt;
{
	      						if (str == null) return true; // should not happen
	      						return (str.equals(((Literal) o).getString()));
	      					}
&lt;p&gt; &lt;br/&gt;
	      					return false;&lt;br/&gt;
	      				}&lt;br/&gt;
	          }, &lt;br/&gt;
	          it );&lt;br/&gt;
	    }&lt;br/&gt;
	    public Statement nextStatement() &lt;/p&gt;
{ return next(); }&lt;br/&gt;
    }&lt;br/&gt;
    &lt;br/&gt;
    private class LangFilteredStmtIterator extends FilterKeepIterator&amp;lt;Statement&amp;gt; implements StmtIterator {&lt;br/&gt;
	    public LangFilteredStmtIterator(final String l, Iterator&amp;lt;Statement&amp;gt; it ) {&lt;br/&gt;
	    	super(&lt;br/&gt;
	    			new Filter&amp;lt;Statement&amp;gt;() {&lt;br/&gt;
	      				@Override public boolean accept(Statement s) {&lt;br/&gt;
	      					RDFNode o = s.getObject();&lt;br/&gt;
	      					if (o instanceof Literal) {
	      						if (l == null) return true;
	      						return (l.equals(((Literal) o).getLanguage()));
	      					} &lt;br/&gt;
	      					return false;&lt;br/&gt;
	      				}&lt;br/&gt;
	          }, &lt;br/&gt;
	          it );&lt;br/&gt;
	    }&lt;br/&gt;
	    public Statement nextStatement() { return next(); }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="13526954" author="fps61" created="Sat, 8 Dec 2012 01:15:35 +0000"  >&lt;p&gt;A JUnit Test for the proposed patch&lt;/p&gt;</comment>
                            <comment id="13526955" author="fps61" created="Sat, 8 Dec 2012 01:21:20 +0000"  >&lt;p&gt;ModelCom with the proposed patch&lt;/p&gt;</comment>
                            <comment id="13529836" author="andy.seaborne" created="Wed, 12 Dec 2012 11:07:02 +0000"  >&lt;p&gt;Fixed - thanks.&lt;/p&gt;

&lt;p&gt;(Note this is in version 2.10.0)&lt;/p&gt;</comment>
                            <comment id="13529849" author="hudson" created="Wed, 12 Dec 2012 11:20:33 +0000"  >&lt;p&gt;Integrated in Jena__Development_Test #327 (See &lt;a href=&quot;https://builds.apache.org/job/Jena__Development_Test/327/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Jena__Development_Test/327/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-362&quot; title=&quot;model.listStatements(s,p,o,lang) has problems when o or lang is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-362&quot;&gt;&lt;del&gt;JENA-362&lt;/del&gt;&lt;/a&gt; : Fix listStatement(,,null,lang) (Revision 1420617)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
andy : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/jena/trunk/jena-core/ReleaseNotes.txt&lt;/li&gt;
	&lt;li&gt;/jena/trunk/jena-core/src/main/java/com/hp/hpl/jena/rdf/model/impl/ModelCom.java&lt;/li&gt;
	&lt;li&gt;/jena/trunk/jena-core/src/test/java/com/hp/hpl/jena/rdf/model/test/TestListStatements.java&lt;/li&gt;
	&lt;li&gt;/jena/trunk/jena-core/src/test/java/com/hp/hpl/jena/rdf/model/test/TestPackage.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791136" author="fps61" created="Wed, 16 Sep 2015 21:23:11 +0000"  >&lt;p&gt;The proposed patch intended to correct the behavior of&lt;br/&gt;
listStatements( Resource S, Property P, String O, String L )&lt;br/&gt;
when O or L is null&lt;br/&gt;
has a &lt;b&gt;very&lt;/b&gt; poor performance when the S argument is also null.&lt;br/&gt;
It calls indeed &lt;br/&gt;
listStatements(S, P, Node.ANY)&lt;br/&gt;
and this is terrible when S is null.&lt;/p&gt;</comment>
                            <comment id="14875633" author="andy.seaborne" created="Fri, 18 Sep 2015 13:43:04 +0000"  >&lt;p&gt;The current codebase has the changes applied.  I&apos;m unclear what you are suggesting.  What could the code do? If O and S are null, calling (?,P,?) and filter for string objects is about the best that can happen as far as I am aware. Note: there is no indexing of L.&lt;/p&gt;

&lt;p&gt;Do you have a proposal relative to the current codebase? &lt;/p&gt;

&lt;p&gt;(Even when O is null, there is an implicit &quot;O is a string&quot; condition in this call.)&lt;/p&gt;</comment>
                            <comment id="14876738" author="fps61" created="Sat, 19 Sep 2015 00:26:40 +0000"  >&lt;p&gt;Hy Andy,&lt;br/&gt;
sorry with my comment, which is badly formulated. When O is null of course, there&apos;s nothing to hope. My question is about the case when L is null, and S also is. The current codebase (which includes the change that I had proposed) has a very poor performance for this case.&lt;br/&gt;
For instance, calling&lt;br/&gt;
listStatements(null, RDFS.label, &quot;some text&quot;, null)&lt;br/&gt;
is terrible when you have a large dataset.&lt;br/&gt;
It is very slow, because in this case, my code calls&lt;br/&gt;
listStatements(null, RDFS.label, Node.ANY)&lt;br/&gt;
I don&apos;t say that I have a better solution. I don&apos;t know whether there is one in the general case. The only thing that I can think of is looping over the ISO langs and call&lt;br/&gt;
listStatements(null, RDFS.label, &quot;some text&quot;, lang). If the dataset is large, that would be much faster. A triple store may provide a better implementation of the method (depending on the way it indexes the things). I don&apos;t know what TDB does internally (when indexing string literal, do the keys include the lang or not?) - but I can say that calling&lt;br/&gt;
(null,rdfs:label,&quot;some text&quot;,null)&lt;br/&gt;
on a moderately large TDB triple store is &lt;b&gt;very&lt;/b&gt; slow - so, my code is called &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Maybe, at least, the documentation about the method in question should warn about this performance issue - which is not obvious: of the 3 components of a triple, you may think that you gave 2 of them, and that this should be enough to get a fast result.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12559997" name="ListStatementTest.java" size="2285" author="fps61" created="Sat, 8 Dec 2012 01:15:35 +0000"/>
                            <attachment id="12560000" name="ModelCom.java" size="52783" author="fps61" created="Sat, 8 Dec 2012 01:21:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296588</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14ae7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233147</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>