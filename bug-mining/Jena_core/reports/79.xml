<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:57:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JENA-1140] Jena 3.0.1 model halts reading large rdf file partway through</title>
                <link>https://issues.apache.org/jira/browse/JENA-1140</link>
                <project id="12311220" key="JENA">Apache Jena</project>
                    <description>&lt;p&gt;The progress halts, or becomes slow to the point where progress is unnoticable, without execution stopping or crashing, when attempting to read a large (~250MB) turtle rdf file into a Jena model, created with org.apache.jena.rdf.model.ModelFactory.createDefaultModel(), using org.apache.jena.rdf.model.Model&apos;s read() method (tested with both the methods using String url and InputStream in).&lt;/p&gt;

&lt;p&gt;The progress will continue until the process uses 1-1.5GB RAM, and progress halts, but execution neither stops nor crashes. The code on the bottom displays the behaviour with a progress bar for the file being read.&lt;/p&gt;

&lt;p&gt;This has been the case for my laptop running Windows 10 using&lt;br/&gt;
Eclipse&lt;br/&gt;
Version: Mars.1 Release (4.5.1)&lt;br/&gt;
Build id: 20150924-1200&lt;/p&gt;

&lt;p&gt;My desktop running Windows 7 using &lt;br/&gt;
Eclipse&lt;br/&gt;
Version: Kepler Service Release 2&lt;br/&gt;
Build id: 20140224-627&lt;/p&gt;

&lt;p&gt;My professor&apos;s Mac using Eclipse, however I don&apos;t know which versions.&lt;/p&gt;

&lt;p&gt;All three systems were employing Apache Jena 3.0.1, and all of them experienced the same issue.&lt;/p&gt;

&lt;p&gt;I have attempted to manually set the max heap size of the JVM by using the -Xmx3G, however the result did not change.&lt;/p&gt;

&lt;p&gt;Employing Apache Jena Version 2.7.4, and using the same resources in the com.hp.hpl package instead of org.apache fixed the problem on all three systems.&lt;/p&gt;

&lt;p&gt;Here is the java test code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReadLotsOfRDF.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.BufferedInputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.FileInputStream;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.hp.hpl.jena.rdf.model.Model;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.hp.hpl.jena.rdf.model.ModelFactory;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.swing.JFrame;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.swing.ProgressMonitorInputStream;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReadLotsOfRDF {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; java.io.IOException {
		&lt;span class=&quot;code-comment&quot;&gt;// create a test frame with a &lt;span class=&quot;code-quote&quot;&gt;&quot;press me&quot;&lt;/span&gt; button
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JFrame f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JFrame(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sample&quot;&lt;/span&gt;);


		Model m = ModelFactory.createDefaultModel();
		m.read(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(
				&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProgressMonitorInputStream(f,&lt;span class=&quot;code-quote&quot;&gt;&quot;Progress&quot;&lt;/span&gt;,
						&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;LSQ-BM.ttl&quot;&lt;/span&gt;))), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TTL&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(m.size());

	}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;LSQ-BM.ttl&quot; file can be (and was) retrieved from &lt;a href=&quot;https://drive.google.com/file/d/0B1tUDhWNTjO-UGhDTWx5U1EyWTg/view&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Eclipse on Windows 7, 8, Mac&lt;/p&gt;</environment>
        <key id="12938505">JENA-1140</key>
            <summary>Jena 3.0.1 model halts reading large rdf file partway through</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andy">Andy Seaborne</assignee>
                                    <reporter username="Manadron">H&#229;vard Wanvik Stenersen</reporter>
                        <labels>
                            <label>Model</label>
                            <label>rdf</label>
                            <label>read</label>
                            <label>slow</label>
                            <label>stop</label>
                    </labels>
                <created>Thu, 11 Feb 2016 13:19:34 +0000</created>
                <updated>Sat, 14 May 2016 09:51:30 +0000</updated>
                            <resolved>Sat, 13 Feb 2016 14:36:05 +0000</resolved>
                                    <version>Jena 3.0.1</version>
                                    <fixVersion>Jena 3.1.0</fixVersion>
                                    <component>Jena</component>
                    <component>RDF API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15144890" author="andy.seaborne" created="Fri, 12 Feb 2016 17:21:31 +0000"  >&lt;p&gt;Thank you for the complete report.&lt;/p&gt;

&lt;p&gt;There is a regression somewhere happening between v2.13.0 and v3.0.0.&lt;/p&gt;

&lt;p&gt;From an initial exploration, it does not look like it related to heap usage.&lt;/p&gt;

&lt;p&gt;Using the new transactional in-memory dataset does not show the problem so it is related to the implementation of the in-memory graph being influenced by some change made between 2.13.0 and 3.0.0.&lt;/p&gt;</comment>
                            <comment id="15145103" author="andy.seaborne" created="Fri, 12 Feb 2016 19:10:50 +0000"  >&lt;p&gt;So far:&lt;/p&gt;

&lt;p&gt;The data contains many &lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt; literals.&lt;/p&gt;

&lt;p&gt;Jena3 added value support for &lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt;. In Jena2,  &lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt; were not indexed by value, but by a placeholder &lt;tt&gt;BaseDatatype.TypedValue&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If the data is converted to use &lt;tt&gt;xsd:dateTime&lt;/tt&gt;, then it runs slowly in Jena 2.13.0.&lt;/p&gt;

&lt;p&gt;Profiling is currently masking exactly where the additional time is going.  It may be HashCommon.findSlot, it may be XSDDatatype.equals or it may be the quality of the hash code.&lt;/p&gt;</comment>
                            <comment id="15145939" author="andy.seaborne" created="Sat, 13 Feb 2016 11:46:25 +0000"  >&lt;p&gt;The problem seems to be the quality of the hash code. The attached data (&lt;tt&gt;data-500k&lt;/tt&gt;) is an extract from the report - it is all the triples with an &lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt;, with the datatype changed to &lt;tt&gt;xsd:dateTime&lt;/tt&gt;. It is slow on Jena2 as well as Jena3, taking about 300s to load. &lt;/p&gt;

&lt;p&gt;A 250K dataset was fast with the old code.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt; loads fast on 2.13.0 because &lt;tt&gt;xsd:dateTimeStamp&lt;/tt&gt; is not indexed by value.&lt;/p&gt;

&lt;p&gt;With the improved hash code, the load time is 2.6s (2.13.0 or 3.0.1).&lt;/p&gt;

&lt;p&gt;The original code (below) generates close hash codes for close XSD dateTimes and XSD dateTimeStamps (Jena 3 onwards).&lt;/p&gt;

&lt;p&gt;The bad hash code leads to hash table collision and long probe chains due to slots already in-use. The hash table is a closed hash table (AKA open addressing) with linear probing.&lt;/p&gt;

&lt;p&gt;This was the hash code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Override
    public int hashCode() {
        int hash = 0;
        for ( int aData : data )
        {
            hash = ( hash &amp;lt;&amp;lt; 1 ) ^ aData;
        }
        return hash;
    }    
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&quot;&amp;lt;&amp;lt; 1&quot; does not work well : datetimes that are close in value, lead to close has codes. Array items that are close by index need to be spread out more.&lt;/p&gt;

&lt;p&gt;Changing to &quot;&amp;lt;&amp;lt; 3&quot; worked slightly better than &quot;&amp;lt;&amp;lt; 2&quot;.  &quot;&amp;lt;&amp;lt; 4&quot; did not make much difference.&lt;/p&gt;

&lt;p&gt;Changing the order so the hashing mixing date and time slots made &quot;&amp;lt;&amp;lt; 2&quot; work as well as &quot;&amp;lt;&amp;lt; 3&quot; (e.g. hash in the order (constants from &lt;a href=&quot;https://github.com/apache/jena/blob/master/jena-core/src/main/java/org/apache/jena/datatypes/xsd/AbstractDateTime.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AbstractDateTime&lt;/a&gt;) CY=0, h=, M, m, D, s ....). The key is that, for example, m and s are 2 slot hashs apart i.e. &quot;&amp;lt;&amp;lt;4&quot; when the &quot;&amp;lt;&amp;lt;2&quot; is used.&lt;/p&gt;

&lt;p&gt; Using the Eclipse generated hashCode works just as well and is probably better researched. This is the fixed committed.&lt;/p&gt;</comment>
                            <comment id="15145940" author="andy.seaborne" created="Sat, 13 Feb 2016 11:47:06 +0000"  >&lt;p&gt;Data extract.&lt;/p&gt;</comment>
                            <comment id="15145998" author="jira-bot" created="Sat, 13 Feb 2016 14:35:45 +0000"  >&lt;p&gt;Commit 8c475680b3d85520e41b7eb78418e9514fb85eef in jena&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andy.seaborne&quot; class=&quot;user-hover&quot; rel=&quot;andy.seaborne&quot;&gt;andy.seaborne&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=jena.git;h=8c47568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=jena.git;h=8c47568&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JENA-1140&quot; title=&quot;Jena 3.0.1 model halts reading large rdf file partway through&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JENA-1140&quot;&gt;&lt;del&gt;JENA-1140&lt;/del&gt;&lt;/a&gt;: Better hash code for AbstractDateTime.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12787800" name="data-500K.nt.gz" size="4250331" author="andy" created="Sat, 13 Feb 2016 11:47:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2spzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>