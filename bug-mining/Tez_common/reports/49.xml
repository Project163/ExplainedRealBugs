<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEZ-3405] Support ability for AM to kill itself if there is no client heartbeating to it</title>
                <link>https://issues.apache.org/jira/browse/TEZ-3405</link>
                <project id="12314426" key="TEZ">Apache Tez</project>
                    <description>&lt;p&gt;HiveServer2 optionally maintains a pool of AMs in either Tez or LLAP mode. This is done to amortize the cost of launching a Tez session.&lt;/p&gt;

&lt;p&gt;We also try in a shutdown hook to kill all these AMs when HS2 goes down. However, there are cases where HS2 doesn&apos;t get the chance to kill these AMs before it goes away. As a result these zombie AMs hang around until the timeout kicks in.&lt;/p&gt;

&lt;p&gt;The trouble with the timeout is that we have to set it fairly high. Otherwise the benefit of having pre-launched AMs obviously goes away (in a lightly loaded cluster).&lt;/p&gt;

&lt;p&gt;So, if people kill/restart HS2 they often times run into situations where the cluster/queue doesn&apos;t have any more capacity for AMs. They either have to manually kill the zombies or wait.&lt;/p&gt;

&lt;p&gt;The request is therefore for Tez to maintain a heartbeat to the client. If the client goes away the AM should exit. That way we can keep the AMs alive for a long time regardless of activity and at the same time don&apos;t have to worry about them if HS2 goes down.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12996157">TEZ-3405</key>
            <summary>Support ability for AM to kill itself if there is no client heartbeating to it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hitesh">Hitesh Shah</assignee>
                                    <reporter username="hagleitn">Gunther Hagleitner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Aug 2016 04:07:37 +0000</created>
                <updated>Tue, 22 Aug 2017 00:02:29 +0000</updated>
                            <resolved>Fri, 21 Oct 2016 22:37:46 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15416197" author="tezqa" created="Wed, 10 Aug 2016 23:29:10 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12823143/TEZ-3405.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12823143/TEZ-3405.1.patch&lt;/a&gt;&lt;br/&gt;
  against master revision b8ff941.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  master compilation may be broken.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1905//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1905//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15416321" author="tezqa" created="Thu, 11 Aug 2016 01:13:57 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12823143/TEZ-3405.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12823143/TEZ-3405.1.patch&lt;/a&gt;&lt;br/&gt;
  against master revision b8ff941.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 4 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//artifact/patchprocess/newPatchFindbugsWarningstez-api.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//artifact/patchprocess/newPatchFindbugsWarningstez-api.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//artifact/patchprocess/newPatchFindbugsWarningstez-dag.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//artifact/patchprocess/newPatchFindbugsWarningstez-dag.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1906//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15418091" author="tezqa" created="Thu, 11 Aug 2016 23:10:43 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12823352/TEZ-3405.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12823352/TEZ-3405.2.patch&lt;/a&gt;&lt;br/&gt;
  against master revision b8ff941.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1909//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1909//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1909//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1909//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15426968" author="hitesh" created="Thu, 18 Aug 2016 18:42:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=harishjp&quot; class=&quot;user-hover&quot; rel=&quot;harishjp&quot;&gt;harishjp&lt;/a&gt; Mind doing a review? &lt;/p&gt;</comment>
                            <comment id="15427792" author="aplusplus" created="Fri, 19 Aug 2016 08:00:19 +0000"  >&lt;p&gt;The patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="15428135" author="harishjp" created="Fri, 19 Aug 2016 12:41:49 +0000"  >&lt;p&gt;Patch looks good to me. Only a couple of minor things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Should we have a minimum interval to 5 or 10s? Since we have a poll interval of 1s at the client, we could have accidental termination if the interval is too small and some calls get missed for any reason (Stop the world gc or network blips).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Can we use only one Timer object? Timer object is designed to handle multiple TimerTasks, ideally we should move to Executors#newSingleThreadScheduledExecutor which will not die if there is an exception in the Task.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15428620" author="sseth" created="Fri, 19 Aug 2016 18:44:35 +0000"  >&lt;p&gt;Bunch of comments/questions&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The findbugs-exclude in the client/AM - is this because the thread is only created after the variable is setup?&lt;/li&gt;
	&lt;li&gt;Nit: final for sessionStarted/sessionStopped&lt;/li&gt;
	&lt;li&gt;Why skip the test in local mode? (Same JVM - but do we need to special case local mode?). Don&apos;t think we&apos;ll end up with thread explosion if multiple TezClient instances are created in the same JVM.&lt;/li&gt;
	&lt;li&gt;Nit: TezConf javadoc - &quot;-1/negative values means disable&quot;&lt;/li&gt;
	&lt;li&gt;Why only in SessionMode?&lt;/li&gt;
	&lt;li&gt;pollInterval calculation can be higher than the timeout if we allow values below 1000. (some sanity checks, or a min timeout as suggested by Harish)&lt;/li&gt;
	&lt;li&gt;This can have problems with the getDagStatus(long timeout) call which waits in the AM on the single handler thread. Increasing handlers to 2 should take care of this.&lt;/li&gt;
	&lt;li&gt;Not sure exactly what happens if this connection is made right when the AM is starting up - can the client thread go into an RPC retry loop, which would then cause a timeout if the AM starts up properly? (Think this applies to submitDag as well - i.e. the waitForProxy method. Haven&apos;t seen anything like this so far)&lt;/li&gt;
	&lt;li&gt;snedAMHeartbeat - why ignore the interrupt? That can be used as a mechanism to kill a retry loop. (e.g. if clientTimeout is set to -1).&lt;/li&gt;
	&lt;li&gt;On a related note - waitForProxy likely needs to handle Interrupt status better - between loops.&lt;/li&gt;
	&lt;li&gt;debug leve if an error is encountered sending a heartbeat to the AM?&lt;/li&gt;
	&lt;li&gt;When cancelling during shutdown - is it possible to send an interrupt as well (probably easier with a SchedulerExecutor). This is in case the thread is in an RPC retry loop. (There&apos;s no guarantees that RPC retry will respect the interrupt - but may as well send it)&lt;/li&gt;
	&lt;li&gt;DAGClientHandler ctor - set time using clock, instead of System.currentMiillis? (or is the clock not available yet on the context)&lt;/li&gt;
	&lt;li&gt;The AM timer runs every second - that can be optimized to be based on the configured timeout ?&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="15431587" author="hitesh" created="Mon, 22 Aug 2016 20:44:14 +0000"  >&lt;p&gt;Comments: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should we have a minimum interval to 5 or 10s&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will change to use a minimum of 10 secs.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we use only one Timer object?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Changing to use executor. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The findbugs-exclude in the client/AM - is this because the thread is only created after the variable is setup?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes - the vars are setup in serviceStart and never modified later. Used in the timer task after initialization and not modified.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: final for sessionStarted/sessionStopped&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will fix.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why skip the test in local mode? (Same JVM - but do we need to special case local mode?). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In local mode, the same JVM is running the DAG so did not see a point of creating a timer task to monitor the process itself. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: TezConf javadoc - &quot;-1/negative values means disable&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will fix. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why only in SessionMode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Main reason - did not see a need for this functionality in non-session mode which is hardly used as far as I know. Also, it gets a bit more complex for non-session mode where the same TezClient can be used to launch multiple dags. Could be fixed in the DAGClient to set up the regular pings to AM. Have not done that as yet as the primary use-case seems session specific. Could that in a follow-up jira if this is needed. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;pollInterval calculation can be higher than the timeout if we allow values below 1000. (some sanity checks, or a min timeout as suggested by Harish)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will address by using a min. of 10 seconds. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This can have problems with the getDagStatus(long timeout) call which waits in the AM on the single handler thread. Increasing handlers to 2 should take care of this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks - missed this completely. Will fix.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not sure exactly what happens if this connection is made right when the AM is starting up - can the client thread go into an RPC retry loop, which would then cause a timeout if the AM starts up properly? (Think this applies to submitDag as well - i.e. the waitForProxy method. Haven&apos;t seen anything like this so far)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;am proxy is only created after the app registers so there should not be a retry loop on the initial start. There is an issue in case of recovery. The assumption here is that the client retry is set well enough to handle AM restart times and also the AM itself does not start its timer until the AM has fully recovered.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;snedAMHeartbeat - why ignore the interrupt? That can be used as a mechanism to kill a retry loop. (e.g. if clientTimeout is set to -1).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It ignores and stops that particular heartbeat try.  Assume session stop was invoked, by the next loop, the session would have been stopped and the timer cancelled.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;On a related note - waitForProxy likely needs to handle Interrupt status better - between loops.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Mind filing a jira with more details? &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;debug leve if an error is encountered sending a heartbeat to the AM?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For the most part, the client if actively pinging the AM for updates, will be logging errors talking to AM. Did not see a need to add more logging for an internal heartbeat ping. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When cancelling during shutdown - is it possible to send an interrupt as well (probably easier with a SchedulerExecutor). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Changing to executor and shutdownNow() which should trigger interrupts as needed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;DAGClientHandler ctor - set time using clock, instead of System.currentMiillis? (or is the clock not available yet on the context)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will look at this - forgot to fix it. Think app context was not being setup in time in local mode causing an NPE in a test.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The AM timer runs every second - that can be optimized to be based on the configured timeout ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can fix this to a max(1 sec, overall timeout/20or /50 ) ? Would that work? &lt;/p&gt;
</comment>
                            <comment id="15432097" author="hitesh" created="Tue, 23 Aug 2016 03:54:58 +0000"  >&lt;p&gt;Review comments addressed. &lt;/p&gt;</comment>
                            <comment id="15432162" author="tezqa" created="Tue, 23 Aug 2016 05:20:31 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12824981/TEZ-3405.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12824981/TEZ-3405.3.patch&lt;/a&gt;&lt;br/&gt;
  against master revision 9ca2d5b.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//artifact/patchprocess/newPatchFindbugsWarningstez-dag.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//artifact/patchprocess/newPatchFindbugsWarningstez-dag.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//artifact/patchprocess/newPatchFindbugsWarningstez-api.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//artifact/patchprocess/newPatchFindbugsWarningstez-api.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1927//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15432206" author="sseth" created="Tue, 23 Aug 2016 06:10:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could be fixed in the DAGClient to set up the regular pings to AM. Have not done that as yet as the primary use-case seems session specific. Could that in a follow-up jira if this is needed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This will get interesting with the parallel request to allow creation of a DAGClient to interact with a running DAG. Maybe we should drop non-session mode at some point.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Mind filing a jira with more details? ... waitForProxy interrupts&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Was assuming that any interaction with YARN to get the AppReport would result in an Interrupt. I don&apos;t think that actually happens - YARN throws an IOException, or YarnException - but no InterruptedException. Not sure if there&apos;s a way to detect if the YarnClient was interrupted during a request.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For the most part, the client if actively pinging the AM for updates, will be logging errors talking to AM. Did not see a need to add more logging for an internal heartbeat ping.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Think it&apos;s worth logging that an interrupt was seen or a specific exception was seen without the entire trace. At least we know if this is hit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I can fix this to a max(1 sec, overall timeout/20or /50 ) ? Would that work?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Re-scheduling based on timeout-lastPingTime gets complicated ?&lt;/p&gt;

&lt;p&gt;Haven&apos;t looked at the new patch yet. One thing from a quick look - the SchedulerExecutor could use a name, and would be better to make it a daemon.&lt;/p&gt;</comment>
                            <comment id="15433515" author="tezqa" created="Tue, 23 Aug 2016 19:58:31 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12825111/TEZ-3405.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12825111/TEZ-3405.4.patch&lt;/a&gt;&lt;br/&gt;
  against master revision 9ca2d5b.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1929//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1929//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1929//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1929//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15454804" author="sseth" created="Thu, 1 Sep 2016 08:50:53 +0000"  >&lt;p&gt;Mostly looks good. +1, after addressing a few minor comments.&lt;br/&gt;
Nit: TEZ_AM_CLIENT_HEARTBEAT_TIMEOUT_SECS_MINIMUM - Move to TezConstants?&lt;br/&gt;
Nit: Move logic from TezConfiguration to a separate helper class? TezConfiguration.java does typically serve as documentation as well.&lt;br/&gt;
Nit: Replace new TimerTask with new Runnable (TimerTask is not serving any purpose)&lt;br/&gt;
Question: The initial timer is only setup after the AM has recovered, correct?&lt;/p&gt;
</comment>
                            <comment id="15456747" author="hitesh" created="Thu, 1 Sep 2016 21:58:23 +0000"  >&lt;p&gt;Patch 5 uploaded. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: TEZ_AM_CLIENT_HEARTBEAT_TIMEOUT_SECS_MINIMUM - Move to TezConstants?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: Move logic from TezConfiguration to a separate helper class? TezConfiguration.java does typically serve as documentation as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Moved to TezCommonUtils which is tagged private. Also, moved helper function introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/TEZ-3326&quot; title=&quot;Display JVM system properties in AM and task logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TEZ-3326&quot;&gt;&lt;del&gt;TEZ-3326&lt;/del&gt;&lt;/a&gt; to this class from TezUtils ( as TezUtils is public ) \cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ebadger&quot; class=&quot;user-hover&quot; rel=&quot;ebadger&quot;&gt;ebadger&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: Replace new TimerTask with new Runnable (TimerTask is not serving any purpose)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Question: The initial timer is only setup after the AM has recovered, correct?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes - setup of timer is done in DAGAppMaster::serviceStart after all services started and the heavy lifting of recovery is done and dag has just about started running.&lt;/p&gt;
</comment>
                            <comment id="15456943" author="tezqa" created="Thu, 1 Sep 2016 23:31:48 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12826713/TEZ-3405.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12826713/TEZ-3405.5.patch&lt;/a&gt;&lt;br/&gt;
  against master revision ae98470.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1951//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1951//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1951//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1951//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15468488" author="hitesh" created="Tue, 6 Sep 2016 20:42:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; Mind doing a final review when you get a chance? &lt;/p&gt;</comment>
                            <comment id="15586778" author="hitesh" created="Tue, 18 Oct 2016 21:52:53 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt;  - please help with hopefully a final review whenever you get a chance. &lt;/p&gt;</comment>
                            <comment id="15587218" author="sseth" created="Wed, 19 Oct 2016 00:51:38 +0000"  >&lt;p&gt;+1. &lt;/p&gt;</comment>
                            <comment id="15589826" author="hitesh" created="Wed, 19 Oct 2016 20:52:34 +0000"  >&lt;p&gt;Re-based patch &lt;/p&gt;</comment>
                            <comment id="15590053" author="tezqa" created="Wed, 19 Oct 2016 22:25:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12834242/TEZ-3405.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12834242/TEZ-3405.6.patch&lt;/a&gt;&lt;br/&gt;
  against master revision 8033e3d.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The following test timeouts occurred in :&lt;br/&gt;
 org.apache.tez.test.TestTezJobs&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2048//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2048//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2048//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2048//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15593286" author="hitesh" created="Thu, 20 Oct 2016 22:57:47 +0000"  >&lt;p&gt;Re-uploading v6 as v7 to trigger build&lt;/p&gt;</comment>
                            <comment id="15593460" author="tezqa" created="Fri, 21 Oct 2016 00:20:32 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12834566/TEZ-3405.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12834566/TEZ-3405.7.patch&lt;/a&gt;&lt;br/&gt;
  against master revision ed03611.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2051//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2051//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2051//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2051//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15596568" author="hitesh" created="Fri, 21 Oct 2016 22:37:47 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt;. Committed to master. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12823143" name="TEZ-3405.1.patch" size="19549" author="hitesh" created="Wed, 10 Aug 2016 23:03:06 +0000"/>
                            <attachment id="12823352" name="TEZ-3405.2.patch" size="25464" author="hitesh" created="Thu, 11 Aug 2016 21:44:06 +0000"/>
                            <attachment id="12824981" name="TEZ-3405.3.patch" size="34933" author="hitesh" created="Tue, 23 Aug 2016 03:54:58 +0000"/>
                            <attachment id="12825111" name="TEZ-3405.4.patch" size="36013" author="hitesh" created="Tue, 23 Aug 2016 18:37:07 +0000"/>
                            <attachment id="12826713" name="TEZ-3405.5.patch" size="44993" author="hitesh" created="Thu, 1 Sep 2016 21:58:23 +0000"/>
                            <attachment id="12834242" name="TEZ-3405.6.patch" size="44735" author="hitesh" created="Wed, 19 Oct 2016 20:52:34 +0000"/>
                            <attachment id="12834566" name="TEZ-3405.7.patch" size="43960" author="hitesh" created="Thu, 20 Oct 2016 22:57:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i324hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>