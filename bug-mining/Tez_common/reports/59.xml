<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEZ-3937] Empty partition BitSet to byte[] conversion creates one extra byte in rounding error</title>
                <link>https://issues.apache.org/jira/browse/TEZ-3937</link>
                <project id="12314426" key="TEZ">Apache Tez</project>
                    <description>&lt;p&gt;Byte array length calculation is defined as (bitset.length / 8) + 1 which has off by one errors on byte boundaries. For example, BitSet of length 0 is converted to a byte array of length 1. This was introduced as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/TEZ-972&quot; title=&quot;Shuffle Phase - optimize memory usage of empty partition data in DataMovementEvent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TEZ-972&quot;&gt;&lt;del&gt;TEZ-972&lt;/del&gt;&lt;/a&gt; since BitSet.toByteArray and valueOf were not supported as Tez supported Java 6 at the time and API was introduced in Java 7.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13159794">TEZ-3937</key>
            <summary>Empty partition BitSet to byte[] conversion creates one extra byte in rounding error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeagles">Jonathan Turner Eagles</assignee>
                                    <reporter username="jeagles">Jonathan Turner Eagles</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 May 2018 18:00:09 +0000</created>
                <updated>Fri, 19 Apr 2019 19:21:06 +0000</updated>
                            <resolved>Mon, 21 May 2018 14:36:08 +0000</resolved>
                                                    <fixVersion>0.9.2</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16478011" author="tezqa" created="Wed, 16 May 2018 20:11:58 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12923740/TEZ-3937.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12923740/TEZ-3937.001.patch&lt;/a&gt;&lt;br/&gt;
  against master revision 1ae6242.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2804//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2804//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2804//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2804//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16479252" author="jlowe" created="Thu, 17 May 2018 15:52:02 +0000"  >&lt;p&gt;Thanks for the patch!&lt;/p&gt;

&lt;p&gt;I love how this drastically simplifies the code for BitSet serialization, but I do have one concern with the change.  If I&apos;m reading the code correctly, the new vesion will serialize and deserialize the bytes in the opposite order that the old code does.  I think it&apos;s fine as long as all callers are pairing these two methods together, e.g.: all calls to deserialize a BitSet are passing byte arrays that were encoded with the new encoded method.&lt;/p&gt;

&lt;p&gt;What worries me there is if a job ever ran where some Tez jars happened to be an older version before this change.  The BitSet would be deserialized mostly backwards (same order of bits within a byte but opposite byte order).  That could lead to silent dataloss since the consumer may think a partition is empty when in fact it&apos;s a completely different partition is empty, due to how shuffle interprets these BitSets.&lt;/p&gt;

&lt;p&gt;If accidental mixing of Tez jars isn&apos;t a concern I think this change is fine.  If we&apos;re mostly worried about the wasted byte when the number of bits is a multiple of 8 then I think a safer change is to fix the toByteArray method to size the destination byte array properly instead.&lt;/p&gt;</comment>
                            <comment id="16480959" author="tezqa" created="Fri, 18 May 2018 17:35:30 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12924147/TEZ-3937.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12924147/TEZ-3937.002.patch&lt;/a&gt;&lt;br/&gt;
  against master revision 1ae6242.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in :&lt;br/&gt;
                   org.apache.tez.test.TestAMRecovery&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2806//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2806//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/2806//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/2806//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16481018" author="jeagles" created="Fri, 18 May 2018 18:36:03 +0000"  >&lt;p&gt;TestAMRecovery test is failing intermittently. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlowe&quot; class=&quot;user-hover&quot; rel=&quot;jlowe&quot;&gt;jlowe&lt;/a&gt;, I have updated the patch to address the concerns listed.&lt;/p&gt;</comment>
                            <comment id="16482555" author="jlowe" created="Mon, 21 May 2018 14:31:54 +0000"  >&lt;p&gt;Thanks for updating the patch! I think this is a safer change.  The unit test failure is not related, and the test passes locally for me with the patch applied.&lt;/p&gt;

&lt;p&gt;+1 for the latest patch.  Committing this.&lt;/p&gt;</comment>
                            <comment id="16482560" author="jlowe" created="Mon, 21 May 2018 14:36:08 +0000"  >&lt;p&gt;Thanks, Jon! I committed this to master and branch-0.9.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12923740" name="TEZ-3937.001.patch" size="1958" author="jeagles" created="Wed, 16 May 2018 18:07:21 +0000"/>
                            <attachment id="12924147" name="TEZ-3937.002.patch" size="1564" author="jeagles" created="Fri, 18 May 2018 16:12:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tskv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>