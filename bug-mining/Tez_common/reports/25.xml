<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEZ-1393] user.dir should not be reset in LocalMode</title>
                <link>https://issues.apache.org/jira/browse/TEZ-1393</link>
                <project id="12314426" key="TEZ">Apache Tez</project>
                    <description>&lt;p&gt;Setting user.dir to the staging-dir has the implication of changing the root of the filesystem to the staging directory, which is application specific.&lt;/p&gt;

&lt;p&gt;If using multiple instance of LocalClient within a single JVM - this can get problematic, between multiple jobs since the CWD will change in the middle of execution - which ends up disallowing usage of relative paths.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12732800">TEZ-1393</key>
            <summary>user.dir should not be reset in LocalMode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sseth">Siddharth Seth</assignee>
                                    <reporter username="sseth">Siddharth Seth</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Aug 2014 09:49:28 +0000</created>
                <updated>Sat, 6 Sep 2014 01:36:07 +0000</updated>
                            <resolved>Tue, 12 Aug 2014 23:49:52 +0000</resolved>
                                                    <fixVersion>0.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14090554" author="sseth" created="Fri, 8 Aug 2014 09:50:57 +0000"  >&lt;p&gt;Patch to make this change. This introduces is working-directory for the AM/tasks - which under regular execution is &quot;.&quot;. In LocalMode, it&apos;s set to the location where tez sets up it&apos;s resources such as configuration, DAGPlan, etc.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeagles&quot; class=&quot;user-hover&quot; rel=&quot;jeagles&quot;&gt;jeagles&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=airbots&quot; class=&quot;user-hover&quot; rel=&quot;airbots&quot;&gt;airbots&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hitesh&quot; class=&quot;user-hover&quot; rel=&quot;hitesh&quot;&gt;hitesh&lt;/a&gt; - pleas review.&lt;/p&gt;</comment>
                            <comment id="14090671" author="airbots" created="Fri, 8 Aug 2014 11:48:57 +0000"  >&lt;p&gt;I agree that we need to change &quot;TezUtils.addUserSpecifiedTezConfiguration&quot;. As well as the staging dir. Because if there are concurrent DAGs running in local mode, it will be problematic since each DAG may create a pb file.  &lt;/p&gt;

&lt;p&gt;My question is if we hard code the working-directory to be &quot;.&quot;, we add dependency to the user current environment. I mean what if user has background programs that changing contents under &quot;.&quot;?  I think, &lt;a href=&quot;https://issues.apache.org/jira/browse/TEZ-1337&quot; title=&quot;Handling of local-dirs for Local Mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TEZ-1337&quot;&gt;TEZ-1337&lt;/a&gt; can help, I mean we read from configuration. Also the configuration is useful for us to reduce dependency on node manager configuration(nm-local.dir) for shuffle. &lt;/p&gt;

&lt;p&gt;some minor issues: &lt;br/&gt;
In DAGAppMapster first constructor (top to down), variable &quot;clock&quot; is never used; line 1468, &quot;recoveredDAGData&quot; is not necessary to be created; other warnings in related java file.&lt;/p&gt;</comment>
                            <comment id="14091115" author="jeagles" created="Fri, 8 Aug 2014 18:36:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt;, initially I looked into a ThreadLocalProperties solution but didn&apos;t have the time to test its feasibility. This technique has the added benefit that user code doesn&apos;t need to be written in this same working directory way and works for multiple LocalClients. If you want I can pursue this idea to see if it meets our criteria. It is advanced, yes, but not complicated.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/9579958/system-setproperty-used-by-a-thread-impacts-other-thread-in-communication-to-ext&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ThreadLocalProperties&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14091322" author="sseth" created="Fri, 8 Aug 2014 21:31:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Because if there are concurrent DAGs running in local mode, it will be problematic since each DAG may create a pb file.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Concurrent executions poses additional problems beyond just the staging directory and the resources localized into it. Lets address those in the concurrent execution jira - if that&apos;s required. I believe Pig has logic to effectively queue the DAGs sequentially if concurrent apps are not available (pools of some kind)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;My question is if we hard code the working-directory to be &quot;.&quot;, we add dependency to the user current environment. I mean what if user has background programs that changing contents under &quot;.&quot;? I think, &lt;a href=&quot;https://issues.apache.org/jira/browse/TEZ-1337&quot; title=&quot;Handling of local-dirs for Local Mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TEZ-1337&quot;&gt;TEZ-1337&lt;/a&gt; can help, I mean we read from configuration. Also the configuration is useful for us to reduce dependency on node manager configuration(nm-local.dir) for shuffle.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;working-directory, I think is an incorrect name - this is really a directory to allow local-mode to work without localizing files. If localization were in place, files would get localized to the working directory - and from there things should just work.&lt;br/&gt;
&quot;.&quot; is only used when running on regular clusters. Earlier we used a relative path which would inherently assume the files to be somewhere in the current working directory.&lt;br/&gt;
In terms of shuffle-handler dependencies - we need to depend on the NM-LOCAL-DIRS since that&apos;s how the ShuffleHandler works. That is not related to this change though - the local directory continues to be under the staging directory till &lt;a href=&quot;https://issues.apache.org/jira/browse/TEZ-1337&quot; title=&quot;Handling of local-dirs for Local Mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TEZ-1337&quot;&gt;TEZ-1337&lt;/a&gt; allows making that configurable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Siddharth Seth, initially I looked into a ThreadLocalProperties solution but didn&apos;t have the time to test its feasibility. This technique has the added benefit that user code doesn&apos;t need to be written in this same working directory way and works for multiple LocalClients. If you want I can pursue this idea to see if it meets our criteria. It is advanced, yes, but not complicated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Jon, I&apos;m not sure ThreadLocalProperties would work for changing user.dir. That&apos;s also used when the filesystem is &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///&lt;/a&gt;, and effectively decides where MRInput / MROutput read/write data in local mode. In terms of the local-directories itself, this is already in place. If we support localization, we&apos;ll have to look at how this needs to be fixed - since that will use the default flle:/// filesystem as well, but needs to be a directory per container. I don&apos;t think we&apos;ll be able to completely support localization though (not without large changes), since these files can be accessed anywhere in the task - and that isn&apos;t easy to control. An example here is splits being sent via HDFS - which we&apos;ll likely have to special case.&lt;/p&gt;</comment>
                            <comment id="14093067" author="hitesh" created="Mon, 11 Aug 2014 17:59:30 +0000"  >&lt;p&gt;Comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use the NM&apos;s defined env value for PWD instead of &quot;.&quot;&lt;/li&gt;
	&lt;li&gt;Should working directory be a string or a fully resolved local fs path?&lt;/li&gt;
	&lt;li&gt;Are 2 ctors needed in DAGAppMaster and TezChild? Why not fallback to &quot;PWD&quot; from env if working dir passed in is empty or null&lt;/li&gt;
	&lt;li&gt;MRRSleep - why is the change needed to set the staging dir?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14093087" author="airbots" created="Mon, 11 Aug 2014 18:11:24 +0000"  >&lt;p&gt;I suggest we clarify all types of dirs used in not only local mode but also general mode for TEZ:&lt;br/&gt;
staging dir:&lt;br/&gt;
local dirs:&lt;br/&gt;
working dirs:&lt;br/&gt;
user.dir:&lt;br/&gt;
......&lt;/p&gt;

&lt;p&gt;I am confused why we allow user to set staging dir (like in OrderedWordCount). From the system point of view, staging dir is the directory that system prepairs the user&apos;s job after user submission. It should be the same for consistency.&lt;/p&gt;</comment>
                            <comment id="14093472" author="sseth" created="Mon, 11 Aug 2014 22:53:04 +0000"  >&lt;p&gt;Updated patch.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;use the NM&apos;s defined env value for PWD instead of &quot;.&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Should working directory be a string or a fully resolved local fs path?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think a string should just work, and it&apos;ll continue to use whatever filesystem it used to use earlier.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Are 2 ctors needed in DAGAppMaster and TezChild? Why not fallback to &quot;PWD&quot; from env if working dir passed in is empty or null&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Removed one of the constructors in DAGAppMaster. TezChild only has one.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;MRRSleep - why is the change needed to set the staging dir?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not sure why this was there. Removed.&lt;/p&gt;</comment>
                            <comment id="14093487" author="sseth" created="Mon, 11 Aug 2014 23:14:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=airbots&quot; class=&quot;user-hover&quot; rel=&quot;airbots&quot;&gt;airbots&lt;/a&gt; Adding a few notes on the different directories involved. I think my previous comment had some details on this as well:&lt;/p&gt;

&lt;p&gt;local-dirs -&amp;gt; Normally, setup by YARN. This is where intermediate Inputs / Outputs generate their data. Cleaned up by YARN after job completion. Is explicitly referenced, so is OK to change. This needs to be app specific rather than container specific.&lt;br/&gt;
PWD: working-directory for running JVMs / AM. This is where resources will be localized, and this directory is always in the classpath.&lt;br/&gt;
StagingDir: directory where the client writes out files so that they can be localized into the distributed cache. In local mode, since we don&apos;t localize files - we end up reading these resources directly from this path.&lt;/p&gt;

&lt;p&gt;user.dir - This is a system property. When using LocalFileSystem - this is the default working directory for the FileSystem instance. DataSources and data sinks which use FileSystem, will just use the FileSystem isntance - irrespective of whether it&apos;s local, hdfs, s3 etc. They won&apos;t attempt to change any directories. This is where setting this system property to be container specific does not work - since final output will be spread across directories. Also setting it within the client is problematic, since users will typically generate data into a relative path - which will not be accessible if this parameter is updated in LocalMode. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am confused why we allow user to set staging dir (like in OrderedWordCount). From the system point of view, staging dir is the directory that system prepairs the user&apos;s job after user submission. It should be the same for consistency.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The users can provide a staging directory in case they want Tez files to be generated within that directory, instead of a standard location that would otherwise be configured in tez-site.xml.&lt;/p&gt;</comment>
                            <comment id="14094876" author="hitesh" created="Tue, 12 Aug 2014 23:23:23 +0000"  >&lt;p&gt;Looks fine as an initial step. We will probably need potential follow ups depending on the approach we choose for working dir locations.&lt;/p&gt;</comment>
                            <comment id="14094892" author="sseth" created="Tue, 12 Aug 2014 23:38:14 +0000"  >&lt;p&gt;Thanks. Committing this.&lt;/p&gt;</comment>
                            <comment id="14094901" author="sseth" created="Tue, 12 Aug 2014 23:49:52 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;</comment>
                            <comment id="14124224" author="bikassaha" created="Sat, 6 Sep 2014 01:36:07 +0000"  >&lt;p&gt;Bulk close for jiras fixed in 0.5.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12660598" name="TEZ-1393.1.txt" size="12636" author="sseth" created="Fri, 8 Aug 2014 09:50:57 +0000"/>
                            <attachment id="12661082" name="TEZ-1393.2.txt" size="11523" author="sseth" created="Mon, 11 Aug 2014 22:53:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yojr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326688">0.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>