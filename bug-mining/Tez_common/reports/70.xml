<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEZ-4501] Fix TestLocalMode timeouts - handle drained in case of InterruptedException</title>
                <link>https://issues.apache.org/jira/browse/TEZ-4501</link>
                <project id="12314426" key="TEZ">Apache Tez</project>
                    <description>&lt;p&gt;The relevant part from AsyncDispatcher is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (waitForDrained) {
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!drained &amp;amp;&amp;amp; eventHandlingThread.isAlive() &amp;amp;&amp;amp; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() &amp;lt; endTime) {
          waitForDrained.wait(1000);
          LOG.info(
              &lt;span class=&quot;code-quote&quot;&gt;&quot;Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: {}, handler thread state: {}&quot;&lt;/span&gt;,
              eventQueue.size(), eventHandlingThread.getState());
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is a log snippet from TestLocalMode when looping for TEZ_AM_DISPATCHER_DRAIN_EVENTS_TIMEOUT simply caused a test timeout because drained was false.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-07-03 12:15:39,938 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(148)) - AsyncDispatcher is draining to stop, ignoring any &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; events.
2023-07-03 12:15:39,938 INFO  [CallbackExecutor] common.AsyncDispatcher (AsyncDispatcher.java:handle(369)) - AsyncDispatcher put event: EventType: C_COMPLETED
2023-07-03 12:15:39,938 WARN  [CallbackExecutor] common.AsyncDispatcher (AsyncDispatcher.java:handle(373)) - AsyncDispatcher thread interrupted (&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; putting event): EventType: C_COMPLETED
java.lang.InterruptedException
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1223)
	at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
	at java.util.concurrent.LinkedBlockingQueue.put(LinkedBlockingQueue.java:339)
	at org.apache.tez.common.AsyncDispatcher$GenericEventHandler.handle(AsyncDispatcher.java:370)
	at org.apache.tez.dag.app.ContainerLauncherContextImpl.containerCompleted(ContainerLauncherContextImpl.java:97)
	at org.apache.tez.dag.app.launcher.LocalContainerLauncher$RunningTaskCallback.onFailure(LocalContainerLauncher.java:357)
	at com.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1135)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;CallbackExecutor&quot;&lt;/span&gt; org.apache.hadoop.yarn.exceptions.YarnRuntimeException: java.lang.InterruptedException
	at org.apache.tez.common.AsyncDispatcher$GenericEventHandler.handle(AsyncDispatcher.java:375)
	at org.apache.tez.dag.app.ContainerLauncherContextImpl.containerCompleted(ContainerLauncherContextImpl.java:97)
	at org.apache.tez.dag.app.launcher.LocalContainerLauncher$RunningTaskCallback.onFailure(LocalContainerLauncher.java:357)
	at com.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1135)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: java.lang.InterruptedException
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1223)
	at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
	at java.util.concurrent.LinkedBlockingQueue.put(LinkedBlockingQueue.java:339)
	at org.apache.tez.common.AsyncDispatcher$GenericEventHandler.handle(AsyncDispatcher.java:370)
	... 6 more
2023-07-03 12:15:40,938 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:41,939 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:42,939 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:43,939 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:44,940 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:45,940 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:46,940 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:47,941 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:48,941 INFO  [Time-limited test] common.AsyncDispatcher (AsyncDispatcher.java:serviceStop(156)) - Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncDispatcher to drain. Current queue size: 0, handler thread state: WAITING
2023-07-03 12:15:49,149 INFO  [Time-limited test] service.AbstractService (AbstractService.java:noteFailure(267)) - Service Central failed in state STOPPED
java.lang.InterruptedException
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	at org.apache.tez.common.AsyncDispatcher.serviceStop(AsyncDispatcher.java:155)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;what happened here is:&lt;br/&gt;
1. test is stopped (tezclient.stop)&lt;br/&gt;
2. eventQueue.put has been &lt;a href=&quot;https://github.com/apache/tez/blob/50380751b7e7e628aeb40a985b94aba98d2a88db/tez-common/src/main/java/org/apache/tez/common/AsyncDispatcher.java#L367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;interrupted&lt;/a&gt;, but drained is already &lt;a href=&quot;https://github.com/apache/tez/blob/50380751b7e7e628aeb40a985b94aba98d2a88db/tez-common/src/main/java/org/apache/tez/common/AsyncDispatcher.java#L338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;set to false&lt;/a&gt;&lt;br/&gt;
3. eventQueue.size == 0 and &lt;a href=&quot;https://github.com/apache/tez/blob/50380751b7e7e628aeb40a985b94aba98d2a88db/tez-common/src/main/java/org/apache/tez/common/AsyncDispatcher.java#L151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;still looping&lt;/a&gt;, this is only possible if &lt;a href=&quot;https://github.com/apache/tez/blob/50380751b7e7e628aeb40a985b94aba98d2a88db/tez-common/src/main/java/org/apache/tez/common/AsyncDispatcher.java#L338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;drained is false: it was set in GenericEventHandler.handle&lt;/a&gt;&lt;br/&gt;
4. hence test waits for TEZ_AM_DISPATCHER_DRAIN_EVENTS_TIMEOUT (10000ms default), but test timeout is also 10000ms: instead of increasing test timeout it would make sense to take care of drained variable in the event of an interrupt&lt;/p&gt;</description>
                <environment></environment>
        <key id="13542370">TEZ-4501</key>
            <summary>Fix TestLocalMode timeouts - handle drained in case of InterruptedException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="abstractdog">L&#225;szl&#243; Bodor</assignee>
                                    <reporter username="abstractdog">L&#225;szl&#243; Bodor</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jul 2023 06:50:14 +0000</created>
                <updated>Thu, 25 Jan 2024 08:07:44 +0000</updated>
                            <resolved>Thu, 25 Jan 2024 08:07:44 +0000</resolved>
                                                    <fixVersion>0.10.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7200">2h</timespent>
                                <comments>
                            <comment id="17810746" author="ayushtkn" created="Thu, 25 Jan 2024 08:07:35 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;

&lt;p&gt;Thanx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abstractdog&quot; class=&quot;user-hover&quot; rel=&quot;abstractdog&quot;&gt;abstractdog&lt;/a&gt; for the contribution!!!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12762397">TEZ-1867</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1iy40:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>