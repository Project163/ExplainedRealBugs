<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEZ-3105] TezMxBeanResourceCalculator does not work on IBM JDK 7 or 8 causing Tez failures</title>
                <link>https://issues.apache.org/jira/browse/TEZ-3105</link>
                <project id="12314426" key="TEZ">Apache Tez</project>
                    <description>&lt;p&gt;When testing Hive on Tez with IBM JDK 7 and 8. The following issue was discovered:&lt;/p&gt;

&lt;p&gt;2016-02-08 22:25:22,869 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; |app.DAGAppMaster|: Error starting DAGAppMaster&lt;br/&gt;
java.lang.RuntimeException: java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at org.apache.hadoop.yarn.util.ResourceCalculatorProcessTree.getResourceCalculatorProcessTree(ResourceCalculatorProcessTree.java:225)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.initResourceCalculatorPlugins(DAGAppMaster.java:347)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.serviceInit(DAGAppMaster.java:371)&lt;br/&gt;
	at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster$6.run(DAGAppMaster.java:2274)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(AccessController.java:686)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:569)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.initAndStartAppMaster(DAGAppMaster.java:2271)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.main(DAGAppMaster.java:2086)&lt;br/&gt;
Caused by: java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:88)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:57)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:436)&lt;br/&gt;
	at org.apache.hadoop.yarn.util.ResourceCalculatorProcessTree.getResourceCalculatorProcessTree(ResourceCalculatorProcessTree.java:221)&lt;br/&gt;
	... 9 more&lt;br/&gt;
Caused by: java.lang.ClassCastException: com.ibm.lang.management.ExtendedOperatingSystem incompatible with com.sun.management.OperatingSystemMXBean&lt;br/&gt;
	at org.apache.tez.util.TezMxBeanResourceCalculator.&amp;lt;init&amp;gt;(TezMxBeanResourceCalculator.java:44)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12937781">TEZ-3105</key>
            <summary>TezMxBeanResourceCalculator does not work on IBM JDK 7 or 8 causing Tez failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gss2002">Greg Senia</assignee>
                                    <reporter username="gss2002">Greg Senia</reporter>
                        <labels>
                            <label>ibm</label>
                            <label>ibm-jdk</label>
                    </labels>
                <created>Tue, 9 Feb 2016 04:57:03 +0000</created>
                <updated>Wed, 18 May 2016 04:55:00 +0000</updated>
                            <resolved>Mon, 14 Mar 2016 18:23:58 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.1</fixVersion>
                    <fixVersion>0.8.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15138434" author="tezqa" created="Tue, 9 Feb 2016 06:50:54 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12786992/TEZ-3105.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12786992/TEZ-3105.patch&lt;/a&gt;&lt;br/&gt;
  against master revision f352cfb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in :&lt;br/&gt;
                   org.apache.tez.dag.app.TestMockDAGAppMaster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1456//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1456//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1456//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1456//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15139708" author="bikassaha" created="Tue, 9 Feb 2016 20:29:02 +0000"  >&lt;p&gt;Thanks for reporting the issue! &lt;/p&gt;

&lt;p&gt;These methods could end up being used frequently. Would there be a perf impact in the patch&apos;s approach. Say vs. just casting the osBean (based on vendor flag) and invoking the method?&lt;/p&gt;</comment>
                            <comment id="15139764" author="sseth" created="Tue, 9 Feb 2016 21:10:58 +0000"  >&lt;p&gt;I think we&apos;ll be better off adding a new implementation of an MxBean based ResourceCalculatorProcessTree for the IBM JDK, and selecting them appropriately where they are setup - DAGAppMaster and TaskCounterUpdater.&lt;/p&gt;</comment>
                            <comment id="15140034" author="gss2002" created="Tue, 9 Feb 2016 23:58:26 +0000"  >&lt;p&gt;I tried casting based on Java type but remember at compile time com.sun.* or sun.* or com.ibm.* may not exist based on jdk being used to compile tez so my approach was how the flink guys did it... Let me know willing to adjust and test&lt;/p&gt;</comment>
                            <comment id="15140137" author="bikassaha" created="Wed, 10 Feb 2016 01:03:38 +0000"  >&lt;p&gt;Ah. Right! That would mean even compilation will fail if we end up creating a parallel implementation that casts the object in the ibm version? In that case this is likely the only option.&lt;/p&gt;</comment>
                            <comment id="15140268" author="sseth" created="Wed, 10 Feb 2016 04:03:52 +0000"  >&lt;p&gt;Missed that. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; - thoughts on the performance implications of such a change ?&lt;br/&gt;
One possible option would be to include the IBM OSMXBean based class under a separate profile which does not get built by default. It lives in the source, but gets compiled only when using the IBM JDK. Similarly an option to disable the compilation of the com.sun based implementation. The usage would end up creating the appropriate instance via Reflection.&lt;/p&gt;</comment>
                            <comment id="15140322" author="gopalv" created="Wed, 10 Feb 2016 05:10:18 +0000"  >
&lt;p&gt;You probably don&apos;t have to go that far - the expensive part is the class lookup &amp;amp; getting a method handle. Store &lt;/p&gt;

&lt;p&gt;method = clazz.getMethod(&quot;getCommittedVirtualMemorySize&quot;);&lt;/p&gt;

&lt;p&gt;into a static final and it should be pretty cheap to invoke it.&lt;/p&gt;

&lt;p&gt;The JVM will JIT stubs (check for GeneratedMethodAccessor&amp;lt;n&amp;gt;) once it sees the static final vars  and it will be nearly as cheap as an interface dispatch with that.&lt;/p&gt;</comment>
                            <comment id="15140377" author="sseth" created="Wed, 10 Feb 2016 05:52:04 +0000"  >&lt;p&gt;That sounds like the best option then... and a small modification to the patch.&lt;/p&gt;</comment>
                            <comment id="15140529" author="gss2002" created="Wed, 10 Feb 2016 09:01:49 +0000"  >&lt;p&gt;Made the changes... Tried to assign it a final but Java at compile time didnt like that.. So I went with one class method that is static and 2 static methods... Let me know. I can change further. I saw perf improvement by adjusting it.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project tez-common: Compilation failure: Compilation failure:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/build/tez-release-HDP-2.3.4.0-tag/tez-common/src/main/java/org/apache/tez/util/TezMxBeanResourceCalculator.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;67,25&amp;#93;&lt;/span&gt; cannot assign a value to final variable clazz&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/build/tez-release-HDP-2.3.4.0-tag/tez-common/src/main/java/org/apache/tez/util/TezMxBeanResourceCalculator.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;68,25&amp;#93;&lt;/span&gt; cannot assign a value to final variable method&lt;/p&gt;</comment>
                            <comment id="15140580" author="tezqa" created="Wed, 10 Feb 2016 09:52:34 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12787225/TEZ-3105-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12787225/TEZ-3105-2.patch&lt;/a&gt;&lt;br/&gt;
  against master revision f352cfb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;      &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The applied patch generated 21 javac compiler warnings (more than the master&apos;s current 17 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 4 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The following test timeouts occurred in :&lt;br/&gt;
 org.apache.tez.test.TestRecovery&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//artifact/patchprocess/newPatchFindbugsWarningstez-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//artifact/patchprocess/newPatchFindbugsWarningstez-common.html&lt;/a&gt;&lt;br/&gt;
Javac warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//artifact/patchprocess/diffJavacWarnings.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//artifact/patchprocess/diffJavacWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1458//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15141288" author="bikassaha" created="Wed, 10 Feb 2016 17:45:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gss2002&quot; class=&quot;user-hover&quot; rel=&quot;gss2002&quot;&gt;gss2002&lt;/a&gt; Could you attach your latest patch? Thanks!&lt;/p&gt;</comment>
                            <comment id="15141534" author="gss2002" created="Wed, 10 Feb 2016 19:51:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bikassaha&quot; class=&quot;user-hover&quot; rel=&quot;bikassaha&quot;&gt;bikassaha&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; I made requested changes and tested in my Sandbox cluster and definitely saw improvement about 10-15 seconds consistently after setting the classes to final.&lt;/p&gt;

&lt;p&gt;BEFORE CHANGE to FINAL:&lt;br/&gt;
hive&amp;gt; select count(symbol) from nyse;&lt;br/&gt;
Query ID = gsenia_20160210024638_405d17b3-6ecb-4ce5-b831-530d387e5e43&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;/p&gt;


&lt;p&gt;Status: Running (Executing on YARN cluster with App id application_1455042331631_0006)&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------&lt;br/&gt;
        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
Map 1 ..........   SUCCEEDED      7          7        0        0       0       0&lt;br/&gt;
Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
VERTICES: 02/02  &lt;span class=&quot;error&quot;&gt;&amp;#91;==========================&amp;gt;&amp;gt;&amp;#93;&lt;/span&gt; 100%  ELAPSED TIME: 63.10 s    &lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
OK&lt;br/&gt;
9211067&lt;br/&gt;
Time taken: 73.212 seconds, Fetched: 1 row(s)&lt;/p&gt;


&lt;p&gt;AFTER CHANGE to FINAL:&lt;/p&gt;

&lt;p&gt;hive&amp;gt; select count(symbol) from nyse;&lt;br/&gt;
Query ID = gsenia_20160210031453_dc08fb39-e3e6-4239-b09a-fb90648e608a&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;/p&gt;


&lt;p&gt;Status: Running (Executing on YARN cluster with App id application_1455042331631_0007)&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------&lt;br/&gt;
        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
Map 1 ..........   SUCCEEDED      7          7        0        0       0       0&lt;br/&gt;
Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
VERTICES: 02/02  &lt;span class=&quot;error&quot;&gt;&amp;#91;==========================&amp;gt;&amp;gt;&amp;#93;&lt;/span&gt; 100%  ELAPSED TIME: 49.71 s    &lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
OK&lt;br/&gt;
9211067&lt;br/&gt;
Time taken: 61.968 seconds, Fetched: 1 row(s)&lt;/p&gt;

&lt;p&gt;Status: Running (Executing on YARN cluster with App id application_1455042331631_0008)&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------&lt;br/&gt;
        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
Map 1 ..........   SUCCEEDED      7          7        0        0       0       0&lt;br/&gt;
Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
VERTICES: 02/02  &lt;span class=&quot;error&quot;&gt;&amp;#91;==========================&amp;gt;&amp;gt;&amp;#93;&lt;/span&gt; 100%  ELAPSED TIME: 57.57 s    &lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
OK&lt;br/&gt;
9211067&lt;br/&gt;
Time taken: 62.251 seconds, Fetched: 1 row(s)&lt;/p&gt;

&lt;p&gt;Status: Running (Executing on YARN cluster with App id application_1455042331631_0023)&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------&lt;br/&gt;
        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
Map 1 ..........   SUCCEEDED      7          7        0        0       0       0&lt;br/&gt;
Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
VERTICES: 02/02  &lt;span class=&quot;error&quot;&gt;&amp;#91;==========================&amp;gt;&amp;gt;&amp;#93;&lt;/span&gt; 100%  ELAPSED TIME: 49.32 s    &lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
OK&lt;br/&gt;
9211067&lt;br/&gt;
Time taken: 58.644 seconds, Fetched: 1 row(s)&lt;/p&gt;</comment>
                            <comment id="15141699" author="tezqa" created="Wed, 10 Feb 2016 21:23:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12787320/TEZ-3105-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12787320/TEZ-3105-2.patch&lt;/a&gt;&lt;br/&gt;
  against master revision f352cfb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in :&lt;br/&gt;
                   org.apache.tez.test.TestFaultTolerance&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1462//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1462//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1462//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1462//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15141826" author="gopalv" created="Wed, 10 Feb 2016 22:25:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gss2002&quot; class=&quot;user-hover&quot; rel=&quot;gss2002&quot;&gt;gss2002&lt;/a&gt;: the final is still in the hot-path.&lt;/p&gt;

&lt;p&gt;I recommend something along the lines of &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Method getCommittedVirtualMemorySize = getMxBeanMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;getCommittedVirtualMemorySize&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Method getProcessCpuTime = getMxBeanMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;getProcessCpuTime&quot;&lt;/span&gt;);

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Method getMxBeanMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; string) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; JAVA_VENDOR_NAME = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.vendor&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; IBM_JAVA = JAVA_VENDOR_NAME.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;IBM&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; mbeanClazz;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (IBM_JAVA) {
        mbeanClazz = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.ibm.management.OperatingSystemMXBean&quot;&lt;/span&gt;);
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        mbeanClazz = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.management.OperatingSystemMXBean&quot;&lt;/span&gt;);
      }
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Method vmemMethod = mbeanClazz
          .getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;getCommittedVirtualMemorySize&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; vmemMethod;
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
      e.printStackTrace();
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
  }

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getCumulativeCpuTime() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getProcessCpuTime == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-comment&quot;&gt;// convert to milliseconds
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TimeUnit.MILLISECONDS.convert(
          (&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) getProcessCpuTime.invoke(osBean), TimeUnit.NANOSECONDS);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InvocationTargetException ite) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So that the method lookup is out of the hot-path and the JIT will put a trampoline for the .invoke(), which will get compiled into native code after approx ~16 hits.&lt;/p&gt;</comment>
                            <comment id="15141967" author="gss2002" created="Wed, 10 Feb 2016 23:45:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; I actually tried that hence the long run between my patches late last night and when I uploaded it... For whatever reason at init time it was getting null.. Example of the error:&lt;/p&gt;

&lt;p&gt;Logging initialized using configuration in &lt;a href=&quot;file:/etc/hive/2.3.4.0-3485/0/hive-log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/etc/hive/2.3.4.0-3485/0/hive-log4j.properties&lt;/a&gt;&lt;br/&gt;
hive&amp;gt; select count(symbol) from nyse;&lt;br/&gt;
Query ID = gsenia_20160210140539_f8bd6347-7208-4b43-88a8-bffaed744469&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Dag submit failed due to java.lang.NullPointerException&lt;br/&gt;
	at org.apache.tez.util.TezMxBeanResourceCalculator.getCumulativeCpuTime(TezMxBeanResourceCalculator.java:86)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.getAMCPUTime(DAGAppMaster.java:355)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.access$2900(DAGAppMaster.java:199)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster$RunningAppContext.getCumulativeCPUTime(DAGAppMaster.java:1521)&lt;br/&gt;
	at org.apache.tez.dag.app.dag.impl.DAGImpl.&amp;lt;init&amp;gt;(DAGImpl.java:544)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.createDAG(DAGAppMaster.java:881)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.createDAG(DAGAppMaster.java:859)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.startDAG(DAGAppMaster.java:2167)&lt;br/&gt;
	at org.apache.tez.dag.app.DAGAppMaster.submitDAGToAppMaster(DAGAppMaster.java:1225)&lt;br/&gt;
	at org.apache.tez.dag.api.client.DAGClientHandler.submitDAG(DAGClientHandler.java:118)&lt;br/&gt;
	at org.apache.tez.dag.api.client.rpc.DAGClientAMProtocolBlockingPBServerImpl.submitDAG(DAGClientAMProtocolBlockingPBServerImpl.java:163)&lt;br/&gt;
	at org.apache.tez.dag.api.client.rpc.DAGClientAMProtocolRPC$DAGClientAMProtocol$2.callBlockingMethod(DAGClientAMProtocolRPC.java:7471)&lt;br/&gt;
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:616)&lt;br/&gt;
	at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:969)&lt;br/&gt;
	at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2151)&lt;br/&gt;
	at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2147)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(AccessController.java:686)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:569)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)&lt;br/&gt;
	at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2145)&lt;br/&gt;
 stack trace: &lt;span class=&quot;error&quot;&gt;&amp;#91;sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method), sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:88), sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:57), java.lang.reflect.Constructor.newInstance(Constructor.java:436), org.apache.tez.common.RPCUtil.instantiateException(RPCUtil.java:53), org.apache.tez.common.RPCUtil.instantiateRuntimeException(RPCUtil.java:85), org.apache.tez.common.RPCUtil.unwrapAndThrowException(RPCUtil.java:135), org.apache.tez.client.TezClient.submitDAGSession(TezClient.java:524), org.apache.tez.client.TezClient.submitDAG(TezClient.java:434), org.apache.hadoop.hive.ql.exec.tez.TezTask.submit(TezTask.java:439), org.apache.hadoop.hive.ql.exec.tez.TezTask.execute(TezTask.java:180), org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:160), org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:89), org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1703), org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1460), org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1237), org.apache.hadoop.hive.ql.Driver.run(Driver.java:1101), org.apache.hadoop.hive.ql.Driver.run(Driver.java:1091), org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:216), org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:168), org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:379), org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:739), org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:684), org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:624), sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method), sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:95), sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55), java.lang.reflect.Method.invoke(Method.java:507), org.apache.hadoop.util.RunJar.run(RunJar.java:221), org.apache.hadoop.util.RunJar.main(RunJar.java:136)&amp;#93;&lt;/span&gt; retrying...&lt;br/&gt;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.tez.TezTask&lt;/p&gt;</comment>
                            <comment id="15141972" author="gss2002" created="Wed, 10 Feb 2016 23:48:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; second run of the fix that generated the NPE....&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; public class TezMxBeanResourceCalculator extends ResourceCalculatorProcessTree {

  private final OperatingSystemMXBean osBean;
  private final Runtime runtime;
  private static final String JAVA_VENDOR_NAME = System.getProperty(&quot;java.vendor&quot;);
  private static final boolean IBM_JAVA = JAVA_VENDOR_NAME.contains(&quot;IBM&quot;);
  private final Class&amp;lt;?&amp;gt; mbeanClazz = getMBeanClass();
  private final Method vmemMethod = getVmemMethod();
  private final Method cpuMethod = getProcCpuMethod();

  /**
   * Create process-tree instance with specified root process.
   * &amp;lt;p/&amp;gt;
   * Subclass must override this.
   *
   * @param root process-tree root-process
   */
  public TezMxBeanResourceCalculator(String root) {
    super(root);
    runtime = Runtime.getRuntime();
    osBean =
         ManagementFactory.getOperatingSystemMXBean();
  }

  @Override public void updateProcessTree() {
    //nothing needs to be done as the data is read from OS mbeans.
  }

  @Override public String getProcessTreeDump() {
    return &quot;&quot;;
  }

  @Override public long getCumulativeVmem(int olderThanAge) {
        long vmem = 0L;
        try {
                vmem= (Long) vmemMethod.invoke(osBean);
        } catch ( IllegalAccessException iae ) {
        } catch ( IllegalArgumentException iare ) {
        } catch ( InvocationTargetException ite ) {
        } catch ( SecurityException se ) {
        }
        return vmem;

  }

  @Override public long getCumulativeRssmem(int olderThanAge) {
    //Not supported directly (RSS ~= memory consumed by JVM from Xmx)
    return runtime.totalMemory();
  }

  @Override public long getCumulativeCpuTime() {
    //convert to milliseconds
        long cputime = 0L;
        try {
                cputime= TimeUnit.MILLISECONDS.convert((Long) cpuMethod.invoke(osBean), TimeUnit.NANOSECONDS);
        } catch ( IllegalAccessException iae ) {
        } catch ( IllegalArgumentException iare ) {
        } catch ( InvocationTargetException ite ) {
        } catch ( SecurityException se ) {
        }
        return cputime;
  }

  @Override public boolean checkPidPgrpidForMatch() {
    return true;
  }

  public float getCpuUsagePercent() {
    //osBean.getProcessCpuLoad() can be closer and returns [0 - 1.0], but might not be accurate.
    //Returning -1 to indicate, this feature is not yet supported.
    return -1;
  }

  public final Class&amp;lt;?&amp;gt; getMBeanClass() {
    try {
        if (IBM_JAVA) {
                return Class.forName(&quot;com.ibm.management.OperatingSystemMXBean&quot;);
        } else {
                return Class.forName(&quot;com.sun.management.OperatingSystemMXBean&quot;);
        }
    } catch ( Exception e ) {
        e.printStackTrace();
        return null;
    }
  }

  public final Method getVmemMethod() {
    try {
        return mbeanClazz.getMethod(&quot;getCommittedVirtualMemorySize&quot;);
    } catch ( Exception e ) {
        e.printStackTrace();
        return null;
    }
  }

  public final Method getProcCpuMethod() {
    try {
        return mbeanClazz.getMethod(&quot;getProcessCpuTime&quot;);
    } catch ( Exception e ) {
        e.printStackTrace();
        return null;
    }
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15141990" author="gss2002" created="Thu, 11 Feb 2016 00:07:49 +0000"  >&lt;p&gt;Looks like it may be because of this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
  private void initResourceCalculatorPlugins() {
    Class&amp;lt;? extends ResourceCalculatorProcessTree&amp;gt; clazz = amConf.getClass(
        TezConfiguration.TEZ_TASK_RESOURCE_CALCULATOR_PROCESS_TREE_CLASS,
        TezMxBeanResourceCalculator.class,
        ResourceCalculatorProcessTree.class);

    // this is set by YARN NM
    String pid = System.getenv().get(&quot;JVM_PID&quot;);
    // for the local debug test cases fallback to JVM hooks that are not portable
    if (pid == null || pid.length() == 0) {
      String processName = java.lang.management.ManagementFactory.getRuntimeMXBean().getName();
      pid = processName.split(&quot;@&quot;)[0];
    }
    cpuPlugin = ResourceCalculatorProcessTree.getResourceCalculatorProcessTree(pid, clazz, amConf);
    
    gcPlugin = new GcTimeUpdater(null);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15155671" author="gss2002" created="Sat, 20 Feb 2016 16:03:15 +0000"  >&lt;p&gt;@GopalV any further thoughts? Let me know. I can make further changes..&lt;/p&gt;</comment>
                            <comment id="15155698" author="hitesh" created="Sat, 20 Feb 2016 17:46:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gss2002&quot; class=&quot;user-hover&quot; rel=&quot;gss2002&quot;&gt;gss2002&lt;/a&gt; Thanks for the patch. Some minor comments: &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Please fix the indentation to 2 spaces and not tabs.&lt;/li&gt;
	&lt;li&gt;getVmemMethod() and getProcCpuMethod() need to handle the case that mbeanClazz can be potentially null&lt;/li&gt;
	&lt;li&gt;getCumulativeVmem() and getCumulativeCpuTime() also both need minor changes to account for the fact that the method objects in question can be null if there was a problem in instantiating them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Last point regarding  mbeanClazz, vmemMethod and cpuMethod - these are currently final objects instantiated once per class instance. They could likely be defined as final static vars and instantiated in a static block given that they will likely be unchanged across the lifetime of a JVM. That said, this does not need to change as we instantiate the overall object only once I believe. &lt;/p&gt;

&lt;p&gt;Would you mind uploading a new patch file to the jira as an attachment. This will trigger the pre-commit build to verify the patch. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; anything else that you would like to add/edit for my above comments? &lt;/p&gt;</comment>
                            <comment id="15155700" author="hitesh" created="Sat, 20 Feb 2016 17:49:07 +0000"  >&lt;p&gt;Forgot to add one more point: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;please change &quot;e.printStackTrace();&quot; to use a logger instead and add some more context to the log message for someone looking to debug issues in this code path.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15159043" author="gss2002" created="Tue, 23 Feb 2016 15:27:32 +0000"  >&lt;p&gt;I will finish the patch this evening&lt;/p&gt;</comment>
                            <comment id="15159310" author="hitesh" created="Tue, 23 Feb 2016 17:57:04 +0000"  >&lt;p&gt;Thanks Greg.&lt;/p&gt;</comment>
                            <comment id="15170402" author="gss2002" created="Sat, 27 Feb 2016 06:57:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hitesh&quot; class=&quot;user-hover&quot; rel=&quot;hitesh&quot;&gt;hitesh&lt;/a&gt; I attempted the above and Tez no longer works correctly when testing with the above changes... I wish there was a better answer.. Looking at what the Flink folks did they did the following:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/6b01a89020f2de3f7710cf72336291b1e8ca8562/flink-runtime/src/main/java/org/apache/flink/runtime/util/EnvironmentInformation.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/6b01a89020f2de3f7710cf72336291b1e8ca8562/flink-runtime/src/main/java/org/apache/flink/runtime/util/EnvironmentInformation.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;	public static long getMaxJvmHeapMemory() {&lt;br/&gt;
		long maxMemory = Runtime.getRuntime().maxMemory();&lt;/p&gt;

&lt;p&gt;		if (maxMemory == Long.MAX_VALUE) {&lt;br/&gt;
			// amount of free memory unknown&lt;br/&gt;
			try &lt;/p&gt;
{
				// workaround for Oracle JDK
				OperatingSystemMXBean operatingSystemMXBean = ManagementFactory.getOperatingSystemMXBean();
				Class&amp;lt;?&amp;gt; clazz = Class.forName(&quot;com.sun.management.OperatingSystemMXBean&quot;);
				Method method = clazz.getMethod(&quot;getTotalPhysicalMemorySize&quot;);
				maxMemory = (Long) method.invoke(operatingSystemMXBean) / 4;
			}
&lt;p&gt;			catch (Throwable e) &lt;/p&gt;
{
				throw new RuntimeException(&quot;Could not determine the amount of free memory.\n&quot; +
						&quot;Please set the maximum memory for the JVM, e.g. -Xmx512M for 512 megabytes.&quot;);
			}
&lt;p&gt;		}&lt;/p&gt;

&lt;p&gt;		return maxMemory;&lt;br/&gt;
	}&lt;/p&gt;


&lt;p&gt;Please advise if this patch is acceptable: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12787320/TEZ-3105-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12787320/TEZ-3105-2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And if not what can be changed.&lt;/p&gt;</comment>
                            <comment id="15192684" author="gss2002" created="Mon, 14 Mar 2016 02:47:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hitesh&quot; class=&quot;user-hover&quot; rel=&quot;hitesh&quot;&gt;hitesh&lt;/a&gt; I have address all of the issue and this now correctly works.. I apologize for the time it took to get this out. Everything should be addressed. Including documentation showing the slight method differences and classname differences in IBM vs Oracle JDK. Any further questions or concerns please let me know.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ibm.com/support/knowledgecenter/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ibm.com/support/knowledgecenter/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html#getProcessCpuTimeByNS(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html#getProcessCpuTimeByNS(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getProcessCpuTime(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getProcessCpuTime(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html#getProcessVirtualMemorySize(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSYKE2_7.0.0/com.ibm.java.api.71.doc/com.ibm.lang.management/com/ibm/lang/management/OperatingSystemMXBean.html#getProcessVirtualMemorySize(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getCommittedVirtualMemorySize(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getCommittedVirtualMemorySize(&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15192719" author="tezqa" created="Mon, 14 Mar 2016 04:08:10 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12793226/TEZ-3105.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12793226/TEZ-3105.patch&lt;/a&gt;&lt;br/&gt;
  against master revision dbd763f.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in :&lt;br/&gt;
                   org.apache.tez.test.TestFaultTolerance&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//artifact/patchprocess/newPatchFindbugsWarningstez-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//artifact/patchprocess/newPatchFindbugsWarningstez-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1561//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15193196" author="gss2002" created="Mon, 14 Mar 2016 12:38:44 +0000"  >&lt;p&gt;Updated to include correct Exceptions vs just one generic exception&lt;/p&gt;</comment>
                            <comment id="15193207" author="gss2002" created="Mon, 14 Mar 2016 12:45:32 +0000"  >&lt;p&gt;Looks like this:&lt;/p&gt;

&lt;p&gt;-1 core tests. The patch failed these unit tests in :&lt;br/&gt;
org.apache.tez.test.TestFaultTolerance&lt;/p&gt;

&lt;p&gt;was not introduced by the patch for this jira&lt;/p&gt;</comment>
                            <comment id="15193330" author="tezqa" created="Mon, 14 Mar 2016 14:06:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment&lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12793304/TEZ-3105.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12793304/TEZ-3105.patch&lt;/a&gt;&lt;br/&gt;
  against master revision dbd763f.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1562//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1562//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-TEZ-Build/1562//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-TEZ-Build/1562//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15193808" author="hitesh" created="Mon, 14 Mar 2016 18:16:10 +0000"  >&lt;p&gt;Thanks for the follow &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gss2002&quot; class=&quot;user-hover&quot; rel=&quot;gss2002&quot;&gt;gss2002&lt;/a&gt;. +1. Committing shortly. &lt;/p&gt;</comment>
                            <comment id="15193830" author="hitesh" created="Mon, 14 Mar 2016 18:23:58 +0000"  >&lt;p&gt;Committed to master and branch 0.7. Thanks for your contribution and following up on this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gss2002&quot; class=&quot;user-hover&quot; rel=&quot;gss2002&quot;&gt;gss2002&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15288208" author="hitesh" created="Wed, 18 May 2016 04:55:00 +0000"  >&lt;p&gt;Closing as 0.7.1 released.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793304" name="TEZ-3105.patch" size="3889" author="gss2002" created="Mon, 14 Mar 2016 12:36:57 +0000"/>
                            <attachment id="12793226" name="TEZ-3105.patch" size="3758" author="gss2002" created="Mon, 14 Mar 2016 02:47:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2slin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334294">0.7.2</customfieldvalue>
    <customfieldvalue id="12334308">0.8.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>