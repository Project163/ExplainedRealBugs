<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-46] [FTP] retrieveFileStream fails randomly or hangs</title>
                <link>https://issues.apache.org/jira/browse/NET-46</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;For my application I need a way to get the InputStream of a binary file on a&lt;br/&gt;
FTPServer. What I did was :&lt;/p&gt;

&lt;p&gt;// connect and get ftpFiles as an array&lt;br/&gt;
// for each ftpFile ...&lt;/p&gt;

&lt;p&gt;InputStream is = ftp.retrieveFileStream(ftpFiles&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getName());&lt;/p&gt;

&lt;p&gt;However, this behaves erratically : sometimes the inputstream is correct and&lt;br/&gt;
sometimes it is null (and the ftpFile exists, no weird name or anything odd&lt;br/&gt;
about it).&lt;/p&gt;

&lt;p&gt;After first blaming my FTPServer (I use GuildFTPd 0.9.9.13) I tried another&lt;br/&gt;
FTPServer (Serv-U 6.1), but this also had the same behavior. &lt;/p&gt;

&lt;p&gt;Then I thought I might have to do with timing. So I tried Thread.sleep(xxx) on a&lt;br/&gt;
couple of locations but to no avail. In a last attempt (was getting pretty&lt;br/&gt;
desperate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) I rewrote my original line and replaced it by this :&lt;/p&gt;

&lt;p&gt;ByteArrayOutputStream out = new ByteArrayOutputStream();&lt;br/&gt;
ftp.retrieveFile(ftpFiles&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getName(),out);&lt;br/&gt;
InputStream is = new ByteArrayInputStream(out.toByteArray());&lt;/p&gt;

&lt;p&gt;And much to my surprise, it worked like a charm. Tested it a couple of times (on&lt;br/&gt;
both FTPServer products) and works perfectly.&lt;/p&gt;

&lt;p&gt;So I&apos;m guessing something is going wrong in your retrieveFileStream&lt;br/&gt;
implementation. Maybe something worth looking into ? (easiest fix : use the&lt;br/&gt;
ByteArrayOut/InputStream swap &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;

&lt;p&gt;kind regards,&lt;/p&gt;

&lt;p&gt;Dennis&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342399">NET-46</key>
            <summary>[FTP] retrieveFileStream fails randomly or hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dennis.meerveld@ubench.com">Dennis Meerveld</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jul 2005 18:59:46 +0000</created>
                <updated>Wed, 17 Apr 2013 19:57:39 +0000</updated>
                            <resolved>Mon, 26 Nov 2012 10:35:42 +0000</resolved>
                                    <version>1.4</version>
                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                    <component>FTP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12409904" author="dfs@apache.org" created="Wed, 27 Jul 2005 02:40:59 +0000"  >&lt;p&gt;retrieveFileStream has been working essentially unchanged since 1997.  Keep&lt;br/&gt;
in mind that retrieveFile performs the exact same operation as retrieveFileStream&lt;br/&gt;
to initiate a fiile transfer.  If retrieveFileStream is returning null, then&lt;br/&gt;
retrieveFile would return false under the same circumstances.  It&apos;s&lt;br/&gt;
more likely the issue you&apos;ve encountered lies elsewhere.  If you&lt;br/&gt;
can provide a self-contained program (class with main()) that we can&lt;br/&gt;
compile and run, we can better determine if there is something in FTPClient&lt;br/&gt;
that requires fixing.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12409905" author="anders@nufort.net" created="Fri, 7 Oct 2005 19:14:29 +0000"  >&lt;p&gt;I&apos;m experiencing the same problem as Dennis.&lt;/p&gt;

&lt;p&gt;Out of 100 file transfers 2 InputStream&apos;s were returned as null.&lt;br/&gt;
And, which was my original problem, on one occation the application hung. See&lt;br/&gt;
the Java thread below. &lt;/p&gt;

&lt;p&gt;Seems like the FTPClient.retrieveFileStream() call now and then returns a null&lt;br/&gt;
InputStream and occationally hangs...&lt;/p&gt;

&lt;p&gt;I&apos;m currently using version 1.3.0 so I&apos;ll try Dennis fix with the 1.4.0.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
 Anders M&lt;/p&gt;


&lt;p&gt;Current Java thread:&lt;br/&gt;
	at java.lang.Object.wait(Native Method)&lt;br/&gt;
	at java.lang.Object.wait(Object.java:429)&lt;br/&gt;
	at org.apache.commons.net.telnet.TelnetInputStream.read(TelnetInputStream.java:339)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x447b0098&amp;gt; (a [I)&lt;br/&gt;
	at org.apache.commons.net.telnet.TelnetInputStream.read(TelnetInputStream.java:466)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:220)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:277)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x447b6270&amp;gt; (a java.io.BufferedInputStream)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder$CharsetSD.readBytes(StreamDecoder.java:408)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder$CharsetSD.implRead(StreamDecoder.java:450)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:182)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x447b60e0&amp;gt; (a java.io.InputStreamReader)&lt;br/&gt;
	at java.io.InputStreamReader.read(InputStreamReader.java:167)&lt;br/&gt;
	at java.io.BufferedReader.fill(BufferedReader.java:136)&lt;br/&gt;
	at java.io.BufferedReader.readLine(BufferedReader.java:299)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x447b60e0&amp;gt; (a java.io.InputStreamReader)&lt;br/&gt;
	at java.io.BufferedReader.readLine(BufferedReader.java:362)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:260)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:456)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:484)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTPClient.&lt;em&gt;openDataConnection&lt;/em&gt;(FTPClient.java:475)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTPClient.retrieveFileStream(FTPClient.java:1327)&lt;br/&gt;
	at spar_vo.SparFTPConnectionVO.getFile(SparFTPConnectionVO.java:119)&lt;br/&gt;
	at spar_uc.SparGetFileUC.performUseCase(SparGetFileUC.java:63)&lt;br/&gt;
	at spar.SparApplication.main(SparApplication.java:97)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13015252" author="sebb@apache.org" created="Mon, 4 Apr 2011 00:43:13 +0000"  >&lt;p&gt;No recent reports.&lt;/p&gt;

&lt;p&gt;If this occurs with the NET 2.2 or later, please re-open with details&lt;/p&gt;</comment>
                            <comment id="13503691" author="dheerajvs" created="Mon, 26 Nov 2012 09:25:06 +0000"  >&lt;p&gt;I faced a similar hang in retrieveFileStream() when using commons-net-3.1. And the callstack is essentially similar to that posted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anders%40nufort.net&quot; class=&quot;user-hover&quot; rel=&quot;anders@nufort.net&quot;&gt;anders@nufort.net&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;libcore.io.Posix	recvfromBytes	Posix.java	-2	true	&lt;br/&gt;
libcore.io.Posix	recvfrom	Posix.java	131	false	&lt;br/&gt;
libcore.io.BlockGuardOs	recvfrom	BlockGuardOs.java	164	false	&lt;br/&gt;
libcore.io.IoBridge	recvfrom	IoBridge.java	513	false	&lt;br/&gt;
java.net.PlainSocketImpl	read	PlainSocketImpl.java	488	false	&lt;br/&gt;
java.net.PlainSocketImpl	access$000	PlainSocketImpl.java	46	false	&lt;br/&gt;
java.net.PlainSocketImpl$PlainSocketInputStream	read	PlainSocketImpl.java	240	false	&lt;br/&gt;
java.io.InputStreamReader	read	InputStreamReader.java	244	false	&lt;br/&gt;
java.io.BufferedReader	fillBuf	BufferedReader.java	130	false	&lt;br/&gt;
java.io.BufferedReader	read	BufferedReader.java	238	false	&lt;br/&gt;
org.apache.commons.net.io.CRLFLineReader	readLine	CRLFLineReader.java	58	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTP	__getReply	FTP.java	310	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTP	__getReply	FTP.java	290	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTP	sendCommand	FTP.java	479	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTPClient	&lt;em&gt;openDataConnection&lt;/em&gt;	FTPClient.java	769	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTPClient	_retrieveFileStream	FTPClient.java	1747	false	&lt;br/&gt;
org.apache.commons.net.ftp.FTPClient	retrieveFileStream	FTPClient.java	1739	false	&lt;/p&gt;

&lt;p&gt;My guess is that in _&lt;em&gt;openDataConnection&lt;/em&gt;_(), the following line to set the dataTimeOut should have been set &lt;b&gt;before&lt;/b&gt; calling sendCommand():&lt;br/&gt;
    socket.setSoTimeout(__dataTimeout);&lt;/p&gt;

&lt;p&gt;Otherwise, the client would be waiting indefinitely for the server&apos;s reply to the RETR command.&lt;/p&gt;

&lt;p&gt;FWIW, I&apos;m running it on Android 4.x&lt;/p&gt;</comment>
                            <comment id="13503712" author="sebb@apache.org" created="Mon, 26 Nov 2012 10:24:51 +0000"  >&lt;p&gt;Good catch. &lt;/p&gt;

&lt;p&gt;In the case of ACTIVE_LOCAL_DATA_CONNECTION_MODE, the code uses the __dataTimeout to protect against the server.accept() timing out.&lt;/p&gt;

&lt;p&gt;However otherwise (i.e. PASSIVE_LOCAL_DATA_CONNECTION_MODE), the socket timeout is not set until the end of the method, after several commands have been issued.&lt;/p&gt;

&lt;p&gt;The code has been changed a bit since 3.1, however there are still some paths where the newly created socket is used before the timeout has been set up.&lt;/p&gt;</comment>
                            <comment id="13503714" author="sebb@apache.org" created="Mon, 26 Nov 2012 10:35:42 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1413545&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1413545&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/NET-46&quot; title=&quot;[FTP] retrieveFileStream fails randomly or hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-46&quot;&gt;&lt;del&gt;NET-46&lt;/del&gt;&lt;/a&gt; retrieveFileStream fails randomly or hangs&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/net/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/net/trunk/src/main/java/org/apache/commons/net/ftp/FTPClient.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>154386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rrk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>