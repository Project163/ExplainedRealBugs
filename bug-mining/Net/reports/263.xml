<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-642] FTPSClient execPROT removes proxy settings</title>
                <link>https://issues.apache.org/jira/browse/NET-642</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;In Reference to &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-578&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/NET-578&lt;/a&gt;&lt;br/&gt;
I&apos;m trying to establish an FTPS Connection via a HTTP Proxy. The Control Connection is properly established, however the Moment I do execPROT the Proxy settings are resetted by call to setSocketFactory(new FTPSSocketFactory(context)); in FTPSClient.java:534.&lt;br/&gt;
This causes FTPSClients with a call to execPROT to actually ignore the proxy settings and attempt to contact the FTPS Server directly for data connections.&lt;br/&gt;
Since we are required to use PROT P this is currently blocking our feature for FTPS Connections via HTTP proxy.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.8.0_112&lt;br/&gt;
Linux 64bit&lt;/p&gt;</environment>
        <key id="13087557">NET-642</key>
            <summary>FTPSClient execPROT removes proxy settings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="DJGummikuh">Johannes Frank</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2017 12:13:45 +0000</created>
                <updated>Mon, 3 Jun 2024 13:18:42 +0000</updated>
                            <resolved>Mon, 7 Nov 2022 15:20:26 +0000</resolved>
                                    <version>3.6</version>
                                    <fixVersion>3.9.0</fixVersion>
                                    <component>FTP</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16121397" author="djgummikuh" created="Thu, 10 Aug 2017 10:12:52 +0000"  >&lt;p&gt;Setting it to critical because we already have two customers now that can&apos;t switch from FTP to FTPS due to the need of going through a Proxy.&lt;/p&gt;</comment>
                            <comment id="16122295" author="garydgregory" created="Thu, 10 Aug 2017 20:44:57 +0000"  >&lt;p&gt;Hi Johannes,&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Feel free to create a PR on GitHub with a unit test if you can.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16123134" author="djgummikuh" created="Fri, 11 Aug 2017 10:09:57 +0000"  >&lt;p&gt;I have the unit test but how and to which branch should I create a PR for that?&lt;/p&gt;

&lt;p&gt;Edit: NVM, done. You have a Pull Request &lt;a href=&quot;https://github.com/apache/commons-net/pull/27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-net/pull/27&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16143544" author="djgummikuh" created="Mon, 28 Aug 2017 09:17:01 +0000"  >&lt;p&gt;Any thoughts on my PR?&lt;/p&gt;</comment>
                            <comment id="16170126" author="djgummikuh" created="Mon, 18 Sep 2017 15:02:54 +0000"  >&lt;p&gt;&lt;b&gt;bump&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="16356894" author="sebb@apache.org" created="Thu, 8 Feb 2018 12:39:54 +0000"  >&lt;p&gt;execPROT(&quot;P&quot;) calls setSocketFactory which clears the proxy variable.&lt;br/&gt;
I don&apos;t know enough about this to determine whether execProt should always call setSocketFactory and/or whether setSocketFactory should clear the proxy.&lt;/p&gt;

&lt;p&gt;But an obvious work-round is to use:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Proxy p =client.getProxy(); &lt;span class=&quot;code-comment&quot;&gt;// save ...
&lt;/span&gt;client.execPROT(&lt;span class=&quot;code-quote&quot;&gt;&quot;P&quot;&lt;/span&gt;);
client.setProxy(p); &lt;span class=&quot;code-comment&quot;&gt;// ... restore the proxy&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does that fix the issue?&lt;/p&gt;</comment>
                            <comment id="16356931" author="djgummikuh" created="Thu, 8 Feb 2018 13:24:55 +0000"  >&lt;p&gt;No it doesn&apos;t because setProxy() resets the Socketfactory to a DefaultSocketFactory (which does not utilize TLS) - execPROT(&quot;P&quot;) earlier replaces the socket factory with a specific FTPSSocketFactory and initializes the SSL/TLS Context - all of which is lost when setProxy bluntly resets the socketfactory to default afterwards in your example.&lt;/p&gt;</comment>
                            <comment id="16356952" author="sebb@apache.org" created="Thu, 8 Feb 2018 13:45:08 +0000"  >&lt;p&gt;I see.&lt;/p&gt;

&lt;p&gt;So what needs to be done then?&lt;br/&gt;
I assume there is a good reason to clear the proxy in setSocketFactory, so dropping that might break some existing code.&lt;/p&gt;

&lt;p&gt;[It looks like there is an unrelated bug in execPROT - it calls initSslContext() (which sets context if necessary) after using context.&lt;br/&gt;
If the code works in other situations I assume it is because the context has already been set up.]&lt;/p&gt;</comment>
                            <comment id="16356981" author="sebb@apache.org" created="Thu, 8 Feb 2018 14:15:22 +0000"  >&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-637&quot; title=&quot;FTPSClient not using the Socks Proxy when opening passive data connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-637&quot;&gt;NET-637&lt;/a&gt; may be due to the same cause.&lt;/p&gt;

&lt;p&gt;It has a work-round which is to use system properties to define the SOCKS proxy.&lt;/p&gt;</comment>
                            <comment id="16357039" author="djgummikuh" created="Thu, 8 Feb 2018 15:02:14 +0000"  >&lt;p&gt;The issue with the java way of using proxies is that it&apos;s totally cumbersome. The fact that commons-net has its own proxy management is basically one of the major selling points for us to keep using commons-net. We already have this proxy management for several other things but whenever we have alternative approaches we take them. Main issue is that especially with proxies that have authentication you can basically only have one set of credentials for any given proxy server at any given time.&lt;/p&gt;</comment>
                            <comment id="16357162" author="sebb@apache.org" created="Thu, 8 Feb 2018 16:23:19 +0000"  >&lt;p&gt;Yes, I realise that.&lt;br/&gt;
But it is still a potential work-round for some circumstances.&lt;br/&gt;
And it also allows one to check that the code is otherwise working OK.&lt;/p&gt;</comment>
                            <comment id="16721590" author="dsylaiev" created="Fri, 14 Dec 2018 16:44:14 +0000"  >&lt;p&gt;Also have this issue. Can&apos;t use HTTP proxy for FTPS connection which require PROT P&lt;/p&gt;</comment>
                            <comment id="16768364" author="arrowemorse" created="Thu, 14 Feb 2019 14:59:52 +0000"  >&lt;p&gt;I have the exact same issue using HTTP Proxy. The failing combination is HTTP proxy +&#160; Local Passive Mode + execPROT = P&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FTPSClient ftps;&lt;/p&gt;

&lt;p&gt;Proxy proxy = &lt;b&gt;new&lt;/b&gt; Proxy(Type.&lt;b&gt;&lt;em&gt;HTTP&lt;/em&gt;&lt;/b&gt;, &lt;b&gt;new&lt;/b&gt; InetSocketAddress(&quot;&amp;lt;proxyhost&amp;gt;&quot;, &amp;lt;proxyport&amp;gt;));&lt;/p&gt;

&lt;p&gt;ftps.setProxy(proxy);&lt;/p&gt;

&lt;p&gt;ftps.execPROT(&quot;P&quot;);&lt;/p&gt;

&lt;p&gt;ftps.enterLocalPassiveMode();&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I could not make the mentioned work around work (adding explicit&#160;System.&lt;em&gt;setProperty&lt;/em&gt;(&quot;socksProxyPort&quot;, &quot;&amp;lt;port&amp;gt;&quot;);&#160;System.&lt;em&gt;setProperty&lt;/em&gt;(&quot;socksProxyHost&quot; ,&quot;&amp;lt;host&amp;gt;&quot;);&lt;/p&gt;

&lt;p&gt;&#160;Any suggested workaround?&lt;/p&gt;</comment>
                            <comment id="16938804" author="madeyedexter" created="Thu, 26 Sep 2019 16:58:06 +0000"  >&lt;p&gt;I am writing a fix for this. This issue has been open for too long and I think there should be a fix.&lt;/p&gt;</comment>
                            <comment id="16939233" author="dsylaiev" created="Fri, 27 Sep 2019 09:01:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/Talend/tdi-studio-se/tree/master/main/plugins/org.talend.designer.components.libs/libs_src/commons-net-ftps-proxy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Talend/tdi-studio-se/tree/master/main/plugins/org.talend.designer.components.libs/libs_src/commons-net-ftps-proxy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s additional lib with fix for commons-net&lt;/p&gt;</comment>
                            <comment id="17169316" author="sebb@apache.org" created="Sat, 1 Aug 2020 16:19:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsylaiev&quot; class=&quot;user-hover&quot; rel=&quot;dsylaiev&quot;&gt;dsylaiev&lt;/a&gt; Thanks for the suggested fix. However it uses reflection, which is risky as it depends on implementation details.&lt;/p&gt;</comment>
                            <comment id="17430056" author="ymihaylov" created="Mon, 18 Oct 2021 14:55:05 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Currently this is blocking us switching to apache-commons-net.&lt;/p&gt;

&lt;p&gt;Is there any plan soon to start working on this?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17430214" author="garydgregory" created="Mon, 18 Oct 2021 20:36:34 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ymihaylov&quot; class=&quot;user-hover&quot; rel=&quot;ymihaylov&quot;&gt;ymihaylov&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Feel free to provide a PR on GitHub.&#160;&lt;/p&gt;</comment>
                            <comment id="17432854" author="ymihaylov" created="Fri, 22 Oct 2021 08:04:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-net/pull/90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-net/pull/90&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13076598">NET-637</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13527438">NET-718</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13581392">NET-731</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13564027">NET-726</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hldz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>