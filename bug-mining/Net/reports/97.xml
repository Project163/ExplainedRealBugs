<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:44:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-291] enterLocalPassiveMode is set back to Active on connect</title>
                <link>https://issues.apache.org/jira/browse/NET-291</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>

&lt;p&gt;enterLocalPassiveMode (exhibit A) docs claim that mode will be set to PASSIVE_LOCAL_DATA_CONNECTION_MODE &quot;some other method such as&quot; enterLocalActiveMode is called  (exhibit B).  However, active mode is being entered after connect is called.   This behavior can be easily observed by modifying FtpExample by moving ftp.enterLocalPassiveMode()  to before ftp.connect(server).   &lt;/p&gt;

&lt;p&gt;Perhaps either the code or docs could be updated to remedy this.  Versions prior to 2.0 behaved as documented.&lt;/p&gt;

&lt;p&gt;exhibit A:&lt;br/&gt;
   /***&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set the current data connection mode to&lt;/li&gt;
	&lt;li&gt;&amp;lt;code&amp;gt; PASSIVE_LOCAL_DATA_CONNECTION_MODE &amp;lt;/code&amp;gt;.  Use this&lt;/li&gt;
	&lt;li&gt;method only for data transfers between the client and server.&lt;/li&gt;
	&lt;li&gt;This method causes a PASV command to be issued to the server&lt;/li&gt;
	&lt;li&gt;before the opening of every data connection, telling the server to&lt;/li&gt;
	&lt;li&gt;open a data port to which the client will connect to conduct&lt;/li&gt;
	&lt;li&gt;data transfers.  The FTPClient will stay in&lt;/li&gt;
	&lt;li&gt;&amp;lt;code&amp;gt; PASSIVE_LOCAL_DATA_CONNECTION_MODE &amp;lt;/code&amp;gt; until the&lt;/li&gt;
	&lt;li&gt;mode is changed by calling some other method such as&lt;/li&gt;
	&lt;li&gt;{@link #enterLocalActiveMode  enterLocalActiveMode() }
&lt;p&gt;     ***/&lt;br/&gt;
    public void enterLocalPassiveMode()&lt;/p&gt;
    {
        __dataConnectionMode = PASSIVE_LOCAL_DATA_CONNECTION_MODE;
        // These will be set when just before a data connection is opened
        // in _openDataConnection_()
        __passiveHost = null;
        __passivePort = -1;
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;exhibit B&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    protected void &lt;em&gt;connectAction&lt;/em&gt;() throws IOException&lt;/p&gt;
    {
        super._connectAction_();
        __initDefaults();
    }</description>
                <environment></environment>
        <key id="12433503">NET-291</key>
            <summary>enterLocalPassiveMode is set back to Active on connect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kbrown_at_turner">Kevin Brown</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2009 19:52:58 +0000</created>
                <updated>Wed, 29 Feb 2012 20:35:54 +0000</updated>
                            <resolved>Tue, 10 Jan 2012 19:39:43 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>3.1</fixVersion>
                                    <component>FTP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12763301" author="jboyd963" created="Wed, 7 Oct 2009 23:26:35 +0000"  >&lt;p&gt;This same behavior, calling __initDefaults() inside connectAction, also resets the fileType to its default, even though the javadocs for FTPClient.setFileType() indicate the type should stay the same until reset&lt;/p&gt;</comment>
                            <comment id="12887427" author="sebb@apache.org" created="Mon, 12 Jul 2010 17:15:03 +0000"  >&lt;p&gt;The call to __initiDefaults() has been present since the original code was imported.&lt;/p&gt;

&lt;p&gt;Presumably at least some of the fields do need to be reset as part of the connectAction method, but it&apos;s not immediately obvious which ones do need to be reset.&lt;/p&gt;

&lt;p&gt;__initDefaults() is also called from the ctor, disconnect() and reinitialize(). Makes sense for the ctor and re-init; not sure whether disconnect() should reset everything.&lt;/p&gt;

&lt;p&gt;Unfortunately changing this might cause some applications to break.&lt;/p&gt;</comment>
                            <comment id="13009346" author="sebb@apache.org" created="Mon, 21 Mar 2011 20:16:02 +0000"  >&lt;p&gt;Out of curiosity, I just tried the following with NET 1.0.0 and with NET 1.4.1:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FTPClient c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FTPClient();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;mode &quot;&lt;/span&gt;+c.getDataConnectionMode());
c.enterLocalPassiveMode();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;mode &quot;&lt;/span&gt;+c.getDataConnectionMode());
c.connect(...);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;mode &quot;&lt;/span&gt;+c.getDataConnectionMode());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mode 0
mode 2
mode 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;AFAICT, this shows that the behaviour has always been this way (unless one of the intervening releases was different, but that seems very unlikely)&lt;/p&gt;</comment>
                            <comment id="13183509" author="sebb@apache.org" created="Tue, 10 Jan 2012 19:39:43 +0000"  >&lt;p&gt;Javadoc updated to state that connect resets the mode&lt;/p&gt;</comment>
                            <comment id="13199381" author="johnb" created="Thu, 2 Feb 2012 23:57:59 +0000"  >&lt;p&gt;With version 3.1 I&apos;m still getting the problem &quot;active mode is being entered after connect is called&quot;, Once I fixed that issue it connected but was not able to make data connections.&lt;/p&gt;

&lt;p&gt;1) FTPHTTPClient still needs to force passive mode until the offending code in FTPClient that resets to active mode is fixed (maybe it used to do this?). 2) FTPHTTPClient overrides &lt;em&gt;&amp;#95;openDataConnection&amp;#95;(String,String)&lt;/em&gt; but should override &lt;em&gt;&amp;#95;openDataConnection&amp;#95;(int,String)&lt;/em&gt; instead because in the parent class the (int,Str) version just converts the first arg to a Str and calls the (Str,Str) version.  Doing this allows the subclass to capture both versions and make the needed behaviour change for Proxied connections.&lt;/p&gt;

&lt;p&gt;Patch is&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
diff -wu .orig/FTPHTTPClient.java FTPHTTPClient.java 
--- .orig/FTPHTTPClient.java	Wed Feb  1 14:57:41 2012
+++ FTPHTTPClient.java	Thu Feb  2 14:05:50 2012
@@ -63,11 +63,11 @@
      * @throws IllegalStateException if connection mode is not passive
      */
     @Override
-    protected Socket _openDataConnection_(int command, String arg) 
+    protected Socket _openDataConnection_(String command, String arg) 
     throws IOException {
         //Force local passive mode, active mode not supported by through proxy
         if (getDataConnectionMode() != PASSIVE_LOCAL_DATA_CONNECTION_MODE) {
-            throw new IllegalStateException(&quot;Only passive connection mode supported&quot;);
+            enterLocalPassiveMode();
         }
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
</comment>
                            <comment id="13199404" author="sebb@apache.org" created="Fri, 3 Feb 2012 00:28:21 +0000"  >&lt;p&gt;Implemented apart from changing to passive mode; try with the new snapshot just uploaded.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>154591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0yb5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>198278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>