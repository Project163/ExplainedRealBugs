<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-650] IMAPClient over proxy doesn&apos;t properly resolve DNS</title>
                <link>https://issues.apache.org/jira/browse/NET-650</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;IMAPClient when configured to use a socks proxy is not able to resolve DNS names through the proxy.&lt;/p&gt;


&lt;p&gt;See attached sample code, if I use it with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -DsocksProxyHost=localhost -DsocksProxyPort=16003 -cp .:./commons-net-3.6.jar imapproxy imap.server.test.com user1 userpass
connect error: java.net.UnknownHostException: imap.server.test.com: unknown error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;vs if I use it with the appropriate IP:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -DsocksProxyHost=localhost -DsocksProxyPort=16003 -cp .:./commons-net-3.6.jar imapproxy 10.250.3.127 user1 userpass
* OK IMAP4rev1 proxy server ready
IMAP: 10.250.3.127 143
AAAA LOGIN *******
AAAA OK [CAPABILITY IMAP4rev1 ACL BINARY CATENATE CHILDREN CONDSTORE ENABLE ESEARCH ESORT I18NLEVEL=1 ID IDLE LIST-EXTENDED LIST-STATUS LITERAL+ LOGIN-REFERRALS MULTIAPPEND NAMESPACE QRESYNC QUOTA RIGHTS=ektx SASL-IR SEARCHRES SORT THREAD=ORDEREDSUBJECT UIDPLUS UNSELECT WITHIN XLIST] LOGIN completed
AAAB LOGOUT
* BYE 10.250.3.127 Zimbra IMAP4rev1 server closing connection
AAAB OK LOGOUT completed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13130321">NET-650</key>
            <summary>IMAPClient over proxy doesn&apos;t properly resolve DNS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="msm">Matthew McGillis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jan 2018 21:02:58 +0000</created>
                <updated>Sat, 7 Oct 2023 18:51:58 +0000</updated>
                            <resolved>Mon, 9 Jan 2023 13:41:45 +0000</resolved>
                                    <version>3.6</version>
                                    <fixVersion>3.10.0</fixVersion>
                                    <component>IMAP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16323283" author="sebb@apache.org" created="Fri, 12 Jan 2018 00:28:03 +0000"  >&lt;p&gt;Any suggestions for a patch?&lt;/p&gt;</comment>
                            <comment id="16323469" author="msm" created="Fri, 12 Jan 2018 02:52:20 +0000"  >&lt;p&gt;Well this is the details of the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.net.UnknownHostException: imap.server.test.com
	at java.net.InetAddress.getAllByName0(InetAddress.java:1280)
	at java.net.InetAddress.getAllByName(InetAddress.java:1192)
	at java.net.InetAddress.getAllByName(InetAddress.java:1126)
	at java.net.InetAddress.getByName(InetAddress.java:1076)
	at org.apache.commons.net.SocketClient.connect(SocketClient.java:202)
	at imapproxy.main(imapproxy.java:45)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it looks like your connect code calls InetAddress directly to resolve the name which will happen on the server that code is run from. Which is not what we need.&lt;/p&gt;

&lt;p&gt;I have attached a new program that works at a socket level in both cases:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -DsocksProxyHost=localhost -DsocksProxyPort=16003 -cp .:./commons-net-3.6.jar socketproxy imap.server.test.com user1 userpass
* OK IMAP4rev1 proxy server ready
$ java -DsocksProxyHost=localhost -DsocksProxyPort=16003 -cp .:./commons-net-3.6.jar socketproxy 10.250.3.127 user1 userpass
* OK IMAP4rev1 proxy server ready
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me know if that doesn&apos;t help I&apos;m not going to have time to work out a patch but hopefully the above should turn into a simple replacement in the appropriate place.&lt;/p&gt;</comment>
                            <comment id="16341532" author="sebb@apache.org" created="Fri, 26 Jan 2018 20:15:05 +0000"  >&lt;p&gt;I don&apos;t have any way of testing this.&lt;/p&gt;

&lt;p&gt;However if you say that socketproxy.java works, this suggests that InetSocketAddress must be getting the host info over the proxy.&lt;br/&gt;
 In which case it should be possible to apply the same fix to imapprox.java&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;i.e.&#160;replace&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ic.connect(iserver,&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(iport));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ic.connect(InetSocketAddress(iserver, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(iport)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does that work for you?&lt;/p&gt;</comment>
                            <comment id="16341640" author="msm" created="Fri, 26 Jan 2018 21:47:41 +0000"  >&lt;p&gt;See the API for the socket connect &lt;a href=&quot;http://commons.apache.org/proper/commons-net/apidocs/org/apache/commons/net/SocketClient.html#connect&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-net/apidocs/org/apache/commons/net/SocketClient.html#connect&lt;/a&gt; it doesn&apos;t support what you suggest.&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ javac -cp ./commons-net-3.6.jar imapproxy.java 
imapproxy.java:44: error: no suitable method found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connect(InetSocketAddress)
      ic.connect(rip);
        ^
    method SocketClient.connect(InetAddress) is not applicable
      (argument mismatch; InetSocketAddress cannot be converted to InetAddress)
    method SocketClient.connect(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) is not applicable
      (argument mismatch; InetSocketAddress cannot be converted to &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
Note: Some messages have been simplified; recompile with -Xdiags:verbose to get full output
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even if it did I would consider that a work around and not a fix for the underlying issue.&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16341698" author="sebb@apache.org" created="Fri, 26 Jan 2018 22:23:52 +0000"  >&lt;p&gt;OK, sorry, I had confused InetAddress with InetSocketAddress.&lt;/p&gt;

&lt;p&gt;Does the imapproxy2.java code work? (it compiles for me)&lt;/p&gt;
</comment>
                            <comment id="16341706" author="msm" created="Fri, 26 Jan 2018 22:29:05 +0000"  >&lt;p&gt;This would be an outline of a test case you might want to setup up or figure out how to build in to a regression test:&lt;/p&gt;

&lt;p&gt;1. Consider two hosts A and B&lt;br/&gt;
 2. Setup the host file on A so it only knows host B&#160;as say: test.domain.com&lt;br/&gt;
 3. Setup the host file on B so it only knows it self as say: proxy.domain.com&lt;br/&gt;
 4. Confirm ping proxy.domain.com from A fails on host lookup&lt;br/&gt;
 5. From A ssh to B creating a socks proxy&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ ssh -D localhost:16000 test.domain.com
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;6. now run the socketproxy.java on A&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ java -DsocksProxyHost=localhost -DsocksProxyPort=16000 socketproxy proxy.domain.com
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As socketproxy is currently written you would need something listening on the imap port of host B so it returns something when connected to so you can see that the above works. But you can replace the port number in socketproxy to anything that will respond. In the above since ssh is on B to support the socks proxy you could use the ssh port which when you connect should return something like:&lt;/p&gt;

&lt;p&gt;$ nc localhost 22&lt;br/&gt;
 SSH-2.0-OpenSSH_7.6&lt;/p&gt;</comment>
                            <comment id="16341717" author="msm" created="Fri, 26 Jan 2018 22:37:14 +0000"  >&lt;p&gt;This is what I get when using your imapproxy2 code with a hostname:&lt;/p&gt;

&lt;p&gt;connect error: java.lang.NullPointerException&lt;br/&gt;
connect error: java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;I also get the same thing when I use an IP address.&lt;/p&gt;</comment>
                            <comment id="16341732" author="msm" created="Fri, 26 Jan 2018 22:49:21 +0000"  >&lt;p&gt;InetSocketAddress should work regardless of proxy or not. So you should be able to test that you have found a working InetSocketAddress solution simply by connecting to anything you would normally.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ java -cp .:./commons-net-3.6.jar socketproxy imap.comcast.net
* OK IMAP4 ready
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then once you are using InetSocketAddress locally fine it should continue to work for when -DsocksProxyHost and -DsocksProxyPort are specified.&lt;/p&gt;</comment>
                            <comment id="16341770" author="sebb@apache.org" created="Fri, 26 Jan 2018 23:11:54 +0000"  >&lt;p&gt;Thanks for the info.&lt;/p&gt;

&lt;p&gt;I left a bit out:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
_socket_ = _socketFactory_.createSocket(); &lt;span class=&quot;code-comment&quot;&gt;// add &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line
&lt;/span&gt;_socket_.connect(endpoint, connectTimeout); &lt;span class=&quot;code-comment&quot;&gt;// before &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That should fix the NPE.&lt;/p&gt;

&lt;p&gt;AFAICT the difference between InetSocketAddress and InetAddress is that the former allows the IP address to be unresolved.&lt;br/&gt;
In which case the Socket is passed the hostname instead of an IP address.&lt;/p&gt;

&lt;p&gt;This brings up something else: it&apos;s possible that the hostname has different values on the local and far side of the proxy, so I think any fix would need to take that into account.&lt;/p&gt;</comment>
                            <comment id="16341777" author="msm" created="Fri, 26 Jan 2018 23:15:25 +0000"  >&lt;p&gt;&amp;gt; This brings up something else: it&apos;s possible that the hostname has different values on the local and far side of the proxy, so I think any fix would need to take that into account.&lt;/p&gt;

&lt;p&gt;Not sure what your thinking but if you have directed something to use a proxy then you want the remote mapping of the name and not the local one.&lt;/p&gt;</comment>
                            <comment id="16341784" author="msm" created="Fri, 26 Jan 2018 23:22:25 +0000"  >&lt;p&gt;I get this with those lines:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ javac -cp .:./commons-net-3.6.jar imapproxy2.java 
imapproxy2.java:17: error: cannot find symbol
            _socket_.connect(endpoint, connectTimeout); &lt;span class=&quot;code-comment&quot;&gt;// before &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;                             ^
  symbol:   variable endpoint
  location: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClient
1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16341796" author="sebb@apache.org" created="Fri, 26 Jan 2018 23:37:32 +0000"  >&lt;p&gt;I forget I changed my code slightly to debug the NPE.&lt;br/&gt;
It should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
_hostname_ = host; &lt;span class=&quot;code-comment&quot;&gt;// after &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line
&lt;/span&gt;_socket_ = _socketFactory_.createSocket(); &lt;span class=&quot;code-comment&quot;&gt;// ++ add &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line ++
&lt;/span&gt;_socket_.connect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(host, port), connectTimeout); &lt;span class=&quot;code-comment&quot;&gt;// before &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16341799" author="sebb@apache.org" created="Fri, 26 Jan 2018 23:43:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;if you have directed something to use a proxy then you want the remote mapping of the name and not the local one.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not necessarily.&lt;br/&gt;
There may be no remote mapping, so you might want to add your own local definition.&lt;br/&gt;
Also the code may not know that a proxy is being used.&lt;/p&gt;

&lt;p&gt;As it stands, the constructor new InetSocketAddress(host, port) will use the local definition if there is one.&lt;br/&gt;
To force the use of the remote mapping, one would need to use InetSocketAddress.createUnresolved(host,port)&lt;/p&gt;</comment>
                            <comment id="16341803" author="msm" created="Fri, 26 Jan 2018 23:48:35 +0000"  >&lt;p&gt;Your latest changes work as expected for both host name and IP of proxy.&lt;/p&gt;</comment>
                            <comment id="16341808" author="sebb@apache.org" created="Fri, 26 Jan 2018 23:53:10 +0000"  >&lt;p&gt;OK great, thanks for testing.&lt;/p&gt;

&lt;p&gt;Now just need to work out how to implement this without changing existing behaviour for the non-proxy case.&lt;/p&gt;</comment>
                            <comment id="16341812" author="msm" created="Fri, 26 Jan 2018 23:55:28 +0000"  >&lt;p&gt;&amp;gt; There may be no remote mapping, so you might want to add your own local definition.&lt;/p&gt;

&lt;p&gt;I would want to know that the remote does not know how to resolve the name.&lt;/p&gt;

&lt;p&gt;&amp;gt; Also the code may not know that a proxy is being used.&lt;/p&gt;

&lt;p&gt;But I do because I told it I wanted it to use the proxy. If I don&apos;t want to use the proxy I won&apos;t specify it.&lt;/p&gt;

&lt;p&gt;&amp;gt; As it stands, the constructor new InetSocketAddress(host, port) will use the local definition if there is one.&lt;br/&gt;
To force the use of the remote mapping, one would need to use InetSocketAddress. InetSocketAddress(host,port)&lt;/p&gt;

&lt;p&gt;Not following the above you sure you wrote it correctly.&lt;/p&gt;</comment>
                            <comment id="16341826" author="sebb@apache.org" created="Sat, 27 Jan 2018 00:05:45 +0000"  >&lt;p&gt;If the remote does not have a mapping, you have to use/remember the IP address.&lt;br/&gt;
It would be nice to be able to define the IP as a local mapping.&lt;/p&gt;

&lt;p&gt;The NET code does not know that you defined the proxy on the command line.&lt;br/&gt;
I don&apos;t think there is a way to find it out.&lt;/p&gt;</comment>
                            <comment id="16341839" author="msm" created="Sat, 27 Jan 2018 00:18:30 +0000"  >&lt;p&gt;&amp;gt; If the remote does not have a mapping, you have to use/remember the IP address.&lt;br/&gt;
It would be nice to be able to define the IP as a local mapping.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that gets very confusing in a number of contexts. I might like it in some cases but not sure I would want it on default. Have you actually tested that a name existing in both places but different ends up always using the local one? To my thinking I want the remote name mapping first. Maybe if it doesn&apos;t exist remotely then look locally. &lt;/p&gt;

&lt;p&gt;I haven&apos;t looked at the actual InetSocketAddress code but some code does now about the proxy and InetSocketAddress may also know this or it may not if you have looked at the code and nothing about the proxy is in it OK but the proxy as I have outlined it is easly knowable simply by checking the property setting. Also keep in mind where this ticket came from which was adding support for something in common-net to know about a proxy so you could specifically configure it in the code. I&apos;m sort of wondering if that has been done consistently with property settings what happens if they overlap.&lt;/p&gt;</comment>
                            <comment id="16341849" author="sebb@apache.org" created="Sat, 27 Jan 2018 00:28:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe if it doesn&apos;t exist remotely then look locally.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You only find out if the remote has the definition once you connect to it, so a fall back would require retrying the connection.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;some code does &lt;span class=&quot;error&quot;&gt;&amp;#91;k&amp;#93;&lt;/span&gt;now about the proxy&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, of course, but AFAICT that is buried deep (in the native code ?)&lt;/p&gt;

&lt;p&gt;Like I wrote, this needs more work and probably some additional options before it can be implemented.&lt;br/&gt;
However you do have a simple work-round which you can use until a proper solution is developed.&lt;/p&gt;</comment>
                            <comment id="16341858" author="msm" created="Sat, 27 Jan 2018 00:40:02 +0000"  >&lt;p&gt;&amp;gt; Yes, of course, but AFAICT that is buried deep (in the native code ?)&lt;/p&gt;

&lt;p&gt;All that happens on the command line is system properties are set. Any code can get a system property value.&lt;/p&gt;

&lt;p&gt;Agree this needs more work.&lt;/p&gt;

&lt;p&gt;I think if you substitute InetSocketAddress in the correct place all your existing regression tests will still pass. Plus it will now support the command line. How things behave in edge cases is worth testing but my guess is that InetSocketAddress probably does what I have suggested. Which is to use the remote name mapping. I think it would be a fairly unusual situation that a local DNS infrastructure knows about a proxy remote infrastructure. But I could see that as a nice configurable feature.&lt;/p&gt;

&lt;p&gt;This also leaves investigation/testing in how the previous ticket implementation of proxy support interacts with all of this.&lt;/p&gt;</comment>
                            <comment id="16341887" author="msm" created="Sat, 27 Jan 2018 01:33:13 +0000"  >&lt;p&gt;If InetSocketAddress acts as I have indicated then if someone wants to add the feature of using a local mapping over a remote mapping they can easily add it simply by passing the connect the locally mapped name.&lt;/p&gt;

&lt;p&gt;InetSocketAddress simply passes IP&apos;s through as does the proxy so its easy to do on top of a InetSocketAddress base.&lt;/p&gt;

&lt;p&gt;However without InetSocketAddress we have no way to get a remote name properly resolved.&lt;/p&gt;

&lt;p&gt;So I think this could be very close it would be interesting to see if just making this InetSocketAddress change in the Common-Net socket code passes all existing tests. If it does then it fixes this bug at no cost to any existing functionality.&lt;/p&gt;</comment>
                            <comment id="16343146" author="sebb@apache.org" created="Mon, 29 Jan 2018 09:49:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;If InetSocketAddress acts ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The above is ambiguous; the InetSocketAddress constructor behaves differently from InetSocketAddress.createUnresolved().&lt;br/&gt;
Only the latter ignores local mappings.&lt;br/&gt;
Since that would change existing behaviour, taking that approach would need to be optional.&lt;/p&gt;

&lt;p&gt;I agree that InetSocketAddress (ISA)  would need to be used somehow to solve the issue.&lt;br/&gt;
The issue is how to do it without changing existing behaviour unnecessarily.&lt;/p&gt;

&lt;p&gt;Also note that passing existing tests does not guarantee that the behaviour is unchanged.&lt;br/&gt;
This area is difficult to test thoroughly and the tests are likely to be incomplete.&lt;br/&gt;
There are several independent conditions here:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;proxy or no proxy&lt;/li&gt;
	&lt;li&gt;existing implementation or ISA constructor or createUnresolved&lt;/li&gt;
	&lt;li&gt;hostname is undefined or defined locally or defined remotely or both.&lt;br/&gt;
That&apos;s 24 combinations without allowing for IP addresses or different ports.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In my tests, there is a problem when using names that have no mapping.&lt;br/&gt;
Currently this results in UnknownHostException with or without a proxy.&lt;/p&gt;

&lt;p&gt;But with the ISA constructor it results in the following error when a proxy is used:&lt;br/&gt;
java.net.SocketException: Malformed reply from SOCKS server&lt;br/&gt;
Not exactly obvious, and it may vary between proxies/OSes.&lt;br/&gt;
I think this could problems for existing applications using NET.&lt;/p&gt;

&lt;p&gt;There may be other differences in behaviour (other than the desired one).&lt;/p&gt;

&lt;p&gt;Given that the problem only exists for hostnames that are not in public DNS and there are various simple work-rounds, I don&apos;t think the existing behaviour should be changed unconditionally. It may be worth adding optional behaviour to implement the feature.&lt;/p&gt;</comment>
                            <comment id="16343921" author="msm" created="Mon, 29 Jan 2018 20:00:06 +0000"  >&lt;p&gt;The question I had is can we add something without impacting current behavior.&lt;/p&gt;

&lt;p&gt;Focus on the no proxy case, hostname defined or undefined locally.&lt;/p&gt;

&lt;p&gt;If we replace existing implementation and use ISA constructor. This is what the source code is for it. (It has other constructors but lets assume this common case only)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; More ...InetSocketAddress(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hostname, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; port) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (port &amp;lt; 0 || port &amp;gt; 0xFFFF) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;port out of range:&quot;&lt;/span&gt; + port);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hostname == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;hostname can&apos;t be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            addr = InetAddress.getByName(hostname);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(UnknownHostException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hostname = hostname;
            addr = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.port = port;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does all existing behavior work.&lt;/p&gt;

&lt;p&gt;My guess is yes.&lt;/p&gt;

&lt;p&gt;If you have the hostname you get the local IP and we have no proxy so the local IP works and gets you to desired destination.&lt;/p&gt;

&lt;p&gt;If you have no hostname then you get the expected and desired response of UnknownHostException this is not a problem in this case it is a informative response.&lt;/p&gt;

&lt;p&gt;If all other existing regression tests pass then the above is a simple fix that keeps all current functionality.&lt;/p&gt;

&lt;p&gt;However the above allows the proxy to now also work in this fashion&lt;br/&gt;
1. the host does not exist locally but does remotely (most common case I think)&lt;br/&gt;
2. the host does exist locally and works remotely (sort of unusual case I think)&lt;br/&gt;
3. the host does not exist locally or remotely (this you get an odd error for but an error is appropriate just might be nice to provide a better one)&lt;br/&gt;
4. the host does exist locally but does not work remotely (sort of unusual case I think expect you would get some sort of error that may or may not be obvious but an error is appropriate)&lt;br/&gt;
5. the host exists in both places but the local ip does not work on remote only the remote ip does (this case is broken in this initial implementation you think the remote name and ip are getting used but instead you are using a local ip remotely for the name you think would work)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13553260">NIFI-12188</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12905744" name="imapproxy.java" size="912" author="msm" created="Thu, 11 Jan 2018 21:02:45 +0000"/>
                            <attachment id="12907945" name="imapproxy2.java" size="1183" author="sebb" created="Fri, 26 Jan 2018 22:22:39 +0000"/>
                            <attachment id="12905790" name="socketproxy.java" size="863" author="msm" created="Fri, 12 Jan 2018 02:52:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3othr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>