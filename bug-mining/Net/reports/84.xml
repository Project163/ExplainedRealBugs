<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:44:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-2] [net] The FTPClient is unable to list files on Japanese servers</title>
                <link>https://issues.apache.org/jira/browse/NET-2</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;I ran into some problems attempting to get the FTPClient to be able to list&lt;br/&gt;
files on a Solaris server which is configured to use the Japanese locale.  The&lt;br/&gt;
problem turned out to be caused by the regular expressions used to parse the&lt;br/&gt;
individual lines received from the server.&lt;/p&gt;

&lt;p&gt;It works great with the English locale, but on Japanese servers, every single&lt;br/&gt;
line of output was failing to match.&lt;/p&gt;

&lt;p&gt;I modified the UnixFTPEntryParser to work correctly with either English or&lt;br/&gt;
Japanese locales. I also added appropriate test cases to make sure every thing&lt;br/&gt;
works.&lt;/p&gt;

&lt;p&gt;Obviously other languages are going to most likely have similar problems.  The&lt;br/&gt;
way I modified the regex, should work correctly with any language that uses&lt;br/&gt;
numerical months and adds units after the month, day, and/or years.&lt;/p&gt;

&lt;p&gt;I also found that there were some encoding problems.  The FTP class allows the&lt;br/&gt;
user to configure a control encoding using the setControlEncoding() method.  But&lt;br/&gt;
this encoding was not being used is several places throughout the code.&lt;/p&gt;

&lt;p&gt;I had to add a couple new methods to handle encoding, but all existing public&lt;br/&gt;
methods were left unchanged and function the same as they did before.&lt;/p&gt;

&lt;p&gt;In addition, if the user specified an invalid control encoding when used with&lt;br/&gt;
the Ant task, it was kicking out some some nasty NPEs because the ant task always&lt;br/&gt;
tries to log off. That could be viewed as a problem with the Ant task, but I made&lt;br/&gt;
the FTP class handle this case more gracefully.  The problem is that the&lt;br/&gt;
isConnected method returns true when the socket has been opened, but the&lt;br/&gt;
protocol is not yet all the way initialized. The logout and disconnect methods&lt;br/&gt;
now handle these cases correctly.&lt;/p&gt;

&lt;p&gt;I will post right back with the patch.   This message was also posted on the dev&lt;br/&gt;
list.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Leif&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12341646">NET-2</key>
            <summary>[net] The FTPClient is unable to list files on Japanese servers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="leif@tanukisoftware.com">Leif Mortenson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Aug 2004 13:26:45 +0000</created>
                <updated>Thu, 20 Sep 2007 05:31:02 +0000</updated>
                            <resolved>Thu, 20 Sep 2007 05:31:02 +0000</resolved>
                                    <version>Nightly Builds</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12407284" author="leif@tanukisoftware.com" created="Wed, 18 Aug 2004 13:27:44 +0000"  >&lt;p&gt;Here is the full patch:&lt;/p&gt;

&lt;p&gt;cvs diff -u &lt;br/&gt;
cvs server: Diffing .&lt;br/&gt;
cvs server: Diffing proposal&lt;br/&gt;
cvs server: Diffing proposal/ftp2&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache/commons&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache/commons/net&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache/commons/net/ftp&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache/commons/net/ftp/ftp2&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/java/org/apache/commons/net/ftp/ftp2/parser&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache/commons&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache/commons/net&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache/commons/net/ftp&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache/commons/net/ftp/ftp2&lt;br/&gt;
cvs server: Diffing proposal/ftp2/src/test/org/apache/commons/net/ftp/ftp2/parser&lt;br/&gt;
cvs server: Diffing src&lt;br/&gt;
cvs server: Diffing src/java&lt;br/&gt;
cvs server: Diffing src/java/examples&lt;br/&gt;
cvs server: Diffing src/java/org&lt;br/&gt;
cvs server: Diffing src/java/org/apache&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/bsd&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/ftp&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/FTP.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTP.java,v&lt;br/&gt;
retrieving revision 1.16&lt;br/&gt;
diff -u -r1.16 FTP.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTP.java	8 Aug 2004 20:38:35 -0000	1.16&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTP.java	18 Aug 2004 06:11:31 -0000&lt;br/&gt;
@@ -420,6 +420,11 @@&lt;br/&gt;
      ***/&lt;br/&gt;
     public int sendCommand(String command, String args) throws IOException&lt;br/&gt;
     {&lt;br/&gt;
+        if ((__commandBuffer == null) || (_controlOutput == null))&lt;br/&gt;
+        &lt;/p&gt;
{
+            throw new IOException(&quot;Not connected.&quot;);
+        }
&lt;p&gt;+        &lt;br/&gt;
         String message;&lt;/p&gt;

&lt;p&gt;         __commandBuffer.setLength(0);&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/FTPClient.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTPClient.java,v&lt;br/&gt;
retrieving revision 1.38&lt;br/&gt;
diff -u -r1.38 FTPClient.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTPClient.java	29 Jun 2004 04:54:30&lt;br/&gt;
-0000	1.38&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTPClient.java	18 Aug 2004 06:11:32 -0000&lt;br/&gt;
@@ -1931,8 +1931,8 @@&lt;br/&gt;
         if ((socket = &lt;em&gt;openDataConnection&lt;/em&gt;(FTPCommand.NLST, pathname)) == null)&lt;br/&gt;
             return null;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reader =&lt;/li&gt;
	&lt;li&gt;new BufferedReader(new InputStreamReader(socket.getInputStream()));&lt;br/&gt;
+        reader = new BufferedReader(&lt;br/&gt;
+            new InputStreamReader(socket.getInputStream(), getControlEncoding()));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         results = new Vector();&lt;br/&gt;
         while ((line = reader.readLine()) != null)&lt;br/&gt;
@@ -2338,7 +2338,7 @@&lt;br/&gt;
         }&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;engine.readServerList(socket.getInputStream());&lt;br/&gt;
+        engine.readServerList(socket.getInputStream(), getControlEncoding());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         socket.close();&lt;/p&gt;

&lt;p&gt;@@ -2425,7 +2425,7 @@&lt;br/&gt;
         if ((socket = &lt;em&gt;openDataConnection&lt;/em&gt;(FTPCommand.LIST, pathname)) == null)&lt;br/&gt;
             return new FTPFile&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;results = parser.parseFileList(socket.getInputStream());&lt;br/&gt;
+        results = parser.parseFileList(socket.getInputStream(),&lt;br/&gt;
getControlEncoding());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         socket.close();&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/commons/net/ftp/FTPFileEntryParserImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTPFileEntryParserImpl.java,v&lt;br/&gt;
retrieving revision 1.8&lt;br/&gt;
diff -u -r1.8 FTPFileEntryParserImpl.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTPFileEntryParserImpl.java	22 Apr 2004&lt;br/&gt;
00:48:07 -0000	1.8&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTPFileEntryParserImpl.java	18 Aug 2004&lt;br/&gt;
06:11:32 -0000&lt;br/&gt;
@@ -34,7 +34,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The constructor for a FTPFileEntryParserImpl object.&lt;br/&gt;
      */&lt;br/&gt;
     public FTPFileEntryParserImpl()&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;{&lt;br/&gt;
+    {&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;@@ -47,16 +47,37 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;@param listStream The InputStream from which the file list should be&lt;/li&gt;
	&lt;li&gt;read.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;/li&gt;
	&lt;li&gt;@return The list of file information contained in the given path.  null&lt;/li&gt;
	&lt;li&gt;if the list could not be obtained or if there are no files in&lt;/li&gt;
	&lt;li&gt;the directory.&lt;/li&gt;
	&lt;li&gt;@exception java.io.IOException  If an I/O error occurs reading the&lt;br/&gt;
listStream.&lt;br/&gt;
      ***/&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FTPFile[] parseFileList(InputStream listStream) throws IOException&lt;br/&gt;
+    public FTPFile[] parseFileList(InputStream listStream, String encoding)&lt;br/&gt;
throws IOException
     {
-        FTPFileList ffl = FTPFileList.create(listStream, this);
+        FTPFileList ffl = FTPFileList.create(listStream, this, encoding);
         return ffl.getFiles();
+    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    /***&lt;br/&gt;
+     * Parses an FTP server file listing and converts it into a usable format&lt;br/&gt;
+     * in the form of an array of &amp;lt;code&amp;gt; FTPFile &amp;lt;/code&amp;gt; instances.  If the&lt;br/&gt;
+     * file list contains no files, &amp;lt;code&amp;gt; null &amp;lt;/code&amp;gt; should be&lt;br/&gt;
+     * returned, otherwise an array of &amp;lt;code&amp;gt; FTPFile &amp;lt;/code&amp;gt; instances&lt;br/&gt;
+     * representing the files in the directory is returned.&lt;br/&gt;
+     * &amp;lt;p&amp;gt;&lt;br/&gt;
+     * @param listStream The InputStream from which the file list should be&lt;br/&gt;
+     *        read.&lt;br/&gt;
+     * @return The list of file information contained in the given path.  null&lt;br/&gt;
+     *     if the list could not be obtained or if there are no files in&lt;br/&gt;
+     *     the directory.&lt;br/&gt;
+     * @exception java.io.IOException  If an I/O error occurs reading the&lt;br/&gt;
listStream.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @deprecated The version of this method which takes an encoding should be&lt;br/&gt;
used.&lt;br/&gt;
+     ***/&lt;br/&gt;
+    public FTPFile[] parseFileList(InputStream listStream) throws IOException&lt;br/&gt;
+    &lt;/p&gt;
{
+        return parseFileList(listStream, null);
     }

&lt;p&gt;     /**&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/FTPFileList.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTPFileList.java,v&lt;br/&gt;
retrieving revision 1.13&lt;br/&gt;
diff -u -r1.13 FTPFileList.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTPFileList.java	21 Apr 2004 23:30:33&lt;br/&gt;
-0000	1.13&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTPFileList.java	18 Aug 2004 06:11:32 -0000&lt;br/&gt;
@@ -82,6 +82,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the output of the LIST command was returned&lt;/li&gt;
	&lt;li&gt;@param parser the default &amp;lt;code&amp;gt;FTPFileEntryParser&amp;lt;/code&amp;gt; to be used&lt;/li&gt;
	&lt;li&gt;by this object.  This may later be changed using the init() method.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;br/&gt;
      *&lt;/li&gt;
	&lt;li&gt;@return the &amp;lt;code&amp;gt;FTPFileList&amp;lt;/code&amp;gt; created, with an initialized&lt;/li&gt;
	&lt;li&gt;of unparsed lines of output.  Will be null if the listing cannot&lt;br/&gt;
@@ -90,26 +91,61 @@&lt;/li&gt;
	&lt;li&gt;Thrown on any failure to read from the socket.&lt;br/&gt;
      */&lt;br/&gt;
     public static FTPFileList create(InputStream stream,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FTPFileEntryParser parser)&lt;br/&gt;
+                                     FTPFileEntryParser parser,&lt;br/&gt;
+                                     String encoding)&lt;br/&gt;
             throws IOException
     {
         FTPFileList list = new FTPFileList(parser);
-        list.readStream(stream);
+        list.readStream(stream, encoding);
         parser.preParse(list.lines);
         return list;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;br/&gt;
+     * The only way to create an &amp;lt;code&amp;gt;FTPFileList&amp;lt;/code&amp;gt; object.  Invokes&lt;br/&gt;
+     * the private constructor and then reads the stream  supplied stream to&lt;br/&gt;
+     * build the intermediate array of &quot;lines&quot; which will later be parsed&lt;br/&gt;
+     * into &amp;lt;code&amp;gt;FTPFile&amp;lt;/code&amp;gt; object.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @param stream The input stream created by reading the socket on which&lt;br/&gt;
+     * the output of the LIST command was returned&lt;br/&gt;
+     * @param parser the default &amp;lt;code&amp;gt;FTPFileEntryParser&amp;lt;/code&amp;gt; to be used&lt;br/&gt;
+     * by this object.  This may later be changed using the init() method.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @return the &amp;lt;code&amp;gt;FTPFileList&amp;lt;/code&amp;gt; created, with an initialized&lt;br/&gt;
+     * of unparsed lines of output.  Will be null if the listing cannot&lt;br/&gt;
+     * be read from the stream.&lt;br/&gt;
+     * @exception IOException&lt;br/&gt;
+     *                   Thrown on any failure to read from the socket.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @deprecated The version of this method which takes an encoding should be&lt;br/&gt;
used.&lt;br/&gt;
+     */&lt;br/&gt;
+    public static FTPFileList create(InputStream stream,&lt;br/&gt;
+                                     FTPFileEntryParser parser)&lt;br/&gt;
+            throws IOException&lt;br/&gt;
+    &lt;/p&gt;
{
+        return create(stream, parser, null);
+    }
&lt;p&gt;+&lt;br/&gt;
+    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;internal method for reading the input into the &amp;lt;code&amp;gt;lines&amp;lt;/code&amp;gt; vector.&lt;br/&gt;
      *&lt;/li&gt;
	&lt;li&gt;@param stream The socket stream on which the input will be read.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;br/&gt;
      *&lt;/li&gt;
	&lt;li&gt;@exception IOException thrown on any failure to read the stream&lt;br/&gt;
      */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void readStream(InputStream stream) throws IOException&lt;br/&gt;
+    public void readStream(InputStream stream, String encoding) throws IOException&lt;br/&gt;
     {&lt;/li&gt;
	&lt;li&gt;BufferedReader reader =&lt;/li&gt;
	&lt;li&gt;new BufferedReader(new InputStreamReader(stream));&lt;br/&gt;
+        BufferedReader reader;&lt;br/&gt;
+        if (encoding == null)&lt;br/&gt;
+        
{
+            reader = new BufferedReader(new InputStreamReader(stream));
+        }&lt;br/&gt;
+        else&lt;br/&gt;
+        {
+            reader = new BufferedReader(new InputStreamReader(stream, encoding));
+        }&lt;br/&gt;
 &lt;br/&gt;
         String line = this.parser.readNextEntry(reader);&lt;br/&gt;
 &lt;br/&gt;
@@ -119,6 +155,20 @@&lt;br/&gt;
             line = this.parser.readNextEntry(reader);&lt;br/&gt;
         }&lt;br/&gt;
         reader.close();&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    /**&lt;br/&gt;
+     * internal method for reading the input into the &amp;lt;code&amp;gt;lines&amp;lt;/code&amp;gt; vector.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @param stream The socket stream on which the input will be read.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @exception IOException thrown on any failure to read the stream&lt;br/&gt;
+     *&lt;br/&gt;
+     * @deprecated The version of this method which takes an encoding should be&lt;br/&gt;
used.&lt;br/&gt;
+     */&lt;br/&gt;
+    public void readStream(InputStream stream) throws IOException&lt;br/&gt;
+    {
+        readStream(stream, null);
     }&lt;br/&gt;
 &lt;br/&gt;
     /**&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/FTPFileListParser.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTPFileListParser.java,v&lt;br/&gt;
retrieving revision 1.12&lt;br/&gt;
diff -u -r1.12 FTPFileListParser.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTPFileListParser.java	29 Jun 2004&lt;br/&gt;
02:16:33 -0000	1.12&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTPFileListParser.java	18 Aug 2004&lt;br/&gt;
06:11:32 -0000&lt;br/&gt;
@@ -45,10 +45,29 @@&lt;br/&gt;
      * &amp;lt;p&amp;gt;&lt;br/&gt;
      * @param listStream The InputStream from which the file list should be&lt;br/&gt;
      *        read.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;br/&gt;
      * @return The list of file information contained in the given path.  null&lt;br/&gt;
      *     if the list could not be obtained or if there are no files in&lt;br/&gt;
      *     the directory.&lt;br/&gt;
      * @exception IOException  If an I/O error occurs reading the listStream.&lt;br/&gt;
+     ***/&lt;br/&gt;
+    FTPFile[] parseFileList(InputStream listStream, String encoding) throws&lt;br/&gt;
IOException;&lt;br/&gt;
+&lt;br/&gt;
+    /***&lt;br/&gt;
+     * Parses an FTP server file listing and converts it into a usable format&lt;br/&gt;
+     * in the form of an array of &amp;lt;code&amp;gt; FTPFile &amp;lt;/code&amp;gt; instances.  If the&lt;br/&gt;
+     * file list contains no files, &amp;lt;code&amp;gt; null &amp;lt;/code&amp;gt; should be&lt;br/&gt;
+     * returned, otherwise an array of &amp;lt;code&amp;gt; FTPFile &amp;lt;/code&amp;gt; instances&lt;br/&gt;
+     * representing the files in the directory is returned.&lt;br/&gt;
+     * &amp;lt;p&amp;gt;&lt;br/&gt;
+     * @param listStream The InputStream from which the file list should be&lt;br/&gt;
+     *        read.&lt;br/&gt;
+     * @return The list of file information contained in the given path.  null&lt;br/&gt;
+     *     if the list could not be obtained or if there are no files in&lt;br/&gt;
+     *     the directory.&lt;br/&gt;
+     * @exception IOException  If an I/O error occurs reading the listStream.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @deprecated The version of this method which takes an encoding should be&lt;br/&gt;
used.&lt;br/&gt;
      ***/&lt;br/&gt;
     FTPFile[] parseFileList(InputStream listStream) throws IOException;&lt;br/&gt;
 &lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/FTPListParseEngine.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/FTPListParseEngine.java,v&lt;br/&gt;
retrieving revision 1.7&lt;br/&gt;
diff -u -r1.7 FTPListParseEngine.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/FTPListParseEngine.java	22 Apr 2004&lt;br/&gt;
00:48:07 -0000	1.7&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/FTPListParseEngine.java	18 Aug 2004&lt;br/&gt;
06:11:33 -0000&lt;br/&gt;
@@ -87,19 +87,39 @@&lt;br/&gt;
      * on the server.&lt;br/&gt;
      *&lt;br/&gt;
      * @param stream input stream provided by the server socket.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;br/&gt;
      *&lt;br/&gt;
      * @exception IOException&lt;br/&gt;
      *                   thrown on any failure to read from the sever.&lt;br/&gt;
      */&lt;br/&gt;
-    public void readServerList(InputStream stream)&lt;br/&gt;
+    public void readServerList(InputStream stream, String encoding)&lt;br/&gt;
     throws IOException&lt;br/&gt;
     {
         this.entries = new LinkedList();
-        readStream(stream);
+        readStream(stream, encoding);
         this.parser.preParse(this.entries);
         resetIterator();
     }&lt;br/&gt;
 &lt;br/&gt;
+    /**&lt;br/&gt;
+     * handle the iniitial reading and preparsing of the list returned by&lt;br/&gt;
+     * the server.  After this method has completed, this object will contain&lt;br/&gt;
+     * a list of unparsed entries (Strings) each referring to a unique file&lt;br/&gt;
+     * on the server.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @param stream input stream provided by the server socket.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @exception IOException&lt;br/&gt;
+     *                   thrown on any failure to read from the sever.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @deprecated The version of this method which takes an encoding should be&lt;br/&gt;
used.&lt;br/&gt;
+     */&lt;br/&gt;
+    public void readServerList(InputStream stream)&lt;br/&gt;
+    throws IOException&lt;br/&gt;
+    {
+        readServerList(stream, null);
+    }&lt;br/&gt;
+&lt;br/&gt;
 &lt;br/&gt;
     /**&lt;br/&gt;
      * Internal method for reading the input into the &amp;lt;code&amp;gt;entries&amp;lt;/code&amp;gt; list.&lt;br/&gt;
@@ -110,14 +130,22 @@&lt;br/&gt;
      * and other data that will not be part of the final listing.&lt;br/&gt;
      *&lt;br/&gt;
      * @param stream The socket stream on which the input will be read.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;br/&gt;
      *&lt;br/&gt;
      * @exception IOException&lt;br/&gt;
      *                   thrown on any failure to read the stream&lt;br/&gt;
      */&lt;br/&gt;
-    private void readStream(InputStream stream) throws IOException&lt;br/&gt;
+    private void readStream(InputStream stream, String encoding) throws IOException&lt;br/&gt;
     {&lt;br/&gt;
-        BufferedReader reader =&lt;br/&gt;
-            new BufferedReader(new InputStreamReader(stream));&lt;br/&gt;
+        BufferedReader reader;&lt;br/&gt;
+        if (encoding == null)&lt;br/&gt;
+        {+            reader = new BufferedReader(new InputStreamReader(stream));+        }
&lt;p&gt;+        else&lt;br/&gt;
+        &lt;/p&gt;
{
+            reader = new BufferedReader(new InputStreamReader(stream, encoding));
+        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         String line = this.parser.readNextEntry(reader);&lt;/p&gt;

&lt;p&gt;cvs server: Diffing src/java/org/apache/commons/net/ftp/parser&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java,v&lt;br/&gt;
retrieving revision 1.18&lt;br/&gt;
diff -u -r1.18 UnixFTPEntryParser.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java	28 Jul&lt;br/&gt;
2004 05:01:47 -0000	1.18&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java	18 Aug&lt;br/&gt;
2004 06:11:33 -0000&lt;br/&gt;
@@ -35,7 +35,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;to determine which month is matched by the parser&lt;br/&gt;
      */&lt;br/&gt;
     private static final String MONTHS =&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)&quot;;&lt;br/&gt;
+        &quot;Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec&quot;;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;this is the regular expression used by this parser.&lt;br/&gt;
@@ -55,6 +55,15 @@&lt;/li&gt;
	&lt;li&gt;execution is on&lt;/li&gt;
	&lt;li&gt;T   the 1000 bit is turned on, and execution is off (undefined bit-&lt;/li&gt;
	&lt;li&gt;state)&lt;br/&gt;
+     *&lt;br/&gt;
+     * Japanese formatted listings use numerical months, and the month, day&lt;br/&gt;
+     *  and year are each followed by a single kanji character.  Rather than&lt;br/&gt;
+     *  testing for the specific kanji characters, this expression allows any&lt;br/&gt;
+     *  non-numerical, non-space character(s).  This should make other languages&lt;br/&gt;
+     *  which use a similar syntax work as well.&lt;br/&gt;
+     *&lt;br/&gt;
+     * (For Japanese, the matched characters are &apos;\u6708&apos; after month,&lt;br/&gt;
+     *  &apos;\u65e5&apos; after day, and &apos;\u5e74&apos; after year.)&lt;br/&gt;
      */&lt;br/&gt;
     private static final String REGEX =&lt;br/&gt;
         &quot;(&lt;span class=&quot;error&quot;&gt;&amp;#91;bcdlfmpSs-&amp;#93;&lt;/span&gt;)&quot;&lt;br/&gt;
@@ -63,9 +72,9 @@&lt;br/&gt;
         + &quot;(\\S+)&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;br/&gt;
         + &quot;(?&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;\\S+)&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+)?&quot;&lt;br/&gt;
         + &quot;(\\d+)&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;+ MONTHS + &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;/li&gt;
	&lt;li&gt;+ &quot;((?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;)|(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-2&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;)|(?:3&lt;span class=&quot;error&quot;&gt;&amp;#91;0-1&amp;#93;&lt;/span&gt;))&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;/li&gt;
	&lt;li&gt;+ &quot;((\\d\\d\\d\\d)|((?:&lt;span class=&quot;error&quot;&gt;&amp;#91;01&amp;#93;&lt;/span&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;d)|(?:2&lt;span class=&quot;error&quot;&gt;&amp;#91;0123&amp;#93;&lt;/span&gt;)|(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;1-9&amp;#93;&lt;/span&gt;))&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;012345&amp;#93;&lt;/span&gt;\\d))&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;br/&gt;
+        + &quot;((?:&quot; + MONTHS + &quot;)|(?&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;?&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;)|(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-1&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;))))&lt;span class=&quot;error&quot;&gt;&amp;#91;^0-9\\s&amp;#93;&lt;/span&gt;*?&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;br/&gt;
+        + &quot;(?&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;)|(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;0-2&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;)|(?:3&lt;span class=&quot;error&quot;&gt;&amp;#91;0-1&amp;#93;&lt;/span&gt;))(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;^0-9\\s&amp;#93;&lt;/span&gt;*?))&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;br/&gt;
+        +&lt;br/&gt;
&quot;((?&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;\\d\\d\\d\\d)&lt;span class=&quot;error&quot;&gt;&amp;#91;^0-9\\s&amp;#93;&lt;/span&gt;*?)|((?:&lt;span class=&quot;error&quot;&gt;&amp;#91;01&amp;#93;&lt;/span&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;d)|(?:2&lt;span class=&quot;error&quot;&gt;&amp;#91;0123&amp;#93;&lt;/span&gt;)|(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;1-9&amp;#93;&lt;/span&gt;))&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;012345&amp;#93;&lt;/span&gt;\\d))&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;&lt;br/&gt;
         + &quot;(\\S+)(&lt;br class=&quot;atl-forced-newline&quot; /&gt;s*.*)&quot;;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;@@ -94,7 +103,6 @@&lt;br/&gt;
      */&lt;br/&gt;
     public FTPFile parseFTPEntry(String entry)&lt;br/&gt;
     {&lt;br/&gt;
-&lt;br/&gt;
         FTPFile file = new FTPFile();&lt;br/&gt;
         file.setRawListing(entry);&lt;br/&gt;
         int type;&lt;br/&gt;
@@ -114,7 +122,7 @@&lt;br/&gt;
             String min = group(24);&lt;br/&gt;
             String name = group(25);&lt;br/&gt;
             String endtoken = group(26);&lt;br/&gt;
-&lt;br/&gt;
+            &lt;br/&gt;
             // bcdlfmpSs-&lt;br/&gt;
             switch (typeStr.charAt(0))&lt;/p&gt;
             {
@@ -130,8 +138,8 @@
                 // break; - fall through
             case &apos;f&apos;:
             case &apos;-&apos;:
-            	type = FTPFile.FILE_TYPE;
-            	break;
+                type = FTPFile.FILE_TYPE;
+                break;
             default:
                 type = FTPFile.UNKNOWN_TYPE;
             }
&lt;p&gt;@@ -189,8 +197,17 @@&lt;/p&gt;

&lt;p&gt;             try&lt;br/&gt;
             {&lt;br/&gt;
+                int month;&lt;br/&gt;
                 int pos = MONTHS.indexOf(mo);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int month = pos / 4;&lt;br/&gt;
+                if ( pos &amp;gt;= 0 )&lt;br/&gt;
+                
{
+                    month = pos / 4;
+                }
&lt;p&gt;+                else&lt;br/&gt;
+                &lt;/p&gt;
{
+                    // Expected to be base-0
+                    month = Integer.parseInt( mo ) - 1;
+                }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                 if (null != yr)&lt;br/&gt;
                 {&lt;br/&gt;
Index: src/java/org/apache/commons/net/ftp/parser/VMSFTPEntryParser.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/java/org/apache/commons/net/ftp/parser/VMSFTPEntryParser.java,v&lt;br/&gt;
retrieving revision 1.24&lt;br/&gt;
diff -u -r1.24 VMSFTPEntryParser.java&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/net/ftp/parser/VMSFTPEntryParser.java	28 Jul&lt;br/&gt;
2004 05:01:47 -0000	1.24&lt;br/&gt;
+++ src/java/org/apache/commons/net/ftp/parser/VMSFTPEntryParser.java	18 Aug&lt;br/&gt;
2004 06:11:33 -0000&lt;br/&gt;
@@ -94,18 +94,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;@param listStream The InputStream from which the file list should be&lt;/li&gt;
	&lt;li&gt;read.&lt;br/&gt;
+     * @param encoding The encoding to use, null for system default.&lt;/li&gt;
	&lt;li&gt;@return The list of file information contained in the given path.  null&lt;/li&gt;
	&lt;li&gt;if the list could not be obtained or if there are no files in&lt;/li&gt;
	&lt;li&gt;the directory.&lt;/li&gt;
	&lt;li&gt;@exception IOException  If an I/O error occurs reading the listStream.&lt;br/&gt;
      ***/&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FTPFile[] parseFileList(InputStream listStream) throws IOException {&lt;br/&gt;
+    public FTPFile[] parseFileList(InputStream listStream, String encoding)&lt;br/&gt;
throws IOException 
{
         FTPListParseEngine engine = new FTPListParseEngine(this);
-        engine.readServerList(listStream);
+        engine.readServerList(listStream, encoding);
         return engine.getFiles();
     }
&lt;p&gt;-&lt;br/&gt;
-&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Parses a line of a VMS FTP server file listing and converts it into a&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/io&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/nntp&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/pop3&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/smtp&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/telnet&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/tftp&lt;br/&gt;
cvs server: Diffing src/java/org/apache/commons/net/util&lt;br/&gt;
cvs server: Diffing src/test&lt;br/&gt;
cvs server: Diffing src/test/org&lt;br/&gt;
cvs server: Diffing src/test/org/apache&lt;br/&gt;
cvs server: Diffing src/test/org/apache/commons&lt;br/&gt;
cvs server: Diffing src/test/org/apache/commons/net&lt;br/&gt;
cvs server: Diffing src/test/org/apache/commons/net/ftp&lt;br/&gt;
cvs server: Diffing src/test/org/apache/commons/net/ftp/parser&lt;br/&gt;
Index: src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java,v&lt;br/&gt;
retrieving revision 1.14&lt;br/&gt;
diff -u -r1.14 UnixFTPEntryParserTest.java
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java	29&lt;br/&gt;
Jul 2004 11:38:36 -0000	1.14&lt;br/&gt;
+++ src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java	18&lt;br/&gt;
Aug 2004 06:11:33 -0000&lt;br/&gt;
@@ -14,7 +14,6 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.commons.net.ftp.parser;&lt;br/&gt;
-&lt;br/&gt;
 import java.util.Calendar;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import junit.framework.TestSuite;&lt;br/&gt;
@@ -69,7 +68,9 @@&lt;br/&gt;
         &quot;-rwxr-xr-t   1 500      500             0 Mar 25 08:21 testStickyExec&quot;,&lt;br/&gt;
         &quot;&lt;del&gt;rwSr-Sr&lt;/del&gt;-   1 500      500             0 Mar 25 08:22 testSuid&quot;,&lt;br/&gt;
         &quot;&lt;del&gt;rwsr-sr&lt;/del&gt;-   1 500      500             0 Mar 25 08:23 testSuidExec&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 1        3518644 May 25 12:12 std&quot;&lt;br/&gt;
+        &quot;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 1        3518644 May 25 12:12 std&quot;,&lt;br/&gt;
+        &quot;&lt;del&gt;rw-rw&lt;/del&gt;---   1 ep1adm   sapsys         0  8\u6708 17\u65e5  20:10&lt;br/&gt;
caerrinf&quot;,&lt;br/&gt;
+        &quot;&lt;del&gt;rw-rw&lt;/del&gt;---   1 ep1adm   sapsys         0  6\u6708  3\u65e5 2003\u5e74&lt;br/&gt;
\u8a66\u9a13\u30d5\u30a1\u30a4\u30eb.csv&quot;&lt;br/&gt;
     };&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;br/&gt;
@@ -215,6 +216,78 @@&lt;br/&gt;
         cal.set(Calendar.DATE,2);&lt;br/&gt;
         cal.set(Calendar.HOUR_OF_DAY, 15);&lt;br/&gt;
         cal.set(Calendar.MINUTE, 13);&lt;br/&gt;
+        assertEquals(df.format(cal.getTime()),&lt;br/&gt;
+                     df.format(f.getTimestamp().getTime()));&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    /**&lt;br/&gt;
+     * @see&lt;br/&gt;
org.apache.commons.net.ftp.parser.FTPParseTestFramework#testParseFieldsOnFile()&lt;br/&gt;
+     */&lt;br/&gt;
+    public void testParseFieldsOnFileJapaneseTime() throws Exception&lt;br/&gt;
+    {&lt;br/&gt;
+        FTPFile f = getParser().parseFTPEntry(&quot;-rwxr-xr-x   2 user     group  &lt;br/&gt;
      4096 3\u6708  2\u65e5 15:13 zxbox&quot;);&lt;br/&gt;
+        assertNotNull(&quot;Could not parse entry.&quot;,&lt;br/&gt;
+                      f);&lt;br/&gt;
+        assertTrue(&quot;Should have been a file.&quot;,&lt;br/&gt;
+                   f.isFile());&lt;br/&gt;
+        checkPermissions(f);&lt;br/&gt;
+        assertEquals(2,&lt;br/&gt;
+                     f.getHardLinkCount());&lt;br/&gt;
+        assertEquals(&quot;user&quot;,&lt;br/&gt;
+                     f.getUser());&lt;br/&gt;
+        assertEquals(&quot;group&quot;,&lt;br/&gt;
+                     f.getGroup());&lt;br/&gt;
+        assertEquals(&quot;zxbox&quot;,&lt;br/&gt;
+                     f.getName());&lt;br/&gt;
+        assertEquals(4096,&lt;br/&gt;
+                     f.getSize());&lt;br/&gt;
+&lt;br/&gt;
+        Calendar cal = Calendar.getInstance();&lt;br/&gt;
+        cal.set(Calendar.MONTH, Calendar.MARCH);&lt;br/&gt;
+&lt;br/&gt;
+        cal.set(Calendar.DATE,1);&lt;br/&gt;
+        cal.set(Calendar.HOUR_OF_DAY, 0);&lt;br/&gt;
+        cal.set(Calendar.MINUTE, 0);&lt;br/&gt;
+        cal.set(Calendar.SECOND, 0);&lt;br/&gt;
+        if (f.getTimestamp().getTime().before(cal.getTime())) &lt;/p&gt;
{
+            cal.add(Calendar.YEAR, -1);
+        }
&lt;p&gt;+        cal.set(Calendar.DATE,2);&lt;br/&gt;
+        cal.set(Calendar.HOUR_OF_DAY, 15);&lt;br/&gt;
+        cal.set(Calendar.MINUTE, 13);&lt;br/&gt;
+        assertEquals(df.format(cal.getTime()),&lt;br/&gt;
+                     df.format(f.getTimestamp().getTime()));&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    /**&lt;br/&gt;
+     * @see&lt;br/&gt;
org.apache.commons.net.ftp.parser.FTPParseTestFramework#testParseFieldsOnFile()&lt;br/&gt;
+     */&lt;br/&gt;
+    public void testParseFieldsOnFileJapaneseYear() throws Exception&lt;br/&gt;
+    &lt;/p&gt;
{
+        FTPFile f = getParser().parseFTPEntry(&quot;-rwxr-xr-x   2 user     group  
      4096 3\u6708  2\u65e5 2003\u5e74 \u8a66\u9a13\u30d5\u30a1\u30a4\u30eb.csv&quot;);
+        assertNotNull(&quot;Could not parse entry.&quot;,
+                      f);
+        assertTrue(&quot;Should have been a file.&quot;,
+                   f.isFile());
+        checkPermissions(f);
+        assertEquals(2,
+                     f.getHardLinkCount());
+        assertEquals(&quot;user&quot;,
+                     f.getUser());
+        assertEquals(&quot;group&quot;,
+                     f.getGroup());
+        assertEquals(&quot;\u8a66\u9a13\u30d5\u30a1\u30a4\u30eb.csv&quot;,
+                     f.getName());
+        assertEquals(4096,
+                     f.getSize());
+
+        Calendar cal = Calendar.getInstance();
+        cal.set(Calendar.YEAR, 2003);
+        cal.set(Calendar.MONTH, Calendar.MARCH);
+        cal.set(Calendar.DATE,2);
+        cal.set(Calendar.HOUR_OF_DAY, 0);
+        cal.set(Calendar.MINUTE, 0);
+        cal.set(Calendar.SECOND, 0);
         assertEquals(df.format(cal.getTime()),
                      df.format(f.getTimestamp().getTime()));
     }
&lt;p&gt;Index: src/test/org/apache/commons/net/ftp/parser/VMSFTPEntryParserTest.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/net/src/test/org/apache/commons/net/ftp/parser/VMSFTPEntryParserTest.java,v&lt;br/&gt;
retrieving revision 1.16&lt;br/&gt;
diff -u -r1.16 VMSFTPEntryParserTest.java&lt;br/&gt;
&amp;#8212; src/test/org/apache/commons/net/ftp/parser/VMSFTPEntryParserTest.java	29 Jun&lt;br/&gt;
2004 04:54:32 -0000	1.16&lt;br/&gt;
+++ src/test/org/apache/commons/net/ftp/parser/VMSFTPEntryParserTest.java	18 Aug&lt;br/&gt;
2004 06:11:33 -0000&lt;br/&gt;
@@ -91,7 +91,7 @@&lt;br/&gt;
         VMSFTPEntryParser parser = new VMSFTPEntryParser();&lt;br/&gt;
         FTPListParseEngine engine = new FTPListParseEngine(parser);&lt;br/&gt;
         engine.readServerList(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new ByteArrayInputStream(fullListing.getBytes()));&lt;br/&gt;
+                new ByteArrayInputStream(fullListing.getBytes()), &quot;ISO-8859-1&quot;);&lt;br/&gt;
         FTPFile[] files = engine.getFiles();&lt;br/&gt;
         assertEquals(6, files.length);&lt;br/&gt;
         assertFileInListing(files, &quot;2-JUN.LIS&quot;);&lt;br/&gt;
@@ -111,7 +111,7 @@&lt;br/&gt;
         VMSFTPEntryParser parser = new VMSVersioningFTPEntryParser();&lt;br/&gt;
         FTPListParseEngine engine = new FTPListParseEngine(parser);&lt;br/&gt;
         engine.readServerList(&lt;/li&gt;
	&lt;li&gt;new ByteArrayInputStream(fullListing.getBytes()));&lt;br/&gt;
+                new ByteArrayInputStream(fullListing.getBytes()), &quot;ISO-8859-1&quot;);&lt;br/&gt;
         FTPFile[] files = engine.getFiles();&lt;br/&gt;
         assertEquals(3, files.length);&lt;br/&gt;
         assertFileInListing(files, &quot;1-JUN.LIS;1&quot;);&lt;br/&gt;
cvs server: Diffing src/test/org/apache/commons/net/telnet&lt;br/&gt;
cvs server: Diffing xdocs&lt;br/&gt;
cvs server: Diffing xdocs/images&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12407285" author="rwinston@eircom.net" created="Fri, 3 Dec 2004 23:49:39 +0000"  >&lt;p&gt;I have applied the parts of this patch that deal keeping the encoding consistent&lt;br/&gt;
throughout the codebase. Thanks, Leif. &lt;/p&gt;</comment>
                            <comment id="12407286" author="rwinston@eircom.net" created="Fri, 15 Apr 2005 23:12:06 +0000"  >&lt;p&gt;Many thanks for the patch Leif. I applied parts of it for release 1.3, however I&lt;br/&gt;
have not applied the whole patch, so I felt it better to mark as WONTFIX rather&lt;br/&gt;
than FIXED.&lt;/p&gt;</comment>
                            <comment id="12407287" author="scohen@apache.org" created="Sat, 16 Apr 2005 11:35:23 +0000"  >&lt;p&gt;Which parts have already been applied and which parts have you decide not to&lt;br/&gt;
apply, Rory?  &lt;/p&gt;

&lt;p&gt;The business about numeric date formats can handled by the new FTPClientConfig&lt;br/&gt;
system.  I don&apos;t think we should be entertaining any more patches dealing with&lt;br/&gt;
Regexes to handle date formats.  The new approach, using FTPClientConfigs uses&lt;br/&gt;
SimpleDateFormats to handle the dates.&lt;/p&gt;

&lt;p&gt;The stuff with encodings is another matter.  There may be merit to it but I&lt;br/&gt;
haven&apos;t had time to look at it yet, either.  &lt;/p&gt;</comment>
                            <comment id="12407288" author="scohen@apache.org" created="Sat, 16 Apr 2005 11:40:40 +0000"  >&lt;p&gt;Oh, duh.  You DID say what parts of the patch you applied.  That part of my last&lt;br/&gt;
post should be ignored.  You&apos;ve applied the encoding stuff.  That is great.  &lt;/p&gt;

&lt;p&gt;But the date formats are now handled a different way as I indicated in my&lt;br/&gt;
previous post.  So WONTFIX is the appropriate designation here.  There is a&lt;br/&gt;
solution to the Date Format problem.  It is the new FTPClientConfig system. &lt;br/&gt;
Therefore I am changing this to FIXED.  Your committing of Mr. Mortenson&apos;s patch&lt;br/&gt;
fixes the encoding problem.  And the FTPClientConfig date parsing fixes the date&lt;br/&gt;
problem.&lt;/p&gt;</comment>
                            <comment id="12407289" author="scohen@apache.org" created="Sat, 16 Apr 2005 11:46:55 +0000"  >&lt;p&gt;Aargh.  My last post was garbled too.  Here is what I meant to say:&lt;/p&gt;

&lt;p&gt;But the date formats are now handled a different way as I indicated in my&lt;br/&gt;
previous post.  So WONTFIX is NOT the appropriate designation here.  There is&lt;br/&gt;
now a solution to the date formatting problem in the new FTPClientConfig system&lt;br/&gt;
with its Date Format options.  Your committing of Mr. Mortenson&apos;s patch fixes&lt;br/&gt;
the encoding problem.  And the FTPClientConfig date parsing fixes the date&lt;br/&gt;
problem.  Since both pieces of this are now fixed, I have changed the status&lt;br/&gt;
accordingly, to FIXED.&lt;/p&gt;


</comment>
                            <comment id="12407290" author="rwinston@eircom.net" created="Sat, 16 Apr 2005 20:39:47 +0000"  >&lt;p&gt;Steve,&lt;/p&gt;

&lt;p&gt;I applied the part solely dealing with encosng for 1.3. I didnt apply any&lt;br/&gt;
changes to the regex portion.&lt;/p&gt;</comment>
                            <comment id="12407291" author="scohen@apache.org" created="Sat, 16 Apr 2005 20:49:05 +0000"  >&lt;p&gt;(In reply to comment #7)&lt;br/&gt;
&amp;gt; Steve,&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; I applied the part solely dealing with encosng for 1.3. I didnt apply any&lt;br/&gt;
&amp;gt; changes to the regex portion.&lt;/p&gt;

&lt;p&gt;I think you did, didn&apos;t you?  Isn&apos;t that what change 161502 is about in&lt;br/&gt;
UnixFTPEntryParser?  You may have intended it for another issue, but I think it&lt;br/&gt;
solves this one.&lt;/p&gt;
</comment>
                            <comment id="12407292" author="scohen@apache.org" created="Mon, 18 Apr 2005 06:00:35 +0000"  >&lt;p&gt;Well, it may not have been fixed at the time I marked it so, but I believe that&lt;br/&gt;
with my most recent changes of this weekend, it is.&lt;/p&gt;

&lt;p&gt;Mr. Mortenson:&lt;br/&gt;
Here is the story as far as the numeric date format goes.  Back in January, in&lt;br/&gt;
response to several infrequent but persistent complaints about being unable to&lt;br/&gt;
parse dates written with month names in languages other than English (leaving&lt;br/&gt;
aside for the moment languages like Japanese which require encoding changes as&lt;br/&gt;
you know), a new system based on the new class FTPClientConfig was created. &lt;br/&gt;
This allows, among other things, a user to pass to the parser a SimpleDateFormat&lt;br/&gt;
string to parse a date not formatted in the &quot;standard&quot; way, as well as to pass&lt;br/&gt;
in a set of month names other than those of the locale in which the client is&lt;br/&gt;
operating.&lt;/p&gt;

&lt;p&gt;Somewhat later, a user informed us (it was a first for us) that there now&lt;br/&gt;
existed unix FTP servers that used a numeric date format.  Thinking that I had&lt;br/&gt;
fortuitously solved that problem without even realizing it, I pointed him at the&lt;br/&gt;
new code.  Turned out, it didn&apos;t quite work - the user could pass in the new&lt;br/&gt;
date format, but there was another piece of code that pulled out the Date&lt;br/&gt;
portion of the listing and sent it to the DateFormat for parsing.  That part did&lt;br/&gt;
not work with the all-numeric date format.  After the fixes of this weekend, it&lt;br/&gt;
now does.  This is why the bug is marked fixed.&lt;/p&gt;

&lt;p&gt;However, it&apos;s not seamless.  The default date format is still the classic &quot;MMM&lt;br/&gt;
dd yyyy&quot; one, not the yyyy-MM-dd that you need to handle all-numeric formatted&lt;br/&gt;
dates.  There is a backward-compatibility problem with the servers that do not&lt;br/&gt;
use the all-numeric format.  It is my fond wish that the all-numeric format will&lt;br/&gt;
be adopted soon and become ubiquitous.  Then we can think about changing the&lt;br/&gt;
default behavior.  But for now, if you construct the parser with the constructor&lt;br/&gt;
that takes an FTPClientConfig properly initialized you should be able to get&lt;br/&gt;
this to work.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>154343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lpr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>