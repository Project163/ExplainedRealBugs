<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-516] parser problem occurs if the filename contains one or more characters of which the second byte of Shift-JIS code is 0x85</title>
                <link>https://issues.apache.org/jira/browse/NET-516</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;Problem occurs if the filename contains one or more characters of which the second byte of Shift-JIS code is 0x85, on a windows Japanese machine when listing file names from IIS FTP server.&lt;br/&gt;
This was working fine in commons-net-1.4.0.jar . &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;This relates to the NTFTPEntryParser&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;windows&lt;/p&gt;</environment>
        <key id="12669610">NET-516</key>
            <summary>parser problem occurs if the filename contains one or more characters of which the second byte of Shift-JIS code is 0x85</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="asha k s">Asha K S</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Sep 2013 06:59:07 +0000</created>
                <updated>Thu, 26 Nov 2015 16:34:47 +0000</updated>
                            <resolved>Thu, 11 Dec 2014 19:17:04 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>3.4</fixVersion>
                                    <component>FTP</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13773657" author="sebb@apache.org" created="Sat, 21 Sep 2013 01:11:46 +0000"  >&lt;p&gt;What problem?&lt;/p&gt;</comment>
                            <comment id="13789575" author="kaif akbar" created="Tue, 8 Oct 2013 19:19:38 +0000"  >&lt;p&gt;It is not listing all such expected files with commons-net-2.0.jar (as shown in notworking.png) whereas it was listing all such files with commons-net-1.4.0.jar (as shown in working.png).&lt;/p&gt;</comment>
                            <comment id="13813475" author="kaif akbar" created="Tue, 5 Nov 2013 00:40:27 +0000"  >&lt;p&gt;Can you please update on this bug?&lt;/p&gt;</comment>
                            <comment id="13814438" author="sebb@apache.org" created="Wed, 6 Nov 2013 00:25:32 +0000"  >&lt;p&gt;Does the test program throw an error?&lt;br/&gt;
If so what?&lt;/p&gt;

&lt;p&gt;Is there a public site that can be used to test against?&lt;/p&gt;</comment>
                            <comment id="13906796" author="sunnykumar" created="Thu, 20 Feb 2014 09:23:42 +0000"  >&lt;p&gt;The issue is happening because of the regular expression used from commons-net-2.0. The regex used by the commons-net 2.0 is &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(\\S+)\\s+(\\S+)\\s+(?:(&amp;lt;DIR&amp;gt;)|([0-9]+))\\s+(\\S.*)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you carefully look at the last capturing group&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(\\S.*)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;first it looks for a non whitespace character then for any character.&lt;/p&gt;

&lt;p&gt;According the java pattern class documentation 0x85 is a line terminator and also .* by default only matches printable characters and wont match any control characters. Creating the pattern using Pattern.DOTALL makes control characters also to match. I am attaching a sample program for reproducing the issue.&lt;/p&gt;</comment>
                            <comment id="13906799" author="sunnykumar" created="Thu, 20 Feb 2014 09:27:22 +0000"  >&lt;p&gt;showing the used regex wont work when control chars are present&lt;/p&gt;</comment>
                            <comment id="13906905" author="sebb@apache.org" created="Thu, 20 Feb 2014 12:17:50 +0000"  >&lt;p&gt;The RE used in 1.4.0 has the same final capture group.&lt;br/&gt;
However, that version used Apache ORO, rather than the Java RE engine which is now used, and the defaults were perhaps different.&lt;/p&gt;</comment>
                            <comment id="13906920" author="sunnykumar" created="Thu, 20 Feb 2014 12:40:51 +0000"  >&lt;p&gt;Apache ORO uses perl flavored regex in which .(dot) metacharacter matches any character except \n. There by it is able to match the regex and extract the file name.&lt;/p&gt;</comment>
                            <comment id="13906931" author="sebb@apache.org" created="Thu, 20 Feb 2014 13:04:18 +0000"  >&lt;p&gt;AFAICT the &quot;.&quot; meta-character does match a control character; it is only line terminators that are excluded by default.&lt;/p&gt;

&lt;p&gt;I think there are at least 2 possible fixes here:&lt;/p&gt;

&lt;p&gt;1) Change the last part of tthe RE to&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(?s)(\\S.*)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This should fix the problem for the NT parser.&lt;/p&gt;

&lt;p&gt;2) Change the RE processing to include Pattern.DOTALL.&lt;br/&gt;
This will affect all Regex matchers (probably some of these have the same issue with multi-byte chars).&lt;br/&gt;
The other Regexes need to be checked to ensure that they don&apos;t expect &quot;.&quot; to exclude line terminators.&lt;/p&gt;</comment>
                            <comment id="13906991" author="sebb@apache.org" created="Thu, 20 Feb 2014 14:19:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Apache ORO uses perl flavored regex in which .(dot) metacharacter matches any character except \n&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks! This suggests another possible approach which is to use the following RE&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(\\S[^\\n]*)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That would be closest to the ORO original.&lt;br/&gt;
However it means changing all the REs, and is not necessarily better than using DOTALL in the shared parent implementation.&lt;/p&gt;</comment>
                            <comment id="13907242" author="sunnykumar" created="Thu, 20 Feb 2014 17:53:04 +0000"  >  &lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;   However it means changing all the REs, and is not necessarily better than using DOTALL in the shared parent implementation.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;  I agree to that. As the same issue may exists in some other parser as well so changing the shared implementation would be the good approach.&lt;/p&gt;</comment>
                            <comment id="13907314" author="sebb@apache.org" created="Thu, 20 Feb 2014 18:53:20 +0000"  >&lt;p&gt;I&apos;m finding it difficult to create a suitable JUnit test to show the problem.&lt;/p&gt;

&lt;p&gt;I can cause the parse error by using the Unicode escape \u0085, but that is unlikely to be used in any file names.&lt;br/&gt;
Ideally there should be a test case created using one of the Japanese characters that caused the problem.&lt;br/&gt;
Any ideas on that?&lt;/p&gt;</comment>
                            <comment id="13907331" author="sunnykumar" created="Thu, 20 Feb 2014 19:07:43 +0000"  >&lt;p&gt;I am attaching some sample files having such multi byte characters in the file name&lt;/p&gt;</comment>
                            <comment id="13907362" author="sebb@apache.org" created="Thu, 20 Feb 2014 19:24:19 +0000"  >&lt;p&gt;Thanks! Do these names all have the issue, or only some of them?&lt;/p&gt;

&lt;p&gt;Also I&apos;m not sure yet how to get these names into a test class.&lt;br/&gt;
At present the tests use strings like the following:&lt;/p&gt;

&lt;p&gt;            &quot;09-13-10  13:08       &amp;lt;DIR&amp;gt;          Temp&quot;,&lt;/p&gt;

&lt;p&gt;but an alternative would be to read the information from a text file.&lt;/p&gt;</comment>
                            <comment id="13907379" author="sunnykumar" created="Thu, 20 Feb 2014 19:35:42 +0000"  >&lt;p&gt;Only some of them have the issue. I have the byte trace of list files operation do you think will it help you for the test case ?&lt;/p&gt;</comment>
                            <comment id="13907398" author="sebb@apache.org" created="Thu, 20 Feb 2014 19:47:02 +0000"  >&lt;p&gt;Not quite sure what you mean by &quot;byte trace&quot;.&lt;/p&gt;

&lt;p&gt;I don&apos;t suppose there is a public FTP server which contains suitable example files?&lt;/p&gt;

&lt;p&gt;Alternatively, the output from running an FTP LIST command and/or MLST?&lt;br/&gt;
There is an example file in the NET source which can do both; you can run it from the jar provided that commons-net.jar is in the same directory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java -jar commons-net-examples-3.3.jar FTPClientExample
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13908586" author="sunnykumar" created="Fri, 21 Feb 2014 18:04:01 +0000"  >&lt;p&gt;I have somehow managed to create a public ftp site and hosted it at &lt;a href=&quot;ftp://commonsnet.ftpstream.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://commonsnet.ftpstream.com/&lt;/a&gt;. But i am unable to find a way to set any japanese charset/encoding. I will mail you the site credentials&lt;/p&gt;</comment>
                            <comment id="13908982" author="sebb@apache.org" created="Fri, 21 Feb 2014 23:21:51 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;However I have tried listing the site files, and I don&apos;t see any problem, so unfortunately it does not help with testing the changes.&lt;/p&gt;</comment>
                            <comment id="13910034" author="sunnykumar" created="Mon, 24 Feb 2014 05:34:29 +0000"  >&lt;p&gt;I have attached a sample test case where i have captured the raw bytes from the list files command, then read using ISO-8859-1 encoding (as we are doing in ftpclient when no control encoding is specfied) in the same way as in FTPClient.  Then matching the entries with the regEx present in the NTFTPEntryParser. Please let me know is it suffice for your test case &lt;/p&gt;</comment>
                            <comment id="13910264" author="sebb@apache.org" created="Mon, 24 Feb 2014 12:58:41 +0000"  >&lt;p&gt;Thanks, I think I may be able to turn that into an input stream.&lt;/p&gt;

&lt;p&gt;What happens if you change the control encoding to something more suited to the file names?&lt;br/&gt;
Does FTPClient still fail to parse the entries?&lt;br/&gt;
I&apos;m wondering whether this is at least partly an encoding issue.&lt;/p&gt;</comment>
                            <comment id="13912517" author="sunnykumar" created="Wed, 26 Feb 2014 05:01:27 +0000"  >&lt;p&gt;Yes, When setting the control encoding of the stream to the encoding of the file name there is no issue.&lt;/p&gt;

&lt;p&gt;IMO, it would be good still to add the DOTALL setting to pattern instance so that it can be backward - compatible. &lt;/p&gt;</comment>
                            <comment id="13912556" author="sunnykumar" created="Wed, 26 Feb 2014 06:08:35 +0000"  >&lt;p&gt;Hi Sebb,&lt;/p&gt;

&lt;p&gt;Can you let us know the patch release date if possible. It became a blocker issue for us where we cant update the code to set the control encoding.&lt;/p&gt;</comment>
                            <comment id="13917769" author="sunnykumar" created="Mon, 3 Mar 2014 06:19:36 +0000"  >&lt;p&gt;Sebb, Can you let us know whether the fix for this issue is targeted or not.&lt;/p&gt;</comment>
                            <comment id="13920457" author="sebb@apache.org" created="Wed, 5 Mar 2014 04:00:15 +0000"  >&lt;p&gt;I&apos;m working on it but there are some problems with unconditionally adding DOTALL to the superclass. &lt;/p&gt;

&lt;p&gt;This will affect any users who have created their own subclass on NET versions from 2.0 when ORO was replaced by Java regexes. The current release is 3.3, so potentially a lot of users might be affected.&lt;/p&gt;

&lt;p&gt;It&apos;s beginning to look like fixing the regexes would be safer. &lt;br/&gt;
So far the only problem report has involved the NT parser, so it may be sensible to fix just that.&lt;/p&gt;</comment>
                            <comment id="13921046" author="sebb@apache.org" created="Wed, 5 Mar 2014 17:01:05 +0000"  >&lt;p&gt;Fixed for the NT code&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1574571&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1574571&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/NET-516&quot; title=&quot;parser problem occurs if the filename contains one or more characters of which the second byte of Shift-JIS code is 0x85&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-516&quot;&gt;&lt;del&gt;NET-516&lt;/del&gt;&lt;/a&gt; parser problem occurs if the filename contains one or more characters of which the second byte of Shift-JIS code is 0x85&lt;br/&gt;
Fix NT parser&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/net/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/net/trunk/src/main/java/org/apache/commons/net/ftp/parser/NTFTPEntryParser.java&lt;br/&gt;
   commons/proper/net/trunk/src/test/java/org/apache/commons/net/ftp/parser/NTFTPEntryParserTest.java&lt;/p&gt;</comment>
                            <comment id="13921069" author="sebb@apache.org" created="Wed, 5 Mar 2014 17:30:27 +0000"  >&lt;p&gt;The current snapshot release includes the changes if you want to try that.&lt;/p&gt;</comment>
                            <comment id="13932117" author="sunnykumar" created="Wed, 12 Mar 2014 18:19:52 +0000"  >&lt;p&gt;Hi Sebb,&lt;/p&gt;

&lt;p&gt;Can you let me know the targeted release date for the fix.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13933236" author="sebb@apache.org" created="Thu, 13 Mar 2014 13:37:49 +0000"  >&lt;p&gt;Sorry, we don&apos;t have planned release dates.&lt;br/&gt;
The release will be done when someone has time to do it.&lt;/p&gt;

&lt;p&gt;Does the current snapshot solve the issue for you?&lt;/p&gt;</comment>
                            <comment id="14242981" author="sebb@apache.org" created="Thu, 11 Dec 2014 19:17:04 +0000"  >&lt;p&gt;As far as is known, this is resolved.&lt;/p&gt;

&lt;p&gt;If not, please re-open.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12630027" name="FTPSample.java" size="1110" author="sunnykumar" created="Thu, 20 Feb 2014 09:27:22 +0000"/>
                            <attachment id="12630606" name="FTPTestSample.java" size="6142" author="sunnykumar" created="Mon, 24 Feb 2014 05:31:39 +0000"/>
                            <attachment id="12630119" name="IIS FTP Files.zip" size="1902" author="sunnykumar" created="Thu, 20 Feb 2014 19:08:10 +0000"/>
                            <attachment id="12630130" name="listfilesStreamBytes.txt" size="4022" author="sunnykumar" created="Thu, 20 Feb 2014 19:37:00 +0000"/>
                            <attachment id="12604207" name="notworking.png" size="11493" author="asha k s" created="Fri, 20 Sep 2013 07:01:39 +0000"/>
                            <attachment id="12604206" name="working.png" size="23735" author="asha k s" created="Fri, 20 Sep 2013 07:01:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349542</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 49 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o9rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>