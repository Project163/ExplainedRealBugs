<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:44:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-89] [net] TelnetClient broken for binary transmissions + solution</title>
                <link>https://issues.apache.org/jira/browse/NET-89</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;TelnetClient does not handle correctly binary transmissions in two places:&lt;/p&gt;

&lt;p&gt;First in TelnetClient#&lt;em&gt;connectAction&lt;/em&gt;() the telnet input and output streams are&lt;br/&gt;
wrapped in the NetASCII streams to handle net vs platform line separator&lt;br/&gt;
conversion which breaks the binary data. My quick solution was to simply remove&lt;br/&gt;
those two wrapping streams. A more general solution might be to provide access&lt;br/&gt;
to the unfilterer stream with methods like getUnfilteredInputStream and&lt;br/&gt;
getUnfilteredOutputStream or to dynamically stop the NetASCII stream from&lt;br/&gt;
&apos;corrupting&apos; the stream when a TelnetOption.BINARY option is negotiated.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Also, in TelnetInputStream#__read() there is a bug in the __receiveState&lt;br/&gt;
handling for the _STATE_IAC state. When a second consecutive IAC (0x255) is&lt;br/&gt;
received to encode the single 0x255 character, read does not return 0x255 but&lt;br/&gt;
instead move on to reading the next char in the stream.&lt;br/&gt;
...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The above bug report has been moved to the subtask &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-329&quot; title=&quot;TelnetInoutStream#__read() bug in the __receiveState handling for the _STATE_IAC state.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-329&quot;&gt;&lt;del&gt;NET-329&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll provide patches for this.&lt;br/&gt;
Colin.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12342225">NET-89</key>
            <summary>[net] TelnetClient broken for binary transmissions + solution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ng@metaxia.com">Colin Surprenant</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2005 00:17:18 +0000</created>
                <updated>Sat, 4 Jun 2011 19:26:36 +0000</updated>
                            <resolved>Tue, 22 Mar 2011 17:16:21 +0000</resolved>
                                                    <fixVersion>3.0</fixVersion>
                                    <component>Telnet</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                                                            <comments>
                            <comment id="12409282" author="ng@metaxia.com" created="Fri, 6 May 2005 00:26:11 +0000"  >&lt;p&gt;Forgot to mention that this is with commons-net-1.3.0. I never tested binary&lt;br/&gt;
transmissions with other versions.&lt;/p&gt;

&lt;p&gt;binary transmission negotiation is enabled using:&lt;br/&gt;
telnet.addOptionHandler(new SimpleOptionHandler(TelnetOption.BINARY, true, true,&lt;br/&gt;
true, true));&lt;/p&gt;

&lt;p&gt;My tests were done using a non commons-net telnet server.&lt;/p&gt;</comment>
                            <comment id="12409283" author="rwinston@eircom.net" created="Sat, 7 May 2005 20:10:44 +0000"  >&lt;p&gt;Thanks Colin. When you provide the patch(es), is there any chance you may be&lt;br/&gt;
able to provide a test case that can be runa against a Telnet server to show the&lt;br/&gt;
problem? That way, we can be sure it gets fixed (and stays fixed).&lt;/p&gt;</comment>
                            <comment id="12409284" author="ng@metaxia.com" created="Wed, 11 May 2005 23:28:57 +0000"  >&lt;p&gt;I think a better testcase for TelnetInputStream would be to simply wrap it&lt;br/&gt;
around a ByteArrayInputStream which contains test patterns and verify what read&lt;br/&gt;
returns.&lt;/p&gt;

&lt;p&gt;For the NetASCII problem I did not take the time to analyse what would be the&lt;br/&gt;
better approach. Regardless of the solution, we should build a &quot;self contained&quot;&lt;br/&gt;
test case and not rely on a telnet server to run the tests against. &lt;/p&gt;
</comment>
                            <comment id="12545312" author="sarge" created="Mon, 26 Nov 2007 00:48:01 +0000"  >&lt;p&gt;I&apos;d like to provide some additional support for fixing this.&lt;/p&gt;

&lt;p&gt;We have a situation where we have some hardware crypto modules connected to a&lt;br/&gt;
Lantronix EDS4100 serial-to-IP device. We need to use Telnet to connect to the&lt;br/&gt;
Lantronix box. However, the hardware crypto modules use \r as the line&lt;br/&gt;
seperator. When running our software on Linux this causes a failure because:&lt;br/&gt;
1. The Unix line separator means that FromNetASCIIInputStream is used.&lt;br/&gt;
2. The FromNetASCIIInputStream#__read method reads a \r then waits for the next&lt;br/&gt;
character.&lt;br/&gt;
3. Because our hardware crypto modules only send one line of response with a \r&lt;br/&gt;
terminator there is no next character.&lt;br/&gt;
4. The read then times out.&lt;/p&gt;

&lt;p&gt;There are two basic issues here: One is that JRE properties are being used to&lt;br/&gt;
configure the library with no method for the developer to override this. The&lt;br/&gt;
second is that the code expects a character after every \r when there is no&lt;br/&gt;
guarantee this might happen.&lt;/p&gt;

&lt;p&gt;In conclusion, I would like a way to either turn off line feed conversion or to&lt;br/&gt;
have access to the unconverted input stream.&lt;/p&gt;</comment>
                            <comment id="12645818" author="moberhuber" created="Fri, 7 Nov 2008 16:44:54 +0000"  >&lt;p&gt;For us, the unconditional wrapping of the inputStream in a FromNetASCIIInputStream in the &lt;em&gt;connectAction&lt;/em&gt;() is also problematic. We have a Java vt100 terminal implementation, which can run on Windows or UNIX. For the vt100 Terminal, we need the CRLF line endings because LF-only must be interpreted as &quot;line down only&quot;. &lt;/p&gt;

&lt;p&gt;We could wrap the inputStream in another ToNetASCIIInputStream when on UNIX, but I don&apos;t fancy this idea too much since there is still a risk of losing data (LF-only &lt;em&gt;MAY&lt;/em&gt; be different than CRLF, not only in binary but in Terminal apps as well, or am I mistaken?) - IMHO using the System.property for deciding on NetASCII decoding or not was not a good idea in the first place at all.&lt;/p&gt;

&lt;p&gt;What about simply introducing a field e.g. TelnetClient#setNetASCIIConversion(boolean b) in order to switch on or off the auto-conversion? Should be called before connecting. I&apos;d assume that anyone dealing with actual Terminals or binary transmission would want to switch the auto conversion off.&lt;/p&gt;

&lt;p&gt;I also like switching off the auto-conversion when BINARY transmission is negotiated, but I&apos;m a little bit worried about what should happen when the binary negotiation happens at a time where e.g. the CR is already consumed but the LF not yet...&lt;/p&gt;</comment>
                            <comment id="12645821" author="moberhuber" created="Fri, 7 Nov 2008 16:52:21 +0000"  >&lt;p&gt;PS there doesn&apos;t even seem to be a suitable workaround by subclassing TelnetClient and overriding protected &lt;em&gt;connectAction&lt;/em&gt; (), because from the subclass we cannot call super.super.&lt;em&gt;connectAction&lt;/em&gt;(); and doing super.&lt;em&gt;connectAction&lt;/em&gt;() first will leave us with a TelnetInputStream whose Thread has already started and might have consumed some characters already, so we cannot replace the FromNetASCIIInputStream after the fact any more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;And, giving access to protected &lt;em&gt;input&lt;/em&gt; also isn&apos;t an option because we cannot have the TelnetInputStream and the client read from the same &lt;em&gt;input&lt;/em&gt; at the same time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Not really having a workaround makes this a major issue indeed, and I&apos;m not sure how this can be fixed without adding new API...&lt;/p&gt;</comment>
                            <comment id="12646553" author="moberhuber" created="Tue, 11 Nov 2008 14:23:33 +0000"  >&lt;p&gt;It looks like currently two separate issues are discussed here &amp;#8211; the original issue with state handling (not sure if this is fixed yet), and the API problem of not being able to obtain an unconverted inputstream that doesn&apos;t undergo the FromNetASCIIInputStream conversion. Should a separate issue be created to track the latter one?&lt;/p&gt;</comment>
                            <comment id="12668881" author="moberhuber" created="Fri, 30 Jan 2009 14:25:14 +0000"  >&lt;p&gt;Can we schedule this for fixing in 1.5 and 2.1 by adding following API:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;TelnetClient.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  /**
   * Enables or disables automatic conversion of input and output streams
   * to or from NetASCII standard format (CRLF).
   * By &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, automatic conversion is ON. It should be disabled when direct
   * (binary) access to the data streams is needed. The setting can only
   * be made or changed before the TelnetClient is connected.
   * 
   * @param b &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/code&amp;gt; to disable automatic conversion of streams to NetASCII format.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setNetASCIIConversion(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; b);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12668886" author="moberhuber" created="Fri, 30 Jan 2009 14:48:47 +0000"  >&lt;p&gt;As an alternative, I believe we could do this &amp;#8211; though I&apos;m not so fond of this since it also requires a functional change: for this API to work, the conditional conversion from &lt;em&gt;input&lt;/em&gt; to __input by applying the FromNetASCIIInputStream or not must be made &lt;b&gt;after&lt;/b&gt; applying the ReaderThread, and &lt;b&gt;not before&lt;/b&gt; as it&apos;s done now. May be a marginal change, but may also change functionality. Also note, that lazy creation of the FromNetASCIIInputStream / ToNetASCIIOutputStream in the getInputStream() / getOutputStream() methods would be preferred over unconditional creation of the Streams in the __connect method.&lt;/p&gt;

&lt;p&gt;On the positive side, mixing the Streams (i.e. using either the binary or the NetASCII variant) may be possible when flush() is called when done with one variant. At this point, however, I&apos;m not exactly sure how this could work out, so the Javadocs below discourage such usage.&lt;/p&gt;

&lt;p&gt;Finally, another idea might be deprecating getInputStream() / getOutputStream() altogether and replace it with having the client do the ToNetASCIIInputStream() etc conversion on the client side after calling getBinaryOutputStream().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;TelnetClient.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /***
     * Returns the unconverted, binary telnet connection output stream
     * (without automatic NetASCII conversion to CRLF line endings).
     * Clients should use either the stream returned by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method, or
     * the stream returned from {@link #getOutputStream()}, but not mix
     * using the Streams.  You should not close the
     * stream when you finish with it.  Rather, you should call
     * {@link #disconnect  disconnect }.
     * &amp;lt;p&amp;gt;
     * This API is available in Commons Net 1.5 and 2.1, but not in version 2.0
     * &amp;lt;p&amp;gt;
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; The unconverted, binary telnet connection output stream.
     * @since 1.5
     * @since 2.1
     ***/
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OutputStream getBinaryOutputStream()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; __binaryOutput;
    }

    /***
     * Returns the unconverted, binary telnet connection input stream
     * (without automatic NetASCII conversion from CRLF line endings).
     * Clients should use either the stream returned by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method, or
     * the stream returned from {@link #getInputStream()}, but not mix
     * using the Streams.  You should not close the
     * stream when you finish with it.  Rather, you should call
     * {@link #disconnect  disconnect }.
     * &amp;lt;p&amp;gt;
     * This API is available in Commons Net 1.5 and 2.1, but not in version 2.0
     * &amp;lt;p&amp;gt;
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; The unconverted, binary telnet connection input stream.
     * @since 1.5
     * @since 2.1
     ***/
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; InputStream getBinaryInputStream()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; __binaryInput;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12781119" author="shlomy" created="Sun, 22 Nov 2009 12:25:41 +0000"  >&lt;p&gt;I have a different case in which the ToNetASCIIInputStream causes a problem. I use text transmissions, not binary, however the telnet server does not seem to tell the difference between &apos;\r&apos; and &apos;\n&apos;, and so the replacement of &apos;\n&apos; with &quot;\r\n&quot; causes every line I send to generate an extra newline, which prevents automation (e.g. in the login/password sequence, the password is always passed as empty due to the extra newline).&lt;/p&gt;

&lt;p&gt;I suggest to add a method like the &quot;setNetASCIIConversion(boolean)&quot; above, and even have a dedicated one for the just the telnet&apos;s output - i.e. avoid only the wrapper ToNetASCIIOutputStream. Something like:&lt;/p&gt;

&lt;p&gt;public void setNetASCIIConversionOnOutput(boolean b);&lt;br/&gt;
public void setNetASCIIConversionOnInput(boolean b);&lt;/p&gt;

&lt;p&gt;The &quot;set&quot; functions can be replaced by &quot;disable&quot; if the default is to have them enabled. Another option, which seems better to me, is to replace these functions with new TelnetClient constructors that take an additional boolean parameter (or two), to ensure this is configured before the connection is made.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Shlomy&lt;/p&gt;</comment>
                            <comment id="12887114" author="sebb@apache.org" created="Sat, 10 Jul 2010 23:24:01 +0000"  >&lt;p&gt;Add code markers to make code easier to read.&lt;/p&gt;</comment>
                            <comment id="12887121" author="sebb@apache.org" created="Sun, 11 Jul 2010 00:02:49 +0000"  >&lt;p&gt;Split off IAC bug report&lt;/p&gt;</comment>
                            <comment id="12887182" author="sebb@apache.org" created="Sun, 11 Jul 2010 11:24:14 +0000"  >&lt;p&gt;The use of ToNetASCIIOutputStream/FromNetASCIIInputStream to wrap the streams does seem to be a bit odd.&lt;/p&gt;

&lt;p&gt;Those classes look OK for wrapping FTP file transfers (which is where they are otherwise used) but  I&apos;m not sure that they should be used with Telnet, given that the Telnet I/O streams also perform some EOL conversions. Also, the Telnet I/O streams take account of BINARY mode, whereas the NetASCII classes don&apos;t.&lt;/p&gt;

&lt;p&gt;Seems to me that all the EOL handling should be done in the I/O streams.&lt;/p&gt;

&lt;p&gt;There should be a means of specifying what EOL conversion (if any) is to be performed by the streams.&lt;br/&gt;
This should probably be set initially and not changed.&lt;/p&gt;

&lt;p&gt;Though in the case of Telnet output, I wonder whether any conversion should be done,  given that the Java code could include the correct EOLs anyway.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12502064">NET-387</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12382020">NET-173</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12468991">NET-329</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72009</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0y9of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>198037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>