<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:44:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-73] [net][PATCH] TelnetInputStream.read hangs when socket data ends in a command sequence</title>
                <link>https://issues.apache.org/jira/browse/NET-73</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;Background: If one calls TelnetInputStream.read() in single-threaded mode (no &lt;br/&gt;
reader thread) and there is no data immediately available, the call blocks on &lt;br/&gt;
a socket read. When data starts to arrive, the stream adds all the available &lt;br/&gt;
bytes to its internal queue before returning the first one to the caller. To &lt;br/&gt;
do this, it calls __read() in a loop for as long as there are bytes available. &lt;br/&gt;
The __read() method returns the first byte of &quot;user data&quot; from the socket. If &lt;br/&gt;
__read() encounters a Telnet command sequence (IAC, WILL, WONT, DO, DONT, &lt;br/&gt;
etc.), it handles the negotiation transparently and then returns the first &lt;br/&gt;
byte of user data.&lt;/p&gt;

&lt;p&gt;In most cases, this works fine, but a problem arises if a chunk of data from &lt;br/&gt;
the remote host ends in a Telnet command sequence. When that happens, the &lt;br/&gt;
TelnetInputStream.read() method hangs, even though it may have already &lt;br/&gt;
acquired some user data. This is because it calls __read() in a loop as long &lt;br/&gt;
as super.available() returns true. But if the remaining data from the socket &lt;br/&gt;
consists entirely of Telnet commands, __read() will process those AND THEN &lt;br/&gt;
BLOCK waiting for user data.&lt;/p&gt;

&lt;p&gt;Just checking super.available() is not sufficient. We should continue the loop &lt;br/&gt;
only if there are bytes of USER DATA still available from the socket. Not &lt;br/&gt;
doing this can cause the client to wait indefinitely.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12343039">NET-73</key>
            <summary>[net][PATCH] TelnetInputStream.read hangs when socket data ends in a command sequence</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhasselbaum@alumni.ithaca.edu">Rob Hasselbaum</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Apr 2006 21:15:58 +0000</created>
                <updated>Wed, 17 Apr 2013 19:57:38 +0000</updated>
                            <resolved>Sat, 18 Aug 2012 08:38:01 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12411784" author="dfs@apache.org" created="Sat, 22 Apr 2006 00:37:13 +0000"  >&lt;p&gt;Can you submit a patch that corrects the error?  All I can offer you in return&lt;br/&gt;
is our thanks and the addition of your name to the list of contributors.&lt;/p&gt;</comment>
                            <comment id="12411785" author="rhasselbaum@alumni.ithaca.edu" created="Sat, 22 Apr 2006 00:40:59 +0000"  >&lt;p&gt;I am working on a patch now. If someone can commit my earlier patch for bug&lt;br/&gt;
38688, we can avoid a messy merge later, as this impacts some of the same code.&lt;/p&gt;</comment>
                            <comment id="12411786" author="dfs@apache.org" created="Mon, 24 Apr 2006 00:02:29 +0000"  >&lt;p&gt;Patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-3&quot; title=&quot;[net][PATCH] TelnetInputStream.read sometimes hangs if reader thread is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-3&quot;&gt;&lt;del&gt;COM-2776&lt;/del&gt;&lt;/a&gt; applied.  Thanks!&lt;/p&gt;</comment>
                            <comment id="12411787" author="rhasselbaum@alumni.ithaca.edu" created="Tue, 25 Apr 2006 02:41:08 +0000"  >&lt;p&gt;Created an attachment (id=18174)&lt;br/&gt;
Fix read hang after command sequence&lt;/p&gt;

&lt;p&gt;This patch prevents the read hang that occurs in single-threaded mode when a&lt;br/&gt;
remote host response ends in a Telnet command sequence.&lt;/p&gt;

&lt;p&gt;I have added a boolean flag to TelnetInputStream.__read that tells it whether&lt;br/&gt;
or not to block on a socket read if there is no user data available in the&lt;br/&gt;
superclass buffer. It is set to true for the first iteration through the loop&lt;br/&gt;
in read(), which is the only time we need to wait. Subsequent iterations only&lt;br/&gt;
serve to eagerly fill the queue, so we don&apos;t need to wait, and the argument is&lt;br/&gt;
set to false. &lt;/p&gt;

&lt;p&gt;If the argument is false and there is no data available, __read() returns a&lt;br/&gt;
value of -2 that prevents the caller from using the data. I didn&apos;t use an&lt;br/&gt;
exception because of overhead concern. (We could hit this condition often.)&lt;/p&gt;

&lt;p&gt;If the reader thread is enabled, run() calls __read() with the argument set to&lt;br/&gt;
true, which is equivalent to the old behavior.&lt;/p&gt;</comment>
                            <comment id="12430756" author="rwinston@eircom.net" created="Sat, 26 Aug 2006 16:38:49 +0000"  >&lt;p&gt;This has been fixed.&lt;/p&gt;</comment>
                            <comment id="12575214" author="sebb@apache.org" created="Wed, 5 Mar 2008 01:15:27 +0000"  >&lt;p&gt;The fix has been applied to trunk - surely it should also be applied to the NET_2_0 branch before closing this bug?&lt;/p&gt;</comment>
                            <comment id="12575215" author="moberhuber" created="Wed, 5 Mar 2008 01:20:23 +0000"  >&lt;p&gt;Darn, it seems to be missing on the NET_2_0 branch indeed... and this has been detected before, see &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-179&quot; title=&quot;NET-73    &amp;quot;TelnetInputStream._read() hangs&amp;quot; fix is not included in nightly builds.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-179&quot;&gt;&lt;del&gt;NET-179&lt;/del&gt;&lt;/a&gt; : &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-179&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/NET-179&lt;/a&gt; Looks like that one needs to get re-opened?&lt;/p&gt;</comment>
                            <comment id="13196804" author="muralidhar" created="Tue, 31 Jan 2012 09:11:28 +0000"  >&lt;p&gt;I am facing same issue with commons-net-3.0.1 jar. TelentInputStream.read hangs and thorows SocketTimeoutException&lt;/p&gt;

&lt;p&gt;Using ERS on linux machine.&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;


&lt;p&gt;java.net.SocketTimeoutException: Read timed out&lt;br/&gt;
	at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
	at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:317)&lt;br/&gt;
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:237)&lt;br/&gt;
	at org.apache.commons.net.telnet.TelnetInputStream.__read(TelnetInputStream.java:136)&lt;br/&gt;
	at org.apache.commons.net.telnet.TelnetInputStream.run(TelnetInputStream.java:591)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="13196876" author="sebb@apache.org" created="Tue, 31 Jan 2012 12:51:35 +0000"  >&lt;p&gt;The 2.x (and 3.x) line of code was patched in r633798, and I&apos;ve checked that the same patch is also in the current 3.0.1 code.&lt;/p&gt;

&lt;p&gt;==&lt;/p&gt;

&lt;p&gt;I think the stack trace shows that the code is waiting to close a previous input stream as part of a connect.&lt;/p&gt;

&lt;p&gt;This suggests that the problem may lie in the way the Telnet classes are being used.&lt;br/&gt;
Can you provide sample code that demonstrates the problem?&lt;/p&gt;</comment>
                            <comment id="13437273" author="sebb@apache.org" created="Sat, 18 Aug 2012 08:38:01 +0000"  >&lt;p&gt;No response to request for reproducer so not a lot can do here.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12334120" name="ASF.LICENSE.NOT.GRANTED--cmd-seq-hang.patch" size="2727" author="rhasselbaum@alumni.ithaca.edu" created="Tue, 25 Apr 2006 02:41:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>154412</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0y5dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>197341</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>