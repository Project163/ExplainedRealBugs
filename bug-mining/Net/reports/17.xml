<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:43:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-188] FTPClient#listFiles returns null element when file&apos;s timestamp is &quot;02/29&quot;</title>
                <link>https://issues.apache.org/jira/browse/NET-188</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;This issue has same cause as &lt;a href=&quot;https://issues.apache.org/jira/browse/VALIDATOR-221&quot; title=&quot;DateValidator considers &amp;quot;02/29&amp;quot; with format &amp;quot;MM/dd&amp;quot; invalid&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VALIDATOR-221&quot;&gt;&lt;del&gt;VALIDATOR-221&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
org.apache.commons.net.ftp.parser.FTPTimestampParserImpl#parseTimestamp throws ParseException with timestampStr = &quot;Feb 29 11:22&quot;.&lt;/p&gt;

&lt;p&gt;FTP Server status:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[root@localhost test-commonsnet]# pwd
/tmp/test-commonsnet
[root@localhost test-commonsnet]# ls -l
total 0
-rw-r--r--  1 root root 0 Dec 19  2006 aaa.txt
-rw-r--r--  1 root root 0 Feb 29 11:22 bbb.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;test code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCommonsNetLeapDay() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FTPClient ftp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FTPClient();
    ftp.connect(host);
    ftp.login(user, password);
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FTPFile[] listFiles = ftp.listFiles(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/test-commonsnet&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; listFiles.length; i++) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;[&quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;] &quot;&lt;/span&gt; + listFiles[i]);
    }
    ftp.disconnect();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;results bellow.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[0] -rw-r--r--    1 0        0               0 Dec 18  2006 aaa.txt
[1] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Second element(bbb.txt) should not be null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12389468">NET-188</key>
            <summary>FTPClient#listFiles returns null element when file&apos;s timestamp is &quot;02/29&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="manhole">HONMA Hirotaka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Feb 2008 10:22:21 +0000</created>
                <updated>Thu, 1 Mar 2012 10:59:16 +0000</updated>
                            <resolved>Thu, 15 May 2008 22:02:53 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>32</votes>
                                    <watches>16</watches>
                                                                                                                <comments>
                            <comment id="12572149" author="rwinston@eircom.net" created="Mon, 25 Feb 2008 18:21:54 +0000"  >&lt;p&gt;Hmmm. This is a tough one. With no year information in the date string, SimpleDateFormat clears the internal Calendar and sets the YEAR field to 1970, the epoch  (the default). Normally, this will have no impact on date parsing, &lt;b&gt;except&lt;/b&gt; when the year in question is a leap year, as 1970 wasn&apos;t one. Thus, SDF thinks that Feb 29th should be riolled over to March 1st in lenient mode, and in strict mode (the default for Net parsing), it simply returns null.  Of course, the real culprit is the horrible Java date/time package implementation. Using something like Joda-time for this works as expected.&lt;/p&gt;</comment>
                            <comment id="12572158" author="rwinston@eircom.net" created="Mon, 25 Feb 2008 18:51:27 +0000"  >&lt;p&gt;Something like this would fix it (I&apos;ve tried it), but I think it&apos;s nasty:&lt;/p&gt;

&lt;p&gt;if (short date validation fails) &lt;br/&gt;
  explicitly add the current year to the date string&lt;br/&gt;
   Create a new non-lenient SDF instance using using the previous SDF toPattern + &quot; yyyy&quot;&lt;br/&gt;
   Attempt to parse the date&lt;/p&gt;

&lt;p&gt;Any comments? I&apos;m tempted to mark this as WONTFIX.&lt;/p&gt;</comment>
                            <comment id="12572292" author="sebb@apache.org" created="Mon, 25 Feb 2008 22:46:39 +0000"  >&lt;p&gt;The ftp directory listing output on Unix systems generally corresponds to that produced by &quot;ls -l&quot;.&lt;/p&gt;

&lt;p&gt;The man page for ls (e.g. on FreeBSD) says:&lt;/p&gt;

&lt;p&gt;     If the modification time of the file is more than 6 months in the past or&lt;br/&gt;
     future, then the year of the last modification is displayed in place of&lt;br/&gt;
     the hour and minute fields.&lt;/p&gt;

&lt;p&gt;So if the year is missing, why not set it according to the rule above?&lt;/p&gt;</comment>
                            <comment id="12572346" author="ashizawa@jajakarta.org" created="Tue, 26 Feb 2008 02:42:22 +0000"  >&lt;p&gt;&amp;gt;Any comments? I&apos;m tempted to mark this as WONTFIX.&lt;/p&gt;

&lt;p&gt;Unfortunately it will not work well, because of lack of crossover year consideration.&lt;/p&gt;

&lt;p&gt;Ex: If a file was created in Dec-2007 and current date was Jan-2008, the missing year would be 2007 (not current year).&lt;/p&gt;

&lt;p&gt;I guess this issue isn&apos;t caused by a JDK implementation.&lt;br/&gt;
I hope it will be fixed soon (not WONTFIX).&lt;/p&gt;
</comment>
                            <comment id="12572349" author="awtimmering" created="Tue, 26 Feb 2008 03:31:14 +0000"  >&lt;p&gt;A fix for this would be greatly appreciated. &lt;/p&gt;

&lt;p&gt;Rory: If not in the Commons Net, where should this be addressed in your opinion?&lt;/p&gt;</comment>
                            <comment id="12572388" author="rwinston@eircom.net" created="Tue, 26 Feb 2008 09:22:44 +0000"  >&lt;p&gt;It is a JDK implementation issue. That&apos;s the whole point of the analysis.&lt;/p&gt;</comment>
                            <comment id="12572389" author="sebb@apache.org" created="Tue, 26 Feb 2008 09:36:53 +0000"  >&lt;p&gt;If the fie was created in Dec 2007, and it is now Jan 2008, then the year will be omitted on Unix systems.&lt;/p&gt;

&lt;p&gt;Since Dec is less that 6 months behind Jan, and &amp;gt; 6 months ahead, the omitted year must be 2007.&lt;/p&gt;

&lt;p&gt;Pseudocode:&lt;/p&gt;

&lt;p&gt;If year is not present&lt;br/&gt;
then &lt;br/&gt;
      calculate date using current year&lt;br/&gt;
      if date - now &amp;gt; 6 months (or calculation fails)&lt;br/&gt;
      then&lt;br/&gt;
          calculate date using previous year&lt;br/&gt;
     endif&lt;br/&gt;
endif&lt;/p&gt;</comment>
                            <comment id="12572391" author="sebb@apache.org" created="Tue, 26 Feb 2008 09:43:30 +0000"  >&lt;p&gt;@Rory: I don&apos;t agree that it&apos;s a JDK problem. &lt;/p&gt;

&lt;p&gt;SimpleDateFormat may not be as flexible as one might want, but it&apos;s not its fault that it cannot handle all partially specified dates.&lt;/p&gt;</comment>
                            <comment id="12572392" author="rwinston@eircom.net" created="Tue, 26 Feb 2008 09:50:12 +0000"  >&lt;p&gt;That should work. I do think this will only happen in the case of Feb 29th , in which case we dont need to check the year, as it will always be the current year.  &lt;/p&gt;</comment>
                            <comment id="12572396" author="sebb@apache.org" created="Tue, 26 Feb 2008 10:02:34 +0000"  >&lt;p&gt;Agreed Feb 29 cannot be the previous year as it is more than 6 months from the end of the year.&lt;/p&gt;

&lt;p&gt;It could potentially be the next year - if the system clock has been turned back, or the file is future-dated.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;I assume the original example must have been created by future-dating a file&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;However the most common case is that Feb 29 will be the current year.&lt;/p&gt;</comment>
                            <comment id="12572448" author="rwinston@eircom.net" created="Tue, 26 Feb 2008 12:14:07 +0000"  >&lt;p&gt;Something like this would work, if the initial recent date format parsing fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (recentDateFormat != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
				pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParsePosition(0);
				&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; year = Calendar.getInstance().get(Calendar.YEAR);
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; timeStampStrPlusYear = timestampStr + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + year;
				SimpleDateFormat hackFormatter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(recentDateFormat.toPattern() + &lt;span class=&quot;code-quote&quot;&gt;&quot; yyyy&quot;&lt;/span&gt;);
				hackFormatter.setLenient(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
				parsed = hackFormatter.parse(timeStampStrPlusYear, pp);
			}
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parsed != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length() + 5) {
				working.setTime(parsed);
			}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although that is really hacky.&lt;/p&gt;</comment>
                            <comment id="12572551" author="rwinston@eircom.net" created="Tue, 26 Feb 2008 16:40:58 +0000"  >&lt;p&gt;Ok....I&apos;ve added a &quot;fix&quot; on the 2.0 dev branch for testing.....does anyone feel brave enough to check it out, build it, and try a test to see if it works on their system?&lt;/p&gt;

&lt;p&gt;$ svn checkout &lt;a href=&quot;http://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0&lt;/a&gt; commons-net&lt;/p&gt;</comment>
                            <comment id="12572759" author="manhole" created="Wed, 27 Feb 2008 01:58:05 +0000"  >&lt;p&gt;Rory, thank you for the quick follow-up.&lt;/p&gt;

&lt;p&gt;In my environment, I got it to work when I also provided DateFormatSymbols to the constructor to make sure the formatting is done in the same locale.&lt;br/&gt;
Also, I think setting the TimeZone is necessary. Please let me know your thoughts.&lt;/p&gt;

&lt;p&gt;Please see below for proposed changes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: FTPTimestampParserImpl.java
===================================================================
--- FTPTimestampParserImpl.java	(revision 631446)
+++ FTPTimestampParserImpl.java	(working copy)
@@ -104,8 +104,9 @@
 				pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParsePosition(0);
 				&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; year = Calendar.getInstance().get(Calendar.YEAR);
 				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; timeStampStrPlusYear = timestampStr + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + year;
-				SimpleDateFormat hackFormatter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(recentDateFormat.toPattern() + &lt;span class=&quot;code-quote&quot;&gt;&quot; yyyy&quot;&lt;/span&gt;);
+				SimpleDateFormat hackFormatter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(recentDateFormat.toPattern() + &lt;span class=&quot;code-quote&quot;&gt;&quot; yyyy&quot;&lt;/span&gt;, recentDateFormat.getDateFormatSymbols());
 				hackFormatter.setLenient(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
+				hackFormatter.setTimeZone(recentDateFormat.getTimeZone());
 				parsed = hackFormatter.parse(timeStampStrPlusYear, pp);
 			}
 			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parsed != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length() + 5) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12573709" author="willwright" created="Fri, 29 Feb 2008 12:37:39 +0000"  >&lt;p&gt;Thanks HONMA - came across this when our production system refused to retrieve any files for today. This fix works a treat.&lt;/p&gt;</comment>
                            <comment id="12573745" author="timfooy" created="Fri, 29 Feb 2008 14:00:21 +0000"  >&lt;p&gt;A combination of this issue and this one &lt;a href=&quot;https://issues.apache.org/bugzilla/show_bug.cgi?id=41724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/bugzilla/show_bug.cgi?id=41724&lt;/a&gt;  has caused a lot of problems in our production environment.  Too bad that the ANT team seems to have fixed this half a year ago but have not released anything since then.  (See &lt;a href=&quot;http://svn.apache.org/viewvc/ant/core/trunk/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java?r1=526548&amp;amp;r2=574313&amp;amp;diff_format=h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/ant/core/trunk/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java?r1=526548&amp;amp;r2=574313&amp;amp;diff_format=h&lt;/a&gt; )&lt;br/&gt;
I hope these fixes in both projects will soon reach a release.&lt;/p&gt;</comment>
                            <comment id="12573746" author="cybertiger" created="Fri, 29 Feb 2008 14:01:16 +0000"  >&lt;p&gt;I&apos;m not in a position to ship the a 3rd party library from subversion as part of our companies product, and this bug is critical for me.&lt;/p&gt;

&lt;p&gt;I need a  workaround for this, unfortunately my attempts are getting more and more hacky, my original attempt involved using the deprecated API to create my own subclass of UnixFTPEntryParser, and then I overrode parseTimestamp() to simply return null as for my purposes I do not need the timestamp.&lt;/p&gt;

&lt;p&gt;Unfortunately the code in UnixFTPEntryParser.parseFTPEntry(...) calls super.parseTimestamp(...) which makes this approach fail.&lt;/p&gt;

&lt;p&gt;I&apos;m also quite perturbed that the API to plug in your own parser has been deprecated and no alternative method to provide your own parser has been implemented, it&apos;s naive to say the least to assume that the commons-net implementation will support all possible list formats in existence.&lt;/p&gt;</comment>
                            <comment id="12573755" author="ndv" created="Fri, 29 Feb 2008 14:13:48 +0000"  >&lt;p&gt;I&apos;ve figured out the the real problem is setLenient (false). A lenient SDF parses Feb 29 correctly. I wonder if is there any reason to use non-lenient SDF? What if just remove setLenient(false)?&lt;/p&gt;</comment>
                            <comment id="12573810" author="bonefish" created="Fri, 29 Feb 2008 16:10:21 +0000"  >&lt;p&gt;Attachted is a somewhat crude but effective work-around: &quot;Feb 29&quot; is replaced by &quot;Feb 28&quot; and after parsing the day is incremented.&lt;/p&gt;</comment>
                            <comment id="12573817" author="tsnyder" created="Fri, 29 Feb 2008 16:29:42 +0000"  >&lt;p&gt;Please consider the following.  &lt;/p&gt;

&lt;p&gt;1. This bug is not specific to leap year.  This will also occur if a file has a timestamp for the non-existent hour during a DST switch.  &lt;br/&gt;
In the U.S. On March 9, 2008 I expect all files created between 2:00am and 2:59am to have a similar issue.&lt;/p&gt;

&lt;p&gt;2. If you setLenient(True), Feb 29 will be returned as March 1.  The current implementation will then see March 1 (on Feb 29th) as the previous year.&lt;/p&gt;
</comment>
                            <comment id="12573879" author="bpphillips" created="Fri, 29 Feb 2008 18:27:06 +0000"  >&lt;p&gt;&amp;gt; On March 9, 2008 I expect all files created between 2:00am and 2:59am to have a similar issue.&lt;/p&gt;

&lt;p&gt;Actually, these timestamps won&apos;t have a problem since they existed in 1970.  However, trying to parse &quot;Apr 26 02:01&quot; with SimpleDateFormat (using format &quot;MMM d HH:mm&quot;) in non-lenient mode does in fact result in the same ParseException being thrown since that was the DST cutover in 1970.&lt;/p&gt;</comment>
                            <comment id="12574043" author="carej@us.ibm.com" created="Sat, 1 Mar 2008 01:07:25 +0000"  >&lt;p&gt;Is there any way to force the FTP server to always use the long timestamp format?&lt;/p&gt;</comment>
                            <comment id="12574098" author="rwinston@eircom.net" created="Sat, 1 Mar 2008 12:14:36 +0000"  >&lt;p&gt;Guys&lt;/p&gt;

&lt;p&gt;Thanks for all the comments and suggestions. I think that I may go for a combination of my suggested fix, Honma&apos;s enhancements, and a GregorianCalendar::isLeapYear() check that somebody else suggested.&lt;/p&gt;

&lt;p&gt;In regards to the question about setLenient(), its actually important that we use strict parsing, otherwise dates that the date parser regards as invalid may be rolled over to the nearest valid date, which we don&apos;t want.&lt;/p&gt;

&lt;p&gt;I&apos;ll check out the scenario that Terrance has raised before committing a final fix.&lt;/p&gt;</comment>
                            <comment id="12574107" author="rwinston@eircom.net" created="Sat, 1 Mar 2008 12:39:07 +0000"  >&lt;p&gt;I cant reproduce the problem with Apr 26 02:01 - parses fine for me. &lt;/p&gt;

&lt;p&gt;I&apos;ll add the isLeapYear() check, as I think the only instance where this is a problem is on a leap year day.&lt;/p&gt;</comment>
                            <comment id="12574116" author="sebb@apache.org" created="Sat, 1 Mar 2008 14:46:20 +0000"  >&lt;p&gt;Seems to me that a lot of the problems have arisen because the array item that is returned for invalid dates is null.&lt;/p&gt;

&lt;p&gt;This might possibly still happen in some cases, so may I suggest that the code at least returns a valid entry?&lt;br/&gt;
If necessary set the file date to the Java epoch, and document this as a possible return.&lt;/p&gt;

&lt;p&gt;At least then the file name and most attributes would be available.&lt;/p&gt;</comment>
                            <comment id="12574486" author="bpphillips" created="Mon, 3 Mar 2008 12:48:22 +0000"  >&lt;p&gt;The attached JUnit test case shows that this problem will reoccur on any date/time that doesn&apos;t exist in the default year 1970.  Specifically, April 26 at 2am (the time at which DST was put into affect in 1970) is unparseable by SimpleDateFormat:&lt;/p&gt;

&lt;p&gt;java.text.ParseException: Unparseable date: &quot;Apr 26 02:00&quot;&lt;br/&gt;
	at java.text.DateFormat.parse(DateFormat.java:337)&lt;br/&gt;
	at DstParseTest.testParseDstWithNoYear(DstParseTest.java:21)&lt;br/&gt;
        &lt;span class=&quot;error&quot;&gt;&amp;#91;snip&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This issue may be specific to the default timezone of your system so the test case explicitly calls sets the time zone to &quot;US/Central&quot; which is my default and exhibits the ParseException failure.&lt;/p&gt;</comment>
                            <comment id="12574559" author="bodik" created="Mon, 3 Mar 2008 15:32:05 +0000"  >&lt;p&gt;It looks like the bug occurs only under jdk 1.5 and above.&lt;br/&gt;
It does not appeir under jdk 1.3.1 and 1.4.2.&lt;br/&gt;
I tested it with SUN jdk.&lt;/p&gt;</comment>
                            <comment id="12574870" author="skaffman" created="Tue, 4 Mar 2008 07:51:39 +0000"  >&lt;p&gt;The fix will be released as 1.4.2, I hope, not just added to the 2.0 trunk?&lt;/p&gt;</comment>
                            <comment id="12575065" author="rwinston@eircom.net" created="Tue, 4 Mar 2008 17:26:59 +0000"  >&lt;p&gt;I have added the fix on both the 1.5.0 and 2.0 branches. I have also removed the specific leap year check, as Brian&apos;s test case shows that other parsing ambiguities can occur.&lt;/p&gt;</comment>
                            <comment id="12575130" author="sebb@apache.org" created="Tue, 4 Mar 2008 20:48:43 +0000"  >&lt;p&gt;Add test cases for Feb 29 in leap and non-leap years&lt;/p&gt;</comment>
                            <comment id="12576525" author="sebb@apache.org" created="Sat, 8 Mar 2008 10:22:31 +0000"  >&lt;p&gt;Current code (FTPTimestampParserImpl r633380) does not work.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;        FTPTimestampParserImpl parser = new FTPTimestampParserImpl();&lt;br/&gt;
        DateFormat df = SimpleDateFormat.getDateTimeInstance();&lt;br/&gt;
        Calendar cal;&lt;br/&gt;
        cal=parser.parseTimestamp(&quot;feb 29 20:04&quot;);&lt;br/&gt;
        System.out.println(df.format(cal.getTime()));&lt;/p&gt;

&lt;p&gt;generates&lt;/p&gt;

&lt;p&gt;       01-Mar-2008 20:04:00&lt;/p&gt;

&lt;p&gt;I think the code needs to add the year (current or +/- 1 year) to the string to be parsed.&lt;br/&gt;
I hope to provide a patch this weekend.&lt;/p&gt;</comment>
                            <comment id="12576527" author="rwinston@eircom.net" created="Sat, 8 Mar 2008 11:09:36 +0000"  >&lt;p&gt;Hi Sebb&lt;/p&gt;

&lt;p&gt;This works fine for me on net-1.5 and net-2.0. Can you step into the code and make sure that it is hitting the point where it adds the year element (which it should be doing already)?&lt;/p&gt;</comment>
                            <comment id="12576538" author="sebb@apache.org" created="Sat, 8 Mar 2008 13:23:08 +0000"  >&lt;p&gt;Just found that the test works on Java 1.5 but fails with Java 1.4 (and probably 1.3)&lt;br/&gt;
Presumably something has changed in the Java 1.5 run-time library.&lt;/p&gt;

&lt;p&gt;Since net 1.5 is targetted at Java 1.3 the problem needs to be fixed.&lt;/p&gt;

&lt;p&gt;There also clearly need to be test cases for Feb 29.&lt;br/&gt;
I think full testing depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-198&quot; title=&quot;FTPTimestampParserImpl#parseTimeStamp() is not fully testable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-198&quot;&gt;&lt;del&gt;NET-198&lt;/del&gt;&lt;/a&gt; being applied, but one can run the following Feb 29 test at present:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testParseFeb29() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        FTPTimestampParserImpl parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FTPTimestampParserImpl();
        Calendar cal;
        cal=parser.parseTimestamp(&lt;span class=&quot;code-quote&quot;&gt;&quot;feb 29 20:04&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dom = cal.get(Calendar.DAY_OF_MONTH);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; mon = cal.get(Calendar.MONTH);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dom != 29 || mon != Calendar.FEBRUARY){
            mon++;
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;failed to parse Feb 29; gave mon=&quot;&lt;/span&gt;+mon+&lt;span class=&quot;code-quote&quot;&gt;&quot; dom=&quot;&lt;/span&gt;+dom);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12576830" author="sebb@apache.org" created="Sun, 9 Mar 2008 22:43:53 +0000"  >&lt;p&gt;This is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-83&quot; title=&quot;[net] FTP timestamp: year recognition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-83&quot;&gt;&lt;del&gt;NET-83&lt;/del&gt;&lt;/a&gt;, which describes another instance where the FTP directory listing does not show the year.&lt;br/&gt;
Note that FreeBSD shows past and future dates without the year if the date is within 6 months of the current date, for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-rw-r--r--  1 user Domain Users  0 Sep  9  2007 200709091234.tmp
-rw-r--r--  1 user Domain Users  0 Sep 10 12:34 200709101234.tmp

-rw-r--r--  1 user Domain Users  0 Sep  7 12:34 200809071234.tmp
-rw-r--r--  1 user Domain Users  0 Sep  8  2008 200809081234.tmp

Sun Mar  9 15:05:09 EDT 2008 # date when listing was obtained
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file names show the actual timestamp used to &quot;touch&quot; the files.&lt;/p&gt;

&lt;p&gt;Looks like the interval that is used is 26 weeks.&lt;br/&gt;
Provided that the client and server clocks are not adrift by more than a day, this should mean that a short date is never ambiguous.&lt;/p&gt;</comment>
                            <comment id="12578008" author="sebb@apache.org" created="Wed, 12 Mar 2008 20:19:42 +0000"  >&lt;p&gt;Patch which appears to solve the Feb 29 problem on Java 1.4.&lt;br/&gt;
Can also be applied to NET_2.0 branch if desired.&lt;br/&gt;
The patch changes the processing so the short form is always parsed with the current year appended.&lt;br/&gt;
So the short form format string(s) could potentially be changed to include the year.&lt;/p&gt;</comment>
                            <comment id="12579187" author="moberhuber" created="Sun, 16 Mar 2008 12:53:08 +0000"  >&lt;p&gt;I applied the patch, and it works fine for Feb.29.&lt;/p&gt;

&lt;p&gt;But I see a problem when it is Dec.31 on the client computer, server is in a different time zone and shows a date as Jan.01 &amp;#8211; in this case the result date is rolled back a whole year. Here is a test case, that can be added to FTPTimestampParserImplTest.java, and fails with both Commons.Net 1.4.1 as well as HEAD as well as with the patch applied:&lt;/p&gt;

&lt;p&gt;    public void testParseJan01() throws Exception &lt;/p&gt;
{
        GregorianCalendar now = new GregorianCalendar(2007, Calendar.DECEMBER, 31, 12, 0);
        checkShortParse(&quot;2007-12-31&quot;,now,now); // should always work
        GregorianCalendar target = (GregorianCalendar) now.clone();
        target.add(Calendar.DAY_OF_YEAR, +1);
        checkShortParse(&quot;2008-1-1&quot;,now,target);
    }


&lt;p&gt;I think this is the kind of situation that was originally meant to address with the setLenienFutureDates() method - See &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-83&quot; title=&quot;[net] FTP timestamp: year recognition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-83&quot;&gt;&lt;del&gt;NET-83&lt;/del&gt;&lt;/a&gt;, comment on FTPTimestampParserImpl is &quot;Fix bug 35181 - add an option to specify leniency when needed because client and server systems cannot be synchronized.&quot;&lt;/p&gt;

&lt;p&gt;The right solution, IMHO, is to allow short dates +- 6 months in the future or past, which seems to be in line with what FreeBSD is doing as well as what Linux is doing. Note that allowing a short date in the future might require adding &quot;current year + 1&quot; to the current Feb29 hack to fix a case where a future date is a leap year on Feb.29.&lt;/p&gt;</comment>
                            <comment id="12579188" author="moberhuber" created="Sun, 16 Mar 2008 12:56:56 +0000"  >&lt;p&gt;Patch to add testcase for Jan01 to FTPTimestampParserImplTest.java&lt;/p&gt;

&lt;p&gt;Sorry for not knowing how to format the testcase properly in a Jira comment.&lt;/p&gt;</comment>
                            <comment id="12579247" author="rwinston@eircom.net" created="Sun, 16 Mar 2008 20:21:39 +0000"  >&lt;p&gt;Ok, so if we add the +/- 6 month date parsing logic, do you think we should make this the default? Or an optional operating mode (like the current lenient mode)? Or could we just drop the lenient mode if we add the +/- 6 month parsing?&lt;/p&gt;</comment>
                            <comment id="12579253" author="moberhuber" created="Sun, 16 Mar 2008 20:52:00 +0000"  >&lt;p&gt;I&apos;d suggest that in terms of API, when a programmer knows the exact behavior of the server, he should be able to get exact timestamps even if they are short and/or in the future. Right now we know that FreeBSD does +-6-month short dates; Linux RHEL4 does +0/-6-month short dates.&lt;/p&gt;

&lt;p&gt;So what about a new API like&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
   FTPClientConfig#setShortDateRange(long msecPast, long msecFuture)&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;br/&gt;
that specifies in what range of time difference a short date is considered to be in the past, or in the future respectively. The Javadoc comment could be similar to the #setLenientFutureDates() method.&lt;/p&gt;

&lt;p&gt;The old setLenientFutureDates(boolean) method could be deprecated, and translated into this:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
if(lenientFutureDates) {&lt;br/&gt;
   setShortDateRange(1000L * 86400 * 364, 1000L * 86400);&lt;br/&gt;
} else {&lt;br/&gt;
   setShortDateRange(1000L * 86400 * 365, 0);&lt;br/&gt;
}&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not completely sure what would be the best default value for the new settings. Given that lenientFutureDates was false by default, we should probably always expect dates in the past only by default. On the other hand, given that a &quot;one day in future&quot; date is much more likely due to time zone differences than a &quot;365 days in the past&quot; short date, a setting of +1 day / -364 days might be a more appropriate default.&lt;/p&gt;

&lt;p&gt;As a matter of fact, we cannot ever guarantee correct parsing when the user has not specified by API what the setting should be. So the goal of a good default setting could either be &quot;avoid invalid dates even if a parse error occurs&quot; (not expected by the average user, IMHO, as the Feb.29 case shows); or, &quot;always fall back to a reasonable date as it would be read by the user, even if it might be incorrect&quot;.&lt;/p&gt;

&lt;p&gt;Given that the original RFC for FTP says &quot;The output of DIR is designed for human readers and might not be machine readable&quot;, I think the default should be guided by what a human user would expect from the listing. That being said, I think that when it&apos;s March 15 and I&apos;m reading &quot;March 16&quot; I&apos;d expect a future date; reading &quot;March 20&quot; I&apos;d expect a past date; so I&apos;m in favor of a &quot;+1 day / -364 days&quot; strategy by default.&lt;/p&gt;

&lt;p&gt;Which is, admittedly, breaking the previous behavior which was lenientFuture == false meanding a +0 / -365 strategy.&lt;/p&gt;</comment>
                            <comment id="12581653" author="mhnagaoka" created="Mon, 24 Mar 2008 19:44:49 +0000"  >&lt;p&gt;Don&apos;t you guys think that the piece of code below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lenientFutureDates) {
 &lt;span class=&quot;code-comment&quot;&gt;// add a day to &lt;span class=&quot;code-quote&quot;&gt;&quot;now&quot;&lt;/span&gt; so that &lt;span class=&quot;code-quote&quot;&gt;&quot;slop&quot;&lt;/span&gt; doesn&apos;t cause a date 
&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// slightly in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; to roll back a full year.  (Bug 35181)
&lt;/span&gt; now.add(Calendar.DATE, 1);
}    
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (working.after(now)) {
 working.add(Calendar.YEAR, -1);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; should also be executed when the &lt;tt&gt;hackFormatter&lt;/tt&gt; is used? Rather than only when the &lt;tt&gt;recentDateFormat&lt;/tt&gt; is used?&lt;/p&gt;</comment>
                            <comment id="12586215" author="sebb@apache.org" created="Mon, 7 Apr 2008 00:28:36 +0000"  >&lt;p&gt;Applied patch of 12/Mar/08 01:19 PM to trunk:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=645336&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=645336&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This fixes the Feb 29 test errors.&lt;/p&gt;

&lt;p&gt;As far as I can see also addresses Mauricio&apos;s comment of 24/Mar/08.&lt;/p&gt;

&lt;p&gt;There remains the problem of future dates.&lt;/p&gt;</comment>
                            <comment id="12586219" author="sebb@apache.org" created="Mon, 7 Apr 2008 01:49:25 +0000"  >&lt;p&gt;I think the original bug (Feb 29 parsing) reported in this issue has now been solved, so this issue can be closed.&lt;/p&gt;

&lt;p&gt;I&apos;ve created two new JIRA issues to deal with the other issues raised in the discussion above:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/NET-211&quot; title=&quot;setLenient() does not work across a year boundary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-211&quot;&gt;&lt;del&gt;NET-211&lt;/del&gt;&lt;/a&gt; - setLenient() does not work across a year boundary&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/NET-212&quot; title=&quot;FTP short date parsing - how to handle future dates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-212&quot;&gt;&lt;del&gt;NET-212&lt;/del&gt;&lt;/a&gt; - FTP short date parsing - how to handle future dates &lt;/p&gt;</comment>
                            <comment id="12586394" author="moberhuber" created="Mon, 7 Apr 2008 13:54:12 +0000"  >&lt;p&gt;I&apos;m also fine with closing this. There&apos;s only FTPTimestampParserImpl line 124 which I do not quite understand:&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
working.set(Calendar.YEAR, now.get(Calendar.YEAR));&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;This code branch only gets executed when the hackFormatter parsed OK, so it must have read the year already and setting the year yet again should be unnecessary?&lt;/p&gt;</comment>
                            <comment id="12586402" author="sebb@apache.org" created="Mon, 7 Apr 2008 14:11:46 +0000"  >&lt;p&gt;I think you&apos;re correct - looks like that line is a left-over from the previous code, where the hackFormatter parsing was done later.&lt;/p&gt;

&lt;p&gt;Fixed in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=645528&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=645528&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12596445" author="sumauan" created="Tue, 13 May 2008 16:58:03 +0000"  >&lt;p&gt;I&apos;ve done another fix for the leap year problem. This should work regardless which is the correct year for the 29. Feb (this year or last year).&lt;br/&gt;
See attached file &quot;FTPTimestampParserImpl.patch&quot;&lt;/p&gt;

&lt;p&gt;Index: FTPTimestampParserImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; FTPTimestampParserImpl.java	(revision 473)&lt;br/&gt;
+++ FTPTimestampParserImpl.java	(working copy)&lt;br/&gt;
@@ -41,6 +41,7 @@&lt;/p&gt;

&lt;p&gt; 	private SimpleDateFormat defaultDateFormat;&lt;br/&gt;
 	private SimpleDateFormat recentDateFormat;&lt;br/&gt;
+	private SimpleDateFormat recentWithYearDateFormat;&lt;/p&gt;


&lt;p&gt; 	/**&lt;br/&gt;
@@ -75,35 +76,62 @@&lt;br/&gt;
 		ParsePosition pp = new ParsePosition(0);&lt;/p&gt;

&lt;p&gt; 		Date parsed = null;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (this.recentDateFormat != null) 
{
-			parsed = recentDateFormat.parse(timestampStr, pp);
-		}&lt;/li&gt;
	&lt;li&gt;if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length())&lt;/li&gt;
	&lt;li&gt;{&lt;/li&gt;
	&lt;li&gt;working.setTime(parsed);&lt;/li&gt;
	&lt;li&gt;working.set(Calendar.YEAR, now.get(Calendar.YEAR));&lt;/li&gt;
	&lt;li&gt;if (working.after(now)) 
{
-				working.add(Calendar.YEAR, -1);
-			}&lt;/li&gt;
	&lt;li&gt;} else {&lt;br/&gt;
+		if (recentWithYearDateFormat != null) {&lt;br/&gt;
+			//For the 29. Feb of a leap year we have to parse with the correct year because&lt;br/&gt;
+			//parsing without a year defaults to 1970 which is not a leap year, then the parsing fails or we get the 1 of mrach&lt;br/&gt;
+			String timestamWithYearStr = timestampStr.trim() + &quot; &quot; + now.get(Calendar.YEAR);&lt;br/&gt;
 			pp = new ParsePosition(0);&lt;/li&gt;
	&lt;li&gt;parsed = defaultDateFormat.parse(timestampStr, pp);&lt;/li&gt;
	&lt;li&gt;// note, length checks are mandatory for us since&lt;/li&gt;
	&lt;li&gt;// SimpleDateFormat methods will succeed if less than&lt;/li&gt;
	&lt;li&gt;// full string is matched.  They will also accept,&lt;/li&gt;
	&lt;li&gt;// despite &quot;leniency&quot; setting, a two-digit number as&lt;/li&gt;
	&lt;li&gt;// a valid year (e.g. 22:04 will parse as 22 A.D.)&lt;/li&gt;
	&lt;li&gt;// so could mistakenly confuse an hour with a year,&lt;/li&gt;
	&lt;li&gt;// if we don&apos;t insist on full length parsing.&lt;/li&gt;
	&lt;li&gt;if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length()) {&lt;br/&gt;
+			parsed = recentWithYearDateFormat.parse(timestamWithYearStr, pp);&lt;br/&gt;
+			if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestamWithYearStr.length()) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { 				working.setTime(parsed);+				working.set(Calendar.YEAR, now.get(Calendar.YEAR));+				if (working.after(now)) {
+					working.add(Calendar.YEAR, -1);
+				}&lt;br/&gt;
+				&lt;br/&gt;
+				return working;&lt;br/&gt;
 			} else {&lt;br/&gt;
-				throw new ParseException(&lt;br/&gt;
-					&quot;Timestamp could not be parsed with older or recent DateFormat&quot;, &lt;br/&gt;
-					pp.getIndex());&lt;br/&gt;
+				timestamWithYearStr = timestampStr.trim() + &quot; &quot; + (now.get(Calendar.YEAR) - 1);&lt;br/&gt;
+				pp = new ParsePosition(0);&lt;br/&gt;
+				parsed = recentWithYearDateFormat.parse(timestamWithYearStr, pp);&lt;br/&gt;
+				if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestamWithYearStr.length()) {
+					working.setTime(parsed);
+					return working;
+				}&lt;br/&gt;
 			}&lt;br/&gt;
+		} else if (this.recentDateFormat != null) {&lt;br/&gt;
+			parsed = recentDateFormat.parse(timestampStr, pp);&lt;br/&gt;
+			if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length()) &lt;br/&gt;
+			{&lt;br/&gt;
+				working.setTime(parsed);&lt;br/&gt;
+				working.set(Calendar.YEAR, now.get(Calendar.YEAR));&lt;br/&gt;
+				if (working.after(now)) {+					working.add(Calendar.YEAR, -1);+				}+				+				return working;+			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; 		}&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;return working;&lt;br/&gt;
+		&lt;br/&gt;
+		pp = new ParsePosition(0);&lt;br/&gt;
+		parsed = defaultDateFormat.parse(timestampStr, pp);&lt;br/&gt;
+		// note, length checks are mandatory for us since&lt;br/&gt;
+		// SimpleDateFormat methods will succeed if less than&lt;br/&gt;
+		// full string is matched.  They will also accept, &lt;br/&gt;
+		// despite &quot;leniency&quot; setting, a two-digit number as&lt;br/&gt;
+		// a valid year (e.g. 22:04 will parse as 22 A.D.) &lt;br/&gt;
+		// so could mistakenly confuse an hour with a year, &lt;br/&gt;
+		// if we don&apos;t insist on full length parsing.&lt;br/&gt;
+		if (parsed != null &amp;amp;&amp;amp; pp.getIndex() == timestampStr.length()) 
{
+			working.setTime(parsed);
+			
+			return working;
+		}
&lt;p&gt;+			&lt;br/&gt;
+&lt;br/&gt;
+		throw new ParseException(&lt;br/&gt;
+				&quot;Timestamp could not be parsed with older or recent DateFormat&quot;, &lt;br/&gt;
+				pp.getIndex());&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	/**&lt;br/&gt;
@@ -146,6 +174,11 @@&lt;br/&gt;
 		if (format != null) {&lt;br/&gt;
 			this.recentDateFormat = new SimpleDateFormat(format);&lt;br/&gt;
 			this.recentDateFormat.setLenient(false);&lt;br/&gt;
+			&lt;br/&gt;
+			if (format.indexOf(&quot;y&quot;) == -1) &lt;/p&gt;
{
+				this.recentWithYearDateFormat = new SimpleDateFormat(format.trim() + &quot; yyyy&quot;);
+				this.recentWithYearDateFormat.setLenient(false);
+			}
&lt;p&gt; 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;@@ -179,6 +212,9 @@&lt;br/&gt;
 		if (this.recentDateFormat != null) &lt;/p&gt;
{
 			this.recentDateFormat.setTimeZone(serverTimeZone);
 		}
&lt;p&gt;			&lt;br/&gt;
+		if (this.recentWithYearDateFormat != null) &lt;/p&gt;
{
+			this.recentWithYearDateFormat.setTimeZone(serverTimeZone);
+		}
&lt;p&gt;			&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	/**&lt;br/&gt;
@@ -223,6 +259,11 @@&lt;br/&gt;
 		} else {&lt;br/&gt;
 			this.recentDateFormat = new SimpleDateFormat(recentFormatString, dfs);&lt;br/&gt;
 			this.recentDateFormat.setLenient(false);&lt;br/&gt;
+&lt;br/&gt;
+			if (recentFormatString.indexOf(&quot;y&quot;) == -1) &lt;/p&gt;
{
+				this.recentWithYearDateFormat = new SimpleDateFormat(recentFormatString.trim() + &quot; yyyy&quot;, dfs);
+				this.recentWithYearDateFormat.setLenient(false);
+			}
&lt;p&gt; 		}&lt;/p&gt;

&lt;p&gt; 		String defaultFormatString = config.getDefaultDateFormatStr();&lt;/p&gt;
</comment>
                            <comment id="12596452" author="sebb@apache.org" created="Tue, 13 May 2008 17:07:41 +0000"  >&lt;p&gt;Thanks, but it has already been fixed in SVN.&lt;/p&gt;</comment>
                            <comment id="12597281" author="antonio" created="Thu, 15 May 2008 21:43:17 +0000"  >&lt;p&gt;If this is fixed, you should close this issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12390526">NET-198</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12390542">NET-199</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12392695">NET-209</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12389869">NET-190</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12390098">NET-193</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12399076">NET-224</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12389928">NET-191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12389871">VFS-201</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12393276">NET-211</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12544760">HADOOP-8127</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12342278">NET-83</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12393277">NET-212</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12391514">NET-205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12376974" name="DstParseTest.java" size="545" author="bpphillips" created="Mon, 3 Mar 2008 12:48:22 +0000"/>
                            <attachment id="12381969" name="FTPTimestampParserImpl.patch" size="4665" author="sumauan" created="Tue, 13 May 2008 16:58:03 +0000"/>
                            <attachment id="12377727" name="FTPTimestampParserLeap.patch" size="4473" author="sebb" created="Wed, 12 Mar 2008 20:19:42 +0000"/>
                            <attachment id="12376838" name="commons-net-ftp-date-parser-feb29.patch" size="1255" author="bonefish" created="Fri, 29 Feb 2008 16:10:21 +0000"/>
                            <attachment id="12377995" name="jan01.patch" size="677" author="moberhuber" created="Sun, 16 Mar 2008 12:56:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>154520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kukv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>119772</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>