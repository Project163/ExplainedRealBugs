<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NET-466] Regression: TelnetInputStream#available() blocks</title>
                <link>https://issues.apache.org/jira/browse/NET-466</link>
                <project id="12310487" key="NET">Commons Net</project>
                    <description>&lt;p&gt;When testing with Commons Net 3.1 for Eclipse &lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=194473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=194473&lt;/a&gt; , I found that our telnet client blocks when the ReaderThread is running and waiting for new data. Investigation shows that our code blocks on TelnetInputStream#available().&lt;/p&gt;

&lt;p&gt;This regression is due to the code introduced for &lt;a href=&quot;https://issues.apache.org/jira/browse/NET-437&quot; title=&quot;TelnetInputStream doesn&amp;#39;t support non-blocking IO when reader thread is not enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-437&quot;&gt;&lt;del&gt;NET-437&lt;/del&gt;&lt;/a&gt; &quot;TelnetInputStream doesn&apos;t support non-blocking IO when reader thread is not enabled&quot;:&lt;/p&gt;

&lt;p&gt;TelnetInputStream#available() now calls super.available() which is declared as &quot;synchronized&quot; on BufferedInputStream in JDK 1.6.0_21 at least. But at the same time, the telnet ReaderThread has already the Monitor on BufferedInputStream and doesn&apos;t give it up while sitting in read0().&lt;/p&gt;

&lt;p&gt;This seems to be exactly the situation that the comment before TelnetInputStream#close() warns about:&lt;br/&gt;
    // Cannot be synchronized.  Will cause deadlock if run() is blocked&lt;br/&gt;
    // in read because BufferedInputStream read() is synchronized.&lt;/p&gt;

&lt;p&gt;This is a severe issue since it violates the specification and use of available().&lt;/p&gt;</description>
                <environment></environment>
        <key id="12557443">NET-466</key>
            <summary>Regression: TelnetInputStream#available() blocks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="moberhuber">Martin Oberhuber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 May 2012 13:39:51 +0000</created>
                <updated>Wed, 17 Apr 2013 19:57:40 +0000</updated>
                            <resolved>Fri, 5 Oct 2012 18:00:19 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                    <component>Telnet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13285341" author="garydgregory" created="Wed, 30 May 2012 02:14:59 +0000"  >&lt;p&gt;Are you saying that all methods in &lt;tt&gt;BufferedInputStream&lt;/tt&gt; marked with &lt;tt&gt;synchronized&lt;/tt&gt; should also be marked as such in &lt;tt&gt;TelnetInputStream&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;This in TelnetClient is confusing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void _connectAction_() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;._connectAction_();
        TelnetInputStream tmp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TelnetInputStream(_input_, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, readerThread);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(readerThread)
        {
            tmp._start();
        }
        &lt;span class=&quot;code-comment&quot;&gt;// __input CANNOT refer to the TelnetInputStream.  We run into
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// blocking problems when some classes use TelnetInputStream, so
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// we wrap it with a BufferedInputStream which we know is safe.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// This blocking behavior requires further investigation, but right
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// now it looks like classes like InputStreamReader are not implemented
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// in a safe manner.
&lt;/span&gt;        __input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(tmp);
        __output = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TelnetOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;TelnetInputStream&lt;/tt&gt; subclasses &lt;tt&gt;BufferedInputStream&lt;/tt&gt; and this method wraps the &lt;tt&gt;TelnetInputStream&lt;/tt&gt; in a &lt;tt&gt;BufferedInputStream&lt;/tt&gt;. Is that what is intended here? If so, it needs better docs!&lt;/p&gt;</comment>
                            <comment id="13420805" author="konrad.garus" created="Mon, 23 Jul 2012 17:35:22 +0000"  >&lt;p&gt;I have not inspected the source, just wanted to report/confirm that &lt;tt&gt;TelnetInputStream.available()&lt;/tt&gt; seems to be blocking indefinitely. I noticed this regression after upgrading from 1.4.1 to 3.1.&lt;/p&gt;

&lt;p&gt;It&apos;s a severe issue for us, blocking update which we direly need for other areas (FTP client).&lt;/p&gt;</comment>
                            <comment id="13420833" author="konrad.garus" created="Mon, 23 Jul 2012 18:06:53 +0000"  >&lt;p&gt;The issue disappears as soon as I disable the reader thread.&lt;/p&gt;

&lt;p&gt;Here are relevant stacktraces from the lock-up:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-0&quot;&lt;/span&gt; daemon prio=10 tid=0x00007f721c61a000 nid=0x3dea runnable [0x00007f7218ee7000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)
	at java.io.BufferedInputStream.read(BufferedInputStream.java:317)
	- locked &amp;lt;0x00000007d70f7510&amp;gt; (a java.io.BufferedInputStream)
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
	at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
	- locked &amp;lt;0x00000007d70fbab0&amp;gt; (a org.apache.commons.net.telnet.TelnetInputStream)
	at org.apache.commons.net.telnet.TelnetInputStream.__read(TelnetInputStream.java:140)
	at org.apache.commons.net.telnet.TelnetInputStream.run(TelnetInputStream.java:608)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

   Locked ownable synchronizers:
	- None



&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; prio=10 tid=0x00007f721c00d000 nid=0x3dd0 waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry [0x00007f7223c29000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED (on object monitor)
	at java.io.BufferedInputStream.available(BufferedInputStream.java:381)
	- waiting to lock &amp;lt;0x00000007d70fbab0&amp;gt; (a org.apache.commons.net.telnet.TelnetInputStream)
	at org.apache.commons.net.telnet.TelnetInputStream.available(TelnetInputStream.java:563)
	- locked &amp;lt;0x00000007d70fe320&amp;gt; (a [I)
	at java.io.BufferedInputStream.available(BufferedInputStream.java:381)
	- locked &amp;lt;0x00000007d7100498&amp;gt; (a java.io.BufferedInputStream)
	at com.example.Main.main(Main.java:95)

   Locked ownable synchronizers:
	- None
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13437287" author="sebb@apache.org" created="Sat, 18 Aug 2012 10:30:08 +0000"  >&lt;p&gt;Applied a fix which should work:&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1374548&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1374548&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/NET-466&quot; title=&quot;Regression: TelnetInputStream#available() blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NET-466&quot;&gt;&lt;del&gt;NET-466&lt;/del&gt;&lt;/a&gt; Regression: TelnetInputStream#available() blocks&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/net/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/net/trunk/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java&lt;/p&gt;


&lt;p&gt;It might be that synchronizing the methods as per Gary&apos;s comment would also fix the issue.&lt;/p&gt;

&lt;p&gt;Does anyone have a suitable test case that shows the issue?&lt;/p&gt;</comment>
                            <comment id="13445743" author="posken" created="Fri, 31 Aug 2012 07:38:04 +0000"  >&lt;p&gt;We had problems using the Telnet client in 3.1 with the &apos;available&apos; that blocked (every time again) So we reverted to 3.0.1. I now downloaded the source code from the trunk and tried it again and now it just works. Don&apos;t have a real test case because it is rather interwoven in the code. So not a &quot;scientific&quot; test, rather a practical one. &lt;/p&gt;</comment>
                            <comment id="13445822" author="sebb@apache.org" created="Fri, 31 Aug 2012 10:30:33 +0000"  >&lt;p&gt;Thanks, that&apos;s very useful to know.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12614470">NET-487</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05aj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>28803</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>