diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppCategoriesProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppCategoriesProvider.java
index 94088834..13e5cd46 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppCategoriesProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppCategoriesProvider.java
@@ -21,7 +21,6 @@ package org.apache.wink.common.internal.providers.entity.app;
 
 import java.io.IOException;
 import java.io.OutputStream;
-import java.io.OutputStreamWriter;
 import java.lang.annotation.Annotation;
 import java.lang.reflect.Type;
 
@@ -33,6 +32,7 @@ import javax.ws.rs.ext.MessageBodyWriter;
 import javax.ws.rs.ext.Provider;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.Marshaller;
+import javax.xml.bind.PropertyException;
 
 import org.apache.wink.common.internal.utils.MediaTypeUtils;
 import org.apache.wink.common.model.app.AppCategories;
@@ -59,12 +59,14 @@ public class AppCategoriesProvider implements MessageBodyWriter<AppCategories> {
 
     public void writeTo(AppCategories t, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType, MultivaluedMap<String, Object> httpHeaders,
             OutputStream entityStream) throws IOException, WebApplicationException {
-        ObjectFactory objectFactory = new ObjectFactory();
-        JAXBElement<AppCategories> feedElement = objectFactory.createCategories(t);
-        Marshaller marshaller = AppCategories.getMarshaller();
-        OutputStreamWriter writer = new OutputStreamWriter(entityStream,
-            ProviderUtils.getCharset(mediaType));
-        AtomJAXBUtils.marshal(marshaller, feedElement, null, writer);
-        writer.flush();
+        try {
+            ObjectFactory objectFactory = new ObjectFactory();
+            JAXBElement<AppCategories> feedElement = objectFactory.createCategories(t);
+            Marshaller marshaller = AppCategories.getMarshaller();
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+            AtomJAXBUtils.marshal(marshaller, feedElement, entityStream);
+        } catch (PropertyException e) {
+            throw new WebApplicationException(e);
+        }
     }
 }
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppServiceProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppServiceProvider.java
index f037a43c..905aafa1 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppServiceProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/app/AppServiceProvider.java
@@ -21,7 +21,6 @@ package org.apache.wink.common.internal.providers.entity.app;
 
 import java.io.IOException;
 import java.io.OutputStream;
-import java.io.OutputStreamWriter;
 import java.lang.annotation.Annotation;
 import java.lang.reflect.Type;
 
@@ -33,6 +32,7 @@ import javax.ws.rs.ext.MessageBodyWriter;
 import javax.ws.rs.ext.Provider;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.Marshaller;
+import javax.xml.bind.PropertyException;
 
 import org.apache.wink.common.internal.utils.MediaTypeUtils;
 import org.apache.wink.common.model.app.AppService;
@@ -40,7 +40,6 @@ import org.apache.wink.common.model.app.ObjectFactory;
 import org.apache.wink.common.model.atom.AtomJAXBUtils;
 import org.apache.wink.common.utils.ProviderUtils;
 
-
 /**
  * Representation of Atom Service Document.
  */
@@ -48,23 +47,38 @@ import org.apache.wink.common.utils.ProviderUtils;
 @Produces(MediaTypeUtils.ATOM_SERVICE_DOCUMENT)
 public class AppServiceProvider implements MessageBodyWriter<AppService> {
 
-    public long getSize(AppService t, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType) {
+    public long getSize(AppService t,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType) {
         return -1;
     }
 
-    public boolean isWriteable(Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType) {
+    public boolean isWriteable(Class<?> type,
+                               Type genericType,
+                               Annotation[] annotations,
+                               MediaType mediaType) {
         return type == AppService.class;
     }
 
-    public void writeTo(AppService t, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType, MultivaluedMap<String, Object> httpHeaders,
-            OutputStream entityStream) throws IOException, WebApplicationException {
+    public void writeTo(AppService t,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType,
+                        MultivaluedMap<String, Object> httpHeaders,
+                        OutputStream entityStream) throws IOException, WebApplicationException {
 
-        ObjectFactory objectFactory = new ObjectFactory();
-        JAXBElement<AppService> sd = objectFactory.createService(t);
-        Marshaller marshaller = AppService.getMarshaller();
-        OutputStreamWriter writer = new OutputStreamWriter(entityStream, ProviderUtils.getCharset(mediaType));
-        AtomJAXBUtils.marshal(marshaller, sd, null, writer);
-        writer.flush();
+        try {
+            ObjectFactory objectFactory = new ObjectFactory();
+            JAXBElement<AppService> sd = objectFactory.createService(t);
+            Marshaller marshaller = AppService.getMarshaller();
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+            AtomJAXBUtils.marshal(marshaller, sd, entityStream);
+        } catch (PropertyException e) {
+            throw new WebApplicationException(e);
+        }
     }
 
-}
\ No newline at end of file
+}
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomEntryProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomEntryProvider.java
index fd7b8630..45879056 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomEntryProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomEntryProvider.java
@@ -23,7 +23,6 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.io.OutputStream;
-import java.io.OutputStreamWriter;
 import java.lang.annotation.Annotation;
 import java.lang.reflect.Type;
 
@@ -33,53 +32,73 @@ import javax.ws.rs.core.MultivaluedMap;
 import javax.ws.rs.core.Response.Status;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.Marshaller;
+import javax.xml.bind.PropertyException;
 import javax.xml.bind.Unmarshaller;
 
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
 import org.apache.wink.common.model.atom.AtomEntry;
 import org.apache.wink.common.model.atom.AtomJAXBUtils;
 import org.apache.wink.common.model.atom.ObjectFactory;
 import org.apache.wink.common.utils.ProviderUtils;
-
-
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 public abstract class AbstractAtomEntryProvider<T> {
 
-    private static final Logger logger = LoggerFactory.getLogger(AbstractAtomEntryProvider.class);
+    private static final Logger logger            =
+                                                      LoggerFactory
+                                                          .getLogger(AbstractAtomEntryProvider.class);
 
-    protected ObjectFactory atomObjectFactory = new org.apache.wink.common.model.atom.ObjectFactory();
+    protected ObjectFactory     atomObjectFactory =
+                                                      new org.apache.wink.common.model.atom.ObjectFactory();
 
-    public long getSize(T t, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType) {
+    public long getSize(T t,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType) {
         return -1;
     }
 
-    protected void writeEntry(AtomEntry entry, Class<?> type, Type genericType, Annotation[] annotations,
-            MediaType mediaType, MultivaluedMap<String,Object> httpHeaders, OutputStream entityStream)
-            throws IOException, WebApplicationException {
+    protected void writeEntry(AtomEntry entry,
+                              Class<?> type,
+                              Type genericType,
+                              Annotation[] annotations,
+                              MediaType mediaType,
+                              MultivaluedMap<String, Object> httpHeaders,
+                              OutputStream entityStream) throws IOException,
+        WebApplicationException {
         if (entry == null) {
             return;
         }
 
-        JAXBElement<AtomEntry> entryElement = atomObjectFactory.createEntry(entry);
-        Marshaller marshaller = AtomEntry.getMarshaller();
-        OutputStreamWriter writer = new OutputStreamWriter(entityStream, ProviderUtils.getCharset(mediaType));
-        AtomJAXBUtils.marshal(marshaller, entryElement, null, writer);
-        writer.flush();
+        try {
+            JAXBElement<AtomEntry> entryElement = atomObjectFactory.createEntry(entry);
+            Marshaller marshaller = AtomEntry.getMarshaller();
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+            AtomJAXBUtils.marshal(marshaller, entryElement, entityStream);
+        } catch (PropertyException e) {
+            throw new WebApplicationException(e);
+        }
     }
 
-    protected AtomEntry readEntry(Class<AtomEntry> type, Type genericType, Annotation[] annotations,
-            MediaType mediaType, MultivaluedMap<String,String> httpHeaders, InputStream entityStream)
-            throws IOException, WebApplicationException {
+    protected AtomEntry readEntry(Class<AtomEntry> type,
+                                  Type genericType,
+                                  Annotation[] annotations,
+                                  MediaType mediaType,
+                                  MultivaluedMap<String, String> httpHeaders,
+                                  InputStream entityStream) throws IOException,
+        WebApplicationException {
 
         Unmarshaller unmarshaller = AtomEntry.getUnmarshaller();
-        InputStreamReader reader = new InputStreamReader(entityStream, ProviderUtils.getCharset(mediaType));
+        InputStreamReader reader =
+            new InputStreamReader(entityStream, ProviderUtils.getCharset(mediaType));
         Object object = AtomJAXBUtils.unmarshal(unmarshaller, reader);
         AtomEntry entry = null;
         if (object instanceof AtomEntry) {
             entry = (AtomEntry)object;
         } else {
-            logger.error("request entity is not an atom entry (it was unmarshalled as {})", object.getClass());
+            logger.error("request entity is not an atom entry (it was unmarshalled as {})", object
+                .getClass());
             throw new WebApplicationException(Status.BAD_REQUEST);
         }
 
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomFeedProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomFeedProvider.java
index 8002235f..d49da4ee 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomFeedProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/atom/AbstractAtomFeedProvider.java
@@ -23,7 +23,6 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.io.OutputStream;
-import java.io.OutputStreamWriter;
 import java.lang.annotation.Annotation;
 import java.lang.reflect.Type;
 
@@ -33,53 +32,72 @@ import javax.ws.rs.core.MultivaluedMap;
 import javax.ws.rs.core.Response.Status;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.Marshaller;
+import javax.xml.bind.PropertyException;
 import javax.xml.bind.Unmarshaller;
 
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
 import org.apache.wink.common.model.atom.AtomFeed;
 import org.apache.wink.common.model.atom.AtomJAXBUtils;
 import org.apache.wink.common.model.atom.ObjectFactory;
 import org.apache.wink.common.utils.ProviderUtils;
-
-
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 public abstract class AbstractAtomFeedProvider<T> {
 
-    private static final Logger logger = LoggerFactory.getLogger(AbstractAtomFeedProvider.class);
+    private static final Logger logger            =
+                                                      LoggerFactory
+                                                          .getLogger(AbstractAtomFeedProvider.class);
 
-    protected ObjectFactory atomObjectFactory = new org.apache.wink.common.model.atom.ObjectFactory();
+    protected ObjectFactory     atomObjectFactory =
+                                                      new org.apache.wink.common.model.atom.ObjectFactory();
 
-    public long getSize(T t, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType) {
+    public long getSize(T t,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType) {
         return -1;
     }
 
-    protected void writeFeed(AtomFeed feed, Class<?> type, Type genericType, Annotation[] annotations,
-            MediaType mediaType, MultivaluedMap<String,Object> httpHeaders, OutputStream entityStream)
-            throws IOException, WebApplicationException {
+    protected void writeFeed(AtomFeed feed,
+                             Class<?> type,
+                             Type genericType,
+                             Annotation[] annotations,
+                             MediaType mediaType,
+                             MultivaluedMap<String, Object> httpHeaders,
+                             OutputStream entityStream) throws IOException, WebApplicationException {
         if (feed == null) {
             return;
         }
 
-        JAXBElement<AtomFeed> feedElement = atomObjectFactory.createFeed(feed);
-        Marshaller marshaller = AtomFeed.getMarshaller();
-        OutputStreamWriter writer = new OutputStreamWriter(entityStream, ProviderUtils.getCharset(mediaType));
-        AtomJAXBUtils.marshal(marshaller, feedElement, null, writer);
-        writer.flush();
+        try {
+            JAXBElement<AtomFeed> feedElement = atomObjectFactory.createFeed(feed);
+            Marshaller marshaller = AtomFeed.getMarshaller();
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+            AtomJAXBUtils.marshal(marshaller, feedElement, entityStream);
+        } catch (PropertyException e) {
+            throw new WebApplicationException(e);
+        }
     }
 
-    protected AtomFeed readFeed(Class<AtomFeed> type, Type genericType, Annotation[] annotations, MediaType mediaType,
-            MultivaluedMap<String,String> httpHeaders, InputStream entityStream) throws IOException,
-            WebApplicationException {
+    protected AtomFeed readFeed(Class<AtomFeed> type,
+                                Type genericType,
+                                Annotation[] annotations,
+                                MediaType mediaType,
+                                MultivaluedMap<String, String> httpHeaders,
+                                InputStream entityStream) throws IOException,
+        WebApplicationException {
 
         Unmarshaller unmarshaller = AtomFeed.getUnmarshaller();
-        InputStreamReader reader = new InputStreamReader(entityStream, ProviderUtils.getCharset(mediaType));
+        InputStreamReader reader =
+            new InputStreamReader(entityStream, ProviderUtils.getCharset(mediaType));
         Object object = AtomJAXBUtils.unmarshal(unmarshaller, reader);
         AtomFeed feed = null;
         if (object instanceof AtomFeed) {
             feed = (AtomFeed)object;
         } else {
-            logger.error("request entity is not an atom feed (it was unmarshalled as {})", object.getClass());
+            logger.error("request entity is not an atom feed (it was unmarshalled as {})", object
+                .getClass());
             throw new WebApplicationException(Status.BAD_REQUEST);
         }
 
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/opensearch/OpenSearchDescriptionProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/opensearch/OpenSearchDescriptionProvider.java
index 74741043..1e7e3860 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/opensearch/OpenSearchDescriptionProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/opensearch/OpenSearchDescriptionProvider.java
@@ -17,12 +17,11 @@
  *  under the License.
  *  
  *******************************************************************************/
- 
+
 package org.apache.wink.common.internal.providers.entity.opensearch;
 
 import java.io.IOException;
 import java.io.OutputStream;
-import java.io.Writer;
 import java.lang.annotation.Annotation;
 import java.lang.reflect.Type;
 
@@ -34,6 +33,7 @@ import javax.ws.rs.ext.MessageBodyWriter;
 import javax.ws.rs.ext.Provider;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.Marshaller;
+import javax.xml.bind.PropertyException;
 
 import org.apache.wink.common.internal.utils.JAXBUtils;
 import org.apache.wink.common.internal.utils.MediaTypeUtils;
@@ -43,36 +43,45 @@ import org.apache.wink.common.model.opensearch.ObjectFactory;
 import org.apache.wink.common.model.opensearch.OpenSearchDescription;
 import org.apache.wink.common.utils.ProviderUtils;
 
-
-
 @Provider
 @Produces(MediaTypeUtils.OPENSEARCH)
 public class OpenSearchDescriptionProvider implements MessageBodyWriter<OpenSearchDescription> {
 
     private final ObjectFactory of = new ObjectFactory();
 
-    public long getSize(OpenSearchDescription t, Class<?> type, Type genericType,
-        Annotation[] annotations, MediaType mediaType) {
+    public long getSize(OpenSearchDescription t,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType) {
         return -1;
     }
 
-    public boolean isWriteable(Class<?> type, Type genericType, Annotation[] annotations,
-        MediaType mediaType) {
+    public boolean isWriteable(Class<?> type,
+                               Type genericType,
+                               Annotation[] annotations,
+                               MediaType mediaType) {
         return (type == OpenSearchDescription.class);
     }
 
-    public void writeTo(OpenSearchDescription openSearchDescriptor, Class<?> type,
-        Type genericType, Annotation[] annotations, MediaType mediaType,
-        MultivaluedMap<String, Object> httpHeaders, OutputStream entityStream) throws IOException,
-        WebApplicationException {
-        JAXBElement<OpenSearchDescription> openSearchDocumentWrapper = of.createOpenSearchDescription(openSearchDescriptor);
-        Marshaller marshaller = OpenSearchDescription.getMarshaller();
-        JAXBUtils.setXmlFormattingOptions(marshaller,
-            XmlFormattingOptions.getDefaultXmlFormattingOptions());
-
-        Writer writer = ProviderUtils.createWriter(entityStream, mediaType);
-        AtomJAXBUtils.marshal(marshaller, openSearchDocumentWrapper, null, writer);
-        writer.flush();
+    public void writeTo(OpenSearchDescription openSearchDescriptor,
+                        Class<?> type,
+                        Type genericType,
+                        Annotation[] annotations,
+                        MediaType mediaType,
+                        MultivaluedMap<String, Object> httpHeaders,
+                        OutputStream entityStream) throws IOException, WebApplicationException {
+        try {
+            JAXBElement<OpenSearchDescription> openSearchDocumentWrapper =
+                of.createOpenSearchDescription(openSearchDescriptor);
+            Marshaller marshaller = OpenSearchDescription.getMarshaller();
+            JAXBUtils.setXmlFormattingOptions(marshaller, XmlFormattingOptions
+                .getDefaultXmlFormattingOptions());
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+            AtomJAXBUtils.marshal(marshaller, openSearchDocumentWrapper, entityStream);
+        } catch (PropertyException e) {
+            throw new WebApplicationException(e);
+        }
     }
 
 }
diff --git a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomEntry.java b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomEntry.java
index 9235e1a7..30ddf753 100644
--- a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomEntry.java
+++ b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomEntry.java
@@ -24,17 +24,15 @@
 // Generated on: 2008.05.27 at 11:24:25 AM IDT 
 //
 
-
 package org.apache.wink.common.model.atom;
 
 import java.io.IOException;
+import java.io.OutputStream;
 import java.io.Reader;
-import java.io.Writer;
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.List;
 
-import javax.ws.rs.WebApplicationException;
 import javax.xml.bind.JAXBContext;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.JAXBException;
@@ -63,7 +61,6 @@ import org.apache.wink.common.model.synd.SyndPerson;
 import org.apache.wink.common.model.synd.SyndText;
 import org.w3c.dom.Element;
 
-
 /**
  * The "atom:entry" element Per RFC4287
  * 
@@ -139,43 +136,28 @@ import org.w3c.dom.Element;
  */
 @XmlAccessorType(XmlAccessType.FIELD)
 @XmlAccessorOrder(XmlAccessOrder.UNDEFINED)
-@XmlType(name = "atomEntry", propOrder = {
-    "id",
-    "updated",
-    "title",
-    "summary",
-    "published",
-    "link",
-    "author",
-    "contributor",
-    "category",
-    "any",
-    "content"
-})
-public class AtomEntry
-    extends AtomCommonAttributes
-    implements NamespacePrefixMapperProvider
-{
-
-    private static final String MATCH_ANY_PATTERN = ".*";
-    
+@XmlType(name = "atomEntry", propOrder = {"id", "updated", "title", "summary", "published", "link",
+                                          "author", "contributor", "category", "any", "content"})
+public class AtomEntry extends AtomCommonAttributes implements NamespacePrefixMapperProvider {
+
+    private static final String      MATCH_ANY_PATTERN = ".*";
+
     @XmlElement(required = true)
-    protected String id;
+    protected String                 id;
     @XmlElement(required = true)
-    protected XMLGregorianCalendar updated;
+    protected XMLGregorianCalendar   updated;
     @XmlElement(required = true)
-    protected AtomText title;
-    protected AtomText summary;
-    protected XMLGregorianCalendar published;
-    protected List<AtomLink> link;
-    protected List<AtomPerson> author;
-    protected List<AtomPerson> contributor;
-    protected List<AtomCategory> category;
+    protected AtomText               title;
+    protected AtomText               summary;
+    protected XMLGregorianCalendar   published;
+    protected List<AtomLink>         link;
+    protected List<AtomPerson>       author;
+    protected List<AtomPerson>       contributor;
+    protected List<AtomCategory>     category;
     @XmlAnyElement
-    protected List<Element> any;
-    protected AtomContent content;
+    protected List<Element>          any;
+    protected AtomContent            content;
 
-    
     @XmlTransient
     private static final JAXBContext atomContext;
 
@@ -190,43 +172,37 @@ public class AtomEntry
     public static Marshaller getMarshaller() {
         return JAXBUtils.createMarshaller(atomContext);
     }
-    
+
     public static Unmarshaller getUnmarshaller() {
         return JAXBUtils.createUnmarshaller(atomContext);
     }
 
     /**
      * Convenience method for creating an AtomEntry from xml
+     * 
      * @param reader input reader
      * @return AtomEntry instance from the input
      */
-    public static AtomEntry unmarshal(Reader reader) {
-        try {
-            return (AtomEntry)AtomJAXBUtils.unmarshal(AtomEntry.getUnmarshaller(), reader);
-        } catch (IOException e) {
-            throw new RestException(e);
-        }
+    public static AtomEntry unmarshal(Reader reader) throws IOException {
+        return (AtomEntry)AtomJAXBUtils.unmarshal(AtomEntry.getUnmarshaller(), reader);
     }
 
-    public static void marshal(AtomEntry entry, Writer writer) {
-        try {
-            JAXBElement<AtomEntry> entryElement = new ObjectFactory().createEntry(entry);
-            Marshaller marshaller = AtomEntry.getMarshaller();
-            AtomJAXBUtils.marshal(marshaller, entryElement, null, writer);
-            writer.flush();
-        } catch (IOException e) {
-            throw new WebApplicationException(e);
-        }
+    public static void marshal(AtomEntry entry, OutputStream os) throws IOException {
+        JAXBElement<AtomEntry> entryElement = new ObjectFactory().createEntry(entry);
+        Marshaller marshaller = AtomEntry.getMarshaller();
+        AtomJAXBUtils.marshal(marshaller, entryElement, null, os);
     }
-    
+
     public JAXBNamespacePrefixMapper getNamespacePrefixMapper() {
-        JAXBNamespacePrefixMapper mapper = new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
+        JAXBNamespacePrefixMapper mapper =
+            new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
         mapper.omitNamespace(RestConstants.NAMESPACE_OPENSEARCH);
         return mapper;
     }
-    
-    public AtomEntry() {}
-    
+
+    public AtomEntry() {
+    }
+
     public AtomEntry(SyndEntry value) {
         super(value);
         if (value == null) {
@@ -259,7 +235,7 @@ public class AtomEntry
         value.getLinks().addAll(getLinksAsSynd());
         return value;
     }
-    
+
     private List<SyndPerson> getAuthorsAsSynd() {
         List<SyndPerson> authors = new ArrayList<SyndPerson>();
         for (AtomPerson value : getAuthors()) {
@@ -298,7 +274,7 @@ public class AtomEntry
             }
         }
     }
-    
+
     private void setCategories(List<SyndCategory> values) {
         category = new ArrayList<AtomCategory>();
         for (SyndCategory value : values) {
@@ -333,6 +309,7 @@ public class AtomEntry
 
     /**
      * Gets the value of updated as a long value
+     * 
      * @return the updated value, or -1 if it is not set
      */
     public long getUpdatedAsTime() {
@@ -356,7 +333,7 @@ public class AtomEntry
     public void setUpdated(XMLGregorianCalendar value) {
         this.updated = value;
     }
-    
+
     /**
      * Sets the value of updated.
      */
@@ -405,6 +382,7 @@ public class AtomEntry
 
     /**
      * Gets the value of published as a long value
+     * 
      * @return the published value, or -1 if it is not set
      */
     public long getPublishedAsTime() {
@@ -428,7 +406,7 @@ public class AtomEntry
     public void setPublished(XMLGregorianCalendar value) {
         this.published = value;
     }
-    
+
     /**
      * Sets the value of published.
      */
@@ -449,25 +427,19 @@ public class AtomEntry
 
     /**
      * Gets the value of link.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the link.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the link.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getLink().add(newItem);
+     * getLink().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
-     * Objects of the following type(s) are allowed in the list
-     * {@link AtomLink }
-     * 
-     * 
+     * Objects of the following type(s) are allowed in the list {@link AtomLink }
      */
     public List<AtomLink> getLinks() {
         if (link == null) {
@@ -475,9 +447,10 @@ public class AtomEntry
         }
         return this.link;
     }
-    
+
     /**
      * Get the list of links that match the relation and type regex patterns
+     * 
      * @param relationPattern the regex relation pattern to match
      * @param typePattern the regex type pattern to match
      * @return the list of links matching the given regex patterns
@@ -486,7 +459,7 @@ public class AtomEntry
         if (relationPattern == null || typePattern == null) {
             throw new NullPointerException("pattern");
         }
-        
+
         List<AtomLink> matchingLinks = new ArrayList<AtomLink>();
         List<AtomLink> links = getLinks();
         for (AtomLink link : links) {
@@ -504,46 +477,43 @@ public class AtomEntry
         }
         return matchingLinks;
     }
-    
+
     /**
      * Get the list of links that match the relation regex pattern
+     * 
      * @param relationPattern the regex relation pattern to match
      * @return the link matching the given regex pattern, or <code>null</code>
      */
     public List<AtomLink> getLinksByType(String typePattern) {
         return getLinks(MATCH_ANY_PATTERN, typePattern);
     }
-    
+
     /**
      * Get the list of links that match the type regex pattern
+     * 
      * @param typePattern the regex type pattern to match
      * @return the link matching the given regex pattern, or <code>null</code>
      */
     public List<AtomLink> getLinksByRelation(String relationPattern) {
         return getLinks(relationPattern, MATCH_ANY_PATTERN);
     }
-    
+
     /**
      * Gets the value of author.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the author.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the author.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getAuthor().add(newItem);
+     * getAuthor().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomPerson }
-     * 
-     * 
      */
     public List<AtomPerson> getAuthors() {
         if (author == null) {
@@ -554,25 +524,20 @@ public class AtomEntry
 
     /**
      * Gets the value of contributor.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the contributor.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the contributor.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getContributor().add(newItem);
+     * getContributor().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomPerson }
-     * 
-     * 
      */
     public List<AtomPerson> getContributors() {
         if (contributor == null) {
@@ -583,25 +548,20 @@ public class AtomEntry
 
     /**
      * Gets the value of category.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the category.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the category.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getCategory().add(newItem);
+     * getCategory().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomCategory }
-     * 
-     * 
      */
     public List<AtomCategory> getCategories() {
         if (category == null) {
@@ -612,25 +572,19 @@ public class AtomEntry
 
     /**
      * Gets extension elements
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the any.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the any.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getAny().add(newItem);
+     * getAny().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
-     * Objects of the following type(s) are allowed in the list
-     * {@link Element }
-     * 
-     * 
+     * Objects of the following type(s) are allowed in the list {@link Element }
      */
     public List<Element> getAny() {
         if (any == null) {
diff --git a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomFeed.java b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomFeed.java
index b0b09915..a4e081ea 100644
--- a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomFeed.java
+++ b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomFeed.java
@@ -24,18 +24,16 @@
 // Generated on: 2008.05.27 at 11:24:25 AM IDT 
 //
 
-
 package org.apache.wink.common.model.atom;
 
 import java.io.IOException;
+import java.io.OutputStream;
 import java.io.Reader;
-import java.io.Writer;
 import java.math.BigInteger;
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.List;
 
-import javax.ws.rs.WebApplicationException;
 import javax.xml.bind.JAXBContext;
 import javax.xml.bind.JAXBElement;
 import javax.xml.bind.JAXBException;
@@ -67,7 +65,6 @@ import org.apache.wink.common.model.synd.SyndPerson;
 import org.apache.wink.common.model.synd.SyndText;
 import org.w3c.dom.Element;
 
-
 /**
  * The "atom:feed" element Per RFC4287
  * 
@@ -142,79 +139,59 @@ import org.w3c.dom.Element;
  */
 @XmlAccessorType(XmlAccessType.FIELD)
 @XmlAccessorOrder(XmlAccessOrder.UNDEFINED)
-@XmlType(name = "atomFeed", propOrder = {
-    "id",
-    "updated",
-    "title",
-    "subtitle",
-    "itemsPerPage",
-    "startIndex",
-    "totalResults",
-    "opensearchQuery",
-    "link",
-    "author",
-    "contributor",
-    "category",
-    "generator",
-    "icon",
-    "logo",
-    "rights",
-    "any",
-    "entry"
-})
-public class AtomFeed
-    extends AtomCommonAttributes
-    implements NamespacePrefixMapperProvider
-{
+@XmlType(name = "atomFeed", propOrder = {"id", "updated", "title", "subtitle", "itemsPerPage",
+                                         "startIndex", "totalResults", "opensearchQuery", "link",
+                                         "author", "contributor", "category", "generator", "icon",
+                                         "logo", "rights", "any", "entry"})
+public class AtomFeed extends AtomCommonAttributes implements NamespacePrefixMapperProvider {
 
     @XmlElement(required = true)
-    protected String id;
+    protected String                                                id;
     @XmlElement(required = true)
-    protected XMLGregorianCalendar updated;
+    protected XMLGregorianCalendar                                  updated;
     @XmlElement(required = true)
-    protected AtomText title;
-    protected AtomText subtitle;
-    protected List<AtomLink> link;
-    protected List<AtomPerson> author;
-    protected List<AtomPerson> contributor;
-    protected List<AtomCategory> category;
-    protected AtomGenerator generator;
-    protected String icon;
-    protected String logo;
-    protected AtomText rights;
+    protected AtomText                                              title;
+    protected AtomText                                              subtitle;
+    protected List<AtomLink>                                        link;
+    protected List<AtomPerson>                                      author;
+    protected List<AtomPerson>                                      contributor;
+    protected List<AtomCategory>                                    category;
+    protected AtomGenerator                                         generator;
+    protected String                                                icon;
+    protected String                                                logo;
+    protected AtomText                                              rights;
     @XmlAnyElement
-    protected List<Object> any;
-    protected List<AtomEntry> entry;
-    
-    @XmlElement(namespace=RestConstants.NAMESPACE_OPENSEARCH)
-    protected BigInteger totalResults;
-    @XmlElement(namespace=RestConstants.NAMESPACE_OPENSEARCH)
-    protected BigInteger itemsPerPage;
-    @XmlElement(namespace=RestConstants.NAMESPACE_OPENSEARCH)
-    protected BigInteger startIndex;
-    @XmlElement(name="Query",namespace=RestConstants.NAMESPACE_OPENSEARCH)
-    protected List<OpenSearchQuery> opensearchQuery;
-    
-    
+    protected List<Object>                                          any;
+    protected List<AtomEntry>                                       entry;
+
+    @XmlElement(namespace = RestConstants.NAMESPACE_OPENSEARCH)
+    protected BigInteger                                            totalResults;
+    @XmlElement(namespace = RestConstants.NAMESPACE_OPENSEARCH)
+    protected BigInteger                                            itemsPerPage;
+    @XmlElement(namespace = RestConstants.NAMESPACE_OPENSEARCH)
+    protected BigInteger                                            startIndex;
+    @XmlElement(name = "Query", namespace = RestConstants.NAMESPACE_OPENSEARCH)
+    protected List<OpenSearchQuery>                                 opensearchQuery;
+
     @XmlTransient
-    private static final JAXBContext atomContext;
+    private static final JAXBContext                                atomContext;
     @XmlTransient
     protected org.apache.wink.common.model.opensearch.ObjectFactory opensearchFactory;
 
     static {
         try {
-            atomContext = JAXBContext.newInstance(
-                    AtomFeed.class.getPackage().getName() + ":" +
-                    OpenSearchDescription.class.getPackage().getName());
+            atomContext =
+                JAXBContext.newInstance(AtomFeed.class.getPackage().getName() + ":"
+                    + OpenSearchDescription.class.getPackage().getName());
         } catch (JAXBException e) {
             throw new RestException("Failed to create JAXBContext for AtomFeed", e);
         }
     }
-    
+
     public AtomFeed() {
         opensearchFactory = new org.apache.wink.common.model.opensearch.ObjectFactory();
     }
-    
+
     public AtomFeed(SyndFeed value) {
         super(value);
         if (value == null) {
@@ -236,14 +213,15 @@ public class AtomFeed
         setLinks(value.getLinks());
         setEntries(value.getEntries());
     }
-    
+
     public SyndFeed toSynd(SyndFeed value) {
         if (value == null) {
             return value;
         }
         super.toSynd(value);
         value.setUpdated(getUpdated());
-        value.setGenerator(getGenerator() != null ? getGenerator().toSynd(new SyndGenerator()) : null);
+        value.setGenerator(getGenerator() != null ? getGenerator().toSynd(new SyndGenerator())
+            : null);
         value.setIcon(getIcon());
         value.setId(getId());
         value.setItemsPerPage(getItemsPerPage());
@@ -259,56 +237,45 @@ public class AtomFeed
         value.getEntries().addAll(getEntriesAsSynd());
         return value;
     }
-    
+
     public static Marshaller getMarshaller() {
         return JAXBUtils.createMarshaller(atomContext);
     }
-    
+
     public static Unmarshaller getUnmarshaller() {
         return JAXBUtils.createUnmarshaller(atomContext);
     }
-    
+
     /**
      * Convenience method for creating an AtomFeed from xml
+     * 
      * @param reader input reader
      * @return AtomFeed instance from the input
      */
-    public static AtomFeed unmarshal(Reader reader) {
-        try {
-            return (AtomFeed)AtomJAXBUtils.unmarshal(AtomFeed.getUnmarshaller(), reader);
-        } catch (IOException e) {
-            throw new WebApplicationException(e);
-        }
+    public static AtomFeed unmarshal(Reader reader) throws IOException {
+        return (AtomFeed)AtomJAXBUtils.unmarshal(AtomFeed.getUnmarshaller(), reader);
     }
-    
-    public static void marshal(AtomFeed feed, Writer writer) {
-        try {
-            JAXBElement<AtomFeed> feedElement = new ObjectFactory().createFeed(feed);
-            Marshaller marshaller = AtomFeed.getMarshaller();
-            AtomJAXBUtils.marshal(marshaller, feedElement, null, writer);
-            writer.flush();
-        } catch (IOException e) {
-            throw new WebApplicationException(e);
-        }
+
+    public static void marshal(AtomFeed feed, OutputStream os) throws IOException {
+        JAXBElement<AtomFeed> feedElement = new ObjectFactory().createFeed(feed);
+        Marshaller marshaller = AtomFeed.getMarshaller();
+        AtomJAXBUtils.marshal(marshaller, feedElement, null, os);
     }
 
     public JAXBNamespacePrefixMapper getNamespacePrefixMapper() {
-        JAXBNamespacePrefixMapper mapper = new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
+        JAXBNamespacePrefixMapper mapper =
+            new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
         if (!openSearchElementsExist()) {
             mapper.omitNamespace(RestConstants.NAMESPACE_OPENSEARCH);
         }
         return mapper;
     }
-    
+
     private boolean openSearchElementsExist() {
-        return 
-            (totalResults != null ||
-             itemsPerPage != null ||
-             startIndex != null ||
-             (opensearchQuery != null && opensearchQuery.size() > 0));
-    }
-    
-    
+        return (totalResults != null || itemsPerPage != null || startIndex != null || (opensearchQuery != null && opensearchQuery
+            .size() > 0));
+    }
+
     private List<SyndPerson> getAuthorsAsSynd() {
         List<SyndPerson> authors = new ArrayList<SyndPerson>();
         for (AtomPerson value : getAuthors()) {
@@ -338,7 +305,7 @@ public class AtomFeed
         }
         return authors;
     }
-    
+
     private List<SyndEntry> getEntriesAsSynd() {
         List<SyndEntry> authors = new ArrayList<SyndEntry>();
         for (AtomEntry value : getEntries()) {
@@ -348,7 +315,7 @@ public class AtomFeed
         }
         return authors;
     }
-    
+
     private void setAuthors(List<SyndPerson> values) {
         getAuthors().clear();
         if (values == null) {
@@ -360,7 +327,7 @@ public class AtomFeed
             }
         }
     }
-    
+
     private void setCategories(List<SyndCategory> values) {
         getCategories().clear();
         if (values == null) {
@@ -384,7 +351,7 @@ public class AtomFeed
             }
         }
     }
-    
+
     private void setEntries(List<SyndEntry> values) {
         getEntries().clear();
         if (values == null) {
@@ -413,6 +380,7 @@ public class AtomFeed
 
     /**
      * Gets the value of updated as a long value
+     * 
      * @return the updated value, or -1 if it is not set
      */
     public long getUpdatedAsTime() {
@@ -436,7 +404,7 @@ public class AtomFeed
     public void setUpdated(XMLGregorianCalendar value) {
         this.updated = value;
     }
-    
+
     /**
      * Sets the value of updated.
      */
@@ -485,25 +453,19 @@ public class AtomFeed
 
     /**
      * Gets the value of link.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the link.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the link.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getLink().add(newItem);
+     * getLink().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
-     * Objects of the following type(s) are allowed in the list
-     * {@link AtomLink }
-     * 
-     * 
+     * Objects of the following type(s) are allowed in the list {@link AtomLink }
      */
     public List<AtomLink> getLinks() {
         if (link == null) {
@@ -514,25 +476,20 @@ public class AtomFeed
 
     /**
      * Gets the value of author.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the author.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the author.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getAuthor().add(newItem);
+     * getAuthor().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomPerson }
-     * 
-     * 
      */
     public List<AtomPerson> getAuthors() {
         if (author == null) {
@@ -543,25 +500,20 @@ public class AtomFeed
 
     /**
      * Gets the value of contributor.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the contributor.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the contributor.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getContributor().add(newItem);
+     * getContributor().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomPerson }
-     * 
-     * 
      */
     public List<AtomPerson> getContributors() {
         if (contributor == null) {
@@ -572,25 +524,20 @@ public class AtomFeed
 
     /**
      * Gets the value of category.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the category.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the category.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getCategory().add(newItem);
+     * getCategory().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomCategory }
-     * 
-     * 
      */
     public List<AtomCategory> getCategories() {
         if (category == null) {
@@ -657,25 +604,19 @@ public class AtomFeed
 
     /**
      * Gets extension elements
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the any.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the any.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getAny().add(newItem);
+     * getAny().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
-     * Objects of the following type(s) are allowed in the list
-     * {@link Element }
-     * 
-     * 
+     * Objects of the following type(s) are allowed in the list {@link Element }
      */
     public List<Object> getAny() {
         if (any == null) {
@@ -686,25 +627,20 @@ public class AtomFeed
 
     /**
      * Gets the value of entry.
-     * 
      * <p>
-     * This accessor method returns a reference to the live list,
-     * not a snapshot. Therefore any modification you make to the
-     * returned list will be present inside the JAXB object.
-     * This is why there is not a <CODE>set</CODE> method for the entry.
-     * 
+     * This accessor method returns a reference to the live list, not a
+     * snapshot. Therefore any modification you make to the returned list will
+     * be present inside the JAXB object. This is why there is not a
+     * <CODE>set</CODE> method for the entry.
      * <p>
      * For example, to add a new item, do as follows:
+     * 
      * <pre>
-     *    getEntry().add(newItem);
+     * getEntry().add(newItem);
      * </pre>
-     * 
-     * 
      * <p>
      * Objects of the following type(s) are allowed in the list
      * {@link AtomEntry }
-     * 
-     * 
      */
     public List<AtomEntry> getEntries() {
         if (entry == null) {
@@ -775,8 +711,8 @@ public class AtomFeed
         } else {
             this.itemsPerPage = null;
         }
-     }
- 
+    }
+
     /**
      * Gets the list of opensearch Query elements
      */
@@ -786,7 +722,7 @@ public class AtomFeed
         }
         return opensearchQuery;
     }
-    
+
     /**
      * Sets the list of opensearch Query elements
      */
@@ -801,6 +737,6 @@ public class AtomFeed
         if (query != null) {
             getOpenSearchQueries().add(query);
         }
-     }
-    
+    }
+
 }
diff --git a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomJAXBUtils.java b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomJAXBUtils.java
index 0d27c834..ecd68a22 100644
--- a/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomJAXBUtils.java
+++ b/wink-common/src/main/java/org/apache/wink/common/model/atom/AtomJAXBUtils.java
@@ -17,15 +17,15 @@
  *  under the License.
  *  
  *******************************************************************************/
- 
 
 package org.apache.wink.common.model.atom;
 
 import java.io.CharArrayWriter;
 import java.io.IOException;
+import java.io.OutputStream;
 import java.io.Reader;
 import java.io.StringReader;
-import java.io.Writer;
+import java.io.UnsupportedEncodingException;
 import java.util.Calendar;
 import java.util.GregorianCalendar;
 import java.util.Map;
@@ -58,12 +58,11 @@ import org.xml.sax.SAXException;
 import org.xml.sax.XMLReader;
 import org.xml.sax.ext.LexicalHandler;
 
-
 public class AtomJAXBUtils {
 
     private final static SAXParserFactory spf;
-    private final static EncodingInfo encodingInfo;
-    private static final DatatypeFactory datatypeFactory;
+    private final static EncodingInfo     encodingInfo;
+    private static final DatatypeFactory  datatypeFactory;
 
     static {
         try {
@@ -87,9 +86,11 @@ public class AtomJAXBUtils {
 
         // as per RFC3023 and Atom specification
         type = type.toLowerCase();
-        if (type.endsWith("/xml") || type.endsWith("+xml") || type.equals("xhtml")
-                || type.equals("text/xml-external-parsed-entity")
-                || type.equals("application/xml-external-parsed-entity") || type.equals("application/xml-dtd")) {
+        if (type.endsWith("/xml") || type.endsWith("+xml")
+            || type.equals("xhtml")
+            || type.equals("text/xml-external-parsed-entity")
+            || type.equals("application/xml-external-parsed-entity")
+            || type.equals("application/xml-dtd")) {
             return true;
         }
 
@@ -118,7 +119,8 @@ public class AtomJAXBUtils {
         try {
             xmlReader = spf.newSAXParser().getXMLReader();
             xmlReader.setContentHandler(handler);
-            // setting this property will cause the handler to get lexical events as well
+            // setting this property will cause the handler to get lexical
+            // events as well
             if (handler instanceof LexicalHandler) {
                 xmlReader.setProperty("http://xml.org/sax/properties/lexical-handler", handler);
             }
@@ -137,16 +139,17 @@ public class AtomJAXBUtils {
         Object result = null;
         try {
             UnmarshallerHandler unmarshallerHandler = unmarshaller.getUnmarshallerHandler();
-            AtomUnmarshallingListener.AtomUnmarshallerHandler handler = new AtomUnmarshallingListener.AtomUnmarshallerHandler(
-                    unmarshallerHandler);
+            AtomUnmarshallingListener.AtomUnmarshallerHandler handler =
+                new AtomUnmarshallingListener.AtomUnmarshallerHandler(unmarshallerHandler);
             AtomUnmarshallingListener listener = new AtomUnmarshallingListener(handler);
             unmarshaller.setListener(listener);
             // here is where the magic begins.
-            // SAX will parse the XML document, and our handler will get all the SAX events
+            // SAX will parse the XML document, and our handler will get all the
+            // SAX events
             saxParse(reader, handler, "failed to unmarshal object");
             // parsing is done and the JAXB object is ready
             result = handler.getResult();
-            if (result instanceof JAXBElement) {
+            if (result instanceof JAXBElement<?>) {
                 result = ((JAXBElement<?>)result).getValue();
             }
         } catch (IllegalStateException e) {
@@ -157,50 +160,68 @@ public class AtomJAXBUtils {
         return result;
     }
 
-    public static void marshal(Marshaller marshaller, Object jaxbObject, Map<String,String> processingInstructions,
-            Writer writer) throws IOException {
-        marshal(marshaller, jaxbObject, processingInstructions, null, writer);
+    public static void marshal(Marshaller marshaller, Object jaxbObject, OutputStream os)
+        throws IOException {
+        marshal(marshaller, jaxbObject, null, null, os);
     }
 
-    public static void marshal(Marshaller marshaller, Object jaxbObject, Map<String,String> processingInstructions,
-            JAXBNamespacePrefixMapper namespacePrefixMapper, Writer writer) throws IOException {
+    public static void marshal(Marshaller marshaller,
+                               Object jaxbObject,
+                               Map<String, String> processingInstructions,
+                               OutputStream os) throws IOException {
+        marshal(marshaller, jaxbObject, processingInstructions, null, os);
+    }
+
+    public static void marshal(Marshaller marshaller,
+                               Object jaxbObject,
+                               Map<String, String> processingInstructions,
+                               JAXBNamespacePrefixMapper namespacePrefixMapper,
+                               OutputStream os) throws IOException {
         try {
             // create a new SAX serializer for creating the XML output.
-            // we will invoke the marshal of JAXB to send all its marshaling events to this handler
-            AtomMarshallingListener.AtomMarshallerHandler handler = new AtomMarshallingListener.AtomMarshallerHandler(
-                    processingInstructions, marshaller);
+            // we will invoke the marshal of JAXB to send all its marshaling
+            // events to this handler
+            AtomMarshallingListener.AtomMarshallerHandler handler =
+                new AtomMarshallingListener.AtomMarshallerHandler(processingInstructions,
+                                                                  marshaller);
             if (namespacePrefixMapper == null) {
                 Object jaxb = jaxbObject;
-                if (jaxbObject instanceof JAXBElement) {
+                if (jaxbObject instanceof JAXBElement<?>) {
                     jaxb = ((JAXBElement<?>)jaxbObject).getValue();
                 }
                 if (jaxb instanceof NamespacePrefixMapperProvider) {
-                    namespacePrefixMapper = ((NamespacePrefixMapperProvider)jaxb).getNamespacePrefixMapper();
+                    namespacePrefixMapper =
+                        ((NamespacePrefixMapperProvider)jaxb).getNamespacePrefixMapper();
                 }
             }
             handler.setNamespacePrefixMapper(namespacePrefixMapper);
-            handler.setOutputCharStream(writer);
-            // add our listener to the marshaler so we will receive events from JAXB
+            handler.setOutputByteStream(os);
+            // add our listener to the marshaler so we will receive events from
+            // JAXB
             marshaller.setListener(new AtomMarshallingListener(handler));
-            // perform the marshaling so that our marshaler (xml serializer) will receive all the
+            // perform the marshaling so that our marshaler (xml serializer)
+            // will receive all the
             // SAX events
             ContentHandler xmlSerializer = handler.asContentHandler();
             marshaller.marshal(jaxbObject, xmlSerializer);
         } catch (JAXBException e) {
             throw new RestException("failed to marshal object (" + jaxbObject.getClass().getName()
-                    + ")", e);
+                + ")", e);
         }
     }
 
-    // ========================== AtomMarshallingListener =================================
+    // ========================== AtomMarshallingListener
+    // =================================
 
     //
-    // JAXB marshaling listener which is used to get events from JAXB during the marshaling of an
+    // JAXB marshaling listener which is used to get events from JAXB during the
+    // marshaling of an
     // XML
     //
     public static class AtomMarshallingListener extends Marshaller.Listener {
 
-        // this is the AtomMarshallerHandler that will receive all the SAX events from JAXB for
+        // this is the AtomMarshallerHandler that will receive all the SAX
+        // events from JAXB for
         // creating the
         // XML output.
         private AtomMarshallerHandler handler;
@@ -222,14 +243,15 @@ public class AtomJAXBUtils {
                     }
                 } else if (source instanceof AtomText) {
                     AtomText text = (AtomText)source;
-                    // we know that the type is xhtml, or we wouldn't have gotten here
+                    // we know that the type is xhtml, or we wouldn't have
+                    // gotten here
                     xmlContent = text.saveValue();
                     xmlContent = surroundWithXhtmlDiv(xmlContent);
                 }
                 handler.pushXmlContent(xmlContent);
             }
         }
-        
+
         private String surroundWithXhtmlDiv(String xhtml) {
             if (xhtml == null) {
                 return null;
@@ -252,21 +274,23 @@ public class AtomJAXBUtils {
         }
 
         /**
-         * AtomMarshallerHandler is a SAX ContentHandler which extends XMLSerliazer to create an XML
-         * output from SAX events.
+         * AtomMarshallerHandler is a SAX ContentHandler which extends
+         * XMLSerliazer to create an XML output from SAX events.
          */
         public static class AtomMarshallerHandler extends XMLSerializer {
-            // this is used to control the output of the xml that the XMLSerializer will produce
-            private OutputFormat of;
-            private int indentation = 4;
+            // this is used to control the output of the xml that the
+            // XMLSerializer will produce
+            private OutputFormat              of;
+            private int                       indentation = 4;
 
-            private Map<String,String> processingInstructions;
+            private Map<String, String>       processingInstructions;
             private JAXBNamespacePrefixMapper namespacePrefixMapper;
 
-            private String xmlContent;
+            private String                    xmlContent;
 
-            public AtomMarshallerHandler(Map<String,String> processingInstructions, Marshaller marshaller)
-                    throws JAXBException {
+            public AtomMarshallerHandler(Map<String, String> processingInstructions,
+                                         Marshaller marshaller) throws JAXBException,
+                UnsupportedEncodingException {
                 this.processingInstructions = processingInstructions;
                 namespacePrefixMapper = null;
                 xmlContent = null;
@@ -274,8 +298,12 @@ public class AtomJAXBUtils {
                 // prepare the OutputFormat to output the XML as desired
                 of = new OutputFormat();
                 of.setMethod(Method.XML);
-                of.setEncoding(encodingInfo);
-                Boolean property = (Boolean)marshaller.getProperty(Marshaller.JAXB_FORMATTED_OUTPUT);
+                String encoding = (String)marshaller.getProperty(Marshaller.JAXB_ENCODING);
+                of.setEncoding(encoding == null ? encodingInfo : new OutputFormat(Method.XML,
+                                                                                  encoding, true)
+                    .getEncodingInfo());
+                Boolean property =
+                    (Boolean)marshaller.getProperty(Marshaller.JAXB_FORMATTED_OUTPUT);
                 boolean formattedOutput = false;
                 if (property != null) {
                     formattedOutput = property.booleanValue();
@@ -317,7 +345,8 @@ public class AtomJAXBUtils {
 
             @Override
             public void startDocument(String rootTagName) throws IOException {
-                // if the user supplied additional processing instructions, add them now
+                // if the user supplied additional processing instructions, add
+                // them now
                 if (processingInstructions != null) {
                     Set<String> keys = processingInstructions.keySet();
                     String attributes = null;
@@ -327,7 +356,9 @@ public class AtomJAXBUtils {
                             super.processingInstruction(key, attributes);
                         } catch (SAXException e) {
                             throw new RestException("failed to add processing instruction '" + key
-                                    + "' with attributes '" + attributes + "'", e);
+                                + "' with attributes '"
+                                + attributes
+                                + "'", e);
                         }
                     }
                 }
@@ -346,11 +377,14 @@ public class AtomJAXBUtils {
             }
 
             @Override
-            public void startElement(String namespaceURI, String localName, String rawName, Attributes attrs)
-                    throws SAXException {
+            public void startElement(String namespaceURI,
+                                     String localName,
+                                     String rawName,
+                                     Attributes attrs) throws SAXException {
 
                 if (namespacePrefixMapper != null) {
-                    String prefix = namespacePrefixMapper.getPreferredPrefix(namespaceURI, null, false);
+                    String prefix =
+                        namespacePrefixMapper.getPreferredPrefix(namespaceURI, null, false);
                     if (prefix != null) {
                         if (prefix.length() == 0) {
                             rawName = localName;
@@ -373,14 +407,16 @@ public class AtomJAXBUtils {
                 namespacePrefixMapper = null;
                 // parse the xml content and send all events to this handler,
                 // except for the startDocument and endDocument events
-                saxParse(new StringReader(xmlContent), new XmlContentHandler(this), "Bad XML content in Atom");
+                saxParse(new StringReader(xmlContent),
+                         new XmlContentHandler(this),
+                         "Bad XML content in Atom");
                 // restore the prefix mapper
                 namespacePrefixMapper = mapper;
             }
 
             /**
-             * Delegates all SAX events to the contained handler except for the start and end
-             * document events
+             * Delegates all SAX events to the contained handler except for the
+             * start and end document events
              */
             private static class XmlContentHandler extends SAXHandlerWrapper {
                 public XmlContentHandler(ContentHandler handler) {
@@ -401,7 +437,8 @@ public class AtomJAXBUtils {
 
     }
 
-    // ========================== AtomUnmarshallingListener =================================
+    // ========================== AtomUnmarshallingListener
+    // =================================
 
     public static class AtomUnmarshallingListener extends Unmarshaller.Listener {
 
@@ -417,7 +454,8 @@ public class AtomJAXBUtils {
             if (target instanceof AtomContent) {
                 unmarshallerHandler.startSpecialContent(target);
 
-                // if JAXB is just about to unmarshal an AtomText construct element
+                // if JAXB is just about to unmarshal an AtomText construct
+                // element
             } else if (target instanceof AtomText) {
                 unmarshallerHandler.startSpecialContent(target);
             }
@@ -433,26 +471,32 @@ public class AtomJAXBUtils {
         }
 
         /**
-         * This handler is used to receive all SAX events during the parsing of an incoming Atom
-         * feed or entry. During the parsing of the XML we will delegate almost all of the events to
-         * JAXB so it can do its magic. Events that are related to the contents of a &lt;content>
-         * element or to a text construct element will be redirected to an instance of a
-         * SpecialContentHandler for converting the contents into a string even if it is xml
+         * This handler is used to receive all SAX events during the parsing of
+         * an incoming Atom feed or entry. During the parsing of the XML we will
+         * delegate almost all of the events to JAXB so it can do its magic.
+         * Events that are related to the contents of a &lt;content> element or
+         * to a text construct element will be redirected to an instance of a
+         * SpecialContentHandler for converting the contents into a string even
+         * if it is xml
          */
         public static class AtomUnmarshallerHandler implements UnmarshallerHandler, LexicalHandler {
 
-            // the JAXB ContentHandler that will receive all the delegated SAX parser events other
-            // than the events related to elements whose xml contents need to be treated as text
-            private UnmarshallerHandler jaxbHandler;
+            // the JAXB ContentHandler that will receive all the delegated SAX
+            // parser events other
+            // than the events related to elements whose xml contents need to be
+            // treated as text
+            private UnmarshallerHandler   jaxbHandler;
 
             // this is an xml serializer to handle SAX events during the parsing
-            // of an element whose xml contents needs to be treated as text, even
+            // of an element whose xml contents needs to be treated as text,
+            // even
             // if it is xml
             private SpecialContentHandler specialContentHandler;
 
-            // flag for indicating that we are currently handing an element whose
+            // flag for indicating that we are currently handing an element
+            // whose
             // contents needs to be treated as text, even if it is xml
-            private boolean isSpecialContent;
+            private boolean               isSpecialContent;
 
             public AtomUnmarshallerHandler(UnmarshallerHandler handler) {
                 jaxbHandler = handler;
@@ -460,7 +504,8 @@ public class AtomJAXBUtils {
             }
 
             public void startSpecialContent(Object target) {
-                // this method is called from the UnmarshallerListener, who received a notification
+                // this method is called from the UnmarshallerListener, who
+                // received a notification
                 // that a JAXB element is going to be unmarshalled.
                 isSpecialContent = true;
                 specialContentHandler = new SpecialContentHandler(target);
@@ -504,7 +549,8 @@ public class AtomJAXBUtils {
                 jaxbHandler.endElement(uri, localName, name);
             }
 
-            public void startElement(String uri, String localName, String name, Attributes atts) throws SAXException {
+            public void startElement(String uri, String localName, String name, Attributes atts)
+                throws SAXException {
                 if (isSpecialContent) {
                     specialContentHandler.startElement(uri, localName, name, atts);
                     return;
@@ -631,12 +677,12 @@ public class AtomJAXBUtils {
 
         private static class SpecialContentHandler extends SAXHandlerWrapper {
             // the JAXB object whose value may be text or xml
-            private Object target;
+            private Object          target;
 
             private CharArrayWriter writer;
-            private int elementCounter;
-            private boolean isXhtml;
-            private boolean isXmlOpen;
+            private int             elementCounter;
+            private boolean         isXhtml;
+            private boolean         isXmlOpen;
 
             public SpecialContentHandler(Object target) {
                 super(initXmlSerializer());
@@ -665,7 +711,8 @@ public class AtomJAXBUtils {
                 if (isXmlOpen) {
                     result = result.trim();
                     if (!result.startsWith("<")) {
-                        throw new RuntimeException("Illegal atom content: must contain a single child element");
+                        throw new RuntimeException(
+                                                   "Illegal atom content: must contain a single child element");
                     }
                 }
                 return result;
@@ -692,7 +739,8 @@ public class AtomJAXBUtils {
             }
 
             @Override
-            public void startElement(String uri, String localName, String name, Attributes atts) throws SAXException {
+            public void startElement(String uri, String localName, String name, Attributes atts)
+                throws SAXException {
                 if (isRootElement()) {
                     openXml();
                 }
@@ -700,13 +748,17 @@ public class AtomJAXBUtils {
                 ++elementCounter;
                 // if we need to skip processing of the first <div> element
                 if (isFirstElement() && isXhtml) {
-                    // if we are unmarshalling xhtml, we need to skip processing of the first <div>
+                    // if we are unmarshalling xhtml, we need to skip processing
+                    // of the first <div>
                     // element
-                    if (uri.equals(RestConstants.NAMESPACE_XHTML) && localName.equalsIgnoreCase("div")) {
-                        // if this is the first div element, then we must ignore it
+                    if (uri.equals(RestConstants.NAMESPACE_XHTML) && localName
+                        .equalsIgnoreCase("div")) {
+                        // if this is the first div element, then we must ignore
+                        // it
                         return;
                     } else {
-                        throw new RuntimeException("Illegal content: xhtml content must have a div root element");
+                        throw new RuntimeException(
+                                                   "Illegal content: xhtml content must have a div root element");
                     }
                 }
 
@@ -716,7 +768,8 @@ public class AtomJAXBUtils {
 
             private void openXml() {
                 if (isXmlOpen) {
-                    throw new RuntimeException("Illegal atom content: must have only one root element");
+                    throw new RuntimeException(
+                                               "Illegal atom content: must have only one root element");
                 }
 
                 // get the type of contents of the JAXB object
@@ -732,7 +785,8 @@ public class AtomJAXBUtils {
                 }
 
                 if (!isXhtml && !isTypeXml(type)) {
-                    throw new RuntimeException("Illegal atom content: must not contain child elements");
+                    throw new RuntimeException(
+                                               "Illegal atom content: must not contain child elements");
                 }
                 isXmlOpen = true;
             }
@@ -742,7 +796,8 @@ public class AtomJAXBUtils {
                 --elementCounter;
                 // if we need to skip processing of the first <div> element
                 if (isLastElement() && isXhtml) {
-                    if (uri.equals(RestConstants.NAMESPACE_XHTML) && localName.equalsIgnoreCase("div")) {
+                    if (uri.equals(RestConstants.NAMESPACE_XHTML) && localName
+                        .equalsIgnoreCase("div")) {
                         return;
                     }
                 }
@@ -761,30 +816,30 @@ public class AtomJAXBUtils {
         }
     }
 
-//    /**
-//     * Remove xml declaration from XML.
-//     * 
-//     * @param xmlStr
-//     *            The XML
-//     * @return String The XML without xml declaration
-//     */
-//    public static String stripXmlDecl(String xmlStr) {
-//
-//        if (xmlStr == null) {
-//            return null;
-//        }
-//
-//        int startInd;
-//        int endInd;
-//        StringBuilder xmlStrBuilder = new StringBuilder(xmlStr);
-//
-//        while ((startInd = xmlStrBuilder.indexOf("<?")) >= 0) {
-//            endInd = xmlStrBuilder.indexOf("?>") + 2;
-//            xmlStrBuilder.replace(startInd, endInd, "");
-//        }
-//        return xmlStrBuilder.toString();
-//    }
-//
+    // /**
+    // * Remove xml declaration from XML.
+    // *
+    // * @param xmlStr
+    // * The XML
+    // * @return String The XML without xml declaration
+    // */
+    // public static String stripXmlDecl(String xmlStr) {
+    //
+    // if (xmlStr == null) {
+    // return null;
+    // }
+    //
+    // int startInd;
+    // int endInd;
+    // StringBuilder xmlStrBuilder = new StringBuilder(xmlStr);
+    //
+    // while ((startInd = xmlStrBuilder.indexOf("<?")) >= 0) {
+    // endInd = xmlStrBuilder.indexOf("?>") + 2;
+    // xmlStrBuilder.replace(startInd, endInd, "");
+    // }
+    // return xmlStrBuilder.toString();
+    // }
+    //
     public static XMLGregorianCalendar timeToXmlGregorianCalendar(long time) {
         if (time == -1) {
             return null;
diff --git a/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java b/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
index 05d51646..1d7053e9 100644
--- a/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
+++ b/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
@@ -21,6 +21,7 @@
 
 package org.apache.wink.common.model.app;
 
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.StringReader;
 import java.io.StringWriter;
@@ -114,9 +115,9 @@ public class AppTest extends TestCase {
         
         AppService service = getService();
         JAXBElement<AppService> element = (new ObjectFactory()).createService(service);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(SERVICE_DOCUMENT, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertEquals(SERVICE_DOCUMENT, os.toString());
     }
 
     public void testAppUnmarshal() throws IOException {
@@ -141,9 +142,9 @@ public class AppTest extends TestCase {
         
         Object service = AtomJAXBUtils.unmarshal(u, new StringReader(SERVICE_DOCUMENT));
         JAXBElement<AppService> element = (new ObjectFactory()).createService((AppService)service);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(SERVICE_DOCUMENT, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertEquals(SERVICE_DOCUMENT, os.toString());
     }
 
     public void testCategories() {
diff --git a/wink-common/src/test/java/org/apache/wink/common/model/atom/AtomTest.java b/wink-common/src/test/java/org/apache/wink/common/model/atom/AtomTest.java
index b15abd6f..2ccf8b06 100644
--- a/wink-common/src/test/java/org/apache/wink/common/model/atom/AtomTest.java
+++ b/wink-common/src/test/java/org/apache/wink/common/model/atom/AtomTest.java
@@ -18,11 +18,11 @@
  *
  *******************************************************************************/
 
-
 package org.apache.wink.common.model.atom;
 
+import java.io.ByteArrayOutputStream;
 import java.io.StringReader;
-import java.io.StringWriter;
+import java.util.Arrays;
 import java.util.Date;
 import java.util.GregorianCalendar;
 import java.util.List;
@@ -37,234 +37,221 @@ import javax.xml.datatype.DatatypeFactory;
 import javax.xml.datatype.XMLGregorianCalendar;
 import javax.xml.namespace.QName;
 
+import junit.framework.TestCase;
+
 import org.apache.wink.common.RestConstants;
 import org.apache.wink.common.internal.utils.JAXBUtils;
 import org.apache.wink.common.model.JAXBNamespacePrefixMapper;
-import org.apache.wink.common.model.atom.AtomCategory;
-import org.apache.wink.common.model.atom.AtomContent;
-import org.apache.wink.common.model.atom.AtomEntry;
-import org.apache.wink.common.model.atom.AtomFeed;
-import org.apache.wink.common.model.atom.AtomGenerator;
-import org.apache.wink.common.model.atom.AtomJAXBUtils;
-import org.apache.wink.common.model.atom.AtomLink;
-import org.apache.wink.common.model.atom.AtomPerson;
-import org.apache.wink.common.model.atom.AtomText;
-import org.apache.wink.common.model.atom.AtomTextType;
-import org.apache.wink.common.model.atom.ObjectFactory;
 import org.apache.wink.common.model.opensearch.OpenSearchQuery;
 
-import junit.framework.TestCase;
-
-
-
 public class AtomTest extends TestCase {
 
-    private static final String ATOM_TEXT_TEXT = "<title type=\"text\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">title</title>\n";
-    private static final String ATOM_TEXT_HTML = "<title type=\"html\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">&lt;h1&gt;title&lt;/h1&gt;</title>\n";
-    private static final String ATOM_TEXT_XHTML =
-        "<title type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <div xmlns=\""+RestConstants.NAMESPACE_XHTML+"\">\n" +
-        "        <h1>title</h1>\n" +
-        "    </div>\n" +
-        "</title>\n";
+    private static final String ATOM_TEXT_TEXT           =
+                                                             "<title type=\"text\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">title</title>\n";
+    private static final String ATOM_TEXT_HTML           =
+                                                             "<title type=\"html\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">&lt;h1&gt;title&lt;/h1&gt;</title>\n";
+    private static final String ATOM_TEXT_XHTML          =
+                                                             "<title type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <div xmlns=\""
+                                                                 + RestConstants.NAMESPACE_XHTML
+                                                                 + "\">\n"
+                                                                 + "        <h1>title</h1>\n"
+                                                                 + "    </div>\n"
+                                                                 + "</title>\n";
     private static final String ATOM_TEXT_XHTML_WITH_DIV =
-        "<title type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <div xmlns=\""+RestConstants.NAMESPACE_XHTML+"\">\n" +
-        "        <h1>\n" +
-        "            <div>title</div>\n" +
-        "        </h1>\n" +
-        "    </div>\n" +
-        "</title>\n";
-
-
-    private static final String ATOM_CONTENT_TEXT = "<content type=\"text\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">title</content>\n";
-    private static final String ATOM_CONTENT_HTML = "<content type=\"html\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">&lt;h1&gt;title&lt;/h1&gt;</content>\n";
-    private static final String ATOM_CONTENT_XHTML =
-        "<content type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <div xmlns=\""+RestConstants.NAMESPACE_XHTML+"\">\n" +
-        "        <h1>title</h1>\n" +
-        "    </div>\n" +
-        "</content>\n";
-    private static final String ATOM_CONTENT_XML =
-        "<content type=\"application/xml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <x xmlns=\"http://x/\">title</x>\n" +
-        "</content>\n";
-
-    private static final String ATOM_ENTRY_1 = replaceTimeToken(
-        "<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <id>1</id>\n" +
-        "    <updated>@TIME@</updated>\n" +
-        "    <title type=\"text\">title</title>\n" +
-        "    <summary type=\"text\">summary</summary>\n" +
-        "    <published>@TIME@</published>\n" +
-        "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-        "    <author>\n" +
-        "        <email>author@hp.com</email>\n" +
-        "        <name>author</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </author>\n" +
-        "    <contributor>\n" +
-        "        <email>cont@hp.com</email>\n" +
-        "        <name>cont</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </contributor>\n" +
-        "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-        "</entry>\n");
-    private static final String ATOM_ENTRY_2 = replaceTimeToken(
-        "<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <id>2</id>\n" +
-        "    <updated>@TIME@</updated>\n" +
-        "    <title type=\"text\">title</title>\n" +
-        "    <summary type=\"text\">summary</summary>\n" +
-        "    <published>@TIME@</published>\n" +
-        "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-        "    <author>\n" +
-        "        <email>author@hp.com</email>\n" +
-        "        <name>author</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </author>\n" +
-        "    <contributor>\n" +
-        "        <email>cont@hp.com</email>\n" +
-        "        <name>cont</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </contributor>\n" +
-        "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-        "    <content type=\"text/plain\">Gustaf's Knckebrd</content>\n" +
-        "</entry>\n");
-    private static final String ATOM_ENTRY_3 = replaceTimeToken(
-        "<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <id>3</id>\n" +
-        "    <updated>@TIME@</updated>\n" +
-        "    <title type=\"text\">title</title>\n" +
-        "    <summary type=\"text\">summary</summary>\n" +
-        "    <published>@TIME@</published>\n" +
-        "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-        "    <author>\n" +
-        "        <email>author@hp.com</email>\n" +
-        "        <name>author</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </author>\n" +
-        "    <contributor>\n" +
-        "        <email>cont@hp.com</email>\n" +
-        "        <name>cont</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </contributor>\n" +
-        "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-        "    <content type=\"application/xml\">\n" +
-        "        <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n" +
-        "            <x2>\n" +
-        "                <y:y1>Gustaf's Knckebrd</y:y1>\n" +
-        "            </x2>\n" +
-        "        </x1>\n" +
-        "    </content>\n" +
-        "</entry>\n");
-
-    private static final String ATOM_FEED_1 = replaceTimeToken(
-        "<feed xml:lang=\"en-us\" xml:base=\"http://feed/base\" anyAttr=\"anyAttrValue\" xmlns:opensearch=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-        "    <id>id</id>\n" +
-        "    <updated>@TIME@</updated>\n" +
-        "    <title type=\"text\">title</title>\n" +
-        "    <subtitle type=\"text\">subtitle</subtitle>\n" +
-        "    <opensearch:itemsPerPage>5</opensearch:itemsPerPage>\n" +
-        "    <opensearch:startIndex>6</opensearch:startIndex>\n" +
-        "    <opensearch:totalResults>7</opensearch:totalResults>\n" +
-        "    <opensearch:Query searchTerms=\"query 1\"/>\n" +
-        "    <opensearch:Query searchTerms=\"query 2\"/>\n" +
-        "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-        "    <author>\n" +
-        "        <email>author@hp.com</email>\n" +
-        "        <name>author</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </author>\n" +
-        "    <contributor>\n" +
-        "        <email>cont@hp.com</email>\n" +
-        "        <name>cont</name>\n" +
-        "        <uri>http://uri</uri>\n" +
-        "    </contributor>\n" +
-        "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-        "    <generator version=\"1.0\" uri=\"http://generator/uri\" xml:lang=\"en-us\" xml:base=\"http://generator/base\">wink</generator>\n" +
-        "    <icon>icon</icon>\n" +
-        "    <logo>logo</logo>\n" +
-        "    <rights type=\"text\">rights</rights>\n" +
-        "    <entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\">\n" +
-        "        <id>1</id>\n" +
-        "        <updated>@TIME@</updated>\n" +
-        "        <title type=\"text\">title</title>\n" +
-        "        <summary type=\"text\">summary</summary>\n" +
-        "        <published>@TIME@</published>\n" +
-        "        <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-        "        <author>\n" +
-        "            <email>author@hp.com</email>\n" +
-        "            <name>author</name>\n" +
-        "            <uri>http://uri</uri>\n" +
-        "        </author>\n" +
-        "        <contributor>\n" +
-        "            <email>cont@hp.com</email>\n" +
-        "            <name>cont</name>\n" +
-        "            <uri>http://uri</uri>\n" +
-        "        </contributor>\n" +
-        "        <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-        "        <content type=\"application/xml\">\n" +
-        "            <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n" +
-        "                <x2>\n" +
-        "                    <y:y1>Gustaf's Knckebrd</y:y1>\n" +
-        "                </x2>\n" +
-        "            </x1>\n" +
-        "        </content>\n" +
-        "    </entry>\n" +
-        "</feed>\n");
-
-    private static final String ATOM_FEED_2 = replaceTimeToken(
-            "<feed xml:lang=\"en-us\" xml:base=\"http://feed/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" +
-            "    <id>id</id>\n" +
-            "    <updated>@TIME@</updated>\n" +
-            "    <title type=\"text\">title</title>\n" +
-            "    <subtitle type=\"text\">subtitle</subtitle>\n" +
-            "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-            "    <author>\n" +
-            "        <email>author@hp.com</email>\n" +
-            "        <name>author</name>\n" +
-            "        <uri>http://uri</uri>\n" +
-            "    </author>\n" +
-            "    <contributor>\n" +
-            "        <email>cont@hp.com</email>\n" +
-            "        <name>cont</name>\n" +
-            "        <uri>http://uri</uri>\n" +
-            "    </contributor>\n" +
-            "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-            "    <generator version=\"1.0\" uri=\"http://generator/uri\" xml:lang=\"en-us\" xml:base=\"http://generator/base\">wink</generator>\n" +
-            "    <icon>icon</icon>\n" +
-            "    <logo>logo</logo>\n" +
-            "    <rights type=\"text\">rights</rights>\n" +
-            "    <entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\">\n" +
-            "        <id>1</id>\n" +
-            "        <updated>@TIME@</updated>\n" +
-            "        <title type=\"text\">title</title>\n" +
-            "        <summary type=\"text\">summary</summary>\n" +
-            "        <published>@TIME@</published>\n" +
-            "        <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n" +
-            "        <author>\n" +
-            "            <email>author@hp.com</email>\n" +
-            "            <name>author</name>\n" +
-            "            <uri>http://uri</uri>\n" +
-            "        </author>\n" +
-            "        <contributor>\n" +
-            "            <email>cont@hp.com</email>\n" +
-            "            <name>cont</name>\n" +
-            "            <uri>http://uri</uri>\n" +
-            "        </contributor>\n" +
-            "        <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n" +
-            "        <content type=\"application/xml\">\n" +
-            "            <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n" +
-            "                <x2>\n" +
-            "                    <y:y1>Gustaf's Knckebrd</y:y1>\n" +
-            "                </x2>\n" +
-            "            </x1>\n" +
-            "        </content>\n" +
-            "    </entry>\n" +
-            "</feed>\n");
-
-    private static JAXBContext ctx;
+                                                             "<title type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <div xmlns=\""
+                                                                 + RestConstants.NAMESPACE_XHTML
+                                                                 + "\">\n"
+                                                                 + "        <h1>\n"
+                                                                 + "            <div>title</div>\n"
+                                                                 + "        </h1>\n"
+                                                                 + "    </div>\n"
+                                                                 + "</title>\n";
+
+    private static final String ATOM_CONTENT_TEXT        =
+                                                             "<content type=\"text\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">title</content>\n";
+    private static final String ATOM_CONTENT_HTML        =
+                                                             "<content type=\"html\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">&lt;h1&gt;title&lt;/h1&gt;</content>\n";
+    private static final String ATOM_CONTENT_XHTML       =
+                                                             "<content type=\"xhtml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <div xmlns=\""
+                                                                 + RestConstants.NAMESPACE_XHTML
+                                                                 + "\">\n"
+                                                                 + "        <h1>title</h1>\n"
+                                                                 + "    </div>\n"
+                                                                 + "</content>\n";
+    private static final String ATOM_CONTENT_XML         =
+                                                             "<content type=\"application/xml\" xml:lang=\"en-us\" xml:base=\"http://title/base\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <x xmlns=\"http://x/\">title</x>\n"
+                                                                 + "</content>\n";
+
+    private static final String ATOM_ENTRY_1             =
+                                                             replaceTimeToken("<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <id>1</id>\n"
+                                                                 + "    <updated>@TIME@</updated>\n"
+                                                                 + "    <title type=\"text\">title</title>\n"
+                                                                 + "    <summary type=\"text\">summary</summary>\n"
+                                                                 + "    <published>@TIME@</published>\n"
+                                                                 + "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "    <author>\n"
+                                                                 + "        <email>author@hp.com</email>\n"
+                                                                 + "        <name>author</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </author>\n"
+                                                                 + "    <contributor>\n"
+                                                                 + "        <email>cont@hp.com</email>\n"
+                                                                 + "        <name>cont</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </contributor>\n"
+                                                                 + "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "</entry>\n");
+    private static final String ATOM_ENTRY_2             =
+                                                             replaceTimeToken("<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <id>2</id>\n"
+                                                                 + "    <updated>@TIME@</updated>\n"
+                                                                 + "    <title type=\"text\">title</title>\n"
+                                                                 + "    <summary type=\"text\">summary</summary>\n"
+                                                                 + "    <published>@TIME@</published>\n"
+                                                                 + "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "    <author>\n"
+                                                                 + "        <email>author@hp.com</email>\n"
+                                                                 + "        <name>author</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </author>\n"
+                                                                 + "    <contributor>\n"
+                                                                 + "        <email>cont@hp.com</email>\n"
+                                                                 + "        <name>cont</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </contributor>\n"
+                                                                 + "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "    <content type=\"text/plain\">Gustaf's Knckebrd</content>\n"
+                                                                 + "</entry>\n");
+    private static final String ATOM_ENTRY_3             =
+                                                             replaceTimeToken("<entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <id>3</id>\n"
+                                                                 + "    <updated>@TIME@</updated>\n"
+                                                                 + "    <title type=\"text\">title</title>\n"
+                                                                 + "    <summary type=\"text\">summary</summary>\n"
+                                                                 + "    <published>@TIME@</published>\n"
+                                                                 + "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "    <author>\n"
+                                                                 + "        <email>author@hp.com</email>\n"
+                                                                 + "        <name>author</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </author>\n"
+                                                                 + "    <contributor>\n"
+                                                                 + "        <email>cont@hp.com</email>\n"
+                                                                 + "        <name>cont</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </contributor>\n"
+                                                                 + "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "    <content type=\"application/xml\">\n"
+                                                                 + "        <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n"
+                                                                 + "            <x2>\n"
+                                                                 + "                <y:y1>Gustaf's Knckebrd</y:y1>\n"
+                                                                 + "            </x2>\n"
+                                                                 + "        </x1>\n"
+                                                                 + "    </content>\n"
+                                                                 + "</entry>\n");
+
+    private static final String ATOM_FEED_1              =
+                                                             replaceTimeToken("<feed xml:lang=\"en-us\" xml:base=\"http://feed/base\" anyAttr=\"anyAttrValue\" xmlns:opensearch=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <id>id</id>\n"
+                                                                 + "    <updated>@TIME@</updated>\n"
+                                                                 + "    <title type=\"text\">title</title>\n"
+                                                                 + "    <subtitle type=\"text\">subtitle</subtitle>\n"
+                                                                 + "    <opensearch:itemsPerPage>5</opensearch:itemsPerPage>\n"
+                                                                 + "    <opensearch:startIndex>6</opensearch:startIndex>\n"
+                                                                 + "    <opensearch:totalResults>7</opensearch:totalResults>\n"
+                                                                 + "    <opensearch:Query searchTerms=\"query 1\"/>\n"
+                                                                 + "    <opensearch:Query searchTerms=\"query 2\"/>\n"
+                                                                 + "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "    <author>\n"
+                                                                 + "        <email>author@hp.com</email>\n"
+                                                                 + "        <name>author</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </author>\n"
+                                                                 + "    <contributor>\n"
+                                                                 + "        <email>cont@hp.com</email>\n"
+                                                                 + "        <name>cont</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </contributor>\n"
+                                                                 + "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "    <generator version=\"1.0\" uri=\"http://generator/uri\" xml:lang=\"en-us\" xml:base=\"http://generator/base\">wink</generator>\n"
+                                                                 + "    <icon>icon</icon>\n"
+                                                                 + "    <logo>logo</logo>\n"
+                                                                 + "    <rights type=\"text\">rights</rights>\n"
+                                                                 + "    <entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\">\n"
+                                                                 + "        <id>1</id>\n"
+                                                                 + "        <updated>@TIME@</updated>\n"
+                                                                 + "        <title type=\"text\">title</title>\n"
+                                                                 + "        <summary type=\"text\">summary</summary>\n"
+                                                                 + "        <published>@TIME@</published>\n"
+                                                                 + "        <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "        <author>\n"
+                                                                 + "            <email>author@hp.com</email>\n"
+                                                                 + "            <name>author</name>\n"
+                                                                 + "            <uri>http://uri</uri>\n"
+                                                                 + "        </author>\n"
+                                                                 + "        <contributor>\n"
+                                                                 + "            <email>cont@hp.com</email>\n"
+                                                                 + "            <name>cont</name>\n"
+                                                                 + "            <uri>http://uri</uri>\n"
+                                                                 + "        </contributor>\n"
+                                                                 + "        <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "        <content type=\"application/xml\">\n"
+                                                                 + "            <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n"
+                                                                 + "                <x2>\n"
+                                                                 + "                    <y:y1>Gustaf's Knckebrd</y:y1>\n"
+                                                                 + "                </x2>\n"
+                                                                 + "            </x1>\n"
+                                                                 + "        </content>\n"
+                                                                 + "    </entry>\n"
+                                                                 + "</feed>\n");
+
+    private static final String ATOM_FEED_2              =
+                                                             replaceTimeToken("<feed xml:lang=\"en-us\" xml:base=\"http://feed/base\" anyAttr=\"anyAttrValue\" xmlns=\"http://www.w3.org/2005/Atom\">\n" + "    <id>id</id>\n"
+                                                                 + "    <updated>@TIME@</updated>\n"
+                                                                 + "    <title type=\"text\">title</title>\n"
+                                                                 + "    <subtitle type=\"text\">subtitle</subtitle>\n"
+                                                                 + "    <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "    <author>\n"
+                                                                 + "        <email>author@hp.com</email>\n"
+                                                                 + "        <name>author</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </author>\n"
+                                                                 + "    <contributor>\n"
+                                                                 + "        <email>cont@hp.com</email>\n"
+                                                                 + "        <name>cont</name>\n"
+                                                                 + "        <uri>http://uri</uri>\n"
+                                                                 + "    </contributor>\n"
+                                                                 + "    <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "    <generator version=\"1.0\" uri=\"http://generator/uri\" xml:lang=\"en-us\" xml:base=\"http://generator/base\">wink</generator>\n"
+                                                                 + "    <icon>icon</icon>\n"
+                                                                 + "    <logo>logo</logo>\n"
+                                                                 + "    <rights type=\"text\">rights</rights>\n"
+                                                                 + "    <entry xml:lang=\"en-us\" xml:base=\"http://entry/base\" anyAttr=\"anyAttrValue\">\n"
+                                                                 + "        <id>1</id>\n"
+                                                                 + "        <updated>@TIME@</updated>\n"
+                                                                 + "        <title type=\"text\">title</title>\n"
+                                                                 + "        <summary type=\"text\">summary</summary>\n"
+                                                                 + "        <published>@TIME@</published>\n"
+                                                                 + "        <link href=\"href\" type=\"text/plain\" rel=\"rel\" hreflang=\"en-us\" title=\"title\" length=\"10\"/>\n"
+                                                                 + "        <author>\n"
+                                                                 + "            <email>author@hp.com</email>\n"
+                                                                 + "            <name>author</name>\n"
+                                                                 + "            <uri>http://uri</uri>\n"
+                                                                 + "        </author>\n"
+                                                                 + "        <contributor>\n"
+                                                                 + "            <email>cont@hp.com</email>\n"
+                                                                 + "            <name>cont</name>\n"
+                                                                 + "            <uri>http://uri</uri>\n"
+                                                                 + "        </contributor>\n"
+                                                                 + "        <category label=\"label\" scheme=\"scheme\" term=\"term\"/>\n"
+                                                                 + "        <content type=\"application/xml\">\n"
+                                                                 + "            <x1 xmlns=\"xxx\" xmlns:y=\"yyy\">\n"
+                                                                 + "                <x2>\n"
+                                                                 + "                    <y:y1>Gustaf's Knckebrd</y:y1>\n"
+                                                                 + "                </x2>\n"
+                                                                 + "            </x1>\n"
+                                                                 + "        </content>\n"
+                                                                 + "    </entry>\n"
+                                                                 + "</feed>\n");
+
+    private static JAXBContext  ctx;
 
     static {
         try {
@@ -281,32 +268,33 @@ public class AtomTest extends TestCase {
         text.setBase("http://title/base");
         text.setLang("en-us");
 
-        JAXBNamespacePrefixMapper mapper = new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
+        JAXBNamespacePrefixMapper mapper =
+            new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
         mapper.omitNamespace(RestConstants.NAMESPACE_OPENSEARCH);
 
         // test type TEXT
         text.setType(AtomTextType.text);
         text.setValue("title");
         JAXBElement<AtomText> element = (new ObjectFactory()).createTitle(text);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_TEXT_TEXT, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_TEXT_TEXT, os.toString());
 
         // test type HTML
         text.setType(AtomTextType.html);
         text.setValue("<h1>title</h1>");
         element = (new ObjectFactory()).createTitle(text);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_TEXT_HTML, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_TEXT_HTML, os.toString());
 
         // test type XHTML
         text.setType(AtomTextType.xhtml);
         text.setValue("<h1>title</h1>");
         element = (new ObjectFactory()).createTitle(text);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_TEXT_XHTML, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_TEXT_XHTML, os.toString());
     }
 
     public void testAtomTextUnmarshal() throws Exception {
@@ -338,7 +326,8 @@ public class AtomTest extends TestCase {
         assertNotNull(text);
         assertEquals("en-us", text.getLang());
         assertEquals("http://title/base", text.getBase());
-        assertEquals("<h1 xmlns=\""+RestConstants.NAMESPACE_XHTML+"\">title</h1>", text.getValue());
+        assertEquals("<h1 xmlns=\"" + RestConstants.NAMESPACE_XHTML + "\">title</h1>", text
+            .getValue());
         assertEquals(AtomTextType.xhtml, text.getType());
     }
 
@@ -352,14 +341,16 @@ public class AtomTest extends TestCase {
         assertNotNull(text);
         assertEquals("en-us", text.getLang());
         assertEquals("http://title/base", text.getBase());
-        assertEquals("<h1 xmlns=\""+RestConstants.NAMESPACE_XHTML+"\"><div>title</div></h1>", text.getValue().replaceAll("\n", "").replaceAll("    ", ""));
+        assertEquals("<h1 xmlns=\"" + RestConstants.NAMESPACE_XHTML + "\"><div>title</div></h1>",
+                     text.getValue().replaceAll("\n", "").replaceAll("    ", ""));
         assertEquals(AtomTextType.xhtml, text.getType());
     }
 
     public void testAtomContentMarshal() throws Exception {
         Marshaller m = JAXBUtils.createMarshaller(ctx);
 
-        JAXBNamespacePrefixMapper mapper = new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
+        JAXBNamespacePrefixMapper mapper =
+            new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_ATOM);
         mapper.omitNamespace(RestConstants.NAMESPACE_OPENSEARCH);
 
         AtomContent content = new AtomContent();
@@ -369,31 +360,31 @@ public class AtomTest extends TestCase {
         content.setType("text");
         content.setValue("title");
         JAXBElement<AtomContent> element = (new ObjectFactory()).createContent(content);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_CONTENT_TEXT, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_CONTENT_TEXT, os.toString());
 
         content.setType("html");
         content.setValue("<h1>title</h1>");
         element = (new ObjectFactory()).createContent(content);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_CONTENT_HTML, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_CONTENT_HTML, os.toString());
 
         content.setType("xhtml");
         content.setValue("<h1>title</h1>");
         element = (new ObjectFactory()).createContent(content);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_CONTENT_XHTML, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_CONTENT_XHTML, os.toString());
 
         content.setType("application/xml");
         content.setValue("<x xmlns=\"http://x/\">title</x>");
         element = (new ObjectFactory()).createContent(content);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, mapper, writer);
-        assertEquals(ATOM_CONTENT_XML, writer.toString());
-}
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, mapper, os);
+        assertEquals(ATOM_CONTENT_XML, os.toString());
+    }
 
     public void testAtomContentUnmarshal() throws Exception {
         Unmarshaller u = JAXBUtils.createUnmarshaller(ctx);
@@ -424,7 +415,8 @@ public class AtomTest extends TestCase {
         assertNotNull(content);
         assertEquals("en-us", content.getLang());
         assertEquals("http://title/base", content.getBase());
-        assertEquals("<h1 xmlns=\""+RestConstants.NAMESPACE_XHTML+"\">title</h1>", content.getValue());
+        assertEquals("<h1 xmlns=\"" + RestConstants.NAMESPACE_XHTML + "\">title</h1>", content
+            .getValue());
         assertEquals("xhtml", content.getType());
 
         element = AtomJAXBUtils.unmarshal(u, new StringReader(ATOM_CONTENT_XML));
@@ -443,24 +435,23 @@ public class AtomTest extends TestCase {
 
         AtomEntry entry = getEntryWithoutContent("1");
         JAXBElement<AtomEntry> element = (new ObjectFactory()).createEntry(entry);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(ATOM_ENTRY_1, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertEquals(ATOM_ENTRY_1, os.toString());
 
         entry = getEntryWithPlainTextContent("2");
         element = (new ObjectFactory()).createEntry(entry);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(ATOM_ENTRY_2, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertTrue(Arrays.equals(ATOM_ENTRY_2.getBytes("UTF-8"), os.toByteArray()));
 
         entry = getEntryWithXmlContent("3");
         element = (new ObjectFactory()).createEntry(entry);
-        writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(ATOM_ENTRY_3, writer.toString());
+        os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertTrue(Arrays.equals(ATOM_ENTRY_3.getBytes("UTF-8"), os.toByteArray()));
     }
 
-
     public void testAtomEntryUnmarshal() throws Exception {
         Unmarshaller u = AtomEntry.getUnmarshaller();
         Object element = AtomJAXBUtils.unmarshal(u, new StringReader(ATOM_ENTRY_1));
@@ -510,7 +501,8 @@ public class AtomTest extends TestCase {
         assertEquals("3", entry.getId());
         assertNotNull(entry.getContent());
         assertEquals("application/xml", entry.getContent().getType());
-        assertEquals("<x1 xmlns=\"xxx\" xmlns:y=\"yyy\"><x2><y:y1>Gustaf's Knckebrd</y:y1></x2></x1>", entry.getContent().getValue().replaceAll("\n", "").replaceAll("    ", ""));
+        assertEquals("<x1 xmlns=\"xxx\" xmlns:y=\"yyy\"><x2><y:y1>Gustaf's Knckebrd</y:y1></x2></x1>",
+                     entry.getContent().getValue().replaceAll("\n", "").replaceAll("    ", ""));
     }
 
     public void testAtomFeedMarshal() throws Exception {
@@ -518,9 +510,9 @@ public class AtomTest extends TestCase {
 
         AtomFeed feed = getFeed();
         JAXBElement<AtomFeed> element = (new ObjectFactory()).createFeed(feed);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(ATOM_FEED_1, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertTrue(Arrays.equals(ATOM_FEED_1.getBytes("UTF-8"), os.toByteArray()));
     }
 
     public void testAtomFeedUnmarshal() throws Exception {
@@ -570,9 +562,9 @@ public class AtomTest extends TestCase {
         Unmarshaller u = AtomFeed.getUnmarshaller();
         AtomFeed feed = (AtomFeed)AtomJAXBUtils.unmarshal(u, new StringReader(ATOM_FEED_1));
         JAXBElement<AtomFeed> element = (new ObjectFactory()).createFeed(feed);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, feed.getNamespacePrefixMapper(), writer);
-        assertEquals(ATOM_FEED_1, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, feed.getNamespacePrefixMapper(), os);
+        assertTrue(Arrays.equals(ATOM_FEED_1.getBytes("UTF-8"), os.toByteArray()));
     }
 
     public void testAtomFeedMarshalUnmarshalWithoutOpenSearch() throws Exception {
@@ -584,9 +576,9 @@ public class AtomTest extends TestCase {
         assertEquals(-1, feed.getTotalResults());
         assertEquals(0, feed.getOpenSearchQueries().size());
         JAXBElement<AtomFeed> element = (new ObjectFactory()).createFeed(feed);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, feed.getNamespacePrefixMapper(), writer);
-        assertEquals(ATOM_FEED_2, writer.toString());
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, feed.getNamespacePrefixMapper(), os);
+        assertTrue(Arrays.equals(ATOM_FEED_2.getBytes("UTF-8"), os.toByteArray()));
     }
 
     public void testGetLinkFromEntry() {
@@ -615,7 +607,6 @@ public class AtomTest extends TestCase {
         link3.setRel("rel2");
         entry.getLinks().add(link5NoType);
 
-
         List<AtomLink> links = entry.getLinks("rel1", "type1");
         assertEquals(1, links.size());
         assertEquals("href1", links.get(0).getHref());
@@ -638,28 +629,28 @@ public class AtomTest extends TestCase {
         try {
             entry.getLinks(null, "");
             fail("expected NullPointerException");
-        } catch(NullPointerException e) {
+        } catch (NullPointerException e) {
             // passed!
         }
 
         try {
             entry.getLinks("", null);
             fail("expected NullPointerException");
-        } catch(NullPointerException e) {
+        } catch (NullPointerException e) {
             // passed!
         }
 
         try {
             entry.getLinks("", null);
             fail("expected NullPointerException");
-        } catch(NullPointerException e) {
+        } catch (NullPointerException e) {
             // passed!
         }
 
         try {
             entry.getLinks("", null);
             fail("expected NullPointerException");
-        } catch(NullPointerException e) {
+        } catch (NullPointerException e) {
             // passed!
         }
 
@@ -808,9 +799,30 @@ public class AtomTest extends TestCase {
         AtomEntry entry = getEntryWithoutContent(id);
         AtomContent content = new AtomContent();
         content.setType("application/xml");
-        content.setValue("<x1 xmlns=\"xxx\" xmlns:y=\"yyy\"><x2><y:y1>Gustaf's Knckebrd</y:y1></x2></x1>");
+        content
+            .setValue("<x1 xmlns=\"xxx\" xmlns:y=\"yyy\"><x2><y:y1>Gustaf's Knckebrd</y:y1></x2></x1>");
         entry.setContent(content);
         return entry;
     }
 
+    public void testEncoding() throws Exception {
+        AtomEntry atomEntry = getEntryWithoutContent("1111");
+
+        JAXBElement<AtomEntry> element = (new ObjectFactory()).createEntry(atomEntry);
+        Marshaller marshaller = AtomEntry.getMarshaller();
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(marshaller, element, os);
+        String defaultContent = new String(os.toByteArray(), "UTF-8");
+
+        String[] encodings = {"US-ASCII", "UTF-8", "UTF-16"};
+        for (String enc : encodings) {
+            element = (new ObjectFactory()).createEntry(atomEntry);
+            marshaller = AtomEntry.getMarshaller();
+            marshaller.setProperty(Marshaller.JAXB_ENCODING, enc);
+            os = new ByteArrayOutputStream();
+            AtomJAXBUtils.marshal(marshaller, element, os);
+            assertEquals(enc + " failed", defaultContent, new String(os.toByteArray(), enc));
+        }
+    }
+
 }
diff --git a/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java b/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
index a89b1188..c9a03260 100644
--- a/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
+++ b/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
@@ -17,13 +17,12 @@
  *  under the License.
  *  
  *******************************************************************************/
- 
 
 package org.apache.wink.common.model.opensearch;
 
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.StringReader;
-import java.io.StringWriter;
 import java.math.BigInteger;
 
 import javax.xml.bind.JAXBElement;
@@ -31,93 +30,93 @@ import javax.xml.bind.Marshaller;
 import javax.xml.bind.Unmarshaller;
 import javax.xml.namespace.QName;
 
+import junit.framework.TestCase;
+
 import org.apache.wink.common.model.atom.AtomJAXBUtils;
-import org.apache.wink.common.model.opensearch.ObjectFactory;
-import org.apache.wink.common.model.opensearch.OpenSearchDescription;
-import org.apache.wink.common.model.opensearch.OpenSearchImage;
-import org.apache.wink.common.model.opensearch.OpenSearchQuery;
-import org.apache.wink.common.model.opensearch.OpenSearchUrl;
 
+public class OpenSearchTest extends TestCase {
 
-import junit.framework.TestCase;
+    private static final String OPENSEARCH =
+                                               "<OpenSearchDescription ns2:otherAttrName=\"otherAttrValue\" xmlns=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns:ns2=\"otherAttrNs\">\n" + "    <ShortName>short name</ShortName>\n"
+                                                   + "    <Description>description</Description>\n"
+                                                   + "    <Tags>tags</Tags>\n"
+                                                   + "    <Contact>contact</Contact>\n"
+                                                   + "    <Url type=\"type\" template=\"template\"/>\n"
+                                                   + "    <LongName>long name</LongName>\n"
+                                                   + "    <Image type=\"image type 1\" width=\"67890\" height=\"12345\">image value 1</Image>\n"
+                                                   + "    <Image type=\"image type 2\" width=\"12345\" height=\"67890\">image value 2</Image>\n"
+                                                   + "    <Query outputEncoding=\"output encoding\" inputEncoding=\"input encoding\" language=\"language\" startIndex=\"2\" startPage=\"3\" count=\"1\" totalResults=\"4\" title=\"title\" searchTerms=\"search terms\" role=\"role\" ns2:otherAttrName=\"otherAttrValue\"/>\n"
+                                                   + "    <Developer>developer</Developer>\n"
+                                                   + "    <Attribution>attribution</Attribution>\n"
+                                                   + "    <SyndicationRight>syndication right</SyndicationRight>\n"
+                                                   + "    <AdultContent>false</AdultContent>\n"
+                                                   + "    <Language>language 1</Language>\n"
+                                                   + "    <Language>language 2</Language>\n"
+                                                   + "    <OutputEncoding>output encoding 1</OutputEncoding>\n"
+                                                   + "    <OutputEncoding>output encoding 2</OutputEncoding>\n"
+                                                   + "    <InputEncoding>input encoding 1</InputEncoding>\n"
+                                                   + "    <InputEncoding>input encoding 2</InputEncoding>\n"
+                                                   + "</OpenSearchDescription>\n";
+
+    // private static JAXBContext ctx;
+    //    
+    // static {
+    // try {
+    // ctx =
+    // JAXBContext.newInstance(OpenSearchDescription.class.getPackage().getName());
+    // } catch (JAXBException e) {
+    // throw new RuntimeException(e);
+    // }
+    // }
 
-public class OpenSearchTest extends TestCase {
-    
-    private static final String OPENSEARCH = 
-            "<OpenSearchDescription ns2:otherAttrName=\"otherAttrValue\" xmlns=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns:ns2=\"otherAttrNs\">\n" + 
-    		"    <ShortName>short name</ShortName>\n" + 
-    		"    <Description>description</Description>\n" + 
-    		"    <Tags>tags</Tags>\n" + 
-    		"    <Contact>contact</Contact>\n" + 
-    		"    <Url type=\"type\" template=\"template\"/>\n" + 
-    		"    <LongName>long name</LongName>\n" + 
-    		"    <Image type=\"image type 1\" width=\"67890\" height=\"12345\">image value 1</Image>\n" + 
-    		"    <Image type=\"image type 2\" width=\"12345\" height=\"67890\">image value 2</Image>\n" + 
-    		"    <Query outputEncoding=\"output encoding\" inputEncoding=\"input encoding\" language=\"language\" startIndex=\"2\" startPage=\"3\" count=\"1\" totalResults=\"4\" title=\"title\" searchTerms=\"search terms\" role=\"role\" ns2:otherAttrName=\"otherAttrValue\"/>\n" + 
-    		"    <Developer>developer</Developer>\n" + 
-    		"    <Attribution>attribution</Attribution>\n" + 
-    		"    <SyndicationRight>syndication right</SyndicationRight>\n" + 
-    		"    <AdultContent>false</AdultContent>\n" + 
-    		"    <Language>language 1</Language>\n" + 
-    		"    <Language>language 2</Language>\n" + 
-    		"    <OutputEncoding>output encoding 1</OutputEncoding>\n" + 
-    		"    <OutputEncoding>output encoding 2</OutputEncoding>\n" + 
-    		"    <InputEncoding>input encoding 1</InputEncoding>\n" + 
-    		"    <InputEncoding>input encoding 2</InputEncoding>\n" + 
-    		"</OpenSearchDescription>\n";
-    
-//    private static JAXBContext ctx;
-//    
-//    static {
-//        try {
-//            ctx = JAXBContext.newInstance(OpenSearchDescription.class.getPackage().getName());
-//        } catch (JAXBException e) {
-//            throw new RuntimeException(e);
-//        }
-//    }
-    
     public void testOpenSearchMarshal() throws IOException {
-//        Map<String,String> p2n = new HashMap<String,String>();
-//        p2n.put("otherAttrNs", "other");
-//        JAXBNamespacePrefixMapper namespacePrefixMapper = 
-//            new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH, p2n);
-//        Marshaller m = AtomJAXBUtils.createMarshaller(ctx, namespacePrefixMapper);
+        // Map<String,String> p2n = new HashMap<String,String>();
+        // p2n.put("otherAttrNs", "other");
+        // JAXBNamespacePrefixMapper namespacePrefixMapper =
+        // new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH,
+        // p2n);
+        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx,
+        // namespacePrefixMapper);
         Marshaller m = OpenSearchDescription.getMarshaller();
-        
+
         OpenSearchDescription osd = getOpenSearchDescription();
-        JAXBElement<OpenSearchDescription> element = (new ObjectFactory()).createOpenSearchDescription(osd);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(OPENSEARCH, writer.toString());
+        JAXBElement<OpenSearchDescription> element =
+            (new ObjectFactory()).createOpenSearchDescription(osd);
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertEquals(OPENSEARCH, os.toString());
     }
-    
+
     public void testOpenSearchUnmarshal() throws IOException {
-//        Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
+        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
         Unmarshaller u = OpenSearchDescription.getUnmarshaller();
         Object element = AtomJAXBUtils.unmarshal(u, new StringReader(OPENSEARCH));
         assertNotNull(element);
         assertTrue(element instanceof OpenSearchDescription);
-        
+
         OpenSearchDescription osd = (OpenSearchDescription)element;
         OpenSearchDescription expectedOsd = getOpenSearchDescription();
-        
+
         assertOpenSearchDescription(expectedOsd, osd);
     }
-    
+
     public void testOpenSearchUnmarshalMarshal() throws IOException {
-//        Marshaller m = AtomJAXBUtils.createMarshaller(ctx, new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH));
+        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx, new
+        // JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH));
         Marshaller m = OpenSearchDescription.getMarshaller();
-//        Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
+        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
         Unmarshaller u = OpenSearchDescription.getUnmarshaller();
-        
+
         Object service = AtomJAXBUtils.unmarshal(u, new StringReader(OPENSEARCH));
-        JAXBElement<OpenSearchDescription> element = (new ObjectFactory()).createOpenSearchDescription((OpenSearchDescription)service);
-        StringWriter writer = new StringWriter();
-        AtomJAXBUtils.marshal(m, element, null, writer);
-        assertEquals(OPENSEARCH, writer.toString());
+        JAXBElement<OpenSearchDescription> element =
+            (new ObjectFactory()).createOpenSearchDescription((OpenSearchDescription)service);
+        ByteArrayOutputStream os = new ByteArrayOutputStream();
+        AtomJAXBUtils.marshal(m, element, null, os);
+        assertEquals(OPENSEARCH, os.toString());
     }
 
-    private void assertOpenSearchDescription(OpenSearchDescription expectedOsd, OpenSearchDescription osd) {
+    private void assertOpenSearchDescription(OpenSearchDescription expectedOsd,
+                                             OpenSearchDescription osd) {
         assertEquals(expectedOsd.getAdultContent(), osd.getAdultContent());
         assertEquals(expectedOsd.getAttribution(), osd.getAttribution());
         assertEquals(expectedOsd.getContact(), osd.getContact());
@@ -127,7 +126,7 @@ public class OpenSearchTest extends TestCase {
         assertEquals(expectedOsd.getShortName(), osd.getShortName());
         assertEquals(expectedOsd.getSyndicationRight(), osd.getSyndicationRight());
         assertEquals(expectedOsd.getTags(), osd.getTags());
-        
+
         assertEquals(expectedOsd.getInputEncoding().size(), osd.getInputEncoding().size());
         for (int i = 0; i < expectedOsd.getInputEncoding().size(); ++i) {
             assertEquals(expectedOsd.getInputEncoding().get(i), osd.getInputEncoding().get(i));
@@ -142,13 +141,13 @@ public class OpenSearchTest extends TestCase {
         for (int i = 0; i < expectedOsd.getLanguage().size(); ++i) {
             assertEquals(expectedOsd.getLanguage().get(i), osd.getLanguage().get(i));
         }
-        
+
         assertEquals(expectedOsd.getOtherAttributes().size(), osd.getOtherAttributes().size());
         for (int i = 0; i < expectedOsd.getOtherAttributes().size(); ++i) {
-            assertEquals(expectedOsd.getOtherAttributes().get(new QName("otherAttrNs", "otherAttrName")), 
-                    osd.getOtherAttributes().get(new QName("otherAttrNs", "otherAttrName")));
+            assertEquals(expectedOsd.getOtherAttributes().get(new QName("otherAttrNs",
+                                                                        "otherAttrName")), osd
+                .getOtherAttributes().get(new QName("otherAttrNs", "otherAttrName")));
         }
-        
 
         assertEquals(expectedOsd.getImage().size(), osd.getImage().size());
         for (int i = 0; i < expectedOsd.getImage().size(); ++i) {
@@ -159,7 +158,7 @@ public class OpenSearchTest extends TestCase {
             assertEquals(expected.getHeight(), actual.getHeight());
             assertEquals(expected.getWidth(), actual.getWidth());
         }
-        
+
         assertEquals(expectedOsd.getUrl().size(), osd.getUrl().size());
         for (int i = 0; i < expectedOsd.getUrl().size(); ++i) {
             OpenSearchUrl expected = expectedOsd.getUrl().get(i);
@@ -167,7 +166,7 @@ public class OpenSearchTest extends TestCase {
             assertEquals(expected.getType(), actual.getType());
             assertEquals(expected.getTemplate(), actual.getTemplate());
         }
-        
+
         assertEquals(expectedOsd.getQuery().size(), osd.getQuery().size());
         for (int i = 0; i < expectedOsd.getQuery().size(); ++i) {
             OpenSearchQuery expected = expectedOsd.getQuery().get(i);
@@ -183,16 +182,16 @@ public class OpenSearchTest extends TestCase {
             assertEquals(expected.getStartPage(), actual.getStartPage());
             assertEquals(expected.getTotalResults(), actual.getTotalResults());
             assertEquals(expected.getOtherAttributes().size(), actual.getOtherAttributes().size());
-            assertEquals(expected.getOtherAttributes().get(new QName("otherAttrNs", "otherAttrName")), 
-                    actual.getOtherAttributes().get(new QName("otherAttrNs", "otherAttrName")));
+            assertEquals(expected.getOtherAttributes()
+                .get(new QName("otherAttrNs", "otherAttrName")), actual.getOtherAttributes()
+                .get(new QName("otherAttrNs", "otherAttrName")));
         }
-        
-        
+
     }
 
     private OpenSearchDescription getOpenSearchDescription() {
         OpenSearchDescription osd = new OpenSearchDescription();
-        
+
         osd.setAttribution("attribution");
         osd.setContact("contact");
         osd.setDescription("description");
@@ -203,30 +202,30 @@ public class OpenSearchTest extends TestCase {
         osd.setAdultContent("false");
         osd.setTags("tags");
         osd.getOtherAttributes().put(new QName("otherAttrNs", "otherAttrName"), "otherAttrValue");
-        
+
         OpenSearchImage image = new OpenSearchImage();
         image.setHeight(new BigInteger("12345"));
         image.setWidth(new BigInteger("67890"));
         image.setType("image type 1");
         image.setValue("image value 1");
         osd.getImage().add(image);
-        
+
         image = new OpenSearchImage();
         image.setHeight(new BigInteger("67890"));
         image.setWidth(new BigInteger("12345"));
         image.setType("image type 2");
         image.setValue("image value 2");
         osd.getImage().add(image);
-        
+
         osd.getInputEncoding().add("input encoding 1");
         osd.getInputEncoding().add("input encoding 2");
-        
+
         osd.getLanguage().add("language 1");
         osd.getLanguage().add("language 2");
-        
+
         osd.getOutputEncoding().add("output encoding 1");
         osd.getOutputEncoding().add("output encoding 2");
-        
+
         OpenSearchQuery query = new OpenSearchQuery();
         query.getOtherAttributes().put(new QName("otherAttrNs", "otherAttrName"), "otherAttrValue");
         query.setCount(new BigInteger("1"));
@@ -240,7 +239,7 @@ public class OpenSearchTest extends TestCase {
         query.setTotalResults(new BigInteger("4"));
         query.setTitle("title");
         osd.getQuery().add(query);
-        
+
         OpenSearchUrl url = new OpenSearchUrl();
         url.setTemplate("template");
         url.setType("type");
