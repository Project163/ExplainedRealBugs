diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/AbstractJAXBProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/AbstractJAXBProvider.java
index faf048a7..9a51ba5c 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/AbstractJAXBProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/AbstractJAXBProvider.java
@@ -41,9 +41,12 @@ import javax.xml.bind.annotation.XmlType;
 import javax.xml.namespace.QName;
 
 import org.apache.wink.common.internal.i18n.Messages;
+import org.apache.wink.common.internal.utils.JAXBUtils;
 import org.apache.wink.common.internal.utils.MediaTypeUtils;
 import org.apache.wink.common.internal.utils.SimpleMap;
 import org.apache.wink.common.internal.utils.SoftConcurrentMap;
+import org.apache.wink.common.model.XmlFormattingOptions;
+import org.apache.wink.common.utils.ProviderUtils;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -73,7 +76,22 @@ public abstract class AbstractJAXBProvider {
     protected final Marshaller getMarshaller(Class<?> type, MediaType mediaType)
         throws JAXBException {
         JAXBContext context = getContext(type, mediaType);
-        return context.createMarshaller();
+        Marshaller marshaller = context.createMarshaller();
+        marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
+
+        ContextResolver<XmlFormattingOptions> contextResolver =
+            providers.getContextResolver(XmlFormattingOptions.class, mediaType);
+        XmlFormattingOptions formatingOptions = null;
+        if (contextResolver != null) {
+            formatingOptions = contextResolver.getContext(type);
+        }
+        if (formatingOptions != null) {
+            JAXBUtils.setXmlFormattingOptions(marshaller, formatingOptions);
+        } else {
+            JAXBUtils.setXmlFormattingOptions(marshaller, XmlFormattingOptions
+                .getDefaultXmlFormattingOptions());
+        }
+        return marshaller;
     }
 
     protected boolean isSupportedMediaType(MediaType mediaType) {
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/JAXBXmlProvider.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/JAXBXmlProvider.java
index 88a5e47a..acf82d4a 100644
--- a/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/JAXBXmlProvider.java
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/entity/xml/JAXBXmlProvider.java
@@ -41,9 +41,6 @@ import javax.xml.bind.annotation.XmlRootElement;
 import javax.xml.transform.stream.StreamSource;
 
 import org.apache.wink.common.internal.i18n.Messages;
-import org.apache.wink.common.internal.utils.JAXBUtils;
-import org.apache.wink.common.model.XmlFormattingOptions;
-import org.apache.wink.common.utils.ProviderUtils;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -110,14 +107,8 @@ public class JAXBXmlProvider extends AbstractJAXBProvider implements MessageBody
                         OutputStream entityStream) throws IOException, WebApplicationException {
         try {
             Marshaller marshaller = getMarshaller(type, mediaType);
-
-            marshaller.setProperty(Marshaller.JAXB_ENCODING, ProviderUtils.getCharset(mediaType));
-
             Object entityToMarshal = getEntityToMarshal(t, type);
 
-            JAXBUtils.setXmlFormattingOptions(marshaller, XmlFormattingOptions
-                .getDefaultXmlFormattingOptions());
-
             // Use an OutputStream directly instead of a Writer for performance.
             marshaller.marshal(entityToMarshal, entityStream);
         } catch (JAXBException e) {
diff --git a/wink-common/src/main/java/org/apache/wink/common/model/XmlFormattingOptions.java b/wink-common/src/main/java/org/apache/wink/common/model/XmlFormattingOptions.java
index 303bb64b..11e7d51f 100644
--- a/wink-common/src/main/java/org/apache/wink/common/model/XmlFormattingOptions.java
+++ b/wink-common/src/main/java/org/apache/wink/common/model/XmlFormattingOptions.java
@@ -32,10 +32,10 @@ package org.apache.wink.common.model;
  */
 public class XmlFormattingOptions implements Cloneable {
 
-    private boolean                     omitXmlDeclaration;
-    private boolean                     indenting;
-
-    private static XmlFormattingOptions defaultXmlFormattingOptions = new XmlFormattingOptions();
+    private final boolean                     omitXmlDeclaration;
+    private final boolean                     indenting;
+    private final static XmlFormattingOptions defaultXmlFormattingOptions =
+                                                                              new XmlFormattingOptions();
 
     public XmlFormattingOptions() {
         this(true, true);
@@ -50,31 +50,11 @@ public class XmlFormattingOptions implements Cloneable {
         return indenting;
     }
 
-    public void setIndenting(boolean indenting) {
-        this.indenting = indenting;
-    }
-
-    public static XmlFormattingOptions getDefaultXmlFormattingOptions() {
-        return defaultXmlFormattingOptions.safeClone();
-    }
-
-    public static void setDefaultXmlFormattingOptions(XmlFormattingOptions defaultXmlFormattingOptions) {
-        XmlFormattingOptions.defaultXmlFormattingOptions = defaultXmlFormattingOptions.safeClone();
-    }
-
-    public void setOmitXmlDeclaration(boolean omitXmlDeclaration) {
-        this.omitXmlDeclaration = omitXmlDeclaration;
-    }
-
     public boolean isOmitXmlDeclaration() {
         return omitXmlDeclaration;
     }
 
-    private XmlFormattingOptions safeClone() {
-        try {
-            return (XmlFormattingOptions)this.clone();
-        } catch (CloneNotSupportedException e) {
-            throw new RuntimeException(e); // this can not happen
-        }
+    public static XmlFormattingOptions getDefaultXmlFormattingOptions() {
+        return defaultXmlFormattingOptions;
     }
 }
diff --git a/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java b/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
index 9eae1a73..f60ef288 100644
--- a/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
+++ b/wink-common/src/test/java/org/apache/wink/common/model/app/AppTest.java
@@ -25,7 +25,9 @@ import java.io.IOException;
 import java.io.StringReader;
 import java.util.List;
 
+import javax.xml.bind.JAXBContext;
 import javax.xml.bind.JAXBElement;
+import javax.xml.bind.JAXBException;
 import javax.xml.bind.Marshaller;
 import javax.xml.bind.Unmarshaller;
 import javax.xml.namespace.QName;
@@ -34,6 +36,7 @@ import junit.framework.TestCase;
 
 import org.apache.wink.common.RestException;
 import org.apache.wink.common.internal.model.ModelUtils;
+import org.apache.wink.common.internal.utils.JAXBUtils;
 import org.apache.wink.common.model.atom.AtomCategory;
 import org.apache.wink.common.model.atom.AtomText;
 import org.apache.wink.test.mock.TestUtils;
@@ -89,20 +92,18 @@ public class AppTest extends TestCase {
                                                          + "    </workspace>\n"
                                                          + "</service>\n";
 
-    // private static JAXBContext ctx;
-    //    
-    // static {
-    // try {
-    // ctx = JAXBContext.newInstance(AppService.class.getPackage().getName());
-    // } catch (JAXBException e) {
-    // throw new RuntimeException(e);
-    // }
-    // }
+    private static JAXBContext  ctx;
+
+    static {
+        try {
+            ctx = JAXBContext.newInstance(AppService.class.getPackage().getName());
+        } catch (JAXBException e) {
+            throw new RuntimeException(e);
+        }
+    }
 
     public void testAppMarshal() throws Exception {
-        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx, new
-        // JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_APP));
-        Marshaller m = AppService.getMarshaller();
+        Marshaller m = JAXBUtils.createMarshaller(ctx);
 
         AppService service = getService();
         JAXBElement<AppService> element = (new ObjectFactory()).createService(service);
@@ -113,8 +114,7 @@ public class AppTest extends TestCase {
     }
 
     public void testAppUnmarshal() throws IOException {
-        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
-        Unmarshaller u = AppService.getUnmarshaller();
+        Unmarshaller u = JAXBUtils.createUnmarshaller(ctx);
         Object element = ModelUtils.unmarshal(u, new StringReader(SERVICE_DOCUMENT));
         assertNotNull(element);
         assertTrue(element instanceof AppService);
@@ -126,11 +126,8 @@ public class AppTest extends TestCase {
     }
 
     public void testAppUnmarshalMarshal() throws Exception {
-        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx, new
-        // JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_APP));
-        Marshaller m = AppService.getMarshaller();
-        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
-        Unmarshaller u = AppService.getUnmarshaller();
+        Marshaller m = JAXBUtils.createMarshaller(ctx);
+        Unmarshaller u = JAXBUtils.createUnmarshaller(ctx);
 
         Object service = ModelUtils.unmarshal(u, new StringReader(SERVICE_DOCUMENT));
         JAXBElement<AppService> element = (new ObjectFactory()).createService((AppService)service);
diff --git a/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java b/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
index 1384eb61..91115d45 100644
--- a/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
+++ b/wink-common/src/test/java/org/apache/wink/common/model/opensearch/OpenSearchTest.java
@@ -25,7 +25,9 @@ import java.io.IOException;
 import java.io.StringReader;
 import java.math.BigInteger;
 
+import javax.xml.bind.JAXBContext;
 import javax.xml.bind.JAXBElement;
+import javax.xml.bind.JAXBException;
 import javax.xml.bind.Marshaller;
 import javax.xml.bind.Unmarshaller;
 import javax.xml.namespace.QName;
@@ -33,6 +35,7 @@ import javax.xml.namespace.QName;
 import junit.framework.TestCase;
 
 import org.apache.wink.common.internal.model.ModelUtils;
+import org.apache.wink.common.internal.utils.JAXBUtils;
 import org.apache.wink.test.mock.TestUtils;
 
 public class OpenSearchTest extends TestCase {
@@ -59,26 +62,18 @@ public class OpenSearchTest extends TestCase {
                                                    + "    <InputEncoding>input encoding 2</InputEncoding>\n"
                                                    + "</OpenSearchDescription>\n";
 
-    // private static JAXBContext ctx;
-    //    
-    // static {
-    // try {
-    // ctx =
-    // JAXBContext.newInstance(OpenSearchDescription.class.getPackage().getName());
-    // } catch (JAXBException e) {
-    // throw new RuntimeException(e);
-    // }
-    // }
+    private static JAXBContext  ctx;
+
+    static {
+        try {
+            ctx = JAXBContext.newInstance(OpenSearchDescription.class.getPackage().getName());
+        } catch (JAXBException e) {
+            throw new RuntimeException(e);
+        }
+    }
 
     public void testOpenSearchMarshal() throws Exception {
-        // Map<String,String> p2n = new HashMap<String,String>();
-        // p2n.put("otherAttrNs", "other");
-        // JAXBNamespacePrefixMapper namespacePrefixMapper =
-        // new JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH,
-        // p2n);
-        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx,
-        // namespacePrefixMapper);
-        Marshaller m = OpenSearchDescription.getMarshaller();
+        Marshaller m = JAXBUtils.createMarshaller(ctx);
 
         OpenSearchDescription osd = getOpenSearchDescription();
         JAXBElement<OpenSearchDescription> element =
@@ -90,8 +85,7 @@ public class OpenSearchTest extends TestCase {
     }
 
     public void testOpenSearchUnmarshal() throws IOException {
-        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
-        Unmarshaller u = OpenSearchDescription.getUnmarshaller();
+        Unmarshaller u = JAXBUtils.createUnmarshaller(ctx);
         Object element = ModelUtils.unmarshal(u, new StringReader(OPENSEARCH));
         assertNotNull(element);
         assertTrue(element instanceof OpenSearchDescription);
@@ -103,11 +97,8 @@ public class OpenSearchTest extends TestCase {
     }
 
     public void testOpenSearchUnmarshalMarshal() throws Exception {
-        // Marshaller m = AtomJAXBUtils.createMarshaller(ctx, new
-        // JAXBNamespacePrefixMapper(RestConstants.NAMESPACE_OPENSEARCH));
-        Marshaller m = OpenSearchDescription.getMarshaller();
-        // Unmarshaller u = AtomJAXBUtils.createUnmarshaller(ctx);
-        Unmarshaller u = OpenSearchDescription.getUnmarshaller();
+        Marshaller m = JAXBUtils.createMarshaller(ctx);
+        Unmarshaller u = JAXBUtils.createUnmarshaller(ctx);
 
         Object service = ModelUtils.unmarshal(u, new StringReader(OPENSEARCH));
         JAXBElement<OpenSearchDescription> element =
