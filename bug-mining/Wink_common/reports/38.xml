<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-107] Need to agree on what Request.selectVariant() should do</title>
                <link>https://issues.apache.org/jira/browse/WINK-107</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;I would like to discuss what Request.selectVariant() is suppose to do and use this issue as a fix if necessary. Originally, the IBM implementation of Request.selectVariant() was implemented very similar to the way that Wink currently has now.  However, I later changed the implementation to be &quot;a big mess&quot;.&lt;/p&gt;

&lt;p&gt;For the current implementation in SVN, I don&apos;t understand why you would iterate over the List&amp;lt;Variant&amp;gt; when you could just easily create the Request version of the variant (Content-Type, Content-Language, etc.) by doing new Variant() and using the HttpHeaders interface to fill in the constructor parameters.&lt;/p&gt;

&lt;p&gt;A better use of selectVariant() is to choose the best possible response Variant IMO.  Also, the method is suppose to modify the Vary header after being called according to JavaDoc and when I look at the Vary header in specs, it always mentions adding the Accept* headers.&lt;/p&gt;

&lt;p&gt;Basically, I tried implementing a selectVariant() method that would choose the best variant based on the incoming request&apos;s Accept* headers (given a list of possible &lt;b&gt;response&lt;/b&gt; variants),  A somewhat simple use case in my variation is that you have a @Produces(&quot;&lt;b&gt;/&lt;/b&gt;&quot;) on the method and your output can be in XML, plain text with either English or Spanish in the response content (so 4 variants would be built and passed into selectVariants).  The incoming request prefers Spanish and plain text as designated by the Accept-Language and Accept header respectively. &lt;/p&gt;

&lt;p&gt;After selectVariant() is called, the application developer can then call Variant.getMediaType() to find out which media type is preferred to send back and more importantly language and encoding.&lt;/p&gt;

&lt;p&gt;I tried looking at Apache CXF but they return null.  Also, discussed this with Mike before he left and I think that&apos;s why he got all confused with Accept* headers.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In short, I was wondering what the use case was for Request.selectVariant() would be, and if necessary change this implementation since this would affect application code before 0.1 goes out.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430611">WINK-107</key>
            <summary>Need to agree on what Request.selectVariant() should do</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bluk">Bryant Luk</assignee>
                                    <reporter username="bluk">Bryant Luk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2009 23:10:52 +0000</created>
                <updated>Sun, 13 Sep 2009 22:51:02 +0000</updated>
                            <resolved>Mon, 24 Aug 2009 21:32:33 +0000</resolved>
                                    <version>0.1</version>
                                    <fixVersion>1.0</fixVersion>
                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12732986" author="bluk" created="Sun, 19 Jul 2009 10:32:44 +0000"  >&lt;p&gt;I&apos;ll make the changes.  If anyone disagrees on the use case, please let me know.&lt;/p&gt;</comment>
                            <comment id="12732989" author="elman" created="Sun, 19 Jul 2009 11:03:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;For the current implementation in SVN, I don&apos;t understand why you would iterate over the List&amp;lt;Variant&amp;gt; when you could just easily create the Request version of the variant (Content-Type, Content-Language, etc.) by doing new Variant() and using the HttpHeaders interface to fill in the constructor parameters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m not quite familiar with the selectVariant() functionality and the use-case, but as I understand from javadoc: the selected variant must be from the variants list. Therefore, the user may rely on == operation, which won&apos;t be true if &lt;tt&gt;new Variant()&lt;/tt&gt; is used.&lt;/p&gt;</comment>
                            <comment id="12732992" author="bluk" created="Sun, 19 Jul 2009 11:30:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not quite familiar with the selectVariant() functionality and the use-case, but as I understand from javadoc: the selected variant must be from the variants list. Therefore, the user may rely on == operation, which won&apos;t be true if new Variant() is used.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, the variant will come from the list, so == should work.&lt;/p&gt;

&lt;p&gt;When I was talking about doing new Variant() I was more talking about inside the resource method itself.  For instance:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@POST
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doSomething(@Context HttpHeaders headers, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; something) {
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; contentEncoding = &lt;span class=&quot;code-comment&quot;&gt;// headers.getRequestHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Encoding&quot;&lt;/span&gt;).get(0) with check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;   Variant requestVariant = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Variant(headers.getMediaType(), headers.getLanguage(), contentEncoding);
   &lt;span class=&quot;code-comment&quot;&gt;// now you know what &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; is suppose to represent
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That would be much more straightforward IMO than calling a Request.selectVariant() that finds the best possible request representation.&lt;/p&gt;

&lt;p&gt;I think a better use case would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@GET
@Produces(&lt;span class=&quot;code-quote&quot;&gt;&quot;application/xml&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;text/plain&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response doSomething(@Context Request request)  {
  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method supported all 3 media types and French and English
&lt;/span&gt; List&amp;lt;Variant&amp;gt; possibleResponseVariants =
            Variant.mediaTypes(MediaType.APPLICATION_JSON_TYPE,
                               MediaType.APPLICATION_XML_TYPE,
                               MediaType.TEXT_PLAIN_TYPE).languages(Locale.FRENCH, Locale.ENGLISH)
                .add().build();
       Variant bestPossibleResponse = request.selectVariant(possibleResponseVariants);

&lt;span class=&quot;code-comment&quot;&gt;// now based on bestPossibleResponse.getMediaType() and other getters choose the best representation to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; as the response
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(bestPossibleResponse.getMediaType().equals(MediaType.APPLICATION_JSON_TYPE)) {
     &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Response.entity(json).type(MediaType.APPLICATION_JSON_TYPE).build();
&lt;/span&gt;  }
&lt;span class=&quot;code-comment&quot;&gt;// etc.
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Browsing around &lt;a href=&quot;http://httpd.apache.org/docs/2.0/content-negotiation.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://httpd.apache.org/docs/2.0/content-negotiation.html&lt;/a&gt; - the &quot;Apache Negotation Algorithm&quot; on that page seems to be the best algorithm to follow unless someone finds a clearer RFC.&lt;/p&gt;</comment>
                            <comment id="12732993" author="bluk" created="Sun, 19 Jul 2009 11:39:44 +0000"  >&lt;p&gt;BTW, the reason why I asked for agreement before trying to implement this myself is because this is the second time that Request.selectVariant() was implemented the &quot;request representation way&quot; instead of choosing the best response variant.  I just wanted to make sure that there was at least someone that agreed with this change before implementing this somewhat tricky code.&lt;/p&gt;</comment>
                            <comment id="12732996" author="elman" created="Sun, 19 Jul 2009 11:52:22 +0000"  >&lt;p&gt;Well, it seems that the current selectVariant() implementation is incorrect. I don&apos;t think it select best choice and it doesn&apos;t add the VARY header to Response. So it probably needs to be changed. So go ahead &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Btw, I don&apos;t think it&apos;s critical for 0.1&lt;/p&gt;</comment>
                            <comment id="12733113" author="bluk" created="Mon, 20 Jul 2009 03:18:52 +0000"  >&lt;p&gt;Attaching an initial patch.  Will need to clean this up some more but please feel free to review.&lt;/p&gt;</comment>
                            <comment id="12746688" author="bluk" created="Sun, 23 Aug 2009 23:01:30 +0000"  >&lt;p&gt;Updated patch to make it easier to apply.  Please comment if you have any feedback.&lt;/p&gt;</comment>
                            <comment id="12747035" author="hudson" created="Mon, 24 Aug 2009 19:40:37 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #113 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/113/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/113/&lt;/a&gt;)&lt;br/&gt;
    Request#selectVariant use Accept* request headers&lt;/p&gt;

&lt;p&gt;See []&lt;/p&gt;</comment>
                            <comment id="12747088" author="bluk" created="Mon, 24 Aug 2009 21:32:33 +0000"  >&lt;p&gt;Applied patch -2nd&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417422" name="WINK-107-2nd.patch" size="54210" author="bluk" created="Sun, 23 Aug 2009 23:01:30 +0000"/>
                            <attachment id="12413971" name="WINK-107.patch" size="54455" author="bluk" created="Mon, 20 Jul 2009 03:18:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ggrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304311</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>