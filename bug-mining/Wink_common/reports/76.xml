<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-289] URISyntaxException when using &quot;[&quot; brackets in query string</title>
                <link>https://issues.apache.org/jira/browse/WINK-289</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;I am using Wink to query/read several backend services using the Atom Protocol.&lt;br/&gt;
One of those produces farely ugly URLs with &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; and &amp;quot;&amp;#93;&lt;/span&gt;&quot; within the URL strings. &lt;br/&gt;
When reading from a feed these URLs are already escaped like this          &lt;a href=&quot;http://myserver/dm/atom/library/%5B@Pgistest/@RMain.nsf%5D/feed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://myserver/dm/atom/library/%5B@Pgistest/@RMain.nsf%5D/feed&lt;/a&gt; .&lt;br/&gt;
This way I can use them directly to read the next feed:&lt;/p&gt;

&lt;p&gt;URI uri = URI.create(uriString);&lt;br/&gt;
new RestClient().resource(uri);&lt;/p&gt;

&lt;p&gt;At this point everything is fine, but as it continues an exception is thrown &lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: schemeSpecificPart is invalid&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl.schemeSpecificPart(UriBuilderImpl.java:867)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec.CGLIB$schemeSpecificPart$24(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec$$FastClassByCGLIB$$10e694a6.invoke(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at net.sf.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:215)&lt;br/&gt;
	at de.gish.lc.services.wink.RuntimeDelegateImpl$1.intercept(RuntimeDelegateImpl.java:39)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec.schemeSpecificPart(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl.uri(UriBuilderImpl.java:961)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec.CGLIB$uri$0(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec$$FastClassByCGLIB$$10e694a6.invoke(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at net.sf.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:215)&lt;br/&gt;
	at de.gish.lc.services.wink.RuntimeDelegateImpl$1.intercept(RuntimeDelegateImpl.java:39)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl$$EnhancerByCGLIB$$927fbbec.uri(&amp;lt;generated&amp;gt;)&lt;br/&gt;
	at javax.ws.rs.core.UriBuilder.fromUri(UriBuilder.java:81)&lt;br/&gt;
	at org.apache.wink.client.internal.ResourceImpl.&amp;lt;init&amp;gt;(ResourceImpl.java:72)&lt;br/&gt;
	at org.apache.wink.client.RestClient.resource(RestClient.java:99)&lt;br/&gt;
	at de.gish.lc.rest.connection.impl.StaticUserLoginBasedConnectionFactory.getResource(StaticUserLoginBasedConnectionFactory.java:105)&lt;br/&gt;
	at de.gish.lc.services.wink.AbstractWinkService.readAtomFeed(AbstractWinkService.java:175)&lt;br/&gt;
	at de.gish.lc.services.wink.QuickrServiceWink.readFeed(QuickrServiceWink.java:47)&lt;br/&gt;
	at de.gish.lc.services.wink.QuickrServiceWink.readLibraryFeedForEntry(QuickrServiceWink.java:119)&lt;br/&gt;
	at de.gish.lc.services.QuickrServiceTest.readLibraryFeedForEntry(QuickrServiceTest.java:74)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)&lt;br/&gt;
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:82)&lt;br/&gt;
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)&lt;br/&gt;
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:240)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)&lt;br/&gt;
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)&lt;br/&gt;
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)&lt;br/&gt;
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)&lt;br/&gt;
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)&lt;br/&gt;
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)&lt;br/&gt;
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)&lt;br/&gt;
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:180)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:45)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)&lt;br/&gt;
Caused by: java.net.URISyntaxException: Illegal character in path at index 39: &lt;a href=&quot;https://quickr.gish.de/dm/atom/library/[@Pgistest/@RMain.nsf]/feed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://quickr.gish.de/dm/atom/library/[@Pgistest/@RMain.nsf]/feed&lt;/a&gt;&lt;br/&gt;
	at java.net.URI$Parser.fail(URI.java:2809)&lt;br/&gt;
	at java.net.URI$Parser.checkChars(URI.java:2982)&lt;br/&gt;
	at java.net.URI$Parser.parseHierarchical(URI.java:3066)&lt;br/&gt;
	at java.net.URI$Parser.parse(URI.java:3014)&lt;br/&gt;
	at java.net.URI.&amp;lt;init&amp;gt;(URI.java:807)&lt;br/&gt;
	at org.apache.wink.common.internal.UriBuilderImpl.schemeSpecificPart(UriBuilderImpl.java:865)&lt;br/&gt;
	... 48 more&lt;/p&gt;

&lt;p&gt;This looks like it is out of the   public UriBuilder schemeSpecificPart(String ssp) throws IllegalArgumentException &lt;/p&gt;
{...}
&lt;p&gt;but as I investigated further the &quot;ssp&quot; String now is   &quot;//myserver/dm/atom/library/&lt;span class=&quot;error&quot;&gt;&amp;#91;@Pgistest/@RMain.nsf&amp;#93;&lt;/span&gt;/feed&quot;&lt;br/&gt;
which means that the brackts (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; and &amp;quot;&amp;#93;&lt;/span&gt;&quot;) are not escaped any more.&lt;br/&gt;
The call comes from    &lt;br/&gt;
public UriBuilder uri(URI uri) throws IllegalArgumentException {&lt;br/&gt;
 ....&lt;/p&gt;

&lt;p&gt;	if (uri.getSchemeSpecificPart() != null) &lt;/p&gt;
{
            logger.debug(&quot;Constructing schemeSpecificPart&quot;); 
            schemeSpecificPart(uri.getSchemeSpecificPart());
        }
&lt;p&gt; ....&lt;br/&gt;
}&lt;br/&gt;
The URI object I created at the beginning with the escape characters for the brackets now returns an unescaped URI string as result of uri.getSchemeSpecificPart().&lt;br/&gt;
As this is used as a direct input for constructing a new URI object within this part of the UriBuilderImpl this leads to an IllegalArgumentException.&lt;/p&gt;


&lt;p&gt;    public UriBuilder schemeSpecificPart(String ssp) throws IllegalArgumentException {&lt;br/&gt;
        ...&lt;/p&gt;

&lt;p&gt;        URI uri = null;&lt;br/&gt;
        try &lt;/p&gt;
{
            // uri templates will be automatically encoded
            uri = new URI(scheme, ssp, fragment);
        }
&lt;p&gt; catch (URISyntaxException e) &lt;/p&gt;
{
            throw new IllegalArgumentException(&quot;schemeSpecificPart is invalid&quot;, e);
        }
&lt;p&gt;       	....&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;This leads to the conclusion that URIs with special characters like brackets are currently not supported as (feed) urls.&lt;/p&gt;

&lt;p&gt;My current workaround is to use a proxy for the UriBuilderImpl class which catches the Exception and will than encode the part of the URI again before use.&lt;/p&gt;

&lt;p&gt;	Enhancer e = new Enhancer();&lt;br/&gt;
        e.setSuperclass(originalBuilder.getClass());&lt;br/&gt;
        e.setCallback(new MethodInterceptor() {&lt;br/&gt;
            public Object intercept(Object obj, java.lang.reflect.Method method, Object[] args, MethodProxy proxy) throws Throwable {&lt;/p&gt;

&lt;p&gt;                Object result;&lt;br/&gt;
                if (&quot;schemeSpecificPart&quot;.equals(method.getName())) {&lt;br/&gt;
                    try &lt;/p&gt;
{
                        result = proxy.invokeSuper(obj, args);
                    }
&lt;p&gt; catch (IllegalArgumentException iae) {&lt;br/&gt;
                        String ssp = (String) args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                        String encoded = UriUtils.encodeUri(ssp, &quot;UTF-8&quot;);&lt;br/&gt;
                        LOG.debug(&quot;in &lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt;, out &lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt;&quot;, new Object[]&lt;/p&gt;
{ssp, encoded }
&lt;p&gt;);&lt;br/&gt;
                        // set encoded value:&lt;br/&gt;
                        result = proxy.invokeSuper(obj, new Object[]&lt;/p&gt;
{encoded }
&lt;p&gt;);&lt;br/&gt;
                    }&lt;/p&gt;

&lt;p&gt;                } else &lt;/p&gt;
{
                    // do normal execution
                    result = proxy.invokeSuper(obj, args);
                }
&lt;p&gt;                return result;&lt;br/&gt;
            }&lt;br/&gt;
        });&lt;/p&gt;

&lt;p&gt; As we are using the Spring framework I used the UriUtils from Spring to escape the URI string again.&lt;br/&gt;
 As this is just a workaround not a solution, I hope for a fix within Wink to handle this.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Java 5, Spring, Rest Client to access ATOM based Rest Services&lt;/p&gt;</environment>
        <key id="12465831">WINK-289</key>
            <summary>URISyntaxException when using &quot;[&quot; brackets in query string</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jramos">Jesse A. Ramos</assignee>
                                    <reporter username="imarahrens">Ingo Marahrens</reporter>
                        <labels>
                            <label>URI</label>
                            <label>invalid</label>
                            <label>schemeSpecificPart</label>
                    </labels>
                <created>Tue, 1 Jun 2010 06:40:04 +0000</created>
                <updated>Sat, 13 Jul 2013 20:13:16 +0000</updated>
                            <resolved>Mon, 7 Jun 2010 00:42:08 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.1.1</fixVersion>
                                    <component>Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12874129" author="jramos" created="Tue, 1 Jun 2010 18:06:33 +0000"  >&lt;p&gt;When getting the information from the URI we&apos;re calling URI.getSchemeSpecificPart() when we should be using getRawSchemeSpecificPart().&lt;/p&gt;

&lt;p&gt;When switching over to use the correct method call, I ran into another issue in our code where URI.getAuthority() has a value but getHost() does not.  We check to see if getHost() is null before setting the host but don&apos;t check getAuthority() resulting in part of the URI being lost.&lt;/p&gt;

&lt;p&gt;Checking in a fix for both issues.&lt;/p&gt;</comment>
                            <comment id="12874143" author="hudson" created="Tue, 1 Jun 2010 18:37:55 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #340 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/340/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/340/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/WINK-289&quot; title=&quot;URISyntaxException when using &amp;quot;[&amp;quot; brackets in query string&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WINK-289&quot;&gt;&lt;del&gt;WINK-289&lt;/del&gt;&lt;/a&gt; Use URI.getRawSchemeSpecificPart() when getting informatin from a URI&lt;/p&gt;</comment>
                            <comment id="12876100" author="bluk" created="Mon, 7 Jun 2010 00:42:08 +0000"  >&lt;p&gt;I think this is fixed now so marking it Resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1gien:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>