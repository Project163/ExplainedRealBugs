<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-243] Unable to inject fields once ResourceInstance is initialized</title>
                <link>https://issues.apache.org/jira/browse/WINK-243</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;Unable to inject fields once ResourceInstance is initialized. &lt;/p&gt;

&lt;p&gt;I get a handle to the the resource instance which is about to be invoked using UriInfo.getMatchedResources,  which will initialize a new ResourceInstance using ObjectFactory which would in-turn inject all fields/methods to the resource instance and the resource instance is returned back. After this process any sort of field injection to the context is not getting reflected in the resource instance. This is because in ResourceInstance.getInstanceMethod,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ResourceInstance.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getInstance(RuntimeContext context) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (instance != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
        }
        instance = record.getObjectFactory().getInstance(context);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
    }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;As we see if the instance is not null the instance is returned as it is.&lt;/p&gt;

&lt;p&gt;A probable fix could be to call wink common&apos;s CreationUtils.injectFields() to re-inject the fields which would inject any field that was set to the context after the resource class was initialized. The code above would look like,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ResourceInstance.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getInstance(RuntimeContext context) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (instance != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			CreationUtils.injectFields(instance, record.getMetadata(), context);
		}  &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ObjectCreationException(e);
		}
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
        }
        instance = record.getObjectFactory().getInstance(context);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
    }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;However this would re-inject fields that was already injected to the instance before while creation of the instance. If that can be lived with, this could possibly be a patch for this bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Wink 1.0 / JRE 1.6&lt;/p&gt;</environment>
        <key id="12445766">WINK-243</key>
            <summary>Unable to inject fields once ResourceInstance is initialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bluk">Bryant Luk</assignee>
                                    <reporter username="bharath_c_m">bharath chinnadurai</reporter>
                        <labels>
                    </labels>
                <created>Sun, 17 Jan 2010 13:57:16 +0000</created>
                <updated>Sat, 13 Jul 2013 20:13:22 +0000</updated>
                            <resolved>Thu, 28 Jan 2010 04:57:31 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12801483" author="bluk" created="Sun, 17 Jan 2010 19:22:03 +0000"  >&lt;p&gt;So if I&apos;m understanding correctly, this is the order of operations:&lt;/p&gt;

&lt;p&gt;1.  Resource class is instantiated.&lt;br/&gt;
2.  Resource object is injected but there are a few context objects that aren&apos;t available yet (so those fields are set to null)&lt;br/&gt;
3.  The context is then later changed by something to add a few context objects (i.e. a user handler or something)&lt;br/&gt;
4.  Your expectation is that the resource instance should have the new context objects injected (basically going back and re-injecting them)&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should re-inject the ResourceInstance again.  There are a lot of complications with that such as performance and users changing the fields/properties themselves in the resource method and expecting that their changes to be permanent (i.e. we inject an object to a @Context UriInfo field and a user could change that field&apos;s value in the resource method to their custom UriInfo that delegates calls back to the injected UriInfo;  very odd yes, but this has happened).&lt;/p&gt;

&lt;p&gt;However, my suggestion is to inject a proxy instead.  The change I believe should be relatively simple.&lt;/p&gt;

&lt;p&gt;In wink-common&apos;s org.apache.wink.common.internal.registry.ContextAccessor at around line 72:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; context directly
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (runtimeContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; runtimeContext.getAttribute(contextClass);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; context directly
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (runtimeContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                T instance = runtimeContext.getAttribute(contextClass);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (instance != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
                }
                /*
                 * &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the instance isn&apos;t directly available from the
                 * runtimecontext at &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time, inject a proxy instead. This
                 * allows context attributes to be added after a &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;is
                 * instantiated
                 */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So if the context attribute isn&apos;t available yet, let the method continue (there&apos;s a block of code already below that would inject a proxy).  If anyone has any comments, please let me know.&lt;/p&gt;</comment>
                            <comment id="12801484" author="bluk" created="Sun, 17 Jan 2010 19:24:01 +0000"  >&lt;p&gt;Attaching patch.  Let me know if this works out.&lt;/p&gt;</comment>
                            <comment id="12803161" author="bharath_c_m" created="Thu, 21 Jan 2010 03:52:17 +0000"  >&lt;p&gt;Hi Bryant,&lt;br/&gt;
Apologies for my delayed reply.&lt;/p&gt;

&lt;p&gt;I tested your patch and it worked fine as expected. &lt;/p&gt;

&lt;p&gt;As per your fix, The actual instance of the interface type is injected if the resource is not initialized and a proxy instance is injected if the resource is already initialized.  &lt;/p&gt;

&lt;p&gt;I see an inconsistency here. For discussion purpose, lets take the below  two cases.&lt;/p&gt;

&lt;p&gt;Case 1: Field injected before resource initialization - Actual instance of the field is injected&lt;br/&gt;
Case 2: Field injected after resource initialization - Proxy instance of the field is injected&lt;/p&gt;

&lt;p&gt;In case 1,  i would be able to type cast the injected field to its actual type&lt;br/&gt;
In case 2, i would get a ClassCastException if attempted to type cast.&lt;/p&gt;

&lt;p&gt;Can this be avoided some how?&lt;/p&gt;</comment>
                            <comment id="12803172" author="bluk" created="Thu, 21 Jan 2010 04:59:09 +0000"  >&lt;p&gt;I don&apos;t think there&apos;s a strict guarantee that the type we inject into a @Context type will be the same exact object that&apos;s set on the message context.  Proxies are already injected during some lifecycles (i.e. singletons) so we only have to inject a singleton once yet it still remains thread safe.  Personally, I would be cautious of type casting any injected instance regardless if it&apos;s in JAX-RS or a general injection framework.&lt;/p&gt;

&lt;p&gt;However, if you really want the real object set on the message context, after applying the patch, I believe you could add a user handler to inject the RuntimeContext itself like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void handleRequest(MessageContext context, HandlersChain chain) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
        context.setAttribute(RuntimeContext.class, context);
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you could call:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Resource {
  @Context
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RuntimeContext runtimeContext;

  @GET
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getHelloWorld() {
     MySubType m = (MySubType)runtimeContext.getAttribute(MyType.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MySubType());
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;assuming MySubType is a child class of MyType.&lt;/p&gt;</comment>
                            <comment id="12804200" author="bharath_c_m" created="Sun, 24 Jan 2010 04:53:06 +0000"  >&lt;p&gt;I tested the fix and is working fine. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12805751" author="hudson" created="Thu, 28 Jan 2010 02:16:26 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #255 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/255/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/255/&lt;/a&gt;)&lt;br/&gt;
    Inject proxies for context objects if object not available&lt;/p&gt;

&lt;p&gt;Thanks to bharath chinnadurai for reporting the&lt;br/&gt;
issue.&lt;/p&gt;

&lt;p&gt;See []&lt;/p&gt;</comment>
                            <comment id="12805903" author="hudson" created="Thu, 28 Jan 2010 12:50:31 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5-itests #93 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5-itests/93/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5-itests/93/&lt;/a&gt;)&lt;br/&gt;
    Inject proxies for context objects if object not available&lt;/p&gt;

&lt;p&gt;Thanks to bharath chinnadurai for reporting the&lt;br/&gt;
issue.&lt;/p&gt;

&lt;p&gt;See []&lt;/p&gt;</comment>
                            <comment id="12828119" author="hudson" created="Mon, 1 Feb 2010 14:29:41 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.6-itests #98 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.6-itests/98/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.6-itests/98/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12430572" name="WINK-243.patch" size="5398" author="bluk" created="Sun, 17 Jan 2010 19:24:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204712</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1gi1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>