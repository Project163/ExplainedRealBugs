<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-187] org.apache.wink.common.internal.utils.FileLoader is not able to open a stream to existing File.</title>
                <link>https://issues.apache.org/jira/browse/WINK-187</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;It seems like the org.apache.wink.common.internal.utils.FileLoader is trying to locate the META-INF/wink-default.properties file using an OSGi class loader.&lt;/p&gt;

&lt;p&gt;This is the exception that is being produced:&lt;/p&gt;

&lt;p&gt;31 &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpServer : 0&amp;#93;&lt;/span&gt; ERROR org.apache.wink.common.internal.utils.FileLoader - No bundle ID found: bundleresource:////300/META-INF/wink-default.properties&lt;br/&gt;
java.io.IOException: No bundle ID found: bundleresource:////300/META-INF/wink-default.properties&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleResourceHandler.openConnection(BundleResourceHandler.java:137)&lt;br/&gt;
	at java.net.URL.openConnection(URL.java:945)&lt;br/&gt;
	at java.net.URL.openStream(URL.java:1009)&lt;br/&gt;
	at org.apache.wink.common.internal.utils.FileLoader.loadFileAsStream(FileLoader.java:97)&lt;br/&gt;
	at org.apache.wink.server.internal.utils.ServletFileLoader.loadFileAsStream(ServletFileLoader.java:50)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.loadProperties(RestServlet.java:166)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.getProperties(RestServlet.java:125)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.getDeploymentConfiguration(RestServlet.java:119)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.createRequestProcessor(RestServlet.java:108)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.init(RestServlet.java:85)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:110)&lt;br/&gt;
	at javax.servlet.GenericServlet.init(GenericServlet.java:211)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:99)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.init(ServletWrapper.java:185)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:341)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:86)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:102)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:3124)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.webapp.BundleWebApp.handleRequest(BundleWebApp.java:451)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:235)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.VirtualHost.handleRequest(VirtualHost.java:96)&lt;br/&gt;
	at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:811)&lt;br/&gt;
	at com.ibm.ws.webcontainer.http.HttpConnection.handleRequest(HttpConnection.java:41)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.readAndHandleRequest(HttpConnection.java:464)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.run(HttpConnection.java:355)&lt;br/&gt;
	at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1498)&lt;/p&gt;

&lt;p&gt;46 &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpServer : 0&amp;#93;&lt;/span&gt; ERROR org.apache.wink.server.internal.servlet.RestServlet - META-INF/wink-default.properties&lt;br/&gt;
java.io.FileNotFoundException: META-INF/wink-default.properties&lt;br/&gt;
	at org.apache.wink.common.internal.utils.FileLoader.loadFileAsStream(FileLoader.java:100)&lt;br/&gt;
	at org.apache.wink.server.internal.utils.ServletFileLoader.loadFileAsStream(ServletFileLoader.java:50)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.loadProperties(RestServlet.java:166)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.getProperties(RestServlet.java:125)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.getDeploymentConfiguration(RestServlet.java:119)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.createRequestProcessor(RestServlet.java:108)&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.init(RestServlet.java:85)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:110)&lt;br/&gt;
	at javax.servlet.GenericServlet.init(GenericServlet.java:211)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:99)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.init(ServletWrapper.java:185)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:341)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:86)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:102)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:3124)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.webapp.BundleWebApp.handleRequest(BundleWebApp.java:451)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:235)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.VirtualHost.handleRequest(VirtualHost.java:96)&lt;br/&gt;
	at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:811)&lt;br/&gt;
	at com.ibm.ws.webcontainer.http.HttpConnection.handleRequest(HttpConnection.java:41)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.readAndHandleRequest(HttpConnection.java:464)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.run(HttpConnection.java:355)&lt;br/&gt;
	at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1498)&lt;/p&gt;

&lt;p&gt;Exception occured in com.ibm.ws.webcontainer.servlet.ServletInstance.service&lt;br/&gt;
javax.servlet.UnavailableException: META-INF/wink-default.properties&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.init(RestServlet.java:95)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:110)&lt;br/&gt;
	at javax.servlet.GenericServlet.init(GenericServlet.java:211)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:99)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.init(ServletWrapper.java:185)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:341)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:86)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:102)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:3124)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.webapp.BundleWebApp.handleRequest(BundleWebApp.java:451)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:235)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.VirtualHost.handleRequest(VirtualHost.java:96)&lt;br/&gt;
	at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:811)&lt;br/&gt;
	at com.ibm.ws.webcontainer.http.HttpConnection.handleRequest(HttpConnection.java:41)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.readAndHandleRequest(HttpConnection.java:464)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.run(HttpConnection.java:355)&lt;br/&gt;
	at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1498)&lt;/p&gt;

&lt;p&gt;Exception occured in com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest()&lt;br/&gt;
javax.servlet.UnavailableException: META-INF/wink-default.properties&lt;br/&gt;
	at org.apache.wink.server.internal.servlet.RestServlet.init(RestServlet.java:95)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:110)&lt;br/&gt;
	at javax.servlet.GenericServlet.init(GenericServlet.java:211)&lt;br/&gt;
	at com.ibm.di.tp.server.servlet.EntryPointServlet.init(EntryPointServlet.java:99)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.init(ServletWrapper.java:185)&lt;br/&gt;
	at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:341)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:86)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:102)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:3124)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.webapp.BundleWebApp.handleRequest(BundleWebApp.java:451)&lt;br/&gt;
	at com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:235)&lt;br/&gt;
	at com.ibm.pvc.internal.webcontainer.VirtualHost.handleRequest(VirtualHost.java:96)&lt;br/&gt;
	at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:811)&lt;br/&gt;
	at com.ibm.ws.webcontainer.http.HttpConnection.handleRequest(HttpConnection.java:41)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.readAndHandleRequest(HttpConnection.java:464)&lt;br/&gt;
	at com.ibm.ws.http.HttpConnection.run(HttpConnection.java:355)&lt;br/&gt;
	at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1498)&lt;/p&gt;

&lt;p&gt;Here is a possible fix you might want to consider for  the org.apache.wink.common.internal.utils.FileLoader class:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
 * &amp;lt;p&amp;gt;
 * loads file
 * &amp;lt;p&amp;gt;
 * first searches &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file in file system
 * &amp;lt;p&amp;gt;
 * &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not found, searchs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file using classloaders
 * 
 * @param fileName
 * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; URISyntaxException
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream loadFileAsStream(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException {

	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fileName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || fileName.trim().equals(&quot;&quot;)) {
		&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NullPointerException(&lt;span class=&quot;code-quote&quot;&gt;&quot;fileName&quot;&lt;/span&gt;);
	}

	logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} in file system.&quot;&lt;/span&gt;, fileName);

	File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileName);
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isFile()) {
		&lt;span class=&quot;code-comment&quot;&gt;// since file is a normal file, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; it
&lt;/span&gt;		logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;File {} found in file system.&quot;&lt;/span&gt;, fileName);
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file);
	}

	&lt;span class=&quot;code-comment&quot;&gt;// before using URLs &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to open it as stream provided by the
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;// classloaders first.
&lt;/span&gt;	InputStream result = openResourceUsingClassLoaders(fileName);

	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
		&lt;span class=&quot;code-comment&quot;&gt;// file is not a normal file, &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to find it using classloaders
&lt;/span&gt;		URL url = loadFileUsingClassLoaders(fileName);
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			&lt;span class=&quot;code-comment&quot;&gt;// decode any escaped sequences such as &amp;lt;space&amp;gt; which is %20 in
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// URL
&lt;/span&gt;			URI uri = url.toURI();
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = uri.getSchemeSpecificPart();
			url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(url.getProtocol(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, path);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
			logger.error(e.getMessage(), e);
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(fileName);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; nothing, but &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the real (!) url
&lt;/span&gt;		}

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			result = url.openStream();
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
			logger.error(e.getMessage(), e);
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(fileName);
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
}

/**
 * open the specified resource using &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loaders
 * 
 * @param filename
 *            the name of the resource
 * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the resource as {@link InputStream} &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; found
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException
 *             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the resource was not found
 */
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream openResourceUsingClassLoaders(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException {
	logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using thread context classloader.&quot;&lt;/span&gt;, filename);
	&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getContextClassLoader();
	InputStream is = openResourceUsingClassLoader(classLoader, filename);

	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
		logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using current classloader.&quot;&lt;/span&gt;, filename);

		classLoader = FileLoader.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader();
		is = openResourceUsingClassLoader(classLoader, filename);

		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
			logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using system classloader.&quot;&lt;/span&gt;, filename);
			is = &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.getSystemResourceAsStream(filename);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
				&lt;span class=&quot;code-comment&quot;&gt;// well, the last attempt has failed! &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;
&lt;/span&gt;				&lt;span class=&quot;code-comment&quot;&gt;// FileNotFoundException
&lt;/span&gt;				logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to open resource using classloaders&quot;&lt;/span&gt;);
				&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(filename);
			}
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; is;
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream openResourceUsingClassLoader(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename) {
	InputStream is = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (classLoader != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
		is = classLoader.getResourceAsStream(filename);
	}
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; is;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;IBM Lotus Expeditor&apos;s  Web Container - LWI. It is loaded in Equinox OSGi framework.&lt;/p&gt;</environment>
        <key id="12435823">WINK-187</key>
            <summary>org.apache.wink.common.internal.utils.FileLoader is not able to open a stream to existing File.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bluk">Bryant Luk</assignee>
                                    <reporter username="kkolev">Kaloyan Kolev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2009 13:04:59 +0000</created>
                <updated>Sat, 13 Jul 2013 20:13:15 +0000</updated>
                            <resolved>Thu, 17 Sep 2009 01:01:37 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.0</fixVersion>
                                    <component>Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12756023" author="elman" created="Wed, 16 Sep 2009 13:21:18 +0000"  >&lt;p&gt;added {code} tag surrounding the proposed patch.&lt;/p&gt;</comment>
                            <comment id="12756032" author="elman" created="Wed, 16 Sep 2009 13:43:58 +0000"  >&lt;p&gt;I&apos;m not really familiar with Equinox, but as far as I understand Equinox blocks some JDK functionality and your proposed patch is a workaround.&lt;br/&gt;
I see at least one problem with your patch: it cannot be used to load multiple resources with the same name, and actually today I enhanced FileLoader with this ability. See &lt;a href=&quot;https://issues.apache.org/jira/browse/WINK-181&quot; title=&quot;Autoregistration of external providers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WINK-181&quot;&gt;&lt;del&gt;WINK-181&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pay attention that Wink first uses the classloader from the Thread.currentThread().getContextClassLoader(). This was done to allow changing the classloader by the external code.&lt;br/&gt;
Can it be a solution for you?&lt;/p&gt;</comment>
                            <comment id="12756046" author="kkolev" created="Wed, 16 Sep 2009 14:21:47 +0000"  >&lt;p&gt;The problem is not related to OSGi, but to the way we mangle the URI identifier. Here is the problematic code in method :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream loadFileAsStream(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException {
...

&lt;span class=&quot;code-comment&quot;&gt;// decode any escaped sequences such as &amp;lt;space&amp;gt; which is %20 in
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// URL
&lt;/span&gt;URI uri = url.toURI();
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = uri.getSchemeSpecificPart();
url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(url.getProtocol(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, path);
...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see the schema-specific-part is treated as a regular path which it is not. This violates the URI specification. For more details please refer to the URI specification here &lt;a href=&quot;http://www.ietf.org/rfc/rfc2396.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ietf.org/rfc/rfc2396.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My suggestion is simply to avoid dealing with URLs when that is not required. At this point the external code has requested an InputStream object and since we have an API for accessing that through the classloaders we could return that directly. My suggestion also considers the context classloader set on the thread. As you can see in the bellow code you have the same functionality as before but this way you do one step less to get the same result.&lt;/p&gt;

&lt;p&gt;These are new methods that need to be added:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
 * open the specified resource using &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loaders
 * 
 * @param filename
 *            the name of the resource
 * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the resource as {@link InputStream} &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; found
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException
 *             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the resource was not found
 */
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream openResourceUsingClassLoaders(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException {
	logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using thread context classloader.&quot;&lt;/span&gt;, filename);
	&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getContextClassLoader();
	InputStream is = openResourceUsingClassLoader(classLoader, filename);

	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
		logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using current classloader.&quot;&lt;/span&gt;, filename);

		classLoader = FileLoader.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader();
		is = openResourceUsingClassLoader(classLoader, filename);

		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
			logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Searching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} using system classloader.&quot;&lt;/span&gt;, filename);
			is = &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.getSystemResourceAsStream(filename);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
				&lt;span class=&quot;code-comment&quot;&gt;// well, the last attempt has failed! &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;
&lt;/span&gt;				&lt;span class=&quot;code-comment&quot;&gt;// FileNotFoundException
&lt;/span&gt;				logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to open resource using classloaders&quot;&lt;/span&gt;);
				&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(filename);
			}
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; is;
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InputStream openResourceUsingClassLoader(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename) {
	InputStream is = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (classLoader != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
		is = classLoader.getResourceAsStream(filename);
	}
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; is;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12756064" author="elman" created="Wed, 16 Sep 2009 14:49:36 +0000"  >&lt;p&gt;Hmmm, I&apos;m not sure why &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;URI uri = url.toURI();
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = uri.getSchemeSpecificPart();
url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(url.getProtocol(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, path);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;was added...&lt;/p&gt;

&lt;p&gt;Regarding doing &quot;one step less&quot;:&lt;br/&gt;
this is code of getResourceAsStream in SUN&apos;s JDK:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; InputStream getResourceAsStream(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
	URL url = getResource(name);
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
	    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; url != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? url.openStream() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
	    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	}
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so it&apos;s exactly same steps.&lt;br/&gt;
May be we can remove the escaping section, so it should work for you.&lt;br/&gt;
Did you try this?&lt;/p&gt;</comment>
                            <comment id="12756067" author="kkolev" created="Wed, 16 Sep 2009 14:54:24 +0000"  >&lt;p&gt;I removed the following code from the original version and the files were successfully found and opened.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			&lt;span class=&quot;code-comment&quot;&gt;// decode any escaped sequences such as &amp;lt;space&amp;gt; which is %20 in
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// URL
&lt;/span&gt;			URI uri = url.toURI();
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = uri.getSchemeSpecificPart();
			url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(url.getProtocol(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, path);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
			logger.error(e.getMessage(), e);
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(fileName);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; nothing, but &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the real (!) url
&lt;/span&gt;		}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12756086" author="bluk" created="Wed, 16 Sep 2009 15:41:13 +0000"  >&lt;p&gt;I&apos;ll go ahead and remove the specified section of the code for now.&lt;/p&gt;</comment>
                            <comment id="12756128" author="hudson" created="Wed, 16 Sep 2009 17:41:41 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #159 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/159/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/159/&lt;/a&gt;)&lt;br/&gt;
    Removed decoding from file loading&lt;/p&gt;

&lt;p&gt;Thanks Kaloyan Kolev for reporting the issue.&lt;/p&gt;

&lt;p&gt;See []&lt;/p&gt;</comment>
                            <comment id="12756309" author="bluk" created="Thu, 17 Sep 2009 01:01:37 +0000"  >&lt;p&gt;Removed the marked code.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15tpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242112</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>