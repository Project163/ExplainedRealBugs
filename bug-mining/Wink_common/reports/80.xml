<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-286] GET methods fail to serve requests without Content-Type if the class/interface has @Consumes</title>
                <link>https://issues.apache.org/jira/browse/WINK-286</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;When the JAX-RS resource (the method with @GET) is accessed from a web browser, the Content-Type is not set and it&apos;s default to application/octet-stream. Wink fails to match to the method as it inherits @Consumes (say, application/json) from the class/interface and it is not compatible with application/octet-stream. For example:&lt;/p&gt;

&lt;p&gt;@Produces(MediaType.APPLICATION_JSON)&lt;br/&gt;
@Consumes(MediaType.APPLICATION_JSON)&lt;br/&gt;
public interface Catalog {&lt;br/&gt;
   @GET&lt;br/&gt;
   List&amp;lt;Item&amp;gt; get();&lt;/p&gt;

&lt;p&gt;   @GET&lt;br/&gt;
   @Path(&quot;&lt;/p&gt;
{id}
&lt;p&gt;&quot;)&lt;br/&gt;
   Item get(@PathParam(&quot;id&quot;) String id);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The GET method doesn&apos;t have the request entity. Why do we need to compare the media type for the request? I assume we should only check the methods that take the HTTP body. &lt;/p&gt;

&lt;p&gt;I had to work around this issue for Tuscany to add &lt;b&gt;/&lt;/b&gt; or application/octet-stream to the GET method&apos;s consumes set. It&apos;s ugly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;    private synchronized void fixMediaTypes(DeploymentConfiguration config) {&lt;br/&gt;
        if (fixed) &lt;/p&gt;
{
            return;
        }
&lt;p&gt;        // FIXME: A hacky workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/TUSCANY-3572&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TUSCANY-3572&lt;/a&gt;&lt;br/&gt;
        ResourceRecord record = config.getResourceRegistry().getRecord(resourceClass);&lt;/p&gt;

&lt;p&gt;        for (MethodMetadata methodMetadata : record.getMetadata().getResourceMethods()) {&lt;br/&gt;
            String method = methodMetadata.getHttpMethod();&lt;br/&gt;
            if (HttpMethod.GET.equals(method) || HttpMethod.HEAD.equals(method) || HttpMethod.DELETE.equals(method)) &lt;/p&gt;
{
                methodMetadata.addConsumes(MediaType.APPLICATION_OCTET_STREAM_TYPE);
                methodMetadata.addConsumes(MediaType.WILDCARD_TYPE);
            }&lt;br/&gt;
            if (HttpMethod.HEAD.equals(method) || HttpMethod.DELETE.equals(method)) {
                methodMetadata.addProduces(MediaType.APPLICATION_OCTET_STREAM_TYPE);
                methodMetadata.addConsumes(MediaType.WILDCARD_TYPE);
            }&lt;br/&gt;
        }&lt;br/&gt;
        for (MethodMetadata methodMetadata : record.getMetadata().getSubResourceMethods()) {&lt;br/&gt;
            String method = methodMetadata.getHttpMethod();&lt;br/&gt;
            if (HttpMethod.GET.equals(method) || HttpMethod.HEAD.equals(method) || HttpMethod.DELETE.equals(method)) {                methodMetadata.addConsumes(MediaType.APPLICATION_OCTET_STREAM_TYPE);                methodMetadata.addConsumes(MediaType.WILDCARD_TYPE);            }
&lt;p&gt;            if (HttpMethod.HEAD.equals(method) || HttpMethod.DELETE.equals(method)) &lt;/p&gt;
{
                methodMetadata.addProduces(MediaType.APPLICATION_OCTET_STREAM_TYPE);
                methodMetadata.addConsumes(MediaType.WILDCARD_TYPE);
            }
&lt;p&gt;        }&lt;br/&gt;
        fixed = true;&lt;br/&gt;
    }&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12465617">WINK-286</key>
            <summary>GET methods fail to serve requests without Content-Type if the class/interface has @Consumes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bluk">Bryant Luk</assignee>
                                    <reporter username="rfeng">Zhaohui Feng</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 May 2010 05:18:29 +0000</created>
                <updated>Sat, 13 Jul 2013 20:13:16 +0000</updated>
                            <resolved>Thu, 9 Sep 2010 22:45:01 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.1.2</fixVersion>
                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12872940" author="bluk" created="Fri, 28 May 2010 11:45:56 +0000"  >&lt;p&gt;1)  To fix this immediately, do you have to have a @Consumes on the interface or can you add it only to the @POST/@PUT methods that you need it on?&lt;/p&gt;

&lt;p&gt;2)  I think we can make it as an optional configuration to fix your case.  I think only the following runtime code must be changed in wink-server/org.apache.wink.server.internal.registry.ResourceRegistry:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Checks &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method record matches the media type of the input entity
     * 
     * @param record the method record to check
     * @param context the context of the current request
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method should be filtered, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; otherwise
     */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filterByConsumes(MethodRecord record, RuntimeContext context) {
        Set&amp;lt;MediaType&amp;gt; consumedMimes = record.getMetadata().getConsumes();
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not specified, then treat as &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; consumes */*
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (consumedMimes.size() == 0) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        MediaType inputMediaType = context.getHttpHeaders().getMediaType();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inputMediaType == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-comment&quot;&gt;// FIX HERE: change here to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; to not filter out the method
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//            inputMediaType = MediaType.APPLICATION_OCTET_STREAM_TYPE;
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MediaType mediaType : consumedMimes) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mediaType.isCompatible(inputMediaType)) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you see if that fixes your issue?&lt;/p&gt;

&lt;p&gt;The reason why I think it should be configurable is because this will change the behavior when determining which class or method is used for existing applications.&lt;/p&gt;

&lt;p&gt;BTW, I think the Wink code as written follows a strict interpretation of the JAX-RS spec (section 3.7.2 step 3a, bullet 2) in comparing the @Consumes media type to the incoming request entity body media type.  The @Consumes annotation indicates what media types of incoming requests are really acceptable (so you expect a message body that you can consume).  If the incoming HTTP request does not have an incoming Media Type (so by HTTP 1.1 spec 7.2.1 and the change in JAX-RS 1.1 for 4.2.1), we&apos;ll assume that it&apos;s an incoming &quot;application/octet-stream&quot; and then do the compatibility check.&lt;/p&gt;</comment>
                            <comment id="12873215" author="rfeng" created="Sat, 29 May 2010 01:36:05 +0000"  >&lt;p&gt;Well, I think the problem is not that Wink sets the content-type to &quot;&quot;application/octet-stream&quot;. I agree it&apos;s the correct behavior per JAX-RS 1.1 spec.&lt;/p&gt;

&lt;p&gt;My understanding is as follows:&lt;/p&gt;

&lt;p&gt;1. For a method that doesn&apos;t expect an entity body, the consumes filtering should be skipped. For example,&lt;/p&gt;

&lt;p&gt;@GET&lt;br/&gt;
String get(); // No input arg&lt;/p&gt;

&lt;p&gt;@GET&lt;br/&gt;
String getById(@QueryParam(&quot;id&quot;) String id); // The only input arg is from the query parameter&lt;/p&gt;

&lt;p&gt;2. For a method that doesn&apos;t produce an entity body, the produces filtering should be skipped. For example,&lt;/p&gt;

&lt;p&gt;@DELETE&lt;br/&gt;
void delete(String id);&lt;/p&gt;</comment>
                            <comment id="12873428" author="bluk" created="Sun, 30 May 2010 13:45:00 +0000"  >&lt;p&gt;For 1) and 2), it is possible (albeit in extreme cases), for users to still read/write entities by including a @Context HttpServletRequest/Response and directly manipulating the streams and therefore read/write entities.&lt;/p&gt;

&lt;p&gt;I really think that the @Consumes/@Produces should be carefully added if you really intend to consume/produce certain types with the class/method.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to code up something later that will do what you want but I don&apos;t think we should enable it by default.  Again, mainly because I would count on this behavior to be consistent with past releases since it&apos;s a subtle but substantial change.&lt;/p&gt;</comment>
                            <comment id="12891638" author="rott" created="Fri, 23 Jul 2010 15:29:07 +0000"  >&lt;p&gt;Even though the workaround is &quot;ugly&quot;, there is still a workaround.  In the interest of keeping Wink as simple as possible, avoiding the risk of breaking past releases, etc, can we keep current behavior and simply document this situation and its workaround?  Would that be satisfactory?&lt;/p&gt;</comment>
                            <comment id="12891780" author="rfeng" created="Fri, 23 Jul 2010 20:41:44 +0000"  >&lt;p&gt;This seems to require some clarifications from the JAX-RS spec guys &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="12891781" author="rfeng" created="Fri, 23 Jul 2010 20:42:45 +0000"  >&lt;p&gt;We should probably also check how other JAX-RS runtimes behave for this test case.&lt;/p&gt;</comment>
                            <comment id="12907809" author="bluk" created="Thu, 9 Sep 2010 22:45:01 +0000"  >&lt;p&gt;I went ahead and changed the default behavior for the &quot;smarter&quot; behavior.  If you change the wink-default.properties value, then it will revert to the old behavior.  In this case, instead of changing too many method signatures, I just faked a wildcard media type for Consumes/Produces in &quot;smart&quot; cases.&lt;/p&gt;

&lt;p&gt;I didn&apos;t run CTS so I have no idea if this is a violation or not.&lt;/p&gt;</comment>
                            <comment id="12907850" author="hudson" created="Fri, 10 Sep 2010 00:52:29 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #382 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Wink-Trunk-JDK1.5/382/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Wink-Trunk-JDK1.5/382/&lt;/a&gt;)&lt;br/&gt;
    Smarter interpretation of @Consumes/@Produces&lt;/p&gt;

&lt;p&gt;Thanks to Raymond Feng for reporting the issue.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/WINK-286&quot; title=&quot;GET methods fail to serve requests without Content-Type if the class/interface has @Consumes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WINK-286&quot;&gt;&lt;del&gt;WINK-286&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12465588">TUSCANY-3572</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1gifb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>