<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:29:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-371] Data conversion issue for Multi-part MIME on mainframe (z/OS)</title>
                <link>https://issues.apache.org/jira/browse/WINK-371</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;We have a method annotated as follows:-&lt;/p&gt;

&lt;p&gt;@POST&lt;br/&gt;
@Consumes(MediaType.MULTIPART_FORM_DATA)&lt;br/&gt;
@Produces(MediaType.TEXT_XML)&lt;/p&gt;

&lt;p&gt;When we look through the parts on zOS, using:&lt;br/&gt;
  while (iterator.hasNext()) &lt;/p&gt;
{
      InPart part = iterator.next();
      InputStream is = part.getBody(InputStream.class, null);
      ...
  }

&lt;p&gt;we see an exception &lt;br/&gt;
java.lang.StringIndexOutOfBoundsException&lt;br/&gt;
 at java.lang.String.substring(String.java:1092)&lt;br/&gt;
 at org.apache.wink.common.internal.providers.multipart.MultiPartParser.parseHeaders(MultiPartParser.java:264)&lt;br/&gt;
 at org.apache.wink.common.internal.providers.multipart.MultiPartParser.nextPart(MultiPartParser.java:109)&lt;br/&gt;
 at org.apache.wink.common.model.multipart.InMultiPart.hasNext(InMultiPart.java:83)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;The headers going over the wire are in UTF-8, but I believe Wink is trying to decode them as platform encoding (e.g. a new String(bytes), without a codepage specified).  On a regular windows/linux box this would work for normal codepoints, but on zOS, EBCDIC encoding is nothing like UTF-8, so the assumption wouldn&apos;t work.  I&apos;m unfortunately not permitted to look at wink sourcecode (legal reasons) so I cannot verify this myself, but as this is a string handling error on a UTF-8 string, that is the best guess I can do.&lt;/p&gt;</description>
                <environment>&lt;p&gt;z/OS primarily&lt;/p&gt;</environment>
        <key id="12614185">WINK-371</key>
            <summary>Data conversion issue for Multi-part MIME on mainframe (z/OS)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pmasters">Peter Masters</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Oct 2012 14:47:01 +0000</created>
                <updated>Sun, 15 Mar 2015 06:13:25 +0000</updated>
                            <resolved>Sun, 15 Mar 2015 06:13:25 +0000</resolved>
                                    <version>1.2</version>
                                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13495216" author="geosan" created="Mon, 12 Nov 2012 11:34:36 +0000"  >&lt;p&gt;I think the analysis by the submitter is correct. Wink converts byte[] to String via new String(byte[], int, int), not taking any charset into account. Therefore it uses the platform encoding. This is wrong, since the header comes from a client, not from the server platform. We run into a similar issue (not the exception, but garbled strings) on Windows 7 and on Linux by explicitly setting the platform encoding to US-ASCII.&lt;/p&gt;

&lt;p&gt;Wink should use new String(byte[], int, int, charset) instead. The issue is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/COCOON-858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/COCOON-858&lt;/a&gt; where it is fixed in newer versions. Wink seems to use the same parser for multi part headers, but the fix did not make it yet into Wink 1.2.&lt;/p&gt;</comment>
                            <comment id="13496017" author="luciano resende" created="Tue, 13 Nov 2012 07:29:30 +0000"  >&lt;p&gt;I have made the change as suggested :&lt;br/&gt;
diff --git a/wink-common/src/main/java/org/apache/wink/common/internal/providers/multipart/MultiPartParser.java b/wink-common/src/main/java/org/apache/wink/common/internal/providers/multipart/MultiPar&lt;br/&gt;
index 1126a30..bc76772 100644&lt;br/&gt;
&amp;#8212; a/wink-common/src/main/java/org/apache/wink/common/internal/providers/multipart/MultiPartParser.java&lt;br/&gt;
+++ b/wink-common/src/main/java/org/apache/wink/common/internal/providers/multipart/MultiPartParser.java&lt;br/&gt;
@@ -36,6 +36,7 @@ import org.apache.wink.common.internal.i18n.Messages;&lt;/p&gt;

&lt;p&gt; public class MultiPartParser {&lt;br/&gt;
     public final static String             SEP                 = &quot;\n&quot;;           //$NON-NLS-1$&lt;br/&gt;
+    public final static String             UTF8                = &quot;UTF-8&quot;;        //$NON-NLS-1$&lt;/p&gt;

&lt;p&gt;     private InputStream                    is;&lt;br/&gt;
     private byte[]                         boundaryBA;&lt;br/&gt;
@@ -297,7 +298,7 @@ public class MultiPartParser &lt;/p&gt;
{
             return null;
         }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String hdr = new String(buff, buffIdx, lineIdx);&lt;br/&gt;
+        String hdr = new String(buff, buffIdx, lineIdx, UTF8);&lt;br/&gt;
         buffIdx += lineIdx + breakeSize;&lt;br/&gt;
         return hdr;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;And will attach a patched jar. Could you help verify that it fixes the problem.&lt;/p&gt;</comment>
                            <comment id="13496018" author="luciano resende" created="Tue, 13 Nov 2012 07:31:14 +0000"  >&lt;p&gt;Patched jar for verifying this fix. Should work ok on top of wink-1.2.x&lt;/p&gt;</comment>
                            <comment id="13496057" author="pmasters" created="Tue, 13 Nov 2012 09:21:28 +0000"  >&lt;p&gt;Hi - many thanks for the response.  I will give the patch a go and see if this has fixed the problem.&lt;/p&gt;

&lt;p&gt;Cheers, Peter&lt;/p&gt;</comment>
                            <comment id="13498753" author="antonpiatek" created="Fri, 16 Nov 2012 11:55:43 +0000"  >&lt;p&gt;Hi, I work with Pete and have been trying to veryfiy your fix.&lt;/p&gt;

&lt;p&gt;Initially I unpacked your supplied jar and updated my wink 1.2 jar with the classes you provided. This unfortunately broke the json marshaller, presumably due to a change between 1.2 and 1.3.&lt;/p&gt;

&lt;p&gt;Then I tried to update just a few class files to see if that would fix it. &lt;br/&gt;
I took my clean wink 1.2 jar and updated it with the following class files from your supplied jar:&lt;br/&gt;
./org/apache/wink/common/internal/providers/multipart/MultiPartParser$PartInputStream.class&lt;br/&gt;
./org/apache/wink/common/internal/providers/multipart/MultiPartParser.class&lt;br/&gt;
my &lt;br/&gt;
This did no break the json marshaller, but it appears not to have fixed the issue - the following error is still seen:&lt;br/&gt;
java.lang.StringIndexOutOfBoundsException&amp;lt;/cause&amp;gt;&amp;lt;stackTrace&amp;gt;java.lang.String.substring(String.java:1092)&lt;br/&gt;
org.apache.wink.common.internal.providers.multipart.MultiPartParser.parseHeaders(MultiPartParser.java:265)&lt;br/&gt;
org.apache.wink.common.internal.providers.multipart.MultiPartParser.nextPart(MultiPartParser.java:110)&lt;br/&gt;
org.apache.wink.common.model.multipart.InMultiPart.hasNext(InMultiPart.java:83)&lt;/p&gt;

&lt;p&gt;It is unfortunate that our legal department has prohibited us from looking at the wink source code.&lt;/p&gt;</comment>
                            <comment id="13498903" author="luciano resende" created="Fri, 16 Nov 2012 16:45:47 +0000"  >&lt;p&gt;Could you clarify what version you are using ? Wink 1.1.2 or Wink 1.2 ? Then I can produce the correct patch.&lt;/p&gt;</comment>
                            <comment id="13498950" author="pmasters" created="Fri, 16 Nov 2012 17:33:27 +0000"  >&lt;p&gt;Hi Luciano - we&apos;re using Wink 1.2 - thanks for the fast response &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13507900" author="luciano resende" created="Sat, 1 Dec 2012 08:29:26 +0000"  >&lt;p&gt;As you had to do some surgery on the previous jar, here is just a compiled class with some changes to better handle encoding and also some system.out around the place where we are seeing the error. Could you please give it a try and provide the messages being printed.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13510444" author="antonpiatek" created="Wed, 5 Dec 2012 12:06:47 +0000"  >&lt;p&gt;unfortunately I still get the same error:&lt;br/&gt;
java.lang.StringIndexOutOfBoundsException&amp;lt;/cause&amp;gt;&amp;lt;stackTrace&amp;gt;java.lang.String.substring(String.java:1092)&lt;br/&gt;
org.apache.wink.common.internal.providers.multipart.MultiPartParser.parseHeaders(MultiPartParser.java:264)&lt;br/&gt;
org.apache.wink.common.internal.providers.multipart.MultiPartParser.nextPart(MultiPartParser.java:109)&lt;br/&gt;
org.apache.wink.common.model.multipart.InMultiPart.hasNext(InMultiPart.java:83)&lt;/p&gt;

&lt;p&gt;I think your stdouts were captured in our debug trace, however I don&apos;t think they are going to help much as they seem to be coming out in the wrong codepage:&lt;br/&gt;
2012-12-05 11:52:35.353092       43 org.apache.wink.server.internal.log.LogUtilities.logResourceMetadata &apos;MbJavaUtilLogHandler:FINEST&apos; , &apos;Resource information for com.ibm.broker.&lt;br/&gt;
admin.requestHandlers.UploadedResourceHandler:&lt;br/&gt;
Path                                                                             HTTP Method   Consumes             Produces		 Resource Method&lt;br/&gt;
workspace/uploadedResource                                                       GET           &lt;span class=&quot;error&quot;&gt;&amp;#91;*/*&amp;#93;&lt;/span&gt;                &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json&amp;#93;&lt;/span&gt;   com.ibm.broker.admin.requestHandlers.Uplo&lt;br/&gt;
adedResourceHandler.getResources(Request)&lt;br/&gt;
workspace/uploadedResource/&lt;/p&gt;
{browserType}/upload/{mainResource}/commit 		 POST	       &lt;span class=&quot;error&quot;&gt;&amp;#91;*/*&amp;#93;&lt;/span&gt;                &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json&amp;#93;&lt;/span&gt;   com.ibm.broker.admin.requestHandlers.Uplo&lt;br/&gt;
adedResourceHandler.commitUploadedResource(Request,String,String)&lt;br/&gt;
workspace/uploadedResource/uploadedWSDLs/{resourceName}                          DELETE        &lt;span class=&quot;error&quot;&gt;&amp;#91;*/*&amp;#93;&lt;/span&gt;                &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json&amp;#93;&lt;/span&gt;   com.ibm.broker.admin.requestHandlers.Uplo&lt;br/&gt;
adedResourceHandler.deleteWSDL(String,Request)&lt;br/&gt;
workspace/uploadedResource/{browserType}
&lt;p&gt;/upload/&lt;/p&gt;
{mainResource}                   POST          &lt;span class=&quot;error&quot;&gt;&amp;#91;multipart/form-data&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;text/html&amp;#93;&lt;/span&gt;          com.ibm.broker.admin.requestHandlers.Upl&lt;br/&gt;
oadedResourceHandler.uploadDependentResource(Request,InMultiPart,String,String)&lt;br/&gt;
workspace/uploadedResource/uploadedWSDLs/{resourceName}                          DELETE	       &lt;span class=&quot;error&quot;&gt;&amp;#91;*/*&amp;#93;&lt;/span&gt;                &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json&amp;#93;&lt;/span&gt;   com.ibm.broker.admin.requestHandlers.Uplo&lt;br/&gt;
adedResourceHandler.deleteWSDL(String,Request)&lt;br/&gt;
workspace/uploadedResource/{browserType}/upload/{mainResource}
&lt;p&gt;                   POST	       &lt;span class=&quot;error&quot;&gt;&amp;#91;multipart/form-data&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;text/html&amp;#93;&lt;/span&gt;          com.ibm.broker.admin.requestHandlers.Upl&lt;br/&gt;
oadedResourceHandler.uploadDependentResource(Request,InMultiPart,String,String)&lt;br/&gt;
workspace/uploadedResource/&lt;/p&gt;
{browserType}
&lt;p&gt;/upload                                  POST	       &lt;span class=&quot;error&quot;&gt;&amp;#91;multipart/form-data&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;text/html&amp;#93;&lt;/span&gt;          com.ibm.broker.admin.requestHandlers.Upl&lt;br/&gt;
oadedResourceHandler.uploadResource(Request,InMultiPart,String)&lt;br/&gt;
workspace/uploadedResource/&lt;/p&gt;
{type}
&lt;p&gt;                                                GET           &lt;span class=&quot;error&quot;&gt;&amp;#91;*/*&amp;#93;&lt;/span&gt;                &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json&amp;#93;&lt;/span&gt;   com.ibm.broker.admin.requestHandlers.Uplo&lt;br/&gt;
adedResourceHandler.getResourcesForType(String,Request)&apos;&lt;br/&gt;
2012-12-05 11:52:35.356592       43 org.apache.wink.server.internal.log.ResourceInvocation.logFinishRequest &apos;MbJavaUtilLogHandler:FINE&apos; , &apos;Resource invocation:&lt;br/&gt;
-&amp;gt; com.ibm.broker.admin.requestHandlers.UploadedResourceHandler.uploadResource(Request,InMultiPart,String)&apos;&lt;br/&gt;
2012-12-05 11:52:35.358252	 43 org.apache.wink.server.internal.log.Requests.logFinishRequest &apos;MbJavaUtilLogHandler:FINEST&apos; , &apos;logFinishRequest() entry&apos;&lt;br/&gt;
2012-12-05 11:52:35.359728       43 org.apache.wink.server.internal.log.Requests.logFinishRequest &apos;MbJavaUtilLogHandler:FINE&apos; , &apos;The request entity as a String in the default enc&lt;br/&gt;
oding:&apos;&lt;br/&gt;
2012-12-05 11:52:35.361288       43 org.apache.wink.server.internal.log.Requests.logFinishRequest &apos;MbJavaUtilLogHandler:FINE&apos; , &apos;&lt;sup&gt;A000000000000000000000000^B^57^65^62.^69^74^46?&lt;/sup&gt;&lt;br/&gt;
72_^42?^75&amp;gt;^64/^72`^71^39|^63^34^64^48^42(^51%^39^52^58^33^43&lt;br/&gt;
^0A^43?&amp;gt;^74^65&amp;gt;^74^A0000^B^44^69^73^70?^73^69^74^69?&amp;gt;^3A^20^66?^72_^A0000^B^64/^74/^3B^20&amp;gt;/&lt;em&gt;^65^A0000^B^22^75^70%?/^64^65^64^66^69%^65^73$)^22^3B^20^66^69%^65&amp;gt;/&lt;/em&gt;^65^A0000^B^22^77&lt;br/&gt;
^0A^43?&amp;gt;^74^65&amp;gt;^74^A0000^B^54`^70^65^3A^20/^70^70%^69^63/^74^69?&amp;gt;^A0000^B?^63^74^65^74^A0000^B^73^74^72^65/_&lt;br/&gt;
......&lt;/p&gt;</comment>
                            <comment id="14353172" author="msmiths" created="Mon, 9 Mar 2015 16:29:32 +0000"  >&lt;p&gt;So, the issue exists wherever strings are created from byte arrays and vice versa.&lt;/p&gt;

&lt;p&gt;The initialization of the boundaryBA and boundaryDelimiterBA attributes needs to take place in the constructor so that a suitable encoding can be specified and UnsupportedEncodingExceptions caught, as follows:&lt;/p&gt;

&lt;p&gt;        try &lt;/p&gt;
{
        	boundaryBA = (&quot;--&quot; + boundary).getBytes(&quot;UTF-8&quot;); //$NON-NLS-1$
        	boundaryDelimiterBA = &quot;--&quot;.getBytes(&quot;UTF-8&quot;); //$NON-NLS-1$
        }
&lt;p&gt; catch (UnsupportedEncodingException e) &lt;/p&gt;
{
        	e.printStackTrace();
        }

&lt;p&gt;This ensures that the parser is able to idenfify each part in the multipart form data.&lt;/p&gt;

&lt;p&gt;Then, as previously noted, the readLine method needs to be modified to specify an encoding when reading each header from the buffer, as follows:&lt;/p&gt;

&lt;p&gt;        String hdr = new String(buff, buffIdx, lineIdx, &quot;UTF-8&quot;); //$NON-NLS-1$&lt;/p&gt;

&lt;p&gt;Obviously, the &quot;UTF-8&quot; string should probably be defined as a constant somewhere to tidy up the code.&lt;/p&gt;

&lt;p&gt;I have tested these changes locally and can verify that they fix the issue on z/OS.&lt;/p&gt;</comment>
                            <comment id="14362245" author="luciano resende" created="Sun, 15 Mar 2015 06:13:25 +0000"  >&lt;p&gt;Fixed applied in trunk. Thanks for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555621" name="MultiPartParser.class" size="7086" author="lresende" created="Sat, 1 Dec 2012 08:29:26 +0000"/>
                            <attachment id="12553279" name="wink-common-1.3.0-incubating-SNAPSHOT-with-wink371-fix.jar" size="588715" author="lresende" created="Tue, 13 Nov 2012 07:31:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dkrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>77292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>