<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:28:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WINK-262] Content-Type of HTTP Response contains no charset.</title>
                <link>https://issues.apache.org/jira/browse/WINK-262</link>
                <project id="12310940" key="WINK">Wink</project>
                    <description>&lt;p&gt;I have the following handler:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.GET;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.Path;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.Produces;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.core.Context;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.core.MediaType;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.core.Request;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.core.Response;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.wink.common.model.atom.AtomEntry;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.wink.common.model.atom.AtomText;

@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;contentType&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ContentTypeTest {
	@GET
	@Produces( { MediaType.APPLICATION_XML, MediaType.TEXT_XML, MediaType.APPLICATION_JSON, &lt;span class=&quot;code-quote&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; })
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response getRepresentation(@Context Request req) {
		AtomEntry e = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomEntry();
		e.setTitle(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomText(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u5341\u4e00\u69cb\u30bd\u30c1\u2010&quot;&lt;/span&gt;));
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Response.ok(e).build();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I open the resource I get the following HTTP response:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Content-Type:	application/xml
Content-Length:	274
Server:	Jetty(6.1.x)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that the charset is not specified and the content is not properly decoded e.g. by RestClient - &lt;a href=&quot;http://code.google.com/p/rest-client/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/rest-client/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However I can see that the XML is properly encoded by opening the resource in FF and enforcing UTF-8 decoding.&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t wink put the encoding used during serialization if different than ASCII?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Jetty Server 6.1&lt;/p&gt;</environment>
        <key id="12458236">WINK-262</key>
            <summary>Content-Type of HTTP Response contains no charset.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rott">Michael Rheinheimer</assignee>
                                    <reporter username="kkolev">Kaloyan Kolev</reporter>
                        <labels>
                            <label>charset</label>
                            <label>missing</label>
                    </labels>
                <created>Fri, 5 Mar 2010 12:00:15 +0000</created>
                <updated>Sat, 13 Jul 2013 20:13:21 +0000</updated>
                            <resolved>Tue, 30 Mar 2010 03:46:36 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12841833" author="bluk" created="Fri, 5 Mar 2010 12:44:41 +0000"  >&lt;p&gt;Would putting Response.ok(e).contentType(&quot;application/xml;charset=(your char set)&quot;).build() work?&lt;/p&gt;

&lt;p&gt;As far as Wink automatically determining the charset, I don&apos;t know if that&apos;s possible.  We would have to read the entire output and &quot;guess&quot; the character set before we started sending anything in the response (because the charset must be sent as part of the HTTP headers, if we started sending content with a large entity, it may be too late to add/change the HTTP header since the entity data could force a flush of the response to the client).  I&apos;m also not too sure how we could determine the charset correctly (i.e. what if there were conflicts).&lt;/p&gt;

&lt;p&gt;Do you have a suggestion on how to determine that?&lt;/p&gt;</comment>
                            <comment id="12841838" author="bluk" created="Fri, 5 Mar 2010 12:51:54 +0000"  >&lt;p&gt;Meant Response.ok(e).type(&quot;application/xml;charset=(your char set)&quot;).build() &lt;/p&gt;</comment>
                            <comment id="12841840" author="nickgallardo" created="Fri, 5 Mar 2010 12:54:47 +0000"  >&lt;p&gt;I understand why you have this question and have seen this same issue before in the web services world.  The model with Wink and JAX-RS is that of a framework for allowing users to surface their desired content.  Wink doesn&apos;t care what content you send and will surface whatever information you provide.  &lt;/p&gt;

&lt;p&gt;In general I agree with Bryant here.  I don&apos;t think Wink should be in the game of trying to determine content encodings from user supplied content.  From an execution standpoint, I can&apos;t think of a reliable way to do it.  The larger issue is that making such a change would dramatically effect performance of the engine if we were to always read content to determine encoding.&lt;/p&gt;


</comment>
                            <comment id="12841855" author="kkolev" created="Fri, 5 Mar 2010 13:36:39 +0000"  >&lt;p&gt;Specifying the charset using the ResponseBuilder.type() method didn&apos;t look very good as I don&apos;t want to figure out what encoding or what media type the user requests in each resource handler - that should be something wink does for me.&lt;/p&gt;

&lt;p&gt;This is why I tried providing the Accept request header explicitly and that actually did it. I could verify that the specified charset was used to encode the content and it was also present in the response Content-Type header.&lt;/p&gt;

&lt;p&gt;So this shows that the actual problem is visible when wink cannot detect the charset which the message body writer serializes the content with (in my case the default is UTF-8). When no charset is detected wink don&apos;t add the default serialization charset to the Content-Type header when responding.&lt;/p&gt;

&lt;p&gt;So do you think that could be enhanced so wink provides the non-ASCII encoding as well?&lt;/p&gt;</comment>
                            <comment id="12841857" author="nickgallardo" created="Fri, 5 Mar 2010 13:45:35 +0000"  >&lt;p&gt;Just to clarify, you&apos;re just wanting Wink to include whatever encoding it used during serialization as the Content-Type header in the response, right?&lt;/p&gt;</comment>
                            <comment id="12841861" author="kkolev" created="Fri, 5 Mar 2010 13:51:53 +0000"  >&lt;p&gt;Right, I think the default serialization encoding missing is what had confused me on the first place.&lt;/p&gt;</comment>
                            <comment id="12841864" author="nickgallardo" created="Fri, 5 Mar 2010 13:58:23 +0000"  >&lt;p&gt;Got it.  That makes sense.  I see no reason to not include that in the response.  &lt;/p&gt;

&lt;p&gt;Marking this for 1.1.&lt;/p&gt;</comment>
                            <comment id="12850631" author="rott" created="Sun, 28 Mar 2010 04:17:21 +0000"  >&lt;p&gt;Attached patch ought to fix this issue.  Please take a look.  I default to &quot;charset=UTF-8&quot; (note: uppercase) on the response Content-Type header of no &quot;charset&quot; already exists.  However, I did not do it for multipart.  I need some review on this; very strange things were happening in the MultiPartParser under MultiPartTest when I added the default charset.&lt;/p&gt;</comment>
                            <comment id="12851002" author="bluk" created="Mon, 29 Mar 2010 17:01:40 +0000"  >&lt;p&gt;My only concern with doing this is we&apos;re adding a charset=UTF-8 to all providers even though the parameter does not make any sense (i.e. if they use a byte[] and set the response content to be image/png or something, then the final media type would be image/png;charset=UTF-8).&lt;/p&gt;</comment>
                            <comment id="12851022" author="rott" created="Mon, 29 Mar 2010 17:47:22 +0000"  >&lt;p&gt;I&apos;d be ok with filtering on the Content-Type to decide if a default charset makes sense or not.  Does that get a little too expensive there, though?  Don&apos;t know where it would be any cheaper, performance-wise.&lt;/p&gt;</comment>
                            <comment id="12851088" author="bluk" created="Mon, 29 Mar 2010 20:56:39 +0000"  >&lt;p&gt;I propose moving the ;charset addition to the String and XML providers.&lt;/p&gt;

&lt;p&gt;The reasoning is because of a few things&lt;br/&gt;
1)  Should work on the client and the server&lt;br/&gt;
2)  The charset should be in addition to any other handler that&apos;s on the path and should be added when providers are invoked directly if possible.&lt;/p&gt;

&lt;p&gt;Right now, the basic code block is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (httpHeaders != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; httpHeaders.get(HttpHeaders.CONTENT_TYPE) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-comment&quot;&gt;// only correct the MediaType &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the MediaType was not explicitly
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// set
&lt;/span&gt;            logger
                .debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Media Type not explicitly set on Response so going to correct charset parameter &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; necessary&quot;&lt;/span&gt;);&lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$
&lt;/span&gt;            Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; parameters = mediaType.getParameters();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parameters != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parameters.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$
&lt;/span&gt;                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; params =
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(mediaType.getParameters());
                        params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$ $NON-NLS-2$
&lt;/span&gt;                        httpHeaders.putSingle(HttpHeaders.CONTENT_TYPE, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MediaType(mediaType
                            .getType(), mediaType.getSubtype(), params)); &lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$
&lt;/span&gt;                        logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Added charset=UTF-8 parameter to Content-Type HttpHeader&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$
&lt;/span&gt;                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can happen in the Atom Model since we pass in an unmodifiable set
&lt;/span&gt;                        logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Caught exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to set the charset&quot;&lt;/span&gt;, e); &lt;span class=&quot;code-comment&quot;&gt;//$NON-NLS-1$
&lt;/span&gt;                    }
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The idea is that if a media type is explicitly set by a Response.type() to not change it.  However, if it was populated by the runtime, then go ahead and add the charset if one does not exist.  A few catches for cases where we invoked the provider directly with unexpected parameter values.&lt;/p&gt;</comment>
                            <comment id="12851090" author="bluk" created="Mon, 29 Mar 2010 21:00:49 +0000"  >&lt;p&gt;Also, I had to add some test code to correct a problem in the MockServletResponse where the charset was being incorrectly set in the case where the response media type was something like &quot;text/plain;charset=UTF-8;otherParam=value&quot; which I believe is still legal.&lt;/p&gt;</comment>
                            <comment id="12851235" author="rott" created="Tue, 30 Mar 2010 03:46:36 +0000"  >&lt;p&gt;Thanks Bryant.  Looks good.  Committed your -2 patch in SVN rev 928969.&lt;/p&gt;</comment>
                            <comment id="12851244" author="hudson" created="Tue, 30 Mar 2010 04:38:53 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #303 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/303/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/303/&lt;/a&gt;)&lt;br/&gt;
    : set default charset=UTF-8 when necessary&lt;/p&gt;</comment>
                            <comment id="12851267" author="hudson" created="Tue, 30 Mar 2010 06:01:59 +0000"  >&lt;p&gt;Integrated in Wink-Trunk-JDK1.5 #304 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/304/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Wink-Trunk-JDK1.5/304/&lt;/a&gt;)&lt;br/&gt;
    : followup - consolidate duplicate code into utility method&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440106" name="WINK-262-2.patch" size="48448" author="bluk" created="Mon, 29 Mar 2010 20:56:39 +0000"/>
                            <attachment id="12440000" name="WINK-262.patch" size="12615" author="rott" created="Sun, 28 Mar 2010 04:17:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1gi8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>