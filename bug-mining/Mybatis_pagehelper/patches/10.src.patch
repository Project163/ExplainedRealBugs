diff --git a/src/main/java/com/github/pagehelper/SqlUtil.java b/src/main/java/com/github/pagehelper/SqlUtil.java
index b3d940d..e61beb6 100644
--- a/src/main/java/com/github/pagehelper/SqlUtil.java
+++ b/src/main/java/com/github/pagehelper/SqlUtil.java
@@ -26,6 +26,7 @@ package com.github.pagehelper;
 
 import com.github.pagehelper.parser.Parser;
 import com.github.pagehelper.parser.impl.AbstractParser;
+import com.github.pagehelper.parser.impl.CacheParser;
 import com.github.pagehelper.sqlsource.*;
 import org.apache.ibatis.builder.StaticSqlSource;
 import org.apache.ibatis.builder.annotation.ProviderSqlSource;
@@ -116,8 +117,9 @@ public class SqlUtil implements Constant {
                 Class<?> parserClass = Class.forName(strDialect);
                 if (Parser.class.isAssignableFrom(parserClass)) {
                     parser = (Parser) parserClass.newInstance();
-                    if(parser instanceof AbstractParser){
-                        ((AbstractParser)parser).initSqlParser(cacheClass);
+                    //空和不为false时，使用缓存，感谢MoonFruit提供的思路
+                    if(StringUtil.isEmpty(cacheClass) || !cacheClass.equalsIgnoreCase("false")){
+                        parser = new CacheParser(parser, cacheClass);
                     }
                 }
             } catch (ClassNotFoundException ex) {
diff --git a/src/main/java/com/github/pagehelper/cache/CacheFactory.java b/src/main/java/com/github/pagehelper/cache/CacheFactory.java
index 6f78069..8df74fc 100644
--- a/src/main/java/com/github/pagehelper/cache/CacheFactory.java
+++ b/src/main/java/com/github/pagehelper/cache/CacheFactory.java
@@ -43,29 +43,8 @@ public abstract class CacheFactory {
         if(StringUtil.isEmpty(sqlCacheClass)){
             try {
                 Class.forName("com.google.common.cache.Cache");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("====com.google.common.cache.Cache=====");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
                 return new GuavaCache();
             } catch (Throwable t){
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("========SimpleCache===================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
-                System.out.println("======================================");
                 return new SimpleCache();
             }
         } else {
diff --git a/src/main/java/com/github/pagehelper/parser/SqlParser.java b/src/main/java/com/github/pagehelper/parser/SqlParser.java
index 6affe0d..116ee35 100644
--- a/src/main/java/com/github/pagehelper/parser/SqlParser.java
+++ b/src/main/java/com/github/pagehelper/parser/SqlParser.java
@@ -24,8 +24,6 @@
 
 package com.github.pagehelper.parser;
 
-import com.github.pagehelper.cache.Cache;
-import com.github.pagehelper.cache.CacheFactory;
 import net.sf.jsqlparser.expression.Alias;
 import net.sf.jsqlparser.expression.Function;
 import net.sf.jsqlparser.parser.CCJSqlParserUtil;
@@ -53,17 +51,6 @@ public class SqlParser {
         TABLE_ALIAS.setUseAs(false);
     }
 
-    //缓存已经修改过的sql
-    private final Cache<String, String> CACHE;
-
-    public SqlParser() {
-        this(CacheFactory.createSqlCache(null));
-    }
-
-    public SqlParser(Cache<String, String> cache) {
-        this.CACHE = cache;
-    }
-
     public void isSupportedSql(String sql) {
         if (sql.trim().toUpperCase().endsWith("FOR UPDATE")) {
             throw new RuntimeException("分页插件不支持包含for update的sql");
@@ -79,18 +66,13 @@ public class SqlParser {
     public String getSmartCountSql(String sql) {
         //校验是否支持该sql
         isSupportedSql(sql);
-        if (CACHE.get(sql) != null) {
-            return CACHE.get(sql);
-        }
         //解析SQL
         Statement stmt = null;
         try {
             stmt = CCJSqlParserUtil.parse(sql);
         } catch (Throwable e) {
             //无法解析的用一般方法返回count语句
-            String countSql = getSimpleCountSql(sql);
-            CACHE.put(sql, countSql);
-            return countSql;
+            return getSimpleCountSql(sql);
         }
         Select select = (Select) stmt;
         SelectBody selectBody = select.getSelectBody();
@@ -101,7 +83,6 @@ public class SqlParser {
         //处理为count查询
         sqlToCount(select);
         String result = select.toString();
-        CACHE.put(sql, result);
         return result;
     }
 
diff --git a/src/main/java/com/github/pagehelper/parser/SqlServer.java b/src/main/java/com/github/pagehelper/parser/SqlServer.java
index 784bfe0..cdeb59d 100644
--- a/src/main/java/com/github/pagehelper/parser/SqlServer.java
+++ b/src/main/java/com/github/pagehelper/parser/SqlServer.java
@@ -34,8 +34,6 @@ import net.sf.jsqlparser.statement.select.*;
 
 import java.util.ArrayList;
 import java.util.List;
-import java.util.Map;
-import java.util.concurrent.ConcurrentHashMap;
 
 /**
  * 将sqlserver查询语句转换为分页语句<br>
@@ -53,12 +51,10 @@ import java.util.concurrent.ConcurrentHashMap;
  * @author liuzh
  */
 public class SqlServer {
-    //缓存结果
-    protected static final Map<String, String> CACHE = new ConcurrentHashMap<String, String>();
     //开始行号
-    protected static final String START_ROW = String.valueOf(Long.MIN_VALUE);
+    public static final String START_ROW = String.valueOf(Long.MIN_VALUE);
     //结束行号
-    protected static final String PAGE_SIZE = String.valueOf(Long.MAX_VALUE);
+    public static final String PAGE_SIZE = String.valueOf(Long.MAX_VALUE);
     //外层包装表
     protected static final String WRAP_TABLE = "WRAP_OUTER_TABLE";
     //表别名名字
@@ -79,6 +75,16 @@ public class SqlServer {
         TOP100_PERCENT.setPercentage(true);
     }
 
+    /**
+     * 转换为分页语句
+     *
+     * @param sql
+     * @return
+     */
+    public String convertToPageSql(String sql) {
+        return convertToPageSql(sql, null, null);
+    }
+
     /**
      * 转换为分页语句
      *
@@ -87,26 +93,27 @@ public class SqlServer {
      * @param limit
      * @return
      */
-    public String convertToPageSql(String sql, int offset, int limit) {
-        String pageSql = CACHE.get(sql);
-        if (pageSql == null) {
-            //解析SQL
-            Statement stmt;
-            try {
-                stmt = CCJSqlParserUtil.parse(sql);
-            } catch (Throwable e) {
-                throw new RuntimeException("不支持该SQL转换为分页查询!");
-            }
-            if (!(stmt instanceof Select)) {
-                throw new RuntimeException("分页语句必须是Select查询!");
-            }
-            //获取分页查询的select
-            Select pageSelect = getPageSelect((Select) stmt);
-            pageSql = pageSelect.toString();
-            CACHE.put(sql, pageSql);
+    public String convertToPageSql(String sql, Integer offset, Integer limit) {
+        //解析SQL
+        Statement stmt;
+        try {
+            stmt = CCJSqlParserUtil.parse(sql);
+        } catch (Throwable e) {
+            throw new RuntimeException("不支持该SQL转换为分页查询!");
+        }
+        if (!(stmt instanceof Select)) {
+            throw new RuntimeException("分页语句必须是Select查询!");
+        }
+        //获取分页查询的select
+        Select pageSelect = getPageSelect((Select) stmt);
+        String pageSql = pageSelect.toString();
+        //缓存移到外面了，所以不替换参数
+        if(offset != null){
+            pageSql = pageSql.replace(START_ROW, String.valueOf(offset));
+        }
+        if(limit != null){
+            pageSql = pageSql.replace(PAGE_SIZE, String.valueOf(limit));
         }
-        pageSql = pageSql.replace(START_ROW, String.valueOf(offset));
-        pageSql = pageSql.replace(PAGE_SIZE, String.valueOf(limit));
         return pageSql;
     }
 
diff --git a/src/main/java/com/github/pagehelper/parser/impl/AbstractParser.java b/src/main/java/com/github/pagehelper/parser/impl/AbstractParser.java
index 2158c5a..c6f3b69 100644
--- a/src/main/java/com/github/pagehelper/parser/impl/AbstractParser.java
+++ b/src/main/java/com/github/pagehelper/parser/impl/AbstractParser.java
@@ -27,7 +27,7 @@ package com.github.pagehelper.parser.impl;
 import com.github.pagehelper.Constant;
 import com.github.pagehelper.Dialect;
 import com.github.pagehelper.Page;
-import com.github.pagehelper.cache.CacheFactory;
+import com.github.pagehelper.StringUtil;
 import com.github.pagehelper.parser.Parser;
 import com.github.pagehelper.parser.SqlParser;
 import com.github.pagehelper.sqlsource.PageProviderSqlSource;
@@ -48,11 +48,7 @@ import java.util.Map;
  */
 public abstract class AbstractParser implements Parser, Constant {
     //处理SQL
-    public SqlParser sqlParser;
-
-    public void initSqlParser(String sqlCacheClass){
-        sqlParser = new SqlParser(CacheFactory.createSqlCache(sqlCacheClass));
-    }
+    public static final SqlParser sqlParser = new SqlParser();
 
     public static Parser newParser(Dialect dialect) {
         return newParser(dialect, null);
@@ -93,8 +89,9 @@ public abstract class AbstractParser implements Parser, Constant {
             default:
                 throw new RuntimeException("分页插件" + dialect + "方言错误!");
         }
-        if(parser instanceof AbstractParser){
-            ((AbstractParser)parser).initSqlParser(cacheClass);
+        //空和不为false时，使用缓存，感谢MoonFruit提供的思路
+        if(StringUtil.isEmpty(cacheClass) || !cacheClass.equalsIgnoreCase("false")){
+            parser = new CacheParser(parser, cacheClass);
         }
         return parser;
     }
diff --git a/src/main/java/com/github/pagehelper/parser/impl/CacheParser.java b/src/main/java/com/github/pagehelper/parser/impl/CacheParser.java
new file mode 100644
index 0000000..76dc178
--- /dev/null
+++ b/src/main/java/com/github/pagehelper/parser/impl/CacheParser.java
@@ -0,0 +1,111 @@
+/*
+ * The MIT License (MIT)
+ *
+ * Copyright (c) 2014 abel533@gmail.com
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+ * THE SOFTWARE.
+ */
+
+package com.github.pagehelper.parser.impl;
+
+import com.github.pagehelper.Page;
+import com.github.pagehelper.SqlUtil;
+import com.github.pagehelper.cache.Cache;
+import com.github.pagehelper.cache.CacheFactory;
+import com.github.pagehelper.parser.Parser;
+import com.github.pagehelper.parser.SqlServer;
+import org.apache.ibatis.mapping.BoundSql;
+import org.apache.ibatis.mapping.MappedStatement;
+import org.apache.ibatis.mapping.ParameterMapping;
+import org.apache.ibatis.session.Configuration;
+
+import java.util.List;
+import java.util.Map;
+
+/**
+ * 缓存实现
+ *
+ * @author liuzh
+ */
+public class CacheParser implements Parser {
+
+    private Parser delegate;
+
+    private Cache<String, String> CACHE_COUNTSQL;
+    private Cache<String, String> CACHE_PAGESQL;
+    private boolean cachePageSql = false;
+
+    public CacheParser(Parser delegate, String sqlCacheClass) {
+        this.delegate = delegate;
+        CACHE_COUNTSQL = CacheFactory.createSqlCache(sqlCacheClass);
+        //一般情况下的pagesql都是简单的字符串拼接，不需要缓存，只有sqlserver方式由于处理SQL结构耗时，因此针对这种情况会缓存
+        if(delegate instanceof SqlServerParser){
+            CACHE_PAGESQL = CacheFactory.createSqlCache(sqlCacheClass);
+            cachePageSql = true;
+        }
+    }
+
+    @Override
+    public boolean isSupportedMappedStatementCache() {
+        return delegate.isSupportedMappedStatementCache();
+    }
+
+    @Override
+    public String getCountSql(String sql) {
+        //一般涉及复杂处理，缓存结果
+        String countSql = CACHE_COUNTSQL.get(sql);
+        if(countSql != null){
+            return countSql;
+        } else {
+            countSql = delegate.getCountSql(sql);
+            CACHE_COUNTSQL.put(sql, countSql);
+        }
+        return countSql;
+    }
+
+    @Override
+    public String getPageSql(String sql) {
+        if(cachePageSql){
+            //SqlServerParser实现会缓存
+            Page<?> page = SqlUtil.getLocalPage();
+            String pageSql = CACHE_PAGESQL.get(sql);
+            if(pageSql == null){
+                //调用不替换参数的这个方法
+                pageSql = ((SqlServerParser)delegate).getPageSqlWithOutPage(sql);
+                CACHE_PAGESQL.put(sql, pageSql);
+            }
+            pageSql = pageSql.replace(SqlServer.START_ROW, String.valueOf(page.getStartRow()));
+            pageSql = pageSql.replace(SqlServer.PAGE_SIZE, String.valueOf(page.getPageSize()));
+            return pageSql;
+        } else {
+            //一般情况下，简单字符串拼接，不需要缓存
+            return delegate.getPageSql(sql);
+        }
+    }
+
+    @Override
+    public List<ParameterMapping> getPageParameterMapping(Configuration configuration, BoundSql boundSql) {
+        return delegate.getPageParameterMapping(configuration, boundSql);
+    }
+
+    @Override
+    public Map<String, Object> setPageParameter(MappedStatement ms, Object parameterObject, BoundSql boundSql, Page<?> page) {
+        return delegate.setPageParameter(ms, parameterObject, boundSql, page);
+    }
+}
diff --git a/src/main/java/com/github/pagehelper/parser/impl/SqlServerParser.java b/src/main/java/com/github/pagehelper/parser/impl/SqlServerParser.java
index ec61019..9b7e806 100644
--- a/src/main/java/com/github/pagehelper/parser/impl/SqlServerParser.java
+++ b/src/main/java/com/github/pagehelper/parser/impl/SqlServerParser.java
@@ -72,6 +72,19 @@ public class SqlServerParser extends AbstractParser {
         return sql;
     }
 
+    /**
+     * 该方法针对 CacheParser 提供，返回的 sql 不是最终执行的 sql，需要替换分页参数
+     *
+     * @param sql
+     * @return
+     */
+    public String getPageSqlWithOutPage(String sql) {
+        sql = sql.replaceAll("((?i)with\\s*\\(nolock\\))", WITHNOLOCK);
+        sql = pageSql.convertToPageSql(sql);
+        sql = sql.replaceAll(WITHNOLOCK, " with(nolock)");
+        return sql;
+    }
+
     @Override
     public Map<String, Object> setPageParameter(MappedStatement ms, Object parameterObject, BoundSql boundSql, Page<?> page) {
         return super.setPageParameter(ms, parameterObject, boundSql, page);
