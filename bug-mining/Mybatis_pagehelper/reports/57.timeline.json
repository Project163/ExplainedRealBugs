[{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/762096291","html_url":"https://github.com/pagehelper/Mybatis-PageHelper/issues/587#issuecomment-762096291","issue_url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/587","id":762096291,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MjA5NjI5MQ==","user":{"login":"lingaoju","id":61577709,"node_id":"MDQ6VXNlcjYxNTc3NzA5","avatar_url":"https://avatars.githubusercontent.com/u/61577709?v=4","gravatar_id":"","url":"https://api.github.com/users/lingaoju","html_url":"https://github.com/lingaoju","followers_url":"https://api.github.com/users/lingaoju/followers","following_url":"https://api.github.com/users/lingaoju/following{/other_user}","gists_url":"https://api.github.com/users/lingaoju/gists{/gist_id}","starred_url":"https://api.github.com/users/lingaoju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingaoju/subscriptions","organizations_url":"https://api.github.com/users/lingaoju/orgs","repos_url":"https://api.github.com/users/lingaoju/repos","events_url":"https://api.github.com/users/lingaoju/events{/privacy}","received_events_url":"https://api.github.com/users/lingaoju/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-18T08:59:18Z","updated_at":"2021-01-18T08:59:18Z","body":"@Override\r\n    public BoundSql doBoundSql(BoundSqlInterceptor.Type type, BoundSql boundSql, CacheKey cacheKey) {\r\n        if (this.interceptors == null || this.interceptors.size() == this.index) {\r\n            return this.original != null ? this.original.doBoundSql(type, boundSql, cacheKey) : boundSql;\r\n        } else {\r\n            return this.interceptors.get(this.index++).boundSql(type, boundSql, cacheKey, this);\r\n        }\r\n    }\r\n图片不知道是否上传成功，这边用代码解释以下，这个是BoundSqlInterceptorChain类部分代码， 这里的this.index++调用后在代码中没有重置，导致不会在进入这个拦截链","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/762096291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lingaoju","id":61577709,"node_id":"MDQ6VXNlcjYxNTc3NzA5","avatar_url":"https://avatars.githubusercontent.com/u/61577709?v=4","gravatar_id":"","url":"https://api.github.com/users/lingaoju","html_url":"https://github.com/lingaoju","followers_url":"https://api.github.com/users/lingaoju/followers","following_url":"https://api.github.com/users/lingaoju/following{/other_user}","gists_url":"https://api.github.com/users/lingaoju/gists{/gist_id}","starred_url":"https://api.github.com/users/lingaoju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingaoju/subscriptions","organizations_url":"https://api.github.com/users/lingaoju/orgs","repos_url":"https://api.github.com/users/lingaoju/repos","events_url":"https://api.github.com/users/lingaoju/events{/privacy}","received_events_url":"https://api.github.com/users/lingaoju/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4216982111,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDIxNjk4MjExMQ==","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4216982111","actor":{"login":"notoverride","id":27325127,"node_id":"MDQ6VXNlcjI3MzI1MTI3","avatar_url":"https://avatars.githubusercontent.com/u/27325127?v=4","gravatar_id":"","url":"https://api.github.com/users/notoverride","html_url":"https://github.com/notoverride","followers_url":"https://api.github.com/users/notoverride/followers","following_url":"https://api.github.com/users/notoverride/following{/other_user}","gists_url":"https://api.github.com/users/notoverride/gists{/gist_id}","starred_url":"https://api.github.com/users/notoverride/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/notoverride/subscriptions","organizations_url":"https://api.github.com/users/notoverride/orgs","repos_url":"https://api.github.com/users/notoverride/repos","events_url":"https://api.github.com/users/notoverride/events{/privacy}","received_events_url":"https://api.github.com/users/notoverride/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-01-18T08:59:18Z","performed_via_github_app":null},{"id":4216982116,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQyMTY5ODIxMTY=","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4216982116","actor":{"login":"notoverride","id":27325127,"node_id":"MDQ6VXNlcjI3MzI1MTI3","avatar_url":"https://avatars.githubusercontent.com/u/27325127?v=4","gravatar_id":"","url":"https://api.github.com/users/notoverride","html_url":"https://github.com/notoverride","followers_url":"https://api.github.com/users/notoverride/followers","following_url":"https://api.github.com/users/notoverride/following{/other_user}","gists_url":"https://api.github.com/users/notoverride/gists{/gist_id}","starred_url":"https://api.github.com/users/notoverride/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/notoverride/subscriptions","organizations_url":"https://api.github.com/users/notoverride/orgs","repos_url":"https://api.github.com/users/notoverride/repos","events_url":"https://api.github.com/users/notoverride/events{/privacy}","received_events_url":"https://api.github.com/users/notoverride/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-01-18T08:59:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/822313460","html_url":"https://github.com/pagehelper/Mybatis-PageHelper/issues/587#issuecomment-822313460","issue_url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/587","id":822313460,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMjMxMzQ2MA==","user":{"login":"a83313886","id":14260480,"node_id":"MDQ6VXNlcjE0MjYwNDgw","avatar_url":"https://avatars.githubusercontent.com/u/14260480?v=4","gravatar_id":"","url":"https://api.github.com/users/a83313886","html_url":"https://github.com/a83313886","followers_url":"https://api.github.com/users/a83313886/followers","following_url":"https://api.github.com/users/a83313886/following{/other_user}","gists_url":"https://api.github.com/users/a83313886/gists{/gist_id}","starred_url":"https://api.github.com/users/a83313886/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a83313886/subscriptions","organizations_url":"https://api.github.com/users/a83313886/orgs","repos_url":"https://api.github.com/users/a83313886/repos","events_url":"https://api.github.com/users/a83313886/events{/privacy}","received_events_url":"https://api.github.com/users/a83313886/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-19T09:17:54Z","updated_at":"2021-04-19T09:17:54Z","body":"我也发现这个问题了。原因在于`BoundSqlInterceptorChain`的`index`字段使用，而`PageHelper`调用时直接复用了同一个实例，一方面在多线程场景下存在并发问题，另一方面就如 @lingaoju 所说的-计数器没有重置。\r\n\r\n`PageHelper`使用同一个实例的代码如下：\r\n```java\r\n    @Override\r\n    public BoundSql doBoundSql(BoundSqlInterceptor.Type type, BoundSql boundSql, CacheKey cacheKey) {\r\n           // ...\r\n            BoundSqlInterceptor.Chain defaultChain = pageBoundSqlInterceptors != null ? pageBoundSqlInterceptors.getChain() : null;\r\n            if (boundSqlInterceptor != null) {\r\n                chain = new BoundSqlInterceptorChain(defaultChain, Arrays.asList(boundSqlInterceptor));\r\n            } else if (defaultChain != null) {\r\n                chain = defaultChain;\r\n            }\r\n            // ...\r\n        return chain.doBoundSql(type, boundSql, cacheKey);\r\n    }\r\n```\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/822313460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"a83313886","id":14260480,"node_id":"MDQ6VXNlcjE0MjYwNDgw","avatar_url":"https://avatars.githubusercontent.com/u/14260480?v=4","gravatar_id":"","url":"https://api.github.com/users/a83313886","html_url":"https://github.com/a83313886","followers_url":"https://api.github.com/users/a83313886/followers","following_url":"https://api.github.com/users/a83313886/following{/other_user}","gists_url":"https://api.github.com/users/a83313886/gists{/gist_id}","starred_url":"https://api.github.com/users/a83313886/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a83313886/subscriptions","organizations_url":"https://api.github.com/users/a83313886/orgs","repos_url":"https://api.github.com/users/a83313886/repos","events_url":"https://api.github.com/users/a83313886/events{/privacy}","received_events_url":"https://api.github.com/users/a83313886/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4611377081,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYxMTM3NzA4MQ==","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4611377081","actor":{"login":"lingaoju","id":61577709,"node_id":"MDQ6VXNlcjYxNTc3NzA5","avatar_url":"https://avatars.githubusercontent.com/u/61577709?v=4","gravatar_id":"","url":"https://api.github.com/users/lingaoju","html_url":"https://github.com/lingaoju","followers_url":"https://api.github.com/users/lingaoju/followers","following_url":"https://api.github.com/users/lingaoju/following{/other_user}","gists_url":"https://api.github.com/users/lingaoju/gists{/gist_id}","starred_url":"https://api.github.com/users/lingaoju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingaoju/subscriptions","organizations_url":"https://api.github.com/users/lingaoju/orgs","repos_url":"https://api.github.com/users/lingaoju/repos","events_url":"https://api.github.com/users/lingaoju/events{/privacy}","received_events_url":"https://api.github.com/users/lingaoju/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-19T09:17:55Z","performed_via_github_app":null},{"id":4611377086,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MTEzNzcwODY=","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4611377086","actor":{"login":"lingaoju","id":61577709,"node_id":"MDQ6VXNlcjYxNTc3NzA5","avatar_url":"https://avatars.githubusercontent.com/u/61577709?v=4","gravatar_id":"","url":"https://api.github.com/users/lingaoju","html_url":"https://github.com/lingaoju","followers_url":"https://api.github.com/users/lingaoju/followers","following_url":"https://api.github.com/users/lingaoju/following{/other_user}","gists_url":"https://api.github.com/users/lingaoju/gists{/gist_id}","starred_url":"https://api.github.com/users/lingaoju/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lingaoju/subscriptions","organizations_url":"https://api.github.com/users/lingaoju/orgs","repos_url":"https://api.github.com/users/lingaoju/repos","events_url":"https://api.github.com/users/lingaoju/events{/privacy}","received_events_url":"https://api.github.com/users/lingaoju/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-19T09:17:55Z","performed_via_github_app":null},{"id":4847939811,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ4NDc5Mzk4MTE=","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4847939811","actor":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-06-06T10:03:40Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":4847939895,"node_id":"MDExOlBpbm5lZEV2ZW50NDg0NzkzOTg5NQ==","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4847939895","actor":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"pinned","commit_id":null,"commit_url":null,"created_at":"2021-06-06T10:03:43Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/855394280","html_url":"https://github.com/pagehelper/Mybatis-PageHelper/issues/587#issuecomment-855394280","issue_url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/587","id":855394280,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NTM5NDI4MA==","user":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-06T12:50:21Z","updated_at":"2021-06-06T12:53:09Z","body":"这是个BUG，现在的修改方式是把chain当成了模板，执行的时候初始化一个实例来解决这个问题，大家可以看看代码，测试看看有没有问题：\r\n```java\r\npackage com.github.pagehelper;\r\n\r\nimport org.apache.ibatis.cache.CacheKey;\r\nimport org.apache.ibatis.mapping.BoundSql;\r\n\r\nimport java.util.List;\r\n\r\npublic class BoundSqlInterceptorChain implements BoundSqlInterceptor.Chain {\r\n    private final BoundSqlInterceptor.Chain original;\r\n    private final List<BoundSqlInterceptor> interceptors;\r\n\r\n    private int     index = 0;\r\n    private boolean executable;\r\n\r\n    public BoundSqlInterceptorChain(BoundSqlInterceptor.Chain original, List<BoundSqlInterceptor> interceptors) {\r\n        this(original, interceptors, false);\r\n    }\r\n\r\n    private BoundSqlInterceptorChain(BoundSqlInterceptor.Chain original, List<BoundSqlInterceptor> interceptors, boolean executable) {\r\n        this.original = original;\r\n        this.interceptors = interceptors;\r\n        this.executable = executable;\r\n    }\r\n\r\n    @Override\r\n    public BoundSql doBoundSql(BoundSqlInterceptor.Type type, BoundSql boundSql, CacheKey cacheKey) {\r\n        if(executable) {\r\n            return _doBoundSql(type, boundSql, cacheKey);\r\n        } else {\r\n            return new BoundSqlInterceptorChain(original, interceptors, true).doBoundSql(type, boundSql, cacheKey);\r\n        }\r\n    }\r\n\r\n    private BoundSql _doBoundSql(BoundSqlInterceptor.Type type, BoundSql boundSql, CacheKey cacheKey) {\r\n        if (this.interceptors == null || this.interceptors.size() == this.index) {\r\n            return this.original != null ? this.original.doBoundSql(type, boundSql, cacheKey) : boundSql;\r\n        } else {\r\n            return this.interceptors.get(this.index++).boundSql(type, boundSql, cacheKey, this);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n```","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/comments/855394280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4848123087,"node_id":"MDExOkNsb3NlZEV2ZW50NDg0ODEyMzA4Nw==","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/4848123087","actor":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"43cf9d15375bfd88d5c39fbd80e215de1fc370ea","commit_url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/commits/43cf9d15375bfd88d5c39fbd80e215de1fc370ea","created_at":"2021-06-06T12:52:45Z","state_reason":null,"performed_via_github_app":null},{"id":5377427676,"node_id":"UNPE_lADOATsemM4u-O1hzwAAAAFAhQjc","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/5377427676","actor":{"login":"abel533","id":1787798,"node_id":"MDQ6VXNlcjE3ODc3OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1787798?v=4","gravatar_id":"","url":"https://api.github.com/users/abel533","html_url":"https://github.com/abel533","followers_url":"https://api.github.com/users/abel533/followers","following_url":"https://api.github.com/users/abel533/following{/other_user}","gists_url":"https://api.github.com/users/abel533/gists{/gist_id}","starred_url":"https://api.github.com/users/abel533/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abel533/subscriptions","organizations_url":"https://api.github.com/users/abel533/orgs","repos_url":"https://api.github.com/users/abel533/repos","events_url":"https://api.github.com/users/abel533/events{/privacy}","received_events_url":"https://api.github.com/users/abel533/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unpinned","commit_id":null,"commit_url":null,"created_at":"2021-09-29T01:20:23Z","performed_via_github_app":null},{"id":13790829681,"node_id":"REFE_lADOATsemM4u-O1hzwAAAAM1_1xx","url":"https://api.github.com/repos/pagehelper/Mybatis-PageHelper/issues/events/13790829681","actor":{"login":"kimwqy","id":76162651,"node_id":"MDQ6VXNlcjc2MTYyNjUx","avatar_url":"https://avatars.githubusercontent.com/u/76162651?v=4","gravatar_id":"","url":"https://api.github.com/users/kimwqy","html_url":"https://github.com/kimwqy","followers_url":"https://api.github.com/users/kimwqy/followers","following_url":"https://api.github.com/users/kimwqy/following{/other_user}","gists_url":"https://api.github.com/users/kimwqy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimwqy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimwqy/subscriptions","organizations_url":"https://api.github.com/users/kimwqy/orgs","repos_url":"https://api.github.com/users/kimwqy/repos","events_url":"https://api.github.com/users/kimwqy/events{/privacy}","received_events_url":"https://api.github.com/users/kimwqy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"43cf9d15375bfd88d5c39fbd80e215de1fc370ea","commit_url":"https://api.github.com/repos/Xugu-Open-Source/Mybatis-PageHelper/commits/43cf9d15375bfd88d5c39fbd80e215de1fc370ea","created_at":"2024-08-07T11:15:44Z","performed_via_github_app":null}]