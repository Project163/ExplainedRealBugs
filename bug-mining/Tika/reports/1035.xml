<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2683] Missing space and inappropriate new-line in Boilerpipe extracted text</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2683</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Boilerpipe extractor in Tika&#160;miss to capture&#160;the space and new-line character in HTML.&lt;/p&gt;

&lt;p&gt;Also, additional new-line characters are inserted in between the text.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Example URL&lt;/b&gt; - &lt;a href=&quot;https://en.wikipedia.org/wiki/Blobfish&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Blobfish&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Missing space&#160;in &quot;family Psychrolutidae&quot; and additional new-line characters around round brackets&#160; &apos;(&apos;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Related issue reported long back -&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Replicable everywhere in all environments&lt;/p&gt;</environment>
        <key id="13169578">TIKA-2683</key>
            <summary>Missing space and inappropriate new-line in Boilerpipe extracted text</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkrugler">Kenneth William Krugler</assignee>
                                    <reporter username="karanjeetsingh">Karanjeet Singh</reporter>
                        <labels>
                            <label>Boilerplate_Removal</label>
                            <label>boilerpipe</label>
                            <label>parser</label>
                    </labels>
                <created>Mon, 2 Jul 2018 17:50:29 +0000</created>
                <updated>Wed, 25 Jul 2018 18:39:14 +0000</updated>
                            <resolved>Wed, 18 Jul 2018 14:01:38 +0000</resolved>
                                    <version>1.18</version>
                                    <fixVersion>1.19</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16545646" author="githubbot" created="Mon, 16 Jul 2018 19:28:56 +0000"  >&lt;p&gt;karanjeets opened a new pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16545840" author="githubbot" created="Mon, 16 Jul 2018 22:58:26 +0000"  >&lt;p&gt;kkrugler commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r202850520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r202850520&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -17,11 +17,9 @@&lt;br/&gt;
 package org.apache.tika.parser.html;&lt;/p&gt;

&lt;p&gt; import java.io.Writer;&lt;br/&gt;
-import java.util.ArrayList;&lt;br/&gt;
-import java.util.BitSet;&lt;br/&gt;
-import java.util.List;&lt;br/&gt;
-import java.util.Locale;&lt;br/&gt;
+import java.util.*;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   In general we try to avoid importing `.&lt;b&gt;` (other than `Assert.&lt;/b&gt;`), though I see a few of these have slipped into the code in other places.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16545855" author="githubbot" created="Mon, 16 Jul 2018 23:19:31 +0000"  >&lt;p&gt;kkrugler commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r202854279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r202854279&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -230,14 +229,20 @@ public void endDocument() throws SAXException {&lt;br/&gt;
                     case CONTINUE:&lt;br/&gt;
                         // Now emit characters that are valid. Note that boilerpipe pre-increments the character index, so&lt;br/&gt;
                         // we have to follow suit.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (char[] chars : element.getCharacters()) {&lt;br/&gt;
+                        for (int i = 0; i &amp;lt; element.getCharacters().size(); i++) {&lt;br/&gt;
+                            char[] chars = element.getCharacters().get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
                             curCharsIndex++;&lt;br/&gt;
+                            boolean isValidCharacterRun = validCharacterRuns.get(curCharsIndex);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validCharacterRuns.get(curCharsIndex)) {&lt;br/&gt;
+                            // &lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&lt;/a&gt;&lt;br/&gt;
+                            // Allow exempted characters to be written&lt;br/&gt;
+                            if (isValidCharacterRun ||&lt;br/&gt;
+                                    (chars.length == 1 &amp;amp;&amp;amp; whitelistCharSet.contains(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
                                 delegate.characters(chars, 0, chars.length);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                                 // &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
+                                if (isValidCharacterRun &amp;amp;&amp;amp; i == element.getCharacters().size() - 1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I&apos;d move this block up one level - I don&apos;t believe it depends on the previous test (`isValidCharacterRun || (chars.length == 1...`) evaluating to true, right?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16545856" author="githubbot" created="Mon, 16 Jul 2018 23:20:31 +0000"  >&lt;p&gt;kkrugler commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r202854453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r202854453&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -230,14 +229,20 @@ public void endDocument() throws SAXException {&lt;br/&gt;
                     case CONTINUE:&lt;br/&gt;
                         // Now emit characters that are valid. Note that boilerpipe pre-increments the character index, so&lt;br/&gt;
                         // we have to follow suit.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (char[] chars : element.getCharacters()) {&lt;br/&gt;
+                        for (int i = 0; i &amp;lt; element.getCharacters().size(); i++) {&lt;br/&gt;
+                            char[] chars = element.getCharacters().get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
                             curCharsIndex++;&lt;br/&gt;
+                            boolean isValidCharacterRun = validCharacterRuns.get(curCharsIndex);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validCharacterRuns.get(curCharsIndex)) {&lt;br/&gt;
+                            // &lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&lt;/a&gt;&lt;br/&gt;
+                            // Allow exempted characters to be written&lt;br/&gt;
+                            if (isValidCharacterRun ||&lt;br/&gt;
+                                    (chars.length == 1 &amp;amp;&amp;amp; whitelistCharSet.contains(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
                                 delegate.characters(chars, 0, chars.length);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                                 // &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
+                                if (isValidCharacterRun &amp;amp;&amp;amp; i == element.getCharacters().size() - 1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Could you explain why we now want to check for `i == element.getCharacters().size() - 1`, where that wasn&apos;t previously done by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; title=&quot;No whitespace added if BoilerpipeContentHandler.setIncludeMarkup(true)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-961&quot;&gt;&lt;del&gt;TIKA-961&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16545858" author="githubbot" created="Mon, 16 Jul 2018 23:22:23 +0000"  >&lt;p&gt;kkrugler commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405410769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405410769&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   If it was possible to have a smaller, generic HTML file for the test then that would be better. I&apos;m almost certain Apache projects are OK with &lt;span class=&quot;error&quot;&gt;&amp;#91;CCA Share Alike&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://en.wikipedia.org/wiki/Wikipedia:Text_of_Creative_Commons_Attribution-ShareAlike_3.0_Unported_License&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Wikipedia:Text_of_Creative_Commons_Attribution-ShareAlike_3.0_Unported_License&lt;/a&gt;) but I&apos;d have to double-check.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547065" author="githubbot" created="Tue, 17 Jul 2018 20:23:11 +0000"  >&lt;p&gt;karanjeets commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r203165247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r203165247&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -17,11 +17,9 @@&lt;br/&gt;
 package org.apache.tika.parser.html;&lt;/p&gt;

&lt;p&gt; import java.io.Writer;&lt;br/&gt;
-import java.util.ArrayList;&lt;br/&gt;
-import java.util.BitSet;&lt;br/&gt;
-import java.util.List;&lt;br/&gt;
-import java.util.Locale;&lt;br/&gt;
+import java.util.*;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Sure, I will make the changes.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547107" author="githubbot" created="Tue, 17 Jul 2018 21:04:32 +0000"  >&lt;p&gt;karanjeets commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r203178168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r203178168&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -230,14 +229,20 @@ public void endDocument() throws SAXException {&lt;br/&gt;
                     case CONTINUE:&lt;br/&gt;
                         // Now emit characters that are valid. Note that boilerpipe pre-increments the character index, so&lt;br/&gt;
                         // we have to follow suit.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (char[] chars : element.getCharacters()) {&lt;br/&gt;
+                        for (int i = 0; i &amp;lt; element.getCharacters().size(); i++) {&lt;br/&gt;
+                            char[] chars = element.getCharacters().get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
                             curCharsIndex++;&lt;br/&gt;
+                            boolean isValidCharacterRun = validCharacterRuns.get(curCharsIndex);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validCharacterRuns.get(curCharsIndex)) {&lt;br/&gt;
+                            // &lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&lt;/a&gt;&lt;br/&gt;
+                            // Allow exempted characters to be written&lt;br/&gt;
+                            if (isValidCharacterRun ||&lt;br/&gt;
+                                    (chars.length == 1 &amp;amp;&amp;amp; whitelistCharSet.contains(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
                                 delegate.characters(chars, 0, chars.length);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                                 // &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
+                                if (isValidCharacterRun &amp;amp;&amp;amp; i == element.getCharacters().size() - 1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   That&apos;s correct. I will move this one level up. &#128077; &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547119" author="githubbot" created="Tue, 17 Jul 2018 21:17:48 +0000"  >&lt;p&gt;karanjeets commented on a change in pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#discussion_r203181822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#discussion_r203181822&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -230,14 +229,20 @@ public void endDocument() throws SAXException {&lt;br/&gt;
                     case CONTINUE:&lt;br/&gt;
                         // Now emit characters that are valid. Note that boilerpipe pre-increments the character index, so&lt;br/&gt;
                         // we have to follow suit.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (char[] chars : element.getCharacters()) {&lt;br/&gt;
+                        for (int i = 0; i &amp;lt; element.getCharacters().size(); i++) {&lt;br/&gt;
+                            char[] chars = element.getCharacters().get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
                             curCharsIndex++;&lt;br/&gt;
+                            boolean isValidCharacterRun = validCharacterRuns.get(curCharsIndex);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validCharacterRuns.get(curCharsIndex)) {&lt;br/&gt;
+                            // &lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&lt;/a&gt;&lt;br/&gt;
+                            // Allow exempted characters to be written&lt;br/&gt;
+                            if (isValidCharacterRun ||&lt;br/&gt;
+                                    (chars.length == 1 &amp;amp;&amp;amp; whitelistCharSet.contains(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
                                 delegate.characters(chars, 0, chars.length);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                                 // &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
+                                if (isValidCharacterRun &amp;amp;&amp;amp; i == element.getCharacters().size() - 1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   It seems `element.getCharacters()` returns a section which corresponds to a tag in the HTML web page. Inside that there are sub-sections created by char length or other heuristics based on the BoilerPipe algorithm. &lt;/p&gt;

&lt;p&gt;   This check ensures that we are detecting/adding whitespace characters at the end of section and not in between. The current behavior doesn&apos;t take care of this and you may see improper new-line characters between the text (Example - &lt;a href=&quot;https://en.wikipedia.org/wiki/Blobfish&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Blobfish&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547120" author="githubbot" created="Tue, 17 Jul 2018 21:20:01 +0000"  >&lt;p&gt;karanjeets commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405731722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405731722&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @kkrugler - Thanks a lot for your quick review. I will update the PR with suggested changes and will try to create a smaller/generic HTML file for the test.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547217" author="githubbot" created="Tue, 17 Jul 2018 23:27:52 +0000"  >&lt;p&gt;karanjeets commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405759871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405759871&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @kkrugler - Updated the PR. Please review.&lt;/p&gt;

&lt;p&gt;   Honestly, the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; title=&quot;No whitespace added if BoilerpipeContentHandler.setIncludeMarkup(true)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-961&quot;&gt;&lt;del&gt;TIKA-961&lt;/del&gt;&lt;/a&gt; seems a hack to me. Ideally, there should be a `ContentHandler` which look at the respective HTML tags and append new-line characters accordingly, similar to `XHTMLContentHandler` logic but without HTML tags. Do you know if anything like this already exist in Tika?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547226" author="githubbot" created="Tue, 17 Jul 2018 23:38:53 +0000"  >&lt;p&gt;kkrugler commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405761718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405761718&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @karanjeets - I agree that &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; title=&quot;No whitespace added if BoilerpipeContentHandler.setIncludeMarkup(true)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-961&quot;&gt;&lt;del&gt;TIKA-961&lt;/del&gt;&lt;/a&gt; seems clunky. I&apos;m not sure trying to push the logic up one level would work, in terms of having sufficient context to guess at the right time(s) to insert newline characters. Though before really commenting, I&apos;d have to dig back into Boilerpipe logic to better understand the root cause of the problem.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547231" author="githubbot" created="Tue, 17 Jul 2018 23:53:27 +0000"  >&lt;p&gt;karanjeets commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405764126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405764126&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @kkrugler - I see. Well, I hope this PR resolves some of the whitespace issues. Thanks for reviewing the code changes.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547870" author="githubbot" created="Wed, 18 Jul 2018 13:54:54 +0000"  >&lt;p&gt;kkrugler closed pull request #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java b/tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
index 4d5cc46d4..191d8b8e2 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
@@ -21,7 +21,9 @@&lt;br/&gt;
 import java.util.BitSet;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Locale;&lt;br/&gt;
+import java.util.Set;&lt;/p&gt;

&lt;p&gt;+import com.google.common.collect.Sets;&lt;br/&gt;
 import de.l3s.boilerpipe.BoilerpipeExtractor;&lt;br/&gt;
 import de.l3s.boilerpipe.BoilerpipeProcessingException;&lt;br/&gt;
 import de.l3s.boilerpipe.document.TextBlock;&lt;br/&gt;
@@ -58,6 +60,7 @@&lt;br/&gt;
     private int headerCharOffset;&lt;br/&gt;
     private List&amp;lt;RecordedElement&amp;gt; elements;&lt;br/&gt;
     private TextDocument td;&lt;br/&gt;
+    private Set&amp;lt;Character&amp;gt; whitelistCharSet = Sets.newHashSet(&apos; &apos;, &apos;\n&apos;, &apos;\r&apos;);&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Creates a new boilerpipe-based content extractor, using the&lt;/li&gt;
	&lt;li&gt;{@link DefaultExtractor}
&lt;p&gt; extraction rules and &quot;delegate&quot; as the content handler.&lt;br/&gt;
@@ -120,7 +123,7 @@ public void startDocument() throws SAXException {&lt;br/&gt;
         headerCharOffset = 0;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         if (includeMarkup) &lt;/p&gt;
{
-            elements = new ArrayList&amp;lt;RecordedElement&amp;gt;();
+            elements = new ArrayList&amp;lt;&amp;gt;();
         }
&lt;p&gt;     }&lt;/p&gt;

&lt;p&gt;@@ -230,18 +233,24 @@ public void endDocument() throws SAXException {&lt;br/&gt;
                     case CONTINUE:&lt;br/&gt;
                         // Now emit characters that are valid. Note that boilerpipe pre-increments the character index, so&lt;br/&gt;
                         // we have to follow suit.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (char[] chars : element.getCharacters()) {&lt;br/&gt;
+                        for (int i = 0; i &amp;lt; element.getCharacters().size(); i++) {&lt;br/&gt;
+                            char[] chars = element.getCharacters().get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
                             curCharsIndex++;&lt;br/&gt;
+                            boolean isValidCharacterRun = validCharacterRuns.get(curCharsIndex);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validCharacterRuns.get(curCharsIndex)) {&lt;br/&gt;
+                            // &lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&lt;/a&gt;&lt;br/&gt;
+                            // Allow exempted characters to be written&lt;br/&gt;
+                            if (isValidCharacterRun ||&lt;br/&gt;
+                                    (chars.length == 1 &amp;amp;&amp;amp; whitelistCharSet.contains(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;))) 
{
                                 delegate.characters(chars, 0, chars.length);
+                            }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;if (!Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) {&lt;/li&gt;
	&lt;li&gt;// Only add whitespace for certain elements&lt;/li&gt;
	&lt;li&gt;if (XHTMLContentHandler.ENDLINE.contains(element.getLocalName())) 
{
-                                        delegate.ignorableWhitespace(NL, 0, NL.length);
-                                    }
&lt;p&gt;+                            // &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-961&lt;/a&gt;&lt;br/&gt;
+                            if (isValidCharacterRun &amp;amp;&amp;amp; i == element.getCharacters().size() - 1&lt;br/&gt;
+                                    &amp;amp;&amp;amp; !Character.isWhitespace(chars&lt;span class=&quot;error&quot;&gt;&amp;#91;chars.length - 1&amp;#93;&lt;/span&gt;)) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                                // Only add whitespace for certain elements+                                if (XHTMLContentHandler.ENDLINE.contains(element.getLocalName())) {
+                                    delegate.ignorableWhitespace(NL, 0, NL.length);
                                 }                             }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;                         }&lt;br/&gt;
diff --git a/tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java b/tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;br/&gt;
index 0ad10949d..ab745f36d 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;br/&gt;
+++ b/tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;br/&gt;
@@ -29,7 +29,6 @@&lt;br/&gt;
 import javax.xml.transform.sax.TransformerHandler;&lt;br/&gt;
 import javax.xml.transform.stream.StreamResult;&lt;br/&gt;
 import java.io.ByteArrayInputStream;&lt;br/&gt;
-import java.io.ByteArrayOutputStream;&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.io.InputStream;&lt;br/&gt;
@@ -54,7 +53,6 @@&lt;br/&gt;
 import java.util.concurrent.Future;&lt;br/&gt;
 import java.util.regex.Pattern;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
 import org.apache.tika.Tika;&lt;br/&gt;
 import org.apache.tika.TikaTest;&lt;br/&gt;
 import org.apache.tika.config.ServiceLoader;&lt;br/&gt;
@@ -62,7 +60,6 @@&lt;br/&gt;
 import org.apache.tika.detect.AutoDetectReader;&lt;br/&gt;
 import org.apache.tika.detect.EncodingDetector;&lt;br/&gt;
 import org.apache.tika.exception.TikaException;&lt;br/&gt;
-import org.apache.tika.io.IOUtils;&lt;br/&gt;
 import org.apache.tika.io.TikaInputStream;&lt;br/&gt;
 import org.apache.tika.metadata.Geographic;&lt;br/&gt;
 import org.apache.tika.metadata.Metadata;&lt;br/&gt;
@@ -70,7 +67,6 @@&lt;br/&gt;
 import org.apache.tika.parser.AutoDetectParser;&lt;br/&gt;
 import org.apache.tika.parser.ParseContext;&lt;br/&gt;
 import org.apache.tika.parser.Parser;&lt;br/&gt;
-import org.apache.tika.parser.RecursiveParserWrapper;&lt;br/&gt;
 import org.apache.tika.sax.AbstractRecursiveParserWrapperHandler;&lt;br/&gt;
 import org.apache.tika.sax.BodyContentHandler;&lt;br/&gt;
 import org.apache.tika.sax.LinkContentHandler;&lt;br/&gt;
@@ -923,6 +919,34 @@ public void testBoilerplateWhitespace() throws Exception &lt;/p&gt;
{
         assertContains(&quot;&#26377;&#20160;&#20040;&#38656;&#35201;&#25105;&#24110;&#20320;&#30340;&quot;, content);
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+     *&lt;br/&gt;
+     * @see &amp;lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA/issues/TIKA-2683&quot;&amp;gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt;&amp;lt;/a&amp;gt;&lt;br/&gt;
+     */&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testBoilerplateMissingWhitespace() throws Exception &lt;/p&gt;
{
+        String path = &quot;/test-documents/testBoilerplateMissingSpace.html&quot;;
+
+        Metadata metadata = new Metadata();
+        BodyContentHandler handler = new BodyContentHandler();
+
+        BoilerpipeContentHandler bpHandler = new BoilerpipeContentHandler(handler);
+        bpHandler.setIncludeMarkup(true);
+
+        new HtmlParser().parse(
+                HtmlParserTest.class.getResourceAsStream(path),
+                bpHandler, metadata, new ParseContext());
+
+        String content = handler.toString();
+
+        // Should contain space between these two words as mentioned in HTML
+        assertContains(&quot;family Psychrolutidae&quot;, content);
+
+        // Shouldn&apos;t add new-line chars around brackets; This is not how the HTML look
+        assertContains(&quot;(Psychrolutes marcidus)&quot;, content);
+    }
&lt;p&gt;+&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-983&quot; title=&quot;HTML parser should add Open Graph meta tag data to Metadata returned by parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-983&quot;&gt;&lt;del&gt;TIKA-983&lt;/del&gt;&lt;/a&gt;:  HTML parser should add Open Graph meta tag data to Metadata returned by parser&lt;br/&gt;
      *&lt;br/&gt;
diff --git a/tika-parsers/src/test/resources/test-documents/testBoilerplateMissingSpace.html b/tika-parsers/src/test/resources/test-documents/testBoilerplateMissingSpace.html&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 000000000..06ea45832
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/tika-parsers/src/test/resources/test-documents/testBoilerplateMissingSpace.html&lt;br/&gt;
@@ -0,0 +1,13 @@&lt;br/&gt;
+&amp;lt;!DOCTYPE html&amp;gt;&lt;br/&gt;
+&amp;lt;html&amp;gt;&lt;br/&gt;
+	&amp;lt;head&amp;gt;&lt;br/&gt;
+		&amp;lt;meta charset=&quot;UTF-8&quot;/&amp;gt;&lt;br/&gt;
+		&amp;lt;title&amp;gt;Blobfish - Wikipedia&amp;lt;/title&amp;gt;&lt;br/&gt;
+	&amp;lt;/head&amp;gt;&lt;br/&gt;
+	&amp;lt;body&amp;gt;&lt;br/&gt;
+		&amp;lt;p&amp;gt;The &amp;lt;b&amp;gt;blobfish&amp;lt;/b&amp;gt; (&amp;lt;i&amp;gt;Psychrolutes marcidus&amp;lt;/i&amp;gt;) is a &amp;lt;a href=&quot;/wiki/Deep_sea_fish&quot; title=&quot;Deep sea fish&quot;&amp;gt;deep sea fish&amp;lt;/a&amp;gt; of the &amp;lt;a href=&quot;/wiki/Family_(biology)&quot; title=&quot;Family (biology)&quot;&amp;gt;family&amp;lt;/a&amp;gt; &amp;lt;a href=&quot;/wiki/Psychrolutidae&quot; title=&quot;Psychrolutidae&quot;&amp;gt;Psychrolutidae&amp;lt;/a&amp;gt;. It inhabits the deep waters off the coasts of mainland &amp;lt;a href=&quot;/wiki/Australia&quot; title=&quot;Australia&quot;&amp;gt;Australia&amp;lt;/a&amp;gt; and &amp;lt;a href=&quot;/wiki/Tasmania&quot; title=&quot;Tasmania&quot;&amp;gt;Tasmania&amp;lt;/a&amp;gt;, as well as the waters of &amp;lt;a href=&quot;/wiki/New_Zealand&quot; title=&quot;New Zealand&quot;&amp;gt;New Zealand&amp;lt;/a&amp;gt;.&amp;lt;sup id=&quot;cite_ref-fishbase_1-0&quot; class=&quot;reference&quot;&amp;gt;&amp;lt;a href=&quot;#cite_note-fishbase-1&quot;&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/sup&amp;gt;&amp;lt;/p&amp;gt;&lt;br/&gt;
+		&amp;lt;p&amp;gt;Blobfish are typically shorter than 30&amp;#160;cm (12&amp;#160;in). They live at depths between 600 and 1,200&amp;#160;m (2,000 and 3,900&amp;#160;ft) where the pressure is 60 to 120 times as great as at &amp;lt;a href=&quot;/wiki/Sea_level&quot; title=&quot;Sea level&quot;&amp;gt;sea level&amp;lt;/a&amp;gt;, which would likely make &amp;lt;a href=&quot;/wiki/Gas_bladder&quot; class=&quot;mw-redirect&quot; title=&quot;Gas bladder&quot;&amp;gt;gas bladders&amp;lt;/a&amp;gt; inefficient for maintaining &amp;lt;a href=&quot;/wiki/Buoyancy&quot; title=&quot;Buoyancy&quot;&amp;gt;buoyancy&amp;lt;/a&amp;gt;.&amp;lt;sup id=&quot;cite_ref-fishbase_1-1&quot; class=&quot;reference&quot;&amp;gt;&amp;lt;a href=&quot;#cite_note-fishbase-1&quot;&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/sup&amp;gt; Instead, the flesh of the blobfish is primarily a gelatinous mass with a &amp;lt;a href=&quot;/wiki/Density&quot; title=&quot;Density&quot;&amp;gt;density&amp;lt;/a&amp;gt; slightly less than water; this allows the fish to float above the sea floor without expending energy on swimming. Its relative lack of muscle is not a disadvantage as it primarily swallows &amp;lt;a href=&quot;/wiki/Marine_snow&quot; title=&quot;Marine snow&quot;&amp;gt;edible matter&amp;lt;/a&amp;gt; that floats in front of it such as deep-ocean &amp;lt;a href=&quot;/wiki/Crustacean&quot; title=&quot;Crustacean&quot;&amp;gt;crustaceans&amp;lt;/a&amp;gt;.&amp;lt;sup id=&quot;cite_ref-2&quot; class=&quot;reference&quot;&amp;gt;&amp;lt;a href=&quot;#cite_note-2&quot;&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/sup&amp;gt;&amp;lt;/p&amp;gt;&lt;br/&gt;
+		&amp;lt;p&amp;gt;Blobfish are often caught as &amp;lt;a href=&quot;/wiki/Bycatch&quot; title=&quot;Bycatch&quot;&amp;gt;bycatch&amp;lt;/a&amp;gt; in &amp;lt;a href=&quot;/wiki/Bottom_trawling&quot; title=&quot;Bottom trawling&quot;&amp;gt;bottom trawling&amp;lt;/a&amp;gt; nets.&amp;lt;/p&amp;gt;&lt;br/&gt;
+		&amp;lt;p&amp;gt;The popular impression of the blobfish as bulbous and gelatinous is partially an artifact of the decompression damage done to specimens when they are brought to the surface from the extreme depths in which they live.&amp;lt;sup id=&quot;cite_ref-3&quot; class=&quot;reference&quot;&amp;gt;&amp;lt;a href=&quot;#cite_note-3&quot;&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/sup&amp;gt; In their natural environment, blobfish appear more typical of their &amp;lt;a href=&quot;/wiki/Superclass_(biology)&quot; class=&quot;mw-redirect&quot; title=&quot;Superclass (biology)&quot;&amp;gt;superclass&amp;lt;/a&amp;gt; &amp;lt;a href=&quot;/wiki/Osteichthyes&quot; title=&quot;Osteichthyes&quot;&amp;gt;Osteichthyes&amp;lt;/a&amp;gt; (bony fish).&amp;lt;/p&amp;gt;&lt;br/&gt;
+	&amp;lt;/body&amp;gt;&lt;br/&gt;
+&amp;lt;/html&amp;gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547871" author="githubbot" created="Wed, 18 Jul 2018 13:55:13 +0000"  >&lt;p&gt;kkrugler commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-405939525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-405939525&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks @karanjeets!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16547878" author="kkrugler" created="Wed, 18 Jul 2018 14:01:38 +0000"  >&lt;p&gt;Fixed via &lt;a href=&quot;https://github.com/apache/tika/commit/8851d511c4768a3200eafa06237b99ec263a201a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #243&lt;/a&gt; from Karanjeet Singh.&lt;/p&gt;</comment>
                            <comment id="16548200" author="hudson" created="Wed, 18 Jul 2018 18:17:17 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #285 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/285/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/285/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets (karanjeet_singh: rev 60bba0696868fe1bb027e2ab3e5b7bbfbd0b75cc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testBoilerplateMissingSpace.html&lt;br/&gt;
Add info about &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; fix (github: rev 80f6dc6e5cc10bb42590fcdf4540e59487f13fc6)&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16548220" author="hudson" created="Wed, 18 Jul 2018 18:26:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1521 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1521/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1521/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets (karanjeet_singh: &lt;a href=&quot;https://github.com/apache/tika/commit/60bba0696868fe1bb027e2ab3e5b7bbfbd0b75cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/60bba0696868fe1bb027e2ab3e5b7bbfbd0b75cc&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testBoilerplateMissingSpace.html&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/html/BoilerpipeContentHandler.java&lt;br/&gt;
Add info about &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; fix (github: &lt;a href=&quot;https://github.com/apache/tika/commit/80f6dc6e5cc10bb42590fcdf4540e59487f13fc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/80f6dc6e5cc10bb42590fcdf4540e59487f13fc6&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16548755" author="githubbot" created="Thu, 19 Jul 2018 03:46:03 +0000"  >&lt;p&gt;chrismattmann commented on issue #243: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2683&quot; title=&quot;Missing space and inappropriate new-line in Boilerpipe extracted text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2683&quot;&gt;&lt;del&gt;TIKA-2683&lt;/del&gt;&lt;/a&gt; contributed by karanjeets&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/243#issuecomment-406145594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/243#issuecomment-406145594&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   thanks for the review and commit @kkrugler and @karanjeets! &#128077; &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16556116" author="tallison@mitre.org" created="Wed, 25 Jul 2018 18:39:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkrugler&quot; class=&quot;user-hover&quot; rel=&quot;kkrugler&quot;&gt;kkrugler&lt;/a&gt;, any chance you could cherry-pick this into branch_1x?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12312720" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Docs Text</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Working on a patch for this issue.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vghr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>