<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2908] TikaException: Failed to close temporary resource - how to fix?</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2908</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I am using Apache Tika on Windows 10, jre 1.8.0_181, and I&apos;ve imported Tika using Maven with the following dependencies:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;dependencies&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;3.8.1&amp;lt;/version&amp;gt; &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.tika&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;tika-parsers&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.21&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;/dependencies&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I have the code below for performing OCR using Tesseract (which I have independently tested and know to be working):&lt;/p&gt;

&lt;p&gt;public static void OCRTest() {&lt;/p&gt;

&lt;p&gt;try {&#160;&lt;/p&gt;

&lt;p&gt;BufferedImage im = ImageIO.read(new File(OCR_IMAGE));&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;TesseractOCRConfig config = new TesseractOCRConfig();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;config.setTessdataPath(&quot;C:&lt;br/&gt;
Program Files\\Tesseract-OCR\tessdata&quot;);&lt;/p&gt;

&lt;p&gt;config.setTesseractPath(&quot;C:&lt;br/&gt;
Program Files&lt;br/&gt;
Tesseract-OCR&quot;);&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ParseContext parseContext = new ParseContext();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;parseContext.set(TesseractOCRConfig.class, config);&lt;/p&gt;

&lt;p&gt;TesseractOCRParser parser = new TesseractOCRParser();&lt;/p&gt;

&lt;p&gt;BodyContentHandler handler = new BodyContentHandler();&lt;/p&gt;

&lt;p&gt;Metadata metadata = new Metadata();&lt;/p&gt;

&lt;p&gt;try {&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;parser.parse(im, handler, metadata, parseContext);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;System.out.println(handler.toString());&lt;/p&gt;

&lt;p&gt;} catch (SAXException e){ e.printStackTrace(); }&lt;/p&gt;

&lt;p&gt;catch (TikaException e) { e.printStackTrace(); }&lt;/p&gt;

&lt;p&gt;} catch (IOException e){ e.printStackTrace(); }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;I run into the following exception:&lt;/p&gt;

&lt;p&gt;org.apache.tika.exception.TikaException: Failed to close temporary resources at org.apache.tika.io.TemporaryResources.dispose(TemporaryResources.java:174) at org.apache.tika.parser.ocr.TesseractOCRParser.parse(TesseractOCRParser.java:251) at test.test.App.OCRTest(App.java:46) at test.test.App.main(App.java:30) Caused by: java.nio.file.FileSystemException: C:\Users\m\AppData\Local\Temp\apache-tika-2643805894084124300.tmp: The process cannot access the file because it is being used by another process.&#160;&lt;/p&gt;

&lt;p&gt;The tmp file is present in the Temp folder. I have the source code downloaded and have stepped through it with the debugger - the error comes from attempting to close the tmp file. There is another post on this board (&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1732&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-1732&lt;/a&gt;)&#160;where someone else has run into the same exception, although with the AutoDetectParser and not Tesseract. Their issue seemed to be a conflict in their imported jars, but I run into this issue even with only the Apache Tika libraries installed. I have a feeling this is a concurrency issue, but I can&apos;t pinpoint the conflict.&lt;/p&gt;

&lt;p&gt;I don&apos;t run into this issue when using the Tika&apos;s AutoDetectParser, only with the TesseractOCRParser. This is an important part of an application I&apos;m working on, so I would really appreciate any insights on how to proceed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13245617">TIKA-2908</key>
            <summary>TikaException: Failed to close temporary resource - how to fix?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="marichi">Marichi Gupta</reporter>
                        <labels>
                            <label>ocr</label>
                            <label>tesseract</label>
                            <label>tika</label>
                    </labels>
                <created>Wed, 17 Jul 2019 20:34:52 +0000</created>
                <updated>Thu, 18 Jul 2019 20:06:48 +0000</updated>
                            <resolved>Thu, 18 Jul 2019 15:41:16 +0000</resolved>
                                    <version>1.21</version>
                                    <fixVersion>1.22</fixVersion>
                                    <component>ocr</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16887950" author="tallison@mitre.org" created="Thu, 18 Jul 2019 12:52:58 +0000"  >&lt;p&gt;As I look at this, I can&apos;t figure out why it works at all for others or even in unit tests:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            tmp.dispose();
            if (tis != null)
                tis.close();
            if (fos != null)
                fos.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should close the fos as soon as we write the tmp file.  We should close tis before we call tmp.dispose.... I think?&lt;/p&gt;</comment>
                            <comment id="16887986" author="tallison@mitre.org" created="Thu, 18 Jul 2019 13:42:38 +0000"  >&lt;p&gt;I cleaned up that part of the code a bit and pushed to master and branch_1x.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marichi&quot; class=&quot;user-hover&quot; rel=&quot;marichi&quot;&gt;marichi&lt;/a&gt;, I&apos;m not confident that will fix your problems, but if you could build locally or wait for a snapshot build and try it out, that&apos;d be great!&lt;/p&gt;</comment>
                            <comment id="16888017" author="hudson" created="Thu, 18 Jul 2019 14:16:30 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build tika-2.x-windows #433 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/433/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/433/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt; &amp;#8211; reorder closing of streams in tesseract parser (tallison: rev 477a8cad63c455be195e4a75468cc3e162e67688)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16888018" author="hudson" created="Thu, 18 Jul 2019 14:16:41 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #213 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/213/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/213/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt; &amp;#8211; reorder closing of streams in tesseract parser (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/8d386f827eb31e7f1cb189ce942c67a84a0c6bdc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/8d386f827eb31e7f1cb189ce942c67a84a0c6bdc&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16888057" author="hudson" created="Thu, 18 Jul 2019 15:08:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1681 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1681/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1681/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt; &amp;#8211; reorder closing of streams in tesseract parser (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/477a8cad63c455be195e4a75468cc3e162e67688&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/477a8cad63c455be195e4a75468cc3e162e67688&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16888072" author="marichi" created="Thu, 18 Jul 2019 15:30:47 +0000"  >&lt;p&gt;Hi Tim - thank you for the response, this seemed resolve the issue - I no longer receive the above exception. Just curious, could you explain how reordering the closing of the streams fixed this?&lt;/p&gt;

&lt;p&gt;Anyways, I have a local subclass of TesseractOCRParser where I overrode the parse method with the new one you provided - I&apos;ll use this until the next snapshot is available. Thanks again for the response.&lt;/p&gt;</comment>
                            <comment id="16888076" author="tallison@mitre.org" created="Thu, 18 Jul 2019 15:39:34 +0000"  >&lt;p&gt;&amp;gt;could you explain how reordering the closing of the streams fixed this?&lt;/p&gt;

&lt;p&gt;tmp holds the pointer to the tmp file and tries to delete the file when you dispose it.  In the earlier code, that was called before the fileoutputstream was closed on the tmp file and before the fileinputstream on that file was closed.   I, frankly, have no idea how that worked before... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16888259" author="hudson" created="Thu, 18 Jul 2019 19:12:05 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #214 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/214/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/214/&lt;/a&gt;)&lt;br/&gt;
Update changes.txt to reflect &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt;. (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/2f6255b4eb5857794a896076f4a88704f57319cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/2f6255b4eb5857794a896076f4a88704f57319cc&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16888263" author="hudson" created="Thu, 18 Jul 2019 19:16:21 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build tika-2.x-windows #434 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/434/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/434/&lt;/a&gt;)&lt;br/&gt;
Update changes.txt to reflect &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt;. (tallison: rev 806489b59aebe4208cd21ad40fa0cf2c9e0e35e7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16888289" author="hudson" created="Thu, 18 Jul 2019 20:06:48 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1682 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1682/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1682/&lt;/a&gt;)&lt;br/&gt;
Update changes.txt to reflect &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2908&quot; title=&quot;TikaException: Failed to close temporary resource - how to fix?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2908&quot;&gt;&lt;del&gt;TIKA-2908&lt;/del&gt;&lt;/a&gt;. (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/806489b59aebe4208cd21ad40fa0cf2c9e0e35e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/806489b59aebe4208cd21ad40fa0cf2c9e0e35e7&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04rxc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>