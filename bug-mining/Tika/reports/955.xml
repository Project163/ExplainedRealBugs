<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:01:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-1788] message/rfc822 parser doesn&apos;t identify attachment filenames from Content-Disposition header</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1788</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;rfc822 email files can contain attachments as subparts, and they&apos;ll&lt;br/&gt;
generally specify the filename of the attachment in a manner like&lt;br/&gt;
this:&lt;/p&gt;

&lt;p&gt;Content-Disposition: attachment;&lt;br/&gt;
        filename*=utf-8&apos;&apos;image001.jpg&lt;/p&gt;

&lt;p&gt;Tika doesn&apos;t seem to be grabbing that information at all!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12910965">TIKA-1788</key>
            <summary>message/rfc822 parser doesn&apos;t identify attachment filenames from Content-Disposition header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="SergeyTsalkov">Sergey Tsalkov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Nov 2015 06:30:30 +0000</created>
                <updated>Tue, 24 Oct 2017 19:35:41 +0000</updated>
                            <resolved>Tue, 24 Oct 2017 19:35:41 +0000</resolved>
                                    <version>1.11</version>
                                    <fixVersion>1.17</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14993539" author="gagravarr" created="Fri, 6 Nov 2015 11:38:20 +0000"  >&lt;p&gt;Any chance you could write a short junit test showing the problem, along with a small test email to use (assuming none of our test ones do it)?&lt;/p&gt;

&lt;p&gt;If you have a look at the &lt;tt&gt;testEmbedded()&lt;/tt&gt; method of the various &lt;tt&gt;org.apache.tika.parser.pkg&lt;/tt&gt; unit tests, those should give you a good pattern to use for writing a succinct junit test for embedded resources like this&lt;/p&gt;</comment>
                            <comment id="14993849" author="tallison@mitre.org" created="Fri, 6 Nov 2015 15:53:54 +0000"  >&lt;p&gt;May have some candidates...grep on our commoncrawl slice with plenty of false positives.&lt;/p&gt;

&lt;p&gt;To retrieve docs: switchout /data2 with &lt;a href=&quot;http://onesixtwo.twofourtwo.twotwoeight.onesevenfour&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://onesixtwo.twofourtwo.twotwoeight.onesevenfour&lt;/a&gt; ... well not quite, but you get the point. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15001773" author="vjeran@tis.hr" created="Thu, 12 Nov 2015 07:03:41 +0000"  >&lt;p&gt;I dunno James library at all, so cannot say if this would affect negatively some other portion of the parser, but...&lt;/p&gt;

&lt;p&gt;Thing is that current Tika&apos;s RFC822Parser sets indirectly James&apos; BasicBodyDescriptor instead of MaximalBodyDescriptor, and this is due to the way RFC822Parser instantiates james&apos; MimeStreamParser internally. If this instantiation would be by specifying DefaultBodyDescriptorBuilder:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MimeStreamParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MimeStreamParser(config, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultBodyDescriptorBuilder());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This way during James&apos; parsing, the MaximalBodyDescriptor would be created which recognizes Content-Disposition field, and it could be utilized in Tika&apos;s MailContentHandler, say in body(...) method if we add:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void body(BodyDescriptor body, InputStream is) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MimeException,
            IOException {
        &lt;span class=&quot;code-comment&quot;&gt;// use a different metadata object
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// in order to specify the mime type of the
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// sub part without damaging the main metadata
&lt;/span&gt;
        Metadata submd = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Metadata();
        submd.set(Metadata.CONTENT_TYPE, body.getMimeType());
        submd.set(Metadata.CONTENT_ENCODING, body.getCharset());
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MaximalBodyDescriptor) {
            MaximalBodyDescriptor maximalBodyDescriptor = (MaximalBodyDescriptor) body;
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; contentDispositionFilename = maximalBodyDescriptor.getContentDispositionFilename();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (contentDispositionFilename != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                submd.set(Metadata.RESOURCE_NAME_KEY, contentDispositionFilename);
            }
        }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15766074" author="derek.hardison" created="Wed, 21 Dec 2016 04:22:00 +0000"  >&lt;p&gt;The * indicates the name is wrapped and it can be any number of continuations... i.e. filename*0, filename*1, etc. will end up being concatenated into a single filename... then there are some rules on where the content-type etc is located when that happens.  You can find examples fairly easy.... i.e. exchange or gmail e-mails.&lt;/p&gt;

&lt;p&gt;You can find some information about it here;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc2231#section-4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://tools.ietf.org/html/rfc2231#section-4&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc5987#section-3.2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://tools.ietf.org/html/rfc5987#section-3.2.2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16201199" author="githubbot" created="Wed, 11 Oct 2017 23:39:39 +0000"  >&lt;p&gt;AarjavP opened a new pull request #211: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/211&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-1788&lt;/a&gt; old case but had the solution in it. Not sure why it never made it in.&lt;/p&gt;

&lt;p&gt;   There is other info available in `MaximalBodyDescriptor`. However I am not sure how they would map to fields in `Metadata` or if most files would even have that info*.&lt;/p&gt;

&lt;p&gt;   One piece of info that I would like to make available is either the whole `Content-Disposition` line which I am not sure how to get, or flags for `attachment`/`inline` that are almost always available with filename. Looking at the source code, it is parsed but hidden away behind a `private` field.&#128546; &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16202525" author="githubbot" created="Thu, 12 Oct 2017 19:53:01 +0000"  >&lt;p&gt;AarjavP commented on issue #211: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/211#issuecomment-336247381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/211#issuecomment-336247381&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   the second commit 9653e77 also provides `Content-Disposition` in the metadata of the embedded object&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16206460" author="githubbot" created="Mon, 16 Oct 2017 19:41:01 +0000"  >&lt;p&gt;tballison commented on issue #211: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/211#issuecomment-337012343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/211#issuecomment-337012343&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @AarjavP , I very much appreciate this PR.  I regret that I haven&apos;t been able to review it carefully yet, but I look forward to doing so over the next week or so (I hope).  Thank you!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16216124" author="githubbot" created="Tue, 24 Oct 2017 00:27:25 +0000"  >&lt;p&gt;tballison closed pull request #211: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/211&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java b/tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;br/&gt;
index 961ccfba1..7476347d5 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;br/&gt;
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;br/&gt;
@@ -27,6 +27,8 @@&lt;br/&gt;
 import java.text.SimpleDateFormat;&lt;br/&gt;
 import java.util.Date;&lt;br/&gt;
 import java.util.Locale;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Map.Entry;&lt;br/&gt;
 import java.util.TimeZone;&lt;br/&gt;
 import java.util.regex.Matcher;&lt;br/&gt;
 import java.util.regex.Pattern;&lt;br/&gt;
@@ -44,6 +46,7 @@&lt;br/&gt;
 import org.apache.james.mime4j.dom.field.ParsedField;&lt;br/&gt;
 import org.apache.james.mime4j.dom.field.UnstructuredField;&lt;br/&gt;
 import org.apache.james.mime4j.field.LenientFieldParser;&lt;br/&gt;
+import org.apache.james.mime4j.message.MaximalBodyDescriptor;&lt;br/&gt;
 import org.apache.james.mime4j.parser.ContentHandler;&lt;br/&gt;
 import org.apache.james.mime4j.stream.BodyDescriptor;&lt;br/&gt;
 import org.apache.james.mime4j.stream.Field;&lt;br/&gt;
@@ -151,6 +154,26 @@ public void body(BodyDescriptor body, InputStream is) throws MimeException,&lt;br/&gt;
         submd.set(Metadata.CONTENT_TYPE, body.getMimeType());&lt;br/&gt;
         submd.set(Metadata.CONTENT_ENCODING, body.getCharset());&lt;/p&gt;

&lt;p&gt;+        if (body instanceof MaximalBodyDescriptor) {&lt;br/&gt;
+            MaximalBodyDescriptor maximalBody = (MaximalBodyDescriptor) body;&lt;br/&gt;
+            String contentDispositionType = maximalBody.getContentDispositionType();&lt;br/&gt;
+            if (contentDispositionType != null &amp;amp;&amp;amp; !contentDispositionType.isEmpty()) {&lt;br/&gt;
+                StringBuilder contentDisposition = new StringBuilder( contentDispositionType );&lt;br/&gt;
+                Map&amp;lt;String, String&amp;gt; contentDispositionParameters = maximalBody.getContentDispositionParameters();&lt;br/&gt;
+                for ( Entry&amp;lt;String, String&amp;gt; param : contentDispositionParameters.entrySet() ) &lt;/p&gt;
{
+                    contentDisposition.append(&quot;; &quot;)
+                                      .append(param.getKey()).append(&quot;=\&quot;&quot;).append(param.getValue()).append(&apos;&quot;&apos;);
+                }
&lt;p&gt;+&lt;br/&gt;
+                String contentDispositionFileName = maximalBody.getContentDispositionFilename();&lt;br/&gt;
+                if ( contentDispositionFileName != null ) &lt;/p&gt;
{
+                    submd.set( Metadata.RESOURCE_NAME_KEY, contentDispositionFileName );
+                }
&lt;p&gt;+&lt;br/&gt;
+                submd.set( Metadata.CONTENT_DISPOSITION, contentDisposition.toString() );&lt;br/&gt;
+            }&lt;br/&gt;
+        }&lt;br/&gt;
+&lt;br/&gt;
         try {&lt;br/&gt;
             if (extractor.shouldParseEmbedded(submd)) {&lt;br/&gt;
                 // Wrap the InputStream before passing on, as the James provided&lt;br/&gt;
diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/mail/RFC822Parser.java b/tika-parsers/src/main/java/org/apache/tika/parser/mail/RFC822Parser.java&lt;br/&gt;
index ff546f48a..03bce971d 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/main/java/org/apache/tika/parser/mail/RFC822Parser.java&lt;br/&gt;
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/mail/RFC822Parser.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import java.util.Set;&lt;/p&gt;

&lt;p&gt; import org.apache.james.mime4j.MimeException;&lt;br/&gt;
+import org.apache.james.mime4j.message.DefaultBodyDescriptorBuilder;&lt;br/&gt;
 import org.apache.james.mime4j.parser.MimeStreamParser;&lt;br/&gt;
 import org.apache.james.mime4j.stream.MimeConfig;&lt;br/&gt;
 import org.apache.tika.exception.TikaException;&lt;br/&gt;
@@ -67,7 +68,7 @@ public void parse(InputStream stream, ContentHandler handler,&lt;/p&gt;

&lt;p&gt;         config = context.get(MimeConfig.class, config);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MimeStreamParser parser = new MimeStreamParser(config);&lt;br/&gt;
+        MimeStreamParser parser = new MimeStreamParser(config, null, new DefaultBodyDescriptorBuilder());&lt;br/&gt;
         XHTMLContentHandler xhtml = new XHTMLContentHandler(handler, metadata);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         MailContentHandler mch = new MailContentHandler(&lt;br/&gt;
diff --git a/tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java b/tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;br/&gt;
index 025273c77..09cad0cf0 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;br/&gt;
+++ b/tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;br/&gt;
@@ -425,7 +425,8 @@ public void testGetAttachmentsAsEmbeddedResources() throws Exception {&lt;br/&gt;
         // No filenames available&lt;br/&gt;
         assertEquals(null, tracker.filenames.get(0));&lt;br/&gt;
         assertEquals(null, tracker.filenames.get(1));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assertEquals(null, tracker.filenames.get(2));&lt;br/&gt;
+        // Except for this using Content-Disposition filename field&lt;br/&gt;
+        assertEquals(&quot;logo.gif&quot;, tracker.filenames.get(2));&lt;br/&gt;
         // Types are available&lt;br/&gt;
         assertEquals(MediaType.TEXT_PLAIN, tracker.mediaTypes.get(0));&lt;br/&gt;
         assertEquals(MediaType.TEXT_HTML, tracker.mediaTypes.get(1));&lt;br/&gt;
@@ -560,6 +561,8 @@ public void testExtractAttachments() throws Exception {&lt;br/&gt;
         final Parser extParser = new AutoDetectParser();&lt;br/&gt;
         final List&amp;lt;MediaType&amp;gt; seenTypes = new ArrayList&amp;lt;MediaType&amp;gt;();&lt;br/&gt;
         final List&amp;lt;String&amp;gt; seenText = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
+        final List&amp;lt;String&amp;gt; seenNames = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
+        final List&amp;lt;String&amp;gt; seenContentDisposition = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
         EmbeddedDocumentExtractor ext = new EmbeddedDocumentExtractor() {&lt;br/&gt;
             @Override&lt;br/&gt;
             public boolean shouldParseEmbedded(Metadata metadata) {&lt;br/&gt;
@@ -570,7 +573,9 @@ public boolean shouldParseEmbedded(Metadata metadata) {&lt;br/&gt;
             public void parseEmbedded(InputStream stream, ContentHandler handler,&lt;br/&gt;
                     Metadata metadata, boolean outputHtml) throws SAXException,&lt;br/&gt;
                     IOException {&lt;br/&gt;
+                seenNames.add( metadata.get(Metadata.RESOURCE_NAME_KEY) );&lt;br/&gt;
                 seenTypes.add( detector.detect(stream, metadata) );&lt;br/&gt;
+                seenContentDisposition.add( metadata.get(Metadata.CONTENT_DISPOSITION) );&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                 ContentHandler h = new BodyContentHandler();&lt;br/&gt;
                 try &lt;/p&gt;
{
@@ -596,6 +601,52 @@ public void parseEmbedded(InputStream stream, ContentHandler handler,
         assertEquals(2, seenText.size());
         assertEquals(&quot;text/plain&quot;, seenTypes.get(0).toString());
         assertEquals(&quot;image/png&quot;, seenTypes.get(1).toString());
+        assertEquals(&quot;testPNG.png&quot;, seenNames.get(1));
         assertEquals(&quot;This email has a PNG attachment included in it\n\n&quot;, seenText.get(0));
+        assertEquals(null, seenContentDisposition.get(0));
+        assertEquals(&quot;attachment; filename=\&quot;testPNG.png\&quot;&quot;, seenContentDisposition.get(1));
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testEmbeddedMetadata() throws Exception {&lt;br/&gt;
+        Metadata metadata = new Metadata();&lt;br/&gt;
+        Parser p = new RFC822Parser();&lt;br/&gt;
+        ParseContext context = new ParseContext();&lt;br/&gt;
+        final Parser extParser = new AutoDetectParser();&lt;br/&gt;
+        final List&amp;lt;Metadata&amp;gt; seenMetadata = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
+        EmbeddedDocumentExtractor ext = new EmbeddedDocumentExtractor() {&lt;br/&gt;
+            @Override&lt;br/&gt;
+            public boolean shouldParseEmbedded(Metadata metadata) &lt;/p&gt;
{
+                return true;
+            }
&lt;p&gt;+&lt;br/&gt;
+            @Override&lt;br/&gt;
+            public void parseEmbedded(InputStream stream, ContentHandler handler,&lt;br/&gt;
+                                      Metadata metadata, boolean outputHtml) throws SAXException,&lt;br/&gt;
+                                                                                    IOException {&lt;br/&gt;
+                seenMetadata.add( metadata );&lt;br/&gt;
+                try &lt;/p&gt;
{
+                    extParser.parse(stream, new DefaultHandler(), metadata, new ParseContext());
+                }
&lt;p&gt; catch (TikaException e) &lt;/p&gt;
{
+                    throw new RuntimeException(e);
+                }
&lt;p&gt;+            }&lt;br/&gt;
+        };&lt;br/&gt;
+        context.set(EmbeddedDocumentExtractor.class, ext);&lt;br/&gt;
+&lt;br/&gt;
+        try(InputStream stream = getStream( &quot;test-documents/testRFC822-multipart&quot; )) &lt;/p&gt;
{
+            p.parse(stream, new DefaultHandler(), metadata, context);
+        }
&lt;p&gt;+&lt;br/&gt;
+        assertEquals(3, seenMetadata.size());&lt;br/&gt;
+        assertEquals(null, seenMetadata.get(0).get(Metadata.CONTENT_DISPOSITION));&lt;br/&gt;
+        assertEquals(&quot;text/plain; charset=UTF-8&quot;, seenMetadata.get(0).get(Metadata.CONTENT_TYPE));&lt;br/&gt;
+        assertEquals(&quot;UTF-8&quot;, seenMetadata.get(0).get(Metadata.CONTENT_ENCODING));&lt;br/&gt;
+        assertEquals(null, seenMetadata.get(1).get(Metadata.CONTENT_DISPOSITION));&lt;br/&gt;
+        assertEquals(&quot;text/html; charset=UTF-8&quot;, seenMetadata.get(1).get(Metadata.CONTENT_TYPE));&lt;br/&gt;
+        assertEquals(&quot;UTF-8&quot;, seenMetadata.get(1).get(Metadata.CONTENT_ENCODING));&lt;br/&gt;
+        assertEquals(&quot;attachment; filename=\&quot;logo.gif\&quot;&quot;, seenMetadata.get(2).get(Metadata.CONTENT_DISPOSITION));&lt;br/&gt;
+        assertEquals(&quot;logo.gif&quot;, seenMetadata.get(2).get(Metadata.RESOURCE_NAME_KEY));&lt;br/&gt;
+        assertEquals(&quot;image/gif&quot;, seenMetadata.get(2).get(Metadata.CONTENT_TYPE));&lt;br/&gt;
     }&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16216125" author="githubbot" created="Tue, 24 Oct 2017 00:27:39 +0000"  >&lt;p&gt;tballison commented on issue #211: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/211#issuecomment-338834900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/211#issuecomment-338834900&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thank you!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16216320" author="hudson" created="Tue, 24 Oct 2017 05:03:15 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1381 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1381/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1381/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; RFC822Parser: provide email attachment filenames when (aarjav: &lt;a href=&quot;https://github.com/apache/tika/commit/18aa69a16f09232413e06d04e921427ff4356cec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/18aa69a16f09232413e06d04e921427ff4356cec&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/mail/RFC822Parser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1788&quot; title=&quot;message/rfc822 parser doesn&amp;#39;t identify attachment filenames from Content-Disposition header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1788&quot;&gt;&lt;del&gt;TIKA-1788&lt;/del&gt;&lt;/a&gt; Provide Content-Disposition metadata in embedded files (aarjav: &lt;a href=&quot;https://github.com/apache/tika/commit/9653e77d935bb00b7a38be483991e8e185f751ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/9653e77d935bb00b7a38be483991e8e185f751ff&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16217533" author="tallison@mitre.org" created="Tue, 24 Oct 2017 19:35:41 +0000"  >&lt;p&gt;Thank you, AarjavP!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13109841">TIKA-2478</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12771042" name="grep_content_disposition.zip" size="33990" author="tallison" created="Fri, 6 Nov 2015 15:53:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o1n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>