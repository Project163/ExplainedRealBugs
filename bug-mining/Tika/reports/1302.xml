<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:04:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3827] Word Document extracted mpga file extension instead of bitmap </title>
                <link>https://issues.apache.org/jira/browse/TIKA-3827</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When tried to parser the .doc document it is extracted two mpga files which can&apos;t be open to play. We are suspecting they should be bitmap image files. The Tika version we are using is 2.4.1.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13047599/13047599_example.DOC&quot; title=&quot;example.DOC attached to TIKA-3827&quot;&gt;example.DOC&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13474830">TIKA-3827</key>
            <summary>Word Document extracted mpga file extension instead of bitmap </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Vamsi452">Tika User</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Aug 2022 07:17:33 +0000</created>
                <updated>Mon, 8 Aug 2022 13:55:00 +0000</updated>
                                                                            <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17574695" author="vamsi452" created="Wed, 3 Aug 2022 12:16:10 +0000"  >&lt;p&gt;Its&#160; is reading it as FilesYO.RF and while extracting the content itself the embedded file contains two file with .mpga extension.&lt;/p&gt;</comment>
                            <comment id="17574756" author="tallison@mitre.org" created="Wed, 3 Aug 2022 14:56:00 +0000"  >&lt;p&gt;The RTFParser runs file type detection on embedded files. That process is identifying these as mpga.  I agree that the files are bitmap, and the RTF file encodes that with: &lt;tt&gt;\bitmap&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;So, should we turn off file type detection if the RTF alleges that the embedded file is a pict/bitmap?  Or do we need to improve our mpga handling?&lt;/p&gt;</comment>
                            <comment id="17574757" author="vamsi452" created="Wed, 3 Aug 2022 15:08:07 +0000"  >&lt;p&gt;I think based on above document, I can say that from Tika should turn off file type detection if the RTF alleges that the embedded file is a pict/bitmap.&lt;/p&gt;</comment>
                            <comment id="17574765" author="vamsi452" created="Wed, 3 Aug 2022 15:18:22 +0000"  >&lt;p&gt;I think both because when I process extracted document separately it is treating it as mpga instead of png/bitmap.&lt;/p&gt;</comment>
                            <comment id="17574779" author="tallison@mitre.org" created="Wed, 3 Aug 2022 16:17:01 +0000"  >&lt;p&gt;It looks like the embedded files do not have bmp headers.  Are they just the raw bytes after what would be the header?  If you extract them (attached), are you able to open them?&lt;/p&gt;

&lt;p&gt;Magic isn&apos;t working because they don&apos;t have headers.  I&apos;m working on adding a mime type hint if \wbitmap is encountered.&lt;/p&gt;</comment>
                            <comment id="17575047" author="vamsi452" created="Thu, 4 Aug 2022 06:08:23 +0000"  >&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I tried to open the extracted file in paint I am seeing the below error.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13047659/13047659_image-2022-08-04-10-53-48-894.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17575184" author="tallison@mitre.org" created="Thu, 4 Aug 2022 10:06:09 +0000"  >&lt;p&gt;Ah, ok, thank you.  Good to have confirmation from a Windows application. I don&apos;t know if this is a feature of how RTF embeds bitmaps (without headers) or if the file is corrupted.  If you open the file in a hex editor, you can see the bytes are extracted properly and that the files do not start with &quot;BM&quot; (see eg: &lt;a href=&quot;https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5&lt;/a&gt;).  This is the reason that Tika&apos;s mime detection on the bytes of these images is failing.  There&apos;s no header.&lt;/p&gt;</comment>
                            <comment id="17575193" author="vamsi452" created="Thu, 4 Aug 2022 10:17:37 +0000"  >&lt;p&gt;But if we look into the original document we are seeing those images. So if it is not bitmap then because it has no header&apos;s, may I know the rules why it is detecting it as mpga file, due that extensions we are trying to play the file but couldn&apos;t.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13047689/13047689_image-2022-08-04-15-44-48-396.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13047690/13047690_image-2022-08-04-15-45-10-892.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17575195" author="tallison@mitre.org" created="Thu, 4 Aug 2022 10:25:47 +0000"  >&lt;p&gt;Ah, thank you.  I hadn&apos;t noticed the images when I opened the file in an application.  The rule that triggers mpga is here: &lt;a href=&quot;https://github.com/apache/tika/blob/main/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml#L5232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/blob/main/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml#L5232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t notice anything in the rtf spec(s) about encoding of &lt;tt&gt;\wbitmap&lt;/tt&gt;, but I&apos;ll take a look again.&lt;/p&gt;</comment>
                            <comment id="17575199" author="tallison@mitre.org" created="Thu, 4 Aug 2022 10:32:30 +0000"  >&lt;p&gt;This might be relevant: &lt;a href=&quot;http://justsolve.archiveteam.org/wiki/Raw_bitmap&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://justsolve.archiveteam.org/wiki/Raw_bitmap&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note that there is metadata about the image before the raw bytes, width, height, color stuff, etc.      &lt;/p&gt;</comment>
                            <comment id="17575204" author="tallison@mitre.org" created="Thu, 4 Aug 2022 10:45:22 +0000"  >&lt;p&gt;I&apos;m not having luck with ImageMagick, but this is likely user error: &lt;a href=&quot;https://legacy.imagemagick.org/discourse-server/viewtopic.php?t=22999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://legacy.imagemagick.org/discourse-server/viewtopic.php?t=22999&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17575208" author="vamsi452" created="Thu, 4 Aug 2022 10:56:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;&#160; I tried using the same file using below link and both the attachments is extracted as png file type.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://products.aspose.app/words/editor&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://products.aspose.app/words/editor&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17575279" author="tallison@mitre.org" created="Thu, 4 Aug 2022 13:49:02 +0000"  >&lt;p&gt;My guess is that aspose is doing the correct post-processing to yield a png.  This happens commonly in PDFs, where the raw bytes for an image that are stored have to be manipulated by the application along with other information in the document to yield an actual image file.&lt;/p&gt;

&lt;p&gt;Are you able to attach the pngs?  I&apos;m curious if they just slapped a png header on those bytes or if they were actually transformed.&lt;/p&gt;</comment>
                            <comment id="17575281" author="vamsi452" created="Thu, 4 Aug 2022 13:56:44 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13047715/13047715_example.zip&quot; title=&quot;example.zip attached to TIKA-3827&quot;&gt;example.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Attached the Zip file , the content text file and two png files.&lt;/p&gt;</comment>
                            <comment id="17575293" author="tallison@mitre.org" created="Thu, 4 Aug 2022 14:29:43 +0000"  >&lt;p&gt;Y, those bytes are completely transformed.  Aspose is doing the correct image manipulation...now we just need to find documentation for what that is...&lt;/p&gt;</comment>
                            <comment id="17575881" author="vamsi452" created="Fri, 5 Aug 2022 14:45:23 +0000"  >&lt;p&gt;Below is the code:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;You can easily extract text from the document using code like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;{{Document doc = new Document(&quot;C:\Temp\in.doc&quot;);&lt;br/&gt;
doc.save(&quot;C:\Temp\out.txt&quot;);}}&lt;/p&gt;

&lt;p&gt;Or of you need to extract text into a String, you can use code like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;{{Document doc = new Document(&quot;C:\Temp\in.doc&quot;);&lt;br/&gt;
String docText = doc.toString(SaveFormat.TEXT);}}&lt;/p&gt;

&lt;p&gt;The following code can be used for image extraction:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;{{Document doc = new Document(&quot;C:\Temp\in.doc&quot;);&lt;/p&gt;

&lt;p&gt;Iterable&amp;lt;Shape&amp;gt; shapes = doc.getChildNodes(NodeType.SHAPE, true);&lt;br/&gt;
int counter = 0;&lt;br/&gt;
for (Shape s : shapes)&lt;br/&gt;
{&lt;br/&gt;
    if (s.hasImage())&lt;/p&gt;
    {
        s.getImageData().save(&quot;C:\Temp\img_&quot; + counter + FileFormatUtil.imageTypeToExtension(s.getImageData().getImageType()));
        counter++;
    }
&lt;p&gt;}}}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17575890" author="tallison@mitre.org" created="Fri, 5 Aug 2022 14:56:21 +0000"  >&lt;p&gt;That&apos;s the client code, but we don&apos;t know what &quot;getImageData()&quot; is doing under the hood to transform the raw bytes.&lt;/p&gt;</comment>
                            <comment id="17575891" author="tallison@mitre.org" created="Fri, 5 Aug 2022 14:58:11 +0000"  >&lt;p&gt;For now, I&apos;ve added a mediatype hint that the bytes are of type &lt;tt&gt;image/x-rtf-raw-bitmap&lt;/tt&gt;.  This prevents parsers from being applied.&lt;/p&gt;

&lt;p&gt;The correct solution would be to figure out the algorithm to manipulate the bytes to convert them to an actual image file, but that is beyond my reach atm.&lt;/p&gt;</comment>
                            <comment id="17575935" author="hudson" created="Fri, 5 Aug 2022 16:06:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #730 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/730/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/730/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3827&quot; title=&quot;Word Document extracted mpga file extension instead of bitmap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3827&quot;&gt;TIKA-3827&lt;/a&gt; &amp;#8211; override image mime if raw bitmap in RTF (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/99533c971d5db7d7f3c501bc6cf67082a8d7f0cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/99533c971d5db7d7f3c501bc6cf67082a8d7f0cc&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/RTFEmbObjHandler.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/TextExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17575945" author="vamsi452" created="Fri, 5 Aug 2022 16:30:35 +0000"  >&lt;p&gt;Okay&lt;/p&gt;</comment>
                            <comment id="17576563" author="vamsi452" created="Mon, 8 Aug 2022 06:15:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;&#160; Image data documentation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reference.aspose.com/words/java/com.aspose.words/ImageData&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reference.aspose.com/words/java/com.aspose.words/ImageData&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17576786" author="tallison@mitre.org" created="Mon, 8 Aug 2022 13:55:00 +0000"  >&lt;p&gt;This is helpful for how to use Aspose&apos;s API, but I don&apos;t see anything in there about how to translate the raw bytes of the image as stored into an actual image.  As I showed above, Tika is extracting the raw bytes as they appear in the file.  However, I think there has to be some kind of transformation to convert that to an actual image file.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13047688" name="Screenshot from 2022-08-04 06-05-09.png" size="33622" author="tallison" created="Thu, 4 Aug 2022 10:05:27 +0000"/>
                            <attachment id="13047599" name="example.DOC" size="19619" author="Vamsi452" created="Wed, 3 Aug 2022 07:17:19 +0000"/>
                            <attachment id="13047715" name="example.zip" size="3256" author="Vamsi452" created="Thu, 4 Aug 2022 13:56:10 +0000"/>
                            <attachment id="13047635" name="file_1.bmp" size="154" author="tallison" created="Wed, 3 Aug 2022 16:16:13 +0000"/>
                            <attachment id="13047634" name="file_2.bmp" size="52" author="tallison" created="Wed, 3 Aug 2022 16:16:13 +0000"/>
                            <attachment id="13047658" name="image-2022-08-04-10-52-44-800.png" size="9625" author="Vamsi452" created="Thu, 4 Aug 2022 05:22:45 +0000"/>
                            <attachment id="13047659" name="image-2022-08-04-10-53-48-894.png" size="11225" author="Vamsi452" created="Thu, 4 Aug 2022 05:23:49 +0000"/>
                            <attachment id="13047689" name="image-2022-08-04-15-44-48-396.png" size="666" author="Vamsi452" created="Thu, 4 Aug 2022 10:14:48 +0000"/>
                            <attachment id="13047690" name="image-2022-08-04-15-45-10-892.png" size="6242" author="Vamsi452" created="Thu, 4 Aug 2022 10:15:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17f3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>