<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:04:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-4065] Apparent multithreading bug in HWP5 parser (2)</title>
                <link>https://issues.apache.org/jira/browse/TIKA-4065</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3092&quot; title=&quot;Apparent multithreading bug in HWP5 parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3092&quot;&gt;&lt;del&gt;TIKA-3092&lt;/del&gt;&lt;/a&gt; is happening again? &lt;tt&gt;testMultiThreadedSkipFully&lt;/tt&gt; fails when using commons-io 2.12.0 or 2.13.0 (we still use 2.11.0 for some reason). I have attached the two extracts of the failing test. The only difference is that &quot;(&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2776&quot; title=&quot;Tika server child restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2776&quot;&gt;&lt;del&gt;TIKA-2776&lt;/del&gt;&lt;/a&gt;)&quot; from A appears as &quot;(&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2776&quot; title=&quot;Tika server child restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2776&quot;&gt;&lt;del&gt;TIKA-2776&lt;/del&gt;&lt;/a&gt; &quot; in B.&lt;/p&gt;

&lt;p&gt;It happens with java 8, 11 and 20.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13539551">TIKA-4065</key>
            <summary>Apparent multithreading bug in HWP5 parser (2)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>commons-io</label>
                    </labels>
                <created>Sun, 11 Jun 2023 09:39:33 +0000</created>
                <updated>Mon, 28 Aug 2023 19:25:41 +0000</updated>
                            <resolved>Tue, 13 Jun 2023 14:25:26 +0000</resolved>
                                                    <fixVersion>2.9.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17731345" author="tilman" created="Sun, 11 Jun 2023 13:16:44 +0000"  >&lt;p&gt;One thing that did work was to revert the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3679&quot; title=&quot;Enforce readFully and skipFully throughout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3679&quot;&gt;&lt;del&gt;TIKA-3679&lt;/del&gt;&lt;/a&gt; for &lt;tt&gt;HwpTextExtractorV5.java&lt;/tt&gt; and &lt;tt&gt;HwpStreamReader.java&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17731642" author="tallison@mitre.org" created="Mon, 12 Jun 2023 14:33:22 +0000"  >&lt;p&gt;Replicated locally.  Will look at changes in commons-io btwn 2.11.0 and 2.12.0.  Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17731652" author="tallison@mitre.org" created="Mon, 12 Jun 2023 14:54:59 +0000"  >&lt;p&gt;commons-io 2.11.0 used a threadlocal static byte[] to read to in &lt;tt&gt;skipFully&lt;/tt&gt;.  In 2.12.0, they got rid of threadlocal for the skip buffer.  We can work around this by using Tika&apos;s &lt;tt&gt;skip&lt;/tt&gt; for now, but we should create a minimal unit test and get this fixed in commons-io.&lt;/p&gt;</comment>
                            <comment id="17731655" author="tallison@mitre.org" created="Mon, 12 Jun 2023 15:11:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-io/commit/c12eaff7f747353a7a9a97df735fd3301f42e313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/commit/c12eaff7f747353a7a9a97df735fd3301f42e313&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17731706" author="tilman" created="Mon, 12 Jun 2023 17:15:40 +0000"  >&lt;p&gt;Thanks! If I understand correctly, they&apos;re using the same write-only buffer accross threads but to write the read() data into it, instead of calling skip(). I wonder why this brings this effect.&lt;/p&gt;</comment>
                            <comment id="17731716" author="tallison@mitre.org" created="Mon, 12 Jun 2023 17:44:19 +0000"  >&lt;p&gt;This and the earlier issue are a complete mystery to me.  It is interesting that I&apos;m able to replicate the diff you saw with just the missing parenthesis.  That suggests something in buffer length or something?&lt;/p&gt;

&lt;p&gt;I&apos;m working on isolating a test case.&lt;/p&gt;

&lt;p&gt;Separately, we can fix the HWPParser so that the unit tests will pass, but that doesn&apos;t fix the underlying problem.  I don&apos;t think we should upgrade commons-io until this is fixed...because we use commons-io&apos;s &lt;tt&gt;skipFully&lt;/tt&gt; all over the place.&lt;/p&gt;

&lt;p&gt;Thank you for finding this!&lt;/p&gt;</comment>
                            <comment id="17731778" author="tallison@mitre.org" created="Mon, 12 Jun 2023 20:55:38 +0000"  >&lt;p&gt;It looks like it is tied to a combination of java&apos;s InflaterInputStream and IOUtils&apos; non-thread-local &lt;tt&gt;skipFully&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/tballison/commons-io/blob/TIKA-4065/src/test/java/org/apache/commons/io/IOUtilsMultithreadedTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tballison/commons-io/blob/TIKA-4065/src/test/java/org/apache/commons/io/IOUtilsMultithreadedTest.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17731779" author="tallison@mitre.org" created="Mon, 12 Jun 2023 20:56:43 +0000"  >&lt;p&gt;I do not have a problem when I swap &lt;tt&gt;skipFully&lt;/tt&gt; (not thread local) for &lt;tt&gt;readFully&lt;/tt&gt; (thread local).  I do not have a problem when the stream doesn&apos;t require an InflaterInputStream.&lt;/p&gt;</comment>
                            <comment id="17731783" author="tallison@mitre.org" created="Mon, 12 Jun 2023 21:07:35 +0000"  >&lt;p&gt;The problem is easily reproducible, but the iteration number varies by run.  Even with the same seed, the iteration numbers vary.&lt;/p&gt;</comment>
                            <comment id="17731784" author="tallison@mitre.org" created="Mon, 12 Jun 2023 21:15:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread/rxfyxqochnj7bw75nr2v7hf5qtkogx7d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/rxfyxqochnj7bw75nr2v7hf5qtkogx7d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17731785" author="tallison@mitre.org" created="Mon, 12 Jun 2023 21:17:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; does this actually affect 2.8.0?  We&apos;re still on commons-io 2.11.0 in 2.8.0, right?  This only happens when we try to bump the version of commons-io, which we haven&apos;t done yet...right?&lt;/p&gt;</comment>
                            <comment id="17731786" author="tallison@mitre.org" created="Mon, 12 Jun 2023 21:18:48 +0000"  >&lt;p&gt;The unit test file that I use in my fork of commons-io was inside of one of the hwp files in our unit test.&lt;/p&gt;</comment>
                            <comment id="17731839" author="tilman" created="Tue, 13 Jun 2023 03:21:21 +0000"  >&lt;p&gt;You&apos;re right, it doesn&apos;t affect 2.8.0, only when updating commons-io.&lt;/p&gt;</comment>
                            <comment id="17732117" author="tallison@mitre.org" created="Tue, 13 Jun 2023 14:25:26 +0000"  >&lt;p&gt;I upgraded to commons-io 2.13.0 and added the workaround in the hwp reader.  Because this bug only appears to affect InflaterInputStream, I&apos;m ok with the upgrade and the temporary workaround. &lt;/p&gt;

&lt;p&gt;If anyone disagrees, we can roll this back.&lt;/p&gt;</comment>
                            <comment id="17732158" author="hudson" created="Tue, 13 Jun 2023 16:11:03 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk11 #1113 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk11/1113/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk11/1113/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4065&quot; title=&quot;Apparent multithreading bug in HWP5 parser (2)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4065&quot;&gt;&lt;del&gt;TIKA-4065&lt;/del&gt;&lt;/a&gt; &amp;#8211; upgrade commons-io and add workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-802&quot; title=&quot;Restore threadlocal for skipfully() byte buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-802&quot;&gt;IO-802&lt;/a&gt; until that is fixed. (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/8793fad6464facfa5a29dae368a85ede106d2230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/8793fad6464facfa5a29dae368a85ede106d2230&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parent/pom.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-miscoffice-module/src/main/java/org/apache/tika/parser/hwp/HwpStreamReader.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13539865">IO-802</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13298337">TIKA-3092</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13428001">TIKA-3679</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13058958" name="a.txt" size="2415" author="tilman" created="Sun, 11 Jun 2023 09:07:15 +0000"/>
                            <attachment id="13058957" name="b.txt" size="2415" author="tilman" created="Sun, 11 Jun 2023 09:07:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1igs0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>