<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2849] TikaInputStream copies the input stream locally</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2849</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When doing &quot;tika.detect(stream, name)&quot; and the stream is a &quot;TikaInputStream&quot;, execution&#160;gets to &quot;TikaInputStream#getPath&quot; which does a &quot;Files.copy(in, path, REPLACE_EXISTING);&quot; which is very, very bad. This input stream could be, as in our case, an input stream from a network file which is tens or hundreds of gigabytes large. Copying it locally is a huge waste of resources to say the least. Why does it do that and can I make it not do it? Or is this something that has to be fixed in Tika?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13226644">TIKA-2849</key>
            <summary>TikaInputStream copies the input stream locally</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="boris-petrov">Boris Petrov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Apr 2019 08:48:51 +0000</created>
                <updated>Mon, 13 Apr 2020 14:43:03 +0000</updated>
                            <resolved>Fri, 19 Apr 2019 20:24:08 +0000</resolved>
                                    <version>1.20</version>
                                    <fixVersion>1.21</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16812492" author="kkrugler" created="Mon, 8 Apr 2019 15:08:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt; - two things here. First, do you have the call stack down to the &lt;tt&gt;TikaInputStream#getPath&lt;/tt&gt; request? Second, it would be great if we could first have this discussion on the user mailing list, before an issue gets created, thanks!&lt;/p&gt;

&lt;p&gt;Finally, I&apos;m not an expert on this part of the code, but I know that some of the parsers (from other open source projects) wrapped by Tika require a local file as input - in those situations, Tika uses the above code to create a file that can be passed in. What&apos;s the type of data being streamed in?&lt;/p&gt;</comment>
                            <comment id="16813500" author="boris-petrov" created="Tue, 9 Apr 2019 14:50:49 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;First thing:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TikaInputStream.getPath() line: 588
TikaInputStream.getFile() line: 616
ZipContainerDetector.detectOPCBased(TikaInputStream) line: 241
ZipContainerDetector.detectZipFormat(TikaInputStream) line: 173
ZipContainerDetector.detect(InputStream, Metadata) line: 110
DefaultDetector(CompositeDetector).detect(InputStream, Metadata) line: 84
Tika.detect(InputStream, Metadata) line: 156
Tika.detect(InputStream, String) line: 184
... my code
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Second thing - yes, sorry, I just think this is an obvious bug, that&apos;s why I directly opened an issue. Will know for next time!&lt;/p&gt;

&lt;p&gt;Final thing - if some parsers require a local file and Tika is passed an InputStream (and not an explicit file or path) then it should definitely &lt;b&gt;not&lt;/b&gt; use those parsers as, again, copying a file locally could be horribly expensive. This happens on any kind of data - an Excel file was the first file that I saw it happening on.&lt;/p&gt;

&lt;p&gt;P.S. Now that I think about it (and looking through the source-code), it may happen only for ZIP files. Check the stacktrace.&lt;/p&gt;</comment>
                            <comment id="16813566" author="tallison@mitre.org" created="Tue, 9 Apr 2019 15:50:38 +0000"  >&lt;p&gt;If you want only magic mime based detection, you can turn off the other detectors, esp zipcontainer detector....perhaps just use Tika-core?  You won&#8217;t necessarily get subtypes of ooxml... e.g. docx vs xlsx. For some file types you really do need the full stream to do fine grained detection, but if you see areas for improvement, our GitHub  site is open for PRs and committers are standing by. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


</comment>
                            <comment id="16813588" author="tallison@mitre.org" created="Tue, 9 Apr 2019 16:24:53 +0000"  >&lt;p&gt;I could see improving the &lt;tt&gt;ZipContainerDetector&lt;/tt&gt; and maybe the &lt;tt&gt;POIFSContainerDetector&lt;/tt&gt; by allowing users to set a &lt;tt&gt;markLimit&lt;/tt&gt;, and the &lt;tt&gt;ZCD/PCD&lt;/tt&gt; would do their best.&lt;/p&gt;

&lt;p&gt;As a first step, try turning off the detectors you don&apos;t want (any container detectors) with a config file like this one: &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/tika/blob/master/tika-parsers/src/test/resources/org/apache/tika/config/TIKA-1702-detector-blacklist.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/blob/master/tika-parsers/src/test/resources/org/apache/tika/config/TIKA-1702-detector-blacklist.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let us know if that helps improve performance and if you&apos;re happy enough without the granularity you can get with the container detectors.&lt;/p&gt;</comment>
                            <comment id="16813593" author="jukkaz" created="Tue, 9 Apr 2019 16:30:45 +0000"  >&lt;p&gt;There&apos;s a related TODO in &lt;tt&gt;detectZipFormat()&lt;/tt&gt; to check for &lt;tt&gt;hasFile()&lt;/tt&gt; before using the potentially expensive &lt;tt&gt;getFile()&lt;/tt&gt; method. We could make the detector fall back to &lt;tt&gt;tryStreamingDetection()&lt;/tt&gt; when the file is not available (or the stream is too large to be spooled into a temporary file).&lt;/p&gt;</comment>
                            <comment id="16816298" author="boris-petrov" created="Fri, 12 Apr 2019 14:12:42 +0000"  >&lt;p&gt;Yes, what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; said makes most sense. I don&apos;t want to disable these detectors, I just want them to be &quot;smarter&quot; - that is not use the file-detection but a stream-based one if the file is not local.&lt;/p&gt;</comment>
                            <comment id="16816446" author="tallison@mitre.org" created="Fri, 12 Apr 2019 16:41:27 +0000"  >&lt;p&gt;+1 working on it now...expanding streaming zip detection.&lt;/p&gt;</comment>
                            <comment id="16816617" author="tallison@mitre.org" created="Fri, 12 Apr 2019 20:21:21 +0000"  >&lt;p&gt;I ran a loop 20 times over all zip-based files in our unit tests.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For &lt;em&gt;detection&lt;/em&gt;, it now takes 4.4 seconds with the streaming zip detection, and it takes 30.9 seconds for the file based detection.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If we&apos;re &lt;em&gt;parsing&lt;/em&gt;&#160;the zip-based files, I get 239 seconds for both &quot;streaming detect then parse&quot; and &quot;zip file detect then parse&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;That&apos;s a ~7x speedup for detection and no difference for parsing?&#160; I&apos;ll take that.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16816625" author="tallison@mitre.org" created="Fri, 12 Apr 2019 20:34:04 +0000"  >&lt;p&gt;The POIFSContainerDetector still calls TikaInputStream.getFile() for its detection.&lt;/p&gt;</comment>
                            <comment id="16816634" author="boris-petrov" created="Fri, 12 Apr 2019 20:49:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; - I&apos;m not sure what the last comment means. Is it going to stay that way or you&apos;re just mentioning it as it also has to be fixed?&lt;/p&gt;</comment>
                            <comment id="16816640" author="tallison@mitre.org" created="Fri, 12 Apr 2019 20:54:14 +0000"  >&lt;p&gt;Mentioning that it has to be fixed.&lt;/p&gt;</comment>
                            <comment id="16816661" author="tallison@mitre.org" created="Fri, 12 Apr 2019 21:13:03 +0000"  >&lt;p&gt;I just pushed a first draft of moving to streaming detection for zip files to the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; branch.&#160; It includes some non-trivial changes.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The timing tests are in &lt;tt&gt;ZipContainerDetectorTest&lt;/tt&gt;...your mileage will vary.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Any and all feedback on that branch is appreciated.&lt;/p&gt;</comment>
                            <comment id="16816663" author="tallison@mitre.org" created="Fri, 12 Apr 2019 21:15:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt;, is it possible to do streaming detection with POIFS?&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;POIFSDump&lt;/tt&gt;, I see:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;try (FileInputStream is = new FileInputStream(filename);
     POIFSFileSystem fs = new POIFSFileSystem(is)) {
    DirectoryEntry root = fs.getRoot();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does that suck the whole file into memory, or can we iterate over it like we do a &lt;tt&gt;ZipInputStream&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16816667" author="tallison@mitre.org" created="Fri, 12 Apr 2019 21:19:42 +0000"  >&lt;p&gt;On the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; branch, I also included an example of how to configure the ZipContainerDetector to read more or less of a zip stream by setting &lt;tt&gt;markLimit&lt;/tt&gt; via a &lt;tt&gt;tika-config.xml&lt;/tt&gt; file as we do for our encoding detectors:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/tika/blob/1e08fb1e54653954a71c71a68218bcdf7a7a3afb/tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipContainerDetectorTest.java#L85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/blob/1e08fb1e54653954a71c71a68218bcdf7a7a3afb/tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipContainerDetectorTest.java#L85&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/tika/blob/TIKA-2849/tika-parsers/src/test/resources/org/apache/tika/parser/pkg/tika-config.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/blob/TIKA-2849/tika-parsers/src/test/resources/org/apache/tika/parser/pkg/tika-config.xml&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16816714" author="tallison@mitre.org" created="Fri, 12 Apr 2019 22:37:03 +0000"  >&lt;p&gt;While working on this, I also noticed that we&apos;re detecting ooxml files twice &amp;#8211; once in the zipdetector and once in OOXMLParserFactory.  This is not a rigorous test, and other things may be going on, but it looks like there may be an improvement in &lt;em&gt;parsing&lt;/em&gt;: on 10 iterations of parsing our zip-based unit test files, it took&lt;/p&gt;

&lt;p&gt;177 seconds for stream and 158 seconds for file based tikainputstream before&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;134 seconds for stream and 133 seconds for file-based tikainputstream after that (and other) fixes&lt;/p&gt;</comment>
                            <comment id="16821961" author="tallison@mitre.org" created="Fri, 19 Apr 2019 14:37:44 +0000"  >&lt;p&gt;I added another parameter to the ZipContainerDetector &amp;#8211; &lt;tt&gt;spoolToFile&lt;/tt&gt;.  The default is &lt;tt&gt;false&lt;/tt&gt;, but if a user wants to get the old legacy behavior s/he can set that to true (programmatically or via TikaConfig) &lt;em&gt;AND&lt;/em&gt; (send in a TikaInputSteam) and the legacy behavior will be available.  I&apos;ll merge the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; branch shortly.&lt;/p&gt;</comment>
                            <comment id="16821964" author="tallison@mitre.org" created="Fri, 19 Apr 2019 14:39:56 +0000"  >&lt;p&gt;As for the POIFSContainerDetector, I do not currently believe that it is possible to do streaming detection and stop short of reading the full stream largely because the part that contains the file type is stored at the end of the file. &lt;/p&gt;

&lt;p&gt;The underlying POIFSFileSystem loads the data off heap at least and limits the total to 2GB.&lt;/p&gt;

&lt;p&gt;If someone can recommend a way to detect the subtypes of tika-office (doc, ppt, xls) without reading the full stream (and without relying on file names), please let us know.&lt;/p&gt;</comment>
                            <comment id="16821982" author="tallison@mitre.org" created="Fri, 19 Apr 2019 15:11:41 +0000"  >&lt;p&gt;Side note.  Of the 397,434 zip files in our regression corpora with a &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Content_Types&amp;#93;&lt;/span&gt;.xml&lt;/tt&gt; entry (ooxml files), that entry shows up physically as the first entry in the zip file 98.19% of the time.  &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Index&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Count&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Percentage&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;390246&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;98.19%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1418&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.36%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1209&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.30%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;412&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.10%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;33&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.01%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;338&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.09%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;68&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.02%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;128&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.03%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;287&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.07%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;488&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.12%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;346&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.09%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;...long tail&lt;/p&gt;</comment>
                            <comment id="16821995" author="jukkaz" created="Fri, 19 Apr 2019 15:24:43 +0000"  >&lt;p&gt;How about something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; TikaInputStream tis = TikaInputStream.&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(input);
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tis != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; tis.hasFile()) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; detect(tis.getFile());
&#160; &#160; }

&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (input == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !hasOleHeader(input)) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&#160;MediaType.OCTET_STREAM;
&#160; &#160; }

&#160; &#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxBytesToSpool = 16 * 1024 * 1024; &lt;span class=&quot;code-comment&quot;&gt;// Or some configurable limit.
&lt;/span&gt;&#160; &#160; InputStream lookahead = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LookaheadInputStream(stream, n);
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; tis = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TikaInputStream(lookahead);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tis.getLength() &amp;lt; maxBytesToSpool) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; detect(tis.getFile());
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; tis.close();
&#160; &#160; &#160; &#160; }
&#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
&#160; &#160; &#160; &#160; lookahead.close();
&#160; &#160; }

&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&#160;MediaType.OCTET_STREAM;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16821998" author="tallison@mitre.org" created="Fri, 19 Apr 2019 15:33:59 +0000"  >&lt;p&gt;These are the applications that had that entry after the first stream:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Files&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Application&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2302&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1800&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Apache POI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;631&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Excel&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;630&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office Word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;543&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Macintosh Word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;334&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office PowerPoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;171&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office Outlook&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;119&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Macintosh Excel&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;PHPWord&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;27&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LibreOffice/6.0.3.2$Windows_X86_64 LibreOffice_project/8f48d515416608e3a835360314dac7e47fd0b821&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LibreOffice/5.1.6.2$Linux_X86_64 LibreOffice_project/10m0$Build-2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Google docs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LibreOffice/5.0.1.2$Windows_x86 LibreOffice_project/81898c9f5c0d43f3473ba111d7b351050be20261&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LibreOffice/5.2.3.3$Windows_x86 LibreOffice_project/d54a8868f08a7b39642414cf2c8ef2f228f780cf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;WPS &#34920;&#26684;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;GemBox.Spreadsheet&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;...&lt;/p&gt;</comment>
                            <comment id="16822002" author="tallison@mitre.org" created="Fri, 19 Apr 2019 15:44:17 +0000"  >&lt;p&gt;Vs those applications that had &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Content_Types&amp;#93;&lt;/span&gt;.xml&lt;/tt&gt; as the first entry...&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Files&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Application&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;224716&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office Word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;55105&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Excel&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;43391&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;35188&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office PowerPoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13017&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Macintosh Word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10300&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Office Outlook&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2920&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Macintosh PowerPoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2166&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Macintosh Excel&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1269&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft PowerPoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;910&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Word 12.0.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;463&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Word 12.1.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;198&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;PHPWord&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;168&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Microsoft Access&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16822013" author="tallison@mitre.org" created="Fri, 19 Apr 2019 16:01:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;...to make sure I understand...The idea is if the TikaInputStream has a file, use it.  If it doesn&apos;t, only spool &lt;tt&gt;n&lt;/tt&gt; (or &lt;tt&gt;maxBytesToSpool&lt;/tt&gt;?) number of bytes ... if the file was fully spooled, detect on that?  &lt;/p&gt;</comment>
                            <comment id="16822038" author="jukkaz" created="Fri, 19 Apr 2019 16:39:24 +0000"  >&lt;p&gt;Exactly (sorry, s/n/maxBytesToSpool/).&lt;/p&gt;

&lt;p&gt;That should work as before on most files, but would avoid the problematic case of potentially spooling unlimited amounts of data to local disk. We can make the max spooling limit configurable, or instruct users to call TikaInputStream.getFile() to force full spooling before calling detect() if they prefer the current logic of always looking at the full file.&lt;/p&gt;</comment>
                            <comment id="16822048" author="tallison@mitre.org" created="Fri, 19 Apr 2019 16:52:26 +0000"  >&lt;p&gt;Got it thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It&apos;s tricky because we want to put the open&#160;POIFS back on the parent TikaInputStream if there is success for potential downstream parsing.&lt;/p&gt;

&lt;p&gt;How about adding a &lt;tt&gt;public Path getPath(int maxBytes) throws IOException&lt;/tt&gt; to TikaInputStream? This would return null or (throw an IOException?) if it didn&apos;t copy the full stream?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public Path getPath(int maxBytes) throws IOException {
        if (path == null) {
            if (position &amp;gt; 0) {
                throw new IOException(&quot;Stream is already being read&quot;);
            } else {
                path = tmp.createTempFile();
                if (maxBytes &amp;gt; -1) {
                    try (InputStream lookAhead = new LookaheadInputStream(in, maxBytes)) {
                        Files.copy(lookAhead, path, REPLACE_EXISTING);
                        if (Files.size(path) &amp;gt;= maxBytes) {
                            return null;
                        }
                    }
                } else {
                    // Spool the entire stream into a temporary file
                    Files.copy(in, path, REPLACE_EXISTING);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16822055" author="jukkaz" created="Fri, 19 Apr 2019 17:00:40 +0000"  >&lt;p&gt;SGTM! Alternatively you could overload the getFile() method with a version that takes a maxBytes argument.&lt;/p&gt;</comment>
                            <comment id="16822057" author="tallison@mitre.org" created="Fri, 19 Apr 2019 17:01:55 +0000"  >&lt;p&gt;+1 and away we go...  Thank you!&lt;/p&gt;</comment>
                            <comment id="16822127" author="tallison@mitre.org" created="Fri, 19 Apr 2019 18:39:46 +0000"  >&lt;p&gt;With 20 loops of detection for our 147 zip-based files, there&apos;s quite an improvement w streaming detection (time in seconds)&lt;/p&gt;

&lt;p&gt;tika stream: 10&lt;br/&gt;
tika stream w file: 31&lt;br/&gt;
non tika stream:8&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With 10 loops of parsing, the times are quite close:&lt;/p&gt;

&lt;p&gt;tika stream: 129&lt;br/&gt;
tika stream w file: 130&lt;br/&gt;
non tika stream:133&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And these are the times with in branch_1x before the merge:&lt;/p&gt;

&lt;p&gt;With 20 loops of detection for our zip-based files,&#160;file based tika-stream is roughly the same, but &amp;gt; 2x faster than detect with a TikaInputStream wrapped InputStream&lt;/p&gt;

&lt;p&gt;tika stream: 72&lt;br/&gt;
tika stream w file: 29&lt;br/&gt;
non tika stream:4 (NOTE THAT ZIP SUB-TYPE DETECTION IS SKIPPED!)*&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With 10 loops of parsing,&#160;the times are all slightly slower in branch_1x:&lt;/p&gt;

&lt;p&gt;tika stream: 166&lt;br/&gt;
tika stream w file: 143&lt;br/&gt;
non tika stream:170&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;*&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;else if (PackageParser.isZipArchive(type)
            &amp;amp;&amp;amp; TikaInputStream.isTikaInputStream(input)) {
    return detectZipFormat(tis);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16822164" author="tallison@mitre.org" created="Fri, 19 Apr 2019 20:24:08 +0000"  >&lt;p&gt;There are still some areas for improvements, but this is quite a bit better.&#160; Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16822173" author="hudson" created="Fri, 19 Apr 2019 20:38:17 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #399 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/399/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/399/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; &amp;#8211; move to streaming detection of zip files and apply (tallison: rev 64877c5a6187ecd13e098e99edc97a1f6dc09112)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/StreamingZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/epub/EpubParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/utils/ZipSalvager.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/org/apache/tika/parser/pkg/tika-config.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetectorBase.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/TikaTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipContainerDetectorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(add) tika-core/src/main/java/org/apache/tika/io/BoundedInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/TruncatedOOXMLTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/iwork/IWorkPackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/POIFSContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/parser/digest/InputStreamDigester.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16822187" author="hudson" created="Fri, 19 Apr 2019 21:12:39 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1643 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1643/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1643/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; &amp;#8211; move to streaming detection of zip files and apply (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/64877c5a6187ecd13e098e99edc97a1f6dc09112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/64877c5a6187ecd13e098e99edc97a1f6dc09112&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/org/apache/tika/parser/pkg/tika-config.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/epub/EpubParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/StreamingZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipContainerDetectorTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-core/src/main/java/org/apache/tika/io/BoundedInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/parser/digest/InputStreamDigester.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/iwork/IWorkPackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/TikaTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/TruncatedOOXMLTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetectorBase.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/utils/ZipSalvager.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/POIFSContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16822188" author="hudson" created="Fri, 19 Apr 2019 21:14:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #177 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/177/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/177/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; &amp;#8211; move to streaming detection of zip files and apply (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/b2928c05345724d84a52275d7e93e0f055562a6b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/b2928c05345724d84a52275d7e93e0f055562a6b&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/POIFSContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/TruncatedOOXMLTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/parser/digest/InputStreamDigester.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/org/apache/tika/parser/pkg/tika-config.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/TikaTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/utils/ZipSalvager.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/StreamingZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/epub/EpubParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipContainerDetectorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetectorBase.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(add) tika-core/src/main/java/org/apache/tika/io/BoundedInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/iwork/IWorkPackageParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16822209" author="tallison@mitre.org" created="Fri, 19 Apr 2019 21:59:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt; let me know if I closed this prematurely.  If there&apos;s an underlying file in TikaInputStream &lt;em&gt;or&lt;/em&gt; if the user sets &lt;tt&gt;markLimit&lt;/tt&gt; to -1, we&apos;ll use the underlying file (e.g. TikaInputStream.get(File f)) or spool to disk and detect on the full file.  If &lt;tt&gt;markLimit&lt;/tt&gt; &amp;gt; 0 but there&apos;s an underlying file, we&apos;ll do file based detection.  &lt;/p&gt;

&lt;p&gt;We&apos;re currently doing streaming detection if a user sends in a non TikaInputStream or if the TikaInputStream wraps an InputStream (not a file).&lt;/p&gt;

&lt;p&gt;There are a number of improvements I&apos;d like to make to zip detection, and I think we&apos;ll eventually move towards streaming detection as default, but I don&apos;t want to make such a drastic change yet.&lt;/p&gt;

&lt;p&gt;Let us know if we should reopen this.&lt;/p&gt;</comment>
                            <comment id="16823030" author="boris-petrov" created="Mon, 22 Apr 2019 11:26:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; thank you for the quick and great support! I just didn&apos;t understand whether you did something for &lt;tt&gt;POIFSContainerDetector&lt;/tt&gt; - in one of the comments you mention that it&apos;s not so easy for this &quot;problem&quot; to be fixed there. So did you just make it that this detector is not used if there isn&apos;t a file or does it still copy locally?&lt;/p&gt;</comment>
                            <comment id="16823084" author="tallison@mitre.org" created="Mon, 22 Apr 2019 12:58:40 +0000"  >&lt;p&gt;For &lt;tt&gt;POIFSContainerDetector&lt;/tt&gt;, I followed Jukka&apos;s recommendation, and I may have gotten it right. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;a) If there is an underlying file in the &lt;tt&gt;TikaInputStream&lt;/tt&gt;, use that for detection (the file is loaded by POI)&lt;br/&gt;
b) If the &lt;tt&gt;TikaInputStream&lt;/tt&gt; wraps an &lt;tt&gt;InputStream&lt;/tt&gt;, spool up to &lt;tt&gt;markLimit&lt;/tt&gt; to disk.  If the amount spooled is less than &lt;tt&gt;markLimit&lt;/tt&gt;, i.e., if the file size is less than &lt;tt&gt;markLimit&lt;/tt&gt;...meaning the entire file has been spooled... POI opens the non-truncated file.  If the amount spooled is equal to &lt;tt&gt;markLimit&lt;/tt&gt; (i.e. we only spooled part of the file) do not detect.&lt;/p&gt;

&lt;p&gt;For now, I&apos;ve kept the legacy behavior, that &lt;tt&gt;POIFSContainerDetector&lt;/tt&gt; does not try to do detection on a non-TikaInputStream.&lt;/p&gt;</comment>
                            <comment id="16823121" author="boris-petrov" created="Mon, 22 Apr 2019 14:09:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; this &lt;tt&gt;markLimit&lt;/tt&gt; configuration that you&apos;re talking about - where is it? What&apos;s the default value?&lt;/p&gt;</comment>
                            <comment id="16823226" author="hudson" created="Mon, 22 Apr 2019 16:37:30 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #400 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/400/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/400/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; &amp;#8211; improve documentation in POIFSContainerDetector (tallison: rev 20848961fae9853aa2afa7957f6421c57fe09272)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/POIFSContainerDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16823244" author="hudson" created="Mon, 22 Apr 2019 17:09:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1644 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1644/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1644/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2849&quot; title=&quot;TikaInputStream copies the input stream locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2849&quot;&gt;&lt;del&gt;TIKA-2849&lt;/del&gt;&lt;/a&gt; &amp;#8211; improve documentation in POIFSContainerDetector (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/20848961fae9853aa2afa7957f6421c57fe09272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/20848961fae9853aa2afa7957f6421c57fe09272&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/POIFSContainerDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16824296" author="tallison@mitre.org" created="Tue, 23 Apr 2019 16:25:41 +0000"  >&lt;p&gt;default:     &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    private int markLimit = 16 * 1024 * 1024
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can configure it programmatically or via TikaConfig...something along these lines:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;properties&amp;gt;
    &amp;lt;parsers/&amp;gt;
    &amp;lt;detectors&amp;gt;
        &amp;lt;detector class=&quot;org.apache.tika.detect.OverrideDetector&quot;/&amp;gt;
        &amp;lt;detector class=&quot;org.apache.tika.detect.microsoft.POIFSContainerDetector&quot;&amp;gt;
            &amp;lt;params&amp;gt;
                &amp;lt;param name=&quot;markLimit&quot; type=&quot;int&quot;&amp;gt;16777216&amp;lt;/param&amp;gt;
            &amp;lt;/params&amp;gt;
        &amp;lt;/detector&amp;gt;
        &amp;lt;detector class=&quot;org.apache.tika.parser.pkg.ZipContainerDetector&quot;&amp;gt;
            &amp;lt;params&amp;gt;
                &amp;lt;param name=&quot;markLimit&quot; type=&quot;int&quot;&amp;gt;16777216&amp;lt;/param&amp;gt;
            &amp;lt;/params&amp;gt;
        &amp;lt;/detector&amp;gt;
    &amp;lt;/detectors&amp;gt;
&amp;lt;/properties&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16824380" author="boris-petrov" created="Tue, 23 Apr 2019 17:46:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; Thanks for the great support! Just a last question - in that case, I can&apos;t see a reason for using &lt;tt&gt;TikaInputStream&lt;/tt&gt; with a stream. Am I right or am I missing something? Why do I have to wrap my stream in an &lt;tt&gt;TikaInputStream&lt;/tt&gt; at all?&lt;/p&gt;</comment>
                            <comment id="16824568" author="tallison@mitre.org" created="Tue, 23 Apr 2019 21:57:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt; not for your use case, I agree.  &lt;/p&gt;

&lt;p&gt;My initial reluctance to respond usefully to this ticket was that I have detect+parse as &lt;em&gt;the&lt;/em&gt; paradigmatic use case...it took me a while to fully comprehend how awful what we were doing would be for your use case...detection on a slow network drive.&lt;/p&gt;

&lt;p&gt;So, if you are going to parse the file, too, then it is better to use TikaInputStream because that will spool the file (if it doesn&apos;t exist) and/or reuse the underlying file for detection and parsing.  Also, some &lt;em&gt;parsers&lt;/em&gt; memorymap the underlying file, so their profile is much kinder on RAM if an actual file is available, but for &lt;em&gt;detection&lt;/em&gt; alone, we can do better.&lt;/p&gt;</comment>
                            <comment id="16824895" author="boris-petrov" created="Wed, 24 Apr 2019 08:02:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; I see now, thanks. By &quot;parsing&quot; you mean text-extraction, correct?&lt;/p&gt;

&lt;p&gt;The funny thing is that we have our own abstraction of a File (which could be a local file, a network one or just a stream in memory) and we use Tika by &lt;b&gt;always&lt;/b&gt; passing a stream we get from this File of ours. And we have our own method of converting this File to a local file (which is smart and doesn&apos;t make a copy if this is already a local file). But now I see that Tika actually prefers in some places a file to be passed instead of a stream (which, by the way, I haven&apos;t read anywhere in the documentation so you might want to improve that a bit so others are not bitten like me) but that doesn&apos;t very well match our own File abstraction.&lt;/p&gt;

&lt;p&gt;So a question I would ask now is is it possible, when calling &lt;tt&gt;Tika.parse&lt;/tt&gt; or &lt;tt&gt;Tika.detect&lt;/tt&gt;, to &lt;b&gt;know&lt;/b&gt; whether it/a detector will need to spool to a file so that we can use our own mechanism for that and not pass it a stream but rather a file?&lt;/p&gt;</comment>
                            <comment id="16843727" author="boris-petrov" created="Mon, 20 May 2019 07:31:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; - just a ping for whether you have a good answer for the question I asked above. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;Thanks!&lt;/p&gt;</comment>
                            <comment id="16844710" author="tallison@mitre.org" created="Tue, 21 May 2019 10:31:11 +0000"  >&lt;p&gt;$DAYJOB and concerns about maintenance.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We can add a page on our wiki for detectors and parsers.  It will take some time to get right and maintain, but I should have some time today or tomorrow.&lt;/p&gt;</comment>
                            <comment id="17078338" author="boris-petrov" created="Wed, 8 Apr 2020 14:26:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; - We hit the same problem as the original issue was about but this time for parsing. These two:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.tika.parser.mp4.MP4Parser.parse(MP4Parser.java:132)
org.apache.tika.parser.external.ExternalParser.parse(ExternalParser.java:222)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the latest Tika (1.24) copy the file. Could the same fix be done for them? If not, my previous question remains very relevant - for us copying the whole file is horrible and we have to protect from that happening. So an option to tell Tika not do it (just blow up or return an empty string or something) is very important. Or at least to have a way of knowing whether Tika will copy or not.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="17080195" author="lfcnassif" created="Fri, 10 Apr 2020 03:42:07 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;There are a number of Tika parsers that need a java.io.File because it is needed by Tika&apos;s dependencies. Looking at current sources, I found File is needed by parsers for rar, 7z, pst, mp4, jpg, tif, webp, sqlite, maybe others... Currently there is no way to know if a parser will spool the stream or not without looking the sources.&lt;/p&gt;

&lt;p&gt;But, my organization have a project with a hard requirement to run a search tool in computers/cellphones with very limited resources in the field, and we prefer to receive an IOException(&quot;File size larger than max spool limit&quot;) from parsers instead of waiting too long in dangerous places or exhausting computer resources and crashing the app...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;, What do you think of a new TikaInputStream constructor that takes the spool limit or some setMaxSpoolSize() method to set this limit? If reached in getPath(), TikaInputStream should throw the IOException above. The problem is that many parsers (and also thirdparty parsers) uses getPath(), not the new getPath(maxBytes), and if this one is used, maxBytes should be received by parsers in some way (parseContext?). But I don&apos;t think parsers should take care of this, I prefer the first approach...&lt;/p&gt;

&lt;p&gt;If approved, I can code that, is simple.&lt;/p&gt;</comment>
                            <comment id="17080610" author="tallison@mitre.org" created="Fri, 10 Apr 2020 16:07:26 +0000"  >&lt;p&gt;Sorry for my delay. I&apos;ve been thinking about this without a great answer.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boris-petrov&quot; class=&quot;user-hover&quot; rel=&quot;boris-petrov&quot;&gt;boris-petrov&lt;/a&gt;, for detection, I can understand reading the first &lt;tt&gt;n&lt;/tt&gt; bytes and wanting to limit that.  For parsing, though, wouldn&apos;t you expect that you&apos;d need to read the entire stream?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;, I&apos;m somewhat regretting the max spool size (I regret adding complexity to TikaInputStream) now and would prefer to see if there might be other options... Let&apos;s get the 1.24.1 release out...&lt;/p&gt;

&lt;p&gt;Would it work to wrap your stream in a BoundedInputStream before sending to TikaInputStream?&lt;/p&gt;</comment>
                            <comment id="17081294" author="lfcnassif" created="Sat, 11 Apr 2020 13:47:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;&#160;actually parse time is not the big problem, but large temp files exhausting limited disk resources and breaking parsing of other smaller files or other parts of the application. BoundedInputStream would hurt parsers that do not need to create temp files...&lt;/p&gt;

&lt;p&gt;I don&apos;t think a setMaxSpoolSize(long) is that complex, we would just store the parameter to be used later by the default getPath(), it would call internally getPath(maxSpoolSize) instead of getPath(-1).&lt;/p&gt;

&lt;p&gt;And all TikaInputStream constructors are private, so we can not extend it. If that could be changed, users could extend to their needs...&lt;/p&gt;</comment>
                            <comment id="17081307" author="boris-petrov" created="Sat, 11 Apr 2020 14:05:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;, well yes, reading the entire stream is one thing, but copying it to a file and then operating on it is another. In my case parsing is not a must, so I would prefer for it to fail or not start at all if the stream is going to be spooled to disk. A `BoundedInputStream` makes sense actually. I will try that. Thanks!&lt;/p&gt;</comment>
                            <comment id="17082361" author="tallison@mitre.org" created="Mon, 13 Apr 2020 14:43:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;, y, that makes sense.  We&apos;d have to update the parsers that require a file to check for a null returned by getPath()/getFile(), and I think we&apos;re limited to int (not long) because of how LookaheadInputStream works.  Please make the modification if you&apos;d like.  Thank you!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13227808">TIKA-2853</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01jqg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>