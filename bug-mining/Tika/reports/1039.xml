<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2701] Text is not extracted properly from WMF files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2701</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Text is always extracted assuming it is in cp-1252 encoding. The attached thumbnail_1.wmf has text in Shift JIS and is extracted incorrectly. Should be &#26222;&#26519;&#26031;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13176066">TIKA-2701</key>
            <summary>Text is not extracted properly from WMF files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="galekseev">Grigoriy Alekseev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Aug 2018 09:55:58 +0000</created>
                <updated>Wed, 21 Jul 2021 22:13:41 +0000</updated>
                                            <version>1.15</version>
                                    <fixVersion>2.0.0-BETA</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16565069" author="galekseev" created="Wed, 1 Aug 2018 09:56:26 +0000"  >&lt;p&gt;Will create a pull request.&lt;/p&gt;</comment>
                            <comment id="16565701" author="tallison@mitre.org" created="Wed, 1 Aug 2018 17:44:04 +0000"  >&lt;p&gt;+1 cannot describe the joy this brings me that someone cares about a) WMF b) encodings. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Thank you!&lt;/p&gt;</comment>
                            <comment id="16566365" author="githubbot" created="Thu, 2 Aug 2018 05:22:19 +0000"  >&lt;p&gt;grigoriy opened a new pull request #245: fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; contributed by grigoriy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/245&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16566370" author="galekseev" created="Thu, 2 Aug 2018 05:26:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt;, my pleasure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16568292" author="githubbot" created="Fri, 3 Aug 2018 14:47:10 +0000"  >&lt;p&gt;tballison closed pull request #245: fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; contributed by grigoriy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/245&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;br/&gt;
index e0a2507da..806c7d9ba 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;br/&gt;
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;br/&gt;
@@ -62,10 +62,10 @@ public void parse(InputStream stream, ContentHandler handler, Metadata metadata,&lt;br/&gt;
         xhtml.startDocument();&lt;br/&gt;
         try {&lt;br/&gt;
             HwmfPicture picture = new HwmfPicture(stream);&lt;br/&gt;
+            Charset charset = LocaleUtil.CHARSET_1252;&lt;br/&gt;
             //TODO: make x/y info public in POI so that we can use it here&lt;br/&gt;
             //to determine when to keep two text parts on the same line&lt;br/&gt;
             for (HwmfRecord record : picture.getRecords()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Charset charset = LocaleUtil.CHARSET_1252;&lt;br/&gt;
                 //this is pure hackery for specifying the font&lt;br/&gt;
                 //TODO: do what Graphics does by maintaining the stack, etc.!&lt;br/&gt;
                 //This fix should be done within POI&lt;br/&gt;
diff --git a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;br/&gt;
index 42fb22098..977f74f4e 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;br/&gt;
+++ b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;br/&gt;
@@ -29,14 +29,20 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testTextExtractionWindows() throws Exception &lt;/p&gt;
{
-        List&amp;lt;Metadata&amp;gt; metadataList = getRecursiveMetadata(&quot;testXLSX_Thumbnail.xlsx&quot;);
-        Metadata wmfMetadata = metadataList.get(1);
-        assertEquals(&quot;image/wmf&quot;, wmfMetadata.get(Metadata.CONTENT_TYPE));
-        assertContains(&quot;This file contains an embedded thumbnail&quot;,
-                wmfMetadata.get(RecursiveParserWrapper.TIKA_CONTENT));
+        testTextExtraction(&quot;testXLSX_Thumbnail.xlsx&quot;, 1, &quot;This file contains an embedded thumbnail&quot;);
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testTextExtractionShiftJISencoding() throws Exception &lt;/p&gt;
{
+        testTextExtraction(&quot;thumbnail_1.wmf&quot;, 0, &quot;&#26222;&#26519;&#26031;&quot;);
     }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;//TODO fix wmf text extraction in &quot;testRTFEmbeddedFiles.rtf&quot;&lt;/li&gt;
	&lt;li&gt;//Chinese is garbled.&lt;br/&gt;
+    private void testTextExtraction(String fileName, int metaDataItemIndex, String expectedText) throws Exception 
{
+        List&amp;lt;Metadata&amp;gt; metadataList = getRecursiveMetadata(fileName);
+        Metadata wmfMetadata = metadataList.get(metaDataItemIndex);
+
+        assertEquals(&quot;image/wmf&quot;, wmfMetadata.get(Metadata.CONTENT_TYPE));
+        assertContains(expectedText, wmfMetadata.get(RecursiveParserWrapper.TIKA_CONTENT));
+    }
&lt;p&gt; }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf b/tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 000000000..b860d183d&lt;br/&gt;
Binary files /dev/null and b/tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf differ&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16568374" author="hudson" created="Fri, 3 Aug 2018 15:42:57 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #291 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/291/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/291/&lt;/a&gt;)&lt;br/&gt;
fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; contributed by grigoriy (grigoriyalexeev: rev ba436227b987199717b5b94689d10c7b0d1deb14)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; change test file name (tallison: rev 7e477e3ae6eaf819f42be2d7eb43aaef89002e4c)&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testWMF_charset.wmf&lt;/li&gt;
	&lt;li&gt;(delete) tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16568550" author="hudson" created="Fri, 3 Aug 2018 18:06:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1536 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1536/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1536/&lt;/a&gt;)&lt;br/&gt;
fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; contributed by grigoriy (grigoriyalexeev: &lt;a href=&quot;https://github.com/apache/tika/commit/ba436227b987199717b5b94689d10c7b0d1deb14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/ba436227b987199717b5b94689d10c7b0d1deb14&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; change test file name (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/7e477e3ae6eaf819f42be2d7eb43aaef89002e4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/7e477e3ae6eaf819f42be2d7eb43aaef89002e4c&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testWMF_charset.wmf&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;/li&gt;
	&lt;li&gt;(delete) tika-parsers/src/test/resources/test-documents/thumbnail_1.wmf&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16568566" author="hudson" created="Fri, 3 Aug 2018 18:17:54 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #67 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/67/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/67/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2701&quot; title=&quot;Text is not extracted properly from WMF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2701&quot;&gt;TIKA-2701&lt;/a&gt; &amp;#8211; via Grigoriy Alekseev (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/d66dcbbbcf59f5b4034a47fed3346ad513b1fcc9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/d66dcbbbcf59f5b4034a47fed3346ad513b1fcc9&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WMFParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WMFParser.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testWMF_charset.wmf&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12933889" name="thumbnail_1.wmf" size="9316" author="galekseev" created="Wed, 1 Aug 2018 09:55:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wk7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>