<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:03:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3405] Open file leak in MP4Parser</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3405</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;After upgrading Tika to version 1.26 (I was using 1.20 before), I started to have some trouble with video files that after Tika parsing couldn&apos;t be moved/deleted because they remained opened after finishing parsing process.&lt;/p&gt;

&lt;p&gt;Investigating the issue, which in my case affects MOV/QT video files (not all of them), I found out that it happens whenever an exception is throw inside&#160;&lt;tt&gt;IsoFile()&lt;/tt&gt; constructor (which is in fact part of MP4Parser project).&#160;&lt;/p&gt;

&lt;p&gt;A simple test snippet to reproduce the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
File file = ...; &lt;span class=&quot;code-comment&quot;&gt;//A test file
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (IsoFile isoFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IsoFile(file)) {
&#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;isoFile = &quot;&lt;/span&gt; + isoFile);
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&#160; &#160; e.printStackTrace();
}
&lt;span class=&quot;code-comment&quot;&gt;//Here the file is still opened&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the relevant part of &lt;tt&gt;IsoFile&lt;/tt&gt; constructor:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; IsoFile(File file) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file).getChannel(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PropertyBoxParserImpl());
}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; IsoFile(ReadableByteChannel readableByteChannel, BoxParser boxParser) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt;    IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.readableByteChannel = readableByteChannel;
    initContainer(readableByteChannel, -1, boxParser);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So if &lt;tt&gt;initContainer()&lt;/tt&gt; fails,&#160;&lt;tt&gt;readableByteChannel&lt;/tt&gt; will not be closed.&lt;br/&gt;
 In the case of the videos I have here, &lt;tt&gt;initContainer()&lt;/tt&gt;&#160;throws a &lt;tt&gt;RuntimeException&lt;/tt&gt; because an unsupported data (although&#160; the videos are valid and I can open them):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.RuntimeException: box size of zero means &apos;till end of file. That is not yet supported&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A possible solution would be changing &lt;tt&gt;IsoFile&lt;/tt&gt; constructor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; IsoFile(ReadableByteChannel readableByteChannel, BoxParser boxParser) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.readableByteChannel = readableByteChannel;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        initContainer(readableByteChannel, -1, boxParser);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            close();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e2) {
        }
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A sample file that cause this issue is attached. I have others if necessary.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10, Oracle JDK 8 (64-bit, 1.8.0_281)&lt;/p&gt;</environment>
        <key id="13378531">TIKA-3405</key>
            <summary>Open file leak in MP4Parser</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tc-wleite">Wladimir Leite</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 May 2021 20:53:55 +0000</created>
                <updated>Mon, 17 May 2021 19:58:01 +0000</updated>
                                            <version>1.26</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17346176" author="lfcnassif" created="Mon, 17 May 2021 13:50:55 +0000"  >&lt;p&gt;Seems there is a previous issue related to this: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-3128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And a PR was already proposed to fix the issue: &lt;a href=&quot;https://github.com/tballison/mp4parser/pull/1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tballison/mp4parser/pull/1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I particularly prefer&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tc-wleite&quot; class=&quot;user-hover&quot; rel=&quot;tc-wleite&quot;&gt;tc-wleite&lt;/a&gt;&apos;s&#160;solution instead of hiding the RuntimeException.&lt;/p&gt;</comment>
                            <comment id="17346210" author="tallison@mitre.org" created="Mon, 17 May 2021 14:58:26 +0000"  >&lt;p&gt;Ugh.  I hadn&apos;t seen that.  Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;!  I&apos;ll fix this now, push the release of that fork and then upgrade for 1.27.  Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tc-wleite&quot; class=&quot;user-hover&quot; rel=&quot;tc-wleite&quot;&gt;tc-wleite&lt;/a&gt; for opening this issue and sharing a triggering file!&lt;/p&gt;</comment>
                            <comment id="17346253" author="tallison@mitre.org" created="Mon, 17 May 2021 16:16:38 +0000"  >&lt;p&gt;I just pushed 1.9.41.5 to maven central.  When that gets there, I&apos;ll update Tika.&lt;/p&gt;</comment>
                            <comment id="17346261" author="tc-wleite" created="Mon, 17 May 2021 16:46:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;,&#160;thank you for the quick response!&#160;&lt;/p&gt;</comment>
                            <comment id="17346407" author="hudson" created="Mon, 17 May 2021 19:37:31 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build Tika &#187; tika-branch1x-jdk8 #130 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-branch1x-jdk8/130/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-branch1x-jdk8/130/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3405&quot; title=&quot;Open file leak in MP4Parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3405&quot;&gt;TIKA-3405&lt;/a&gt; &amp;#8211; fix and upgrade isoparser (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/c6998bdfeb1c598ca9ee0f4833caae64d05c60f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/c6998bdfeb1c598ca9ee0f4833caae64d05c60f5&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17346416" author="hudson" created="Mon, 17 May 2021 19:58:01 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #235 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/235/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/235/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3405&quot; title=&quot;Open file leak in MP4Parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3405&quot;&gt;TIKA-3405&lt;/a&gt; &amp;#8211; upgrade isoparser (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/592dea4654327b055ad41061b42b910e790eae76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/592dea4654327b055ad41061b42b910e790eae76&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parent/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13025484" name="1.mov" size="82395" author="tc-wleite" created="Fri, 14 May 2021 20:51:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r1ow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>