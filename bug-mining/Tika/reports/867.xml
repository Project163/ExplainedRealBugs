<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:00:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2219] CharsetDetector no longer detects windows-1252 charset</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2219</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Starting with Tika 1.14, windows-1252 is no longer detected, as ISO-8859-1 is always detected instead.  While not tested, this likely affects other windows-125* encodings as well.&lt;/p&gt;

&lt;p&gt;I tracked it down to a change in the &lt;tt&gt;CharsetRecog_sbcs.CharsetRecog_8859_1#getName()&lt;/tt&gt; method.  Now it always returns &quot;ISO-8859-1&quot; whereas before it was: &lt;tt&gt;return haveC1Bytes ? &quot;windows-1252&quot; : &quot;ISO-8859-1&quot;;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Now that condition has been moved to the &lt;tt&gt;match(CharsetDetector det)&lt;/tt&gt; method so that the returned CharsetMatch has the proper name.  The problem with that is &lt;tt&gt;CharsetDetector#detectAll()&lt;/tt&gt; method overwrites the correct match with a new one that will return the value of &lt;tt&gt;#getName()&lt;/tt&gt;  from the &lt;tt&gt;CharsetRecognizer&lt;/tt&gt; instead (which is always &quot;ISO-8859-1&quot; in this case).&lt;/p&gt;

&lt;p&gt;There might be legitimate reasons why the &lt;tt&gt;CharsetMatch&lt;/tt&gt; instances in &lt;tt&gt;detectAll()&lt;/tt&gt; method are replaced with new ones, but changing this code in that method appears to work for me:&lt;/p&gt;

&lt;p&gt;// Remove this:&lt;br/&gt;
//                    CharsetMatch m = new CharsetMatch(this, csr, confidence);&lt;br/&gt;
//                    matches.add(m);&lt;/p&gt;

&lt;p&gt;// Add this instead:&lt;br/&gt;
                    matches.add(charsetMatch);&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any.&lt;/p&gt;</environment>
        <key id="13029274">TIKA-2219</key>
            <summary>CharsetDetector no longer detects windows-1252 charset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pascal.essiembre">Pascal Essiembre</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Dec 2016 22:12:23 +0000</created>
                <updated>Mon, 12 Apr 2021 13:01:18 +0000</updated>
                            <resolved>Tue, 20 Dec 2016 19:26:37 +0000</resolved>
                                    <version>1.14</version>
                                    <fixVersion>1.15</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15764363" author="tallison@mitre.org" created="Tue, 20 Dec 2016 14:46:45 +0000"  >&lt;p&gt;Thank you for opening this. This was caused by our &quot;upgrade&quot; to our copy of ICU4J (&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt;).  I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="15765010" author="tallison@mitre.org" created="Tue, 20 Dec 2016 19:19:42 +0000"  >&lt;p&gt;Y, your diagnosis is correct.  Thank you.&lt;/p&gt;

&lt;p&gt;So that we capture the updated confidence, I used the fuller constructor:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                    CharsetMatch m = new CharsetMatch(this, csr, confidence, charsetMatch.getName(), charsetMatch.getLanguage());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Out of curiosity are you using the standard detectors in order, or are you only using CharsetDetector?&lt;/p&gt;

&lt;p&gt;I found that the UniversalEncodingDetector was applying ISO-8859-1 to the file I created to trigger &quot;windows-1252&quot; in CharsetDetector.&lt;/p&gt;</comment>
                            <comment id="15765034" author="pascal.essiembre" created="Tue, 20 Dec 2016 19:30:24 +0000"  >&lt;p&gt;I am relying on CharsetDetector.  Thanks for the fix!&lt;/p&gt;</comment>
                            <comment id="15765059" author="pascal.essiembre" created="Tue, 20 Dec 2016 19:37:53 +0000"  >&lt;p&gt;BTW, I tested and can confirm you fix works just fine.&lt;/p&gt;</comment>
                            <comment id="15765129" author="hudson" created="Tue, 20 Dec 2016 20:12:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1163 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1163/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1163/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2219&quot; title=&quot;CharsetDetector no longer detects windows-1252 charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2219&quot;&gt;&lt;del&gt;TIKA-2219&lt;/del&gt;&lt;/a&gt; - make sure to transmit encoding name in detectAll() via (tallison: rev 2dbd65122a477c1b7a61d88e4fdf25a3d47effcd)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testTXT_win-1252.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/txt/CharsetDetectorTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15765144" author="hudson" created="Tue, 20 Dec 2016 20:19:53 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build tika-2.x-windows #85 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/85/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/85/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2219&quot; title=&quot;CharsetDetector no longer detects windows-1252 charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2219&quot;&gt;&lt;del&gt;TIKA-2219&lt;/del&gt;&lt;/a&gt; make sure to transmit charset name in detectAll via Pascal (tallison: rev 68f3058643756d8e08f85903a585684f7d0f0b20)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/test/java/org/apache/tika/parser/txt/CharsetDetectorTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-test-resources/src/test/resources/test-documents/testTXT_win-1252.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15765207" author="hudson" created="Tue, 20 Dec 2016 20:47:34 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x #184 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/184/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/184/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2219&quot; title=&quot;CharsetDetector no longer detects windows-1252 charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2219&quot;&gt;&lt;del&gt;TIKA-2219&lt;/del&gt;&lt;/a&gt; make sure to transmit charset name in detectAll via Pascal (tallison: rev 68f3058643756d8e08f85903a585684f7d0f0b20)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/test/java/org/apache/tika/parser/txt/CharsetDetectorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;(add) tika-test-resources/src/test/resources/test-documents/testTXT_win-1252.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15765343" author="tallison@mitre.org" created="Tue, 20 Dec 2016 21:50:04 +0000"  >&lt;p&gt;Great.  Thank you!&lt;/p&gt;</comment>
                            <comment id="15765347" author="tallison@mitre.org" created="Tue, 20 Dec 2016 21:51:06 +0000"  >&lt;p&gt;Looks like they aren&apos;t twiddling with the confidence scores any more (see: &lt;a href=&quot;http://bugs.icu-project.org/trac/browser/icu4j/tags/release-58-1/main/classes/core/src/com/ibm/icu/text/CharsetDetector.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repo&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;193	        for (int i = 0; i &amp;lt; ALL_CS_RECOGNIZERS.size(); i++) {
194	            CSRecognizerInfo rcinfo = ALL_CS_RECOGNIZERS.get(i);
195	            boolean active = (fEnabledRecognizers != null) ? fEnabledRecognizers[i] : rcinfo.isDefaultEnabled;
196	            if (active) {
197	                CharsetMatch m = rcinfo.recognizer.match(this);
198	                if (m != null) {
199	                    matches.add(m);
200	                }
201	            }
202	        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15765412" author="hudson" created="Tue, 20 Dec 2016 22:19:28 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build tika-2.x-windows #86 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/86/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/86/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2219&quot; title=&quot;CharsetDetector no longer detects windows-1252 charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2219&quot;&gt;&lt;del&gt;TIKA-2219&lt;/del&gt;&lt;/a&gt; make sure to transmit charset name in detectAll via Pascal (tallison: rev 54154e0045066dfb50a10d158090262acaabaaba)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/test/java/org/apache/tika/parser/txt/CharsetDetectorTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15765514" author="hudson" created="Tue, 20 Dec 2016 23:03:51 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-2.x #185 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/185/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/185/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2219&quot; title=&quot;CharsetDetector no longer detects windows-1252 charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2219&quot;&gt;&lt;del&gt;TIKA-2219&lt;/del&gt;&lt;/a&gt; make sure to transmit charset name in detectAll via Pascal (tallison: rev 54154e0045066dfb50a10d158090262acaabaaba)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-text-module/src/test/java/org/apache/tika/parser/txt/CharsetDetectorTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16149673" author="mcaruanagalizia" created="Thu, 31 Aug 2017 21:55:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt; I think this issue has regressed. Please take a look at the attached file. It&apos;s parsed as an email but the body text is detected as US-ASCII instead of Windows-1252 (note the x92 characters).&lt;/p&gt;</comment>
                            <comment id="16149675" author="mcaruanagalizia" created="Thu, 31 Aug 2017 21:56:26 +0000"  >&lt;p&gt;This file contains x92 characters which should force detection to Windows-1252.&lt;/p&gt;</comment>
                            <comment id="16150712" author="tallison@mitre.org" created="Fri, 1 Sep 2017 15:21:38 +0000"  >&lt;p&gt;Not sure if there&apos;s anything we can do here.&lt;/p&gt;

&lt;p&gt;The attached file doesn&apos;t go through the charset detector at all because it is parsed by the RFC822Parser.  If you parse the file with the TXTParser (which in turn calls CharsetDetector), it is correctly id&apos;d as windows-1252 and correctly parsed.&lt;/p&gt;

&lt;p&gt;IIRC, the correct way to encode windows-1252 in RFC822  should be something like &lt;tt&gt;?windows-1252?Q?100_=80?&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Any recommended fix?&lt;/p&gt;</comment>
                            <comment id="16150718" author="mcaruanagalizia" created="Fri, 1 Sep 2017 15:26:56 +0000"  >&lt;p&gt;Thanks for getting back. Shouldn&apos;t the RFC822Parser attempt to detect the body encoding when none is declared?&lt;/p&gt;</comment>
                            <comment id="16150752" author="tallison@mitre.org" created="Fri, 1 Sep 2017 15:51:08 +0000"  >&lt;p&gt;I defer to others, but I think RFC822 specifies old school ascii as default and doesn&apos;t expect or allow anything else unless declared as in the example above.&lt;/p&gt;

&lt;p&gt;We can allow for more flexibility than the spec allows, but the challenge is that the underlying mime4j parser is reading an inputstream and interpreting it as ASCII.  I don&apos;t think we can pass it a &lt;tt&gt;Reader&lt;/tt&gt; or otherwise specify an encoding...I only looked very quickly tho.&lt;/p&gt;

&lt;p&gt;Any recommendations?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12884803" name="test.txt" size="352" author="mcaruanagalizia" created="Thu, 31 Aug 2017 21:55:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37slj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>