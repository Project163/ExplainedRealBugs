<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:03:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3517] Text extraction doesn&apos;t work for Pages and Numbers when Tesseract is disabled</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3517</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When I try running tika to try to extract text from Mac Pages and Numbers files, the text extraction does not work if Tesseract is disabled. &#160;I&apos;m attaching sample files, including the config file I use to disable Tesseract. &#160;I get the same results whether I run the server version (tika-server-standard-2.0.0.jar) or the command line app (tika-app-2.0.0.jar). &#160;&lt;/p&gt;

&lt;p&gt;The following commands extract text along with what appears to be a list of a bunch of .iwa files and .jpg files inside the Pages and Numbers files:&lt;/p&gt;

&lt;p&gt;java -jar ~/tika-app-2.0.0.jar -t ~/SSN.pages&lt;/p&gt;

&lt;p&gt;java -jar ~/tika-app-2.0.0.jar -t ~/SSN.numbers&lt;/p&gt;

&lt;p&gt;However, when I run the following commands using the configuration file to disable Tesseract, all that is extracted is the list of .iwa and .jpg files and none of the actual text is extracted:&lt;/p&gt;

&lt;p&gt;java -jar ~/tika-app-2.0.0.jar --config=no_ocr.xml -t ~/SSN.pages&lt;/p&gt;

&lt;p&gt;java -jar ~/tika-app-2.0.0.jar --config=no_ocr.xml -t ~/SSN.numbers&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I haven&apos;t see similar problems with other types of files I&apos;ve tested with, including .docx, pptx, .xlsx, .odt, .ods, .odp, and .pdf. &#160;Those work fine with or without Tesseract disabled.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On a somewhat separate issue, I have been unable to get any text extracted from my test Keynote file at all, whether Tesseract is enabled or not. &#160;I&apos;m having difficulty uploading that file, so I&apos;ll see if I can add that later.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;I tested this on RHEL7. &#160;I got the same results whether I was using Tesseract 3 or Tesseract 4, but that doesn&apos;t really matter because the problems I&apos;m having are when Tesseract is disabled.&lt;/p&gt;</environment>
        <key id="13393974">TIKA-3517</key>
            <summary>Text extraction doesn&apos;t work for Pages and Numbers when Tesseract is disabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="heyyoucb">Chris Bryant</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Aug 2021 21:28:49 +0000</created>
                <updated>Mon, 9 Aug 2021 20:27:52 +0000</updated>
                                            <version>2.0.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17394998" author="tallison@mitre.org" created="Fri, 6 Aug 2021 21:58:27 +0000"  >&lt;p&gt;Sorry about this.  The answer will bring you no joy.&lt;/p&gt;

&lt;p&gt;We don&apos;t handle the more modern versions of iWorks files.  In Tika 1.x, the numbers file is being detected as &quot;application/vnd.apple.unknown.13&quot;, and no text is returned.  There&apos;s clearly a bug in tika-app and tika-server in 2.0.0 that is preventing correct file type detection of iworks files.  I&apos;ll figure that out and fix it on this issue.  When that is fixed, though, you&apos;ll get correct file type detection, but still no text because we don&apos;t support these versions of iworks. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The reason you&apos;re getting text w ocr is because of the thumbnails in the file.&lt;/p&gt;</comment>
                            <comment id="17395967" author="tallison@mitre.org" created="Mon, 9 Aug 2021 10:52:02 +0000"  >&lt;p&gt;I fixed this in main/2.0.1-SNAPSHOT.  However, regrettably, we still don&apos;t support text extraction from these files.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if we should open a separate issue to extract the thumbnails so that you can at least run OCR against them?&lt;/p&gt;</comment>
                            <comment id="17396006" author="hudson" created="Mon, 9 Aug 2021 12:01:15 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #304 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/304/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/304/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3517&quot; title=&quot;Text extraction doesn&amp;#39;t work for Pages and Numbers when Tesseract is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3517&quot;&gt;TIKA-3517&lt;/a&gt; &amp;#8211; fix iwork 13 detection in the streaming zip detector code within IWork13PackageParser (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/eed26c90121e1049d379a97ef480ce0830b018d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/eed26c90121e1049d379a97ef480ce0830b018d1&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-apple-module/src/main/java/org/apache/tika/parser/iwork/iwana/IWork13PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-apple-module/src/test/java/org/apache/tika/parser/iwork/iwana/IWork13ParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/apache/tika/detect/TestContainerAwareDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17396040" author="heyyoucb" created="Mon, 9 Aug 2021 13:20:39 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;.&#160; I see Tika-1358 now.&#160; With regular extraction not working, I guess it is nice that OCR can pull the text from the thumbnails.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17396260" author="tallison@mitre.org" created="Mon, 9 Aug 2021 20:20:37 +0000"  >&lt;p&gt;For posterity, I&apos;m attaching the Document.iwa file from inside the zip, and a decompressed Document (decompressed with snzip (&lt;a href=&quot;https://github.com/kubo/snzip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kubo/snzip&lt;/a&gt;) &lt;tt&gt;snzip -t iwa -d Document.iwa&lt;/tt&gt;).  I&apos;m not able to process the decompressed file with protoc &lt;tt&gt;protoc --decode_raw &amp;lt; Document&lt;/tt&gt; or with the java protobuf library.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        try (InputStream is = Files.newInputStream(Paths.get(&quot;/blah/blah/Document&quot;))) {
            UnknownFieldSet doc =
                    UnknownFieldSet.parseFrom(is);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get &quot;Protocol message tag had invalid wire type&quot; from the latter and &quot;Failed to parse input&quot; from the former.&lt;/p&gt;

&lt;p&gt;I also tried decompressing the stream with Commons compress and got the same results.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        Path p = Paths.get(&quot;/blah/blah/Document.iwa&quot;);
        try (InputStream is = new FramedSnappyCompressorInputStream(Files.newInputStream(p),
                FramedSnappyDialect.IWORK_ARCHIVE)) {
            UnknownFieldSet doc =
                    UnknownFieldSet.parseFrom(is);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There be dragons. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12723815">TIKA-1358</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13031673" name="Document" size="15889" author="tallison" created="Mon, 9 Aug 2021 20:16:27 +0000"/>
                            <attachment id="13031672" name="Document.iwa" size="9252" author="tallison" created="Mon, 9 Aug 2021 20:16:27 +0000"/>
                            <attachment id="13031592" name="SSN.numbers" size="669775" author="heyyoucb" created="Fri, 6 Aug 2021 21:09:35 +0000"/>
                            <attachment id="13031593" name="SSN.pages" size="833113" author="heyyoucb" created="Fri, 6 Aug 2021 21:09:29 +0000"/>
                            <attachment id="13031591" name="no_ocr.xml" size="241" author="heyyoucb" created="Fri, 6 Aug 2021 21:11:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0totc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>