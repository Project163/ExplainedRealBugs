<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:01:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2311] Preserve &quot;x-tika-ooxml&quot; mime value for truncated ooxml files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2311</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The following is an unintended consequence of &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2212&quot; title=&quot;Update mimes for OOXMLParser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2212&quot;&gt;&lt;del&gt;TIKA-2212&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The OOXML parser used to handle &lt;tt&gt;x-tika-ooxml&lt;/tt&gt;. We have some truncated ooxml files in our regression corpus.  The previous behavior was:&lt;/p&gt;

&lt;p&gt;1) ZipPackage detector caught the zip truncation exception and returned &quot;application/zip&quot;&lt;br/&gt;
2) The mime detector recognized magic and returned &lt;tt&gt;x-tika-ooxml&lt;/tt&gt;&lt;br/&gt;
3) The file was then routed to the OOXML parser which didn&apos;t wind up doing much with the content because it hit the zip exception early on, but the final mime type was &lt;tt&gt;x-tika-ooxml&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The current behavior&lt;br/&gt;
1) Same detection steps&lt;br/&gt;
2) However, because the OOXML parser no longer handles &lt;tt&gt;x-tika-ooxml&lt;/tt&gt;, the file is handled by the Package Parser, which overwrites the magic-determined mime type, and the new mime type is &lt;tt&gt;application/zip&lt;/tt&gt;.&lt;br/&gt;
3) Some content is extracted because the Package parser handles the zip entries in order and only throws the exception once it hits the last entry in the zip file.&lt;/p&gt;

&lt;p&gt;Ideally, I&apos;d like to keep the magic-determined mime detection.  Once we can chain parsers, the user should be able to backoff to the PackageParser, but I don&apos;t think this should be the default behavior.&lt;/p&gt;

&lt;p&gt;One solution would be to create a new mime type that is not the parent of the other ooxml subtypes, but is itself a leaf subtype, something like: &lt;tt&gt;x-tika-ooxml-unk&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Any objections/other recommendations?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13059375">TIKA-2311</key>
            <summary>Preserve &quot;x-tika-ooxml&quot; mime value for truncated ooxml files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Mar 2017 11:30:25 +0000</created>
                <updated>Mon, 12 Apr 2021 13:02:00 +0000</updated>
                            <resolved>Mon, 1 May 2017 19:23:28 +0000</resolved>
                                                    <fixVersion>1.15</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15943165" author="lfcnassif" created="Mon, 27 Mar 2017 12:35:46 +0000"  >&lt;p&gt;Hi Tim,&lt;/p&gt;

&lt;p&gt;What about removing the mimetype overwrite logic from PackageParser? So truncated ooxml will continue to be x-tika-ooxml and will be handled by PackageParser or other future parser for generics ooxml?&lt;/p&gt;</comment>
                            <comment id="15943216" author="tallison@mitre.org" created="Mon, 27 Mar 2017 12:59:23 +0000"  >&lt;p&gt;I thought about that.  I was uncomfortable with the tight coupling of checking if &quot;x-tika-ooxml&quot; had already been set in the PackageParser.  Or, should we have a more general check if &lt;tt&gt;Content-Type&lt;/tt&gt; has already been set, do not overwrite?&lt;/p&gt;

&lt;p&gt;I prefer this option to my original proposal.&lt;/p&gt;</comment>
                            <comment id="15943238" author="gagravarr" created="Mon, 27 Mar 2017 13:16:03 +0000"  >&lt;p&gt;How about we have package parser say &quot;if no mimetype set or current mimetype is not based on zip, set to zip. If current mimetype is a child of zip, leave unchanged&quot; ?&lt;/p&gt;</comment>
                            <comment id="15943281" author="tallison@mitre.org" created="Mon, 27 Mar 2017 13:40:42 +0000"  >&lt;p&gt;Y, this is far preferable.&lt;/p&gt;

&lt;p&gt;Is there a lightweight way to grab the MediaTypeRegistry in order to do the checking for &quot;child of zip&quot;?  Create singleton in PackageParser?  Or a better way?&lt;/p&gt;</comment>
                            <comment id="15967868" author="tallison@mitre.org" created="Thu, 13 Apr 2017 16:49:39 +0000"  >&lt;p&gt;When I use a static MediaTypesRegistry in PackageParser, the new unit test passes on a truncated docx, however test-documents.tar is now detected as &quot;x-gtar&quot;.&lt;/p&gt;

&lt;p&gt;Looking at the definition: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;mime-type type=&quot;application/x-gtar&quot;&amp;gt;
    &amp;lt;_comment&amp;gt;GNU tar Compressed File Archive (GNU Tape Archive)&amp;lt;/_comment&amp;gt;
      &amp;lt;magic priority=&quot;50&quot;&amp;gt;
           GNU tar archive
      &amp;lt;match value=&quot;ustar  \0&quot; type=&quot;string&quot; offset=&quot;257&quot; /&amp;gt;
    &amp;lt;/magic&amp;gt;
    &amp;lt;glob pattern=&quot;*.gtar&quot;/&amp;gt;
    &amp;lt;sub-class-of type=&quot;application/x-tar&quot;/&amp;gt;
  &amp;lt;/mime-type&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is this really the mime for &lt;tt&gt;ustar&lt;/tt&gt; not &lt;tt&gt;gtar&lt;/tt&gt;???&lt;/p&gt;</comment>
                            <comment id="15967876" author="tallison@mitre.org" created="Thu, 13 Apr 2017 16:56:05 +0000"  >&lt;p&gt;Ha, Nifi overrides our def and just calls it &lt;tt&gt;.tar&lt;/tt&gt;: &lt;a href=&quot;https://github.com/apache/nifi/blob/master/nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/resources/org/apache/tika/mime/custom-mimetypes.xml#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Should we do the same?&lt;/p&gt;</comment>
                            <comment id="15967977" author="tallison@mitre.org" created="Thu, 13 Apr 2017 18:04:00 +0000"  >&lt;p&gt;Thank you, for the feedback, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I kept our distinction, if I understand correctly, btwn posix and gnu tar by modifying the unit test.&lt;/p&gt;</comment>
                            <comment id="15968059" author="hudson" created="Thu, 13 Apr 2017 18:47:12 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #197 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/197/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/197/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; maintain x-tika-ooxml mime type for truncated ooxml (tallison: rev 143efc8d92735099f5077956d8f257aad106321a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/test/java/org/apache/tika/parser/pkg/TarParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(add) tika-test-resources/src/test/resources/test-documents/testWORD_truncated.docx&lt;/li&gt;
	&lt;li&gt;(edit) tika-app/src/test/java/org/apache/tika/parser/pkg/PackageTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-office-module/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15968088" author="hudson" created="Thu, 13 Apr 2017 19:03:04 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-2.x #243 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/243/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/243/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; maintain x-tika-ooxml mime type for truncated ooxml (tallison: rev 143efc8d92735099f5077956d8f257aad106321a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-app/src/test/java/org/apache/tika/parser/pkg/PackageTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(add) tika-test-resources/src/test/resources/test-documents/testWORD_truncated.docx&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-office-module/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/test/java/org/apache/tika/parser/pkg/TarParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15968089" author="hudson" created="Thu, 13 Apr 2017 19:03:35 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1239 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1239/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1239/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; maintain mime information for truncated ooxml (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/3aab15f8f277614e3c5783c4862e25d63b737425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/3aab15f8f277614e3c5783c4862e25d63b737425&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/src/test/resources/test-documents/testWORD_truncated.docx&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/TarParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15990828" author="tallison@mitre.org" created="Mon, 1 May 2017 14:01:28 +0000"  >&lt;p&gt;Regression corpus shows the initial fix is not enough.&lt;/p&gt;

&lt;p&gt;There are some truncated files in our regression corpus that can be opened by OPCPackage but cannot be opened by ZipFile.  These files can be fully parsed by the OOXMLParser without an exception &amp;#8211; the truncated embedded file is never required for parsing.&lt;/p&gt;

&lt;p&gt;If we flip the order in detectZipFormat to open an OPCPackage and test for ooxml before opening a ZipFile, we get the same behavior as in 1.14 on our unit tests and on the handful of example files from our regression set.  We&apos;ll need to confirm that this doesn&apos;t lead to any unforeseen behavior in other files in the regression set.  &lt;/p&gt;

</comment>
                            <comment id="15990829" author="tallison@mitre.org" created="Mon, 1 May 2017 14:02:03 +0000"  >&lt;p&gt;example xlsm file that cannot be opened by MSWord, but which can be parsed without an exception by Tika 1.14.&lt;/p&gt;</comment>
                            <comment id="15991352" author="tallison@mitre.org" created="Mon, 1 May 2017 19:23:28 +0000"  >&lt;p&gt;Will reopen if that didn&apos;t fix the problem...&lt;/p&gt;</comment>
                            <comment id="15991415" author="hudson" created="Mon, 1 May 2017 19:48:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1253 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1253/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1253/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; to handle truncated files more robustly, in (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/0b37895ef0eae560444e3078b7fa33f6fec11eca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/0b37895ef0eae560444e3078b7fa33f6fec11eca&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15991497" author="hudson" created="Mon, 1 May 2017 20:40:39 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x #250 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/250/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/250/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; try OPC before ZipFile.  This can work better on some (tallison: rev 6930ff0251e9e93ee969a9f1287c902d31045b59)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-office-module/src/main/java/org/apache/tika/parser/opc/OPCDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15991502" author="hudson" created="Mon, 1 May 2017 20:43:58 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #203 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/203/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/203/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2311&quot; title=&quot;Preserve &amp;quot;x-tika-ooxml&amp;quot; mime value for truncated ooxml files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2311&quot;&gt;&lt;del&gt;TIKA-2311&lt;/del&gt;&lt;/a&gt; &amp;#8211; try OPC before ZipFile.  This can work better on some (tallison: rev 6930ff0251e9e93ee969a9f1287c902d31045b59)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/ZipContainerDetector.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-office-module/src/main/java/org/apache/tika/parser/opc/OPCDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13112464">TIKA-2483</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12865764" name="2ANEZKVHPKXC4VYR2HKYUYRVWFLCQTXI" size="24576" author="tallison" created="Mon, 1 May 2017 14:02:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ctzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>