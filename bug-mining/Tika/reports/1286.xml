<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:04:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3710] HTML document detected incorrect as message/rfc822</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3710</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I&apos;m detecting content types and extracting text from documents using the AutoDetectParser.&lt;/p&gt;

&lt;p&gt;I&apos;ve received some documents that are HTML fragments generated from emails. The documents are clearly HTML, not emails, but the AutoDetectParser gives me the MIME type message/rfc822 and no text. I&apos;ve attached an example.&lt;/p&gt;

&lt;p&gt;It looks like the presence of From:, Sent:, and Subject: at the beginning of lines is why the documents are matching RFC822. However, I believe the presence of HTML before these headers means the document is not valid RFC822.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13437111">TIKA-3710</key>
            <summary>HTML document detected incorrect as message/rfc822</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="samstephens">Sam Stephens</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2022 01:11:57 +0000</created>
                <updated>Thu, 2 Jun 2022 09:53:59 +0000</updated>
                            <resolved>Thu, 2 Jun 2022 09:53:59 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.4.1</fixVersion>
                                    <component>detector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17515921" author="tallison@mitre.org" created="Fri, 1 Apr 2022 13:34:00 +0000"  >&lt;p&gt;Y, I agree.  rfc822 detection continues to be a pain.&lt;/p&gt;

&lt;p&gt;Did the original html file actually have an html header?  Or did it literally start at &amp;lt;h2&amp;gt;?&lt;/p&gt;

&lt;p&gt;We can tighten our rules a bit.&lt;/p&gt;</comment>
                            <comment id="17516142" author="JIRAUSER287416" created="Fri, 1 Apr 2022 21:32:44 +0000"  >&lt;p&gt;The HTML document is exactly what you see there; these documents are fragments, not full HTML documents. However I did try wrapping the fragment in &amp;lt;html/&amp;gt; and &amp;lt;body/&amp;gt; tags to make a full document, and it was still detected as message/rfc822.&lt;/p&gt;</comment>
                            <comment id="17538524" author="JIRAUSER287416" created="Wed, 18 May 2022 01:02:02 +0000"  >&lt;p&gt;Note that I exclude org.apache.tika.parser.mail.RFC822Parser as a parser, my debugging appears to show org.apache.tika.parser.csv.TextAndCSVParser being used for parsing, we get the full raw text of the document, including HTML tags, and the returned content type is &apos;message/rfc822; charset=ISO-8859-1&apos;.&lt;/p&gt;</comment>
                            <comment id="17538885" author="tallison@mitre.org" created="Wed, 18 May 2022 14:51:18 +0000"  >&lt;p&gt;As I look at our mime type for html, we do include &lt;tt&gt;h1&lt;/tt&gt; at offset 0 as sufficient to identify html.  Here you have &lt;tt&gt;h2&lt;/tt&gt;... hmmm... &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17538896" author="gagravarr" created="Wed, 18 May 2022 15:04:21 +0000"  >&lt;p&gt;The h1 isn&apos;t quite as unique as we might like, and maybe not as good as some of the other ones&lt;/p&gt;

&lt;p&gt;How about changing that to &amp;lt;h1&amp;gt; or &amp;lt;h1&#160; (so opening+h1+closing or opening+h1+space) and then adding the same for h2 and h3?&lt;/p&gt;</comment>
                            <comment id="17538963" author="tallison@mitre.org" created="Wed, 18 May 2022 17:03:02 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt;. I was being imprecise on &lt;tt&gt;h1&lt;/tt&gt;, we actually do require &lt;tt&gt;&amp;lt;h1&lt;/tt&gt;. I&apos;ll add the same for &lt;tt&gt;&amp;lt;h2&lt;/tt&gt; and &lt;tt&gt;&amp;lt;h3&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17538974" author="tallison@mitre.org" created="Wed, 18 May 2022 17:21:25 +0000"  >&lt;p&gt;The hiccup is this point in the mimetypes.xml file.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    &amp;lt;!-- The magic priority needs to be lower than that of --&amp;gt;
    &amp;lt;!--  files which contain HTML within them, eg mime emails --&amp;gt;
    &amp;lt;magic priority=&quot;40&quot;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even if the file starts with &lt;tt&gt;&amp;lt;html&amp;gt;&lt;/tt&gt;, we&apos;re identifying the file as &lt;tt&gt;appplication/rfc822&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17539051" author="JIRAUSER287416" created="Wed, 18 May 2022 20:01:30 +0000"  >&lt;p&gt;Is it valid for a message/rfc822 message to have a bunch of preamble like the HTML tags in my document before the headers? Is the answer that the RFC822 detection here is too loose, and the non-header material at the beginning of my file should result in the message/rfc822 parser rejecting it?&lt;/p&gt;</comment>
                            <comment id="17539054" author="JIRAUSER287416" created="Wed, 18 May 2022 20:07:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;The h1 isn&apos;t quite as unique as we might like, and maybe not as good as some of the other ones&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Honestly, I&apos;m not so worried about the HTML fragment detection, because that&apos;s never going to be perfect. A bare text string without any HTML tags is technically an HTML fragment. In the modern world where people can and do define their own HTML tags, you &lt;em&gt;could&lt;/em&gt; say that any file opens with a valid tag as defined by the W3C is HTML, but that feels open to false positives.&lt;/p&gt;</comment>
                            <comment id="17539574" author="tallison@mitre.org" created="Thu, 19 May 2022 14:19:21 +0000"  >&lt;p&gt;Sorry, that comment must have referred to the patterns in that block that allowed content before the html tags.  The patterns currently require the &lt;tt&gt;&amp;lt;h1&lt;/tt&gt; etc as the first character.  We could move the patterns that require a match as the first character to a different block with a higher priority?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is it valid for a message/rfc822 message to have a bunch of preamble like the HTML tags in my document before the headers? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;My memory is that we&apos;ve seen some crazy headers before the usual rfc822 headers.  I do not think we&apos;ve seen html tags in those.&lt;/p&gt;</comment>
                            <comment id="17539580" author="tallison@mitre.org" created="Thu, 19 May 2022 14:25:10 +0000"  >&lt;p&gt;This works on the test file:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;magic priority=&quot;60&quot;&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;HTML&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;html&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;HEAD&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;head&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;BODY&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;body&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;TITLE&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;title&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;DIV&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;div&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;h1&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;H1&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;h2&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;H2&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;h3&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;H3&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
    &amp;lt;/magic&amp;gt;
    &amp;lt;!-- The magic priority needs to be lower than that of --&amp;gt;
    &amp;lt;!--  files which contain HTML within them, eg mime emails --&amp;gt;
    &amp;lt;magic priority=&quot;40&quot;&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!DOCTYPE HTML&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!DOCTYPE html&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!doctype HTML&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!doctype html&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;HEAD&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;head&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;TITLE&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;title&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;HTML&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;html&quot; type=&quot;string&quot; offset=&quot;0:128&quot;/&amp;gt;
    &amp;lt;/magic&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17539582" author="gagravarr" created="Thu, 19 May 2022 14:31:49 +0000"  >&lt;p&gt;I was thinking we&apos;d do (open)h1(close) or (open)h1(space) to cover both HTML cases but reduce the changes of a false positive match (+h2/h3)&lt;/p&gt;</comment>
                            <comment id="17539590" author="tallison@mitre.org" created="Thu, 19 May 2022 14:39:18 +0000"  >&lt;p&gt;Sounds good.  What do you think of breaking those out into a higher priority block as above?  Obv, we&apos;ll need to run this on a bunch of docs to see if this is overall a good change...&lt;/p&gt;</comment>
                            <comment id="17539594" author="gagravarr" created="Thu, 19 May 2022 14:44:09 +0000"  >&lt;p&gt;As a &quot;normal&quot; html file wouldn&apos;t start with these snippets, and they&apos;re already at a pretty high priority, I think just leave them in the 60 block along with the more typical starting tags we have there now&lt;/p&gt;</comment>
                            <comment id="17539607" author="tallison@mitre.org" created="Thu, 19 May 2022 15:01:24 +0000"  >&lt;p&gt;The current main block is 40, which is intentionally below RFC822.&lt;/p&gt;

&lt;p&gt;How&apos;s this look:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;magic priority=&quot;60&quot;&amp;gt;
      &amp;lt;match value=&quot;(?i)&amp;amp;lt;(html|head|body|title|div)[ &amp;gt;]&quot; type=&quot;regex&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;(?i)&amp;amp;lt;h[123][ &amp;gt;]&quot; type=&quot;regex&quot; offset=&quot;0&quot;/&amp;gt;
    &amp;lt;/magic&amp;gt;
    &amp;lt;!-- The magic priority needs to be lower than that of --&amp;gt;
    &amp;lt;!--  files which contain HTML within them, eg mime emails --&amp;gt;
    &amp;lt;magic priority=&quot;40&quot;&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!DOCTYPE HTML&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
      &amp;lt;match value=&quot;&amp;amp;lt;!DOCTYPE html&quot; type=&quot;string&quot; offset=&quot;0:64&quot;/&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17544964" author="tallison@mitre.org" created="Wed, 1 Jun 2022 15:10:39 +0000"  >&lt;p&gt;I just committed and pushed this.  Please let me know if there are any objections.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17545044" author="hudson" created="Wed, 1 Jun 2022 17:19:39 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #624 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/624/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/624/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3710&quot; title=&quot;HTML document detected incorrect as message/rfc822&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3710&quot;&gt;&lt;del&gt;TIKA-3710&lt;/del&gt;&lt;/a&gt; - update mime detection for rfc822, again. (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/a52e4d153e950077f7fdedadcc5d75604fe2563d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/a52e4d153e950077f7fdedadcc5d75604fe2563d&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources/test-documents/testBrokenHTMLContainingRFC822.html&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/apache/tika/mime/TestMimeTypes.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17545156" author="lfcnassif" created="Wed, 1 Jun 2022 21:13:18 +0000"  >&lt;p&gt;Seems good to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; !&lt;/p&gt;</comment>
                            <comment id="17545383" author="tallison@mitre.org" created="Thu, 2 Jun 2022 09:53:50 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;lfcnassif&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13041869" name="html-that-looks-like-rfc822.html" size="452" author="samstephens" created="Fri, 1 Apr 2022 01:09:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z111ds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>