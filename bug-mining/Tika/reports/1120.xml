<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2624] Rendering PDFs for OCR with Tesseract uses different DPI than claimed</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2624</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Tika has two properties in &lt;tt&gt;PDFParser.properties&lt;/tt&gt; that control what happens in AbstractPDF2XHTML when a PDF is rendered before being passed to Tesseract for OCR.&#160; These are &lt;tt&gt;ocrDPI&lt;/tt&gt; (default 300) and &lt;tt&gt;ocrImageScale&lt;/tt&gt; (default 2.0).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ocrDPI&lt;/tt&gt; is passed to &lt;tt&gt;ImageIOUtil.writeImage&lt;/tt&gt;, which uses it as the metadata in the image (i.e. it doesn&apos;t control scaling at all, it&apos;s just an advertised metadata field).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ocrImageScale&lt;/tt&gt; is passed to PDFBox&apos;s &lt;tt&gt;PDFRenderer.renderImage&lt;/tt&gt;, which uses it to specify the scale for rendering.&#160; This value is such that 1.0 == 72dpi, and therefore Tika&apos;s default is to request 144dpi for rendering.&lt;/p&gt;

&lt;p&gt;This means that Tika is asking PDFBox to render at 144dpi, and then advertising 300dpi in the image metadata.&#160; This makes no sense to me, and is surely going to confuse Tesseract.&lt;/p&gt;

&lt;p&gt;Instead of doing this, we should remove &lt;tt&gt;ocrImageScale&lt;/tt&gt;, and use the same DPI value in both places.&lt;/p&gt;

&lt;p&gt;We should keep the existing default DPI value, since Tesseract is trained at 300dpi by default, so this will mean that all stages between PDFRenderer and Tesseract are defaulting to 300dpi.&lt;/p&gt;

&lt;p&gt;This change will have the side-effect that the temporary images between the PDF rendering and Tesseract will be 4x larger (144dpi to 300dpi).&#160; This will have a memory and temporary disk space impact, but I think that it&apos;s still best to have the whole pipeline using 300dpi.&#160; People who have memory constraints will need to reduce ocrDPI and make the corresponding changes on the Tesseract side.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13149553">TIKA-2624</key>
            <summary>Rendering PDFs for OCR with Tesseract uses different DPI than claimed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="ewanmellor-2">Ewan Mellor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Apr 2018 18:55:39 +0000</created>
                <updated>Wed, 23 Oct 2019 00:05:04 +0000</updated>
                            <resolved>Tue, 22 Oct 2019 21:52:02 +0000</resolved>
                                    <version>1.17</version>
                                    <fixVersion>1.23</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16423005" author="githubbot" created="Mon, 2 Apr 2018 19:15:45 +0000"  >&lt;p&gt;ewanmellor opened a new pull request #232: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; contributed by ewanmellor.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/232&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Change AbstractPDF2XHTML.doOCROnCurrentPage to use the same DPI value&lt;br/&gt;
   (PDFParserConfig.ocrDPI) for both the PDF rendering and the image metadata.&lt;/p&gt;

&lt;p&gt;   Previously, the PDF was being rendered using ocrImageScale (default 2.0 ==&lt;br/&gt;
   144dpi) and then putting ocrDPI (default 300) in the image metadata.  Having&lt;br/&gt;
   these two things be independent makes no sense, and is surely going to&lt;br/&gt;
   confuse Tesseract when the image metadata does not match the data.&lt;/p&gt;

&lt;p&gt;   This change means that ocrDPI drives both values, and ocrImageScale is&lt;br/&gt;
   removed.  This also switches from PDFRenderer.renderImage to&lt;br/&gt;
   PDFRenderer.renderImageWithDPI, but that&apos;s just a stub to make it clearer&lt;br/&gt;
   what&apos;s going on.&lt;/p&gt;

&lt;p&gt;   This change will have the side-effect that the temporary images between the&lt;br/&gt;
   PDF rendering and Tesseract will be 4x larger (144dpi to 300dpi).  This will&lt;br/&gt;
   have a memory and temporary disk space impact, but it will ensure that the&lt;br/&gt;
   whole pipeline uses 300dpi by default.  People who have memory constraints&lt;br/&gt;
   will need to reduce ocrDPI and make the corresponding changes on the&lt;br/&gt;
   Tesseract side.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16423026" author="tallison@mitre.org" created="Mon, 2 Apr 2018 19:33:53 +0000"  >&lt;p&gt;Thank you for opening this and submitting a PR.  I ran into this on an image degradation study...where I (mis?)remembered that the first time I used dpi I was actually getting different images...in short it felt like it worked.  However a year or so later w a different version of PDFBox, I found that dpi didn&apos;t work at all, and I had to rely on the scale instead, as you helpfully explain above.  I wonder if what I experienced was a diff btwn PDFBox 1.8.x and 2.0.x?  Or did dpi actually work on TIFF on my first run but doesn&apos;t work on JPEG?  Or, this could have just been faulty memory...&lt;/p&gt;</comment>
                            <comment id="16423040" author="ewanmellor-2" created="Mon, 2 Apr 2018 19:45:15 +0000"  >&lt;p&gt;There were definitely changes between 1.8 and 2.0, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1963&quot; title=&quot;PDFImageWriter doesn&amp;#39;t make use of PDFStreamEngine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1963&quot;&gt;&lt;del&gt;PDFBOX-1963&lt;/del&gt;&lt;/a&gt;.  I think it&apos;s always been 1 == 72dpi though; I see that in their doc-comments dating back to 2014.  Of course, it could easily have been buggy back then.&lt;/p&gt;

</comment>
                            <comment id="16423041" author="lfcnassif" created="Mon, 2 Apr 2018 19:45:34 +0000"  >&lt;p&gt;Wow, that is a major bug, not sure when it was introduced. Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewanmellor-2&quot; class=&quot;user-hover&quot; rel=&quot;ewanmellor-2&quot;&gt;ewanmellor-2&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16423051" author="tallison@mitre.org" created="Mon, 2 Apr 2018 19:58:51 +0000"  >&lt;p&gt;I&apos;m happy to remove &lt;tt&gt;setOcrImageScale&lt;/tt&gt; throughout in 2.0.0.  Are we ok deprecating it in 1.18 and making it a no-op?  Should we log warn no-op in 1.18 or leave deprecation and documentation as the only warning?&lt;/p&gt;</comment>
                            <comment id="16423108" author="ewanmellor-2" created="Mon, 2 Apr 2018 20:44:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt; I don&apos;t know what your release policy / schedule is.  If 2.0.0 is coming soon, I wouldn&apos;t bother with 1.18, just treat this as a breaking change for 2.0.  Tesseract 4 is such a big change, anyone doing new OCR work right now should be on the bleeding edge (IMHO) and you can just keep 1.x for stability.  It&apos;s really up to you though.&lt;/p&gt;

&lt;p&gt;If you&apos;re not planning to release 2.0 for a while, then a logged warning in 1.18 makes sense.&lt;/p&gt;</comment>
                            <comment id="16956463" author="githubbot" created="Mon, 21 Oct 2019 21:35:46 +0000"  >&lt;p&gt;epugh commented on issue #232: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; contributed by ewanmellor.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/232#issuecomment-544718260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/232#issuecomment-544718260&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Interesting patch, do you have any examples of this being an issue that you can share?   I never really thought about having them be the same.   &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16956572" author="githubbot" created="Tue, 22 Oct 2019 00:51:55 +0000"  >&lt;p&gt;ewanmellor commented on issue #232: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; contributed by ewanmellor.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/232#issuecomment-544766754&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/232#issuecomment-544766754&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I don&apos;t have examples that I can share, sorry.  This work was for a proprietary product, and I am no longer working on it.&lt;/p&gt;

&lt;p&gt;   I remember it making an absolutely enormous difference in OCR quality though (with Tesseract 4).&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16957204" author="epugh" created="Tue, 22 Oct 2019 16:23:39 +0000"  >&lt;p&gt;I am rereading this thread via JIRA versus the github PR, and it seems like since 2.0 isn&apos;t imminent that merging this would be good idea?&lt;/p&gt;</comment>
                            <comment id="16957255" author="tallison@mitre.org" created="Tue, 22 Oct 2019 18:09:37 +0000"  >&lt;p&gt;Fellow devs, any objections to rolling this out in 1.23?&lt;/p&gt;</comment>
                            <comment id="16957261" author="tilman" created="Tue, 22 Oct 2019 18:14:52 +0000"  >&lt;p&gt;None from me. Re &quot;This will have a memory and temporary disk space impact&quot;, be aware that rendering will be slower too, but 300dpi is a minimum for decent OCR.&lt;/p&gt;</comment>
                            <comment id="16957265" author="kkrugler" created="Tue, 22 Oct 2019 18:26:44 +0000"  >&lt;p&gt;Seems like a good change to me. Anyone using OCR will be dealing with resource constraints in any case (it&apos;s not the normal use case), so potentially requiring some adjustments to setup is fine, especially if we highlight that in the release note.&lt;/p&gt;</comment>
                            <comment id="16957364" author="githubbot" created="Tue, 22 Oct 2019 21:33:26 +0000"  >&lt;p&gt;tballison commented on pull request #232: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; contributed by ewanmellor.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/232&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16957370" author="tallison@mitre.org" created="Tue, 22 Oct 2019 21:52:02 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewanmellor-2&quot; class=&quot;user-hover&quot; rel=&quot;ewanmellor-2&quot;&gt;ewanmellor-2&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh&quot; class=&quot;user-hover&quot; rel=&quot;epugh&quot;&gt;epugh&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16957440" author="hudson" created="Wed, 23 Oct 2019 00:04:23 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1719 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1719/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1719/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; contributed by ewanmellor. (#232) (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/849fc385e626d904c50c3338d4668f6ab44bd72a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/849fc385e626d904c50c3338d4668f6ab44bd72a&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pdf/PDFParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/AbstractPDF2XHTML.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/resources/org/apache/tika/parser/pdf/PDFParser.properties&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDFParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDFParserConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16957442" author="hudson" created="Wed, 23 Oct 2019 00:05:04 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #256 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/256/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/256/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2624&quot; title=&quot;Rendering PDFs for OCR with Tesseract uses different DPI than claimed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2624&quot;&gt;&lt;del&gt;TIKA-2624&lt;/del&gt;&lt;/a&gt; &amp;#8211; Rendering PDFs for OCR with Tesseract uses different DPI (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/8346ea9ba10aa05399dce56e3ef19e92d4c5c6d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/8346ea9ba10aa05399dce56e3ef19e92d4c5c6d9&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pdf/PDFParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/resources/org/apache/tika/parser/pdf/PDFParser.properties&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDFParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDFParserConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/AbstractPDF2XHTML.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s253:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>