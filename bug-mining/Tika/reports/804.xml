<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:00:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-1837] HtmlEncodingDetector wrongly detects charset from commented meta</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1837</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The org.apache.tika.parser.html.HtmlEncodingDetector class will grab the first meta tag that has a charset in it matching the pattern defined in HTTP_META_PATTERN. The problem encountered is when there are multiple such meta tags but the first ones are commented.  &lt;/p&gt;

&lt;p&gt;In my mind the detector should not consider commented code for this detection. &lt;/p&gt;

&lt;p&gt;Real example encountered in an HTML page:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;   &lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!--&amp;lt;meta http-equiv=&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt; content=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/html; charset=ISO-8859-1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;meta http-equiv=&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt; content=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/html; charset=utf-8&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The detector currently detects &lt;tt&gt;ISO-8859-1&lt;/tt&gt; while it should detect &lt;tt&gt;utf-8&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Fix:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;As opposed to modify the meta-detection regex, I recommend to first strip comments, taking into consideration the substring from the input stream may not hold the closing characters &lt;tt&gt;--&amp;gt;&lt;/tt&gt;.  This has been tested to work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;HtmlEncodingDetector.java, line 104+&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; head = ASCII.decode(ByteBuffer.wrap(buffer, 0, n)).toString();

        &lt;span class=&quot;code-comment&quot;&gt;// START FIX:
&lt;/span&gt;        head = head.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;!--.*?(--&amp;gt;|$)&quot;&lt;/span&gt;, &quot;&quot;);
        &lt;span class=&quot;code-comment&quot;&gt;// END FIX
&lt;/span&gt;
        Matcher equiv = HTTP_META_PATTERN.matcher(head);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Any.&lt;/p&gt;</environment>
        <key id="12932631">TIKA-1837</key>
            <summary>HtmlEncodingDetector wrongly detects charset from commented meta</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pascal.essiembre">Pascal Essiembre</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>patch</label>
                    </labels>
                <created>Wed, 20 Jan 2016 06:49:31 +0000</created>
                <updated>Thu, 26 May 2016 18:35:02 +0000</updated>
                            <resolved>Thu, 26 May 2016 14:50:57 +0000</resolved>
                                    <version>1.11</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="15108609" author="tallison@mitre.org" created="Wed, 20 Jan 2016 14:18:13 +0000"  >&lt;p&gt;Thank you for raising this. I&apos;ll fix this next week unless someone else takes it first.&lt;/p&gt;

&lt;p&gt;Out of curiosity, how often are you seeing this? Can you describe your corpus? How are you detecting botched encodings?&lt;/p&gt;</comment>
                            <comment id="15108892" author="pascal.essiembre" created="Wed, 20 Jan 2016 16:48:54 +0000"  >&lt;p&gt;How often? It was the first and only time I have encountered this as an issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We publish an open-source crawler (Norconex HTTP Collector) and we rely on Tika for parsing the vast majority of documents.  This specific issue has been raised by one of the HTTP Collector users (see the external issue URL).  As such, we do not have a set corpus: it&apos;s everybody&apos;s data.&lt;/p&gt;</comment>
                            <comment id="15302177" author="tallison@mitre.org" created="Thu, 26 May 2016 14:50:57 +0000"  >&lt;p&gt;Sorry, this one fell off my plate.  Thank you for opening this!&lt;/p&gt;</comment>
                            <comment id="15302220" author="hudson" created="Thu, 26 May 2016 15:16:30 +0000"  >&lt;p&gt;FAILURE: Integrated in tika-2.x-windows #7 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/7/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/7/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1837&quot; title=&quot;HtmlEncodingDetector wrongly detects charset from commented meta&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1837&quot;&gt;&lt;del&gt;TIKA-1837&lt;/del&gt;&lt;/a&gt; &amp;#8211; strip comments before trying to find encoding in (tallison: rev 43e30006d16ef4957c7aff347c9b76f3e1e163c5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/html/HtmlEncodingDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15302299" author="hudson" created="Thu, 26 May 2016 15:56:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #1002 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/1002/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/1002/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1837&quot; title=&quot;HtmlEncodingDetector wrongly detects charset from commented meta&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1837&quot;&gt;&lt;del&gt;TIKA-1837&lt;/del&gt;&lt;/a&gt; &amp;#8211; strip comments before trying to find encoding in (tallison: rev 16290d86c3a976f7c323b0be6750ad07f4840018)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/html/HtmlEncodingDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15302654" author="hudson" created="Thu, 26 May 2016 18:35:02 +0000"  >&lt;p&gt;UNSTABLE: Integrated in tika-2.x #103 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/103/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/103/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1837&quot; title=&quot;HtmlEncodingDetector wrongly detects charset from commented meta&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1837&quot;&gt;&lt;del&gt;TIKA-1837&lt;/del&gt;&lt;/a&gt; &amp;#8211; strip comments before trying to find encoding in (tallison: rev 43e30006d16ef4957c7aff347c9b76f3e1e163c5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/html/HtmlEncodingDetector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/Norconex/collector-http/issues/223]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rq1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>