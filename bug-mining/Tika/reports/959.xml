<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:01:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2483] Using PackageParser in ForkParser causes NPE</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2483</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;blockquote&gt;
&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.tika.mime.MimeTypesFactory.create(MimeTypesFactory.java:158)&lt;br/&gt;
        at org.apache.tika.mime.MimeTypes.getDefaultMimeTypes(MimeTypes.java:577)&lt;br/&gt;
        at org.apache.tika.config.TikaConfig.getDefaultMimeTypes(TikaConfig.java:78)&lt;br/&gt;
        at org.apache.tika.config.TikaConfig.&amp;lt;init&amp;gt;(TikaConfig.java:242)&lt;br/&gt;
        at org.apache.tika.config.TikaConfig.getDefaultConfig(TikaConfig.java:379)&lt;br/&gt;
        at org.apache.tika.parser.pkg.PackageParser.parse(PackageParser.java:165)&lt;br/&gt;
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The mediaTypeRegistry handling code in parse() of PackageParser seems cause the problem due to ForkParser cannot properly construct default TikaConfig. Also since TikaConfig is not serializable, there is no way to assign mediaTypeRegistry/bufferedMediaTypeRegistry before calling parse()&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112464">TIKA-2483</key>
            <summary>Using PackageParser in ForkParser causes NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="chikei">TzeKai Lee</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Oct 2017 03:28:00 +0000</created>
                <updated>Mon, 11 Dec 2017 20:04:30 +0000</updated>
                            <resolved>Fri, 8 Dec 2017 16:39:02 +0000</resolved>
                                    <version>1.16</version>
                                    <fixVersion>1.17</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16221993" author="gagravarr" created="Fri, 27 Oct 2017 09:16:32 +0000"  >&lt;p&gt;Are you able to put together a small snippet of code (ideally a junit unit test case, but anything we can run will do) that shows how to reproduce the issue? Someone can then take a look and ponder the right fix&lt;/p&gt;</comment>
                            <comment id="16222023" author="chikei" created="Fri, 27 Oct 2017 09:48:11 +0000"  >&lt;p&gt;this should produce the NPE&lt;/p&gt;</comment>
                            <comment id="16251723" author="hudson" created="Tue, 14 Nov 2017 16:56:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1391 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1391/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1391/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2483&quot; title=&quot;Using PackageParser in ForkParser causes NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2483&quot;&gt;&lt;del&gt;TIKA-2483&lt;/del&gt;&lt;/a&gt; &amp;#8211; revert loading of mime repository in PackageParser from (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/06486c8548daf5f9ba588da4e88e3da82a429e70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/06486c8548daf5f9ba588da4e88e3da82a429e70&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/fork/ForkParserIntegrationTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16283780" author="tallison@mitre.org" created="Fri, 8 Dec 2017 16:14:45 +0000"  >&lt;p&gt;Regression tests in prep for 1.17 found a blocker caused by an incomplete fix to this issue. We need to add quite a few more specializations of zip and tar to check for and avoid overwriting of mime types to zip. Lots of files that were identified as kmz, tika-ooxml, etc in 1.16 are now being identified as &quot;zip&quot; during the parse in 1.17-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;Current patch includes list semi-manually, which I abhor, but I added a test to make sure that PackageParser&apos;s list of specialization stays current with TikaConfig&apos;s default config. &lt;/p&gt;

&lt;p&gt;After 1.17 is released, we can either work towards getting rid of serialization of parsers in ForkParser and/or making TikaConfig serializable.  Until we do that, I don&apos;t see an elegant solution.&lt;/p&gt;</comment>
                            <comment id="16283922" author="hudson" created="Fri, 8 Dec 2017 17:54:36 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1409 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1409/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1409/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2483&quot; title=&quot;Using PackageParser in ForkParser causes NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2483&quot;&gt;&lt;del&gt;TIKA-2483&lt;/del&gt;&lt;/a&gt; &amp;#8211; add in all children of zip and tar to prevent overwriting (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/90d624588483f379180c812b7235bb2222be9c2e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/90d624588483f379180c812b7235bb2222be9c2e&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/PackageParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/pkg/ZipParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16286477" author="gagravarr" created="Mon, 11 Dec 2017 20:04:30 +0000"  >&lt;p&gt;Since it&apos;s possible to get a Tika Config object turned into the XML version, a non-ideal option might be to implement serialize and deserialize of TikaConfig via xml&lt;/p&gt;

&lt;p&gt;Short term, since this is causing some regression issues, should we provide a helper method to &quot;get a MediaTypeRegistry if possible&quot; ? That could do the caching, could take the ParseContext to look up a TikaConfig or MediaTypeRegistry, and could catch + log + etc in the ForkParser case. That should restore the current behaviour for most cases, clean the code up, and give us an easy point to test/fix/etc later. It might also possibly help clean up a few other places in the parser code doing similar stuff&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13059375">TIKA-2311</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12894318" name="testForkedPackageParsing.patch" size="1158" author="chikei" created="Fri, 27 Oct 2017 09:47:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lrrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>