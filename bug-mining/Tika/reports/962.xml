<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:01:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2347] Underlined text is not decorated as such when extracting from word documents</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2347</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When extracting from doc and docx bold and italic text decoration is extracted, however underlining is not.  Can be demonstrated in WordParserTest or OOXMLParserTest (change to docx) with the following test case.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;WordParserTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testTextDecoration() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      XMLResult result = getXML(&lt;span class=&quot;code-quote&quot;&gt;&quot;testWORD_various.doc&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; xml = result.xml;

      assertTrue(xml.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;b&amp;gt;Bold&amp;lt;/b&amp;gt;&quot;&lt;/span&gt;));
      assertTrue(xml.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;i&amp;gt;italic&amp;lt;/i&amp;gt;&quot;&lt;/span&gt;));
      assertTrue(xml.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;u&amp;gt;underline&amp;lt;/u&amp;gt;&quot;&lt;/span&gt;));

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13067720">TIKA-2347</key>
            <summary>Underlined text is not decorated as such when extracting from word documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davemeikle">Dave Meikle</assignee>
                                    <reporter username="hendrens">Stuart Hendren</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Apr 2017 15:23:41 +0000</created>
                <updated>Mon, 12 Apr 2021 13:00:48 +0000</updated>
                            <resolved>Fri, 24 Nov 2017 01:12:31 +0000</resolved>
                                    <version>1.14</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.17</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15989011" author="githubbot" created="Fri, 28 Apr 2017 15:32:38 +0000"  >&lt;p&gt;stuarthendren opened a new pull request #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Extracts underline for both doc and docx and assigns tag &amp;lt;u&amp;gt;.&lt;br/&gt;
   Given lowest nesting among style tags.&lt;br/&gt;
   Adds tests using testWORD_various.doc and testWord_various.docx&lt;br/&gt;
   Updates affected output in other WordParserTests.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16169130" author="githubbot" created="Sat, 16 Sep 2017 23:17:01 +0000"  >&lt;p&gt;darkdreamingdan commented on issue #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173#issuecomment-330000650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173#issuecomment-330000650&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Could you also add strikethrough support?  It&apos;s just the same thnig but using the &amp;lt;strike&amp;gt; xhtml element.  We have our own branch for this code but it would be good to unify our PRs&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16169131" author="githubbot" created="Sat, 16 Sep 2017 23:17:11 +0000"  >&lt;p&gt;darkdreamingdan commented on issue #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173#issuecomment-330000650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173#issuecomment-330000650&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Could you also add strikethrough support?  It&apos;s just the same thnig but using the `&amp;lt;strike&amp;gt;` xhtml element.  We have our own branch for this code but it would be good to unify our PRs&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16169132" author="githubbot" created="Sat, 16 Sep 2017 23:19:20 +0000"  >&lt;p&gt;darkdreamingdan commented on issue #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173#issuecomment-330000650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173#issuecomment-330000650&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Could you also add strikethrough support?  It&apos;s just the same thnig but using the `&amp;lt;strike&amp;gt;` xhtml element.  We have our own branch for this code but it would be good to unify our PRs.&lt;/p&gt;

&lt;p&gt;   Also, any news on this getting merged?  &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16264858" author="davemeikle" created="Fri, 24 Nov 2017 01:12:31 +0000"  >&lt;p&gt;Committed in &lt;a href=&quot;https://github.com/apache/tika/commit/639f3bf361a08210da8fae68e3eeb4e12df6c4de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;639f3bf361a08210da8fae68e3eeb4e12df6c4de&lt;/a&gt;. Thanks Stuart!&lt;/p&gt;</comment>
                            <comment id="16264859" author="githubbot" created="Fri, 24 Nov 2017 01:15:21 +0000"  >&lt;p&gt;dameikle commented on issue #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173#issuecomment-346717055&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173#issuecomment-346717055&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged into master now with included strikethrough support for docx. Thanks @stuarthendren!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16264860" author="githubbot" created="Fri, 24 Nov 2017 01:15:21 +0000"  >&lt;p&gt;dameikle closed pull request #173: Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/173&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java&lt;br/&gt;
index 31809250d..90fbd6c37 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java&lt;br/&gt;
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java&lt;br/&gt;
@@ -84,6 +84,7 @@&lt;br/&gt;
     private boolean curStrikeThrough;&lt;br/&gt;
     private boolean curBold;&lt;br/&gt;
     private boolean curItalic;&lt;br/&gt;
+    private boolean curUnderline;&lt;/p&gt;

&lt;p&gt;     private final Metadata metadata;&lt;/p&gt;

&lt;p&gt;@@ -372,20 +373,8 @@ private int handleParagraph(Paragraph p, int parentTableLevel, Range r, HWPFDocu&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Close any still open style tags&lt;/li&gt;
	&lt;li&gt;if (curStrikeThrough) 
{
-            xhtml.endElement(&quot;s&quot;);
-            curStrikeThrough = false;
-        }&lt;/li&gt;
	&lt;li&gt;if (curItalic) 
{
-            xhtml.endElement(&quot;i&quot;);
-            curItalic = false;
-        }&lt;/li&gt;
	&lt;li&gt;if (curBold) 
{
-            xhtml.endElement(&quot;b&quot;);
-            curBold = false;
-        }
&lt;p&gt;-&lt;br/&gt;
+        closeStyleElements(false, xhtml);&lt;br/&gt;
+        &lt;br/&gt;
         xhtml.endElement(tas.getTag());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         return 0;&lt;br/&gt;
@@ -399,7 +388,11 @@ private void handleCharacterRun(CharacterRun cr, boolean skipStyling, XHTMLConte&lt;/p&gt;

&lt;p&gt;         if (!skipStyling) {&lt;br/&gt;
             if (cr.isBold() != curBold) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Enforce nesting &amp;#8211; must close s and i tags&lt;br/&gt;
+                // Enforce nesting &amp;#8211; must close u, s and i tags&lt;br/&gt;
+                if (curUnderline) 
{
+                    xhtml.endElement(&quot;u&quot;);
+                    curUnderline = false;
+                }&lt;br/&gt;
                 if (curStrikeThrough) {
                     xhtml.endElement(&quot;s&quot;);
                     curStrikeThrough = false;
@@ -417,7 +410,11 @@ private void handleCharacterRun(CharacterRun cr, boolean skipStyling, XHTMLConte
             }&lt;br/&gt;
 &lt;br/&gt;
             if (cr.isItalic() != curItalic) {&lt;br/&gt;
-                // Enforce nesting &amp;#8211; must close s tag&lt;br/&gt;
+                // Enforce nesting &amp;#8211; must close u and s tag&lt;br/&gt;
+            	if (curUnderline) {
+            		xhtml.endElement(&quot;u&quot;);
+            		curUnderline = false;
+            	}&lt;br/&gt;
                 if (curStrikeThrough) {
                     xhtml.endElement(&quot;s&quot;);
                     curStrikeThrough = false;
@@ -431,6 +428,11 @@ private void handleCharacterRun(CharacterRun cr, boolean skipStyling, XHTMLConte
             }&lt;br/&gt;
 &lt;br/&gt;
             if (cr.isStrikeThrough() != curStrikeThrough) {&lt;br/&gt;
+                // Enforce nesting &amp;#8211; must close u tag&lt;br/&gt;
+                if (curUnderline) {+                    xhtml.endElement(&quot;u&quot;);+                    curUnderline = false;+                }
&lt;p&gt;                 if (cr.isStrikeThrough()) &lt;/p&gt;
{
                     xhtml.startElement(&quot;s&quot;);
                 }
&lt;p&gt; else &lt;/p&gt;
{
@@ -438,6 +440,16 @@ private void handleCharacterRun(CharacterRun cr, boolean skipStyling, XHTMLConte
                 }
&lt;p&gt;                 curStrikeThrough = cr.isStrikeThrough();&lt;br/&gt;
             }&lt;br/&gt;
+            &lt;br/&gt;
+            boolean isUnderline = cr.getUnderlineCode() != 0;&lt;br/&gt;
+            if (isUnderline != curUnderline) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                if (isUnderline) {
+                    xhtml.startElement(&quot;u&quot;);
+                } else {
+                    xhtml.endElement(&quot;u&quot;);
+                }+                curUnderline = isUnderline;+            }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;         }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // Clean up the text&lt;br/&gt;
@@ -546,6 +558,10 @@ private void closeStyleElements(boolean skipStyling, XHTMLContentHandler xhtml)&lt;br/&gt;
         if (skipStyling) &lt;/p&gt;
{
             return;
         }
&lt;p&gt;+        if (curUnderline) &lt;/p&gt;
{
+        	xhtml.endElement(&quot;u&quot;);
+        	curUnderline = false;
+        }
&lt;p&gt;         if (curStrikeThrough) &lt;/p&gt;
{
             xhtml.endElement(&quot;s&quot;);
             curStrikeThrough = false;
diff --git a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java
index 39a72c6a2..23a1aedac 100644
--- a/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java
+++ b/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java
@@ -33,6 +33,7 @@
 import org.apache.poi.xwpf.usermodel.ICell;
 import org.apache.poi.xwpf.usermodel.IRunElement;
 import org.apache.poi.xwpf.usermodel.ISDTContent;
+import org.apache.poi.xwpf.usermodel.UnderlinePatterns;
 import org.apache.poi.xwpf.usermodel.XWPFDocument;
 import org.apache.poi.xwpf.usermodel.XWPFHeaderFooter;
 import org.apache.poi.xwpf.usermodel.XWPFHyperlink;
@@ -224,7 +225,7 @@ private void extractParagraph(XWPFParagraph paragraph, XWPFListManager listManag
             xhtml.endElement(&quot;a&quot;);
         }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TmpFormatting fmtg = new TmpFormatting(false, false);&lt;br/&gt;
+        TmpFormatting fmtg = new TmpFormatting(false, false, false);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         //hyperlinks may or may not have hyperlink ids&lt;br/&gt;
         String lastHyperlinkId = null;&lt;br/&gt;
@@ -328,6 +329,10 @@ private TmpFormatting closeStyleTags(XHTMLContentHandler xhtml,&lt;br/&gt;
             xhtml.endElement(&quot;b&quot;);&lt;br/&gt;
             fmtg.setBold(false);&lt;br/&gt;
         }&lt;br/&gt;
+        if (fmtg.isUnderline()) &lt;/p&gt;
{
+        	xhtml.endElement(&quot;u&quot;);
+        	fmtg.setUnderline(false);
+        }
&lt;p&gt;         return fmtg;&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;@@ -336,6 +341,10 @@ private TmpFormatting processRun(XWPFRun run, XWPFParagraph paragraph,&lt;br/&gt;
             throws SAXException, XmlException, IOException {&lt;br/&gt;
         // True if we are currently in the named style tag:&lt;br/&gt;
         if (run.isBold() != tfmtg.isBold()) {&lt;br/&gt;
+            if (tfmtg.isUnderline()) &lt;/p&gt;
{
+                xhtml.endElement(&quot;u&quot;);
+                tfmtg.setUnderline(false);
+            }&lt;br/&gt;
             if (tfmtg.isItalic()) {
                 xhtml.endElement(&quot;i&quot;);
                 tfmtg.setItalic(false);
@@ -349,6 +358,10 @@ private TmpFormatting processRun(XWPFRun run, XWPFParagraph paragraph,
         }&lt;br/&gt;
 &lt;br/&gt;
         if (run.isItalic() != tfmtg.isItalic()) {&lt;br/&gt;
+            if (tfmtg.isUnderline()) {+                xhtml.endElement(&quot;u&quot;);+                tfmtg.setUnderline(false);+            }
&lt;p&gt;             if (run.isItalic()) &lt;/p&gt;
{
                 xhtml.startElement(&quot;i&quot;);
             }
&lt;p&gt; else &lt;/p&gt;
{
@@ -356,6 +369,16 @@ private TmpFormatting processRun(XWPFRun run, XWPFParagraph paragraph,
             }
&lt;p&gt;             tfmtg.setItalic(run.isItalic());&lt;br/&gt;
         }&lt;br/&gt;
+        &lt;br/&gt;
+        boolean isUnderline = run.getUnderline() != UnderlinePatterns.NONE;&lt;br/&gt;
+        if (isUnderline != tfmtg.isUnderline()) {&lt;br/&gt;
+            if (isUnderline) &lt;/p&gt;
{
+                xhtml.startElement(&quot;u&quot;);
+            }
&lt;p&gt; else &lt;/p&gt;
{
+                xhtml.endElement(&quot;u&quot;);
+            }
&lt;p&gt;+            tfmtg.setUnderline(isUnderline);&lt;br/&gt;
+        }&lt;/p&gt;

&lt;p&gt;         xhtml.characters(run.toString());&lt;/p&gt;

&lt;p&gt;@@ -484,10 +507,12 @@ private void addRelatedParts(PackagePart documentPart, List&amp;lt;PackagePart&amp;gt; related&lt;br/&gt;
     private class TmpFormatting {&lt;br/&gt;
         private boolean bold = false;&lt;br/&gt;
         private boolean italic = false;&lt;br/&gt;
+        private boolean underline = false;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private TmpFormatting(boolean bold, boolean italic) {&lt;br/&gt;
+        private TmpFormatting(boolean bold, boolean italic, boolean underline) 
{
             this.bold = bold;
             this.italic = italic;
+            this.underline = underline;
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         public boolean isBold() {&lt;br/&gt;
@@ -505,6 +530,15 @@ public boolean isItalic() {&lt;br/&gt;
         public void setItalic(boolean italic) &lt;/p&gt;
{
             this.italic = italic;
         }
&lt;p&gt;+        &lt;br/&gt;
+&lt;br/&gt;
+        public boolean isUnderline() &lt;/p&gt;
{
+            return underline;
+        }
&lt;p&gt;+&lt;br/&gt;
+        public void setUnderline(boolean underline) &lt;/p&gt;
{
+            this.underline = underline;
+        }

&lt;p&gt;     }&lt;/p&gt;

&lt;p&gt;diff --git a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;br/&gt;
index df6d807fc..7938c3b1c 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;br/&gt;
+++ b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;br/&gt;
@@ -29,6 +29,7 @@&lt;br/&gt;
 import org.apache.log4j.Level;&lt;br/&gt;
 import org.apache.log4j.Logger;&lt;br/&gt;
 import org.apache.tika.TikaTest;&lt;br/&gt;
+&lt;br/&gt;
 import org.apache.tika.config.TikaConfig;&lt;br/&gt;
 import org.apache.tika.metadata.Metadata;&lt;br/&gt;
 import org.apache.tika.metadata.Office;&lt;br/&gt;
@@ -109,7 +110,7 @@ public void testWordHTML() throws Exception {&lt;br/&gt;
         assertTrue(xml.contains(&quot;&amp;lt;td&amp;gt;&quot;));&lt;br/&gt;
         // TODO - Check for the nested table&lt;br/&gt;
         // Links&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assertTrue(xml.contains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;Tika&amp;lt;/a&amp;gt;&quot;));&lt;br/&gt;
+        assertTrue(xml.contains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;&amp;lt;u&amp;gt;Tika&amp;lt;/u&amp;gt;&amp;lt;/a&amp;gt;&quot;));&lt;br/&gt;
         // Paragraphs with other styles&lt;br/&gt;
         assertTrue(xml.contains(&quot;&amp;lt;p class=\&quot;signature\&quot;&amp;gt;This one&quot;));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -195,6 +196,17 @@ public void testWord6Parser() throws Exception &lt;/p&gt;
{
             assertContains(&quot;The quick brown fox jumps over the lazy dog&quot;, handler.toString());
         }
&lt;p&gt;     }&lt;br/&gt;
+    &lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testTextDecoration() throws Exception &lt;/p&gt;
{
+      XMLResult result = getXML(&quot;testWORD_various.doc&quot;);
+      String xml = result.xml;
+
+      assertTrue(xml.contains(&quot;&amp;lt;b&amp;gt;Bold&amp;lt;/b&amp;gt;&quot;));
+      assertTrue(xml.contains(&quot;&amp;lt;i&amp;gt;italic&amp;lt;/i&amp;gt;&quot;));
+      assertTrue(xml.contains(&quot;&amp;lt;u&amp;gt;underline&amp;lt;/u&amp;gt;&quot;));
+
+    }

&lt;p&gt;     @Test&lt;br/&gt;
     public void testVarious() throws Exception {&lt;br/&gt;
@@ -361,15 +373,15 @@ public void testHeaderHyperlinks() throws Exception &lt;/p&gt;
{
         assertFalse(xml.contains(&quot;HYPERLINK&quot;));
 
         // Check we do have the link
-        assertContains(&quot;&amp;lt;a href=\&quot;http://tw-systemhaus.de\&quot;&amp;gt;http:&quot;, xml);
+        assertContains(&quot;&amp;lt;a href=\&quot;http://tw-systemhaus.de\&quot;&amp;gt;&amp;lt;u&amp;gt;http:&quot;, xml);
 
         // Check we do have the email
-        assertContains(&quot;&amp;lt;a href=\&quot;mailto:ab@example.com\&quot;&amp;gt;ab@&quot;, xml);
+        assertContains(&quot;&amp;lt;a href=\&quot;mailto:ab@example.com\&quot;&amp;gt;&amp;lt;u&amp;gt;ab@&quot;, xml);
     }

&lt;p&gt;     @Test&lt;br/&gt;
     public void testControlCharacter() throws Exception &lt;/p&gt;
{
-        assertContains(&quot;1. Introduzione&amp;lt;b&amp;gt; &amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt; &amp;lt;/p&amp;gt;&quot;, getXML(&quot;testControlCharacters.doc&quot;).xml.replaceAll(&quot;\\s+&quot;, &quot; &quot;));
+        assertContains(&quot;&amp;lt;u&amp;gt;1.&amp;lt;/u&amp;gt; &amp;lt;u&amp;gt;Introduzione&amp;lt;/u&amp;gt;&amp;lt;b&amp;gt; &amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;u&amp;gt; &amp;lt;/u&amp;gt;&amp;lt;/p&amp;gt;&quot;, getXML(&quot;testControlCharacters.doc&quot;).xml.replaceAll(&quot;\\s+&quot;, &quot; &quot;));
     }

&lt;p&gt;     @Test&lt;br/&gt;
@@ -383,7 +395,7 @@ public void testParagraphsAfterTables() throws Exception &lt;/p&gt;
{
                 &quot;application/msword&quot;,
                 metadata.get(Metadata.CONTENT_TYPE));
 
-        assertContains(&quot;&amp;lt;p&amp;gt;1. Organisering av vakten:&amp;lt;/p&amp;gt;&quot;, xml);
+        assertContains(&quot;&amp;lt;p&amp;gt;&amp;lt;u&amp;gt;1. Organisering av vakten:&amp;lt;/u&amp;gt;&amp;lt;/p&amp;gt;&quot;, xml);
 
     }

&lt;p&gt;@@ -521,8 +533,8 @@ public void testBoldHyperlink() throws Exception &lt;/p&gt;
{
         //TIKA-1255
         String xml = getXML(&quot;testWORD_boldHyperlink.doc&quot;).xml;
         xml = xml.replaceAll(&quot;\\s+&quot;, &quot; &quot;);
-        assertContains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;hyper &amp;lt;b&amp;gt;link&amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt;&quot;, xml);
-        assertContains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;&amp;lt;b&amp;gt;hyper&amp;lt;/b&amp;gt; link&amp;lt;/a&amp;gt;; bold&quot; , xml);
+        assertContains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;&amp;lt;u&amp;gt;hyper &amp;lt;/u&amp;gt;&amp;lt;b&amp;gt;&amp;lt;u&amp;gt;link&amp;lt;/u&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt;&quot;, xml);
+        assertContains(&quot;&amp;lt;a href=\&quot;http://tika.apache.org/\&quot;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;u&amp;gt;hyper&amp;lt;/u&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;u&amp;gt; link&amp;lt;/u&amp;gt;&amp;lt;/a&amp;gt;; bold&quot; , xml);
     }

&lt;p&gt;     @Test&lt;br/&gt;
diff --git a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;br/&gt;
index 642054536..06c5a1e0b 100644&lt;br/&gt;
&amp;#8212; a/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;br/&gt;
+++ b/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;br/&gt;
@@ -579,6 +579,17 @@ public void testNullHeaders() throws Exception &lt;/p&gt;
{
             assertEquals(&quot;Should have found some text&quot;, false, handler.toString().isEmpty());
         }
&lt;p&gt;     }&lt;br/&gt;
+    &lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testTextDecoration() throws Exception &lt;/p&gt;
{
+      XMLResult result = getXML(&quot;testWORD_various.docx&quot;);
+      String xml = result.xml;
+
+      assertTrue(xml.contains(&quot;&amp;lt;b&amp;gt;Bold&amp;lt;/b&amp;gt;&quot;));
+      assertTrue(xml.contains(&quot;&amp;lt;i&amp;gt;italic&amp;lt;/i&amp;gt;&quot;));
+      assertTrue(xml.contains(&quot;&amp;lt;u&amp;gt;underline&amp;lt;/u&amp;gt;&quot;));
+
+    }

&lt;p&gt;     @Test&lt;br/&gt;
     public void testVarious() throws Exception {&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16264877" author="hudson" created="Fri, 24 Nov 2017 02:05:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1396 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1396/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1396/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; Adds underline extraction from word documents (david: &lt;a href=&quot;https://github.com/apache/tika/commit/d64a32c63f376b9e003a4512adfec05414d4dfe6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/d64a32c63f376b9e003a4512adfec05414d4dfe6&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; - Added extraction of &amp;lt;strike&amp;gt; element in DOCX files (david: &lt;a href=&quot;https://github.com/apache/tika/commit/93cbed6df993ef01e59c55b86449b664e9052cae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/93cbed6df993ef01e59c55b86449b664e9052cae&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/XWPFWordExtractorDecorator.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/resources/test-documents/testWORD_various.docx&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/test/resources/test-documents/testWORD_various.doc&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; - Add underline extraction from Word documents (doc/docx) from (david: &lt;a href=&quot;https://github.com/apache/tika/commit/639f3bf361a08210da8fae68e3eeb4e12df6c4de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/639f3bf361a08210da8fae68e3eeb4e12df6c4de&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2347&quot; title=&quot;Underlined text is not decorated as such when extracting from word documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2347&quot;&gt;&lt;del&gt;TIKA-2347&lt;/del&gt;&lt;/a&gt; - Add underline extraction from Word documents (doc/docx) from (david: &lt;a href=&quot;https://github.com/apache/tika/commit/beedc4277526c6327524acb3a799b2ca6c898a05&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/beedc4277526c6327524acb3a799b2ca6c898a05&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13133752">TIKA-2555</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13143288">TIKA-2601</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3e8uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>