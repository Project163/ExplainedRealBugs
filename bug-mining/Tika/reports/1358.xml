<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:04:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-4137] Building current Tika main branch fails under Java 20/21</title>
                <link>https://issues.apache.org/jira/browse/TIKA-4137</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When I execute &quot;mvn verify&quot; on the current main branch using  Java 11 or Java 17, the build completes. With Java 20 and 21 the same command fails because now a couple of JUnit tests in tika-server-core fail:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(...)
[INFO] Running org.apache.tika.server.core.StackTraceTest
[ERROR] Tests run: 4, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.034 s &amp;lt;&amp;lt;&amp;lt; FAILURE! -- in org.apache.tika.server.core.StackTraceTest
[ERROR] org.apache.tika.server.core.StackTraceTest.testEmptyParser -- Time elapsed: 0.007 s &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.opentest4j.AssertionFailedError: bad type: /tika ==&amp;gt; expected: &amp;lt;200&amp;gt; but was: &amp;lt;500&amp;gt;
	at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)
	at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:132)
	at org.junit.jupiter.api.AssertEquals.failNotEqual(AssertEquals.java:197)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:559)
	at org.apache.tika.server.core.StackTraceTest.testEmptyParser(StackTraceTest.java:132)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)

WARN  [main] 21:28:26,651 org.apache.tika.pipes.PipesServer received -1 from client; shutting down
ERROR [main] 21:28:26,652 org.apache.tika.pipes.PipesServer exiting: 1
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   StackTraceOffTest.testEmptyParser:137 bad type: /tika ==&amp;gt; expected: &amp;lt;200&amp;gt; but was: &amp;lt;500&amp;gt;
[ERROR]   StackTraceTest.testEmptyParser:132 bad type: /tika ==&amp;gt; expected: &amp;lt;200&amp;gt; but was: &amp;lt;500&amp;gt;
[ERROR]   TikaResourceFetcherTest.testHeader:101-&amp;gt;CXFTestBase.assertContains:66 hello world not found in:
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;
    
    &amp;lt;head&amp;gt;
        
        &amp;lt;meta name=&quot;my-key&quot; content=&quot;parsers-value&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.DefaultParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.mock.MockParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;author&quot; content=&quot;Nikolai Lobachevsky&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:sourcePath&quot; content=&quot;mock/hello_world.xml&quot;/&amp;gt;
        ==&amp;gt; expected: &amp;lt;true&amp;gt; but was: &amp;lt;false&amp;gt;
[ERROR]   TikaResourceFetcherTest.testQueryPart:109-&amp;gt;CXFTestBase.assertContains:66 hello world not found in:
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;
    
    &amp;lt;head&amp;gt;
        
        &amp;lt;meta name=&quot;my-key&quot; content=&quot;parsers-value&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.DefaultParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.mock.MockParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;author&quot; content=&quot;Nikolai Lobachevsky&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:sourcePath&quot; content=&quot;mock/hello_world.xml&quot;/&amp;gt;
        ==&amp;gt; expected: &amp;lt;true&amp;gt; but was: &amp;lt;false&amp;gt;
[ERROR]   TikaResourceTest.testHeaders:91-&amp;gt;CXFTestBase.assertContains:66 &amp;lt;meta name=&quot;mymeta&quot; content=&quot;first,second,third&quot;/&amp;gt; not found in:
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;
    
    &amp;lt;head&amp;gt;
        
        &amp;lt;meta name=&quot;my-key&quot; content=&quot;parsers-value&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.DefaultParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.mock.MockParser&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;author&quot; content=&quot;Nikolai Lobachevsky&quot;/&amp;gt;
        
        &amp;lt;meta name=&quot;X-TIKA:digest:SHA1&quot; content=&quot;R5FG5V2U44YXOZTMKGVNTTSPGLF2JH ==&amp;gt; expected: &amp;lt;true&amp;gt; but was: &amp;lt;false&amp;gt;
[ERROR]   TikaResourceTest.testNoWriteLimitOnStreamingWrite:187-&amp;gt;CXFTestBase.assertContains:66 separation.&amp;lt;/p&amp;gt; not found in:
&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;

    &amp;lt;head&amp;gt;

        &amp;lt;meta name=&quot;my-key&quot; content=&quot;parsers-value&quot;/&amp;gt;

        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.DefaultParser&quot;/&amp;gt;

        &amp;lt;meta name=&quot;X-TIKA:Parsed-By&quot; content=&quot;org.apache.tika.parser.mock.MockParser&quot;/&amp;gt;

        &amp;lt;meta name=&quot;author&quot; content=&quot;Nikolai Lobachevsky&quot;/&amp;gt;

        &amp;lt;meta name=&quot;X-TIKA:digest:SHA1&quot; content=&quot;AQWEMUMSJVFZWYGM4TKXRTQ5Q436X4DN&quot;/&amp;gt;

        &amp;lt;meta name=&quot;Content-Length&quot; content=&quot;1562&quot;/&amp;gt;

        &amp;lt;meta name=&quot;X ==&amp;gt; expected: &amp;lt;true&amp;gt; but was: &amp;lt;false&amp;gt;
[INFO] 
[ERROR] Tests run: 75, Failures: 6, Errors: 0, Skipped: 7
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13551459">TIKA-4137</key>
            <summary>Building current Tika main branch fails under Java 20/21</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="t_heit">Thorsten Heit</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Sep 2023 19:54:55 +0000</created>
                <updated>Wed, 15 May 2024 16:10:19 +0000</updated>
                            <resolved>Fri, 22 Sep 2023 16:42:15 +0000</resolved>
                                    <version>3.0.0-BETA</version>
                                    <fixVersion>3.0.0-BETA</fixVersion>
                    <fixVersion>2.9.3</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17767283" author="t_heit" created="Wed, 20 Sep 2023 20:35:36 +0000"  >&lt;p&gt;I debugged the failing method &lt;tt&gt;StackTraceTest#testEmptyParser()&lt;/tt&gt; in Eclipse, turned on logging in CXF and slightly changed the log4j configuration XML so that more debug data was logged. By using this I was able to narrow down the part in the code where an error is thrown:&lt;/p&gt;

&lt;p&gt;When &lt;tt&gt;tika-core/org.apache.tika.parser.XHTMLContentHandler#lazyEndHead(...)&lt;/tt&gt; is called, the following snipped is executed (lines 183ff):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// TIKA-725: Prefer &amp;lt;title&amp;gt;&amp;lt;/title&amp;gt; over &amp;lt;title/&amp;gt;
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.characters(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[0], 0, 0);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.endElement(XHTML, &lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(&lt;tt&gt;super.endElement()&lt;/tt&gt;) produces a SAXException that is being catched in &lt;tt&gt;tika-core/org.apache.tika.parser.CompositeParser#parse(...)&lt;/tt&gt;, line 306. According to the debugger the exception contains the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.tika.sax.TaggedSAXException: Ung&#252;ltiges XML-Zeichen (Unicode: 0x0) wurde in den Zeichendaten des Knotens gefunden.
org.apache.tika.sax.TaggedSAXException: Ung&#252;ltiges XML-Zeichen (Unicode: 0x0) wurde in den Zeichendaten des Knotens gefunden.
org.xml.sax.SAXException: Ung&#252;ltiges XML-Zeichen (Unicode: 0x0) wurde in den Zeichendaten des Knotens gefunden.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have checked the release notes of Java 18-20, but haven&apos;t seen hints about corresponding changes in the XML / XSLT stuff in the JDK that could cause this behaviour change.&lt;/p&gt;

&lt;p&gt;As far as I understood the problem is the &lt;tt&gt;new char&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/tt&gt; in the above code:&lt;br/&gt;
A null character seems to be processed, finally lands in the depths of the &lt;tt&gt;java.xml&lt;/tt&gt; module in the class &lt;tt&gt;com.sun.org.apache.xml.internal.serializer.ToStream#accumDefaultEscape()&lt;/tt&gt; and lets the following snipped generate the execption:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isVer11 &amp;amp;&amp;amp; XMLChar.isInvalid(ch)) {
                    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.xml.sax.SAXException(Utils.messages.createMessage(
                            MsgKey.ER_WF_INVALID_CHARACTER_IN_TEXT,
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]{&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toHexString(ch)}));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17767284" author="t_heit" created="Wed, 20 Sep 2023 20:38:56 +0000"  >&lt;p&gt;Considering the comment in the code snippet above I replaced the line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.characters(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[0], 0, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with this one:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.characters(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;.toCharArray(), 0, 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the JUnit tests in &lt;tt&gt;tika-server-core&lt;/tt&gt; pass. Unfortunately a few others now fail:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;TikaCLITest&lt;/tt&gt; from &lt;tt&gt;tika-app&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;BodyContentHandlerTest&lt;/tt&gt; and &lt;tt&gt;RichTextContentHandlerTest&lt;/tt&gt; from &lt;tt&gt;tika-core&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;RecursiveParserWrapperTest&lt;/tt&gt; from &lt;tt&gt;tika-parsers-standard-package&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Still investigating...&lt;/p&gt;</comment>
                            <comment id="17767586" author="tallison@mitre.org" created="Thu, 21 Sep 2023 14:20:58 +0000"  >&lt;p&gt;Working on a PR now.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if we should skip the &amp;lt;title&amp;gt; element altogether if there is no title?  Or should we add a space as you&apos;re doing?&lt;/p&gt;</comment>
                            <comment id="17767587" author="tallison@mitre.org" created="Thu, 21 Sep 2023 14:22:09 +0000"  >&lt;p&gt;That was some debugging... thank you!&lt;/p&gt;</comment>
                            <comment id="17767589" author="githubbot" created="Thu, 21 Sep 2023 14:30:22 +0000"  >&lt;p&gt;tballison opened a new pull request, #1350:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1350&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1350&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
     Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
     or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
     distributed with this work for additional information&lt;br/&gt;
     regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
     to you under the Apache License, Version 2.0 (the&lt;br/&gt;
     &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
     with the License.  You may obtain a copy of the License at&lt;/p&gt;

&lt;p&gt;       &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     Unless required by applicable law or agreed to in writing,&lt;br/&gt;
     software distributed under the License is distributed on an&lt;br/&gt;
     &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
     KIND, either express or implied.  See the License for the&lt;br/&gt;
     specific language governing permissions and limitations&lt;br/&gt;
     under the License.&lt;br/&gt;
   --&amp;gt;&lt;br/&gt;
   This PR omits the &amp;lt;title/&amp;gt; element if there is no title.  We may want to insert a space instead? &amp;lt;title&amp;gt; &amp;lt;/title&amp;gt;&lt;/p&gt;


&lt;p&gt;   Thanks for your contribution to &lt;span class=&quot;error&quot;&gt;&amp;#91;Apache Tika&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://tika.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://tika.apache.org/&lt;/a&gt;)! Your help is appreciated!&lt;/p&gt;

&lt;p&gt;   Before opening the pull request, please verify that&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;there is an open issue on the &lt;span class=&quot;error&quot;&gt;&amp;#91;Tika issue tracker&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/TIKA&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/TIKA&lt;/a&gt;) which describes the problem or the improvement. We cannot accept pull requests without an issue because the change wouldn&apos;t be listed in the release notes.&lt;/li&gt;
	&lt;li&gt;the issue ID (`TIKA-XXXX`)&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;is referenced in the title of the pull request&lt;/li&gt;
	&lt;li&gt;and placed in front of your commit messages surrounded by square brackets (`&lt;span class=&quot;error&quot;&gt;&amp;#91;TIKA-XXXX&amp;#93;&lt;/span&gt; Issue or pull request title`)&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;commits are squashed into a single one (or few commits for larger changes)&lt;/li&gt;
	&lt;li&gt;Tika is successfully built and unit tests pass by running `mvn clean test`&lt;/li&gt;
	&lt;li&gt;there should be no conflicts when merging the pull request branch into the &lt;b&gt;recent&lt;/b&gt; `main` branch. If there are conflicts, please try to rebase the pull request branch on top of a freshly pulled `main` branch&lt;/li&gt;
	&lt;li&gt;if you add new module that downstream users will depend upon add it to relevant group in `tika-bom/pom.xml`.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   We will be able to faster integrate your pull request if these conditions are met. If you have any questions how to fix your problem or about using Tika in general, please sign up for the &lt;span class=&quot;error&quot;&gt;&amp;#91;Tika mailing list&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://tika.apache.org/mail-lists.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tika.apache.org/mail-lists.html&lt;/a&gt;). Thanks!&lt;/p&gt;


</comment>
                            <comment id="17767590" author="tallison@mitre.org" created="Thu, 21 Sep 2023 14:31:24 +0000"  >&lt;p&gt;I&apos;m wondering if this means that we have to defensively check every call to characters to make sure that the length &amp;gt; 0?  I can imagine on some files that some parsers may call characters on a 0 length array.&lt;/p&gt;</comment>
                            <comment id="17767611" author="githubbot" created="Thu, 21 Sep 2023 15:29:51 +0000"  >&lt;p&gt;tballison commented on PR #1350:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1350#issuecomment-1729817690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1350#issuecomment-1729817690&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Keeping this as draft to allow for input on whether we want to:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;simply not output the title element if a document has no title (current PR)&lt;/li&gt;
	&lt;li&gt;add a space to an empty title element&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="17767670" author="t_heit" created="Thu, 21 Sep 2023 18:10:43 +0000"  >&lt;p&gt;&amp;gt; Working on a PR now.&lt;/p&gt;

&lt;p&gt;Then you&apos;re faster than I &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; I&apos;m wondering if we should skip the &amp;lt;title&amp;gt; element altogether if there is no title? Or should we add a space as you&apos;re doing?&lt;/p&gt;

&lt;p&gt;The space character I added was only for finding out the position where the real error occured. When adding it, as mentioned above, a few other tests fail because they still assume an empty title element. I don&apos;t know if it makes sense to omit the &amp;lt;title&amp;gt; element if there&apos;s no titie available; I don&apos;t have much insights into Tika sources...&lt;/p&gt;

&lt;p&gt;I just have started to look into Tika source code because in our company we&apos;re using Tika in one of our applications that runs under Java 11+ and that uses the modern jakarta namespace variants. Unfortunately via Tika a few (transitive) dependencies come into play that still use the old javax ones...&lt;/p&gt;</comment>
                            <comment id="17767675" author="t_heit" created="Thu, 21 Sep 2023 18:20:08 +0000"  >&lt;p&gt;&amp;gt; That was some debugging... thank you!&lt;/p&gt;

&lt;p&gt;Thanks, this took me a few hours to find out...&lt;/p&gt;

&lt;p&gt;&amp;gt; I&apos;m wondering if this means that we have to defensively check every call to characters to make sure that the length &amp;gt; 0? I can imagine on some files that some parsers may call characters on a 0 length array.&lt;/p&gt;

&lt;p&gt;I guess the best option would be to find the real cause why the JUnit tests behave slightly different when running under Java 11, 17 or 20/21. I&apos;m still not sure why this is the case. Perhaps the XML stuff was updated to a newer version, perhaps the behaviour can be configured via properties (don&apos;t now, just a guess), who knows...&lt;/p&gt;</comment>
                            <comment id="17767684" author="tallison@mitre.org" created="Thu, 21 Sep 2023 18:47:31 +0000"  >&lt;p&gt;The unit tests that I had to modify for the current strategy (don&apos;t output a &amp;lt;title/&amp;gt; element at all if there&apos;s no title) all had to do with expecting a &quot;&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;&quot; content or had something to do with the length of the string which had changed because there was no title elment.&lt;/p&gt;

&lt;p&gt;Let me see if the same thing happens if we go with the &quot;add a space&quot; policy...&lt;/p&gt;</comment>
                            <comment id="17767719" author="t_heit" created="Thu, 21 Sep 2023 20:36:22 +0000"  >&lt;p&gt;It seems that the following minimal patch solves the problem:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java b/tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java
index aadf86f30..2913e740b 100644
--- a/tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java
+++ b/tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java
@@ -676,6 +676,7 @@ public class TikaResource {
                 handler.getTransformer().setOutputProperty(OutputKeys.METHOD, format);
                 handler.getTransformer().setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);
                 handler.getTransformer().setOutputProperty(OutputKeys.ENCODING, UTF_8.name());
+                handler.getTransformer().setOutputProperty(OutputKeys.VERSION, &quot;1.1&quot;);
                 handler.setResult(new StreamResult(writer));
                 content = new ExpandedTitleContentHandler(handler);
             } catch (TransformerConfigurationException e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;No further changes in the code are necessary; a full &quot;mvn clean verify&quot; worked out-of-the-box, both under Java 11 and Java 21.&lt;/p&gt;</comment>
                            <comment id="17767729" author="t_heit" created="Thu, 21 Sep 2023 21:02:08 +0000"  >&lt;p&gt;Out of curiosity I downloaded the source code of Java 17 and 21 from the openjdk repository at Github and compared the code of the &lt;tt&gt;java.xml&lt;/tt&gt; module. AFAICT no real changes in the code that could affect Tika, apart from the above mentioned class &lt;tt&gt;com.sun.org.apache.xml.internal.serializer.ToStream&lt;/tt&gt; that now throws an exception; see code snippet above...&lt;/p&gt;</comment>
                            <comment id="17767980" author="tallison@mitre.org" created="Fri, 22 Sep 2023 12:15:58 +0000"  >&lt;p&gt;Oh, wow. Interesting.  So it isn&apos;t a general problem &amp;#8211; Java 21 forbids writing a zero-length array of chars.  Rather it&apos;s a problem with our transformer configuration.  Thank you so much.  I&apos;ll close the initial PR, and open one for this fix.  That would explain why so many tests passed and we were only seeing problems in some tika-server tests.&lt;/p&gt;</comment>
                            <comment id="17767991" author="t_heit" created="Fri, 22 Sep 2023 12:43:16 +0000"  >&lt;p&gt;Already done: &lt;a href=&quot;https://github.com/apache/tika/pull/1353&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17768012" author="githubbot" created="Fri, 22 Sep 2023 13:35:35 +0000"  >&lt;p&gt;tballison commented on PR #1350:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1350#issuecomment-1731432427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1350#issuecomment-1731432427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @theit solved this more elegantly&lt;/p&gt;

</comment>
                            <comment id="17768013" author="githubbot" created="Fri, 22 Sep 2023 13:35:36 +0000"  >&lt;p&gt;tballison closed pull request #1350: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4137&quot; title=&quot;Building current Tika main branch fails under Java 20/21&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4137&quot;&gt;&lt;del&gt;TIKA-4137&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1350&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1350&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17768014" author="tallison@mitre.org" created="Fri, 22 Sep 2023 13:36:28 +0000"  >&lt;p&gt;I added a jdk21 build to our github actions just now for the main branch.&lt;/p&gt;</comment>
                            <comment id="17768017" author="t_heit" created="Fri, 22 Sep 2023 13:43:03 +0000"  >&lt;p&gt;Great &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17768089" author="tallison@mitre.org" created="Fri, 22 Sep 2023 16:42:15 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=t_heit&quot; class=&quot;user-hover&quot; rel=&quot;t_heit&quot;&gt;t_heit&lt;/a&gt; for your diligence in finding the source of the problem!&lt;/p&gt;</comment>
                            <comment id="17768116" author="hudson" created="Fri, 22 Sep 2023 18:07:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk11 #1258 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk11/1258/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk11/1258/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4137&quot; title=&quot;Building current Tika main branch fails under Java 20/21&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4137&quot;&gt;&lt;del&gt;TIKA-4137&lt;/del&gt;&lt;/a&gt; &amp;#8211; add a jdk21 build workflow (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/6871c9157ed58fe1a0249bbdf44ef76116dba767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/6871c9157ed58fe1a0249bbdf44ef76116dba767&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) .github/workflows/main-jdk21-build.yml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17768361" author="tilman" created="Sun, 24 Sep 2023 09:05:25 +0000"  >&lt;p&gt;I&apos;ve modified the jdk18 build job on the ci to a jdk21 build job and it looks good too&lt;br/&gt;
&lt;a href=&quot;https://ci-builds.apache.org/job/tika/job/tika-main-jdk21/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/tika/job/tika-main-jdk21/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17846672" author="robfrank" created="Wed, 15 May 2024 15:03:06 +0000"  >&lt;p&gt;Could you please backport this small fix on 2.9.x ?&#160;&lt;/p&gt;

&lt;p&gt;We are on 2.9.x and&#160; moving to Java 21 from 17.&lt;/p&gt;</comment>
                            <comment id="17846697" author="tallison@mitre.org" created="Wed, 15 May 2024 16:10:19 +0000"  >&lt;p&gt;Y, done just now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12551594">TIKA-895</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12523677">TIKA-725</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13063074" name="org.apache.tika.server.core.StackTraceOffTest.txt" size="1234" author="t_heit" created="Wed, 20 Sep 2023 19:54:46 +0000"/>
                            <attachment id="13063073" name="org.apache.tika.server.core.StackTraceTest.txt" size="1219" author="t_heit" created="Wed, 20 Sep 2023 19:54:46 +0000"/>
                            <attachment id="13063072" name="org.apache.tika.server.core.TikaResourceFetcherTest.txt" size="3333" author="t_heit" created="Wed, 20 Sep 2023 19:54:46 +0000"/>
                            <attachment id="13063071" name="org.apache.tika.server.core.TikaResourceTest.txt" size="3360" author="t_heit" created="Wed, 20 Sep 2023 19:54:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1khrc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>