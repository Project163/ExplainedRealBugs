<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:00:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2037] Problems with email attachments</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2037</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I stumbled across a couple of problems while parsing and extracting attachments from .eml files from Thunderbird. Some of them are wrongly identified (as text/html, or application/xhtml+xml) and in a lot of them, the attachments are not detected. I tried to parse 20 random eml files with attachments (pdf,txt,html,etc), and at least 10 of them are either identified as html, or correctly identified as rfc822 but the attachments are not extracted. I tried the same files using TikaCLI -z option with the same result.&lt;/p&gt;

&lt;p&gt;What I did: I extended the class ParsingEmbeddedDocumentExtractor to extract and store the attachments somewhere else (exactly as shown in this example code &lt;a href=&quot;https://github.com/apache/tika/blob/master/tika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/blob/master/tika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.java&lt;/a&gt;). &lt;/p&gt;
</description>
                <environment>&lt;p&gt;Eclipse, Java 8&lt;/p&gt;</environment>
        <key id="12991156">TIKA-2037</key>
            <summary>Problems with email attachments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eli.trucco">Eli Trucco</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2016 15:42:06 +0000</created>
                <updated>Tue, 26 Jul 2016 12:16:27 +0000</updated>
                            <resolved>Wed, 20 Jul 2016 17:21:06 +0000</resolved>
                                    <version>1.13</version>
                                    <fixVersion>1.14</fixVersion>
                                    <component>detector</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15386061" author="eli.trucco" created="Wed, 20 Jul 2016 15:44:13 +0000"  >&lt;p&gt;I attached two example files. Exkursion is always detected as text/html and CameraCalibration is correctly identified as rfc822 but the attachments are not extracted. &lt;/p&gt;</comment>
                            <comment id="15386070" author="tallison@mitre.org" created="Wed, 20 Jul 2016 15:48:24 +0000"  >&lt;p&gt;Thank you for opening this.  I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="15386079" author="eli.trucco" created="Wed, 20 Jul 2016 15:57:20 +0000"  >&lt;p&gt;Thanks, Tim! Another thing I noticed is, in the example code ExtractEmbeddedFiles.java (link above), the input stream should first be wrapped in TikaInputStream, otherwise RFC822 Parser will throw an exception because it doesn&apos;t support mark/reset. &lt;/p&gt;</comment>
                            <comment id="15386159" author="gagravarr" created="Wed, 20 Jul 2016 16:33:00 +0000"  >&lt;p&gt;I&apos;ve just tried with a 1.14 snapshot build, and both are detected as &lt;tt&gt;message/rfc822&lt;/tt&gt; there, so it looks like we may have already fixed at least part of this on trunk&lt;/p&gt;

&lt;p&gt;Attachment extraction is failing with a different error, from within Tika itself so likely our own fault:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.tika.exception.TikaException: Failed to parse an email message
	at org.apache.tika.parser.mail.RFC822Parser.parse(RFC822Parser.java:81)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)
	at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:191)
	at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:480)
	at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:145)
Caused by: java.io.IOException: mark/reset not supported
	at java.io.InputStream.reset(InputStream.java:347)
	at org.apache.tika.parser.microsoft.POIFSContainerDetector.detect(POIFSContainerDetector.java:436)
	at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:77)
	at org.apache.tika.cli.TikaCLI$FileEmbeddedDocumentExtractor.parseEmbedded(TikaCLI.java:1021)
	at org.apache.tika.parser.mail.MailContentHandler.body(MailContentHandler.java:182)
	at org.apache.james.mime4j.parser.MimeStreamParser.parse(MimeStreamParser.java:133)
	at org.apache.tika.parser.mail.RFC822Parser.parse(RFC822Parser.java:78)
	... 6 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15386172" author="eli.trucco" created="Wed, 20 Jul 2016 16:38:57 +0000"  >&lt;p&gt;Hi Nick, &lt;br/&gt;
This line &quot;Caused by: java.io.IOException: mark/reset not supported&quot; I think is thrown because the input stream in the parseEmbedded method inside TikaCLI.java is not wrapped in TikaInputStream. &lt;/p&gt;</comment>
                            <comment id="15386237" author="gagravarr" created="Wed, 20 Jul 2016 17:21:06 +0000"  >&lt;p&gt;Fixed in 952fb54 along with a simpler unit test inspired by your files, thanks!&lt;/p&gt;</comment>
                            <comment id="15386260" author="eli.trucco" created="Wed, 20 Jul 2016 17:36:14 +0000"  >&lt;p&gt;Great. So after resolving the exception, you were able to extract the attachments from both files?&lt;/p&gt;</comment>
                            <comment id="15389781" author="tallison@mitre.org" created="Fri, 22 Jul 2016 16:31:04 +0000"  >&lt;p&gt;Any chance you could update 2.0, too?  Thank you!&lt;/p&gt;</comment>
                            <comment id="15393649" author="hudson" created="Tue, 26 Jul 2016 11:22:52 +0000"  >&lt;p&gt;FAILURE: Integrated in tika-2.x #124 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/124/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/124/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2037&quot; title=&quot;Problems with email attachments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2037&quot;&gt;&lt;del&gt;TIKA-2037&lt;/del&gt;&lt;/a&gt; RFC822Parser should wrap the James InputStream of embedded (nick: rev 31374a39bae03bfc260f73662c133467637193f1)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-office-module/src/test/java/org/apache/tika/parser/mbox/MboxParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;/li&gt;
	&lt;li&gt;CHANGES.txt&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2037&quot; title=&quot;Problems with email attachments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2037&quot;&gt;&lt;del&gt;TIKA-2037&lt;/del&gt;&lt;/a&gt; Merge fixes for 2.x (nick: rev f89887d2fbaa3949c398095b37322208a3fd4c7a)&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/test/resources/test-documents/testEmailWithPNGAtt.eml&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;/li&gt;
	&lt;li&gt;tika-test-resources/src/test/resources/test-documents/testEmailWithPNGAtt.eml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15393707" author="hudson" created="Tue, 26 Jul 2016 12:16:27 +0000"  >&lt;p&gt;FAILURE: Integrated in tika-2.x-windows #28 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/28/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/28/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2037&quot; title=&quot;Problems with email attachments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2037&quot;&gt;&lt;del&gt;TIKA-2037&lt;/del&gt;&lt;/a&gt; RFC822Parser should wrap the James InputStream of embedded (nick: rev 31374a39bae03bfc260f73662c133467637193f1)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;CHANGES.txt&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-office-module/src/test/java/org/apache/tika/parser/mbox/MboxParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2037&quot; title=&quot;Problems with email attachments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2037&quot;&gt;&lt;del&gt;TIKA-2037&lt;/del&gt;&lt;/a&gt; Merge fixes for 2.x (nick: rev f89887d2fbaa3949c398095b37322208a3fd4c7a)&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/main/java/org/apache/tika/parser/mail/MailContentHandler.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/test/resources/test-documents/testEmailWithPNGAtt.eml&lt;/li&gt;
	&lt;li&gt;tika-test-resources/src/test/resources/test-documents/testEmailWithPNGAtt.eml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12819124" name="CameraCalibration.eml" size="79259" author="eli.trucco" created="Wed, 20 Jul 2016 15:44:13 +0000"/>
                            <attachment id="12819125" name="Exkursion.eml" size="706500" author="eli.trucco" created="Wed, 20 Jul 2016 15:44:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i319mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>