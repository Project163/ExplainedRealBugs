<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:02:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3040] PDF inline OCR: Exception while processing certain image (others in same PDF work)</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3040</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;There is a PDF document (without plain text content) in which text content are scans of multiple pages.&lt;/p&gt;

&lt;p&gt;OCR for one of the images (text of a page) fails by tika-server with activated inline OCR for PDF.&lt;/p&gt;

&lt;p&gt;My fallback/alternate in Open Semantic ETL / Open Semantic Search using pdfimages of Debian package poppler-utils to extract the images works for all images in that PDF document).&lt;/p&gt;

&lt;p&gt;I can not attach/upload this document here to the public because of Copyright/Classified issues, but if interested, i could send it to certain developer(s).&lt;/p&gt;

&lt;p&gt;Following tika-server exception in result field X-TIKA:EXCEPTION:embedded_stream_exception:&lt;/p&gt;

&lt;p&gt;javax.imageio.IIOException: Bogus input colorspace at java.desktop/com.sun.imageio.plugins.jpeg.JPEGImageWriter.writeImage(Native Method) at java.desktop/com.sun.imageio.plugins.jpeg.JPEGImageWriter.writeOnThread(JPEGImageWriter.java:1007) at java.desktop/com.sun.imageio.plugins.jpeg.JPEGImageWriter.write(JPEGImageWriter.java:371) at org.apache.pdfbox.tools.imageio.ImageIOUtil.writeImage(ImageIOUtil.java:316) at org.apache.pdfbox.tools.imageio.ImageIOUtil.writeImage(ImageIOUtil.java:189) at org.apache.pdfbox.tools.imageio.ImageIOUtil.writeImage(ImageIOUtil.java:166) at org.apache.pdfbox.tools.imageio.ImageIOUtil.writeImage(ImageIOUtil.java:148) at org.apache.tika.parser.pdf.PDF2XHTML.writeToBuffer(PDF2XHTML.java:304) at org.apache.tika.parser.pdf.PDF2XHTML.processImageObject(PDF2XHTML.java:268) at org.apache.tika.parser.pdf.PDF2XHTML.extractImages(PDF2XHTML.java:194) at org.apache.tika.parser.pdf.PDF2XHTML.endPage(PDF2XHTML.java:165) at org.apache.pdfbox.text.PDFTextStripper.processPage(PDFTextStripper.java:393) at org.apache.tika.parser.pdf.PDF2XHTML.processPage(PDF2XHTML.java:153) at org.apache.tika.parser.pdf.AbstractPDF2XHTML.processPages(AbstractPDF2XHTML.java:867) at org.apache.pdfbox.text.PDFTextStripper.writeText(PDFTextStripper.java:266) at org.apache.tika.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:124) at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:162) at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280) at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280) at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:143) at org.apache.tika.parser.RecursiveParserWrapper.parse(RecursiveParserWrapper.java:233) at org.apache.tika.server.resource.TikaResource.parse(TikaResource.java:409) at org.apache.tika.server.resource.RecursiveMetadataResource.parseMetadata(RecursiveMetadataResource.java:147) at org.apache.tika.server.resource.RecursiveMetadataResource.getMetadata(RecursiveMetadataResource.java:123) at jdk.internal.reflect.GeneratedMethodAccessor5.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:566) at org.apache.cxf.service.invoker.AbstractInvoker.performInvocation(AbstractInvoker.java:179) at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:96) at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:201) at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:104) at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59) at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308) at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121) at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:267) at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.doService(JettyHTTPDestination.java:247) at org.apache.cxf.transport.http_jetty.JettyHTTPHandler.handle(JettyHTTPHandler.java:79) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1296) at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:190) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1211) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) at org.eclipse.jetty.server.Server.handle(Server.java:500) at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:386) at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:560) at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:378) at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:268) at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:782) at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:914) at java.base/java.lang.Thread.run(Thread.java:834)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian 10&lt;/p&gt;

&lt;p&gt;Tesseract&lt;/p&gt;</environment>
        <key id="13284663">TIKA-3040</key>
            <summary>PDF inline OCR: Exception while processing certain image (others in same PDF work)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Mandalka">Markus Mandalka</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Feb 2020 20:19:58 +0000</created>
                <updated>Mon, 24 Feb 2020 19:00:38 +0000</updated>
                            <resolved>Mon, 24 Feb 2020 19:00:38 +0000</resolved>
                                    <version>1.23</version>
                                    <fixVersion>1.24</fixVersion>
                                    <component>ocr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17034817" author="tilman" created="Tue, 11 Feb 2020 20:27:15 +0000"  >&lt;p&gt;Please send it to me, tilman at snafu dot de . Please clarify what page makes the problem and how to reproduce with the server. (I&apos;ll probably try to reproduce with PDFBOX ExtractImages first)&lt;/p&gt;</comment>
                            <comment id="17034822" author="tilman" created="Tue, 11 Feb 2020 20:43:17 +0000"  >&lt;p&gt;Try also to use the twelvemonkeys library&lt;br/&gt;
&lt;a href=&quot;https://github.com/haraldk/TwelveMonkeys&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/haraldk/TwelveMonkeys&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wonder whether this is this bug?&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-6508095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-6508095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From looking at the tika source code, your image is a jpeg with CMYK or an &quot;unusual&quot; colorspace (not grey or RGB).&lt;/p&gt;</comment>
                            <comment id="17034854" author="mandalka" created="Tue, 11 Feb 2020 21:31:35 +0000"  >&lt;p&gt;Document attached in email.&lt;/p&gt;

&lt;p&gt;For others: This is &quot;only&quot; exception on this image so the OCR for this image doesn&apos;t work, but no general tika-server exception, so rest of document (and its other images) was processed/returned.&lt;/p&gt;</comment>
                            <comment id="17035024" author="tilman" created="Wed, 12 Feb 2020 04:02:05 +0000"  >&lt;p&gt;Thanks for the file, I think I see what the problem is. It is both in PDFBox and in Tika, that segment uses the same code. The problem is that it is a JPEG image that has a mask, thus an ARGB image. However JPEG files are not transparent. It should probably be saved as PNG, or the mask be lost.&lt;/p&gt;</comment>
                            <comment id="17035046" author="tilman" created="Wed, 12 Feb 2020 04:53:20 +0000"  >&lt;p&gt;Can you build from source? If yes, open the file PDF2XHTML.java and search for the line &quot;String extension = image.getSuffix();&quot;&lt;/p&gt;

&lt;p&gt;there add this below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (image.getMask() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || image.getSoftMask() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                extension = &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is done so early because the MIME type must match the content.&lt;/p&gt;</comment>
                            <comment id="17035049" author="tilman" created="Wed, 12 Feb 2020 04:58:53 +0000"  >&lt;p&gt;Unrelated to this: I suspect the current code misses inline images, see e.g. the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-52&quot; title=&quot;DCTFilter is not implemented yet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-52&quot;&gt;&lt;del&gt;PDFBOX-52&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17035237" author="tallison@mitre.org" created="Wed, 12 Feb 2020 10:36:35 +0000"  >&lt;p&gt;Will do. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;Out of curiosity, does the &#8220;render page then run ocr&#8221; strategy work on this doc?&lt;/p&gt;</comment>
                            <comment id="17035347" author="mandalka" created="Wed, 12 Feb 2020 13:02:08 +0000"  >&lt;p&gt;&amp;gt; Out of curiosity, does the &#8220;render page then run ocr&#8221; strategy work on this doc?&lt;/p&gt;

&lt;p&gt;Tried this document with &quot;X-Tika-PDFOcrStrategy: ocr_only&quot; instead of &quot;X-Tika-PDFextractInlineImages: true&quot; and can see the text of all the images and no X-TIKA:EXCEPTION:embedded_stream_exception for the problematic image.&lt;/p&gt;</comment>
                            <comment id="17035359" author="tallison@mitre.org" created="Wed, 12 Feb 2020 13:37:26 +0000"  >&lt;p&gt;Great!  Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Mandalka&quot; class=&quot;user-hover&quot; rel=&quot;Mandalka&quot;&gt;Mandalka&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17035683" author="tilman" created="Wed, 12 Feb 2020 20:21:56 +0000"  >&lt;p&gt;I have not managed to reproduce the effect, I ran this:&lt;/p&gt;

&lt;p&gt;java -jar tika-app-1.23-SNAPSHOT.jar -j -z &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3040&quot; title=&quot;PDF inline OCR: Exception while processing certain image (others in same PDF work)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3040&quot;&gt;&lt;del&gt;TIKA-3040&lt;/del&gt;&lt;/a&gt;.pdf&lt;/p&gt;

&lt;p&gt;this extracts the file, the &quot;problem&quot; file is extracted as a CMYK JPEG with &lt;font color=&quot;#FFBDAD&quot;&gt;pink&lt;/font&gt;, which isn&apos;t very good either.&lt;/p&gt;

&lt;p&gt;When including my fix, then I get a PNG file, which is good.&lt;/p&gt;

&lt;p&gt;I haven&apos;t tested with tika-server, would I have to write some client code for that? Or can this be done from the browser URL?&lt;/p&gt;</comment>
                            <comment id="17035685" author="tilman" created="Wed, 12 Feb 2020 20:30:26 +0000"  >&lt;p&gt;I expected that it works with the &quot;render page&quot; strategy, because this is a very different path.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Mandalka&quot; class=&quot;user-hover&quot; rel=&quot;Mandalka&quot;&gt;Mandalka&lt;/a&gt; the image extraction strategy may seem faster, but it will not always be the best, some PDFs have the scan split into tiny pieces.&lt;/p&gt;</comment>
                            <comment id="17035687" author="tallison@mitre.org" created="Wed, 12 Feb 2020 20:34:14 +0000"  >&lt;p&gt;Cant remember if the unpacker resource does the equivalent of -z...&lt;/p&gt;

&lt;p&gt;Maybe test w ocr and pdfparser configured to extract inline images?&lt;/p&gt;

&lt;p&gt;If you send me the file I can take a look.&lt;/p&gt;</comment>
                            <comment id="17035719" author="mandalka" created="Wed, 12 Feb 2020 21:24:43 +0000"  >&lt;p&gt;Emailed this file and another (english and with plaintext in it so maybe easier to debug) PDF causing same exception.&lt;/p&gt;</comment>
                            <comment id="17036508" author="hudson" created="Thu, 13 Feb 2020 21:18:17 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build Tika-trunk #1773 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1773/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1773/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3040&quot; title=&quot;PDF inline OCR: Exception while processing certain image (others in same PDF work)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3040&quot;&gt;&lt;del&gt;TIKA-3040&lt;/del&gt;&lt;/a&gt; &amp;#8211; align our image extraction code PDFs with updates to (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/fe2f4dd964279953a5fdfb8125a1d62290c1b271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/fe2f4dd964279953a5fdfb8125a1d62290c1b271&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/ImageGraphicsEngine.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17036514" author="hudson" created="Thu, 13 Feb 2020 21:26:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #308 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/308/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/308/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3040&quot; title=&quot;PDF inline OCR: Exception while processing certain image (others in same PDF work)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3040&quot;&gt;&lt;del&gt;TIKA-3040&lt;/del&gt;&lt;/a&gt; &amp;#8211; align our image extraction code PDFs with updates to (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/4d1e1b97dc21c537ea2d6f36ed325875ca9b9c46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/4d1e1b97dc21c537ea2d6f36ed325875ca9b9c46&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pdf/ImageGraphicsEngine.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17043769" author="tallison@mitre.org" created="Mon, 24 Feb 2020 19:00:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Mandalka&quot; class=&quot;user-hover&quot; rel=&quot;Mandalka&quot;&gt;Mandalka&lt;/a&gt;, please reopen if &lt;tt&gt;branch_1x&lt;/tt&gt; doesn&apos;t work as expected on your files.&lt;/p&gt;

&lt;p&gt;Many thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; for diagnosing this and actually fixing this...I did just a copy/paste job.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13284720">PDFBOX-4771</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bdxc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>