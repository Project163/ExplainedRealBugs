<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:05:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-4315] XPS file parser does not emit whitespace as expected</title>
                <link>https://issues.apache.org/jira/browse/TIKA-4315</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;We are using tika to extract text from XPS files and have hit an issue where whitespace is not emitted where we would expect. See the attached example file where opening the file it visually has a large gap between &quot;x&quot; and &quot;abcde1234f&quot; but when extracted by tika it calls `characters` with &quot;x&quot; and then `characters` on &quot;abcde1234f&quot;. We would expect a `ignorableWhitespace` in between those calls but we don&apos;t get one.&lt;/p&gt;

&lt;p&gt;I have a pull request that fixes the issue which I will submit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13593899">TIKA-4315</key>
            <summary>XPS file parser does not emit whitespace as expected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ruairidh-next">Ruairidh Williamson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Oct 2024 14:32:33 +0000</created>
                <updated>Fri, 31 Jan 2025 21:49:36 +0000</updated>
                            <resolved>Thu, 24 Oct 2024 11:18:14 +0000</resolved>
                                    <version>2.9.1</version>
                    <version>2.9.2</version>
                                    <fixVersion>2.9.3</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17890200" author="githubbot" created="Wed, 16 Oct 2024 17:46:30 +0000"  >&lt;p&gt;tballison commented on PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970#issuecomment-2417504174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970#issuecomment-2417504174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Y, I now remember this issue with XPS. This is the same challenge with PDFs. Interpolating whitespace has to be determined based on character width and the distance between text blocks, which means that you have to sort text chunks so that they&apos;re on the same &quot;line&quot;, and you have to get reading order correct, etc.&lt;/p&gt;

</comment>
                            <comment id="17891476" author="githubbot" created="Mon, 21 Oct 2024 09:46:45 +0000"  >&lt;p&gt;ruwi-next commented on PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970#issuecomment-2426171823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970#issuecomment-2426171823&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &amp;gt; Y, I now remember this issue with XPS. This is the same challenge with PDFs. Interpolating whitespace has to be determined based on character width and the distance between text blocks, which means that you have to sort text chunks so that they&apos;re on the same &quot;line&quot;, and you have to get reading order correct, etc.&lt;/p&gt;

&lt;p&gt;   Thank you for the feedback, that makes sense. I&apos;ll take a look at the PDF implementation and see if I can implement this properly.&lt;/p&gt;

</comment>
                            <comment id="17891487" author="githubbot" created="Mon, 21 Oct 2024 10:33:08 +0000"  >&lt;p&gt;THausherr commented on PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970#issuecomment-2426278282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970#issuecomment-2426278282&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   The PDF implementation can be found in PDFTextStripper.java in the PDFBox project.&lt;/p&gt;

</comment>
                            <comment id="17892409" author="githubbot" created="Thu, 24 Oct 2024 09:25:10 +0000"  >&lt;p&gt;ruwi-next commented on PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970#issuecomment-2434755713&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970#issuecomment-2434755713&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   I&apos;ve had a go at implementing this, changes in &lt;span class=&quot;error&quot;&gt;&amp;#91;c42466f&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/tika/pull/1970/commits/c42466ff72f1470935ee01d792ef4d10d8c67f87&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970/commits/c42466ff72f1470935ee01d792ef4d10d8c67f87&lt;/a&gt;), I can squash into one commit if that is preferred.&lt;/p&gt;

&lt;p&gt;   The implementation uses the indices string that is provided in XPS. It is a list of information for each glyph in a run. The useful information is the advance which based on &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/xpsobjectmodel/ns-xpsobjectmodel-xps_glyph_index&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://learn.microsoft.com/en-us/windows/win32/api/xpsobjectmodel/ns-xpsobjectmodel-xps_glyph_index&lt;/a&gt; is measured in 1/100 em. Using this we can calculate the distance between runs and decide based on a threshold if a whitespace should be inserted. I have added some test xps files that I made to test this.&lt;/p&gt;

&lt;p&gt;   This implementation has some assumptions and limitations. Mainly that we do not get the glyph advance value for the last glyph in a run. I have used the average advance or 0.5 as a fallback in this case.&lt;/p&gt;

&lt;p&gt;   It also sorts the runs based on LTR unless all runs in a row are RTL. This maybe incorrect for cases where there is LTR and a multiple runs of RTL but I am not knowledgeable in this area.&lt;/p&gt;

&lt;p&gt;   Any feedback is appreciated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

</comment>
                            <comment id="17892439" author="githubbot" created="Thu, 24 Oct 2024 11:13:06 +0000"  >&lt;p&gt;tballison merged PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17892440" author="githubbot" created="Thu, 24 Oct 2024 11:13:12 +0000"  >&lt;p&gt;tballison commented on PR #1970:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/1970#issuecomment-2434987172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1970#issuecomment-2434987172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Wow. That&apos;s fantastic. Thank you!&lt;/p&gt;

</comment>
                            <comment id="17892442" author="tallison@mitre.org" created="Thu, 24 Oct 2024 11:18:14 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruairidh-next&quot; class=&quot;user-hover&quot; rel=&quot;ruairidh-next&quot;&gt;ruairidh-next&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17892459" author="hudson" created="Thu, 24 Oct 2024 12:16:12 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Tika &#187; tika-branch_2x-jdk11 #518 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-branch_2x-jdk11/518/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-branch_2x-jdk11/518/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4315&quot; title=&quot;XPS file parser does not emit whitespace as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4315&quot;&gt;&lt;del&gt;TIKA-4315&lt;/del&gt;&lt;/a&gt; Fix XPS whitespace not being emitted (#1970) (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/f6fe845637f42b6c01bed388d610b0e9c9f83ea1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/f6fe845637f42b6c01bed388d610b0e9c9f83ea1&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/resources/test-documents/testXLSX.xps&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/resources/test-documents/test_text.xps&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/ooxml/xps/XPSPageContentHandler.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/java/org/apache/tika/parser/microsoft/ooxml/xps/XPSParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17892466" author="hudson" created="Thu, 24 Oct 2024 12:46:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-branch_3x-jdk11 #1851 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-branch_3x-jdk11/1851/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-branch_3x-jdk11/1851/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4315&quot; title=&quot;XPS file parser does not emit whitespace as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4315&quot;&gt;&lt;del&gt;TIKA-4315&lt;/del&gt;&lt;/a&gt; Fix XPS whitespace not being emitted (#1970) (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/6eeeb185685a7015316791e44848bb5d68613a25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/6eeeb185685a7015316791e44848bb5d68613a25&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/java/org/apache/tika/parser/microsoft/ooxml/xps/XPSParserTest.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/resources/test-documents/test_text.xps&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/ooxml/xps/XPSPageContentHandler.java&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/test/resources/test-documents/testXLSX.xps&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17892500" author="hudson" created="Thu, 24 Oct 2024 14:00:18 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build Tika &#187; tika-branch_2x-jdk11 #519 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-branch_2x-jdk11/519/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-branch_2x-jdk11/519/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4315&quot; title=&quot;XPS file parser does not emit whitespace as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4315&quot;&gt;&lt;del&gt;TIKA-4315&lt;/del&gt;&lt;/a&gt; &amp;#8211; checkstyle (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/ba6a2e3bd68a09852889961643fafc809f8eb1da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/ba6a2e3bd68a09852889961643fafc809f8eb1da&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/ooxml/xps/XPSPageContentHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13596640">TIKA-4337</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13071922" name="testXLSX.xps" size="30091" author="ruairidh-next" created="Tue, 1 Oct 2024 14:31:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rq4o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>