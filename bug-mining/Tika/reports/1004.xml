<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:01:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2530] OutlookExtractor &quot;buffer underrun&quot; when parsing .msg with embedded .msg</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2530</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When parsing certain .msg files containing certain attachments (e.g. other .msg files), I get this error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
Caused by: org.apache.poi.util.LittleEndian$BufferUnderrunException: buffer underrun
        at org.apache.poi.util.LittleEndian.readInt(LittleEndian.java:662)
        at org.apache.poi.hmef.CompressedRTF.decompress(CompressedRTF.java:73)
        at org.apache.poi.util.LZWDecompresser.decompress(LZWDecompresser.java:81)
        at org.apache.poi.hmef.attribute.MAPIRtfAttribute.&amp;lt;init&amp;gt;(MAPIRtfAttribute.java:42)
        at org.apache.tika.parser.microsoft.OutlookExtractor.parse(OutlookExtractor.java:270)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the issue is with &lt;tt&gt;MAPIRtfAttribute&lt;/tt&gt; not liking it when receiving an empty byte array from &lt;tt&gt;OutlookExtractor&lt;/tt&gt;.  I was able to eliminate the error at around line 269 of &lt;tt&gt;OutlookExtractor&lt;/tt&gt; with Tika 1.16 code (or around line 322 with Tika 1.17) with the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-comment&quot;&gt;//--- START FIX ---
&lt;/span&gt;            ByteChunk chunk = (ByteChunk) rtfChunk;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (chunk != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; chunk.getValue() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 
                    &amp;amp;&amp;amp; chunk.getValue().length &amp;gt; 0 &amp;amp;&amp;amp; !doneBody) {
                &lt;span class=&quot;code-comment&quot;&gt;//ByteChunk chunk = (ByteChunk) rtfChunk;
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//--- END FIX ---&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not sure if that is a real fix or more should be done than just getting rid of the error to make sure all is extracted properly from all files.&lt;/p&gt;

&lt;p&gt;I cannot share the sample file I have to test since it was given to me as sensitive content and I could not recreate a faulty msg file.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>&lt;p&gt;Reproduced with both Tika 1.16 and Tika 1.17 on Windows but the problem is likely on all platform.&lt;/p&gt;</environment>
        <key id="13125438">TIKA-2530</key>
            <summary>OutlookExtractor &quot;buffer underrun&quot; when parsing .msg with embedded .msg</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="pascal.essiembre">Pascal Essiembre</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Dec 2017 20:44:07 +0000</created>
                <updated>Fri, 9 Mar 2018 12:57:40 +0000</updated>
                                            <version>1.16</version>
                    <version>1.17</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16391404" author="lenczykt" created="Thu, 8 Mar 2018 15:35:45 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have similar issue in my project&lt;/p&gt;

&lt;p&gt;error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.tika.exception.TikaException: TIKA-198: Illegal IOException from org.apache.tika.parser.executable.ExecutableParser@271f18d3
 at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:286)
 at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)
 at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:143)
 at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:159)
 at com.roche.medmap.search.FileContentExtractor.extract(FileContentExtractor.java:29)
 ... 1 more
Caused by: org.apache.poi.util.LittleEndian$BufferUnderrunException: buffer underrun
 at org.apache.poi.util.LittleEndian.readInt(LittleEndian.java:662)
 at org.apache.tika.parser.executable.ExecutableParser.parsePE(ExecutableParser.java:98)
 at org.apache.tika.parser.executable.ExecutableParser.parse(ExecutableParser.java:74)
 at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is file which causes error: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913621/12913621_test_file.txt&quot; title=&quot;test_file.txt attached to TIKA-2530&quot;&gt;test_file.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Details:&lt;br/&gt;
tika: org.apache.tika:tika-parsers:1.17&lt;br/&gt;
java: 1.8.0_161&quot;&lt;/p&gt;</comment>
                            <comment id="16391753" author="tallison@mitre.org" created="Thu, 8 Mar 2018 19:13:23 +0000"  >&lt;p&gt;I just added the temporary workaround (length check) in the OutlookParser.&#160; This workaround will be available in 1.18 and 2.0.0.&#160; It would be great if we could work with a triggering document to determine if this is a bug in POI or if an rtf body might just be empty.&#160; &#160; &#160;I&apos;m going to leave this issue open until we find a triggering file.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pascal.essiembre&quot; class=&quot;user-hover&quot; rel=&quot;pascal.essiembre&quot;&gt;pascal.essiembre&lt;/a&gt;!&#160;&lt;/p&gt;</comment>
                            <comment id="16391761" author="tallison@mitre.org" created="Thu, 8 Mar 2018 19:14:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lenczykt&quot; class=&quot;user-hover&quot; rel=&quot;lenczykt&quot;&gt;lenczykt&lt;/a&gt;, that&apos;s a different parser (ExecutableParser vs OutlookParser), and a different issue.&lt;/p&gt;</comment>
                            <comment id="16391978" author="hudson" created="Thu, 8 Mar 2018 22:07:37 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build tika-2.x-windows #218 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/218/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/218/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2530&quot; title=&quot;OutlookExtractor &amp;quot;buffer underrun&amp;quot; when parsing .msg with embedded .msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2530&quot;&gt;TIKA-2530&lt;/a&gt; &amp;#8211; temporary workaround &amp;#8211; check for zero length byte array in (tallison: rev 8ecfeeff86e991fa9b6c3fa12b89ec96aef00684)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/OutlookExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16391993" author="hudson" created="Thu, 8 Mar 2018 22:15:16 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #9 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/9/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/9/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2530&quot; title=&quot;OutlookExtractor &amp;quot;buffer underrun&amp;quot; when parsing .msg with embedded .msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2530&quot;&gt;TIKA-2530&lt;/a&gt; &amp;#8211; temporary workaround &amp;#8211; check for zero length byte array in (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/ceee42a3982574704ecb30b1ac2e7e658d7d18b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/ceee42a3982574704ecb30b1ac2e7e658d7d18b3&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/OutlookExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16391996" author="hudson" created="Thu, 8 Mar 2018 22:16:24 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1456 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1456/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1456/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2530&quot; title=&quot;OutlookExtractor &amp;quot;buffer underrun&amp;quot; when parsing .msg with embedded .msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2530&quot;&gt;TIKA-2530&lt;/a&gt; &amp;#8211; temporary workaround &amp;#8211; check for zero length byte array in (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/8ecfeeff86e991fa9b6c3fa12b89ec96aef00684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/8ecfeeff86e991fa9b6c3fa12b89ec96aef00684&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/microsoft/OutlookExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16392565" author="lenczykt" created="Fri, 9 Mar 2018 08:19:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt;&lt;br/&gt;
Should I create separate issue for it?&lt;/p&gt;</comment>
                            <comment id="16392781" author="tallison@mitre.org" created="Fri, 9 Mar 2018 12:14:42 +0000"  >&lt;p&gt;If you think it is fixable, yes, please do open an issue.&#160; However, I&apos;m not sure that it is an issue.&#160; The file is being identified as an exe, and it clearly isn&apos;t...&#160; So, are you asking that we change the mime signature somehow so that this file is processed as a text file?&#160; Or are you suggesting that this exe file is a good file and we shouldn&apos;t be throwing an exception?&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="16392837" author="lenczykt" created="Fri, 9 Mar 2018 12:48:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt; Ohh, you are right. This text file is executable. I haven&apos;t noticed. &lt;br/&gt;
I discovered when you add &quot;MZ&quot;(&lt;a href=&quot;https://en.wikipedia.org/wiki/DOS_MZ_executable&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/DOS_MZ_executable&lt;/a&gt;) as the beginning of file it becomes executable. You can check file content &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913621/12913621_test_file.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12913621/12913621_test_file.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think we can forget about my issue. Thx &lt;/p&gt;</comment>
                            <comment id="16392848" author="tallison@mitre.org" created="Fri, 9 Mar 2018 12:57:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we can forget about my issue.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lenczykt&quot; class=&quot;user-hover&quot; rel=&quot;lenczykt&quot;&gt;lenczykt&lt;/a&gt;, done!&#160; But seriously... thank you for pinging us and sharing a document that we can look at.&#160; Do not hesitate to ask on the user list or open an issue &lt;del&gt;if&lt;/del&gt; when you find areas for improvements.&#160; Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12913621" name="test_file.txt" size="16" author="lenczykt" created="Thu, 8 Mar 2018 15:35:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/Norconex/importer/issues/72]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nzjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>