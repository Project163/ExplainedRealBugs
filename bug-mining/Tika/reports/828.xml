<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:00:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2041] Charset detection doesn&apos;t appear to be thread-safe</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2041</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;On the user list, Christian Leitinger noted that his team found a potential issue with the thread safety of the encoding detector.  I was able to reproduce this with on the corpus of html files in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=faghani&quot; class=&quot;user-hover&quot; rel=&quot;faghani&quot;&gt;faghani&lt;/a&gt;&apos;s encoding detector.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Test
    public void testMultiThreadingEncodingDetection() throws Exception {

        Path testDocs = Paths.get(&quot;C:/data/encodings/corpus&quot;);
        List&amp;lt;Path&amp;gt; paths = new ArrayList&amp;lt;&amp;gt;();
        Map&amp;lt;Path, String&amp;gt; encodings = new ConcurrentHashMap&amp;lt;&amp;gt;();
        for (File encodingDirs : testDocs.toFile().listFiles()) {
            for (File file : encodingDirs.listFiles()) {
                    String encoding = getEncoding(file.toPath());
                    paths.add(file.toPath());
                    encodings.put(file.toPath(), encoding);
            }
        }
        int numThreads = 1000;
        ExecutorService ex = Executors.newFixedThreadPool(numThreads);
        CompletionService&amp;lt;String&amp;gt; completionService =
                new ExecutorCompletionService&amp;lt;&amp;gt;(ex);

        for (int i = 0; i &amp;lt; numThreads; i++) {
            completionService.submit(new EncodingDetectorRunner(paths, encodings), &quot;done&quot;);
        }
        int completed = 0;
        while (completed &amp;lt; numThreads) {
            Future&amp;lt;String&amp;gt; future = completionService.take();
            if (future.isDone() &amp;amp;&amp;amp; &quot;done&quot;.equals(future.get())) {
                completed++;
            }
        }
        assertTrue(&quot;success!&quot;, true);
    }

    private class EncodingDetectorRunner implements Runnable {
        private final List&amp;lt;Path&amp;gt; paths;
        private final Map&amp;lt;Path, String&amp;gt; encodings;
        private final Random r = new Random();
        private EncodingDetectorRunner(List&amp;lt;Path&amp;gt; paths, Map&amp;lt;Path, String&amp;gt; encodings) {
            this.paths = paths;
            this.encodings = encodings;
        }

        @Override
        public void run() {
            for (int i = 0; i &amp;lt; 100; i++) {
                int pInd = r.nextInt(paths.size());

                String detectedEncoding = null;
                try {
                    detectedEncoding = getEncoding(paths.get(pInd));
                } catch (Exception e) {
                    throw new RuntimeException(e);
                }
                String trueEncoding = encodings.get(paths.get(pInd));
                if (! detectedEncoding.equals(trueEncoding)) {
                    throw new RuntimeException(&quot;detected: &quot; + detectedEncoding +
                            &quot; but should have been: &quot;+trueEncoding + &quot; for &quot; + paths.get(pInd));
                }
            }
        }
    }

    public String getEncoding(Path p) throws Exception {
        try (InputStream is = TikaInputStream.get(p)) {
            AutoDetectReader reader = new AutoDetectReader(is);
            String val = reader.getCharset().toString();
            if (val == null) {
                return &quot;NULL&quot;;
            } else {
                return val;
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;yields:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ava.util.concurrent.ExecutionException: java.lang.RuntimeException: detected: ISO-8859-1 but should have been: windows-1252 for C:\data\encodings\corpus\Shift_JIS\1

	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
	at org.apache.tika.parser.html.HtmlParserTest.testMultiThreadingEncodingDetection(HtmlParserTest.java:1213)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12992468">TIKA-2041</key>
            <summary>Charset detection doesn&apos;t appear to be thread-safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jul 2016 02:52:05 +0000</created>
                <updated>Mon, 12 Apr 2021 13:00:51 +0000</updated>
                            <resolved>Thu, 11 Aug 2016 20:05:00 +0000</resolved>
                                                    <fixVersion>1.14</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15393633" author="fnl" created="Tue, 26 Jul 2016 11:04:31 +0000"  >&lt;p&gt;Hi; I&apos;m one of the pals of Christian. If it might help, one possible origin I suspect of being (involved in) the cause of this bug is the private static class CharsetRecog_IBM420_ar in CharsetRecog_sbcs. It can edit the byte array being processed (search for a private method called &quot;unshape&quot;). That might be able to change the distribution of bytes that the CharsetDetector uses to predict the final outcome, if the order of the CharsetRecognizer static private classes being used somehow is not thread-safe. While I had no time to figure out a proof for this theory, I imagine that the unshape method, which mutates the CharsetDetector.fByteStats and CharsetDetector.fInputBytes values, could be related to the cause of this bug; Or at least that there is some similar code found in a CharsetRecognizer that mutates these array values.&lt;/p&gt;</comment>
                            <comment id="15393749" author="tallison@mitre.org" created="Tue, 26 Jul 2016 12:58:32 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt; on the user list:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;On the whole, I think Tika is following the POI model on thread-safety as a minimum. That is, two threads working on two different documents should always be fine. Two threads trying to work on the same document may not be&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="15393768" author="fnl" created="Tue, 26 Jul 2016 13:15:42 +0000"  >&lt;p&gt;@Tim: Regarding Nick&apos;s comment and just to clear up any ambiguity: Neither the code above or where we observed the bug are cases of multiple threads working on the same input stream/byte array. &lt;span class=&quot;error&quot;&gt;&amp;#91;EDITS: making this reply more clear.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15393809" author="tallison@mitre.org" created="Tue, 26 Jul 2016 13:47:11 +0000"  >&lt;p&gt;Sorry. I agree.  Had to run to a meeting before including the important part b above.   I&apos;m able to reproduce this issue with multiple threads processing each file only once.&lt;/p&gt;

&lt;p&gt;Has anyone done enough googling or used pure ICU4J to figure out if this is an issue known by/fixed by them in a more recent version?&lt;/p&gt;</comment>
                            <comment id="15393862" author="tallison@mitre.org" created="Tue, 26 Jul 2016 14:19:41 +0000"  >&lt;p&gt;Out of curiosity, what type of diffs are you seeing?  When I experiment with turning off loading of certain subsets of recognizers, the errors I&apos;m getting seem to be roughly equivalent windows vs. ISO character sets: windows-1255 vs. ISO-8859-8 or windows-1254 vs. ISO-8859-9.&lt;/p&gt;

&lt;p&gt;The problem there, I think, is that haveC1bytes is storing instance state, but the recognizers are being loaded statically (looks like they&apos;ve gotten rid of haveC1Bytes in &lt;a href=&quot;http://source.icu-project.org/repos/icu/icu4j/trunk/main/classes/core/src/com/ibm/icu/text/CharsetRecog_sbcs.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; and in 57-rc)&lt;/p&gt;

&lt;p&gt;Are you seeing differences beyond these win/ISO equivalences?&lt;/p&gt;</comment>
                            <comment id="15393909" author="fnl" created="Tue, 26 Jul 2016 14:57:46 +0000"  >&lt;p&gt;Nope, that is exactly the same problem I was seeing, and to my best knowledge there is no other case.&lt;/p&gt;

&lt;p&gt;In single-threaded mode haveC1bytes is always false; Therefore, my suspicion is  that something (unshape?) triggers an update of the various mutable state values in CharsetDetector, and by the time the CharsetDetector instance checks the result of the CharsetRecognizer, instead of returning the correct Latin encoding name, instead it returns the Windows variant, because haveC1Bytes has (wrongly) been changed and set to true. (BTW, this is doubly annoying because even for ASCII-only documents, Latin-1 is the default result, but instead leading to the &quot;windows-1252&quot; variant being detected.)&lt;/p&gt;</comment>
                            <comment id="15394007" author="tallison@mitre.org" created="Tue, 26 Jul 2016 16:06:33 +0000"  >&lt;p&gt;Thank you for the confirmation.  Unless my colleagues object, I&apos;ll re-copy/paste the classes that we use from ICU4J from the latest release (or trunk?).  That should fix this.&lt;/p&gt;</comment>
                            <comment id="15394074" author="fnl" created="Tue, 26 Jul 2016 16:53:59 +0000"  >&lt;p&gt;Sounds great; If it resolves the above unit-test, it should fix our problem, too. Thank you for looking into this! &lt;span class=&quot;error&quot;&gt;&amp;#91;EDIT: typo&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15394284" author="tallison@mitre.org" created="Tue, 26 Jul 2016 18:33:56 +0000"  >&lt;p&gt;Fixes this problem, indeed.  However...&lt;/p&gt;

&lt;p&gt;Looks like the newer version has dropped EBCDIC_500_*.  I&apos;ll add those back in?&lt;/p&gt;

&lt;p&gt;The newer version has decreased to 8000, the number of bytes read; formerly 12000.  This is causing one of our tests to fail.  Will increase bytes read to 12000.&lt;/p&gt;</comment>
                            <comment id="15394397" author="hudson" created="Tue, 26 Jul 2016 19:31:04 +0000"  >&lt;p&gt;FAILURE: Integrated in Tika-trunk #1086 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1086/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1086/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt;, step 1, upgrade icu4j components; add back ebcdic and bump (tallison: rev d698d49793bb96aee6a8bfcc4a174c922cb83cb8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_2022.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecognizer.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_UTF8.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_mbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_Unicode.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt; &amp;#8211; add unit test in HTMLParserTest (tallison: rev 7dc5c671f892bac79d8fb2d55e9e94718ca31cbe)&lt;/li&gt;
	&lt;li&gt;CHANGES.txt&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15394458" author="gagravarr" created="Tue, 26 Jul 2016 20:04:49 +0000"  >&lt;p&gt;We added the &lt;tt&gt;EBCDIC_500_&lt;/tt&gt; family of detectors into our own copy of the library. Tried but failed to get it accepted upstream &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We should keep it, but possibly also put in a note that it&apos;s Tika-custom to avoid confusion on any future upgrades!&lt;/p&gt;</comment>
                            <comment id="15394837" author="tallison@mitre.org" created="Wed, 27 Jul 2016 00:30:58 +0000"  >&lt;p&gt;Good to know.  Any other custom changes?  &lt;/p&gt;</comment>
                            <comment id="15394854" author="tallison@mitre.org" created="Wed, 27 Jul 2016 00:47:55 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=c.leitinger&quot; class=&quot;user-hover&quot; rel=&quot;c.leitinger&quot;&gt;c.leitinger&lt;/a&gt;,  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fnl&quot; class=&quot;user-hover&quot; rel=&quot;fnl&quot;&gt;fnl&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.aistleitner%40selerityinc.com&quot; class=&quot;user-hover&quot; rel=&quot;christian.aistleitner@selerityinc.com&quot;&gt;christian.aistleitner@selerityinc.com&lt;/a&gt; for finding this issue and helping us to find the cause.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=c.leitinger&quot; class=&quot;user-hover&quot; rel=&quot;c.leitinger&quot;&gt;c.leitinger&lt;/a&gt;, thank you for taking the first (very important!) step of contacting us about this issue.  Now you know how to reach us. Let us know what else you find. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15394897" author="hudson" created="Wed, 27 Jul 2016 01:16:23 +0000"  >&lt;p&gt;FAILURE: Integrated in tika-2.x-windows #29 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/29/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/29/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt;, upgrade ICU4j&apos;s charset detector to avoid multithreading bug. (tallison: rev 9f6c71fa69eaae558aff85cfa0dce72bca08fd4e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;CHANGES.txt&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecognizer.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_mbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_UTF8.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_Unicode.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/Icu4jEncodingDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_2022.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15394918" author="hudson" created="Wed, 27 Jul 2016 01:44:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-2.x #125 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/125/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/125/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt;, upgrade ICU4j&apos;s charset detector to avoid multithreading bug. (tallison: rev 9f6c71fa69eaae558aff85cfa0dce72bca08fd4e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-web-module/src/test/java/org/apache/tika/parser/html/HtmlParserTest.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecognizer.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_mbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/Icu4jEncodingDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_UTF8.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_Unicode.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_2022.java&lt;/li&gt;
	&lt;li&gt;CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15395176" author="c.leitinger" created="Wed, 27 Jul 2016 07:31:49 +0000"  >&lt;p&gt;Thanks for the fix!&lt;br/&gt;
That was super-quick.&lt;br/&gt;
You rock!&lt;/p&gt;</comment>
                            <comment id="15395282" author="gagravarr" created="Wed, 27 Jul 2016 09:06:50 +0000"  >&lt;p&gt;Running &quot;git log&quot; and &quot;git diff&quot; on the file suggests other custom bits are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;CharsetRecog_IBM866_ru&lt;/tt&gt; (9f5593e6990fddc3471e1b87fb1df2f00c5ed600)&lt;/li&gt;
	&lt;li&gt;comments in the class javadoc on how the recogniser works, and hints on adding new ones (aa944e848894e16adec24eeffe29e11b96ad29a8)&lt;/li&gt;
	&lt;li&gt;tweak for invalid character in the charset / ngram uncertainty (aa944e848894e16adec24eeffe29e11b96ad29a8)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ones we customised but now have their own &quot;proper&quot; fixes upstream look to be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;byte[] for each byte when detecting IBM420 charset (a157a6f025c4b5eda63881124919b4271f85ba0b)&lt;/li&gt;
	&lt;li&gt;typecasts (424c0ebd503900bdff481e059a3a326dc7add814)&lt;/li&gt;
	&lt;li&gt;for loops (79211cc7a400f3b0b066f0a6401dee1c2fa9c90e)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15395498" author="tallison@mitre.org" created="Wed, 27 Jul 2016 11:38:53 +0000"  >&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt; for pointing out some other Tika-custom bits.  I&apos;m reopening this until I have a chance to add those back.&lt;/p&gt;</comment>
                            <comment id="15417844" author="tallison@mitre.org" created="Thu, 11 Aug 2016 20:05:00 +0000"  >&lt;p&gt;I think I got all of these.  Thank you, again, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15417862" author="hudson" created="Thu, 11 Aug 2016 20:16:47 +0000"  >&lt;p&gt;FAILURE: Integrated in tika-2.x-windows #33 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/33/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/33/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt; - add important diffs between new copy/paste from ICU4J and (tallison: rev b41c0b2a88a314db594ca1f616ae4be71676bbcc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15417908" author="hudson" created="Thu, 11 Aug 2016 20:45:22 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-2.x #129 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/129/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/129/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt; - add important diffs between new copy/paste from ICU4J and (tallison: rev b41c0b2a88a314db594ca1f616ae4be71676bbcc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parser-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15417910" author="hudson" created="Thu, 11 Aug 2016 20:46:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in Tika-trunk #1090 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1090/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1090/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2041&quot; title=&quot;Charset detection doesn&amp;#39;t appear to be thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2041&quot;&gt;&lt;del&gt;TIKA-2041&lt;/del&gt;&lt;/a&gt; - add important diffs between new copy/paste from ICU4J and (tallison: rev bd9a9b911b4e0205c9dfd4527063e6e1c0fd0c44)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetDetector.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetRecog_sbcs.java&lt;/li&gt;
	&lt;li&gt;tika-parsers/src/main/java/org/apache/tika/parser/txt/CharsetMatch.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31hq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>