<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:03:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3582] Tika does not respect a configuration value passed over a HTTP Header</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3582</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;&#160;&lt;br/&gt;
I think the value of&#160;TikaServerConfig.TaskTimeoutMillis should be overridden for the current request over &lt;b&gt;X-Tika-OCRTimeoutSeconds&lt;/b&gt;&#160;header. The following request takes more than 120 seconds.&lt;br/&gt;
&lt;b&gt;curl -vvv -X PUT -T sampleimage.png &lt;a href=&quot;http://localhost:9998/tika&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:9998/tika&lt;/a&gt; --header &quot;X-Tika-OCRTimeoutSeconds: 600&quot;&lt;/b&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
Tesserect is configured with tessdata_best models&lt;/p&gt;</description>
                <environment></environment>
        <key id="13408428">TIKA-3582</key>
            <summary>Tika does not respect a configuration value passed over a HTTP Header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="dataminer.accolade">dataminer.accolade</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Oct 2021 11:33:57 +0000</created>
                <updated>Thu, 16 Dec 2021 22:29:57 +0000</updated>
                            <resolved>Wed, 27 Oct 2021 14:22:44 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17434404" author="tallison@mitre.org" created="Tue, 26 Oct 2021 14:45:31 +0000"  >&lt;p&gt;To confirm that I understand this correctly...  when you set a parser specific timeout to be longer than the default timeout, that specific parse task timeout should override the default timeout for that specific task.&lt;/p&gt;</comment>
                            <comment id="17434410" author="tallison@mitre.org" created="Tue, 26 Oct 2021 14:56:52 +0000"  >&lt;p&gt;I think a better way to fix this is to allow per parse timeout requests to override the default.  We&apos;ll have to figure out how to propagate this to AbstractExternalProcessParser(s).  Obv, we won&apos;t create any breaking changes, but we&apos;ll deprecate that specific setting for tesseract.&lt;/p&gt;

&lt;p&gt;One challenge is that the forked server has to crash and restart to guarantee a timeout for regular parsers, whereas for tesseract and other external process parsers, it can stop the forked process reliably. &lt;/p&gt;</comment>
                            <comment id="17434412" author="tallison@mitre.org" created="Tue, 26 Oct 2021 14:59:23 +0000"  >&lt;p&gt;For pipes, perhaps we add a timeout to the FetchEmitTuple.  We should open another issue for that.&lt;/p&gt;</comment>
                            <comment id="17434484" author="tallison@mitre.org" created="Tue, 26 Oct 2021 17:36:52 +0000"  >&lt;p&gt;I added an override in the tesseract parser for timeouts per parse.  Eventually, we can get around to deprecating the current methods.&lt;/p&gt;

&lt;p&gt;Users can now add &lt;tt&gt;X-Tika-Timeout-Millis&lt;/tt&gt; via the headers for /rmeta and /tika.  This value cannot be greater than &lt;tt&gt;taskTimeoutMillis&lt;/tt&gt; as configured for tika-server.  The reason I made this choice was out of concern for security.  There may be some circumstances where folks hosting the server would not want clients to set whatever they felt was a reasonable timeout.&lt;/p&gt;

&lt;p&gt;So, for now, the server should have the largest &lt;tt&gt;taskTimeoutMillis&lt;/tt&gt; desired, but the clients should specify a smaller limit.&lt;/p&gt;

&lt;p&gt;I&apos;m not held to this decision.  Please reopen if this doesn&apos;t make sense.  &lt;/p&gt;</comment>
                            <comment id="17434488" author="tallison@mitre.org" created="Tue, 26 Oct 2021 17:40:41 +0000"  >&lt;p&gt;The other security concern is that clients can now specify a very short timeout and force the server to restart pretty much at will, causing DoS.&lt;/p&gt;

&lt;p&gt;We could move this feature to require &quot;enableUnsecure&quot;?  Or we could document &quot;you are on your own if you are hosting a Tika server and you&apos;re opening it to requests to clients you don&apos;t trust.&quot;&lt;/p&gt;

&lt;p&gt;Let me know what you think.&lt;/p&gt;</comment>
                            <comment id="17434489" author="tallison@mitre.org" created="Tue, 26 Oct 2021 17:41:24 +0000"  >&lt;p&gt;Reopening until we come to agreement with the potential DoS either excessively long processing or very short processing that can trigger server restarts.&lt;/p&gt;</comment>
                            <comment id="17434493" author="gagravarr" created="Tue, 26 Oct 2021 17:47:03 +0000"  >&lt;p&gt;Bit fiddly, but how about a config option on the server for the minimum (with a sensible default), and the header never lets you go below that minimum?&lt;/p&gt;</comment>
                            <comment id="17434510" author="hudson" created="Tue, 26 Oct 2021 18:34:24 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #347 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/347/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/347/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3582&quot; title=&quot;Tika does not respect a configuration value passed over a HTTP Header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3582&quot;&gt;&lt;del&gt;TIKA-3582&lt;/del&gt;&lt;/a&gt; &amp;#8211; add parse timeouts per task in /rmeta and /tika. This timeout cannot be greater than taskTimeoutMillis. (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/452aa916b5eee1fea176211e6b5711e06412a50f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/452aa916b5eee1fea176211e6b5711e06412a50f&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/DetectorResource.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/ServerStatusWatcher.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/parser/external2/ExternalParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-ocr-module/src/test/java/org/apache/tika/parser/ocr/TesseractOCRParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/resources/META-INF/services/org.apache.tika.server.core.ParseContextConfig&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/java/org/apache/tika/server/core/TranslateResourceTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/java/org/apache/tika/server/core/ServerStatusTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/java/org/apache/tika/server/core/TikaServerIntegrationTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/TikaTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-ocr-module/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/TikaServerProcess.java&lt;/li&gt;
	&lt;li&gt;(add) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/config/TimeoutConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TranslateResource.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/ServerStatus.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-ocr-module/src/test/resources/test-configs/&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3582&quot; title=&quot;Tika does not respect a configuration value passed over a HTTP Header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3582&quot;&gt;&lt;del&gt;TIKA-3582&lt;/del&gt;&lt;/a&gt;-tesseract.xml&lt;/li&gt;
	&lt;li&gt;(add) tika-core/src/main/java/org/apache/tika/config/TikaTaskTimeout.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/TaskStatus.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17434527" author="tallison@mitre.org" created="Tue, 26 Oct 2021 18:54:43 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[INFO] Loading classes to check...
[INFO] Scanning classes for violations...
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGBUS (0x7) at pc=0x00007f0fb6e06462, pid=31300, tid=0x00007f0f6239f700
#
# JRE version: OpenJDK Runtime Environment (8.0_275-b01) (build 1.8.0_275-b01)
# Java VM: OpenJDK 64-Bit Server VM (25.275-b01 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# C  [libc.so.6+0xbb462]
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try &quot;ulimit -c unlimited&quot; before starting Java again
#
# An error report file with more information is saved as:
# /home/jenkins/workspace/Tika/tika-main-jdk8/hs_err_pid31300.log
#
# If you would like to submit a bug report, please visit:
#   https://github.com/AdoptOpenJDK/openjdk-support/issues
# The crash happened outside the Java Virtual Machine in native code.
# See problematic frame for where to report the bug.
#
ERROR: Maven JVM terminated unexpectedly with exit code 134
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17434539" author="dataminer.accolade" created="Tue, 26 Oct 2021 19:30:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; that&apos;s what i meant &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;when you set a parser specific timeout to be longer than the default timeout, that specific parse task timeout should override the default timeout for that specific task&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17434881" author="tallison@mitre.org" created="Wed, 27 Oct 2021 14:22:38 +0000"  >&lt;p&gt;I implemented &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nick&quot; class=&quot;user-hover&quot; rel=&quot;nick&quot;&gt;nick&lt;/a&gt;&apos;s recommendation.  Headers cannot override the minimum and maximum set via the server-config.  Let me know if this doesn&apos;t work for you.&lt;/p&gt;</comment>
                            <comment id="17434948" author="hudson" created="Wed, 27 Oct 2021 16:17:27 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #350 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/350/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/350/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3582&quot; title=&quot;Tika does not respect a configuration value passed over a HTTP Header&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3582&quot;&gt;&lt;del&gt;TIKA-3582&lt;/del&gt;&lt;/a&gt; &amp;#8211; set a hard limit for the minimum parse time that a client can request to make DoS a trifle more challenging (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/bb2c282b1733b07d026f1baddb998d2dd3255459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/bb2c282b1733b07d026f1baddb998d2dd3255459&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/TikaResource.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/resources/configs/tika-config-server-basic.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/java/org/apache/tika/server/core/IntegrationTestBase.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/java/org/apache/tika/server/core/TikaServerIntegrationTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/resources/tika-server-config-default.xml&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/main/java/org/apache/tika/server/core/TikaServerConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-server/tika-server-core/src/test/resources/configs/tika-config-server.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13035363" name="sampleimage.png" size="6756477" author="dataminer.accolade" created="Tue, 26 Oct 2021 11:14:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w5yo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>