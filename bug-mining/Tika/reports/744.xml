<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:59:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-1791] URI is not hierarchical exception when location model resource is inside a jar in classpath</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1791</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Stacktrace&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The following error happens when location NER model resource is packaged inside a jar and GeoTopicParser is enabled.

Caused by: java.lang.IllegalArgumentException: URI is not hierarchical
	at java.io.File.&amp;lt;init&amp;gt;(File.java:418)
	at org.apache.tika.parser.geo.topic.GeoParserConfig.&amp;lt;init&amp;gt;(GeoParserConfig.java:33)
	at org.apache.tika.parser.geo.topic.GeoParser.&amp;lt;init&amp;gt;(GeoParser.java:54)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:422)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.newInstance(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:442)
	at org.apache.tika.config.TikaConfig$XmlLoader.loadOne(TikaConfig.java:559)
	at org.apache.tika.config.TikaConfig$XmlLoader.loadOverall(TikaConfig.java:492)
	at org.apache.tika.config.TikaConfig.&amp;lt;init&amp;gt;(TikaConfig.java:166)
	at org.apache.tika.config.TikaConfig.&amp;lt;init&amp;gt;(TikaConfig.java:149)
	at org.apache.tika.config.TikaConfig.&amp;lt;init&amp;gt;(TikaConfig.java:142)
	at org.apache.tika.config.TikaConfig.&amp;lt;init&amp;gt;(TikaConfig.java:138)
	at edu.usc.cs.ir.cwork.tika.Parser.&amp;lt;init&amp;gt;(Parser.java:45)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Refernces :&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/18055189/why-my-uri-is-not-hierarchical&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/18055189/why-my-uri-is-not-hierarchical&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;location model  file is placed inside a fat Jar (with all the dependencies)&lt;/p&gt;</environment>
        <key id="12911724">TIKA-1791</key>
            <summary>URI is not hierarchical exception when location model resource is inside a jar in classpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thammegowda">Thamme Gowda</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Nov 2015 00:32:32 +0000</created>
                <updated>Mon, 16 Nov 2015 00:59:07 +0000</updated>
                            <resolved>Sun, 15 Nov 2015 20:04:58 +0000</resolved>
                                    <version>1.11</version>
                                    <fixVersion>1.12</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14997841" author="githubbot" created="Tue, 10 Nov 2015 01:55:14 +0000"  >&lt;p&gt;GitHub user thammegowda opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/63&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1791&quot; title=&quot;URI is not hierarchical exception when location model resource is inside a jar in classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1791&quot;&gt;&lt;del&gt;TIKA-1791&lt;/del&gt;&lt;/a&gt; fix : non hierarchical URI exception when NER model is inside jar file&lt;/p&gt;

&lt;p&gt;    Improvement : Model is loaded once and NameFinder is reused &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/thammegowda/tika&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thammegowda/tika&lt;/a&gt; fix-1791&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/63.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/63.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #63&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4c02c9e94adfde2163a2e2b4fac9425e5485a583&lt;br/&gt;
Author: Thamme Gowda &amp;lt;tgowdan@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-10T01:39:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1791&quot; title=&quot;URI is not hierarchical exception when location model resource is inside a jar in classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1791&quot;&gt;&lt;del&gt;TIKA-1791&lt;/del&gt;&lt;/a&gt; fix : non hierarchical URI for NER model&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14997843" author="thammegowda" created="Tue, 10 Nov 2015 01:56:19 +0000"  >&lt;p&gt;Resolved and pull request is created on GitHub :  &lt;a href=&quot;https://github.com/apache/tika/pull/63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/63&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14998814" author="gagravarr" created="Tue, 10 Nov 2015 16:02:43 +0000"  >&lt;p&gt;There seems to be quite a few changes in the patch, not just a simple String to URL swap. Would you be able to explain a bit more about why you needed to make the additional changes you did, and why you took the approach you did to refactor things for the change?&lt;/p&gt;

&lt;p&gt;I&apos;m also a little worried about the &lt;tt&gt;geoparser.initialize(context);&lt;/tt&gt; lines in the test - does that mean the parser stops working for people who don&apos;t add this additional step? If so, it&apos;s a no-go as most people will probably be using it via one of the facades like &lt;tt&gt;AutoDetectParser&lt;/tt&gt; or &lt;tt&gt;DefaultParser&lt;/tt&gt; so won&apos;t know to do things like that. &lt;/p&gt;</comment>
                            <comment id="14999085" author="thammegowda" created="Tue, 10 Nov 2015 18:40:02 +0000"  >&lt;p&gt;Thanks for the feedback. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The fix for non-hierarchical URI is done by using URL instead of URI and path string. (Learned that we can have a URL to files inside ZIP archive, but not URI)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;While I modified NER model loading code to make above change possible, I also happened to make these changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The NER model was previously reloaded for every `parse()` call. It now reuses the model by making use of a state variable.&lt;/li&gt;
	&lt;li&gt;The `isAvailable()` function was previously trying to launch an external process for every call to figureout availability of &apos;lucene-geo-gazeteer&apos; command (it is invoked in `parse()`). This has been changed to use a state variable.&lt;/li&gt;
	&lt;li&gt;The model is loaded on first call to `parse()` or `isAviable()` : via lazy intialization. My tests showed that it is backward compatible.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;UPDATE : &lt;br/&gt;
Test case is now unaltered.  I was just trying to see if the test cases are passing different parse context. The lazy intialization of name extractor is gauranteed to work and thus shouldnt be breaking the existing usages. The &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; GeoParserConfig.setNERModelPath(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is also preserved for the users who are already using it to supply model path. However, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;GeoParserConfig.getNERPath() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is swapped with URL getter.&lt;/p&gt;</comment>
                            <comment id="15000462" author="gagravarr" created="Wed, 11 Nov 2015 14:55:20 +0000"  >&lt;p&gt;Thanks for the explanation&lt;/p&gt;

&lt;p&gt;Next question - what happens if two calls to &lt;tt&gt;GeoParser&lt;/tt&gt; use different NER paths? eg&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                GeoParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GeoParser();

 		ParseContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParseContext();
 		GeoParserConfig config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GeoParserConfig();
 		context.set(GeoParserConfig.class, config);

                config.setNERModelPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin&quot;&lt;/span&gt;);
                parser.parse(inputA, metadata, handler, context);

                config.setNERModelPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/bin&quot;&lt;/span&gt;);
                parser.parse(inputB, metadata, handler, context);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same parser each time, but different paths on the config. At first glance, it looks like your code would cause parsing 2 to use the config from parsing 1?&lt;/p&gt;</comment>
                            <comment id="15000975" author="thammegowda" created="Wed, 11 Nov 2015 19:53:16 +0000"  >&lt;p&gt;Thanks for pointing out the issue.&lt;br/&gt;
I didn&apos;t anticipate changes to configurations after the parser started to run. &lt;/p&gt;

&lt;p&gt;It&apos;s now handled in `intialize()`:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.modelUrl != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.modelUrl.equals(modelUrl)) {
	&lt;span class=&quot;code-comment&quot;&gt;//previously initialized &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the same URL
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the Tika&apos;s environments are so dynamic (like files pointed by URLs are frequently updated/deleted), then probably states shouldn&apos;t be used. However, as you can see it&apos;s a tradeoff to performance. If this is the case, I can revert back to the older way.&lt;/p&gt;
</comment>
                            <comment id="15005618" author="gagravarr" created="Sat, 14 Nov 2015 21:06:55 +0000"  >&lt;p&gt;Longer term, we want to move instance-specific config out of Parser Context objects, and onto constructors etc (including Config XML support).&lt;/p&gt;

&lt;p&gt;The contract for the Parser objects is that they&apos;re used to do document-specific changes/configuration. While there are cases, like this, where they also get (ab)used for instance config (eg normally static paths), while they&apos;re on the Parser Context, we need to handle the cases of them changing&lt;/p&gt;</comment>
                            <comment id="15005623" author="chrismattmann" created="Sat, 14 Nov 2015 21:16:46 +0000"  >&lt;p&gt;Config XML in my mind is just one option for loading or setting properties - the ParseContext is supposed to be a more dynamic way of setting properties on a per parse invocation process. The problem with moving static paths into constructors is that we have too many places in Tika (starting with ServiceLoading as the most glaring) that expect zero arg constructors so we can&apos;t simply move these types of properties into the constructors until we figure out something better later.&lt;/p&gt;</comment>
                            <comment id="15006009" author="githubbot" created="Sun, 15 Nov 2015 19:53:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/63&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15006013" author="gagravarr" created="Sun, 15 Nov 2015 20:04:58 +0000"  >&lt;p&gt;Thanks, applied in r1714492 (with a few other little tweaks up to r1714496)&lt;/p&gt;</comment>
                            <comment id="15006024" author="hudson" created="Sun, 15 Nov 2015 20:47:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #885 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/885/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/885/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1791&quot; title=&quot;URI is not hierarchical exception when location model resource is inside a jar in classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1791&quot;&gt;&lt;del&gt;TIKA-1791&lt;/del&gt;&lt;/a&gt; Comments and logging (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1714494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1714494&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/java/org/apache/tika/parser/geo/topic/GeoParser.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1791&quot; title=&quot;URI is not hierarchical exception when location model resource is inside a jar in classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1791&quot;&gt;&lt;del&gt;TIKA-1791&lt;/del&gt;&lt;/a&gt; GeoParser fix for models in a jar file, from Thamme Gowda N. This closes #63 from GitHub (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1714492&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1714492&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/java/org/apache/tika/parser/geo/topic/GeoParser.java&lt;/li&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/java/org/apache/tika/parser/geo/topic/GeoParserConfig.java&lt;/li&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/java/org/apache/tika/parser/geo/topic/NameEntityExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15006116" author="chrismattmann" created="Mon, 16 Nov 2015 00:59:07 +0000"  >&lt;p&gt;thanks for committing this Nick burch and for the work Thamme!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o66n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>