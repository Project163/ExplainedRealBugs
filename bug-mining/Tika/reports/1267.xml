<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:03:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3639] NullPointerException  throws when parsing zip file</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3639</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Always throws a NullPointerException when detect zip file, it can be reproduced through the following steps.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a zip file with a index.xml&#65292; the xml is simple
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.0&apos;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&apos;UTF-8&apos;&lt;/span&gt; ?&amp;gt;
&amp;lt;index&amp;gt;
&amp;lt;/index&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;add dependency to pom.xml&#65292; the &lt;b&gt;Key&lt;/b&gt; &#160;dependency ** is &lt;b&gt;tika-parser-apple-module&lt;/b&gt;&#160;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;dependencies&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;dependency&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;groupId&amp;gt;org.apache.tika&amp;lt;/groupId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;artifactId&amp;gt;tika-core&amp;lt;/artifactId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;version&amp;gt;2.2.1&amp;lt;/version&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;/dependency&amp;gt;&#160; &#160; &#160; &#160; 
            &amp;lt;dependency&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;groupId&amp;gt;org.apache.tika&amp;lt;/groupId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;artifactId&amp;gt;tika-parsers&amp;lt;/artifactId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;type&amp;gt;pom&amp;lt;/type&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;version&amp;gt;2.2.1&amp;lt;/version&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;/dependency&amp;gt;&#160; &#160; &#160; &#160; 
            &amp;lt;dependency&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;groupId&amp;gt;org.apache.tika&amp;lt;/groupId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;artifactId&amp;gt;tika-parser-apple-module&amp;lt;/artifactId&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;version&amp;gt;2.2.1&amp;lt;/version&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;/dependency&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;using tika.detect to parse zip file&#65292; it will throws a NPE
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filePath = &lt;span class=&quot;code-quote&quot;&gt;&quot;123.zip&quot;&lt;/span&gt;;
Tika tika = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tika(); 
type = tika.detect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(filePath)));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;Notice that when using tika.detect(String name), it&#8216;s normal and return &quot;application/zip&quot;,&#160; the NPE situation only occur&#160; when using tika.detect(InputStream stream)&#12290;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It seems when tika parse a zip file through &lt;b&gt;IWorkPackageParser&lt;/b&gt;,&#160; tika will parsing index.xml, it will parse &apos;.Number&apos;, &apos;.key&apos;, &apos;.pages&apos;, &apos;encrypted&apos; file using below class in xml, when Number, key, pages are all empty, the encrypted&apos;s namespace is null, then in the for-loop it will throws a NPE.&lt;/p&gt;

&lt;p&gt;the source code below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KEYNOTE(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//developer.apple.com/namespaces/keynote2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;presentation&quot;&lt;/span&gt;,
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MediaType.application(&lt;span class=&quot;code-quote&quot;&gt;&quot;vnd.apple.keynote&quot;&lt;/span&gt;)),
NUMBERS(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//developer.apple.com/namespaces/ls&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;document&quot;&lt;/span&gt;,
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MediaType.application(&lt;span class=&quot;code-quote&quot;&gt;&quot;vnd.apple.numbers&quot;&lt;/span&gt;)),
PAGES(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//developer.apple.com/namespaces/sl&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;document&quot;&lt;/span&gt;,
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MediaType.application(&lt;span class=&quot;code-quote&quot;&gt;&quot;vnd.apple.pages&quot;&lt;/span&gt;)),
ENCRYPTED(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, MediaType.application(&lt;span class=&quot;code-quote&quot;&gt;&quot;x-tika-iworks-&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt;&quot;&lt;/span&gt;)); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; IWORKDocumentType detectType(InputStream stream) { &#160;
 &#160; QName qname = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlRootExtractor().extractRootElement(stream); &#160; &#160; &#160;
 &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (qname != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &#160; &#160; &#160; &#160; &#160; &#160; &#160;  
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = qname.getNamespaceURI(); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; local = qname.getLocalPart();&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;      
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (IWORKDocumentType type : values()) { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type.getNamespace().equals(uri) &amp;amp;&amp;amp; type.getPart().equals(local)) { &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
    } &#160; &#160; &#160; &#160; &#160; &#160;  
 &#160; } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13420732">TIKA-3639</key>
            <summary>NullPointerException  throws when parsing zip file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison">Tim Allison</assignee>
                                    <reporter username="Hermes_Lee">Kaka Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2022 07:03:10 +0000</created>
                <updated>Mon, 7 Feb 2022 16:21:26 +0000</updated>
                            <resolved>Mon, 10 Jan 2022 12:09:50 +0000</resolved>
                                    <version>2.2.0</version>
                    <version>2.2.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17471937" author="tallison@mitre.org" created="Mon, 10 Jan 2022 12:09:15 +0000"  >&lt;p&gt;Thank you for opening this and submitting a triggering file. This is a bug that is now fixed in 2.2.2-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This happens when you use the iworks detector by itself (e.g. if you are only using the tika-parser-apple-module).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In Tika 2.x, instead of importing tika-parsers as you did in Tika 1.x, if you want to import &quot;most of the basic parsers&quot;, you should import tika-parsers-standard-package (and maybe tika-parsers-sqlite3-module).&#160; See &lt;a href=&quot;https://cwiki.apache.org/confluence/display/TIKA/Migrating+to+Tika+2.0.0.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/TIKA/Migrating+to+Tika+2.0.0.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you, again, and please let us know if you have any questions.&lt;/p&gt;</comment>
                            <comment id="17471942" author="tallison@mitre.org" created="Mon, 10 Jan 2022 12:11:16 +0000"  >&lt;p&gt;I&apos;m downgrading the severity of this&#160; to minor because this does not affect tika-app or tika-server, and I don&apos;t think most users would use only the tika-parser-apple-module.&#160; If you disagree, please increase the severity.&#160;&lt;/p&gt;</comment>
                            <comment id="17472038" author="hudson" created="Mon, 10 Jan 2022 14:05:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #411 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/411/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/411/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3639&quot; title=&quot;NullPointerException  throws when parsing zip file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3639&quot;&gt;&lt;del&gt;TIKA-3639&lt;/del&gt;&lt;/a&gt; &amp;#8211; avoid NPE in iworks detection (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/78b70df7b04a796769a339f897cb9e274b881523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/78b70df7b04a796769a339f897cb9e274b881523&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-apple-module/src/test/resources/test-documents/testIWorksNPEDetector.zip&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-apple-module/src/test/java/org/apache/tika/parser/iwork/IWorkParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-apple-module/src/main/java/org/apache/tika/parser/iwork/IWorkPackageParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17473251" author="hermes_lee" created="Wed, 12 Jan 2022 02:46:39 +0000"  >&lt;p&gt;Thank you for fixing this bug&#65292; I&#8216;m glad to contribute to tika project~&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13038265" name="123.zip" size="204" author="Hermes_Lee" created="Wed, 5 Jan 2022 07:02:33 +0000"/>
                            <attachment id="13038266" name="IWORKDocumentType.png" size="53689" author="Hermes_Lee" created="Wed, 5 Jan 2022 07:02:01 +0000"/>
                            <attachment id="13038267" name="detectype.png" size="37809" author="Hermes_Lee" created="Wed, 5 Jan 2022 07:02:01 +0000"/>
                            <attachment id="13038268" name="exception.png" size="49899" author="Hermes_Lee" created="Wed, 5 Jan 2022 06:29:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0y96g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>