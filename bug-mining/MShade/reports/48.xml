<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:19:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MSHADE-104] Cannot shade aspectj library</title>
                <link>https://issues.apache.org/jira/browse/MSHADE-104</link>
                <project id="12317921" key="MSHADE">Maven Shade Plugin (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;SimpleRelocator.java performs path matching in canRelocatePath() using String.startsWith() which treats the relocation path as a non-regex but then performs path substitution in relocatePath() using String.replaceFirst() which treats the relocation path as a regex.&lt;/p&gt;

&lt;p&gt;The reason I care about this difference is that I&apos;m trying to shade the AspectJ library, and one of its classes (org.aspectj.weaver.bcel.BcelShadow) uses the string literal&lt;br/&gt;
&quot;(I)Lorg/aspectj/lang/ProceedingJoinPoint;&quot; which understandably doesn&apos;t get shaded by a normal relocation pattern, e.g.&lt;/p&gt;

&lt;p&gt;  &amp;lt;relocation&amp;gt;&lt;br/&gt;
    &amp;lt;pattern&amp;gt;org.aspectj&amp;lt;/pattern&amp;gt;&lt;br/&gt;
    &amp;lt;shadedPattern&amp;gt;hidden.aspectj&amp;lt;/shadedPattern&amp;gt;&lt;br/&gt;
  &amp;lt;/relocation&amp;gt;&lt;/p&gt;

&lt;p&gt;So I would like to hard-code an additional relocation pattern to handle this, e.g.&lt;/p&gt;

&lt;p&gt;  &amp;lt;relocation&amp;gt;&lt;br/&gt;
    &amp;lt;pattern&amp;gt;(I)Lorg/aspectj/lang/ProceedingJoinPoint;&amp;lt;/pattern&amp;gt;&lt;br/&gt;
    &amp;lt;shadedPattern&amp;gt;(I)Lhidden/aspectj/lang/ProceedingJoinPoint;&amp;lt;/shadedPattern&amp;gt;&lt;br/&gt;
  &amp;lt;/relocation&amp;gt;&lt;/p&gt;

&lt;p&gt;This almost works, but not quite because the parentheses get treated as a non-regex string in canRelocatePath() but then as a regex string in relocatePath().  I can escape the parentheses to make relocatePath() match, but then of course the escaping makes canRelocatePath() return false and then it never gets to relocatePath().&lt;/p&gt;

&lt;p&gt;I hope you will consider the attached patch which uses org.codehaus.plexus.util.StringUtils.replaceOnce() to perform a non-regex substitution instead of String.replaceFirst().  I don&apos;t think this will cause regression issues since the prior match in canRelocatePath() already performs a non-regex match.  I have attached a simple unit test as well (as a patch to the existing SimpleRelocatorTest.java).&lt;/p&gt;

&lt;p&gt;In case you&apos;re interested, here is a link to the &quot;problem&quot; AspectJ class:&lt;br/&gt;
&lt;a href=&quot;http://dev.eclipse.org/viewcvs/viewvc.cgi/org.aspectj/modules/weaver/src/org/aspectj/weaver/bcel/BcelShadow.java?view=markup&amp;amp;root=Tools_Project&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.eclipse.org/viewcvs/viewvc.cgi/org.aspectj/modules/weaver/src/org/aspectj/weaver/bcel/BcelShadow.java?view=markup&amp;amp;root=Tools_Project&lt;/a&gt;&lt;br/&gt;
(see text &quot;(I)Lorg/aspectj/lang/ProceedingJoinPoint;&quot; on line 2924)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12808111">MSHADE-104</key>
            <summary>Cannot shade aspectj library</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bmargulies">Benson Margulies</assignee>
                                    <reporter username="traskstalnaker">Trask Stalnaker</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Aug 2011 00:29:35 +0000</created>
                <updated>Sat, 14 Jun 2025 18:12:29 +0000</updated>
                            <resolved>Sun, 20 Nov 2011 16:18:08 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14449229" author="traskstalnaker" created="Mon, 22 Aug 2011 00:36:02 +0000"  >&lt;p&gt;Oops, updated patch file for the unit test attached.&lt;/p&gt;</comment>
                            <comment id="14449249" author="traskstalnaker" created="Sun, 20 Nov 2011 03:27:18 +0000"  >&lt;p&gt;Modified patch implementation, added &amp;lt;rawString&amp;gt; property for the relocation element to hopefully make this type of usage clearer and to remove concerns about it affecting any existing users of the shade plugin.  Also, the previous patch was still not able to relocate the raw string &quot;META-INF/aop.xml&quot;.  The new implementation is more flexible and can handle any text/regex.  Attached patch with unit tests (&lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-104&quot; title=&quot;Cannot shade aspectj library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-104&quot;&gt;&lt;del&gt;MSHADE-104&lt;/del&gt;&lt;/a&gt;-v3.patch).  Also attached example usage for shading AspectJ (shaded-aspectjweaver-pom.xml).  Thanks.&lt;/p&gt;</comment>
                            <comment id="14448975" author="bmargulies" created="Sun, 20 Nov 2011 14:58:33 +0000"  >&lt;p&gt;Could you please add some comments to PackageRelocation to explain the reason for a boolean that is always false? Or reconsider and just pass false (with a comment) in ShadeMojo?&lt;/p&gt;</comment>
                            <comment id="14449242" author="traskstalnaker" created="Sun, 20 Nov 2011 15:38:02 +0000"  >&lt;p&gt;The &amp;lt;relocations&amp;gt; configuration property (&lt;a href=&quot;http://maven.apache.org/plugins/maven-shade-plugin/shade-mojo.html#relocations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/plugins/maven-shade-plugin/shade-mojo.html#relocations&lt;/a&gt;) gets mapped to the PackageRelocation class, so even though the field is private, it gets set (magically) via the (proposed) &amp;lt;rawString&amp;gt; configuration property, e.g.&lt;/p&gt;

&lt;p&gt;&amp;lt;configuration&amp;gt;&lt;br/&gt;
  &amp;lt;relocations&amp;gt;&lt;br/&gt;
    &amp;lt;relocation&amp;gt;&lt;br/&gt;
      &amp;lt;rawString&amp;gt;true&amp;lt;/rawString&amp;gt;&lt;br/&gt;
      &amp;lt;pattern&amp;gt;Lorg/aspectj/&amp;lt;/pattern&amp;gt;&lt;br/&gt;
      &amp;lt;shadedPattern&amp;gt;Lorg/example/shaded/aspectj/&amp;lt;/shadedPattern&amp;gt;&lt;br/&gt;
    &amp;lt;/relocation&amp;gt;&lt;br/&gt;
  &amp;lt;/relocations&amp;gt;&lt;br/&gt;
&amp;lt;/configuration&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14448994" author="bmargulies" created="Sun, 20 Nov 2011 16:17:50 +0000"  >&lt;p&gt;committed in 1204282. Thanks, Trask.&lt;/p&gt;</comment>
                            <comment id="14449240" author="traskstalnaker" created="Sun, 20 Nov 2011 16:55:41 +0000"  >&lt;p&gt;Thanks very much for reviewing and committing.&lt;/p&gt;</comment>
                            <comment id="17448952" author="yx91490" created="Thu, 25 Nov 2021 06:07:25 +0000"  >&lt;p&gt;How about add some explanation about &amp;lt;rawString&amp;gt; to official site?&lt;/p&gt;</comment>
                            <comment id="17976216" author="JIRAUSER302100" created="Sat, 14 Jun 2025 18:12:29 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/issues/465&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-shade-plugin#465&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12718942" name="MSHADE-104-v3.patch" size="6468" author="" created="Sun, 20 Nov 2011 03:27:18 +0000"/>
                            <attachment id="12719021" name="SimpleRelocator.patch" size="791" author="" created="Mon, 22 Aug 2011 00:29:36 +0000"/>
                            <attachment id="12718994" name="SimpleRelocatorTest-2.patch" size="1174" author="" created="Mon, 22 Aug 2011 00:36:02 +0000"/>
                            <attachment id="12718919" name="SimpleRelocatorTest.patch" size="1172" author="" created="Mon, 22 Aug 2011 00:29:36 +0000"/>
                            <attachment id="12719004" name="shaded-aspectjweaver-pom.xml" size="4340" author="" created="Sun, 20 Nov 2011 03:27:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2b1w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>