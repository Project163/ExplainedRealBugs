<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:20:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MSHADE-467] Dependency-reduced POM with missing exclusions in concurrent build</title>
                <link>https://issues.apache.org/jira/browse/MSHADE-467</link>
                <project id="12317921" key="MSHADE">Maven Shade Plugin (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;As discussed in &lt;a href=&quot;https://lists.apache.org/thread/ljdbh9h0lqs1qsf9o8bnm35mtr85y4vr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this maven-users thread&lt;/a&gt;, when running Maven builds for &lt;a href=&quot;https://github.com/stl543/shadeMT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this reproducer&lt;/a&gt; concurrently, some dependency exclusions are missing from the generated dependency-reduced POMs. Run the reproducer like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;
$ mvn clean package -T 4 | grep &apos;BUILD SUCCESS&apos; &amp;amp;&amp;amp; find . -name &quot;dependency-reduced-pom.xml&quot; -exec bash -c &apos;cat $0 | grep exclu | wc -l &apos; {} \;
[INFO] BUILD SUCCESS
12
12
12
12
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When running with &lt;tt&gt;-T 1&lt;/tt&gt;, however, the correct result is 20.&lt;/p&gt;

&lt;p&gt;This concurrency issue might have been introduced by the &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-413&quot; title=&quot;Maven shade plugin enters endless loop &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-413&quot;&gt;&lt;del&gt;MSHADE-413&lt;/del&gt;&lt;/a&gt; fix, but I am not sure.&lt;/p&gt;

&lt;p&gt;I have a local fix, synchronising on the injected mojo parameter &lt;tt&gt;MavenSession session&lt;/tt&gt;  in the lower section of &lt;tt&gt;ShadeMojo::rewriteDependencyReducedPomIfWeHaveReduction&lt;/tt&gt;. There might be a better way to fix the problem, but I it leave that up to the PR reviewers to come up with one, if any.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13565507">MSHADE-467</key>
            <summary>Dependency-reduced POM with missing exclusions in concurrent build</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmannibucau">Romain Manni-Bucau</assignee>
                                    <reporter username="kriegaex">Alexander Kriegisch</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Jan 2024 05:01:47 +0000</created>
                <updated>Sat, 14 Jun 2025 18:13:23 +0000</updated>
                            <resolved>Wed, 31 Jan 2024 06:49:40 +0000</resolved>
                                    <version>3.4.1</version>
                    <version>3.5.0</version>
                    <version>3.5.1</version>
                                    <fixVersion>3.5.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17808867" author="githubbot" created="Sat, 20 Jan 2024 05:13:16 +0000"  >&lt;p&gt;kriegaex opened a new pull request, #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MSHADE-467&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;   You can already start reviewing the fix. I am going to convert the reproducer project into an integration test and then force-push after reordering commits, so the IT ends up reproducing the problem before the fix.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; I hereby declare this contribution to be licenced under the &lt;span class=&quot;error&quot;&gt;&amp;#91;Apache License Version 2.0, January 2004&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] In any other case, please file an &lt;span class=&quot;error&quot;&gt;&amp;#91;Apache Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="17808870" author="githubbot" created="Sat, 20 Jan 2024 06:06:37 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901776577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901776577&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   IT is in place now after a force-push. Please review.&lt;/p&gt;

</comment>
                            <comment id="17808873" author="githubbot" created="Sat, 20 Jan 2024 06:39:32 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901785723&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901785723&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Hm, according to &lt;a href=&quot;https://github.com/kriegaex/maven-shade-plugin/actions/runs/7592589521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kriegaex/maven-shade-plugin/actions/runs/7592589521&lt;/a&gt;, the fix does not work universally on all combinations of Maven and JDK versions. I am open for input.&lt;/p&gt;

</comment>
                            <comment id="17808884" author="githubbot" created="Sat, 20 Jan 2024 08:50:56 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901979558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1901979558&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   OK, &lt;span class=&quot;error&quot;&gt;&amp;#91;this build&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/kriegaex/maven-shade-plugin/actions/runs/7593219673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kriegaex/maven-shade-plugin/actions/runs/7593219673&lt;/a&gt;) has passed now. For Maven 3.9.6, synchronisation on a single session instance was enough, but for Maven 3.6.3 it was a bit too naive and optimistic. Complex objects like project, session etc. contain lots of nested stuff, and not everything can or even should be deep-cloned as was done in &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-413&quot; title=&quot;Maven shade plugin enters endless loop &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-413&quot;&gt;&lt;del&gt;MSHADE-413&lt;/del&gt;&lt;/a&gt; in another part of the mojo. That can work, but leads to potential brittle solutions, if the plugin needs to run on multiple Maven versions.&lt;/p&gt;

&lt;p&gt;   So, protection of the critical section with a `ReentrantLock` it is, then.&lt;/p&gt;

</comment>
                            <comment id="17808885" author="githubbot" created="Sat, 20 Jan 2024 08:56:51 +0000"  >&lt;p&gt;rmannibucau commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460308801&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460308801&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   A global lock looks wrong, shouldnt we lock on the project (we can store a concurrenthashmap of project/lock in the session to avoid synchronized for the future if we enable virtual threads a day)&lt;/p&gt;


</comment>
                            <comment id="17808886" author="githubbot" created="Sat, 20 Jan 2024 09:02:41 +0000"  >&lt;p&gt;kriegaex commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I tried, it is not enough. Feel free to suggest something better, but after you verified that it works, please.&lt;/p&gt;


</comment>
                            <comment id="17808887" author="githubbot" created="Sat, 20 Jan 2024 09:03:41 +0000"  >&lt;p&gt;kriegaex commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I tried synchronising on both project and session, it is not enough. Feel free to suggest something better, but after you verified that it works, please.&lt;/p&gt;


</comment>
                            <comment id="17808888" author="githubbot" created="Sat, 20 Jan 2024 09:05:17 +0000"  >&lt;p&gt;kriegaex commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460311390&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I tried synchronising on both project and session, it is not enough. Feel free to suggest something better, but after you verified that it works, please. I can imagine, that somebody who is more experienced in this code base, Maven plugins in general and concurrency in particular, can come up with a better solution. But let this one be the benchmark. Before my PR, the bug occurs, now it is fixed. A better fix is always welcome.&lt;/p&gt;


</comment>
                            <comment id="17808889" author="githubbot" created="Sat, 20 Jan 2024 09:16:58 +0000"  >&lt;p&gt;kriegaex commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460317942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460317942&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   BTW, feel free to commit on top of the PR, we can always squash some commits later, as long as we keep the IT separate from the fix.&lt;/p&gt;

&lt;p&gt;   !&lt;span class=&quot;error&quot;&gt;&amp;#91;image&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/maven-shade-plugin/assets/1537384/140dd01b-d84d-4100-a42f-7085a7f05c00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/assets/1537384/140dd01b-d84d-4100-a42f-7085a7f05c00&lt;/a&gt;)&lt;/p&gt;



</comment>
                            <comment id="17808905" author="githubbot" created="Sat, 20 Jan 2024 12:39:44 +0000"  >&lt;p&gt;rmannibucau commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460418023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460418023&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   ```&lt;br/&gt;
   diff --git a/src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java b/src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java&lt;br/&gt;
   index 3a7eaaa..a8475d9 100644&lt;br/&gt;
   -&lt;/p&gt;</comment>
                            <comment id="17808960" author="githubbot" created="Sat, 20 Jan 2024 21:11:34 +0000"  >&lt;p&gt;kriegaex commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460668776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460668776&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   LGTM, thanks for the great input. I made sure your authorship was respected in the latest commit. The CI build on my fork is passing. Before merging, would you like me to squash our two solutions into one commit? I wwould prefer to keep both commits for reference and to see the code evolution. Should the necessity for a reentrant lock arise in the future, at least we have an example. We also have one already for what is generally preferable, like in this case. As I cannot merge myself, I leave it up to you to decide.&lt;/p&gt;


</comment>
                            <comment id="17809095" author="githubbot" created="Sun, 21 Jan 2024 08:29:14 +0000"  >&lt;p&gt;rmannibucau commented on code in PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460752671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#discussion_r1460752671&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/apache/maven/plugins/shade/mojo/ShadeMojo.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -1112,15 +1116,21 @@ private void rewriteDependencyReducedPomIfWeHaveReduction(&lt;br/&gt;
                     w.close();&lt;br/&gt;
                 }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ProjectBuildingRequest projectBuildingRequest =&lt;/li&gt;
	&lt;li&gt;new DefaultProjectBuildingRequest(session.getProjectBuildingRequest());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setLocalRepository(session.getLocalRepository());&lt;/li&gt;
	&lt;li&gt;projectBuildingRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());&lt;br/&gt;
+                // Lock critical section to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-467&quot; title=&quot;Dependency-reduced POM with missing exclusions in concurrent build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-467&quot;&gt;&lt;del&gt;MSHADE-467&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+                try {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Looks ok to me like that - if another commiter is ok then let&apos;s go &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


</comment>
                            <comment id="17809287" author="githubbot" created="Mon, 22 Jan 2024 08:06:53 +0000"  >&lt;p&gt;fmarot commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903451284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903451284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Big big thank you for your work @kriegaex &#128077;&lt;/p&gt;

</comment>
                            <comment id="17809315" author="githubbot" created="Mon, 22 Jan 2024 09:10:48 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903549966&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903549966&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @rmannibucau, any idea why the build passed for the whole matrix on my fork, but here is failed due to locked files on Windows?&lt;/p&gt;

</comment>
                            <comment id="17809323" author="githubbot" created="Mon, 22 Jan 2024 09:31:13 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903588421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1903588421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   I do not think it is pure chance that it happens in the new IT. Maybe, in some other part of Maven, at least in some versions, there are other concurrency issues we are hitting here by chance, just because we are testing this setup. If you run the build a few times and it does not re-occur, maybe the test is &quot;just&quot; flaky because of Maven or some situation on the GitHub server. If it happens more often, maybe we can try my initial solution with the reentrant lock and see if that one produces more stable results.&lt;/p&gt;

&lt;p&gt;   Looking at the stack trace below the &lt;span class=&quot;error&quot;&gt;&amp;#91;error message in the Maven 3.6.3 JDK 8 Windows build&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/maven-shade-plugin/actions/runs/7596727600/job/20718211260#step:8:8504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/actions/runs/7596727600/job/20718211260#step:8:8504&lt;/a&gt;), it seems as if the Maven `MultiThreadedBuilder` is involved. Maybe its resource management is suboptimal on a platform like Windows where open files are locked.&lt;/p&gt;

</comment>
                            <comment id="17809413" author="githubbot" created="Mon, 22 Jan 2024 12:35:01 +0000"  >&lt;p&gt;rmannibucau merged PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17809416" author="romain.manni-bucau" created="Mon, 22 Jan 2024 12:36:07 +0000"  >&lt;p&gt;Fixed for 3.5.2 but I don&apos;t have Jira perms to flag it, if anyone can do it would be welcomed.&lt;/p&gt;</comment>
                            <comment id="17810469" author="githubbot" created="Wed, 24 Jan 2024 15:54:17 +0000"  >&lt;p&gt;stl543 commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1908415155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1908415155&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @kriegaex I build the reproducer and my project with the current master version with maven 3.8.6, 3.9.4 and 3.9.6 : Everything works fine !&lt;br/&gt;
   Thank you !!&lt;/p&gt;

</comment>
                            <comment id="17810738" author="githubbot" created="Thu, 25 Jan 2024 07:54:58 +0000"  >&lt;p&gt;kriegaex commented on PR #210:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1909565638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-shade-plugin/pull/210#issuecomment-1909565638&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @stl543, @fmarot, you are welcome. But looking at the commits, what effectively ended up in the merge were basically your reproducer and a variation of my fix provided by @rmannibucau. I.e., almost all the credit stays in France. I just debugged and connected the dots. Allez les Bleus! &#127467;&#127479; &lt;/p&gt;

</comment>
                            <comment id="17812559" author="hboutemy" created="Wed, 31 Jan 2024 06:49:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romain.manni-bucau&quot; class=&quot;user-hover&quot; rel=&quot;romain.manni-bucau&quot;&gt;romain.manni-bucau&lt;/a&gt; closing as Fixed as requested (PR merged)&lt;/p&gt;</comment>
                            <comment id="17976462" author="JIRAUSER302100" created="Sat, 14 Jun 2025 18:13:23 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-shade-plugin/issues/721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-shade-plugin#721&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mw20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>