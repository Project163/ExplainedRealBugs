diff --git a/CHANGES.txt b/CHANGES.txt
index cd5f03267..c8154a6db 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -71,6 +71,8 @@ BUGFIXES:
   ZOOKEEPER-518. DEBUG message for outstanding proposals in leader should be
    moved to trace. (phunt)
 
+  ZOOKEEPER-533.  ant error running clean twice (phunt via mahadev)
+
 IMPROVEMENTS:
   ZOOKEEPER-473. cleanup junit tests to eliminate false positives due to
   "socket reuse" and failure to close client (phunt via mahadev)
diff --git a/src/contrib/bookkeeper/build.xml b/src/contrib/bookkeeper/build.xml
index de8345129..7bca63179 100644
--- a/src/contrib/bookkeeper/build.xml
+++ b/src/contrib/bookkeeper/build.xml
@@ -32,15 +32,6 @@
     <property name="test.junit.haltonfailure" value="no" />
     <property name="test.junit.maxmem" value="512m" />
 
-  
-  <available classname="org.apache.zookeeper.ZooKeeperMain"
-             classpathref="classpath"
-             property="mainIsCompiled"/>
-
-  <target name="checkMainCompiled" unless="mainIsCompiled">
-    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
-  </target>
-
   <target name="setjarname">
     <property name="jarname"
               value="${build.dir}/zookeeper-${version}-${name}.jar"/>
diff --git a/src/contrib/build-contrib.xml b/src/contrib/build-contrib.xml
index c028d68bb..19f121121 100644
--- a/src/contrib/build-contrib.xml
+++ b/src/contrib/build-contrib.xml
@@ -48,10 +48,10 @@
     <pathelement location="${build.classes}"/>
     <fileset refid="lib.jars"/>
     <pathelement location="${zk.root}/build/classes"/>
-    <fileset dir="${zk.root}/build/lib">
+    <fileset dir="${zk.root}/build/lib" erroronmissingdir="false">
       <include name="**/*.jar" />
     </fileset>
-    <fileset dir="${zk.root}/build/test/lib">
+    <fileset dir="${zk.root}/build/test/lib" erroronmissingdir="false">
       <include name="**/*.jar" />
     </fileset>
     <fileset dir="${zk.root}/src/java/lib">
@@ -121,4 +121,19 @@
     <delete dir="${build.dir}"/>
   </target>
 
+
+  <!-- ================================================================== -->
+  <!-- Utility features                                                   -->
+  <!-- ================================================================== -->
+
+  <target name="checkMainIsAvailable">
+    <available classname="org.apache.zookeeper.ZooKeeperMain"
+               classpathref="classpath"
+               property="mainIsCompiled"/>
+  </target>
+
+  <target name="checkMainCompiled" unless="mainIsCompiled" depends="checkMainIsAvailable">
+    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
+  </target>
+
 </project>
diff --git a/src/contrib/fatjar/build.xml b/src/contrib/fatjar/build.xml
index e83063432..2da17184a 100644
--- a/src/contrib/fatjar/build.xml
+++ b/src/contrib/fatjar/build.xml
@@ -20,14 +20,6 @@
 <project name="fatjar" default="jar">
   <import file="../build-contrib.xml"/>
 
-  <available classname="org.apache.zookeeper.ZooKeeperMain"
-             classpathref="classpath"
-             property="mainIsCompiled"/>
-
-  <target name="checkMainCompiled" unless="mainIsCompiled">
-    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
-  </target>
-
   <target name="setjarname">
     <property name="jarname"
               value="${build.dir}/zookeeper-${version}-${name}.jar"/>
diff --git a/src/contrib/rest/build.xml b/src/contrib/rest/build.xml
index 078425eca..398ff9186 100644
--- a/src/contrib/rest/build.xml
+++ b/src/contrib/rest/build.xml
@@ -34,14 +34,6 @@
     <property name="test.junit.haltonfailure" value="no" />
     <property name="test.junit.maxmem" value="512m" />
 
-  <available classname="org.apache.zookeeper.ZooKeeperMain"
-             classpathref="classpath"
-             property="mainIsCompiled"/>
-
-  <target name="checkMainCompiled" unless="mainIsCompiled">
-    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
-  </target>
-
   <target name="setjarname">
     <property name="main.jarname"
               value="${zk.root}/build/zookeeper-${version}.jar"/>
diff --git a/src/contrib/zkpython/build.xml b/src/contrib/zkpython/build.xml
index 0bc317b0a..3c482a93e 100644
--- a/src/contrib/zkpython/build.xml
+++ b/src/contrib/zkpython/build.xml
@@ -26,15 +26,6 @@
   <property name="test.output" value="no" />
   <property name="test.timeout" value="900000" />
 
-  <available classname="org.apache.zookeeper.ZooKeeperMain"
-             classpathref="classpath"
-             property="mainIsCompiled"/>
-
-  <target name="checkMainCompiled" unless="mainIsCompiled">
-    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
-  </target>
-
-
   <target name="test"
           depends="test-init,test-category,test-start,python-test,test-stop" />
 	
diff --git a/src/recipes/build-recipes.xml b/src/recipes/build-recipes.xml
index d0578f5b5..c961debde 100644
--- a/src/recipes/build-recipes.xml
+++ b/src/recipes/build-recipes.xml
@@ -48,7 +48,7 @@
     <pathelement location="${build.classes}"/>
     <fileset refid="lib.jars"/>
     <pathelement location="${zk.root}/build/classes"/>
-    <fileset dir="${zk.root}/build/lib">
+    <fileset dir="${zk.root}/build/lib" erroronmissingdir="false">
       <include name="**/*.jar" />
     </fileset>
     <fileset dir="${zk.root}/src/java/lib">
@@ -118,4 +118,19 @@
     <delete dir="${build.dir}"/>
   </target>
 
+
+  <!-- ================================================================== -->
+  <!-- Utility features                                                   -->
+  <!-- ================================================================== -->
+
+  <target name="checkMainIsAvailable">
+    <available classname="org.apache.zookeeper.ZooKeeperMain"
+               classpathref="classpath"
+               property="mainIsCompiled"/>
+  </target>
+
+  <target name="checkMainCompiled" unless="mainIsCompiled" depends="checkMainIsAvailable">
+    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
+  </target>
+
 </project>
diff --git a/src/recipes/lock/build.xml b/src/recipes/lock/build.xml
index 27bd44dcd..28fe83717 100644
--- a/src/recipes/lock/build.xml
+++ b/src/recipes/lock/build.xml
@@ -32,15 +32,6 @@
     <property name="test.junit.haltonfailure" value="no" />
     <property name="test.junit.maxmem" value="512m" />
 
-  
-  <available classname="org.apache.zookeeper.ZooKeeperMain"
-             classpathref="classpath"
-             property="mainIsCompiled"/>
-
-  <target name="checkMainCompiled" unless="mainIsCompiled">
-    <fail message="ZooKeeper main must first be compiled (toplevel build.xml)"/>
-  </target>
-
   <target name="setjarname">
     <property name="jarname"
               value="${build.dir}/zookeeper-${version}-recipes-${name}.jar"/>
