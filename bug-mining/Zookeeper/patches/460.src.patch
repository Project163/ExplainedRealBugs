diff --git a/CHANGES.txt b/CHANGES.txt
index 687ec1656..e9c08d94a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -218,6 +218,8 @@ BUGFIXES:
     completion callback if zookeeper_close has been called
     (Michi Mutsuzaki via phunt and mahadev)
 
+  ZOOKEEPER-1522. intermittent failures in Zab test due to NPE in
+    recursiveDelete test function (phunt via flavio)
 
 IMPROVEMENTS:
 
diff --git a/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java b/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java
index 6644ca255..42207e1bc 100644
--- a/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java
+++ b/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java
@@ -48,8 +48,6 @@
 import org.apache.zookeeper.server.ZKDatabase;
 import org.apache.zookeeper.server.ZooKeeperServer;
 import org.apache.zookeeper.server.persistence.FileTxnSnapLog;
-import org.apache.zookeeper.server.quorum.Leader;
-import org.apache.zookeeper.server.quorum.QuorumPeer;
 import org.apache.zookeeper.server.quorum.QuorumPeer.QuorumServer;
 import org.apache.zookeeper.server.quorum.flexible.QuorumMaj;
 import org.apache.zookeeper.server.util.ZxidUtils;
@@ -59,8 +57,12 @@
 import org.apache.zookeeper.txn.TxnHeader;
 import org.junit.Assert;
 import org.junit.Test;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 public class Zab1_0Test {
+    private static final Logger LOG = LoggerFactory.getLogger(Zab1_0Test.class);
+
     private static final class LeadThread extends Thread {
         private final Leader leader;
 
@@ -71,8 +73,10 @@ private LeadThread(Leader leader) {
         public void run() {
             try {
                 leader.lead();
+            } catch (InterruptedException e) {
+                LOG.info("Leader thread interrupted", e);
             } catch (Exception e) {
-                e.printStackTrace();
+                LOG.warn("Unexpected exception in leader thread", e);
             } finally {
                 leader.shutdown("lead ended");
             }
@@ -160,10 +164,10 @@ public void testLeaderInConnectingFollowers() throws Exception {
             	Assert.fail("leader timed out in getEpochToPropose");
             }
         } finally {
-            recursiveDelete(tmpDir);
             if (leader != null) {
                 leader.shutdown("end of test");
             }
+            recursiveDelete(tmpDir);
         }
     }
     
@@ -208,10 +212,14 @@ public void testLastAcceptedEpoch() throws Exception {
             }
             
         } finally {
-            recursiveDelete(tmpDir);
             if (leader != null) {
                 leader.shutdown("end of test");
             }
+            if (leadThread != null) {
+                leadThread.interrupt();
+                leadThread.join();
+            }
+            recursiveDelete(tmpDir);
         }
     }
     
@@ -245,10 +253,10 @@ public void testLeaderInElectingFollowers() throws Exception {
             Assert.assertTrue(f1.msg + " without waiting for leader", f1.msg == null);            
             Assert.assertTrue(f2.msg + " without waiting for leader", f2.msg == null);
         } finally {
-            recursiveDelete(tmpDir);
             if (leader != null) {
                 leader.shutdown("end of test");
             }
+            recursiveDelete(tmpDir);
         }
     }
 
@@ -347,7 +355,6 @@ public void testLeaderConversation(LeaderConversation conversation) throws Excep
 
             conversation.converseWithLeader(ia, oa, leader);
         } finally {
-            recursiveDelete(tmpDir);
             if (leader != null) {
                 leader.shutdown("end of test");
             }
@@ -355,6 +362,7 @@ public void testLeaderConversation(LeaderConversation conversation) throws Excep
                 leadThread.interrupt();
                 leadThread.join();
             }
+            recursiveDelete(tmpDir);
         }
     }
     
@@ -416,7 +424,6 @@ public void testPopulatedLeaderConversation(PopulatedLeaderConversation conversa
 
             conversation.converseWithLeader(ia, oa, leader, zxid);
         } finally {
-            recursiveDelete(tmpDir);
             if (leader != null) {
                 leader.shutdown("end of test");
             }
@@ -424,6 +431,7 @@ public void testPopulatedLeaderConversation(PopulatedLeaderConversation conversa
                 leadThread.interrupt();
                 leadThread.join();
             }
+            recursiveDelete(tmpDir);
         }
     }
     
@@ -449,8 +457,10 @@ public void testFollowerConversation(FollowerConversation conversation) throws E
                 public void run() {
                     try {
                         followerForThread.followLeader();
-                    } catch(Exception e) {
-                        e.printStackTrace();
+                    } catch (InterruptedException e) {
+                        LOG.info("Follower thread interrupted", e);
+                    } catch (Exception e) {
+                        LOG.warn("Unexpected exception in follower thread", e);
                     }
                 }
             };
@@ -750,7 +760,7 @@ public void converseWithFollower(InputArchive ia, OutputArchive oa,
                     // Make sure the data was recorded in the filesystem ok
                     ZKDatabase zkDb2 = new ZKDatabase(new FileTxnSnapLog(logDir, snapDir));
                     zkDb2.loadDataBase();
-                    System.out.println(zkDb2.getSessions());
+                    LOG.info("zkdb2 sessions:" + zkDb2.getSessions());
                     Assert.assertNotNull(zkDb2.getSessionWithTimeOuts().get(4L));
                 } finally {
                     recursiveDelete(tmpDir);
@@ -914,8 +924,12 @@ private void recursiveDelete(File file) {
         if (file.isFile()) {
             file.delete();
         } else {
-            for(File c: file.listFiles()) {
-                recursiveDelete(c);
+            // might return null if deleted out from under us...
+            File[] files = file.listFiles();
+            if (files != null) {
+                for(File c: files) {
+                    recursiveDelete(c);
+                }
             }
             file.delete();
         }
