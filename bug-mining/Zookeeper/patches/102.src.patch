diff --git a/CHANGES.txt b/CHANGES.txt
index bd4b2d5b8..5d68d8af3 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -72,6 +72,8 @@ BUGFIXES:
 
   ZOOKEEPER-392. Change log4j properties in bookkeeper. (flavio via mahadev)
 
+  ZOOKEEPER-400. Issues with procedure to close ledger. (flavio)
+
 IMPROVEMENTS:
   ZOOKEEPER-308. improve the atomic broadcast performance 3x.
   (breed via mahadev)
diff --git a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/ClientCBWorker.java b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/ClientCBWorker.java
index 6305b9fc4..d27f3ed42 100644
--- a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/ClientCBWorker.java
+++ b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/ClientCBWorker.java
@@ -113,10 +113,11 @@ public void run(){
                     case Operation.ADD:
                         AddOp aOp = (AddOp) op;
                     
+                        aOp.getLedger().setAddConfirmed(aOp.entry);
                         aOp.cb.addComplete(aOp.getErrorCode(),
                             aOp.getLedger().getId(), aOp.entry, 
                             aOp.ctx);
-                        aOp.getLedger().setAddConfirmed(aOp.entry);
+                        
                         break;
                     case Operation.READ:
                         ReadOp rOp = (ReadOp) op;
diff --git a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerHandle.java b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerHandle.java
index 4f1bf9424..1b0df87ff 100644
--- a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerHandle.java
+++ b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerHandle.java
@@ -444,8 +444,8 @@ public void close()
     throws KeeperException, InterruptedException {
         //Set data on zookeeper
         ByteBuffer last = ByteBuffer.allocate(8);
-        last.putLong(getLast());
-        LOG.info("Last saved on ZK is: " + getLast());
+        last.putLong(lastAddConfirmed);
+        LOG.info("Last saved on ZK is: " + lastAddConfirmed);
         String closePath = BookKeeper.prefix + bk.getZKStringId(getId()) + BookKeeper.close; 
         if(bk.getZooKeeper().exists(closePath, false) == null){
            bk.getZooKeeper().create(closePath, 
diff --git a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerRecoveryMonitor.java b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerRecoveryMonitor.java
index 00df7d8ac..91922c418 100644
--- a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerRecoveryMonitor.java
+++ b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/client/LedgerRecoveryMonitor.java
@@ -150,14 +150,12 @@ boolean recover(byte[] passwd) throws
                     hasMore = false;
                     LOG.debug("Recovering: " + lh.getLast());
                     LedgerSequence ls = lh.readEntries(lh.getLast(), lh.getLast());
-                    //if(ls == null) throw BKException.create(Code.ReadException);
                     LOG.debug("Received entry for: " + lh.getLast());
                     
                     byte[] le = ls.nextElement().getEntry();
                     if(le != null){
                         if(notLegitimate) notLegitimate = false;
                         lh.addEntry(le);
-                        //lh.incLast();
                         hasMore = true;
                     }
                 }
@@ -168,7 +166,7 @@ boolean recover(byte[] passwd) throws
          * Write counter as the last entry of ledger
          */
         if(!notLegitimate){
-            //lh.setLast(readCounter);
+            lh.setAddConfirmed(readCounter);
             lh.close();
             
             return true;
diff --git a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BookieReadWriteTest.java b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BookieReadWriteTest.java
index 3a3626dc8..7f13ce8bb 100644
--- a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BookieReadWriteTest.java
+++ b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BookieReadWriteTest.java
@@ -189,7 +189,7 @@ public void testReadWriteAsyncSingleClient() throws IOException{
 			
 			// wait for all entries to be acknowledged
 			synchronized (sync) {
-				if (sync.counter < numEntriesToWrite){
+				while (sync.counter < numEntriesToWrite){
 					LOG.debug("Entries counter = " + sync.counter);
 					sync.wait();
 				}
@@ -204,7 +204,7 @@ public void testReadWriteAsyncSingleClient() throws IOException{
 			// open ledger
 			lh = bkc.openLedger(ledgerId, ledgerPassword);
 			LOG.debug("Number of entries written: " + lh.getLast());
-			assertTrue("Verifying number of entries written", lh.getLast() == numEntriesToWrite);		
+			assertTrue("Verifying number of entries written", lh.getLast() == (numEntriesToWrite - 1));		
 			
 			//read entries
 			lh.asyncReadEntries(0, numEntriesToWrite - 1, this, (Object) sync);
@@ -269,7 +269,7 @@ public void testSyncReadAsyncWriteStringsSingleClient() throws IOException{
 			
 			// wait for all entries to be acknowledged
 			synchronized (sync) {
-				if (sync.counter < numEntriesToWrite){
+				while (sync.counter < numEntriesToWrite){
 					LOG.debug("Entries counter = " + sync.counter);
 					sync.wait();
 				}
@@ -284,7 +284,7 @@ public void testSyncReadAsyncWriteStringsSingleClient() throws IOException{
 			// open ledger
 			lh = bkc.openLedger(ledgerId, ledgerPassword);
 			LOG.debug("Number of entries written: " + lh.getLast());
-			assertTrue("Verifying number of entries written", lh.getLast() == numEntriesToWrite);		
+			assertTrue("Verifying number of entries written", lh.getLast() == (numEntriesToWrite - 1));		
 			
 			//read entries			
 			ls = lh.readEntries(0, numEntriesToWrite - 1);
@@ -342,7 +342,7 @@ public void testReadWriteSyncSingleClient() throws IOException {
 			lh.close();
 			lh = bkc.openLedger(ledgerId, ledgerPassword);
 			LOG.debug("Number of entries written: " + lh.getLast());
-			assertTrue("Verifying number of entries written", lh.getLast() == numEntriesToWrite);		
+			assertTrue("Verifying number of entries written", lh.getLast() == (numEntriesToWrite - 1));		
 			
 			ls = lh.readEntries(0, numEntriesToWrite - 1);
 			int i = 0;
@@ -394,7 +394,7 @@ public void testReadWriteZero() throws IOException {
 			lh.close();
 			lh = bkc.openLedger(ledgerId, ledgerPassword);
 			LOG.debug("Number of entries written: " + lh.getLast());
-			assertTrue("Verifying number of entries written", lh.getLast() == (numEntriesToWrite + 1));		
+			assertTrue("Verifying number of entries written", lh.getLast() == numEntriesToWrite);		
 			
 			ls = lh.readEntries(0, numEntriesToWrite - 1);
 			int i = 0;
@@ -441,8 +441,8 @@ public void testMultiLedger() throws IOException {
             lh2 = bkc.openLedger(ledgerId2, ledgerPassword);
             
             LOG.debug("Number of entries written: " + lh.getLast() + ", " + lh2.getLast());
-            assertTrue("Verifying number of entries written lh (" + lh.getLast() + ")" , lh.getLast() == numEntriesToWrite);
-            assertTrue("Verifying number of entries written lh2 (" + lh2.getLast() + ")", lh2.getLast() == numEntriesToWrite);
+            assertTrue("Verifying number of entries written lh (" + lh.getLast() + ")" , lh.getLast() == (numEntriesToWrite - 1));
+            assertTrue("Verifying number of entries written lh2 (" + lh2.getLast() + ")", lh2.getLast() == (numEntriesToWrite - 1));
             
             ls = lh.readEntries(0, numEntriesToWrite - 1);
             int i = 0;
diff --git a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/LedgerRecoveryTest.java b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/LedgerRecoveryTest.java
index ec386a939..db85fe079 100644
--- a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/LedgerRecoveryTest.java
+++ b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/LedgerRecoveryTest.java
@@ -243,7 +243,7 @@ public void testLedgerRecovery(){
             /*
              * Check if has recovered properly.
              */
-            assertTrue("Has not recovered correctly: " + afterlh.getLast(), afterlh.getLast() == 1000);
+            assertTrue("Has not recovered correctly: " + afterlh.getLast(), afterlh.getLast() == 999);
         } catch (KeeperException e) {
             LOG.error("Error when opening ledger", e);
             fail("Couldn't open ledger");
@@ -328,7 +328,7 @@ public void testEmptyLedgerRecovery(){
             /*
              * Check if has recovered properly.
              */
-            assertTrue("Has not recovered correctly: " + afterlh.getLast(), afterlh.getLast() == 1);
+            assertTrue("Has not recovered correctly: " + afterlh.getLast(), afterlh.getLast() == 0);
         } catch (KeeperException e) {
             LOG.error("Error when opening ledger", e);
             fail("Couldn't open ledger");
