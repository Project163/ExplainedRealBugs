diff --git a/CHANGES.txt b/CHANGES.txt
index e71585a4d..4c07b9fdf 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -667,6 +667,9 @@ BUGFIXES:
   ZOOKEEPER-1699. Leader should timeout and give up leadership when losing
   quorum of last proposed configuration (Alexander Shraer via michim)
 
+  ZOOKEEPER-1870. flakey test in StandaloneDisabledTest.startSingleServerTest 
+  (Helen Hastings via fpj)
+
 IMPROVEMENTS:
 
   ZOOKEEPER-1170. Fix compiler (eclipse) warnings: unused imports,
diff --git a/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java b/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java
index d8ba7c28c..5749bdd1e 100644
--- a/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java
+++ b/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java
@@ -277,6 +277,7 @@ public void run() {
                                            LOG.info("restarting leader election");
                                            self.shuttingDownLE = true;
                                            self.getElectionAlg().shutdown();
+                                           break;
                                        }
                                    }           
                                } catch (IOException e) {                         
@@ -573,6 +574,8 @@ public QuorumCnxManager getCnxManager(){
     volatile boolean stop;
     public void shutdown(){
         stop = true;
+        proposedLeader = -1;
+        proposedZxid = -1;
         LOG.debug("Shutting down connection manager");
         manager.halt();
         LOG.debug("Shutting down messenger");
@@ -713,7 +716,7 @@ synchronized void updateProposal(long leader, long zxid, long epoch){
         proposedEpoch = epoch;
     }
 
-    synchronized Vote getVote(){
+    synchronized public Vote getVote(){
         return new Vote(proposedLeader, proposedZxid, proposedEpoch);
     }
 
diff --git a/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java b/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java
index 4770a3cce..c1ef8cd1a 100644
--- a/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java
+++ b/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java
@@ -457,6 +457,12 @@ public void halt() {
         LOG.debug("Halting listener");
         listener.halt();
         
+        // Wait for the listener to terminate.
+        try {
+            listener.join();
+        } catch (InterruptedException ex) {
+            LOG.warn("Got interrupted before joining the listener", ex);
+        }
         softHalt();
     }
    
@@ -551,22 +557,19 @@ public void run() {
                         numRetries = 0;
                     }
                 } catch (IOException e) {
-                    if ( !shutdown ) {
-                        LOG.error("Exception while listening", e);
+                    if (shutdown) {
+                        break;
                     }
+                    LOG.error("Exception while listening", e);
                     numRetries++;
                     try {
                         ss.close();
                         Thread.sleep(1000);
                     } catch (IOException ie) {
-                        if ( !shutdown ) {
-                            LOG.error("Error closing server socket", ie);
-                        }
+                        LOG.error("Error closing server socket", ie);
                     } catch (InterruptedException ie) {
-                        if ( !shutdown ) {
-                            LOG.error("Interrupted while sleeping. " +
-                                "Ignoring exception", ie);
-                        }
+                        LOG.error("Interrupted while sleeping. " +
+                            "Ignoring exception", ie);
                     }
                 }
             }
@@ -576,9 +579,17 @@ public void run() {
                         + "I won't be able to participate in leader "
                         + "election any longer: "
                         + self.getElectionAddress());
+            } else if (ss != null) {
+                // Clean up for shutdown.
+                try {
+                    ss.close();
+                } catch (IOException ie) {
+                    // Don't log an error for shutdown.
+                    LOG.debug("Error closing server socket", ie);
+                }
             }
         }
-        
+
         /**
          * Halts this listener thread.
          */
diff --git a/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java b/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
index 2d53f6888..0ec6e678e 100644
--- a/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
+++ b/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
@@ -1269,6 +1269,7 @@ public synchronized void restartLeaderElection(QuorumVerifier qvOLD, QuorumVerif
         if (qvOLD == null || !qvOLD.equals(qvNEW)) {
             LOG.warn("Restarting Leader Election");
             getElectionAlg().shutdown();
+            shuttingDownLE = false;
             startLeaderElection();
         }           
     }
diff --git a/src/java/test/org/apache/zookeeper/test/CnxManagerTest.java b/src/java/test/org/apache/zookeeper/test/CnxManagerTest.java
index 6938c9db3..76d4b3f3e 100644
--- a/src/java/test/org/apache/zookeeper/test/CnxManagerTest.java
+++ b/src/java/test/org/apache/zookeeper/test/CnxManagerTest.java
@@ -173,7 +173,8 @@ public void testCnxManager() throws Exception {
             if(thread.failed)
                 Assert.fail("Did not receive expected message");
         }
-
+        cnxManager.halt();
+        Assert.assertFalse(cnxManager.listener.isAlive());
     }
 
     @Test
@@ -206,7 +207,8 @@ public void testCnxManagerTimeout() throws Exception {
         long end = System.currentTimeMillis();
 
         if((end - begin) > 6000) Assert.fail("Waited more than necessary");
-
+        cnxManager.halt();
+        Assert.assertFalse(cnxManager.listener.isAlive());
     }
 
     /**
@@ -269,6 +271,7 @@ public void testCnxManagerSpinLock() throws Exception {
         }
         peer.shutdown();
         cnxManager.halt();
+        Assert.assertFalse(cnxManager.listener.isAlive());
     }
 
     /*
@@ -295,6 +298,8 @@ public void testSocketTimeout() throws Exception {
         cnxManager.receiveConnection(sock);
         long end = System.currentTimeMillis();
         if((end - begin) > ((peer.getSyncLimit() * peer.getTickTime()) + 500)) Assert.fail("Waited more than necessary");
+        cnxManager.halt();
+        Assert.assertFalse(cnxManager.listener.isAlive());
     }
 
     /*
diff --git a/src/java/test/org/apache/zookeeper/test/FLETest.java b/src/java/test/org/apache/zookeeper/test/FLETest.java
index 553c3a39c..eebc78fa3 100644
--- a/src/java/test/org/apache/zookeeper/test/FLETest.java
+++ b/src/java/test/org/apache/zookeeper/test/FLETest.java
@@ -162,7 +162,11 @@ public void run() {
                         LOG.info("I'm the leader: " + i);
                         if (lc < this.totalRounds) {
                             LOG.info("Leader " + i + " dying");
-                            ((FastLeaderElection) peer.getElectionAlg()).shutdown();
+                            FastLeaderElection election =
+                                (FastLeaderElection) peer.getElectionAlg();
+                            election.shutdown();
+                            // Make sure the vote is reset to -1 after shutdown.
+                            Assert.assertEquals(-1, election.getVote().getId());
                             LOG.info("Leader " + i + " dead");
                             
                             break;
