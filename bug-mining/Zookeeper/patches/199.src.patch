diff --git a/src/contrib/bookkeeper/build.xml b/src/contrib/bookkeeper/build.xml
index 4df2f9b18..acd287b13 100644
--- a/src/contrib/bookkeeper/build.xml
+++ b/src/contrib/bookkeeper/build.xml
@@ -60,7 +60,7 @@
 
   <target name="compile" depends="ivy-retrieve,zookeeperbuildcontrib.compile"/>
 
-  <target name="test" depends="compile-test,test-init,test-category,junit.run" />
+  <target name="test" depends="checkMainTestCompiled,compile-test,test-init,test-category,junit.run" />
 
 	<target name="compile-test" depends="ivy-retrieve-test,compile">
   		<property name="target.jdk" value="${ant.java.version}" />	
@@ -71,6 +71,9 @@
 			target="${target.jdk}" 
 			debug="on" >
 			<classpath refid="classpath" />
+			<classpath>
+				<pathelement location="${zk.root}/build/test/classes"/>
+			</classpath>
 		</javac>
 	</target>
 	
@@ -104,6 +107,7 @@
           <classpath refid="classpath"/>
           <classpath>
              <pathelement path="${build.test}" />
+             <pathelement location="${zk.root}/build/test/classes"/>
           </classpath>
           <formatter type="${test.junit.output.format}" />
           <batchtest todir="${test.log.dir}" unless="testcase">
diff --git a/src/contrib/build-contrib.xml b/src/contrib/build-contrib.xml
index 9f21e7ca0..bcf3c66e3 100644
--- a/src/contrib/build-contrib.xml
+++ b/src/contrib/build-contrib.xml
@@ -163,6 +163,16 @@
   </target>
 
 
+  <target name="checkMainTestIsAvailable">
+    <available file="${zk.root}/build/test/classes/org/apache/zookeeper/test/ClientBase.class"
+               property="mainTestIsCompiled">
+    </available>
+  </target>
+
+  <target name="checkMainTestCompiled" unless="mainTestIsCompiled" depends="checkMainTestIsAvailable">
+    <fail message="ZooKeeper test must first be compiled (toplevel build.xml) using 'ant compile-test'"/>
+  </target>
+
   <!-- ====================================================== -->
   <!-- Ivy                                                    -->
   <!-- ====================================================== -->
