diff --git a/CHANGES.txt b/CHANGES.txt
index 3f4e4ce9e..94f589b13 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -60,6 +60,9 @@ BUGFIXES:
   ZOOKEEPER-499. electionAlg should default to FLE (3) - regression (phunt via
   mahadev) 
 
+  ZOOKEEPER-477. zkCleanup.sh is flaky (fernando via mahadev)
+
+
 IMPROVEMENTS:
   ZOOKEEPER-473. cleanup junit tests to eliminate false positives due to
   "socket reuse" and failure to close client (phunt via mahadev)
diff --git a/bin/zkCleanup.sh b/bin/zkCleanup.sh
index 9fe2c2051..df2f12fe2 100755
--- a/bin/zkCleanup.sh
+++ b/bin/zkCleanup.sh
@@ -36,8 +36,16 @@ ZOOBINDIR=`dirname "$ZOOBIN"`
 
 . $ZOOBINDIR/zkEnv.sh
 
-eval `grep -e "^dataDir=" $ZOOCFG`
+ZOODATADIR=$(grep '^dataDir=' $ZOOCFG | sed -e 's/.*=//')
+ZOODATALOGDIR=$(grep '^dataLogDir=' $ZOOCFG | sed -e 's/.*=//')
 
-java "-Dzookeeper.log.dir=${ZOO_LOG_DIR}" "-Dzookeeper.root.logger=${ZOO_LOG4J_PROP}" \
+if [ "x${ZOODATALOGDIR}" = "x" ]
+then
+echo java "-Dzookeeper.log.dir=${ZOO_LOG_DIR}" "-Dzookeeper.root.logger=${ZOO_LOG4J_PROP}" \
+     -cp $CLASSPATH $JVMFLAGS \
+     org.apache.zookeeper.server.PurgeTxnLog $ZOODATADIR $*
+else
+echo java "-Dzookeeper.log.dir=${ZOO_LOG_DIR}" "-Dzookeeper.root.logger=${ZOO_LOG4J_PROP}" \
      -cp $CLASSPATH $JVMFLAGS \
-     org.apache.zookeeper.server.PurgeTxnLog $dataDir
+     org.apache.zookeeper.server.PurgeTxnLog $ZOODATALOGDIR $ZOODATADIR $*
+fi
