diff --git a/CHANGES.txt b/CHANGES.txt
index f3e46ec29..3c2871f38 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -80,6 +80,9 @@ BUGFIXES:
 
   ZOOKEEPER-792. zkpython memory leak (Lei Zhang via henryr)
 
+  ZOOKEEPER-854. BookKeeper does not compile due to changes in the ZooKeeper 
+  code (Flavio via mahadev)
+
 IMPROVEMENTS:
   ZOOKEEPER-724. Improve junit test integration - log harness information 
   (phunt via mahadev)
diff --git a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/util/LocalBookKeeper.java b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/util/LocalBookKeeper.java
index 9b31b0e23..5d8ecfc09 100644
--- a/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/util/LocalBookKeeper.java
+++ b/src/contrib/bookkeeper/src/java/org/apache/bookkeeper/util/LocalBookKeeper.java
@@ -38,7 +38,7 @@
 import org.apache.zookeeper.Watcher;
 import org.apache.zookeeper.ZooKeeper;
 import org.apache.zookeeper.ZooDefs.Ids;
-import org.apache.zookeeper.server.NIOServerCnxn;
+import org.apache.zookeeper.server.NIOServerCnxnFactory;
 import org.apache.zookeeper.server.ZooKeeperServer;
 
 public class LocalBookKeeper {
@@ -62,7 +62,7 @@ public LocalBookKeeper(int numberOfBookies){
 	}
 	
 	private final String HOSTPORT = "127.0.0.1:2181";
-	NIOServerCnxn.Factory serverFactory;
+	NIOServerCnxnFactory serverFactory;
 	ZooKeeperServer zks;
 	ZooKeeper zkc;
 	int ZooKeeperDefaultPort = 2181;
@@ -77,7 +77,7 @@ public LocalBookKeeper(int numberOfBookies){
 	 * @param args
 	 */
 	
-	private void runZookeeper() throws IOException{
+	private void runZookeeper(int maxCC) throws IOException{
 		// create a ZooKeeper server(dataDir, dataLogDir, port)
 		LOG.info("Starting ZK server");
 		//ServerStats.registerAsConcrete();
@@ -88,7 +88,8 @@ private void runZookeeper() throws IOException{
 		    
 		try {
 			zks = new ZooKeeperServer(ZkTmpDir, ZkTmpDir, ZooKeeperDefaultPort);
-			serverFactory =  new NIOServerCnxn.Factory(new InetSocketAddress(ZooKeeperDefaultPort));
+			serverFactory =  new NIOServerCnxnFactory();
+			serverFactory.configure(new InetSocketAddress(ZooKeeperDefaultPort), maxCC);
 			serverFactory.startup(zks);
 		} catch (Exception e) {
 			// TODO Auto-generated catch block
@@ -143,7 +144,7 @@ public static void main(String[] args) throws IOException, InterruptedException
 			System.exit(-1);
 		}
 		LocalBookKeeper lb = new LocalBookKeeper(Integer.parseInt(args[0]));
-		lb.runZookeeper();
+		lb.runZookeeper(1000);
 		lb.initializeZookeper();
 		lb.runBookies();
 		while (true){
diff --git a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BaseTestCase.java b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BaseTestCase.java
index a2006ed25..f9f181783 100644
--- a/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BaseTestCase.java
+++ b/src/contrib/bookkeeper/test/org/apache/bookkeeper/test/BaseTestCase.java
@@ -37,7 +37,7 @@
 import org.apache.zookeeper.Watcher;
 import org.apache.zookeeper.ZooKeeper;
 import org.apache.zookeeper.ZooDefs.Ids;
-import org.apache.zookeeper.server.NIOServerCnxn;
+import org.apache.zookeeper.server.NIOServerCnxnFactory;
 import org.apache.zookeeper.server.ZooKeeperServer;
 import org.apache.zookeeper.test.ClientBase;
 import org.junit.After;
@@ -56,7 +56,7 @@ public abstract class BaseTestCase extends TestCase {
     static Integer ZooKeeperDefaultPort = 2181;
     ZooKeeperServer zks;
     ZooKeeper zkc; // zookeeper client
-    NIOServerCnxn.Factory serverFactory;
+    NIOServerCnxnFactory serverFactory;
     File ZkTmpDir;
 
     // BookKeeper
@@ -89,7 +89,8 @@ public void setUp() throws Exception {
         ZkTmpDir.mkdir();
 
         zks = new ZooKeeperServer(ZkTmpDir, ZkTmpDir, ZooKeeperDefaultPort);
-        serverFactory = new NIOServerCnxn.Factory(new InetSocketAddress(ZooKeeperDefaultPort));
+        serverFactory = new NIOServerCnxnFactory();
+        serverFactory.configure(new InetSocketAddress(ZooKeeperDefaultPort), 100);
         serverFactory.startup(zks);
 
         boolean b = ClientBase.waitForServerUp(HOSTPORT, ClientBase.CONNECTION_TIMEOUT);
