<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:02:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3598]  Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3598</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;&#160;&lt;br/&gt;
There was a regression introduced after inline the write in CommitProcessor with changes intorduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3359&quot; title=&quot;Batch commits in the CommitProcessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3359&quot;&gt;&lt;del&gt;ZOOKEEPER-3359&lt;/del&gt;&lt;/a&gt;,&#160;which didn&apos;t wait the in-flight write to finish before calling shutdown on the nextProcessor.&lt;br/&gt;
&#160;&lt;br/&gt;
So it&apos;s possible that CommitProcessor thread and QuorumPeer thread will update the DataTree concurrently if we&apos;re doing&#160;fastForwardDataBase at the end of ZooKeeperServer.shutdown, which will cause inconsistent issue.&lt;br/&gt;
&#160;&lt;br/&gt;
This JIRA is going to make sure we wait on the CommitProcessor to shutdown gracefully before calling shutdown on next processor, and exit if we cannot finish it gracefully to avoid potential inconsistency.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13265111">ZOOKEEPER-3598</key>
            <summary> Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="lvfangmin">Fangmin Lv</assignee>
                                    <reporter username="lvfangmin">Fangmin Lv</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 29 Oct 2019 19:23:57 +0000</created>
                <updated>Mon, 18 Nov 2019 12:41:52 +0000</updated>
                                            <version>3.6.0</version>
                                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="16971749" author="hudson" created="Mon, 11 Nov 2019 17:27:46 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Zookeeper-trunk-single-thread #608 (See &lt;a href=&quot;https://builds.apache.org/job/Zookeeper-trunk-single-thread/608/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Zookeeper-trunk-single-thread/608/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3598&quot; title=&quot; Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3598&quot;&gt;ZOOKEEPER-3598&lt;/a&gt;: Fix potential data inconsistency issue due to (eolivelli: rev 79f99af81842f415b97e1c3c18c953df5bd129b2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/CommitProcessor.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/ExitCode.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/test/java/org/apache/zookeeper/server/quorum/CommitProcessorTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16971763" author="hudson" created="Mon, 11 Nov 2019 18:05:39 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #769 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/769/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/769/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3598&quot; title=&quot; Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3598&quot;&gt;ZOOKEEPER-3598&lt;/a&gt;: Fix potential data inconsistency issue due to (eolivelli: rev 79f99af81842f415b97e1c3c18c953df5bd129b2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/ExitCode.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/test/java/org/apache/zookeeper/server/quorum/CommitProcessorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/CommitProcessor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16974975" author="andorm" created="Fri, 15 Nov 2019 09:55:07 +0000"  >&lt;p&gt;Re-opening this issue due to the discussion here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1143&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16975088" author="hudson" created="Fri, 15 Nov 2019 13:17:14 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Zookeeper-trunk-single-thread #615 (See &lt;a href=&quot;https://builds.apache.org/job/Zookeeper-trunk-single-thread/615/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Zookeeper-trunk-single-thread/615/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3598&quot; title=&quot; Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3598&quot;&gt;ZOOKEEPER-3598&lt;/a&gt;: Fix potential data inconsistency issue due to (andor: rev 9f13268567dfcc26a5f59a7449aeec21fb5e16b3)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/ExitCode.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/test/java/org/apache/zookeeper/server/quorum/CommitProcessorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/CommitProcessor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16975107" author="hudson" created="Fri, 15 Nov 2019 13:45:38 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #777 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/777/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/777/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3598&quot; title=&quot; Fix potential data inconsistency issue due to CommitProcessor not gracefully shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3598&quot;&gt;ZOOKEEPER-3598&lt;/a&gt;: Fix potential data inconsistency issue due to (andor: rev 9f13268567dfcc26a5f59a7449aeec21fb5e16b3)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/CommitProcessor.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/test/java/org/apache/zookeeper/server/quorum/CommitProcessorTest.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/server/ExitCode.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z082ag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Committed to master branch as 79f99af81842f415b97e1c3c18c953df5bd129b2&lt;br/&gt;
&lt;br/&gt;
(I had a problem with the script and JIRA)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>