<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:00:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2338] c bindings should create socket&apos;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2338</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I&apos;ve observed socket FD leaks in Apache Mesos when using ZK to coordinate master leadership: &lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-4065&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MESOS-4065&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12920127">ZOOKEEPER-2338</key>
            <summary>c bindings should create socket&apos;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fr0stbyte">Radu Brumariu</assignee>
                                    <reporter username="jdef">James DeFelice</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 8 Dec 2015 16:57:26 +0000</created>
                <updated>Tue, 31 Mar 2020 10:44:17 +0000</updated>
                            <resolved>Wed, 6 Dec 2017 22:59:39 +0000</resolved>
                                    <version>3.5.3</version>
                    <version>3.4.11</version>
                    <version>3.6.0</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16219361" author="githubbot" created="Wed, 25 Oct 2017 19:29:50 +0000"  >&lt;p&gt;GitHub user fr0stbyte opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/407&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;

&lt;p&gt;    This addresses the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&lt;/a&gt; preventing the sockets to leak into the forked children &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fr0stbyte/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fr0stbyte/zookeeper&lt;/a&gt; radu/cloexec_on_c_client&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/407.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/407.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #407&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 431742cd8f1726c17e3afdedf553b79663294177&lt;br/&gt;
Author: Radu Brumariu &amp;lt;radu@groupon.com&amp;gt;&lt;br/&gt;
Date:   2017-10-25T18:24:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16219985" author="hadoopqa" created="Thu, 26 Oct 2017 05:24:41 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1120//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16221002" author="hadoopqa" created="Thu, 26 Oct 2017 18:47:38 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1122//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16222514" author="githubbot" created="Fri, 27 Oct 2017 15:03:19 +0000"  >&lt;p&gt;Github user fr0stbyte closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/407&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16222516" author="githubbot" created="Fri, 27 Oct 2017 15:04:05 +0000"  >&lt;p&gt;GitHub user fr0stbyte opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fr0stbyte/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fr0stbyte/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #410&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e7fb9fc9fb0140c35869af255d39e643597b517c&lt;br/&gt;
Author: Radu Brumariu &amp;lt;radu@groupon.com&amp;gt;&lt;br/&gt;
Date:   2017-10-25T18:24:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16222534" author="hadoopqa" created="Fri, 27 Oct 2017 15:17:40 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1125//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16222786" author="githubbot" created="Fri, 27 Oct 2017 20:47:38 +0000"  >&lt;p&gt;Github user afine commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @fr0stbyte &lt;/p&gt;

&lt;p&gt;    I see in the JIRA that this ticked arises from an issue related to running ZooKeeper Mesos. Would you be able to explain exactly why this is needed?&lt;/p&gt;</comment>
                            <comment id="16235179" author="githubbot" created="Thu, 2 Nov 2017 04:58:14 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @afine Thanks for looking at the PR&lt;br/&gt;
    Here is the bug tracked on Mesos side : &lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-4065&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MESOS-4065&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="16236559" author="githubbot" created="Thu, 2 Nov 2017 20:42:23 +0000"  >&lt;p&gt;Github user afine commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte Thanks for linking to the Mesos bug. Unfortunately, I am not familiar with the way Mesos handles processes and I think it is possible that other members of the community share my ignorance.&lt;/p&gt;

&lt;p&gt;    Would you mind describing the conditions that are necessary to reproduce this bug?&lt;/p&gt;</comment>
                            <comment id="16238782" author="githubbot" created="Sat, 4 Nov 2017 05:11:23 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte Reading some Stackoverflow about the flag (&lt;a href=&quot;https://stackoverflow.com/questions/22304631/what-is-the-purpose-to-set-sock-cloexec-flag-with-accept4-same-as-o-cloexec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/22304631/what-is-the-purpose-to-set-sock-cloexec-flag-with-accept4-same-as-o-cloexec&lt;/a&gt;), the change looks reasonable to me. However it would be beneficial to shed some light on how it&apos;s related to your scenario.&lt;/p&gt;</comment>
                            <comment id="16254198" author="githubbot" created="Wed, 15 Nov 2017 21:11:48 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This looks like a non-backward compatible change to me. That said I&apos;m not sure how many clients would rely on this behavior. thoughts?&lt;/p&gt;</comment>
                            <comment id="16254592" author="githubbot" created="Thu, 16 Nov 2017 01:20:58 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt I&apos;d have no problem making in backward compatible, but I am not sure how. Can you offer some guidance here ?&lt;br/&gt;
    @anmolnar In the description of &lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-4065&quot; title=&quot;slave FD for ZK tcp connection leaked to executor process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MESOS-4065&quot;&gt;MESOS-4065&lt;/a&gt; you can see 2 processes that share the same open file descriptor. In Linux ( Unix in general ) upon forking, the child inherits all the open files of the parent, unless the O_CLOEXEC option has been set on the file descriptor. My change uses the SOCK_CLOEXEC which is an atomic set of that flag. The alternative is to open it and then use `fcntl` to set the flag, but that leaves space for a race as a process could fork before.&lt;br/&gt;
    Since the child process does not need / makes use of the open file descriptor it is proper to close it before exec&apos;ing. I wouldn&apos;t say it&apos;s a functional bug, but rather good housekeeping ( afaict ).&lt;br/&gt;
    @afine I think in order to reproduce it, you need a process that uses the C client, then that forks and execs something else. To verify, look at the open file descriptors for the 2 processes and verify that the open socket to zookeeper is not available in the child.&lt;/p&gt;</comment>
                            <comment id="16256282" author="githubbot" created="Fri, 17 Nov 2017 01:29:23 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt; I am not sure how&lt;/p&gt;

&lt;p&gt;    Yea, same here I&apos;m afraid.&lt;/p&gt;

&lt;p&gt;    In thinking about it a bit perhaps what we could do is one of the following two option (might be more):&lt;/p&gt;

&lt;p&gt;    1)  add it with some extra tooling in autoconf (and probably now cmake since it was recently introduced). Basically: add a new flag that the user (person compiling the library) could use to enable/disable SOCK_CLOEXEC when running ./configure.&lt;/p&gt;

&lt;p&gt;    In 3.5 the default behavior would be to not use SOCK_CLOEXEC regardless whether it&apos;s supported or not (user can override default with the option). In 3.6 and later we&apos;d make SOCK_CLOEXEC the default and call it out as a potential issue as part of the release notes (disable with the option in this case).&lt;/p&gt;

&lt;p&gt;    2) it seems like we could do similar with a runtime property that the user could set in code prior to running zookeeper_init that would be global in nature. e.g. zoo_deterministic_conn_order&lt;/p&gt;

&lt;p&gt;    Again the defaults would be as specified in 1) above.&lt;/p&gt;

&lt;p&gt;    Thoughts?&lt;/p&gt;

</comment>
                            <comment id="16261485" author="githubbot" created="Tue, 21 Nov 2017 21:10:24 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt both options seem fine to me. I think would prefer the first one, that way if the library remains ABI compatible, the clients won&apos;t need to recompile.&lt;/p&gt;
</comment>
                            <comment id="16267799" author="githubbot" created="Mon, 27 Nov 2017 23:35:58 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt Let me know if the changes are inline with what you&apos;ve had in mind. Once we clear that, I will add the changes for 3.6&lt;/p&gt;</comment>
                            <comment id="16267818" author="hadoopqa" created="Mon, 27 Nov 2017 23:54:22 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1314//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16278977" author="githubbot" created="Tue, 5 Dec 2017 18:10:29 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt @anmolnar any suggestion on changes or does this look good ?&lt;/p&gt;</comment>
                            <comment id="16280249" author="githubbot" created="Wed, 6 Dec 2017 14:39:59 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte According to my tiny C knowledge, it looks good to me.&lt;/p&gt;</comment>
                            <comment id="16281053" author="githubbot" created="Wed, 6 Dec 2017 22:45:04 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I tested it with cmake and autotools based generation and the command lines work properly with agreed upon defaults. LGTM. +1.&lt;/p&gt;</comment>
                            <comment id="16281069" author="githubbot" created="Wed, 6 Dec 2017 22:55:29 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16281076" author="githubbot" created="Wed, 6 Dec 2017 22:59:13 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Committed to branch-3.5 and master. I tried applying to branch-3.4 but it wouldn&apos;t apply cleanly. Please submit another pull request for 3.4 and I&apos;ll review/commit that as well. Thanks @fr0stbyte !&lt;/p&gt;</comment>
                            <comment id="16281125" author="hudson" created="Wed, 6 Dec 2017 23:31:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3646 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3646/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3646/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt;: set SOCK_CLOEXEC on socket if defined (phunt: rev 665038e0698cd471a25b7ead4c8a50f767a3e7ed)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/c/configure.ac&lt;/li&gt;
	&lt;li&gt;(edit) src/c/cmake_config.h.in&lt;/li&gt;
	&lt;li&gt;(edit) src/c/CMakeLists.txt&lt;/li&gt;
	&lt;li&gt;(edit) src/c/src/zookeeper.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16283077" author="githubbot" created="Fri, 8 Dec 2017 05:22:09 +0000"  >&lt;p&gt;GitHub user fr0stbyte opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;

&lt;p&gt;    @phunt @anmolnar &lt;br/&gt;
    PR for 3.4 branch.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fr0stbyte/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fr0stbyte/zookeeper&lt;/a&gt; fr0stbyte/&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt;-3.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #427&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 025142999b3fee596d6f41d63e0076582cca539f&lt;br/&gt;
Author: Radu Brumariu &amp;lt;radu@groupon.com&amp;gt;&lt;br/&gt;
Date:   2017-10-25T18:24:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2338&quot; title=&quot;c bindings should create socket&amp;#39;s with SOCK_CLOEXEC to avoid fd leaks on fork/exec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2338&quot;&gt;&lt;del&gt;ZOOKEEPER-2338&lt;/del&gt;&lt;/a&gt; - set SOCK_CLOEXEC on socket if defined&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16283094" author="hadoopqa" created="Fri, 8 Dec 2017 05:59:04 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1336//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16284832" author="githubbot" created="Sat, 9 Dec 2017 17:01:01 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @anmolnar sorry, my editor is configured to strip the trailing white spaces . Do you need me to disable that?&lt;/p&gt;</comment>
                            <comment id="16285514" author="githubbot" created="Mon, 11 Dec 2017 05:14:29 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte no thanks, that&apos;s fine, I&apos;ve dug it out already.&lt;br/&gt;
    Going forward I suggest to make linter / indentation / whitespace changes in a commit separate from the code changes.&lt;/p&gt;</comment>
                            <comment id="16285693" author="githubbot" created="Mon, 11 Dec 2017 09:55:21 +0000"  >&lt;p&gt;Github user mfenes commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte could you please add a description to your PR so that everybody could understand the purpose of this change?&lt;/p&gt;</comment>
                            <comment id="16288006" author="githubbot" created="Tue, 12 Dec 2017 18:16:52 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    For this one I&apos;m fine with the whitespace as it also got into the trunk/3.5 commit.&lt;/p&gt;

&lt;p&gt;    It&apos;s unfortunate that github doesn&apos;t have an option to remove whitespace changes from the diff they show but you can get around this by diffing the commit locally. (which is what I typically do)&lt;/p&gt;

&lt;p&gt;    Agree with @mfenes &apos;s comment - even though this is a backport it&apos;s still nice to have. &lt;/p&gt;

&lt;p&gt;    Thanks @fr0stbyte !&lt;/p&gt;</comment>
                            <comment id="16288045" author="githubbot" created="Tue, 12 Dec 2017 18:42:01 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt @mfenes updated the initial comment of this PR. Let me know if you need me to move it into a separate comment&lt;/p&gt;</comment>
                            <comment id="16288071" author="githubbot" created="Tue, 12 Dec 2017 18:55:40 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte in future I believe you need to update the commit message, that doesn&apos;t seem to be updated along with the PR description I&apos;m afraid. (something to consider for future changes, I&apos;ll commit this as-is for now, esp as it matches what went into trunk...)&lt;/p&gt;</comment>
                            <comment id="16288266" author="githubbot" created="Tue, 12 Dec 2017 21:02:03 +0000"  >&lt;p&gt;Github user fr0stbyte commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @phunt thanks, will keep that in mind.&lt;/p&gt;</comment>
                            <comment id="16290016" author="githubbot" created="Wed, 13 Dec 2017 22:09:04 +0000"  >&lt;p&gt;Github user phunt commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427#discussion_r156800318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427#discussion_r156800318&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/configure.ac &amp;#8212;&lt;br/&gt;
    @@ -130,18 +130,66 @@ main()&lt;br/&gt;
      else&lt;br/&gt;
        exit(0);&lt;br/&gt;
     }&lt;br/&gt;
    -], AC_MSG_RESULT(yes) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ipv6=yes,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;/li&gt;
	&lt;li&gt;ipv6=no,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;br/&gt;
    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   ipv6=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   ipv6=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
        ipv6=no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     if test x&quot;$ipv6&quot; = xyes; then&lt;br/&gt;
       USEIPV6=&quot;-DZOO_IPV6_ENABLED&quot;&lt;br/&gt;
       AC_SUBST(USEIPV6)&lt;br/&gt;
     fi&lt;/p&gt;

&lt;p&gt;    +# use SOCK_CLOEXEC if available and wanted&lt;br/&gt;
    +AC_ARG_WITH(&lt;span class=&quot;error&quot;&gt;&amp;#91;sock_cloexec&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +[AS_HELP_STRING(&lt;span class=&quot;error&quot;&gt;&amp;#91;--with-sock-cloexec&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;build with SOCK_CLOEXEC flag set on the connections&amp;#93;&lt;/span&gt;)],&lt;br/&gt;
    +[],&lt;span class=&quot;error&quot;&gt;&amp;#91;with_sock_cloexec=no&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_MSG_CHECKING(&lt;span class=&quot;error&quot;&gt;&amp;#91;whether SOCK_CLOEXEC is available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_TRY_RUN([ /* is SOCK_CLOEXEC available ? */&lt;br/&gt;
    +#include &amp;lt;sys/types.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sys/socket.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;stdlib.h&amp;gt;&lt;br/&gt;
    +main()&lt;br/&gt;
    +&lt;/p&gt;
{
    +#ifdef SOCK_CLOEXEC
    +  exit(0);
    +#else
    +  exit(1);
    +#endif
    +}
&lt;p&gt;    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   has_sock_cloexec=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no)&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno &amp;amp;&amp;amp; test &quot;x$has_sock_cloexec&quot; = xno; then&lt;br/&gt;
    +  AC_MSG_WARN(&lt;span class=&quot;error&quot;&gt;&amp;#91;cannot use SOCK_CLOEXEC -- SOCK_CLOEXEC undefined on this platform&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  with_sock_cloexec=no&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno; then&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building with SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +else&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building without SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +AS_IF(&lt;span class=&quot;error&quot;&gt;&amp;#91;test x&amp;quot;$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;, [AC_DEFINE(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;Define to 1, if SOCK_CLOEXEC is defined and wanted&amp;#93;&lt;/span&gt;)])&lt;br/&gt;
    +AM_CONDITIONAL(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;test &amp;quot;x$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I believe you may have pulled this in by accident? It&apos;s not part of the 3.5/trunk patch. Please remove this section (if I read that right).&lt;/p&gt;</comment>
                            <comment id="16290026" author="githubbot" created="Wed, 13 Dec 2017 22:14:49 +0000"  >&lt;p&gt;Github user phunt commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427#discussion_r156801636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427#discussion_r156801636&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/configure.ac &amp;#8212;&lt;br/&gt;
    @@ -130,18 +130,66 @@ main()&lt;br/&gt;
      else&lt;br/&gt;
        exit(0);&lt;br/&gt;
     }&lt;br/&gt;
    -], AC_MSG_RESULT(yes) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ipv6=yes,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;/li&gt;
	&lt;li&gt;ipv6=no,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;br/&gt;
    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   ipv6=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   ipv6=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
        ipv6=no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     if test x&quot;$ipv6&quot; = xyes; then&lt;br/&gt;
       USEIPV6=&quot;-DZOO_IPV6_ENABLED&quot;&lt;br/&gt;
       AC_SUBST(USEIPV6)&lt;br/&gt;
     fi&lt;/p&gt;

&lt;p&gt;    +# use SOCK_CLOEXEC if available and wanted&lt;br/&gt;
    +AC_ARG_WITH(&lt;span class=&quot;error&quot;&gt;&amp;#91;sock_cloexec&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +[AS_HELP_STRING(&lt;span class=&quot;error&quot;&gt;&amp;#91;--with-sock-cloexec&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;build with SOCK_CLOEXEC flag set on the connections&amp;#93;&lt;/span&gt;)],&lt;br/&gt;
    +[],&lt;span class=&quot;error&quot;&gt;&amp;#91;with_sock_cloexec=no&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_MSG_CHECKING(&lt;span class=&quot;error&quot;&gt;&amp;#91;whether SOCK_CLOEXEC is available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_TRY_RUN([ /* is SOCK_CLOEXEC available ? */&lt;br/&gt;
    +#include &amp;lt;sys/types.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sys/socket.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;stdlib.h&amp;gt;&lt;br/&gt;
    +main()&lt;br/&gt;
    +&lt;/p&gt;
{
    +#ifdef SOCK_CLOEXEC
    +  exit(0);
    +#else
    +  exit(1);
    +#endif
    +}
&lt;p&gt;    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   has_sock_cloexec=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no)&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno &amp;amp;&amp;amp; test &quot;x$has_sock_cloexec&quot; = xno; then&lt;br/&gt;
    +  AC_MSG_WARN(&lt;span class=&quot;error&quot;&gt;&amp;#91;cannot use SOCK_CLOEXEC -- SOCK_CLOEXEC undefined on this platform&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  with_sock_cloexec=no&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno; then&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building with SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +else&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building without SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +AS_IF(&lt;span class=&quot;error&quot;&gt;&amp;#91;test x&amp;quot;$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;, [AC_DEFINE(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;Define to 1, if SOCK_CLOEXEC is defined and wanted&amp;#93;&lt;/span&gt;)])&lt;br/&gt;
    +AM_CONDITIONAL(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;test &amp;quot;x$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Aside from the the rest looks ok. Ready to commit once this item is addressed.&lt;/p&gt;</comment>
                            <comment id="16290385" author="githubbot" created="Thu, 14 Dec 2017 06:00:02 +0000"  >&lt;p&gt;Github user fr0stbyte commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427#discussion_r156860284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427#discussion_r156860284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/configure.ac &amp;#8212;&lt;br/&gt;
    @@ -130,18 +130,66 @@ main()&lt;br/&gt;
      else&lt;br/&gt;
        exit(0);&lt;br/&gt;
     }&lt;br/&gt;
    -], AC_MSG_RESULT(yes) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ipv6=yes,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;/li&gt;
	&lt;li&gt;ipv6=no,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;br/&gt;
    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   ipv6=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   ipv6=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
        ipv6=no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     if test x&quot;$ipv6&quot; = xyes; then&lt;br/&gt;
       USEIPV6=&quot;-DZOO_IPV6_ENABLED&quot;&lt;br/&gt;
       AC_SUBST(USEIPV6)&lt;br/&gt;
     fi&lt;/p&gt;

&lt;p&gt;    +# use SOCK_CLOEXEC if available and wanted&lt;br/&gt;
    +AC_ARG_WITH(&lt;span class=&quot;error&quot;&gt;&amp;#91;sock_cloexec&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +[AS_HELP_STRING(&lt;span class=&quot;error&quot;&gt;&amp;#91;--with-sock-cloexec&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;build with SOCK_CLOEXEC flag set on the connections&amp;#93;&lt;/span&gt;)],&lt;br/&gt;
    +[],&lt;span class=&quot;error&quot;&gt;&amp;#91;with_sock_cloexec=no&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_MSG_CHECKING(&lt;span class=&quot;error&quot;&gt;&amp;#91;whether SOCK_CLOEXEC is available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_TRY_RUN([ /* is SOCK_CLOEXEC available ? */&lt;br/&gt;
    +#include &amp;lt;sys/types.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sys/socket.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;stdlib.h&amp;gt;&lt;br/&gt;
    +main()&lt;br/&gt;
    +&lt;/p&gt;
{
    +#ifdef SOCK_CLOEXEC
    +  exit(0);
    +#else
    +  exit(1);
    +#endif
    +}
&lt;p&gt;    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   has_sock_cloexec=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no)&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno &amp;amp;&amp;amp; test &quot;x$has_sock_cloexec&quot; = xno; then&lt;br/&gt;
    +  AC_MSG_WARN(&lt;span class=&quot;error&quot;&gt;&amp;#91;cannot use SOCK_CLOEXEC -- SOCK_CLOEXEC undefined on this platform&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  with_sock_cloexec=no&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno; then&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building with SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +else&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building without SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +AS_IF(&lt;span class=&quot;error&quot;&gt;&amp;#91;test x&amp;quot;$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;, [AC_DEFINE(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;Define to 1, if SOCK_CLOEXEC is defined and wanted&amp;#93;&lt;/span&gt;)])&lt;br/&gt;
    +AM_CONDITIONAL(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;test &amp;quot;x$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    @phunt I think it was : &lt;a href=&quot;https://github.com/apache/zookeeper/pull/410/files#diff-79599273360e5b5ede514927c8033356R182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/410/files#diff-79599273360e5b5ede514927c8033356R182&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16293461" author="githubbot" created="Sat, 16 Dec 2017 00:19:36 +0000"  >&lt;p&gt;Github user phunt commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427#discussion_r157325096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427#discussion_r157325096&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/configure.ac &amp;#8212;&lt;br/&gt;
    @@ -130,18 +130,66 @@ main()&lt;br/&gt;
      else&lt;br/&gt;
        exit(0);&lt;br/&gt;
     }&lt;br/&gt;
    -], AC_MSG_RESULT(yes) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ipv6=yes,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;/li&gt;
	&lt;li&gt;ipv6=no,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;br/&gt;
    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   ipv6=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   ipv6=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
        ipv6=no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     if test x&quot;$ipv6&quot; = xyes; then&lt;br/&gt;
       USEIPV6=&quot;-DZOO_IPV6_ENABLED&quot;&lt;br/&gt;
       AC_SUBST(USEIPV6)&lt;br/&gt;
     fi&lt;/p&gt;

&lt;p&gt;    +# use SOCK_CLOEXEC if available and wanted&lt;br/&gt;
    +AC_ARG_WITH(&lt;span class=&quot;error&quot;&gt;&amp;#91;sock_cloexec&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +[AS_HELP_STRING(&lt;span class=&quot;error&quot;&gt;&amp;#91;--with-sock-cloexec&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;build with SOCK_CLOEXEC flag set on the connections&amp;#93;&lt;/span&gt;)],&lt;br/&gt;
    +[],&lt;span class=&quot;error&quot;&gt;&amp;#91;with_sock_cloexec=no&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_MSG_CHECKING(&lt;span class=&quot;error&quot;&gt;&amp;#91;whether SOCK_CLOEXEC is available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_TRY_RUN([ /* is SOCK_CLOEXEC available ? */&lt;br/&gt;
    +#include &amp;lt;sys/types.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sys/socket.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;stdlib.h&amp;gt;&lt;br/&gt;
    +main()&lt;br/&gt;
    +&lt;/p&gt;
{
    +#ifdef SOCK_CLOEXEC
    +  exit(0);
    +#else
    +  exit(1);
    +#endif
    +}
&lt;p&gt;    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   has_sock_cloexec=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no)&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno &amp;amp;&amp;amp; test &quot;x$has_sock_cloexec&quot; = xno; then&lt;br/&gt;
    +  AC_MSG_WARN(&lt;span class=&quot;error&quot;&gt;&amp;#91;cannot use SOCK_CLOEXEC -- SOCK_CLOEXEC undefined on this platform&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  with_sock_cloexec=no&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno; then&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building with SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +else&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building without SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +AS_IF(&lt;span class=&quot;error&quot;&gt;&amp;#91;test x&amp;quot;$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;, [AC_DEFINE(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;Define to 1, if SOCK_CLOEXEC is defined and wanted&amp;#93;&lt;/span&gt;)])&lt;br/&gt;
    +AM_CONDITIONAL(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;test &amp;quot;x$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Sorry I was unclear @fr0stbyte - I meant the following:&lt;/p&gt;

&lt;p&gt;    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    +saved_LIBS=&quot;$LIBS&quot;&lt;br/&gt;
    +LIBS=&quot;&quot;&lt;br/&gt;
    +AC_CHECK_LIB(rt, clock_gettime)&lt;br/&gt;
    +CLOCK_GETTIME_LIBS=$LIBS&lt;br/&gt;
    +AC_SUBST(CLOCK_GETTIME_LIBS)&lt;br/&gt;
    +LIBS=&quot;$saved_LIBS&quot;&lt;/p&gt;

&lt;p&gt;    those lines are included in this patch, but not #410 &lt;/p&gt;

&lt;p&gt;    Could you remove them? Or am I totally missing something?&lt;/p&gt;</comment>
                            <comment id="16331511" author="githubbot" created="Fri, 19 Jan 2018 00:38:43 +0000"  >&lt;p&gt;Github user phunt commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/427#discussion_r162510701&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/427#discussion_r162510701&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/configure.ac &amp;#8212;&lt;br/&gt;
    @@ -130,18 +130,66 @@ main()&lt;br/&gt;
      else&lt;br/&gt;
        exit(0);&lt;br/&gt;
     }&lt;br/&gt;
    -], AC_MSG_RESULT(yes) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ipv6=yes,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;/li&gt;
	&lt;li&gt;ipv6=no,&lt;/li&gt;
	&lt;li&gt;AC_MSG_RESULT(no)&lt;br/&gt;
    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   ipv6=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   ipv6=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
        ipv6=no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     if test x&quot;$ipv6&quot; = xyes; then&lt;br/&gt;
       USEIPV6=&quot;-DZOO_IPV6_ENABLED&quot;&lt;br/&gt;
       AC_SUBST(USEIPV6)&lt;br/&gt;
     fi&lt;/p&gt;

&lt;p&gt;    +# use SOCK_CLOEXEC if available and wanted&lt;br/&gt;
    +AC_ARG_WITH(&lt;span class=&quot;error&quot;&gt;&amp;#91;sock_cloexec&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +[AS_HELP_STRING(&lt;span class=&quot;error&quot;&gt;&amp;#91;--with-sock-cloexec&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;build with SOCK_CLOEXEC flag set on the connections&amp;#93;&lt;/span&gt;)],&lt;br/&gt;
    +[],&lt;span class=&quot;error&quot;&gt;&amp;#91;with_sock_cloexec=no&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_MSG_CHECKING(&lt;span class=&quot;error&quot;&gt;&amp;#91;whether SOCK_CLOEXEC is available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +AC_TRY_RUN([ /* is SOCK_CLOEXEC available ? */&lt;br/&gt;
    +#include &amp;lt;sys/types.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sys/socket.h&amp;gt;&lt;br/&gt;
    +#include &amp;lt;stdlib.h&amp;gt;&lt;br/&gt;
    +main()&lt;br/&gt;
    +&lt;/p&gt;
{
    +#ifdef SOCK_CLOEXEC
    +  exit(0);
    +#else
    +  exit(1);
    +#endif
    +}
&lt;p&gt;    +], AC_MSG_RESULT(yes)&lt;br/&gt;
    +   has_sock_cloexec=yes,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no,&lt;br/&gt;
    +   AC_MSG_RESULT(no)&lt;br/&gt;
    +   has_sock_cloexec=no)&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno &amp;amp;&amp;amp; test &quot;x$has_sock_cloexec&quot; = xno; then&lt;br/&gt;
    +  AC_MSG_WARN(&lt;span class=&quot;error&quot;&gt;&amp;#91;cannot use SOCK_CLOEXEC -- SOCK_CLOEXEC undefined on this platform&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  with_sock_cloexec=no&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +if test &quot;x$with_sock_cloexec&quot; != xno; then&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building with SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +else&lt;br/&gt;
    +AC_MSG_NOTICE(&lt;span class=&quot;error&quot;&gt;&amp;#91;building without SOCK_CLOEXEC&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +fi&lt;br/&gt;
    +&lt;br/&gt;
    +AS_IF(&lt;span class=&quot;error&quot;&gt;&amp;#91;test x&amp;quot;$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;, [AC_DEFINE(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;Define to 1, if SOCK_CLOEXEC is defined and wanted&amp;#93;&lt;/span&gt;)])&lt;br/&gt;
    +AM_CONDITIONAL(&lt;span class=&quot;error&quot;&gt;&amp;#91;SOCK_CLOEXEC_ENABLED&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;test &amp;quot;x$with_sock_cloexec&amp;quot; != xno&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +&lt;br/&gt;
    +# Determine which libraries we need to use clock_gettime&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    @fr0stbyte I&apos;d still like to get this committed - does my most recent comment make sense or am I missing something?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12918151">MESOS-4065</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2plxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>