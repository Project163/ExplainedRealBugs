<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:57:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2212] distributed race condition related to QV version</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2212</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When a joiner is listed as an observer in an initial config,&lt;br/&gt;
the joiner should become a non-voting follower (not an observer) until reconfig is triggered. &lt;a href=&quot;http://zookeeper.apache.org/doc/trunk/zookeeperReconfig.html#sc_reconfig_general&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found a distributed race-condition situation where an observer keeps being an observer and cannot become a non-voting follower.&lt;/p&gt;

&lt;p&gt;This race condition happens when an observer receives an UPTODATE Quorum Packet from the leader:2888/tcp &lt;b&gt;after&lt;/b&gt; receiving a Notification FLE Packet of which n.config version is larger than the observer&apos;s one from leader:3888/tcp.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Detail&quot;&gt;&lt;/a&gt;Detail&lt;/h4&gt;
&lt;ul&gt;
	&lt;li&gt;Problem: An observer cannot become a non-voting follower&lt;/li&gt;
	&lt;li&gt;Cause: Cannot restart FLE&lt;/li&gt;
	&lt;li&gt;Cause: In &lt;tt&gt;QuorumPeer.run()&lt;/tt&gt;, cannot shutdown &lt;tt&gt;Observer&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java#L1014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Cause: In &lt;tt&gt;QuorumPeer.run()&lt;/tt&gt;, cannot return from &lt;tt&gt;Observer.observeLeader()&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java#L1010&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Cause: In &lt;tt&gt;Observer.observeLeader()&lt;/tt&gt;, &lt;tt&gt;Learner.syncWithLeader()&lt;/tt&gt; does not throw an exception of &quot;changes proposed in reconfig&quot; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/Observer.java#L79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Cause: In &lt;tt&gt;switch(qp.getType()) case UPTODATE&lt;/tt&gt; of &lt;tt&gt;Learner.syncWithLeader()&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/Learner.java#L492-507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;, &lt;tt&gt;QuorumPeer.processReconfig()&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java#L1644&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;returns false with a log message like &lt;a href=&quot;https://github.com/osrg/earthquake/blob/v0.1/example/zk-found-bug.ether/example-output/3.REPRODUCED/zk2.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;2 setQuorumVerifier called with known or old config 4294967296. Current version: 4294967296&quot;&lt;/a&gt;. &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java#L1369&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;br/&gt;
,&lt;/li&gt;
	&lt;li&gt;Cause: The observer have already received a Notification Packet(&lt;tt&gt;n.config.version=4294967296&lt;/tt&gt;) and invoked &lt;tt&gt;QuorumPeer.processReconfig()&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/zookeeper/blob/98a3cabfa279833b81908d72f1c10ee9f598a045/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java#L291-304&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;(Link)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;&lt;a name=&quot;HowIfoundthisbug&quot;&gt;&lt;/a&gt;How I found this bug&lt;/h4&gt;
&lt;p&gt;I found this bug using &lt;a href=&quot;http://osrg.github.io/earthquake/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Earthquake&lt;/a&gt;, our open-source dynamic model checker for real implementations of distributed systems.&lt;/p&gt;

&lt;p&gt;Earthquakes permutes C/Java function calls, Ethernet packets, and injected fault events in various orders so as to find implementation-level bugs of the distributed system.&lt;/p&gt;

&lt;p&gt;When Earthquake finds a bug, Earthquake automatically records &lt;a href=&quot;https://github.com/osrg/earthquake/blob/v0.1/example/zk-found-bug.ether/example-output/3.REPRODUCED/json&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the event history&lt;/a&gt; and helps the user to analyze which permutation of events triggers the bug.&lt;/p&gt;

&lt;p&gt;I analyzed Earthquake&apos;s event histories and found that the bug is triggered when an observer receives an UPTODATE &lt;b&gt;after&lt;/b&gt; receiving a specific kind of FLE packet.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Howtoreproducethisbug&quot;&gt;&lt;/a&gt;How to reproduce this bug&lt;/h4&gt;
&lt;p&gt;You can also easily reproduce the bug using Earthquake.&lt;br/&gt;
I made a Docker container &lt;a href=&quot;https://registry.hub.docker.com/u/osrg/earthquake-zookeeper-2212/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;osrg/earthquake-zookeeper-2212&lt;/a&gt; on Docker hub:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    host$ sudo modprobe openvswitch
    host$ docker run --privileged -t -i --rm osrg/earthquake-zookeeper-2212
    guest$ ./000-prepare.sh
    [INFO] Starting Earthquake Ethernet Switch
    [INFO] Starting Earthquake Orchestrator
    [INFO] Starting Earthquake Ethernet Inspector
    [IMPORTANT] Please kill the processes (&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;=1234, orchestrator=1235, and inspector=1236) after you finished all of the experiments
    [IMPORTANT] Please &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; to 100-run-experiment.sh..
    guest$ ./100-run-experiment.sh
    [IMPORTANT] THE BUG WAS REPRODUCED!
    guest$ kill -9 1234 1235 1236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that &lt;tt&gt;--privileged&lt;/tt&gt; is needed, as this container uses Docker-in-Docker.&lt;/p&gt;

&lt;p&gt;For further information about reproducing this bug, please refer to &lt;a href=&quot;https://github.com/osrg/earthquake/blob/v0.1/example/zk-found-bug.ether&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/osrg/earthquake/blob/v0.1/example/zk-found-bug.ether&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12836749">ZOOKEEPER-2212</key>
            <summary>distributed race condition related to QV version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="suda">Akihiro Suda</assignee>
                                    <reporter username="suda">Akihiro Suda</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jun 2015 06:45:23 +0000</created>
                <updated>Fri, 14 Aug 2015 04:12:35 +0000</updated>
                            <resolved>Mon, 15 Jun 2015 23:08:30 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14580598" author="shralex" created="Wed, 10 Jun 2015 14:48:28 +0000"  >&lt;p&gt;Thanks a lot for finding this!&lt;/p&gt;</comment>
                            <comment id="14581511" author="shralex" created="Thu, 11 Jun 2015 06:21:27 +0000"  >&lt;p&gt;I&apos;m not sure how to solve this yet, so any suggestions are welcome.&lt;/p&gt;

&lt;p&gt;Intuitively, once a server has completed leader election, FLE should not be controlling its configuration. The reason why the code processing new configurations in FLE exists is to allow a server to &quot;catch up&quot; with the right members of an ensemble. If its already connected to the leader (or leading) this is not necessary. Otherwise, for example in case of a configuration change, a server may get an FLE message with a future config version before the reconfiguration commit arrives, which may be problematic similarly to the scenario here with observers. &lt;/p&gt;

&lt;p&gt;So my current thought is perhaps to do config changes in FLE only if the server itself is LOOKING.&lt;/p&gt;
</comment>
                            <comment id="14585513" author="suda" created="Mon, 15 Jun 2015 06:54:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, Thank you for the suggestion.&lt;/p&gt;

&lt;p&gt;Your suggestion seems exactly right!&lt;br/&gt;
The attached patch that implements your suggestion seems to resolve the bug.&lt;/p&gt;


&lt;p&gt;FYI Just in case of other unknown race conditions, I tested this patch with Earthquake for 50 times, and fortunately it looks fine.&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;host$ sudo modprobe openvswitch&lt;br/&gt;
host$ docker run --privileged -t -i --rm -v $HOME:/mnt/host osrg/earthquake-zookeeper-2212&lt;br/&gt;
guest$ pushd example/zk-found-bug.ether/zk_testbed/zookeeper&lt;br/&gt;
guest$ git am /mnt/host/PATCH.patch&lt;br/&gt;
guest$ popd&lt;br/&gt;
guest$ ./000-prepare.sh&lt;br/&gt;
guest$ (for f in $(seq 1 50);do ./100-run-experiment.sh; done) 2&amp;gt;&amp;amp;1 | tee /tmp/log&lt;br/&gt;
guest$ grep REPRODUCED /tmp/log | wc -l&lt;br/&gt;
0 &amp;lt;--- The bug is resolved&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14585524" author="hadoopqa" created="Mon, 15 Jun 2015 07:11:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739553/0001-ZOOKEEPER-2212-distributed-race-condition-related-to.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739553/0001-ZOOKEEPER-2212-distributed-race-condition-related-to.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1685200.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2769//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2769//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14585525" author="shralex" created="Mon, 15 Jun 2015 07:12:19 +0000"  >&lt;p&gt;Thanks a lot, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;. I&apos;ve marked this as &quot;patch available&quot; to trigger automatic tests.&lt;br/&gt;
Since you&apos;ve already submitted a patch, I&apos;m assigning the issue to you. &lt;br/&gt;
Hope this is ok, otherwise please feel free to assign back to me.&lt;/p&gt;</comment>
                            <comment id="14585549" author="hadoopqa" created="Mon, 15 Jun 2015 07:51:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739558/ZOOKEEPER-2212-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739558/ZOOKEEPER-2212-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1685200.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2770//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2770//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14585616" author="hadoopqa" created="Mon, 15 Jun 2015 08:18:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739562/ZOOKEEPER-2212-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739562/ZOOKEEPER-2212-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1685200.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2771//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14585736" author="suda" created="Mon, 15 Jun 2015 10:11:37 +0000"  >&lt;p&gt;&lt;tt&gt;ReconfigRecoveryTest.testCurrentObserverIsParticipantInNewConfig&lt;/tt&gt; failed. I will check this later.&lt;/p&gt;</comment>
                            <comment id="14585737" author="suda" created="Mon, 15 Jun 2015 10:11:38 +0000"  >&lt;p&gt;&lt;tt&gt;ReconfigRecoveryTest.testCurrentObserverIsParticipantInNewConfig&lt;/tt&gt; failed. I will check this later.&lt;/p&gt;</comment>
                            <comment id="14587032" author="rgs" created="Mon, 15 Jun 2015 22:25:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;: the 0001-&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2212&quot; title=&quot;distributed race condition related to QV version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2212&quot;&gt;&lt;del&gt;ZOOKEEPER-2212&lt;/del&gt;&lt;/a&gt;-distributed-race-condition-related-to.patch file is in git-format-patch format, mind creating it with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ git diff --no-prefix HEAD~1.. &amp;gt; ZOOKEEPER-2212.patch
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so that it can be applied? Thanks!&lt;/p&gt;</comment>
                            <comment id="14587038" author="shralex" created="Mon, 15 Jun 2015 22:28:33 +0000"  >&lt;p&gt;Raul, the latest patch (ending with v3) was applied correctly.&lt;/p&gt;</comment>
                            <comment id="14587043" author="rgs" created="Mon, 15 Jun 2015 22:30:34 +0000"  >&lt;p&gt;Heh, some how i misread the dates. Sorry about that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;! If I can get your +1 I&apos;ll go ahead and merge it. &lt;/p&gt;</comment>
                            <comment id="14587080" author="shralex" created="Mon, 15 Jun 2015 22:50:22 +0000"  >&lt;p&gt;+1 Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;The failing test has been failing on Hudson intermittently for a while. Locally this test passes for me with the patch.&lt;/p&gt;
</comment>
                            <comment id="14587082" author="shralex" created="Mon, 15 Jun 2015 22:50:44 +0000"  >&lt;p&gt;thanks, Raul!&lt;/p&gt;</comment>
                            <comment id="14587099" author="shralex" created="Mon, 15 Jun 2015 23:03:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;, perhaps your tool can somehow help in debugging &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2172&quot; title=&quot;Cluster crashes when reconfig a new node as a participant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2172&quot;&gt;&lt;del&gt;ZOOKEEPER-2172&lt;/del&gt;&lt;/a&gt; ? &lt;/p&gt;</comment>
                            <comment id="14587109" author="rgs" created="Mon, 15 Jun 2015 23:08:30 +0000"  >&lt;p&gt;Merged:&lt;/p&gt;

&lt;p&gt;trunk &lt;a href=&quot;https://github.com/apache/zookeeper/commit/ec056d3c3a18b862d0cd83296b7d4319652b0b1c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/ec056d3c3a18b862d0cd83296b7d4319652b0b1c&lt;/a&gt;&lt;br/&gt;
3.5 &lt;a href=&quot;https://github.com/apache/zookeeper/commit/87c43f0aac1b01814a86ea135fda50076e1e3432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/87c43f0aac1b01814a86ea135fda50076e1e3432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14587327" author="suda" created="Tue, 16 Jun 2015 02:03:17 +0000"  >&lt;p&gt;Thank you a lot for merging!&lt;/p&gt;</comment>
                            <comment id="14587329" author="suda" created="Tue, 16 Jun 2015 02:04:39 +0000"  >&lt;p&gt;Thank you for information!&lt;/p&gt;

&lt;p&gt;The failing test seems under discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2080&quot; title=&quot;Fix deadlock in dynamic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2080&quot;&gt;&lt;del&gt;ZOOKEEPER-2080&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="14587338" author="suda" created="Tue, 16 Jun 2015 02:15:14 +0000"  >&lt;p&gt;Thank you a lot for suggestion!&lt;/p&gt;

&lt;p&gt;Actually, I found this bug by accident while tackling &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2172&quot; title=&quot;Cluster crashes when reconfig a new node as a participant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2172&quot;&gt;&lt;del&gt;ZOOKEEPER-2172&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m still trying to refine workload (reconfig + some write ops) so as to reproduce &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2172&quot; title=&quot;Cluster crashes when reconfig a new node as a participant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2172&quot;&gt;&lt;del&gt;ZOOKEEPER-2172&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14587866" author="hudson" created="Tue, 16 Jun 2015 10:59:05 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2728 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2728/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2728/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2212&quot; title=&quot;distributed race condition related to QV version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2212&quot;&gt;&lt;del&gt;ZOOKEEPER-2212&lt;/del&gt;&lt;/a&gt;: distributed race condition related to QV version&lt;br/&gt;
(Akihiro Suda via rgs) (rgs: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1685685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1685685&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14605946" author="shralex" created="Mon, 29 Jun 2015 17:32:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;, any chance your tool can help with the test failure we&apos;re seeing here and elsewhere? &lt;/p&gt;

&lt;p&gt;org.apache.zookeeper.server.quorum.ReconfigRecoveryTest.testCurrentObserverIsParticipantInNewConfig&lt;/p&gt;

&lt;p&gt;it may be easier than the race condition in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2172&quot; title=&quot;Cluster crashes when reconfig a new node as a participant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2172&quot;&gt;&lt;del&gt;ZOOKEEPER-2172&lt;/del&gt;&lt;/a&gt; since here you can see all the input state and performed&lt;br/&gt;
operations. &lt;/p&gt;</comment>
                            <comment id="14606907" author="suda" created="Tue, 30 Jun 2015 03:11:26 +0000"  >&lt;p&gt;Thanks for the proposal!&lt;br/&gt;
I will try to apply my tool to testCurrentObserverIsParticipantInNewConfig this week.&lt;/p&gt;
</comment>
                            <comment id="14696440" author="suda" created="Fri, 14 Aug 2015 04:12:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, sorry for late reply.&lt;/p&gt;

&lt;p&gt;Please refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2080?focusedCommentId=14696437&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14696437&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;my this comment&lt;/a&gt; in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2080&quot; title=&quot;Fix deadlock in dynamic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2080&quot;&gt;&lt;del&gt;ZOOKEEPER-2080&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I&apos;m not sure how to resolve the bug yet, but I somehow found out that the bug is related to QCnxM/FLE.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12739553" name="0001-ZOOKEEPER-2212-distributed-race-condition-related-to.patch" size="2926" author="suda" created="Mon, 15 Jun 2015 06:54:09 +0000"/>
                            <attachment id="12739558" name="ZOOKEEPER-2212-v2.patch" size="2351" author="suda" created="Mon, 15 Jun 2015 07:49:41 +0000"/>
                            <attachment id="12739562" name="ZOOKEEPER-2212-v3.patch" size="2373" author="suda" created="Mon, 15 Jun 2015 08:02:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/osrg/earthquake/tree/v0.1/example/zk-found-bug.ether]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fv5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>