<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:58:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-1029] C client bug in zookeeper_init (if bad hostname is given)</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1029</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;If you give invalid hostname to zookeeper_init method, it&apos;s not able to resolve it, and it tries to do the cleanup (free buffer/completion lists/etc) . The adaptor_init() is not called for this code path, so the lock,cond variables (for adaptor, completion lists) are not initialized.&lt;/p&gt;

&lt;p&gt;As part of the cleanup it&apos;s trying to clean up some buffers and acquires locks and unlocks (where the locks have not yet been initialized, so unlocking fails) &lt;br/&gt;
    lock_completion_list(&amp;amp;zh-&amp;gt;sent_requests); -&#61664; pthread_mutex/cond not initialized&lt;br/&gt;
    tmp_list = zh-&amp;gt;sent_requests;&lt;br/&gt;
    zh-&amp;gt;sent_requests.head = 0;&lt;br/&gt;
    zh-&amp;gt;sent_requests.last = 0;&lt;br/&gt;
    unlock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);  &#61664; trying to broadcast here on uninitialized cond&lt;/p&gt;

&lt;p&gt;It should do error checking to see if locking succeeds before unlocking it. If Locking fails, then appropriate error handling has to be done.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502418">ZOOKEEPER-1029</key>
            <summary>C client bug in zookeeper_init (if bad hostname is given)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Paiva Junqueira</assignee>
                                    <reporter username="dheerajagrawal">Dheeraj Agrawal</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Mar 2011 20:47:43 +0000</created>
                <updated>Tue, 25 Dec 2018 09:42:48 +0000</updated>
                            <resolved>Fri, 11 Dec 2015 20:15:56 +0000</resolved>
                                    <version>3.3.2</version>
                    <version>3.4.6</version>
                    <version>3.5.0</version>
                                    <fixVersion>3.4.7</fixVersion>
                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>18</watches>
                                                                                                                <comments>
                            <comment id="13445463" author="rdermer" created="Thu, 30 Aug 2012 23:57:18 +0000"  >&lt;p&gt;zoo_multi and zoo_amulti crash for the same reason.  Made some local fixes here.&lt;/p&gt;</comment>
                            <comment id="13445933" author="dheerajagrawal" created="Fri, 31 Aug 2012 13:49:39 +0000"  >&lt;p&gt;Is it possible to submit a patch for this if it has been fixed?&lt;/p&gt;</comment>
                            <comment id="13585202" author="bionicbeagle" created="Sat, 23 Feb 2013 19:43:59 +0000"  >&lt;p&gt;This still happens with latest (3.4.x). On Windows it actually crashes even earlier actually, at the inital lock. &lt;/p&gt;

&lt;p&gt;The cleanup code should ideally detect that the lists haven&apos;t been initialized and skip the teardown logic. From a cursory look it looks like this might require some explicit flags to indicate the current state to the cleanup code.&lt;/p&gt;

&lt;p&gt;I&apos;d have a go myself but I am unfortunately very new to the codebase, and it seems like there&apos;s not a whole lot of interest in fixing this fairly serious issue... which in turn makes me wonder if I should use Zookeeper from C/C++! Because if this doesn&apos;t get fixed, who knows what other issues exist?&lt;/p&gt;</comment>
                            <comment id="14511654" author="stevenschlansker" created="Fri, 24 Apr 2015 20:16:00 +0000"  >&lt;p&gt;This causes serious issues with clustering software e.g. Mesos has a critical bug open over this:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-2186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MESOS-2186&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14586458" author="stevenschlansker" created="Mon, 15 Jun 2015 18:35:21 +0000"  >&lt;p&gt;We just had an hour long outage of our production Mesos cluster due to this bug.  Is there any hope for a fix?  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14586493" author="rgs" created="Mon, 15 Jun 2015 18:55:48 +0000"  >&lt;p&gt;The ZooKeeper client should probably just keep retrying the lookups from the IO thread (i.e.: it could very well be transient). I don&apos;t think a failed DNS lookup should be coupled with failing the ZK handler (at all). &lt;/p&gt;</comment>
                            <comment id="14621325" author="stevenschlansker" created="Thu, 9 Jul 2015 21:41:04 +0000"  >&lt;p&gt;Doubly so if only one of the hostnames does not resolve &amp;#8211; in a cluster, name resolution failure should be at most a warning as long as at least one &quot;in-sync&quot; server is reachable.&lt;/p&gt;</comment>
                            <comment id="14700149" author="stevenschlansker" created="Mon, 17 Aug 2015 20:13:19 +0000"  >&lt;p&gt;I am raising the priority of this issue to &apos;Blocker&apos; as it 1) is a complete crash of the ZK client 2) affects multiple users 3) affects production stability 4) has been open for a very long time.  Hopefully it can be considered for the next releases of the 3.4.x and 3.5.x series?&lt;/p&gt;</comment>
                            <comment id="14734539" author="antmat" created="Tue, 8 Sep 2015 09:54:20 +0000"  >&lt;p&gt;We have the same problem. We use zookeper in cocaine cloud engine and cocaine-runtime can not start if one of the zk node is unresolvable(f.e. hostname changed) despite the fact that we have zk quorum.&lt;/p&gt;</comment>
                            <comment id="14962527" author="rgs" created="Sun, 18 Oct 2015 17:41:15 +0000"  >&lt;p&gt;Ok, so the bug is that we don&apos;t initialize the zh struct after calling calloc() in zookeeper_init:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/blob/branch-3.4/src/c/src/zookeeper.c#L788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/branch-3.4/src/c/src/zookeeper.c#L788&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since we don&apos;t, zh-&amp;gt;adaptor_priv might not be NULL, which means that when doing the following chain of calls:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;destroy() -&amp;gt; cleanup_bufs() -&amp;gt; enter_critical()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;zh-&amp;gt;adaptor_priv might be != NULL:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;void enter_critical(zhandle_t* zh)
{
    struct adaptor_threads *adaptor = zh-&amp;gt;adaptor_priv;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(adaptor)
        pthread_mutex_lock(&amp;amp;adaptor-&amp;gt;zh_lock);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At which point, the World crumbles into pieces. So memset() should be all we need to be able to safely cleanup after a failed.&lt;/p&gt;

&lt;p&gt;Still haven&apos;t looked at &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdermer&quot; class=&quot;user-hover&quot; rel=&quot;rdermer&quot;&gt;rdermer&lt;/a&gt;&apos;s case for zoo_multi and zoo_amulti. Attaching a patch for the first case. &lt;/p&gt;</comment>
                            <comment id="14962534" author="rgs" created="Sun, 18 Oct 2015 17:55:11 +0000"  >&lt;p&gt;The patch also fixes broken calls to LOG_DEBUG (due to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2253&quot; title=&quot;C asserts ordering of ping requests, while Java client does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2253&quot;&gt;&lt;del&gt;ZOOKEEPER-2253&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Lets get this in so I can cut an RC for 3.4.7.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cchen&quot; class=&quot;user-hover&quot; rel=&quot;cchen&quot;&gt;cchen&lt;/a&gt; (about the broken LOG_DEBUG calls from &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2253&quot; title=&quot;C asserts ordering of ping requests, while Java client does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2253&quot;&gt;&lt;del&gt;ZOOKEEPER-2253&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14962612" author="rgs" created="Sun, 18 Oct 2015 20:26:48 +0000"  >&lt;p&gt;I take that back, calloc() does initialize the memory to zero. Hmm, let me try to build a repro. &lt;/p&gt;</comment>
                            <comment id="14962615" author="rgs" created="Sun, 18 Oct 2015 20:32:53 +0000"  >&lt;p&gt;Actually, I can&apos;t repro this using &lt;a href=&quot;https://gist.github.com/rgs1/998684a0e93c072cb65d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/rgs1/998684a0e93c072cb65d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Can someone provide a repro?&lt;/p&gt;</comment>
                            <comment id="14962624" author="fpj" created="Sun, 18 Oct 2015 20:54:55 +0000"  >&lt;p&gt;Does it mean that if you pass a bad hostname, the client doesn&apos;t crash as this issue describes?&lt;/p&gt;</comment>
                            <comment id="14962628" author="rgs" created="Sun, 18 Oct 2015 21:03:22 +0000"  >&lt;p&gt;Okey, so re-reading the initial description it is true that we don&apos;t check if the locks have been properly initialized, but even if that&apos;s wrong, it shouldn&apos;t crash. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenschlansker&quot; class=&quot;user-hover&quot; rel=&quot;stevenschlansker&quot;&gt;stevenschlansker&lt;/a&gt;: could you provide a repro for the mesos case you report?&lt;/p&gt;</comment>
                            <comment id="14962642" author="fpj" created="Sun, 18 Oct 2015 21:39:56 +0000"  >&lt;p&gt;From the description of the issue, the problem is that we do this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    if (zh-&amp;gt;hostname == 0) {
        goto abort;
    }
    if(getaddrs(zh)!=0) {
        goto abort;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;before calling adaptor_init. I&apos;m wondering if the problem is that in the lock and unlock calls we don&apos;t have anything in in sent_requests:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// In free_completions called from abort-&amp;gt;destroy-&amp;gt;cleanup_bufs:

    lock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);
    tmp_list = zh-&amp;gt;sent_requests;
    zh-&amp;gt;sent_requests.head = 0;
    zh-&amp;gt;sent_requests.last = 0;
    unlock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);

// Lock/Unlock calls
void lock_completion_list(completion_head_t *l)
{
    pthread_mutex_lock(&amp;amp;l-&amp;gt;lock);
}
void unlock_completion_list(completion_head_t *l)
{
    pthread_cond_broadcast(&amp;amp;l-&amp;gt;cond);
    pthread_mutex_unlock(&amp;amp;l-&amp;gt;lock);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14962650" author="rgs" created="Sun, 18 Oct 2015 22:04:58 +0000"  >&lt;p&gt;But that shouldn&apos;t cause a crash, if cond and lock are NULL then pthread_cond_broadcast and pthread_mutex_lock will just return EINVAL.&lt;/p&gt;

&lt;p&gt;It&apos;s still needs to be fixed, but the MESOS related problem seems to cause a crasher. I want to separate the issues. &lt;/p&gt;</comment>
                            <comment id="14963012" author="fpj" created="Mon, 19 Oct 2015 09:00:42 +0000"  >&lt;p&gt;I was actually referring to l being null, not cond and lock. &lt;/p&gt;</comment>
                            <comment id="14963444" author="rgs" created="Mon, 19 Oct 2015 15:10:55 +0000"  >&lt;p&gt;But that&apos;s not correct, sent_requests is a struct (not a struct *) with cond and lock members. It&apos;s initialized to 0 as part of the calloc call(). So there won&apos;t be a NULL pointer dereference.&lt;/p&gt;

&lt;p&gt;I think the Mesos crasher is not in ZK, but in Mesos proper.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinod%40twitter.com&quot; class=&quot;user-hover&quot; rel=&quot;vinod@twitter.com&quot;&gt;vinod@twitter.com&lt;/a&gt; might know better. &lt;/p&gt;</comment>
                            <comment id="14979542" author="fpj" created="Thu, 29 Oct 2015 00:23:17 +0000"  >&lt;p&gt;Would it work if we do something like this in destroy(..)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     &lt;span class=&quot;code-comment&quot;&gt;/* call any outstanding completions with a special error code */&lt;/span&gt;
-    cleanup_bufs(zh,1,ZCLOSING);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (zh-&amp;gt;addrs != 0) {
+        cleanup_bufs(zh,1,ZCLOSING);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The rationale is that if the addresses are not set, and can&apos;t possibly have any buffers to cleanup. It&apos;s a bit hacky and I wish there were a better way to spot that the initialization between getaddrs and adaptor_init in zookeeper_init hasn&apos;t been done.&lt;/p&gt;</comment>
                            <comment id="14979550" author="rgs" created="Thu, 29 Oct 2015 00:27:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: I am not sure if that doesn&apos;t leak memory.. have you checked?&lt;/p&gt;</comment>
                            <comment id="14979553" author="rgs" created="Thu, 29 Oct 2015 00:29:50 +0000"  >&lt;p&gt;Sorry, you are right: there is nothing to cleanup. That&apos;s probably as good as it can get without adding more exit/cleanup branches to zookeeper_init...&lt;/p&gt;</comment>
                            <comment id="14980738" author="fpj" created="Thu, 29 Oct 2015 16:39:37 +0000"  >&lt;p&gt;Here is a preliminary patch for branch 3.4.&lt;/p&gt;</comment>
                            <comment id="14980773" author="fpj" created="Thu, 29 Oct 2015 16:50:52 +0000"  >&lt;p&gt;Patch for branch 3.4.&lt;/p&gt;</comment>
                            <comment id="14980829" author="hadoopqa" created="Thu, 29 Oct 2015 17:12:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12769566/ZOOKEEPER-1029-3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12769566/ZOOKEEPER-1029-3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1711151.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2936//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2936//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14980870" author="rgs" created="Thu, 29 Oct 2015 17:30:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;; thanks - lgtm. Fixing the log calls isn&apos;t necessary though (it has been fixed here: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/ad9e978b32ba7b7d7dfeb0b749ace2ae99384035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/ad9e978b32ba7b7d7dfeb0b749ace2ae99384035&lt;/a&gt;). Could you rebase and re-post? I can merge afterwards. Thanks!&lt;/p&gt;</comment>
                            <comment id="14981217" author="fpj" created="Thu, 29 Oct 2015 20:35:15 +0000"  >&lt;p&gt;I&apos;m wondering how to test this. It is simple enough that it seems to do the job, but it&apos;d be good to make sure.&lt;/p&gt;</comment>
                            <comment id="14981415" author="fpj" created="Thu, 29 Oct 2015 22:09:02 +0000"  >&lt;p&gt;We have these test cases:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    void testInvalidAddressString1()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; string INVALID_HOST(&lt;span class=&quot;code-quote&quot;&gt;&quot;host1&quot;&lt;/span&gt;);
        zh=zookeeper_init(INVALID_HOST.c_str(),0,0,0,0,0);
        CPPUNIT_ASSERT(zh==0);
        CPPUNIT_ASSERT_EQUAL(EINVAL,errno);
    }

   void testInvalidAddressString2()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; string INVALID_HOST(&lt;span class=&quot;code-quote&quot;&gt;&quot;host1:1111+host:123&quot;&lt;/span&gt;);
        zh=zookeeper_init(INVALID_HOST.c_str(),0,0,0,0,0);
        CPPUNIT_ASSERT(zh==0);
        CPPUNIT_ASSERT((ENOENT|EINVAL) &amp;amp; errno);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why isn&apos;t this verifying the problem described here? CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dheerajagrawal&quot; class=&quot;user-hover&quot; rel=&quot;dheerajagrawal&quot;&gt;dheerajagrawal&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14981438" author="rgs" created="Thu, 29 Oct 2015 22:22:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: what are you trying to verify? As I said before, trying to lock/unlock uninitialized locks doesn&apos;t actually change cleanup code path (i.e.: we just don&apos;t acquire the lock, but it doesn&apos;t matter since the IO &amp;amp; event thread haven&apos;t started...).&lt;/p&gt;</comment>
                            <comment id="14981548" author="fpj" created="Thu, 29 Oct 2015 23:20:12 +0000"  >&lt;p&gt;One of the comments mentioned a crash and it confused me, I thought the problem described here was causing a crash, so I was simply trying to avoid that execution path through cleanup_bufs. After reading the description again, I think the solution is simply to check the return value of the lock call, like in the latest patch I submitted, but let me know if I got it wrong again.&lt;/p&gt;</comment>
                            <comment id="14981556" author="rgs" created="Thu, 29 Oct 2015 23:27:23 +0000"  >&lt;p&gt;Yeah - the crash is actually in Mesos (&lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-2186&quot; title=&quot;Mesos crashes if any configured zookeeper does not resolve.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MESOS-2186&quot;&gt;&lt;del&gt;MESOS-2186&lt;/del&gt;&lt;/a&gt;). &lt;/p&gt;</comment>
                            <comment id="14981558" author="fpj" created="Thu, 29 Oct 2015 23:29:28 +0000"  >&lt;p&gt;and what do you think of the latest patch, does it make any sense?&lt;/p&gt;</comment>
                            <comment id="14981577" author="rgs" created="Thu, 29 Oct 2015 23:40:18 +0000"  >&lt;p&gt;I think it&apos;s a good start, though we might want to check return codes for these ones too:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;void enter_critical(zhandle_t* zh)
{
    struct adaptor_threads *adaptor = zh-&amp;gt;adaptor_priv;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(adaptor)
        pthread_mutex_lock(&amp;amp;adaptor-&amp;gt;zh_lock);
}

void leave_critical(zhandle_t* zh)
{
    struct adaptor_threads *adaptor = zh-&amp;gt;adaptor_priv;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(adaptor)
        pthread_mutex_unlock(&amp;amp;adaptor-&amp;gt;zh_lock);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can probably leave that for another round. Unless there&apos;s anything else you&apos;d like to add, I&apos;ll go ahead and merge this. &lt;/p&gt;</comment>
                            <comment id="14981578" author="rgs" created="Thu, 29 Oct 2015 23:40:54 +0000"  >&lt;p&gt;meant to say: &quot;although we can probably leave these two methods for later...&quot;&lt;/p&gt;</comment>
                            <comment id="14981588" author="fpj" created="Thu, 29 Oct 2015 23:49:09 +0000"  >&lt;p&gt;I made the changes you suggested.&lt;/p&gt;</comment>
                            <comment id="14981605" author="rgs" created="Fri, 30 Oct 2015 00:00:33 +0000"  >&lt;p&gt;lgtm - thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt; - in case you want to take a look, otherwise i&apos;ll merge it tomorrow. &lt;/p&gt;</comment>
                            <comment id="14981726" author="hadoopqa" created="Fri, 30 Oct 2015 02:09:39 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12769667/ZOOKEEPER-1029-3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12769667/ZOOKEEPER-1029-3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1711151.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2937//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2937//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14982461" author="hadoopqa" created="Fri, 30 Oct 2015 12:10:44 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12769759/ZOOKEEPER-1029-3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12769759/ZOOKEEPER-1029-3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1711151.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2938//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2938//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14982500" author="hadoopqa" created="Fri, 30 Oct 2015 12:39:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12769766/ZOOKEEPER-1029-3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12769766/ZOOKEEPER-1029-3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1711151.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2939//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2939//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14982722" author="dheerajagrawal" created="Fri, 30 Oct 2015 15:45:13 +0000"  >&lt;p&gt;Looks good/./. one quick note . I see in the patch return codes are added to all pthread wrapper functions, please check the windows impl / defines of the all the pthread methods, to make sure they return the same error code. many times unix/windows return code may be different. I think there is a file which has all the windows defines for those pthreads.&lt;br/&gt;
for eg.&lt;br/&gt;
return pthread_mutex_unlock&lt;/p&gt;</comment>
                            <comment id="14982733" author="dheerajagrawal" created="Fri, 30 Oct 2015 15:48:21 +0000"  >&lt;p&gt;Error code as in 0 vs &amp;gt; 0, &amp;lt; 0 etc. &lt;br/&gt;
on success on unix we may get 1 for certain call, and on windows for the same call we may get 0. I had seen some differences like this. Just wanted to make sure none of the apis here in the patch, dont have that..else the branching may not be correct on windows.&lt;/p&gt;</comment>
                            <comment id="14982744" author="fpj" created="Fri, 30 Oct 2015 15:53:18 +0000"  >&lt;p&gt;Canceling patch to address comments.&lt;/p&gt;</comment>
                            <comment id="14982786" author="fpj" created="Fri, 30 Oct 2015 16:20:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dheerajagrawal&quot; class=&quot;user-hover&quot; rel=&quot;dheerajagrawal&quot;&gt;dheerajagrawal&lt;/a&gt; I have checked winport.c and the value returned on success is 0 out of a call to WaitForSingleObject. The success value is also 0 on linux. Are we good or do you see any problem? Feel free to double check if you want, otherwise I&apos;ll resubmit the patch.&lt;/p&gt;

&lt;p&gt;I have also run tests and they pass fine for me.&lt;/p&gt;</comment>
                            <comment id="14983031" author="cnauroth" created="Fri, 30 Oct 2015 18:34:02 +0000"  >&lt;p&gt;+1 for the branch-3.4 patch.  Thank you, Flavio.  I can review a trunk/branch-3.5 patch too when it&apos;s available.&lt;/p&gt;</comment>
                            <comment id="14983175" author="fpj" created="Fri, 30 Oct 2015 19:50:20 +0000"  >&lt;p&gt;I wanted to primarily unblock &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; so that we can finally produce an RC for 3.4.7. If you could check this one in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;, I&apos;d appreciate.&lt;/p&gt;

&lt;p&gt;I&apos;ll generate a patch for 3.5 and trunk and soon as I have a chance, but I don&apos;t want it to block 3.4.7.&lt;/p&gt;</comment>
                            <comment id="14983651" author="cnauroth" created="Sat, 31 Oct 2015 00:08:53 +0000"  >&lt;p&gt;Sounds good.  I have committed this to branch-3.4.  I&apos;ll leave the JIRA opened, pending commits to trunk and branch-3.5.  Flavio and Raul, thank you for your work on this.&lt;/p&gt;</comment>
                            <comment id="14983885" author="fpj" created="Sat, 31 Oct 2015 07:43:24 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Branch 3.4: Committed revision 1711566&lt;/p&gt;</comment>
                            <comment id="15039717" author="rgs" created="Fri, 4 Dec 2015 04:04:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: can you forward port your patch to trunk/3.5?&lt;/p&gt;</comment>
                            <comment id="15049410" author="fpj" created="Wed, 9 Dec 2015 21:31:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; could you have a look at this, please? this is the version for 3.5 and trunk of the patch so that we can close this issue.&lt;/p&gt;</comment>
                            <comment id="15049439" author="hadoopqa" created="Wed, 9 Dec 2015 21:58:00 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776638/ZOOKEEPER-1029-3.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776638/ZOOKEEPER-1029-3.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1718758.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2992//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15050129" author="rgs" created="Thu, 10 Dec 2015 05:56:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: a few comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in lock_reconfig/unlock_reconfig and enter_critical/leave_critical if the the adaptor is not initialized we return 0 (lock or unlock succeeded) - is this actually desired? If so, maybe add a comment explaining why this is so?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    lock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);
-    tmp_list = zh-&amp;gt;sent_requests;
-    zh-&amp;gt;sent_requests.head = 0;
-    zh-&amp;gt;sent_requests.last = 0;
-    unlock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);
-    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (tmp_list.head) {
....

+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lock_completion_list(&amp;amp;zh-&amp;gt;sent_requests) == 0) {
+        tmp_list = zh-&amp;gt;sent_requests;
+        zh-&amp;gt;sent_requests.head = 0;
+        zh-&amp;gt;sent_requests.last = 0;
+        unlock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);
+        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (tmp_list.head) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we are now iterating over tmp_list.head &lt;b&gt;only if&lt;/b&gt; zh-&amp;gt;requests was locked - do we need to couple them? Or should it be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lock_completion_list(&amp;amp;zh-&amp;gt;sent_requests) == 0) {
+        tmp_list = zh-&amp;gt;sent_requests;
+        zh-&amp;gt;sent_requests.head = 0;
+        zh-&amp;gt;sent_requests.last = 0;
+        unlock_completion_list(&amp;amp;zh-&amp;gt;sent_requests);
+     }
+     &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (tmp_list.head) {
+     ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;similarly, in:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    a_list.completion = NULL;
-    a_list.next = NULL;
-    zoo_lock_auth(zh);
...
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (zoo_lock_auth(zh) == 0) {
+        a_list.completion = NULL;
+        a_list.next = NULL;
+
+        get_auth_completions(&amp;amp;zh-&amp;gt;auth_h, &amp;amp;a_list);
+        zoo_unlock_auth(zh);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;setting a_list.completion = NULL and a_list.next = NULL didn&apos;t previously depend on obtaining zoo_lock_auth.. but now they do. Again, should it just be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+    a_list.completion = NULL;
+    a_list.next = NULL;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (zoo_lock_auth(zh) == 0) {
+        get_auth_completions(&amp;amp;zh-&amp;gt;auth_h, &amp;amp;a_list);
+        zoo_unlock_auth(zh);
+     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="15050434" author="fpj" created="Thu, 10 Dec 2015 09:25:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; thanks for the review and comments. &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Previously, the return value was void, so if there was no adaptor, then we&apos;d silently move on. By returning 0, I&apos;m essentially keeping the same behavior and saying that it is OK to make progress. The case this patch is covering is focused on the one that it does try to acquire the lock, but the lock operation fails. Also, if you want to make this change here, then we will need to fix it in the 3.4 branch as well. With this patch, I&apos;m just porting what we&apos;ve done for the 3.4 branch so far.&lt;/li&gt;
	&lt;li&gt;I don&apos;t think it is ok to move the while loop out of the if block because we aren&apos;t initializing tmp_list. Even if we were, there isn&apos;t going to be any iteration of the while loop because there is no head.&lt;/li&gt;
	&lt;li&gt;It sounds ok to make this change, but I don&apos;t see much advantage or any correction of behavior. If we don&apos;t call the if block as you define it, then we&apos;ll have a_list.completion = NULL and a_list.next = NULL, so there will be no iteration of the subsequent while loop.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15050442" author="fpj" created="Thu, 10 Dec 2015 09:32:27 +0000"  >&lt;p&gt;Waiting for feedback.&lt;/p&gt;</comment>
                            <comment id="15051570" author="cnauroth" created="Thu, 10 Dec 2015 20:11:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;.  The patch mostly looks good to me, pending resolution of the feedback from Raul.  I ran some successful manual testing on both Linux and Windows.&lt;/p&gt;

&lt;p&gt;I just have a minor request.  There are some coding style differences in the branch-3.5 patch compared to what got committed to branch-3.4.  For example, indentation is different in &lt;tt&gt;unlock_buffer_list&lt;/tt&gt;, and &lt;tt&gt;enter_critical&lt;/tt&gt; uses a different brace style for a single-line if/else body.  Can we please match style as closely as possible between the 2 branches?  That will reduce the likelihood of merge conflicts if there are later backports to branch-3.4.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15051575" author="rgs" created="Thu, 10 Dec 2015 20:19:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; - it makes sense. I am +1 with the patch as is. &lt;/p&gt;</comment>
                            <comment id="15051576" author="rgs" created="Thu, 10 Dec 2015 20:19:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;: i checked Flavio&apos;s replies, I am +1 with the patch as is. Thanks!&lt;/p&gt;</comment>
                            <comment id="15051659" author="fpj" created="Thu, 10 Dec 2015 21:14:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; I have fixed the if/else blocks, but the extra space in &lt;tt&gt;unlock_buffer_list&lt;/tt&gt; was accidental, not a conscious style choice. Just remove it next time you commit a patch. &lt;/p&gt;</comment>
                            <comment id="15053500" author="cnauroth" created="Fri, 11 Dec 2015 20:15:56 +0000"  >&lt;p&gt;+1 for the branch-3.5 patch.  I have committed this to trunk and branch-3.5  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;, thank you for the patch.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, thank you for the thorough code reviews.&lt;/p&gt;</comment>
                            <comment id="15053646" author="hudson" created="Fri, 11 Dec 2015 21:56:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2828 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2828/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2828/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1029&quot; title=&quot;C client bug in zookeeper_init (if bad hostname is given)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1029&quot;&gt;&lt;del&gt;ZOOKEEPER-1029&lt;/del&gt;&lt;/a&gt;: C client bug in zookeeper_init (if bad hostname is given) (fpj via cnauroth) (cnauroth: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1719528&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1719528&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/src/c/src/mt_adaptor.c&lt;/li&gt;
	&lt;li&gt;trunk/src/c/src/st_adaptor.c&lt;/li&gt;
	&lt;li&gt;trunk/src/c/src/zk_adaptor.h&lt;/li&gt;
	&lt;li&gt;trunk/src/c/src/zookeeper.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16642943" author="jomach" created="Tue, 9 Oct 2018 08:17:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; I think there is a bug here. On Mesos we have a problem that if&#160;one host is not DNS resolvable&#160; it does not try the other ones.&#160;&lt;/p&gt;

&lt;p&gt;I checked the zookeeper.c and in the function&#160;resolve_hosts line 813 we jump to next and from there we return the ZOK. I think there is some kind of looping missing. I&apos;m no C expert sorry... On the Java api I see that we use&#160;InetSocketAddress.createUnresolved so that it will not be tried to resolve the hosts, can it be that we have a issue there ?&lt;/p&gt;</comment>
                            <comment id="16728641" author="bibmaster" created="Tue, 25 Dec 2018 09:42:48 +0000"  >&lt;p&gt;Function &lt;tt&gt;free_auth_completion(&amp;amp;a_list)&lt;/tt&gt; call must be moved inside conditional block &lt;tt&gt;if (zoo_lock_auth(zh) == 0)&lt;/tt&gt;. Otherwise it&#160;is called with trash in a_list.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12976382">ZOOKEEPER-2443</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12769766" name="ZOOKEEPER-1029-3.4.patch" size="8477" author="fpj" created="Fri, 30 Oct 2015 12:21:17 +0000"/>
                            <attachment id="12769759" name="ZOOKEEPER-1029-3.4.patch" size="8509" author="fpj" created="Fri, 30 Oct 2015 11:34:42 +0000"/>
                            <attachment id="12769667" name="ZOOKEEPER-1029-3.4.patch" size="5105" author="fpj" created="Thu, 29 Oct 2015 23:49:09 +0000"/>
                            <attachment id="12769662" name="ZOOKEEPER-1029-3.4.patch" size="3883" author="fpj" created="Thu, 29 Oct 2015 23:16:58 +0000"/>
                            <attachment id="12769566" name="ZOOKEEPER-1029-3.4.patch" size="4133" author="fpj" created="Thu, 29 Oct 2015 16:50:52 +0000"/>
                            <attachment id="12769561" name="ZOOKEEPER-1029-3.4.patch" size="3295" author="fpj" created="Thu, 29 Oct 2015 16:39:37 +0000"/>
                            <attachment id="12776893" name="ZOOKEEPER-1029-3.5.patch" size="9556" author="fpj" created="Thu, 10 Dec 2015 21:14:02 +0000"/>
                            <attachment id="12776638" name="ZOOKEEPER-1029-3.5.patch" size="9432" author="fpj" created="Wed, 9 Dec 2015 21:31:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2455</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05yyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>c client, adaptor_init, zookeeper_init, bad hostname</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>