<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:02:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3706] ZooKeeper.close() would leak SendThread when the network is broken</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3706</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The close method of ZooKeeper may cause the leak of SendThread when the network is broken.&lt;/p&gt;

&lt;p&gt;When the network is broken, the SendThread of ZooKeeper client falls into the&#160;continuous&#160;reconnecting scenario. But there is an unsafe point which is just at the moment before startConnect() during the continuous reconnecting. If SendThread.close() in another thread hit the unsafe point,&#160;startConnect() would sleep some time and force to change state to&#160;States.CONNECTING although&#160;SendThread.close() already set state to States.CLOSED. In this case, the SendThread would be never be dead and nobody would change the state again.&lt;/p&gt;

&lt;p&gt;In normal case, ZooKeeper.close() would be blocked forever to wait closeSession packet is finished until the network broken is recovered. But if user set the request timeout, ZooKeeper.close() would break the block waiting within timeout and invoke&#160;SendThread.close() to change state to CLOSED. That&apos;s why SendThread.close() can hit the unsafe point.&lt;/p&gt;

&lt;p&gt;Set request timeout is a very common practice.&#160;&lt;/p&gt;

&lt;p&gt;I propose a patch and send it out later.&lt;/p&gt;

&lt;p&gt;Maybe someone can help to review it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13281532">ZOOKEEPER-3706</key>
            <summary>ZooKeeper.close() would leak SendThread when the network is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yfx416">Pierre Yin</assignee>
                                    <reporter username="yfx416">Pierre Yin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 25 Jan 2020 08:28:45 +0000</created>
                <updated>Tue, 17 May 2022 09:02:25 +0000</updated>
                            <resolved>Tue, 3 Mar 2020 02:13:59 +0000</resolved>
                                    <version>3.6.0</version>
                    <version>3.4.14</version>
                    <version>3.5.6</version>
                                    <fixVersion>3.5.10</fixVersion>
                    <fixVersion>3.6.3</fixVersion>
                    <fixVersion>3.7.0</fixVersion>
                    <fixVersion>3.8.0</fixVersion>
                                    <component>java client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="36600">10h 10m</timespent>
                                <comments>
                            <comment id="17023457" author="yfx416" created="Sat, 25 Jan 2020 08:40:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1235&lt;/a&gt;  Please see the pr&lt;/p&gt;</comment>
                            <comment id="17049842" author="hanm" created="Tue, 3 Mar 2020 02:13:59 +0000"  >&lt;p&gt;Issue resolved by pull request 1235&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1235&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17128712" author="aishwaryasoni1991" created="Mon, 8 Jun 2020 23:30:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yfx416&quot; class=&quot;user-hover&quot; rel=&quot;yfx416&quot;&gt;yfx416&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;&#160;I think I am facing a similar issue (maybe because of the fix or the cause of 3706) in my environment. I have created a ticket&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3828&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-3828&lt;/a&gt;&#160;which has the logs and behavior similar to it. The SendThread of ZooKeeper client stays in the connecting (or rather reconnecting) state until I restart the leader node again.&#160;&lt;br/&gt;
I feel we need to re-look this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;&#160;Can this be a reason for my issue (3828)?&lt;/p&gt;</comment>
                            <comment id="17291425" author="mukti" created="Fri, 26 Feb 2021 06:56:01 +0000"  >&lt;p&gt;This issue is not merged in 3.6.1. It seems this is merged only in master.&#160;&lt;/p&gt;</comment>
                            <comment id="17298228" author="arshad.mohammad" created="Tue, 9 Mar 2021 17:53:07 +0000"  >&lt;p&gt;This JIRA change is present in master, branch-3.7 and branch-3.7.0. So changed the fixed version from 3.6.1 to 3.8.0,3.7.0&lt;/p&gt;</comment>
                            <comment id="17538037" author="symat" created="Tue, 17 May 2022 08:58:31 +0000"  >&lt;p&gt;this was actually cherry-picked to multiple branches already. Usually we haven&apos;t created separate Jira tasks / PRs for the cherry-picks (except &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-4223&quot; title=&quot;Backport ZOOKEEPER-3706 to branch-3.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-4223&quot;&gt;&lt;del&gt;ZOOKEEPER-4223&lt;/del&gt;&lt;/a&gt; for branch-3.6). I updated the fixed versions to: 3.5.10, 3.6.3, 3.7.0, 3.8.0&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13361115">ZOOKEEPER-4223</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/zookeeper/pull/1235]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0auw0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>