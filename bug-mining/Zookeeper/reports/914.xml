<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:01:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2847] Cannot bind to client port when reconfig based on old static config</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2847</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When started the ensemble with old static config that the server string doesn&apos;t have client port, dynamically remove and add the same server from the ensemble will cause that server cannot bind to client port, and the ZooKeeper server cannot serve client requests anymore.&lt;/p&gt;

&lt;p&gt;From the code, we&apos;ll set the clientAddr to null when start up with old static config, and dynamic config forces to have &amp;lt;client port&amp;gt; part, which will trigger the following rebind code in QuorumPeer#processReconfig, and cause the address already in used issue.&lt;/p&gt;

&lt;p&gt;    public boolean processReconfig(QuorumVerifier qv, Long suggestedLeaderId, Long zxid, boolean restartLE) {&lt;br/&gt;
        ...&lt;br/&gt;
        if (myNewQS != null &amp;amp;&amp;amp; myNewQS.clientAddr != null&lt;br/&gt;
                &amp;amp;&amp;amp; !myNewQS.clientAddr.equals(oldClientAddr)) &lt;/p&gt;
{
            cnxnFactory.reconfigure(myNewQS.clientAddr);
            updateThreadName();
        }
&lt;p&gt;        ...&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment></environment>
        <key id="13088140">ZOOKEEPER-2847</key>
            <summary>Cannot bind to client port when reconfig based on old static config</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yisong-yue">Yisong Yue</assignee>
                                    <reporter username="lvfangmin">Fangmin Lv</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 19 Jul 2017 06:14:54 +0000</created>
                <updated>Fri, 4 Oct 2019 14:55:16 +0000</updated>
                            <resolved>Mon, 1 Oct 2018 04:11:33 +0000</resolved>
                                    <version>3.5.3</version>
                    <version>3.6.0</version>
                                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="16610005" author="hadoopqa" created="Tue, 11 Sep 2018 01:52:39 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2150//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16624485" author="hanm" created="Sat, 22 Sep 2018 04:43:59 +0000"  >&lt;p&gt;Issue resolved by pull request 620&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/620&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16624536" author="hudson" created="Sat, 22 Sep 2018 06:45:48 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #200 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/200/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/200/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2847&quot; title=&quot;Cannot bind to client port when reconfig based on old static config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2847&quot;&gt;&lt;del&gt;ZOOKEEPER-2847&lt;/del&gt;&lt;/a&gt;: Cannot bind to client port when reconfig based on old (hanm: rev e116d32b63039fe9f0677f0af76c0a77fe74c82b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerConfigTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16626485" author="hanm" created="Mon, 24 Sep 2018 21:27:42 +0000"  >&lt;p&gt;looks like this patch breaks recent trunk build. There is at least one reconfig test failing deterministically. To reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant test -Dtestcase=ReconfigLegacyTest -Dtest.method=testReconfigRemoveClientFromStatic test-core-java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This test was broken because it expected that if &quot;clientPort&quot; was available in static config file it should be kept there, for compatibility reasons (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;). The code checks if the condition is met using QuorumServer.clientAddr, which is null iff there is no clientPort in the static config file. The fix in this patch broke this assumption, because now QuorumServer.clientAddr will always be assigned a value, there is no way to differentiate if the value was assigned by reading from the server config portion of the static config file, or from the code (if (qs != null &amp;amp;&amp;amp; qs.clientAddr == null) qs.clientAddr = clientPortAddress&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. As a result, needEraseClientInfoFromStaticConfig now return true even if clientPort configuration is available in static config file, which leads to this test fails.&lt;/p&gt;

&lt;p&gt;I think we can use a dedicated field to represent the state of &quot;should erase&quot; for static config file to fix this.&lt;/p&gt;</comment>
                            <comment id="16626486" author="hanm" created="Mon, 24 Sep 2018 21:29:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yisong-yue&quot; class=&quot;user-hover&quot; rel=&quot;yisong-yue&quot;&gt;yisong-yue&lt;/a&gt; Do you want to put up another patch to fix the unit test failure of testReconfigRemoveClientFromStatic? &lt;/p&gt;

&lt;p&gt;btw I am not sure why a previous old passes &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2237/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2237/&lt;/a&gt; - that is why i did not catch this until today ran the build both locally and on jenkins.&lt;/p&gt;</comment>
                            <comment id="16626522" author="yisong-yue" created="Mon, 24 Sep 2018 22:30:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;&#160;Yes, I&apos;ll put up a&#160;patch (by that you mean open another&#160;issue, right?)&#160;to fix it. Thanks for investigating!&lt;/p&gt;</comment>
                            <comment id="16626539" author="hanm" created="Mon, 24 Sep 2018 22:58:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yisong-yue&quot; class=&quot;user-hover&quot; rel=&quot;yisong-yue&quot;&gt;yisong-yue&lt;/a&gt; Thanks for quick response. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;by that you mean open another issue, right&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can reuse this JIRA issue for the fix. But if you like, create a new issue is also OK. up to you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16631649" author="andorm" created="Fri, 28 Sep 2018 10:11:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yisong-yue&quot; class=&quot;user-hover&quot; rel=&quot;yisong-yue&quot;&gt;yisong-yue&lt;/a&gt; Are u able to submit a fix for this anytime soon? Trunk builds have been red for a week now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; I wonder how that patch could have broken the unit test, because you merged it with a green build.&lt;/p&gt;</comment>
                            <comment id="16632131" author="hanm" created="Fri, 28 Sep 2018 16:57:26 +0000"  >&lt;p&gt;not sure, this test passed in the pre-commit check build (2237)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2237/testReport/org.apache.zookeeper.server.quorum/ReconfigLegacyTest/testReconfigRemoveClientFromStatic/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2237/testReport/org.apache.zookeeper.server.quorum/ReconfigLegacyTest/testReconfigRemoveClientFromStatic/&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;though it fails deterministically on my local box (and now on jenkins).&#160;&lt;/p&gt;</comment>
                            <comment id="16632598" author="lvfangmin" created="Fri, 28 Sep 2018 22:19:29 +0000"  >&lt;p&gt;Sorry, this is a known issue, I was&#160;planning to&#160;comment&#160;on the PR before it&apos;s merged (was thinking Jenkins can catch this as well), but get distracted at that time.&lt;/p&gt;

&lt;p&gt;I&apos;m working with Yisong on this, will provide a PR today.&lt;/p&gt;</comment>
                            <comment id="16632638" author="yisong-yue" created="Fri, 28 Sep 2018 23:17:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andor&quot; class=&quot;user-hover&quot; rel=&quot;andor&quot;&gt;andor&lt;/a&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;&#160;Sorry for the delay! It has been a busy week. We&apos;ll submit a patch for it today.&lt;/p&gt;

&lt;p&gt;(Just&#160;found this comment didn&apos;t get sent out...&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                            <comment id="16633601" author="hanm" created="Mon, 1 Oct 2018 04:11:33 +0000"  >&lt;p&gt;Issue resolved by pull request 649&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/649&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16633609" author="hudson" created="Mon, 1 Oct 2018 04:40:53 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #212 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/212/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/212/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2847&quot; title=&quot;Cannot bind to client port when reconfig based on old static config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2847&quot;&gt;&lt;del&gt;ZOOKEEPER-2847&lt;/del&gt;&lt;/a&gt;: Cannot bind to client port when reconfig based on old (hanm: rev a8cf62678131626b778d0572290d582f70a2cbfc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16633616" author="yisong-yue" created="Mon, 1 Oct 2018 05:05:34 +0000"  >&lt;p&gt;^ seems like a flakey test case. I cannot reproduce&#160;the failure locally.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hozj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>