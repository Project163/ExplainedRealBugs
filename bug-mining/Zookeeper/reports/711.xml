<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:57:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2253] C asserts ordering of ping requests, while Java client does not</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2253</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Affects C clients from 3.3 to trunk.&lt;/p&gt;

&lt;p&gt;The Java client does not enforce ordering on ping requests. It merely updates fields when a ping reply is received and schedules a new ping request when necessary.&lt;/p&gt;

&lt;p&gt;The C client actually enqueues the void response in the completion data structure and pulls it off when it gets a response.&lt;/p&gt;

&lt;p&gt;This sounds like an implementation detail (and it is, sort of), but if a future server were to, say, send unsolicited ping replies to a client to assert liveness, it would work fine against a Java client but would cause a C client to fail the assertion in zookeeper_process, &quot;assert(cptr)&quot;, line 2912, zookeeper.c.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857336">ZOOKEEPER-2253</key>
            <summary>C asserts ordering of ping requests, while Java client does not</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cchen">Chris Chen</assignee>
                                    <reporter username="cchen">Chris Chen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2015 21:58:45 +0000</created>
                <updated>Thu, 3 Mar 2016 01:29:40 +0000</updated>
                            <resolved>Sat, 26 Sep 2015 20:30:04 +0000</resolved>
                                    <version>3.5.0</version>
                                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14731286" author="cchen" created="Fri, 4 Sep 2015 19:24:05 +0000"  >&lt;p&gt;Attaching patch.&lt;/p&gt;</comment>
                            <comment id="14731347" author="hadoopqa" created="Fri, 4 Sep 2015 20:10:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754255/ZOOKEEPER-2253.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754255/ZOOKEEPER-2253.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1698058.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2855//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2855//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14732468" author="rgs" created="Sun, 6 Sep 2015 17:32:54 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cchen&quot; class=&quot;user-hover&quot; rel=&quot;cchen&quot;&gt;cchen&lt;/a&gt;! Though, it&apos;s not applying:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     [exec] patching file src/c/src/zookeeper.c
     [exec] Hunk #1 succeeded at 1617 (offset 105 lines).
     [exec] Hunk #2 FAILED at 1877.
     [exec] Hunk #3 succeeded at 2740 (offset 259 lines).
     [exec] Hunk #4 succeeded at 2852 (offset 259 lines).
     [exec] Hunk #5 FAILED at 2664.
     [exec] 2 out of 5 hunks FAILED -- saving rejects to file src/c/src/zookeeper.c.rej
     [exec] patching file src/c/tests/TestOperations.cc
     [exec] PATCH APPLICATION FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you have a fresh checkout?&lt;/p&gt;</comment>
                            <comment id="14732472" author="rgs" created="Sun, 6 Sep 2015 17:37:54 +0000"  >&lt;p&gt;Hmm, I am not sure about this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hdr.xid != PING_XID &amp;amp;&amp;amp; hdr.zxid &amp;gt; 0) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hdr.zxid &amp;gt; 0) {
                 &lt;span class=&quot;code-comment&quot;&gt;// Update last_zxid only when it is a request response
&lt;/span&gt;                 zh-&amp;gt;last_zxid = hdr.zxid;
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does the Java implementation update last_zxid on pings as well? How is this related to out of order pings?&lt;/p&gt;</comment>
                            <comment id="14734015" author="cchen" created="Mon, 7 Sep 2015 19:35:55 +0000"  >&lt;p&gt;Updated patch against HEAD.&lt;/p&gt;</comment>
                            <comment id="14734017" author="hadoopqa" created="Mon, 7 Sep 2015 19:40:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754535/ZOOKEEPER-2253.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754535/ZOOKEEPER-2253.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1701505.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2858//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2858//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14734018" author="cchen" created="Mon, 7 Sep 2015 19:44:03 +0000"  >&lt;p&gt;There is no last_zxid check since the zxid is -1 for pings right?&lt;/p&gt;

&lt;p&gt;This here is a test because in the C client the ping replies are &quot;in order&quot; but if this check wasn&apos;t there the C client would set the last zxid to -1.&lt;/p&gt;

&lt;p&gt;With this patch (hdr.xid != PING_XID) is guaranteed to be false, so.&lt;/p&gt;</comment>
                            <comment id="14734019" author="cchen" created="Mon, 7 Sep 2015 19:44:07 +0000"  >&lt;p&gt;There is no last_zxid check since the zxid is -1 for pings right?&lt;/p&gt;

&lt;p&gt;This here is a test because in the C client the ping replies are &quot;in order&quot; but if this check wasn&apos;t there the C client would set the last zxid to -1.&lt;/p&gt;

&lt;p&gt;With this patch (hdr.xid != PING_XID) is guaranteed to be false, so.&lt;/p&gt;</comment>
                            <comment id="14734020" author="cchen" created="Mon, 7 Sep 2015 19:50:10 +0000"  >&lt;p&gt;Arrgh patchy.&lt;/p&gt;</comment>
                            <comment id="14734028" author="hadoopqa" created="Mon, 7 Sep 2015 20:11:48 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754536/ZOOKEEPER-2253.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754536/ZOOKEEPER-2253.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1701505.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14735220" author="cchen" created="Tue, 8 Sep 2015 17:28:55 +0000"  >&lt;p&gt;Added patch for 3.4 branch.&lt;/p&gt;</comment>
                            <comment id="14735239" author="hadoopqa" created="Tue, 8 Sep 2015 17:39:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754676/zookeeper-2253-3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754676/zookeeper-2253-3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1701505.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2864//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2864//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14736116" author="rgs" created="Wed, 9 Sep 2015 03:58:02 +0000"  >&lt;p&gt;wait, we are mixing things.&lt;/p&gt;

&lt;p&gt;xid != zxid&lt;/p&gt;

&lt;p&gt;xid --&amp;gt; id used to pair each request with its reply.&lt;br/&gt;
zxid --&amp;gt; the last transaction id seen by the quorum.&lt;/p&gt;

&lt;p&gt;which one are you referring to?&lt;/p&gt;</comment>
                            <comment id="14744562" author="cchen" created="Tue, 15 Sep 2015 00:22:57 +0000"  >&lt;p&gt;Yes, sorry, I meant to say&lt;/p&gt;

&lt;p&gt;The conditional check here is for a reply packet to update the last seen zxid. Because we match for a ping packet in another block that check is now superfluous.&lt;/p&gt;</comment>
                            <comment id="14908912" author="cchen" created="Sat, 26 Sep 2015 00:01:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; lemme know if you have any questions&lt;/p&gt;</comment>
                            <comment id="14909462" author="rgs" created="Sat, 26 Sep 2015 20:20:04 +0000"  >&lt;p&gt;Ah, you right. Thanks or clarifying. &lt;/p&gt;</comment>
                            <comment id="14909468" author="rgs" created="Sat, 26 Sep 2015 20:30:04 +0000"  >&lt;p&gt;Merged:&lt;/p&gt;

&lt;p&gt;trunk - &lt;a href=&quot;https://github.com/apache/zookeeper/commit/bd9a1448f9b29859092e6bdca93da121ec166b7a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/bd9a1448f9b29859092e6bdca93da121ec166b7a&lt;/a&gt;&lt;br/&gt;
3.5 - &lt;a href=&quot;https://github.com/apache/zookeeper/commit/1fab0ada53d7de36d5825625d548f0ac90085910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/1fab0ada53d7de36d5825625d548f0ac90085910&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cchen&quot; class=&quot;user-hover&quot; rel=&quot;cchen&quot;&gt;cchen&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14909487" author="hudson" created="Sat, 26 Sep 2015 21:24:00 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2800 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2800/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2800/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2253&quot; title=&quot;C asserts ordering of ping requests, while Java client does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2253&quot;&gt;&lt;del&gt;ZOOKEEPER-2253&lt;/del&gt;&lt;/a&gt;: C asserts ordering of ping requests, while Java client does not&lt;br/&gt;
(Chris Chen via rgs) (rgs: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1705482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1705482&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zookeeper.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/TestOperations.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14909565" author="rgs" created="Sun, 27 Sep 2015 02:26:15 +0000"  >&lt;p&gt;Oops, forgot about 3.4: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/ff4ea0cff2cf2eab25406897f2097e6e2916d21c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/ff4ea0cff2cf2eab25406897f2097e6e2916d21c&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12754536" name="ZOOKEEPER-2253.patch" size="7078" author="cchen" created="Mon, 7 Sep 2015 19:50:10 +0000"/>
                            <attachment id="12754535" name="ZOOKEEPER-2253.patch" size="7086" author="cchen" created="Mon, 7 Sep 2015 19:35:55 +0000"/>
                            <attachment id="12754255" name="ZOOKEEPER-2253.patch" size="6991" author="cchen" created="Fri, 4 Sep 2015 19:24:23 +0000"/>
                            <attachment id="12754676" name="zookeeper-2253-3.4.patch" size="6610" author="cchen" created="Tue, 8 Sep 2015 17:28:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j4hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>