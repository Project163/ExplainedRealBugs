<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:03:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3954] use of uninitialized data in zookeeper-client/zookeeper-client-c/src/zookeeper.c:free_auth_completion</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3954</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When compiled with &lt;tt&gt;-O3&lt;/tt&gt; and &lt;tt&gt;gcc-10&lt;/tt&gt; (which is the default for Ubuntu on ppc64el), compilation fails like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/bin/bash ./libtool -tag=CC --mode=compile gcc -DHAVE_CONFIG_H -I. -I./include -I./tests -I./generated -Wdate-time -D_FORTIFY_SOURCE=2 -Wall -Werror -g -O3 -fdebug-prefix-map=/&amp;lt;&amp;lt;PKGBUILDDIR&amp;gt;&amp;gt;=. -fstack-protector-strong -Wformat -Werror=format-security -MT zookeeper.lo -MD -MP -MF .deps/zookeeper.Tpo -c -o zookeeper.lo `test -f &lt;span class=&quot;code-quote&quot;&gt;&apos;src/zookeeper.c&apos;&lt;/span&gt; || echo &lt;span class=&quot;code-quote&quot;&gt;&apos;./&apos;&lt;/span&gt;`src/zookeeper.c libtool: compile: gcc -DHAVE_CONFIG_H -I. -I./include -I./tests -I./generated -Wdate-time -D_FORTIFY_SOURCE=2 -Wall -Werror -g -O3 -fdebug-prefix-map=/&amp;lt;&amp;lt;PKGBUILDDIR&amp;gt;&amp;gt;=. -fstack-protector-strong -Wformat -Werror=format-security -MT zookeeper.lo -MD -MP -MF .deps/zookeeper.Tpo -c src/zookeeper.c -fPIC -DPIC -o .libs/zookeeper.o
src/zookeeper.c: In function &lt;span class=&quot;code-quote&quot;&gt;&apos;free_completions&apos;&lt;/span&gt;: 
src/zookeeper.c:284:9: error: &lt;span class=&quot;code-quote&quot;&gt;&apos;a_list.next&apos;&lt;/span&gt; may be used uninitialized in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; function [-Werror=maybe-uninitialized] 
284 | tmp = a_list&amp;gt;next; 
    | ~~~^~~~~~~~~~~~~ 
cc1: all warnings being treated as errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;What&apos;s happening here is that free_auth_completions is being inlined into free_completions, and this lets gcc see that members of a_list are being accessed without initialization. I don&apos;t know anything like enough about this code to see if this is a bug in code paths that are actually taken but at a glance it&apos;s certainly not obviously impossible: if the two if conditions at the top level of&#160;free_completions evaluate false, the function effectively looks like this:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-c&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;void&lt;/span&gt;&lt;/span&gt; free_completions(zhandle_t *zh,&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&lt;/span&gt; callCompletion,&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&lt;/span&gt; reason)
{ 
 auth_completion_list_t a_list; 
 free_auth_completion(&amp;amp;a_list); 
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so it&apos;s pretty clear that a_list is backed by uninitialized stack memory. Explicitly initializing the variable with &quot;&lt;tt&gt;a_list = {NULL, NULL, NULL&lt;/tt&gt;}&quot; makes the warning go away.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13333632">ZOOKEEPER-3954</key>
            <summary>use of uninitialized data in zookeeper-client/zookeeper-client-c/src/zookeeper.c:free_auth_completion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ztzg">Damien Diederen</assignee>
                                    <reporter username="mwhudson">Michael Hudson-Doyle</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 4 Oct 2020 23:39:10 +0000</created>
                <updated>Sun, 28 Mar 2021 08:54:00 +0000</updated>
                            <resolved>Mon, 12 Oct 2020 06:41:21 +0000</resolved>
                                    <version>3.6.2</version>
                                    <fixVersion>3.5.9</fixVersion>
                    <fixVersion>3.6.3</fixVersion>
                    <fixVersion>3.7.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="17207860" author="ztzg" created="Mon, 5 Oct 2020 06:58:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwhudson&quot; class=&quot;user-hover&quot; rel=&quot;mwhudson&quot;&gt;mwhudson&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;This should obviously be fixed, but, luckily enough, is not a big issue: the second condition in &lt;tt&gt;free_completions&lt;/tt&gt; will, in practice, always evaluate to&lt;br/&gt;
&lt;tt&gt;true&lt;/tt&gt;&#8212;as &lt;tt&gt;zoo_lock_auth&lt;/tt&gt; either returns a hardcoded zero (&lt;tt&gt;_st&lt;/tt&gt; variant) or is a wrapper around &lt;tt&gt;pthread_mutex_lock&lt;/tt&gt; (&lt;tt&gt;_mt&lt;/tt&gt; variant):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (zoo_lock_auth(zh) == 0) {
    ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would suggest simply getting rid of the conditional (but not the locking!), as 1/ most of the client code does not check &lt;tt&gt;zoo_lock_auth&lt;/tt&gt; &apos;s return value and 2/ we have bigger problems if (unconditional) locks start failing.&lt;/p&gt;

&lt;p&gt;What do you think?  Are you planning to submit a &quot;pull request,&quot; or should I cook one up?&lt;/p&gt;

&lt;p&gt;Cheers, -D&lt;/p&gt;</comment>
                            <comment id="17207886" author="mwhudson" created="Mon, 5 Oct 2020 07:56:48 +0000"  >&lt;p&gt;I wasn&apos;t planning on submitting a fix, no. I can if you want...&lt;/p&gt;</comment>
                            <comment id="17208077" author="ztzg" created="Mon, 5 Oct 2020 13:24:12 +0000"  >&lt;p&gt;Okay, I&apos;ll take care of it.  Thanks!&lt;/p&gt;</comment>
                            <comment id="17208336" author="ztzg" created="Mon, 5 Oct 2020 21:28:36 +0000"  >&lt;p&gt;Here it is: &lt;a href=&quot;https://github.com/apache/zookeeper/pull/1481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1481&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17212152" author="symat" created="Mon, 12 Oct 2020 06:41:21 +0000"  >&lt;p&gt;Issue resolved by pull request 1487&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1487&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1487&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jels:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>