<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:59:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2737] NettyServerCnxFactory leaks connection if exception happens while writing to a channel.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2737</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Found this while debugging occasionally failed unit tests. Currently we do this if exception occurs during writing to a channel with Netty:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void exceptionCaught(ChannelHandlerContext ctx, ExceptionEvent e)
            &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
        {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Exception caught &quot;&lt;/span&gt; + e, e.getCause());
            NettyServerCnxn cnxn = (NettyServerCnxn) ctx.getAttachment();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cnxn != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
                    LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closing &quot;&lt;/span&gt; + cnxn);
                    cnxn.close();
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the connection is only closed when debug mode is enabled. This is problematic as lots of clean up code is abstracted inside the close and without proper close the connection we are leaking resources.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/blob/master/src/java/main/org/apache/zookeeper/server/NettyServerCnxnFactory.java#L147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Commit log&lt;/a&gt; indicates the issue exists since day 1 with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-733&quot; title=&quot;use netty to handle client connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-733&quot;&gt;&lt;del&gt;ZOOKEEPER-733&lt;/del&gt;&lt;/a&gt;. Note the original patch uploaded to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-733&quot; title=&quot;use netty to handle client connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-733&quot;&gt;&lt;del&gt;ZOOKEEPER-733&lt;/del&gt;&lt;/a&gt; has this close call in right place, and the call gets moved around during iteration of the patches w/o gets noticed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13058955">ZOOKEEPER-2737</key>
            <summary>NettyServerCnxFactory leaks connection if exception happens while writing to a channel.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hanm">Michael Han</assignee>
                                    <reporter username="hanm">Michael Han</reporter>
                        <labels>
                            <label>connection</label>
                            <label>netty</label>
                            <label>server</label>
                    </labels>
                <created>Fri, 24 Mar 2017 17:16:17 +0000</created>
                <updated>Thu, 18 May 2017 03:43:58 +0000</updated>
                            <resolved>Mon, 27 Mar 2017 17:32:19 +0000</resolved>
                                    <version>3.5.2</version>
                                    <fixVersion>3.5.3</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15940817" author="githubbot" created="Fri, 24 Mar 2017 17:53:01 +0000"  >&lt;p&gt;GitHub user hanm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2737&quot; title=&quot;NettyServerCnxFactory leaks connection if exception happens while writing to a channel.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2737&quot;&gt;&lt;del&gt;ZOOKEEPER-2737&lt;/del&gt;&lt;/a&gt;: close netty connection when exceptions occur during w&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;rite to channel to prevent resource leak.&lt;/p&gt;

&lt;p&gt;    I am OK to add some contrived test case to test this but I&apos;d like to do that later if needed, so this fix can get in upcoming releases..&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hanm/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hanm/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2737&quot; title=&quot;NettyServerCnxFactory leaks connection if exception happens while writing to a channel.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2737&quot;&gt;&lt;del&gt;ZOOKEEPER-2737&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #207&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ad3b98418b6739d14003753f913a894dc0868fc1&lt;br/&gt;
Author: Michael Han &amp;lt;hanm@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-03-24T17:49:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2737&quot; title=&quot;NettyServerCnxFactory leaks connection if exception happens while writing to a channel.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2737&quot;&gt;&lt;del&gt;ZOOKEEPER-2737&lt;/del&gt;&lt;/a&gt;: close netty connection when exceptions occur during write to channel.&lt;br/&gt;
    To prevent resource leak.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15940852" author="hadoopqa" created="Fri, 24 Mar 2017 18:14:05 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/478//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15940855" author="githubbot" created="Fri, 24 Mar 2017 18:16:38 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    good catch!&lt;/p&gt;</comment>
                            <comment id="15943553" author="githubbot" created="Mon, 27 Mar 2017 16:23:07 +0000"  >&lt;p&gt;Github user afine commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15943590" author="githubbot" created="Mon, 27 Mar 2017 16:39:28 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ugh, sorry about that. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15943653" author="githubbot" created="Mon, 27 Mar 2017 17:06:46 +0000"  >&lt;p&gt;Github user rakeshadr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @hanm, +1 LGTM&lt;/p&gt;</comment>
                            <comment id="15943690" author="hanm" created="Mon, 27 Mar 2017 17:32:20 +0000"  >&lt;p&gt;Issue resolved by pull request 207&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15943691" author="githubbot" created="Mon, 27 Mar 2017 17:32:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/207&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15943701" author="hanm" created="Mon, 27 Mar 2017 17:39:00 +0000"  >&lt;p&gt;Committed.&lt;br/&gt;
Master: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/d8adc547f9856747905b7d46450f13fa98df147f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/d8adc547f9856747905b7d46450f13fa98df147f&lt;/a&gt;&lt;br/&gt;
3.5:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/5c356f5a47402c000b5e206a536273afc75de883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/5c356f5a47402c000b5e206a536273afc75de883&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15943825" author="hudson" created="Mon, 27 Mar 2017 18:46:56 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3334 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3334/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3334/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2737&quot; title=&quot;NettyServerCnxFactory leaks connection if exception happens while writing to a channel.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2737&quot;&gt;&lt;del&gt;ZOOKEEPER-2737&lt;/del&gt;&lt;/a&gt;: close netty connection when exceptions occur during w&#8230; (hanm: rev d8adc547f9856747905b7d46450f13fa98df147f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/NettyServerCnxnFactory.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12461144">ZOOKEEPER-733</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13041156">ZOOKEEPER-2686</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cre7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>