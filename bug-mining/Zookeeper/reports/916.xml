<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:01:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3156] ZOOKEEPER-2184 causes kerberos principal to not have resolved host name</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3156</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2184&quot; title=&quot;Zookeeper Client should re-resolve hosts when connection attempts fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2184&quot;&gt;&lt;del&gt;ZOOKEEPER-2184&lt;/del&gt;&lt;/a&gt; the zookeeper client would canonicalize a configured host name before creating the SASL client which is used to create the principal name.&#160; After &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2184&quot; title=&quot;Zookeeper Client should re-resolve hosts when connection attempts fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2184&quot;&gt;&lt;del&gt;ZOOKEEPER-2184&lt;/del&gt;&lt;/a&gt; that canonicalization does not happen so the principal that the ZK client tries to use when it is configured to talk to a CName is different between 3.4.13 and all previous versions of ZK.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For example&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;zk1.mycluster.mycompany.com maps to real-node.mycompany.com.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;3.4.13 will want the server to have &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:zookeeper/zk1.mycluster.com@KDC.MYCOMPANY.COM&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zookeeper/zk1.mycluster.com@KDC.MYCOMPANY.COM&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;3.4.12 wants the server to have &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:zookeeper/real-node.mycompany.com@KDC.MYCOMPANY.COM&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zookeeper/real-node.mycompany.com@KDC.MYCOMPANY.COM&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This makes 3.4.13 incompatible with many ZK setups currently in existence.&#160; It would be nice to have that resolution be optional because in some cases it might be nice to have a single principal tied to the cname.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187676">ZOOKEEPER-3156</key>
            <summary>ZOOKEEPER-2184 causes kerberos principal to not have resolved host name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="revans2">Robert Joseph Evans</assignee>
                                    <reporter username="revans2">Robert Joseph Evans</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 26 Sep 2018 17:20:50 +0000</created>
                <updated>Fri, 4 Oct 2019 14:55:12 +0000</updated>
                            <resolved>Mon, 5 Nov 2018 18:42:05 +0000</resolved>
                                    <version>3.6.0</version>
                    <version>3.4.13</version>
                    <version>3.5.5</version>
                                    <fixVersion>3.6.0</fixVersion>
                    <fixVersion>3.5.5</fixVersion>
                    <fixVersion>3.4.14</fixVersion>
                                    <component>java client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="44400">12h 20m</timespent>
                                <comments>
                            <comment id="16629274" author="eolivelli" created="Wed, 26 Sep 2018 18:55:37 +0000"  >&lt;p&gt;I see the problem.&lt;/p&gt;

&lt;p&gt;Do you have already a patch?&lt;/p&gt;

&lt;p&gt;Maybe a good idea is to add a client configuration flag or system property.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16629283" author="andorm" created="Wed, 26 Sep 2018 19:06:01 +0000"  >&lt;p&gt;I like the idea of having a configuration switch for that, because I&apos;m not entirely sure what would be the right behaviour.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=revans2&quot; class=&quot;user-hover&quot; rel=&quot;revans2&quot;&gt;revans2&lt;/a&gt; Do you have a patch already?&lt;/p&gt;</comment>
                            <comment id="16629288" author="andorm" created="Wed, 26 Sep 2018 19:15:13 +0000"  >&lt;p&gt;Is this the logic that we&apos;re talking about?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ZooKeeperSaslClient.isEnabled()) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; principalUserName = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(
                ZK_SASL_CLIENT_USERNAME, &lt;span class=&quot;code-quote&quot;&gt;&quot;zookeeper&quot;&lt;/span&gt;);
        zooKeeperSaslClient =
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZooKeeperSaslClient(
                    principalUserName+&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;+addr.getHostName());
...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16629340" author="andorm" created="Wed, 26 Sep 2018 20:12:39 +0000"  >&lt;p&gt;We should use getCanonicalHostName() to force reverse ip lookup and get the FQDN of the server according to this javadoc:&lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getCanonicalHostName(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getCanonicalHostName(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Introducing a switch to enable reverse dns lookups would be inline with Kerberos client behaviour:&lt;br/&gt;
&lt;a href=&quot;http://web.mit.edu/kerberos/krb5-current/doc/admin/princ_dns.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://web.mit.edu/kerberos/krb5-current/doc/admin/princ_dns.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the krb5 client you can disable canonicalization with rdns=false setting.&lt;/p&gt;

&lt;p&gt;I can put together a patch tomorrow if needed.&lt;/p&gt;</comment>
                            <comment id="16631671" author="andorm" created="Fri, 28 Sep 2018 10:28:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=revans2&quot; class=&quot;user-hover&quot; rel=&quot;revans2&quot;&gt;revans2&lt;/a&gt; Any thoughts?&lt;/p&gt;</comment>
                            <comment id="16632211" author="revans2" created="Fri, 28 Sep 2018 18:23:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andor&quot; class=&quot;user-hover&quot; rel=&quot;andor&quot;&gt;andor&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Sorry I was on a plane all day yesterday so I didn&apos;t respond sooner.&#160; I have been doing some debugging trying to get a patch, but I have not come up with one yet.&#160; I originally wanted to see if I could match the behavior from before by moving the host name resolution code later in the process, but despite the data structures being the same it is not possible as some information is lost in the current process.&#160; I think having a flag that would optionally call &lt;tt&gt;getCannicalHostName&lt;/tt&gt; would be great. If someone else has a patch I am happy to test it out, otherwise I will put together a patch myself.&lt;/p&gt;

&lt;p&gt;Be aware though that a global flag is not 100% backwards compatible, and there is a very small possibility that a single process will want to talk to multiple different zookeeper ensembles, i.e. apache storm + older kafka client, which could run into an issue where each ensemble wants something different.&#160; It is a small enough chance, and there are ways to work around it so I am fine with it, but it is possible.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16632380" author="andorm" created="Fri, 28 Sep 2018 19:36:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=revans2&quot; class=&quot;user-hover&quot; rel=&quot;revans2&quot;&gt;revans2&lt;/a&gt; Thanks for looking into this. As long as you&apos;re the assignee of this Jira, I&apos;m happy to wait for your pull request to review.&lt;/p&gt;

&lt;p&gt;Regarding backwards compatibility: &quot;...could run into an issue where each ensemble wants something different&quot;&lt;br/&gt;
This wasn&apos;t supported previously either: meaning that previous versions always did reverse IP lookups, so basically followed the behaviour that you mentioned as 3.4.12. Therefore I don&apos;t think the fix could cause backward compatibility issues as long as the default behaviour is the original (rnds=true).&lt;/p&gt;

&lt;p&gt;Let&apos;s try to wrap up what I think happened here:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Previous versions of ZooKeeper (up to 3.4.12) did DNS resolution upfront and returned the pure IP address to upper layers like the SASL client. The original implementation stripped the hostname from the InetSocketAddress after name resolution and created a new one with only IP address and port number,&lt;/li&gt;
	&lt;li&gt;This was fine for connecting the client to the server, because it only needs the IP address,&lt;/li&gt;
	&lt;li&gt;It forced the SASL client to do reverse DNS lookup by calling getHostName(),&lt;/li&gt;
	&lt;li&gt;The current behaviour, which I think is the right approach, creates new InetSocketAddress with the resolved IP address and the original hostname, so upper layers don&apos;t need to do reverse lookup.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With the new switch and using getCanonicalHostName() in the SASL client we can enforce the reverse lookup which is needed here. &lt;/p&gt;</comment>
                            <comment id="16632482" author="revans2" created="Fri, 28 Sep 2018 19:46:27 +0000"  >&lt;p&gt;OK I have a patch up for 3.4 and if it looks good I am happy to port it to all release lines.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/pull/648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/648&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have a few questions though.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I have canonicalization on by default, is that what we want?&lt;/li&gt;
	&lt;li&gt;Is there some place that I can document the new System property that I added?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16675577" author="andorm" created="Mon, 5 Nov 2018 18:42:05 +0000"  >&lt;p&gt;Issue resolved by pull request 652&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/652&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/652&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16675821" author="hudson" created="Mon, 5 Nov 2018 22:19:14 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Zookeeper-trunk-single-thread #94 (See &lt;a href=&quot;https://builds.apache.org/job/Zookeeper-trunk-single-thread/94/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Zookeeper-trunk-single-thread/94/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3156&quot; title=&quot;ZOOKEEPER-2184 causes kerberos principal to not have resolved host name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3156&quot;&gt;&lt;del&gt;ZOOKEEPER-3156&lt;/del&gt;&lt;/a&gt;: Add in option to canonicalize host name (andor: rev 83fd6e298dda420125f8be35fda68cb226b0ee05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) zookeeper-server/src/main/java/org/apache/zookeeper/SaslServerPrincipal.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/client/ZKClientConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java&lt;/li&gt;
	&lt;li&gt;(add) zookeeper-server/src/test/java/org/apache/zookeeper/ClientCanonicalizeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16675917" author="hudson" created="Tue, 6 Nov 2018 00:25:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #256 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/256/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/256/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3156&quot; title=&quot;ZOOKEEPER-2184 causes kerberos principal to not have resolved host name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3156&quot;&gt;&lt;del&gt;ZOOKEEPER-3156&lt;/del&gt;&lt;/a&gt;: Add in option to canonicalize host name (andor: rev 83fd6e298dda420125f8be35fda68cb226b0ee05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/client/ZKClientConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) zookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java&lt;/li&gt;
	&lt;li&gt;(add) zookeeper-server/src/test/java/org/apache/zookeeper/ClientCanonicalizeTest.java&lt;/li&gt;
	&lt;li&gt;(add) zookeeper-server/src/main/java/org/apache/zookeeper/SaslServerPrincipal.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yj5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>