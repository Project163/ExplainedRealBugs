<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:05:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-4940] Enabling zookeeper.ssl.ocsp with JRE TLS provider errors out</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-4940</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The problem is that ZK uncoditionally calls &lt;b&gt;io.netty.handler.ssl.SslContextBuilder.enableOcsp(boolean)&lt;/b&gt;&lt;br/&gt;
when &lt;em&gt;zookeeper.ssl.ocsp&lt;/em&gt; is set to true, even though Netty explicitly does not support that for the JRE provider.&lt;/p&gt;

&lt;p&gt;For JRE OCSP is set in the javax.net.ssl.TrustManager object.&lt;br/&gt;
I did not dig deep, but I presume that the OpenSSL provider ignores that, hence it needs another property.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;To make this even more intersting, this setting doesn&apos;t actually do anything at all in Zookeeper.&lt;/del&gt;&lt;br/&gt;
&lt;del&gt;Zookeeper use netty-tcnative-boringssl-static , but this method is a NoOP for boringSSL, it is only supported by tcnative&lt;/del&gt;&lt;br/&gt;
&lt;del&gt;for OpenSSL.&lt;/del&gt;&lt;br/&gt;
&lt;del&gt;(I guess in theory the consumer could replace the tcnative implementation, in which case it would work as intended)&lt;/del&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[zk: ccycloud-1.nightly7310-og.root.comops.site:2182(CONNECTING) 0] 2025-06-18 04:06:01,013 [myid:] - WARN  [zkNetty-EpollEventLoopGroup-1-1:o.a.z.c.ClientX509Util@72] - zookeeper.ssl.keyStore.location not specified
2025-06-18 04:06:01,074 [myid:] - WARN  [zkNetty-EpollEventLoopGroup-1-1:i.n.c.ChannelInitializer@97] - Failed to initialize a channel. Closing: [id: 0x1fac3cf9]
java.lang.IllegalArgumentException: OCSP is not supported with this SslProvider: JDK
	at io.netty.handler.ssl.SslContext.newClientContextInternal(SslContext.java:837)
	at io.netty.handler.ssl.SslContextBuilder.build(SslContextBuilder.java:648)
	at org.apache.zookeeper.common.ClientX509Util.createNettySslContextForClient(ClientX509Util.java:93)
	at org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initSSL(ClientCnxnSocketNetty.java:449)
	at org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initChannel(ClientCnxnSocketNetty.java:438)
	at org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initChannel(ClientCnxnSocketNetty.java:424)
	at io.netty.channel.ChannelInitializer.initChannel(ChannelInitializer.java:129)
	at io.netty.channel.ChannelInitializer.handlerAdded(ChannelInitializer.java:112)
	at io.netty.channel.AbstractChannelHandlerContext.callHandlerAdded(AbstractChannelHandlerContext.java:1130)
	at io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(DefaultChannelPipeline.java:558)
	at io.netty.channel.DefaultChannelPipeline.access$100(DefaultChannelPipeline.java:45)
	at io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute(DefaultChannelPipeline.java:1410)
	at io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers(DefaultChannelPipeline.java:1064)
	at io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded(DefaultChannelPipeline.java:599)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.register0(AbstractChannel.java:513)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.access$200(AbstractChannel.java:428)
	at io.netty.channel.AbstractChannel$AbstractUnsafe$1.run(AbstractChannel.java:485)
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:408)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:998)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:750)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13621180">ZOOKEEPER-4940</key>
            <summary>Enabling zookeeper.ssl.ocsp with JRE TLS provider errors out</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stoty">Istvan Toth</assignee>
                                    <reporter username="stoty">Istvan Toth</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 18 Jun 2025 04:12:18 +0000</created>
                <updated>Fri, 29 Aug 2025 21:28:59 +0000</updated>
                            <resolved>Tue, 29 Jul 2025 20:04:32 +0000</resolved>
                                    <version>3.10.0</version>
                    <version>3.9.3</version>
                                    <fixVersion>3.10.0</fixVersion>
                    <fixVersion>3.9.4</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="23400">6.5h</timespent>
                                <comments>
                            <comment id="17981671" author="stoty" created="Wed, 18 Jun 2025 04:51:28 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andor&quot; class=&quot;user-hover&quot; rel=&quot;andor&quot;&gt;andor&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17982786" author="andorm" created="Wed, 18 Jun 2025 18:33:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;when&#160;&lt;em&gt;zookeeper.ssl.ocsp&lt;/em&gt;&#160;is set to true&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This sounds like a user error to me. Why do you want to set it if it&apos;s not supported by your runtime?&lt;/p&gt;</comment>
                            <comment id="17983440" author="stoty" created="Thu, 19 Jun 2025 05:21:58 +0000"  >&lt;p&gt;No.&lt;br/&gt;
This happens if you set ocsp to true and use the JRE provider , which is totally supported by the runtime.&lt;/p&gt;

&lt;p&gt;Setting the parameter causes the Tcnative provider to request a stapled OCSP response from the server.&lt;br/&gt;
The JRE provider has a system property for the same purpose, and no way to configure this on an Connection/SSLContext basis.&lt;/p&gt;

&lt;p&gt;So Netty is kind of right by not accepting the parameter for JRE, but this is still a horrible API.&lt;/p&gt;

&lt;p&gt;(And this still doesn&apos;t do anything unless you replace the default tcnative implementation used by ZK)&lt;/p&gt;</comment>
                            <comment id="17985130" author="andorm" created="Sat, 21 Jun 2025 22:59:12 +0000"  >&lt;p&gt;Could you please share both the client and server configuration (config files and command line parameters) which is broken?&lt;/p&gt;

&lt;p&gt;What if we just put this setting behind an SslProvider check and don&apos;t set it if SslProvider == JDK?&lt;/p&gt;</comment>
                            <comment id="17985131" author="andorm" created="Sat, 21 Jun 2025 23:10:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Setting the parameter causes the Tcnative provider to request a stapled OCSP response from the server.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Really? We&apos;ve never added OCSP stapling support to ZooKeeper. Based on the JDK documentation, it can be enabled on both client and server side by setting&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jdk.tls.client.enableStatusRequestExtension=true
jdk.tls.server.enableStatusRequestExtension=true&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;system properties, but ZooKeeper doesn&apos;t touch these. Therefore we only do CRL and client-side OCSP if revocation is enabled.&lt;/p&gt;

&lt;p&gt;In which case we might not need to set it in SslContext at all. Have you found Netty&apos;s documentation of this property?&lt;/p&gt;</comment>
                            <comment id="17985132" author="andorm" created="Sat, 21 Jun 2025 23:19:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://netty.io/4.1/api/io/netty/handler/ssl/OpenSsl.html#isOcspSupported--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Even better&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OpenSsl.isOcspSupported()) {
    sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which will enable Ocsp stapling if set in the ZooKeeper configuration &lt;em&gt;and&lt;/em&gt; the provider supports it. For the JRE provider one must set it via the above mentioned properties. I&apos;m not sure if we want to integrate that in ZooKeeper, though we already set some other system properties on the server side.&lt;/p&gt;</comment>
                            <comment id="18003522" author="stoty" created="Mon, 7 Jul 2025 13:11:22 +0000"  >&lt;p&gt;I&apos;ve just replied to the same issue on the PR.&lt;/p&gt;

&lt;p&gt;jdk.tls.client.enableStatusRequestExtension=true&lt;br/&gt;
jdk.tls.server.enableStatusRequestExtension=true&lt;/p&gt;

&lt;p&gt;works for the JRE TLS provider, while &lt;/p&gt;

&lt;p&gt;sslContextBuilder.enableOcsp() works for tcnative. (if supported)&lt;/p&gt;

&lt;p&gt;The problem is that sslContextBuilder.enableOcsp() when the provider is JRE will just throw an exception, hence we need to check for the provider before calling it.&lt;/p&gt;

&lt;p&gt;OpenSsl.isOcspSupported() only tells us if the native library loaded by tcnative supports it, but that&apos;s unrelated to whether we&apos;re using tcnative or the JRE provider.&lt;br/&gt;
i.e tcnative could have loaded an OpenSSL native library that supports OCSP, but if we set the JRE TLS provider for Netty, it still won&apos;t work.&lt;/p&gt;</comment>
                            <comment id="18010731" author="andorm" created="Tue, 29 Jul 2025 20:04:32 +0000"  >&lt;p&gt;Issue resolved by pull request 2282&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/2282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/2282&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13622681">ZOOKEEPER-4949</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13485657">ZOOKEEPER-4622</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wdlc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>