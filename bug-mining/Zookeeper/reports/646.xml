<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:56:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2006] Standalone mode won&apos;t take client port from dynamic config</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2006</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When clientPort is specified in the new format, using &quot;server.x=host:port1:port2;clientPort&quot; in either static or dynamic file and without a &quot;clientPort = xxxx&quot; statement, a standalone mode server doesn&apos;t set up client port. &lt;/p&gt;

&lt;p&gt;A second problem is that zkServer.sh looks for the client port in both static and dynamic files, but when looking in the static files it only looks for the &quot;clientPort&quot; statement, so if its specified in the new format the port will be missed and commands such as &quot;zkServer.sh status&quot; will not work. This is a problem for standalone mode, but also in distributed mode when the server is still LOOKING (once a leader is established and the server is LEADING/FOLLOWING/OBSERVING, a dynamic file is created and the client port will be found by the script).&lt;/p&gt;

&lt;p&gt;Review Board:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/24786/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24786/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12732707">ZOOKEEPER-2006</key>
            <summary>Standalone mode won&apos;t take client port from dynamic config</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hdeng">Hongchao Deng</assignee>
                                    <reporter username="hdeng">Hongchao Deng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Aug 2014 22:26:52 +0000</created>
                <updated>Sat, 30 Aug 2014 18:29:27 +0000</updated>
                            <resolved>Tue, 19 Aug 2014 20:53:12 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14097569" author="shralex" created="Thu, 14 Aug 2014 20:20:17 +0000"  >&lt;p&gt;Hi, yeah dynamic file doesn&apos;t really make sense in the standalone mode.&lt;br/&gt;
Perhaps we could make sure that its unspecified by checking that QuorumPeerConfig.dynamicConfigFileStr wasm&apos;t set somewhere in org.apache.zookeeper.server.ServerConfig.readFrom&lt;/p&gt;</comment>
                            <comment id="14097594" author="shralex" created="Thu, 14 Aug 2014 20:27:42 +0000"  >&lt;p&gt;Btw I noticed that when in standalone mode the static config file still gets backed up. Probably not an issue though.&lt;/p&gt;</comment>
                            <comment id="14097636" author="hdeng" created="Thu, 14 Aug 2014 20:51:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;&lt;br/&gt;
Good for sharing the thoughts.&lt;/p&gt;

&lt;p&gt;Currently the standalone logic isn&apos;t separated out. I think this could be a good chance to refactor standalone code. For example, look at the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isDistributed() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; quorumVerifier!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; (!standaloneEnabled || quorumVerifier.getVotingMembers().size() &amp;gt; 1);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This could be changed to simply returning the boolean.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Regardingstandalonemodeanddynamicconfig.&quot;&gt;&lt;/a&gt;Regarding standalone mode and dynamic config.&lt;/h2&gt;

&lt;p&gt;Let me summarize my thoughts and more is welcome to add:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Pre-assumption: &quot;standaloneEnabled&quot; and &quot;dynamicConfigFile&quot; is &lt;b&gt;mutually exclusive&lt;/b&gt; in config file.&lt;/li&gt;
	&lt;li&gt;Backward-compatibility: A single line &amp;#8211; &quot;server.X=...&quot; in &lt;b&gt;static&lt;/b&gt; config file is still standalone mode.&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;&lt;a name=&quot;TODO&quot;&gt;&lt;/a&gt;TODO&lt;/h3&gt;
&lt;p&gt;1. check mutual exclusiveness of &quot;standaloneEnabled&quot; and &quot;dynamicConfigFile&quot;.&lt;br/&gt;
2. Make sure standalone wouldn&apos;t create dynamic file.&lt;br/&gt;
3. Enforce the minimum number of servers is 2 for any dynamic ensemble. So a server with dynamic file of &lt;b&gt;one&lt;/b&gt; server wouldn&apos;t be able to start.&lt;/p&gt;

&lt;p&gt;One question,&lt;br/&gt;
what if a user use the new format&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;server.1=localhost:X:X:participant; port
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a problem because standalone wouldn&apos;t get client port from quorum verifier (there isn&apos;t one).&lt;/p&gt;</comment>
                            <comment id="14097651" author="shralex" created="Thu, 14 Aug 2014 21:01:09 +0000"  >&lt;p&gt;In general I don&apos;t think improving standalone mode is worth it. The recent introduction of the standaloneEnabled flag and the related support for running the normal non-standalone stack with a single server ensemble makes standalone mode unnecessary. One would probably pretty much always prefer to run with standaloneEnabled = false in a distributed mode. So I expect standalone mode to go away in the future.&lt;/p&gt;

&lt;p&gt;&amp;gt; Pre-assumption: &quot;standaloneEnabled&quot; and &quot;dynamicConfigFile&quot; is mutually exclusive in config file.&lt;br/&gt;
I don&apos;t think this is true. standaloneEnabled may be true or false depending on whether one wants to allow the cluster to shrink to a single server. at the same time dynamicConfigfile can be specified.&lt;/p&gt;

&lt;p&gt;&amp;gt; Backward-compatibility: A single line &#8211; &quot;server.X=...&quot; in static config file is still standalone mode.&lt;br/&gt;
Not sure about that. Standalone mode doesn&apos;t understand what a quorum or leader port is, what an observer is, etc. So writing such a line is kindof strange in standalone mode. &lt;/p&gt;</comment>
                            <comment id="14097661" author="shralex" created="Thu, 14 Aug 2014 21:08:04 +0000"  >&lt;p&gt;I think if you take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt; it can help clarify things.&lt;/p&gt;</comment>
                            <comment id="14097684" author="hdeng" created="Thu, 14 Aug 2014 21:22:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;&lt;br/&gt;
Okay. Adding a &quot;standaloneEnabled=false&quot; solve all the problems.&lt;/p&gt;

&lt;p&gt;My concern is about two scenarios:&lt;/p&gt;

&lt;p&gt;1. I set only one server in dynamic config.&lt;br/&gt;
dynamic file looks like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;server.X=...participant; 2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wonder if it makes more sense to assume it is equal to &quot;standaloneEnabled=false&quot; if &quot;dynamicConfigFile&quot; is set?&lt;/p&gt;

&lt;p&gt;2. same as above. If it is not &quot;standaloneEnabled=false&quot;, then the user has made another mistake that client port is added only in dynamic file.&lt;/p&gt;

&lt;p&gt;What do you think to deal with this?&lt;/p&gt;</comment>
                            <comment id="14097821" author="hdeng" created="Thu, 14 Aug 2014 22:34:32 +0000"  >&lt;p&gt;Let me give one example and make it clearer:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;static file doesn&apos;t set &quot;standaloneEnabled&quot; but has a dynamic config file.&lt;/li&gt;
	&lt;li&gt;the dynamic config contains only a single server information.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When it is booted up, the server will be in standalone mode. So there are two potential problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the user might just want to setup a single server and add more servers later.&lt;/li&gt;
	&lt;li&gt;the user might not realize that standalone mode requires client port to be in the old way in static file like &quot;clientPort=2818&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it would be nice to disable standalone mode if &quot;dynamicConfigFile&quot; is set.&lt;/p&gt;</comment>
                            <comment id="14097835" author="shralex" created="Thu, 14 Aug 2014 22:41:02 +0000"  >&lt;p&gt;I take my suggestion back - everything should work fine now. It doesn&apos;t work because of two bugs - see below.&lt;/p&gt;

&lt;p&gt;About standaloneEnabled - I think we should have a known default value for standaloneEnabled and that shouldn&apos;t change based on other flags. I think it was set to true for backward comaptibility reasons. Michi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt; can probably explain better.&lt;/p&gt;

&lt;p&gt;But actually, I think there are 2 bugs we should fix.&lt;br/&gt;
1) in QuorumPeerConfig the following lines are executed only when its distributed mode. I think this is why the standalone mode doesn&apos;t listen on the client port. I think we should move it out of CheckValidity - run it after checkValidity is invoked, wherever that happens. &lt;/p&gt;

&lt;p&gt;QuorumServer qs = quorumVerifier.getAllMembers().get(serverId);&lt;br/&gt;
if (qs!=null &amp;amp;&amp;amp; qs.clientAddr != null) clientPortAddress = qs.clientAddr; &lt;/p&gt;

&lt;p&gt;2) bin/zkServer.sh doesn&apos;t look for for client port in the static file. There is a bunch of code there to find it in the dynamic file but not in the static one if its specified in the new format. Fixing this seems important for backward compatibility. I attach a draft of this fix.&lt;/p&gt;</comment>
                            <comment id="14097845" author="hdeng" created="Thu, 14 Aug 2014 22:46:45 +0000"  >&lt;p&gt;Okay. Cool. I will work on fixing the client port thing.&lt;/p&gt;</comment>
                            <comment id="14098062" author="hadoopqa" created="Fri, 15 Aug 2014 02:06:35 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12661917/draft&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12661917/draft&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1617921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2280//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14098112" author="hdeng" created="Fri, 15 Aug 2014 03:50:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;.&lt;br/&gt;
Can you help give some insights into standaloneEnabled variable in QuorumPeerConfig? I wonder if this could be improved based on Alex&apos;s comments:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;we should have a known default value for standaloneEnabled and that shouldn&apos;t change based on other flags&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14098115" author="michim" created="Fri, 15 Aug 2014 03:59:00 +0000"  >&lt;p&gt;I don&apos;t know if I can give you much insight, but the idea was to add an option to disable standalone mode so that you can bootstrap a cluster using the dynamic reconfiguration. The default value for standaloneEnabled is set to true for backward compatibility.&lt;/p&gt;</comment>
                            <comment id="14099451" author="shralex" created="Sat, 16 Aug 2014 02:06:40 +0000"  >&lt;p&gt;Hi Hongchao, thanks for the patch!&lt;br/&gt;
Its probably better to take this logic out of CheckValidity. The name of the function implies that its only checking stuff but not modifying state. How about putting it in a separate function and invoking it after CheckValidity ?&lt;/p&gt;</comment>
                            <comment id="14099462" author="hdeng" created="Sat, 16 Aug 2014 02:35:52 +0000"  >&lt;blockquote&gt;
&lt;p&gt;How about putting it in a separate function and invoking it after CheckValidity ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sounds good.&lt;/p&gt;

&lt;p&gt;I am also waiting for the test result. I expect there would be a few.&lt;/p&gt;</comment>
                            <comment id="14099463" author="hadoopqa" created="Sat, 16 Aug 2014 02:37:31 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662207/ZOOKEEPER-2006.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662207/ZOOKEEPER-2006.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1617921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2284//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14099488" author="hdeng" created="Sat, 16 Aug 2014 03:39:18 +0000"  >&lt;p&gt;It looks like there is quite a few test failures.&lt;/p&gt;

&lt;p&gt;The change I made in QuorumTestBase is that previously a MainThread will write &quot;clientPort&quot; both to static config (zoo.cfg) and dynamic file. Something looks like this, and it&apos;s duplicated.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;clientPort=2181
...
server.1=localhost:X:X:participant;2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the change, if a user had written a &quot;dynamicConfigFile&quot; on bootup, it won&apos;t have &quot;clientPort&quot; in static config. That&apos;s EXPECTED behavior.&lt;/p&gt;

&lt;p&gt;I will try to figure out what is hidden in those failures. At the mean time, anyone who has ideas please share.&lt;/p&gt;</comment>
                            <comment id="14100140" author="hdeng" created="Sun, 17 Aug 2014 21:59:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;&lt;br/&gt;
I have worked out a solution and put code on review board: &lt;a href=&quot;https://reviews.apache.org/r/24786/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24786/&lt;/a&gt;&lt;br/&gt;
Any feedback is appreciated much!&lt;/p&gt;</comment>
                            <comment id="14100195" author="hadoopqa" created="Mon, 18 Aug 2014 00:39:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662394/ZOOKEEPER-2006-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662394/ZOOKEEPER-2006-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1617921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2285//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14100199" author="shralex" created="Mon, 18 Aug 2014 00:46:35 +0000"  >&lt;p&gt;Hi Hongchao,&lt;/p&gt;

&lt;p&gt;great work! I really liked your changes. I had a few minor comments in the review board and also changed the description of this JIRA to clarify the problem a bit. &lt;/p&gt;

&lt;p&gt;Alex&lt;/p&gt;</comment>
                            <comment id="14100212" author="hdeng" created="Mon, 18 Aug 2014 01:37:27 +0000"  >&lt;p&gt;Cool. Thanks for the feedback. It also help me find a bug in isDistributed():&lt;br/&gt;
1. if quorumVerifier members equals 0 and standaloneEnabled = false, it returns true (quorum), which should be false (standalone).&lt;/p&gt;</comment>
                            <comment id="14100217" author="shralex" created="Mon, 18 Aug 2014 01:53:53 +0000"  >&lt;p&gt;Hmm... if standaloneEnabled = false the user explicitly asked not to run standalone mode. He probably forgot to specify the server(s). I think instead of changing isDistributed() we should add a check to parseDynamicConfig, after quorumVerified is set: if standaloneEnabled = false then numParticipators should be &amp;gt;= 1.&lt;/p&gt;</comment>
                            <comment id="14100240" author="hdeng" created="Mon, 18 Aug 2014 03:08:02 +0000"  >&lt;p&gt;Sounds reasonable. I added a check for that. I keep my change in isDistributed() because that&apos;s the expected logic.&lt;/p&gt;</comment>
                            <comment id="14100266" author="shralex" created="Mon, 18 Aug 2014 04:23:00 +0000"  >&lt;p&gt;why is this the expected logic ? isDistributed() determines which stack we&apos;re gonna run - standalone or distributed. If standaloneEnabled = false the user expects us to run a distributed stack. Its just that the other settings should be set so that we&apos;re indeed able to run it or we should fail the boot. &lt;/p&gt;</comment>
                            <comment id="14100271" author="shralex" created="Mon, 18 Aug 2014 04:31:32 +0000"  >&lt;p&gt;in other words - in this case I&apos;d prefer to run the distributed stack as the user wanted and let some other code report a failure or just crash rather than to run a standalone stack. Consider for example a bug where your new check that throws the exception doesn&apos;t run for some reason - if the system just runs in standalone mode it will be difficult for the user to detect that anything went wrong.&lt;/p&gt;</comment>
                            <comment id="14100273" author="hdeng" created="Mon, 18 Aug 2014 04:41:47 +0000"  >&lt;p&gt;Made sense.&lt;br/&gt;
Thanks for the comments.&lt;/p&gt;</comment>
                            <comment id="14100352" author="hadoopqa" created="Mon, 18 Aug 2014 06:42:39 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662420/ZOOKEEPER-2006-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662420/ZOOKEEPER-2006-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1617921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2288//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14100828" author="shralex" created="Mon, 18 Aug 2014 16:41:25 +0000"  >&lt;p&gt;Hi Hongchao, &lt;/p&gt;

&lt;p&gt;I tried to run it and there are still multiple issues with zkServer.sh changes.&lt;br/&gt;
I can work on this tonight or if you have time you can take a look.&lt;/p&gt;

&lt;p&gt;Currently there&apos;s a small parsing error in zkServer.sh, but besides that there are a few issues:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;myid is not checked. Its possible that clientPort wasn&apos;t specified, myid wasn&apos;t set and yet it finds the port.&lt;/li&gt;
	&lt;li&gt;if there was no &quot;;port&quot; in the server.x line, it will find port2 here &quot;sever.1=host:port1:port2&quot; since it deletes everything before &quot;;&quot; but there&apos;s no &quot;;&quot; here. We need to check that there&apos;s a &quot;;&quot; and something after it before doing &quot;sed&quot;.&lt;/li&gt;
	&lt;li&gt;clientPortAddress is not set correctly if I write &quot;server.1=host:port1:port2;host2:port3&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;we need to check this more by running with different possible config files.&lt;/p&gt;

&lt;p&gt;Maybe this should be a separate JIRA since this is not only related to standalone mode.&lt;/p&gt;</comment>
                            <comment id="14100829" author="shralex" created="Mon, 18 Aug 2014 16:43:03 +0000"  >&lt;p&gt;btw the way I debug this is just by running &quot;./bin/zkServer status&quot; and printing stuff - there&apos;s no need to start the server even.&lt;/p&gt;</comment>
                            <comment id="14100913" author="hdeng" created="Mon, 18 Aug 2014 17:40:38 +0000"  >&lt;p&gt;I didn&apos;t have any problem running it..&lt;br/&gt;
In three cases:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;clientPort=2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;server.1=...;2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dynamicConfigFile=./dyanmicFile
... (in dynamicFile)...
server.1=...;2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it shows&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: ./zoo.cfg
Client port found: 2183
Mode: standalone
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14100954" author="hdeng" created="Mon, 18 Aug 2014 18:00:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;&lt;br/&gt;
BTW, I changed one thing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ! [[ &lt;span class=&quot;code-quote&quot;&gt;&quot;$clientPort&quot;&lt;/span&gt; =~ ^[0-9]+$ ]] ; then
-         then
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is an additional &quot;then&quot; introduced by the change in zkServer.sh..&lt;/p&gt;</comment>
                            <comment id="14100984" author="shralex" created="Mon, 18 Aug 2014 18:14:33 +0000"  >&lt;p&gt;The problems I saw where when there was a mistake in the static file. For example there was no client port specified but the script still found it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; And also as I mentioned clientPortAddress is not picked up when specified only in the dynamic way&lt;/p&gt;</comment>
                            <comment id="14101853" author="shralex" created="Tue, 19 Aug 2014 05:04:35 +0000"  >&lt;p&gt;modified the zkServer.sh part of the patch&lt;/p&gt;</comment>
                            <comment id="14101890" author="shralex" created="Tue, 19 Aug 2014 05:45:08 +0000"  >&lt;p&gt;+1 as far as I&apos;m concerned. I tried the patch out a bit and everything looks fine so far.&lt;/p&gt;

&lt;p&gt;if there are no additional comments from others I&apos;ll commit it tomorrow.&lt;/p&gt;</comment>
                            <comment id="14102170" author="hadoopqa" created="Tue, 19 Aug 2014 12:40:12 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662694/ZOOKEEPER-2006-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662694/ZOOKEEPER-2006-v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1617921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2289//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14102818" author="shralex" created="Tue, 19 Aug 2014 20:53:12 +0000"  >&lt;p&gt;Committed to trunk and 3.5.0.&lt;/p&gt;

&lt;p&gt;Thanks a lot, Hongchao!&lt;/p&gt;</comment>
                            <comment id="14103929" author="hudson" created="Wed, 20 Aug 2014 14:26:47 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2412 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2412/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2412/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2006&quot; title=&quot;Standalone mode won&amp;#39;t take client port from dynamic config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2006&quot;&gt;&lt;del&gt;ZOOKEEPER-2006&lt;/del&gt;&lt;/a&gt;. Standalone mode won&apos;t take client port from dynamic config. (Hongchao Deng via Alex Shraer) (shralex: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1618977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1618977&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/bin/zkServer.sh&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/StandaloneTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12730300">ZOOKEEPER-1997</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12662394" name="ZOOKEEPER-2006-v2.patch" size="16594" author="hdeng" created="Sun, 17 Aug 2014 21:56:26 +0000"/>
                            <attachment id="12662411" name="ZOOKEEPER-2006-v3.patch" size="17193" author="hdeng" created="Mon, 18 Aug 2014 01:38:29 +0000"/>
                            <attachment id="12662416" name="ZOOKEEPER-2006-v4.patch" size="17842" author="hdeng" created="Mon, 18 Aug 2014 03:05:41 +0000"/>
                            <attachment id="12662420" name="ZOOKEEPER-2006-v5.patch" size="17276" author="hdeng" created="Mon, 18 Aug 2014 04:42:23 +0000"/>
                            <attachment id="12662694" name="ZOOKEEPER-2006-v6.patch" size="17829" author="shralex" created="Tue, 19 Aug 2014 05:04:35 +0000"/>
                            <attachment id="12662529" name="ZOOKEEPER-2006-v6.patch" size="17489" author="hdeng" created="Mon, 18 Aug 2014 18:00:12 +0000"/>
                            <attachment id="12662207" name="ZOOKEEPER-2006.patch" size="9382" author="hdeng" created="Sat, 16 Aug 2014 00:27:38 +0000"/>
                            <attachment id="12661917" name="draft" size="1715" author="shralex" created="Thu, 14 Aug 2014 22:41:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410735</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ynz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410728</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>