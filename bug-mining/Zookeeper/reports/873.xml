<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:01:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3006] Potential NPE in ZKDatabase#calculateTxnLogSizeLimit</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3006</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I have found a&#160;potential NPE in&#160;ZKDatabase#calculateTxnLogSizeLimit:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//ZKDatabase
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; calculateTxnLogSizeLimit() {
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; snapSize = 0;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
snapSize = snapLog.findMostRecentSnapshot().length();
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to get size of most recent snapshot&quot;&lt;/span&gt;);
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) (snapSize * snapshotSizeFactor);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;in&#160;FileTxnSnapLog#findMostRecentSnapshot(), it will return the result of&#160; FileSnap#findMostRecentSnapshot:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// called by FileTxnSnapLog#findMostRecentSnapshot()
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; File findMostRecentSnapshot() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
List&amp;lt;File&amp;gt; files = findNValidSnapshots(1);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (files.size() == 0) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; files.get(0);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it will return null when the files sizes is 0, but ZKDatabase#calculateTxnLogSizeLimit has no null checker&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13147675">ZOOKEEPER-3006</key>
            <summary>Potential NPE in ZKDatabase#calculateTxnLogSizeLimit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eribeiro">Edward Ribeiro</assignee>
                                    <reporter username="xiaoheipangzi">lujie</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Mar 2018 08:16:21 +0000</created>
                <updated>Fri, 6 Apr 2018 04:31:58 +0000</updated>
                            <resolved>Fri, 6 Apr 2018 04:04:40 +0000</resolved>
                                    <version>3.6.0</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16412662" author="githubbot" created="Sat, 24 Mar 2018 15:36:42 +0000"  >&lt;p&gt;GitHub user edwardoliveira opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&quot; title=&quot;Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3006&quot;&gt;&lt;del&gt;ZOOKEEPER-3006&lt;/del&gt;&lt;/a&gt;: Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/eribeiro/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eribeiro/zookeeper&lt;/a&gt; zk-3006-potential-npe&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #493&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c0a9763c5a0fc63d2cad99ea9d219c08fd454d2e&lt;br/&gt;
Author: Edward Ribeiro &amp;lt;edward.ribeiro@...&amp;gt;&lt;br/&gt;
Date:   2018-03-24T15:35:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&quot; title=&quot;Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3006&quot;&gt;&lt;del&gt;ZOOKEEPER-3006&lt;/del&gt;&lt;/a&gt;: Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16412868" author="githubbot" created="Sun, 25 Mar 2018 03:02:28 +0000"  >&lt;p&gt;Github user LJ1043041006 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 lgtm,  but &quot;All checks have failed&quot; makes me wonder and i think the error is not cause by this patch, am i right.&lt;/p&gt;</comment>
                            <comment id="16412874" author="githubbot" created="Sun, 25 Mar 2018 03:33:19 +0000"  >&lt;p&gt;Github user eribeiro commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @anmoldar thanks for the feedback! Gonna update the description and add a test case asap. Btw, I am not the one who found this potential npe, but I am glad to help. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Last but not least, I opened the PR for master, but should we address this issue on previous branches too? &lt;/p&gt;

&lt;p&gt;    @LJ1043041006 yup, I don&apos;t think the failed tests are related to this patch at all. Gonna take a closer look really soon. ZK has some flaky tests, but looks like there was an exception that prevented any test from running.&lt;/p&gt;</comment>
                            <comment id="16412886" author="githubbot" created="Sun, 25 Mar 2018 04:49:45 +0000"  >&lt;p&gt;Github user LJ1043041006 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @eribeiro , I found this  potential npe  and open issue &lt;span class=&quot;error&quot;&gt;&amp;#91;zk-3006&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&lt;/a&gt;), but i am not  very familiar with zookeeper code, so could you please add a unit test? thinks!&lt;/p&gt;</comment>
                            <comment id="16412977" author="githubbot" created="Sun, 25 Mar 2018 10:43:06 +0000"  >&lt;p&gt;Github user maoling commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1,LGTM&lt;/p&gt;</comment>
                            <comment id="16413181" author="githubbot" created="Sun, 25 Mar 2018 20:18:45 +0000"  >&lt;p&gt;Github user edwardoliveira commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hey, @LJ1043041006, I have just added a unit test. Cheers!&lt;/p&gt;</comment>
                            <comment id="16413274" author="githubbot" created="Mon, 26 Mar 2018 02:04:37 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @edwardoliveira : could you please share your email so I can put it in commit message when merge this? &lt;br/&gt;
    Also, could you please create a JIRA account if you don&apos;t have one on &lt;a href=&quot;https://issues.apache.org/jira/projects/ZOOKEEPER&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/ZOOKEEPER&lt;/a&gt; so I can assign &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&quot; title=&quot;Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3006&quot;&gt;&lt;del&gt;ZOOKEEPER-3006&lt;/del&gt;&lt;/a&gt; to you? This is to make sure we distribute commit credits to contributors.&lt;/p&gt;</comment>
                            <comment id="16413291" author="githubbot" created="Mon, 26 Mar 2018 02:25:23 +0000"  >&lt;p&gt;Github user eribeiro commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @hanm,&lt;/p&gt;

&lt;p&gt;    Excuse me for the mess up and subsequent confusion. @edwardoliveira is me, @eribeiro (on GH and JIRA), but I inadvertedly opened the PR using my second GH account. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    My e-mail is edward.ribeiro@gmail.com&lt;/p&gt;

&lt;p&gt;    If you prefer, I may close this PR and open a new PR from my main account. The referenced branch comes from the right account, already.&lt;/p&gt;

&lt;p&gt;    I have already assigned the issue to myself, btw. &lt;/p&gt;

&lt;p&gt;    Cheers!&lt;/p&gt;</comment>
                            <comment id="16413558" author="githubbot" created="Mon, 26 Mar 2018 08:25:42 +0000"  >&lt;p&gt;Github user LJ1043041006 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi guys, *&lt;b&gt;one more thing&lt;/b&gt;*&lt;br/&gt;
    I have developed a very simple tool to find Potential NPE in Zookeeper(based on  &lt;span class=&quot;error&quot;&gt;&amp;#91;WALA&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/wala/WALA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wala/WALA&lt;/a&gt;)), I list the result in ZK-3007~3010&lt;br/&gt;
    , so anyone can help me confirm them and  improve this tool (hopefully it can be open source  ) &lt;/p&gt;</comment>
                            <comment id="16427911" author="hanm" created="Fri, 6 Apr 2018 04:04:40 +0000"  >&lt;p&gt;Issue resolved by pull request 493&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16427912" author="githubbot" created="Fri, 6 Apr 2018 04:04:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16427931" author="githubbot" created="Fri, 6 Apr 2018 04:05:53 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/493&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @edwardoliveira that&apos;s fine, I did not know that&apos;s you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Patch committed.&lt;/p&gt;</comment>
                            <comment id="16427958" author="hudson" created="Fri, 6 Apr 2018 04:31:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3790 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3790/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3790/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3006&quot; title=&quot;Potential NPE in ZKDatabase#calculateTxnLogSizeLimit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3006&quot;&gt;&lt;del&gt;ZOOKEEPER-3006&lt;/del&gt;&lt;/a&gt;: Potential NPE in ZKDatabase#calculateTxnLogSizeLimit (hanm: rev fbd21329d32f185d198344f2d394175c92a82f9e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/ZKDatabase.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/ZkDatabaseCorruptionTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rqlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>