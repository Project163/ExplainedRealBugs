<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:04:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-4477] Single Kerberos ticket renewal failure can prevent all future renewals since Java 9</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-4477</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Zookeeper refresh thread for Kerberos have the same problem in the reLogin() &lt;a href=&quot;https://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/Login.java#L413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/Login.java#L413&lt;/a&gt;&#160; function as describe in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-12730&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The refresh thread for Kerberos performs re-login by logging out and then logging in again. If login fails, we retry after a backoff. Every iteration of the loop performs loginContext.logout() and loginContext.login(). If login fails, we end up with two consecutive logouts. This used to work, but from Java 9 onwards, this results in a NullPointerException due to &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8173069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8173069&lt;/a&gt;. We should check if logout is required before attempting logout.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A NPE is throw if multiple logout() is invoke multiple times:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-02-14 18:38:11,899 ERROR org.apache.zookeeper.Login: Failed to refresh TGT: refresh thread exiting now.
javax.security.auth.login.LoginException: java.lang.NullPointerException: invalid &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; input(s)
&#160; &#160; at java.base/java.util.Objects.requireNonNull(Objects.java:246)
&#160; &#160; at java.base/javax.security.auth.Subject$SecureSet.remove(Subject.java:1172)
&#160; &#160; at java.base/java.util.Collections$SynchronizedCollection.remove(Collections.java:2043)
&#160; &#160; at jdk.security.auth/com.sun.security.auth.module.Krb5LoginModule.logout(Krb5LoginModule.java:1202)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.invoke(LoginContext.java:732)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:665)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:663)
&#160; &#160; at java.base/java.security.AccessController.doPrivileged(Native Method)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:663)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.logout(LoginContext.java:613)
&#160; &#160; at org.apache.zookeeper.Login.reLogin(Login.java:413)
&#160; &#160; at org.apache.zookeeper.Login.access$500(Login.java:49)
&#160; &#160; at org.apache.zookeeper.Login$1.run(Login.java:240)
&#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.invoke(LoginContext.java:821)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:665)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:663)
&#160; &#160; at java.base/java.security.AccessController.doPrivileged(Native Method)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:663)
&#160; &#160; at java.base/javax.security.auth.login.LoginContext.logout(LoginContext.java:613)
&#160; &#160; at org.apache.zookeeper.Login.reLogin(Login.java:413)
&#160; &#160; at org.apache.zookeeper.Login.access$500(Login.java:49)
&#160; &#160; at org.apache.zookeeper.Login$1.run(Login.java:240)
&#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13430119">ZOOKEEPER-4477</key>
            <summary>Single Kerberos ticket renewal failure can prevent all future renewals since Java 9</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="symat">Mate Szalay-Beko</assignee>
                                    <reporter username="vgrivel">Vincent Grivel</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 23 Feb 2022 07:25:51 +0000</created>
                <updated>Mon, 26 Aug 2024 14:46:00 +0000</updated>
                            <resolved>Tue, 1 Mar 2022 15:41:05 +0000</resolved>
                                    <version>3.5.9</version>
                    <version>3.6.3</version>
                    <version>3.7.0</version>
                                    <fixVersion>3.5.10</fixVersion>
                    <fixVersion>3.7.1</fixVersion>
                    <fixVersion>3.6.4</fixVersion>
                    <fixVersion>3.9.0</fixVersion>
                    <fixVersion>3.8.1</fixVersion>
                                    <component>kerberos</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="16800">4h 40m</timespent>
                                <comments>
                            <comment id="17496562" author="eolivelli" created="Wed, 23 Feb 2022 08:25:30 +0000"  >&lt;p&gt;This is interesting I have been running zookeeper with kerberos as soon as java9 was released and I had never seen this problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Would you like to send a PR?&lt;/p&gt;</comment>
                            <comment id="17497948" author="symat" created="Fri, 25 Feb 2022 07:21:18 +0000"  >&lt;p&gt;I have seen this exception already with ZK 3.5.5 on java 11.&lt;br/&gt;
The TGT renewal thread seems to retry the TGT renewal a few times (waiting 10 seconds between retries). I&apos;m not exactly sure what will happen after the TGT renewal thread finally exit? (maybe the client will start a new Login? Or this had to be done by the application or e.g. curator?)&lt;/p&gt;

&lt;p&gt;Anyway, the problem seems valid, and the patch applied by &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-12730&lt;/a&gt; seems reasonable and safe. I&apos;ll prepare a fix for this. I think the same problem appears even on master branch in ZooKeeper.&lt;/p&gt;</comment>
                            <comment id="17497955" author="symat" created="Fri, 25 Feb 2022 07:27:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vgrivel&quot; class=&quot;user-hover&quot; rel=&quot;vgrivel&quot;&gt;vgrivel&lt;/a&gt; please let me know if you are already working on the patch, otherwise I&apos;ll create one soon.&lt;/p&gt;</comment>
                            <comment id="17497958" author="symat" created="Fri, 25 Feb 2022 07:30:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;I had never seen this problem.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I heard someone reproduced this by decreasing TGT expiration time during tests. But I guess other kerberos problem (KDC overload, temporary network problems, etc) can trigger this also in normal production systems.&lt;/p&gt;</comment>
                            <comment id="17498008" author="JIRAUSER285658" created="Fri, 25 Feb 2022 09:21:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt; I&apos;m not working on a patch so I will let you do it if it is good.&#160;&lt;br/&gt;
We start seeing this issue by doing an extensive test of KDC failures and resiliency of Kafka. For that we simulate KDC failure while decreasing the TGT validity to few minutes.&#160;&lt;/p&gt;

&lt;p&gt;Linked to that issue, we also raised a JDK enhancement request: &lt;a href=&quot;https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8282223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8282223&lt;/a&gt; as currently only a SocketTimeoutException trigger the retry mechanism to connect to the KDC.&lt;/p&gt;</comment>
                            <comment id="17498220" author="symat" created="Fri, 25 Feb 2022 17:21:07 +0000"  >&lt;p&gt;PR created against the master branch, any comments are welcomed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1828&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1828&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17499614" author="eolivelli" created="Tue, 1 Mar 2022 15:41:05 +0000"  >&lt;p&gt;Issue resolved by pull request 1833&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1833&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17500008" author="JIRAUSER285658" created="Wed, 2 Mar 2022 09:32:51 +0000"  >&lt;p&gt;Thanks for the work and the fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zutc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>