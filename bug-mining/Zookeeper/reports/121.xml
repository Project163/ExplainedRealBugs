<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:47:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-427] ZooKeeper server unexpectedly high CPU utilisation</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-427</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I am running a 5 node ZooKeeper cluster and I noticed that one of them has very high CPU usage:&lt;/p&gt;

&lt;p&gt; PID   USER      PR  NI  VIRT  RES  SHR S   %CPU %MEM    TIME+   COMMAND &lt;br/&gt;
 6883  infact       22   0   725m  41m  4188 S   95       0.5          5671:54  java&lt;/p&gt;

&lt;p&gt;It is not &quot;doing anything&quot; application-wise at this point, so I was wondering why the heck it&apos;s using up so much CPU.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux: 2.6.18-92.1.18.el5 #1 SMP Wed Nov 12 09:19:49 EST 2008 x86_64 x86_64 x86_64 GNU/Linux&lt;br/&gt;
java version &quot;1.6.0_03&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_03-b05)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 1.6.0_03-b05, mixed mode)&lt;/p&gt;</environment>
        <key id="12426974">ZOOKEEPER-427</key>
            <summary>ZooKeeper server unexpectedly high CPU utilisation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Paiva Junqueira</assignee>
                                    <reporter username="satish">Satish Kotha</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2009 21:01:41 +0000</created>
                <updated>Mon, 11 Oct 2010 07:34:54 +0000</updated>
                            <resolved>Thu, 18 Jun 2009 20:33:45 +0000</resolved>
                                    <version>3.1.1</version>
                                    <fixVersion>3.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12715684" author="satish" created="Tue, 2 Jun 2009 21:03:55 +0000"  >&lt;p&gt;Attached a jstack and the zookeeper logfile.&lt;/p&gt;</comment>
                            <comment id="12715693" author="mahadev" created="Tue, 2 Jun 2009 21:16:44 +0000"  >&lt;p&gt;satish, can you just try strace to see which one of thread is spinning? &lt;br/&gt;
also, with the log files it seems like you are doing a lot of trasactions through some other zookeeper server? &lt;/p&gt;</comment>
                            <comment id="12715698" author="satish" created="Tue, 2 Jun 2009 21:29:04 +0000"  >&lt;p&gt;I ran: strace -o zookeeper-strace.log -p6883&lt;/p&gt;

&lt;p&gt;So far nothing in the logfile.&lt;/p&gt;

&lt;p&gt;less zookeeper-strace.log&lt;/p&gt;

&lt;p&gt;futex(0x404079d0, FUTEX_WAIT, 6884, NULL&lt;/p&gt;</comment>
                            <comment id="12715703" author="satish" created="Tue, 2 Jun 2009 21:44:39 +0000"  >&lt;p&gt;Attached zoo.cfg file.&lt;/p&gt;</comment>
                            <comment id="12715714" author="mahadev" created="Tue, 2 Jun 2009 21:54:53 +0000"  >&lt;p&gt;satish for strace &lt;/p&gt;

&lt;p&gt;you will have to do an strace on all the pid&apos;s in&lt;/p&gt;

&lt;p&gt;/proc/6883/tasks/&lt;/p&gt;

&lt;p&gt;to see which of the threads is spinning and on what... &lt;/p&gt;</comment>
                            <comment id="12715723" author="satish" created="Tue, 2 Jun 2009 22:27:05 +0000"  >&lt;p&gt;oops!  Sorry, Mahadev, I already bounced that zookeeper server, (it&apos;s a production server, so I didn&apos;t want to leave it flapping for too long)  and it&apos;s been behaving well since.  If I can reproduce the problem I will run strace as you have suggested.&lt;/p&gt;</comment>
                            <comment id="12715731" author="mahadev" created="Tue, 2 Jun 2009 22:37:25 +0000"  >&lt;p&gt;no worries satish,&lt;br/&gt;
 I hope we could have gotten that trace though... We had seen similar behavior in another jira &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-287&quot; title=&quot;high cpu utilization caused by nioserver factory thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-287&quot;&gt;&lt;del&gt;ZOOKEEPER-287&lt;/del&gt;&lt;/a&gt;, and wanted to make sure if both are caused by similar problems. I have linked these two together. Do update the jira in case you run into this again.&lt;/p&gt;
</comment>
                            <comment id="12716020" author="phunt" created="Wed, 3 Jun 2009 18:28:22 +0000"  >&lt;p&gt;I found &lt;a href=&quot;https://issues.apache.org/jira/browse/DIRMINA-678&quot; title=&quot;NioProcessor 100% CPU usage on Linux (epoll selector bug)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DIRMINA-678&quot;&gt;&lt;del&gt;DIRMINA-678&lt;/del&gt;&lt;/a&gt; which looks the same as what we are seeing.&lt;/p&gt;

&lt;p&gt;Basically nio in the 1.6 jdk is broken and afaict it&apos;s not fixed until jdk7:&lt;br/&gt;
&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6403933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6403933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There&apos;s a potential work around used by grizzly/mina that recreates the selector if this&lt;br/&gt;
problem occurs. We should look at creating a test for this and fixing in 3.2 if we can have&lt;br/&gt;
high confidence in the patch.&lt;/p&gt;</comment>
                            <comment id="12720949" author="zhurs" created="Wed, 17 Jun 2009 22:16:13 +0000"  >&lt;p&gt;Hi!&lt;/p&gt;

&lt;p&gt;I think, that problem is not in nio, but in QuorumCnxManager.&lt;/p&gt;

&lt;p&gt;Manager start while-loop when channel is connected and start wait msgLength in read call.&lt;br/&gt;
At this moment process from other side stops and &quot;read&quot; return &quot;-1&quot;&lt;br/&gt;
But there is no checking of &quot;read&quot; return value, so loop become infinite.&lt;/p&gt;

&lt;p&gt;Please, look at my patch, it works for my case.&lt;/p&gt;</comment>
                            <comment id="12721128" author="fpj" created="Thu, 18 Jun 2009 08:55:20 +0000"  >&lt;p&gt;+1, great catch! As the original patch does not apply correctly and doesn&apos;t have the correct file name, I&apos;m uploading a new patch. Unit tests pass for me just fine.&lt;/p&gt;
</comment>
                            <comment id="12721454" author="hadoopqa" created="Thu, 18 Jun 2009 20:21:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12411045/ZOOKEEPER-427.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12411045/ZOOKEEPER-427.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 786156.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/124/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12721458" author="breed" created="Thu, 18 Jun 2009 20:25:56 +0000"  >&lt;p&gt;+1 great catch! thanx for the patch!&lt;/p&gt;</comment>
                            <comment id="12721465" author="breed" created="Thu, 18 Jun 2009 20:33:45 +0000"  >&lt;p&gt;Committed revision 786251.&lt;/p&gt;</comment>
                            <comment id="12722554" author="hudson" created="Mon, 22 Jun 2009 10:48:56 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #354 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/354/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/354/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12413848">ZOOKEEPER-287</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12476980">ZOOKEEPER-893</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12417230">DIRMINA-678</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12411045" name="ZOOKEEPER-427.patch" size="787" author="fpj" created="Thu, 18 Jun 2009 08:55:20 +0000"/>
                            <attachment id="12410997" name="zk_quorum_recv_eof.patch" size="1345" author="zhurs" created="Wed, 17 Jun 2009 22:16:13 +0000"/>
                            <attachment id="12409703" name="zoo.cfg" size="525" author="satish" created="Tue, 2 Jun 2009 21:44:39 +0000"/>
                            <attachment id="12409697" name="zookeeper-jstack.log" size="16126" author="satish" created="Tue, 2 Jun 2009 21:03:55 +0000"/>
                            <attachment id="12409698" name="zookeeper.log" size="127436" author="satish" created="Tue, 2 Jun 2009 21:03:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i060xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>