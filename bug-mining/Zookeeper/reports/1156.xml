<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:05:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-4699] zh-&gt;hostname heap-use-after-free in zookeeper_interest</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-4699</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;we got an asan error. The usage is one separate thread call zoo_set_servers periodically. It will use lock to make (free and reset zh-&amp;gt;hostname operation) atomic: &lt;br/&gt;
&lt;tt&gt;// NOTE: guard access to{hostname, addr_cur, addrs, addrs_old, addrs_new}lock_reconfig(zh);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;in the mean while the io thread will call zoo_interest function and access zh-&amp;gt;hostname in log: &lt;tt&gt;LOG_WARN(LOGCALLBACK(zh), &quot;Delaying connection after exhaustively trying all servers &lt;span class=&quot;error&quot;&gt;&amp;#91;%s&amp;#93;&lt;/span&gt;&quot;,zh-&amp;gt;hostname);&lt;/tt&gt; without any lock...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;stack:&lt;/p&gt;

&lt;p&gt;{{=================================================================&lt;br/&gt;
==450==ERROR: AddressSanitizer: heap-use-after-free on address 0x6030004fcbd0 at pc 0x7fbc74e9a5ce bp 0x7fbc3ebf4060 sp 0x7fbc3ebf3810&lt;br/&gt;
READ of size 2 at 0x6030004fcbd0 thread T98&lt;br/&gt;
#0 0x7fbc74e9a5cd (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x8a5cd)&lt;br/&gt;
#1 0x7fbc74e9c61d in __interceptor_vsnprintf (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x8c61d)&lt;br/&gt;
#2 0x55e1ced0cdd6 in log_message (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x1906dd6)&lt;br/&gt;
#3 0x55e1cecfc578 in zookeeper_interest (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x18f6578)&lt;br/&gt;
#4 0x55e1ced0f0b4 in do_io (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x19090b4)&lt;br/&gt;
#5 0x7fbc74bfa4a3 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x74a3)&lt;br/&gt;
#6 0x7fbc73656d0e in __clone (/lib/x86_64-linux-gnu/libc.so.6+0xe8d0e)&lt;/p&gt;

&lt;p&gt;0x6030004fcbd0 is located 0 bytes inside of 20-byte region [0x6030004fcbd0,0x6030004fcbe4)&lt;br/&gt;
freed by thread T100 here:&lt;br/&gt;
#0 0x7fbc74ed1a10 in free (/usr/lib/x86_64-linux-gnu/libasan.so.3+0xc1a10)&lt;br/&gt;
#1 0x55e1cecf9e14 in zoo_set_servers (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x18f3e14)&lt;br/&gt;
#5 0x7fbc74bfa4a3 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x74a3)&lt;/p&gt;

&lt;p&gt;previously allocated by thread T100 here:&lt;br/&gt;
#0 0x7fbc74e67f30 in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x57f30)&lt;br/&gt;
#1 0x55e1cecf9e20 in zoo_set_servers (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x18f3e20)&lt;br/&gt;
#5 0x7fbc74bfa4a3 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x74a3)&lt;/p&gt;

&lt;p&gt;Thread T98 created by T0 here:&lt;br/&gt;
#0 0x7fbc74e40f59 in __interceptor_pthread_create (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x30f59)&lt;br/&gt;
#1 0x55e1ced0ea97 in start_threads (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x1908a97)&lt;br/&gt;
#2 0x55e1ced0ed11 in adaptor_init (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x1908d11)&lt;br/&gt;
#3 0x55e1cecf9c9c in zookeeper_init_internal (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x18f3c9c)&lt;br/&gt;
#4 0x55e1cecf9d38 in zookeeper_init (/opt/tiger/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/deploy/bin/{&lt;/b&gt;}{&lt;b&gt;}&lt;/b&gt;+0x18f3d38)&lt;br/&gt;
#12 0x55e1ce2f2097 in main /tmp/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/{&lt;/b&gt;}&lt;b&gt;{&lt;/b&gt;}/{&lt;b&gt;}&lt;/b&gt;*/main.cc:148&lt;br/&gt;
#13 0x7fbc7358e2e0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x202e0)&lt;/p&gt;

&lt;p&gt;Thread T100 created by T0 here:&lt;br/&gt;
#0 0x7fbc74e40f59 in __interceptor_pthread_create (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x30f59)&lt;br/&gt;
#8 0x55e1ce2f2097 in main /tmp/&lt;b&gt;{&lt;/b&gt;}{&lt;b&gt;}/{&lt;/b&gt;}&lt;b&gt;{&lt;/b&gt;}/{&lt;b&gt;}&lt;/b&gt;*/main.cc:148&lt;br/&gt;
#9 0x7fbc7358e2e0 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x202e0)&lt;/p&gt;

&lt;p&gt;SUMMARY: AddressSanitizer: heap-use-after-free (/usr/lib/x86_64-linux-gnu/libasan.so.3+0x8a5cd)&lt;br/&gt;
Shadow bytes around the buggy address:&lt;br/&gt;
0x0c0680097920: 00 00 00 07 fa fa 00 00 00 07 fa fa fd fd fd fd&lt;br/&gt;
0x0c0680097930: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa&lt;br/&gt;
0x0c0680097940: fa fa fa fa 00 00 00 07 fa fa 00 00 00 07 fa fa&lt;br/&gt;
0x0c0680097950: 00 00 00 07 fa fa fa fa fa fa fa fa 00 00 00 07&lt;br/&gt;
0x0c0680097960: fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00&lt;br/&gt;
=&amp;gt;0x0c0680097970: 00 07 fa fa fa fa fa fa fa fa&lt;span class=&quot;error&quot;&gt;&amp;#91;fd&amp;#93;&lt;/span&gt;fd fd fa fa fa&lt;br/&gt;
0x0c0680097980: fd fd fd fa fa fa 00 00 00 07 fa fa fd fd fd fd&lt;br/&gt;
0x0c0680097990: fa fa fa fa fa fa fa fa 00 00 00 07 fa fa 00 00&lt;br/&gt;
0x0c06800979a0: 00 07 fa fa fd fd fd fd fa fa 00 00 00 07 fa fa&lt;br/&gt;
0x0c06800979b0: fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd&lt;br/&gt;
0x0c06800979c0: fa fa fd fd fd fd fa fa fa fa fa fa fa fa fd fd&lt;br/&gt;
Shadow byte legend (one shadow byte represents 8 application bytes):&lt;br/&gt;
Addressable: 00&lt;br/&gt;
Partially addressable: 01 02 03 04 05 06 07&lt;br/&gt;
Heap left redzone: fa&lt;br/&gt;
Heap right redzone: fb&lt;br/&gt;
Freed heap region: fd&lt;br/&gt;
Stack left redzone: f1&lt;br/&gt;
Stack mid redzone: f2&lt;br/&gt;
Stack right redzone: f3&lt;br/&gt;
Stack partial redzone: f4&lt;br/&gt;
Stack after return: f5&lt;br/&gt;
Stack use after scope: f8&lt;br/&gt;
Global redzone: f9&lt;br/&gt;
Global init order: f6&lt;br/&gt;
Poisoned by user: f7&lt;br/&gt;
Container overflow: fc&lt;br/&gt;
Array cookie: ac&lt;br/&gt;
Intra object redzone: bb&lt;br/&gt;
ASan internal: fe&lt;br/&gt;
Left alloca redzone: ca&lt;br/&gt;
Right alloca redzone: cb}}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;debian&#160;&lt;/p&gt;</environment>
        <key id="13537544">ZOOKEEPER-4699</key>
            <summary>zh-&gt;hostname heap-use-after-free in zookeeper_interest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fanyang">fanyang</assignee>
                                    <reporter username="hanye">whyer</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 24 May 2023 20:12:28 +0000</created>
                <updated>Fri, 29 Aug 2025 21:29:02 +0000</updated>
                            <resolved>Fri, 18 Oct 2024 01:52:55 +0000</resolved>
                                    <version>3.8.1</version>
                                    <fixVersion>3.10.0</fixVersion>
                    <fixVersion>3.9.4</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17818673" author="fanyang" created="Tue, 20 Feb 2024 06:56:33 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanye&quot; class=&quot;user-hover&quot; rel=&quot;hanye&quot;&gt;hanye&lt;/a&gt;&lt;br/&gt;
I created a PR using this ticket &lt;a href=&quot;https://github.com/apache/zookeeper/pull/2138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/2138&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17890771" author="kezhuw" created="Fri, 18 Oct 2024 01:52:55 +0000"  >&lt;p&gt;Issue resolved by pull request 2138&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/2138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/2138&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1i4fc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>