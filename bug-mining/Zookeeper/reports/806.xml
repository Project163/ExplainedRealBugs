<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:59:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2725] Upgrading to a global session fails with a multiop</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2725</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;On an ensemble with local sessions enabled, when a client with a local session requests the creation of an ephemeral node within a multi-op, the client gets a session expired message.  The same multi-op works if the session is already global. This breaks the client&apos;s expectation of seamless promotion from local session to global session server-side. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13056466">ZOOKEEPER-2725</key>
            <summary>Upgrading to a global session fails with a multiop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enixon">Brian Nixon</assignee>
                                    <reporter username="enixon">Brian Nixon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Mar 2017 22:34:55 +0000</created>
                <updated>Thu, 13 Jul 2017 03:05:51 +0000</updated>
                            <resolved>Tue, 21 Mar 2017 16:50:14 +0000</resolved>
                                    <version>3.5.2</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15927211" author="nixon" created="Wed, 15 Mar 2017 23:52:00 +0000"  >&lt;p&gt;I messed up the name of the pull request - meant to link &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195&lt;/a&gt; to this issue.&lt;/p&gt;</comment>
                            <comment id="15930851" author="githubbot" created="Fri, 17 Mar 2017 22:46:20 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106757751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106757751&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +        waitForClient(zk, ZooKeeper.States.CONNECTED);&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        LOG.info(&quot;RUNNING MULTI-OP&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: not sure we need all of this logging&lt;/p&gt;</comment>
                            <comment id="15930852" author="githubbot" created="Fri, 17 Mar 2017 22:46:20 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106757640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106757640&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +        waitForClient(zk, ZooKeeper.States.CONNECTED);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Not sure we need this. I don&apos;t think we need to do this in other tests.&lt;/p&gt;</comment>
                            <comment id="15930853" author="githubbot" created="Fri, 17 Mar 2017 22:46:20 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106759077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106759077&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Would it be possible to test `public Request checkUpgradeSession(Request request)` directly in addition to this integration style test?&lt;/p&gt;</comment>
                            <comment id="15930915" author="hadoopqa" created="Fri, 17 Mar 2017 23:58:20 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15931547" author="githubbot" created="Sun, 19 Mar 2017 03:39:04 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106797306&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106797306&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumZooKeeperServer.java &amp;#8212;&lt;br/&gt;
    @@ -62,18 +64,40 @@ public Request checkUpgradeSession(Request request)&lt;br/&gt;
             // This is called by the request processor thread (either follower&lt;br/&gt;
             // or observer request processor), which is unique to a learner.&lt;br/&gt;
             // So will not be called concurrently by two threads.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (request.type != OpCode.create ||&lt;br/&gt;
    +        if ((request.type != OpCode.create &amp;amp;&amp;amp; request.type != OpCode.create2 &amp;amp;&amp;amp; request.type != OpCode.multi) ||&lt;br/&gt;
                 !upgradeableSessionTracker.isLocalSession(request.sessionId)) 
{
                 return null;
             }&lt;/li&gt;
	&lt;li&gt;CreateRequest createRequest = new CreateRequest();&lt;/li&gt;
	&lt;li&gt;request.request.rewind();&lt;/li&gt;
	&lt;li&gt;ByteBufferInputStream.byteBuffer2Record(request.request, createRequest);&lt;/li&gt;
	&lt;li&gt;request.request.rewind();&lt;/li&gt;
	&lt;li&gt;CreateMode createMode = CreateMode.fromFlag(createRequest.getFlags());&lt;/li&gt;
	&lt;li&gt;if (!createMode.isEphemeral()) {&lt;/li&gt;
	&lt;li&gt;return null;&lt;br/&gt;
    +&lt;br/&gt;
    +        if (OpCode.multi == request.type) {&lt;br/&gt;
    +            MultiTransactionRecord multiTransactionRecord = new MultiTransactionRecord();&lt;br/&gt;
    +            request.request.rewind();&lt;br/&gt;
    +            ByteBufferInputStream.byteBuffer2Record(request.request, multiTransactionRecord);&lt;br/&gt;
    +            request.request.rewind();&lt;br/&gt;
    +            boolean containsEphemeralCreate = false;&lt;br/&gt;
    +            for (Op op : multiTransactionRecord) {&lt;br/&gt;
    +                if (op.getType() == OpCode.create || op.getType() == OpCode.create2) {&lt;br/&gt;
    +                    CreateRequest createRequest = (CreateRequest)op.toRequestRecord();&lt;br/&gt;
    +                    CreateMode createMode = CreateMode.fromFlag(createRequest.getFlags());&lt;br/&gt;
    +                    if (createMode.isEphemeral()) {&lt;br/&gt;
    +                        containsEphemeralCreate = true;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we can just return null here (or break the loop) - there is no need to check rest of ops because as long as there is an ephemeral / create we&apos;d upgrade session?&lt;/p&gt;</comment>
                            <comment id="15931548" author="githubbot" created="Sun, 19 Mar 2017 03:41:45 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106797340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106797340&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +        waitForClient(zk, ZooKeeper.States.CONNECTED);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Right, there is no need for this check (which use polling which is not recommended.). createClient already ensures that zk is in connected state via watchers. The only benefit of additional check here might be that in case of flaky test environment, a zk might loss connection to server right after createClient, but in that case we might want to wrap the subsequent test code (i.e. create) using retry with timeout logic.&lt;/p&gt;</comment>
                            <comment id="15931549" author="githubbot" created="Sun, 19 Mar 2017 03:42:49 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106797356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106797356&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +        waitForClient(zk, ZooKeeper.States.CONNECTED);&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        LOG.info(&quot;RUNNING MULTI-OP&quot;);&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            multi = zk.multi(Arrays.asList(
    +                    Op.setData(path, data.getBytes(), 0),
    +                    Op.create(path + &quot;/e&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
    +                    Op.create(path + &quot;/p&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    +                    Op.create(path + &quot;/q&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)
    +            ));
    +        }
&lt;p&gt; catch (KeeperException.SessionExpiredException e) {&lt;br/&gt;
    +            LOG.info(&quot;SESSION EXPIRED&quot;, e);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We are not expected to get a SessionExpiredException here right with this patch, right? So might worth to put an assert here.&lt;/p&gt;</comment>
                            <comment id="15931551" author="githubbot" created="Sun, 19 Mar 2017 03:43:44 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r106797374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r106797374&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +        waitForClient(zk, ZooKeeper.States.CONNECTED);&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        LOG.info(&quot;RUNNING MULTI-OP&quot;);&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            multi = zk.multi(Arrays.asList(
    +                    Op.setData(path, data.getBytes(), 0),
    +                    Op.create(path + &quot;/e&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
    +                    Op.create(path + &quot;/p&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    +                    Op.create(path + &quot;/q&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)
    +            ));
    +        }
&lt;p&gt; catch (KeeperException.SessionExpiredException e) &lt;/p&gt;
{
    +            LOG.info(&quot;SESSION EXPIRED&quot;, e);
    +        }
&lt;p&gt;    +        LOG.info(&quot;TESTING RESULTS&quot;);&lt;br/&gt;
    +        Assert.assertNotNull(multi);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    In addition to these tests, it might be helpful to verify that a session upgrade has actually happened. I think we can verify that by comparing the old session id retrieved from zk before the multi-op and the new session id?&lt;/p&gt;</comment>
                            <comment id="15933263" author="githubbot" created="Mon, 20 Mar 2017 18:39:54 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Proposed changes sound good, addressed with additional commit&lt;/p&gt;</comment>
                            <comment id="15933878" author="githubbot" created="Tue, 21 Mar 2017 00:43:14 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r107051170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r107051170&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,135 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.jute.BinaryOutputArchive;&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.proto.CreateRequest;&lt;br/&gt;
    +import org.apache.zookeeper.proto.GetDataRequest;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumPeer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.nio.ByteBuffer;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());&lt;br/&gt;
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);&lt;br/&gt;
    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();&lt;br/&gt;
    +        Assert.assertFalse(&quot;session already global&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            multi = zk.multi(Arrays.asList(
    +                    Op.setData(path, data.getBytes(), 0),
    +                    Op.create(path + &quot;/e&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
    +                    Op.create(path + &quot;/p&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    +                    Op.create(path + &quot;/q&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)
    +            ));
    +        }
&lt;p&gt; catch (KeeperException.SessionExpiredException e) &lt;/p&gt;
{
    +            // the scenario that inspired this unit test
    +            Assert.fail(&quot;received session expired for a session promotion in a multi-op&quot;);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        Assert.assertNotNull(multi);&lt;br/&gt;
    +        Assert.assertEquals(4, multi.size());&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/e&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/p&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/q&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertTrue(&quot;session not promoted&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException &lt;/p&gt;
{
    +        final ZooKeeper zk = createClient();
    +
    +        String path = &quot;/directcheckupgradesession&quot;;
    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
    +
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);
    +
    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());
    +        Request createRequest = makeCreateRequest(path + &quot;/e&quot;, zk.getSessionId());
    +        Assert.assertNull(&quot;tried to upgrade on a read&quot;, server.checkUpgradeSession(readRequest));
    +        Assert.assertNotNull(&quot;failed to upgrade on a create&quot;, server.checkUpgradeSession(createRequest));
    +        Assert.assertNull(&quot;tried to upgrade after successful promotion&quot;,
    +                server.checkUpgradeSession(createRequest));
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException {&lt;br/&gt;
    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();&lt;br/&gt;
    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);&lt;br/&gt;
    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);&lt;br/&gt;
    +        getDataRequest.serialize(boa, &quot;request&quot;);&lt;br/&gt;
    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());&lt;br/&gt;
    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList&amp;lt;&amp;gt;());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `new ArrayList&amp;lt;&amp;gt;()` would not work in JDK 7 (the compiler can&apos;t infer the type w/o explicitly specify the type parameter here). I think you are using JDK 8 so you don&apos;t see this. Suggest change this to &apos;new ArrayList&amp;lt;Id&amp;gt;()&apos; so it works with both JDK 7 and 8. Pre-commit job also failed because of this:  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/462/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/462/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15933879" author="githubbot" created="Tue, 21 Mar 2017 00:43:42 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r107051228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r107051228&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,135 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.jute.BinaryOutputArchive;&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.proto.CreateRequest;&lt;br/&gt;
    +import org.apache.zookeeper.proto.GetDataRequest;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumPeer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.nio.ByteBuffer;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());&lt;br/&gt;
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);&lt;br/&gt;
    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();&lt;br/&gt;
    +        Assert.assertFalse(&quot;session already global&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            multi = zk.multi(Arrays.asList(
    +                    Op.setData(path, data.getBytes(), 0),
    +                    Op.create(path + &quot;/e&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
    +                    Op.create(path + &quot;/p&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    +                    Op.create(path + &quot;/q&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)
    +            ));
    +        }
&lt;p&gt; catch (KeeperException.SessionExpiredException e) &lt;/p&gt;
{
    +            // the scenario that inspired this unit test
    +            Assert.fail(&quot;received session expired for a session promotion in a multi-op&quot;);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        Assert.assertNotNull(multi);&lt;br/&gt;
    +        Assert.assertEquals(4, multi.size());&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/e&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/p&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/q&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertTrue(&quot;session not promoted&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException &lt;/p&gt;
{
    +        final ZooKeeper zk = createClient();
    +
    +        String path = &quot;/directcheckupgradesession&quot;;
    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
    +
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);
    +
    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());
    +        Request createRequest = makeCreateRequest(path + &quot;/e&quot;, zk.getSessionId());
    +        Assert.assertNull(&quot;tried to upgrade on a read&quot;, server.checkUpgradeSession(readRequest));
    +        Assert.assertNotNull(&quot;failed to upgrade on a create&quot;, server.checkUpgradeSession(createRequest));
    +        Assert.assertNull(&quot;tried to upgrade after successful promotion&quot;,
    +                server.checkUpgradeSession(createRequest));
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException &lt;/p&gt;
{
    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();
    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);
    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);
    +        getDataRequest.serialize(boa, &quot;request&quot;);
    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());
    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList&amp;lt;&amp;gt;());
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private Request makeCreateRequest(String path, long sessionId) throws IOException {&lt;br/&gt;
    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();&lt;br/&gt;
    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);&lt;br/&gt;
    +        CreateRequest createRequest = new CreateRequest(path,&lt;br/&gt;
    +                &quot;data&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL.toFlag());&lt;br/&gt;
    +        createRequest.serialize(boa, &quot;request&quot;);&lt;br/&gt;
    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());&lt;br/&gt;
    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.create2, bb, new ArrayList&amp;lt;&amp;gt;());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Same here (`new ArrayList&amp;lt;&amp;gt;`)&lt;/p&gt;</comment>
                            <comment id="15933882" author="githubbot" created="Tue, 21 Mar 2017 00:44:21 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM, except it does not build with JDK 7. Will merge after the fix.&lt;/p&gt;</comment>
                            <comment id="15934781" author="githubbot" created="Tue, 21 Mar 2017 15:44:46 +0000"  >&lt;p&gt;Github user enixon commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195#discussion_r107191973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195#discussion_r107191973&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,135 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.server;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.jute.BinaryOutputArchive;&lt;br/&gt;
    +import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.Op;&lt;br/&gt;
    +import org.apache.zookeeper.OpResult;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.proto.CreateRequest;&lt;br/&gt;
    +import org.apache.zookeeper.proto.GetDataRequest;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumPeer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;&lt;br/&gt;
    +import org.apache.zookeeper.test.QuorumBase;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.nio.ByteBuffer;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +&lt;br/&gt;
    +public class MultiOpSessionUpgradeTest extends QuorumBase {&lt;br/&gt;
    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public void setUp() throws Exception &lt;/p&gt;
{
    +        localSessionsEnabled = true;
    +        localSessionsUpgradingEnabled = true;
    +        super.setUp();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {&lt;br/&gt;
    +        final ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        String data = &quot;test&quot;;&lt;br/&gt;
    +        String path = &quot;/ephemeralcreatemultiop&quot;;&lt;br/&gt;
    +        zk.create(path, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);&lt;br/&gt;
    +&lt;br/&gt;
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());&lt;br/&gt;
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);&lt;br/&gt;
    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();&lt;br/&gt;
    +        Assert.assertFalse(&quot;session already global&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;OpResult&amp;gt; multi = null;&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            multi = zk.multi(Arrays.asList(
    +                    Op.setData(path, data.getBytes(), 0),
    +                    Op.create(path + &quot;/e&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
    +                    Op.create(path + &quot;/p&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    +                    Op.create(path + &quot;/q&quot;, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)
    +            ));
    +        }
&lt;p&gt; catch (KeeperException.SessionExpiredException e) &lt;/p&gt;
{
    +            // the scenario that inspired this unit test
    +            Assert.fail(&quot;received session expired for a session promotion in a multi-op&quot;);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        Assert.assertNotNull(multi);&lt;br/&gt;
    +        Assert.assertEquals(4, multi.size());&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/e&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/p&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertEquals(data, new String(zk.getData(path + &quot;/q&quot;, false, null)));&lt;br/&gt;
    +        Assert.assertTrue(&quot;session not promoted&quot;, sessionTracker.isGlobalSession(zk.getSessionId()));&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException &lt;/p&gt;
{
    +        final ZooKeeper zk = createClient();
    +
    +        String path = &quot;/directcheckupgradesession&quot;;
    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
    +
    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());
    +        Assert.assertNotNull(&quot;unable to find server interlocutor&quot;, server);
    +
    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());
    +        Request createRequest = makeCreateRequest(path + &quot;/e&quot;, zk.getSessionId());
    +        Assert.assertNull(&quot;tried to upgrade on a read&quot;, server.checkUpgradeSession(readRequest));
    +        Assert.assertNotNull(&quot;failed to upgrade on a create&quot;, server.checkUpgradeSession(createRequest));
    +        Assert.assertNull(&quot;tried to upgrade after successful promotion&quot;,
    +                server.checkUpgradeSession(createRequest));
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException {&lt;br/&gt;
    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();&lt;br/&gt;
    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);&lt;br/&gt;
    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);&lt;br/&gt;
    +        getDataRequest.serialize(boa, &quot;request&quot;);&lt;br/&gt;
    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());&lt;br/&gt;
    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList&amp;lt;&amp;gt;());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can&apos;t believe I missed those - something about them was bothering me about those lines when I was preparing the commit too.&lt;/p&gt;

&lt;p&gt;    Will fix.&lt;/p&gt;</comment>
                            <comment id="15934805" author="hadoopqa" created="Tue, 21 Mar 2017 16:07:26 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15934871" author="hanm" created="Tue, 21 Mar 2017 16:50:14 +0000"  >&lt;p&gt;Issue resolved by pull request 195&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15934872" author="githubbot" created="Tue, 21 Mar 2017 16:50:21 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/195&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15934881" author="hanm" created="Tue, 21 Mar 2017 16:54:04 +0000"  >&lt;p&gt;Merged to master, &lt;a href=&quot;https://github.com/apache/zookeeper/commit/63577ba52a829391ded3ae11c62c0e996865b5c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/63577ba52a829391ded3ae11c62c0e996865b5c7&lt;/a&gt;, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nixon&quot; class=&quot;user-hover&quot; rel=&quot;nixon&quot;&gt;nixon&lt;/a&gt; for the patch!&lt;/p&gt;</comment>
                            <comment id="15934943" author="hudson" created="Tue, 21 Mar 2017 17:29:49 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3325 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3325/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3325/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2725&quot; title=&quot;Upgrading to a global session fails with a multiop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2725&quot;&gt;&lt;del&gt;ZOOKEEPER-2725&lt;/del&gt;&lt;/a&gt;: Promote local session to global when ephemeral created (hanm: rev 63577ba52a829391ded3ae11c62c0e996865b5c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumZooKeeperServer.java&lt;/li&gt;
	&lt;li&gt;(add) src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cc13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>