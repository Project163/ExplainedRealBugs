<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:45:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2] Synchronization issues in QuorumPeer and FastLeader election</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;There are a couple of cases of member variables that need to be marked volatile or surrounded in a synchronization block. A couple of examples are:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;QuorumPeer state should be synchronous&lt;/li&gt;
	&lt;li&gt;currentVote in QuorumPeer is marked volatile, but when it&apos;s members are often accessed individually as if they were in an atomic unit. Such code should be changed to get a reference to the currentVote and they access members through that reference.&lt;/li&gt;
	&lt;li&gt;It looks like logicalClock in FastLeaderElection should be volatile. It should either be fixed or commented to explain why it doesn&apos;t need to be.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12397819">ZOOKEEPER-2</key>
            <summary>Synchronization issues in QuorumPeer and FastLeader election</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Paiva Junqueira</assignee>
                                    <reporter username="breed">Benjamin Reed</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jun 2008 16:34:31 +0000</created>
                <updated>Tue, 9 Sep 2008 21:11:22 +0000</updated>
                            <resolved>Mon, 25 Aug 2008 21:13:14 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>leaderElection</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12604535" author="fpj" created="Thu, 12 Jun 2008 15:14:25 +0000"  >&lt;p&gt;This is a tentative patch to fix the problems pointed out on QuorumPeer and FastLeaderElection.&lt;/p&gt;

&lt;p&gt;1- Makes logicalclock volatile;&lt;br/&gt;
2- Creates accessor methods for currentVote and state, and enforce their use;&lt;br/&gt;
3- Accessor methods are synchronized.&lt;/p&gt;

&lt;p&gt;-F&lt;/p&gt;</comment>
                            <comment id="12604537" author="fpj" created="Thu, 12 Jun 2008 15:15:43 +0000"  >&lt;p&gt;Please check the attached patch.&lt;/p&gt;</comment>
                            <comment id="12604645" author="evanj" created="Thu, 12 Jun 2008 21:22:01 +0000"  >&lt;p&gt;A quick look at the patch looks good to me. However there is a &quot;long logicalclock&quot; in AuthFastLeaderElection.java as well. It looks like it should also be volatile.&lt;/p&gt;</comment>
                            <comment id="12607315" author="fpj" created="Mon, 23 Jun 2008 17:56:32 +0000"  >&lt;p&gt;Have made logicalclock on AuthFastLeaderElection volatile as well.&lt;/p&gt;</comment>
                            <comment id="12607321" author="fpj" created="Mon, 23 Jun 2008 18:07:31 +0000"  >&lt;p&gt;Please review. -F&lt;/p&gt;</comment>
                            <comment id="12615677" author="phunt" created="Tue, 22 Jul 2008 17:11:16 +0000"  >&lt;p&gt;Mahadev please review this patch.&lt;/p&gt;</comment>
                            <comment id="12615691" author="mahadev" created="Tue, 22 Jul 2008 17:43:02 +0000"  >&lt;p&gt;assigning this back to flavio since he is working on the patch and I will review it.&lt;/p&gt;</comment>
                            <comment id="12618847" author="phunt" created="Thu, 31 Jul 2008 20:58:44 +0000"  >&lt;p&gt;I updated flavio&apos;s patch for the new directory structure on apache.&lt;/p&gt;</comment>
                            <comment id="12618848" author="phunt" created="Thu, 31 Jul 2008 21:00:25 +0000"  >&lt;p&gt;This patch fails &quot;ant test&quot;, specifically I see alot of the following in the log:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;QuorumPeer&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:397)&lt;/p&gt;

&lt;p&gt;(I ran the tests 3 times, failed each time in the same way, mainline test passes fine)&lt;br/&gt;
This is ubuntu machine with java 1.6.0_06 (single cpu/core)&lt;/p&gt;</comment>
                            <comment id="12618849" author="phunt" created="Thu, 31 Jul 2008 21:01:09 +0000"  >&lt;p&gt;PS, in future please use the &amp;lt;id&amp;gt;.patch naming scheme, ie. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2&quot; title=&quot;Synchronization issues in QuorumPeer and FastLeader election&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2&quot;&gt;&lt;del&gt;ZOOKEEPER-2&lt;/del&gt;&lt;/a&gt;.patch, thanks.&lt;/p&gt;</comment>
                            <comment id="12622062" author="fpj" created="Wed, 13 Aug 2008 01:29:02 +0000"  >&lt;p&gt;Variable state on QuorumPeer was not initialized, so the exceptions Pat observed. I fixed it, and generated a patch against the apache repository. QuorumTest still fails, but it fails in my computer even without this patch with the same erros, so I don&apos;t think it is a problem with this patch.&lt;/p&gt;</comment>
                            <comment id="12622359" author="fpj" created="Wed, 13 Aug 2008 21:12:11 +0000"  >&lt;p&gt;Submitted a new patch with the problem that Pat pointed out fixed.&lt;/p&gt;</comment>
                            <comment id="12622631" author="mahadev" created="Thu, 14 Aug 2008 18:22:47 +0000"  >&lt;p&gt;flavio -  while we are at it ... can we improve the documentation with javadocs in FastLeaderElection? I am happy to open another jira for it but seems a little redundant... In particular Messenger class lacks javadocs, class workersender lacks javadocs, some of the methods in FastLeaderElection class lack javadoc as well. It will help us lesser mortals to understand leader election better with some javadocs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  &lt;/p&gt;</comment>
                            <comment id="12622723" author="phunt" created="Thu, 14 Aug 2008 22:04:34 +0000"  >&lt;p&gt;+1 on Mahadev&apos;s doc request.&lt;/p&gt;</comment>
                            <comment id="12625426" author="fpj" created="Mon, 25 Aug 2008 17:04:35 +0000"  >&lt;p&gt;Added javadoc comments.&lt;/p&gt;</comment>
                            <comment id="12625513" author="mahadev" created="Mon, 25 Aug 2008 21:08:36 +0000"  >&lt;p&gt;+1 the patch looks good... and passes the tests as well... &lt;/p&gt;</comment>
                            <comment id="12625516" author="mahadev" created="Mon, 25 Aug 2008 21:13:14 +0000"  >&lt;p&gt;I just committed this. Thanks Flavio.&lt;/p&gt;</comment>
                            <comment id="12626544" author="hudson" created="Thu, 28 Aug 2008 12:32:04 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #67 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/67/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/67/&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12388858" name="ZOOKEEPER-2.patch" size="21348" author="fpj" created="Mon, 25 Aug 2008 17:04:35 +0000"/>
                            <attachment id="12387310" name="patch-le-polish" size="11521" author="phunt" created="Thu, 31 Jul 2008 20:58:44 +0000"/>
                            <attachment id="12384519" name="patch-le-polish" size="11431" author="fpj" created="Mon, 23 Jun 2008 17:56:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48115</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0623z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>