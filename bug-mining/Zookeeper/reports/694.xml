<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:57:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2201] Network issues can cause cluster to hang due to near-deadlock</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2201</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;&lt;tt&gt;DataTree.serializeNode&lt;/tt&gt; synchronizes on the &lt;tt&gt;DataNode&lt;/tt&gt; it is about to serialize then writes it out via &lt;tt&gt;OutputArchive.writeRecord&lt;/tt&gt;, potentially to a network connection. Under default linux TCP settings, a network connection where the other side completely disappears will hang (blocking on the &lt;tt&gt;java.net.SocketOutputStream.socketWrite0&lt;/tt&gt; call) for over 15 minutes. During this time, any attempt to create/delete/modify the &lt;tt&gt;DataNode&lt;/tt&gt; will cause the leader to hang at the beginning of the request processor chain:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;ProcessThread(sid:5 cport:-1):&quot; prio=10 tid=0x00000000026f1800 nid=0x379c waiting for monitor entry [0x00007fe6c2a8c000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.zookeeper.server.PrepRequestProcessor.getRecordForPath(PrepRequestProcessor.java:163)
        - waiting to lock &amp;lt;0x00000000d4cd9e28&amp;gt; (a org.apache.zookeeper.server.DataNode)
        - locked &amp;lt;0x00000000d2ef81d0&amp;gt; (a java.util.ArrayList)
        at org.apache.zookeeper.server.PrepRequestProcessor.pRequest2Txn(PrepRequestProcessor.java:345)
        at org.apache.zookeeper.server.PrepRequestProcessor.pRequest(PrepRequestProcessor.java:534)
        at org.apache.zookeeper.server.PrepRequestProcessor.run(PrepRequestProcessor.java:131)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, any attempt to send a snapshot to a follower or to disk will hang.&lt;/p&gt;

&lt;p&gt;Because the ping packets are sent by another thread which is unaffected, followers never time out and become leader, even though the cluster will make no progress until either the leader is killed or the TCP connection times out. This isn&apos;t exactly a deadlock since it will resolve itself eventually, but as mentioned above this will take &amp;gt; 15 minutes with the default TCP retry settings in linux.&lt;/p&gt;

&lt;p&gt;A simple solution to this is: in &lt;tt&gt;DataTree.serializeNode&lt;/tt&gt; we can take a copy of the contents of the &lt;tt&gt;DataNode&lt;/tt&gt; (as is done with its children) in the synchronized block, then call &lt;tt&gt;writeRecord&lt;/tt&gt; with the copy of the &lt;tt&gt;DataNode&lt;/tt&gt; outside of the original &lt;tt&gt;DataNode&lt;/tt&gt; synchronized block.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834449">ZOOKEEPER-2201</key>
            <summary>Network issues can cause cluster to hang due to near-deadlock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dnadolny">Donny Nadolny</assignee>
                                    <reporter username="dnadolny">Donny Nadolny</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2015 01:30:25 +0000</created>
                <updated>Thu, 21 Jul 2016 20:18:45 +0000</updated>
                            <resolved>Sat, 6 Jun 2015 16:54:09 +0000</resolved>
                                    <version>3.4.6</version>
                    <version>3.5.0</version>
                                    <fixVersion>3.4.7</fixVersion>
                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14568367" author="hadoopqa" created="Tue, 2 Jun 2015 01:41:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12736704/ZOOKEEPER-2201.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12736704/ZOOKEEPER-2201.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1682823.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2739//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2739//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14570314" author="phunt" created="Wed, 3 Jun 2015 05:52:06 +0000"  >&lt;p&gt;The approach looks reasonable to me and this is a serious issue. Perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt; might have some insight?&lt;/p&gt;

&lt;p&gt;Can you use copyStatPersisted instead of copying yourself?&lt;/p&gt;

&lt;p&gt;Also can you provide a patch for trunk as well as branch 3.4? We&apos;ll need to fix that in both places and as you can see the patch is not applying cleanly to trunk.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14570893" author="dnadolny" created="Wed, 3 Jun 2015 14:17:04 +0000"  >&lt;p&gt;patch against trunk&lt;/p&gt;</comment>
                            <comment id="14570897" author="dnadolny" created="Wed, 3 Jun 2015 14:19:54 +0000"  >&lt;p&gt;patch against 3.4 branch&lt;/p&gt;</comment>
                            <comment id="14570900" author="hadoopqa" created="Wed, 3 Jun 2015 14:21:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737283/ZOOKEEPER-2201-branch-34.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737283/ZOOKEEPER-2201-branch-34.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1683163.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2746//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2746//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14570901" author="dnadolny" created="Wed, 3 Jun 2015 14:21:48 +0000"  >&lt;p&gt;I had seen &lt;tt&gt;DataNode.copyStat&lt;/tt&gt; which gives a &lt;tt&gt;Stat&lt;/tt&gt; but didn&apos;t notice &lt;tt&gt;DataTree.copyStatPersisted&lt;/tt&gt;.&lt;br/&gt;
I&apos;ve updated the code to use &lt;tt&gt;copyStatPersisted&lt;/tt&gt;, and included a patch against trunk and another against the 3.4 branch. My previous one was against 3.4.6 specifically.&lt;br/&gt;
(Hmm, I see now that JIRA adds comments about an attachment as a plain comment in the ticket. I was hoping for a description beside the file itself...)&lt;/p&gt;</comment>
                            <comment id="14570930" author="dnadolny" created="Wed, 3 Jun 2015 14:36:58 +0000"  >&lt;p&gt;The failure above is for the patch against the branch, which of course can&apos;t be applied against trunk. I&apos;ll re-upload the trunk patch to get the build kicked off again.&lt;/p&gt;</comment>
                            <comment id="14570938" author="hadoopqa" created="Wed, 3 Jun 2015 14:48:24 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737286/ZOOKEEPER-2201.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737286/ZOOKEEPER-2201.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1683163.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2747//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14571255" author="dnadolny" created="Wed, 3 Jun 2015 16:07:07 +0000"  >&lt;p&gt;The failure above is due to a flaky test which fails occasionally depending on timing. I&apos;ve filed a ticket (and patch) to fix that at &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2204&quot; title=&quot;LearnerSnapshotThrottlerTest.testHighContentionWithTimeout fails occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2204&quot;&gt;&lt;del&gt;ZOOKEEPER-2204&lt;/del&gt;&lt;/a&gt;. I&apos;ll upload the patch for trunk once more in the hopes I don&apos;t get unlucky and hit the same transient failure twice.&lt;/p&gt;</comment>
                            <comment id="14571274" author="hadoopqa" created="Wed, 3 Jun 2015 16:18:38 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737302/ZOOKEEPER-2201.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737302/ZOOKEEPER-2201.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1683163.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2749//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573432" author="rgs" created="Thu, 4 Jun 2015 19:24:33 +0000"  >&lt;p&gt;testHighContentionWithTimeout has now been fixed: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/fac170aa2e82c63aeea60d756a450ce343c43e6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/fac170aa2e82c63aeea60d756a450ce343c43e6d&lt;/a&gt;. Could you re-kick the build? Thanks!&lt;/p&gt;</comment>
                            <comment id="14573461" author="rgs" created="Thu, 4 Jun 2015 19:46:32 +0000"  >&lt;p&gt;Why is this true:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+            &lt;span class=&quot;code-comment&quot;&gt;//we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not need to make a copy of node.data because the contents
&lt;/span&gt;+            &lt;span class=&quot;code-comment&quot;&gt;//are never changed
&lt;/span&gt;+            nodeCopy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataNode(node.data, node.acl, statCopy);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;? Can&apos;t node.data change after we leave the synchronized block if setData is called: &lt;a href=&quot;https://github.com/apache/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java#L643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java#L643&lt;/a&gt; ? Ditto for the acl: &lt;a href=&quot;https://github.com/apache/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java#L744&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java#L744&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Also, could we encapsulate the DataNode copying logic in DataNode#clone (I suspect it is or will be duplicated otherwise)? &lt;/p&gt;</comment>
                            <comment id="14573628" author="dnadolny" created="Thu, 4 Jun 2015 21:38:07 +0000"  >&lt;p&gt;&lt;tt&gt;node.data&lt;/tt&gt; can change to be a new reference if we call &lt;tt&gt;setData&lt;/tt&gt;, what I meant was that we never call &lt;tt&gt;node.data[x] = ...&lt;/tt&gt; so that it was safe to give the &lt;tt&gt;nodeCopy&lt;/tt&gt; the same reference to the underlying array. Compare that with &lt;tt&gt;node.children&lt;/tt&gt; which is a mutable &lt;tt&gt;Set&lt;/tt&gt; so the existing code needs to take a copy of that first.&lt;/p&gt;

&lt;p&gt;With the acl (and stat info), yes those can both change, but what we ensure by synchronizing on &lt;tt&gt;node&lt;/tt&gt; is that we get a consistent copy of the &lt;tt&gt;DataNode&lt;/tt&gt; state as it once existed - it can change after we take our copy, just like it could change after we wrote it over the wire, but we&apos;ve captured a consistent view of it in both cases.&lt;/p&gt;

&lt;p&gt;For moving it to a &lt;tt&gt;DataNode.clone&lt;/tt&gt; method, I&apos;m not sure. I thought about that when I was initially writing this and decided against it at the time because I think this is a very specific kind of &lt;tt&gt;clone&lt;/tt&gt;: we&apos;re getting the same reference to &lt;tt&gt;data&lt;/tt&gt;, but for &lt;tt&gt;children&lt;/tt&gt; we&apos;d get a copy, however the copy would still point to the same children &lt;tt&gt;DataNode&lt;/tt&gt; instances that the original did. I see it as a weird kind of shallow copy, so I&apos;m not sure it makes sense to move it.&lt;/p&gt;

&lt;p&gt;I&apos;ve resubmitted the original patch for now, although I&apos;m open to moving it to a &lt;tt&gt;copy&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="14573657" author="hadoopqa" created="Thu, 4 Jun 2015 21:53:41 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737702/ZOOKEEPER-2201.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737702/ZOOKEEPER-2201.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1683605.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2752//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573939" author="rgs" created="Fri, 5 Jun 2015 02:01:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;node.data can change to be a new reference if we call setData, what I meant was that we never call node.data&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; = ... so that it was safe to give the nodeCopy the same reference to the underlying array. Compare that with node.children which is a mutable Set so the existing code needs to take a copy of that first.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ah - thanks for clarifying.yeah, i guess if data was immutable (ByteBuffer maybe?) clone() would make more sense. or if  agree it&apos;s a shallow copy since we get the data by reference. or we made data private and added a setter. then clone would make sense. &lt;/p&gt;
</comment>
                            <comment id="14573948" author="rgs" created="Fri, 5 Jun 2015 02:14:48 +0000"  >&lt;p&gt;+1, though if someone has an idea to elegantly implement clone and encapsulate that logic (and express that data is immutable), that would be nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14575364" author="hdeng" created="Fri, 5 Jun 2015 22:40:45 +0000"  >&lt;p&gt;+1&lt;br/&gt;
The patch looks good!&lt;/p&gt;</comment>
                            <comment id="14575827" author="rgs" created="Sat, 6 Jun 2015 16:54:37 +0000"  >&lt;p&gt;Merged:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683878&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683930&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683931&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1683931&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(pasting SVN URLs since the github mirror seems to be lagging). &lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dnadolny&quot; class=&quot;user-hover&quot; rel=&quot;dnadolny&quot;&gt;dnadolny&lt;/a&gt;! &lt;/p&gt;</comment>
                            <comment id="14576117" author="hudson" created="Sun, 7 Jun 2015 06:04:55 +0000"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2718 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2718/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2718/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2201&quot; title=&quot;Network issues can cause cluster to hang due to near-deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2201&quot;&gt;&lt;del&gt;ZOOKEEPER-2201&lt;/del&gt;&lt;/a&gt;: Network issues can cause cluster to hang due to near-deadlock&lt;br/&gt;
(Donny Nadolny via rgs) (rgs: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1683878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1683878&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/DataTreeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12737283" name="ZOOKEEPER-2201-branch-34.patch" size="4952" author="dnadolny" created="Wed, 3 Jun 2015 14:19:54 +0000"/>
                            <attachment id="12737702" name="ZOOKEEPER-2201.patch" size="4916" author="dnadolny" created="Thu, 4 Jun 2015 21:38:26 +0000"/>
                            <attachment id="12737302" name="ZOOKEEPER-2201.patch" size="4916" author="dnadolny" created="Wed, 3 Jun 2015 16:07:38 +0000"/>
                            <attachment id="12737286" name="ZOOKEEPER-2201.patch" size="4916" author="dnadolny" created="Wed, 3 Jun 2015 14:37:34 +0000"/>
                            <attachment id="12737282" name="ZOOKEEPER-2201.patch" size="4916" author="dnadolny" created="Wed, 3 Jun 2015 14:17:04 +0000"/>
                            <attachment id="12736704" name="ZOOKEEPER-2201.patch" size="5249" author="dnadolny" created="Tue, 2 Jun 2015 01:32:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fhnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>