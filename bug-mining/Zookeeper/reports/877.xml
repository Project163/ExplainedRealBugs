<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:01:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2988] NPE triggered if server receives a vote for a server id not in their voting view</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2988</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We&apos;ve observed the following behavior in elections when a node is lagging behind the quorum in its view of the ensemble topology.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Node A is operating with node B in its voting view, but without view of node C.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;B votes for C.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A then switches its vote to C, but throws a NPE when attempting to connect.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This causes the QuorumPeer to spin up a Follower only to immediately have it shutdown by the exception.&lt;/p&gt;

&lt;p&gt;Ideally, A would not advertise a vote for a server that it will not follow.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13141899">ZOOKEEPER-2988</key>
            <summary>NPE triggered if server receives a vote for a server id not in their voting view</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enixon">Brian Nixon</assignee>
                                    <reporter username="enixon">Brian Nixon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Mar 2018 20:18:13 +0000</created>
                <updated>Tue, 17 Jul 2018 04:49:57 +0000</updated>
                            <resolved>Mon, 30 Apr 2018 04:35:29 +0000</resolved>
                                    <version>3.5.3</version>
                    <version>3.4.11</version>
                    <version>3.4.12</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                    <fixVersion>3.4.13</fixVersion>
                                    <component>leaderElection</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16382603" author="githubbot" created="Thu, 1 Mar 2018 20:29:48 +0000"  >&lt;p&gt;GitHub user enixon opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;id not in their voting view&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/enixon/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/enixon/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #476&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1862a718168ee07287d0b9769a0f4ce20bd1bd32&lt;br/&gt;
Author: Brian Nixon &amp;lt;nixon@...&amp;gt;&lt;br/&gt;
Date:   2018-03-01T19:19:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server id not in their voting view&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16382604" author="githubbot" created="Thu, 1 Mar 2018 20:30:22 +0000"  >&lt;p&gt;GitHub user enixon opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/477&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;id not in their voting view&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/enixon/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/enixon/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;-3.5&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/477.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/477.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #477&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a1364d8c4ec9fdf1c4210b6485a6a143c1e14f5f&lt;br/&gt;
Author: Brian Nixon &amp;lt;nixon@...&amp;gt;&lt;br/&gt;
Date:   2018-03-01T19:21:47Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server id not in their voting view&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16382605" author="githubbot" created="Thu, 1 Mar 2018 20:30:41 +0000"  >&lt;p&gt;GitHub user enixon opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;id not in their voting view&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/enixon/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/enixon/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;-3.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #478&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6fc857a1cfe97a46a4f453613b95f9682adcce96&lt;br/&gt;
Author: Brian Nixon &amp;lt;nixon@...&amp;gt;&lt;br/&gt;
Date:   2018-03-01T19:19:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server id not in their voting view&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16384209" author="githubbot" created="Fri, 2 Mar 2018 21:58:00 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171972029&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171972029&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -1012,4 +1012,113 @@ public void testFailedTxnAsPartOfQuorumLoss() throws Exception &lt;/p&gt;
{
                 Assert.assertNull(&quot;server &quot; + i + &quot; should not have /zk&quot; + leader, servers.zk[i].exists(&quot;/zk&quot; + leader, false));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Verify that a node without the leader in its view will not attempt to connect to the leader.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testLeaderOutOfView() throws Exception {&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +&lt;br/&gt;
    +        Layout layout = new PatternLayout(&quot;%d&lt;/p&gt;
{ISO8601}
&lt;p&gt; [,yid:%X&lt;/p&gt;
{myid}
&lt;p&gt;] - %5p [%t:%C&lt;/p&gt;
{1}
&lt;p&gt;@%L] - %m%n&quot;);&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.DEBUG);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(&quot;org.apache.zookeeper.server.quorum&quot;);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            final int CLIENT_PORT_QP1 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP2 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP3 = PortAssignment.unique();
    +
    +            String quorumCfgIncomplete = getUniquePortCfgForId(1) + &quot;\n&quot; + getUniquePortCfgForId(2);
    +            String quorumCfgComplete = quorumCfgIncomplete + &quot;\n&quot; + getUniquePortCfgForId(3);
    +
    +            // Node 1 is started without the leader (3) in its config view
    +            MainThread q1 = new MainThread(1, CLIENT_PORT_QP1, quorumCfgIncomplete);
    +            MainThread q2 = new MainThread(2, CLIENT_PORT_QP2, quorumCfgComplete);
    +            MainThread q3 = new MainThread(3, CLIENT_PORT_QP3, quorumCfgComplete);
    +
    +            // Node 1 must be started first, before quorum is formed, to trigger the attempted invalid connection to 3
    +            q1.start();
    +            QuorumPeer quorumPeer1 = waitForQuorumPeer(q1, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer1.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 3 started second to avoid 1 and 2 forming a quorum before 3 starts up
    +            q3.start();
    +            QuorumPeer quorumPeer3 = waitForQuorumPeer(q3, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer3.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 2 started last, kicks off leader election
    +            q2.start();
    +
    +            // Nodes 2 and 3 now form quorum and fully start. 1 attempts to vote for 3, fails, returns to LOOKING state
    +            Assert.assertTrue(&quot;waiting for server 2 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2, CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3, CONNECTION_TIMEOUT));
    +
    +            Assert.assertTrue(q1.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LOOKING);
    +            Assert.assertTrue(q2.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.FOLLOWING);
    +            Assert.assertTrue(q3.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LEADING);
    +
    +            q1.shutdown();
    +            q2.shutdown();
    +            q3.shutdown();
    +
    +            Assert.assertTrue(&quot;waiting for server 1 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP1,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 2 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            qlogger.removeAppender(appender);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        // Verify that Node 1 never threw an exception&lt;br/&gt;
    +        LineNumberReader r = new LineNumberReader(new StringReader(os.toString()));&lt;br/&gt;
    +        String line;&lt;br/&gt;
    +        boolean found = false;&lt;br/&gt;
    +        Pattern p = Pattern.compile(&quot;.&lt;b&gt;java.lang.NullPointerException.&lt;/b&gt;&quot;);&lt;br/&gt;
    +        while ((line = r.readLine()) != null) {&lt;br/&gt;
    +            found = p.matcher(line).matches();&lt;br/&gt;
    +            if (found) &lt;/p&gt;
{
    +                break;
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +&lt;br/&gt;
    +        Assert.assertFalse(&quot;Node should not attempt connection to out of view leader&quot;, found);&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    private String getUniquePortCfgForId(int id) &lt;/p&gt;
{
    +        return String.format(&quot;server.%d=127.0.0.1:%d:%d&quot;, id, PortAssignment.unique(), PortAssignment.unique());
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private QuorumPeer waitForQuorumPeer(MainThread mainThread, int timeout) {&lt;br/&gt;
    +        long start = Time.currentElapsedTime();&lt;br/&gt;
    +        while (true) {&lt;br/&gt;
    +            QuorumPeer quorumPeer = mainThread.getQuorumPeer();&lt;br/&gt;
    +            if (quorumPeer != null) &lt;/p&gt;
{
    +                return quorumPeer;
    +            }
&lt;p&gt;    +&lt;br/&gt;
    +            if (Time.currentElapsedTime() &amp;gt; start + timeout) &lt;/p&gt;
{
    +                LOG.error(&quot;Timed out while waiting for QuorumPeer&quot;);
    +                break;
    +            }
&lt;p&gt;    +&lt;br/&gt;
    +            try &lt;/p&gt;
{
    +                Thread.sleep(250);
    +            }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
    +                // ignore
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +        throw new NullPointerException();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can we use a better exception?&lt;/p&gt;</comment>
                            <comment id="16384210" author="githubbot" created="Fri, 2 Mar 2018 21:58:00 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171972608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171972608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -1012,4 +1012,113 @@ public void testFailedTxnAsPartOfQuorumLoss() throws Exception &lt;/p&gt;
{
                 Assert.assertNull(&quot;server &quot; + i + &quot; should not have /zk&quot; + leader, servers.zk[i].exists(&quot;/zk&quot; + leader, false));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Verify that a node without the leader in its view will not attempt to connect to the leader.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testLeaderOutOfView() throws Exception {&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +&lt;br/&gt;
    +        Layout layout = new PatternLayout(&quot;%d&lt;/p&gt;
{ISO8601}
&lt;p&gt; [,yid:%X&lt;/p&gt;
{myid}
&lt;p&gt;] - %5p [%t:%C&lt;/p&gt;
{1}
&lt;p&gt;@%L] - %m%n&quot;);&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.DEBUG);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(&quot;org.apache.zookeeper.server.quorum&quot;);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            final int CLIENT_PORT_QP1 = PortAssignment.unique();&lt;br/&gt;
    +            final int CLIENT_PORT_QP2 = PortAssignment.unique();&lt;br/&gt;
    +            final int CLIENT_PORT_QP3 = PortAssignment.unique();&lt;br/&gt;
    +&lt;br/&gt;
    +            String quorumCfgIncomplete = getUniquePortCfgForId(1) + &quot;\n&quot; + getUniquePortCfgForId(2);&lt;br/&gt;
    +            String quorumCfgComplete = quorumCfgIncomplete + &quot;\n&quot; + getUniquePortCfgForId(3);&lt;br/&gt;
    +&lt;br/&gt;
    +            // Node 1 is started without the leader (3) in its config view&lt;br/&gt;
    +            MainThread q1 = new MainThread(1, CLIENT_PORT_QP1, quorumCfgIncomplete);&lt;br/&gt;
    +            MainThread q2 = new MainThread(2, CLIENT_PORT_QP2, quorumCfgComplete);&lt;br/&gt;
    +            MainThread q3 = new MainThread(3, CLIENT_PORT_QP3, quorumCfgComplete);&lt;br/&gt;
    +&lt;br/&gt;
    +            // Node 1 must be started first, before quorum is formed, to trigger the attempted invalid connection to 3&lt;br/&gt;
    +            q1.start();&lt;br/&gt;
    +            QuorumPeer quorumPeer1 = waitForQuorumPeer(q1, CONNECTION_TIMEOUT);&lt;br/&gt;
    +            Assert.assertTrue(quorumPeer1.getPeerState() == QuorumPeer.ServerState.LOOKING);&lt;br/&gt;
    +&lt;br/&gt;
    +            // Node 3 started second to avoid 1 and 2 forming a quorum before 3 starts up&lt;br/&gt;
    +            q3.start();&lt;br/&gt;
    +            QuorumPeer quorumPeer3 = waitForQuorumPeer(q3, CONNECTION_TIMEOUT);&lt;br/&gt;
    +            Assert.assertTrue(quorumPeer3.getPeerState() == QuorumPeer.ServerState.LOOKING);&lt;br/&gt;
    +&lt;br/&gt;
    +            // Node 2 started last, kicks off leader election&lt;br/&gt;
    +            q2.start();&lt;br/&gt;
    +&lt;br/&gt;
    +            // Nodes 2 and 3 now form quorum and fully start. 1 attempts to vote for 3, fails, returns to LOOKING state&lt;br/&gt;
    +            Assert.assertTrue(&quot;waiting for server 2 to start&quot;,&lt;br/&gt;
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2, CONNECTION_TIMEOUT));&lt;br/&gt;
    +            Assert.assertTrue(&quot;waiting for server 3 to start&quot;,&lt;br/&gt;
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3, CONNECTION_TIMEOUT));&lt;br/&gt;
    +&lt;br/&gt;
    +            Assert.assertTrue(q1.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LOOKING);&lt;br/&gt;
    +            Assert.assertTrue(q2.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.FOLLOWING);&lt;br/&gt;
    +            Assert.assertTrue(q3.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LEADING);&lt;br/&gt;
    +&lt;br/&gt;
    +            q1.shutdown();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    is there a way we can use the existing tearDown code. So we make sure we never leave any servers running even if an assertion fails?&lt;/p&gt;</comment>
                            <comment id="16384211" author="githubbot" created="Fri, 2 Mar 2018 21:58:00 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171972228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171972228&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -1012,4 +1012,113 @@ public void testFailedTxnAsPartOfQuorumLoss() throws Exception &lt;/p&gt;
{
                 Assert.assertNull(&quot;server &quot; + i + &quot; should not have /zk&quot; + leader, servers.zk[i].exists(&quot;/zk&quot; + leader, false));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Verify that a node without the leader in its view will not attempt to connect to the leader.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testLeaderOutOfView() throws Exception {&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +&lt;br/&gt;
    +        Layout layout = new PatternLayout(&quot;%d&lt;/p&gt;
{ISO8601}
&lt;p&gt; [,yid:%X&lt;/p&gt;
{myid}
&lt;p&gt;] - %5p [%t:%C&lt;/p&gt;
{1}
&lt;p&gt;@%L] - %m%n&quot;);&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.DEBUG);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(&quot;org.apache.zookeeper.server.quorum&quot;);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            final int CLIENT_PORT_QP1 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP2 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP3 = PortAssignment.unique();
    +
    +            String quorumCfgIncomplete = getUniquePortCfgForId(1) + &quot;\n&quot; + getUniquePortCfgForId(2);
    +            String quorumCfgComplete = quorumCfgIncomplete + &quot;\n&quot; + getUniquePortCfgForId(3);
    +
    +            // Node 1 is started without the leader (3) in its config view
    +            MainThread q1 = new MainThread(1, CLIENT_PORT_QP1, quorumCfgIncomplete);
    +            MainThread q2 = new MainThread(2, CLIENT_PORT_QP2, quorumCfgComplete);
    +            MainThread q3 = new MainThread(3, CLIENT_PORT_QP3, quorumCfgComplete);
    +
    +            // Node 1 must be started first, before quorum is formed, to trigger the attempted invalid connection to 3
    +            q1.start();
    +            QuorumPeer quorumPeer1 = waitForQuorumPeer(q1, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer1.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 3 started second to avoid 1 and 2 forming a quorum before 3 starts up
    +            q3.start();
    +            QuorumPeer quorumPeer3 = waitForQuorumPeer(q3, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer3.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 2 started last, kicks off leader election
    +            q2.start();
    +
    +            // Nodes 2 and 3 now form quorum and fully start. 1 attempts to vote for 3, fails, returns to LOOKING state
    +            Assert.assertTrue(&quot;waiting for server 2 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2, CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3, CONNECTION_TIMEOUT));
    +
    +            Assert.assertTrue(q1.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LOOKING);
    +            Assert.assertTrue(q2.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.FOLLOWING);
    +            Assert.assertTrue(q3.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LEADING);
    +
    +            q1.shutdown();
    +            q2.shutdown();
    +            q3.shutdown();
    +
    +            Assert.assertTrue(&quot;waiting for server 1 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP1,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 2 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            qlogger.removeAppender(appender);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        // Verify that Node 1 never threw an exception&lt;br/&gt;
    +        LineNumberReader r = new LineNumberReader(new StringReader(os.toString()));&lt;br/&gt;
    +        String line;&lt;br/&gt;
    +        boolean found = false;&lt;br/&gt;
    +        Pattern p = Pattern.compile(&quot;.&lt;b&gt;java.lang.NullPointerException.&lt;/b&gt;&quot;);&lt;br/&gt;
    +        while ((line = r.readLine()) != null) {&lt;br/&gt;
    +            found = p.matcher(line).matches();&lt;br/&gt;
    +            if (found) &lt;/p&gt;
{
    +                break;
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +&lt;br/&gt;
    +        Assert.assertFalse(&quot;Node should not attempt connection to out of view leader&quot;, found);&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    private String getUniquePortCfgForId(int id) &lt;/p&gt;
{
    +        return String.format(&quot;server.%d=127.0.0.1:%d:%d&quot;, id, PortAssignment.unique(), PortAssignment.unique());
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private QuorumPeer waitForQuorumPeer(MainThread mainThread, int timeout) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I believe this has the potential to be flaky since we can return `quorumPeer` before the thread actually starts. We should ensure that the thread started.&lt;/p&gt;</comment>
                            <comment id="16384212" author="githubbot" created="Fri, 2 Mar 2018 21:58:00 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171970721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171970721&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -1012,4 +1012,113 @@ public void testFailedTxnAsPartOfQuorumLoss() throws Exception &lt;/p&gt;
{
                 Assert.assertNull(&quot;server &quot; + i + &quot; should not have /zk&quot; + leader, servers.zk[i].exists(&quot;/zk&quot; + leader, false));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Verify that a node without the leader in its view will not attempt to connect to the leader.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testLeaderOutOfView() throws Exception {&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +&lt;br/&gt;
    +        Layout layout = new PatternLayout(&quot;%d&lt;/p&gt;
{ISO8601}
&lt;p&gt; [,yid:%X&lt;/p&gt;
{myid}
&lt;p&gt;] - %5p [%t:%C&lt;/p&gt;
{1}
&lt;p&gt;@%L] - %m%n&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It would be great if we did not specify the pattern as a literal. Take a look at some of the other tests and see if the way they get the patternlayout could apply here (`testElectionFraud` for example).&lt;/p&gt;</comment>
                            <comment id="16384213" author="githubbot" created="Fri, 2 Mar 2018 21:58:00 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171973588&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171973588&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -1012,4 +1012,113 @@ public void testFailedTxnAsPartOfQuorumLoss() throws Exception &lt;/p&gt;
{
                 Assert.assertNull(&quot;server &quot; + i + &quot; should not have /zk&quot; + leader, servers.zk[i].exists(&quot;/zk&quot; + leader, false));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Verify that a node without the leader in its view will not attempt to connect to the leader.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testLeaderOutOfView() throws Exception {&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +&lt;br/&gt;
    +        Layout layout = new PatternLayout(&quot;%d&lt;/p&gt;
{ISO8601}
&lt;p&gt; [,yid:%X&lt;/p&gt;
{myid}
&lt;p&gt;] - %5p [%t:%C&lt;/p&gt;
{1}
&lt;p&gt;@%L] - %m%n&quot;);&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.DEBUG);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(&quot;org.apache.zookeeper.server.quorum&quot;);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            final int CLIENT_PORT_QP1 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP2 = PortAssignment.unique();
    +            final int CLIENT_PORT_QP3 = PortAssignment.unique();
    +
    +            String quorumCfgIncomplete = getUniquePortCfgForId(1) + &quot;\n&quot; + getUniquePortCfgForId(2);
    +            String quorumCfgComplete = quorumCfgIncomplete + &quot;\n&quot; + getUniquePortCfgForId(3);
    +
    +            // Node 1 is started without the leader (3) in its config view
    +            MainThread q1 = new MainThread(1, CLIENT_PORT_QP1, quorumCfgIncomplete);
    +            MainThread q2 = new MainThread(2, CLIENT_PORT_QP2, quorumCfgComplete);
    +            MainThread q3 = new MainThread(3, CLIENT_PORT_QP3, quorumCfgComplete);
    +
    +            // Node 1 must be started first, before quorum is formed, to trigger the attempted invalid connection to 3
    +            q1.start();
    +            QuorumPeer quorumPeer1 = waitForQuorumPeer(q1, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer1.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 3 started second to avoid 1 and 2 forming a quorum before 3 starts up
    +            q3.start();
    +            QuorumPeer quorumPeer3 = waitForQuorumPeer(q3, CONNECTION_TIMEOUT);
    +            Assert.assertTrue(quorumPeer3.getPeerState() == QuorumPeer.ServerState.LOOKING);
    +
    +            // Node 2 started last, kicks off leader election
    +            q2.start();
    +
    +            // Nodes 2 and 3 now form quorum and fully start. 1 attempts to vote for 3, fails, returns to LOOKING state
    +            Assert.assertTrue(&quot;waiting for server 2 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2, CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 to start&quot;,
    +                    ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3, CONNECTION_TIMEOUT));
    +
    +            Assert.assertTrue(q1.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LOOKING);
    +            Assert.assertTrue(q2.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.FOLLOWING);
    +            Assert.assertTrue(q3.getQuorumPeer().getPeerState() == QuorumPeer.ServerState.LEADING);
    +
    +            q1.shutdown();
    +            q2.shutdown();
    +            q3.shutdown();
    +
    +            Assert.assertTrue(&quot;waiting for server 1 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP1,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 2 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP2,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +            Assert.assertTrue(&quot;waiting for server 3 down&quot;,
    +                    ClientBase.waitForServerDown(&quot;127.0.0.1:&quot; + CLIENT_PORT_QP3,
    +                            ClientBase.CONNECTION_TIMEOUT));
    +
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            qlogger.removeAppender(appender);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        // Verify that Node 1 never threw an exception&lt;br/&gt;
    +        LineNumberReader r = new LineNumberReader(new StringReader(os.toString()));&lt;br/&gt;
    +        String line;&lt;br/&gt;
    +        boolean found = false;&lt;br/&gt;
    +        Pattern p = Pattern.compile(&quot;.&lt;b&gt;java.lang.NullPointerException.&lt;/b&gt;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It would be great to have a more direct way of expressing that this member never enters the following state. Can we check the logs for `FOLLOWING` like in `testElectionFraud`?&lt;/p&gt;</comment>
                            <comment id="16384214" author="githubbot" created="Fri, 2 Mar 2018 21:58:01 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171972767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171972767&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java &amp;#8212;&lt;br/&gt;
    @@ -1064,7 +1065,12 @@ else if (self.getCurrentAndNextConfigVoters().contains(n.sid)) &lt;/p&gt;
{
                             break;
                         }
&lt;p&gt;                     } else {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.warn(&quot;Ignoring notification from non-cluster member &quot; + n.sid);&lt;br/&gt;
    +                    if (!self.getCurrentAndNextConfigVoters().contains(n.leader)) {&lt;br/&gt;
    +                        LOG.warn(&quot;Ignoring notification for non-cluster member sid {} from sid {}&quot;, n.leader, n.sid);&lt;br/&gt;
    +                    }&lt;br/&gt;
    +                    if (!self.getCurrentAndNextConfigVoters().contains(n.sid)) {&lt;br/&gt;
    +                        LOG.warn(&quot;Ignoring notification from non-cluster member sid {}&quot;, n.sid);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    nit: lets say &quot;quorum&quot; instead of &quot;cluster&quot;&lt;/p&gt;</comment>
                            <comment id="16384215" author="githubbot" created="Fri, 2 Mar 2018 21:58:01 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r171964902&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r171964902&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java &amp;#8212;&lt;br/&gt;
    @@ -1064,7 +1065,12 @@ else if (self.getCurrentAndNextConfigVoters().contains(n.sid)) &lt;/p&gt;
{
                             break;
                         }
&lt;p&gt;                     } else {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.warn(&quot;Ignoring notification from non-cluster member &quot; + n.sid);&lt;br/&gt;
    +                    if (!self.getCurrentAndNextConfigVoters().contains(n.leader)) {&lt;br/&gt;
    +                        LOG.warn(&quot;Ignoring notification for non-cluster member sid {} from sid {}&quot;, n.leader, n.sid);&lt;br/&gt;
    +                    }&lt;br/&gt;
    +                    if (!self.getCurrentAndNextConfigVoters().contains(n.sid)) {&lt;br/&gt;
    +                        LOG.warn(&quot;Ignoring notification from non-cluster member sid {}&quot;, n.sid);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    lets log which member was voted for&lt;/p&gt;</comment>
                            <comment id="16417130" author="githubbot" created="Wed, 28 Mar 2018 10:12:30 +0000"  >&lt;p&gt;Github user maoling commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @enixon can we move on ?&lt;/p&gt;</comment>
                            <comment id="16432600" author="githubbot" created="Tue, 10 Apr 2018 17:12:45 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @maoling I was about 2/3 done with cleaning up this diff when I got dragged into different projects. Thanks for the ping, I&apos;ll try to update here this week.&lt;/p&gt;</comment>
                            <comment id="16436930" author="githubbot" created="Fri, 13 Apr 2018 07:04:32 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Made all changes requested in comments, I can alter the pull requests for the other ZooKeeper branches once we reach agreement on this one.&lt;/p&gt;</comment>
                            <comment id="16440380" author="githubbot" created="Tue, 17 Apr 2018 04:53:01 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @enixon testLeaderOutOfView deterministically fails for me both locally and on Jenkins. Please take a look.&lt;/p&gt;</comment>
                            <comment id="16440997" author="githubbot" created="Tue, 17 Apr 2018 15:17:41 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Tests passing again.&lt;/p&gt;

&lt;p&gt;    This is what can happen when you use a different logging config and your tests rely on scraping the logs.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16441066" author="githubbot" created="Tue, 17 Apr 2018 15:49:12 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r182127687&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r182127687&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java &amp;#8212;&lt;br/&gt;
    @@ -927,10 +927,11 @@ public Vote lookForLeader() throws InterruptedException &lt;/p&gt;
{
                                 tmpTimeOut : maxNotificationInterval);
                         LOG.info(&quot;Notification time out: &quot; + notTimeout);
                     }
&lt;p&gt; &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;else if (self.getCurrentAndNextConfigVoters().contains(n.sid)) {&lt;br/&gt;
    +                else if (self.getCurrentAndNextConfigVoters().contains(n.sid) &amp;amp;&amp;amp;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    As this PR modifies this line and add similar ones, wouldn&apos;t be the case of creating a private method with a meaningful name like below?&lt;br/&gt;
    ```&lt;br/&gt;
    private boolean configVotersContains(long sid) &lt;/p&gt;
{
        return self.getCurrentAndNextConfigVoters().contains(sid);
    }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    This makes this line and the lines below more readable, imho.&lt;/p&gt;</comment>
                            <comment id="16441278" author="githubbot" created="Tue, 17 Apr 2018 18:06:19 +0000"  >&lt;p&gt;Github user enixon commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476#discussion_r182175483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476#discussion_r182175483&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java &amp;#8212;&lt;br/&gt;
    @@ -927,10 +927,11 @@ public Vote lookForLeader() throws InterruptedException &lt;/p&gt;
{
                                 tmpTimeOut : maxNotificationInterval);
                         LOG.info(&quot;Notification time out: &quot; + notTimeout);
                     }
&lt;p&gt; &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;else if (self.getCurrentAndNextConfigVoters().contains(n.sid)) {&lt;br/&gt;
    +                else if (self.getCurrentAndNextConfigVoters().contains(n.sid) &amp;amp;&amp;amp;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    There are five uses of `getCurrentAndNextConfigVoters().contains` in the class, seems reasonable to make it a method.&lt;/p&gt;</comment>
                            <comment id="16441935" author="githubbot" created="Wed, 18 Apr 2018 05:56:43 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    What&apos;s the build failure on this commit?&lt;/p&gt;</comment>
                            <comment id="16441959" author="githubbot" created="Wed, 18 Apr 2018 06:30:02 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @enixon this: &lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-16349&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/INFRA-16349&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16458301" author="hanm" created="Mon, 30 Apr 2018 04:35:29 +0000"  >&lt;p&gt;Issue resolved by pull request 476&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16458302" author="githubbot" created="Mon, 30 Apr 2018 04:35:46 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16458306" author="hanm" created="Mon, 30 Apr 2018 04:45:00 +0000"  >&lt;p&gt;I&apos;ve committed this to 3.5 and master. Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nixon&quot; class=&quot;user-hover&quot; rel=&quot;nixon&quot;&gt;nixon&lt;/a&gt;. Is the patch also applicable to 3.4? I assume this happens only in 3.5+ with dynamic reconfiguration.&#160;&lt;/p&gt;</comment>
                            <comment id="16458345" author="hudson" created="Mon, 30 Apr 2018 06:29:16 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #6 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/6/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2988&quot; title=&quot;NPE triggered if server receives a vote for a server id not in their voting view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2988&quot;&gt;&lt;del&gt;ZOOKEEPER-2988&lt;/del&gt;&lt;/a&gt;: NPE triggered if server receives a vote for a server &#8230; (hanm: rev 2022766ec907f63b1b43fc5455e9e7761cd332f6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16458844" author="nixon" created="Mon, 30 Apr 2018 18:33:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; thanks for merging it to 3.5 too, I&apos;ll shut down that second pr. This bug is applicable to 3.4 as well - imo it&apos;s a worse danger on that branch since its easy for configuration files to be stale. I&apos;ll fix up pr 478 for the 3.4 branch to reflect the comments I got on pr 476 so it can be ready for review.&lt;/p&gt;</comment>
                            <comment id="16458851" author="hadoopqa" created="Mon, 30 Apr 2018 18:35:39 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1655//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16459015" author="githubbot" created="Mon, 30 Apr 2018 20:31:54 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/477&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Change merged to branch-3.5 with &lt;a href=&quot;https://github.com/apache/zookeeper/pull/476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/476&lt;/a&gt;, closing this PR as redundant. &lt;/p&gt;</comment>
                            <comment id="16459016" author="githubbot" created="Mon, 30 Apr 2018 20:31:54 +0000"  >&lt;p&gt;Github user enixon closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/477&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16459072" author="hadoopqa" created="Mon, 30 Apr 2018 21:21:51 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1656//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16460057" author="githubbot" created="Tue, 1 May 2018 19:41:36 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The only failure report out of Jenkins is &quot;Test org.apache.zookeeper.test.FollowerResyncConcurrencyTest FAILED (crashed)&quot;. I&apos;m unable to repro any issue with that test on my branch locally, is there a good way to re-run the test?&lt;/p&gt;</comment>
                            <comment id="16460503" author="githubbot" created="Wed, 2 May 2018 04:19:11 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @enixon &quot;FollowerResyncConcurrencyTest &quot; is a known flaky test (and the error in this case is infrastructure issues - the JVM abnormally exit). I tested your patch using a Jenkins job and everything looks good. Committed, please close this pull request.&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; is there a good way to re-run the test&lt;/p&gt;

&lt;p&gt;    P.S. to kick off the pre-commit build bot, you can close the pull request and reopen it.&lt;/p&gt;</comment>
                            <comment id="16460505" author="hanm" created="Wed, 2 May 2018 04:20:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;This bug is applicable to 3.4 as well - imo it&apos;s a worse danger on that branch since its easy for configuration files to be stale.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Make sense. Just committed the patch for branch-3.4, and updated the Jira fixed version to include 3.4.&lt;/p&gt;</comment>
                            <comment id="16460563" author="githubbot" created="Wed, 2 May 2018 06:10:06 +0000"  >&lt;p&gt;Github user enixon commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, @hanm !&lt;/p&gt;</comment>
                            <comment id="16460564" author="githubbot" created="Wed, 2 May 2018 06:10:06 +0000"  >&lt;p&gt;Github user enixon closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/478&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qrfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>