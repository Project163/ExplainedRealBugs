<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:59:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2797] Invalid TTL from misbehaving client nukes zookeeper</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2797</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I was adding container and TTL support to kazoo, and managed to screw something up which set the TTL to a negative value. This invalid TTL blew up the commit processor, and got written to the log, preventing the zookeepers from starting back up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13076023">ZOOKEEPER-2797</key>
            <summary>Invalid TTL from misbehaving client nukes zookeeper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="patrickwhite">Patrick White</assignee>
                                    <reporter username="patrickwhite">Patrick White</reporter>
                        <labels>
                            <label>ttl_nodes</label>
                    </labels>
                <created>Tue, 30 May 2017 23:32:20 +0000</created>
                <updated>Tue, 5 Apr 2022 03:38:37 +0000</updated>
                            <resolved>Thu, 1 Jun 2017 03:46:18 +0000</resolved>
                                    <version>3.6.0</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>security</component>
                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16030363" author="githubbot" created="Tue, 30 May 2017 23:35:31 +0000"  >&lt;p&gt;GitHub user packysauce opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2797&quot; title=&quot;Invalid TTL from misbehaving client nukes zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2797&quot;&gt;&lt;del&gt;ZOOKEEPER-2797&lt;/del&gt;&lt;/a&gt; Defend against bad TTLs from misbehaving clients&lt;/p&gt;

&lt;p&gt;    Validate the TTL before it makes it to the commit processor to prevent blowing up ZK&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/packysauce/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/packysauce/zookeeper&lt;/a&gt; protect_from_bad_ttl&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #267&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 00541acbbffcd6c3d4267078f1644e554e1200f8&lt;br/&gt;
Author: Patrick White &amp;lt;patrick@patrickwhite.org&amp;gt;&lt;br/&gt;
Date:   2017-05-30T20:22:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2797&quot; title=&quot;Invalid TTL from misbehaving client nukes zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2797&quot;&gt;&lt;del&gt;ZOOKEEPER-2797&lt;/del&gt;&lt;/a&gt; Defend against bad TTLs from misbehaving clients&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16030438" author="hadoopqa" created="Wed, 31 May 2017 00:47:37 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/751//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16030514" author="githubbot" created="Wed, 31 May 2017 02:28:12 +0000"  >&lt;p&gt;Github user packysauce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The failed test in jenkins runs fine for me locally, and the logs indicated succeeded (if I&apos;m interpreting that correctly)&lt;/p&gt;</comment>
                            <comment id="16030624" author="githubbot" created="Wed, 31 May 2017 04:46:18 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267#discussion_r119269582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267#discussion_r119269582&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/CreateTTLTest.java &amp;#8212;&lt;br/&gt;
    @@ -69,6 +75,23 @@ public void testCreate()&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         @Test&lt;br/&gt;
    +    public void testBadTTLs()&lt;br/&gt;
    +            throws IOException, KeeperException, InterruptedException {&lt;br/&gt;
    +        Stat stat = new Stat();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: is this needed?&lt;/p&gt;</comment>
                            <comment id="16030625" author="githubbot" created="Wed, 31 May 2017 04:49:00 +0000"  >&lt;p&gt;Github user packysauce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267#discussion_r119270375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267#discussion_r119270375&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/CreateTTLTest.java &amp;#8212;&lt;br/&gt;
    @@ -69,6 +75,23 @@ public void testCreate()&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         @Test&lt;br/&gt;
    +    public void testBadTTLs()&lt;br/&gt;
    +            throws IOException, KeeperException, InterruptedException {&lt;br/&gt;
    +        Stat stat = new Stat();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ah! the first version of this went through the zk client-ish interface, so probably not needed anymore&lt;/p&gt;</comment>
                            <comment id="16030677" author="hadoopqa" created="Wed, 31 May 2017 05:46:09 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/753//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16032389" author="githubbot" created="Thu, 1 Jun 2017 03:43:33 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm, merging.&lt;/p&gt;</comment>
                            <comment id="16032393" author="githubbot" created="Thu, 1 Jun 2017 03:46:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16032394" author="hanm" created="Thu, 1 Jun 2017 03:46:18 +0000"  >&lt;p&gt;Issue resolved by pull request 267&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/267&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16032396" author="hanm" created="Thu, 1 Jun 2017 03:47:42 +0000"  >&lt;p&gt;Committed to master: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/3824da0b649c6a6a698cfe6c79ca3d44a9e94f29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/3824da0b649c6a6a698cfe6c79ca3d44a9e94f29&lt;/a&gt;&lt;br/&gt;
Committed to branch-3.5:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/90495d96131cc4cf6a8f2533c06b796136234c35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/90495d96131cc4cf6a8f2533c06b796136234c35&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16032397" author="hanm" created="Thu, 1 Jun 2017 03:48:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt;: please add &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickwhite&quot; class=&quot;user-hover&quot; rel=&quot;patrickwhite&quot;&gt;patrickwhite&lt;/a&gt; to contributor list and assign this issue to him.&lt;/p&gt;</comment>
                            <comment id="16032399" author="hanm" created="Thu, 1 Jun 2017 03:50:46 +0000"  >&lt;p&gt;Side note: I think it&apos;s good to have the ttl validation on server side anyway, but it would also be good to have same validation on client side so invalid ttl value will be caught earlier before sending over to server. I believe the Java client does ttl validation, so kazoo client should do something similar.&lt;/p&gt;</comment>
                            <comment id="16032415" author="patrickwhite" created="Thu, 1 Jun 2017 04:24:33 +0000"  >&lt;p&gt;The client doing it is nice, but the server should always be validating all fields of all requests.&lt;/p&gt;

&lt;p&gt;Kazoo doesn&apos;t support TTL and containers at the moment. I&apos;ll have a diff up soon. I also validate client side. Guess how I figured out how to kill ZK via TTLs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16032421" author="patrickwhite" created="Thu, 1 Jun 2017 04:30:50 +0000"  >&lt;p&gt;As an aside, any insight into why create flags moved from being bitfield-like to an enum?&lt;/p&gt;</comment>
                            <comment id="16032435" author="hudson" created="Thu, 1 Jun 2017 04:39:02 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3410 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3410/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3410/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2797&quot; title=&quot;Invalid TTL from misbehaving client nukes zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2797&quot;&gt;&lt;del&gt;ZOOKEEPER-2797&lt;/del&gt;&lt;/a&gt;: Defend against bad TTLs from misbehaving clients (hanm: rev 3824da0b649c6a6a698cfe6c79ca3d44a9e94f29)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/CreateTTLTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16033254" author="hanm" created="Thu, 1 Jun 2017 16:29:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;the server should always be validating all fields of all requests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Absolutely, to prevent bad clients. I mentioned client side check because if we control the clients, then doing client side check is more efficient as it prevents unnecessary round trips.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;any insight into why create flags moved from being bitfield-like to an enum?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If you are referring to the EphemeralType as the enum, my guess would be for readability. &lt;/p&gt;</comment>
                            <comment id="17517192" author="JIRAUSER287593" created="Tue, 5 Apr 2022 03:38:37 +0000"  >&lt;h4&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h4&gt;
&lt;p&gt;I was adding container and TTL support to kazoo, and managed to screw something up which set the TTL to a negative value. This invalid TTL blew up the commit processor, and got written to the log, preventing the zookeepers from starting back up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fo0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>