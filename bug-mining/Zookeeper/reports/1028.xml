<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:03:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3944] zookeeper c api sasl client memory leak</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3944</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I find this memory leak through sanitizer.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/blob/master/zookeeper-client/zookeeper-client-c/src/zookeeper.c#L664-L665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt;&#160;within zookeeper_close() it destroy the client and reset it to NULL. This client is created using calloc()&lt;/p&gt;

&lt;p&gt;In zoo_sasl_client_destroy(), the client is not freed, neither within zookeeper_close().&#160;&lt;/p&gt;

&lt;p&gt;I would suggest add a free() before setting it to NULL in zookeeper_close&lt;/p&gt;</description>
                <environment></environment>
        <key id="13329196">ZOOKEEPER-3944</key>
            <summary>zookeeper c api sasl client memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="xiaotian_qi">Xiaotian Qi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2020 11:43:30 +0000</created>
                <updated>Sun, 28 Mar 2021 08:55:13 +0000</updated>
                            <resolved>Mon, 28 Sep 2020 07:27:38 +0000</resolved>
                                    <version>3.6.2</version>
                                    <fixVersion>3.7.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17201756" author="ztzg" created="Thu, 24 Sep 2020 20:24:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotian_qi&quot; class=&quot;user-hover&quot; rel=&quot;xiaotian_qi&quot;&gt;xiaotian_qi&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Argh; nice catch.&#160; The &lt;tt&gt;destroy&lt;/tt&gt; &quot;method&quot; carefully unwinds the fields, but is indeed missing a &lt;tt&gt;free&lt;/tt&gt; of the structure itself.&lt;/p&gt;

&lt;p&gt;(I would have put the &lt;tt&gt;free&lt;/tt&gt; at the end of the &lt;tt&gt;destroy&lt;/tt&gt; method&#8212;a bit like how C++ &lt;tt&gt;delete&lt;/tt&gt; works&#8212;but the patch generally looks fine to me.)&lt;/p&gt;

&lt;p&gt;Are you planning to to submit this as a PR, or would you prefer I do it?&#160; (And if I do, would you object to me moving the &lt;tt&gt;free&lt;/tt&gt; inside the method, while still keeping the patch attributed to you?)&lt;/p&gt;

&lt;p&gt;Unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eolivelli&quot; class=&quot;user-hover&quot; rel=&quot;eolivelli&quot;&gt;eolivelli&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt; are okay with directly applying the attached patch, of course.&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Damien Diederen&lt;/p&gt;</comment>
                            <comment id="17201795" author="xiaotian_qi" created="Thu, 24 Sep 2020 21:54:00 +0000"  >&lt;p&gt;Hi Damien,&lt;/p&gt;

&lt;p&gt;I actually prefer free it in zookeeper_close, as in the destroy method it &lt;a href=&quot;https://github.com/apache/zookeeper/blob/master/zookeeper-client/zookeeper-client-c/src/zk_sasl.c#L118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;set a state of the sasl client struct&lt;/a&gt;. This looks to me like semantically destroy should not free the memory(otherwise setting the state is useless)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A PR is created: &lt;a href=&quot;https://github.com/apache/zookeeper/pull/1466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1466&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17201904" author="ztzg" created="Fri, 25 Sep 2020 04:48:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotian_qi&quot; class=&quot;user-hover&quot; rel=&quot;xiaotian_qi&quot;&gt;xiaotian_qi&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Okay.&lt;/p&gt;

&lt;p&gt;(I also had in mind that ZK &lt;tt&gt;&lt;b&gt;destroy&lt;/b&gt;&lt;/tt&gt; methods were freeing memory&#8212;but looking closer, it&apos;s a mix of both: &lt;tt&gt;destroy_completion_entry&lt;/tt&gt; and &lt;tt&gt;destroy_zk_hashtable&lt;/tt&gt;, for example, include a &lt;tt&gt;free&lt;/tt&gt;, but &lt;tt&gt;destroy(zhandle_t)&lt;/tt&gt;&#8212;which is quite central&#8212;doesn&apos;t.)&lt;/p&gt;

&lt;p&gt;Thank you for submitting the PR.&lt;/p&gt;

&lt;p&gt;Cheers, -D&lt;/p&gt;</comment>
                            <comment id="17201945" author="eolivelli" created="Fri, 25 Sep 2020 06:44:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotian_qi&quot; class=&quot;user-hover&quot; rel=&quot;xiaotian_qi&quot;&gt;xiaotian_qi&lt;/a&gt;&#160;please send a Pull request, now we have all workflows integrated with github.&lt;/p&gt;

&lt;p&gt;With a PR a CI job will validate the patch automatically for instance&lt;/p&gt;</comment>
                            <comment id="17203051" author="symat" created="Mon, 28 Sep 2020 07:27:38 +0000"  >&lt;p&gt;Issue resolved by pull request 1466&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1466&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13012070" name="0001-ZOOKEEPER-3944-Fix-sasl-memory-leak.patch" size="848" author="xiaotian_qi" created="Thu, 24 Sep 2020 12:58:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ivqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>