<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:57:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2189] QuorumCnxManager: use BufferedOutputStream for initial msg</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2189</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;This was original JIRA of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2203&quot; title=&quot;multiple leaders can be elected when configs conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2203&quot;&gt;&lt;del&gt;ZOOKEEPER-2203&lt;/del&gt;&lt;/a&gt;. For project management reason, all the issues and related discussion are moved to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2203&quot; title=&quot;multiple leaders can be elected when configs conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2203&quot;&gt;&lt;del&gt;ZOOKEEPER-2203&lt;/del&gt;&lt;/a&gt;. This JIRA is linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2098&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2098&quot;&gt;&lt;del&gt;ZOOKEEPER-2098&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;==============&lt;/p&gt;

&lt;p&gt;This sequence leads the ensemble to a split-brain state:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start server 1 (config=1:participant, 2:participant, 3:participant)&lt;/li&gt;
	&lt;li&gt;Start server 2 (config=1:participant, 2:participant, 3:participant)&lt;/li&gt;
	&lt;li&gt;1 and 2 believe 2 is the leader&lt;/li&gt;
	&lt;li&gt;Start server 3 (config=1:observer, 2:observer, 3:participant)&lt;/li&gt;
	&lt;li&gt;3 believes 3 is the leader, although 1 and 2 still believe 2 is the leader&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Such a split-brain ensemble is very unstable.&lt;br/&gt;
Znodes can be lost easily:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create some znodes on 2&lt;/li&gt;
	&lt;li&gt;Restart 1 and 2&lt;/li&gt;
	&lt;li&gt;1, 2 and 3 can think 3 is the leader&lt;/li&gt;
	&lt;li&gt;znodes created on 2 are lost, as 1 and 2 sync with 3&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I consider this behavior as a bug and that ZK should fail gracefully if a participant is listed as an observer in the config.&lt;/p&gt;

&lt;p&gt;In current implementation, ZK cannot detect such an invalid config, as FastLeaderElection.sendNotification() sends notifications to only voting members and hence there is no message from observers(1 and 2) to the new voter (3).&lt;br/&gt;
I think FastLeaderElection.sendNotification() should send notifications to all the members and FastLeaderElection.Messenger.WorkerReceiver.run() should verify acks.&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12829462">ZOOKEEPER-2189</key>
            <summary>QuorumCnxManager: use BufferedOutputStream for initial msg</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="suda">Akihiro Suda</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 May 2015 06:20:59 +0000</created>
                <updated>Wed, 3 Jun 2015 16:46:17 +0000</updated>
                                            <version>3.5.0</version>
                                                    <component>leaderElection</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14565932" author="hudson" created="Sat, 30 May 2015 10:40:26 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2707 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2707/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2707/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2189&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2189&quot;&gt;ZOOKEEPER-2189&lt;/a&gt;: QuorumCnxManager: use BufferedOutputStream for initial msg&lt;br/&gt;
(Raul Gutierrez Segales via hdeng) (hdeng: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1682558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1682558&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14566040" author="rgs" created="Sat, 30 May 2015 15:10:28 +0000"  >&lt;p&gt;this message is bogus, the commit message meant to reference &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2098&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2098&quot;&gt;&lt;del&gt;ZOOKEEPER-2098&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14566120" author="hdeng" created="Sat, 30 May 2015 17:47:49 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I committed &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2098&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2098&quot;&gt;&lt;del&gt;ZOOKEEPER-2098&lt;/del&gt;&lt;/a&gt; but mistakenly wrote the commit message to be &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2189&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2189&quot;&gt;ZOOKEEPER-2189&lt;/a&gt;. Would you mind to open another JIRA and grant this JIRA number to me. Thanks!&lt;/p&gt;</comment>
                            <comment id="14566164" author="shralex" created="Sat, 30 May 2015 19:44:24 +0000"  >&lt;p&gt;Verifying acks as proposed in this JIRA will not solve this issue. Acks from observers are not required to elect a leader. If standaloneenabled=false server 3 can be elected without seeing any other messages. &lt;/p&gt;

&lt;p&gt;Also, suppose you wrote the wrong ports for the other servers ? &lt;/p&gt;

&lt;p&gt;It seems that to fix such errors one needs some kind of config registry. &lt;/p&gt;</comment>
                            <comment id="14566479" author="hudson" created="Sun, 31 May 2015 09:35:50 +0000"  >&lt;p&gt;ABORTED: Integrated in ZooKeeper-trunk #2708 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2708/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2708/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2189&quot; title=&quot;QuorumCnxManager: use BufferedOutputStream for initial msg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2189&quot;&gt;ZOOKEEPER-2189&lt;/a&gt;: QuorumCnxManager: use BufferedOutputStream for initial msg&lt;br/&gt;
(Raul Gutierrez Segales via hdeng) (hdeng: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1682623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1682623&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14567099" author="suda" created="Mon, 1 Jun 2015 09:27:08 +0000"  >&lt;p&gt;Hi Hongchao Deng,&lt;/p&gt;

&lt;p&gt;Thank you for the offer.&lt;br/&gt;
But as this JIRA has been still kept open, I think we can still continue with this JIRA.&lt;br/&gt;
I will open another JIRA if there is a problem.&lt;/p&gt;</comment>
                            <comment id="14567101" author="suda" created="Mon, 1 Jun 2015 09:27:24 +0000"  >&lt;p&gt;Hi Alexander Shraer,&lt;/p&gt;

&lt;p&gt;Thank you for the feedback.&lt;/p&gt;

&lt;p&gt;I understood we cannot solve the issue by verifying acks, &lt;br/&gt;
but could you tell me what config registry stands for?&lt;br/&gt;
(something like &quot;discovery.etcd.io&quot; or Consul&apos;s Atlas integration?)&lt;/p&gt;</comment>
                            <comment id="14567512" author="hdeng" created="Mon, 1 Jun 2015 16:24:04 +0000"  >&lt;p&gt;I didn&apos;t offer anything... You might misunderstand..&lt;/p&gt;

&lt;p&gt;What I meant is I committed &quot;2098&quot;, but I wrote the message to be &quot;2198&quot; (not committed &quot;2198&quot;).&lt;br/&gt;
I wonder if you can give this JIRA to me, I will replicate &quot;2098&quot; to this JIRA and mark it duplicated. You can create a new JIRA and move discussion there.&lt;/p&gt;

&lt;p&gt;I would really appreciate it if you can help me. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14569824" author="shralex" created="Tue, 2 Jun 2015 21:45:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=suda&quot; class=&quot;user-hover&quot; rel=&quot;suda&quot;&gt;suda&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;On second thought, although its not going to solve the specific scenario you describe, it may still be a good idea to add some check(s). For example, if a server receives a configuration from another server (in FastLeaderElection.java) with the same configuration version,  the configuration itself must be identical.  The check should only be for non-initial configs (see &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1783&quot; title=&quot;Distinguish initial configuration from first established configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1783&quot;&gt;&lt;del&gt;ZOOKEEPER-1783&lt;/del&gt;&lt;/a&gt;), so probably (rqv.getVersion() &amp;gt; 0x100000000 and rqv.getVersion() == curQV.getVersion()). &lt;br/&gt;
If you still think its a good idea, would you like to propose a patch ?&lt;/p&gt;

&lt;p&gt;Regarding the config registry, I didn&apos;t have any specific system in mind, perhaps others can advise. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="14570133" author="suda" created="Wed, 3 Jun 2015 02:06:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Sorry for the misunderstanding,&lt;/p&gt;

&lt;p&gt;I&apos;m OK to assign the JIRA to you, but I don&apos;t seem to have the permission to do so.&lt;br/&gt;
Could you list me as a contributor so that I can assign JIRAs?&lt;/p&gt;

</comment>
                            <comment id="14570194" author="hdeng" created="Wed, 3 Jun 2015 02:56:04 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thanks for your understanding. I really appreciate your help.&lt;/p&gt;

&lt;p&gt;All you have to do is to click &quot;More&quot; -&amp;gt; &quot;Clone&quot; and clone this JIRA to a new one.&lt;/p&gt;

&lt;p&gt;Then I can take it myself and add a comment to tell people that discussion here belongs to that JIRA &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thanks for reporting the issue and contributing to the project too!&lt;/p&gt;</comment>
                            <comment id="14570246" author="suda" created="Wed, 3 Jun 2015 04:08:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;Thank you for the advice.&lt;/p&gt;

&lt;p&gt;I made the clone: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2203&quot; title=&quot;multiple leaders can be elected when configs conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2203&quot;&gt;&lt;del&gt;ZOOKEEPER-2203&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14570247" author="suda" created="Wed, 3 Jun 2015 04:08:42 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;Thank you for the advice.&lt;/p&gt;

&lt;p&gt;I made the clone: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2203&quot; title=&quot;multiple leaders can be elected when configs conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2203&quot;&gt;&lt;del&gt;ZOOKEEPER-2203&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14570280" author="phunt" created="Wed, 3 Jun 2015 04:59:19 +0000"  >&lt;p&gt;Not sure re config registry. What would that entail? Git? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14570286" author="hdeng" created="Wed, 3 Jun 2015 05:05:47 +0000"  >&lt;p&gt;I think they are talking about a central registry to contain server list. Just like &quot;discovery.etcd.io&quot; or DMV...&lt;/p&gt;

&lt;p&gt;However, this is like asking the root of root. ZK is the root of knowledge for most distributed systems. Are we expecting a root for ZK too?&lt;/p&gt;

&lt;p&gt;Anyway, JIRA is moved to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2203&quot; title=&quot;multiple leaders can be elected when configs conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2203&quot;&gt;&lt;del&gt;ZOOKEEPER-2203&lt;/del&gt;&lt;/a&gt;. Let&apos;s move discussion there. Do me a favor and let me clean up the mess caused by my mistake...&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12764076">ZOOKEEPER-2098</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-368&quot; title=&quot;Observers: core functionality &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-368&quot;&gt;&lt;strike&gt;ZOOKEEPER-368&lt;/strike&gt;&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eny7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>