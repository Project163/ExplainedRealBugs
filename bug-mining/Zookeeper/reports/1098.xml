<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:04:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-1875] NullPointerException in ClientCnxn$EventThread.processEvent</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1875</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We&apos;ve been seeing NullPointerException while working on HBase:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;14/01/30 22:15:25 INFO zookeeper.ZooKeeper: Client environment:user.dir=/home/biadmin/hbase-trunk
14/01/30 22:15:25 INFO zookeeper.ZooKeeper: Initiating client connection, connectString=hdtest009:2181 sessionTimeout=90000 watcher=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
14/01/30 22:15:25 INFO zookeeper.ClientCnxn: Opening socket connection to server hdtest009/9.30.194.18:2181. Will not attempt to authenticate using SASL (Unable to locate a login configuration)
14/01/30 22:15:25 INFO zookeeper.ClientCnxn: Socket connection established to hdtest009/9.30.194.18:2181, initiating session
14/01/30 22:15:25 INFO zookeeper.ClientCnxn: Session establishment complete on server hdtest009/9.30.194.18:2181, sessionid = 0x143986213e67e48, negotiated timeout = 60000
14/01/30 22:15:25 ERROR zookeeper.ClientCnxn: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling watcher
java.lang.NullPointerException
        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:519)
        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:495)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is the watcher is null in this part of the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;       &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void processEvent(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; event) {
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (event &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; WatcherSetEventPair) {
                  &lt;span class=&quot;code-comment&quot;&gt;// each watcher will process the event
&lt;/span&gt;                  WatcherSetEventPair pair = (WatcherSetEventPair) event;
                  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Watcher watcher : pair.watchers) {
                      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                          watcher.process(pair.event);
                      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
                          LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling watcher &quot;&lt;/span&gt;, t);
                      }
                  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12692768">ZOOKEEPER-1875</key>
            <summary>NullPointerException in ClientCnxn$EventThread.processEvent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="arshad.mohammad">Mohammad Arshad</assignee>
                                    <reporter username="jinghe">Jerry He</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 3 Feb 2014 04:06:08 +0000</created>
                <updated>Thu, 15 Jun 2023 21:09:12 +0000</updated>
                                            <version>3.4.5</version>
                    <version>3.4.10</version>
                                                    <component>java client</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>12</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="13889205" author="jinghe" created="Mon, 3 Feb 2014 04:18:13 +0000"  >&lt;p&gt;Attached a patch that does the null checking for watcher.&lt;/p&gt;</comment>
                            <comment id="13889207" author="hadoopqa" created="Mon, 3 Feb 2014 04:22:38 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12626596/ZOOKEEPER-1875.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12626596/ZOOKEEPER-1875.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1561672.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1915//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1915//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13889212" author="jinghe" created="Mon, 3 Feb 2014 04:37:44 +0000"  >&lt;p&gt;The patch was generated based on trunk. I am not sure why it can not be applied.&lt;br/&gt;
Re-submitting ...&lt;/p&gt;</comment>
                            <comment id="13889215" author="hadoopqa" created="Mon, 3 Feb 2014 04:42:13 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12626598/ZOOKEEPER-1875-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12626598/ZOOKEEPER-1875-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1561672.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1916//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1916//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13890005" author="jinghe" created="Mon, 3 Feb 2014 22:24:24 +0000"  >&lt;p&gt;Can someone look to see why the patch can not apply on the build server?&lt;br/&gt;
I can apply fine locally.&lt;/p&gt;

&lt;p&gt;Also regarding the NPE, it can be easily re-created when you instantiate a zookeeper class with null watcher. &lt;/p&gt;</comment>
                            <comment id="13890424" author="thawan" created="Tue, 4 Feb 2014 06:06:00 +0000"  >&lt;p&gt;Patch need to be in svn format&lt;/p&gt;</comment>
                            <comment id="13891337" author="jinghe" created="Tue, 4 Feb 2014 22:45:55 +0000"  >&lt;p&gt;Thanks, Thawan.&lt;br/&gt;
Attached a re-formatted patch.  Hope it will work this time.&lt;/p&gt;</comment>
                            <comment id="13891502" author="hadoopqa" created="Wed, 5 Feb 2014 00:26:15 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12627002/ZOOKEEPER-1875-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12627002/ZOOKEEPER-1875-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1561672.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1917//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13891540" author="stack" created="Wed, 5 Feb 2014 00:48:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13897419" author="jinghe" created="Tue, 11 Feb 2014 01:33:55 +0000"  >&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;Are we good with the patch?&lt;/p&gt;</comment>
                            <comment id="13897458" author="fournc" created="Tue, 11 Feb 2014 02:19:47 +0000"  >&lt;p&gt;No easy test possible?&lt;/p&gt;</comment>
                            <comment id="13902519" author="jinghe" created="Sat, 15 Feb 2014 20:48:26 +0000"  >&lt;p&gt;Hi, Camille&lt;/p&gt;

&lt;p&gt;Are you asking for a unit test case? &lt;br/&gt;
Can you give a pointer or suggestion to a test case I can follow or add to?&lt;/p&gt;</comment>
                            <comment id="13955794" author="michim" created="Mon, 31 Mar 2014 22:20:31 +0000"  >&lt;p&gt;Yes, it would be good to add a test case. I would add a new test file ClientCnxnTest.java under trunk/src/java/test/org/apache/zookeeper/test. Just as one example, SessionTest.java starts a server and tests the client against the server. &lt;/p&gt;</comment>
                            <comment id="14006257" author="michim" created="Thu, 22 May 2014 18:26:23 +0000"  >&lt;p&gt;Actually I&apos;m not sure if watcher or pair.event is ever supposed to be null. Maybe there is a bug somewhere else?&lt;/p&gt;</comment>
                            <comment id="14020864" author="rakeshr" created="Sat, 7 Jun 2014 16:12:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt; When reviewing the code, I&apos;ve come across one case where it can result in NPE. Zookeeper client.register(null) allows null watcher and during connection event the following code results in null watcher.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; None:
                result.add(defaultWatcher);
                &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; clear = ClientCnxn.getDisableAutoResetWatch() &amp;amp;&amp;amp;
                        state != Watcher.Event.KeeperState.SyncConnected;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve attached a patch to validate the null connection watcher at the api level. I hope this wont be a compatibility issue for 3.5 release?&lt;/p&gt;</comment>
                            <comment id="14020879" author="hadoopqa" created="Sat, 7 Jun 2014 17:02:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648821/ZOOKEEPER-1875.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648821/ZOOKEEPER-1875.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1600481.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2123//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14020941" author="michim" created="Sat, 7 Jun 2014 19:42:54 +0000"  >&lt;p&gt;+1 Good catch Rakesh. I don&apos;t think this would be a compatibility problem, but I&apos;ll wait for others to confirm before checking this in to 3.5.&lt;/p&gt;</comment>
                            <comment id="14020951" author="jinghe" created="Sat, 7 Jun 2014 20:15:10 +0000"  >&lt;p&gt;Hi, guys&lt;br/&gt;
It is possible that existing user code instantiate ZooKeeper with a null watcher.&lt;br/&gt;
It is a valid use case: I need a ZooKeeper but I don&apos;t want to watch or get any event.&lt;/p&gt;

&lt;p&gt;Do I misunderstand anything?&lt;/p&gt;</comment>
                            <comment id="14021270" author="rakeshr" created="Sun, 8 Jun 2014 19:05:58 +0000"  >&lt;p&gt;AFAIK mostly everyone will have logic against connection watch notifications and act upon. If anyone has null watcher pattern, still it can be achieved by passing NullWatcher implementation. I thought of avoiding null checks during &apos;result.add(defaultWatcher);&apos;, if anyone has strong reason we can have this alternate way&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14075443" author="phunt" created="Sat, 26 Jul 2014 17:56:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;It is a valid use case: I need a ZooKeeper but I don&apos;t want to watch or get any event.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s valid wrt not interested in setting any znode watches. However watchers are also notified about service state changes - such as being connected/disconnected from the ZK service. You can&apos;t operate w/o this (creating a zk object is not sufficient, you are async notified when you are eventually connected to the service - that goes to a watcher).&lt;/p&gt;

&lt;p&gt;Unfortunately I see the current patch as a b/w incompat issue - users might be passing null watcher when contructing the ZK object even though they shouldn&apos;t be. Take a look at the results here (not everything is apropos but there are enough there...)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/search?q=%22new+zookeeper%22+null&amp;amp;type=Code&amp;amp;ref=searchresults&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/search?q=%22new+zookeeper%22+null&amp;amp;type=Code&amp;amp;ref=searchresults&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We might be able to fix this over time, but for the time being I believe we need to live with it.&lt;/p&gt;

&lt;p&gt;imo the patch should be updated to just address the original issue - handle the case where we get a null watcher.&lt;/p&gt;</comment>
                            <comment id="14075484" author="jinghe" created="Sat, 26 Jul 2014 20:23:30 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt;&lt;br/&gt;
Are you ok with the original patch first patch?&lt;br/&gt;
I think it is simple guard against null watcher during processing of events that we should have in place anyway.&lt;/p&gt;</comment>
                            <comment id="14076022" author="rakeshr" created="Mon, 28 Jul 2014 08:30:01 +0000"  >&lt;p&gt;I agree not to break compatibility. So in this jira will just handle the original null watcher issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jinghe&quot; class=&quot;user-hover&quot; rel=&quot;jinghe&quot;&gt;jinghe&lt;/a&gt; How about doing the null checks at the place where it is adding the null defaultWatcher to the list, like below. Please see my &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1875?focusedCommentId=14020864&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14020864&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;previous comments for the root cause &lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ZooKeeper.java


&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defaultWatcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    result.add(defaultWatcher);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14076489" author="jinghe" created="Mon, 28 Jul 2014 18:02:31 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Good suggestion! That will do.&lt;br/&gt;
Maybe add the customary null checking in my first patch as well? &lt;/p&gt;</comment>
                            <comment id="14151170" author="rakeshr" created="Sun, 28 Sep 2014 18:30:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jinghe&quot; class=&quot;user-hover&quot; rel=&quot;jinghe&quot;&gt;jinghe&lt;/a&gt; will you generate a patch?&lt;/p&gt;</comment>
                            <comment id="15969977" author="ctubbsii" created="Sat, 15 Apr 2017 14:25:28 +0000"  >&lt;p&gt;I can confirm this bug affects 3.4.10 also. Will there be a 3.4.11 to fix this, or will this only be fixed in 3.5+?&lt;br/&gt;
This issue affects the &lt;a href=&quot;https://github.com/revelc/zookeeper-maven-plugin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zookeeper-maven-plugin&lt;/a&gt;. I&apos;ve had to create a NOOPWatcher to work around, because null cannot be passed as a watcher in the constructor.&lt;/p&gt;</comment>
                            <comment id="16885139" author="genstr" created="Mon, 15 Jul 2019 12:07:55 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;jerryhe&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zookeeper&quot; class=&quot;user-hover&quot; rel=&quot;zookeeper&quot;&gt;zookeeper&lt;/a&gt;, is this Jira planned to be included in the next releases - &lt;a href=&quot;https://issues.apache.org/jira/issues/?jql=project+%3D+ZOOKEEPER+AND+fixVersion+%3D+3.6.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;3.6.0&lt;/a&gt;,&#160;&lt;a href=&quot;https://issues.apache.org/jira/issues/?jql=project+%3D+ZOOKEEPER+AND+fixVersion+%3D+3.5.6&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;3.5.6&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
 Yauheni Salopiy&lt;/p&gt;</comment>
                            <comment id="17003464" author="rajsura" created="Thu, 26 Dec 2019 04:38:12 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;jerryhe&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you please at least generate a patch that is likely to be merged in future releases?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Rajkiran&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17006728" author="rajsura" created="Thu, 2 Jan 2020 10:43:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;jerryhe&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you please at least generate a patch that is likely to be merged in future releases?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Rajkiran&lt;/p&gt;</comment>
                            <comment id="17518639" author="arshad.mohammad" created="Thu, 7 Apr 2022 07:22:30 +0000"  >&lt;p&gt;This issue is still applicable to all versions.&lt;br/&gt;
is anybody interested in raising PR.&lt;/p&gt;</comment>
                            <comment id="17518795" author="arshad.mohammad" created="Thu, 7 Apr 2022 11:02:32 +0000"  >&lt;p&gt;I had observed this issue in the past, but right now don&apos;t have details of exact cause.&lt;/p&gt;</comment>
                            <comment id="17518799" author="arshad.mohammad" created="Thu, 7 Apr 2022 11:11:16 +0000"  >&lt;p&gt;I think as proposed in the first patch we should skip the watcher processing if either watcher or pair.event is null, but we should also add warning so in future we can get better understanding of the use case from where problem is coming.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (watcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; pair.event != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    watcher.process(pair.event);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    LOG.warn(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Skipping watcher processing as watcher and pair.event cannot&quot;&lt;/span&gt;
            + &lt;span class=&quot;code-quote&quot;&gt;&quot; be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;. watcher={}, pair.event={}&quot;&lt;/span&gt;,
        watcher == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt; : watcher.getClass().getName(),
        pair.event == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt; : pair.event);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17523057" author="arshad.mohammad" created="Sat, 16 Apr 2022 09:52:52 +0000"  >&lt;p&gt;I have checked the zk client code carefully, NPE will occur only when watcher is set null either throw ZooKeeper constructor or through register method. Now I think we should do the exactly what had been submitted in latest &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1875&quot; title=&quot;NullPointerException in ClientCnxn$EventThread.processEvent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1875&quot;&gt;ZOOKEEPER-1875&lt;/a&gt;.patch.&lt;/p&gt;</comment>
                            <comment id="17523059" author="arshad.mohammad" created="Sat, 16 Apr 2022 09:54:45 +0000"  >&lt;p&gt;When watcher is null ZooKeeper client app is anyway getting null pointer exception. &lt;br/&gt;
Now after this fix the apps will start getting IllegalArgumentException which will make it easier to figure out the wrong in the code and correct it.&lt;/p&gt;</comment>
                            <comment id="17523063" author="arshad.mohammad" created="Sat, 16 Apr 2022 10:33:13 +0000"  >&lt;p&gt;Issue resolved by pull request 1855&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1855&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1855&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17523064" author="arshad.mohammad" created="Sat, 16 Apr 2022 10:38:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;jerryhe&lt;/a&gt; for raising the issue and submitting the patches.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eolivelli&quot; class=&quot;user-hover&quot; rel=&quot;eolivelli&quot;&gt;eolivelli&lt;/a&gt; for the reviews.&lt;/p&gt;</comment>
                            <comment id="17680136" author="eolivelli" created="Tue, 24 Jan 2023 08:21:57 +0000"  >&lt;p&gt;I have reverted the patch from master, branch-3.8, branch-3.8.1 and branch-3.7.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The PR is causing regressions on third party projects, like Apache BookKeeper and Apache Pulsar.&lt;/p&gt;

&lt;p&gt;it is okay to prevent passing &quot;null&quot; to register watcher, but we should allow passing null in the constructor (we can automatically set a dummy watcher that does nothing).&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17680137" author="eolivelli" created="Tue, 24 Jan 2023 08:22:57 +0000"  >&lt;p&gt;Also, if we want to introduce this kind of changes, it is better to do it only on major releases (like 3.9.0)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13369723">NIFI-8394</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12627002" name="ZOOKEEPER-1875-trunk.patch" size="807" author="jinghe" created="Tue, 4 Feb 2014 22:44:37 +0000"/>
                            <attachment id="12648821" name="ZOOKEEPER-1875.patch" size="3610" author="rakeshr" created="Sat, 7 Jun 2014 16:09:02 +0000"/>
                            <attachment id="12648817" name="ZOOKEEPER-1875.patch" size="1351" author="rakeshr" created="Sat, 7 Jun 2014 15:41:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s02v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>