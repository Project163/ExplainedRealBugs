<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:56:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2186] QuorumCnxManager#receiveConnection may crash with random input</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2186</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;This will allocate an arbitrarily large byte buffer (and try to read it!):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; receiveConnection(Socket sock) {
        &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; sid = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
...
                sid = din.readLong();
                &lt;span class=&quot;code-comment&quot;&gt;// next comes the #bytes in the remainder of the message                                                                             
&lt;/span&gt;                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; num_remaining_bytes = din.readInt();
                &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] b = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[num_remaining_bytes];
                &lt;span class=&quot;code-comment&quot;&gt;// remove the remainder of the message from din                                                                                      
&lt;/span&gt;                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; num_read = din.read(b);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will crash the QuorumCnxManager thread, so the cluster will keep going but future elections might fail to converge (ditto for leaving/joining members). &lt;/p&gt;

&lt;p&gt;Patch coming up in a bit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828468">ZOOKEEPER-2186</key>
            <summary>QuorumCnxManager#receiveConnection may crash with random input</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgs">Ra&#250;l Guti&#233;rrez Segal&#233;s</assignee>
                                    <reporter username="rgs">Ra&#250;l Guti&#233;rrez Segal&#233;s</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 May 2015 19:36:43 +0000</created>
                <updated>Mon, 9 Apr 2018 10:11:58 +0000</updated>
                            <resolved>Sun, 24 May 2015 06:34:14 +0000</resolved>
                                    <version>3.4.6</version>
                    <version>3.5.0</version>
                                    <fixVersion>3.4.7</fixVersion>
                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="14535419" author="hdeng" created="Fri, 8 May 2015 20:19:50 +0000"  >&lt;p&gt;Good catch!&lt;br/&gt;
I will be glad to review and commit it.&lt;/p&gt;</comment>
                            <comment id="14536196" author="rgs" created="Sat, 9 May 2015 04:22:31 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14536207" author="hdeng" created="Sat, 9 May 2015 04:42:55 +0000"  >&lt;p&gt;Can you open a RB for it?&lt;/p&gt;</comment>
                            <comment id="14536226" author="hadoopqa" created="Sat, 9 May 2015 05:24:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12731682/ZOOKEEPER-2186.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12731682/ZOOKEEPER-2186.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1678032.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2682//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14536947" author="michim" created="Sat, 9 May 2015 22:59:23 +0000"  >&lt;p&gt;do we need this for 3.5.1?&lt;/p&gt;</comment>
                            <comment id="14536966" author="rgs" created="Sun, 10 May 2015 00:20:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;: yes, I&apos;d say so. &lt;/p&gt;</comment>
                            <comment id="14537018" author="michim" created="Sun, 10 May 2015 04:21:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/34023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34023&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14537035" author="michim" created="Sun, 10 May 2015 05:16:48 +0000"  >&lt;p&gt;the patch looks good to me overall. i just a couple of questions. also, it would be great if you can add a test case for this change.&lt;/p&gt;</comment>
                            <comment id="14537564" author="rgs" created="Mon, 11 May 2015 04:59:57 +0000"  >&lt;p&gt;Handle old serves (i.e.: which don&apos;t send the protocolVersion but instead just send their sid).&lt;/p&gt;
</comment>
                            <comment id="14537608" author="hadoopqa" created="Mon, 11 May 2015 05:44:40 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12731853/ZOOKEEPER-2186.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12731853/ZOOKEEPER-2186.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1678645.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2684//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14537613" author="rgs" created="Mon, 11 May 2015 05:50:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;: i think this should be much cleaner, I encapsulated the parsing code into the InitialMessage class so we can easily test that independently of QuorumCnxManager socket handling stuff (and, opening fewer sockets in our tests is usually a good thing!).&lt;/p&gt;

&lt;p&gt;I&apos;ll add the tests tomorrow.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt; since this somehow related to reconfig. &lt;/p&gt;</comment>
                            <comment id="14537663" author="hadoopqa" created="Mon, 11 May 2015 06:48:42 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12731857/ZOOKEEPER-2186.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12731857/ZOOKEEPER-2186.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1678645.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2685//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14538116" author="hdeng" created="Mon, 11 May 2015 16:25:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;&lt;br/&gt;
Can you open a RB for this?&lt;/p&gt;

&lt;p&gt;I have some questions and comments to make. Thanks!&lt;/p&gt;</comment>
                            <comment id="14538294" author="githubbot" created="Mon, 11 May 2015 17:59:34 +0000"  >&lt;p&gt;GitHub user rgs1 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/30&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2186&quot; title=&quot;QuorumCnxManager#receiveConnection may crash with random input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2186&quot;&gt;&lt;del&gt;ZOOKEEPER-2186&lt;/del&gt;&lt;/a&gt;: QuorumCnxManager#receiveConnection may crash with ran&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;dom input&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rgs1/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rgs1/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2186&quot; title=&quot;QuorumCnxManager#receiveConnection may crash with random input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2186&quot;&gt;&lt;del&gt;ZOOKEEPER-2186&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/30.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/30.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #30&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ff9cdc570fb4c84acf3c8b0c64875b5e54d82523&lt;br/&gt;
Author: Raul Gutierrez S &amp;lt;rgs@twitter.com&amp;gt;&lt;br/&gt;
Date:   2015-05-11T17:48:47Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2186&quot; title=&quot;QuorumCnxManager#receiveConnection may crash with random input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2186&quot;&gt;&lt;del&gt;ZOOKEEPER-2186&lt;/del&gt;&lt;/a&gt;: QuorumCnxManager#receiveConnection may crash with random input&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14538301" author="rgs" created="Mon, 11 May 2015 18:01:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;: git-review is broken for me today, mind reviewing in the PR:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/pull/30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/30&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;? Thanks!&lt;/p&gt;</comment>
                            <comment id="14538609" author="shralex" created="Mon, 11 May 2015 20:35:03 +0000"  >&lt;p&gt;Thanks Raul! I was indeed not very careful here. The patch looks good to me overall. &lt;br/&gt;
Consider reducing the max buffer size - b only contains a string of the form host:port, so jute.maxbuffer and 1 MB may be way too much.&lt;/p&gt;</comment>
                            <comment id="14542690" author="rgs" created="Wed, 13 May 2015 20:51:35 +0000"  >&lt;p&gt;add tests &amp;amp; fix maxBuffer constant.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14542793" author="hadoopqa" created="Wed, 13 May 2015 21:50:02 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12732673/ZOOKEEPER-2186.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12732673/ZOOKEEPER-2186.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1678645.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2693//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14542820" author="hdeng" created="Wed, 13 May 2015 22:04:07 +0000"  >&lt;p&gt;Hi Raul, sorry for nitpicking. Can you add a comment for the new Class?&lt;/p&gt;</comment>
                            <comment id="14542912" author="rgs" created="Wed, 13 May 2015 23:31:46 +0000"  >&lt;p&gt;Document what the InitialMessage is meant to do. &lt;/p&gt;</comment>
                            <comment id="14542981" author="hadoopqa" created="Thu, 14 May 2015 00:29:22 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12732708/ZOOKEEPER-2186.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12732708/ZOOKEEPER-2186.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1678645.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2694//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14542991" author="hdeng" created="Thu, 14 May 2015 00:38:57 +0000"  >&lt;p&gt;+1&lt;br/&gt;
The latest patch looks really good.&lt;br/&gt;
Thanks for the clean patch, Raul!&lt;/p&gt;</comment>
                            <comment id="14543196" author="michim" created="Thu, 14 May 2015 05:07:36 +0000"  >&lt;p&gt;+1 I&apos;m checking this in.&lt;/p&gt;</comment>
                            <comment id="14543203" author="michim" created="Thu, 14 May 2015 05:15:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; this patch does not apply to branch-3.4. Could you upload a separate patch for 3.4? Thanks!&lt;/p&gt;

&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1679313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1679313&lt;/a&gt;&lt;br/&gt;
branch-3.5: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1679314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1679314&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14543375" author="rgs" created="Thu, 14 May 2015 08:24:49 +0000"  >&lt;p&gt;Here&apos;s the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;. Note that it&apos;s much smaller because there is almost now parsing going on in 3.4 (i.e.: sending hostname:port is a 3.5/reconfig thing). &lt;/p&gt;

&lt;p&gt;Also note that boundary checks for what has to be read is a bit different too, i.e.: 0 remaining bytes is fine because old servers might not sending anything else besides there sid (afaik). &lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14543381" author="hadoopqa" created="Thu, 14 May 2015 08:31:00 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12732809/ZOOKEEPER-2186-v3.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12732809/ZOOKEEPER-2186-v3.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1679313.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2697//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2697//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14543531" author="hudson" created="Thu, 14 May 2015 11:55:01 +0000"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2691 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2691/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2691/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2186&quot; title=&quot;QuorumCnxManager#receiveConnection may crash with random input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2186&quot;&gt;&lt;del&gt;ZOOKEEPER-2186&lt;/del&gt;&lt;/a&gt; QuorumCnxManager#receiveConnection may crash with random input (rgs via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1679313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1679313&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/CnxManagerTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14557652" author="michim" created="Sun, 24 May 2015 06:32:52 +0000"  >&lt;p&gt;+1 for the 3.4 patch. Thanks Raul!&lt;/p&gt;</comment>
                            <comment id="14557654" author="michim" created="Sun, 24 May 2015 06:34:14 +0000"  >&lt;p&gt;branch-3.4: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1681417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1681417&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14577616" author="githubbot" created="Mon, 8 Jun 2015 18:34:20 +0000"  >&lt;p&gt;Github user rgs1 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/30&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15083051" author="maalto" created="Tue, 5 Jan 2016 13:31:54 +0000"  >&lt;p&gt;Any considerations regarding this patch if there is a need to add more information into the InitialMessage in future? &lt;br/&gt;
Now with the change it would fail to accept connections from members having different protocol version, and I see it will be quite difficult (or impossible) to do rolling upgrades in production systems.&lt;/p&gt;

&lt;p&gt;I&apos;m looking at submitting a feature to implement application level keep alive message on the TCP/IP connection used for Leader Election, which would require either additional information on the InitialMessage or increasing the protocol version. Currently doing either of those would break the compatibility.&lt;/p&gt;</comment>
                            <comment id="15083172" author="fpj" created="Tue, 5 Jan 2016 14:57:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maalto&quot; class=&quot;user-hover&quot; rel=&quot;maalto&quot;&gt;maalto&lt;/a&gt; as I can see in the patch, the change is supposed to be backward compatible. Why is it that you think it isn&apos;t more concretely? Perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; can shed some light here.&lt;/p&gt;</comment>
                            <comment id="15083390" author="maalto" created="Tue, 5 Jan 2016 17:19:44 +0000"  >&lt;p&gt;As I see it any member having different protocol version implementation than the existing protocol version (= -65536L) would fail to communicate with the member running this patch (older versions still allowed as the patch provides backward compatibility). This is because of the protocol version check that has been added to the parse() method of the InitialMessage class.&lt;/p&gt;

&lt;p&gt;Additionally, I think the message format for the Initial message should allow older version to skip data that the newer versions would add to the message. This would require writing the full message length after the sid field in the message. Now the parsing code assumes that the remaining data is fully used for host address and port. This is how it is now, but that assumption will make it difficult to add any new fields to the message without breaking the upgrade path.&lt;/p&gt;

&lt;p&gt;I hope this explanation clarified my concerns.&lt;/p&gt;
</comment>
                            <comment id="15083614" author="geek101" created="Tue, 5 Jan 2016 19:29:03 +0000"  >&lt;p&gt;I agree with Markus here, I noticed this issue but assumed that there is no expectation perhaps to add to the HDR anymore with respect to this protocol version -65536L . Otherwise its best to do the following as Markus requested.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dout.writeLong(PROTOCOL_VERSION);

&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; addr = self.getElectionAddress().getHostString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + self.getElectionAddress().getPort();
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] addr_bytes = addr.getBytes();

&lt;span class=&quot;code-comment&quot;&gt;// After version write the total length of msg sent by sender.
&lt;/span&gt;dout.writeInt(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.BYTES + addr_bytes.length);   
&lt;span class=&quot;code-comment&quot;&gt;// Write sid afterwards
&lt;/span&gt;dout.writeLong(self.getId());
&lt;span class=&quot;code-comment&quot;&gt;// Write length of host/port string                                   
&lt;/span&gt;dout.writeInt(addr_bytes.length);
&lt;span class=&quot;code-comment&quot;&gt;// Write host/port string                       
&lt;/span&gt;dout.write(addr_bytes);                                           
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This helps older revisions to ignore msg past host/port since it will read only what it understands and discard rest of the bytes.&lt;/p&gt;

&lt;p&gt;I have another proposal:&lt;br/&gt;
Once the RX side when a compatible peer sees new protocol version i.e -65536L it could reply with -65536L too (this wont happen with older peer since it will send notification with state, which cannot be -65536L) and both of them could negotiate in protobufs,  and this once and for all solving this issue.&lt;/p&gt;

&lt;p&gt;Also I prefer both channels be symmetric with respect to header negotiation just like the data exchange which makes implementation of channels much easier.&lt;/p&gt;

&lt;p&gt;I am not quite sure if this can be done now that 3.5.1 is out there and Protocol version bump happened sometime ago in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1633&quot; title=&quot;Introduce a protocol version to connection initiation message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1633&quot;&gt;&lt;del&gt;ZOOKEEPER-1633&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15083655" author="geek101" created="Tue, 5 Jan 2016 19:47:53 +0000"  >&lt;p&gt;Markus I have come across the same issue and decided to implement this by sending the same notification. I am working on this as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-901&quot; title=&quot;Redesign of QuorumCnxManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-901&quot;&gt;ZOOKEEPER-901&lt;/a&gt;, refer some of the discussions about this here &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1045&quot; title=&quot;Support Quorum Peer mutual authentication via SASL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1045&quot;&gt;&lt;del&gt;ZOOKEEPER-1045&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Let me know what you think about this idea?. I think this has the potential to solve the user level keep-alive implementation without the need to send new bits in hdr and/or the to introduce a new message for keep-alive.&lt;/p&gt;

&lt;p&gt;However this breaks the current FLE due to this code: &lt;a href=&quot;http://bit.ly/1PdWY1D&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bit.ly/1PdWY1D&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;FastLeaderElection.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// Verify &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there is any change in the proposed leader
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;((n = recvqueue.poll(finalizeWait,
                  TimeUnit.MILLISECONDS)) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(totalOrderPredicate(n.leader, n.zxid, n.peerEpoch,
                     proposedLeader, proposedZxid, proposedEpoch)){
        recvqueue.put(n);
        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this while loop is in error, if I am not mistaken, it should use a global clock limit how long to poll for rather than hoping no one is going send any messages with-in the finalizeWait time window. I am hoping to negotiate for a change here if the submitted patch is found to be reasonable. &lt;/p&gt;</comment>
                            <comment id="15089067" author="maalto" created="Fri, 8 Jan 2016 11:04:04 +0000"  >&lt;p&gt;I think this was one of the reasons I did my implementation directly in the QuorumCnxManager within the SendWorker and RecvWorker threads directly writing/reading from the stream. This made it totally invisible for the FastLeaderElection algorithm, as Notification was just one of the message types in the connection level as soon as the initial handshake was completed, and keep-alive was managed by inside the QuorumCnxManager (as I think it should be). Unfortunately due to the issues in the handshake not supporting upgrades I got stuck on finding a good way to get the change in.&lt;/p&gt;</comment>
                            <comment id="15089120" author="maalto" created="Fri, 8 Jan 2016 12:11:00 +0000"  >&lt;p&gt;I think this might work, but I think it would still require change to allow different protocol version message to be accepted and skipped properly. With that change the the newer protocol version member could adapt to older version easily. &lt;/p&gt;

&lt;p&gt;Regarding &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-901&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-901&lt;/a&gt; I&apos;m not seeing immediately how it will fix the issue unless proper keep-alive is implemented for both directions. We have been hitting some cases in our prod environment where one direction of the TCP/IP connection is working, but other is not working. This causes whole ZK cluster to fail when leader election starts. So the keep-alive would need to be monitored for both directions.&lt;/p&gt;</comment>
                            <comment id="15089635" author="geek101" created="Fri, 8 Jan 2016 18:18:15 +0000"  >&lt;p&gt;Which version of ZK do you work with?. Did you take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2246&quot; title=&quot;quorum connection manager takes a long time to shut down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2246&quot;&gt;ZOOKEEPER-2246&lt;/a&gt;. We had exactly the same issue and my least risky proposal fix was to use ZK with TCP keep-alive enabled for FLE sockets. Let me know if that could work for you?.&lt;/p&gt;</comment>
                            <comment id="15090660" author="fpj" created="Sat, 9 Jan 2016 15:29:36 +0000"  >&lt;p&gt;I&apos;m still waiting for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt; to give his opinion on this one, but given that this change is out in both 3.4.7 and and 3.5.1, I&apos;d rather have this discussed in a separate jira. Could you one of you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=geek101&quot; class=&quot;user-hover&quot; rel=&quot;geek101&quot;&gt;geek101&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maalto&quot; class=&quot;user-hover&quot; rel=&quot;maalto&quot;&gt;maalto&lt;/a&gt; please start another jira? &lt;/p&gt;

&lt;p&gt;If this issue really breaks compatibility, then it needs to be a blocker.&lt;/p&gt;</comment>
                            <comment id="15091128" author="rakeshr" created="Sun, 10 Jan 2016 17:52:11 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maalto&quot; class=&quot;user-hover&quot; rel=&quot;maalto&quot;&gt;maalto&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=geek101&quot; class=&quot;user-hover&quot; rel=&quot;geek101&quot;&gt;geek101&lt;/a&gt; for the discussions.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Any considerations regarding this patch if there is a need to add more information into the InitialMessage in future? &lt;br/&gt;
Now with the change it would fail to accept connections from members having different protocol version, and I see it will be quite difficult (or impossible) to do rolling upgrades in production systems.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To understand more, I hope you referring to the following logic in the trunk &amp;amp; 3.5 branch. Is there any thing to be addressed in 3.4 branch code?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (protocolVersion != PROTOCOL_VERSION) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InitialMessageException(
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;Got unrecognized protocol version %s&quot;&lt;/span&gt;, protocolVersion);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Markus I have come across the same issue and decided to implement this by sending the same notification. I am working on this as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-901&quot; title=&quot;Redesign of QuorumCnxManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-901&quot;&gt;ZOOKEEPER-901&lt;/a&gt;, refer some of the discussions about this here &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1045&quot; title=&quot;Support Quorum Peer mutual authentication via SASL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1045&quot;&gt;&lt;del&gt;ZOOKEEPER-1045&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=geek101&quot; class=&quot;user-hover&quot; rel=&quot;geek101&quot;&gt;geek101&lt;/a&gt; Do you have specific comments about &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1045&quot; title=&quot;Support Quorum Peer mutual authentication via SASL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1045&quot;&gt;&lt;del&gt;ZOOKEEPER-1045&lt;/del&gt;&lt;/a&gt; jira implementation?&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1045&quot; title=&quot;Support Quorum Peer mutual authentication via SASL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1045&quot;&gt;&lt;del&gt;ZOOKEEPER-1045&lt;/del&gt;&lt;/a&gt; jira I&apos;m thinking of a logic based on PROTOCOL_VERSION. I&apos;ve referred &lt;tt&gt;3.4 branch&lt;/tt&gt; code base, here I failed to see any validation logic against the PROTOCOL_VERSION. Till now old servers are not sending any PROTOCOL_VERSION but instead just send their sid. So I think I can safely write an upgradation steps from &lt;tt&gt;3.4.x&lt;/tt&gt; version to &lt;tt&gt;3.4.y&lt;/tt&gt; version, right? If anybody is interested to know my upgradation proposal in ZK-1045 please refer &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12780771/ZOOKEEPER-1045-Rolling%20Upgrade%20Design%20Proposal.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12780771/ZOOKEEPER-1045-Rolling%20Upgrade%20Design%20Proposal.pdf&lt;/a&gt; and welcome any comments/questions.&lt;/p&gt;</comment>
                            <comment id="15092564" author="geek101" created="Mon, 11 Jan 2016 19:54:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2353&quot; title=&quot;QuorumCnxManager protocol needs to be upgradable with-in a specific Version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2353&quot;&gt;ZOOKEEPER-2353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15093703" author="maalto" created="Tue, 12 Jan 2016 10:36:09 +0000"  >&lt;p&gt;We are using 3.4.6. The proposed patch looks as it might work for us. Although it would requires changing OS keep alive options. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                                                <inwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13149663">ZOOKEEPER-3016</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12732809" name="ZOOKEEPER-2186-v3.4.patch" size="2406" author="rgs" created="Thu, 14 May 2015 08:24:49 +0000"/>
                            <attachment id="12732708" name="ZOOKEEPER-2186.patch" size="12811" author="rgs" created="Wed, 13 May 2015 23:31:46 +0000"/>
                            <attachment id="12732673" name="ZOOKEEPER-2186.patch" size="12688" author="rgs" created="Wed, 13 May 2015 20:51:35 +0000"/>
                            <attachment id="12731857" name="ZOOKEEPER-2186.patch" size="8731" author="rgs" created="Mon, 11 May 2015 05:50:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ehxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>