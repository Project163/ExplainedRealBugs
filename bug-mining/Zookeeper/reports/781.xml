<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:58:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2014] Only admin should be allowed to reconfig a cluster</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2014</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; introduces reconfiguration support via the reconfig() call. We should, at the very least, ensure that only the Admin can reconfigure a cluster. Perhaps restricting access to /zookeeper/config as well, though this is debatable. Surely one could ensure Admin only access via an ACL, but that would leave everyone who doesn&apos;t use ACLs unprotected. We could also force a default ACL to make it a bit more consistent (maybe).&lt;/p&gt;

&lt;p&gt;Finally, making reconfig() only available to Admins means they have to run with zookeeper.DigestAuthenticationProvider.superDigest (which I am not sure if everyone does, or how would it work with other authentication providers). &lt;/p&gt;

&lt;p&gt;Review board &lt;a href=&quot;https://reviews.apache.org/r/51546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/51546/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12735645">ZOOKEEPER-2014</key>
            <summary>Only admin should be allowed to reconfig a cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hanm">Michael Han</assignee>
                                    <reporter username="rgs">Ra&#250;l Guti&#233;rrez Segal&#233;s</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Aug 2014 02:57:37 +0000</created>
                <updated>Thu, 18 May 2017 03:44:01 +0000</updated>
                            <resolved>Sun, 13 Nov 2016 20:10:56 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.3</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                                                                                <comments>
                            <comment id="14105013" author="rgs" created="Thu, 21 Aug 2014 04:10:37 +0000"  >&lt;p&gt;this is RFC and very basic.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;hdeng&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14105040" author="hdeng" created="Thu, 21 Aug 2014 04:56:46 +0000"  >&lt;blockquote&gt;
&lt;p&gt; ensure that only the Admin can reconfigure a cluster.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This change will reduce much flexibility in reconfig.&lt;br/&gt;
A counter scenario would be I have a process that detects &quot;permanent&quot; failed ZK servers and removes them to make a smaller quorum (better fault tolerance). Does the process have to be Admin? Or would a default ACL be a better option here?&lt;/p&gt;</comment>
                            <comment id="14105041" author="shralex" created="Thu, 21 Aug 2014 04:56:58 +0000"  >&lt;p&gt;Thanks for starting this thread, Raul. I&apos;m not sure what&apos;s the right way to handle the issue, but just wanted to mention a couple of things.&lt;/p&gt;

&lt;p&gt;1. Regarding access to /zookeeper/config - clients may need read access for example in order to run the new client-side load balancing functionality, they need to detect a config change and get a new connection string. They can use getConfig for this. It is probably a good idea to restrict access for writes. Writing it probably won&apos;t break the system but may cause all clients to migrate to any server I choose to mention there, if clients are using the client-side load balancing algorithm.&lt;/p&gt;

&lt;p&gt;2. Notice that when the leader processes reconfig in PrepRequestProcessor it already checks ACL:&lt;/p&gt;

&lt;p&gt;               nodeRecord = getRecordForPath(ZooDefs.CONFIG_NODE);               &lt;br/&gt;
               checkACL(zks, nodeRecord.acl, ZooDefs.Perms.WRITE, request.authInfo);                  &lt;/p&gt;</comment>
                            <comment id="14105042" author="shralex" created="Thu, 21 Aug 2014 05:00:29 +0000"  >&lt;p&gt;Actually perhaps we should open a JIRA to hide the client-side rebalancing from clients (not for 3.5.0). We may want to implement it inside the client-side library somehow and just let the client specify whether this is enabled or disabled when creating a ZK handle. What do you think ? &lt;/p&gt;</comment>
                            <comment id="14105052" author="shralex" created="Thu, 21 Aug 2014 05:13:49 +0000"  >&lt;p&gt;+&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14106404" author="shralex" created="Fri, 22 Aug 2014 03:24:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, should this be similar to how updating the quota znode works ? or do you think changing configuration is different ?&lt;/p&gt;</comment>
                            <comment id="14106503" author="rgs" created="Fri, 22 Aug 2014 05:51:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;: well, quotas rely on ACLs. But, quotas are (currently) advisory only (i.e.: we don&apos;t reject traffic) so no damage can be done by non-admins. So I think we need a stricter enforcement here, no?&lt;/p&gt;</comment>
                            <comment id="14106504" author="rgs" created="Fri, 22 Aug 2014 05:52:05 +0000"  >&lt;p&gt;(by which I mean, you can really bring a cluster down with this).&lt;/p&gt;</comment>
                            <comment id="14107813" author="phunt" created="Sat, 23 Aug 2014 02:35:09 +0000"  >&lt;p&gt;Yes, this is a concern for me as well.&lt;/p&gt;

&lt;p&gt;1) mixing the client api and the admin api is not great. It would be better to have them separate. We should fix this asap.&lt;/p&gt;

&lt;p&gt;2) this (controlling access to reconfig) is a big issue from a security perspective IMO.&lt;/p&gt;

&lt;p&gt;A few comments on the comments so far:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;ensure that only the Admin can reconfigure a cluster&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;sounds sensible to me&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Perhaps restricting access to /zookeeper/config as well&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;in the past we&apos;ve (ben in particular) tried to limit the amount of information we provide to the client/session. For example we don&apos;t tell them which server they are connected to. I see this in the same vein.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;one could ensure Admin only access via an ACL, but that would leave everyone who doesn&apos;t use ACLs unprotected.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;well, you&apos;re already unprotected in this situation so I don&apos;t really see it as a sticking point.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;clients may need read access for example in order to run the new client-side load balancing functionality&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;perhaps this argues for pushing this to the the server? encapsulate the information on the service I mean and expose as a specific api.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Actually perhaps we should open a JIRA to hide the client-side rebalancing from clients (not for 3.5.0). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes, that&apos;s what I was trying to get at in the previous item in this comment. Although I think we&apos;d need to fix this now - while we can still change the apis w/o worrying about b/w compat (we can change new apis during the alpha period w/o worrying about back compat)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;should this be similar to how updating the quota znode works ? or do you think changing configuration is different ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;if quotas are &quot;admin&quot; functions we probably need to fix those as well - lock them down to just admin level authz I mean.&lt;/p&gt;</comment>
                            <comment id="14107837" author="shralex" created="Sat, 23 Aug 2014 04:00:50 +0000"  >&lt;p&gt;Everything you guys are saying about admin-only controls sounds very reasonable. I just want to clarify about the special reconfig znode. IMHO we should not allow write permissions to this node. I don&apos;t even see why an admin should have it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; its set only through the reconfig API. &lt;/p&gt;

&lt;p&gt;I do think that all clients should have read permissions, and here&apos;s why - the information they get from this znode is the up-to-date connection string. When the configuration changes this is the bare minimum they need in order not to loose track of the system. When their server crashes they need to know whom to connect to next. The new connection string is exactly the information we exploit for rebalancing. It is even implemented inside the updateServerList method, which is also needed in any case. &lt;/p&gt;

&lt;p&gt;Regarding my suggestion - Hongchao opened a JIRA for it and you can read the discussion there &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-2016&lt;/a&gt;&lt;br/&gt;
Please especially see Marshall&apos;s comment.&lt;br/&gt;
All I&apos;m proposing there is to implement some default behaviour that will save most clients from setting a watch and invoking updateServerList - I suggest that the client-side-library does it for them if they opt-in for the default behaviour. It doesn&apos;t change APIs, just adds one more feature, so it doesn&apos;t delay 3.5.0.&lt;/p&gt;




</comment>
                            <comment id="15198757" author="shralex" created="Thu, 17 Mar 2016 05:14:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, does your patch solve the issue ? if not, what is still missing ? If I remember correctly my concern was that I&apos;d like getConfig to be available to regular clients, not only admin, so they can react to configuration changes.&lt;/p&gt;

&lt;p&gt;If this JIRA is what&apos;s blocking 3.5 perhaps we could reconsider the approach and go with something&lt;br/&gt;
simpler to start with, such as relying on ACLs. Or setting default ACLs for the config znode and requiring&lt;br/&gt;
client admins to have these permissions.&lt;/p&gt;</comment>
                            <comment id="15198842" author="phunt" created="Thu, 17 Mar 2016 06:39:31 +0000"  >&lt;p&gt;We can&apos;t (or at least promise we won&apos;t) change the api in a non b/w compatible way once it&apos;s post-alpha. As such I believe at a minimum we need to clean up the API (should be simple - move it out of ZooKeeper class) and ensure there are no security issues.&lt;/p&gt;</comment>
                            <comment id="15384994" author="hanm" created="Tue, 19 Jul 2016 22:33:27 +0000"  >&lt;p&gt;Had an offline discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; yesterday regarding this issue, the conversation is captured as following points (with some of my thoughts as well):&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;We can&apos;t fix security issue unless we enforce authentication and authorization. Just by moving client APIs around is not enough because at protocol level the server still open to reconfiguration and someone can exploit this easily (by writing their own ZK client instead of using ZooKeeper client for example.).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;That said though, the ZooKeeper::reconfig API should be moved out of ZooKeeper class (for Java client) anyway, because it&apos;s more about an admin feature rather than a client API. Moving reconfig out of ZooKeeper will also remove constraints we possibly put on normal ZooKeeper clients (such as having to use zookeeper.DigestAuthenticationProvider.superDigest), which is a bonus. Due to API backward compatibility concerns, this refactoring should happen before we move to beta.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;We&apos;d like to introduce a new configuration option in zoo.cfg to turn off reconfig feature by default. ZK users who needs use this feature need turn it on explicitly. Because dynamic reconfig feature brings something new (e.g. cfg.dynamic file), have this feature off is good for &apos;the principal of least surprise&apos;. Having the feature off by default will also buy us sometime to fortify and stabilize the feature without having it being a blocker issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The action items / plans I am thinking in the time frame of 3.5.3:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fix Security:
	&lt;ul&gt;
		&lt;li&gt;Enforce an ACL on /zookeeper/config, such that only users that have write permission to it can reconfig the cluster. /zookeeper/config is by default readable to anyone so zookeeper (none-admin) clients can load balancing on client side either manually (current behavior) or automatically (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2016&quot; title=&quot;Automate client-side rebalancing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2016&quot;&gt;ZOOKEEPER-2016&lt;/a&gt;).&lt;/li&gt;
		&lt;li&gt;ZooKeeper users are responsible for properly configure the ACL such that only a limited set of admin users are part of the ACL with write access. The authentication of these users will be delegated to existing mechanisms ZooKeeper already supports, such as SASL client login, so not much work here except documentation on such a requirement to use reconfig feature.&lt;/li&gt;
		&lt;li&gt;The default behavior is such that if /zookeeper/config node has no associated ACLs, then no one is allowed write access except super user.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Fix API:
	&lt;ul&gt;
		&lt;li&gt;For Java client, create a new class ZooKeeperAdmin that inherits ZooKeeper class and move reconfig API into ZooKeeperAdmin class.&lt;/li&gt;
		&lt;li&gt;For C client, there is no namespace and the existing zhandle is coupled with reconfig state so it is not as simple as Java client to isolate admin part of the API from rest of APIs. Working on a proposal.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Introduce a new zoo.cfg option to switch reconfiguration feature on or off. The new configuration option will be set as &apos;disable reconfig&apos; by default when 3.5.3 shipped, and user who wants reconfig has to enable reconfig option explicitly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Are these good enough for now to address all security concerns or we still miss something?&lt;br/&gt;
Comments?&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15432063" author="shralex" created="Tue, 23 Aug 2016 03:20:21 +0000"  >&lt;p&gt;Hi Michael, all of this sounds good to me except for moving getConfig to ZooKeeperAdmin. I&apos;ve explained why several times in the thread above (search for &quot;getconfig&quot;), please let me know if you disagree.&lt;/p&gt;</comment>
                            <comment id="15432119" author="hanm" created="Tue, 23 Aug 2016 04:29:19 +0000"  >&lt;p&gt;Thanks for your feedback Alex. I agree about getConfig API remaining as part of ZooKeeper because we don&apos;t transparently handle load balancing for clients. I had that in my first version of proposal but I forgot to keep it when update the proposal.&lt;/p&gt;

&lt;p&gt;A side question, I think this (handle load balancing when server changes) is the only use case for getConfig API right? Basically:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Client sets a watcher when calling getConfig.&lt;/li&gt;
	&lt;li&gt;The callback of the watcher invokes updateServerList.&lt;/li&gt;
	&lt;li&gt;When servers are reconfigured, watcher gets triggered and updateServerList gets invoked, which would do load balancing for clients.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15432124" author="shralex" created="Tue, 23 Aug 2016 04:39:20 +0000"  >&lt;p&gt;I think that the general idea is that clients should be able to track the latest configuration and do something when it changes. For example if the server to which the client is connected goes away, it should have a way to query the system for the new list of servers and connect to one of them. The method you described is one option, outlined in the reconfig manual (right at the end there&apos;s some code for this). &lt;/p&gt;

&lt;p&gt;It would be nice to automate these steps for the user and to support a user defined policy instead of these steps (see some ideas in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2016&quot; title=&quot;Automate client-side rebalancing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2016&quot;&gt;ZOOKEEPER-2016&lt;/a&gt;). For example, if you want the user to only connect to near-by servers, you&apos;d need to filter the new list of servers before calling updateServerList. This can be done as part of a user-supplied policy.&lt;/p&gt;</comment>
                            <comment id="15439681" author="hanm" created="Fri, 26 Aug 2016 19:48:43 +0000"  >&lt;p&gt;First stab on implementing basics outlined in the design. Patch is not ready (pending docs update, more tests, and C client work), upload here for preview and feedback only. &lt;/p&gt;</comment>
                            <comment id="15450110" author="hanm" created="Tue, 30 Aug 2016 20:47:41 +0000"  >&lt;p&gt;Fixed C client unit tests, added more documentation regarding API changes, new configuration option, and ACLs around config znode. Added more Java tests. Patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="15450116" author="hadoopqa" created="Tue, 30 Aug 2016 20:49:39 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12826240/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12826240/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1757584.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 37 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3376//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3376//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15450126" author="hanm" created="Tue, 30 Aug 2016 20:54:07 +0000"  >&lt;p&gt;build bot complains, cancel to investigate..&lt;/p&gt;</comment>
                            <comment id="15450446" author="hadoopqa" created="Tue, 30 Aug 2016 23:18:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12826264/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12826264/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1757584.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 37 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3377//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15450515" author="hanm" created="Tue, 30 Aug 2016 23:50:00 +0000"  >&lt;p&gt;For reviewers: &lt;a href=&quot;https://reviews.apache.org/r/51546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/51546/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15455908" author="hanm" created="Thu, 1 Sep 2016 16:23:47 +0000"  >&lt;p&gt;Fix find bug warnings.&lt;/p&gt;</comment>
                            <comment id="15455970" author="hadoopqa" created="Thu, 1 Sep 2016 16:47:52 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12826655/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12826655/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1757584.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 37 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3378//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15507418" author="hanm" created="Tue, 20 Sep 2016 18:48:58 +0000"  >&lt;p&gt;Nudge nudge - anyone has cycles to take a look at the patch and provide feedback?&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;shralex&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15509210" author="fpj" created="Wed, 21 Sep 2016 08:33:00 +0000"  >&lt;p&gt;I&apos;ll get to it before the end of this week, this is really important for the progress of the 3.5 branch.&lt;/p&gt;</comment>
                            <comment id="15524410" author="hanm" created="Mon, 26 Sep 2016 22:45:02 +0000"  >&lt;p&gt;Update patch to address review comments. Major changes comparing to previous version patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Warn user when skipACL is set and reconfig is performed.&lt;/li&gt;
	&lt;li&gt;New keeper exception that represents the error user got when doing reconfig but with reconfig feature disabled.&lt;/li&gt;
	&lt;li&gt;ZooKeeperAdmin moved to admin package.&lt;/li&gt;
	&lt;li&gt;Doc updates.&lt;/li&gt;
	&lt;li&gt;Misc updates (rename method in java way, remove tabs, etc.).&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15524413" author="hanm" created="Mon, 26 Sep 2016 22:46:37 +0000"  >&lt;p&gt;Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; for your review comments. Just upload a new patch that address all of your review comments (minors the C client ones). The remaining work is on C client side where I plan to add more tests as Java side, which will be done in next few days and then I will upload final patch for review.&lt;/p&gt;</comment>
                            <comment id="15527075" author="rakeshr" created="Tue, 27 Sep 2016 18:47:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; for working on this. I&apos;ve added few comments in RB, please take a look at it.&lt;/p&gt;</comment>
                            <comment id="15527643" author="hanm" created="Tue, 27 Sep 2016 22:38:08 +0000"  >&lt;p&gt;Fixed a couple of things pointed out by Rakesh (C client work is still WIP, not included here.).&lt;/p&gt;</comment>
                            <comment id="15528898" author="fpj" created="Wed, 28 Sep 2016 08:33:32 +0000"  >&lt;p&gt;I&apos;ll wait until you have the C client changes to make another pass, unless you need feedback on some specific parts to make progress. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15531249" author="hanm" created="Wed, 28 Sep 2016 23:38:32 +0000"  >&lt;p&gt;Update patch to include C client work:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed skipACL, set up servers with super user digest auth like Java tests did.&lt;/li&gt;
	&lt;li&gt;Updated C client tests, add one specific test case to cover various reconfig failure cases caused by failure of auth.&lt;/li&gt;
	&lt;li&gt;Misc update for first review feedback related to method signature and so on.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15531257" author="hanm" created="Wed, 28 Sep 2016 23:41:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: Sounds good - actually just updated patch that incorporates some C side changes. PTAL when you have a chance, thanks a lot!&lt;/p&gt;</comment>
                            <comment id="15531402" author="hadoopqa" created="Thu, 29 Sep 2016 00:48:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12830808/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12830808/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision ec20c5434cc8a334b3fd25e27d26dccf4793c8f3.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 40 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3458//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15531585" author="hadoopqa" created="Thu, 29 Sep 2016 02:34:11 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12830832/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12830832/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision ec20c5434cc8a334b3fd25e27d26dccf4793c8f3.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 40 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3459//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15543794" author="hanm" created="Mon, 3 Oct 2016 23:49:23 +0000"  >&lt;p&gt;Update patch that fixes a couple of places pointed by Flavio in review board.&lt;/p&gt;</comment>
                            <comment id="15543981" author="hadoopqa" created="Tue, 4 Oct 2016 01:16:18 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12831433/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12831433/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision ec20c5434cc8a334b3fd25e27d26dccf4793c8f3.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 42 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3462//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15558081" author="fpj" created="Sat, 8 Oct 2016 14:36:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; One of the tests that failed in the QA run is modified in the patch: &lt;tt&gt;testQuorumSystemChange&lt;/tt&gt;. Could you have a look, please?&lt;/p&gt;</comment>
                            <comment id="15558418" author="hanm" created="Sat, 8 Oct 2016 17:51:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;: This is a flaky test, and it happened before this patch with exact same error message in Apache builds and precommit build. I did a search over my email archive and found a couple of instances (e.g. ZooKeeper_branch35_openjdk7 - Build # 159). I&apos;ll create a separate JIRA and put it under &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2135&quot; title=&quot;fix trunk build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2135&quot;&gt;ZOOKEEPER-2135&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;On a side note, I have an internal Jenkins job that set up and stress test my patch branch of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;. There is no test failure except the one that&apos;s already tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2080&quot; title=&quot;Fix deadlock in dynamic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2080&quot;&gt;&lt;del&gt;ZOOKEEPER-2080&lt;/del&gt;&lt;/a&gt;. So this flaky testQuorumSystemChange one might also hard to reproduce.&lt;/p&gt;</comment>
                            <comment id="15561850" author="fpj" created="Mon, 10 Oct 2016 09:59:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; I&apos;m probably missing something obvious, but when I try to reconfigure, I get an auth failure, but I think I&apos;m setting up everything right. This is the output of ZooKeeperMain plus my commands:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Connecting to localhost:2181
log4j:WARN No appenders could be found for logger (org.apache.zookeeper.ZooKeeper).
log4j:WARN Please initialize the log4j system properly.
log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.
Welcome to ZooKeeper!
JLine support is disabled

WATCHER::

WATCHER::

WatchedEvent state:SyncConnected type:None path:null

WatchedEvent state:SyncConnected type:None path:null
addauth digest super:test
getAcl /zookeeper/config
&apos;digest,&apos;super:D/InIHSb7yEEbrWz8b9l71RjZJU=
: a
reconfig -add server.5=127.0.0.1:1234:1235;1236
Authentication is not valid : 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have &lt;tt&gt;reconfigEnabled=true&lt;/tt&gt; in the configuration of the servers.&lt;/p&gt;</comment>
                            <comment id="15563598" author="hanm" created="Mon, 10 Oct 2016 21:38:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; It&apos;s a bug, thanks for pointing it out! When we do reconfigure through command line, the &lt;tt&gt;addauth&lt;/tt&gt; command will set the auth packet for the connection associated with the &lt;tt&gt;ZooKeeper&lt;/tt&gt; object of the &lt;tt&gt;CliCommand&lt;/tt&gt;. The reconfig command however is going to be executed by the &lt;tt&gt;ZooKeeperAdmin&lt;/tt&gt; object of the &lt;tt&gt;CliCommand&lt;/tt&gt;, and because addauth currently does not associate the auth packet to the underlying connection managed by &lt;tt&gt;ZooKeeperAdmin&lt;/tt&gt;, when reconfig request hits server it will miss auth info, thus yield auth failure. The fix is to teach &lt;tt&gt;AddAuthCommand&lt;/tt&gt; to set auth packet for &lt;tt&gt;ZooKeeperAdmin&lt;/tt&gt; as well.&lt;/p&gt;

&lt;p&gt;As we previously discussed in review board, an alternative is to have a single ZooKeeper object (since ZooKeeperAdmin is also a ZooKeeper) maintained in &lt;tt&gt;CliCommand&lt;/tt&gt; so every command / request will converge to a single path. I did not do that for stability purposes - with a separate ZooKeeperAdmin object all existing commands (except reconfig) should not be impacted at all. I might be over cautious on this one though and maintaining a single ZK object inside CliCommand might be a better solution overall. Please let me know if you prefer one over the other.&lt;/p&gt;

&lt;p&gt;Attaching updated patch (with one line change) that fixes the issue. Verified with zkCli.sh / reconfig command on a local 3 server cluster.&lt;/p&gt;</comment>
                            <comment id="15563602" author="hanm" created="Mon, 10 Oct 2016 21:39:35 +0000"  >&lt;p&gt;Trivial update that fixes an important bug pointed out by Flavio (reconfig failed with NoAuth via zkCli.sh).&lt;/p&gt;</comment>
                            <comment id="15563874" author="hadoopqa" created="Mon, 10 Oct 2016 23:23:19 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12832546/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12832546/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision f78061aafb19b102c37cb6d744ec6258d5f5b66e.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 42 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3480//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15565322" author="fpj" created="Tue, 11 Oct 2016 12:45:55 +0000"  >&lt;p&gt;Thanks for fixing it. I see the point of stability, but I don&apos;t think it is much of a concern in this case. You&apos;re just building on top of the ZooKeeper, you won&apos;t be re-wiring the existing ZooKeeper client code, I think. If I&apos;m right, then it is better to have a single connection to the service rather than two, one for the ZooKeeper object and another for ZooKeeperAdmin. In any case, it might be worth giving it a shot to get a sense of whether it&apos;d cause trouble.&lt;/p&gt;</comment>
                            <comment id="15565419" author="fpj" created="Tue, 11 Oct 2016 13:35:25 +0000"  >&lt;p&gt;I checked that it works for me when reconfig is enabled. I have a couple of other things I wanted to raise:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;When I tried with reconfig disabled, I got this message:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;reconfig -add server.5=127.0.0.1:1234:1235;1236
KeeperErrorCode = Reconfig is disabled for
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And it should be only &lt;tt&gt;Reconfig disabled&lt;/tt&gt;, unless we want to convey some other information.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;I have also verified that to get the reconfig command to go through we only need the leader to have &lt;tt&gt;reconfigEnabled = true&lt;/tt&gt;. There is no way around it unless the replicas coordinate to use the same value. We need it well documented, though.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15566674" author="hanm" created="Tue, 11 Oct 2016 21:28:29 +0000"  >&lt;p&gt;Yes keeping a single connection is right thing to do. Patch on the way.&lt;/p&gt;</comment>
                            <comment id="15566681" author="hanm" created="Tue, 11 Oct 2016 21:31:01 +0000"  >&lt;p&gt;Patch updates:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Consolidate ZooKeeper and ZooKeeperAdmin object usage in CliCommand stack.&lt;/li&gt;
	&lt;li&gt;Fix confusing KeeperException error message when path is set as empty.&lt;/li&gt;
	&lt;li&gt;More documentation on having a consistent setting for the reconfigEnabled option across ensemble.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15566745" author="hadoopqa" created="Tue, 11 Oct 2016 22:00:07 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12832770/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12832770/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision f78061aafb19b102c37cb6d744ec6258d5f5b66e.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 45 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3481//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15566824" author="hanm" created="Tue, 11 Oct 2016 22:33:08 +0000"  >&lt;p&gt;Fix findbug warnings.&lt;/p&gt;</comment>
                            <comment id="15566907" author="hadoopqa" created="Tue, 11 Oct 2016 23:07:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12832782/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12832782/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision f78061aafb19b102c37cb6d744ec6258d5f5b66e.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 45 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3483//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15566912" author="hanm" created="Tue, 11 Oct 2016 23:09:23 +0000"  >&lt;p&gt;Failed tests are known flaky..&lt;/p&gt;</comment>
                            <comment id="15581886" author="fpj" created="Mon, 17 Oct 2016 10:54:32 +0000"  >&lt;p&gt;Thanks for the updates, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;. I want to do a few manual checks, but otherwise, the changes look good. I encourage others to have a look as well before we check it in.&lt;/p&gt;</comment>
                            <comment id="15584491" author="hanm" created="Tue, 18 Oct 2016 05:14:33 +0000"  >&lt;p&gt;Upload new patch to address Abe&apos;s review comments. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Don&apos;t swallow the KeeperException when setting ACL on the config node during DataTree creation, instead let the exception bubble up to stop ZK server startup. This is to make sure we always have access controlled config node after ZK server is started.&lt;/li&gt;
	&lt;li&gt;The rest of changes are really mechanical changes due to the exception specification changes in signature.&lt;/li&gt;
	&lt;li&gt;Passed internal stress test of all unit tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15584609" author="hadoopqa" created="Tue, 18 Oct 2016 06:23:29 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12833880/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12833880/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision cef5978969bedfe066f903834a9ea4af6d508844.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 96 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3493//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15612555" author="githubbot" created="Thu, 27 Oct 2016 17:22:06 +0000"  >&lt;p&gt;GitHub user hanm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: Only admin should be allowed to reconfig a cluster.&lt;/p&gt;

&lt;p&gt;    This PR implements &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;. For details, please refer to&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Previous review board: &lt;a href=&quot;https://reviews.apache.org/r/51546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/51546/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hanm/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hanm/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/94.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/94.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #94&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 616e1275ac38890c2bf1e3ac27465172cf1c52d5&lt;br/&gt;
Author: Michael Han &amp;lt;hanm@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2016-10-27T16:16:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: Only admin should be allowed to reconfig a cluster.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15620024" author="githubbot" created="Sun, 30 Oct 2016 14:26:40 +0000"  >&lt;p&gt;Github user fpj commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @hanm since there is no comment, would you mind closing this PR and resubmitting it to see if QA picks it up?&lt;/p&gt;</comment>
                            <comment id="15620175" author="rakeshr" created="Sun, 30 Oct 2016 16:20:27 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; for the continuous effort. Sorry for the delay in reviews. I&apos;ve looked at the latest patch and added few minor comments in the RB. &lt;/p&gt;

&lt;p&gt;+1 from me after addressing these comments.&lt;/p&gt;</comment>
                            <comment id="15621145" author="githubbot" created="Mon, 31 Oct 2016 03:59:45 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fpj Sure, closing and resubmitting with a new one that also addressing Rakesh&apos;s comments today.&lt;/p&gt;</comment>
                            <comment id="15621146" author="githubbot" created="Mon, 31 Oct 2016 03:59:45 +0000"  >&lt;p&gt;Github user hanm closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/94&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15621149" author="githubbot" created="Mon, 31 Oct 2016 04:01:56 +0000"  >&lt;p&gt;GitHub user hanm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: Only admin should be allowed to reconfig a cluster.&lt;/p&gt;

&lt;p&gt;    This PR implements &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;. For details, please refer to&lt;/p&gt;

&lt;p&gt;    JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&lt;/a&gt;&lt;br/&gt;
    Review board: &lt;a href=&quot;https://reviews.apache.org/r/51546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/51546/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hanm/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hanm/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #96&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6d18cffde99d4cf5298e045d6c0f23b36fd62925&lt;br/&gt;
Author: Michael Han &amp;lt;hanm@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2016-10-31T03:58:11Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: Only admin should be allowed to reconfig a cluster.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15621217" author="hanm" created="Mon, 31 Oct 2016 04:31:00 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt; for your code review. Updated patch and PR to address your review comments. Will create a new JIRA to track the discrepancy between C / Java client regarding error code mismatch.&lt;/p&gt;</comment>
                            <comment id="15621244" author="hadoopqa" created="Mon, 31 Oct 2016 04:52:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12836113/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12836113/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision f6349d16fcd5f04b560095417fd2a1813ac3e855.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 96 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3504//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15624126" author="hadoopqa" created="Tue, 1 Nov 2016 02:41:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12836113/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12836113/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision f6349d16fcd5f04b560095417fd2a1813ac3e855.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 96 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3507//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15634422" author="breed" created="Thu, 3 Nov 2016 21:58:09 +0000"  >&lt;p&gt;just a curious observer: why are we propagating the NoNodeException everywhere? i wasn&apos;t clear from the patch why that suddenly popped up as part of the change.&lt;/p&gt;</comment>
                            <comment id="15634520" author="hanm" created="Thu, 3 Nov 2016 22:28:20 +0000"  >&lt;p&gt;NoNodeException is thrown from within DataTree&apos;s constructor, &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96/files#diff-a676d93082759105dd8c79c0a76a8007R264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;addConfigNode&lt;/a&gt;. The intention is in cases such exception happens, we bubble exception up to abort the server startup instead of letting the server starting up with incorrect ACLs configured on the config node. It&apos;s unfortunate that the exception has to be thrown from DataTree&apos;s constructor which is on the critical path that leads to NoNodeException being scattered everywhere.&lt;/p&gt;</comment>
                            <comment id="15635265" author="breed" created="Fri, 4 Nov 2016 05:04:39 +0000"  >&lt;p&gt;ah that makes sense. i didn&apos;t dig deep enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; it is sad that an exception &quot;that should never happen&quot; has such a big impact on the code. shouldn&apos;t we have thrown a runtime exception? i think it would have eliminated a lot of this patch...&lt;/p&gt;

&lt;p&gt;this is just an observation not a vote &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15635390" author="hanm" created="Fri, 4 Nov 2016 06:10:21 +0000"  >&lt;p&gt;Good point on throwing an unchecked exception which does not contaminate method signatures. The benefit of throwing a KeeperException here is minimum as the higher level code in ZooKeeperServerMain that processed typed exceptions currently does not specifically react to KeeperException (and there seems not much need to do so), so processing a KeeperException in ZooKeeperServerMain will end up with same code path as a RuntimeException. Let me update the patch again to keep it lean.&lt;/p&gt;</comment>
                            <comment id="15636922" author="hanm" created="Fri, 4 Nov 2016 16:33:48 +0000"  >&lt;p&gt;Address Ben&apos;s comment by replacing KeeperException.NoNodeException with RuntimeException in addConfigNode to avoid changing function signatures across code base.&lt;/p&gt;</comment>
                            <comment id="15636990" author="hadoopqa" created="Fri, 4 Nov 2016 16:58:44 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12837178/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12837178/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 62 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 20 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3516//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15637058" author="hadoopqa" created="Fri, 4 Nov 2016 17:17:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12837180/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12837180/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 60 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 20 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3517//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15640611" author="githubbot" created="Sat, 5 Nov 2016 21:23:59 +0000"  >&lt;p&gt;Github user rgs1 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86673398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86673398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/c/tests/TestReconfigServer.cc &amp;#8212;&lt;br/&gt;
    @@ -324,4 +336,109 @@ testRemoveConnectedFollower() &lt;/p&gt;
{
         zookeeper_close(zk);
     }

&lt;p&gt;    +/**&lt;br/&gt;
    + * &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: only admin or users who are explicitly granted permission can do reconfig.&lt;br/&gt;
    + */&lt;br/&gt;
    +void TestReconfigServer::&lt;br/&gt;
    +testReconfigFailureWithoutAuth() {&lt;br/&gt;
    +    std::vector&amp;lt;std::string&amp;gt; servers;&lt;br/&gt;
    +    std::string version;&lt;br/&gt;
    +    struct Stat stat;&lt;br/&gt;
    +    int len = 1024;&lt;br/&gt;
    +    char buf&lt;span class=&quot;error&quot;&gt;&amp;#91;len&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +    // connect to a follower.&lt;br/&gt;
    +    int32_t leader = getLeader();&lt;br/&gt;
    +    std::vector&amp;lt;int32_t&amp;gt; followers = getFollowers();&lt;br/&gt;
    +    CPPUNIT_ASSERT(leader &amp;gt;= 0);&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(NUM_SERVERS - 1, (uint32_t)(followers.size()));&lt;br/&gt;
    +    std::stringstream ss;&lt;br/&gt;
    +    for (int i = 0; i &amp;lt; followers.size(); i++) &lt;/p&gt;
{
    +      ss &amp;lt;&amp;lt; cluster_[followers[i]]-&amp;gt;getHostPort() &amp;lt;&amp;lt; &quot;,&quot;;
    +    }&lt;br/&gt;
    +    ss &amp;lt;&amp;lt; cluster_&lt;span class=&quot;error&quot;&gt;&amp;#91;leader&amp;#93;&lt;/span&gt;-&amp;gt;getHostPort();&lt;br/&gt;
    +    std::string hosts = ss.str().c_str();&lt;br/&gt;
    +    zoo_deterministic_conn_order(true);&lt;br/&gt;
    +    zhandle_t* zk = zookeeper_init(hosts.c_str(), NULL, 10000, NULL, NULL, 0);&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(true, waitForConnected(zk, 10));&lt;br/&gt;
    +&lt;br/&gt;
    +    std::string connectedHost(zoo_get_current_server(zk));&lt;br/&gt;
    +    std::string portString = connectedHost.substr(connectedHost.find(&quot;:&quot;) + 1);&lt;br/&gt;
    +    uint32_t port;&lt;br/&gt;
    +    std::istringstream (portString) &amp;gt;&amp;gt; port;&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(cluster_[followers&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;]-&amp;gt;getClientPort(), port);&lt;br/&gt;
    +&lt;br/&gt;
    +    // remove the follower.&lt;br/&gt;
    +    len = 1024;&lt;br/&gt;
    +    ss.str(&quot;&quot;);&lt;br/&gt;
    +    ss &amp;lt;&amp;lt; followers&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +    // No auth, should fail.&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZNOAUTH, zoo_reconfig(zk, NULL, ss.str().c_str(), NULL, -1, buf, &amp;amp;len, &amp;amp;stat));&lt;br/&gt;
    +    // Wrong auth, should fail.&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZOK, zoo_add_auth(zk, &quot;digest&quot;, &quot;super:wrong&quot;, 11, NULL,(void*)ZOK));&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZNOAUTH, zoo_reconfig(zk, NULL, ss.str().c_str(), NULL, -1, buf, &amp;amp;len, &amp;amp;stat));&lt;br/&gt;
    +    // Right auth, should pass.&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZOK, zoo_add_auth(zk, &quot;digest&quot;, &quot;super:test&quot;, 10, NULL,(void*)ZOK));&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZOK, zoo_reconfig(zk, NULL, ss.str().c_str(), NULL, -1, buf, &amp;amp;len, &amp;amp;stat));&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL((int)ZOK, zoo_getconfig(zk, 0, buf, &amp;amp;len, &amp;amp;stat));&lt;br/&gt;
    +    parseConfig(buf, len, servers, version);&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(NUM_SERVERS - 1, (uint32_t)(servers.size()));&lt;br/&gt;
    +    for (int i = 0; i &amp;lt; cluster_.size(); i++) {&lt;br/&gt;
    +        if (i == followers&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;) {
    +            continue;
    +        }&lt;br/&gt;
    +        CPPUNIT_ASSERT(std::find(servers.begin(), servers.end(),&lt;br/&gt;
    +                       cluster_&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;-&amp;gt;getServerString()) != servers.end());&lt;br/&gt;
    +    }&lt;br/&gt;
    +    zookeeper_close(zk);&lt;br/&gt;
    +}&lt;br/&gt;
    +&lt;br/&gt;
    +void TestReconfigServer::&lt;br/&gt;
    +testReconfigFailureWithoutServerSuperuserPasswordConfigured() {&lt;br/&gt;
    +    std::vector&amp;lt;std::string&amp;gt; servers;&lt;br/&gt;
    +    std::string version;&lt;br/&gt;
    +    struct Stat stat;&lt;br/&gt;
    +    int len = 1024;&lt;br/&gt;
    +    char buf&lt;span class=&quot;error&quot;&gt;&amp;#91;len&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +    // Create a new quorum with the super user&apos;s password not configured.&lt;br/&gt;
    +    tearDown();&lt;br/&gt;
    +    ZooKeeperQuorumServer::tConfigPairs configs;&lt;br/&gt;
    +    configs.push_back(std::make_pair(&quot;reconfigEnabled&quot;, &quot;true&quot;));&lt;br/&gt;
    +    cluster_ = ZooKeeperQuorumServer::getCluster(NUM_SERVERS, configs, &quot;&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +    // connect to a follower.&lt;br/&gt;
    +    int32_t leader = getLeader();&lt;br/&gt;
    +    std::vector&amp;lt;int32_t&amp;gt; followers = getFollowers();&lt;br/&gt;
    +    CPPUNIT_ASSERT(leader &amp;gt;= 0);&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(NUM_SERVERS - 1, (uint32_t)(followers.size()));&lt;br/&gt;
    +    std::stringstream ss;&lt;br/&gt;
    +    for (int i = 0; i &amp;lt; followers.size(); i++) {    +      ss &amp;lt;&amp;lt; cluster_[followers[i]]-&amp;gt;getHostPort() &amp;lt;&amp;lt; &quot;,&quot;;    +    }
&lt;p&gt;    +    ss &amp;lt;&amp;lt; cluster_&lt;span class=&quot;error&quot;&gt;&amp;#91;leader&amp;#93;&lt;/span&gt;-&amp;gt;getHostPort();&lt;br/&gt;
    +    std::string hosts = ss.str().c_str();&lt;br/&gt;
    +    zoo_deterministic_conn_order(true);&lt;br/&gt;
    +    zhandle_t* zk = zookeeper_init(hosts.c_str(), NULL, 10000, NULL, NULL, 0);&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(true, waitForConnected(zk, 10));&lt;br/&gt;
    +&lt;br/&gt;
    +    std::string connectedHost(zoo_get_current_server(zk));&lt;br/&gt;
    +    std::string portString = connectedHost.substr(connectedHost.find(&quot;:&quot;) + 1);&lt;br/&gt;
    +    uint32_t port;&lt;br/&gt;
    +    std::istringstream (portString) &amp;gt;&amp;gt; port;&lt;br/&gt;
    +    CPPUNIT_ASSERT_EQUAL(cluster_[followers&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;]-&amp;gt;getClientPort(), port);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    connect to follower seems repeated, can we move it to a private helper method?&lt;/p&gt;</comment>
                            <comment id="15640612" author="githubbot" created="Sat, 5 Nov 2016 21:23:59 +0000"  >&lt;p&gt;Github user rgs1 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86673475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86673475&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/DataTree.java &amp;#8212;&lt;br/&gt;
    @@ -245,15 +245,25 @@ public DataTree() &lt;/p&gt;
{
             addConfigNode();
         }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void addConfigNode() {&lt;/li&gt;
	&lt;li&gt;DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;/li&gt;
	&lt;li&gt;if (zookeeperZnode!=null) 
{ // should always be the case
    -        	 zookeeperZnode.addChild(configChildZookeeper);
    -         }
&lt;p&gt; else &lt;/p&gt;
{
    -        	 LOG.error(&quot;There&apos;s no /zookeeper znode - this should never happen&quot;);
    -         }&lt;/li&gt;
	&lt;li&gt;nodes.put(configZookeeper, configDataNode);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    +    public void addConfigNode() {&lt;br/&gt;
    +        DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;br/&gt;
    +        if (zookeeperZnode!=null) { // should always be the case
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    nit: spaces around `!=`&lt;/p&gt;</comment>
                            <comment id="15640613" author="githubbot" created="Sat, 5 Nov 2016 21:23:59 +0000"  >&lt;p&gt;Github user rgs1 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86673489&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86673489&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/DataTree.java &amp;#8212;&lt;br/&gt;
    @@ -245,15 +245,25 @@ public DataTree() &lt;/p&gt;
{
             addConfigNode();
         }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void addConfigNode() {&lt;/li&gt;
	&lt;li&gt;DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;/li&gt;
	&lt;li&gt;if (zookeeperZnode!=null) 
{ // should always be the case
    -        	 zookeeperZnode.addChild(configChildZookeeper);
    -         }
&lt;p&gt; else &lt;/p&gt;
{
    -        	 LOG.error(&quot;There&apos;s no /zookeeper znode - this should never happen&quot;);
    -         }&lt;/li&gt;
	&lt;li&gt;nodes.put(configZookeeper, configDataNode);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    +    public void addConfigNode() {&lt;br/&gt;
    +        DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;br/&gt;
    +        if (zookeeperZnode!=null) { // should always be the case
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    i think this should be an assertion (and we can drop the LOG.error call)&lt;/p&gt;</comment>
                            <comment id="15641216" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86679034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86679034&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/DataTree.java &amp;#8212;&lt;br/&gt;
    @@ -245,15 +245,25 @@ public DataTree() &lt;/p&gt;
{
             addConfigNode();
         }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void addConfigNode() {&lt;/li&gt;
	&lt;li&gt;DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;/li&gt;
	&lt;li&gt;if (zookeeperZnode!=null) 
{ // should always be the case
    -        	 zookeeperZnode.addChild(configChildZookeeper);
    -         }
&lt;p&gt; else &lt;/p&gt;
{
    -        	 LOG.error(&quot;There&apos;s no /zookeeper znode - this should never happen&quot;);
    -         }&lt;/li&gt;
	&lt;li&gt;nodes.put(configZookeeper, configDataNode);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    +    public void addConfigNode() {&lt;br/&gt;
    +        DataNode zookeeperZnode = nodes.get(procZookeeper);&lt;br/&gt;
    +        if (zookeeperZnode!=null) 
{ // should always be the case
    +            zookeeperZnode.addChild(configChildZookeeper);
    +        }
&lt;p&gt; else &lt;/p&gt;
{
    +            LOG.error(&quot;There&apos;s no /zookeeper znode - this should never happen.&quot;);
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        nodes.put(configZookeeper, configDataNode);&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            // Reconfig node is access controlled by default (ZOOKEEPER-2014).
    +            setACL(configZookeeper, ZooDefs.Ids.READ_ACL_UNSAFE, -1);
    +        }
&lt;p&gt; catch (KeeperException.NoNodeException e) {&lt;br/&gt;
    +            LOG.error(&quot;Fail to set ACL on {} - this should never happen: {}&quot;, configZookeeper, e);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    actually if we are asserting above, perhaps we should also assert here.&lt;/p&gt;</comment>
                            <comment id="15641217" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86678939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86678939&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml &amp;#8212;&lt;br/&gt;
    @@ -1108,6 +1109,42 @@ server.3=zoo3:2888:3888&amp;lt;/programlisting&amp;gt;&lt;br/&gt;
                   &amp;lt;/para&amp;gt;&lt;br/&gt;
                 &amp;lt;/listitem&amp;gt;&lt;br/&gt;
               &amp;lt;/varlistentry&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +          &amp;lt;varlistentry&amp;gt;&lt;br/&gt;
    +            &amp;lt;term&amp;gt;reconfigEnabled&amp;lt;/term&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +            &amp;lt;listitem&amp;gt;&lt;br/&gt;
    +              &amp;lt;para&amp;gt;(No Java system property)&amp;lt;/para&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +              &amp;lt;para&amp;gt;&amp;lt;emphasis role=&quot;bold&quot;&amp;gt;New in 3.5.3:&amp;lt;/emphasis&amp;gt;&lt;br/&gt;
    +                This controls the enabling or disabling of&lt;br/&gt;
    +                &amp;lt;ulink url=&quot;zookeeperReconfig.html&quot;&amp;gt;&lt;br/&gt;
    +                  Dynamic Reconfiguration&amp;lt;/ulink&amp;gt; feature. When the feature&lt;br/&gt;
    +                is enabled, users can perform reconfigure operations through&lt;br/&gt;
    +                the ZooKeeper client API or through ZooKeeper command line tools&lt;br/&gt;
    +                assuming users are authorized to perform such operations.&lt;br/&gt;
    +                When the feature is disabled, no user, including the super user,&lt;br/&gt;
    +                can perform a reconfiguration. Any attempt to reconfigure will return an error.&lt;br/&gt;
    +                &amp;lt;emphasis role=&quot;bold&quot;&amp;gt;&quot;reconfigEnabled&quot;&amp;lt;/emphasis&amp;gt; option can be set as&lt;br/&gt;
    +                &amp;lt;emphasis role=&quot;bold&quot;&amp;gt;&quot;reconfigEnabled=false&quot;&amp;lt;/emphasis&amp;gt; or&lt;br/&gt;
    +                &amp;lt;emphasis role=&quot;bold&quot;&amp;gt;&quot;reconfigEnabled=true&quot;&amp;lt;/emphasis&amp;gt;&lt;br/&gt;
    +                to a server&apos;s config file, or using QuorumPeerConfig&apos;s&lt;br/&gt;
    +                setReconfigEnabled method. The default value is false.&lt;br/&gt;
    +&lt;br/&gt;
    +                If present, the value should be consistent across every server in&lt;br/&gt;
    +                the entire ensemble. Setting the value as true on some servers and false&lt;br/&gt;
    +                on other servers will cause inconsistent behavior depends on which server&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    depends -&amp;gt; depending&lt;/p&gt;</comment>
                            <comment id="15641219" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86679094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86679094&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/test/ReconfigExceptionTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,220 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.test;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.Collections;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.TimeoutException;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ZKTestCase;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.PortAssignment;&lt;br/&gt;
    +import org.apache.zookeeper.admin.ZooKeeperAdmin;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.data.Stat;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumPeerConfig;&lt;br/&gt;
    +import org.junit.After;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Before;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ReconfigExceptionTest extends ZKTestCase {&lt;br/&gt;
    +    private static final Logger LOG = LoggerFactory&lt;br/&gt;
    +            .getLogger(ReconfigExceptionTest.class);&lt;br/&gt;
    +    private static String authProvider = &quot;zookeeper.DigestAuthenticationProvider.superDigest&quot;;&lt;br/&gt;
    +    // Use DigestAuthenticationProvider.base64Encode or&lt;br/&gt;
    +    // run ZooKeeper jar with org.apache.zookeeper.server.auth.DigestAuthenticationProvider to generate password.&lt;br/&gt;
    +    // An example:&lt;br/&gt;
    +    // java -cp zookeeper-3.6.0-SNAPSHOT.jar:lib/log4j-1.2.17.jar:lib/slf4j-log4j12-1.7.5.jar:&lt;br/&gt;
    +    // lib/slf4j-api-1.7.5.jar org.apache.zookeeper.server.auth.DigestAuthenticationProvider super:test&lt;br/&gt;
    +    // The password here is &apos;test&apos;.&lt;br/&gt;
    +    private static String superDigest = &quot;super&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;/InIHSb7yEEbrWz8b9l71RjZJU=&quot;;&lt;br/&gt;
    +    private QuorumUtil qu;&lt;br/&gt;
    +    private ZooKeeperAdmin zkAdmin;&lt;br/&gt;
    +&lt;br/&gt;
    +    @Before&lt;br/&gt;
    +    public void setup() throws InterruptedException, KeeperException.NoNodeException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    we don&apos;t throw NoNodeException anymore&lt;/p&gt;</comment>
                            <comment id="15641218" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86679106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86679106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/test/ReconfigExceptionTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,220 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper.test;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.Collections;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.TimeoutException;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ZKTestCase;&lt;br/&gt;
    +import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs;&lt;br/&gt;
    +import org.apache.zookeeper.PortAssignment;&lt;br/&gt;
    +import org.apache.zookeeper.admin.ZooKeeperAdmin;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.data.Stat;&lt;br/&gt;
    +import org.apache.zookeeper.server.quorum.QuorumPeerConfig;&lt;br/&gt;
    +import org.junit.After;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Before;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ReconfigExceptionTest extends ZKTestCase {&lt;br/&gt;
    +    private static final Logger LOG = LoggerFactory&lt;br/&gt;
    +            .getLogger(ReconfigExceptionTest.class);&lt;br/&gt;
    +    private static String authProvider = &quot;zookeeper.DigestAuthenticationProvider.superDigest&quot;;&lt;br/&gt;
    +    // Use DigestAuthenticationProvider.base64Encode or&lt;br/&gt;
    +    // run ZooKeeper jar with org.apache.zookeeper.server.auth.DigestAuthenticationProvider to generate password.&lt;br/&gt;
    +    // An example:&lt;br/&gt;
    +    // java -cp zookeeper-3.6.0-SNAPSHOT.jar:lib/log4j-1.2.17.jar:lib/slf4j-log4j12-1.7.5.jar:&lt;br/&gt;
    +    // lib/slf4j-api-1.7.5.jar org.apache.zookeeper.server.auth.DigestAuthenticationProvider super:test&lt;br/&gt;
    +    // The password here is &apos;test&apos;.&lt;br/&gt;
    +    private static String superDigest = &quot;super&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;/InIHSb7yEEbrWz8b9l71RjZJU=&quot;;&lt;br/&gt;
    +    private QuorumUtil qu;&lt;br/&gt;
    +    private ZooKeeperAdmin zkAdmin;&lt;br/&gt;
    +&lt;br/&gt;
    +    @Before&lt;br/&gt;
    +    public void setup() throws InterruptedException, KeeperException.NoNodeException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    +1 awesome work! i only found little nits! thanx for sticking with this!&lt;/p&gt;</comment>
                            <comment id="15641215" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86679075&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86679075&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/test/ClientBase.java &amp;#8212;&lt;br/&gt;
    @@ -356,7 +356,7 @@ private static int getPort(String hostPort) {&lt;br/&gt;
          */&lt;br/&gt;
         public static void startServerInstance(File dataDir,&lt;br/&gt;
                 ServerCnxnFactory factory, String hostPort) throws IOException,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;InterruptedException {&lt;br/&gt;
    +            InterruptedException, KeeperException.NoNodeException {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    this isn&apos;t needed anymore right?&lt;/p&gt;</comment>
                            <comment id="15641220" author="githubbot" created="Sun, 6 Nov 2016 05:43:02 +0000"  >&lt;p&gt;Github user breed commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r86679058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r86679058&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/DataTreeTest.java &amp;#8212;&lt;br/&gt;
    @@ -200,29 +198,34 @@ public void testSerializeDoesntLockDataNodeWhileWriting() throws Exception {&lt;br/&gt;
             BinaryOutputArchive oa = new BinaryOutputArchive(out) {&lt;br/&gt;
                 @Override&lt;br/&gt;
                 public void writeRecord(Record r, String tag) throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DataNode node = (DataNode) r;&lt;/li&gt;
	&lt;li&gt;if (node.data.length == 1 &amp;amp;&amp;amp; node.data&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == 42) {&lt;/li&gt;
	&lt;li&gt;final Semaphore semaphore = new Semaphore(0);&lt;/li&gt;
	&lt;li&gt;new Thread(new Runnable() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public void run() {&lt;/li&gt;
	&lt;li&gt;synchronized (markerNode) {&lt;/li&gt;
	&lt;li&gt;//When we lock markerNode, allow writeRecord to continue&lt;/li&gt;
	&lt;li&gt;semaphore.release();&lt;br/&gt;
    +                // Need check if the record is a DataNode instance because of changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +                // which adds default ACL to config node.&lt;br/&gt;
    +                if (r instanceof DataNode) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    is there a reason we added the instanceof here? if we didn&apos;t need it before, why do we need it now?&lt;/p&gt;</comment>
                            <comment id="15641315" author="hanm" created="Sun, 6 Nov 2016 07:01:13 +0000"  >&lt;p&gt;Update patch for addressing review comments from Ben and Raul.&lt;/p&gt;</comment>
                            <comment id="15641319" author="githubbot" created="Sun, 6 Nov 2016 07:04:14 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @breed and @rgs1 for your time and review feedback. Pull request, patch, and review board is now updated.&lt;/p&gt;</comment>
                            <comment id="15641347" author="hadoopqa" created="Sun, 6 Nov 2016 07:27:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12837643/ZOOKEEPER-2014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12837643/ZOOKEEPER-2014.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 57 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 20 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3524//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15645962" author="breed" created="Tue, 8 Nov 2016 00:34:52 +0000"  >&lt;p&gt;shall i commit it or are we waiting on something else?&lt;/p&gt;</comment>
                            <comment id="15645990" author="hanm" created="Tue, 8 Nov 2016 00:44:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=breed&quot; class=&quot;user-hover&quot; rel=&quot;breed&quot;&gt;breed&lt;/a&gt; We were previously waiting for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2624&quot; title=&quot;Add test script for pull requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2624&quot;&gt;&lt;del&gt;ZOOKEEPER-2624&lt;/del&gt;&lt;/a&gt; to land and for more review comments. Now &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2624&quot; title=&quot;Add test script for pull requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2624&quot;&gt;&lt;del&gt;ZOOKEEPER-2624&lt;/del&gt;&lt;/a&gt; landed and more review comments were collected and addressed, I think this one is ready to land &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15656130" author="githubbot" created="Fri, 11 Nov 2016 04:49:27 +0000"  >&lt;p&gt;Github user fpj commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r87536973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r87536973&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/DataTreeTest.java &amp;#8212;&lt;br/&gt;
    @@ -200,29 +198,34 @@ public void testSerializeDoesntLockDataNodeWhileWriting() throws Exception {&lt;br/&gt;
             BinaryOutputArchive oa = new BinaryOutputArchive(out) {&lt;br/&gt;
                 @Override&lt;br/&gt;
                 public void writeRecord(Record r, String tag) throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DataNode node = (DataNode) r;&lt;/li&gt;
	&lt;li&gt;if (node.data.length == 1 &amp;amp;&amp;amp; node.data&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == 42) {&lt;/li&gt;
	&lt;li&gt;final Semaphore semaphore = new Semaphore(0);&lt;/li&gt;
	&lt;li&gt;new Thread(new Runnable() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public void run() {&lt;/li&gt;
	&lt;li&gt;synchronized (markerNode) {&lt;/li&gt;
	&lt;li&gt;//When we lock markerNode, allow writeRecord to continue&lt;/li&gt;
	&lt;li&gt;semaphore.release();&lt;br/&gt;
    +                // Need check if the record is a DataNode instance because of changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +                // which adds default ACL to config node.&lt;br/&gt;
    +                if (r instanceof DataNode) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @hanm hmm, I&apos;m not sure about this. In the changes for `DataTree`, we only set the ACL of the `/zookeeper/config` znode, but setting ACLs was something we were doing before, so I&apos;m confused about why we can have a mix of znode records and ACL records with the changes proposed here. Could you clarify, please?&lt;/p&gt;</comment>
                            <comment id="15656309" author="githubbot" created="Fri, 11 Nov 2016 06:37:16 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96#discussion_r87543684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96#discussion_r87543684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/DataTreeTest.java &amp;#8212;&lt;br/&gt;
    @@ -200,29 +198,34 @@ public void testSerializeDoesntLockDataNodeWhileWriting() throws Exception {&lt;br/&gt;
             BinaryOutputArchive oa = new BinaryOutputArchive(out) {&lt;br/&gt;
                 @Override&lt;br/&gt;
                 public void writeRecord(Record r, String tag) throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DataNode node = (DataNode) r;&lt;/li&gt;
	&lt;li&gt;if (node.data.length == 1 &amp;amp;&amp;amp; node.data&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == 42) {&lt;/li&gt;
	&lt;li&gt;final Semaphore semaphore = new Semaphore(0);&lt;/li&gt;
	&lt;li&gt;new Thread(new Runnable() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public void run() {&lt;/li&gt;
	&lt;li&gt;synchronized (markerNode) {&lt;/li&gt;
	&lt;li&gt;//When we lock markerNode, allow writeRecord to continue&lt;/li&gt;
	&lt;li&gt;semaphore.release();&lt;br/&gt;
    +                // Need check if the record is a DataNode instance because of changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +                // which adds default ACL to config node.&lt;br/&gt;
    +                if (r instanceof DataNode) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @fpj - we were not setting ACLs on intrinsic znodes (i.e. /zookeeper/config) ZooKeeper implicitly created while initializing a DataTree before. And for this test case, it only creates znodes, not ACLs. As a result, it&apos;s reasonable for the previous test case to assume every record that&apos;s serializing is a DataNode record. Now with this patch, there is an ACL implicitly created when /zookeeper/config node is created, so the previous assumption (that all records to be serialized are DataNode record) does not hold. Thus, a change is required.&lt;/p&gt;

&lt;p&gt;    For reference, you could put a break point on &lt;a href=&quot;https://github.com/apache/zookeeper/blob/master/src/java/main/org/apache/zookeeper/server/ReferenceCountedACLCache.java#L133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/master/src/java/main/org/apache/zookeeper/server/ReferenceCountedACLCache.java#L133&lt;/a&gt; while running this test case, and you will see there is one ACL that&apos;s serialized. Now you can remove the ACL associated with /zookeeper/config at &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96/files#diff-a676d93082759105dd8c79c0a76a8007R259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96/files#diff-a676d93082759105dd8c79c0a76a8007R259&lt;/a&gt;, and you will see the break point on ReferenceCountedACLCache.java previous set not get hit. That is the difference.&lt;/p&gt;

&lt;p&gt;    Another way to experiment this is to create an ACL in this test (without applying this pull request first), something like:&lt;br/&gt;
    `final DataNode markerNode = tree.getNode(&quot;/marker&quot;);&lt;br/&gt;
      tree.setACL(&quot;/marker&quot;, ZooDefs.Ids.READ_ACL_UNSAFE, -1);` will do. Then we will see the same type casting failure - this simulates what this PR will do in terms of changing the type of records. Basically I think the root cause is the test itself could be made more robust, by eliminate the assumptions (that every record is a DataNode) that might not always hold.&lt;/p&gt;
</comment>
                            <comment id="15662002" author="githubbot" created="Sun, 13 Nov 2016 20:00:10 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/96&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15662017" author="fpj" created="Sun, 13 Nov 2016 20:10:58 +0000"  >&lt;p&gt;+1, great work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt;, thanks for the patch!&lt;/p&gt;</comment>
                            <comment id="15662042" author="hudson" created="Sun, 13 Nov 2016 20:31:00 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3155 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3155/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3155/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2014&quot; title=&quot;Only admin should be allowed to reconfig a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2014&quot;&gt;&lt;del&gt;ZOOKEEPER-2014&lt;/del&gt;&lt;/a&gt;: Only admin should be allowed to reconfig a cluster. (fpj: rev 73e102a58d01b27bc6208bbfbde2d12f0deba1f4)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/ReconfigLegacyTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/ZooKeeper.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/cli/CliCommand.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/TestableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/systest/org/apache/zookeeper/test/system/BaseSysTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/ReconfigDuringLeaderSyncTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/ReconfigBackupTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/LearnerTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/KeeperException.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/DataTreeTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/c/tests/ZooKeeperQuorumServer.h&lt;/li&gt;
	&lt;li&gt;(add) src/java/test/org/apache/zookeeper/test/ReconfigMisconfigTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/cli/ReconfigCommand.java&lt;/li&gt;
	&lt;li&gt;(edit) src/c/tests/TestReconfigServer.cc&lt;/li&gt;
	&lt;li&gt;(add) src/java/test/org/apache/zookeeper/test/ReconfigExceptionTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/c/include/zookeeper.h&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/RaceConditionTest.java&lt;/li&gt;
	&lt;li&gt;(add) src/java/main/org/apache/zookeeper/admin/ZooKeeperAdmin.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/ACLTest.java&lt;/li&gt;
	&lt;li&gt;(edit) build.xml&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/ZooKeeperMain.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/ReconfigFailureCasesTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/ZooKeeperServerMain.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/ReconfigTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/docs/src/documentation/content/xdocs/zookeeperReconfig.xml&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/StandaloneDisabledTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/StandaloneTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/c/tests/ZooKeeperQuorumServer.cc&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/ClientCnxn.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15728484" author="randgalt" created="Wed, 7 Dec 2016 11:07:25 +0000"  >&lt;p&gt;I realize I&apos;m very late to this issue but I truly don&apos;t understand the benefit of this. This change has completely broken Curator and I&apos;m now struggling to figure out how to fix it. How does breaking all existing clients help ZooKeeper usage?&lt;/p&gt;</comment>
                            <comment id="16002692" author="randgalt" created="Tue, 9 May 2017 13:43:25 +0000"  >&lt;p&gt;I&apos;m terribly sorry I was so late to this issue. Now that it&apos;s released I see even more problems. I just sent this email to @dev&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;reconfig() is limited to &quot;super&quot; user. Perversely, this reduces security as &quot;super&quot; user is utterly insecure. Requiring new databases to be post-applied via super user creates a security hole. For the time that the new ACLs for /zookeeper/config are to be changed the ZooKeeper instance will be in &quot;super&quot; user mode. Additionally, having to do all this is terribly cumbersome. Lastly, the docs only make passing mention of this. I think users will be very surprised by this - especially as the docs refer users to ReconfigExceptionTest.java which isn&apos;t part of the client distribution.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12401266">ZOOKEEPER-107</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13026329">ZOOKEEPER-2642</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12837643" name="ZOOKEEPER-2014.patch" size="133799" author="hanm" created="Sun, 6 Nov 2016 07:01:13 +0000"/>
                            <attachment id="12837180" name="ZOOKEEPER-2014.patch" size="134375" author="hanm" created="Fri, 4 Nov 2016 16:45:20 +0000"/>
                            <attachment id="12836113" name="ZOOKEEPER-2014.patch" size="162854" author="hanm" created="Mon, 31 Oct 2016 04:29:38 +0000"/>
                            <attachment id="12833880" name="ZOOKEEPER-2014.patch" size="162840" author="hanm" created="Tue, 18 Oct 2016 05:14:33 +0000"/>
                            <attachment id="12832782" name="ZOOKEEPER-2014.patch" size="125461" author="hanm" created="Tue, 11 Oct 2016 22:33:08 +0000"/>
                            <attachment id="12832770" name="ZOOKEEPER-2014.patch" size="123420" author="hanm" created="Tue, 11 Oct 2016 21:31:00 +0000"/>
                            <attachment id="12832546" name="ZOOKEEPER-2014.patch" size="121127" author="hanm" created="Mon, 10 Oct 2016 21:39:35 +0000"/>
                            <attachment id="12831433" name="ZOOKEEPER-2014.patch" size="120656" author="hanm" created="Mon, 3 Oct 2016 23:49:23 +0000"/>
                            <attachment id="12830832" name="ZOOKEEPER-2014.patch" size="112307" author="hanm" created="Thu, 29 Sep 2016 01:38:25 +0000"/>
                            <attachment id="12830589" name="ZOOKEEPER-2014.patch" size="106533" author="hanm" created="Tue, 27 Sep 2016 22:38:08 +0000"/>
                            <attachment id="12830416" name="ZOOKEEPER-2014.patch" size="106168" author="hanm" created="Mon, 26 Sep 2016 22:45:02 +0000"/>
                            <attachment id="12826655" name="ZOOKEEPER-2014.patch" size="96286" author="hanm" created="Thu, 1 Sep 2016 16:23:47 +0000"/>
                            <attachment id="12826264" name="ZOOKEEPER-2014.patch" size="95965" author="hanm" created="Tue, 30 Aug 2016 22:51:33 +0000"/>
                            <attachment id="12825698" name="ZOOKEEPER-2014.patch" size="79501" author="hanm" created="Fri, 26 Aug 2016 19:48:43 +0000"/>
                            <attachment id="12663337" name="ZOOKEEPER-2014.patch" size="2320" author="rgs" created="Thu, 21 Aug 2014 04:10:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z667:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>