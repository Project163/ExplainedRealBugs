<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:59:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2808] ACL with index 1 might be removed if it&apos;s only being used once</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2808</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When Zeus start up, it will create DataTree instance, in which the empty config znode is created with READ_UNSAFE acl, the acl will be stored in a map with index 1. Then it&apos;s going to load the snapshot from disk, the nodes and acl map will be cleared, but the reconfig znode is still reference to acl index 1. The reconfig znode will be reused, so actually it may reference to a different ACL stored in the snasphot. After leader-follower syncing, the reconfig znode will be added back again (if it doesn&apos;t exist), which will remove the previous reference to ACL index 1, if the index 1 has 0 reference it will be removed from the ACL map, which could cause that ACL un-usable, and that znode will not be readable.&lt;/p&gt;

&lt;p&gt;Error logs related:&lt;br/&gt;
-----------------------------&lt;br/&gt;
2017-06-12 12:02:21,443 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:2&amp;#93;&lt;/span&gt; - ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CommitProcWorkThread-14:DataTree@249&amp;#93;&lt;/span&gt; - ERROR: ACL not available for long 1&lt;br/&gt;
2017-06-12 12:02:21,444 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:2&amp;#93;&lt;/span&gt; - ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CommitProcWorkThread-14:FinalRequestProcessor@567&amp;#93;&lt;/span&gt; - Failed to process sessionid:0x201035cc882002d type:getChildren cxid:0x1 zxid:0xfffffffffffffffe txntype:unknown reqpath:n/a&lt;br/&gt;
java.lang.RuntimeException: Failed to fetch acls for 1&lt;br/&gt;
        at org.apache.zookeeper.server.DataTree.convertLong(DataTree.java:250)&lt;br/&gt;
        at org.apache.zookeeper.server.DataTree.getACL(DataTree.java:799)&lt;br/&gt;
        at org.apache.zookeeper.server.ZKDatabase.getACL(ZKDatabase.java:574)&lt;br/&gt;
        at org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:463)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.CommitProcessor$CommitWorkRequest.doWork(CommitProcessor.java:439)&lt;br/&gt;
        at org.apache.zookeeper.server.WorkerService$ScheduledWorkRequest.run(WorkerService.java:151)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13080159">ZOOKEEPER-2808</key>
            <summary>ACL with index 1 might be removed if it&apos;s only being used once</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lvfangmin">Fangmin Lv</assignee>
                                    <reporter username="lvfangmin">Fangmin Lv</reporter>
                        <labels>
                            <label>upgrade</label>
                    </labels>
                <created>Thu, 15 Jun 2017 17:46:22 +0000</created>
                <updated>Mon, 19 Jun 2017 04:02:56 +0000</updated>
                            <resolved>Sun, 18 Jun 2017 17:23:34 +0000</resolved>
                                    <version>3.6.0</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16051387" author="hanm" created="Fri, 16 Jun 2017 05:16:57 +0000"  >&lt;p&gt;We could reset the ACL of the config node at the end of snapshot deserialization. Would this fix the problem?&lt;/p&gt;</comment>
                            <comment id="16052527" author="githubbot" created="Fri, 16 Jun 2017 23:42:25 +0000"  >&lt;p&gt;GitHub user lvfangmin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2808&quot; title=&quot;ACL with index 1 might be removed if it&amp;#39;s only being used once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2808&quot;&gt;&lt;del&gt;ZOOKEEPER-2808&lt;/del&gt;&lt;/a&gt;: fix miss-referenced ACL count issue when upgrading the ZooKeeper&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/lvfangmin/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lvfangmin/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2808&quot; title=&quot;ACL with index 1 might be removed if it&amp;#39;s only being used once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2808&quot;&gt;&lt;del&gt;ZOOKEEPER-2808&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/284.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/284.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #284&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 295b9b782ac499814f6ccf149ecd17d15d3bf5bc&lt;br/&gt;
Author: Fangmin Lyu &amp;lt;allenlyu@fb.com&amp;gt;&lt;br/&gt;
Date:   2017-06-16T23:38:43Z&lt;/p&gt;

&lt;p&gt;    fix miss-referenced ACL count issue when upgrading the ZooKeeper&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16052543" author="hadoopqa" created="Sat, 17 Jun 2017 00:00:30 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/796//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16052551" author="lvfangmin" created="Sat, 17 Jun 2017 00:08:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanm&quot; class=&quot;user-hover&quot; rel=&quot;hanm&quot;&gt;hanm&lt;/a&gt; we can clear the ACL of the config node after clear the datatree at the beginning of the deserialization, what I did in the patch is creating a &apos;clean&apos; config node every time we call addConfigNode.&lt;/p&gt;</comment>
                            <comment id="16053260" author="hanm" created="Sun, 18 Jun 2017 17:19:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvfangmin&quot; class=&quot;user-hover&quot; rel=&quot;lvfangmin&quot;&gt;lvfangmin&lt;/a&gt; Sounds good to me. It is a clean solution. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt; Could you please add &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvfangmin&quot; class=&quot;user-hover&quot; rel=&quot;lvfangmin&quot;&gt;lvfangmin&lt;/a&gt; to contributor list and assign this issue to him?&lt;/p&gt;</comment>
                            <comment id="16053261" author="githubbot" created="Sun, 18 Jun 2017 17:22:07 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM.&lt;/p&gt;</comment>
                            <comment id="16053263" author="githubbot" created="Sun, 18 Jun 2017 17:23:29 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/284&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16053264" author="hanm" created="Sun, 18 Jun 2017 17:23:34 +0000"  >&lt;p&gt;Issue resolved by pull request 284&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/284&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16053265" author="hanm" created="Sun, 18 Jun 2017 17:26:11 +0000"  >&lt;p&gt;Committed to master: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/111ae5a5b67999925f1921736a14fcfbdb1b7348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/111ae5a5b67999925f1921736a14fcfbdb1b7348&lt;/a&gt;&lt;br/&gt;
3.5:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/b9ff4935bf8cb6d85229eb5012b9b5d0a8049e79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/b9ff4935bf8cb6d85229eb5012b9b5d0a8049e79&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16053282" author="hudson" created="Sun, 18 Jun 2017 18:32:57 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3433 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3433/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3433/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2808&quot; title=&quot;ACL with index 1 might be removed if it&amp;#39;s only being used once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2808&quot;&gt;&lt;del&gt;ZOOKEEPER-2808&lt;/del&gt;&lt;/a&gt;: fix miss-referenced ACL count issue when upgrading the (hanm: rev 111ae5a5b67999925f1921736a14fcfbdb1b7348)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/ZKDatabase.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/DataTreeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gbwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>