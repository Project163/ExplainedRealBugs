<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:00:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2804] Node creation fails with NPE if ACLs are null</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2804</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;If null ACLs are passed then zk node creation or set ACL fails with NPE&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
	at org.apache.zookeeper.server.PrepRequestProcessor.removeDuplicates(PrepRequestProcessor.java:1301)
	at org.apache.zookeeper.server.PrepRequestProcessor.fixupACL(PrepRequestProcessor.java:1341)
	at org.apache.zookeeper.server.PrepRequestProcessor.pRequest2Txn(PrepRequestProcessor.java:519)
	at org.apache.zookeeper.server.PrepRequestProcessor.pRequest(PrepRequestProcessor.java:1126)
	at org.apache.zookeeper.server.PrepRequestProcessor.run(PrepRequestProcessor.java:178)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected to handle null in server and return proper error code to client&lt;/p&gt;</description>
                <environment></environment>
        <key id="13078574">ZOOKEEPER-2804</key>
            <summary>Node creation fails with NPE if ACLs are null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Bhupendra">Bhupendra Kumar Jain</assignee>
                                    <reporter username="Bhupendra">Bhupendra Kumar Jain</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Jun 2017 10:20:21 +0000</created>
                <updated>Fri, 18 Aug 2017 23:41:29 +0000</updated>
                            <resolved>Fri, 18 Aug 2017 21:39:57 +0000</resolved>
                                                    <fixVersion>3.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16044549" author="fpj" created="Fri, 9 Jun 2017 15:32:15 +0000"  >&lt;p&gt;Good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bhupendra&quot; class=&quot;user-hover&quot; rel=&quot;Bhupendra&quot;&gt;Bhupendra&lt;/a&gt;! Do you want to submit a patch?&lt;/p&gt;</comment>
                            <comment id="16045655" author="bhupendra" created="Sat, 10 Jun 2017 18:52:31 +0000"  >&lt;p&gt;After I rechecked the code, I noticed that all create APIs and also SetACL API have the NPE issue. Server must throw InvalidACLException in the null case. &lt;/p&gt;

&lt;p&gt;Apart from this, Currently client side ACL null parameter validation is missing. We can probably add client side validation also to throw IllegalArgumentException for null ACL.  &lt;/p&gt;</comment>
                            <comment id="16045684" author="githubbot" created="Sat, 10 Jun 2017 20:27:34 +0000"  >&lt;p&gt;GitHub user jainbhupendra24 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2804&quot; title=&quot;Node creation fails with NPE if ACLs are null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2804&quot;&gt;&lt;del&gt;ZOOKEEPER-2804&lt;/del&gt;&lt;/a&gt;:Node creation fails with NPE if ACLs are null&lt;/p&gt;

&lt;p&gt;    1) Handled Null case in server. Client will get InvalidACLException &lt;br/&gt;
    2) Handled null check in create and setACL APIs in client side. as per their javadoc &lt;br/&gt;
    @throws KeeperException.InvalidACLException if the ACL is invalid, null, or empty&lt;br/&gt;
    3) Not handling any validation for async API of create and setACL in this JIRA because these API doesn&apos;t throw KeeperException explicitly. So can not throw InvalidACLException from Client.  If we throw IllegalArgumentException then it will not be consistent with other sync APIs.  So Let server throw InvalidACLException for async API.&lt;/p&gt;


&lt;p&gt;    Please review and provide suggestion. &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jainbhupendra24/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jainbhupendra24/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2804&quot; title=&quot;Node creation fails with NPE if ACLs are null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2804&quot;&gt;&lt;del&gt;ZOOKEEPER-2804&lt;/del&gt;&lt;/a&gt;-new&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #279&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9deacdabc061b95b24242a6bc557b7ee031bdf9e&lt;br/&gt;
Author: bhupendra jain &amp;lt;bhupendra.jain@huawei.com&amp;gt;&lt;br/&gt;
Date:   2017-06-10T20:16:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2804&quot; title=&quot;Node creation fails with NPE if ACLs are null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2804&quot;&gt;&lt;del&gt;ZOOKEEPER-2804&lt;/del&gt;&lt;/a&gt;:Node creation fails with NPE if ACLs are null&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16045698" author="hadoopqa" created="Sat, 10 Jun 2017 20:49:04 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +0 tests included.  The patch appears to be a documentation patch that doesn&apos;t require tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/784//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16045855" author="githubbot" created="Sun, 11 Jun 2017 06:47:39 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Test failure is not related&lt;/p&gt;</comment>
                            <comment id="16045964" author="githubbot" created="Sun, 11 Jun 2017 13:31:22 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121280641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121280641&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;ACL&amp;gt; it = acl.iterator();&lt;/li&gt;
	&lt;li&gt;while (it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ACL a = it.next();&lt;/li&gt;
	&lt;li&gt;if (retval.contains(a) == false) {&lt;/li&gt;
	&lt;li&gt;retval.add(a);&lt;br/&gt;
    +        if(acl != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    nit: space between `if` and `(`&lt;/p&gt;</comment>
                            <comment id="16045965" author="githubbot" created="Sun, 11 Jun 2017 13:31:22 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121280993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121280993&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;ACL&amp;gt; it = acl.iterator();&lt;/li&gt;
	&lt;li&gt;while (it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ACL a = it.next();&lt;/li&gt;
	&lt;li&gt;if (retval.contains(a) == false) {&lt;/li&gt;
	&lt;li&gt;retval.add(a);&lt;br/&gt;
    +        if(acl != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    ```&lt;br/&gt;
       if (acl != null) &lt;/p&gt;
{
           retval.addAll(acl);
       }
&lt;p&gt; &lt;br/&gt;
    }&lt;br/&gt;
    return new List&amp;lt;&amp;gt;(retval);&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    OR&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
        if (acl != null) {&lt;br/&gt;
            for (ACL a: acl) {&lt;br/&gt;
                 if (a != null) &lt;/p&gt;
{
                    retval.add(a);
                 }
&lt;p&gt;            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
    return new List&amp;lt;&amp;gt;(retval);&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    Main difference between the two code snippets is that the latter accounts for null entries in the `acl` List. As you know, Lists accept null entries, but `Set` throws `NPE`. The original code doesn&apos;t prevent that, but this can never be the case (sending a null ACL entry in the List), so the former snippet is preferrable.&lt;/p&gt;

</comment>
                            <comment id="16045966" author="githubbot" created="Sun, 11 Jun 2017 13:31:22 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121280799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121280799&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    If we make retval a `Set` then code on lines 918-924 can be simplified as shown below.&lt;br/&gt;
    ```&lt;br/&gt;
    Set&amp;lt;ACL&amp;gt; retval = new ACL&amp;lt;&amp;gt;();&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16045967" author="githubbot" created="Sun, 11 Jun 2017 13:31:22 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121281455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121281455&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.size() == 0) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Wouldn&apos;t be better to account for `null` entries in the `acl` List like below?&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    if (acl == null || acl.size() == 0 || acl.contains(null)) {&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    The same applies to other changes in this file.&lt;/p&gt;</comment>
                            <comment id="16047783" author="githubbot" created="Tue, 13 Jun 2017 12:12:41 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121657958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121657958&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.size() == 0) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This client side nulll check is better to add. I will add&lt;/p&gt;</comment>
                            <comment id="16047784" author="githubbot" created="Tue, 13 Jun 2017 12:15:02 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121658390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121658390&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;ACL&amp;gt; it = acl.iterator();&lt;/li&gt;
	&lt;li&gt;while (it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ACL a = it.next();&lt;/li&gt;
	&lt;li&gt;if (retval.contains(a) == false) {&lt;/li&gt;
	&lt;li&gt;retval.add(a);&lt;br/&gt;
    +        if(acl != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Server side, the validation for null is already present in fixupACL method and it throws InvalidACLException.  This check is after the removeDuplicates method call.&lt;/p&gt;

&lt;p&gt;    So do you mean we can handle null in removeDuplicates method itself and if so,, we can remove the null validation code in fixupACL method. &lt;/p&gt;</comment>
                            <comment id="16047785" author="githubbot" created="Tue, 13 Jun 2017 12:16:17 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121658648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121658648&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks for review . I will add the test case&lt;/p&gt;</comment>
                            <comment id="16048172" author="githubbot" created="Tue, 13 Jun 2017 17:49:54 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121749385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121749385&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;ACL&amp;gt; it = acl.iterator();&lt;/li&gt;
	&lt;li&gt;while (it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ACL a = it.next();&lt;/li&gt;
	&lt;li&gt;if (retval.contains(a) == false) {&lt;/li&gt;
	&lt;li&gt;retval.add(a);&lt;br/&gt;
    +        if(acl != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good point. I added the check for nulls on `removeDuplicates` because `Set` doesn&apos;t accept null entries. So, if there is a null in `acl` list then the first snippet I suggested would throw an exception.&lt;/p&gt;</comment>
                            <comment id="16048178" author="githubbot" created="Tue, 13 Jun 2017 17:56:50 +0000"  >&lt;p&gt;Github user eribeiro commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r121751200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r121751200&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java &amp;#8212;&lt;br/&gt;
    @@ -915,11 +915,13 @@ protected void pRequest(Request request) throws RequestProcessorException {&lt;br/&gt;
         private List&amp;lt;ACL&amp;gt; removeDuplicates(List&amp;lt;ACL&amp;gt; acl) {&lt;/p&gt;

&lt;p&gt;             ArrayList&amp;lt;ACL&amp;gt; retval = new ArrayList&amp;lt;ACL&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;ACL&amp;gt; it = acl.iterator();&lt;/li&gt;
	&lt;li&gt;while (it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ACL a = it.next();&lt;/li&gt;
	&lt;li&gt;if (retval.contains(a) == false) {&lt;/li&gt;
	&lt;li&gt;retval.add(a);&lt;br/&gt;
    +        if(acl != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    If we are going to keep the code we can at least modernize it a bit as below:&lt;br/&gt;
    ```&lt;br/&gt;
    for (ACL a : acl) {&lt;br/&gt;
        if (!retval.contains(a)) &lt;/p&gt;
{
            retval.add(a);
        }
&lt;p&gt;    }&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16058110" author="hadoopqa" created="Wed, 21 Jun 2017 20:08:24 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/819//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16059390" author="githubbot" created="Thu, 22 Jun 2017 13:31:17 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    All comments are addressed and CI failure is not related to this change. Please review.&lt;/p&gt;</comment>
                            <comment id="16062442" author="githubbot" created="Sun, 25 Jun 2017 22:25:15 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; Handled Null case in server. Client will get InvalidACLException&lt;/p&gt;

&lt;p&gt;    I don&apos;t see what code changes included in this patch that&apos;s corresponding to this. Maybe some changes were not uploaded?&lt;/p&gt;</comment>
                            <comment id="16062444" author="githubbot" created="Sun, 25 Jun 2017 22:27:39 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Please also avoid unnecessary file permission changes (100644 &#8594; 100755 as indicated by git diff).&lt;/p&gt;

&lt;p&gt;    Also a rebase is required as this PR is conflicting with &lt;a href=&quot;https://github.com/apache/zookeeper/pull/288/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/288/&lt;/a&gt; that&apos;s just merged in.&lt;/p&gt;</comment>
                            <comment id="16071425" author="hadoopqa" created="Sat, 1 Jul 2017 22:31:10 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/850//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16071946" author="githubbot" created="Mon, 3 Jul 2017 05:40:23 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    All review comments are taken care.  Please review. &lt;/p&gt;</comment>
                            <comment id="16076358" author="hadoopqa" created="Thu, 6 Jul 2017 10:55:10 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/864//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16077850" author="githubbot" created="Fri, 7 Jul 2017 09:14:42 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Comments are replied and updated in latest patch. Please review &lt;/p&gt;</comment>
                            <comment id="16079314" author="githubbot" created="Sat, 8 Jul 2017 20:56:51 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I am still not sure what this is about - there is no code change on server (ZooKeeper.java is part of client library). &lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; Handled Null case in server. Client will get InvalidACLException&lt;/p&gt;

&lt;p&gt;    Please update PR description to clarify this - either remove this or mention it&apos;s a client side change. PR description will be part of commit message so please keep it accurate.&lt;/p&gt;
</comment>
                            <comment id="16079316" author="githubbot" created="Sat, 8 Jul 2017 21:02:44 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r126290078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r126290078&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/test/ACLTest.java &amp;#8212;&lt;br/&gt;
    @@ -189,4 +191,110 @@ public void process(WatchedEvent event) {&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;br/&gt;
    +    &lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testNullACL() throws Exception {&lt;br/&gt;
    +        File tmpDir = ClientBase.createTmpDir();&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +        ZooKeeperServer zks = new ZooKeeperServer(tmpDir, tmpDir, 3000);&lt;br/&gt;
    +        final int PORT = Integer.parseInt(HOSTPORT.split(&quot;:&quot;)&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;br/&gt;
    +        ServerCnxnFactory f = ServerCnxnFactory.createFactory(PORT, -1);&lt;br/&gt;
    +        f.startup(zks);&lt;br/&gt;
    +        ZooKeeper zk = ClientBase.createZKClient(HOSTPORT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            // case 1 : null ACL with create&lt;br/&gt;
    +            try {&lt;br/&gt;
    +                zk.create(&quot;/foo&quot;, &quot;foo&quot;.getBytes(), null, CreateMode.PERSISTENT);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    All tests can be consolidated into a single try block to avoid duplicate the boilerplate code. &lt;/p&gt;</comment>
                            <comment id="16079859" author="githubbot" created="Mon, 10 Jul 2017 04:49:01 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r126334642&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r126334642&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/test/ACLTest.java &amp;#8212;&lt;br/&gt;
    @@ -189,4 +191,110 @@ public void process(WatchedEvent event) {&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;br/&gt;
    +    &lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testNullACL() throws Exception {&lt;br/&gt;
    +        File tmpDir = ClientBase.createTmpDir();&lt;br/&gt;
    +        ClientBase.setupTestEnv();&lt;br/&gt;
    +        ZooKeeperServer zks = new ZooKeeperServer(tmpDir, tmpDir, 3000);&lt;br/&gt;
    +        final int PORT = Integer.parseInt(HOSTPORT.split(&quot;:&quot;)&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;br/&gt;
    +        ServerCnxnFactory f = ServerCnxnFactory.createFactory(PORT, -1);&lt;br/&gt;
    +        f.startup(zks);&lt;br/&gt;
    +        ZooKeeper zk = ClientBase.createZKClient(HOSTPORT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            // case 1 : null ACL with create&lt;br/&gt;
    +            try {&lt;br/&gt;
    +                zk.create(&quot;/foo&quot;, &quot;foo&quot;.getBytes(), null, CreateMode.PERSISTENT);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    OK , will make these changes&lt;/p&gt;</comment>
                            <comment id="16079864" author="githubbot" created="Mon, 10 Jul 2017 04:54:31 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @hanm , Please refer the null check added in PrepRequestProcessor class in server side to safeguard against NPE.  Client side null check is added for early validation and early feedback to the user. &lt;/p&gt;
</comment>
                            <comment id="16080660" author="githubbot" created="Mon, 10 Jul 2017 17:07:01 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r126481060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r126481060&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.isEmpty() || acl.contains(null)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    These validations should also be applied on async create APIs &lt;/p&gt;

&lt;p&gt;    1. org.apache.zookeeper.ZooKeeper.create(String, byte[], List&amp;lt;ACL&amp;gt;, CreateMode, Create2Callback, Object, long) &lt;br/&gt;
    2. org.apache.zookeeper.ZooKeeper.create(String, byte[], List&amp;lt;ACL&amp;gt;, CreateMode, StringCallback, Object)&lt;/p&gt;</comment>
                            <comment id="16080667" author="githubbot" created="Mon, 10 Jul 2017 17:11:42 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r126482088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r126482088&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1535,7 +1535,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             RequestHeader h = new RequestHeader();&lt;br/&gt;
             setCreateHeader(createMode, h);&lt;br/&gt;
             Create2Response response = new Create2Response();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.isEmpty() || acl.contains(null)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    As this Validation we are doing multiple places it would be better if this piece of code is extracted to method. Some thing like&lt;br/&gt;
     ` private void validateACL(List&amp;lt;ACL&amp;gt; acl) throws InvalidACLException {&lt;br/&gt;
            if (acl == null || acl.isEmpty() || acl.contains(null)) &lt;/p&gt;
{
                throw new KeeperException.InvalidACLException();
            }
&lt;p&gt;        }`&lt;br/&gt;
    and put this method along with other validation methods for example &lt;br/&gt;
    `&lt;br/&gt;
    PathUtils.validatePath(clientPath, createMode.isSequential());&lt;br/&gt;
            EphemeralType.validateTTL(createMode, -1);&lt;br/&gt;
            validateACL(acl);&lt;br/&gt;
    `&lt;/p&gt;
</comment>
                            <comment id="16081647" author="githubbot" created="Tue, 11 Jul 2017 04:40:28 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r126593104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r126593104&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.isEmpty() || acl.contains(null)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +1 on this. We can throw IllegalArgumentException instead of KeeperException (which would change API signature) on async methods. It&apos;s good to catch the bad arguments at client side.&lt;/p&gt;</comment>
                            <comment id="16081650" author="githubbot" created="Tue, 11 Jul 2017 04:41:21 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; Please refer the null check added in PrepRequestProcessor class in server side to safeguard against NPE. &lt;/p&gt;

&lt;p&gt;    @jainbhupendra24 thanks for clarification. &lt;/p&gt;</comment>
                            <comment id="16087254" author="githubbot" created="Fri, 14 Jul 2017 12:39:04 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r127447190&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r127447190&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.isEmpty() || acl.contains(null)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Throwing IllegalArgumentException is the correct way but it may break the existing behavior. Consider the case where application code is like &lt;/p&gt;

&lt;p&gt;               zk.create(callBackHandler)` // call to create api and callback handler is passed&lt;br/&gt;
               doSomething();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;- - -  // some more stuff&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    At present, if client pass null ACL parameter, the error will be handled by callBackHandler and in application code doSomething() method will execute. &lt;/p&gt;

&lt;p&gt;    But if we throw IllegalArgumentException , then doSomething() method will not execute. So it will change the existing behavior of application code. &lt;/p&gt;

&lt;p&gt;    Please suggest if we really need to handle this case. &lt;/p&gt;</comment>
                            <comment id="16093320" author="githubbot" created="Wed, 19 Jul 2017 16:00:24 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279#discussion_r128291070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279#discussion_r128291070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ZooKeeper.java &amp;#8212;&lt;br/&gt;
    @@ -1436,7 +1436,7 @@ public String create(final String path, byte data[], List&amp;lt;ACL&amp;gt; acl,&lt;br/&gt;
             request.setData(data);&lt;br/&gt;
             request.setFlags(createMode.toFlag());&lt;br/&gt;
             request.setPath(serverPath);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (acl != null &amp;amp;&amp;amp; acl.size() == 0) {&lt;br/&gt;
    +        if (acl == null || acl.isEmpty() || acl.contains(null)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks @jainbhupendra24 for the details. We can leave these functions as it is. It is trivial problem we can ignore over the backward compatibility.&lt;/p&gt;</comment>
                            <comment id="16131689" author="githubbot" created="Fri, 18 Aug 2017 04:18:13 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Let&apos;s wrap this up before it becoming more stale. I believe the only remaining work item is the last review comment @arshadmohammad made:&lt;br/&gt;
    &amp;gt;&amp;gt; As this Validation we are doing multiple places it would be better if this piece of code is extracted to method. &lt;br/&gt;
    @jainbhupendra24 Do you mind update this pull request and do what Arshad suggested?&lt;/p&gt;</comment>
                            <comment id="16131709" author="githubbot" created="Fri, 18 Aug 2017 04:39:40 +0000"  >&lt;p&gt;Github user jainbhupendra24 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @hanm , I will update the patch&lt;/p&gt;</comment>
                            <comment id="16133520" author="hadoopqa" created="Fri, 18 Aug 2017 19:19:57 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/948//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16133651" author="githubbot" created="Fri, 18 Aug 2017 21:35:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16133654" author="githubbot" created="Fri, 18 Aug 2017 21:37:53 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jainbhupendra24 merged to master: d7c192c1829cc657d3312f47ecb5b97519d1b30d&lt;/p&gt;

&lt;p&gt;    Do you mind create separate pull requests targeting branch-3.5, and branch-3.4 respectively? The current pull request has merge conflicts with those branches. &lt;/p&gt;</comment>
                            <comment id="16133784" author="hudson" created="Fri, 18 Aug 2017 23:41:29 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3504 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3504/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3504/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2804&quot; title=&quot;Node creation fails with NPE if ACLs are null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2804&quot;&gt;&lt;del&gt;ZOOKEEPER-2804&lt;/del&gt;&lt;/a&gt;: Node creation fails with NPE if ACLs are null (hanm: rev d7c192c1829cc657d3312f47ecb5b97519d1b30d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/ZooKeeper.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/ACLTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g2zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>