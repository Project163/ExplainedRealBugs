<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:03:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3769] fast leader election does not end if leader is taken down</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3769</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;In a cluster with three nodes, node3 is the leader and the other nodes are followers.&lt;/p&gt;

&lt;p&gt;If I stop node3, the other two nodes do not finish the leader election.&lt;/p&gt;

&lt;p&gt;This is happening with ZK 3.5.7,&#160; openjdk version &quot;12.0.2&quot; 2019-07-16, and this config&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;tickTime=2000&lt;br/&gt;
 initLimit=30&lt;br/&gt;
 syncLimit=3&lt;br/&gt;
 dataDir=/company/service/data&lt;br/&gt;
 dataLogDir=/company/service/log&lt;br/&gt;
 clientPort=2181&lt;br/&gt;
 snapCount=100000&lt;br/&gt;
 autopurge.snapRetainCount=3&lt;br/&gt;
 autopurge.purgeInterval=1&lt;br/&gt;
 skipACL=yes&lt;br/&gt;
 preAllocSize=65536&lt;br/&gt;
 maxClientCnxns=0&lt;br/&gt;
 4lw.commands.whitelist=*&lt;br/&gt;
 admin.enableServer=false&lt;/p&gt;

&lt;p&gt;server.1=companydemo1.snc4.companyinc.com:3000:4000&lt;br/&gt;
 server.2=companydemo2.snc4.companyinc.com:3000:4000&lt;br/&gt;
 server.3=companydemo3.snc4.companyinc.com:3000:4000&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you have a look at the logs and help me figure this out? It seems like node 1 is not getting notifications back from node2, but I don&apos;t see anything wrong with the network so I am wondering if bugs like&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3756&quot; title=&quot;Members failing to rejoin quorum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3756&quot;&gt;&lt;del&gt;ZOOKEEPER-3756&lt;/del&gt;&lt;/a&gt; could be causing it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In the logs, node3 is killed at 11:17:14&lt;/p&gt;

&lt;p&gt;node2 is killed at 11:17:50 2 and node 1 at&#160;11:18:02&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13293614">ZOOKEEPER-3769</key>
            <summary>fast leader election does not end if leader is taken down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="symat">Mate Szalay-Beko</assignee>
                                    <reporter username="lasaro">Lasaro Camargos</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 24 Mar 2020 18:49:05 +0000</created>
                <updated>Mon, 11 May 2020 15:41:05 +0000</updated>
                            <resolved>Tue, 7 Apr 2020 07:09:17 +0000</resolved>
                                    <version>3.5.7</version>
                                    <fixVersion>3.7.0</fixVersion>
                    <fixVersion>3.6.1</fixVersion>
                    <fixVersion>3.5.8</fixVersion>
                                    <component>leaderElection</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="15000">4h 10m</timespent>
                                <comments>
                            <comment id="17066185" author="lasaro" created="Tue, 24 Mar 2020 21:22:15 +0000"  >&lt;p&gt;Just to complement on the behavior (not covered by the logs), if I bring node 3 back up, it becomes the leader, 2 a follower, and 1 does not finish the election.&lt;/p&gt;

&lt;p&gt;If I stop and restart node 1, then it joins the cluster successfully.&lt;/p&gt;

&lt;p&gt;It seems like the connection from 1 to 2 needs a &quot;refresh&quot; in order to work properly.&lt;/p&gt;</comment>
                            <comment id="17066245" author="lasaro" created="Tue, 24 Mar 2020 22:48:53 +0000"  >&lt;p&gt;After I enabled SASL in order to force the asynchronous creation of sockets, the problem no longer reproduces. Hence I am guessing this might be related to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-900&quot; title=&quot;FLE implementation should be improved to use non-blocking sockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-900&quot;&gt;ZOOKEEPER-900&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17066710" author="symat" created="Wed, 25 Mar 2020 14:19:22 +0000"  >&lt;p&gt;Thanks for the logs and all the details! I still try to understand what exactly happened here.&lt;/p&gt;

&lt;p&gt;Unfortunately the logs for Server 3 are ended around 11:16:15. Maybe not all the log messages got flushed to the log file.&lt;/p&gt;

&lt;p&gt;The first thing I found is that after killing Server 3, both Server 1 and 2 are starting a new leader election (around 11:17:14) and sending their votes to each other, but the Server 1 never received the votes of Server 2 while Server 2 receives the votes of Server 1.&lt;/p&gt;

&lt;p&gt;The second interesting thing is that after 11:17:14 only Server 2 tries to establish connection periodically to Server 3. Server 1 doesn&apos;t realize that the connection is broken.&lt;/p&gt;

&lt;p&gt;Something is really odd with Server 1...&lt;/p&gt;

&lt;p&gt;There is an important error for Server 1, which can explains maybe the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
03/24/20 11:16:16,297 [WorkerReceiver[myid=1]] ERROR [org.apache.zookeeper.server.NIOServerCnxnFactory] (NIOServerCnxnFactory.java:92) - &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[WorkerReceiver[myid=1],5,main] died

java.nio.BufferUnderflowException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
     at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:178) ~[?:?]
     at java.nio.ByteBuffer.get(ByteBuffer.java:762) ~[?:?]
     at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerReceiver.run(FastLeaderElection.java:278) ~[zookeeper-3.5.7.jar:3.5.7]                                                                                
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As far as I can tell, this exception (and the serve 1 and 3 log messages before this time) suggests that somehow a partial message got transferred from Server 3 to Server 1 causing some unexpected problems. Also for some reason the connection got broken between Server 3 and Server 1 way before 11:17:14.&lt;/p&gt;

&lt;p&gt;This is a strange scenario, I haven&apos;t seen it yet. I will continue the investigation.&lt;/p&gt;

&lt;p&gt;At the moment my guess is that this should be some OS / JDK / network related issue that triggers some unhandled exception in ZooKeeper. Would it be possible for you to try out two things?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;does the same problem appear with an older Java version? (e.g. latest OpenJDK 8) I&apos;m wondering why we don&apos;t handle this particular exception in the code, maybe this is something we haven&apos;t seen before with the older JDK versions?&lt;/li&gt;
	&lt;li&gt;does the same problem appear with using the &lt;tt&gt;zookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory&lt;/tt&gt; in zoo.cfg? In the new ZooKeeper Netty is also supported (actually it is necessary to switch to Netty, if someone wants to use SSL in ZooKeeper). Maybe using Netty instead of NIO would solve the problem.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If any of these workarounds would help, then still we have an issue in ZooKeeper (at least about handling this exception correctly). But it would help in the investigation to see if any of these changes would fix the problem.&lt;/p&gt;</comment>
                            <comment id="17066943" author="lasaro" created="Wed, 25 Mar 2020 18:08:51 +0000"  >&lt;p&gt;Thank you for the analysis, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Wrt to testing with NETTY, before trying SASL I did try just NETTY, but the behavior was exactly the same.&lt;/p&gt;

&lt;p&gt;Wrt to using an&#160;older JDK, I reverted all my changes to the configs and put back the original version, 3.5.5, but didn&apos;t get to try other JDK.&#160;The problem no longer reproduces and I am still trying to figure if/what I am missing that might have changed the setup.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regarding not handling the BufferUnderflowException properly, yes, it makes sense; the thread died and wasn&apos;t recreated so no more messages were ever received.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17067385" author="symat" created="Thu, 26 Mar 2020 06:19:31 +0000"  >&lt;p&gt;Sorry, I just wrote the NETTY config parameter wrong. I guess you did it right when you tested it, still let me correct myself. You need &lt;tt&gt;serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory&lt;/tt&gt; in the zoo.cfg, or using the system property &lt;tt&gt;-Dzookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I will try to reproduce the issue locally with Docker using ZooKeeper 3.5.7 and OpenJDK 12.0.2. Although I am not sure if this can be reproduced in Docker...&lt;/p&gt;

&lt;p&gt;I will also create a small patch to handle this BufferUnderflowException exception. Do you see this same exception all the time when some of the server fails to rejoin? Or was this only a single random error?&lt;/p&gt;</comment>
                            <comment id="17067433" author="symat" created="Thu, 26 Mar 2020 07:20:06 +0000"  >&lt;p&gt;What OS version are you using?&lt;/p&gt;</comment>
                            <comment id="17067521" author="symat" created="Thu, 26 Mar 2020 09:09:44 +0000"  >&lt;p&gt;I was trying to reproduce the issue using ZooKeeper 3.5.7 and OpenJDK 12.0.2 with:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this compose file: &lt;a href=&quot;https://github.com/symat/zookeeper-docker-test/blob/master/3_nodes_zk_jdk_12.yml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/symat/zookeeper-docker-test/blob/master/3_nodes_zk_jdk_12.yml&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;this config (based on your config): &lt;a href=&quot;https://github.com/symat/zookeeper-docker-test/blob/master/conf/ZOOKEEPER-3769_zoo.cfg&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/symat/zookeeper-docker-test/blob/master/conf/ZOOKEEPER-3769_zoo.cfg&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I used OpenJDK 12.0.2 runtime in the docker containers. And I was trying out ZooKeeper 3.5.7 compiled both with 8u424 and with 12.0.2.&lt;/p&gt;

&lt;p&gt;Unfortunately everything was working fine... I haven&apos;t seen the BufferUnderflowException and the quorum was up quickly after I stopped the container of Server 3 (which was the leader perviously).&lt;/p&gt;

&lt;p&gt;Maybe it is an OS / networking related thing which can not be simulated with docker on a single machine. Anyway, I will create a patched version to handle this exception.&lt;/p&gt;</comment>
                            <comment id="17067546" author="symat" created="Thu, 26 Mar 2020 09:49:28 +0000"  >&lt;p&gt;I created a patched 3.5.7 version, where the exception is caught and the malformed message is skipped. Can you maybe try out this version?&lt;br/&gt;
&lt;a href=&quot;https://drive.google.com/open?id=1cTdusaEFIVvH2D5KSrj6M9VVJoqlaQwD&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/open?id=1cTdusaEFIVvH2D5KSrj6M9VVJoqlaQwD&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This should print out a warning to the log after catching the exception: &lt;br/&gt;
&lt;tt&gt;Skipping the processing of a partial / malformed response message sent by sid=XXX&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17068032" author="lasaro" created="Thu, 26 Mar 2020 20:48:16 +0000"  >&lt;p&gt;I went back and looked into some older logs and could confirm that the WorkerReceiver died and that&apos;s what caused the election to hang. However, the BufferUnderflowException was present in very few instances. Most of the time, it was a NegativeArraySizeException that was caught, but pretty much in the same situation, that is, after the connection being broken to node3. The following are excerpts from node1 and node 3. Let me know if you would like to have a look at the full logs.&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,772 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.ZooKeeperServer&amp;#93;&lt;/span&gt; (ZooKeeperServer.java:166) - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir /company/service/log/version-2 snapdir /company/service/data/version-2&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,772 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (Follower.java:69) - FOLLOWING - LEADER ELECTION TOOK - 9 MS&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,774 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumPeer&amp;#93;&lt;/span&gt; (QuorumPeer.java:202) - Resolved address for companydemo3.snc4.companyinc.com: companydemo3.snc4.companyinc.com/172.22.64.148&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,793 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i UNKNOWN17 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,798 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i DIFF 40000001f null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,799 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (Learner.java:391) - Getting a diff from the leader 0x40000001f&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,801 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i NEWLEADER 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,801 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (Learner.java:546) - Learner received NEWLEADER message&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,815 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i UPTODATE ffffffffffffffff null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Learner&amp;#93;&lt;/span&gt; (Learner.java:529) - Learner received UPTODATE message&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumPeer&amp;#93;&lt;/span&gt; (QuorumPeer.java:1916) - Reconfig feature is disabled, skip reconfig processing.&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,817 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.CommitProcessor&amp;#93;&lt;/span&gt; (CommitProcessor.java:256) - Configuring CommitProcessor with 32 worker threads.&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,064 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:924) - Received connection request 172.22.30.98:58472&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,064 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1038) - Address of remote peer: 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,064 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,064 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1072) - Removing entry from senderWorkerMap sid=3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:3&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1143) - Interrupted while waiting for message on queue&lt;/p&gt;

&lt;p&gt;java.lang.InterruptedException: null&lt;/p&gt;

&lt;p&gt;at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2056) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2133) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.util.concurrent.ArrayBlockingQueue.poll(ArrayBlockingQueue.java:432) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:1294) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$700(QuorumCnxManager.java:82) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:1131) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:3&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1114) - Attempting to send lastMessage to sid=3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:3&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.FastLeaderElection&amp;#93;&lt;/span&gt; (FastLeaderElection.java:267) - Backward compatibility mode (28 bits), server id: 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:3&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1227) - Connection broken for id 3, my id = 1, error =&lt;/p&gt;

&lt;p&gt;java.net.SocketException: Socket closed&lt;/p&gt;

&lt;p&gt;at java.net.SocketInputStream.socketRead0(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.net.SocketInputStream.socketRead(SocketInputStream.java:115) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.net.SocketInputStream.read(SocketInputStream.java:168) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.net.SocketInputStream.read(SocketInputStream.java:140) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.io.BufferedInputStream.fill(BufferedInputStream.java:252) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.io.BufferedInputStream.read(BufferedInputStream.java:271) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.io.DataInputStream.readInt(DataInputStream.java:392) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:1212) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:3&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1153) - Send worker leaving thread id 3 my id = 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.FastLeaderElection&amp;#93;&lt;/span&gt; (FastLeaderElection.java:309) - Backward compatibility mode (before reconfig), server id: 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:3&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1230) - Interrupting SendWorker&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:3&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.FastLeaderElection&amp;#93;&lt;/span&gt; (FastLeaderElection.java:332) - Receive new notification message. My id = 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,067 [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.FastLeaderElection&amp;#93;&lt;/span&gt; (FastLeaderElection.java:679) - Notification: 0 (message format version), 0 (n.leader), 0x583c5800d6340d (n.zxid), 0xb71421b100000000 (n.round), FOLLOWING (n.state), 3 (n.sid), 0x583c58 (n.peerEPoch), FOLLOWING (my state)&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,127 [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;] ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.NIOServerCnxnFactory&amp;#93;&lt;/span&gt; (NIOServerCnxnFactory.java:92) - Thread Thread[WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;,5,main] died&lt;/p&gt;

&lt;p&gt;java.lang.NegativeArraySizeException: -1082130432&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerReceiver.run(FastLeaderElection.java:276) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at java.lang.Thread.run(Thread.java:835) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,729 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:924) - Received connection request 172.22.24.91:44072&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,729 &lt;span class=&quot;error&quot;&gt;&amp;#91;companydemo1.snc4.companyinc.com/172.22.65.65:4000&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1038) - Address of remote peer: 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,730 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1227) - Connection broken for id 1, my id = 1, error =&lt;/p&gt;

&lt;p&gt;java.io.EOFException: null&lt;/p&gt;

&lt;p&gt;at java.io.DataInputStream.readInt(DataInputStream.java:397) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:1212) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,731 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1230) - Interrupting SendWorker&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,731 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,732 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1072) - Removing entry from senderWorkerMap sid=1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:48,732 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1143) - Interrupted while waiting for message on queue&lt;/p&gt;

&lt;p&gt;java.lang.InterruptedException: null&lt;/p&gt;

&lt;p&gt;at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2056) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Node 3&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,796 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (LearnerHandler.java:480) - Sending NEWLEADER message to 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,797 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o DIFF 40000001f null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,797 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o DIFF 40000001f null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,798 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o NEWLEADER 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,798 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o NEWLEADER 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,804 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (LearnerHandler.java:513) - Received NEWLEADER-ACK message from 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,804 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.64.47:44648&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (LearnerHandler.java:513) - Received NEWLEADER-ACK message from 2&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,804 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Leader&amp;#93;&lt;/span&gt; (Leader.java:1296) - Have quorum of supporters, sids: [ &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 3&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;1, 3&amp;#93;&lt;/span&gt; ]; starting up and setting last processed zxid: 0x500000000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,805 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumPeer&amp;#93;&lt;/span&gt; (QuorumPeer.java:1916) - Reconfig feature is disabled, skip reconfig processing.&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,806 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x104c41214550000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x104c41214550000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x204c3f1cea10000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x204c3f1cea10000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x304c3eda5410000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x304c3eda5410000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x204c3ef8a220000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,807 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x204c3ef8a220000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,808 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x304c3eb60c30000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,808 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x304c3eb60c30000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,808 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x104c40fcfd70000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,808 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x104c40fcfd70000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,810 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.CommitProcessor&amp;#93;&lt;/span&gt; (CommitProcessor.java:256) - Configuring CommitProcessor with 32 worker threads.&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,812 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.PrepRequestProcessor&amp;#93;&lt;/span&gt; (PrepRequestProcessor.java:99) - zookeeper.skipACL==&quot;yes&quot;, ACL checks will be skipped&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,814 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=3&amp;#93;&lt;/span&gt;(plain=&lt;span class=&quot;error&quot;&gt;&amp;#91;0:0:0:0:0:0:0:0&amp;#93;&lt;/span&gt;:2181)(secure=disabled)] INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.ContainerManager&amp;#93;&lt;/span&gt; (ContainerManager.java:64) - Using checkIntervalMs=60000 maxPerMinute=10000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (LearnerHandler.java:534) - Sending UPTODATE message to 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.64.47:44648&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (LearnerHandler.java:534) - Sending UPTODATE message to 2&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o UPTODATE ffffffffffffffff null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;Sender-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - o UPTODATE ffffffffffffffff null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i ACK 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Leader&amp;#93;&lt;/span&gt; (Leader.java:849) - Ack zxid: 0x500000000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.LearnerHandler&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - i ACK 500000000 null&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.64.47:44648&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Leader&amp;#93;&lt;/span&gt; (Leader.java:855) - outstanding proposals all&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,816 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Leader&amp;#93;&lt;/span&gt; (Leader.java:849) - Ack zxid: 0x500000000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:45,817 &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/172.22.65.65:60166&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.Leader&amp;#93;&lt;/span&gt; (Leader.java:855) - outstanding proposals all&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1227) - Connection broken for id 1, my id = 3, error =&lt;/p&gt;

&lt;p&gt;java.io.EOFException: null&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at java.io.DataInputStream.readInt(DataInputStream.java:397) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:1212) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1230) - Interrupting SendWorker&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,065 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;RecvWorker:1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1072) - Removing entry from senderWorkerMap sid=1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1143) - Interrupted while waiting for message on queue&lt;/p&gt;

&lt;p&gt;java.lang.InterruptedException: null&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2056) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2133) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at java.util.concurrent.ArrayBlockingQueue.poll(ArrayBlockingQueue.java:432) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:1294) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$700(QuorumCnxManager.java:82) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:1131) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.5.7.jar:3.5.7&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1055) - Calling finish for 1&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:46,066 &lt;span class=&quot;error&quot;&gt;&amp;#91;SendWorker:1&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.quorum.QuorumCnxManager&amp;#93;&lt;/span&gt; (QuorumCnxManager.java:1153) - Send worker leaving thread&#160; id 1 my id = 3&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,290 &lt;span class=&quot;error&quot;&gt;&amp;#91;NIOServerCxnFactory.AcceptThread:0.0.0.0/0.0.0.0:2181&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.NIOServerCnxnFactory&amp;#93;&lt;/span&gt; (NIOServerCnxnFactory.java:296) - Accepted socket connection from /172.22.64.148:41132&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,295 &lt;span class=&quot;error&quot;&gt;&amp;#91;NIOWorkerThread-1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.ZooKeeperServer&amp;#93;&lt;/span&gt; (ZooKeeperServer.java:1001) - Session establishment request from client /172.22.64.148:41132 client&apos;s lastZxid is 0x0&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,295 &lt;span class=&quot;error&quot;&gt;&amp;#91;NIOWorkerThread-1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (SessionTrackerImpl.java:274) - Adding session 0x304c3f1b81c0000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,295 &lt;span class=&quot;error&quot;&gt;&amp;#91;NIOWorkerThread-1&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.SessionTrackerImpl&amp;#93;&lt;/span&gt; (ZooTrace.java:71) - SessionTrackerImpl &amp;#8212; Adding session 0x304c3f1b81c0000 40000&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,296 &lt;span class=&quot;error&quot;&gt;&amp;#91;NIOWorkerThread-1&amp;#93;&lt;/span&gt; DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.ZooKeeperServer&amp;#93;&lt;/span&gt; (ZooKeeperServer.java:1052) - Client attempting to establish new session: session = 0x304c3f1b81c0000, zxid = 0x0, timeout = 60000, address = /172.22.64.148:41132&lt;/p&gt;

&lt;p&gt;03/23/20 10:14:50,296 &lt;span class=&quot;error&quot;&gt;&amp;#91;ProcessThread(sid:3 cport:-1):&amp;#93;&lt;/span&gt; TRACE &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.zookeeper.server.PrepRequestProcessor&amp;#93;&lt;/span&gt; (ZooTrace.java:88) - :Psessionid:0x304c3f1b81c0000 type:createSession cxid:0x0 zxid:0xfffffffffffffffe txntype:unknown reqpath:n/a&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17068558" author="symat" created="Fri, 27 Mar 2020 10:54:09 +0000"  >&lt;p&gt;Thanks, this is an important observation. It also means that the first patched ZooKeeper I shared with you will not help in all cases.&lt;/p&gt;

&lt;p&gt;I will create a more complete patch and send it to you later today. I will also try to write some unit tests to generate malformed / partial notification messages.&lt;/p&gt;

&lt;p&gt;But I am still&#160;confused why no one have seen this problem before. Is there anything special in your networking setup? Are you maybe using some tunnels?&lt;/p&gt;

&lt;p&gt;Also: are you starting the cluster with an empty snapshot, or you always boot the cluster from an existing snapshot when you do these tests? Have you used dynamic reconfig in the cluster before?&lt;/p&gt;</comment>
                            <comment id="17068796" author="symat" created="Fri, 27 Mar 2020 15:07:45 +0000"  >&lt;p&gt;I was able to reproduce all these exceptions (and more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) with some unit tests and did some changes in the code to properly handle the error cases. I hope this will help in your case.&lt;/p&gt;

&lt;p&gt;This is the commit I created (on top of branch 3.5): &lt;a href=&quot;https://github.com/symat/zookeeper/commit/c080690adfab1bb4be2a3c4ba34a9b80e00d32f0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/symat/zookeeper/commit/c080690adfab1bb4be2a3c4ba34a9b80e00d32f0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I compiled a new patched ZooKeeper for you:&lt;br/&gt;
&lt;a href=&quot;https://drive.google.com/open?id=1kjG7JO3n1SDe2EduI_dGvfZzq0a-SwEy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/open?id=1kjG7JO3n1SDe2EduI_dGvfZzq0a-SwEy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is it possible for you to test this version?&lt;br/&gt;
If it would work, then I would submit a Pull Request.&lt;/p&gt;</comment>
                            <comment id="17068985" author="lasaro" created="Fri, 27 Mar 2020 18:57:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;, thanks for the updated patch. I gave it a spin and it is working, as in its not regressing anything else. I cannot confirm that it handles the issue I had as I still haven&apos;t managed to reproduce.&lt;br/&gt;
Trying to answer your questions,&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;There is nothing particular to this setup; all are physical boxes, running on the same network, OS (centos 7) and java version (12)&lt;/li&gt;
	&lt;li&gt;During the time the problem reproduced, I had multiple runs in which I just restarted the service, but also runs in which I cleaned the setup. It consistently reproduced, until it didn&apos;t. Whatever it was, it doesn&apos;t seem related to the snapshots.&lt;/li&gt;
	&lt;li&gt;Regarding dynamic reconfiguration, no, I haven&apos;t used it in this setup.&lt;/li&gt;
	&lt;li&gt;You had asked me if I had tried Netty. Please ignore my previous response. I didn&apos;t try it while the problem still reproduced.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Even if I cannot reproduce, I still think this is a fix worth having. Please submit the PR.&lt;/p&gt;

&lt;p&gt;Should I change the Jira name to better reflect what actually happened?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17070017" author="symat" created="Sat, 28 Mar 2020 20:09:06 +0000"  >&lt;p&gt;Thanks for all the background info, and for testing the patch! And also thanks for the comment on the commit! (I asked the dynamic re-config, because that affects the vote message content as well)&lt;/p&gt;

&lt;p&gt;I agree, this patch makes sense anyway, it never hurts to handle exceptions in the code, even if they are exceptionally hard to reproduce &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t think you should change the Jira title, it kind of shows the symptom. But feel free to change it if you want. I submitted the PR on the master branch, but I am sure we will backport it to both 3.6 and 3.5 branches. Actually this error is also present on branch 3.4, but I am not sure if we will add the fix there, as 3.4 is practically EOL by now. But if you would need it on 3.4 then let me know!&lt;/p&gt;</comment>
                            <comment id="17070311" author="lasaro" created="Sun, 29 Mar 2020 12:28:00 +0000"  >&lt;p&gt;I had to backtrack on it happening with Netty. The factory was&lt;br/&gt;
misconfigured and it was actually running on NIO.&lt;br/&gt;
Regarding the version, I tried 3.5.5 and 3.5.7.&lt;/p&gt;

&lt;p&gt;L&#225;saro&lt;/p&gt;


&lt;p&gt;On Sun, Mar 29, 2020 at 4:26 AM ASF GitHub Bot (Jira) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="17070777" author="symat" created="Mon, 30 Mar 2020 08:16:18 +0000"  >&lt;p&gt;OK, thanks for the info!&lt;/p&gt;</comment>
                            <comment id="17074812" author="lasaro" created="Fri, 3 Apr 2020 18:51:39 +0000"  >&lt;p&gt;thanks for driving this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17076984" author="eolivelli" created="Tue, 7 Apr 2020 07:09:17 +0000"  >&lt;p&gt;Committed to master and branch-3.6&lt;br/&gt;
thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=symat&quot; class=&quot;user-hover&quot; rel=&quot;symat&quot;&gt;symat&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17076985" author="eolivelli" created="Tue, 7 Apr 2020 07:10:17 +0000"  >&lt;p&gt;Committed the port to branch-3.5 as well.&lt;/p&gt;</comment>
                            <comment id="17104572" author="symat" created="Mon, 11 May 2020 15:41:05 +0000"  >&lt;p&gt;closed after releasing 3.5.8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12997598" name="node1.log" size="49279" author="lasaro" created="Tue, 24 Mar 2020 19:07:59 +0000"/>
                            <attachment id="12997597" name="node2.log" size="131351" author="lasaro" created="Tue, 24 Mar 2020 19:07:59 +0000"/>
                            <attachment id="12997596" name="node3.log" size="32889" author="lasaro" created="Tue, 24 Mar 2020 19:07:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cuug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>