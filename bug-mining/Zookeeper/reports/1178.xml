<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:05:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-4921] Zookeeper Client 3.9.3 Fails to Reconnect After Network Failures</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-4921</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;After upgrading the Java Zookeeper client to version 3.9.3, we observed that it is not resilient to brief network disruptions, such as a short VPN blip. In such cases, the client attempts to reconnect only once, and if unsuccessful, the session expires.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Apr 23, 2025 10:19:23 AM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process&lt;br/&gt;
INFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In contrast, the previous version (3.9.2) would continuously retry until the network connection was restored, maintaining the session more reliably.&lt;/p&gt;

&lt;p&gt;I believe it&apos;s a new issue with this change: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-4508&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-4508&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Step to repro:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Open VPN.&lt;/li&gt;
	&lt;li&gt;Start the application which connects to the Zookeeper server with the VPN.&lt;/li&gt;
	&lt;li&gt;Disable VPN for a couple of minutes.&lt;/li&gt;
	&lt;li&gt;Observe the application.&lt;/li&gt;
	&lt;li&gt;Enable the VPN again.&lt;/li&gt;
&lt;/ol&gt;


&lt;blockquote&gt;&lt;p&gt;3.9.3:&lt;br/&gt;
&quot;message&quot; : &quot;Session 0x0 for server XXX, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.&quot;,&lt;br/&gt;
&#160; &quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 5590ms for session id 0x0&lt;br/&gt;
&#160; &#160; &#160; &#160; at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;3.9.2: Application will be reconnected successfully.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13616163">ZOOKEEPER-4921</key>
            <summary>Zookeeper Client 3.9.3 Fails to Reconnect After Network Failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kezhuw">Kezhu Wang</assignee>
                                    <reporter username="tranvanchuong1995">Chuong Tran</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 23 Apr 2025 17:51:59 +0000</created>
                <updated>Fri, 29 Aug 2025 21:29:00 +0000</updated>
                            <resolved>Sun, 11 May 2025 02:20:55 +0000</resolved>
                                    <version>3.9.3</version>
                                    <fixVersion>3.10.0</fixVersion>
                    <fixVersion>3.9.4</fixVersion>
                                    <component>java client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17946769" author="JIRAUSER309503" created="Wed, 23 Apr 2025 17:53:36 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andor&quot; class=&quot;user-hover&quot; rel=&quot;andor&quot;&gt;andor&lt;/a&gt; as I see your comment on the previous issue.&lt;/p&gt;</comment>
                            <comment id="17946772" author="ctubbsii" created="Wed, 23 Apr 2025 18:02:13 +0000"  >&lt;p&gt;The Accumulo team has noticed this and has developed a solution, a &quot;ZooSession&quot; object that mostly mimics the API of ZooKeeper client object, and automatically reconnects. However, it needs additional work to be fully resilient to exceptions thrown due to transient failures. Some of that is encapsulated in a helper &quot;ZooReader&quot; and &quot;ZooReaderWriter&quot; objects which retry operations on transient errors, and plan to merge those into the ZooSession feature. I think if we can make it resilient enough to be generally useful, it is something that we could contribute directly to the ZooKeeper project. However, that requires some time to polish up the API and behavior, and we have a lot of other development tasks we&apos;re working on.&lt;/p&gt;

&lt;p&gt;But, I think the idea is sound. It&apos;s very weird, after all, that the ZK client is useless after network failures. It&apos;s a bit like having to restart your browser every time you navigate to website with an error. That shouldn&apos;t be necessary.&lt;/p&gt;

&lt;p&gt;You may want to take a look at the workarounds that the Accumulo project has come up with for handling these transient issues.&lt;/p&gt;</comment>
                            <comment id="17946897" author="kezhuw" created="Thu, 24 Apr 2025 01:30:22 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tranvanchuong1995&quot; class=&quot;user-hover&quot; rel=&quot;tranvanchuong1995&quot;&gt;tranvanchuong1995&lt;/a&gt;, did you have more logs during repro steps ?&lt;/p&gt;

&lt;p&gt;&amp;gt;&#160; Disable VPN for a couple of minutes.&lt;/p&gt;

&lt;p&gt;What is the ZooKeeper session timeout ? &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-4508&quot; title=&quot;ZooKeeper client run to endless loop in ClientCnxn.SendThread.run if all server down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-4508&quot;&gt;&lt;del&gt;ZOOKEEPER-4508&lt;/del&gt;&lt;/a&gt; enforced client side check to expire zookeeper session in case of unreachable of cluster to avoid endless reconnection(a.k.a. no &lt;tt&gt;Expired&lt;/tt&gt; after lose connection to cluster). The timeout is &lt;tt&gt;sessionTimeout * 4 /3&lt;/tt&gt;. The default max session timeout in zookeeper is 1 minute, &quot;a couple of minutes&quot; usually enough for a zookeeper session to expire.&lt;/p&gt;</comment>
                            <comment id="17946903" author="kezhuw" created="Thu, 24 Apr 2025 02:25:24 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 5590ms for session id 0x0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the log when client decide to give up retry.&lt;br/&gt;
1. This log comes from an unestablished zookeeper session as it prints &quot;session id 0x0&quot;.&lt;br/&gt;
2. The server is configured with a small session timeout as the default min expiration timeout in client is &lt;tt&gt;8000ms&lt;/tt&gt; (it is &lt;tt&gt;4/3&lt;/tt&gt; of the default min session timeout in server which is &lt;tt&gt;6000ms&lt;/tt&gt;).&lt;/p&gt;
</comment>
                            <comment id="17946907" author="JIRAUSER309503" created="Thu, 24 Apr 2025 02:33:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt; This is the full log of 3.9.3:&lt;/p&gt;

{
&quot;time&quot; : &quot;2025-04-23T18:51:35.611-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x100707c2dc261da for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.&quot;,
&quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 2667ms for session id 0x100707c2dc261da
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1259)
&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:37.218-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Opening socket connection to server XXX/YYYY:2181.&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:37.219-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;SASL config status: Will not attempt to authenticate using SASL (unknown error)&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.355-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Client session timed out, have not heard from server in 8393ms for session id 0x100707c2dc261da&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.360-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x100707c2dc261da for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.&quot;,
&quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 8393ms for session id 0x100707c2dc261da
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)
&quot;
}
&lt;p&gt;Apr 23, 2025 6:51:41 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process&lt;br/&gt;
INFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1&lt;/p&gt;
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.588-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZkAnnouncer Mutator-EventThread&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;EventThread shut down for session: 0x100707c2dc261da&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.595-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ZooKeeper&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 watcher=com.twitter.finagle.common.zookeeper.ZooKeeperClient$3@6ecbbfdf&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.596-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxnSocket&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;jute.maxbuffer value is 1048575 Bytes&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.597-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;zookeeper.request.timeout value is 0. feature enabled=false&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.600-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Opening socket connection to server XXX/YYYY:2181.&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:41.601-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;SASL config status: Will not attempt to authenticate using SASL (unknown error)&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:45.613-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x0 for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.&quot;,
&quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 4005ms for session id 0x0
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1259)
&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:46.730-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Opening socket connection to server XXX/YYYY:2181.&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:46.730-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;SASL config status: Will not attempt to authenticate using SASL (unknown error)&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:50.732-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Client session timed out, have not heard from server in 9134ms for session id 0x0&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T18:51:50.732-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x0 for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.&quot;,
&quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 9134ms for session id 0x0
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)
&quot;
}
&lt;p&gt;Apr 23, 2025 6:51:50 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process&lt;br/&gt;
INFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1&lt;/p&gt;</comment>
                            <comment id="17946909" author="JIRAUSER309503" created="Thu, 24 Apr 2025 02:44:31 +0000"  >&lt;p&gt;With 3.9.2, it will retry really hard until we connect to the VPN:&lt;/p&gt;
{
&quot;time&quot; : &quot;2025-04-23T19:42:23.638-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x100707c2dc26281 for server XXX:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.&quot;,
&quot;stackTrace&quot; : &quot;j.l.IllegalArgumentException: Unable to canonicalize address XXX:2181 because it&apos;s not resolvable
at o.a.z.SaslServerPrincipal.getServerPrincipal(SaslServerPrincipal.java:78)
at o.a.z.SaslServerPrincipal.getServerPrincipal(SaslServerPrincipal.java:41)
at o.a.z.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1142)
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1192)
&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.506-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Opening socket connection to server XXX/YYY:2181.&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.507-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;SASL config status: Will not attempt to authenticate using SASL (unknown error)&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.519-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Socket connection established, initiating session, client: /10.4.9.178:61916, server: XXX/YYY:2181&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.536-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Unable to reconnect to ZooKeeper service, session 0x100707c2dc26281 has expired&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.537-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;WARN&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session 0x100707c2dc26281 for server XXX/YYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.&quot;,
&quot;stackTrace&quot; : &quot;o.a.z.ClientCnxn$SessionExpiredException: Unable to reconnect to ZooKeeper service, session 0x100707c2dc26281 has expired
at o.a.z.ClientCnxn$SendThread.onConnected(ClientCnxn.java:1418)
at o.a.z.ClientCnxnSocket.readConnectResult(ClientCnxnSocket.java:148)
at o.a.z.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:86)
at o.a.z.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:350)
at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1274)
&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.542-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-EventThread&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;EventThread shut down for session: 0x100707c2dc26281&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.543-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ZooKeeper&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 watcher=com.twitter.finagle.common.zookeeper.ZooKeeperClient$3@38b9cd1e&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.544-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxnSocket&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;jute.maxbuffer value is 1048575 Bytes&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.545-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;message&quot; : &quot;zookeeper.request.timeout value is 0. feature enabled=false&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.546-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Opening socket connection to server XXX/YYY:2181.&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.547-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;SASL config status: Will not attempt to authenticate using SASL (unknown error)&quot;
}
&lt;p&gt;Apr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process&lt;br/&gt;
INFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1&lt;/p&gt;
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.557-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Socket connection established, initiating session, client: /10.4.9.178:61917, server: XXX/YYY:2181&quot;
}
{
&quot;time&quot; : &quot;2025-04-23T19:42:25.571-07:00&quot;,
&quot;logger_name&quot; : &quot;org.apache.zookeeper.ClientCnxn&quot;,
&quot;thread_name&quot; : &quot;ZookeeperClient-watcherProcessor-SendThread(XXX:2181)&quot;,
&quot;level&quot; : &quot;INFO&quot;,
&quot;myid&quot; : &quot;XXX:2181&quot;,
&quot;message&quot; : &quot;Session establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000&quot;
}
&lt;p&gt;Apr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.Group$ActiveMembership join&lt;br/&gt;
INFO: Membership path is : /env-q/finagle/service/example-server/thrift/member_0000000003&lt;br/&gt;
Apr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.Group$ActiveMembership join&lt;br/&gt;
INFO: Set group member ID to member_0000000003&lt;/p&gt;</comment>
                            <comment id="17946919" author="kezhuw" created="Thu, 24 Apr 2025 04:21:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tranvanchuong1995&quot; class=&quot;user-hover&quot; rel=&quot;tranvanchuong1995&quot;&gt;tranvanchuong1995&lt;/a&gt; Thank you for your sharing! You could upload log file directly to jira.&lt;/p&gt;

&lt;p&gt;3.9.3:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;o.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 2667ms for session id 0x100707c2dc261da
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.9.2:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Session 0x100707c2dc26281 for server XXX:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sessions will expired finally in your cases. In case of 3.9.3, it is &lt;b&gt;considered expired&lt;/b&gt; by client, while in 3.9.2, it is &lt;b&gt;confirmed expired&lt;/b&gt; by server. There is no much differences in these two cases from client&apos;s perspective except &lt;b&gt;the later will be delayed substantially if cluster is unreachable&lt;/b&gt;, just like this case.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;With 3.9.2, it will retry really hard until we connect to the VPN:

{&quot;2025-04-23T19:42:25.543-07:00&quot;,&quot;Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 &quot; }
{&quot;2025-04-23T19:42:25.557-07:00&quot;, &quot;Socket connection established, initiating session, client: /10.4.9.178:61917, server: XXX/YYY:2181&quot; }
{&quot;2025-04-23T19:42:25.571-07:00&quot;, &quot;Session establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000&quot; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It will retry hard(&lt;b&gt;actually endless&lt;/b&gt;) to get reconnected and to know its expiration. The next client will success immediately in your case as network has been repaired.&lt;br/&gt;
3.9.3:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2025-04-23T18:51:41.595-07:00,  Initiating client connection, connectString=XXX:2181 sessionTimeout=4000
2025-04-23T18:51:41.600-07:00, Opening socket connection to server XXX/YYYY:2181
2025-04-23T18:51:45.613-07:00, Client connection timed out, have not heard from server in 4005ms for session id 0x0

2025-04-23T18:51:46.730-07:00, Opening socket connection to server XXX/YYYY:2181
2025-04-23T18:51:50.732-07:00, Client session timed out, have not heard from server in 9134ms for session id 0x0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the log, I can tell the it try twice before exhausting expiration timeout(a.k.a. 4/3 * 4000ms).&lt;/p&gt;

&lt;p&gt;3.9.2&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Session establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In 3.9.2, the client will keeping retry(&lt;b&gt;actuall endless&lt;/b&gt;) until a brand new session established while 3.9.3 does not. &lt;/p&gt;

&lt;p&gt; Those endless retry is what &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-4508&quot; title=&quot;ZooKeeper client run to endless loop in ClientCnxn.SendThread.run if all server down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-4508&quot;&gt;&lt;del&gt;ZOOKEEPER-4508&lt;/del&gt;&lt;/a&gt; try to fix so client can get prompt notification according to session timeout and react somehow.&lt;/p&gt;

&lt;p&gt;I think you could mimic 3.9.2 behavior by looping new session establishment so you could get a brand new session after network repaired.&lt;/p&gt;</comment>
                            <comment id="17946925" author="JIRAUSER309503" created="Thu, 24 Apr 2025 04:57:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt;&#160;Are you saying that starting with version 3.9.3, the application is now responsible for managing session establishment itself? In our case, the Zookeeper library is embedded within the Twitter Finagle library, creating multiple layers of abstraction that make it nearly impossible for us to override this behavior.&lt;/p&gt;</comment>
                            <comment id="17946974" author="kezhuw" created="Thu, 24 Apr 2025 08:14:07 +0000"  >&lt;p&gt;&amp;gt; Are you saying that starting with version 3.9.3, the application is now responsible for managing session establishment itself?&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.zookeeper.ZooKeeper&lt;/tt&gt; manages a single session which tolerate network downtime within session timeout. Beyond that, applications(Finagle, Curator, etc.) have to manage themselves across sessions.&lt;/p&gt;

&lt;p&gt;&amp;gt; In our case, the Zookeeper library is embedded within the Twitter Finagle library, creating multiple layers of abstraction that make it nearly impossible for us to override this behavior.&lt;/p&gt;

&lt;p&gt;Seems that finagle&apos;s &lt;a href=&quot;https://github.com/twitter/finagle/blob/develop/finagle-serversets/src/main/java/com/twitter/finagle/common/zookeeper/ZooKeeperClient.java#L357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ZooKeeperClient.get&lt;/a&gt; relies on the endless retrying during estalishing a brand new session. We could fix it there.&lt;/p&gt;

&lt;p&gt;Alternative, we could provide a option for zookeeper to loop until a customized timeout in new session establishment. I think it might be a common pattern to get &lt;tt&gt;Expired&lt;/tt&gt; and then loop until connected.&lt;/p&gt;</comment>
                            <comment id="17947070" author="kezhuw" created="Thu, 24 Apr 2025 15:10:57 +0000"  >&lt;p&gt;&amp;gt;&#160;Alternative, we could provide a option for zookeeper to loop until a customized timeout in new session establishment. I think it might be a common pattern to get &lt;tt&gt;Expired&lt;/tt&gt; and then loop until connected.&lt;/p&gt;

&lt;p&gt;I sent a dev mail to discuss this. &lt;a href=&quot;https://lists.apache.org/thread/nfb9z7rhgglbjzfxvg4z2m3pks53b3c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/nfb9z7rhgglbjzfxvg4z2m3pks53b3c1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17947080" author="JIRAUSER309503" created="Thu, 24 Apr 2025 16:10:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt; this dev mail discussion looks really good. I am looking forward to hearing about the final decision. Thank you!&lt;/p&gt;</comment>
                            <comment id="17950741" author="kezhuw" created="Sun, 11 May 2025 02:20:55 +0000"  >&lt;p&gt;Issue resolved by pull request 2252&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/2252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/2252&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13437158">ZOOKEEPER-4508</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13616408">ZOOKEEPER-4923</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
            <label>Scala</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vimo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>