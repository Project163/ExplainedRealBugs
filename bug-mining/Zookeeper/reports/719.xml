<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:57:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2227] stmk four-letter word fails execution at server while reading trace mask argument.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2227</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When the server handles the &lt;tt&gt;stmk&lt;/tt&gt; four-letter word, it attempts to read an 8-byte Java &lt;tt&gt;long&lt;/tt&gt; from the request as the trace mask argument.  The read fails, because the destination buffer&apos;s capacity is only 4 bytes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12842083">ZOOKEEPER-2227</key>
            <summary>stmk four-letter word fails execution at server while reading trace mask argument.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cnauroth">Chris Nauroth</assignee>
                                    <reporter username="cnauroth">Chris Nauroth</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Jul 2015 19:22:10 +0000</created>
                <updated>Thu, 21 Jul 2016 20:18:18 +0000</updated>
                            <resolved>Sun, 8 Nov 2015 22:31:16 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.4.7</fixVersion>
                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14610863" author="cnauroth" created="Wed, 1 Jul 2015 19:24:41 +0000"  >&lt;p&gt;See below for sample stack traces from both the NIO connection and the Netty connection.  I believe this has been broken since release 3.3.0 by the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-572&quot; title=&quot;add ability for operator to examine state of watches currently registered with a server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-572&quot;&gt;&lt;del&gt;ZOOKEEPER-572&lt;/del&gt;&lt;/a&gt; patch.  Prior to that patch, the code had been allocating an 8-byte buffer for reading the trace mask argument.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-06-30 16:03:03,723 [myid:] - WARN  [NIOWorkerThread-15:WorkerService$ScheduledWorkRequest@164] - Unexpected exception
java.nio.BufferUnderflowException
        at java.nio.Buffer.nextGetIndex(Buffer.java:498)
        at java.nio.HeapByteBuffer.getLong(HeapByteBuffer.java:406)
        at org.apache.zookeeper.server.NIOServerCnxn.checkFourLetterWord(NIOServerCnxn.java:514)
        at org.apache.zookeeper.server.NIOServerCnxn.readLength(NIOServerCnxn.java:535)
        at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:331)
        at org.apache.zookeeper.server.NIOServerCnxnFactory$IOWorkRequest.doWork(NIOServerCnxnFactory.java:530)
        at org.apache.zookeeper.server.WorkerService$ScheduledWorkRequest.run(WorkerService.java:162)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-07-01 10:57:34,958 [myid:] - WARN  [New I/O worker #3:NettyServerCnxnFactory$CnxnChannelHandler@141] - Exception caught [id: 0xefdbe549, /0:0:0:0:0:0:0:1:50197 =&amp;gt; /0:0:0:0:0:0:0:1:2181] EXCEPTION: java.nio.BufferUnderflowException
java.nio.BufferUnderflowException
	at java.nio.Buffer.nextGetIndex(Buffer.java:498)
	at java.nio.HeapByteBuffer.getLong(HeapByteBuffer.java:406)
	at org.apache.zookeeper.server.NettyServerCnxn.checkFourLetterWord(NettyServerCnxn.java:285)
	at org.apache.zookeeper.server.NettyServerCnxn.receiveMessage(NettyServerCnxn.java:387)
	at org.apache.zookeeper.server.NettyServerCnxnFactory$CnxnChannelHandler.processMessage(NettyServerCnxnFactory.java:243)
	at org.apache.zookeeper.server.NettyServerCnxnFactory$CnxnChannelHandler.messageReceived(NettyServerCnxnFactory.java:165)
	at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)
	at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)
	at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)
	at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:109)
	at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:312)
	at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:90)
	at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14610889" author="cnauroth" created="Wed, 1 Jul 2015 19:36:07 +0000"  >&lt;p&gt;I&apos;m attaching a patch.  Summary:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Both the NIO and Netty connection classes now use a correctly sized buffer for reading the trace mask.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;FourLetterWordsTest&lt;/tt&gt; has a new test to cover &lt;tt&gt;stmk&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;FourLetterWordsNettyTest&lt;/tt&gt; is a new suite that subclasses &lt;tt&gt;FourLetterWordsTest&lt;/tt&gt; but configures the Netty connection factory.  This will repeat all of the four-letter word tests through Netty.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14611045" author="hadoopqa" created="Wed, 1 Jul 2015 21:50:04 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12743139/ZOOKEEPER-2227.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12743139/ZOOKEEPER-2227.001.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1688505.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2800//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14611795" author="rakeshr" created="Thu, 2 Jul 2015 11:03:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; Good catch!&lt;/p&gt;

&lt;p&gt;Just few comments:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We have &lt;tt&gt;NioNettySuiteTest&lt;/tt&gt; and it will run &lt;tt&gt;FourLetterWordsTest&lt;/tt&gt; against Netty. Can we remove &lt;tt&gt;FourLetterWordsNettyTest&lt;/tt&gt; ?&lt;/li&gt;
	&lt;li&gt;Its good to have timeout params in tests, &lt;tt&gt;@Test(timeout = 30000)&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14612077" author="cnauroth" created="Thu, 2 Jul 2015 15:31:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;rakeshr&lt;/a&gt;, thank you for your code review.  I&apos;m attaching patch v002.&lt;/p&gt;

&lt;p&gt;Thanks for the tip about &lt;tt&gt;NioNettySuiteTest&lt;/tt&gt;.  I wasn&apos;t aware of that.  I dropped &lt;tt&gt;FourLetterWordsNettyTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;None of the tests in this suite had specified a timeout, so I handled it by setting a JUnit timeout rule for the whole suite.  That will automatically cover any new tests added to the suite in the future too.&lt;/p&gt;</comment>
                            <comment id="14875974" author="hadoopqa" created="Fri, 18 Sep 2015 17:16:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12743327/ZOOKEEPER-2227.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12743327/ZOOKEEPER-2227.002.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1702378.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2882//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14876275" author="arshad.mohammad" created="Fri, 18 Sep 2015 20:11:39 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; for the patch. Here is one review comment.&lt;br/&gt;
To trace all the log level mask value is 1022&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ALL = CLIENT_REQUEST_TRACE_MASK | CLIENT_DATA_PACKET_TRACE_MASK
                | CLIENT_PING_TRACE_MASK | SERVER_PACKET_TRACE_MASK
                | SESSION_TRACE_MASK|EVENT_DELIVERY_TRACE_MASK|SERVER_PING_TRACE_MASK|WARNING_TRACE_MASK|JMX_TRACE_MASK;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After applying your patch, when this mask is set netcat using &lt;tt&gt;echo stmk 1022|netcat host port&lt;/tt&gt;, &lt;tt&gt;java.nio.BufferUnderflowException&lt;/tt&gt; exception is thrown.&lt;br/&gt;
This happens because &quot; 1022&quot; is not serialized to 8 bytes but actually 5 bytes. &lt;br/&gt;
So can you make it work even in this scenario by reading the number of bytes available&lt;/p&gt;

</comment>
                            <comment id="14876750" author="cnauroth" created="Sat, 19 Sep 2015 00:38:39 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad&quot; class=&quot;user-hover&quot; rel=&quot;arshad.mohammad&quot;&gt;arshad.mohammad&lt;/a&gt;.  Thank you for reviewing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;After applying your patch, when this mask is set netcat using echo stmk 1022|netcat host port, java.nio.BufferUnderflowException exception is thrown.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;stmk&lt;/tt&gt; expects as input the 64-bit binary integral value (Java &lt;tt&gt;long&lt;/tt&gt;) containing the mask, not a text representation like the example shown above.  Therefore, we must parse exactly 8 bytes.&lt;/p&gt;

&lt;p&gt;It takes some extra work in the shell to encode a trace mask value like this.  In &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2229&quot; title=&quot;Several four-letter words are undocumented.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2229&quot;&gt;&lt;del&gt;ZOOKEEPER-2229&lt;/del&gt;&lt;/a&gt;, I&apos;m updating documentation for some of the four-letter words.  Here is an example I gave for one way to encode the argument properly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;perl -e &lt;span class=&quot;code-quote&quot;&gt;&quot;print &lt;span class=&quot;code-quote&quot;&gt;&apos;stmk&apos;&lt;/span&gt;, pack(&lt;span class=&quot;code-quote&quot;&gt;&apos;q&amp;gt;&apos;&lt;/span&gt;, 0b0011111010)&quot;&lt;/span&gt; | nc localhost 2181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is admittedly a strange interface compared to the other four-letter words.  I think all of the other four-letter words accept text input instead of binary.  However, I approached this patch as just restoring the existing functionality that had been broken in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-572&quot; title=&quot;add ability for operator to examine state of watches currently registered with a server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-572&quot;&gt;&lt;del&gt;ZOOKEEPER-572&lt;/del&gt;&lt;/a&gt;, not changing the interface, for reasons of backwards-compatibility.&lt;/p&gt;</comment>
                            <comment id="14877221" author="arshad.mohammad" created="Sat, 19 Sep 2015 17:36:51 +0000"  >&lt;p&gt;IMHO, smtk interface complexity can be avoided with proper handling at the server side. Here is code snippet what i am suggesting&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;incomingBuffer = ByteBuffer.allocate(8);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; rc = sock.read(incomingBuffer);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rc &amp;lt; 0) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Read error&quot;&lt;/span&gt;);
}            
incomingBuffer.flip();
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] inputBytes=&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[rc];
incomingBuffer.get(inputBytes);
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; inputString=&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(inputBytes);
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; traceMask = &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.parseLong(inputString.trim());
ZooTrace.setTextTraceLevel(traceMask);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14900138" author="cnauroth" created="Mon, 21 Sep 2015 02:02:21 +0000"  >&lt;p&gt;Thank you again, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad&quot; class=&quot;user-hover&quot; rel=&quot;arshad.mohammad&quot;&gt;arshad.mohammad&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The change proposed in this comment would be backwards-incompatible with the functionality that existed before it was broken by the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-572&quot; title=&quot;add ability for operator to examine state of watches currently registered with a server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-572&quot;&gt;&lt;del&gt;ZOOKEEPER-572&lt;/del&gt;&lt;/a&gt; patch, because it would change the parameter from a binary encoding to a text encoding.  My goal in this patch is to restore the broken functionality in the 3.4 line, not introduce new or different functionality.&lt;/p&gt;

&lt;p&gt;I agree that the interface of &lt;tt&gt;stmk&lt;/tt&gt; is awkward.  We could consider a backwards-incompatible improvement in version 3.5 or later.  However, if we&apos;re going to take the leap to a backwards-incompatible change, then I&apos;d favor doing something even bolder.  For example, we could restructure the trace logging into different Log4J categories, and then support it through dynamic reconfiguration of Log4J.  This is something that would be outside the scope of this JIRA though, and tracked in a separate JIRA targeted to 3.5 or later.&lt;/p&gt;

&lt;p&gt;Honestly, I have to believe almost no one is using &lt;tt&gt;stmk&lt;/tt&gt; at this point.  As per &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2229&quot; title=&quot;Several four-letter words are undocumented.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2229&quot;&gt;&lt;del&gt;ZOOKEEPER-2229&lt;/del&gt;&lt;/a&gt;, it is undocumented, and it has been broken for years.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Even still, ZooKeeper has a formally published backwards-compatibility policy, and I&apos;d prefer that we stick to it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/ReleaseManagement&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/ReleaseManagement&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14900509" author="eribeiro" created="Mon, 21 Sep 2015 11:07:00 +0000"  >&lt;p&gt;I strongly agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt; in that backwards incompatible changes should not be targeted to minor release (by the way, what version does this patch addresses? 4.5.6, 4.5 ? We need to update this JIRA.&lt;/p&gt;

&lt;p&gt;Ideally, backwards incompatible changes should be done on major changes (5.0, e.g.), even if the feature is seemingly not used because ZooKeeper is used by a *&lt;b&gt;a lot&lt;/b&gt;* of projects. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14900863" author="cnauroth" created="Mon, 21 Sep 2015 15:50:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eribeiro&quot; class=&quot;user-hover&quot; rel=&quot;eribeiro&quot;&gt;eribeiro&lt;/a&gt;, thanks for taking a look too.  I&apos;m updating fix version to show that I&apos;m targeting releases 3.4.7 and 3.5.2 with this patch.&lt;/p&gt;</comment>
                            <comment id="14900867" author="cnauroth" created="Mon, 21 Sep 2015 15:51:44 +0000"  >&lt;p&gt;...and 3.6.0 (trunk).&lt;/p&gt;</comment>
                            <comment id="14995819" author="rgs" created="Sun, 8 Nov 2015 21:41:56 +0000"  >&lt;p&gt;Merged (trunk and 3.5):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/commit/8f836e195025a540dab8eab6b52b9b30946e1c47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/8f836e195025a540dab8eab6b52b9b30946e1c47&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/4c8f7181cbe41ef38753155b88bdd472a03980b7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/4c8f7181cbe41ef38753155b88bdd472a03980b7&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;: mind adding a patch for 3.4 (doesn&apos;t apply cleanly as is). Thanks!&lt;/p&gt;</comment>
                            <comment id="14995830" author="cnauroth" created="Sun, 8 Nov 2015 21:56:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, thank you for the review.  Here is a patch for branch-3.4.&lt;/p&gt;</comment>
                            <comment id="14995831" author="hadoopqa" created="Sun, 8 Nov 2015 21:59:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12771247/ZOOKEEPER-2227-branch-3.4.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12771247/ZOOKEEPER-2227-branch-3.4.002.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1713303.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2949//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2949//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14995848" author="hudson" created="Sun, 8 Nov 2015 22:30:25 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2811 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2811/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2811/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2227&quot; title=&quot;stmk four-letter word fails execution at server while reading trace mask argument.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2227&quot;&gt;&lt;del&gt;ZOOKEEPER-2227&lt;/del&gt;&lt;/a&gt;: stmk four-letter word fails execution at server while&lt;br/&gt;
reading trace mask argument (Chris Nauroth via rgs) (rgs: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1713300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1713300&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;trunk/src/java/main/org/apache/zookeeper/server/NIOServerCnxn.java&lt;/li&gt;
	&lt;li&gt;trunk/src/java/main/org/apache/zookeeper/server/NettyServerCnxn.java&lt;/li&gt;
	&lt;li&gt;trunk/src/java/test/org/apache/zookeeper/test/FourLetterWordsTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14995849" author="rgs" created="Sun, 8 Nov 2015 22:31:16 +0000"  >&lt;p&gt;Merged for 3.4:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/zookeeper/commit/4e7d4db0b200833c5ae270490c335a87c3f6a089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/4e7d4db0b200833c5ae270490c335a87c3f6a089&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12884311">ZOOKEEPER-2278</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12440230">ZOOKEEPER-572</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12842157">ZOOKEEPER-2229</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12771247" name="ZOOKEEPER-2227-branch-3.4.002.patch" size="4323" author="cnauroth" created="Sun, 8 Nov 2015 21:56:41 +0000"/>
                            <attachment id="12743139" name="ZOOKEEPER-2227.001.patch" size="5769" author="cnauroth" created="Wed, 1 Jul 2015 19:36:07 +0000"/>
                            <attachment id="12743327" name="ZOOKEEPER-2227.002.patch" size="4489" author="cnauroth" created="Thu, 2 Jul 2015 15:31:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gr4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>