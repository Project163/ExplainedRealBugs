<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:02:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3737] Unable to eliminate log4j1 transitive dependency</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3737</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Apache Accumulo is trying to switch to using log4j2 only. However, this seems impossible, because ZooKeeper has a hard-coded dependency on log4j 1.2 for some sort of jmx thing. The following is the error and stack trace I get whenever I remove log4j 1.2 from the class path and try to run a test instance of ZooKeeper as part of Accumulo&apos;s build test suite.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-02-24T20:10:03,682 [jmx.ManagedUtil] ERROR: Problems &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; registering log4j jmx beans!
java.lang.ClassNotFoundException: org.apache.log4j.jmx.HierarchyDynamicMBean
	at jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581) ~[?:?]
	at jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:521) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:315) ~[?:?]
	at org.apache.zookeeper.jmx.ManagedUtil.registerLog4jMBeans(ManagedUtil.java:72) ~[zookeeper-3.5.7.jar:3.5.7]
	at org.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:94) ~[zookeeper-3.5.7.jar:3.5.7]
	at org.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:64) ~[zookeeper-3.5.7.jar:3.5.7]
	at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]
	at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:?]
	at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]
	at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]
	at org.apache.accumulo.start.Main.lambda$execMainClass$1(Main.java:167) ~[accumulo-start-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834) [?:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I know previous work has been done on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-850&quot; title=&quot;Switch from log4j to slf4j&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-850&quot;&gt;&lt;del&gt;ZOOKEEPER-850&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1371&quot; title=&quot;Remove dependency on log4j in the source code.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1371&quot;&gt;&lt;del&gt;ZOOKEEPER-1371&lt;/del&gt;&lt;/a&gt; to eliminate the use of log4j in the source, but this work does not appear to be complete, since it is still required at runtime (at least, for the server... but maybe for the client too... it&apos;s hard to tell from the way Accumulo runs its test suite, and I&apos;m not super familiar with ZK internals).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13287385">ZOOKEEPER-3737</key>
            <summary>Unable to eliminate log4j1 transitive dependency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctubbsii">Christopher Tubbs</assignee>
                                    <reporter username="ctubbsii">Christopher Tubbs</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 25 Feb 2020 01:20:46 +0000</created>
                <updated>Mon, 11 May 2020 15:41:20 +0000</updated>
                            <resolved>Sun, 1 Mar 2020 06:56:54 +0000</resolved>
                                    <version>3.4.14</version>
                    <version>3.5.7</version>
                                    <fixVersion>3.7.0</fixVersion>
                    <fixVersion>3.6.1</fixVersion>
                    <fixVersion>3.5.8</fixVersion>
                                    <component>jmx</component>
                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17044032" author="ctubbsii" created="Tue, 25 Feb 2020 01:27:24 +0000"  >&lt;p&gt;If anybody wants to reproduce, I have a draft pull request for Accumulo at &lt;a href=&quot;https://github.com/apache/accumulo/pull/1531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/accumulo/pull/1531&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The command to reproduce the build failure would be: &lt;tt&gt;mvn clean package -Dtest=MiniAccumuloClusterTest&lt;/tt&gt;&lt;br/&gt;
The error can be observed when that test gets stuck at: &lt;tt&gt;minicluster/target/mini-tests/org.apache.accumulo.minicluster.MiniAccumuloClusterTest/logs/ZooKeeperServerMain_*.out&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17044645" author="phunt" created="Tue, 25 Feb 2020 16:50:16 +0000"  >&lt;p&gt;ZK log4j2 support is still an open issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2342&quot; title=&quot;Migrate to Log4J 2.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2342&quot;&gt;&lt;del&gt;ZOOKEEPER-2342&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17044648" author="phunt" created="Tue, 25 Feb 2020 16:53:13 +0000"  >&lt;p&gt;You should be able to disable this feature via configuration:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/blob/019e841e7703835aaa146dd1c16fd1b43d017071/zookeeper-server/src/main/java/org/apache/zookeeper/jmx/ManagedUtil.java#L65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/019e841e7703835aaa146dd1c16fd1b43d017071/zookeeper-server/src/main/java/org/apache/zookeeper/jmx/ManagedUtil.java#L65&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;See &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/blob/019e841e7703835aaa146dd1c16fd1b43d017071/zookeeper-server/src/main/java/org/apache/zookeeper/jmx/ManagedUtil.java#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/blob/019e841e7703835aaa146dd1c16fd1b43d017071/zookeeper-server/src/main/java/org/apache/zookeeper/jmx/ManagedUtil.java#L42&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;tldr: set &quot;zookeeper.jmx.log4j.disable&quot; to true&lt;/p&gt;</comment>
                            <comment id="17044654" author="phunt" created="Tue, 25 Feb 2020 17:04:20 +0000"  >&lt;p&gt;According to this:&lt;br/&gt;
&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/jmx.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/jmx.html&lt;/a&gt;&lt;br/&gt;
in log4j2 &quot;JMX support is enabled by default&quot;&lt;/p&gt;

&lt;p&gt;As such the registerLog4jMBeans method should not be called when log4j2 is being used. Perhaps we can check whether HierarchyDynamicMBean is available and not call the method - ie add another check to isLog4jJmxEnabled...&lt;/p&gt;</comment>
                            <comment id="17044659" author="ctubbsii" created="Tue, 25 Feb 2020 17:09:37 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt;, I will try setting that property. It looks like that won&apos;t work in 3.4.14, because the class won&apos;t load (since &lt;tt&gt;org.apache.log4j.jmx.HierarchyDynamicMBean&lt;/tt&gt; isn&apos;t loaded dynamically, as it is since 3.5.5). But, it should work in 3.5.5 and later.&lt;/p&gt;

&lt;p&gt;Also, it seems there&apos;s a bug in the checking for log4j1. It is assuming log4j1 is available if the class &lt;tt&gt;org.apache.log4j.spi.LoggerRepository&lt;/tt&gt; can be loaded. However, that class is also available in the &lt;tt&gt;log4j-1.2-api&lt;/tt&gt; compatibility jar from log4j2. Since the class it actually needs is &lt;tt&gt;org.apache.log4j.jmx.HierarchyDynamicMBean&lt;/tt&gt;, it should probably be checking for that instead, since that is not available in the log4j2 compatibility jar. Then, the system property would not be necessary. However, the system property should be a feasible workaround. I will try it.&lt;/p&gt;</comment>
                            <comment id="17044672" author="phunt" created="Tue, 25 Feb 2020 17:14:52 +0000"  >&lt;p&gt;Git blame indicates that the check for LoggerRepository is from over 4 years ago. Perhaps it was accurate at the time - ie added for &quot;compatibility&quot; at some point.&lt;/p&gt;

&lt;p&gt;Given you&apos;re in there and easily able to reproduce please consider submitting a patch to fix this in ZK. Thx.&lt;/p&gt;</comment>
                            <comment id="17044673" author="ctubbsii" created="Tue, 25 Feb 2020 17:15:19 +0000"  >&lt;p&gt;If it&apos;s enabled by default in log4j2, it seems ZK could just get rid of it entirely in its own code. Just use slf4j as the logging facade, and defer to any advanced logging features to the log4j2 implementation (or any alternate implementation users select). The less done in code, the more reusable and portable the ZK code is.&lt;/p&gt;</comment>
                            <comment id="17044754" author="ctubbsii" created="Tue, 25 Feb 2020 19:13:34 +0000"  >&lt;p&gt;I&apos;ll open a PR to address this soon. I first had to get the build working for my environment (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3738&quot; title=&quot;Avoid use of broken codehaus properties-maven-plugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3738&quot;&gt;&lt;del&gt;ZOOKEEPER-3738&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3739&quot; title=&quot;Remove use of com.sun.nio.file.SensitivityWatchEventModifier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3739&quot;&gt;&lt;del&gt;ZOOKEEPER-3739&lt;/del&gt;&lt;/a&gt;, both of which now have PRs).&lt;/p&gt;</comment>
                            <comment id="17044836" author="ctubbsii" created="Tue, 25 Feb 2020 20:48:36 +0000"  >&lt;p&gt;Patch available in the linked pull request.&lt;/p&gt;</comment>
                            <comment id="17048470" author="phunt" created="Sun, 1 Mar 2020 05:46:11 +0000"  >&lt;p&gt;Committed to 3.5/3.6 and trunk. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctubbsii&quot; class=&quot;user-hover&quot; rel=&quot;ctubbsii&quot;&gt;ctubbsii&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17048476" author="ctubbsii" created="Sun, 1 Mar 2020 06:55:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt; Awesome! Should this JIRA issue now be marked as resolved/fixed/closed?&lt;/p&gt;</comment>
                            <comment id="17104587" author="symat" created="Mon, 11 May 2020 15:41:20 +0000"  >&lt;p&gt;closed after releasing 3.5.8&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12920618">ZOOKEEPER-2342</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12539547">ZOOKEEPER-1371</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12471687">ZOOKEEPER-850</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0buhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>