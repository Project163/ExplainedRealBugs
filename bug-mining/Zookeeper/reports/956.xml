<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:02:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-3510] Frequent &apos;zkServer.sh stop&apos; failures when running C test suite</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-3510</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;As mentioned in &lt;a href=&quot;https://github.com/apache/zookeeper/pull/1054#discussion_r314208678&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1054#discussion_r314208678&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;There is a &lt;tt&gt;sleep 3&lt;/tt&gt; statement in &lt;tt&gt;zkServer.sh restart&lt;/tt&gt;.  I am unable to unearth the history of that particular line, but I believe part&#8212;if not all&#8212;of that &lt;tt&gt;sleep&lt;/tt&gt; should be part of &lt;tt&gt;zkServer.sh stop&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I frequently observe &lt;tt&gt;FAILED TO START&lt;/tt&gt; errors in the C test suite; the logs consistently show that those are caused by &lt;tt&gt;java.net.BindException: Address already in use&lt;/tt&gt;.  Adding a simple &lt;tt&gt;sleep 1&lt;/tt&gt; before &lt;tt&gt;echo STOPPED&lt;/tt&gt; &quot;fixes&quot; it for me.  I will submit an initial PR with the corresponding change and a commit message akin to:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ZOOKEEPER-XXXX: Make zkServer.sh stop more reliable&lt;/p&gt;

&lt;p&gt;Kill is asynchronous, and without the sleep, the server&apos;s TCP port can still be busy when the next server is started&#8212;causing flaky runs of the C client&apos;s test suite.&lt;/p&gt;

&lt;p&gt;(It would probably be better to spin a few times, probing with ps -p.)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;As noted above, the sleep is far from optimal, an adaptive mechanism would be better&#8212;but I do not want to make the first iteration too complicated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13250969">ZOOKEEPER-3510</key>
            <summary>Frequent &apos;zkServer.sh stop&apos; failures when running C test suite</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ztzg">Damien Diederen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 15 Aug 2019 08:18:38 +0000</created>
                <updated>Wed, 16 Oct 2019 18:59:09 +0000</updated>
                            <resolved>Fri, 23 Aug 2019 10:16:23 +0000</resolved>
                                                    <fixVersion>3.6.0</fixVersion>
                    <fixVersion>3.5.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16914114" author="nkalmar" created="Fri, 23 Aug 2019 10:16:23 +0000"  >&lt;p&gt;Issue resolved by pull request 1055&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1055&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1055&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16914145" author="hudson" created="Fri, 23 Aug 2019 10:48:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #671 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/671/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/671/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3510&quot; title=&quot;Frequent &amp;#39;zkServer.sh stop&amp;#39; failures when running C test suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3510&quot;&gt;&lt;del&gt;ZOOKEEPER-3510&lt;/del&gt;&lt;/a&gt;: Make &apos;zkServer.sh stop&apos; more reliable (nkalmar: rev 942213dfe28e464f068f8a195d1424c4b29af585)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) bin/zkServer.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16914319" author="hudson" created="Fri, 23 Aug 2019 14:53:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Zookeeper-trunk-single-thread #506 (See &lt;a href=&quot;https://builds.apache.org/job/Zookeeper-trunk-single-thread/506/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Zookeeper-trunk-single-thread/506/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-3510&quot; title=&quot;Frequent &amp;#39;zkServer.sh stop&amp;#39; failures when running C test suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-3510&quot;&gt;&lt;del&gt;ZOOKEEPER-3510&lt;/del&gt;&lt;/a&gt;: Make &apos;zkServer.sh stop&apos; more reliable (nkalmar: rev 942213dfe28e464f068f8a195d1424c4b29af585)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) bin/zkServer.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05owo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>