<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:00:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2953] Flaky Test: testNoLogBeforeLeaderEstablishment</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2953</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;testNoLogBeforeLeaderEstablishment has been flaky on 3.4, 3.5, and master for quite awhile. My understanding is that the purpose of the test is to make sure that a server receives support from the quorum before changing the epoch and acting as leader. &lt;/p&gt;

&lt;p&gt;There are a couple issues with the test in its current state. First, the assertions the test makes are not always true. It is possible, if the zookeeper database is not cleared, for a follower to be ahead of a leader when the quorum is shutdown. That follower will then likely become leader when the quorum is restarted. This is the cause of the flaky behavior. Second, the test does not appear to create the conditions it wants to test for. Since, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt; (specifically the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1081&quot; title=&quot;modify leader/follower code to correctly deal with new leader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1081&quot;&gt;&lt;del&gt;ZOOKEEPER-1081&lt;/del&gt;&lt;/a&gt; subtask) we take the epoch into consideration in &lt;tt&gt;FastLeaderElection&lt;/tt&gt; so the test no longer &quot;believes it is the leader once it recovers&quot;.&lt;/p&gt;

&lt;p&gt;After discussing the issue offline with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;phunt&lt;/a&gt; we decided it would still be valuable to test the situation where a server is elected leader without the support of the quorum. So I removed &lt;tt&gt;testNoLogBeforeLeaderEstablishment&lt;/tt&gt; and created a new test called &lt;tt&gt;testElectionFraud&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13124534">ZOOKEEPER-2953</key>
            <summary>Flaky Test: testNoLogBeforeLeaderEstablishment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="abrahamfine">Abraham Fine</assignee>
                                    <reporter username="abrahamfine">Abraham Fine</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Dec 2017 00:24:44 +0000</created>
                <updated>Sat, 16 Dec 2017 02:05:46 +0000</updated>
                            <resolved>Sat, 16 Dec 2017 00:49:05 +0000</resolved>
                                    <version>3.5.3</version>
                    <version>3.4.11</version>
                    <version>3.6.0</version>
                                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                    <fixVersion>3.4.12</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16288562" author="githubbot" created="Wed, 13 Dec 2017 01:11:31 +0000"  >&lt;p&gt;GitHub user afine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/afine/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/afine/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #432&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 68a0382093da1d64583211746ac672ed12f5da5c&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T00:35:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16288563" author="githubbot" created="Wed, 13 Dec 2017 01:11:46 +0000"  >&lt;p&gt;GitHub user afine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/afine/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/afine/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;_3.5&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #433&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 36abecd0d4389b24e22852cccac50259b2abdb1a&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T00:51:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16288564" author="githubbot" created="Wed, 13 Dec 2017 01:12:19 +0000"  >&lt;p&gt;GitHub user afine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/434&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/afine/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/afine/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;_3.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/434.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/434.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #434&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4834ba25b9b0a9f0448675f96ca402120833f54e&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T01:10:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16288837" author="githubbot" created="Wed, 13 Dec 2017 07:45:22 +0000"  >&lt;p&gt;Github user afine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16288838" author="githubbot" created="Wed, 13 Dec 2017 07:45:46 +0000"  >&lt;p&gt;GitHub user afine reopened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/afine/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/afine/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #432&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 68a0382093da1d64583211746ac672ed12f5da5c&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T00:35:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16288925" author="githubbot" created="Wed, 13 Dec 2017 09:10:42 +0000"  >&lt;p&gt;Github user afine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16288926" author="githubbot" created="Wed, 13 Dec 2017 09:10:43 +0000"  >&lt;p&gt;GitHub user afine reopened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/afine/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/afine/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;_3.5&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #433&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 36abecd0d4389b24e22852cccac50259b2abdb1a&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T00:51:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment&lt;/p&gt;

&lt;p&gt;commit 5e4da2dcf3067008a33ace787c3d78c0bdbee823&lt;br/&gt;
Author: Abraham Fine &amp;lt;afine@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-12-13T08:20:56Z&lt;/p&gt;

&lt;p&gt;    fix whitespace&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16289274" author="githubbot" created="Wed, 13 Dec 2017 13:43:35 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156657072&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156657072&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It&apos;d be useful to utilize the class-wide ```servers``` field which is used to shutdown test servers in the ```tearDown()``` method.&lt;/p&gt;

&lt;p&gt;    For example ```testHighestZxidJoinLate()``` test does it that way.&lt;/p&gt;</comment>
                            <comment id="16289275" author="githubbot" created="Wed, 13 Dec 2017 13:43:36 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156658012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156658012&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find the leader&lt;br/&gt;
    +          int trueLeader = -1;&lt;br/&gt;
    +          for (int i = 0; i &amp;lt; numServers; i++) {&lt;br/&gt;
    +            if (servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.main.quorumPeer.leader != null) &lt;/p&gt;
{
    +              trueLeader = i;
    +            }
&lt;p&gt;    +          }&lt;br/&gt;
    +          Assert.assertTrue(&quot;There should be a leader&quot;, trueLeader &amp;gt;= 0);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find a follower&lt;br/&gt;
    +          int falseLeader = (trueLeader + 1) % numServers;&lt;br/&gt;
    +          Assert.assertTrue(servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower != null);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Minor: I believe that it&apos;s generally a good idea to add a short message to asserts to describe what could be the problem when assertion fails.&lt;/p&gt;</comment>
                            <comment id="16289276" author="githubbot" created="Wed, 13 Dec 2017 13:43:36 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156660196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156660196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find the leader&lt;br/&gt;
    +          int trueLeader = -1;&lt;br/&gt;
    +          for (int i = 0; i &amp;lt; numServers; i++) {&lt;br/&gt;
    +            if (servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.main.quorumPeer.leader != null) &lt;/p&gt;
{
    +              trueLeader = i;
    +            }
&lt;p&gt;    +          }&lt;br/&gt;
    +          Assert.assertTrue(&quot;There should be a leader&quot;, trueLeader &amp;gt;= 0);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find a follower&lt;br/&gt;
    +          int falseLeader = (trueLeader + 1) % numServers;&lt;br/&gt;
    +          Assert.assertTrue(servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower != null);&lt;br/&gt;
    +&lt;br/&gt;
    +          // to keep the quorum peer running and force it to go into the looking state, we kill leader election&lt;br/&gt;
    +          // and close the connection to the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.electionAlg.shutdown();&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower.getSocket().close();&lt;br/&gt;
    +&lt;br/&gt;
    +          // wait for the falseLeader to disconnect&lt;br/&gt;
    +          waitForOne(servers.zk&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;, States.CONNECTING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // convince falseLeader that it is the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.setPeerState(QuorumPeer.ServerState.LEADING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // provide time for the falseleader to realize no followers have connected&lt;br/&gt;
    +          // (this is twice the timeout used in Leader#getEpochToPropose)&lt;br/&gt;
    +          Thread.sleep(2 * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.initLimit * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.tickTime);&lt;br/&gt;
    +&lt;br/&gt;
    +          // Restart leader election&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.startLeaderElection();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I wonder if this one has to be called explicitly. &lt;/p&gt;

&lt;p&gt;    The peer should automatically realise that it&apos;s no longer the leader, stop leading and start leader election (which is basically looking). That&apos;s what this test is intended to validate and shouldn&apos;t be started explicitly.&lt;/p&gt;

&lt;p&gt;    Correct me if I&apos;m wrong.&lt;/p&gt;</comment>
                            <comment id="16289277" author="githubbot" created="Wed, 13 Dec 2017 13:44:54 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @afine Generally the new test looks good to me, but would you please elaborate why the old test was flaky and how the new fixes that?&lt;/p&gt;</comment>
                            <comment id="16289894" author="githubbot" created="Wed, 13 Dec 2017 20:57:05 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156780239&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156780239&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Fixed, forgot to put that in this branch.&lt;/p&gt;</comment>
                            <comment id="16289901" author="githubbot" created="Wed, 13 Dec 2017 21:00:31 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156781040&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156781040&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find the leader&lt;br/&gt;
    +          int trueLeader = -1;&lt;br/&gt;
    +          for (int i = 0; i &amp;lt; numServers; i++) {&lt;br/&gt;
    +            if (servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.main.quorumPeer.leader != null) &lt;/p&gt;
{
    +              trueLeader = i;
    +            }
&lt;p&gt;    +          }&lt;br/&gt;
    +          Assert.assertTrue(&quot;There should be a leader&quot;, trueLeader &amp;gt;= 0);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find a follower&lt;br/&gt;
    +          int falseLeader = (trueLeader + 1) % numServers;&lt;br/&gt;
    +          Assert.assertTrue(servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower != null);&lt;br/&gt;
    +&lt;br/&gt;
    +          // to keep the quorum peer running and force it to go into the looking state, we kill leader election&lt;br/&gt;
    +          // and close the connection to the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.electionAlg.shutdown();&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower.getSocket().close();&lt;br/&gt;
    +&lt;br/&gt;
    +          // wait for the falseLeader to disconnect&lt;br/&gt;
    +          waitForOne(servers.zk&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;, States.CONNECTING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // convince falseLeader that it is the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.setPeerState(QuorumPeer.ServerState.LEADING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // provide time for the falseleader to realize no followers have connected&lt;br/&gt;
    +          // (this is twice the timeout used in Leader#getEpochToPropose)&lt;br/&gt;
    +          Thread.sleep(2 * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.initLimit * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.tickTime);&lt;br/&gt;
    +&lt;br/&gt;
    +          // Restart leader election&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.startLeaderElection();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Stopping and starting leader election is necessary here to prevent a race condition. It is possible that after the server is disconnected from the leader it becomes a follower before the test hits `servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.setPeerState(QuorumPeer.ServerState.LEADING);` and falseLeader will never try to `lead`, defeating the purpose of the test.&lt;/p&gt;</comment>
                            <comment id="16289905" author="githubbot" created="Wed, 13 Dec 2017 21:01:57 +0000"  >&lt;p&gt;Github user afine commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @anmolnar An explanation is coming, please excuse the cruft at this stage. I wanted to run the new test on apache hardware hence the &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; in the title.&lt;/p&gt;</comment>
                            <comment id="16289943" author="githubbot" created="Wed, 13 Dec 2017 21:31:04 +0000"  >&lt;p&gt;Github user anmolnar commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @afine got it&lt;/p&gt;</comment>
                            <comment id="16289958" author="githubbot" created="Wed, 13 Dec 2017 21:39:50 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156793172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156793172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find the leader&lt;br/&gt;
    +          int trueLeader = -1;&lt;br/&gt;
    +          for (int i = 0; i &amp;lt; numServers; i++) {&lt;br/&gt;
    +            if (servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.main.quorumPeer.leader != null) &lt;/p&gt;
{
    +              trueLeader = i;
    +            }
&lt;p&gt;    +          }&lt;br/&gt;
    +          Assert.assertTrue(&quot;There should be a leader&quot;, trueLeader &amp;gt;= 0);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find a follower&lt;br/&gt;
    +          int falseLeader = (trueLeader + 1) % numServers;&lt;br/&gt;
    +          Assert.assertTrue(servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower != null);&lt;br/&gt;
    +&lt;br/&gt;
    +          // to keep the quorum peer running and force it to go into the looking state, we kill leader election&lt;br/&gt;
    +          // and close the connection to the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.electionAlg.shutdown();&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower.getSocket().close();&lt;br/&gt;
    +&lt;br/&gt;
    +          // wait for the falseLeader to disconnect&lt;br/&gt;
    +          waitForOne(servers.zk&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;, States.CONNECTING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // convince falseLeader that it is the leader&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.setPeerState(QuorumPeer.ServerState.LEADING);&lt;br/&gt;
    +&lt;br/&gt;
    +          // provide time for the falseleader to realize no followers have connected&lt;br/&gt;
    +          // (this is twice the timeout used in Leader#getEpochToPropose)&lt;br/&gt;
    +          Thread.sleep(2 * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.initLimit * servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.tickTime);&lt;br/&gt;
    +&lt;br/&gt;
    +          // Restart leader election&lt;br/&gt;
    +          servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.startLeaderElection();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I see. Hence the shutdown() call a few lines before.&lt;br/&gt;
    Makes sense.&lt;/p&gt;</comment>
                            <comment id="16291163" author="githubbot" created="Thu, 14 Dec 2017 16:49:08 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r156999341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r156999341&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find the leader&lt;br/&gt;
    +          int trueLeader = -1;&lt;br/&gt;
    +          for (int i = 0; i &amp;lt; numServers; i++) {&lt;br/&gt;
    +            if (servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.main.quorumPeer.leader != null) &lt;/p&gt;
{
    +              trueLeader = i;
    +            }
&lt;p&gt;    +          }&lt;br/&gt;
    +          Assert.assertTrue(&quot;There should be a leader&quot;, trueLeader &amp;gt;= 0);&lt;br/&gt;
    +&lt;br/&gt;
    +          // find a follower&lt;br/&gt;
    +          int falseLeader = (trueLeader + 1) % numServers;&lt;br/&gt;
    +          Assert.assertTrue(servers.mt&lt;span class=&quot;error&quot;&gt;&amp;#91;falseLeader&amp;#93;&lt;/span&gt;.main.quorumPeer.follower != null);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixed&lt;/p&gt;</comment>
                            <comment id="16291164" author="githubbot" created="Thu, 14 Dec 2017 16:49:42 +0000"  >&lt;p&gt;Github user afine commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; removed and I added a description of the issue to the JIRA.&lt;/p&gt;</comment>
                            <comment id="16291168" author="githubbot" created="Thu, 14 Dec 2017 16:56:11 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433#discussion_r157001258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433#discussion_r157001258&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Please use the global field.&lt;/p&gt;</comment>
                            <comment id="16291169" author="githubbot" created="Thu, 14 Dec 2017 16:56:11 +0000"  >&lt;p&gt;Github user anmolnar commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433#discussion_r157001279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433#discussion_r157001279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Here too.&lt;/p&gt;</comment>
                            <comment id="16291187" author="githubbot" created="Thu, 14 Dec 2017 17:08:36 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433#discussion_r157004899&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433#discussion_r157004899&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixed&lt;/p&gt;</comment>
                            <comment id="16291188" author="githubbot" created="Thu, 14 Dec 2017 17:08:38 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433#discussion_r157004909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433#discussion_r157004909&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        int numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          Servers servers = LaunchServers(numServers, 500);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixed&lt;/p&gt;</comment>
                            <comment id="16291213" author="hadoopqa" created="Thu, 14 Dec 2017 17:26:54 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1373//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16293475" author="githubbot" created="Sat, 16 Dec 2017 00:31:55 +0000"  >&lt;p&gt;Github user phunt commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432#discussion_r157326074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432#discussion_r157326074&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java &amp;#8212;&lt;br/&gt;
    @@ -335,6 +336,100 @@ public void testHighestZxidJoinLate() throws Exception &lt;/p&gt;
{
                     output[0], 2);
         }

&lt;p&gt;    +    /**&lt;br/&gt;
    +     * This test validates that if a quorum member determines that it is leader without the support of the rest of the&lt;br/&gt;
    +     * quorum (the other members do not believe it to be the leader) it will stop attempting to lead and become a follower.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @throws IOException&lt;br/&gt;
    +     * @throws InterruptedException&lt;br/&gt;
    +     */&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testElectionFraud() throws IOException, InterruptedException {&lt;br/&gt;
    +        // capture QuorumPeer logging&lt;br/&gt;
    +        Layout layout = Logger.getRootLogger().getAppender(&quot;CONSOLE&quot;).getLayout();&lt;br/&gt;
    +        ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
    +        WriterAppender appender = new WriterAppender(layout, os);&lt;br/&gt;
    +        appender.setThreshold(Level.INFO);&lt;br/&gt;
    +        Logger qlogger = Logger.getLogger(QuorumPeer.class);&lt;br/&gt;
    +        qlogger.addAppender(appender);&lt;br/&gt;
    +&lt;br/&gt;
    +        numServers = 3;&lt;br/&gt;
    +&lt;br/&gt;
    +        // used for assertions later&lt;br/&gt;
    +        boolean foundLeading = false;&lt;br/&gt;
    +        boolean foundLooking = false;&lt;br/&gt;
    +        boolean foundFollowing = false;&lt;br/&gt;
    +&lt;br/&gt;
    +        try {&lt;br/&gt;
    +          // spin up a quorum, we use a small ticktime to make the test run faster&lt;br/&gt;
    +          servers = LaunchServers(numServers, 500);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Note that by reducing this you are also affecting the init and sync limits  in the same proportion... Not a reason not to do it but FYI in case we start seeing this test as flakey down the road. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16293479" author="githubbot" created="Sat, 16 Dec 2017 00:36:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16293481" author="githubbot" created="Sat, 16 Dec 2017 00:39:01 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm, +1 thanks @afine &lt;/p&gt;</comment>
                            <comment id="16293485" author="githubbot" created="Sat, 16 Dec 2017 00:41:39 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm. +1 thanks @afine &lt;/p&gt;

&lt;p&gt;    please close this as it&apos;s not the default branch won&apos;t be closed automatically.&lt;/p&gt;</comment>
                            <comment id="16293489" author="githubbot" created="Sat, 16 Dec 2017 00:48:43 +0000"  >&lt;p&gt;Github user phunt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/434&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm +1 thanks @afine &lt;/p&gt;

&lt;p&gt;    Please close this one as well.&lt;/p&gt;</comment>
                            <comment id="16293490" author="phunt" created="Sat, 16 Dec 2017 00:49:05 +0000"  >&lt;p&gt;lgtm, +1 thanks Abe.&lt;/p&gt;</comment>
                            <comment id="16293516" author="githubbot" created="Sat, 16 Dec 2017 01:07:36 +0000"  >&lt;p&gt;Github user afine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/433&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16293517" author="githubbot" created="Sat, 16 Dec 2017 01:08:03 +0000"  >&lt;p&gt;Github user afine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/434&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16293562" author="hudson" created="Sat, 16 Dec 2017 02:05:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3661 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3661/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3661/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2953&quot; title=&quot;Flaky Test: testNoLogBeforeLeaderEstablishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2953&quot;&gt;&lt;del&gt;ZOOKEEPER-2953&lt;/del&gt;&lt;/a&gt;: Flaky Test: testNoLogBeforeLeaderEstablishment (phunt: rev f2cbcc7e0d7adff08bd73a27f2193b1198e4c7f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java&lt;/li&gt;
	&lt;li&gt;(edit) src/java/test/org/apache/zookeeper/test/QuorumTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nu0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>