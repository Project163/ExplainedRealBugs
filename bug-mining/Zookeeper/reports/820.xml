<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:59:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2775] ZK Client not able to connect with Xid out of order error </title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2775</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>
&lt;p&gt;During Network unreachable scenario in one of the cluster, we observed Xid out of order and Nothing in the queue error continously. And ZK client it finally not able to connect successully to ZK server. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Logs:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;unexpected error, closing socket connection and attempting reconnect | org.apache.zookeeper.ClientCnxn (ClientCnxn.java:1447) &lt;br/&gt;
java.io.IOException: Xid out of order. Got Xid 52 with err 0 expected Xid 53 for a packet with details: clientPath:null serverPath:null finished:false header:: 53,101  replyHeader:: 0,0,-4  request:: 12885502275,v&lt;/p&gt;
{&apos;/app1/controller,&apos;/app1/config/changes}
&lt;p&gt;,v{},v&lt;/p&gt;
{&apos;/app1/config/changes}
&lt;p&gt;  response:: null&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.readResponse(ClientCnxn.java:996)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:101)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:370)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1426)&lt;/p&gt;

&lt;p&gt;unexpected error, closing socket connection and attempting reconnect &lt;br/&gt;
java.io.IOException: Nothing in the queue, but got 1&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.readResponse(ClientCnxn.java:983)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:101)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:370)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1426)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Analysis:&lt;/b&gt; &lt;br/&gt;
1) First time Client fails to do SASL login due to network unreachable problem.&lt;br/&gt;
2017-03-29 10:03:59,377 | WARN  | &lt;span class=&quot;error&quot;&gt;&amp;#91;main-SendThread(192.168.130.8:24002)&amp;#93;&lt;/span&gt; | SASL configuration failed: javax.security.auth.login.LoginException: Network is unreachable (sendto failed) Will continue connection to Zookeeper server without SASL authentication, if Zookeeper server allows it. | org.apache.zookeeper.ClientCnxn (ClientCnxn.java:1307) &lt;br/&gt;
	Here the boolean saslLoginFailed becomes true.&lt;/p&gt;

&lt;p&gt;2) After some time network connection is recovered and client is successully able to login but still the boolean saslLoginFailed is not reset to false. &lt;/p&gt;

&lt;p&gt;3) Now SASL negotiation between client and server start happening and during this time no user request will be sent. ( As the socket channel will be closed for write till sasl negotiation complets)&lt;br/&gt;
4) Now response from server for SASL packet will be processed by the client and client assumes that tunnelAuthInProgress() is finished ( method checks for saslLoginFailed boolean Since the boolean is true it assumes its done.) and tries to process the packet as a other packet and will result in above errors. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution:&lt;/b&gt;  Reset the saslLoginFailed boolean every time before client login&lt;/p&gt;</description>
                <environment></environment>
        <key id="13069343">ZOOKEEPER-2775</key>
            <summary>ZK Client not able to connect with Xid out of order error </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arshad.mohammad">Mohammad Arshad</assignee>
                                    <reporter username="Bhupendra">Bhupendra Kumar Jain</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 May 2017 06:12:03 +0000</created>
                <updated>Thu, 25 Jan 2018 22:07:58 +0000</updated>
                            <resolved>Mon, 12 Jun 2017 23:18:39 +0000</resolved>
                                    <version>3.4.10</version>
                    <version>3.5.3</version>
                    <version>3.6.0</version>
                                    <fixVersion>3.4.11</fixVersion>
                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>java client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15997846" author="arshad.mohammad" created="Fri, 5 May 2017 06:29:09 +0000"  >&lt;p&gt;This issue has been discussed many times, many places but it was never concluded.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bhupendra&quot; class=&quot;user-hover&quot; rel=&quot;Bhupendra&quot;&gt;Bhupendra&lt;/a&gt; for analyzing and reporting it.&lt;br/&gt;
Are you willing to submit the fix?&lt;/p&gt;</comment>
                            <comment id="16009967" author="arshad.mohammad" created="Mon, 15 May 2017 03:51:18 +0000"  >&lt;p&gt;Discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bhupendra&quot; class=&quot;user-hover&quot; rel=&quot;Bhupendra&quot;&gt;Bhupendra&lt;/a&gt; offline, I will submit the fix&lt;/p&gt;</comment>
                            <comment id="16009971" author="arshad.mohammad" created="Mon, 15 May 2017 04:01:18 +0000"  >&lt;p&gt;Submitting patch for quick review, later i will raise merge request.&lt;br/&gt;
1) Fix has just one line change&lt;br/&gt;
2) Moved SaslAuthTest to org.apache.zookeeper package and added test case for this defect scenario&lt;/p&gt;</comment>
                            <comment id="16010650" author="githubbot" created="Mon, 15 May 2017 15:00:27 +0000"  >&lt;p&gt;GitHub user arshadmohammad opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;: ZK Client not able to connect with Xid out of order error&lt;/p&gt;

&lt;p&gt;    Once client enters into Xid out of order issue, It never comes to normal state. It keeps trying to connect and  fail with the same error.  Recreating/Restarting is the only solution as of now. This happens because of bug in the ZK client code. This MR provides the fix. &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/arshadmohammad/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/arshadmohammad/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;-XidOutOfOrder&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #254&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16010687" author="hadoopqa" created="Mon, 15 May 2017 15:20:00 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/688//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16011195" author="githubbot" created="Mon, 15 May 2017 19:37:10 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116581847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116581847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    +&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;, &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            File tmpDir = createTmpDir();&lt;br/&gt;
    +            File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
    +            FileWriter fwriter = new FileWriter(saslConfFile);&lt;br/&gt;
    +&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server &lt;/p&gt;
{\n&quot; + &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;          user_super=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;\n&quot; + &quot;Client &lt;/p&gt;
{\n&quot;
    +                    + &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;       username=\&quot;super\&quot;\n&quot; + &quot;       password=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.close();&lt;br/&gt;
    +            System.setProperty(&quot;java.security.auth.login.config&quot;, saslConfFile.getAbsolutePath());&lt;br/&gt;
    +        } catch (IOException e) &lt;/p&gt;
{
    +            // could not create tmp directory to hold JAAS conf file : test will
    +            // fail now.
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @AfterClass&lt;br/&gt;
    +    public static void clean() &lt;/p&gt;
{
    +        System.clearProperty(&quot;zookeeper.authProvider.1&quot;);
    +        System.clearProperty(&quot;java.security.auth.login.config&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private AtomicInteger authFailed = new AtomicInteger(0);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    protected TestableZooKeeper createClient(String hp) throws IOException, InterruptedException &lt;/p&gt;
{
    +        MyWatcher watcher = new MyWatcher();
    +        return createClient(watcher, hp);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private class MyWatcher extends CountdownWatcher {&lt;br/&gt;
    +        @Override&lt;br/&gt;
    +        public synchronized void process(WatchedEvent event) {&lt;br/&gt;
    +            if (event.getState() == KeeperState.AuthFailed) &lt;/p&gt;
{
    +                authFailed.incrementAndGet();
    +            }
&lt;p&gt; else &lt;/p&gt;
{
    +                super.process(event);
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testAuth() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            zk.create(&quot;/path1&quot;, null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);
    +            Thread.sleep(1000);
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            zk.close();
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testValidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; validIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        validIds.add(&quot;user&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com&quot;);&lt;br/&gt;
    +        validIds.add(&quot;user@KERB.REALM&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com@KERB.REALM&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String validId : validIds) {
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();
    +            ACL acl = new ACL(0, new Id(&quot;sasl&quot;, validId));
    +            aclList.add(acl);
    +            zk.create(&quot;/valid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +            i++;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testInvalidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; invalidIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM/server.com&quot;);&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM1@KERB.REALM2&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String invalidId : invalidIds) {&lt;br/&gt;
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    +            try {
    +                ACL acl = new ACL(0, new Id(&quot;sasl&quot;, invalidId));
    +                aclList.add(acl);
    +                zk.create(&quot;/invalid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +                Assert.fail(&quot;SASLAuthenticationProvider.isValid() failed to catch invalid Id.&quot;);
    +            } catch (KeeperException.InvalidACLException e) {
    +                // ok.
    +            } finally {
    +                i++;
    +            }&lt;br/&gt;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testZKOperationsAfterClientSaslAuthFailure() throws Exception {&lt;br/&gt;
    +        CountdownWatcher watcher = new CountdownWatcher();&lt;br/&gt;
    +        ZooKeeper zk = new ZooKeeper(hostPort, CONNECTION_TIMEOUT, watcher);&lt;br/&gt;
    +        watcher.waitForConnected(CONNECTION_TIMEOUT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            setSaslFailureFlag(zk);&lt;br/&gt;
    +&lt;br/&gt;
    +            // try node creation for around 15 second,&lt;br/&gt;
    +            int totalTry = 10;&lt;br/&gt;
    +            int tryCount = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +            boolean success = false;&lt;br/&gt;
    +            while (!success &amp;amp;&amp;amp; tryCount++ &amp;lt;= totalTry) {&lt;br/&gt;
    +                try {
    +                    zk.create(&quot;/saslAuthFail&quot;, &quot;data&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE,
    +                            CreateMode.PERSISTENT_SEQUENTIAL);
    +                    success = true;
    +                } catch (KeeperException.ConnectionLossException e) {
    +                    Thread.sleep(1000);
    +                    // do nothing
    +                }&lt;br/&gt;
    +            }&lt;br/&gt;
    +            assertTrue(&quot;ZNode creation is failing continusly after Sasl auth failure.&quot;, success);&lt;br/&gt;
    +&lt;br/&gt;
    +        } finally {    +            zk.close();    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    // set saslLoginFailed to true to simulate SASL login failure,&lt;br/&gt;
    +    // LoginException&lt;br/&gt;
    +    private void setSaslFailureFlag(ZooKeeper zk) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    would it be possible to inject a mock ZooKeeperSaslClient for the test, it may be cleaner and more maintainable than reflection?&lt;/p&gt;</comment>
                            <comment id="16011196" author="githubbot" created="Mon, 15 May 2017 19:37:10 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116581496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116581496&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    +&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;, &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            File tmpDir = createTmpDir();&lt;br/&gt;
    +            File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
    +            FileWriter fwriter = new FileWriter(saslConfFile);&lt;br/&gt;
    +&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server &lt;/p&gt;
{\n&quot; + &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;          user_super=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;\n&quot; + &quot;Client &lt;/p&gt;
{\n&quot;
    +                    + &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;       username=\&quot;super\&quot;\n&quot; + &quot;       password=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.close();&lt;br/&gt;
    +            System.setProperty(&quot;java.security.auth.login.config&quot;, saslConfFile.getAbsolutePath());&lt;br/&gt;
    +        } catch (IOException e) &lt;/p&gt;
{
    +            // could not create tmp directory to hold JAAS conf file : test will
    +            // fail now.
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @AfterClass&lt;br/&gt;
    +    public static void clean() &lt;/p&gt;
{
    +        System.clearProperty(&quot;zookeeper.authProvider.1&quot;);
    +        System.clearProperty(&quot;java.security.auth.login.config&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private AtomicInteger authFailed = new AtomicInteger(0);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    protected TestableZooKeeper createClient(String hp) throws IOException, InterruptedException &lt;/p&gt;
{
    +        MyWatcher watcher = new MyWatcher();
    +        return createClient(watcher, hp);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private class MyWatcher extends CountdownWatcher {&lt;br/&gt;
    +        @Override&lt;br/&gt;
    +        public synchronized void process(WatchedEvent event) {&lt;br/&gt;
    +            if (event.getState() == KeeperState.AuthFailed) &lt;/p&gt;
{
    +                authFailed.incrementAndGet();
    +            }
&lt;p&gt; else &lt;/p&gt;
{
    +                super.process(event);
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testAuth() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            zk.create(&quot;/path1&quot;, null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);
    +            Thread.sleep(1000);
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            zk.close();
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testValidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; validIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        validIds.add(&quot;user&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com&quot;);&lt;br/&gt;
    +        validIds.add(&quot;user@KERB.REALM&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com@KERB.REALM&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String validId : validIds) &lt;/p&gt;
{
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();
    +            ACL acl = new ACL(0, new Id(&quot;sasl&quot;, validId));
    +            aclList.add(acl);
    +            zk.create(&quot;/valid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +            i++;
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testInvalidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; invalidIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM/server.com&quot;);&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM1@KERB.REALM2&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String invalidId : invalidIds) {&lt;br/&gt;
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    +            try &lt;/p&gt;
{
    +                ACL acl = new ACL(0, new Id(&quot;sasl&quot;, invalidId));
    +                aclList.add(acl);
    +                zk.create(&quot;/invalid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +                Assert.fail(&quot;SASLAuthenticationProvider.isValid() failed to catch invalid Id.&quot;);
    +            }
&lt;p&gt; catch (KeeperException.InvalidACLException e) &lt;/p&gt;
{
    +                // ok.
    +            }
&lt;p&gt; finally &lt;/p&gt;
{
    +                i++;
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testZKOperationsAfterClientSaslAuthFailure() throws Exception {&lt;br/&gt;
    +        CountdownWatcher watcher = new CountdownWatcher();&lt;br/&gt;
    +        ZooKeeper zk = new ZooKeeper(hostPort, CONNECTION_TIMEOUT, watcher);&lt;br/&gt;
    +        watcher.waitForConnected(CONNECTION_TIMEOUT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            setSaslFailureFlag(zk);&lt;br/&gt;
    +&lt;br/&gt;
    +            // try node creation for around 15 second,&lt;br/&gt;
    +            int totalTry = 10;&lt;br/&gt;
    +            int tryCount = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +            boolean success = false;&lt;br/&gt;
    +            while (!success &amp;amp;&amp;amp; tryCount++ &amp;lt;= totalTry) {&lt;br/&gt;
    +                try &lt;/p&gt;
{
    +                    zk.create(&quot;/saslAuthFail&quot;, &quot;data&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE,
    +                            CreateMode.PERSISTENT_SEQUENTIAL);
    +                    success = true;
    +                }
&lt;p&gt; catch (KeeperException.ConnectionLossException e) &lt;/p&gt;
{
    +                    Thread.sleep(1000);
    +                    // do nothing
    +                }
&lt;p&gt;    +            }&lt;br/&gt;
    +            assertTrue(&quot;ZNode creation is failing continusly after Sasl auth failure.&quot;, success);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    typo: continuously&lt;/p&gt;</comment>
                            <comment id="16011197" author="githubbot" created="Mon, 15 May 2017 19:37:10 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116565952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116565952&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    why was this file moved?&lt;/p&gt;</comment>
                            <comment id="16011198" author="githubbot" created="Mon, 15 May 2017 19:37:10 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116570478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116570478&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1080,6 +1080,8 @@ private void startConnect() throws IOException &lt;/p&gt;
{
                             zooKeeperSaslClient.shutdown();
                         }
&lt;p&gt;                         zooKeeperSaslClient = new ZooKeeperSaslClient(getServerPrincipal(addr), clientConfig);&lt;br/&gt;
    +                    // SASL login succeeded&lt;br/&gt;
    +                    saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I wonder if this will impact `clientTunneledAuthenticationInProgress`? Perhaps we should revert this when a new connection attempt starts?&lt;/p&gt;</comment>
                            <comment id="16011199" author="githubbot" created="Mon, 15 May 2017 19:37:11 +0000"  >&lt;p&gt;Github user afine commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116578675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116578675&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    and i think the diff would be cleaner if a `git mv` was used instead of adding one file and deleting the other.&lt;/p&gt;</comment>
                            <comment id="16013066" author="githubbot" created="Tue, 16 May 2017 20:36:41 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    How about removing saslLoginFailed and use zooKeeperSaslClient to track the state of sasl login? The invariant would be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;sasl login failed: zooKeeperSaslClient == null&lt;/li&gt;
	&lt;li&gt;sasl login succeeded or in progress: zooKeeperSaslClient != null&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16013195" author="githubbot" created="Tue, 16 May 2017 22:13:53 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116871274&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116871274&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    File was moved to make SendThread accessible in the test case.  Now moved with git mv. This is the right way to move the file&lt;/p&gt;</comment>
                            <comment id="16013196" author="githubbot" created="Tue, 16 May 2017 22:14:27 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116871380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116871380&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    +&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;, &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            File tmpDir = createTmpDir();&lt;br/&gt;
    +            File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
    +            FileWriter fwriter = new FileWriter(saslConfFile);&lt;br/&gt;
    +&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server &lt;/p&gt;
{\n&quot; + &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;          user_super=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;\n&quot; + &quot;Client &lt;/p&gt;
{\n&quot;
    +                    + &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;       username=\&quot;super\&quot;\n&quot; + &quot;       password=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.close();&lt;br/&gt;
    +            System.setProperty(&quot;java.security.auth.login.config&quot;, saslConfFile.getAbsolutePath());&lt;br/&gt;
    +        } catch (IOException e) &lt;/p&gt;
{
    +            // could not create tmp directory to hold JAAS conf file : test will
    +            // fail now.
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @AfterClass&lt;br/&gt;
    +    public static void clean() &lt;/p&gt;
{
    +        System.clearProperty(&quot;zookeeper.authProvider.1&quot;);
    +        System.clearProperty(&quot;java.security.auth.login.config&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private AtomicInteger authFailed = new AtomicInteger(0);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    protected TestableZooKeeper createClient(String hp) throws IOException, InterruptedException &lt;/p&gt;
{
    +        MyWatcher watcher = new MyWatcher();
    +        return createClient(watcher, hp);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private class MyWatcher extends CountdownWatcher {&lt;br/&gt;
    +        @Override&lt;br/&gt;
    +        public synchronized void process(WatchedEvent event) {&lt;br/&gt;
    +            if (event.getState() == KeeperState.AuthFailed) &lt;/p&gt;
{
    +                authFailed.incrementAndGet();
    +            }
&lt;p&gt; else &lt;/p&gt;
{
    +                super.process(event);
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testAuth() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            zk.create(&quot;/path1&quot;, null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);
    +            Thread.sleep(1000);
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            zk.close();
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testValidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; validIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        validIds.add(&quot;user&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com&quot;);&lt;br/&gt;
    +        validIds.add(&quot;user@KERB.REALM&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com@KERB.REALM&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String validId : validIds) &lt;/p&gt;
{
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();
    +            ACL acl = new ACL(0, new Id(&quot;sasl&quot;, validId));
    +            aclList.add(acl);
    +            zk.create(&quot;/valid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +            i++;
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testInvalidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; invalidIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM/server.com&quot;);&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM1@KERB.REALM2&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String invalidId : invalidIds) {&lt;br/&gt;
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    +            try &lt;/p&gt;
{
    +                ACL acl = new ACL(0, new Id(&quot;sasl&quot;, invalidId));
    +                aclList.add(acl);
    +                zk.create(&quot;/invalid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +                Assert.fail(&quot;SASLAuthenticationProvider.isValid() failed to catch invalid Id.&quot;);
    +            }
&lt;p&gt; catch (KeeperException.InvalidACLException e) &lt;/p&gt;
{
    +                // ok.
    +            }
&lt;p&gt; finally &lt;/p&gt;
{
    +                i++;
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testZKOperationsAfterClientSaslAuthFailure() throws Exception {&lt;br/&gt;
    +        CountdownWatcher watcher = new CountdownWatcher();&lt;br/&gt;
    +        ZooKeeper zk = new ZooKeeper(hostPort, CONNECTION_TIMEOUT, watcher);&lt;br/&gt;
    +        watcher.waitForConnected(CONNECTION_TIMEOUT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            setSaslFailureFlag(zk);&lt;br/&gt;
    +&lt;br/&gt;
    +            // try node creation for around 15 second,&lt;br/&gt;
    +            int totalTry = 10;&lt;br/&gt;
    +            int tryCount = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +            boolean success = false;&lt;br/&gt;
    +            while (!success &amp;amp;&amp;amp; tryCount++ &amp;lt;= totalTry) {&lt;br/&gt;
    +                try &lt;/p&gt;
{
    +                    zk.create(&quot;/saslAuthFail&quot;, &quot;data&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE,
    +                            CreateMode.PERSISTENT_SEQUENTIAL);
    +                    success = true;
    +                }
&lt;p&gt; catch (KeeperException.ConnectionLossException e) &lt;/p&gt;
{
    +                    Thread.sleep(1000);
    +                    // do nothing
    +                }
&lt;p&gt;    +            }&lt;br/&gt;
    +            assertTrue(&quot;ZNode creation is failing continusly after Sasl auth failure.&quot;, success);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    corrected&lt;/p&gt;</comment>
                            <comment id="16013197" author="githubbot" created="Tue, 16 May 2017 22:15:15 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116871534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116871534&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,187 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.File;&lt;br/&gt;
    +import java.io.FileWriter;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
    +import java.util.ArrayList;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.concurrent.atomic.AtomicInteger;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
    +import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
    +import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
    +import org.apache.zookeeper.data.ACL;&lt;br/&gt;
    +import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class SaslAuthTest extends ClientBase {&lt;br/&gt;
    +&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;, &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            File tmpDir = createTmpDir();&lt;br/&gt;
    +            File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
    +            FileWriter fwriter = new FileWriter(saslConfFile);&lt;br/&gt;
    +&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server &lt;/p&gt;
{\n&quot; + &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;          user_super=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;\n&quot; + &quot;Client &lt;/p&gt;
{\n&quot;
    +                    + &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot;
    +                    + &quot;       username=\&quot;super\&quot;\n&quot; + &quot;       password=\&quot;test\&quot;;\n&quot; + &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.close();&lt;br/&gt;
    +            System.setProperty(&quot;java.security.auth.login.config&quot;, saslConfFile.getAbsolutePath());&lt;br/&gt;
    +        } catch (IOException e) &lt;/p&gt;
{
    +            // could not create tmp directory to hold JAAS conf file : test will
    +            // fail now.
    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @AfterClass&lt;br/&gt;
    +    public static void clean() &lt;/p&gt;
{
    +        System.clearProperty(&quot;zookeeper.authProvider.1&quot;);
    +        System.clearProperty(&quot;java.security.auth.login.config&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private AtomicInteger authFailed = new AtomicInteger(0);&lt;br/&gt;
    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    protected TestableZooKeeper createClient(String hp) throws IOException, InterruptedException &lt;/p&gt;
{
    +        MyWatcher watcher = new MyWatcher();
    +        return createClient(watcher, hp);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private class MyWatcher extends CountdownWatcher {&lt;br/&gt;
    +        @Override&lt;br/&gt;
    +        public synchronized void process(WatchedEvent event) {&lt;br/&gt;
    +            if (event.getState() == KeeperState.AuthFailed) &lt;/p&gt;
{
    +                authFailed.incrementAndGet();
    +            }
&lt;p&gt; else &lt;/p&gt;
{
    +                super.process(event);
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testAuth() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            zk.create(&quot;/path1&quot;, null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);
    +            Thread.sleep(1000);
    +        }
&lt;p&gt; finally &lt;/p&gt;
{
    +            zk.close();
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testValidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; validIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        validIds.add(&quot;user&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com&quot;);&lt;br/&gt;
    +        validIds.add(&quot;user@KERB.REALM&quot;);&lt;br/&gt;
    +        validIds.add(&quot;service/host.name.com@KERB.REALM&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String validId : validIds) {
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();
    +            ACL acl = new ACL(0, new Id(&quot;sasl&quot;, validId));
    +            aclList.add(acl);
    +            zk.create(&quot;/valid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +            i++;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testInvalidSaslIds() throws Exception {&lt;br/&gt;
    +        ZooKeeper zk = createClient();&lt;br/&gt;
    +&lt;br/&gt;
    +        List&amp;lt;String&amp;gt; invalidIds = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM/server.com&quot;);&lt;br/&gt;
    +        invalidIds.add(&quot;user@KERB.REALM1@KERB.REALM2&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        int i = 0;&lt;br/&gt;
    +        for (String invalidId : invalidIds) {&lt;br/&gt;
    +            List&amp;lt;ACL&amp;gt; aclList = new ArrayList&amp;lt;ACL&amp;gt;();&lt;br/&gt;
    +            try {
    +                ACL acl = new ACL(0, new Id(&quot;sasl&quot;, invalidId));
    +                aclList.add(acl);
    +                zk.create(&quot;/invalid&quot; + i, null, aclList, CreateMode.PERSISTENT);
    +                Assert.fail(&quot;SASLAuthenticationProvider.isValid() failed to catch invalid Id.&quot;);
    +            } catch (KeeperException.InvalidACLException e) {
    +                // ok.
    +            } finally {
    +                i++;
    +            }&lt;br/&gt;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    public void testZKOperationsAfterClientSaslAuthFailure() throws Exception {&lt;br/&gt;
    +        CountdownWatcher watcher = new CountdownWatcher();&lt;br/&gt;
    +        ZooKeeper zk = new ZooKeeper(hostPort, CONNECTION_TIMEOUT, watcher);&lt;br/&gt;
    +        watcher.waitForConnected(CONNECTION_TIMEOUT);&lt;br/&gt;
    +        try {&lt;br/&gt;
    +            setSaslFailureFlag(zk);&lt;br/&gt;
    +&lt;br/&gt;
    +            // try node creation for around 15 second,&lt;br/&gt;
    +            int totalTry = 10;&lt;br/&gt;
    +            int tryCount = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +            boolean success = false;&lt;br/&gt;
    +            while (!success &amp;amp;&amp;amp; tryCount++ &amp;lt;= totalTry) {&lt;br/&gt;
    +                try {
    +                    zk.create(&quot;/saslAuthFail&quot;, &quot;data&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE,
    +                            CreateMode.PERSISTENT_SEQUENTIAL);
    +                    success = true;
    +                } catch (KeeperException.ConnectionLossException e) {
    +                    Thread.sleep(1000);
    +                    // do nothing
    +                }&lt;br/&gt;
    +            }&lt;br/&gt;
    +            assertTrue(&quot;ZNode creation is failing continusly after Sasl auth failure.&quot;, success);&lt;br/&gt;
    +&lt;br/&gt;
    +        } finally {    +            zk.close();    +        }
&lt;p&gt;    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    // set saslLoginFailed to true to simulate SASL login failure,&lt;br/&gt;
    +    // LoginException&lt;br/&gt;
    +    private void setSaslFailureFlag(ZooKeeper zk) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    There will be lot of code change which I want to avoid.&lt;/p&gt;</comment>
                            <comment id="16013200" author="githubbot" created="Tue, 16 May 2017 22:22:55 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116872750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116872750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1080,6 +1080,8 @@ private void startConnect() throws IOException &lt;/p&gt;
{
                             zooKeeperSaslClient.shutdown();
                         }
&lt;p&gt;                         zooKeeperSaslClient = new ZooKeeperSaslClient(getServerPrincipal(addr), clientConfig);&lt;br/&gt;
    +                    // SASL login succeeded&lt;br/&gt;
    +                    saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    this change has impact on tunnelAuthInProgress.  But yes, we should init the variable on new connection start as this is tunnelAuthInProgress logic expects.&lt;/p&gt;</comment>
                            <comment id="16013206" author="githubbot" created="Tue, 16 May 2017 22:26:51 +0000"  >&lt;p&gt;Github user arshadmohammad commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     zooKeeperSaslClient == null is already used in tunnelAuthInProgress() which is quite different from saslLoginFailed being false. So I think we can not do above change.&lt;/p&gt;</comment>
                            <comment id="16013219" author="githubbot" created="Tue, 16 May 2017 22:40:03 +0000"  >&lt;p&gt;Github user arshadmohammad commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @afine @hanm for the reviews. Addressed the comments, Please have a look.&lt;/p&gt;</comment>
                            <comment id="16013238" author="hadoopqa" created="Tue, 16 May 2017 23:04:41 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/693//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16013244" author="githubbot" created="Tue, 16 May 2017 23:08:29 +0000"  >&lt;p&gt;Github user hanm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116879091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116879091&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -16,54 +16,58 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
      */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    -package org.apache.zookeeper.test;&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;/p&gt;

&lt;p&gt;     import java.io.File;&lt;br/&gt;
     import java.io.FileWriter;&lt;br/&gt;
     import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
     import java.util.ArrayList;&lt;br/&gt;
     import java.util.List;&lt;br/&gt;
     import java.util.concurrent.atomic.AtomicInteger;&lt;/p&gt;

&lt;p&gt;    -import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    -import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    -import org.apache.zookeeper.TestableZooKeeper;&lt;br/&gt;
    -import org.apache.zookeeper.WatchedEvent;&lt;br/&gt;
    -import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
     import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
     import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
     import org.apache.zookeeper.data.ACL;&lt;br/&gt;
     import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
     import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
     import org.junit.Test;&lt;/p&gt;

&lt;p&gt;     public class SaslAuthTest extends ClientBase {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;static {&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;zookeeper.authProvider.1&quot;,&quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    -&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;,&lt;br/&gt;
    +                &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
             try {&lt;br/&gt;
                 File tmpDir = createTmpDir();&lt;br/&gt;
                 File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
                 FileWriter fwriter = new FileWriter(saslConfFile);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fwriter.write(&quot;&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;Server 
{\n&quot; +
    -                    &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot; +
    -                    &quot;          user_super=\&quot;test\&quot;;\n&quot; +
    -                    &quot;}
&lt;p&gt;;\n&quot; +&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&quot;Client 
{\n&quot; +
    -                    &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot; +
    -                    &quot;       username=\&quot;super\&quot;\n&quot; +
    -                    &quot;       password=\&quot;test\&quot;;\n&quot; +
    -                    &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server {\n&quot;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Nit: not sure if change is by accident or not, but this made readability worse.&lt;/p&gt;</comment>
                            <comment id="16013245" author="githubbot" created="Tue, 16 May 2017 23:11:19 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; So I think we can not do above change.&lt;/p&gt;

&lt;p&gt;    Correct - I was looking to consolidate unnecessary variables used to encode states but looks like we do need saslLoginFailed.&lt;/p&gt;

&lt;p&gt;    lgtm just with one nit on the test file readability.&lt;/p&gt;</comment>
                            <comment id="16013892" author="githubbot" created="Wed, 17 May 2017 11:46:41 +0000"  >&lt;p&gt;Github user rakeshadr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r116976191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r116976191&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1054,6 +1054,8 @@ private void sendPing() {&lt;br/&gt;
             private boolean saslLoginFailed = false;&lt;/p&gt;

&lt;p&gt;             private void startConnect() throws IOException {&lt;br/&gt;
    +            // initializing it for new connection&lt;br/&gt;
    +            saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    How about setting to false only after client has successfully logged in instead of setting to false at the beginning. &lt;br/&gt;
    ```&lt;br/&gt;
    zooKeeperSaslClient = new ZooKeeperSaslClient(getServerPrincipal(addr), clientConfig);&lt;br/&gt;
    saslLoginFailed = false;&lt;br/&gt;
    ```&lt;br/&gt;
    I&apos;m not sure about any concurrency cases between narrow window of resetting the flag to false and the client attempt to do login operation. Since the previous operation was failed, the client should still reflect the status until the login is successful next time, right?&lt;/p&gt;
</comment>
                            <comment id="16014110" author="githubbot" created="Wed, 17 May 2017 14:22:46 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r117014954&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r117014954&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1054,6 +1054,8 @@ private void sendPing() {&lt;br/&gt;
             private boolean saslLoginFailed = false;&lt;/p&gt;

&lt;p&gt;             private void startConnect() throws IOException {&lt;br/&gt;
    +            // initializing it for new connection&lt;br/&gt;
    +            saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Only one thread involved in new connection creation. So there will not any chance another thread setting the flag in between.&lt;/p&gt;
</comment>
                            <comment id="16014119" author="githubbot" created="Wed, 17 May 2017 14:29:42 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r117016986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r117016986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1054,6 +1054,8 @@ private void sendPing() {&lt;br/&gt;
             private boolean saslLoginFailed = false;&lt;/p&gt;

&lt;p&gt;             private void startConnect() throws IOException {&lt;br/&gt;
    +            // initializing it for new connection&lt;br/&gt;
    +            saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Successfull Login is not necessary to successfully connect to ZK Server.  ZK server may allow connection without client login being successful, based on configuration. So it is better to set the flag at the start of the new connection.  &lt;br/&gt;
    This change has impact on tunnelAuthInProgress, in this method also same thing is expeted. In this there is a sceanrio where zooKeeperSaslClient can be null&lt;/p&gt;</comment>
                            <comment id="16014137" author="githubbot" created="Wed, 17 May 2017 14:43:44 +0000"  >&lt;p&gt;Github user arshadmohammad commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r117021379&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r117021379&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/test/org/apache/zookeeper/SaslAuthTest.java &amp;#8212;&lt;br/&gt;
    @@ -16,54 +16,58 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
      */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    -package org.apache.zookeeper.test;&lt;br/&gt;
    +package org.apache.zookeeper;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;/p&gt;

&lt;p&gt;     import java.io.File;&lt;br/&gt;
     import java.io.FileWriter;&lt;br/&gt;
     import java.io.IOException;&lt;br/&gt;
    +import java.lang.reflect.Field;&lt;br/&gt;
     import java.util.ArrayList;&lt;br/&gt;
     import java.util.List;&lt;br/&gt;
     import java.util.concurrent.atomic.AtomicInteger;&lt;/p&gt;

&lt;p&gt;    -import org.apache.zookeeper.CreateMode;&lt;br/&gt;
    -import org.apache.zookeeper.KeeperException;&lt;br/&gt;
    -import org.apache.zookeeper.TestableZooKeeper;&lt;br/&gt;
    -import org.apache.zookeeper.WatchedEvent;&lt;br/&gt;
    -import org.apache.zookeeper.ZooKeeper;&lt;br/&gt;
    +import org.apache.zookeeper.ClientCnxn.SendThread;&lt;br/&gt;
     import org.apache.zookeeper.Watcher.Event.KeeperState;&lt;br/&gt;
     import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
     import org.apache.zookeeper.data.ACL;&lt;br/&gt;
     import org.apache.zookeeper.data.Id;&lt;br/&gt;
    +import org.apache.zookeeper.test.ClientBase;&lt;br/&gt;
    +import org.junit.AfterClass;&lt;br/&gt;
     import org.junit.Assert;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
     import org.junit.Test;&lt;/p&gt;

&lt;p&gt;     public class SaslAuthTest extends ClientBase {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;static {&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;zookeeper.authProvider.1&quot;,&quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
    -&lt;br/&gt;
    +    @BeforeClass&lt;br/&gt;
    +    public static void init() {&lt;br/&gt;
    +        System.setProperty(&quot;zookeeper.authProvider.1&quot;,&lt;br/&gt;
    +                &quot;org.apache.zookeeper.server.auth.SASLAuthenticationProvider&quot;);&lt;br/&gt;
             try {&lt;br/&gt;
                 File tmpDir = createTmpDir();&lt;br/&gt;
                 File saslConfFile = new File(tmpDir, &quot;jaas.conf&quot;);&lt;br/&gt;
                 FileWriter fwriter = new FileWriter(saslConfFile);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fwriter.write(&quot;&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;Server 
{\n&quot; +
    -                    &quot;          org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot; +
    -                    &quot;          user_super=\&quot;test\&quot;;\n&quot; +
    -                    &quot;}
&lt;p&gt;;\n&quot; +&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&quot;Client 
{\n&quot; +
    -                    &quot;       org.apache.zookeeper.server.auth.DigestLoginModule required\n&quot; +
    -                    &quot;       username=\&quot;super\&quot;\n&quot; +
    -                    &quot;       password=\&quot;test\&quot;;\n&quot; +
    -                    &quot;}
&lt;p&gt;;&quot; + &quot;\n&quot;);&lt;br/&gt;
    +            fwriter.write(&quot;&quot; + &quot;Server {\n&quot;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Same content was already present, I tried to format it which could not help to clean.&lt;br/&gt;
    Now moved jaas config file content generation to new method.&lt;/p&gt;</comment>
                            <comment id="16014208" author="hadoopqa" created="Wed, 17 May 2017 15:26:05 +0000"  >&lt;p&gt;+1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/699//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16014938" author="githubbot" created="Wed, 17 May 2017 23:33:03 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm.&lt;/p&gt;</comment>
                            <comment id="16015523" author="githubbot" created="Thu, 18 May 2017 10:00:04 +0000"  >&lt;p&gt;Github user rakeshadr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254#discussion_r117207576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254#discussion_r117207576&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java &amp;#8212;&lt;br/&gt;
    @@ -1054,6 +1054,8 @@ private void sendPing() {&lt;br/&gt;
             private boolean saslLoginFailed = false;&lt;/p&gt;

&lt;p&gt;             private void startConnect() throws IOException {&lt;br/&gt;
    +            // initializing it for new connection&lt;br/&gt;
    +            saslLoginFailed = false;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks @arshadmohammad  for the details.&lt;/p&gt;

&lt;p&gt;    yes, only `SendThread` is updating the flag. But, during sasl login retries period, the flag status will be checked by `tunnelAuthInProgress()` packet processing thread, so multiple threads are accessing the flag. The code looks little tricky and `zooKeeperSaslClient `null value represents auth in progress. I&apos;m almost OK with the change and trying another attempt to avoid any compatibility issues to the users as this would go to stable branches&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. &lt;/p&gt;

&lt;p&gt;    Earlier the behavior was, once the flag updated to flase, `tunnelAuthInProgress` function would return false always. Now, with the proposed fix, sometimes it would return false and sometimes it would return true, right? Will this results in any consistency issues later?&lt;/p&gt;

&lt;p&gt;    Assume  a case, where successful login takes several retries.&lt;br/&gt;
    (1) Immediately after the login failure the flag will be false. During this time `tunnelAuthInProgress() ` function returns false to the callers.&lt;br/&gt;
    (2) Assume, `startConnect()` retries started. During this time, `tunnelAuthInProgress() ` function returns true to the callers.&lt;/p&gt;

&lt;p&gt;    My previous suggestion was to avoid this situation and consistently `tunnelAuthInProgress()` function return false until the next successful login. Does this makes sense to you?&lt;/p&gt;

&lt;p&gt;    @hanm, welcome your thoughts. Thanks!&lt;/p&gt;</comment>
                            <comment id="16016903" author="githubbot" created="Fri, 19 May 2017 05:02:50 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; Will this results in any consistency issues later?&lt;/p&gt;

&lt;p&gt;    I guess the previous behavior was problematic and the fact tunnelAuthInProgress always return false once a login failed (even after a new connection retry attempt) is a bug that this JIRA trying to fix, right? If we keep the old semantic then the bug will not be fixed because of the details described in the JIRA - basically if we keep the old semantic and always return false upon a failed login then the future SASL packet will be treated as normal packet and got ignored - thus SASL login will never succeed..&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; so multiple threads are accessing the flag. &lt;/p&gt;

&lt;p&gt;    Yeah this looks like the case - so should we set the flag as volatile?&lt;/p&gt;</comment>
                            <comment id="16036683" author="bhupendra" created="Mon, 5 Jun 2017 08:49:01 +0000"  >&lt;p&gt;In which case multiple threads will be accessing the flag ? As I checked, only sendThread access and modifies the flag. &lt;/p&gt;

&lt;p&gt;During SASL handshake also , the response packet is processed by sendThread itself in readResponse() method.  Also I observed, that the response never gets processed by ServerSaslResponseCallback . ( May be its unused now) ... &lt;/p&gt;

&lt;p&gt;Am I missing anything ? &lt;/p&gt;</comment>
                            <comment id="16037163" author="githubbot" created="Mon, 5 Jun 2017 16:24:24 +0000"  >&lt;p&gt;Github user rakeshrapache commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt; SASL login will never succeed&lt;/p&gt;

&lt;p&gt;    Yes, agreed. You guys are correct. I got confused with the server behavior of continue connection to Zookeeper server without SASL auth. I was thinking that there is a chance of sending data packets via unauth channel and processing async new connections simultaneously.&lt;/p&gt;

&lt;p&gt;    Thanks @arshadmohammad, @hanm and @Bhupendra Kumar for the clarifications.&lt;/p&gt;

&lt;p&gt;    +1 LGTM&lt;/p&gt;</comment>
                            <comment id="16042542" author="githubbot" created="Thu, 8 Jun 2017 10:58:00 +0000"  >&lt;p&gt;Github user arshadmohammad commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This PR can be merged to master and branch-3.5 only. I  will raise another pull request for branch-3.4&lt;/p&gt;</comment>
                            <comment id="16042918" author="githubbot" created="Thu, 8 Jun 2017 15:59:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16042923" author="hanm" created="Thu, 8 Jun 2017 16:01:33 +0000"  >&lt;p&gt;Committed to master&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/fa1dc109d4c1bb7913fee43170ed6131e3dc1b1f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/fa1dc109d4c1bb7913fee43170ed6131e3dc1b1f&lt;/a&gt;&lt;br/&gt;
branch-3.5&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/0026e27e81f4889816bec162964e2a721cc53db9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/0026e27e81f4889816bec162964e2a721cc53db9&lt;/a&gt;&lt;br/&gt;
branch-3.4&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/commit/ac5fa3f54fbf47437ed86bd02cd0e9fdb9edf5e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/commit/ac5fa3f54fbf47437ed86bd02cd0e9fdb9edf5e6&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16042988" author="hudson" created="Thu, 8 Jun 2017 16:36:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3419 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/3419/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/3419/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;: ZK Client not able to connect with Xid out of order (hanm: rev fa1dc109d4c1bb7913fee43170ed6131e3dc1b1f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) src/java/main/org/apache/zookeeper/ClientCnxn.java&lt;/li&gt;
	&lt;li&gt;(delete) src/java/test/org/apache/zookeeper/test/SaslAuthTest.java&lt;/li&gt;
	&lt;li&gt;(add) src/java/test/org/apache/zookeeper/SaslAuthTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16045627" author="githubbot" created="Sat, 10 Jun 2017 17:40:09 +0000"  >&lt;p&gt;GitHub user arshadmohammad opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;: ZK Client not able to connect with Xid out of order error&lt;/p&gt;

&lt;p&gt;    Same as PR &lt;a href=&quot;https://github.com/apache/zookeeper/pull/254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/254&lt;/a&gt; but this is for branch-3.4&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/arshadmohammad/zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/arshadmohammad/zookeeper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;-branch-3.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/278.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #278&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 31580024b18d57eff28acb7099bad0606b51efa3&lt;br/&gt;
Author: Mohammad Arshad &amp;lt;arshad@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-10T17:36:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;: ZK Client not able to connect with Xid out of order error&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16045643" author="hadoopqa" created="Sat, 10 Jun 2017 18:15:35 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 48 new Findbugs (version 3.0.1) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/783//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16047204" author="githubbot" created="Mon, 12 Jun 2017 23:17:29 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lgtm, will merge soon.&lt;/p&gt;</comment>
                            <comment id="16047205" author="hanm" created="Mon, 12 Jun 2017 23:18:39 +0000"  >&lt;p&gt;Issue resolved by pull request 278&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16050877" author="githubbot" created="Thu, 15 Jun 2017 18:04:28 +0000"  >&lt;p&gt;Github user hanm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It is merged, please close this @arshadmohammad.&lt;/p&gt;</comment>
                            <comment id="16051352" author="githubbot" created="Fri, 16 Jun 2017 04:20:12 +0000"  >&lt;p&gt;Github user arshadmohammad closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/zookeeper/pull/278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/278&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16340172" author="githubbot" created="Thu, 25 Jan 2018 22:05:51 +0000"  >&lt;p&gt;GitHub user jiajunwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/helix/pull/131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/helix/pull/131&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Bump up ZOOKEEPER version to 3.4.11.&lt;/p&gt;

&lt;p&gt;    There is a zk connection related bug (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;) fixed in 3.4.11. Bump up version to get the fix.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jiajunwang/helix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jiajunwang/helix&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/helix/pull/131.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/helix/pull/131.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #131&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 22cc4a4d4819b211b30094de7b3b0944cb5c033b&lt;br/&gt;
Author: jiajunwang &amp;lt;ericwang1985@...&amp;gt;&lt;br/&gt;
Date:   2018-01-25T22:04:13Z&lt;/p&gt;

&lt;p&gt;    Bump up ZOOKEEPER version to 3.4.11.&lt;/p&gt;

&lt;p&gt;    There is a zk connection related bug (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2775&quot; title=&quot;ZK Client not able to connect with Xid out of order error &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2775&quot;&gt;&lt;del&gt;ZOOKEEPER-2775&lt;/del&gt;&lt;/a&gt;) fixed in 3.4.11. Bump up version to get the fix.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16340175" author="githubbot" created="Thu, 25 Jan 2018 22:07:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/helix/pull/131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/helix/pull/131&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12868004" name="ZOOKEEPER-2775-01.patch" size="13606" author="arshad.mohammad" created="Mon, 15 May 2017 03:56:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3eiuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>