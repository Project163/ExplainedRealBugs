<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:02:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[ZOOKEEPER-2307] ZooKeeper not starting because acceptedEpoch is less than the currentEpoch</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-2307</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;This issue occurred in one of our test environment where disk was being changed to read only very frequently.&lt;br/&gt;
The the scenario is as follows:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Configure three node ZooKeeper cluster, lets say nodes are A, B and C&lt;/li&gt;
	&lt;li&gt;Start A and B. Both A and B start successfully, quorum is running.&lt;/li&gt;
	&lt;li&gt;Start C, because of IO error C fails to update acceptedEpoch file. But C also starts successfully, joins the quorum as follower&lt;/li&gt;
	&lt;li&gt;Stop C&lt;/li&gt;
	&lt;li&gt;Start C, bellow exception with message &quot;The accepted epoch, 0 is less than the current epoch, 1&quot; is thrown
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-10-29 16:52:32,942 [myid:3] - ERROR [main:QuorumPeer@784] - Unable to load database on disk
java.io.IOException: The accepted epoch, 0 is less than the current epoch, 1
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:781)
	at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:720)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:202)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:139)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:88)
2015-10-29 16:52:32,946 [myid:3] - ERROR [main:QuorumPeerMain@111] - Unexpected exception, exiting abnormally
java.lang.RuntimeException: Unable to run quorum server 
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:785)
	at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:720)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:202)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:139)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:88)
Caused by: java.io.IOException: The accepted epoch, 0 is less than the current epoch, 1
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:781)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12908923">ZOOKEEPER-2307</key>
            <summary>ZooKeeper not starting because acceptedEpoch is less than the currentEpoch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arshad.mohammad">Mohammad Arshad</assignee>
                                    <reporter username="arshad.mohammad">Mohammad Arshad</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 29 Oct 2015 15:12:25 +0000</created>
                <updated>Sun, 31 Oct 2021 08:43:44 +0000</updated>
                            <resolved>Tue, 17 Dec 2019 12:48:46 +0000</resolved>
                                                    <fixVersion>3.6.3</fixVersion>
                    <fixVersion>3.7.0</fixVersion>
                    <fixVersion>3.5.8</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>14</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="14980633" author="arshad.mohammad" created="Thu, 29 Oct 2015 15:28:56 +0000"  >&lt;p&gt;There is a problem in the code. Runtime value of acceptedEpoch is being updated before writing to acceptedEpoch file&lt;/p&gt;
    &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setAcceptedEpoch(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; e) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        acceptedEpoch = e;
        writeLongToFile(ACCEPTED_EPOCH_FILENAME, e);
    }
    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To fix the issue we should first write to file and then update the run time value. Same change should be done for currentEpoch as well.&lt;/p&gt;</comment>
                            <comment id="14980656" author="arshad.mohammad" created="Thu, 29 Oct 2015 15:41:17 +0000"  >&lt;p&gt;Submitting test patch &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2307&quot; title=&quot;ZooKeeper not starting because acceptedEpoch is less than the currentEpoch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2307&quot;&gt;&lt;del&gt;ZOOKEEPER-2307&lt;/del&gt;&lt;/a&gt;-01.patch to reproduce the scenario, also to have better understanding of the scenario. Please review the proposed solution.&lt;/p&gt;</comment>
                            <comment id="14980746" author="fpj" created="Thu, 29 Oct 2015 16:42:56 +0000"  >&lt;p&gt;I don&apos;t see a problem with inverting the order of the operations, but I&apos;m thinking that these methods that update epochs might need to be synchronized. The problem you&apos;re describing seems to be due to concurrent access.&lt;/p&gt;</comment>
                            <comment id="14980947" author="arshad.mohammad" created="Thu, 29 Oct 2015 18:15:11 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; for your quick response&lt;br/&gt;
AFAIK, operation order is the real problem&lt;br/&gt;
Have a look at code snippet in &lt;/p&gt;
{org.apache.zookeeper.server.quorum.Learner.registerWithLeader(int)}
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newEpoch &amp;gt; self.getAcceptedEpoch()) {
    wrappedEpochBytes.putInt((&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)self.getCurrentEpoch());
    self.setAcceptedEpoch(newEpoch);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newEpoch == self.getAcceptedEpoch()) {
    &lt;span class=&quot;code-comment&quot;&gt;// since we have already acked an epoch equal to the leaders, we cannot ack
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// again, but we still need to send our lastZxid to the leader so that we can
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// sync with it &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it does assume leadership of the epoch.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// the -1 indicates that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; reply should not count as an ack &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; epoch
&lt;/span&gt;    wrappedEpochBytes.putInt(-1);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Suppose, newEpoch=1 and self.getAcceptedEpoch()=0&lt;br/&gt;
If self.setAcceptedEpoch(newEpoch); throws error while writing to file. The server will go for leader election and when again comes at code &lt;tt&gt;if (newEpoch &amp;gt; self.getAcceptedEpoch())&lt;/tt&gt; this time self.getAcceptedEpoch() will return 1  and will proceed for Leader.ACKEPOCH. &lt;/p&gt;

&lt;p&gt;self.getAcceptedEpoch() should not have returned 1 because the initial value was 0 and setAcceptedEpoch() was unsuccessful.&lt;/p&gt;</comment>
                            <comment id="14981680" author="suda" created="Fri, 30 Oct 2015 01:11:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2162&quot; title=&quot;infinite exception loop occurs when dataDir is lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2162&quot;&gt;ZOOKEEPER-2162&lt;/a&gt; seems very similar&lt;/p&gt;</comment>
                            <comment id="14984821" author="arshad.mohammad" created="Mon, 2 Nov 2015 07:23:42 +0000"  >&lt;p&gt;The issue seems similar but actually it is not. Scenarios are completely different.&lt;/p&gt;</comment>
                            <comment id="14984827" author="arshad.mohammad" created="Mon, 2 Nov 2015 07:29:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt;, What is your opinion on the proposed fix now.&lt;br/&gt;
Any other opinion on the proposed fix.&lt;br/&gt;
Junit test case patch is already attached, I think it will help to quickly understand the scenario. &lt;/p&gt;</comment>
                            <comment id="14991429" author="arshad.mohammad" created="Thu, 5 Nov 2015 09:52:58 +0000"  >&lt;p&gt;Submitting the fix.&lt;/p&gt;</comment>
                            <comment id="14991451" author="hadoopqa" created="Thu, 5 Nov 2015 10:13:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12770769/ZOOKEEPER-2307-02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12770769/ZOOKEEPER-2307-02.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1712218.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    -1 release audit.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2943//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15003678" author="arshad.mohammad" created="Fri, 13 Nov 2015 07:58:03 +0000"  >&lt;p&gt;Previous patch failed two tested cases &lt;tt&gt;testTxnTimeout&lt;/tt&gt; and &lt;tt&gt;testNormalRun&lt;/tt&gt; in &lt;tt&gt;org.apache.zookeeper.server.quorum.Zab1_0Test&lt;/tt&gt; This happened because after this issue fix currentEpoch and acceptedEpoch update takes more time as it is first written to file and then run time value is changed. &lt;/p&gt;

&lt;p&gt;To fix the these failing test case, now we should wait at least for a time taken to write small data to a file.&lt;/p&gt;</comment>
                            <comment id="15003689" author="hadoopqa" created="Fri, 13 Nov 2015 08:16:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12772143/ZOOKEEPER-2307-03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12772143/ZOOKEEPER-2307-03.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1713774.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 8 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2956//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15003791" author="arshad.mohammad" created="Fri, 13 Nov 2015 09:55:22 +0000"  >&lt;blockquote&gt;
&lt;p&gt;-1 javadoc. The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This patch has not introduced any new javadoc warning&lt;/p&gt;</comment>
                            <comment id="15044099" author="rgs" created="Sun, 6 Dec 2015 20:01:03 +0000"  >&lt;p&gt;The patch generally lgtm, a few nits and observations:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;do you mind adding java docs for QuorumPeer#setCurrentEpoch and QuorumPeer#setAcceptedEpoch? Specially, noting why they don&apos;t have to be synchronized would be useful (i.e.: they can only be called from the Leader and Learner classes and it all happens from one thread&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java why is getQuorumPeer added? Can&apos;t see where it&apos;s used. Also, there&apos;s some whitespaces/tabs before the method...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;i think waitUptoAFileWriteTime() is a bit racy and hackish and will break in the future. as much as i dislike sleep() calls in tests, in this case it&apos;s probably alright to loop a few times until getAcceptedEpoch() and getCurrentEpoch() converge&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Other than, it looks good. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad&quot; class=&quot;user-hover&quot; rel=&quot;arshad.mohammad&quot;&gt;arshad.mohammad&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;fpj&lt;/a&gt; for further thoughts. &lt;/p&gt;</comment>
                            <comment id="15044101" author="rgs" created="Sun, 6 Dec 2015 20:02:24 +0000"  >&lt;p&gt;Ignore my comment about getQuorumPeer not being used, forgot to look at the new file src/java/test/org/apache/zookeeper/test/EpochWriteFailureTest.java...&lt;/p&gt;</comment>
                            <comment id="15343002" author="hadoopqa" created="Tue, 21 Jun 2016 23:13:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12772143/ZOOKEEPER-2307-03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12772143/ZOOKEEPER-2307-03.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1748630.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 8 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3227//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3227//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15415066" author="hadoopqa" created="Wed, 10 Aug 2016 10:11:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1755379.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3347//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15415083" author="arshad.mohammad" created="Wed, 10 Aug 2016 10:25:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;-1 core tests. The patch failed core unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;tt&gt;org.apache.zookeeper.test.AsyncHammerTest.testHammer&lt;/tt&gt; failed. But the failure is not related to this patch. Verified locally, testHammer passed.&lt;/p&gt;</comment>
                            <comment id="15415095" author="arshad.mohammad" created="Wed, 10 Aug 2016 10:37:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;rgs&lt;/a&gt;, hope you remember this issue.&lt;br/&gt;
Submitted new patch &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2307&quot; title=&quot;ZooKeeper not starting because acceptedEpoch is less than the currentEpoch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2307&quot;&gt;&lt;del&gt;ZOOKEEPER-2307&lt;/del&gt;&lt;/a&gt;-04.patch which addressed  your comments.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;updated logic toverify current epoch in Zab1_0Test&lt;/li&gt;
	&lt;li&gt;removed unused method from org.apache.zookeeper.server.quorum.Zab1_0Test.deserializeSnapshot()&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15832304" author="hadoopqa" created="Fri, 20 Jan 2017 19:34:42 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 42c75b5f2457f8ea5b4106ce5dc1c34c330361c0.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3564//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3564//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16664961" author="andorm" created="Fri, 26 Oct 2018 09:57:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad&quot; class=&quot;user-hover&quot; rel=&quot;arshad.mohammad&quot;&gt;arshad.mohammad&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This one looks like an important and easy to fix. Are you still working on this?&lt;br/&gt;
Reverting this to major, so it won&apos;t block the stable release.&lt;/p&gt;</comment>
                            <comment id="16665018" author="arshad.mohammad" created="Fri, 26 Oct 2018 10:53:46 +0000"  >&lt;p&gt;Work for this issue was completed long back. Now the last given patch need to be re based.&lt;br/&gt;
I will rebase the changes and raise a PR.&lt;/p&gt;</comment>
                            <comment id="16665325" author="hadoopqa" created="Fri, 26 Oct 2018 15:47:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12822995/ZOOKEEPER-2307-04.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1ce2ca8107438d283581d18d064a25bd6b74adf7.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3707//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3707//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16695356" author="mkedwards" created="Wed, 21 Nov 2018 23:24:04 +0000"  >&lt;p&gt;Should this be a release blocker for 3.5.5?&lt;/p&gt;</comment>
                            <comment id="16789626" author="lawrence.craft" created="Mon, 11 Mar 2019 14:23:04 +0000"  >&lt;p&gt;Has there been any movement on this?&lt;/p&gt;

&lt;p&gt;We are encountering the same bug. It looks like the latest patch no longer applies properly; the changes look simple enough to implement, though.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arshad.mohammad&quot; class=&quot;user-hover&quot; rel=&quot;arshad.mohammad&quot;&gt;arshad.mohammad&lt;/a&gt; have you submitted a pull request for this? I looked through Github and couldn&apos;t find one. I can rebase the patch and submit one if it would make things easier.&lt;/p&gt;</comment>
                            <comment id="16975089" author="arshad.mohammad" created="Fri, 15 Nov 2019 13:20:34 +0000"  >&lt;p&gt;Raised PR.&lt;/p&gt;</comment>
                            <comment id="16998176" author="andorm" created="Tue, 17 Dec 2019 12:48:46 +0000"  >&lt;p&gt;Issue resolved by pull request 1145&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/zookeeper/pull/1145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/zookeeper/pull/1145&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17094322" author="hadoopqa" created="Tue, 28 Apr 2020 09:06:27 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version ) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4432//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="17094406" author="hadoopqa" created="Tue, 28 Apr 2020 11:16:26 +0000"  >&lt;p&gt;-1 overall.  GitHub Pull Request  Build&lt;/p&gt;


&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version ) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/4436//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="17104595" author="symat" created="Mon, 11 May 2020 15:41:26 +0000"  >&lt;p&gt;closed after releasing 3.5.8&lt;/p&gt;</comment>
                            <comment id="17289823" author="mukti" created="Wed, 24 Feb 2021 10:06:12 +0000"  >&lt;p&gt;This issue has not gone into branch-3.6. I will create a jira to port to branch-3.6&lt;/p&gt;</comment>
                            <comment id="17289860" author="symat" created="Wed, 24 Feb 2021 11:19:13 +0000"  >&lt;p&gt;True... it is present in 3.5.8+ and also will be present in 3.7.0+, but I haven&apos;t cherry-picked it into branch-3.6. I&apos;ll do it now: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-4222&quot; title=&quot;Backport ZOOKEEPER-2307 to branch-3.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-4222&quot;&gt;&lt;del&gt;ZOOKEEPER-4222&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17436428" author="zouyonghao" created="Sun, 31 Oct 2021 08:43:44 +0000"  >&lt;p&gt;I still got this issue in 3.7.0, did this really resolved?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-10-31 16:28:38,778 [myid:5] - INFO  [main:SnapStream@61] - zookeeper.snapshot.compression.method = CHECKED
2021-10-31 16:28:38,779 [myid:5] - INFO  [main:FileSnap@85] - Reading snapshot data5/version-2/snapshot.100000003
2021-10-31 16:28:38,782 [myid:5] - INFO  [main:DataTree@1709] - The digest in the snapshot has digest version of 2, , with zxid as 0x100000003, and digest value as 6044988169
2021-10-31 16:28:38,789 [myid:5] - INFO  [main:FileTxnSnapLog@372] - 1 txns loaded in 2 ms
2021-10-31 16:28:38,789 [myid:5] - INFO  [main:ZKDatabase@290] - Snapshot loaded in 14 ms, highest zxid is 0x200000001, digest is 6044988169
2021-10-31 16:28:38,790 [myid:5] - ERROR [main:QuorumPeer@1191] - Unable to load database on disk
java.io.IOException: The accepted epoch, 2 is less than the current epoch, 16
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:1188)
	at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:1130)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:229)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:137)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:91)
2021-10-31 16:28:38,793 [myid:5] - ERROR [main:QuorumPeerMain@114] - Unexpected exception, exiting abnormally
java.lang.RuntimeException: Unable to run quorum server 
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:1192)
	at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:1130)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:229)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:137)
	at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:91)
Caused by: java.io.IOException: The accepted epoch, 2 is less than the current epoch, 16
	at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:1188)
	... 4 more
2021-10-31 16:28:38,793 [myid:5] - INFO  [main:ZKAuditProvider@42] - ZooKeeper audit is disabled.
2021-10-31 16:28:38,795 [myid:5] - ERROR [main:ServiceUtils@42] - Exiting JVM with code 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13032796">ZOOKEEPER-2660</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13360582">ZOOKEEPER-4222</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12820457">ZOOKEEPER-2162</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12769553" name="ZOOKEEPER-2307-01.patch" size="6851" author="arshad.mohammad" created="Thu, 29 Oct 2015 15:41:17 +0000"/>
                            <attachment id="12770769" name="ZOOKEEPER-2307-02.patch" size="7496" author="arshad.mohammad" created="Thu, 5 Nov 2015 09:52:58 +0000"/>
                            <attachment id="12772143" name="ZOOKEEPER-2307-03.patch" size="12539" author="arshad.mohammad" created="Fri, 13 Nov 2015 07:58:03 +0000"/>
                            <attachment id="12822995" name="ZOOKEEPER-2307-04.patch" size="11664" author="arshad.mohammad" created="Wed, 10 Aug 2016 09:58:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nozz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>