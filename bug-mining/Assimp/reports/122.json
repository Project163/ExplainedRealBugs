{"url":"https://api.github.com/repos/assimp/assimp/issues/6069","repository_url":"https://api.github.com/repos/assimp/assimp","labels_url":"https://api.github.com/repos/assimp/assimp/issues/6069/labels{/name}","comments_url":"https://api.github.com/repos/assimp/assimp/issues/6069/comments","events_url":"https://api.github.com/repos/assimp/assimp/issues/6069/events","html_url":"https://github.com/assimp/assimp/issues/6069","id":2951903238,"node_id":"I_kwDOAAnkjM6v8ngG","number":6069,"title":"Bug: Stack-based Buffer Overflow in Assimp::MD2Importer::InternReadFile","user":{"login":"sae-as-me","id":188014830,"node_id":"U_kgDOCzTg7g","avatar_url":"https://avatars.githubusercontent.com/u/188014830?v=4","gravatar_id":"","url":"https://api.github.com/users/sae-as-me","html_url":"https://github.com/sae-as-me","followers_url":"https://api.github.com/users/sae-as-me/followers","following_url":"https://api.github.com/users/sae-as-me/following{/other_user}","gists_url":"https://api.github.com/users/sae-as-me/gists{/gist_id}","starred_url":"https://api.github.com/users/sae-as-me/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sae-as-me/subscriptions","organizations_url":"https://api.github.com/users/sae-as-me/orgs","repos_url":"https://api.github.com/users/sae-as-me/repos","events_url":"https://api.github.com/users/sae-as-me/events{/privacy}","received_events_url":"https://api.github.com/users/sae-as-me/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":244436167,"node_id":"MDU6TGFiZWwyNDQ0MzYxNjc=","url":"https://api.github.com/repos/assimp/assimp/labels/Bug","name":"Bug","color":"bfe5bf","default":false,"description":"Global flag to mark a deviation from expected behaviour"},{"id":2238868387,"node_id":"MDU6TGFiZWwyMjM4ODY4Mzg3","url":"https://api.github.com/repos/assimp/assimp/labels/Fuzzer","name":"Fuzzer","color":"c5def5","default":false,"description":"Bugs found by a fuzzer"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/assimp/assimp/milestones/11","html_url":"https://github.com/assimp/assimp/milestone/11","labels_url":"https://api.github.com/repos/assimp/assimp/milestones/11/labels","id":12498340,"node_id":"MI_kwDOAAnkjM4AvrWk","number":11,"title":"The assimp 6.0 release","description":"The Asset-Impporter-Lib Version 6.0 is coming ....","creator":{"login":"kimkulling","id":2323156,"node_id":"MDQ6VXNlcjIzMjMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/2323156?v=4","gravatar_id":"","url":"https://api.github.com/users/kimkulling","html_url":"https://github.com/kimkulling","followers_url":"https://api.github.com/users/kimkulling/followers","following_url":"https://api.github.com/users/kimkulling/following{/other_user}","gists_url":"https://api.github.com/users/kimkulling/gists{/gist_id}","starred_url":"https://api.github.com/users/kimkulling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimkulling/subscriptions","organizations_url":"https://api.github.com/users/kimkulling/orgs","repos_url":"https://api.github.com/users/kimkulling/repos","events_url":"https://api.github.com/users/kimkulling/events{/privacy}","received_events_url":"https://api.github.com/users/kimkulling/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":46,"state":"open","created_at":"2025-03-12T09:53:11Z","updated_at":"2025-06-09T18:57:53Z","due_on":"2025-05-31T07:00:00Z","closed_at":null},"comments":4,"created_at":"2025-03-27T07:24:05Z","updated_at":"2025-04-08T14:47:14Z","closed_at":"2025-03-29T10:09:24Z","author_association":"NONE","type":{"id":101701,"node_id":"IT_kwDOAAQNPc4AAY1F","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:11:49Z","updated_at":"2024-07-26T10:05:04Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Affected Projects\nassimp v5.4.3 ([https://github.com/assimp/assimp](https://github.com/assimp/assimp))\n## Problem Type\nCWE-121: Stack-based Buffer Overflow\n## Description\n### Summary\nA stack-buffer-overflow vulnerability was discovered in the `Assimp::MD2Importer::InternReadFile` function within the Assimp Library. This issue occurs when processing certain malformed files, leading to an out-of-bounds write and potential application crash.\n### Details\nThe vulnerability arises in the `Assimp::MD2Importer::InternReadFile` function defined in `code/AssetLib/MD2/MD2Loader.cpp` at line `326`. \nAs shown below, the function `MD2Importer::InternReadFile` lacks checking of `iLen` before calling `memcpy` (without restricting the value of `iLen`), resulting in a write operation beyond the allocated memory. It also reflects that the generation process of `pcSkins->name` may have the problem of the string not being truncated correctly, resulting in the value of `iLen` being too large.\n```cpp\n// Imports the given file into the given scene structure.\nvoid MD2Importer::InternReadFile( const std::string& pFile,\n    aiScene* pScene, IOSystem* pIOHandler)\n{\n    std::unique_ptr<IOStream> file( pIOHandler->Open( pFile));\n\n    // Check whether we can read from the file\n    if (file == nullptr) {\n        throw DeadlyImportError(\"Failed to open MD2 file \", pFile, \"\");\n    }\n\n    // ... other code\n    if (m_pcHeader->numTexCoords && m_pcHeader->numSkins)\n    {\n        // navigate to the first texture associated with the mesh\n        const MD2::Skin* pcSkins = (const MD2::Skin*) ((unsigned char*)m_pcHeader +\n            m_pcHeader->offsetSkins);\n\n        aiColor3D clr;\n        clr.b = clr.g = clr.r = 1.0f;\n        pcHelper->AddProperty<aiColor3D>(&clr, 1,AI_MATKEY_COLOR_DIFFUSE);\n        pcHelper->AddProperty<aiColor3D>(&clr, 1,AI_MATKEY_COLOR_SPECULAR);\n\n        clr.b = clr.g = clr.r = 0.05f;\n        pcHelper->AddProperty<aiColor3D>(&clr, 1,AI_MATKEY_COLOR_AMBIENT);\n\n        if (pcSkins->name[0])\n        {\n            aiString szString;\n            const ai_uint32 iLen = (ai_uint32) ::strlen(pcSkins->name);\n            ::memcpy(szString.data,pcSkins->name,iLen);    //stack-buffer-overflow\n            szString.data[iLen] = '\\0';\n            szString.length = iLen;\n\n            pcHelper->AddProperty(&szString,AI_MATKEY_TEXTURE_DIFFUSE(0));\n        }\n        else{\n            ASSIMP_LOG_WARN(\"Texture file name has zero length. It will be skipped.\");\n        }\n    }\n    \n    // ...\n}\n```\n\n![Image](https://github.com/user-attachments/assets/41c765e4-dfff-48e9-8ef3-d20fa163920b)\n\n### PoC\n**Steps to reproduce:**\n\n1. Clone the Assimp repository and build it using the following commands : \n```sh\nexport CC='clang'\nexport CXX='clang++'\nexport CFLAGS='-fsanitize=address -O0 -g'\nexport CXXFLAGS='-fsanitize=address -O0 -g'\nexport LIB_FUZZING_ENGINE='-fsanitize=fuzzer'\n\ncmake CMakeLists.txt -G \"Ninja\" -DBUILD_SHARED_LIBS=OFF -DASSIMP_BUILD_ZLIB=ON \\\n                    -DASSIMP_BUILD_TESTS=OFF -DASSIMP_BUILD_ASSIMP_TOOLS=OFF \\\n                    -DASSIMP_BUILD_SAMPLES=OFF\ncmake --build .\n```\n2. Compile the fuzzer: \n```sh\n$CXX $CXXFLAGS $LIB_FUZZING_ENGINE -std=c++11 -I$SRC/assimp/include \\\n\t\tfuzz/assimp_fuzzer.cc -o $OUT/assimp_fuzzer  \\\n\t\t./lib/libassimp.a ./contrib/zlib/libzlibstatic.a\n```\n3. Run the fuzzer to trigger the segmentation fault: \n\n[Assimp_MD2Importer_InternReadFile-sbo.zip](https://github.com/user-attachments/files/19580598/Assimp_MD2Importer_InternReadFile-sbo.zip)\n\n```sh\n./assimp_fuzzer ./Assimp_MD2Importer_InternReadFile-sbo\n```\nThe invalid write access will cause AddressSanitizer to report a segmentation fault during the execution of the post-processing logic.\n### Report\n```sh\nRunning: ./Assimp_MD2Importer_InternReadFile-sbo\n=================================================================\n==2206==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe16e88e14 at pc 0x5c407aa3dbfa bp 0x7ffe16e888f0 sp 0x7ffe16e880c0\nWRITE of size 28256 at 0x7ffe16e88e14 thread T0\n    #0 0x5c407aa3dbf9 in __asan_memcpy (/fuzz/fuzzers/assimp_fuzzer+0x456bf9) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n    #1 0x5c407b49d651 in Assimp::MD2Importer::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /fuzz/project/assimp/code/AssetLib/MD2/MD2Loader.cpp:326:13\n    #2 0x5c407b007842 in Assimp::BaseImporter::ReadFile(Assimp::Importer*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, Assimp::IOSystem*) /fuzz/project/assimp/code/Common/BaseImporter.cpp:131:9\n    #3 0x5c407aa82df4 in Assimp::Importer::ReadFile(char const*, unsigned int) /fuzz/project/assimp/code/Common/Importer.cpp:709:30\n    #4 0x5c407aa806b2 in Assimp::Importer::ReadFileFromMemory(void const*, unsigned long, unsigned int, char const*) /fuzz/project/assimp/code/Common/Importer.cpp:507:9\n    #5 0x5c407aa7bd27 in LLVMFuzzerTestOneInput /fuzz/project/assimp/fuzz/assimp_fuzzer.cc:57:34\n    #6 0x5c407a9a21a3 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/fuzz/fuzzers/assimp_fuzzer+0x3bb1a3) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n    #7 0x5c407a98bf1f in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/fuzz/fuzzers/assimp_fuzzer+0x3a4f1f) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n    #8 0x5c407a991c76 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/fuzz/fuzzers/assimp_fuzzer+0x3aac76) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n    #9 0x5c407a9bba92 in main (/fuzz/fuzzers/assimp_fuzzer+0x3d4a92) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n    #10 0x776615aaed8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n    #11 0x776615aaee3f in __libc_start_main csu/../csu/libc-start.c:392:3\n    #12 0x5c407a9867e4 in _start (/fuzz/fuzzers/assimp_fuzzer+0x39f7e4) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3)\n\nAddress 0x7ffe16e88e14 is located in stack of thread T0 at offset 1300 in frame\n    #0 0x5c407b49b49f in Assimp::MD2Importer::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /fuzz/project/assimp/code/AssetLib/MD2/MD2Loader.cpp:197\n\n  This frame has 12 object(s):\n    [32, 40) 'file' (line 198)\n    [64, 96) 'ref.tmp' (line 198)\n    [128, 129) 'ref.tmp2' (line 198)\n    [144, 168) 'mBuffer2' (line 212)\n    [208, 209) 'ref.tmp25' (line 212)\n    [224, 228) 'iMode' (line 305)\n    [240, 252) 'clr' (line 314)\n    [272, 1300) 'szString' (line 324)\n    [1440, 1452) 'clr165' (line 338) <== Memory access at offset 1300 partially underflows this variable\n    [1472, 2500) 'szName' (line 346) <== Memory access at offset 1300 partially underflows this variable\n    [2640, 3668) 'sz' (line 350) <== Memory access at offset 1300 partially underflows this variable\n    [3808, 3872) 'ref.tmp378' (line 434) <== Memory access at offset 1300 partially underflows this variable\nHINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork\n      (longjmp and C++ exceptions *are* supported)\nSUMMARY: AddressSanitizer: stack-buffer-overflow (/fuzz/fuzzers/assimp_fuzzer+0x456bf9) (BuildId: 2e85733d2820458344d0708d9620140031cd73e3) in __asan_memcpy\nShadow bytes around the buggy address:\n  0x100042dc9170: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x100042dc9180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x100042dc9190: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x100042dc91a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x100042dc91b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n=>0x100042dc91c0: 00 00[04]f2 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2 f2\n  0x100042dc91d0: f2 f2 f2 f2 f8 f8 f2 f2 f8 f8 f8 f8 f8 f8 f8 f8\n  0x100042dc91e0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\n  0x100042dc91f0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\n  0x100042dc9200: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\n  0x100042dc9210: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==2206==ABORTING\n```","closed_by":{"login":"kimkulling","id":2323156,"node_id":"MDQ6VXNlcjIzMjMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/2323156?v=4","gravatar_id":"","url":"https://api.github.com/users/kimkulling","html_url":"https://github.com/kimkulling","followers_url":"https://api.github.com/users/kimkulling/followers","following_url":"https://api.github.com/users/kimkulling/following{/other_user}","gists_url":"https://api.github.com/users/kimkulling/gists{/gist_id}","starred_url":"https://api.github.com/users/kimkulling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimkulling/subscriptions","organizations_url":"https://api.github.com/users/kimkulling/orgs","repos_url":"https://api.github.com/users/kimkulling/repos","events_url":"https://api.github.com/users/kimkulling/events{/privacy}","received_events_url":"https://api.github.com/users/kimkulling/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assimp/assimp/issues/6069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assimp/assimp/issues/6069/timeline","performed_via_github_app":null,"state_reason":"completed"}