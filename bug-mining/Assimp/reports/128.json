{"url":"https://api.github.com/repos/assimp/assimp/issues/6358","repository_url":"https://api.github.com/repos/assimp/assimp","labels_url":"https://api.github.com/repos/assimp/assimp/issues/6358/labels{/name}","comments_url":"https://api.github.com/repos/assimp/assimp/issues/6358/comments","events_url":"https://api.github.com/repos/assimp/assimp/issues/6358/events","html_url":"https://github.com/assimp/assimp/issues/6358","id":3433354491,"node_id":"I_kwDOAAnkjM7MpNT7","number":6358,"title":"Bug: Heap-buffer-overflow in Q3DImporter::InternReadFile","user":{"login":"ahuo1","id":91304853,"node_id":"MDQ6VXNlcjkxMzA0ODUz","avatar_url":"https://avatars.githubusercontent.com/u/91304853?v=4","gravatar_id":"","url":"https://api.github.com/users/ahuo1","html_url":"https://github.com/ahuo1","followers_url":"https://api.github.com/users/ahuo1/followers","following_url":"https://api.github.com/users/ahuo1/following{/other_user}","gists_url":"https://api.github.com/users/ahuo1/gists{/gist_id}","starred_url":"https://api.github.com/users/ahuo1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahuo1/subscriptions","organizations_url":"https://api.github.com/users/ahuo1/orgs","repos_url":"https://api.github.com/users/ahuo1/repos","events_url":"https://api.github.com/users/ahuo1/events{/privacy}","received_events_url":"https://api.github.com/users/ahuo1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":244436167,"node_id":"MDU6TGFiZWwyNDQ0MzYxNjc=","url":"https://api.github.com/repos/assimp/assimp/labels/Bug","name":"Bug","color":"bfe5bf","default":false,"description":"Global flag to mark a deviation from expected behaviour"},{"id":2238868387,"node_id":"MDU6TGFiZWwyMjM4ODY4Mzg3","url":"https://api.github.com/repos/assimp/assimp/labels/Fuzzer","name":"Fuzzer","color":"c5def5","default":false,"description":"Bugs found by a fuzzer"},{"id":8287495077,"node_id":"LA_kwDOAAnkjM8AAAAB7fkjpQ","url":"https://api.github.com/repos/assimp/assimp/labels/Security%20Risk","name":"Security Risk","color":"bfd4f2","default":false,"description":"Bugs that could potentially be security vulnerabilities"},{"id":8423934209,"node_id":"LA_kwDOAAnkjM8AAAAB9hsJAQ","url":"https://api.github.com/repos/assimp/assimp/labels/Sanitizer","name":"Sanitizer","color":"4A776C","default":false,"description":"Bug/build issue discovered using sanitizer e.g. ASAN"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-09-19T08:08:02Z","updated_at":"2025-11-04T09:09:14Z","closed_at":"2025-11-04T09:09:14Z","author_association":"NONE","type":{"id":101701,"node_id":"IT_kwDOAAQNPc4AAY1F","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:11:49Z","updated_at":"2024-07-26T10:05:04Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Environment\n- OS: Ubuntu 22.04\n- Compiler: clang 13.0.1\n- C++ Standard: C++17\n- Sanitizers: AddressSanitizer (ASan) + UndefinedBehaviorSanitizer (UBSan)\n- Assimp Version: 6.0.2 / master commit [0581ed5](https://github.com/assimp/assimp/commit/0581ed5f114ebea8654d3ce16cd5b64f59b8c7b3)\n\n## Build Instructions\n```\nexport CC=clang-13\nexport CXX=clang++-13\nexport CFLAGS=\"${CFLAGS} -fsanitize=address -O1 -g\"\nexport CXXFLAGS=\"${CXXFLAGS} -fsanitize=address -O1 -g\"\nexport LDFLAGS=\"${LDFLAGS} -fsanitize=address\"\n\nexport LIB_FUZZING_ENGINE=\"-fsanitize=fuzzer\"\n\ncmake CMakeLists.txt -G \"Ninja\" -DBUILD_SHARED_LIBS=OFF -DASSIMP_BUILD_ZLIB=ON \\\n                                -DASSIMP_BUILD_TESTS=ON -DASSIMP_BUILD_ASSIMP_TOOLS=OFF \\\n                                -DASSIMP_BUILD_SAMPLES=OFF\ncmake --build .\n\n$CXX $CXXFLAGS $LIB_FUZZING_ENGINE -std=c++11 -I./include \\\n        fuzz/assimp_fuzzer.cc -o ./assimp_fuzzer  \\\n        ./lib/libassimp.a ./contrib/zlib/libzlibstatic.a\n```\n\n## Reproduction\nRun the fuzzer with a crafted input file:\n```\n./assimp_fuzzer poc\n```\n\n## Observed Behavior\nProgram crashes with ASan/UBSan report:\n\n```\n==2126824==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000000b2 at pc 0x000001487021 bp 0x7ffdccf5fcf0 sp 0x7ffdccf5fce8\nWRITE of size 1 at 0x6020000000b2 thread T0\n[Detaching after fork from child process 2126877]\n    #0 0x1487020 in Assimp::Q3DImporter::InternReadFile(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, aiScene*, Assimp::IOSystem*) /root/assimp/code/AssetLib/Q3D/Q3DLoader.cpp:317:30\n    #1 0x957941 in Assimp::BaseImporter::ReadFile(Assimp::Importer*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, Assimp::IOSystem*) /root/assimp/code/Common/BaseImporter.cpp:131:9\n    #2 0x522c01 in Assimp::Importer::ReadFile(char const*, unsigned int) /root/assimp/code/Common/Importer.cpp:709:30\n    #3 0x52082b in Assimp::Importer::ReadFileFromMemory(void const*, unsigned long, unsigned int, char const*) /root/assimp/code/Common/Importer.cpp:507:9\n    #4 0x51c8ba in LLVMFuzzerTestOneInput /root/assimp/fuzz/assimp_fuzzer.cc:57:34\n    #5 0x4506f3 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/assimp_fuzzer+0x4506f3)\n    #6 0x43953f in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/assimp_fuzzer+0x43953f)\n    #7 0x43f7c0 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/assimp_fuzzer+0x43f7c0)\n    ...\n```\n\n## Root Cause Analysis\nThe crash occurs in Q3DImporter::InternReadFile() while allocating texture data:\nhttps://github.com/assimp/assimp/blob/0581ed5f114ebea8654d3ce16cd5b64f59b8c7b3/code/AssetLib/Q3D/Q3DLoader.cpp#L312-L321\nWhen the file provides extremely large mWidth and mHeight, their product overflows the unsigned int range, causing mul to wrap around to a small number (observed as 0 during GDB debugging). Immediately afterward, the code calculates end = &begin[mul - 1] + 1, which underflows mul - 1 and creates an invalid pointer far beyond the allocated buffer. The subsequent loop then writes out of bounds, triggering a heap-buffer-overflow. Proper bounds checking and using 64-bit arithmetic before multiplication would prevent this vulnerability.\n\nDuring debugging with GDB, we confirmed:\n```\n(gdb) p tex->mWidth\n$1 = 17432576\n(gdb) p tex->mHeight\n$2 = 171704320\n(gdb) p mul\n$3 = 0\n```\nThis confirms that the multiplication overflowed, leading directly to the invalid memory access.\n\nThe attached file contains a proof-of-concept.\n[poc.zip](https://github.com/user-attachments/files/22422643/poc.zip)","closed_by":{"login":"kimkulling","id":2323156,"node_id":"MDQ6VXNlcjIzMjMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/2323156?v=4","gravatar_id":"","url":"https://api.github.com/users/kimkulling","html_url":"https://github.com/kimkulling","followers_url":"https://api.github.com/users/kimkulling/followers","following_url":"https://api.github.com/users/kimkulling/following{/other_user}","gists_url":"https://api.github.com/users/kimkulling/gists{/gist_id}","starred_url":"https://api.github.com/users/kimkulling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimkulling/subscriptions","organizations_url":"https://api.github.com/users/kimkulling/orgs","repos_url":"https://api.github.com/users/kimkulling/repos","events_url":"https://api.github.com/users/kimkulling/events{/privacy}","received_events_url":"https://api.github.com/users/kimkulling/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/assimp/assimp/issues/6358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/assimp/assimp/issues/6358/timeline","performed_via_github_app":null,"state_reason":"completed"}