{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531","repository_url":"https://api.github.com/repos/pylint-dev/pylint","labels_url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531/labels{/name}","comments_url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531/comments","events_url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531/events","html_url":"https://github.com/pylint-dev/pylint/issues/9531","id":2221008369,"node_id":"I_kwDOAtdnV86EYeXx","number":9531,"title":"E1520 recommends an invalid combination of `@singledispatch` and `@staticmethod`","user":{"login":"AlexWaygood","id":66076021,"node_id":"MDQ6VXNlcjY2MDc2MDIx","avatar_url":"https://avatars.githubusercontent.com/u/66076021?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexWaygood","html_url":"https://github.com/AlexWaygood","followers_url":"https://api.github.com/users/AlexWaygood/followers","following_url":"https://api.github.com/users/AlexWaygood/following{/other_user}","gists_url":"https://api.github.com/users/AlexWaygood/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexWaygood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexWaygood/subscriptions","organizations_url":"https://api.github.com/users/AlexWaygood/orgs","repos_url":"https://api.github.com/users/AlexWaygood/repos","events_url":"https://api.github.com/users/AlexWaygood/events{/privacy}","received_events_url":"https://api.github.com/users/AlexWaygood/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":297274518,"node_id":"MDU6TGFiZWwyOTcyNzQ1MTg=","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Help%20wanted%20%F0%9F%99%8F","name":"Help wanted ðŸ™","color":"378805","default":false,"description":"Outside help would be appreciated, good for new contributors"},{"id":2374167765,"node_id":"MDU6TGFiZWwyMzc0MTY3NzY1","url":"https://api.github.com/repos/pylint-dev/pylint/labels/False%20Positive%20%F0%9F%A6%9F","name":"False Positive ðŸ¦Ÿ","color":"28a2b7","default":false,"description":"A message is emitted but nothing is wrong with the code"},{"id":4259347450,"node_id":"LA_kwDOAtdnV8794Hv6","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Needs%20PR","name":"Needs PR","color":"378805","default":false,"description":"This issue is accepted, sufficiently specified and now needs an implementation"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pylint-dev/pylint/milestones/109","html_url":"https://github.com/pylint-dev/pylint/milestone/109","labels_url":"https://api.github.com/repos/pylint-dev/pylint/milestones/109/labels","id":10598037,"node_id":"MI_kwDOAtdnV84AobaV","number":109,"title":"3.1.1","description":"","creator":{"login":"Pierre-Sassoulas","id":5493666,"node_id":"MDQ6VXNlcjU0OTM2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/5493666?v=4","gravatar_id":"","url":"https://api.github.com/users/Pierre-Sassoulas","html_url":"https://github.com/Pierre-Sassoulas","followers_url":"https://api.github.com/users/Pierre-Sassoulas/followers","following_url":"https://api.github.com/users/Pierre-Sassoulas/following{/other_user}","gists_url":"https://api.github.com/users/Pierre-Sassoulas/gists{/gist_id}","starred_url":"https://api.github.com/users/Pierre-Sassoulas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pierre-Sassoulas/subscriptions","organizations_url":"https://api.github.com/users/Pierre-Sassoulas/orgs","repos_url":"https://api.github.com/users/Pierre-Sassoulas/repos","events_url":"https://api.github.com/users/Pierre-Sassoulas/events{/privacy}","received_events_url":"https://api.github.com/users/Pierre-Sassoulas/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2024-02-23T20:13:37Z","updated_at":"2024-05-13T12:23:00Z","due_on":null,"closed_at":"2024-05-13T12:23:00Z"},"comments":0,"created_at":"2024-04-02T16:59:39Z","updated_at":"2024-05-07T11:27:15Z","closed_at":"2024-05-07T11:26:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug description\r\n\r\nHi from Ruff!\r\n\r\nWe recently received a [bug report](https://github.com/astral-sh/ruff/issues/10619) at Ruff stating that our reimplementation of E1520 was recommending an invalid combination of `@functools.singledispatch` and `@staticmethod`. For example, this code runs fine, but ruff's PLE1520 rule was telling the issue reporter that they should use `@singledispatch` here instead of `@singledispatchmethod`. If you do so, the code raises an exception at runtime, as `@staticmethod` is a descriptor, and `@singledispatch` isn't designed to be stacked on top of descriptor instances (that's what `@singledispatchmethod` is for). The Python docs also state that `@singledispatchmethod` should be used for static methods: https://docs.python.org/3/library/functools.html#functools.singledispatchmethod.\r\n\r\n```py\r\nfrom functools import singledispatch, singledispatchmethod\r\n\r\nclass Foo:\r\n    @singledispatchmethod\r\n    @staticmethod\r\n    def bar(value):\r\n        raise NotImplementedError() \r\n\r\n    @bar.register\r\n    @staticmethod\r\n    def _(value: int) -> int:\r\n        return 42 * value\r\n\r\n    def method(self) -> int:\r\n        return self.bar(2)\r\n\r\nprint(Foo().method())\r\n```\r\n\r\nAfter investigating the bug, we decided to change our PLE1520 rule so that it no longer complained about `@singledispatchmethod` on top of `@staticmethod`. It looks like pylint has the same incorrect behaviour here in the original PLE1520 rule, though, so I thought I'd open an issue to give you a heads-up as well!\r\n\r\nIn case it's helpful, here's the fix that was contributed to Ruff to fix the bug: https://github.com/astral-sh/ruff/pull/10637. The fix also involved some small changes to PLE1519 (E1519 at pylint) as well as PLE1520 (E1520 at pylint).\r\n\r\n\r\n### Command used\r\n\r\n```shell\r\npylint demo.py\r\n```\r\n\r\n\r\n### Pylint output\r\n\r\n```\r\n************* Module demo\r\ndemo.py:7:35: C0303: Trailing whitespace (trailing-whitespace)\r\ndemo.py:1:0: C0114: Missing module docstring (missing-module-docstring)\r\ndemo.py:3:0: C0115: Missing class docstring (missing-class-docstring)\r\ndemo.py:6:4: C0116: Missing function or method docstring (missing-function-docstring)\r\ndemo.py:6:4: C0104: Disallowed name \"bar\" (disallowed-name)\r\ndemo.py:4:5: E1520: singledispatchmethod decorator should not be used with functions, use singledispatch instead. (singledispatchmethod-function)\r\ndemo.py:9:5: E1520: singledispatchmethod decorator should not be used with functions, use singledispatch instead. (singledispatchmethod-function)\r\ndemo.py:14:4: C0116: Missing function or method docstring (missing-function-docstring)\r\ndemo.py:1:0: W0611: Unused singledispatch imported from functools (unused-import)\r\n\r\n------------------------------------------------------------------\r\nYour code has been rated at 0.00/10 (previous run: 0.00/10, +0.00)\r\n```\r\n\r\n### Expected behavior\r\n\r\n```\r\n************* Module demo\r\ndemo.py:7:35: C0303: Trailing whitespace (trailing-whitespace)\r\ndemo.py:1:0: C0114: Missing module docstring (missing-module-docstring)\r\ndemo.py:3:0: C0115: Missing class docstring (missing-class-docstring)\r\ndemo.py:6:4: C0116: Missing function or method docstring (missing-function-docstring)\r\ndemo.py:6:4: C0104: Disallowed name \"bar\" (disallowed-name)\r\ndemo.py:14:4: C0116: Missing function or method docstring (missing-function-docstring)\r\ndemo.py:1:0: W0611: Unused singledispatch imported from functools (unused-import)\r\n\r\n------------------------------------------------------------------\r\nYour code has been rated at 10.00/10 (previous run: 0.00/10, +0.00)\r\n```\r\n\r\n### Pylint version\r\n\r\n```shell\r\npylint 3.1.0\r\nastroid 3.1.0\r\nPython 3.12.2 (main, Feb 15 2024, 19:30:27) [Clang 15.0.0 (clang-1500.1.0.2.5)]\r\n```\r\n\r\n### OS / Environment\r\n\r\nMacOS; Python 3.12.2\r\n\r\n### Additional dependencies\r\n\r\nNone","closed_by":{"login":"mbyrnepr2","id":31762852,"node_id":"MDQ6VXNlcjMxNzYyODUy","avatar_url":"https://avatars.githubusercontent.com/u/31762852?v=4","gravatar_id":"","url":"https://api.github.com/users/mbyrnepr2","html_url":"https://github.com/mbyrnepr2","followers_url":"https://api.github.com/users/mbyrnepr2/followers","following_url":"https://api.github.com/users/mbyrnepr2/following{/other_user}","gists_url":"https://api.github.com/users/mbyrnepr2/gists{/gist_id}","starred_url":"https://api.github.com/users/mbyrnepr2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbyrnepr2/subscriptions","organizations_url":"https://api.github.com/users/mbyrnepr2/orgs","repos_url":"https://api.github.com/users/mbyrnepr2/repos","events_url":"https://api.github.com/users/mbyrnepr2/events{/privacy}","received_events_url":"https://api.github.com/users/mbyrnepr2/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pylint-dev/pylint/issues/9531/timeline","performed_via_github_app":null,"state_reason":"completed"}