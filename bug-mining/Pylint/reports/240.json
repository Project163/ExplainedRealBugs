{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866","repository_url":"https://api.github.com/repos/pylint-dev/pylint","labels_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866/labels{/name}","comments_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866/comments","events_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866/events","html_url":"https://github.com/pylint-dev/pylint/issues/3866","id":711254673,"node_id":"MDU6SXNzdWU3MTEyNTQ2NzM=","number":3866,"title":"Erroneous unused-variable (false positive) in lambda with *args and default argument","user":{"login":"pganssle","id":1377457,"node_id":"MDQ6VXNlcjEzNzc0NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1377457?v=4","gravatar_id":"","url":"https://api.github.com/users/pganssle","html_url":"https://github.com/pganssle","followers_url":"https://api.github.com/users/pganssle/followers","following_url":"https://api.github.com/users/pganssle/following{/other_user}","gists_url":"https://api.github.com/users/pganssle/gists{/gist_id}","starred_url":"https://api.github.com/users/pganssle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pganssle/subscriptions","organizations_url":"https://api.github.com/users/pganssle/orgs","repos_url":"https://api.github.com/users/pganssle/repos","events_url":"https://api.github.com/users/pganssle/events{/privacy}","received_events_url":"https://api.github.com/users/pganssle/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2374167765,"node_id":"MDU6TGFiZWwyMzc0MTY3NzY1","url":"https://api.github.com/repos/pylint-dev/pylint/labels/False%20Positive%20%F0%9F%A6%9F","name":"False Positive ðŸ¦Ÿ","color":"28a2b7","default":false,"description":"A message is emitted but nothing is wrong with the code"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-09-29T16:01:45Z","updated_at":"2022-06-30T18:32:46Z","closed_at":"2022-06-30T18:32:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When running `pylint` over the following function, it warns that the variable `variable` (the one defined in the function, not the parameter), is unused:\r\n\r\n```python\r\ndef lambda_with_args():\r\n    variable = 1\r\n    return lambda *_, variable=variable: variable + 1\r\n```\r\n\r\nI see the same issue when you add `**kwargs` and/or other parameters to the lambda:\r\n\r\n```python\r\ndef lambda_with_args_kwargs():\r\n    variable = 1\r\n    return lambda *_, variable=variable, **_kwargs: variable + 1\r\n```\r\n\r\nThe expected behavior is that `variable` should be considered used, since it is used to set the default argument for `variable` in the lambda. This is actually a fairly common idiom to get \"early-binding\" behavior in lambdas (though having `*args` in a lambda is considerably less common, so I'm not entirely shocked that â€” as far as I saw â€” this hasn't been reported before).\r\n\r\nWith some further explorations, I have determined:\r\n\r\n1. Multiple non-`*args` arguments, or `**kwargs` alone is not enough to trigger this bug.\r\n2. Replacing the `lambda` with the equivalent `def` statement also won't trigger the bug:\r\n\r\n    ```python\r\n    def func_def():\r\n        variable = 1\r\n        def f(*_, variable=variable):\r\n            return variable + 1\r\n        return f\r\n    ```\r\n3. If you change the name of the variable that `variable` gets bound to, it also won't trigger the bug (`lambda *args, var=variable: var + 1` works fine).\r\n\r\nHere is a minimal Python file that shows all of these properties:\r\n\r\n<details>\r\n\r\n```python\r\n# pylint: disable=missing-module-docstring, missing-docstring\r\n# pylint: disable=invalid-name\r\n\r\n# These trigger the bug\r\ndef lambda_with_args():\r\n    variable = 1\r\n    return lambda *_, variable=variable: variable + 1\r\n\r\ndef lambda_with_args_kwargs():\r\n    variable = 1\r\n    return lambda *_, variable=variable, **_kwargs: variable + 1\r\n\r\ndef lambda_with_args_and_multi_args():\r\n    variable = 1\r\n    return lambda *_, a, variable=variable: variable + a\r\n\r\n\r\n# The rest of these do not trigger the bug\r\ndef lambda_with_multi_args():\r\n    variable = 1\r\n    return lambda a, variable=variable: variable + a\r\n\r\ndef lambda_without_args():\r\n    variable = 1\r\n    return lambda variable=variable: variable + 1\r\n\r\ndef lambda_with_kwargs():\r\n    variable = 1\r\n    return lambda variable=variable, **_: variable + 1\r\n\r\ndef func_def():\r\n    variable = 1\r\n    def f(*_, variable=variable):\r\n        return variable + 1\r\n\r\n    return f\r\n\r\ndef different_name():\r\n    variable = 1\r\n    return lambda *args, var=variable: var + 1\r\n```\r\n\r\n</details>\r\n\r\n\r\n### pylint --version output\r\n\r\n<details>\r\n\r\n```\r\npylint 2.6.0\r\nastroid 2.4.2\r\nPython 3.8.2 (default, Apr 18 2020, 12:47:51) \r\n[GCC 9.3.0]\r\n```\r\n\r\n</details>\r\n\r\nDoing a bit more digging, it seems that prior to `pylint==2.6.0`, this bug also affected the `def f(*_, variable=variable)` variant, and in earlier versions even more erroneous warnings were raised as well. Not entirely sure, but I suspect #3713 fixed the issue for the `def` version of this.","closed_by":{"login":"Pierre-Sassoulas","id":5493666,"node_id":"MDQ6VXNlcjU0OTM2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/5493666?v=4","gravatar_id":"","url":"https://api.github.com/users/Pierre-Sassoulas","html_url":"https://github.com/Pierre-Sassoulas","followers_url":"https://api.github.com/users/Pierre-Sassoulas/followers","following_url":"https://api.github.com/users/Pierre-Sassoulas/following{/other_user}","gists_url":"https://api.github.com/users/Pierre-Sassoulas/gists{/gist_id}","starred_url":"https://api.github.com/users/Pierre-Sassoulas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pierre-Sassoulas/subscriptions","organizations_url":"https://api.github.com/users/Pierre-Sassoulas/orgs","repos_url":"https://api.github.com/users/Pierre-Sassoulas/repos","events_url":"https://api.github.com/users/Pierre-Sassoulas/events{/privacy}","received_events_url":"https://api.github.com/users/Pierre-Sassoulas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3866/timeline","performed_via_github_app":null,"state_reason":"completed"}