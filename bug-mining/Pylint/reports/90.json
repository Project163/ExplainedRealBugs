{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538","repository_url":"https://api.github.com/repos/pylint-dev/pylint","labels_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538/labels{/name}","comments_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538/comments","events_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538/events","html_url":"https://github.com/pylint-dev/pylint/issues/3538","id":608490265,"node_id":"MDU6SXNzdWU2MDg0OTAyNjU=","number":3538,"title":"Crash when pyproject.toml disable = [ \"array\", \"of\", \"items\" ] ","user":{"login":"bruceadams","id":225823,"node_id":"MDQ6VXNlcjIyNTgyMw==","avatar_url":"https://avatars.githubusercontent.com/u/225823?v=4","gravatar_id":"","url":"https://api.github.com/users/bruceadams","html_url":"https://github.com/bruceadams","followers_url":"https://api.github.com/users/bruceadams/followers","following_url":"https://api.github.com/users/bruceadams/following{/other_user}","gists_url":"https://api.github.com/users/bruceadams/gists{/gist_id}","starred_url":"https://api.github.com/users/bruceadams/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bruceadams/subscriptions","organizations_url":"https://api.github.com/users/bruceadams/orgs","repos_url":"https://api.github.com/users/bruceadams/repos","events_url":"https://api.github.com/users/bruceadams/events{/privacy}","received_events_url":"https://api.github.com/users/bruceadams/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":297274515,"node_id":"MDU6TGFiZWwyOTcyNzQ1MTU=","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Bug%20:beetle:","name":"Bug :beetle:","color":"ea9896","default":false,"description":""},{"id":297362476,"node_id":"MDU6TGFiZWwyOTczNjI0NzY=","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Configuration","name":"Configuration","color":"ededed","default":false,"description":"Related to configuration"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-04-28T17:30:58Z","updated_at":"2020-05-16T07:33:24Z","closed_at":"2020-05-16T07:33:24Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Hi there! Thank you for discovering and submitting an issue.\r\n\r\n  Before you submit this, make sure that the issue doesn't already exist\r\n  or if it is not closed.\r\n\r\n  Is your issue fixed on the preview release?: pip install pylint astroid --pre -U\r\n\r\n-->\r\n\r\n### Steps to reproduce\r\n1. Specify an array of messages to disable in `pyproject.toml`\r\n2. Run pylint\r\n\r\n### Current behavior\r\nCrash parsing `pyproject.toml`:\r\n\r\n```bash\r\n$ pylint sample\r\nTraceback (most recent call last):\r\n  File \"/Users/bruce/Library/Caches/pypoetry/virtualenvs/ifb-partner-api-AO4b-1bH-py3.8/bin/pylint\", line 10, in <module>\r\n    sys.exit(run_pylint())\r\n  File \"/Users/bruce/Library/Caches/pypoetry/virtualenvs/ifb-partner-api-AO4b-1bH-py3.8/lib/python3.8/site-packages/pylint/__init__.py\", line 22, in run_pylint\r\n    PylintRun(sys.argv[1:])\r\n  File \"/Users/bruce/Library/Caches/pypoetry/virtualenvs/ifb-partner-api-AO4b-1bH-py3.8/lib/python3.8/site-packages/pylint/lint/run.py\", line 300, in __init__\r\n    linter.load_config_file()\r\n  File \"/Users/bruce/Library/Caches/pypoetry/virtualenvs/ifb-partner-api-AO4b-1bH-py3.8/lib/python3.8/site-packages/pylint/config.py\", line 785, in load_config_file\r\n    for option, value in parser.items(section):\r\n  File \"/usr/local/Cellar/python@3.8/3.8.2/Frameworks/Python.framework/Versions/3.8/lib/python3.8/configparser.py\", line 859, in items\r\n    return [(option, value_getter(option)) for option in orig_keys]\r\n  File \"/usr/local/Cellar/python@3.8/3.8.2/Frameworks/Python.framework/Versions/3.8/lib/python3.8/configparser.py\", line 859, in <listcomp>\r\n    return [(option, value_getter(option)) for option in orig_keys]\r\n  File \"/usr/local/Cellar/python@3.8/3.8.2/Frameworks/Python.framework/Versions/3.8/lib/python3.8/configparser.py\", line 855, in <lambda>\r\n    value_getter = lambda option: self._interpolation.before_get(self,\r\n  File \"/usr/local/Cellar/python@3.8/3.8.2/Frameworks/Python.framework/Versions/3.8/lib/python3.8/configparser.py\", line 395, in before_get\r\n    self._interpolate_some(parser, option, L, value, section, defaults, 1)\r\n  File \"/usr/local/Cellar/python@3.8/3.8.2/Frameworks/Python.framework/Versions/3.8/lib/python3.8/configparser.py\", line 412, in _interpolate_some\r\n    p = rest.find(\"%\")\r\nAttributeError: 'list' object has no attribute 'find'\r\n```\r\n\r\n```toml\r\n[tool.poetry]\r\nname = \"fake\"\r\nversion = \"0.1.0\"\r\ndescription = \"dummy\"\r\nauthors = [\"Bruce Adams <bruce.adams@acm.org>\"]\r\n\r\n[tool.poetry.dependencies]\r\npython = \"^3.8\"\r\nconnexion = { extras = [\"swagger-ui\"], version = \"^2.7.0\" }\r\nokta_jwt = \"^1.3.5\"\r\n\r\n[tool.poetry.dev-dependencies]\r\nblack = \"^19.10b0\"\r\nfire = \"^0.3.1\"\r\nmypy = \"^0.770\"\r\npyjwt = { extras = [\"crypto\"], version = \"^1.7.1\" }\r\npylint = \"^2.5.0\"\r\npytest = \"^5.4.1\"\r\npytest-cov = \"^2.8.1\"\r\n\r\n[tool.pylint.\"MESSAGES CONTROL\"]\r\n# bad-continuation - pylint sometimes complains about black's formatting; we go with black\r\n# logging-format-interpolation, logging-fstring-interpolation, logging-not-lazy\r\n# - pylint wants deferred formatting for log messages (to use less CPU if that\r\n#   log level is disabled). We prefer the legibility of f-strings: f\"a is {a}\"\r\ndisable = [\r\n    \"bad-continuation\",\r\n    \"logging-format-interpolation\",\r\n    \"logging-fstring-interpolation\",\r\n    \"logging-not-lazy\"\r\n]\r\n\r\n[build-system]\r\nrequires = [\"poetry>=1.0\"]\r\nbuild-backend = \"poetry.masonry.api\"\r\n```\r\n\r\n### Expected behavior\r\nWhat I hope for is that the `pyproject.toml` above behaves the same as when the disable line looks like this.\r\n\r\n```\r\ndisable = \"bad-continuation,logging-format-interpolation,logging-fstring-interpolation,logging-not-lazy\"\r\n```\r\n\r\n### pylint --version output\r\n\r\n```bash\r\n$ pylint --version\r\npylint 2.5.0\r\nastroid 2.4.0\r\nPython 3.8.2 (default, Mar 11 2020, 00:29:50)\r\n[Clang 11.0.0 (clang-1100.0.33.17)]\r\n```\r\n\r\n### Additional information\r\n\r\nI tried adding a test for the behavior I want into https://github.com/PyCQA/pylint/blob/master/tests/test_config.py I was _very_ surprised to have that test pass!\r\n\r\nI can add that test in a PR, if you'd like. Here it is, just for reference:\r\n\r\n```python\r\nimport unittest.mock\r\n\r\nimport pylint.lint\r\n\r\n\r\ndef test_can_read_toml(tmp_path):\r\n    config_file = tmp_path / \"pyproject.toml\"\r\n    config_file.write_text(\r\n        \"[tool.pylint.'messages control']\\n\"\r\n        \"disable='logging-format-interpolation,logging-fstring-interpolation'\\n\"\r\n        \"enable='missing-module-docstring'\\n\"\r\n        \"jobs=10\\n\"\r\n    )\r\n    linter = pylint.lint.PyLinter()\r\n    linter.global_set_option = unittest.mock.MagicMock()\r\n    linter.read_config_file(str(config_file))\r\n\r\n    assert linter.global_set_option.called_with(\r\n        \"disable\", \"logging-format-interpolation\"\r\n    )\r\n    assert linter.global_set_option.called_with(\r\n        \"disable\", \"logging-fstring-interpolation\"\r\n    )\r\n    assert linter.global_set_option.called_with(\"enable\", \"missing-module-docstring\")\r\n    assert linter.global_set_option.called_with(\"jobs\", 10)\r\n\r\n\r\ndef test_can_read_toml_array(tmp_path):\r\n    config_file = tmp_path / \"pyproject.toml\"\r\n    config_file.write_text(\r\n        '[tool.pylint.\"messages control\"]\\n'\r\n        'disable=[\\n\"logging-format-interpolation\",\\n\"logging-fstring-interpolation\"\\n]\\n'\r\n        'enable=\"missing-module-docstring\"\\n'\r\n        \"jobs=10\\n\"\r\n    )\r\n    linter = pylint.lint.PyLinter()\r\n    linter.global_set_option = unittest.mock.MagicMock()\r\n    linter.read_config_file(str(config_file))\r\n\r\n    assert linter.global_set_option.called_with(\r\n        \"disable\", \"logging-format-interpolation\"\r\n    )\r\n    assert linter.global_set_option.called_with(\r\n        \"disable\", \"logging-fstring-interpolation\"\r\n    )\r\n    assert linter.global_set_option.called_with(\"enable\", \"missing-module-docstring\")\r\n    assert linter.global_set_option.called_with(\"jobs\", 10)\r\n\r\n\r\ndef test_can_read_setup_cfg(tmp_path):\r\n    config_file = tmp_path / \"setup.cfg\"\r\n    config_file.write_text(\r\n        \"[pylint.messages control]\\n\"\r\n        \"disable=all\\n\"\r\n        \"enable=missing-module-docstring\\n\"\r\n        \"jobs=10\\n\"\r\n    )\r\n    linter = pylint.lint.PyLinter()\r\n    linter.global_set_option = unittest.mock.MagicMock()\r\n    linter.read_config_file(str(config_file))\r\n\r\n    assert linter.global_set_option.called_with(\"disable\", \"all\")\r\n    assert linter.global_set_option.called_with(\"enable\", \"missing-module-docstring\")\r\n    assert linter.global_set_option.called_with(\"jobs\", 10)\r\n```\r\n","closed_by":{"login":"PCManticore","id":448166,"node_id":"MDQ6VXNlcjQ0ODE2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/448166?v=4","gravatar_id":"","url":"https://api.github.com/users/PCManticore","html_url":"https://github.com/PCManticore","followers_url":"https://api.github.com/users/PCManticore/followers","following_url":"https://api.github.com/users/PCManticore/following{/other_user}","gists_url":"https://api.github.com/users/PCManticore/gists{/gist_id}","starred_url":"https://api.github.com/users/PCManticore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PCManticore/subscriptions","organizations_url":"https://api.github.com/users/PCManticore/orgs","repos_url":"https://api.github.com/users/PCManticore/repos","events_url":"https://api.github.com/users/PCManticore/events{/privacy}","received_events_url":"https://api.github.com/users/PCManticore/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pylint-dev/pylint/issues/3538/timeline","performed_via_github_app":null,"state_reason":"completed"}