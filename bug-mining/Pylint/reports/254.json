{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366","repository_url":"https://api.github.com/repos/pylint-dev/pylint","labels_url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366/labels{/name}","comments_url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366/comments","events_url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366/events","html_url":"https://github.com/pylint-dev/pylint/issues/7366","id":1353013438,"node_id":"I_kwDOAtdnV85QpVi-","number":7366,"title":"incorrect logic in test__test_environ_pythonpath_no_arg","user":{"login":"bnavigator","id":4623504,"node_id":"MDQ6VXNlcjQ2MjM1MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/4623504?v=4","gravatar_id":"","url":"https://api.github.com/users/bnavigator","html_url":"https://github.com/bnavigator","followers_url":"https://api.github.com/users/bnavigator/followers","following_url":"https://api.github.com/users/bnavigator/following{/other_user}","gists_url":"https://api.github.com/users/bnavigator/gists{/gist_id}","starred_url":"https://api.github.com/users/bnavigator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnavigator/subscriptions","organizations_url":"https://api.github.com/users/bnavigator/orgs","repos_url":"https://api.github.com/users/bnavigator/repos","events_url":"https://api.github.com/users/bnavigator/events{/privacy}","received_events_url":"https://api.github.com/users/bnavigator/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2841556922,"node_id":"MDU6TGFiZWwyODQxNTU2OTIy","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Maintenance","name":"Maintenance","color":"C5DEF5","default":false,"description":"Discussion or action around maintaining pylint or the dev workflow"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-08-27T10:54:45Z","updated_at":"2022-08-27T13:57:56Z","closed_at":"2022-08-27T13:57:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`test__test_environ_pythonpath_no_arg` expects an unchanged PYTHONPATH. But that is not what the decorator does:\r\n\r\nhttps://github.com/PyCQA/pylint/blob/ccd1dc8d5d1bc705b0b5eb4183ba979f97a96f21/tests/testutils/test_testutils_utils.py#L53-L60\r\n\r\nhttps://github.com/PyCQA/pylint/blob/ccd1dc8d5d1bc705b0b5eb4183ba979f97a96f21/pylint/testutils/utils.py#L54-L62\r\n\r\nThe test fails, when the test suite is run with a set PYTHONPATH:\r\n\r\n```\r\n[  111s] =================================== FAILURES ===================================\r\n[  111s] _____________________ test__test_environ_pythonpath_no_arg _____________________\r\n[  111s] \r\n[  111s]     def test__test_environ_pythonpath_no_arg() -> None:\r\n[  111s]         python_path = os.environ.get(\"PYTHONPATH\")\r\n[  111s]         with _test_environ_pythonpath():\r\n[  111s] >           assert os.environ.get(\"PYTHONPATH\") == python_path\r\n[  111s] E           AssertionError: assert None == '/home/abuild/rpmbuild/BUILDROOT/python-pylint-2.15.0-0.x86_64/usr/lib/python3.8/site-packages'\r\n[  111s] E            +  where None = <bound method Mapping.get of environ({'PYTHONDONTWRITEBYTECODE': '1', 'SHELL': '/bin/bash', 'RPM_SOURCE_DIR': '/home/abuild/rpmbuild/SOURCES', 'XDG_CONFIG_DIRS': '/etc/xdg:/usr/etc/xdg', 'LESS': '-M -I -R', 'MACHTYPE': 'x86_64-suse-linux', 'PKG_CONFIG_PATH': ':/usr/lib64/pkgconfig:/usr/share/pkgconfig', 'HISTSIZE': '1000', 'HOSTNAME': 'skylab', 'MINICOM': '-c on', 'PYTHONHASHSEED': '0', 'CPU': 'x86_64', 'XDG_CONFIG_HOME': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/xdgflavorconfig', 'GPG_TTY': 'not a tty', 'PWD': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0', 'SOURCE_DATE_EPOCH': '1661558400', 'LOGNAME': 'abuild', 'SUSE_ZNOW': '1', 'RPM_ARCH': 'x86_64', 'XKEYSYMDB': '/usr/X11R6/lib/X11/XKeysymDB', 'XNLSPATH': '/usr/X11R6/lib/X11/nls', 'HOME': '/home/abuild', 'LANG': 'C', 'OSTYPE': 'linux', 'LESS_ADVANCED_PREPROCESSOR': 'no', 'RPM_PACKAGE_RELEASE': '0', 'PERL_HASH_SEED': '42', 'RPM_OS': 'linux', 'SUSE_IGNORED_RPATHS': '/etc/suse-ignored-rpaths.conf', 'MALLOC_PERTURB_': '69', 'LESSCLOSE': 'lessclose.sh %s %s', 'TERM': 'xterm-256color', 'HOST': 'skylab', 'LESSOPEN': 'lessopen.sh %s', 'USER': 'abuild', 'SUSE_ASNEEDED': '1', 'MORE': '-sl', 'CSHEDIT': 'emacs', 'SHLVL': '1', 'RPM_BUILD_DIR': '/home/abuild/rpmbuild/BUILD', 'WINDOWMANAGER': 'xterm', 'PAGER': 'less', 'MALLOC_CHECK_': '3', 'FORCE_SOURCE_DATE': '1', 'RPM_OPT_FLAGS': '-O2 -Wall -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -Werror=return-type -flto=auto -g', 'RPM_DOC_DIR': '/usr/share/doc/packages', 'QT_HASH_SEED': '0', 'RPM_PACKAGE_VERSION': '2.15.0', 'LC_ALL': 'en_US.UTF-8', 'XDG_DATA_DIRS': '/usr/share', 'VENDOR': 'suse', 'PATH': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/flavorbin:/usr/local/bin:/usr/bin:/bin', 'PROFILEREAD': 'true', 'MAIL': '/var/mail/abuild', 'HOSTTYPE': 'x86_64', 'RPM_BUILD_NCPUS': '12', 'RPM_PACKAGE_NAME': 'python-pylint', 'LESSKEY': '/usr/etc/lesskey.bin', 'RPM_BUILD_ROOT': '/home/abuild/rpmbuild/BUILDROOT/python-pylint-2.15.0-0.x86_64', 'OLDPWD': '/home/abuild/rpmbuild/BUILD', '_': '/usr/bin/pytest-3.8', 'tmp_path_env': '/tmp/pytest-of-abuild/pytest-356/test_can_read_toml_env_variabl0/pyproject.toml', 'PYTEST_CURRENT_TEST': 'tests/testutils/test_testutils_utils.py::test__test_environ_pythonpath_no_arg (call)'})>('PYTHONPATH')\r\n[  111s] E            +    where <bound method Mapping.get of environ({'PYTHONDONTWRITEBYTECODE': '1', 'SHELL': '/bin/bash', 'RPM_SOURCE_DIR': '/home/abuild/rpmbuild/SOURCES', 'XDG_CONFIG_DIRS': '/etc/xdg:/usr/etc/xdg', 'LESS': '-M -I -R', 'MACHTYPE': 'x86_64-suse-linux', 'PKG_CONFIG_PATH': ':/usr/lib64/pkgconfig:/usr/share/pkgconfig', 'HISTSIZE': '1000', 'HOSTNAME': 'skylab', 'MINICOM': '-c on', 'PYTHONHASHSEED': '0', 'CPU': 'x86_64', 'XDG_CONFIG_HOME': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/xdgflavorconfig', 'GPG_TTY': 'not a tty', 'PWD': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0', 'SOURCE_DATE_EPOCH': '1661558400', 'LOGNAME': 'abuild', 'SUSE_ZNOW': '1', 'RPM_ARCH': 'x86_64', 'XKEYSYMDB': '/usr/X11R6/lib/X11/XKeysymDB', 'XNLSPATH': '/usr/X11R6/lib/X11/nls', 'HOME': '/home/abuild', 'LANG': 'C', 'OSTYPE': 'linux', 'LESS_ADVANCED_PREPROCESSOR': 'no', 'RPM_PACKAGE_RELEASE': '0', 'PERL_HASH_SEED': '42', 'RPM_OS': 'linux', 'SUSE_IGNORED_RPATHS': '/etc/suse-ignored-rpaths.conf', 'MALLOC_PERTURB_': '69', 'LESSCLOSE': 'lessclose.sh %s %s', 'TERM': 'xterm-256color', 'HOST': 'skylab', 'LESSOPEN': 'lessopen.sh %s', 'USER': 'abuild', 'SUSE_ASNEEDED': '1', 'MORE': '-sl', 'CSHEDIT': 'emacs', 'SHLVL': '1', 'RPM_BUILD_DIR': '/home/abuild/rpmbuild/BUILD', 'WINDOWMANAGER': 'xterm', 'PAGER': 'less', 'MALLOC_CHECK_': '3', 'FORCE_SOURCE_DATE': '1', 'RPM_OPT_FLAGS': '-O2 -Wall -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -Werror=return-type -flto=auto -g', 'RPM_DOC_DIR': '/usr/share/doc/packages', 'QT_HASH_SEED': '0', 'RPM_PACKAGE_VERSION': '2.15.0', 'LC_ALL': 'en_US.UTF-8', 'XDG_DATA_DIRS': '/usr/share', 'VENDOR': 'suse', 'PATH': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/flavorbin:/usr/local/bin:/usr/bin:/bin', 'PROFILEREAD': 'true', 'MAIL': '/var/mail/abuild', 'HOSTTYPE': 'x86_64', 'RPM_BUILD_NCPUS': '12', 'RPM_PACKAGE_NAME': 'python-pylint', 'LESSKEY': '/usr/etc/lesskey.bin', 'RPM_BUILD_ROOT': '/home/abuild/rpmbuild/BUILDROOT/python-pylint-2.15.0-0.x86_64', 'OLDPWD': '/home/abuild/rpmbuild/BUILD', '_': '/usr/bin/pytest-3.8', 'tmp_path_env': '/tmp/pytest-of-abuild/pytest-356/test_can_read_toml_env_variabl0/pyproject.toml', 'PYTEST_CURRENT_TEST': 'tests/testutils/test_testutils_utils.py::test__test_environ_pythonpath_no_arg (call)'})> = environ({'PYTHONDONTWRITEBYTECODE': '1', 'SHELL': '/bin/bash', 'RPM_SOURCE_DIR': '/home/abuild/rpmbuild/SOURCES', 'XDG_CONFIG_DIRS': '/etc/xdg:/usr/etc/xdg', 'LESS': '-M -I -R', 'MACHTYPE': 'x86_64-suse-linux', 'PKG_CONFIG_PATH': ':/usr/lib64/pkgconfig:/usr/share/pkgconfig', 'HISTSIZE': '1000', 'HOSTNAME': 'skylab', 'MINICOM': '-c on', 'PYTHONHASHSEED': '0', 'CPU': 'x86_64', 'XDG_CONFIG_HOME': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/xdgflavorconfig', 'GPG_TTY': 'not a tty', 'PWD': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0', 'SOURCE_DATE_EPOCH': '1661558400', 'LOGNAME': 'abuild', 'SUSE_ZNOW': '1', 'RPM_ARCH': 'x86_64', 'XKEYSYMDB': '/usr/X11R6/lib/X11/XKeysymDB', 'XNLSPATH': '/usr/X11R6/lib/X11/nls', 'HOME': '/home/abuild', 'LANG': 'C', 'OSTYPE': 'linux', 'LESS_ADVANCED_PREPROCESSOR': 'no', 'RPM_PACKAGE_RELEASE': '0', 'PERL_HASH_SEED': '42', 'RPM_OS': 'linux', 'SUSE_IGNORED_RPATHS': '/etc/suse-ignored-rpaths.conf', 'MALLOC_PERTURB_': '69', 'LESSCLOSE': 'lessclose.sh %s %s', 'TERM': 'xterm-256color', 'HOST': 'skylab', 'LESSOPEN': 'lessopen.sh %s', 'USER': 'abuild', 'SUSE_ASNEEDED': '1', 'MORE': '-sl', 'CSHEDIT': 'emacs', 'SHLVL': '1', 'RPM_BUILD_DIR': '/home/abuild/rpmbuild/BUILD', 'WINDOWMANAGER': 'xterm', 'PAGER': 'less', 'MALLOC_CHECK_': '3', 'FORCE_SOURCE_DATE': '1', 'RPM_OPT_FLAGS': '-O2 -Wall -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -Werror=return-type -flto=auto -g', 'RPM_DOC_DIR': '/usr/share/doc/packages', 'QT_HASH_SEED': '0', 'RPM_PACKAGE_VERSION': '2.15.0', 'LC_ALL': 'en_US.UTF-8', 'XDG_DATA_DIRS': '/usr/share', 'VENDOR': 'suse', 'PATH': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/flavorbin:/usr/local/bin:/usr/bin:/bin', 'PROFILEREAD': 'true', 'MAIL': '/var/mail/abuild', 'HOSTTYPE': 'x86_64', 'RPM_BUILD_NCPUS': '12', 'RPM_PACKAGE_NAME': 'python-pylint', 'LESSKEY': '/usr/etc/lesskey.bin', 'RPM_BUILD_ROOT': '/home/abuild/rpmbuild/BUILDROOT/python-pylint-2.15.0-0.x86_64', 'OLDPWD': '/home/abuild/rpmbuild/BUILD', '_': '/usr/bin/pytest-3.8', 'tmp_path_env': '/tmp/pytest-of-abuild/pytest-356/test_can_read_toml_env_variabl0/pyproject.toml', 'PYTEST_CURRENT_TEST': 'tests/testutils/test_testutils_utils.py::test__test_environ_pythonpath_no_arg (call)'}).get\r\n[  111s] E            +      where environ({'PYTHONDONTWRITEBYTECODE': '1', 'SHELL': '/bin/bash', 'RPM_SOURCE_DIR': '/home/abuild/rpmbuild/SOURCES', 'XDG_CONFIG_DIRS': '/etc/xdg:/usr/etc/xdg', 'LESS': '-M -I -R', 'MACHTYPE': 'x86_64-suse-linux', 'PKG_CONFIG_PATH': ':/usr/lib64/pkgconfig:/usr/share/pkgconfig', 'HISTSIZE': '1000', 'HOSTNAME': 'skylab', 'MINICOM': '-c on', 'PYTHONHASHSEED': '0', 'CPU': 'x86_64', 'XDG_CONFIG_HOME': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/xdgflavorconfig', 'GPG_TTY': 'not a tty', 'PWD': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0', 'SOURCE_DATE_EPOCH': '1661558400', 'LOGNAME': 'abuild', 'SUSE_ZNOW': '1', 'RPM_ARCH': 'x86_64', 'XKEYSYMDB': '/usr/X11R6/lib/X11/XKeysymDB', 'XNLSPATH': '/usr/X11R6/lib/X11/nls', 'HOME': '/home/abuild', 'LANG': 'C', 'OSTYPE': 'linux', 'LESS_ADVANCED_PREPROCESSOR': 'no', 'RPM_PACKAGE_RELEASE': '0', 'PERL_HASH_SEED': '42', 'RPM_OS': 'linux', 'SUSE_IGNORED_RPATHS': '/etc/suse-ignored-rpaths.conf', 'MALLOC_PERTURB_': '69', 'LESSCLOSE': 'lessclose.sh %s %s', 'TERM': 'xterm-256color', 'HOST': 'skylab', 'LESSOPEN': 'lessopen.sh %s', 'USER': 'abuild', 'SUSE_ASNEEDED': '1', 'MORE': '-sl', 'CSHEDIT': 'emacs', 'SHLVL': '1', 'RPM_BUILD_DIR': '/home/abuild/rpmbuild/BUILD', 'WINDOWMANAGER': 'xterm', 'PAGER': 'less', 'MALLOC_CHECK_': '3', 'FORCE_SOURCE_DATE': '1', 'RPM_OPT_FLAGS': '-O2 -Wall -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -Werror=return-type -flto=auto -g', 'RPM_DOC_DIR': '/usr/share/doc/packages', 'QT_HASH_SEED': '0', 'RPM_PACKAGE_VERSION': '2.15.0', 'LC_ALL': 'en_US.UTF-8', 'XDG_DATA_DIRS': '/usr/share', 'VENDOR': 'suse', 'PATH': '/home/abuild/rpmbuild/BUILD/pylint-2.15.0/build/flavorbin:/usr/local/bin:/usr/bin:/bin', 'PROFILEREAD': 'true', 'MAIL': '/var/mail/abuild', 'HOSTTYPE': 'x86_64', 'RPM_BUILD_NCPUS': '12', 'RPM_PACKAGE_NAME': 'python-pylint', 'LESSKEY': '/usr/etc/lesskey.bin', 'RPM_BUILD_ROOT': '/home/abuild/rpmbuild/BUILDROOT/python-pylint-2.15.0-0.x86_64', 'OLDPWD': '/home/abuild/rpmbuild/BUILD', '_': '/usr/bin/pytest-3.8', 'tmp_path_env': '/tmp/pytest-of-abuild/pytest-356/test_can_read_toml_env_variabl0/pyproject.toml', 'PYTEST_CURRENT_TEST': 'tests/testutils/test_testutils_utils.py::test__test_environ_pythonpath_no_arg (call)'}) = os.environ\r\n[  111s] \r\n[  111s] tests/testutils/test_testutils_utils.py:56: AssertionError\r\n[  111s] =========================== short test summary info ============================\r\n```","closed_by":{"login":"Pierre-Sassoulas","id":5493666,"node_id":"MDQ6VXNlcjU0OTM2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/5493666?v=4","gravatar_id":"","url":"https://api.github.com/users/Pierre-Sassoulas","html_url":"https://github.com/Pierre-Sassoulas","followers_url":"https://api.github.com/users/Pierre-Sassoulas/followers","following_url":"https://api.github.com/users/Pierre-Sassoulas/following{/other_user}","gists_url":"https://api.github.com/users/Pierre-Sassoulas/gists{/gist_id}","starred_url":"https://api.github.com/users/Pierre-Sassoulas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pierre-Sassoulas/subscriptions","organizations_url":"https://api.github.com/users/Pierre-Sassoulas/orgs","repos_url":"https://api.github.com/users/Pierre-Sassoulas/repos","events_url":"https://api.github.com/users/Pierre-Sassoulas/events{/privacy}","received_events_url":"https://api.github.com/users/Pierre-Sassoulas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pylint-dev/pylint/issues/7366/timeline","performed_via_github_app":null,"state_reason":"completed"}