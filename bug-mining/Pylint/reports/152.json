{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058","repository_url":"https://api.github.com/repos/pylint-dev/pylint","labels_url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058/labels{/name}","comments_url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058/comments","events_url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058/events","html_url":"https://github.com/pylint-dev/pylint/issues/5058","id":1002240300,"node_id":"I_kwDOAtdnV847vPks","number":5058,"title":"Crash on pandas data_frame 'to_string'","user":{"login":"tobiasfshr","id":36965290,"node_id":"MDQ6VXNlcjM2OTY1Mjkw","avatar_url":"https://avatars.githubusercontent.com/u/36965290?v=4","gravatar_id":"","url":"https://api.github.com/users/tobiasfshr","html_url":"https://github.com/tobiasfshr","followers_url":"https://api.github.com/users/tobiasfshr/followers","following_url":"https://api.github.com/users/tobiasfshr/following{/other_user}","gists_url":"https://api.github.com/users/tobiasfshr/gists{/gist_id}","starred_url":"https://api.github.com/users/tobiasfshr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tobiasfshr/subscriptions","organizations_url":"https://api.github.com/users/tobiasfshr/orgs","repos_url":"https://api.github.com/users/tobiasfshr/repos","events_url":"https://api.github.com/users/tobiasfshr/events{/privacy}","received_events_url":"https://api.github.com/users/tobiasfshr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":297274515,"node_id":"MDU6TGFiZWwyOTcyNzQ1MTU=","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Bug%20:beetle:","name":"Bug :beetle:","color":"ea9896","default":false,"description":""},{"id":1041256788,"node_id":"MDU6TGFiZWwxMDQxMjU2Nzg4","url":"https://api.github.com/repos/pylint-dev/pylint/labels/Crash%20%F0%9F%92%A5","name":"Crash ðŸ’¥","color":"c64d6f","default":false,"description":"A bug that makes pylint crash"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pylint-dev/pylint/milestones/51","html_url":"https://github.com/pylint-dev/pylint/milestone/51","labels_url":"https://api.github.com/repos/pylint-dev/pylint/milestones/51/labels","id":7159222,"node_id":"MI_kwDOAtdnV84AbT22","number":51,"title":"2.12.0","description":"","creator":{"login":"Pierre-Sassoulas","id":5493666,"node_id":"MDQ6VXNlcjU0OTM2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/5493666?v=4","gravatar_id":"","url":"https://api.github.com/users/Pierre-Sassoulas","html_url":"https://github.com/Pierre-Sassoulas","followers_url":"https://api.github.com/users/Pierre-Sassoulas/followers","following_url":"https://api.github.com/users/Pierre-Sassoulas/following{/other_user}","gists_url":"https://api.github.com/users/Pierre-Sassoulas/gists{/gist_id}","starred_url":"https://api.github.com/users/Pierre-Sassoulas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pierre-Sassoulas/subscriptions","organizations_url":"https://api.github.com/users/Pierre-Sassoulas/orgs","repos_url":"https://api.github.com/users/Pierre-Sassoulas/repos","events_url":"https://api.github.com/users/Pierre-Sassoulas/events{/privacy}","received_events_url":"https://api.github.com/users/Pierre-Sassoulas/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":226,"state":"closed","created_at":"2021-09-16T15:50:04Z","updated_at":"2024-12-17T20:23:50Z","due_on":null,"closed_at":"2021-11-25T14:30:10Z"},"comments":1,"created_at":"2021-09-21T11:03:41Z","updated_at":"2021-10-18T15:53:38Z","closed_at":"2021-10-06T19:56:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug description\r\n\r\n```python\r\nWhen parsing the following file:\r\n\r\n\"\"\"Definition of the base evaluation result class.\"\"\"\r\n\r\nfrom collections import defaultdict\r\nfrom typing import AbstractSet, Dict, List, Optional, Union\r\n\r\nimport numpy as np\r\nfrom pandas import DataFrame\r\nfrom pydantic import BaseModel, PrivateAttr\r\n\r\nScores = Dict[str, Union[int, float]]\r\nScoresList = List[Scores]\r\nAVERAGE = \"AVERAGE\"\r\nOVERALL = \"OVERALL\"\r\n\r\n\r\nclass Result(BaseModel):\r\n    \"\"\"The base class for bdd100k evaluation results.\r\n\r\n    Each data field corresponds to a evluation metric. The value for each\r\n    metric is a list of dicts, each dict maps the category names to scores.\r\n    There used to be two or three dicts in the list. The first one contains\r\n    keys of basic categories, and the last one contains conclusion categories\r\n    like 'OVERALL' and 'AVERAGE'. The middle one (optional), contains super\r\n    classes for the two-level class hierarchy case.\r\n\r\n    Functions:\r\n        {} -> dict[str, dict[str, int | float]]:\r\n            export all data to a nested dict.\r\n        json() -> str:\r\n            export the nested dict of `dict()` into a JSON string.\r\n        pd_frame() -> pandas.DataFrame:\r\n            export data fields to a formatted DataFrame.\r\n        table() -> str:\r\n            export data fields to a formatted table string.\r\n        summary() -> dict[str, int | float]:\r\n            export most important fields to a flattened dict.\r\n        __str__() -> str:\r\n            the same as `table()`.\r\n    \"\"\"\r\n\r\n    _row_breaks: List[int] = PrivateAttr([])\r\n\r\n    def __init__(self, **data: Union[int, float, ScoresList]) -> None:\r\n        \"\"\"Check the input structure and initiliaze the model.\r\n\r\n        All keys in the Scoreslist need to be the same set for the different\r\n        evaluation metrics.\r\n        \"\"\"\r\n        data_check: Dict[str, ScoresList] = {\r\n            metric: cont\r\n            for metric, cont in data.items()\r\n            if isinstance(cont, list)\r\n        }\r\n        ref_scores_list = data_check[list(data_check.keys())[0]]\r\n        for scores_list in data_check.values():\r\n            assert len(scores_list) == len(ref_scores_list)\r\n            for scores, ref_scores in zip(scores_list, ref_scores_list):\r\n                assert scores.keys() == ref_scores.keys()\r\n        super().__init__(**data)\r\n        cur_index = 1\r\n        self._row_breaks = [1]\r\n        for scores in ref_scores_list[:-1]:\r\n            cur_index += 1 + len(scores)\r\n            self._row_breaks.append(cur_index)\r\n\r\n    def __eq__(self, other: \"Result\") -> bool:  # type: ignore\r\n        \"\"\"Check whether two instances are equal.\"\"\"\r\n        if self._row_breaks != other._row_breaks:\r\n            return False\r\n        other_dict = dict(other)\r\n        for metric, scores_list in self:\r\n            other_scores_list = other_dict[metric]\r\n            if not isinstance(scores_list, list):\r\n                if scores_list != other_scores_list:\r\n                    return False\r\n                continue\r\n            if len(scores_list) != len(other_scores_list):\r\n                return False\r\n            for scores, other_scores in zip(scores_list, other_scores_list):\r\n                if set(scores.keys()) != set(other_scores.keys()):\r\n                    return False\r\n                for category, score in scores.items():\r\n                    if not np.isclose(score, other_scores[category]):\r\n                        return False\r\n        return super().__eq__(other)\r\n\r\n    def pd_frame(\r\n        self,\r\n        include: Optional[AbstractSet[str]] = None,\r\n        exclude: Optional[AbstractSet[str]] = None,\r\n    ) -> DataFrame:\r\n        \"\"\"Convert data model into a data frame.\r\n\r\n        Args:\r\n            include (set[str]): Optional, the metrics to convert\r\n            exclude (set[str]): Optional, the metrics not to convert\r\n        Returns:\r\n            data_frame (pandas.DataFrmae): the exported DataFrame\r\n        \"\"\"\r\n        frame_dict: Dict[str, Scores] = defaultdict(dict)\r\n        for metric, scores_list in self.dict(\r\n            include=include, exclude=exclude  # type: ignore\r\n        ).items():\r\n            if not isinstance(scores_list, list):\r\n                continue\r\n            for scores in scores_list:\r\n                for cls_, score in scores.items():\r\n                    frame_dict[metric][cls_] = score\r\n        return DataFrame.from_dict(frame_dict)\r\n\r\n    def table(\r\n        self,\r\n        include: Optional[AbstractSet[str]] = None,\r\n        exclude: Optional[AbstractSet[str]] = None,\r\n    ) -> str:\r\n        \"\"\"Convert data model into a table for formatted printing.\r\n\r\n        Args:\r\n            include (set[str]): Optional, the metrics to convert\r\n            exclude (set[str]): Optional, the metrics not to convert\r\n        Returns:\r\n            table (str): the exported table string\r\n        \"\"\"\r\n        data_frame = self.pd_frame(include, exclude)\r\n        summary = data_frame.to_string(float_format=\"{:.1f}\".format)\r\n        summary = summary.replace(\"NaN\", \" - \")\r\n        strs = summary.split(\"\\n\")\r\n        split_line = \"-\" * len(strs[0])\r\n\r\n        for row_ind in self._row_breaks:\r\n            strs.insert(row_ind, split_line)\r\n        summary = \"\".join([f\"{s}\\n\" for s in strs])\r\n        summary = \"\\n\" + summary\r\n        return summary  # type: ignore\r\n\r\n    def __str__(self) -> str:\r\n        \"\"\"Convert the data into a printable string.\"\"\"\r\n        print(\"hi{}\".format(\"world\"))\r\n        return self.table()\r\n\r\n    def summary(\r\n        self,\r\n        include: Optional[AbstractSet[str]] = None,\r\n        exclude: Optional[AbstractSet[str]] = None,\r\n    ) -> Scores:\r\n        \"\"\"Convert the data into a flattened dict as the summary.\r\n\r\n        This function is different to the `.dict()` function.\r\n        As a comparison, `.dict()` will export all data fields as a nested\r\n        dict, While `.summary()` only exports most important information,\r\n        like the overall scores, as a flattened compact dict.\r\n\r\n        Args:\r\n            include (set[str]): Optional, the metrics to convert\r\n            exclude (set[str]): Optional, the metrics not to convert\r\n        Returns:\r\n            dict[str, int | float]: returned summary of the result\r\n        \"\"\"\r\n        summary_dict: Dict[str, Union[int, float]] = {}\r\n        for metric, scores_list in self.dict(\r\n            include=include, exclude=exclude  # type: ignore\r\n        ).items():\r\n            if not isinstance(scores_list, list):\r\n                summary_dict[metric] = scores_list\r\n            else:\r\n                summary_dict[metric] = scores_list[-1].get(\r\n                    OVERALL, scores_list[-1].get(AVERAGE)\r\n                )\r\n        return summary_dict\r\n```\r\n\r\n\r\npylint crashed with a ``AttributeError`` and with the following stacktrace:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1008, in _check_files\r\n    self._check_file(get_ast, check_astroid_module, file)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1043, in _check_file\r\n    check_astroid_module(ast_node)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1180, in check_astroid_module\r\n    retval = self._check_astroid_module(\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1227, in _check_astroid_module\r\n    walker.walk(node)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 78, in walk\r\n    self.walk(child)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 78, in walk\r\n    self.walk(child)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 78, in walk\r\n    self.walk(child)\r\n  [Previous line repeated 4 more times]\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 75, in walk\r\n    callback(astroid)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/checkers/refactoring/recommendation_checker.py\", line 327, in visit_const\r\n    self._detect_replacable_format_call(node)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/checkers/refactoring/recommendation_checker.py\", line 340, in _detect_replacable_format_call\r\n    if node.parent.parent.args:\r\nAttributeError: 'Keyword' object has no attribute 'args'\r\n```\r\n\r\nNOTE: When i comment the line summary = data_frame.to_string(float_format=\"{:.1f}\".format), the error disappears\r\n\r\n\r\n\r\n### Configuration\r\n\r\n```ini\r\nhttps://github.com/scalabel/scalabel/blob/master/.pylintrc\r\n```\r\n\r\n\r\n### Command used\r\n\r\n```shell\r\npylint scalabel\r\n```\r\n\r\n\r\n### Pylint output\r\n\r\n```shell\r\nException on node <Const.str l.125 at 0x7fd2dcae8520> in file '/home/tobfischer/PycharmProjects/scalabel/scalabel/eval/result.py'\r\nTraceback (most recent call last):\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 75, in walk\r\n    callback(astroid)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/checkers/refactoring/recommendation_checker.py\", line 327, in visit_const\r\n    self._detect_replacable_format_call(node)\r\n  File \"/itet-stor/tobfischer/net_scratch/conda_envs/openmt/lib/python3.8/site-packages/pylint/checkers/refactoring/recommendation_checker.py\", line 340, in _detect_replacable_format_call\r\n    if node.parent.parent.args:\r\nAttributeError: 'Keyword' object has no attribute 'args'\r\n************* Module scalabel.eval.result\r\nscalabel/eval/result.py:1:0: F0001: Fatal error while checking 'scalabel/eval/result.py'. Please open an issue in our bug tracker so we address this. There is a pre-filled template that you can use in '/scratch/.cache_tobfischer/pylint/pylint-crash-2021-09-21-13.txt'. (fatal)\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nshould pass\r\n\r\n### Pylint version\r\n\r\n```shell\r\n2.11\r\n```\r\n\r\n\r\n### OS / Environment\r\n\r\n_No response_\r\n\r\n### Additional dependencies\r\n\r\n_No response_","closed_by":{"login":"Pierre-Sassoulas","id":5493666,"node_id":"MDQ6VXNlcjU0OTM2NjY=","avatar_url":"https://avatars.githubusercontent.com/u/5493666?v=4","gravatar_id":"","url":"https://api.github.com/users/Pierre-Sassoulas","html_url":"https://github.com/Pierre-Sassoulas","followers_url":"https://api.github.com/users/Pierre-Sassoulas/followers","following_url":"https://api.github.com/users/Pierre-Sassoulas/following{/other_user}","gists_url":"https://api.github.com/users/Pierre-Sassoulas/gists{/gist_id}","starred_url":"https://api.github.com/users/Pierre-Sassoulas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pierre-Sassoulas/subscriptions","organizations_url":"https://api.github.com/users/Pierre-Sassoulas/orgs","repos_url":"https://api.github.com/users/Pierre-Sassoulas/repos","events_url":"https://api.github.com/users/Pierre-Sassoulas/events{/privacy}","received_events_url":"https://api.github.com/users/Pierre-Sassoulas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pylint-dev/pylint/issues/5058/timeline","performed_via_github_app":null,"state_reason":"completed"}