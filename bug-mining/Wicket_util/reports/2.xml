<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:27:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-2741] non-performant Collections.synchronizedMap() should be replaced with ConcurrentMap</title>
                <link>https://issues.apache.org/jira/browse/WICKET-2741</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;The following two classes use Collections.synchronizedMap() --&amp;gt; lots of contention @ concurrent load. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;RequestListenerInterface.interfaces&lt;/li&gt;
	&lt;li&gt;WebApplication.addBufferedResponse&lt;/li&gt;
	&lt;li&gt;Injector.inject() - &apos;cache&apos; field.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The last instance makes @SpringBean unusable in production (too much contention @ concurrent load)&lt;/p&gt;

&lt;p&gt;Here&apos;s a sample output of contention around monitor of class java.util.Collections$SynchronizedMap:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+--------------------------------------------------------------------------------------+------------------+-----------------+
|                                         Name                                         |    Time (ms)     |      Count      |
+--------------------------------------------------------------------------------------+------------------+-----------------+
|  +---java.util.Collections$SynchronizedMap.get(Object)                               |  126,101   51 %  |  19,145   52 %  |
|  | |                                                                                 |                  |                 |
|  | +---org.apache.wicket.injection.Injector.inject(Object, IFieldValueFactory)       |  109,912   45 %  |  16,285   44 %  |
|  | |                                                                                 |                  |                 |
|  | +---org.springframework.beans.CachedIntrospectionResults.forClass(Class)          |   16,188    7 %  |   2,860    8 %  |
|  |                                                                                   |                  |                 |
|  +---java.util.Collections$SynchronizedMap.put(Object, Object)                       |  119,343   49 %  |  17,676   48 %  |
|    |                                                                                 |                  |                 |
|    +---org.apache.wicket.injection.Injector.inject(Object, IFieldValueFactory)       |                  |                 |
|      |                                                                               |                  |                 |
|      +---org.apache.wicket.injection.ConfigurableInjector.inject(Object)             |                  |                 |
|        |                                                                             |                  |                 |
|        +---org.apache.wicket.injection.ComponentInjector.onInstantiation(Component)  |  118,060   48 %  |  17,467   47 %  |
|        |                                                                             |                  |                 |
|        +---com.castanealabs.gui.model.ZipCodeValidator.&amp;lt;init&amp;gt;()                      |      686    0 %  |     106    0 %  |
|        |                                                                             |                  |                 |
|        +---com.castanealabs.gui.model.ProductSkuProgramDataProvider.&amp;lt;init&amp;gt;(IModel)   |      337    0 %  |      59    0 %  |
|        |                                                                             |                  |                 |
|        +---com.castanealabs.gui.model.ProductTypeProgramDataProvider.&amp;lt;init&amp;gt;(IModel)  |      259    0 %  |      44    0 %  |
+--------------------------------------------------------------------------------------+------------------+-----------------+

Generated by YourKit Java Profiler 8.0.22 Feb 12, 2010 3:52:25 PM
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12456206">WICKET-2741</key>
            <summary>non-performant Collections.synchronizedMap() should be replaced with ConcurrentMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivaynberg">Igor Vaynberg</assignee>
                                    <reporter username="nikita.tovstoles">Nikita Tovstoles</reporter>
                        <labels>
                            <label>performance</label>
                    </labels>
                <created>Fri, 12 Feb 2010 23:54:04 +0000</created>
                <updated>Tue, 18 May 2010 22:08:29 +0000</updated>
                            <resolved>Mon, 17 May 2010 21:23:27 +0000</resolved>
                                    <version>1.4.6</version>
                                    <fixVersion>1.4.9</fixVersion>
                    <fixVersion>1.5-M1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12833403" author="jdonnerstag" created="Sat, 13 Feb 2010 15:53:19 +0000"  >&lt;p&gt;Obviously with Inspector we can not simple replace Collections.synchronizedMap(new WeakHashMap()) with ConcurrentWeakHashMap since such a class does not exist. And we don&apos;t want to add a dependency on a 3rd party library just for that purpose. Since you seem to have all the tests and tools properly set up to validate, may be you could also provide a patch. I&apos;m more than happy to apply it later on to the repository.&lt;/p&gt;

&lt;p&gt;Thanks for your help&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                            <comment id="12833593" author="nikita.tovstoles" created="Sun, 14 Feb 2010 17:07:40 +0000"  >&lt;p&gt;OK. I&apos;ve found another perf issue with @SpringBean. Switching back to a locator pattern (injecting beans into WebApplication bean only) improved throughput 5x @ 20 concurrent users. I am happy to help, but would need to understand your reluctance to use a 3rd party library, given the current perf impact. For the above, Google Collections&apos; &lt;a href=&quot;http://google-collections.googlecode.com/svn/trunk/javadoc/index.html?com/google/common/collect/MapMaker.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MapMaker&lt;/a&gt; looks like a solid fit.&lt;/p&gt;</comment>
                            <comment id="12833606" author="jdonnerstag" created="Sun, 14 Feb 2010 18:50:20 +0000"  >&lt;p&gt;It&apos;s not that we are completely against it, but we careful in adding dependencies. A rule which we treat more strict for wicket-core than subproject such as wicket-spring. But if there is a good reason to add a lib, we&apos;ll do.&lt;/p&gt;

&lt;p&gt;Since we are using maven, it&apos;s a clear benefit if that lib is available via a maven repository (such as &lt;a href=&quot;http://repo2.maven.org/maven2/com/google/collections/google-collections/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo2.maven.org/maven2/com/google/collections/google-collections/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12833784" author="jcompagner" created="Mon, 15 Feb 2010 12:24:42 +0000"  >&lt;p&gt;cant we just copy the specific ConcurrentMap impl we need from google code and add it to our own package?&lt;/p&gt;

&lt;p&gt;Else we could just use a ConcurrentHashMap and then use WeakReference keys ourself (but then we need to make sure that we clean it now and then)&lt;/p&gt;</comment>
                            <comment id="12868250" author="sfussenegger" created="Mon, 17 May 2010 15:14:40 +0000"  >&lt;p&gt;this patch uses a copy-on-write approach to avoid synchronization for reads. Only in the rare event of a yet unmapped ClassLoader it&apos;s going to be a bit slower. While the patch seems to work very well a second or third pair of eyes would be very well appreciated. &lt;/p&gt;

&lt;p&gt;This patch also contains changes by patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-2875&quot; title=&quot;Heavily Broken Caching in Injector&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-2875&quot;&gt;&lt;del&gt;WICKET-2875&lt;/del&gt;&lt;/a&gt; and reuses an empty array (new Field&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;) for classes without any injectable fields.&lt;/p&gt;</comment>
                            <comment id="12868861" author="hudson" created="Tue, 18 May 2010 22:08:29 +0000"  >&lt;p&gt;Integrated in Apache Wicket 1.5.x #54 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Apache%20Wicket%201.5.x/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Apache%20Wicket%201.5.x/54/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12464675">WICKET-2875</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12444689" name="wicket-2741.patch" size="3729" author="sfussenegger" created="Mon, 17 May 2010 15:14:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203602</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kcmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>