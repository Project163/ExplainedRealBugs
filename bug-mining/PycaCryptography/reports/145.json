{"url":"https://api.github.com/repos/pyca/cryptography/issues/11453","repository_url":"https://api.github.com/repos/pyca/cryptography","labels_url":"https://api.github.com/repos/pyca/cryptography/issues/11453/labels{/name}","comments_url":"https://api.github.com/repos/pyca/cryptography/issues/11453/comments","events_url":"https://api.github.com/repos/pyca/cryptography/issues/11453/events","html_url":"https://github.com/pyca/cryptography/issues/11453","id":2474002694,"node_id":"I_kwDOALYunM6TdkkG","number":11453,"title":"Incorrect PKCS12 serialization with version 43","user":{"login":"pierrenicolasr","id":2227840,"node_id":"MDQ6VXNlcjIyMjc4NDA=","avatar_url":"https://avatars.githubusercontent.com/u/2227840?v=4","gravatar_id":"","url":"https://api.github.com/users/pierrenicolasr","html_url":"https://github.com/pierrenicolasr","followers_url":"https://api.github.com/users/pierrenicolasr/followers","following_url":"https://api.github.com/users/pierrenicolasr/following{/other_user}","gists_url":"https://api.github.com/users/pierrenicolasr/gists{/gist_id}","starred_url":"https://api.github.com/users/pierrenicolasr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pierrenicolasr/subscriptions","organizations_url":"https://api.github.com/users/pierrenicolasr/orgs","repos_url":"https://api.github.com/users/pierrenicolasr/repos","events_url":"https://api.github.com/users/pierrenicolasr/events{/privacy}","received_events_url":"https://api.github.com/users/pierrenicolasr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-08-19T19:01:51Z","updated_at":"2025-01-30T03:04:05Z","closed_at":"2024-08-23T00:22:49Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Upgrading from 42.0.8 to 43.0.0, we noticed a change (regression ?) when serializing pkcs12 container.\r\n\r\nWe use something like\r\n\r\n```\r\n    def to_pkcs12(self, password: bytes = b''):\r\n        encryption = PrivateFormat.PKCS12.encryption_builder() \\\r\n            .kdf_rounds(50000) \\\r\n            .key_cert_algorithm(pkcs12.PBES.PBESv1SHA1And3KeyTripleDESCBC) \\\r\n            .hmac_hash(hashes.SHA1()).build(password) if password else NoEncryption()\r\n        return pkcs12.serialize_key_and_certificates(None, self.private_key, self.x509cert, None, encryption)\r\n```\r\n\r\nWhen calling\r\n\r\n` openssl pkcs12 -info -nocerts -in cert.p12`\r\n\r\nafter exporting pkcs12 certificate, we can see that Bag Attribute is empty:\r\n\r\n```\r\nAC: sha1, Iteration 2048\r\nMAC length: 20, salt length: 8\r\nPKCS7 Encrypted data: pbeWithSHA1And3-KeyTripleDES-CBC, Iteration 50000\r\nCertificate bag\r\nPKCS7 Data\r\nShrouded Keybag: pbeWithSHA1And3-KeyTripleDES-CBC, Iteration 50000\r\nBag Attributes: <No Attributes>\r\nKey Attributes: <No Attributes>\r\n```\r\n\r\nExact same code running 42.0.8 will have:\r\n\r\n```\r\n-----END CERTIFICATE-----\r\nBag Attributes\r\n    localKeyID: CC E2 4E 5D FC 51 88 11 28 11 AB 52 F5 06 C7 87 E2 82 7A 08\r\nKey Attributes: <No Attributes>\r\n```\r\n\r\nTrying to install the certificate (using profile) on an iPad will fail due to missing certificate.\r\n\r\nPython 3.12.4\r\ncffi 1.17.0\r\n","closed_by":{"login":"reaperhulk","id":161495,"node_id":"MDQ6VXNlcjE2MTQ5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/161495?v=4","gravatar_id":"","url":"https://api.github.com/users/reaperhulk","html_url":"https://github.com/reaperhulk","followers_url":"https://api.github.com/users/reaperhulk/followers","following_url":"https://api.github.com/users/reaperhulk/following{/other_user}","gists_url":"https://api.github.com/users/reaperhulk/gists{/gist_id}","starred_url":"https://api.github.com/users/reaperhulk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reaperhulk/subscriptions","organizations_url":"https://api.github.com/users/reaperhulk/orgs","repos_url":"https://api.github.com/users/reaperhulk/repos","events_url":"https://api.github.com/users/reaperhulk/events{/privacy}","received_events_url":"https://api.github.com/users/reaperhulk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyca/cryptography/issues/11453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyca/cryptography/issues/11453/timeline","performed_via_github_app":null,"state_reason":"completed"}