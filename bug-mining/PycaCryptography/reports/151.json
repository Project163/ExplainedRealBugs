{"url":"https://api.github.com/repos/pyca/cryptography/issues/11920","repository_url":"https://api.github.com/repos/pyca/cryptography","labels_url":"https://api.github.com/repos/pyca/cryptography/issues/11920/labels{/name}","comments_url":"https://api.github.com/repos/pyca/cryptography/issues/11920/comments","events_url":"https://api.github.com/repos/pyca/cryptography/issues/11920/events","html_url":"https://github.com/pyca/cryptography/issues/11920","id":2644171485,"node_id":"I_kwDOALYunM6dmtrd","number":11920,"title":"Invalid DSA key can cause cryptography.exceptions.InternalError / internal OpenSSL error","user":{"login":"hannob","id":990588,"node_id":"MDQ6VXNlcjk5MDU4OA==","avatar_url":"https://avatars.githubusercontent.com/u/990588?v=4","gravatar_id":"","url":"https://api.github.com/users/hannob","html_url":"https://github.com/hannob","followers_url":"https://api.github.com/users/hannob/followers","following_url":"https://api.github.com/users/hannob/following{/other_user}","gists_url":"https://api.github.com/users/hannob/gists{/gist_id}","starred_url":"https://api.github.com/users/hannob/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hannob/subscriptions","organizations_url":"https://api.github.com/users/hannob/orgs","repos_url":"https://api.github.com/users/hannob/repos","events_url":"https://api.github.com/users/hannob/events{/privacy}","received_events_url":"https://api.github.com/users/hannob/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-11-08T14:15:45Z","updated_at":"2025-02-10T03:08:09Z","closed_at":"2024-11-11T14:37:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Code example:\r\n```\r\n#!/usr/bin/python3\r\n\r\nfrom cryptography.hazmat.primitives import hashes\r\nfrom cryptography.hazmat.primitives.asymmetric import dsa\r\nfrom cryptography.hazmat.primitives.serialization import load_pem_private_key\r\n\r\npem = b\"\"\"-----BEGIN DSA PRIVATE KEY-----\r\nMGECAQACFQHH+MnFXh4NNlZiV/zUVb5a5ib3kwIVAOP8ZOKvDwabKzEr/moq3y1z\r\nE3vJAhUAl/2Ylx9fWbzHdh1URsc/c6IM/TECAQECFCsjU4AZRcuks45g1NMOUeCB\r\nEpvg\r\n-----END DSA PRIVATE KEY-----\"\"\"\r\nkey = load_pem_private_key(pem, password=None)\r\nsig = key.sign(b\"test\", hashes.SHA256())\r\n```\r\n\r\nThe key here is an invalid DSA key, it is a test case from boringssl: https://github.com/google/boringssl/blob/master/crypto/dsa/dsa_test.cc\r\n\r\nPython cryptography successfully imports this key, but attempting to sign with it leads to InternalError exception:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/tmp/dsafail\", line 13, in <module>\r\n    sig = key.sign(b\"test\", hashes.SHA256())\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\ncryptography.exceptions.InternalError: Unknown OpenSSL error. This error is commonly encountered\r\n                        when another library is not cleaning up the OpenSSL error\r\n                        stack. If you are using cryptography with another library\r\n                        that uses OpenSSL try disabling it before reporting a bug.\r\n                        Otherwise please file an issue at\r\n                        https://github.com/pyca/cryptography/issues with\r\n                        information on how to reproduce this. ([<OpenSSLError(code=83886196, lib=10, reason=116, reason_text=too many retries)>])\r\n```","closed_by":{"login":"reaperhulk","id":161495,"node_id":"MDQ6VXNlcjE2MTQ5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/161495?v=4","gravatar_id":"","url":"https://api.github.com/users/reaperhulk","html_url":"https://github.com/reaperhulk","followers_url":"https://api.github.com/users/reaperhulk/followers","following_url":"https://api.github.com/users/reaperhulk/following{/other_user}","gists_url":"https://api.github.com/users/reaperhulk/gists{/gist_id}","starred_url":"https://api.github.com/users/reaperhulk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reaperhulk/subscriptions","organizations_url":"https://api.github.com/users/reaperhulk/orgs","repos_url":"https://api.github.com/users/reaperhulk/repos","events_url":"https://api.github.com/users/reaperhulk/events{/privacy}","received_events_url":"https://api.github.com/users/reaperhulk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyca/cryptography/issues/11920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyca/cryptography/issues/11920/timeline","performed_via_github_app":null,"state_reason":"completed"}