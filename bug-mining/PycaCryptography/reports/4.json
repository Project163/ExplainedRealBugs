{"url":"https://api.github.com/repos/pyca/cryptography/issues/4158","repository_url":"https://api.github.com/repos/pyca/cryptography","labels_url":"https://api.github.com/repos/pyca/cryptography/issues/4158/labels{/name}","comments_url":"https://api.github.com/repos/pyca/cryptography/issues/4158/comments","events_url":"https://api.github.com/repos/pyca/cryptography/issues/4158/events","html_url":"https://github.com/pyca/cryptography/issues/4158","id":306644174,"node_id":"MDU6SXNzdWUzMDY2NDQxNzQ=","number":4158,"title":"Certificate breaks decode_asn1:_parse_asn1_time","user":{"login":"jcrowgey","id":4524026,"node_id":"MDQ6VXNlcjQ1MjQwMjY=","avatar_url":"https://avatars.githubusercontent.com/u/4524026?v=4","gravatar_id":"","url":"https://api.github.com/users/jcrowgey","html_url":"https://github.com/jcrowgey","followers_url":"https://api.github.com/users/jcrowgey/followers","following_url":"https://api.github.com/users/jcrowgey/following{/other_user}","gists_url":"https://api.github.com/users/jcrowgey/gists{/gist_id}","starred_url":"https://api.github.com/users/jcrowgey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcrowgey/subscriptions","organizations_url":"https://api.github.com/users/jcrowgey/orgs","repos_url":"https://api.github.com/users/jcrowgey/repos","events_url":"https://api.github.com/users/jcrowgey/events{/privacy}","received_events_url":"https://api.github.com/users/jcrowgey/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":83603179,"node_id":"MDU6TGFiZWw4MzYwMzE3OQ==","url":"https://api.github.com/repos/pyca/cryptography/labels/bugs","name":"bugs","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-03-19T21:31:35Z","updated_at":"2020-08-04T00:02:42Z","closed_at":"2018-03-30T18:10:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Certificate found in the wild seem to break cryptography's date parser.  The underlying openssl tool handles the same data without crashing:\r\n\r\n```\r\n$ echo \"MIICizCCAfQCCQD60p0z19VwkjANBgkqhkiG9w0BAQUFADCBhzELMAkGA1UEBhMCTkwxEzARBgNVBAgTClNvbWUtU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UEChMFTUJJY3QxFDASBgNVBAsTC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEcMBoGCSqGSIb3DQEJARYNaW5mb0BtYmljdC5ubDAiFw0xNTA2MjAxOTQxMTNaGBEyNzU4MDYwMzAyMTk0MTEzWjCBhzELMAkGA1UEBhMCTkwxEzARBgNVBAgTClNvbWUtU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UEChMFTUJJY3QxFDASBgNVBAsTC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEcMBoGCSqGSIb3DQEJARYNaW5mb0BtYmljdC5ubDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA7XfoqQkpO2AJ/i+4vO0qzoKdRRo8YIlLgmwiry4r/M854yzKrujjdhLc3AjqqUy1w+FWR+THBdSOWXNPHtDuHsjZAE1A9bWpoZFBAIOTsMvQp8W3C1DK77umVkf1+i924aUPCeJHKWQJ9nIjM8+uvEvrBfC1Kz8b7hHD5fdXWbcCAwEAATANBgkqhkiG9w0BAQUFAAOBgQAONDYlp/cTUaNBBm7OYtXJzk1avUE4/l5PTKZBqDrZVkC55zUT2D4kLHjARXD08xLfsppEbPovo637lpSqsUI0eLHndVb5S/97TZaSpdY3SNMbDQXwmGdsYnjRGDeidGWcg3sCLifqFakWSuMI5Il+9S9nqlUBJYwF5CgCyv6H1g==\" | base64 -d | openssl x509 -text -inform DER\r\nCertificate:\r\n    Data:\r\n        Version: 1 (0x0)\r\n        Serial Number:\r\n            fa:d2:9d:33:d7:d5:70:92\r\n    Signature Algorithm: sha1WithRSAEncryption\r\n        Issuer: C = NL, ST = Some-State, L = Almere, O = MBIct, OU = development, CN = MBIct, emailAddress = info@mbict.nl\r\n        Validity\r\n            Not Before: Jun 20 19:41:13 2015 GMT\r\n            Not After : Jun  3 02:19:41 2758 GMT\r\n        Subject: C = NL, ST = Some-State, L = Almere, O = MBIct, OU = development, CN = MBIct, emailAddress = info@mbict.nl\r\n        Subject Public Key Info:\r\n            Public Key Algorithm: rsaEncryption\r\n                Public-Key: (1024 bit)\r\n                Modulus:\r\n                    00:ed:77:e8:a9:09:29:3b:60:09:fe:2f:b8:bc:ed:\r\n                    2a:ce:82:9d:45:1a:3c:60:89:4b:82:6c:22:af:2e:\r\n                    2b:fc:cf:39:e3:2c:ca:ae:e8:e3:76:12:dc:dc:08:\r\n                    ea:a9:4c:b5:c3:e1:56:47:e4:c7:05:d4:8e:59:73:\r\n                    4f:1e:d0:ee:1e:c8:d9:00:4d:40:f5:b5:a9:a1:91:\r\n                    41:00:83:93:b0:cb:d0:a7:c5:b7:0b:50:ca:ef:bb:\r\n                    a6:56:47:f5:fa:2f:76:e1:a5:0f:09:e2:47:29:64:\r\n                    09:f6:72:23:33:cf:ae:bc:4b:eb:05:f0:b5:2b:3f:\r\n                    1b:ee:11:c3:e5:f7:57:59:b7\r\n                Exponent: 65537 (0x10001)\r\n    Signature Algorithm: sha1WithRSAEncryption\r\n         0e:34:36:25:a7:f7:13:51:a3:41:06:6e:ce:62:d5:c9:ce:4d:\r\n         5a:bd:41:38:fe:5e:4f:4c:a6:41:a8:3a:d9:56:40:b9:e7:35:\r\n         13:d8:3e:24:2c:78:c0:45:70:f4:f3:12:df:b2:9a:44:6c:fa:\r\n         2f:a3:ad:fb:96:94:aa:b1:42:34:78:b1:e7:75:56:f9:4b:ff:\r\n         7b:4d:96:92:a5:d6:37:48:d3:1b:0d:05:f0:98:67:6c:62:78:\r\n         d1:18:37:a2:74:65:9c:83:7b:02:2e:27:ea:15:a9:16:4a:e3:\r\n         08:e4:89:7e:f5:2f:67:aa:55:01:25:8c:05:e4:28:02:ca:fe:\r\n         87:d6\r\n-----BEGIN CERTIFICATE-----\r\nMIICizCCAfQCCQD60p0z19VwkjANBgkqhkiG9w0BAQUFADCBhzELMAkGA1UEBhMC\r\nTkwxEzARBgNVBAgTClNvbWUtU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UE\r\nChMFTUJJY3QxFDASBgNVBAsTC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEc\r\nMBoGCSqGSIb3DQEJARYNaW5mb0BtYmljdC5ubDAiFw0xNTA2MjAxOTQxMTNaGBEy\r\nNzU4MDYwMzAyMTk0MTEzWjCBhzELMAkGA1UEBhMCTkwxEzARBgNVBAgTClNvbWUt\r\nU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UEChMFTUJJY3QxFDASBgNVBAsT\r\nC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEcMBoGCSqGSIb3DQEJARYNaW5m\r\nb0BtYmljdC5ubDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA7XfoqQkpO2AJ\r\n/i+4vO0qzoKdRRo8YIlLgmwiry4r/M854yzKrujjdhLc3AjqqUy1w+FWR+THBdSO\r\nWXNPHtDuHsjZAE1A9bWpoZFBAIOTsMvQp8W3C1DK77umVkf1+i924aUPCeJHKWQJ\r\n9nIjM8+uvEvrBfC1Kz8b7hHD5fdXWbcCAwEAATANBgkqhkiG9w0BAQUFAAOBgQAO\r\nNDYlp/cTUaNBBm7OYtXJzk1avUE4/l5PTKZBqDrZVkC55zUT2D4kLHjARXD08xLf\r\nsppEbPovo637lpSqsUI0eLHndVb5S/97TZaSpdY3SNMbDQXwmGdsYnjRGDeidGWc\r\ng3sCLifqFakWSuMI5Il+9S9nqlUBJYwF5CgCyv6H1g==\r\n-----END CERTIFICATE-----\r\n```\r\n\r\n\r\nSteps to reproduce:\r\n\r\n1) create a virtualenv and pip install cryptography\r\n\r\n```\r\n$ virtualenv venv\r\nRunning virtualenv with interpreter /usr/bin/python2\r\nNew python executable in /home/j/src/cryptotest/venv/bin/python2\r\nAlso creating executable in /home/j/src/cryptotest/venv/bin/python\r\nInstalling setuptools, pkg_resources, pip, wheel...done.\r\n$ . venv/bin/activate\r\n(venv)$ pip install cryptography\r\nCollecting cryptography\r\n[snip]\r\n```\r\n\r\n2) try to pull the end validity date out of the certificate\r\n \r\n```\r\n(venv) $ python\r\nPython 2.7.13 (default, Nov 24 2017, 17:33:09) \r\n[GCC 6.3.0 20170516] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import cryptography\r\n>>> import base64\r\n>>> text = 'MIICizCCAfQCCQD60p0z19VwkjANBgkqhkiG9w0BAQUFADCBhzELMAkGA1UEBhMCTkwxEzARBgNVBAgTClNvbWUtU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UEChMFTUJJY3QxFDASBgNVBAsTC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEcMBoGCSqGSIb3DQEJARYNaW5mb0BtYmljdC5ubDAiFw0xNTA2MjAxOTQxMTNaGBEyNzU4MDYwMzAyMTk0MTEzWjCBhzELMAkGA1UEBhMCTkwxEzARBgNVBAgTClNvbWUtU3RhdGUxDzANBgNVBAcTBkFsbWVyZTEOMAwGA1UEChMFTUJJY3QxFDASBgNVBAsTC2RldmVsb3BtZW50MQ4wDAYDVQQDEwVNQkljdDEcMBoGCSqGSIb3DQEJARYNaW5mb0BtYmljdC5ubDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA7XfoqQkpO2AJ/i+4vO0qzoKdRRo8YIlLgmwiry4r/M854yzKrujjdhLc3AjqqUy1w+FWR+THBdSOWXNPHtDuHsjZAE1A9bWpoZFBAIOTsMvQp8W3C1DK77umVkf1+i924aUPCeJHKWQJ9nIjM8+uvEvrBfC1Kz8b7hHD5fdXWbcCAwEAATANBgkqhkiG9w0BAQUFAAOBgQAONDYlp/cTUaNBBm7OYtXJzk1avUE4/l5PTKZBqDrZVkC55zUT2D4kLHjARXD08xLfsppEbPovo637lpSqsUI0eLHndVb5S/97TZaSpdY3SNMbDQXwmGdsYnjRGDeidGWcg3sCLifqFakWSuMI5Il+9S9nqlUBJYwF5CgCyv6H1g=='\r\n>>> from cryptography import x509\r\n>>> cert = cryptography.x509.load_der_x509_certificate(base64.b64decode(text), cryptography.hazmat.backends.default_backend())\r\n>>> cert.not_valid_after\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/j/src/cryptotest/venv/local/lib/python2.7/site-packages/cryptography/hazmat/backends/openssl/x509.py\", line 96, in not_valid_after\r\n    return _parse_asn1_time(self._backend, asn1_time)\r\n  File \"/home/j/src/cryptotest/venv/local/lib/python2.7/site-packages/cryptography/hazmat/backends/openssl/decode_asn1.py\", line 737, in _parse_asn1_time\r\n    backend.openssl_assert(generalized_time != backend._ffi.NULL)\r\n  File \"/home/j/src/cryptotest/venv/local/lib/python2.7/site-packages/cryptography/hazmat/backends/openssl/backend.py\", line 105, in openssl_assert\r\n    return binding._openssl_assert(self._lib, ok)\r\n  File \"/home/j/src/cryptotest/venv/local/lib/python2.7/site-packages/cryptography/hazmat/bindings/openssl/binding.py\", line 76, in _openssl_assert\r\n    errors_with_text\r\ncryptography.exceptions.InternalError: Unknown OpenSSL error. This error is commonly encountered when another library is not cleaning up the OpenSSL error stack. If you are using cryptography with another library that uses OpenSSL try disabling it before reporting a bug. Otherwise please file an issue at https://github.com/pyca/cryptography/issues with information on how to reproduce this. ([])\r\n```","closed_by":{"login":"reaperhulk","id":161495,"node_id":"MDQ6VXNlcjE2MTQ5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/161495?v=4","gravatar_id":"","url":"https://api.github.com/users/reaperhulk","html_url":"https://github.com/reaperhulk","followers_url":"https://api.github.com/users/reaperhulk/followers","following_url":"https://api.github.com/users/reaperhulk/following{/other_user}","gists_url":"https://api.github.com/users/reaperhulk/gists{/gist_id}","starred_url":"https://api.github.com/users/reaperhulk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reaperhulk/subscriptions","organizations_url":"https://api.github.com/users/reaperhulk/orgs","repos_url":"https://api.github.com/users/reaperhulk/repos","events_url":"https://api.github.com/users/reaperhulk/events{/privacy}","received_events_url":"https://api.github.com/users/reaperhulk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyca/cryptography/issues/4158/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyca/cryptography/issues/4158/timeline","performed_via_github_app":null,"state_reason":"completed"}