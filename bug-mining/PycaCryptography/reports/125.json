{"url":"https://api.github.com/repos/pyca/cryptography/issues/9253","repository_url":"https://api.github.com/repos/pyca/cryptography","labels_url":"https://api.github.com/repos/pyca/cryptography/issues/9253/labels{/name}","comments_url":"https://api.github.com/repos/pyca/cryptography/issues/9253/comments","events_url":"https://api.github.com/repos/pyca/cryptography/issues/9253/events","html_url":"https://github.com/pyca/cryptography/issues/9253","id":1807765315,"node_id":"I_kwDOALYunM5rwE9D","number":9253,"title":"Cryptography 41.0.2 fails to parse certificate signed with DSA","user":{"login":"niooss-ledger","id":64031241,"node_id":"MDQ6VXNlcjY0MDMxMjQx","avatar_url":"https://avatars.githubusercontent.com/u/64031241?v=4","gravatar_id":"","url":"https://api.github.com/users/niooss-ledger","html_url":"https://github.com/niooss-ledger","followers_url":"https://api.github.com/users/niooss-ledger/followers","following_url":"https://api.github.com/users/niooss-ledger/following{/other_user}","gists_url":"https://api.github.com/users/niooss-ledger/gists{/gist_id}","starred_url":"https://api.github.com/users/niooss-ledger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niooss-ledger/subscriptions","organizations_url":"https://api.github.com/users/niooss-ledger/orgs","repos_url":"https://api.github.com/users/niooss-ledger/repos","events_url":"https://api.github.com/users/niooss-ledger/events{/privacy}","received_events_url":"https://api.github.com/users/niooss-ledger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":4844286604,"node_id":"LA_kwDOALYunM8AAAABIL3yjA","url":"https://api.github.com/repos/pyca/cryptography/labels/waiting-on-reporter","name":"waiting-on-reporter","color":"b60205","default":false,"description":"Issue is waiting on a reply from the reporter. It will be automatically cloesd if there is no reply."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2023-07-17T13:16:14Z","updated_at":"2023-10-19T00:01:08Z","closed_at":"2023-07-20T21:10:16Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nWhen parsing a certificated signed with DSA, `cryptography` 41.0.2 fails with:\r\n\r\n```text\r\n  File \"/usr/local/lib/python3.11/site-packages/cryptography/x509/base.py\", line 583, in load_pem_x509_certificate\r\n    return rust_x509.load_pem_x509_certificate(data)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nValueError: error parsing asn1 value: ParseError { kind: ExtraData, location: [\"Certificate::tbs_cert\", \"TbsCertificate::signature_alg\"] }\r\n```\r\n\r\nTo reproduce the bug, I generated a certificate in a clean container `python:3.11-alpine` container (launched with `docker run --rm -it docker.io/library/python:3.11-alpine sh`):\r\n\r\n```sh\r\napk add openjdk11 openssl\r\nkeytool -genkeypair -noprompt -keyalg dsa -storetype pkcs12 -keystore store.p12 -storepass changeit -alias a -dname CN=example\r\nopenssl pkcs12 -info -passin pass:changeit -nodes -in store.p12\r\n```\r\n\r\nThis generated a DSA keypair and displayed a certificate.\r\nI load this certificate with `cryptography.x509.load_pem_x509_certificate`:\r\n\r\n```python\r\nimport cryptography.hazmat.backends\r\nimport cryptography.x509\r\n\r\ncertificate = b\"\"\"-----BEGIN CERTIFICATE-----\r\nMIIEIDCCA8ugAwIBAgIEK3rzQDANBglghkgBZQMEAwIFADASMRAwDgYDVQQDEwdl\r\neGFtcGxlMB4XDTIzMDcxNzEzMDQ0MVoXDTIzMTAxNTEzMDQ0MVowEjEQMA4GA1UE\r\nAxMHZXhhbXBsZTCCA0IwggI1BgcqhkjOOAQBMIICKAKCAQEAj3k12bmq6b+r7Yh6\r\nz0lRtvMuxZ47rzcY6OrElh8+/TYG50NRqcQYMzm4CefCrhxTm6dHW4XQEa24tHmH\r\ndUmEaVysDo8UszYIKKIv+icRCj1iqZNFNAmg/mlsRlj4S90ggZw3CaAQV7GVrc0A\r\nIz26VIS2KR+dZI74g0SGd5ec7AS0NKasLnXpmF3iPbApL8ERjJ/6nYGB5zONt5K3\r\nMNe540lZL2gJmHIVORXqPWuLRlPGM0WPgDsypMLg8nKQJW5OP4o7CDihxFDk4Ywa\r\nKaN9316hQ95LZv8EkD7VzxYj4VjUh8YI6X8hHNgdyiPLbjgHZfgi40K+SEwFdjk5\r\nYBzWZwIdALr2lqaFePff3uf6Z8l3x4XvMrIzuuWAwLzVaV0CggEAFqZcWCBIUHBO\r\ndQKjl1cEDTTaOjR4wVTU5KXALSQu4E+W5h5L0JBKvayPN+6x4J8xgtI8kEPLZC+I\r\nAEFg7fnKCbMgdqecMqYn8kc+kYebosTnRL0ggVRMtVuALDaNH6g+1InpTg+gaI4y\r\nQopceMR4xo0FJ7ccmjq7CwvhLERoljnn08502xAaZaorh/ZMaCbbPscvS1WZg0u0\r\n7bAvfJDppJbTpV1TW+v8RdT2GfY/Pe27hzklwvIk4HcxKW2oh+weR0j4fvtf3rdU\r\nhDFrIjLe5VPdrwIRKw0fAtowlzIk/ieu2oudSyki2bqL457Z4QOmPFKBC8aIt+Lt\r\nQxbh7xfb3gOCAQUAAoIBAE9198Qk2RSPzrlp1Kn2dekLQl/7vhwIMM2ELDO16y3F\r\npUI+m3NRUDThVos5La8qcnJpBVG/uM3nkpSev10zAUEv7DZoXWqmM71JXyk0dJrv\r\nZHJMnsLAC9raNxQNPLeXBowprVXCOFwLZHplYNDi6kq2/scg87YC6l3UYjaVa4gD\r\njIDYmKcKuVI61JIYDJUIBfDtB/bgvAPwOf7Nb++lNQ4X5ibBrnuIGA5IXghxs3+3\r\nNS1xoDUMt3bArjex2q3L/s0+ag5x2VbxqtQhMfBo9Tz5/R2vbN3NUn3oqcS1nBPx\r\nfR7YyV+6Wvc7Lqixx+3KWPuzsB/xbkUQb4jtKCJ4GYijITAfMB0GA1UdDgQWBBQ2\r\nzCtCCA1f4l/9+S+kzPnCD0q1UDANBglghkgBZQMEAwIFAANAADA9Ah0AkTHX6Lxh\r\nsobhhLgQWHiHOZ8ndECVDfG5ro3NtQIcEEkRmOSDscN78wHoMqSoSl+v2kAFWXKN\r\nSYhhaQ==\r\n-----END CERTIFICATE-----\"\"\"\r\nbackend = cryptography.hazmat.backends.default_backend()\r\ncert = cryptography.x509.load_pem_x509_certificate(certificate, backend)\r\nprint(cert)\r\n```\r\n\r\nWith `cryptography==41.0.2`, this fails with\r\n\r\n```text\r\nTraceback (most recent call last):\r\n  File \"/example.py\", line 30, in <module>\r\n    cert = cryptography.x509.load_pem_x509_certificate(certificate, backend)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/site-packages/cryptography/x509/base.py\", line 583, in load_pem_x509_certificate\r\n    return rust_x509.load_pem_x509_certificate(data)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nValueError: error parsing asn1 value: ParseError { kind: ExtraData, location: [\"Certificate::tbs_cert\", \"TbsCertificate::signature_alg\"] }\r\n```\r\n\r\n- This is also broken with `cryptography==41.0.0`\r\n- This works when downgrading to `cryptography==40.0.2` and previous versions (the Python script successfully displays `<Certificate(subject=<Name(CN=example)>, ...)>`).\r\n- This also fails with current git `main` installed with `apk add cargo git pkgconf openssl-dev && pip install git+https://github.com/pyca/cryptography`.\r\n\r\nI am using Python 3.11, `cryptography` 41.0.2, `cffi` 1.15.1 and `pip` 23.1.2, on Linux (Alpine container) on an x86-64 processor.\r\n\r\nAre certificates signed with DSA unsupported since `cryptography` 41.0.0?","closed_by":{"login":"alex","id":772,"node_id":"MDQ6VXNlcjc3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/772?v=4","gravatar_id":"","url":"https://api.github.com/users/alex","html_url":"https://github.com/alex","followers_url":"https://api.github.com/users/alex/followers","following_url":"https://api.github.com/users/alex/following{/other_user}","gists_url":"https://api.github.com/users/alex/gists{/gist_id}","starred_url":"https://api.github.com/users/alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alex/subscriptions","organizations_url":"https://api.github.com/users/alex/orgs","repos_url":"https://api.github.com/users/alex/repos","events_url":"https://api.github.com/users/alex/events{/privacy}","received_events_url":"https://api.github.com/users/alex/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyca/cryptography/issues/9253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyca/cryptography/issues/9253/timeline","performed_via_github_app":null,"state_reason":"completed"}