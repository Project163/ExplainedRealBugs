{"url":"https://api.github.com/repos/pyca/cryptography/issues/5065","repository_url":"https://api.github.com/repos/pyca/cryptography","labels_url":"https://api.github.com/repos/pyca/cryptography/issues/5065/labels{/name}","comments_url":"https://api.github.com/repos/pyca/cryptography/issues/5065/comments","events_url":"https://api.github.com/repos/pyca/cryptography/issues/5065/events","html_url":"https://github.com/pyca/cryptography/issues/5065","id":523210687,"node_id":"MDU6SXNzdWU1MjMyMTA2ODc=","number":5065,"title":"Two PKCS12 tests fail when OpenSSL is built without RC2 support","user":{"login":"koobs","id":1011612,"node_id":"MDQ6VXNlcjEwMTE2MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1011612?v=4","gravatar_id":"","url":"https://api.github.com/users/koobs","html_url":"https://github.com/koobs","followers_url":"https://api.github.com/users/koobs/followers","following_url":"https://api.github.com/users/koobs/following{/other_user}","gists_url":"https://api.github.com/users/koobs/gists{/gist_id}","starred_url":"https://api.github.com/users/koobs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/koobs/subscriptions","organizations_url":"https://api.github.com/users/koobs/orgs","repos_url":"https://api.github.com/users/koobs/repos","events_url":"https://api.github.com/users/koobs/events{/privacy}","received_events_url":"https://api.github.com/users/koobs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":72590163,"node_id":"MDU6TGFiZWw3MjU5MDE2Mw==","url":"https://api.github.com/repos/pyca/cryptography/labels/backend","name":"backend","color":"fbca04","default":false,"description":null},{"id":72590189,"node_id":"MDU6TGFiZWw3MjU5MDE4OQ==","url":"https://api.github.com/repos/pyca/cryptography/labels/primitives","name":"primitives","color":"eb6420","default":false,"description":null},{"id":83603179,"node_id":"MDU6TGFiZWw4MzYwMzE3OQ==","url":"https://api.github.com/repos/pyca/cryptography/labels/bugs","name":"bugs","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"alex","id":772,"node_id":"MDQ6VXNlcjc3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/772?v=4","gravatar_id":"","url":"https://api.github.com/users/alex","html_url":"https://github.com/alex","followers_url":"https://api.github.com/users/alex/followers","following_url":"https://api.github.com/users/alex/following{/other_user}","gists_url":"https://api.github.com/users/alex/gists{/gist_id}","starred_url":"https://api.github.com/users/alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alex/subscriptions","organizations_url":"https://api.github.com/users/alex/orgs","repos_url":"https://api.github.com/users/alex/repos","events_url":"https://api.github.com/users/alex/events{/privacy}","received_events_url":"https://api.github.com/users/alex/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"alex","id":772,"node_id":"MDQ6VXNlcjc3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/772?v=4","gravatar_id":"","url":"https://api.github.com/users/alex","html_url":"https://github.com/alex","followers_url":"https://api.github.com/users/alex/followers","following_url":"https://api.github.com/users/alex/following{/other_user}","gists_url":"https://api.github.com/users/alex/gists{/gist_id}","starred_url":"https://api.github.com/users/alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alex/subscriptions","organizations_url":"https://api.github.com/users/alex/orgs","repos_url":"https://api.github.com/users/alex/repos","events_url":"https://api.github.com/users/alex/events{/privacy}","received_events_url":"https://api.github.com/users/alex/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/pyca/cryptography/milestones/31","html_url":"https://github.com/pyca/cryptography/milestone/31","labels_url":"https://api.github.com/repos/pyca/cryptography/milestones/31/labels","id":4410944,"node_id":"MDk6TWlsZXN0b25lNDQxMDk0NA==","number":31,"title":"Twenty Ninth release","description":"","creator":{"login":"alex","id":772,"node_id":"MDQ6VXNlcjc3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/772?v=4","gravatar_id":"","url":"https://api.github.com/users/alex","html_url":"https://github.com/alex","followers_url":"https://api.github.com/users/alex/followers","following_url":"https://api.github.com/users/alex/following{/other_user}","gists_url":"https://api.github.com/users/alex/gists{/gist_id}","starred_url":"https://api.github.com/users/alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alex/subscriptions","organizations_url":"https://api.github.com/users/alex/orgs","repos_url":"https://api.github.com/users/alex/repos","events_url":"https://api.github.com/users/alex/events{/privacy}","received_events_url":"https://api.github.com/users/alex/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":26,"state":"closed","created_at":"2019-06-15T23:56:28Z","updated_at":"2020-04-11T23:05:30Z","due_on":null,"closed_at":"2020-04-11T23:05:30Z"},"comments":4,"created_at":"2019-11-15T02:10:17Z","updated_at":"2020-07-27T00:02:48Z","closed_at":"2019-11-24T23:16:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The following two tests fail when run with an **OpenSSL** (1.1.1d) built **without RC2** support:\r\n\r\n * TestPKCS12.test_load_pkcs12_ec_keys[cert-rc2-key-3des.p12-cryptography]\r\n * TestPKCS12.test_load_pkcs12_ec_keys[no-password.p12-None]\r\n\r\nThe error summary is: `ValueError: Invalid password or PKCS12 data`\r\n\r\nReproduction Environment:\r\n\r\n * Operating System:  FreeBSD 13.0-CURRENT #3 r354143: Tue Oct 29 13:10:35 AEDT 2019\r\n * OpenSSL: 1.1.1d-freebsd  10 Sep 2019 (via ports, with RC2 option disabled)\r\n * Python 2.7.17 / 3.7.5\r\n * cryptography: 2.8 (PyPI sdist)\r\n\r\nFull backtraces follow:\r\n\r\nTestPKCS12.test_load_pkcs12_ec_keys[cert-rc2-key-3des.p12-cryptography] \r\n```\r\nTestPKCS12.test_load_pkcs12_ec_keys[cert-rc2-key-3des.p12-cryptography] \r\n_______________________________________________________________________\r\n\r\nself = <tests.hazmat.primitives.test_pkcs12.TestPKCS12 object at 0x8774ecc50>, filename = 'cert-rc2-key-3des.p12', password = 'cryptography', backend = <cryptography.hazmat.backends.openssl.backend.Backend object at 0x804bf5390>\r\n\r\n    @pytest.mark.parametrize(\r\n        (\"filename\", \"password\"),\r\n        [\r\n            (\"cert-key-aes256cbc.p12\", b\"cryptography\"),\r\n            (\"cert-none-key-none.p12\", b\"cryptography\"),\r\n            (\"cert-rc2-key-3des.p12\", b\"cryptography\"),\r\n            (\"no-password.p12\", None),\r\n        ]\r\n    )\r\n    def test_load_pkcs12_ec_keys(self, filename, password, backend):\r\n        cert = load_vectors_from_file(\r\n            os.path.join(\"x509\", \"custom\", \"ca\", \"ca.pem\"),\r\n            lambda pemfile: x509.load_pem_x509_certificate(\r\n                pemfile.read(), backend\r\n            ), mode=\"rb\"\r\n        )\r\n        key = load_vectors_from_file(\r\n            os.path.join(\"x509\", \"custom\", \"ca\", \"ca_key.pem\"),\r\n            lambda pemfile: load_pem_private_key(\r\n                pemfile.read(), None, backend\r\n            ), mode=\"rb\"\r\n        )\r\n        parsed_key, parsed_cert, parsed_more_certs = load_vectors_from_file(\r\n            os.path.join(\"pkcs12\", filename),\r\n            lambda derfile: load_key_and_certificates(\r\n                derfile.read(), password, backend\r\n>           ), mode=\"rb\"\r\n        )\r\n\r\ntests/hazmat/primitives/test_pkcs12.py:49:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/utils.py:48: in load_vectors_from_file\r\n    return loader(vector_file)\r\ntests/hazmat/primitives/test_pkcs12.py:48: in <lambda>\r\n    derfile.read(), password, backend\r\nsrc/cryptography/hazmat/primitives/serialization/pkcs12.py:9: in load_key_and_certificates\r\n    return backend.load_key_and_certificates_from_pkcs12(data, password)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <cryptography.hazmat.backends.openssl.backend.Backend object at 0x804bf5390>\r\ndata = \"0\\x82\\x03R\\x02\\x01\\x030\\x82\\x03\\x18\\x06\\t*\\x86H\\x86\\xf7\\r\\x01\\x07\\x01\\xa0\\x82\\x03\\t\\x04\\x82\\x03\\x050\\x82\\x03\\x010\\x82...2\\x1a\\x05\\x00\\x04\\x14)\\x00\\x91\\x90\\xe8\\x10I\\xc3uw<U\\xd4\\xdc\\xa7EM}C\\x1b\\x04\\x08\\xb7\\xde6_\\xa1\\x95\\xdd!\\x02\\x02\\x08\\x00\", password = 'cryptography'\r\n\r\n    def load_key_and_certificates_from_pkcs12(self, data, password):\r\n        if password is not None:\r\n            utils._check_byteslike(\"password\", password)\r\n\r\n        bio = self._bytes_to_bio(data)\r\n        p12 = self._lib.d2i_PKCS12_bio(bio.bio, self._ffi.NULL)\r\n        if p12 == self._ffi.NULL:\r\n            self._consume_errors()\r\n            raise ValueError(\"Could not deserialize PKCS12 data\")\r\n\r\n        p12 = self._ffi.gc(p12, self._lib.PKCS12_free)\r\n        evp_pkey_ptr = self._ffi.new(\"EVP_PKEY **\")\r\n        x509_ptr = self._ffi.new(\"X509 **\")\r\n        sk_x509_ptr = self._ffi.new(\"Cryptography_STACK_OF_X509 **\")\r\n        with self._zeroed_null_terminated_buf(password) as password_buf:\r\n            res = self._lib.PKCS12_parse(\r\n                p12, password_buf, evp_pkey_ptr, x509_ptr, sk_x509_ptr\r\n            )\r\n\r\n        if res == 0:\r\n            self._consume_errors()\r\n>           raise ValueError(\"Invalid password or PKCS12 data\")\r\nE           ValueError: Invalid password or PKCS12 data\r\n\r\nsrc/cryptography/hazmat/backends/openssl/backend.py:2433: ValueError\r\n```\r\n\r\nTestPKCS12.test_load_pkcs12_ec_keys[no-password.p12-None\r\n```\r\nTestPKCS12.test_load_pkcs12_ec_keys[no-password.p12-None\r\n_________________________________________________________________________\r\n\r\nself = <tests.hazmat.primitives.test_pkcs12.TestPKCS12 object at 0x8775bc950>, filename = 'no-password.p12', password = None, backend = <cryptography.hazmat.backends.openssl.backend.Backend object at 0x804bf5390>\r\n\r\n    @pytest.mark.parametrize(\r\n        (\"filename\", \"password\"),\r\n        [\r\n            (\"cert-key-aes256cbc.p12\", b\"cryptography\"),\r\n            (\"cert-none-key-none.p12\", b\"cryptography\"),\r\n            (\"cert-rc2-key-3des.p12\", b\"cryptography\"),\r\n            (\"no-password.p12\", None),\r\n        ]\r\n    )\r\n    def test_load_pkcs12_ec_keys(self, filename, password, backend):\r\n        cert = load_vectors_from_file(\r\n            os.path.join(\"x509\", \"custom\", \"ca\", \"ca.pem\"),\r\n            lambda pemfile: x509.load_pem_x509_certificate(\r\n                pemfile.read(), backend\r\n            ), mode=\"rb\"\r\n        )\r\n        key = load_vectors_from_file(\r\n            os.path.join(\"x509\", \"custom\", \"ca\", \"ca_key.pem\"),\r\n            lambda pemfile: load_pem_private_key(\r\n                pemfile.read(), None, backend\r\n            ), mode=\"rb\"\r\n        )\r\n        parsed_key, parsed_cert, parsed_more_certs = load_vectors_from_file(\r\n            os.path.join(\"pkcs12\", filename),\r\n            lambda derfile: load_key_and_certificates(\r\n                derfile.read(), password, backend\r\n>           ), mode=\"rb\"\r\n        )\r\n\r\ntests/hazmat/primitives/test_pkcs12.py:49:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/utils.py:48: in load_vectors_from_file\r\n    return loader(vector_file)\r\ntests/hazmat/primitives/test_pkcs12.py:48: in <lambda>\r\n    derfile.read(), password, backend\r\nsrc/cryptography/hazmat/primitives/serialization/pkcs12.py:9: in load_key_and_certificates\r\n    return backend.load_key_and_certificates_from_pkcs12(data, password)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <cryptography.hazmat.backends.openssl.backend.Backend object at 0x804bf5390>\r\ndata = '0\\x82\\x03\\xb0\\x02\\x01\\x030\\x82\\x03w\\x06\\t*\\x86H\\x86\\xf7\\r\\x01\\x07\\x01\\xa0\\x82\\x03h\\x04\\x82\\x03d0\\x82\\x03`0\\x82\\x02\\'\\...5\\x00\\x04\\x14mL\\xfc\\xde\\xc7i\\xdc\\xfd\\xd4\\x06x\\xd7\\x9d{\\x19\\xebm\\x14\"\\xe4\\x04\\x08u+\\xf6\\x1b\\x90\\xbb\\xee\\xad\\x02\\x01\\x01', password = None\r\n\r\n    def load_key_and_certificates_from_pkcs12(self, data, password):\r\n        if password is not None:\r\n            utils._check_byteslike(\"password\", password)\r\n\r\n        bio = self._bytes_to_bio(data)\r\n        p12 = self._lib.d2i_PKCS12_bio(bio.bio, self._ffi.NULL)\r\n        if p12 == self._ffi.NULL:\r\n            self._consume_errors()\r\n            raise ValueError(\"Could not deserialize PKCS12 data\")\r\n\r\n        p12 = self._ffi.gc(p12, self._lib.PKCS12_free)\r\n        evp_pkey_ptr = self._ffi.new(\"EVP_PKEY **\")\r\n        x509_ptr = self._ffi.new(\"X509 **\")\r\n        sk_x509_ptr = self._ffi.new(\"Cryptography_STACK_OF_X509 **\")\r\n        with self._zeroed_null_terminated_buf(password) as password_buf:\r\n            res = self._lib.PKCS12_parse(\r\n                p12, password_buf, evp_pkey_ptr, x509_ptr, sk_x509_ptr\r\n            )\r\n\r\n        if res == 0:\r\n            self._consume_errors()\r\n>           raise ValueError(\"Invalid password or PKCS12 data\")\r\nE           ValueError: Invalid password or PKCS12 data\r\n\r\nsrc/cryptography/hazmat/backends/openssl/backend.py:2433: ValueError\r\n\r\n_________________________________________________________________________\r\n2 failed, 102886 passed, 4194 skipped, 3 warnings in 1021.08 seconds\r\n_________________________________________________________________________\r\n```\r\n\r\n","closed_by":{"login":"reaperhulk","id":161495,"node_id":"MDQ6VXNlcjE2MTQ5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/161495?v=4","gravatar_id":"","url":"https://api.github.com/users/reaperhulk","html_url":"https://github.com/reaperhulk","followers_url":"https://api.github.com/users/reaperhulk/followers","following_url":"https://api.github.com/users/reaperhulk/following{/other_user}","gists_url":"https://api.github.com/users/reaperhulk/gists{/gist_id}","starred_url":"https://api.github.com/users/reaperhulk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reaperhulk/subscriptions","organizations_url":"https://api.github.com/users/reaperhulk/orgs","repos_url":"https://api.github.com/users/reaperhulk/repos","events_url":"https://api.github.com/users/reaperhulk/events{/privacy}","received_events_url":"https://api.github.com/users/reaperhulk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pyca/cryptography/issues/5065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pyca/cryptography/issues/5065/timeline","performed_via_github_app":null,"state_reason":"completed"}