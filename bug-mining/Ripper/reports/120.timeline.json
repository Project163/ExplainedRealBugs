[{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304508664","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304508664","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304508664,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDUwODY2NA==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-28T11:43:33Z","updated_at":"2017-05-28T11:43:33Z","body":"Could you share `input.txt` please? (Or some equivalent that triggers the same bug.)","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304508664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304551552","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304551552","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304551552,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDU1MTU1Mg==","user":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-29T00:52:16Z","updated_at":"2017-05-29T13:32:00Z","body":"Sure: \r\nhere is input.txt:\r\n\r\n```\r\nnchoir octogenaries alumic peshwaship 're seminomata typhlectasis designator's gourdful\r\nracked raisins albahaca windable speckledbill lidderon kolkhos steelify\r\nantapodosis benedictine\r\n```\r\n\r\n--------------\r\nAlso I am not sure what the expected behaviour if a word can start with a singlequote but if you start with a space you still get this error.  \r\nrg \" 're\" -wo input.txt\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', /checkout/src/libcore/option.rs:323\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304551552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1101023656,"node_id":"MDEyOkxhYmVsZWRFdmVudDExMDEwMjM2NTY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1101023656","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2017-05-29T13:33:55Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":1101051513,"node_id":"MDExOkNsb3NlZEV2ZW50MTEwMTA1MTUxMw==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1101051513","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"112b3c5e0ae232fdbce90cd505c57f2c4abc4a22","commit_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits/112b3c5e0ae232fdbce90cd505c57f2c4abc4a22","created_at":"2017-05-29T13:54:25Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304767352","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304767352","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304767352,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDc2NzM1Mg==","user":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-30T03:38:48Z","updated_at":"2017-05-30T03:38:48Z","body":"Wow, that was fast, thanks. \r\nbtw, your blog post on the internals of ripgrep and others was amazing!\r\n I ended up using it as the basic reference point for my [blog post](https://iabdb.me/2017/05/29/how-the-mighty-have-fallen-or-how-i-learned-to-love-grep/).","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304767352/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304847996","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304847996","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304847996,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDg0Nzk5Ng==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-30T11:17:44Z","updated_at":"2017-05-30T11:17:44Z","body":"@pindash No problem. That is an epic blog post! Nice work! There are definitely some details in there that are questionable though...\r\n\r\nFirstly, I'm kind of curious to see so much focus put on memory maps. Did you happen to read through the sections on memory maps in my blog posts? They tend to provide a small speed boost on very large files, but that's about it.\r\n\r\nSecondly, I'm impressed you were able to get so much mileage out of `rg -f`. I've never actually benchmarked ripgrep's `-f` flag against GNU grep's `-f` flag, so I don't think it's fair to say that I think it's faster. Namely, its current implementation is a quick hack. Note though that the regex engine may elect to use Aho-Corasick, so you can't really say whether it's being used or not. (Although, given the number of patterns, the regex engine is almost certainly avoiding all literal optimizations.) A better implementation would use Aho-Corasick explicitly inside ripgrep when the `-F` flag is used.\r\n\r\nThirdly, GNU grep doesn't actually use Aho-Corasick. It uses Commentz-Walter.\r\n\r\n> Also, the newest grep had somehow increased it’s speed on non-ASCII characters. So some of the traditional speedups like setting up LC_ALL=C, which forces grep to use ASCII characters doesn’t actually increase the speed.\r\n\r\nI don't think a blanket statement like this is accurate. Have you seen the benchmarks in my blog post? They might have fixed the performance problems when searching simple ASCII literals, but they certainly haven't fixed them when using actual regexes like `\\w`. :-)\r\n\r\n> Ripgrep then goes one step further and tries to optimize this by searching for a common literal among all those patterns so that it can skip using the regex engine which is much slower. If it finds a common literal string among the patterns it will submit it to it’s implementation of the teddy algorithm, which takes advantage of Intel’s more recent SIMD instructions (single instruction multiple data, AKA vectorized processing). The teddy algorithm submits the literal to be checked against 16 bytes at a time and if it finds a match it will go into the slower regex engine to verify. This implementation forces our pattern files to be smaller since a pattern-file that is too big will not have a common literal or will match too often.\r\n\r\nUnfortunately, this analysis is wrong. The Teddy algorithm is only used when there is a small number of common literals identified. In a large list like the one you're using, it won't be used. (And even then, you didn't say how you install ripgrep, which means you might not even have SIMD turned on.)\r\n\r\n> In fact, the pattern-files have a limit that will throw an error if they are too big because they overwhelm the regex engine.\r\n\r\nThat can be tweaked with `--dfa-size-limit` and `--regex-size-limit`.\r\n\r\n> Because of this limitation, ripgrep has to search the entire file many more times than grep has to. \r\n\r\nI think this conclusion does turn out to be right though. :-) Or at least, part of the story.\r\n\r\n> Additionally, ripgrep will perform terribly if the original patternfile is not sorted. I suspected that ripgrep was benefitting from our sorted tokens file, and was able to find common literals, which was allowing it to be much faster than a random tokens file.\r\n\r\nThis sounds like a bug. Nice find. :-) I created #497.\r\n\r\n> Also because ripgrep uses a nonnaive version of Boyer-Moore it is able to skip many more bytes.\r\n\r\nI am starting to think that I shouldn't say that ripgrep (or the regex engine) actually uses Boyer-Moore. The reason why is because it doesn't actually use a shift table, which is kind of a hallmark of Boyer-Moore, and therefore, there's no \"skipping.\" Instead, it's fast because it picks \"rare\" bytes to feed to `memchr`, which maximizes the amount of time search stays in a highly optimized SIMD routine.\r\n\r\nWith that said, this certainly has no effect on the commands you're running. Boyer-Moore is for single substring search, not multiple substring search.\r\n\r\n> A disclaimer where I suggest using ripgrep until grep reintroduces mmap for large files. Old versions of grep have bugs that are not documented all that well.\r\n\r\nNot sure why you're saying this. Are you actually seeing a huge difference between grep with memory maps and grep without? (Using the same version of grep!) You should be able to run `rg` with and without memory maps too, e.g., `rg --mmap` and `rg --no-mmap`.\r\n\r\n> So if you know that everything is in ASCII and you know that the words in the description are space delimited nothing beats KDBQ.\r\n\r\nI think because of those assumptions, you're fundamentally solving a different problem. :-) If you made those assumptions in a custom search tool, then I wonder what the results would be!\r\n\r\n","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304847996/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1102114154,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwMjExNDE1NA==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102114154","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-30T11:17:44Z","performed_via_github_app":null},{"id":1102114155,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDIxMTQxNTU=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102114155","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-30T11:17:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304863043","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304863043","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304863043,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDg2MzA0Mw==","user":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-30T12:29:50Z","updated_at":"2017-05-30T12:29:50Z","body":"[Not sure if this should be continued here]\n@BurntSushi\nThank you, I will try and go through all of your points and fix any of my\nerrors and assumptions. It probably deserves its own post with a python\nrunable[you inspired me] so that tests are repeatable.\n\nI will verify with empirical evidence, but I expected memory maps [and they\nwere, but again I need to verify] to be faster especially if many processes\nare reading the same large file. Especially since though this file was\nlarge it comfortably fits in the systems main memory and therefore the page\nfiles.\n\nAlso, Boyer-Moore has a weakness if you have a wild char at the end of a\nstring where as your rare byte optimization will work regardless so long as\na rare byte gets chosen.\n\nAlso if ripgrep is not using teddy on patterns of 200-400 why does it\nperform faster on a sorted pattern file, where the tokens all share a\ncommon first letter for example?\n\n\n I think because of those assumptions,  you're fundamentally solving a\n different problem. :-)\n\nI quite agree, the problem ripgrep is solving is really more general, and\ntechnically an inverted file index would be the appropriate solution for\nsomething like this. At the same time when doing a one off analysis, the\noverhead of building the index is too high a penalty.\n\nYour thoroughness and expertise are much appreciated.\n\n\n\n\nOn May 30, 2017 7:17 AM, \"Andrew Gallant\" <notifications@github.com> wrote:\n\n@pindash <https://github.com/pindash> No problem. That is an epic blog\npost! Nice work! There are definitely some details in there that are\nquestionable though...\n\nFirstly, I'm kind of curious to see so much focus put on memory maps. Did\nyou happen to read through the sections on memory maps in my blog posts?\nThey tend to provide a small speed boost on very large files, but that's\nabout it.\n\nSecondly, I'm impressed you were able to get so much mileage out of rg -f.\nI've never actually benchmarked ripgrep's -f flag against GNU grep's -f\nflag, so I don't think it's fair to say that I think it's faster. Namely,\nits current implementation is a quick hack. Note though that the regex\nengine may elect to use Aho-Corasick, so you can't really say whether it's\nbeing used or not. (Although, given the number of patterns, the regex\nengine is almost certainly avoiding all literal optimizations.) A better\nimplementation would use Aho-Corasick explicitly inside ripgrep when the -F\nflag is used.\n\nThirdly, GNU grep doesn't actually use Aho-Corasick. It uses\nCommentz-Walter.\n\nAlso, the newest grep had somehow increased it’s speed on non-ASCII\ncharacters. So some of the traditional speedups like setting up LC_ALL=C,\nwhich forces grep to use ASCII characters doesn’t actually increase the\nspeed.\n\nI don't think a blanket statement like this is accurate. Have you seen the\nbenchmarks in my blog post? They might have fixed the performance problems\nwhen searching simple ASCII literals, but they certainly haven't fixed them\nwhen using actual regexes like \\w. :-)\n\nRipgrep then goes one step further and tries to optimize this by searching\nfor a common literal among all those patterns so that it can skip using the\nregex engine which is much slower. If it finds a common literal string\namong the patterns it will submit it to it’s implementation of the teddy\nalgorithm, which takes advantage of Intel’s more recent SIMD instructions\n(single instruction multiple data, AKA vectorized processing). The teddy\nalgorithm submits the literal to be checked against 16 bytes at a time and\nif it finds a match it will go into the slower regex engine to verify. This\nimplementation forces our pattern files to be smaller since a pattern-file\nthat is too big will not have a common literal or will match too often.\n\nUnfortunately, this analysis is wrong. The Teddy algorithm is only used\nwhen there is a small number of common literals identified. In a large list\nlike the one you're using, it won't be used. (And even then, you didn't say\nhow you install ripgrep, which means you might not even have SIMD turned\non.)\n\nIn fact, the pattern-files have a limit that will throw an error if they\nare too big because they overwhelm the regex engine.\n\nThat can be tweaked with --dfa-size-limit and --regex-size-limit.\n\nBecause of this limitation, ripgrep has to search the entire file many more\ntimes than grep has to.\n\nI think this conclusion does turn out to be right though. :-) Or at least,\npart of the story.\n\nAdditionally, ripgrep will perform terribly if the original patternfile is\nnot sorted. I suspected that ripgrep was benefitting from our sorted tokens\nfile, and was able to find common literals, which was allowing it to be\nmuch faster than a random tokens file.\n\nThis sounds like a bug. Nice find. :-) I created #497\n<https://github.com/BurntSushi/ripgrep/issues/497>.\n\nAlso because ripgrep uses a nonnaive version of Boyer-Moore it is able to\nskip many more bytes.\n\nI am starting to think that I shouldn't say that ripgrep (or the regex\nengine) actually uses Boyer-Moore. The reason why is because it doesn't\nactually use a shift table, which is kind of a hallmark of Boyer-Moore, and\ntherefore, there's no \"skipping.\" Instead, it's fast because it picks\n\"rare\" bytes to feed to memchr, which maximizes the amount of time search\nstays in a highly optimized SIMD routine.\n\nWith that said, this certainly has no effect on the commands you're\nrunning. Boyer-Moore is for single substring search, not multiple substring\nsearch.\n\nA disclaimer where I suggest using ripgrep until grep reintroduces mmap for\nlarge files. Old versions of grep have bugs that are not documented all\nthat well.\n\nNot sure why you're saying this. Are you actually seeing a huge difference\nbetween grep with memory maps and grep without? (Using the same version of\ngrep!) You should be able to run rg with and without memory maps too, e.g., rg\n--mmap and rg --no-mmap.\n\nSo if you know that everything is in ASCII and you know that the words in\nthe description are space delimited nothing beats KDBQ.\n\nI think because of those assumptions, you're fundamentally solving a\ndifferent problem. :-) If you made those assumptions in a custom search\ntool, then I wonder what the results would be!\n\n—\nYou are receiving this because you were mentioned.\n\nReply to this email directly, view it on GitHub\n<https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304847996>,\nor mute the thread\n<https://github.com/notifications/unsubscribe-auth/ACDWYfeI35oXkk05hEtmJpyh2ofGhXzzks5r-_rbgaJpZM4NonOJ>\n.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304863043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1102214286,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwMjIxNDI4Ng==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102214286","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-30T12:29:50Z","performed_via_github_app":null},{"id":1102214287,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDIyMTQyODc=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102214287","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-30T12:29:50Z","performed_via_github_app":null},{"id":1102214288,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwMjIxNDI4OA==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102214288","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-30T12:29:50Z","performed_via_github_app":null},{"id":1102214289,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDIyMTQyODk=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1102214289","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-30T12:29:50Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304866431","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-304866431","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":304866431,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDg2NjQzMQ==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-30T12:43:46Z","updated_at":"2017-05-30T12:43:46Z","body":"> I will verify with empirical evidence, but I expected memory maps [and they\r\nwere, but again I need to verify] to be faster especially if many processes\r\nare reading the same large file. Especially since though this file was\r\nlarge it comfortably fits in the systems main memory and therefore the page\r\nfiles.\r\n\r\nRight. You might get a small win. I've never seen memory maps blow away a well written incremental solution (as can be found in GNU grep and ripgrep). Here's an example on a ~10GB file (`OpenSubtitles2016.raw.en`):\r\n\r\n```\r\n[andrew@Cheetah subtitles] time rg -c 'Sherlock Holmes' OpenSubtitles2016.raw.en --mmap\r\n5107\r\n\r\nreal    0m1.498s\r\nuser    0m1.087s\r\nsys     0m0.381s\r\n[andrew@Cheetah subtitles] time rg -c 'Sherlock Holmes' OpenSubtitles2016.raw.en --no-mmap\r\n5107\r\n\r\nreal    0m2.452s\r\nuser    0m1.028s\r\nsys     0m1.382s\r\n```\r\n\r\nSo... maybe that is a bit bigger than a \"small\" win. :-)\r\n\r\n> Also, Boyer-Moore has a weakness if you have a wild char at the end of a\r\nstring where as your rare byte optimization will work regardless so long as\r\na rare byte gets chosen.\r\n\r\nRight. This is kind of an artifact of the modern era, which is interesting. The issue is that most Boyer Moore implementations these days implement their skip loop with `memchr`, which in turn uses optimized SIMD routines. This makes the penalty for getting a substring with a common last byte far more severe than when the skip loop was a simple `while` loop.\r\n\r\n> Also if ripgrep is not using teddy on patterns of 200-400 why does it\r\nperform faster on a sorted pattern file, where the tokens all share a\r\ncommon first letter for example?\r\n\r\nI honestly don't know. But it surely has nothing to do with Teddy. Even if Teddy were running, the order of the literals shouldn't really matter. My current guess is that you're tripping over a performance bug in literal extraction. (Which is silly, because the number of literals is so high, we'll end up throwing away any extracted literals anyway.)","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/304866431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/305022407","html_url":"https://github.com/BurntSushi/ripgrep/issues/493#issuecomment-305022407","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/493","id":305022407,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTAyMjQwNw==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-30T22:05:45Z","updated_at":"2017-05-30T22:05:45Z","body":"@pindash One other important thing to note: when I came up with the name \"ripgrep,\" I was trying to think of short pertinent names that began with the letter R (R for Rust). I liked \"rip\" because of the connotation of \"rip through your text.\" It wasn't until after I publicly mentioned the name that the alternative \"rest in peace\" meaning was made clear to me by others. I just hadn't realized it until someone actually said it. :-)\r\n\r\nIf I had realized that meaning before hand, I probably would have changed the name, since it's not particularly nice. On the other hand, the name \"grep\" isn't owned by any one group of people.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/305022407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1103198073,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwMzE5ODA3Mw==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1103198073","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-30T22:05:45Z","performed_via_github_app":null},{"id":1103198075,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDMxOTgwNzU=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/1103198075","actor":{"login":"pindash","id":2152033,"node_id":"MDQ6VXNlcjIxNTIwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/2152033?v=4","gravatar_id":"","url":"https://api.github.com/users/pindash","html_url":"https://github.com/pindash","followers_url":"https://api.github.com/users/pindash/followers","following_url":"https://api.github.com/users/pindash/following{/other_user}","gists_url":"https://api.github.com/users/pindash/gists{/gist_id}","starred_url":"https://api.github.com/users/pindash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pindash/subscriptions","organizations_url":"https://api.github.com/users/pindash/orgs","repos_url":"https://api.github.com/users/pindash/repos","events_url":"https://api.github.com/users/pindash/events{/privacy}","received_events_url":"https://api.github.com/users/pindash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-30T22:05:45Z","performed_via_github_app":null}]