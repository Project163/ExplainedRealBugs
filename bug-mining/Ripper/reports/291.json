{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550","id":598579004,"node_id":"MDU6SXNzdWU1OTg1NzkwMDQ=","number":1550,"title":"high peak memory usage with parallel breadth first directory traversal","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721678,"node_id":"MDU6TGFiZWwzMzk3MjE2Nzg=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/bug","name":"bug","color":"fc2929","default":true,"description":"A bug."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-04-12T21:50:32Z","updated_at":"2020-04-18T15:33:04Z","closed_at":"2020-04-18T15:33:04Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What version of ripgrep are you using?\r\n\r\nripgrep 12.0.0\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n\r\n#### How did you install ripgrep?\r\n\r\n`cargo install ripgrep` on `rustc 1.42.0 (b8cedc004 2020-03-09)`\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nLinux, derived from Ubuntu 18.04\r\n\r\n#### Describe your question, feature request, or bug.\r\n\r\nrg seems to leak memory when searching for an expression in latest versions of all crates from crates.io. The memory usage gradually increases and peaks at around 1Gb.\r\n\r\n#### If this is a bug, what are the steps to reproduce the behavior?\r\n\r\n```bash\r\n# get all crates from crates.io\r\ngit clone https://github.com/the-lean-crate/criner && cd criner && cargo run --release -- mine\r\n# get latest version of every crate\r\nfor dir in ./criner.db/assets/*/*/*/; do echo -n \"$dir\"; ls \"$dir\" | grep '\\.crate' | sort -Vr | head -n 1; done > ./latest-versions\r\nmkdir crates\r\ncd crates\r\n# decompress the latest version of every crate\r\ncat ../latest-versions | parallel ../decompress-one-crate.sh\r\n```\r\nwhere decompress-one-crate.sh is\r\n```bash\r\n#!/bin/sh\r\ncat \"$1\" | tar --gunzip -xf -\r\n```\r\n\r\nSample `rg` invocation exhibiting the behavior is:\r\n\r\n```\r\nrg --iglob '*.rs' -iF '#[allow('\r\n```\r\n\r\n#### If this is a bug, what is the actual behavior?\r\n\r\nMemory usage increases as the search progresses, reaching as high as 1Gb. It increases gradually and accumulates.\r\n\r\n#### If this is a bug, what is the expected behavior?\r\n\r\nMemory usage should not accumulate\r\n","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550/timeline","performed_via_github_app":null,"state_reason":"completed"}