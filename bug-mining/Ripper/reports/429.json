{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/3131","id":3343354637,"node_id":"I_kwDOAzJbyc7HR4sN","number":3131,"title":"rg -c omits files when a NUL byte is encountered after an earlier match","user":{"login":"ejh3","id":7369146,"node_id":"MDQ6VXNlcjczNjkxNDY=","avatar_url":"https://avatars.githubusercontent.com/u/7369146?v=4","gravatar_id":"","url":"https://api.github.com/users/ejh3","html_url":"https://github.com/ejh3","followers_url":"https://api.github.com/users/ejh3/followers","following_url":"https://api.github.com/users/ejh3/following{/other_user}","gists_url":"https://api.github.com/users/ejh3/gists{/gist_id}","starred_url":"https://api.github.com/users/ejh3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ejh3/subscriptions","organizations_url":"https://api.github.com/users/ejh3/orgs","repos_url":"https://api.github.com/users/ejh3/repos","events_url":"https://api.github.com/users/ejh3/events{/privacy}","received_events_url":"https://api.github.com/users/ejh3/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721684,"node_id":"MDU6TGFiZWwzMzk3MjE2ODQ=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":"A feature or bug that is unlikely to be implemented or fixed."},{"id":449399236,"node_id":"MDU6TGFiZWw0NDkzOTkyMzY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/doc","name":"doc","color":"fbca04","default":false,"description":"An issue with or an improvement to documentation."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-08-21T22:14:21Z","updated_at":"2025-09-23T00:24:54Z","closed_at":"2025-09-23T00:24:54Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Please tick this box to confirm you have reviewed the above.\n\n- [x] I have a different issue.\n\n### What version of ripgrep are you using?\n```\nripgrep 14.1.1\n\nfeatures:+pcre2\nsimd(compile):+SSE2,+SSSE3,-AVX2\nsimd(runtime):+SSE2,+SSSE3,+AVX2\n\nPCRE2 10.43 is available (JIT is available)\n```\n### How did you install ripgrep?\n\n```\n> rpm -qf $(which rg) 2>/dev/null\nripgrep-14.1.1-1.el9.x86_64\n```\n\n### What operating system are you using ripgrep on?\n\n```\n> uname -a\nLinux PLACEHOLDER 5.10.228-41577284.AroraKernel510.el7.x86_64 #1 SMP Tue Apr 15 16:42:53 PDT 2025 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n### Describe your bug.\n\nWhen a file contains a match before a NUL byte but also contains a NUL later, `rg -l` correctly lists the file, but `rg -c` omits it entirely. This is inconsistent: `-c` should report the same set of files as `-l` or ripgrep with no options, even if binary-file detection stops the scan early. Using `-ca` (treat as text) gives the expected results.\n\n### What are the steps to reproduce the behavior?\n\n```\nejhunter /tmp/rgBug > { echo \"cat here\"; yes \"padding line\" | head -n 150000; printf '\\0'; } > file1.txt\nejhunter /tmp/rgBug > echo \"cat here\" > file2.txt\n\nejhunter /tmp/rgBug > rg 'cat' -l --no-config\nfile2.txt\nfile1.txt\n\nejhunter /tmp/rgBug > rg 'cat' -c --no-config\nfile2.txt:1\n\nejhunter /tmp/rgBug > rg 'cat' --no-config\nfile2.txt\n1:cat here\n\nfile1.txt\n1:cat here\nfile1.txt: WARNING: stopped searching binary file after match (found \"\\0\" byte around offset 1950009)\n\nejhunter /tmp/rgBug > rg 'cat' -ca --no-config\nfile2.txt:1\nfile1.txt:1\n```\n\n### What is the actual behavior?\n\n```\nejhunter /tmp/rgBug > rg 'cat' -c --no-config --debug\nrg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:89: not reading config files because --no-config is present\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1083: number of paths given to search: 0\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1108: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Search(Count))\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1118: heuristic chose to search ./\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1269: found hostname for hyperlink configuration: REDACTED\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1279: hyperlink format: \"\"\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 12 thread(s)\nrg: DEBUG|grep_regex::config|/usr/share/cargo/registry/grep-regex-0.1.13/src/config.rs:175: assembling HIR from 1 fixed string literals\nrg: DEBUG|globset|/usr/share/cargo/registry/globset-0.4.15/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\nfile2.txt:1\nrg: DEBUG|grep_printer::summary|/usr/share/cargo/registry/grep-printer-0.2.2/src/summary.rs:698: ignoring file1.txt: found binary data at offset 1950009\nejhunter /tmp/rgBug > rg 'cat' -l --no-config --debug\nrg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:89: not reading config files because --no-config is present\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1083: number of paths given to search: 0\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1108: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Search(FilesWithMatches))\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1118: heuristic chose to search ./\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1269: found hostname for hyperlink configuration: REDACTED\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1279: hyperlink format: \"\"\nrg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 12 thread(s)\nrg: DEBUG|grep_regex::config|/usr/share/cargo/registry/grep-regex-0.1.13/src/config.rs:175: assembling HIR from 1 fixed string literals\nrg: DEBUG|globset|/usr/share/cargo/registry/globset-0.4.15/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\nfile2.txt\nfile1.txt\n```\n\n### What is the expected behavior?\n\nThe `--count` option should behave the same as having no options wrt how many matches it finds. If there's only 1 match found before early termination, `rg -c` should return that. Whether it spit out a warning or not, I don't have a strong opinion on.","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/3131/timeline","performed_via_github_app":null,"state_reason":"completed"}