{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/1335","id":474891750,"node_id":"MDU6SXNzdWU0NzQ4OTE3NTA=","number":1335,"title":"ripgrep much slower than (rip)grep","user":{"login":"zsugabubus","id":30056345,"node_id":"MDQ6VXNlcjMwMDU2MzQ1","avatar_url":"https://avatars.githubusercontent.com/u/30056345?v=4","gravatar_id":"","url":"https://api.github.com/users/zsugabubus","html_url":"https://github.com/zsugabubus","followers_url":"https://api.github.com/users/zsugabubus/followers","following_url":"https://api.github.com/users/zsugabubus/following{/other_user}","gists_url":"https://api.github.com/users/zsugabubus/gists{/gist_id}","starred_url":"https://api.github.com/users/zsugabubus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsugabubus/subscriptions","organizations_url":"https://api.github.com/users/zsugabubus/orgs","repos_url":"https://api.github.com/users/zsugabubus/repos","events_url":"https://api.github.com/users/zsugabubus/events{/privacy}","received_events_url":"https://api.github.com/users/zsugabubus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721683,"node_id":"MDU6TGFiZWwzMzk3MjE2ODM=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/question","name":"question","color":"cc317c","default":true,"description":"An issue that is lacking clarity on one or more points."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":38,"created_at":"2019-07-31T01:28:31Z","updated_at":"2020-09-13T12:52:16Z","closed_at":"2019-08-02T11:36:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What version of ripgrep are you using?\r\n\r\nripgrep 11.0.1\r\n-SIMD -AVX (compiled)\r\n+SIMD -AVX (runtime)\r\n\r\n#### How did you install ripgrep?\r\n\r\npacman -S ripgrep\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nArch Linux\r\n\r\n#### Describe your question, feature request, or bug.\r\n\r\nripgrep is 3-4-5 times slower than GNU grep on simple string pattern.\r\n\r\n#### If this is a bug, what is the actual behavior?\r\n\r\n```\r\ngrep file\\.php -r .  0.19s user 0.10s system 98% cpu 0.298 total\r\nrg (--no-ignore) file\\.php  3.68s user 0.45s system 365% cpu 1.129 total\r\nrg --debug --hidden --no-ignore file\\.php  6.12s user 0.42s system 383% cpu 1.706 total\r\nDEBUG|grep_regex::literal|grep-regex/src/literal.rs:115: required literal found: \"file\"\r\nDEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\n```\r\n\r\nAs I tried to find _one-by-one_ what top-level file (or directory) causes the slowdown, I came to the conclusion: none. Ripgrep should be faster... So I did this table:\r\n(Sorry, for hiding the names, I'm not sure if I'm allowed to show them.)\r\n```\r\n#!/bin/sh\r\n$ echo GREPWHAT=$GREPWHAT RGFLAGS=$RGFLAGS GREPFLAGS=$GREPFLAGS; find -maxdepth 1 | xargs -I{} sh -c 'echo $(echo {} | tr a-z x):$(du -sh {} | cut -f1):$(find {} | wc -l):$( ( time rg \"$GREPWHAT\" $RGFLAGS {} &>/dev/null ) 2>&1 | tr \\\\t\\\\n \\  ):$( ( time find -mindepth 1 -maxdepth 1 -not -path {} | xargs rg \"$GREPWHAT\" $RGFLAGS  &>/dev/null ) 2>&1 | tr \\\\t\\\\n \\  ):$( ( time grep \"$GREPWHAT\" $GREPFLAGS -r {} &>/dev/null ) 2>&1 | tr \\\\t\\\\n \\ ):$( ( time find -mindepth 1 -maxdepth 1 -not -path {} | xargs grep \"$GREPWHAT\" $GREPFLAGS -r &>/dev/null ) 2>&1 | tr \\\\t\\\\n \\  )' | column -ts: -Rsize,files,rgtime,rgwothistime,greptime,grepwothistime -Nname,size,files,rgtime,rgwothistime,greptime,grepwothistime\r\n\r\nGREPWHAT=xxxxxxxxxxxxxxxxxxx.xxx RGFLAGS=-j1 GREPFLAGS=\r\nname                  size  files                                      rgtime                                rgwothistime                                    greptime                             grepwothistime\r\n.                     127M  12961   real 0m0.964s user 0m3.295s sys 0m0.348s    real 0m0.971s user 0m3.285s sys 0m0.388s    real 0m0.146s user 0m0.039s sys 0m0.100s    real 0m0.148s user 0m0.069s sys 0m0.078s\r\n./xx                  4.0K      1   real 0m0.009s user 0m0.006s sys 0m0.003s    real 0m0.919s user 0m3.097s sys 0m0.406s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.146s user 0m0.055s sys 0m0.089s\r\n./_xxx_xxxxxx.xxx     428K      1   real 0m0.011s user 0m0.008s sys 0m0.004s    real 0m0.936s user 0m3.123s sys 0m0.388s    real 0m0.004s user 0m0.004s sys 0m0.000s    real 0m0.144s user 0m0.043s sys 0m0.100s\r\n./xxxxxx               89M  11741   real 0m0.217s user 0m0.576s sys 0m0.211s    real 0m0.221s user 0m0.688s sys 0m0.109s    real 0m0.106s user 0m0.036s sys 0m0.064s    real 0m0.051s user 0m0.023s sys 0m0.029s\r\n./xxxxx                16K      7   real 0m0.010s user 0m0.009s sys 0m0.004s    real 0m0.942s user 0m3.101s sys 0m0.418s    real 0m0.003s user 0m0.003s sys 0m0.000s    real 0m0.147s user 0m0.049s sys 0m0.098s\r\n./xxxxxxx              52K     28   real 0m0.014s user 0m0.015s sys 0m0.004s    real 0m0.946s user 0m3.148s sys 0m0.418s    real 0m0.003s user 0m0.003s sys 0m0.000s    real 0m0.152s user 0m0.048s sys 0m0.099s\r\n./xxxxxx.xxx          4.0K      1   real 0m0.008s user 0m0.006s sys 0m0.003s    real 0m0.929s user 0m3.113s sys 0m0.400s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.143s user 0m0.051s sys 0m0.091s\r\n./xxxxxx               20K      5   real 0m0.012s user 0m0.015s sys 0m0.000s    real 0m0.926s user 0m3.114s sys 0m0.421s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.144s user 0m0.038s sys 0m0.105s\r\n./xxxxxxxxx           248K     60   real 0m0.013s user 0m0.015s sys 0m0.005s    real 0m0.939s user 0m3.139s sys 0m0.384s    real 0m0.004s user 0m0.000s sys 0m0.004s    real 0m0.151s user 0m0.056s sys 0m0.095s\r\n./xxxxxx.xx           4.0K      1   real 0m0.006s user 0m0.000s sys 0m0.006s    real 0m0.937s user 0m3.176s sys 0m0.413s    real 0m0.004s user 0m0.004s sys 0m0.000s    real 0m0.145s user 0m0.055s sys 0m0.089s\r\n./xxxxxx               35M    522   real 0m0.068s user 0m0.138s sys 0m0.077s    real 0m0.227s user 0m0.639s sys 0m0.211s    real 0m0.036s user 0m0.025s sys 0m0.011s    real 0m0.114s user 0m0.031s sys 0m0.082s\r\n./xxxx.xxx            4.0K      1   real 0m0.006s user 0m0.006s sys 0m0.001s    real 0m0.933s user 0m3.123s sys 0m0.408s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.150s user 0m0.045s sys 0m0.104s\r\n./xxxxxxx.xxx         4.0K      1   real 0m0.007s user 0m0.001s sys 0m0.006s    real 0m0.941s user 0m3.139s sys 0m0.409s    real 0m0.003s user 0m0.003s sys 0m0.000s    real 0m0.145s user 0m0.072s sys 0m0.072s\r\n./xxxxx.xxx           4.0K      1   real 0m0.008s user 0m0.004s sys 0m0.004s    real 0m0.957s user 0m3.127s sys 0m0.419s    real 0m0.004s user 0m0.004s sys 0m0.000s    real 0m0.154s user 0m0.048s sys 0m0.101s\r\n./xxxxxxxx            276K     52   real 0m0.013s user 0m0.016s sys 0m0.000s    real 0m1.037s user 0m2.956s sys 0m0.385s    real 0m0.004s user 0m0.004s sys 0m0.000s    real 0m0.147s user 0m0.036s sys 0m0.109s\r\n./xxxxxx              128K     34   real 0m0.012s user 0m0.010s sys 0m0.005s    real 0m0.934s user 0m3.142s sys 0m0.398s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.146s user 0m0.062s sys 0m0.083s\r\n./xxxxxxxx.xxxx       212K      1   real 0m0.009s user 0m0.005s sys 0m0.004s    real 0m0.924s user 0m3.123s sys 0m0.362s    real 0m0.004s user 0m0.000s sys 0m0.003s    real 0m0.147s user 0m0.063s sys 0m0.083s\r\n./xxxxxxxx.xxxx       4.0K      1   real 0m0.008s user 0m0.003s sys 0m0.005s    real 0m0.928s user 0m3.067s sys 0m0.422s    real 0m0.004s user 0m0.004s sys 0m0.000s    real 0m0.151s user 0m0.057s sys 0m0.088s\r\n./xxxxxx              1.2M    294   real 0m0.018s user 0m0.027s sys 0m0.008s    real 0m0.852s user 0m2.761s sys 0m0.476s    real 0m0.007s user 0m0.000s sys 0m0.007s    real 0m0.141s user 0m0.033s sys 0m0.108s\r\n./xxxxxxxxx            12K      5   real 0m0.012s user 0m0.016s sys 0m0.000s    real 0m0.987s user 0m2.797s sys 0m0.365s    real 0m0.003s user 0m0.000s sys 0m0.003s    real 0m0.148s user 0m0.038s sys 0m0.109s\r\n./xxxxxxx             4.0K      1   real 0m0.005s user 0m0.000s sys 0m0.005s    real 0m1.074s user 0m2.989s sys 0m0.386s    real 0m0.005s user 0m0.004s sys 0m0.000s    real 0m0.143s user 0m0.057s sys 0m0.085s\r\n./xxx                 764K    198   real 0m0.014s user 0m0.011s sys 0m0.012s    real 0m0.970s user 0m2.792s sys 0m0.481s    real 0m0.005s user 0m0.005s sys 0m0.000s    real 0m0.201s user 0m0.065s sys 0m0.133s\r\n./.xxxxxxxx.xxxx.xxx   44K      1   real 0m0.007s user 0m0.003s sys 0m0.003s    real 0m1.393s user 0m2.965s sys 0m0.569s    real 0m0.004s user 0m0.000s sys 0m0.003s    real 0m0.205s user 0m0.079s sys 0m0.119s\r\n./.xxxxxxxxx          4.0K      1   real 0m0.007s user 0m0.001s sys 0m0.006s    real 0m1.140s user 0m2.975s sys 0m0.556s    real 0m0.004s user 0m0.000s sys 0m0.004s    real 0m0.156s user 0m0.051s sys 0m0.099s\r\n./.xxxxxxxxxxxxx      4.0K      1   real 0m0.006s user 0m0.003s sys 0m0.003s    real 0m0.954s user 0m3.055s sys 0m0.484s    real 0m0.003s user 0m0.003s sys 0m0.000s    real 0m0.149s user 0m0.070s sys 0m0.078s\r\n./.xxx.xxxxxxx        4.0K      1   real 0m0.007s user 0m0.004s sys 0m0.003s    real 0m0.956s user 0m3.130s sys 0m0.402s    real 0m0.003s user 0m0.003s sys 0m0.000s    real 0m0.149s user 0m0.068s sys 0m0.076s\r\n$ # Note that the sum of ripgrep times doesn't match with . time.\r\n$ # wothis means: grepping in the directory with that file excluded.\r\n$ time tokei\r\n-------------------------------------------------------------------------------\r\n Language            Files        Lines         Code     Comments       Blanks\r\n-------------------------------------------------------------------------------\r\n...\r\n-------------------------------------------------------------------------------\r\n Total                9256      1221713       827992       262436       131285\r\n-------------------------------------------------------------------------------\r\n\r\nreal    0m1.061s\r\nuser    0m3.384s\r\nsys     0m0.295s\r\n$ # Note that tokei has similar running time.\r\n$ stat -f . | head -3\r\n  File: \".\"\r\n    ID: 0        Namelen: 255     Type: tmpfs\r\nBlock size: 4096       Fundamental block size: 4096\r\n$ # Fast as hell tmpfs. Does it count?\r\n```\r\n\r\nTomorrow I will make a line length statistics if it counts, but I think it should be an issue around directory listing. Anyway, I would like to help, so tell me what to do/share. `--debug` didn't help too much. ","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1335/timeline","performed_via_github_app":null,"state_reason":"completed"}