[{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612681850","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-612681850","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":612681850,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjY4MTg1MA==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-12T21:55:05Z","updated_at":"2020-04-12T21:55:05Z","body":"Using a regex instead of a simple pattern doesn't seem to make a difference - this one behaves identically: `rg --iglob '*.rs' -U \"enum[^\\\\n]+\\\\{\\\\n[^\\\\n]+\\\\n\\\\}\"`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612681850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612682746","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-612682746","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":612682746,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjY4Mjc0Ng==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-12T22:02:25Z","updated_at":"2020-04-12T22:02:25Z","body":"Downloading all of crates.io takes 50Gb of disk space, and latest version of every crate uncompressed is 18Gb. If you don't want to download that, point me to a memory profiler and I can run it myself now that I have the corpus locally.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612682746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612683699","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-612683699","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":612683699,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjY4MzY5OQ==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-12T22:10:44Z","updated_at":"2020-04-12T22:12:58Z","body":"I've actually been meaning to download all crates, since it makes for a nice test corpus. So I will investigate this. Thank you for making it easy.\r\n\r\nWithout investigating, I'm pretty sure I know the culprit. If I'm right, then it's less of a leak and more of a conscious trade off. Namely, ripgrep must buffer enough room to store at least one line contiguously in memory. If you run across a very long line, then the buffer expands to that capacity. But it will never shrink itself. ripgrep uses one of these buffers per thread. So if each buffer has to expand to a large size, then they never contract. While contracting won't reduce per-thread peak memory usage, it could reduce the overall process peak memory usage in most cases.\r\n\r\nWith that said, there is no particular reason why the behavior must be this way. It's just that I've never had a good test case for it. Some kind of contraction is probably wise. Although whether contraction actually results in memory being freed back to the OS is perhaps a separate issue that I suspect is mostly out of the control of ripgrep.\r\n\r\nBut yeah, I'll do some investigation to confirm my hypothesis. Thanks for the report!","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/612683699/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3225502366,"node_id":"MDEyOkxhYmVsZWRFdmVudDMyMjU1MDIzNjY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3225502366","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-04-12T22:10:53Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":3225502367,"node_id":"MDEyOkxhYmVsZWRFdmVudDMyMjU1MDIzNjc=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3225502367","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-04-12T22:10:53Z","label":{"name":"question","color":"cc317c"},"performed_via_github_app":null},{"actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-17T11:14:42Z","updated_at":"2020-04-17T11:14:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/1553","id":601867509,"node_id":"MDU6SXNzdWU2MDE4Njc1MDk=","number":1553,"title":"rg takes up all memory (>10GB)","user":{"login":"albertz","id":59132,"node_id":"MDQ6VXNlcjU5MTMy","avatar_url":"https://avatars.githubusercontent.com/u/59132?v=4","gravatar_id":"","url":"https://api.github.com/users/albertz","html_url":"https://github.com/albertz","followers_url":"https://api.github.com/users/albertz/followers","following_url":"https://api.github.com/users/albertz/following{/other_user}","gists_url":"https://api.github.com/users/albertz/gists{/gist_id}","starred_url":"https://api.github.com/users/albertz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertz/subscriptions","organizations_url":"https://api.github.com/users/albertz/orgs","repos_url":"https://api.github.com/users/albertz/repos","events_url":"https://api.github.com/users/albertz/events{/privacy}","received_events_url":"https://api.github.com/users/albertz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721679,"node_id":"MDU6TGFiZWwzMzk3MjE2Nzk=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/duplicate","name":"duplicate","color":"cccccc","default":true,"description":"An issue that is duplicative of another."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-04-17T10:22:16Z","updated_at":"2020-04-18T17:05:11Z","closed_at":"2020-04-17T11:14:42Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":53631945,"node_id":"MDEwOlJlcG9zaXRvcnk1MzYzMTk0NQ==","name":"ripgrep","full_name":"BurntSushi/ripgrep","private":false,"owner":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/BurntSushi/ripgrep","description":"ripgrep recursively searches directories for a regex pattern while respecting your gitignore","fork":false,"url":"https://api.github.com/repos/BurntSushi/ripgrep","forks_url":"https://api.github.com/repos/BurntSushi/ripgrep/forks","keys_url":"https://api.github.com/repos/BurntSushi/ripgrep/keys{/key_id}","collaborators_url":"https://api.github.com/repos/BurntSushi/ripgrep/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/BurntSushi/ripgrep/teams","hooks_url":"https://api.github.com/repos/BurntSushi/ripgrep/hooks","issue_events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events{/number}","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/events","assignees_url":"https://api.github.com/repos/BurntSushi/ripgrep/assignees{/user}","branches_url":"https://api.github.com/repos/BurntSushi/ripgrep/branches{/branch}","tags_url":"https://api.github.com/repos/BurntSushi/ripgrep/tags","blobs_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/refs{/sha}","trees_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/trees{/sha}","statuses_url":"https://api.github.com/repos/BurntSushi/ripgrep/statuses/{sha}","languages_url":"https://api.github.com/repos/BurntSushi/ripgrep/languages","stargazers_url":"https://api.github.com/repos/BurntSushi/ripgrep/stargazers","contributors_url":"https://api.github.com/repos/BurntSushi/ripgrep/contributors","subscribers_url":"https://api.github.com/repos/BurntSushi/ripgrep/subscribers","subscription_url":"https://api.github.com/repos/BurntSushi/ripgrep/subscription","commits_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits{/sha}","git_commits_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/commits{/sha}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/comments{/number}","issue_comment_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments{/number}","contents_url":"https://api.github.com/repos/BurntSushi/ripgrep/contents/{+path}","compare_url":"https://api.github.com/repos/BurntSushi/ripgrep/compare/{base}...{head}","merges_url":"https://api.github.com/repos/BurntSushi/ripgrep/merges","archive_url":"https://api.github.com/repos/BurntSushi/ripgrep/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/BurntSushi/ripgrep/downloads","issues_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues{/number}","pulls_url":"https://api.github.com/repos/BurntSushi/ripgrep/pulls{/number}","milestones_url":"https://api.github.com/repos/BurntSushi/ripgrep/milestones{/number}","notifications_url":"https://api.github.com/repos/BurntSushi/ripgrep/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/labels{/name}","releases_url":"https://api.github.com/repos/BurntSushi/ripgrep/releases{/id}","deployments_url":"https://api.github.com/repos/BurntSushi/ripgrep/deployments","created_at":"2016-03-11T02:02:33Z","updated_at":"2025-11-09T23:50:59Z","pushed_at":"2025-10-30T17:30:23Z","git_url":"git://github.com/BurntSushi/ripgrep.git","ssh_url":"git@github.com:BurntSushi/ripgrep.git","clone_url":"https://github.com/BurntSushi/ripgrep.git","svn_url":"https://github.com/BurntSushi/ripgrep","homepage":"","size":5534,"stargazers_count":57154,"watchers_count":57154,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2304,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":88,"license":{"key":"unlicense","name":"The Unlicense","spdx_id":"Unlicense","url":"https://api.github.com/licenses/unlicense","node_id":"MDc6TGljZW5zZTE1"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cli","command-line","command-line-tool","gitignore","grep","recursively-search","regex","ripgrep","rust","search"],"visibility":"public","forks":2304,"open_issues":88,"watchers":57154,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### What version of ripgrep are you using?\r\n\r\nripgrep 11.0.1 (rev 973de50c9e)\r\n-SIMD -AVX (compiled)\r\n+SIMD -AVX (runtime)\r\n\r\n#### How did you install ripgrep?\r\n\r\nVia VSCode, Version: 1.44.0\r\nCommit: 2aae1f26c72891c399f860409176fe435a154b13\r\nDate: 2020-04-08T08:23:56.137Z\r\nElectron: 7.1.11\r\nChrome: 78.0.3904.130\r\nNode.js: 12.8.1\r\nV8: 7.8.279.23-electron.0\r\nOS: Darwin x64 17.7.0\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nLinux (via the VSCode SSH extension, where VSCode itself runs on Mac).\r\n\r\n#### Describe your bug.\r\n\r\nThe `rg` process takes a lot of memory (>10GB) when searching through a very big directory (several 100GB, also slow NFS, also having a couple of symlinks, which also might be circular).\r\nIn the extreme case, it crashes the whole system.\r\n\r\n#### What are the steps to reproduce the behavior?\r\n\r\nHave a very big directory (several 100GB, also slow NFS, also having a couple of symlinks, which also might be circular).\r\n\r\nVSCode ([via](https://github.com/microsoft/vscode-ripgrep/issues/11), [via](https://github.com/microsoft/vscode/issues/95201), [via](https://github.com/microsoft/vscode-python/issues/11173)) starts it like this:\r\n`rg --files --hidden --case-sensitive -g **/*.ipynb -g !**/.git -g !**/.svn -g !**/.hg -g !**/CVS -g !**/.DS_Store -g !**/__pycache__ -g !**/*.pyc --no-ignore --follow --no-config --no-ignore-global`\r\n\r\n#### What is the actual behavior?\r\n\r\nIt starts the search. However, I can see that the memory just increases, and the process never manages to finish.\r\n\r\n\r\nSee `ps axu` on the Linux SSH server, and search for the `rg` process by VSCode:\r\n```\r\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\nzeyer    14685  117 53.7 8244360 8231756 ?     Sl   11:12  13:09 /u/zeyer/.vscode-server/bin/0ba0ca52957102ca3527cf479571617f0de6ed50/node_modules/vscode-ripgrep/bin/rg --files --hidden --case-sensitive -g **/*.ipynb -g !**/.git -g !**/.svn -g !**/.hg -g !**/CVS -g !**/.DS_Store -g !**/__pycache__ -g !**/*.pyc --no-ignore --follow --no-config --no-ignore-global\r\nzeyer    20113 87.3 12.8 1978088 1965448 ?     Sl   11:30   4:42 /u/zeyer/.vscode-server/bin/2aae1f26c72891c399f860409176fe435a154b13/node_modules/vscode-ripgrep/bin/rg --files --hidden --case-sensitive -g **/*.ipynb -g !**/.git -g !**/.svn -g !**/.hg -g !**/CVS -g !**/.DS_Store -g !**/__pycache__ -g !**/*.pyc --no-ignore --follow --no-config --no-ignore-global\r\n```\r\nThe `cwd` of that process is a VSCode setup, which is the very big project directory. Many of the files are behind some symlinks, but I partly want to follow symlinks. (I'm not sure how to selectively disable to not follow some of the symlinks.)\r\n\r\nI think the issue is that the directory is just very big.\r\n\r\nI happened already multiple times that the Linux server became unresponsive because all memory was occupied, and luckily the Linux OOM killer killed `rg` and the system recovered a while later. This is what I see in `dmesg -T`:\r\n\r\n```\r\n[Tue Apr 14 11:14:15 2020] [ pid ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name\r\n...\r\n[Tue Apr 14 11:14:15 2020] [27303]  2574 27303  2550868  2546981 20484096        0             0 rg\r\n...\r\n[Tue Apr 14 11:14:15 2020] Out of memory: Kill process 27303 (rg) score 528 or sacrifice child\r\n[Tue Apr 14 11:14:15 2020] Killed process 27303 (rg) total-vm:10203472kB, anon-rss:10187924kB, file-rss:0kB, shmem-rss:0kB\r\n[Tue Apr 14 11:14:15 2020] oom_reaper: reaped process 27303 (rg), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB\r\n```\r\n\r\n#### What is the expected behavior?\r\n\r\nIt should never happen (crashing my whole system because OOM), even if the user opens a immensely huge directory (or let's say an infinite big virtual FUSE directory).\r\n","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1553/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":3246358097,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50MzI0NjM1ODA5Nw==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3246358097","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2020-04-18T00:30:44Z","label":{"name":"question","color":"cc317c"},"performed_via_github_app":null},{"id":3246358475,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzI0NjM1ODQ3NQ==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3246358475","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2020-04-18T00:31:02Z","rename":{"from":"Memory leak when searching all of crates.io","to":"high peak memory usage with parallel breadth first directory traversal"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615522680","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-615522680","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":615522680,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTUyMjY4MA==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-18T00:38:15Z","updated_at":"2020-04-18T00:39:23Z","body":"OK, I did some experimenting and my guess was wrong.\r\n\r\nIt turns out that this is a result of how ripgrep implements parallel directory traversal. Namely, since it uses a queue to communicate new work among threads, this results in a breadth first traversal. In this case, the initial directory is extremely wide, because it contains the latest version of every crate. Upon entering each directory, a matcher for processing gitignore rules is created. Since this is breadth first, a gitignore matcher is created for _every directory_ before ripgrep ever starts to process a single file. This is primarily what contributes to a large peak memory usage. You can test this hypothesis by searching without parallelism (with `-j1`) or by disabling gitignore exclusions (with `-u/--no-ignore`). Both result in very small peak memory usage.\r\n\r\nFixing this is unfortunately not quite so easy. @bmalehorn was actually barking up the right tree a few years ago, and even submitted a PR to switch the traversal to depth first in #450. But the upsides didn't seem so apparent to me then, and it appeared to change the output order a bit too much for my taste. But with this example in front of me, it seems clearer that switching to a depth first traversal is better than what we have today.\r\n\r\nSince then though, Crossbeam seems to no longer provide a thread safe stack. One can be [implemented without much code](https://github.com/crossbeam-rs/crossbeam/blob/e3020305ffa5e32917c0122e24578a486e34cfbd/crossbeam-epoch/examples/treiber_stack.rs), but I'm hesitant to add `unsafe`, especially when it's in an area of data structures that are outside my area of expertise.\r\n\r\nSo I think this bug is blocked on either rethinking how traversal works (I've always wanted to use rayon) or switching to using a depth first traversal with minimal risk from `unsafe`.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615522680/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3246366660,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzI0NjM2NjY2MA==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3246366660","actor":{"login":"bmalehorn","id":3344958,"node_id":"MDQ6VXNlcjMzNDQ5NTg=","avatar_url":"https://avatars.githubusercontent.com/u/3344958?v=4","gravatar_id":"","url":"https://api.github.com/users/bmalehorn","html_url":"https://github.com/bmalehorn","followers_url":"https://api.github.com/users/bmalehorn/followers","following_url":"https://api.github.com/users/bmalehorn/following{/other_user}","gists_url":"https://api.github.com/users/bmalehorn/gists{/gist_id}","starred_url":"https://api.github.com/users/bmalehorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmalehorn/subscriptions","organizations_url":"https://api.github.com/users/bmalehorn/orgs","repos_url":"https://api.github.com/users/bmalehorn/repos","events_url":"https://api.github.com/users/bmalehorn/events{/privacy}","received_events_url":"https://api.github.com/users/bmalehorn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-04-18T00:38:16Z","performed_via_github_app":null},{"id":3246366663,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDMyNDYzNjY2NjM=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3246366663","actor":{"login":"bmalehorn","id":3344958,"node_id":"MDQ6VXNlcjMzNDQ5NTg=","avatar_url":"https://avatars.githubusercontent.com/u/3344958?v=4","gravatar_id":"","url":"https://api.github.com/users/bmalehorn","html_url":"https://github.com/bmalehorn","followers_url":"https://api.github.com/users/bmalehorn/followers","following_url":"https://api.github.com/users/bmalehorn/following{/other_user}","gists_url":"https://api.github.com/users/bmalehorn/gists{/gist_id}","starred_url":"https://api.github.com/users/bmalehorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmalehorn/subscriptions","organizations_url":"https://api.github.com/users/bmalehorn/orgs","repos_url":"https://api.github.com/users/bmalehorn/repos","events_url":"https://api.github.com/users/bmalehorn/events{/privacy}","received_events_url":"https://api.github.com/users/bmalehorn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-04-18T00:38:16Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615535741","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-615535741","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":615535741,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTUzNTc0MQ==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-18T01:42:44Z","updated_at":"2020-04-18T01:42:44Z","body":"I've consulted my friendly neighbourhood good of concurrency, Acrimon, and their recommendation for a concurrent stack was `Mutex<Vec>` because a Trieber stack is not meaningfully faster than that. Faster concurrent stack implementations are possible, but \"no one is really insane enough to do this stuff\".\r\n\r\nListing all files up front before creating the gitignore handlers would solve this, but also create a different kind of scalability limit with all the file paths being loaded in memory at once, and I'm not sure how that interacts with filesystem cache behavior.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615535741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615537337","html_url":"https://github.com/BurntSushi/ripgrep/issues/1550#issuecomment-615537337","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1550","id":615537337,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTUzNzMzNw==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-18T01:54:58Z","updated_at":"2020-04-18T01:54:58Z","body":"A `Mutex<Vec<Work>>` is indeed worth trying and shouldn't be too hard to do so. It is plausible that we won't be able to observe a performance difference.\r\n\r\nListing all files up front is another way of looking at, but is a major architectural change and it is difficult for me to reason about its performance characteristics.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/615537337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3247730626,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMyNDc3MzA2MjY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3247730626","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b1c2964c6137192198ddc73e030511b660764f0f","commit_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits/b1c2964c6137192198ddc73e030511b660764f0f","created_at":"2020-04-18T15:21:08Z","performed_via_github_app":null},{"actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-04-18T15:21:36Z","updated_at":"2020-04-18T15:21:36Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554/events","html_url":"https://github.com/BurntSushi/ripgrep/pull/1554","id":602484521,"node_id":"MDExOlB1bGxSZXF1ZXN0NDA1NTE0Njc2","number":1554,"title":"crates/ignore: switch to depth first traversal","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-04-18T15:21:36Z","updated_at":"2020-07-06T07:45:24Z","closed_at":"2020-04-18T15:33:04Z","author_association":"OWNER","active_lock_reason":null,"draft":false,"repository":{"id":53631945,"node_id":"MDEwOlJlcG9zaXRvcnk1MzYzMTk0NQ==","name":"ripgrep","full_name":"BurntSushi/ripgrep","private":false,"owner":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/BurntSushi/ripgrep","description":"ripgrep recursively searches directories for a regex pattern while respecting your gitignore","fork":false,"url":"https://api.github.com/repos/BurntSushi/ripgrep","forks_url":"https://api.github.com/repos/BurntSushi/ripgrep/forks","keys_url":"https://api.github.com/repos/BurntSushi/ripgrep/keys{/key_id}","collaborators_url":"https://api.github.com/repos/BurntSushi/ripgrep/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/BurntSushi/ripgrep/teams","hooks_url":"https://api.github.com/repos/BurntSushi/ripgrep/hooks","issue_events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events{/number}","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/events","assignees_url":"https://api.github.com/repos/BurntSushi/ripgrep/assignees{/user}","branches_url":"https://api.github.com/repos/BurntSushi/ripgrep/branches{/branch}","tags_url":"https://api.github.com/repos/BurntSushi/ripgrep/tags","blobs_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/refs{/sha}","trees_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/trees{/sha}","statuses_url":"https://api.github.com/repos/BurntSushi/ripgrep/statuses/{sha}","languages_url":"https://api.github.com/repos/BurntSushi/ripgrep/languages","stargazers_url":"https://api.github.com/repos/BurntSushi/ripgrep/stargazers","contributors_url":"https://api.github.com/repos/BurntSushi/ripgrep/contributors","subscribers_url":"https://api.github.com/repos/BurntSushi/ripgrep/subscribers","subscription_url":"https://api.github.com/repos/BurntSushi/ripgrep/subscription","commits_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits{/sha}","git_commits_url":"https://api.github.com/repos/BurntSushi/ripgrep/git/commits{/sha}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/comments{/number}","issue_comment_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments{/number}","contents_url":"https://api.github.com/repos/BurntSushi/ripgrep/contents/{+path}","compare_url":"https://api.github.com/repos/BurntSushi/ripgrep/compare/{base}...{head}","merges_url":"https://api.github.com/repos/BurntSushi/ripgrep/merges","archive_url":"https://api.github.com/repos/BurntSushi/ripgrep/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/BurntSushi/ripgrep/downloads","issues_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues{/number}","pulls_url":"https://api.github.com/repos/BurntSushi/ripgrep/pulls{/number}","milestones_url":"https://api.github.com/repos/BurntSushi/ripgrep/milestones{/number}","notifications_url":"https://api.github.com/repos/BurntSushi/ripgrep/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/labels{/name}","releases_url":"https://api.github.com/repos/BurntSushi/ripgrep/releases{/id}","deployments_url":"https://api.github.com/repos/BurntSushi/ripgrep/deployments","created_at":"2016-03-11T02:02:33Z","updated_at":"2025-11-09T23:50:59Z","pushed_at":"2025-10-30T17:30:23Z","git_url":"git://github.com/BurntSushi/ripgrep.git","ssh_url":"git@github.com:BurntSushi/ripgrep.git","clone_url":"https://github.com/BurntSushi/ripgrep.git","svn_url":"https://github.com/BurntSushi/ripgrep","homepage":"","size":5534,"stargazers_count":57154,"watchers_count":57154,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2304,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":88,"license":{"key":"unlicense","name":"The Unlicense","spdx_id":"Unlicense","url":"https://api.github.com/licenses/unlicense","node_id":"MDc6TGljZW5zZTE1"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cli","command-line","command-line-tool","gitignore","grep","recursively-search","regex","ripgrep","rust","search"],"visibility":"public","forks":2304,"open_issues":88,"watchers":57154,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/pulls/1554","html_url":"https://github.com/BurntSushi/ripgrep/pull/1554","diff_url":"https://github.com/BurntSushi/ripgrep/pull/1554.diff","patch_url":"https://github.com/BurntSushi/ripgrep/pull/1554.patch","merged_at":"2020-04-18T15:33:04Z"},"body":"This replaces the use of channels in the parallel directory traversal\r\nwith a simple stack. The primary motivation for this change is to reduce\r\npeak memory usage. In particular, when using a channel (which is a\r\nqueue), we wind up visiting files in a breadth first fashion. Using a\r\nstack switches us to a depth first traversal. While there are no real\r\nintrinsic differences, depth first traversal generally tends to use less\r\nmemory because directory trees are more commonly wide than they are\r\ndeep.\r\n\r\nIn particular, the queue/stack size itself is not the only concern. In\r\none recent case documented in #1550, a user wanted to search all Rust\r\ncrates. The directory structure was shallow but extremely wide, with a\r\nsingle directory containing all crates. This in turn results is in\r\ndescending into each of those directories and building a gitignore\r\nmatcher for each (since most crates have `.gitignore` files) before ever\r\nsearching a single file. This means that ripgrep has all such matchers\r\nin memory simultaneously, which winds up using quite a bit of memory.\r\n\r\nIn a depth first traversal, peak memory usage is much lower because\r\ngitignore matches are built and discarded more quickly. In the case of\r\nsearching all crates, the peak memory usage decrease is dramatic. On my\r\nsystem, it shrinks by an order magnitude, from almost 1GB to 50MB. The\r\ndecline in peak memory usage is consistent across other use cases as\r\nwell, but is typically more modest. For example, searching the Linux\r\nrepo has a 50% decrease in peak memory usage and searching the Chromium\r\nrepo has a 25% decrease in peak memory usage.\r\n\r\nSearch times generally remain unchanged, although some ad hoc benchmarks\r\nthat I typically run have gotten a bit slower. As far as I can tell,\r\nthis appears to be result of scheduling changes. Namely, the depth first\r\ntraversal seems to result in searching some very large files towards the\r\nend of the search, which reduces the effectiveness of parallelism and\r\nmakes the overall search take longer. This seems to suggest that a stack\r\nisn't optimal. It would instead perhaps be better to prioritize\r\nsearching larger files first, but it's not quite clear how to do this\r\nwithout introducing more overhead (getting the file size for each file\r\nrequires a stat call).\r\n\r\nFixes #1550 \r\n\r\ncc @bmalehorn who attempted a similar change many moons ago!","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554/reactions","total_count":4,"+1":0,"-1":0,"laugh":0,"hooray":4,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1554/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3247768306,"node_id":"MDExOkNsb3NlZEV2ZW50MzI0Nzc2ODMwNg==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3247768306","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-04-18T15:33:04Z","state_reason":null,"performed_via_github_app":null},{"id":3247768363,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMyNDc3NjgzNjM=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3247768363","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"139f186e5721e74542604fad8a3c5907c4911faa","commit_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits/139f186e5721e74542604fad8a3c5907c4911faa","created_at":"2020-04-18T15:33:06Z","performed_via_github_app":null},{"id":3318958535,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMzMTg5NTg1MzU=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/3318958535","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b56315ea8454e45425d6d2f54377f133eedd3cda","commit_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits/b56315ea8454e45425d6d2f54377f133eedd3cda","created_at":"2020-05-09T03:37:38Z","performed_via_github_app":null}]