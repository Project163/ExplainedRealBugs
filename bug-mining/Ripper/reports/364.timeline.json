[{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799796187","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799796187","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799796187,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTc5NjE4Nw==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:26:14Z","updated_at":"2021-03-15T22:26:14Z","body":"Thanks for the report!\r\n\r\nSo I'll say that off the bat, it will be difficult for me to do anything about this without a repro. It's _possible_ that the high memory usage is due to a specific file. So if that's the case, it might be possible for you to whittle this down by trying smaller and smaller subsets of your corpus and see if you can still observe high memory usage. If not, then yeah, I'd probably have to have a way to debug this myself.\r\n\r\nWhat follows is me brainstorming.\r\n\r\nMy _initial_ guess at this, ignoring your heap backtrace, would have simply been that one or more of your files has very long lines. And because of that and the constraint that a line _must_ fit contiguously in memory, ripgrep expands its internal buffers to fit it. (Since ripgrep has several of these buffers in existence due to parallelism, it's possible that there are a few files with moderately long lines, and the expansions of all those buffers adds up to increased memory usage overall.) In general, this kind of thing just cannot be avoided and is a known limitation of ripgrep. It's also a problem with GNU grep. This is why, for example, GNU grep will by default replace NUL bytes with line terminators in case it trips over a binary file with no line terminators in it. In that case, the entire file would be treated as one single line, which could be quite bad.\r\n\r\nNow, given your heap trace, I'm not sure what to think. If it is indeed related to ignores, then yeah, I would expect `--no-ignore` to fix it.\r\n\r\nSome things to try:\r\n\r\n* How does `rg -uuu` behave?\r\n* How does GNU grep behave on the same data set? What is its peak memory usage?\r\n* What happens if you pass `-a` to ripgrep? And GNU grep?","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799796187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4461356475,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ0NjEzNTY0NzU=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461356475","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-03-15T22:26:22Z","label":{"name":"question","color":"cc317c"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799796456","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799796456","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799796456,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTc5NjQ1Ng==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:26:49Z","updated_at":"2021-03-15T22:26:49Z","body":"Oh, also, I'm not sure how to use your heap profile. Is there a program I should be using to open it that gives me a nice visualization?","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799796456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799800869","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799800869","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799800869,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgwMDg2OQ==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:36:13Z","updated_at":"2021-03-15T22:36:13Z","body":"Yeah, here's the GUI that analyzes this format: https://github.com/KDE/heaptrack","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799800869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799801906","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799801906","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799801906,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgwMTkwNg==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:38:40Z","updated_at":"2021-03-15T22:38:40Z","body":"`heaptrack --analyze \"/path/to/file.gz\"` works, you don't even need to ungzip it.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799801906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799805275","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799805275","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799805275,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgwNTI3NQ==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:46:47Z","updated_at":"2021-03-15T22:46:47Z","body":"@Shnatsel Oh my goodness. That is spiffy! Love it. Do you mind sharing the command you used to create that profile?","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799805275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4461414510,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDQ2MTQxNDUxMA==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461414510","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-03-15T22:46:47Z","performed_via_github_app":null},{"id":4461414513,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ0NjE0MTQ1MTM=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461414513","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-03-15T22:46:48Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799808153","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799808153","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799808153,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgwODE1Mw==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:54:12Z","updated_at":"2021-03-15T22:54:12Z","body":"`heaptrack rg --no-ignore AddressSanitizer`, it's that simple. By the way, it also shows a ton of short-lived allocations somewhere in colored printing even though I don't have a ton of matches.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799808153/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799810322","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799810322","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799810322,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgxMDMyMg==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:59:22Z","updated_at":"2021-03-15T22:59:22Z","body":"OK, I've looked at this with heaptrack and expanded a few traces:\r\n\r\n![heap-trace-expanded](https://user-images.githubusercontent.com/456674/111231135-1c00e300-85bf-11eb-97b3-02dce9ed4f0d.png)\r\n\r\nFrom what I can see, there are three distinct sources of large memory usage:\r\n\r\n1. The first, and biggest (179MB) appears to be what I speculated about above: there is a long line somewhere that is growing ripgrep's internal buffer. If that is indeed true, then it should be possible to narrow this down to the particular file. But, if it really is just a long line, then unfortunately that's just the way the cookie crumbles. The only real possible work-around here that I can think of is to occasionally contract the buffer, which in the presence of multiple threads, could theoretically lower peak memory usage if there are multiple files with long lines and they are searched using different buffers. But figuring out the best strategy for that is tricky and I'm inclined to pass on it.\r\n2. The second (142MB) appears to be a result of the parallel directory traversal eagerly collecting the paths it wants to traverse. This is somewhat related to the last memory problem you reported, which I \"fixed\" by switching from breadth first to depth first traversal. But it's not a truly fundamental fix. I would love to fix this, but I don't know. I don't know how to introduce back-pressure in the traversal algorithm. :-(\r\n3. The last one (46MB) is the most perplexing. It looks like a _single path_ is using up tens of MB. Does that sound right to you for your specific data set? That can't be right, right? Neither `PathBuf` nor `OsString` buffers are reused in ripgrep IIRC, so I'm not really sure what could be causing that. Unless the heap trace isn't reporting a single path, but rather, \"there are a whole bunch of PathBufs using lots of memory,\" which would be consistent with (2) above.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799810322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799810402","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799810402","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799810402,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgxMDQwMg==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:59:34Z","updated_at":"2021-03-15T22:59:34Z","body":"Hmmm I can't seem to find the allocs for colored printing.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799810402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799811314","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799811314","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799811314,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgxMTMxNA==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:01:20Z","updated_at":"2021-03-15T23:01:20Z","body":"GNU grep only uses 125Mb at its peak:\r\n```\r\ntime grep -r AddressSanitizer\r\n60.91user 208.19system 15:22.34elapsed 29%CPU (0avgtext+0avgdata 125588maxresident)k\r\n179260304inputs+0outputs (2major+56824minor)pagefaults 0swaps\r\n```\r\n\r\nHere's the -uuu command:\r\n```\r\ntime rg -uuu AddressSanitizer\r\n64.60user 239.45system 5:06.36elapsed 99%CPU (0avgtext+0avgdata 592932maxresident)k\r\n195622760inputs+0outputs (57major+150679minor)pagefaults 0swaps\r\n```\r\nThe command for which I posted the heaptrack profile:\r\n```\r\ntime rg --no-ignore AddressSanitizer\r\n64.48user 244.57system 5:09.16elapsed 99%CPU (0avgtext+0avgdata 524660maxresident)k\r\n193740072inputs+0outputs (16major+137157minor)pagefaults 0swaps\r\n```\r\nDefault configuration:\r\n```\r\ntime rg AddressSanitizer\r\n65.97user 245.02system 4:54.54elapsed 105%CPU (0avgtext+0avgdata 591276maxresident)k\r\n193990288inputs+0outputs (5major+167537minor)pagefaults 0swaps\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799811314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799812232","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799812232","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799812232,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgxMjIzMg==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:03:20Z","updated_at":"2021-03-15T23:03:20Z","body":"@Shnatsel In light of some observations above, what happens if you do `time rg -uuu -j1 AddressSanitizer`?","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799812232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4461460451,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDQ2MTQ2MDQ1MQ==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461460451","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-03-15T23:03:20Z","performed_via_github_app":null},{"id":4461460454,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ0NjE0NjA0NTQ=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461460454","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-03-15T23:03:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799814036","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799814036","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799814036,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgxNDAzNg==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:07:34Z","updated_at":"2021-03-15T23:07:34Z","body":"To find the many small allocations, go to bottom-up view and sort by the number of allocations, then select the first entry. \r\n\r\nThis is what the bottom-up list sorted by allocation count looks like for me:\r\n\r\n![Снимок экрана от 2021-03-16 00 03 08](https://user-images.githubusercontent.com/291257/111232385-4f596700-85eb-11eb-8c45-bb0348369a6b.png)\r\n\r\nIf you click the first item, this is the backtrace:\r\n\r\n![Снимок экрана от 2021-03-16 00 06 09](https://user-images.githubusercontent.com/291257/111232456-6e57f900-85eb-11eb-9355-e3bd8045a1e4.png)\r\n\r\n`termcolor` frames are prominent in this backtrace.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799814036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799823986","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799823986","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799823986,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgyMzk4Ng==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:16:46Z","updated_at":"2021-03-15T23:16:46Z","body":"Yeah, there will be _some_ allocs from termcolor because the printer is writing to an in memory buffer owned by termcolor when using parallelism. I can see them in the heap viz. But whenever I try to drill down and follow the trace with the most allocs, I don't wind up in termcolor, but rather, in `PathBuf` crud. (And this is unfortunately to be expected, because std provides no way of amortizing allocs when dealing with file system APIs. There are lots of little hidden allocs in that area, particularly with respect to creating C strings for libc APIs. I have a WIP patch in `walkdir` to try to fix some of it, but it's a steep steep hill to climb.)","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799823986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799825915","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799825915","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799825915,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgyNTkxNQ==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:21:25Z","updated_at":"2021-03-15T23:21:25Z","body":"`-j1` makes a huge difference. For a good part of the execution the memory use is just 1Mb!\r\n\r\nThe final result is even lower than GNU grep!\r\n```\r\ntime rg -uuu -j1 AddressSanitizer\r\n73.94user 256.63system 16:59.72elapsed 32%CPU (0avgtext+0avgdata 58836maxresident)k\r\n185588456inputs+0outputs (3major+13642minor)pagefaults 0swaps\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799825915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799827643","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799827643","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799827643,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgyNzY0Mw==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:25:34Z","updated_at":"2021-03-15T23:25:34Z","body":"How many threads do you have on this machine?","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799827643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799830165","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799830165","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799830165,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgzMDE2NQ==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:31:40Z","updated_at":"2021-03-15T23:32:15Z","body":"I have 4 cores, no SMT. `/proc/$pid/status` shows 5 threads for the `rg` process when running `rg --no-ignore AddressSanitizer`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799830165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799836340","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799836340","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799836340,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgzNjM0MA==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:47:55Z","updated_at":"2021-03-15T23:47:55Z","body":"All right. I think I'm going to have to close this at `wontfix`. I don't see any obvious thing to do here to fix the higher memory usage when using parallelism. One should expect using parallelism to use more memory I think. It's really a fundamental trade off in a tool like this. A reasonable response would be that parallelism should increase memory usage proportionally with a low constant. In your case, it looks to be increasing by a factor 10 instead of 4 or 5. But unfortunately, the parallel aspects of ripgrep (thinking about the recursive directory traversal) are piggish in a way that isn't a simple linear increase with the number of threads. And I don't know how to fix it, sadly.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799836340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4461591761,"node_id":"MDExOkNsb3NlZEV2ZW50NDQ2MTU5MTc2MQ==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461591761","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-03-15T23:47:55Z","state_reason":null,"performed_via_github_app":null},{"id":4461592041,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50NDQ2MTU5MjA0MQ==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461592041","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2021-03-15T23:48:03Z","label":{"name":"question","color":"cc317c"},"performed_via_github_app":null},{"id":4461592042,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ0NjE1OTIwNDI=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461592042","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-03-15T23:48:03Z","label":{"name":"wontfix","color":"ffffff"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799840657","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799840657","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799840657,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg0MDY1Nw==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T00:00:11Z","updated_at":"2021-03-16T00:00:11Z","body":"Ah, I also have a directory structure that's very wide this time around, so that's what probably hogs all the memory. Some directories have 600,000 files in them. That's probably a contributing factor.\r\n\r\nWhat is the fundamental issue with introducing backpressure? Perhaps we can figure out some kind of solution.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799840657/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799845005","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799845005","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799845005,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg0NTAwNQ==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T00:11:21Z","updated_at":"2021-03-16T00:12:28Z","body":"This is the relevant code: https://github.com/BurntSushi/ripgrep/blob/c7730d1f3a366e42fdd497a1e0db4bf090de415c/crates/ignore/src/walk.rs#L1383-L1678\r\n\r\nThe directory traverser is setup as a fixed thread pool. Each thread has a worker. Basically, what happens is that once you see a directory in a worker, you list its contents. All entries in that directory are then \"sent\" on a channel (implemented here as a thread safe stack). Each worker is waiting on things coming in the channel. When it pops an item off the stack, it's (roughly) either a file or a directory. If it's a file, it will execute the caller's function (which in ripgrep's case will perform the actual search, write to a buffer, etc.). If it's a directory, then it repeats the process: lists its contents and pushes every item on to the stack for the worker pool to process.\r\n\r\nSo what happens is that when you hit directories, the implementation immediately plops every single one of its entries on to the channel. And when it hits more directories, it keeps doing the same. Thus, my working theory is that it very quickly just plops the entire set of things to search on to this channel.\r\n\r\nPreviously, I was using an asynchronous channel for this. And that gave us a breadth first traversal. But now we use a stack. Both things have this particular problem.\r\n\r\nThe naive desire here would be to have a way for the stack to have a constrained size and prevent the workers from pushing more stuff on to it until the workers have completed more of the work. This is the fundamental problem that I have not figured out how to solve. More specifically, the difference between this problem and typical thread/worker formulations is that the producers and consumers **are the same**. So if you start constraining the stack, you aren't just constraining a producer but a consumer as well. And one invariably leads to deadlock. This is [why termination is subtle and weird](https://github.com/BurntSushi/ripgrep/blob/c7730d1f3a366e42fdd497a1e0db4bf090de415c/crates/ignore/src/walk.rs#L1601-L1635).\r\n\r\nNow, I am _not_ claiming that this is itself an unsolvable problem. I do not have enough experience with this sort of thing to be certain about it. What I mean is that I just haven't figured out how to fix it.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799845005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799857434","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799857434","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799857434,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg1NzQzNA==","user":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T00:42:25Z","updated_at":"2021-03-16T00:42:25Z","body":"Ah, so even leaving the files to be searched aside for a moment, completing some work on the directories may result in _more_ directories being discovered that we have to add to the queue. This makes constraining the size of the directory queue very problematic because completing some work may create more work that we have to add to the queue.\r\n\r\nThe file queue however doesn't suffer from this problem. So it should be possible to constrain the queue of those at least, and switch from discovering new files to searching the files that have been already discovered when the queue exceeds a certain size threshold. That should alleviate at least part of the problem.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799857434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799863439","html_url":"https://github.com/BurntSushi/ripgrep/issues/1823#issuecomment-799863439","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1823","id":799863439,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg2MzQzOQ==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T00:59:01Z","updated_at":"2021-03-16T00:59:01Z","body":"> Ah, so even leaving the files to be searched aside for a moment, completing some work on the directories may result in _more_ directories being discovered that we have to add to the queue. This makes constraining the size of the directory queue very problematic because completing some work may create more work that we have to add to the queue.\r\n\r\nExactly.\r\n\r\n> The file queue however doesn't suffer from this problem. So it should be possible to constrain the queue of those at least, and switch from discovering new files to searching the files that have been already discovered when the queue exceeds a certain size threshold. That should alleviate at least part of the problem.\r\n\r\nThis is an interesting idea. I can't immediately knock it down, so I'll re-open this, rename it and tag it with help wanted to see if anyone wants to take a crack at it. In theory, it should be a fairly isolated change. But it might be a tricky/subtle one.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/799863439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4461760885,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50NDQ2MTc2MDg4NQ==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461760885","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2021-03-16T00:59:10Z","label":{"name":"wontfix","color":"ffffff"},"performed_via_github_app":null},{"id":4461760886,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ0NjE3NjA4ODY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4461760886","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-03-16T00:59:10Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null}]