{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/953","id":332995230,"node_id":"MDU6SXNzdWUzMzI5OTUyMzA=","number":953,"title":"`Walk` from `ignore` returns an Ok(...) and an Err(...) for the same permission-denied subdirectory","user":{"login":"sashaweiss","id":9013117,"node_id":"MDQ6VXNlcjkwMTMxMTc=","avatar_url":"https://avatars.githubusercontent.com/u/9013117?v=4","gravatar_id":"","url":"https://api.github.com/users/sashaweiss","html_url":"https://github.com/sashaweiss","followers_url":"https://api.github.com/users/sashaweiss/followers","following_url":"https://api.github.com/users/sashaweiss/following{/other_user}","gists_url":"https://api.github.com/users/sashaweiss/gists{/gist_id}","starred_url":"https://api.github.com/users/sashaweiss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sashaweiss/subscriptions","organizations_url":"https://api.github.com/users/sashaweiss/orgs","repos_url":"https://api.github.com/users/sashaweiss/repos","events_url":"https://api.github.com/users/sashaweiss/events{/privacy}","received_events_url":"https://api.github.com/users/sashaweiss/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":449399236,"node_id":"MDU6TGFiZWw0NDkzOTkyMzY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/doc","name":"doc","color":"fbca04","default":false,"description":"An issue with or an improvement to documentation."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-06-16T15:38:32Z","updated_at":"2018-08-30T19:33:17Z","closed_at":"2018-08-22T03:05:54Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Skipped some of the preamble, since this isn't strictly a `ripgrep` question!\r\n\r\nI'm using `ignore 0.4.2`, on Mac OSX 10.13.4.\r\n\r\n#### Describe your question, feature request, or bug.\r\nWhen I use a `Walk` to iterate a directory containing a subdirectory with restricted permissions, it yields two separate entries for that subdirectory - one with an `Ok(DirEntry {...})` and one with an `Err(WithPath {...})`.\r\n\r\nAlso interestingly, calling the `DirEntry::error()` method from the `DirEntry` in the `Ok` returns `None`.\r\n\r\n#### If this is a bug, what are the steps to reproduce the behavior?\r\n[This example repo](https://github.com/sashaweiss/ignore_permissions_example) will demonstrate this behavior!\r\n\r\n#### If this is a bug, what is the expected behavior?\r\nI think I expected that calling `DirEntry::error()` on the `DirEntry {...}` in the `Ok` would give me back the same `WithPath` error, or some other indicator that `ignore` won't be able to recur into that directory.\r\n\r\nAlternatively, if it's possible for a `Walk` to build a `DirEntry` even for a directory that is permission-restricted, maybe it makes sense for there to be another `Error` variant that contains a `DirEntry`? A `WithDirEntry {...}` perhaps?\r\n\r\nI think in either case it'd make sense to eliminate the duplicate entry - in the first case by not returning the `Err`, and in the second case by not returning the `Ok`. Off the bat, not sure which would make the most sense. It's also not immediately clear to me how to make sure a solution to this makes sense for permission-restricted _files_, since so far my discussion of it has been focused on directories (and the fact that `ignore` won't recur into them).\r\n\r\nMy intuition says that the error comes about since `ignore` can detect the restricted directory while searching its parent directory, and that the error comes about when it tries to dive in - since this doesn't come up for restricted files. If you agree that this is something that should change, I'd be happy to try to help with a PR if you'd like!\r\n\r\nThanks in advance for your advice! `ignore` has been awesome to use and exactly what I needed - just want to confirm this behavior with you before building a workaround.","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/953/timeline","performed_via_github_app":null,"state_reason":"completed"}