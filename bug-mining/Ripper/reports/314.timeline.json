[{"id":4673457468,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2NzM0NTc0Njg=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4673457468","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"dd7e6ac3868b87112203aaac007c0bc5de214d4d","commit_url":"https://api.github.com/repos/rust-lang/regex/commits/dd7e6ac3868b87112203aaac007c0bc5de214d4d","created_at":"2021-05-01T11:27:30Z","performed_via_github_app":null},{"actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-01T11:27:44Z","updated_at":"2021-05-01T11:27:44Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rust-lang/regex/issues/768","repository_url":"https://api.github.com/repos/rust-lang/regex","labels_url":"https://api.github.com/repos/rust-lang/regex/issues/768/labels{/name}","comments_url":"https://api.github.com/repos/rust-lang/regex/issues/768/comments","events_url":"https://api.github.com/repos/rust-lang/regex/issues/768/events","html_url":"https://github.com/rust-lang/regex/pull/768","id":873647603,"node_id":"MDExOlB1bGxSZXF1ZXN0NjI4NDE2NjAx","number":768,"title":"compiler: fix lazy DFA false quits on ASCII text","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-05-01T11:27:44Z","updated_at":"2021-05-01T11:46:00Z","closed_at":"2021-05-01T11:42:36Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":27890669,"node_id":"MDEwOlJlcG9zaXRvcnkyNzg5MDY2OQ==","name":"regex","full_name":"rust-lang/regex","private":false,"owner":{"login":"rust-lang","id":5430905,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=","avatar_url":"https://avatars.githubusercontent.com/u/5430905?v=4","gravatar_id":"","url":"https://api.github.com/users/rust-lang","html_url":"https://github.com/rust-lang","followers_url":"https://api.github.com/users/rust-lang/followers","following_url":"https://api.github.com/users/rust-lang/following{/other_user}","gists_url":"https://api.github.com/users/rust-lang/gists{/gist_id}","starred_url":"https://api.github.com/users/rust-lang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rust-lang/subscriptions","organizations_url":"https://api.github.com/users/rust-lang/orgs","repos_url":"https://api.github.com/users/rust-lang/repos","events_url":"https://api.github.com/users/rust-lang/events{/privacy}","received_events_url":"https://api.github.com/users/rust-lang/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rust-lang/regex","description":"An implementation of regular expressions for Rust. This implementation uses finite automata and guarantees linear time matching on all inputs.","fork":false,"url":"https://api.github.com/repos/rust-lang/regex","forks_url":"https://api.github.com/repos/rust-lang/regex/forks","keys_url":"https://api.github.com/repos/rust-lang/regex/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rust-lang/regex/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rust-lang/regex/teams","hooks_url":"https://api.github.com/repos/rust-lang/regex/hooks","issue_events_url":"https://api.github.com/repos/rust-lang/regex/issues/events{/number}","events_url":"https://api.github.com/repos/rust-lang/regex/events","assignees_url":"https://api.github.com/repos/rust-lang/regex/assignees{/user}","branches_url":"https://api.github.com/repos/rust-lang/regex/branches{/branch}","tags_url":"https://api.github.com/repos/rust-lang/regex/tags","blobs_url":"https://api.github.com/repos/rust-lang/regex/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rust-lang/regex/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rust-lang/regex/git/refs{/sha}","trees_url":"https://api.github.com/repos/rust-lang/regex/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rust-lang/regex/statuses/{sha}","languages_url":"https://api.github.com/repos/rust-lang/regex/languages","stargazers_url":"https://api.github.com/repos/rust-lang/regex/stargazers","contributors_url":"https://api.github.com/repos/rust-lang/regex/contributors","subscribers_url":"https://api.github.com/repos/rust-lang/regex/subscribers","subscription_url":"https://api.github.com/repos/rust-lang/regex/subscription","commits_url":"https://api.github.com/repos/rust-lang/regex/commits{/sha}","git_commits_url":"https://api.github.com/repos/rust-lang/regex/git/commits{/sha}","comments_url":"https://api.github.com/repos/rust-lang/regex/comments{/number}","issue_comment_url":"https://api.github.com/repos/rust-lang/regex/issues/comments{/number}","contents_url":"https://api.github.com/repos/rust-lang/regex/contents/{+path}","compare_url":"https://api.github.com/repos/rust-lang/regex/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rust-lang/regex/merges","archive_url":"https://api.github.com/repos/rust-lang/regex/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rust-lang/regex/downloads","issues_url":"https://api.github.com/repos/rust-lang/regex/issues{/number}","pulls_url":"https://api.github.com/repos/rust-lang/regex/pulls{/number}","milestones_url":"https://api.github.com/repos/rust-lang/regex/milestones{/number}","notifications_url":"https://api.github.com/repos/rust-lang/regex/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rust-lang/regex/labels{/name}","releases_url":"https://api.github.com/repos/rust-lang/regex/releases{/id}","deployments_url":"https://api.github.com/repos/rust-lang/regex/deployments","created_at":"2014-12-11T20:39:09Z","updated_at":"2025-11-09T09:51:18Z","pushed_at":"2025-10-13T14:38:41Z","git_url":"git://github.com/rust-lang/regex.git","ssh_url":"git@github.com:rust-lang/regex.git","clone_url":"https://github.com/rust-lang/regex.git","svn_url":"https://github.com/rust-lang/regex","homepage":"https://docs.rs/regex","size":8103,"stargazers_count":3825,"watchers_count":3825,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":484,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":47,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["automata","automaton","dfa","nfa","regex","regex-engine","regex-parser","regex-syntax","regexp","regular-expressions","rust"],"visibility":"public","forks":484,"open_issues":47,"watchers":3825,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rust-lang/regex/pulls/768","html_url":"https://github.com/rust-lang/regex/pull/768","diff_url":"https://github.com/rust-lang/regex/pull/768.diff","patch_url":"https://github.com/rust-lang/regex/pull/768.patch","merged_at":"2021-05-01T11:42:36Z"},"body":"One of the things the lazy DFA can't handle is Unicode word boundaries,\r\nsince it requires multi-byte look-around. However, it turns out that on\r\npure ASCII text, Unicode word boundaries are equivalent to ASCII word\r\nboundaries. So the DFA has a heuristic: it treats Unicode word\r\nboundaries as ASCII boundaries until it sees a non-ASCII byte. When it\r\ndoes, it quits, and some other (slower) regex engine needs to take over.\r\n\r\nIn a bug report against ripgrep[1], it was discovered that the lazy DFA\r\nwas quitting and falling back to a slower engine even though the\r\nhaystack was pure ASCII.\r\n\r\nIt turned out that our equivalence byte class optimization was at fault.\r\nNamely, a '{' (which appears very frequently in the input) was being\r\ngrouped in with other non-ASCII bytes. So whenever the DFA saw it, it\r\ntreated it as a non-ASCII byte and thus stopped.\r\n\r\nThe fix for this is simple: when we see a Unicode word boundary in the\r\ncompiler, we set a boundary on our byte classes such that ASCII bytes\r\nare guaranteed to be in a different class from non-ASCII bytes. And\r\nindeed, this fixes the performance problem reported in [1].\r\n\r\n[1] - https://github.com/BurntSushi/ripgrep/issues/1860","reactions":{"url":"https://api.github.com/repos/rust-lang/regex/issues/768/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rust-lang/regex/issues/768/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4673473696,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2NzM0NzM2OTY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4673473696","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"036ce80c93591b1416556bd142aa1d6749db6d91","commit_url":"https://api.github.com/repos/rust-lang/regex/commits/036ce80c93591b1416556bd142aa1d6749db6d91","created_at":"2021-05-01T11:42:37Z","performed_via_github_app":null},{"id":4673476658,"node_id":"MDExOkNsb3NlZEV2ZW50NDY3MzQ3NjY1OA==","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/4673476658","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"3f4c4188c1150ae21bec2afd11fcc48bce1c1447","commit_url":"https://api.github.com/repos/BurntSushi/ripgrep/commits/3f4c4188c1150ae21bec2afd11fcc48bce1c1447","created_at":"2021-05-01T11:45:57Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/830620337","html_url":"https://github.com/BurntSushi/ripgrep/issues/1860#issuecomment-830620337","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1860","id":830620337,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDYyMDMzNw==","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-01T11:53:49Z","updated_at":"2021-05-01T11:53:49Z","body":"This is the definition of a perfect bug report. Thank you so much. And thank you for reporting it. This was indeed quite a subtle performance bug in the regex engine. The actual fix is here: https://github.com/rust-lang/regex/pull/768\r\n\r\nThe higher level view is that there is a space (and also time) saving optimization in the faster lazy DFA engine that groups together bytes into equivalence classes that can't otherwise discriminate between a match and a non-match. That was actually correct here, but the grouping didn't account for bytes that cause the DFA to quit early. In particular, your JSON file has many `{` (that's `0x7B`) bytes. It's very close to the upper end of the ASCII range, which increases its likelihood of getting lumped together with bytes outside of the ASCII range. And indeed, that's exactly what happened here. The regex engine was continually running the lazy DFA, seeing a `{`, stopping incorrectly and then falling back to a slower NFA engine.\r\n\r\nThe fix for this was to simply mark the ASCII range as distinct from the non-ASCII range when constructing the equivalence class boundaries (if a Unicode word boundary is seen).\r\n\r\nAnother interesting way to look at this, is if you try adding the `\\{\\}$` regex to your search. That will incidentally result in a set of equivalence classes where brackets aren't seen as non-ASCII, and thus, the search runs quickly.\r\n\r\nThanks again for the great bug report!","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/830620337/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/830733137","html_url":"https://github.com/BurntSushi/ripgrep/issues/1860#issuecomment-830733137","issue_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1860","id":830733137,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDczMzEzNw==","user":{"login":"ethack","id":1696711,"node_id":"MDQ6VXNlcjE2OTY3MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1696711?v=4","gravatar_id":"","url":"https://api.github.com/users/ethack","html_url":"https://github.com/ethack","followers_url":"https://api.github.com/users/ethack/followers","following_url":"https://api.github.com/users/ethack/following{/other_user}","gists_url":"https://api.github.com/users/ethack/gists{/gist_id}","starred_url":"https://api.github.com/users/ethack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ethack/subscriptions","organizations_url":"https://api.github.com/users/ethack/orgs","repos_url":"https://api.github.com/users/ethack/repos","events_url":"https://api.github.com/users/ethack/events{/privacy}","received_events_url":"https://api.github.com/users/ethack/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T03:21:39Z","updated_at":"2021-05-02T03:21:39Z","body":"Thank you for the explanation and quick turn-around for a fix! It sounds like there are some really neat things happening in the rust regex library. Ripgrep has become an indispensable part of my toolkit so you have my gratitude and admiration for all your work on the project. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/comments/830733137/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ethack","id":1696711,"node_id":"MDQ6VXNlcjE2OTY3MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1696711?v=4","gravatar_id":"","url":"https://api.github.com/users/ethack","html_url":"https://github.com/ethack","followers_url":"https://api.github.com/users/ethack/followers","following_url":"https://api.github.com/users/ethack/following{/other_user}","gists_url":"https://api.github.com/users/ethack/gists{/gist_id}","starred_url":"https://api.github.com/users/ethack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ethack/subscriptions","organizations_url":"https://api.github.com/users/ethack/orgs","repos_url":"https://api.github.com/users/ethack/repos","events_url":"https://api.github.com/users/ethack/events{/privacy}","received_events_url":"https://api.github.com/users/ethack/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11794051828,"node_id":"REFE_lADOAzJbyc40EPiSzwAAAAK--vL0","url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/events/11794051828","actor":{"login":"vors","id":816680,"node_id":"MDQ6VXNlcjgxNjY4MA==","avatar_url":"https://avatars.githubusercontent.com/u/816680?v=4","gravatar_id":"","url":"https://api.github.com/users/vors","html_url":"https://github.com/vors","followers_url":"https://api.github.com/users/vors/followers","following_url":"https://api.github.com/users/vors/following{/other_user}","gists_url":"https://api.github.com/users/vors/gists{/gist_id}","starred_url":"https://api.github.com/users/vors/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vors/subscriptions","organizations_url":"https://api.github.com/users/vors/orgs","repos_url":"https://api.github.com/users/vors/repos","events_url":"https://api.github.com/users/vors/events{/privacy}","received_events_url":"https://api.github.com/users/vors/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3f4c4188c1150ae21bec2afd11fcc48bce1c1447","commit_url":"https://api.github.com/repos/vors/ripgrep/commits/3f4c4188c1150ae21bec2afd11fcc48bce1c1447","created_at":"2024-02-13T21:15:46Z","performed_via_github_app":null}]