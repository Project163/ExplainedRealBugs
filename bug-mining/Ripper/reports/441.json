{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/2777","id":2234001879,"node_id":"I_kwDOAzJbyc6FKCnX","number":2777,"title":"Negation pattern/whitelisting is ignored from `--ignore-file`","user":{"login":"noirbizarre","id":15725,"node_id":"MDQ6VXNlcjE1NzI1","avatar_url":"https://avatars.githubusercontent.com/u/15725?v=4","gravatar_id":"","url":"https://api.github.com/users/noirbizarre","html_url":"https://github.com/noirbizarre","followers_url":"https://api.github.com/users/noirbizarre/followers","following_url":"https://api.github.com/users/noirbizarre/following{/other_user}","gists_url":"https://api.github.com/users/noirbizarre/gists{/gist_id}","starred_url":"https://api.github.com/users/noirbizarre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noirbizarre/subscriptions","organizations_url":"https://api.github.com/users/noirbizarre/orgs","repos_url":"https://api.github.com/users/noirbizarre/repos","events_url":"https://api.github.com/users/noirbizarre/events{/privacy}","received_events_url":"https://api.github.com/users/noirbizarre/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":449399236,"node_id":"MDU6TGFiZWw0NDkzOTkyMzY=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/doc","name":"doc","color":"fbca04","default":false,"description":"An issue with or an improvement to documentation."},{"id":1849506066,"node_id":"MDU6TGFiZWwxODQ5NTA2MDY2","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/rollup","name":"rollup","color":"ffccee","default":false,"description":"A PR that has been merged with many others in a rollup."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2024-04-09T17:41:40Z","updated_at":"2025-10-11T02:07:02Z","closed_at":"2025-10-11T02:07:02Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Please tick this box to confirm you have reviewed the above.\r\n\r\n- [X] I have a different issue.\r\n\r\n### What version of ripgrep are you using?\r\n\r\nripgrep 14.1.0\r\n\r\nfeatures:-simd-accel,-pcre2\r\nsimd(compile):+SSE2,-SSSE3,-AVX2\r\nsimd(runtime):+SSE2,+SSSE3,+AVX2\r\n\r\nPCRE2 is not available in this build of ripgrep.\r\n\r\n### How did you install ripgrep?\r\n\r\nPacman\r\n\r\n### What operating system are you using ripgrep on?\r\n\r\nArchlinux\r\n\r\n### Describe your bug.\r\n\r\nNegation patterns are ignored from `--ignore-file` while documentation says it should take precedence\r\n\r\n### What are the steps to reproduce the behavior?\r\n\r\n- Create an empty repository (`mkdir case && cd case && git init`)\r\n- create an hidden file: `touch .hidden`\r\n- add `.hidden` to the `.gitignore` file\r\n- create a `search.ignore` file whitelisting the `.hidden` file: `!.hidden`\r\n- run `rg --files --hidden --ignore-file=search.ignore`\r\n\r\n\r\n### What is the actual behavior?\r\n\r\n`.hidden` file is not whitelisted and is missing from result while it should be there.\r\n\r\nHere the actual output with `rg --files --hidden --ignore-file=search.ignore --debug`:\r\n```console\r\nrg: DEBUG|rg::flags::parse|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/parse.rs:97: no extra arguments found from configuration file\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Files)\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1109: heuristic chose to search ./\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: archxps\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1270: hyperlink format: \"\"\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:174: using 8 thread(s)\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:448: glob converted to regex: Glob { glob: \".vscode/*\", re: \"(?-u)^\\\\.vscode/[^/]*$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal('.'), Literal('v'), Literal('s'), Literal('c'), Literal('o'), Literal('d'), Literal('e'), Literal('/'), ZeroOrMore]) }\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 4 literals, 6 basenames, 1 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 1 regexes\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrg: DEBUG|ignore::walk|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ignore-0.4.22/src/walk.rs:1799: ignoring ./.hidden: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(\"./.gitignore\"), original: \".hidden\", actual: \"**/.hidden\", is_whitelist: false, is_only_dir: false })))\r\nsearch.ignore\r\n.git/HEAD\r\n.git/config\r\n.git/description\r\n.git/info/exclude\r\n.git/hooks/update.sample\r\n.git/hooks/sendemail-validate.sample\r\n.git/hooks/push-to-checkout.sample\r\n.git/hooks/prepare-commit-msg.sample\r\n.git/hooks/pre-receive.sample\r\n.git/hooks/pre-rebase.sample\r\n.git/hooks/pre-push.sample\r\n.git/hooks/pre-merge-commit.sample\r\n.git/hooks/pre-commit.sample\r\n.git/hooks/pre-applypatch.sample\r\n.git/hooks/post-update.sample\r\n.git/hooks/fsmonitor-watchman.sample\r\n.git/hooks/commit-msg.sample\r\n.git/hooks/applypatch-msg.sample\r\n.gitignore\r\n```\r\n\r\n### What is the expected behavior?\r\n\r\nIgnore provided with `--ignore-file` should take precedence and whitelist previously ignored patterns.\r\nHere's the expected output:\r\n\r\n```console\r\n$ rg --files --hidden --ignore-file=search.ignore\r\nsearch.ignore\r\n.gitignore\r\n.git/config\r\n.git/description\r\n.git/HEAD\r\n.git/info/exclude\r\n.git/hooks/pre-merge-commit.sample\r\n.git/hooks/pre-commit.sample\r\n.git/hooks/pre-applypatch.sample\r\n.git/hooks/post-update.sample\r\n.git/hooks/fsmonitor-watchman.sample\r\n.git/hooks/commit-msg.sample\r\n.git/hooks/applypatch-msg.sample\r\n.git/hooks/update.sample\r\n.git/hooks/prepare-commit-msg.sample\r\n.git/hooks/sendemail-validate.sample\r\n.git/hooks/pre-receive.sample\r\n.git/hooks/push-to-checkout.sample\r\n.git/hooks/pre-rebase.sample\r\n.git/hooks/pre-push.sample\r\n.hidden\r\n```\r\n\r\n### Note\r\n\r\nAdding the same negation pattern to the `.ignore` file works as expected and whitelist `.hidden`:\r\n\r\n```console\r\nrg: DEBUG|rg::flags::parse|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/parse.rs:97: no extra arguments found from configuration file\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Files)\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1109: heuristic chose to search ./\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: archxps\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:1270: hyperlink format: \"\"\r\nrg: DEBUG|rg::flags::hiargs|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ripgrep-14.1.0/crates/core/flags/hiargs.rs:174: using 8 thread(s)\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:448: glob converted to regex: Glob { glob: \".vscode/*\", re: \"(?-u)^\\\\.vscode/[^/]*$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal('.'), Literal('v'), Literal('s'), Literal('c'), Literal('o'), Literal('d'), Literal('e'), Literal('/'), ZeroOrMore]) }\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 4 literals, 6 basenames, 1 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 1 regexes\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrg: DEBUG|globset|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/globset-0.4.14/src/lib.rs:453: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrg: DEBUG|ignore::walk|/home/noirbizarre/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ignore-0.4.22/src/walk.rs:1802: whitelisting ./.hidden: Whitelist(IgnoreMatch(Gitignore(Glob { from: Some(\"./.ignore\"), original: \"!.hidden\", actual: \"**/.hidden\", is_whitelist: true, is_only_dir: false })))\r\n.ignore\r\nsearch.ignore\r\n.git/HEAD\r\n.git/config\r\n.git/description\r\n.git/info/exclude\r\n.git/hooks/update.sample\r\n.git/hooks/sendemail-validate.sample\r\n.git/hooks/push-to-checkout.sample\r\n.git/hooks/prepare-commit-msg.sample\r\n.git/hooks/pre-receive.sample\r\n.git/hooks/pre-rebase.sample\r\n.git/hooks/pre-push.sample\r\n.git/hooks/pre-merge-commit.sample\r\n.git/hooks/pre-commit.sample\r\n.git/hooks/pre-applypatch.sample\r\n.git/hooks/post-update.sample\r\n.git/hooks/fsmonitor-watchman.sample\r\n.git/hooks/commit-msg.sample\r\n.git/hooks/applypatch-msg.sample\r\n.gitignore\r\n.hidden\r\n```\r\nGiven standard ignore patterns are properly handled from `--ignore-file`, it means that only `--ignore-file` negation patterns are broken","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2777/timeline","performed_via_github_app":null,"state_reason":"completed"}