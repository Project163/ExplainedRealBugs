{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/1155","id":397035063,"node_id":"MDU6SXNzdWUzOTcwMzUwNjM=","number":1155,"title":"add flag to enable \"hybrid\" regex mode","user":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721680,"node_id":"MDU6TGFiZWwzMzk3MjE2ODA=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"An enhancement to the functionality of the software."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-01-08T18:42:03Z","updated_at":"2019-04-14T23:29:30Z","closed_at":"2019-04-14T23:29:30Z","author_association":"OWNER","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In some cases, it would be nice for ripgrep to use Rust's regex engine by default whenever possible, and then fall back to PCRE2 when \"advanced\" regex features are used. In terms of user level documentation, I might suggest this specification:\r\n\r\n```\r\n--auto-hybrid-regex\r\n    When this flag is used, ripgrep will dynamically choose between supported\r\n    regex engines depending on the features used in a pattern. When ripgrep\r\n    chooses a regex engine, it applies that choice for every regex provided to\r\n    ripgrep (e.g., via multiple `-e/--regexp` or `-f/--file` flags).\r\n\r\n    As an example of how this flag might behave, ripgrep will attempt to use its\r\n    default finite automata based regex engine whenever the pattern can be\r\n    successfully compiled with that regex engine. If PCRE2 is enabled and if the\r\n    pattern given could not be compiled with the default regex engine, then PCRE2\r\n    will be automatically used for searching. If PCRE2 isn't available, then this flag\r\n    has no effect because there is only one regex engine to choose from.\r\n\r\n    In the future, ripgrep may adjust its heuristics for how it decides which regex\r\n    engine to use. In general, the heuristics will be limited to a static analysis of\r\n    the patterns, and not to any specific runtime behavior observed while searching\r\n    files.\r\n\r\n    The primary downside of using this flag is that it may not always be obvious\r\n    which regex engine ripgrep uses, and thus, the match semantics or performance\r\n    profile of ripgrep may subtly and unexpectedly change. However, in many cases,\r\n    all regex engines will agree on what constitutes a match and it can be nice to\r\n    transparently support more advanced regex features like look-around and\r\n    backreferences without explicitly needing to enable them.\r\n\r\n    This flag can be disabled with `--no-auto-hybrid-regex`.\r\n```\r\n\r\nI had initially thought about adding this when I added PCRE2, since it's a somewhat logical addition. However, I held off because I wanted a real use case first. One such use case is here: https://github.com/Microsoft/vscode/issues/64606\r\n\r\nIn terms of implementation, we should add debug logs indicating which regex engine is being used and any compilation errors that are otherwise suppressed in normal output.\r\n\r\ncc @roblourens","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/1155/timeline","performed_via_github_app":null,"state_reason":"completed"}