{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505","repository_url":"https://api.github.com/repos/BurntSushi/ripgrep","labels_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505/labels{/name}","comments_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505/comments","events_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505/events","html_url":"https://github.com/BurntSushi/ripgrep/issues/2505","id":1697676196,"node_id":"I_kwDOAzJbyc5lMHuk","number":2505,"title":"should --vimgrep run in single threaded mode by default?","user":{"login":"voidus","id":124298,"node_id":"MDQ6VXNlcjEyNDI5OA==","avatar_url":"https://avatars.githubusercontent.com/u/124298?v=4","gravatar_id":"","url":"https://api.github.com/users/voidus","html_url":"https://github.com/voidus","followers_url":"https://api.github.com/users/voidus/followers","following_url":"https://api.github.com/users/voidus/following{/other_user}","gists_url":"https://api.github.com/users/voidus/gists{/gist_id}","starred_url":"https://api.github.com/users/voidus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/voidus/subscriptions","organizations_url":"https://api.github.com/users/voidus/orgs","repos_url":"https://api.github.com/users/voidus/repos","events_url":"https://api.github.com/users/voidus/events{/privacy}","received_events_url":"https://api.github.com/users/voidus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":339721683,"node_id":"MDU6TGFiZWwzMzk3MjE2ODM=","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/question","name":"question","color":"cc317c","default":true,"description":"An issue that is lacking clarity on one or more points."},{"id":1849506066,"node_id":"MDU6TGFiZWwxODQ5NTA2MDY2","url":"https://api.github.com/repos/BurntSushi/ripgrep/labels/rollup","name":"rollup","color":"ffccee","default":false,"description":"A PR that has been merged with many others in a rollup."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2023-05-05T14:01:49Z","updated_at":"2023-11-25T20:03:58Z","closed_at":"2023-11-25T20:03:58Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I think I'm hitting #999 again\r\n\r\n#### What version of ripgrep are you using?\r\n\r\n`ripgrep 13.0.0` \r\n\r\n#### How did you install ripgrep?\r\n\r\nVia nix' home-manager @nixpkgs rev 402cc3633cc60dfc50378197305c984518b30773\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nArch linux with a lot of stuff (including rg) coming from nix\r\n\r\n#### Describe your bug.\r\n\r\nProject info:\r\n\r\n```> du -sh .; echo \"incl gitignore\"; find -type f | wc -l; find -type f -print0 | xargs -0 cat | wc -l; echo \"excl gitignore\"; fd --type f | wc -l; fd --type f --print0 | xargs -0 cat | wc -l;  \r\n98M\t.\r\nincl gitignore\r\n5717\r\n90682\r\nexcl gitignore\r\n410\r\n27827\r\n\r\n > nix run nixpkgs#time -- -v rg a | wc -l        \r\n\tCommand being timed: \"rg a\"\r\n\tUser time (seconds): 0.00\r\n\tSystem time (seconds): 0.00\r\n\tPercent of CPU this job got: 160%\r\n\tElapsed (wall clock) time (h:mm:ss or m:ss): 0:00.01\r\n\tAverage shared text size (kbytes): 0\r\n\tAverage unshared data size (kbytes): 0\r\n\tAverage stack size (kbytes): 0\r\n\tAverage total size (kbytes): 0\r\n\tMaximum resident set size (kbytes): 10880\r\n\tAverage resident set size (kbytes): 0\r\n\tMajor (requiring I/O) page faults: 0\r\n\tMinor (reclaiming a frame) page faults: 2214\r\n\tVoluntary context switches: 211\r\n\tInvoluntary context switches: 29\r\n\tSwaps: 0\r\n\tFile system inputs: 0\r\n\tFile system outputs: 0\r\n\tSocket messages sent: 0\r\n\tSocket messages received: 0\r\n\tSignals delivered: 0\r\n\tPage size (bytes): 4096\r\n\tExit status: 0\r\n14008\r\n\r\n> nix run nixpkgs#time -- -v rg --vimgrep a | wc -l\r\nCommand terminated by signal 9\r\n\tCommand being timed: \"rg --vimgrep a\"\r\n\tUser time (seconds): 4.67\r\n\tSystem time (seconds): 35.86\r\n\tPercent of CPU this job got: 85%\r\n\tElapsed (wall clock) time (h:mm:ss or m:ss): 0:47.30\r\n\tAverage shared text size (kbytes): 0\r\n\tAverage unshared data size (kbytes): 0\r\n\tAverage stack size (kbytes): 0\r\n\tAverage total size (kbytes): 0\r\n\tMaximum resident set size (kbytes): 26359456\r\n\tAverage resident set size (kbytes): 0\r\n\tMajor (requiring I/O) page faults: 15488\r\n\tMinor (reclaiming a frame) page faults: 7088456\r\n\tVoluntary context switches: 467064\r\n\tInvoluntary context switches: 52122\r\n\tSwaps: 0\r\n\tFile system inputs: 1722872\r\n\tFile system outputs: 0\r\n\tSocket messages sent: 0\r\n\tSocket messages received: 0\r\n\tSignals delivered: 0\r\n\tPage size (bytes): 4096\r\n\tExit status: 0\r\n89447\r\n```\r\n\r\n26Gigs of memory to search through a hundred megs of stuff seems like an issue.\r\n\r\nI `^c`'d the vimgrep one once my 32GB of memory + 18GB of swap were full.\r\n\r\nI'm running this in this subfolder: https://gitlab.com/sea-watch.org/planner/-/tree/main/backoffice but I'm working in this repo so it might not be the same.\r\nI did move the big .direnv folder with the python virtualenvs out of the way to run the above test.\r\n\r\nI'd be more than happy to debug this further if you have any guidance.","closed_by":{"login":"BurntSushi","id":456674,"node_id":"MDQ6VXNlcjQ1NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/456674?v=4","gravatar_id":"","url":"https://api.github.com/users/BurntSushi","html_url":"https://github.com/BurntSushi","followers_url":"https://api.github.com/users/BurntSushi/followers","following_url":"https://api.github.com/users/BurntSushi/following{/other_user}","gists_url":"https://api.github.com/users/BurntSushi/gists{/gist_id}","starred_url":"https://api.github.com/users/BurntSushi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurntSushi/subscriptions","organizations_url":"https://api.github.com/users/BurntSushi/orgs","repos_url":"https://api.github.com/users/BurntSushi/repos","events_url":"https://api.github.com/users/BurntSushi/events{/privacy}","received_events_url":"https://api.github.com/users/BurntSushi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/BurntSushi/ripgrep/issues/2505/timeline","performed_via_github_app":null,"state_reason":"completed"}