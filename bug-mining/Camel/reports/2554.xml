<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:00:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6991] Problem with stream caching and DefaultHttpBinding.writeResponse</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6991</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;DefaultHttpBinding.writeResponse was modified between 2.11.0 and 2.11.2. This yields to a problem with stream caching. &lt;/p&gt;

&lt;p&gt;When exchange.out is not set target (DefaultHttpBinding.java:215)  is assigned to exchange.in . exchange.in may contain a body which is already removed by an onCompletion callback. In DefaultHttpBindung.java:377 this body is read. This may yield to an exception&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian 7&lt;/p&gt;</environment>
        <key id="12680486">CAMEL-6991</key>
            <summary>Problem with stream caching and DefaultHttpBinding.writeResponse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="ulrich.kramer">Ulrich Kramer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Nov 2013 11:21:19 +0000</created>
                <updated>Fri, 22 Nov 2013 08:27:55 +0000</updated>
                            <resolved>Fri, 22 Nov 2013 08:27:55 +0000</resolved>
                                    <version>2.11.2</version>
                                    <fixVersion>2.12.0</fixVersion>
                                    <component>camel-http</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13829284" author="davsclaus" created="Thu, 21 Nov 2013 20:03:25 +0000"  >&lt;p&gt;Are you talking about using onCompletion&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/oncompletion.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/oncompletion.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;eg onCompletion in a route, or what?&lt;/p&gt;</comment>
                            <comment id="13829286" author="davsclaus" created="Thu, 21 Nov 2013 20:05:59 +0000"  >&lt;p&gt;And can you provide an sample route or what else to demonstrate this?&lt;/p&gt;</comment>
                            <comment id="13829287" author="davsclaus" created="Thu, 21 Nov 2013 20:06:19 +0000"  >&lt;p&gt;And try with latest release Camel 2.12.1&lt;/p&gt;</comment>
                            <comment id="13829696" author="ulrich.kramer" created="Fri, 22 Nov 2013 06:21:02 +0000"  >&lt;p&gt;With the following example you can reproduce the problem when you set two breakpoints:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;CachedOutputStream line: 209  cleanUpTempFile()&lt;/li&gt;
	&lt;li&gt;FileInputStreamCache line: 110  createInputStream(File)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;cleanupTempFile is called first. createInputStream creates an IOException because the file is already removed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        CamelContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultCamelContext();
        context.addRoutes(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:input&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:55555/input&quot;&lt;/span&gt;);
&lt;/span&gt;                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:55555/input&quot;&lt;/span&gt;).process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
&lt;/span&gt;
                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                        Assert.assertFalse(exchange.hasOut());
                    }
                });
            }
        });
        context.start();
        ProducerTemplate template = context.createProducerTemplate();
        &lt;span class=&quot;code-object&quot;&gt;StringBuffer&lt;/span&gt; sb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;StringBuffer&lt;/span&gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 10000; i++) {
            sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;0123456789&quot;&lt;/span&gt;);
        }
        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:input&quot;&lt;/span&gt;, sb.toString());
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13829793" author="davsclaus" created="Fri, 22 Nov 2013 08:27:40 +0000"  >&lt;p&gt;Ah use Camel 2.12 onwards as Jetty ends the UoW after it has written the response. So the cleanup of the file happens afterwards now.&lt;br/&gt;
For earlier releases use .convertBodyTo(byte[].class) to ensure the content is in-memory, at the end of the jetty route.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359751</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q0mf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>