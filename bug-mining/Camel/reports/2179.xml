<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:55:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5953] Java DSL: unmarshal() inside choice() blocks adding more conditions</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5953</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This routing code leads to the exception below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:abc&quot;&lt;/span&gt;)
    .choice()
        .when(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body} == &lt;span class=&quot;code-quote&quot;&gt;&apos;Please &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not fail&apos;&lt;/span&gt;&quot;&lt;/span&gt;))
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
            .unmarshal().xstream().endChoice()
        .otherwise()
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
        .end();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.ClassCastException: org.apache.camel.model.RouteDefinition cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.camel.model.ChoiceDefinition
	at org.apache.camel.model.ProcessorDefinition.endChoice(ProcessorDefinition.java:1256)
	at com.mycompany.MyRoute.configure(MyRoute.java:40)
	at org.apache.camel.builder.RouteBuilder.checkInitialized(RouteBuilder.java:322)
	at org.apache.camel.builder.RouteBuilder.configureRoutes(RouteBuilder.java:276)
	at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:262)
	[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also happens if we try to add another when instead of an otherwise.&lt;/p&gt;

&lt;p&gt;Tried using end(), endParent(), but they all lead to the same exception. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12627020">CAMEL-5953</key>
            <summary>Java DSL: unmarshal() inside choice() blocks adding more conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="raulvk">Ra&#250;l Kripalani</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jan 2013 20:57:30 +0000</created>
                <updated>Mon, 4 Feb 2013 08:13:16 +0000</updated>
                            <resolved>Mon, 4 Feb 2013 08:13:16 +0000</resolved>
                                    <version>2.10.3</version>
                                    <fixVersion>2.10.4</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13551488" author="bvahdat" created="Fri, 11 Jan 2013 20:17:14 +0000"  >&lt;p&gt;I just quickly looked at this and IMHO it&apos;s a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4044&quot; title=&quot;ChoiceProcessor : unable to find the mBeans processor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4044&quot;&gt;&lt;del&gt;CAMEL-4044&lt;/del&gt;&lt;/a&gt;. For example if you would revert one of the changes made there for &lt;tt&gt;ProcessorDefinition&lt;/tt&gt; (line 1215 on trunk) where:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defn &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; TryDefinition) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;has been changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defn &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; TryDefinition || defn &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ChoiceDefinition) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then your route would be fine without any nasty &lt;tt&gt;ClassCastException&lt;/tt&gt;. However it&apos;s not that easy as this change would cause some existing &lt;tt&gt;camel-core&lt;/tt&gt; tests to fail, &lt;b&gt;mainly&lt;/b&gt; at the places where the code has been changed through &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4044&quot; title=&quot;ChoiceProcessor : unable to find the mBeans processor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4044&quot;&gt;&lt;del&gt;CAMEL-4044&lt;/del&gt;&lt;/a&gt; itself. As Claus has already mentioned there that fix has a poor code coverage.&lt;/p&gt;</comment>
                            <comment id="13551782" author="njiang" created="Sat, 12 Jan 2013 03:29:55 +0000"  >&lt;p&gt;To workaround this issue, you can use the direct endpoint to break the main route to some smaller routes.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:abc&quot;&lt;/span&gt;)
    .choice()
        .when(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body} == &lt;span class=&quot;code-quote&quot;&gt;&apos;Please &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not fail&apos;&lt;/span&gt;&quot;&lt;/span&gt;))
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:unmarshal&quot;&lt;/span&gt;)
        .otherwise()
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
        .end();

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:unmarshal&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
            .unmarshal().xstream();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13551900" author="davsclaus" created="Sat, 12 Jan 2013 12:25:36 +0000"  >&lt;p&gt;See this FAQ&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can do this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:abc&quot;&lt;/span&gt;)
    .choice()
        .when(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body} == &lt;span class=&quot;code-quote&quot;&gt;&apos;Please &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not fail&apos;&lt;/span&gt;&quot;&lt;/span&gt;))
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
            .unmarshal(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XStreamDataFormat())
        .otherwise()
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt;)
        .end();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13569766" author="davsclaus" created="Sun, 3 Feb 2013 12:26:06 +0000"  >&lt;p&gt;I found a possible solution.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17dzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251236</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>