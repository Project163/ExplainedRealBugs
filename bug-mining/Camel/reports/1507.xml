<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:45:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4176] camel-http4 component does not support proxy settings for HTTPS</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4176</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Camel-http4 does not support http proxy configuration for HTTPS (https4:// endpoints).&lt;/p&gt;

&lt;p&gt;Scenario 1:&lt;/p&gt;

&lt;p&gt;Camel &amp;#8211; HTTP --&amp;gt; Proxy &amp;#8211; HTTPS4 --&amp;gt; Destination&lt;/p&gt;

&lt;p&gt;http.proxyHost &amp;amp; http.proxyPort are specified and recognized:&lt;/p&gt;

&lt;p&gt;		String _authUsername=&quot;WS_P2P_INTERNAL&quot;;&lt;br/&gt;
		String _authPassword=&quot;WS_P2P_INTERNAL&quot;;&lt;/p&gt;

&lt;p&gt;		from(&quot;servlet:///proxy?matchOnUriPrefix=true&quot;)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_URI)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_PATH)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_QUERY)&lt;/p&gt;

&lt;p&gt;		.to(&quot;https4://aupdc-osb01d:9002/P2P_Creditors/P2P_CreditorWS?wsdl&amp;amp;authUsername=&quot;&lt;ins&gt;_authUsername&lt;/ins&gt;&quot;&amp;amp;authPassword=&quot;&lt;ins&gt;_authPassword&lt;/ins&gt;&quot;&amp;amp;x509HostnameVerifier=AllowAllVerifier&amp;amp;proxyAuthHost=aupdc00-revprx01t&amp;amp;proxyAuthPort=9001&quot;);&lt;/p&gt;


&lt;p&gt;Getting exception:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Scheme &apos;http&apos; not registered.&lt;br/&gt;
	at org.apache.http.conn.scheme.SchemeRegistry.getScheme(SchemeRegistry.java:71)&lt;br/&gt;
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:127)&lt;/p&gt;

&lt;p&gt;Attaching the whole log - http_exception.log&lt;/p&gt;


&lt;p&gt;Scenario 2:&lt;/p&gt;


&lt;p&gt;Camel &amp;#8211; HTTPS --&amp;gt; Proxy &amp;#8211; HTTPS4 --&amp;gt; Destination&lt;/p&gt;

&lt;p&gt;Camel does not seem top recognize and accept https.proxyHost and https.proxyPort settings:&lt;/p&gt;

&lt;p&gt;getContext().getProperties().put(&quot;https.proxyHost&quot;, &quot;aupdc00-revprx01d&quot;);&lt;br/&gt;
getContext().getProperties().put(&quot;https.proxyPort&quot;, &quot;9001&quot;);&lt;/p&gt;


</description>
                <environment>&lt;p&gt;Win 7 x64&lt;br/&gt;
JDK 1.6.0 25&lt;/p&gt;</environment>
        <key id="12512937">CAMEL-4176</key>
            <summary>camel-http4 component does not support proxy settings for HTTPS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="doffe">Don Doffe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jul 2011 06:59:33 +0000</created>
                <updated>Sun, 17 Jul 2011 07:35:19 +0000</updated>
                            <resolved>Sun, 17 Jul 2011 07:35:19 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                    <component>camel-http</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13061059" author="davsclaus" created="Thu, 7 Jul 2011 06:30:41 +0000"  >&lt;p&gt;Ah sorry there is special support for those as properties on the CamelContext. This is very uncommon.&lt;/p&gt;</comment>
                            <comment id="13061074" author="davsclaus" created="Thu, 7 Jul 2011 06:56:10 +0000"  >&lt;p&gt;Ah I debugged a bit and discovered the issue is likely because your http proxy has scheme: http. eg http client will default and use http scheme if you dont specify that.&lt;/p&gt;</comment>
                            <comment id="13061075" author="davsclaus" created="Thu, 7 Jul 2011 06:57:00 +0000"  >&lt;p&gt;Also in scenario 2 you should use &quot;http&quot; and not &quot;https&quot; as documented&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/http4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/http4&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;getContext().getProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.proxyHost&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;aupdc00-revprx01d&quot;&lt;/span&gt;);
getContext().getProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.proxyPort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;9001&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13061079" author="davsclaus" created="Thu, 7 Jul 2011 07:00:57 +0000"  >&lt;p&gt;Okay I think ProxyHttpClientConfigurer should support scheme from the proxyHost. It current dont and thus it default to http.&lt;/p&gt;</comment>
                            <comment id="13061083" author="davsclaus" created="Thu, 7 Jul 2011 07:11:57 +0000"  >&lt;p&gt;We should probably add an option to configure the proxy scheme so you can do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;to(&lt;span class=&quot;code-quote&quot;&gt;&quot;https4:&lt;span class=&quot;code-comment&quot;&gt;//aupdc-osb01d:9002/P2P_Creditors/P2P_CreditorWS?wsdl&amp;amp;authUsername=&quot;&lt;/span&gt;_authUsername&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;authPassword=&quot;&lt;/span&gt;_authPassword&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;x509HostnameVerifier=AllowAllVerifier&amp;amp;proxyAuthHost=aupdc00-revprx01t&amp;amp;proxyAuthPort=9001&amp;amp;proxyAuthScheme=https4&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;eg notice the new proxyAuthScheme.&lt;/p&gt;

&lt;p&gt;For scenario 2 you can then do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;getContext().getProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.proxyHost&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;aupdc00-revprx01d&quot;&lt;/span&gt;);
getContext().getProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.proxyPort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;9001&quot;&lt;/span&gt;);
getContext().getProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.proxyScheme&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;https4&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13061084" author="davsclaus" created="Thu, 7 Jul 2011 07:13:56 +0000"  >&lt;p&gt;We can also default and use the same scheme as the producer if the proxyAuthScheme option has not been explicit set.&lt;/p&gt;

&lt;p&gt;Then it ought to work in the original reported use-case, as Camel will fallback and use the https4&lt;/p&gt;</comment>
                            <comment id="13061096" author="davsclaus" created="Thu, 7 Jul 2011 07:38:41 +0000"  >&lt;p&gt;I have committed a fix on trunk. Can you try with updated source code from trunk?&lt;/p&gt;</comment>
                            <comment id="13061888" author="doffe" created="Fri, 8 Jul 2011 10:44:30 +0000"  >&lt;p&gt;Run the tests.&lt;/p&gt;

&lt;p&gt;When proxy settings are defined in the endpoint URL, it works. If the proxyAuthScheme is defined it is used, otherwise falls back to http4.&lt;/p&gt;

&lt;p&gt;But when the proxy setting are defined globally using getContext().getProperties().put() - it does not. When &quot;http.proxyScheme&quot; is defined it is used. But when it is not the same issue presents itself - camel falls back to http.&lt;/p&gt;
</comment>
                            <comment id="13061955" author="davsclaus" created="Fri, 8 Jul 2011 13:33:04 +0000"  >&lt;p&gt;Don thanks for testing. I have just commited a new fix for that scenario with the getProperties on the CamelContext.&lt;br/&gt;
Can you test again on your system?&lt;/p&gt;</comment>
                            <comment id="13062352" author="doffe" created="Sat, 9 Jul 2011 10:00:16 +0000"  >&lt;p&gt;Run the tests again.&lt;/p&gt;

&lt;p&gt;I can confirm that the component uses proxy scheme correctly: if defined explicitly, it is used, if not - the system falls back to the endpoint scheme.&lt;/p&gt;

&lt;p&gt;Work for both, the endpoint and global params.&lt;/p&gt;

&lt;p&gt;Thanks a lot. nicely done!&lt;/p&gt;</comment>
                            <comment id="13062353" author="davsclaus" created="Sat, 9 Jul 2011 10:08:50 +0000"  >&lt;p&gt;Don, thanks for reporting and testing.&lt;/p&gt;</comment>
                            <comment id="13065644" author="doffe" created="Fri, 15 Jul 2011 01:01:48 +0000"  >&lt;p&gt;I&apos;m testing against the Release Candidate from the repo:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/repositories/orgapachecamel-023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/orgapachecamel-023&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what went wrong, but the issue seem to be back.&lt;/p&gt;

&lt;p&gt;When &lt;br/&gt;
proxyAuthScheme=http4 &lt;br/&gt;
or &lt;br/&gt;
getContext().getProperties().put(&quot;http.proxyScheme&quot;, &quot;http4&quot;);&lt;/p&gt;

&lt;p&gt;are specified on a https4 endpoint I get following exception on invocation:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Scheme &apos;http4&apos; not registered.&lt;br/&gt;
	at org.apache.http.conn.scheme.SchemeRegistry.getScheme(SchemeRegistry.java:71)&lt;br/&gt;
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:127)&lt;br/&gt;
	at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:149)&lt;/p&gt;


</comment>
                            <comment id="13065773" author="davsclaus" created="Fri, 15 Jul 2011 08:41:09 +0000"  >&lt;p&gt;Can you post your Camel route. Do you also use plain http4 scheme, (eg not https)&lt;/p&gt;</comment>
                            <comment id="13065789" author="doffe" created="Fri, 15 Jul 2011 09:07:36 +0000"  >&lt;p&gt;from(&quot;servlet:///proxy?matchOnUriPrefix=true&quot;)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_URI)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_PATH)&lt;br/&gt;
		.removeHeader(Exchange.HTTP_QUERY)&lt;br/&gt;
		.to(&quot;https4://aupdc-osb01d:9002/P2P_Creditors/P2P_CreditorWS?wsdl&quot; +&lt;br/&gt;
				&quot;&amp;amp;authUsername=WS_P2P_INTERNAL&quot;+&lt;br/&gt;
				&quot;&amp;amp;authPassword=WS_P2P_INTERNAL&quot;+&lt;br/&gt;
				&quot;&amp;amp;proxyAuthHost=aupdc00-revprx01d&quot;+&lt;br/&gt;
				&quot;&amp;amp;proxyAuthPort=9001&quot;+&lt;br/&gt;
				&quot;&amp;amp;proxyAuthScheme=http4&quot;+&lt;br/&gt;
				&quot;&amp;amp;x509HostnameVerifier=AllowAllHostnameVerifier&quot;&lt;br/&gt;
				);&lt;/p&gt;

&lt;p&gt;No other endpoint uses http4.The plan was to use http4 only for communication to proxy.&lt;/p&gt;</comment>
                            <comment id="13065807" author="davsclaus" created="Fri, 15 Jul 2011 09:28:10 +0000"  >&lt;p&gt;What runtime container do you use?&lt;/p&gt;</comment>
                            <comment id="13065808" author="davsclaus" created="Fri, 15 Jul 2011 09:28:38 +0000"  >&lt;p&gt;And can you post the full stracktrace?&lt;/p&gt;</comment>
                            <comment id="13065821" author="doffe" created="Fri, 15 Jul 2011 10:00:11 +0000"  >&lt;p&gt;For the time being it is jetty (for testing)&lt;/p&gt;

&lt;p&gt;mvn jetty:run&lt;/p&gt;

&lt;p&gt;Attaching out.log&lt;/p&gt;</comment>
                            <comment id="13065835" author="davsclaus" created="Fri, 15 Jul 2011 10:22:45 +0000"  >&lt;p&gt;Ah so you proxy is plain http on port 9001. &lt;br/&gt;
And you use https on port 9002.&lt;/p&gt;</comment>
                            <comment id="13065841" author="davsclaus" created="Fri, 15 Jul 2011 10:30:29 +0000"  >&lt;p&gt;Don, can you try with the attached JAR. Just renamed it to 2.8.0 and override your existing JAR.&lt;/p&gt;</comment>
                            <comment id="13065847" author="davsclaus" created="Fri, 15 Jul 2011 10:42:16 +0000"  >&lt;p&gt;The last patch&lt;/p&gt;</comment>
                            <comment id="13065860" author="doffe" created="Fri, 15 Jul 2011 11:20:10 +0000"  >&lt;p&gt;I&apos;m getting nullpointer exception.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching the latest log.&lt;/p&gt;

&lt;p&gt;out2.log&lt;/p&gt;

&lt;p&gt;p.s. if you&apos;d like you can reach me directly - forrestline at gmail dt com&lt;/p&gt;</comment>
                            <comment id="13065982" author="davsclaus" created="Fri, 15 Jul 2011 14:53:31 +0000"  >&lt;p&gt;Ah I forgot there is a minor fix in camel-core. So you need to use this JAR also. &lt;/p&gt;</comment>
                            <comment id="13065987" author="davsclaus" created="Fri, 15 Jul 2011 15:00:57 +0000"  >&lt;p&gt;Updated camel-http4 with a minor fix needed as well&lt;/p&gt;</comment>
                            <comment id="13065988" author="davsclaus" created="Fri, 15 Jul 2011 15:01:34 +0000"  >&lt;p&gt;Don you need to use the updated attached camel-core and camel-http4 components. You can just rename them to 2.8.0 and override existing JARs&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486586" name="CAMEL-4176.patch" size="2379" author="davsclaus" created="Fri, 15 Jul 2011 10:42:16 +0000"/>
                            <attachment id="12486624" name="camel-core-2.9-SNAPSHOT.jar" size="1823076" author="davsclaus" created="Fri, 15 Jul 2011 14:53:31 +0000"/>
                            <attachment id="12486626" name="camel-http4-2.9-SNAPSHOT.jar" size="63225" author="davsclaus" created="Fri, 15 Jul 2011 15:00:57 +0000"/>
                            <attachment id="12485381" name="http_exception.log" size="49895" author="doffe" created="Wed, 6 Jul 2011 07:00:20 +0000"/>
                            <attachment id="12486576" name="out.log" size="31295" author="doffe" created="Fri, 15 Jul 2011 10:00:37 +0000"/>
                            <attachment id="12486588" name="out2.log" size="28217" author="doffe" created="Fri, 15 Jul 2011 11:20:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13853</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01zbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>