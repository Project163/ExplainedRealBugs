<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:46:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4354] header added using an EventNotifier is not present at AggregationStrategy for http endpoints</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4354</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A new header added using an EventNotifier is not present when the exchange is aggregated with an AggregationStrategy.&lt;br/&gt;
This is happening only if the enpoint type is http, ftp doesn&apos;t have this issue.&lt;/p&gt;

&lt;p&gt;This was working with an early version of 2.8.0-SNAPSHOT&lt;/p&gt;

&lt;p&gt;Following the EventNotifier code used.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ExchangeSentEventNotifier.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ExchangeSentEventNotifier &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; EventNotifierSupport {

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doStart() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        /*
         *  filter out unwanted events
         *  we are interested only in ExchangeSentEvent
         */
        setIgnoreCamelContextEvents(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreServiceEvents(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreRouteEvents(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreExchangeCreatedEvent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreExchangeCompletedEvent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreExchangeFailedEvents(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        setIgnoreExchangeSentEvents(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);		
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doStop() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEnabled(EventObject event) {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; event &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ExchangeSentEvent;
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void notify(EventObject event) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(event.getClass() == ExchangeSentEvent.class){
            ExchangeSentEvent eventSent = (ExchangeSentEvent)event;
            
            log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Took &quot;&lt;/span&gt; + eventSent.getTimeTaken() + &lt;span class=&quot;code-quote&quot;&gt;&quot; millis to send to: &quot;&lt;/span&gt; + eventSent.getEndpoint());

            &lt;span class=&quot;code-comment&quot;&gt;//storing time taken to the custom header            
&lt;/span&gt;            eventSent.getExchange().getIn().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;x-time-taken&quot;&lt;/span&gt;, eventSent.getTimeTaken());
            
    	}
		
	}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </description>
                <environment>&lt;p&gt;linux/windows&lt;/p&gt;</environment>
        <key id="12519401">CAMEL-4354</key>
            <summary>header added using an EventNotifier is not present at AggregationStrategy for http endpoints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="crive">Marco Crivellaro</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Aug 2011 11:24:26 +0000</created>
                <updated>Fri, 2 Sep 2011 09:15:18 +0000</updated>
                            <resolved>Fri, 19 Aug 2011 17:01:29 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.8.1</fixVersion>
                    <fixVersion>2.9.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13087659" author="davsclaus" created="Fri, 19 Aug 2011 11:30:31 +0000"  >&lt;p&gt;This is actually a miss usage of the EventNotifer as the idea it is a read-only event notification mechanism.&lt;br/&gt;
Any changes on headers is not meant to guaranteed to be preserved etc. &lt;/p&gt;</comment>
                            <comment id="13087663" author="davsclaus" created="Fri, 19 Aug 2011 11:34:23 +0000"  >&lt;p&gt;Also make sure you set the header on the correct IN or OUT. See&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/using-getin-or-getout-methods-on-exchange.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/using-getin-or-getout-methods-on-exchange.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The exchange may very well have an OUT message already, so you should populate it correctly. Storing the detail directly on the Exchange as a property will always preserve it.&lt;/p&gt;</comment>
                            <comment id="13087690" author="crive" created="Fri, 19 Aug 2011 13:00:56 +0000"  >&lt;p&gt;fixed by making use of exchange property&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;eventSent.getExchange().setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;x-time-taken&quot;&lt;/span&gt;, eventSent.getTimeTaken());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13087755" author="davsclaus" created="Fri, 19 Aug 2011 15:15:55 +0000"  >&lt;p&gt;Marco which http component did you use? http4 or the regular http, or the jetty http producer?&lt;/p&gt;</comment>
                            <comment id="13087758" author="davsclaus" created="Fri, 19 Aug 2011 15:23:29 +0000"  >&lt;p&gt;Okay the ExchangeSentEvent is being fired to early for async routing engine. For synchronous routing, the event is emitted &lt;b&gt;after&lt;/b&gt; the producer has completed. For async routing is emitted just after the producer have send, but not waiting for until its done. To keep it consistent we ought to fire the event when the producer is done. Then its the same for sync and async.&lt;/p&gt;</comment>
                            <comment id="13087798" author="davsclaus" created="Fri, 19 Aug 2011 17:01:29 +0000"  >&lt;p&gt;ExchangeSentEvent is now emitted when producer is done for both sync/async routing.&lt;/p&gt;</comment>
                            <comment id="13088555" author="crive" created="Mon, 22 Aug 2011 07:36:28 +0000"  >&lt;p&gt;shall we consider a better practice using an exchange property instead of an header?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13793</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i020f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>