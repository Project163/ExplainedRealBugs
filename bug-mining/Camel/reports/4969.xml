<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:36:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13267] Camel stops consuming queue after restart of RabbitMQ broker</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13267</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I am consuming a RabbitMQ queue as following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;rabbitmq:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?username=test&amp;amp;password=test&amp;amp;declare=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;queue=q&amp;amp;autoAck=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;threadPoolSize=1&amp;amp;exclusiveConsumer=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/span&gt;   .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:receive&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I restart the RabbitMQ broker, no messages are longer received in the log handler.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;According the management interface, all pending messages are in UNACKED state. This means that they are transmitted to the consumer, but not acknowledged. In other words, Camel was able to restore the connection after the restart, but fails to deliver to the log handler and acknowledge them afterwards.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I did not test this, but I believe the&#160;consumer will eventually crash due to OOM.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;example&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please find a self-contained example on &lt;a href=&quot;https://github.com/pbillen/playground-camel-13267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pbillen/playground-camel-13267&lt;/a&gt;.You need a (local) Docker daemon to run this. Use it as following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start with `mvn clean install -U`.&lt;/li&gt;
	&lt;li&gt;You notice in the logging that every 500ms, a message is sent and received. You can also log into the administrator interface on &lt;a href=&quot;http://localhost:15672/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:15672&lt;/a&gt;&#160;with login/password `test`. You will see the message pass through every 500ms. Great!&lt;/li&gt;
	&lt;li&gt;Now restart the RabbitMQ broker. Typically, find the container identifier with `docker ps` and then execute `docker restart &amp;lt;identifier&amp;gt;`.&lt;/li&gt;
	&lt;li&gt;After restart, you notice that every 500ms a message is sent, but not received. You can also log into the administrator interface and see that all messages are into the UNACKED state.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13218311">CAMEL-13267</key>
            <summary>Camel stops consuming queue after restart of RabbitMQ broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="pbillen">Peter Billen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Feb 2019 11:00:26 +0000</created>
                <updated>Tue, 6 Aug 2019 19:12:24 +0000</updated>
                            <resolved>Tue, 6 Aug 2019 19:12:24 +0000</resolved>
                                    <version>2.23.0</version>
                                    <fixVersion>3.0.0.RC1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-rabbitmq</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16779285" author="zregvart" created="Wed, 27 Feb 2019 13:07:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pbillen&quot; class=&quot;user-hover&quot; rel=&quot;pbillen&quot;&gt;pbillen&lt;/a&gt; have you noticed the &lt;tt&gt;automaticRecoveryEnabled&lt;/tt&gt; endpoint property? Take look at the &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-rabbitmq/src/main/docs/rabbitmq-component.adoc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;component documentation&lt;/a&gt; for other automatic recovery options.&lt;/p&gt;</comment>
                            <comment id="16779301" author="pbillen" created="Wed, 27 Feb 2019 13:16:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt; I added an example to the issue description. I will now look into the auto-recovery option. Though, I believe the connection and consumer is already being recovered, as all messages after the restart are into UNACKED state. This means that the messages have been delivered successfully to the consumer, but not yet acknowledged (which makes sense, because they do not seem to be propagated to the log handler, as described in the issue).&lt;/p&gt;

&lt;p&gt;Thanks for feedback! I will let you know if auto recovery helps here.&lt;/p&gt;</comment>
                            <comment id="16779315" author="pbillen" created="Wed, 27 Feb 2019 13:27:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt; Right, everything seems to work fine with `automaticRecoveryEnabled` enabled! This is great, because it solves my use case. Thanks a lot!&lt;/p&gt;

&lt;p&gt;That said, I am wondering what is happening with `automaticRecoveryEnabled` disabled, which is the default. As explained, all messages are in UNACKED state, so they are at consumer side. Where are they? Are they queued? Until when? Don&apos;t we risk going OOM here?&lt;/p&gt;</comment>
                            <comment id="16780703" author="zregvart" created="Thu, 28 Feb 2019 16:31:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pbillen&quot; class=&quot;user-hover&quot; rel=&quot;pbillen&quot;&gt;pbillen&lt;/a&gt; I guess we should set the &lt;tt&gt;automaticRecoveryEnabled&lt;/tt&gt; to true by default, we&apos;re explicitly setting it from &lt;tt&gt;null&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt; (I think because of a change made in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12111&quot; title=&quot;Reconnect doesn&amp;#39;t work if camel is started with rabbit broker initially inaccessible and automaticRecoveryEnabled=true or not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12111&quot;&gt;&lt;del&gt;CAMEL-12111&lt;/del&gt;&lt;/a&gt;). Pull request for that would be very welcome.&lt;/p&gt;

&lt;p&gt;I don&apos;t have the answers to your other questions, and I don&apos;t think Apache Camel community is not the place to ask those, perhaps reach out to RabbitMQ community as Camel is simply utilizing the AMQP client from RabbitMQ.&lt;/p&gt;</comment>
                            <comment id="16901395" author="davsclaus" created="Tue, 6 Aug 2019 19:10:53 +0000"  >&lt;p&gt;Lets enable that option out of the box in camel 3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z004tc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>