<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:43:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15526] Camel-AWS2-S3:  Consume Gzip file from S3 not working. </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15526</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;When consuming Gzip file from S3 using AWS2-S3 component, file not downlaoding properly;&lt;/p&gt;

&lt;p&gt;Same code working for AWS-S3, after upgrading to AWS2-S3, this code not working.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Task:&lt;br/&gt;
 1. Download &quot;myfile.csv.gzip&quot; file from S3.&lt;/p&gt;

&lt;p&gt;2. GUnzip file and send to processor.&lt;br/&gt;
 3. Processor will send file to http end point using multipart upload.&lt;/p&gt;

&lt;p&gt;Here is the code used.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;{{}}&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;from(&quot;aws2-s3://mybucket?amazonS3Client=#amazonS3Client&amp;amp;deleteAfterRead=false&amp;amp;delay=5000&amp;amp;synchronous=true&amp;amp;includeBody=true&amp;amp;autocloseBody=false&amp;amp;prefix=myfile.csv.gz&quot;)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;{{ .unmarshal().gzipDeflater()}}&lt;/p&gt;

&lt;p&gt;{{ .process(@Override public void process(Exchange exchange) throws Exception {}}&lt;/p&gt;

&lt;p&gt;{{ MultipartEntityBuilder multipartEntityBuilder = MultipartEntityBuilder.create();&lt;br/&gt;
 String filename = exchange.getIn().getHeader(AWS2S3Constants.KEY, String.class);&lt;br/&gt;
 String body = exchange.getIn().getBody(String.class);&lt;br/&gt;
 ContentBody cd = new InputStreamBody(new ByteArrayInputStream(body.getBytes()), ContentType.MULTIPART_FORM_DATA, &quot;temp.csv&quot;);&lt;br/&gt;
 multipartEntityBuilder.addPart(&quot;file&quot;, cd);&lt;br/&gt;
 System.out.println(cd);&lt;br/&gt;
 exchange.getOut().setBody(multipartEntityBuilder.build())&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
 .to(&quot;direct:httproute&quot;);}}&lt;/p&gt;

&lt;p&gt;{{}}&lt;/p&gt;

&lt;p&gt;Stack Trace:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Stack Trace&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; WARN software.amazon.awssdk.profiles.internal.ProfileFileReader - Ignoring profile &apos;plugins&apos; on line 6 because it did not start with &apos;profile &apos; and it was not &apos;default&apos;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.support.LRUCacheFactory - Detected and using LRUCacheFactory: camel-caffeine-lrucache&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.component.http.HttpComponent - Created ClientConnectionManager org.apache.http.impl.conn.PoolingHttpClientConnectionManager@1b73be9f&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.component.http.HttpComponent - Created ClientConnectionManager org.apache.http.impl.conn.PoolingHttpClientConnectionManager@35a9782c&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.AbstractCamelContext - Apache Camel 3.4.2 (camel-1) is starting&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.AbstractCamelContext - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at &lt;a href=&quot;http://camel.apache.org/stream-caching.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/stream-caching.html&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.AbstractCamelContext - Using HealthCheck: camel-health&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.InternalRouteStartupManager - Route: route1 started and consuming from: aws2-s3://mybucket&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.InternalRouteStartupManager - Route: route2 started and consuming from: direct://httproute&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.AbstractCamelContext - Total 3 routes, of which 3 are started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.camel.impl.engine.AbstractCamelContext - Apache Camel 3.4.2 (camel-1) started in 1.496 seconds&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Camel (camel-1) thread #1 - aws2-s3://mybucket&amp;#93;&lt;/span&gt; INFO consuming - Consumer Fired!&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Camel (camel-1) thread #1 - aws2-s3://mybucket&amp;#93;&lt;/span&gt; INFO route1 - Replay Message Sent to &lt;a href=&quot;file:s3out&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:s3out&lt;/a&gt; input_2020-07-01-07-20-31-796_0.csv.gz&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Camel (camel-1) thread #1 - aws2-s3://mybucket&amp;#93;&lt;/span&gt; ERROR org.apache.camel.processor.errorhandler.DefaultErrorHandler - Failed delivery for (MessageId: ID-DGHANTA-Mac-1599955541230-0-1 on ExchangeId: ID-DGHANTA-Mac-1599955541230-0-1). Exhausted after delivery attempt: 1 caught: java.util.zip.ZipException: Not in GZIP format&lt;/p&gt;

&lt;p&gt;Message History (complete message history is disabled)&lt;br/&gt;
---------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
RouteId ProcessorId Processor Elapsed (ms)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;route1 &amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;route1 &amp;#93;&lt;/span&gt; [from&lt;span class=&quot;error&quot;&gt;&amp;#91;aws2-s3://mybucket?amazonS3Client=%23&amp;#93;&lt;/span&gt; [ 250]&lt;br/&gt;
 ...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;route1 &amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;unmarshal1 &amp;#93;&lt;/span&gt; [unmarshal&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.model.dataformat.GzipDataFormat@d41f816&amp;#93;&lt;/span&gt; ] [ 0]&lt;/p&gt;

&lt;p&gt;Stacktrace&lt;br/&gt;
---------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;java.util.zip.ZipException: Not in GZIP format&lt;br/&gt;
 at java.util.zip.GZIPInputStream.readHeader(GZIPInputStream.java:165)&lt;br/&gt;
 at java.util.zip.GZIPInputStream.&amp;lt;init&amp;gt;(GZIPInputStream.java:79)&lt;br/&gt;
 at java.util.zip.GZIPInputStream.&amp;lt;init&amp;gt;(GZIPInputStream.java:91)&lt;br/&gt;
 at org.apache.camel.dataformat.deflater.GzipDeflaterDataFormat.unmarshal(GzipDeflaterDataFormat.java:62)&lt;br/&gt;
 at org.apache.camel.support.processor.UnmarshalProcessor.process(UnmarshalProcessor.java:64)&lt;br/&gt;
 at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:395)&lt;br/&gt;
 at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:148)&lt;br/&gt;
 at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:60)&lt;br/&gt;
 at org.apache.camel.processor.Pipeline.process(Pipeline.java:147)&lt;br/&gt;
 at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:286)&lt;br/&gt;
 at org.apache.camel.component.aws2.s3.AWS2S3Consumer.processBatch(AWS2S3Consumer.java:200)&lt;br/&gt;
 at org.apache.camel.component.aws2.s3.AWS2S3Consumer.poll(AWS2S3Consumer.java:113)&lt;br/&gt;
 at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:187)&lt;br/&gt;
 at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:106)&lt;br/&gt;
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
 at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)&lt;br/&gt;
 at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)&lt;br/&gt;
 at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Dinesh&lt;/p&gt;

&lt;p&gt;{{}}&lt;/p&gt;</description>
                <environment>&lt;p&gt;camel Aws2-s3&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13327219">CAMEL-15526</key>
            <summary>Camel-AWS2-S3:  Consume Gzip file from S3 not working. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="edingha">Dinesh</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Sep 2020 13:42:58 +0000</created>
                <updated>Fri, 25 Sep 2020 18:09:12 +0000</updated>
                            <resolved>Fri, 25 Sep 2020 18:09:12 +0000</resolved>
                                    <version>3.4.2</version>
                                    <fixVersion>3.6.0</fixVersion>
                    <fixVersion>3.4.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17194911" author="edingha" created="Sun, 13 Sep 2020 00:22:05 +0000"  >&lt;p&gt;Updated Stack trace.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ijko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>