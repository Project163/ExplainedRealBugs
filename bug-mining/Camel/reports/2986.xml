<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:05:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8077] NullPointerException in getRouteDefinition before context is started</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8077</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Not sure if this occurs in 2.14.0. Does not occur in 2.13.3.&lt;/p&gt;

&lt;p&gt;I am extending CamelSpringTestSupport with:&lt;/p&gt;

&lt;p&gt;@Override&lt;br/&gt;
public boolean isUseAdviceWith() {&lt;br/&gt;
    return true;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;In a @Before method I call context.getRouteDefintion(&quot;some.id&quot;)&lt;/p&gt;

&lt;p&gt;It throws a NullPointerException:&lt;/p&gt;

&lt;p&gt;org.apache.camel.impl.DefaultCamelContext.getRouteDefinition(DefaultCamelContext.java:1464)&lt;/p&gt;

&lt;p&gt;If I put context.start() at the top of the @Before method, it works.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12757321">CAMEL-8077</key>
            <summary>NullPointerException in getRouteDefinition before context is started</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="camelguy">Camel Guy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Nov 2014 02:58:41 +0000</created>
                <updated>Mon, 1 Dec 2014 21:20:08 +0000</updated>
                            <resolved>Sun, 30 Nov 2014 16:02:58 +0000</resolved>
                                    <version>2.14.0</version>
                                    <fixVersion>2.14.1</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14222609" author="njiang" created="Mon, 24 Nov 2014 03:19:18 +0000"  >&lt;p&gt;Are you using Camel 2.14.1-SNAPSHOT?&lt;br/&gt;
Can you show us the whole test case?&lt;/p&gt;</comment>
                            <comment id="14223256" author="camelguy" created="Mon, 24 Nov 2014 18:30:20 +0000"  >&lt;p&gt;Yes, I am using 2.14.1-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;route.getId() returns null when the context has not started.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public synchronized RouteDefinition getRouteDefinition(String id) {
    for (RouteDefinition route : routeDefinitions) {
        if (route.getId().equals(id)) {
            return route;
        }
    }
    return null;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There was a time when I could get one route via getRouteDefinition by id successfully but not another. getRouteDefinition(A) = successful but getRouteDefinition(B) = exception. The difference is that route B is declared in camel-context.xml after route A.&lt;/p&gt;

&lt;p&gt;However, after adding &amp;lt;import&amp;gt; and &amp;lt;routeContextRef&amp;gt;, getRouteDefinition(A) failed too. The route I&apos;m trying to grab is in the main context file, not in the imported one.&lt;/p&gt;

&lt;p&gt;It appears that camel-context.xml is loaded in a background thread and has a race condition with my methods. I have the same problem with @Test methods. I tried sleeping for, say, a minute in @Begin but that doesn&apos;t fix the problem. I also moved the @Begin code to the @Test method and put a sleep there. That doesn&apos;t work either. The only fix is to call context.start().&lt;/p&gt;

&lt;p&gt;In camel-context.xml most routes do not specify an id attribute.&lt;/p&gt;

&lt;p&gt;Here&apos;s my test.java&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;package my.test;

import org.apache.camel.EndpointInject;
import org.apache.camel.ProducerTemplate;
import org.apache.camel.builder.AdviceWithRouteBuilder;
import org.apache.camel.component.mock.MockEndpoint;
import org.apache.camel.model.ModelCamelContext;
import org.apache.camel.model.RouteDefinition;
import org.apache.camel.test.spring.CamelSpringTestSupport;
import org.springframework.context.support.AbstractXmlApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.junit.Before;
import org.junit.Test;

public final class OneJDBCErrorTest extends CamelSpringTestSupport {
	protected AbstractXmlApplicationContext createApplicationContext() {
		return new ClassPathXmlApplicationContext(&quot;META-INF/spring/camel-context.xml&quot;);
	}

	@EndpointInject(uri=&quot;direct:Start&quot;)
	private ProducerTemplate start;

	@EndpointInject(uri=&quot;mock:Test:JDBC:TotalExceptions&quot;)
	private MockEndpoint mockTotalExceptions;

	@EndpointInject(uri=&quot;mock:Test:JDBC:Failed&quot;)
	private MockEndpoint mockJdbcFailed;

	@Override
	public boolean isUseAdviceWith() {
	    return true;
	}

	@Before
	final public void jdbcError() throws Exception {
		context.start(); // bug in 2.14 - this is needed
		
		ModelCamelContext model = (ModelCamelContext) context;

		RouteDefinition jdbc = model.getRouteDefinition(&quot;SQL:JDBC&quot;);
		
		jdbc.adviceWith(context, new AdviceWithRouteBuilder() {
	        @Override
	        public void configure() throws Exception {
	        	weaveById(&quot;test:SQL:JDBC:NextError&quot;).before().to(&quot;mock:Test:JDBC:TotalExceptions&quot;);
	        }
	    }
		);
	}
	
	@Test
	final public void oneFailure() throws Exception {
		mockTotalExceptions.expectedMessageCount(4);
		mockJdbcFailed.expectedMessageCount(0);
		
		context.start();
		start.sendBody(&quot;&quot;);

		mockTotalExceptions.assertIsSatisfied();
		mockJdbcFailed.assertIsSatisfied();

		context.stop();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14229130" author="davsclaus" created="Sun, 30 Nov 2014 15:18:04 +0000"  >&lt;p&gt;You need to set the id of the route&lt;/p&gt;</comment>
                            <comment id="14229140" author="camelguy" created="Sun, 30 Nov 2014 15:51:07 +0000"  >&lt;p&gt;For all routes? This exception doesn&apos;t occur in 2.13. The route with the id it&apos;s looking for exists. Code works as-is if I call context.start() (or downgrade to 2.13 but I need the CamelFreemarkerDataModel feature).&lt;/p&gt;</comment>
                            <comment id="14229700" author="davsclaus" created="Mon, 1 Dec 2014 11:58:17 +0000"  >&lt;p&gt;Yeah for all routes needed until the NPE is gone, or use the other api on CamelContext that returns a List and find the route yourself.&lt;/p&gt;</comment>
                            <comment id="14230480" author="camelguy" created="Mon, 1 Dec 2014 21:19:11 +0000"  >&lt;p&gt;You or someone else fixed the problem on 2.14.1-SNAPSHOT, which I confirmed. Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22p8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>