<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:45:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16178] Enrich with REST+netty hangs when connection is closed without response</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16178</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Enricher hangs when used with REST endpoint utilizing netty when there is no response from the server but the server immediately closes the connection. In such case read timeout is ignored as connection is already closed.&lt;br/&gt;
&#160;&lt;br/&gt;
The reason of this behavior is that &lt;tt&gt;org.apache.camel.component.netty.handlers.ClientChannelHandler.channelInactive&lt;/tt&gt;&#160;contains following conditions for callback invocation when there was no response: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
configuration.isSync() &amp;amp;&amp;amp; !doneUoW &amp;amp;&amp;amp; !messageReceived &amp;amp;&amp;amp; !exceptionHandled
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
doneUoW = exchange.getUnitOfWork() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works as expected when initially there had been UoW in Exchange (this is the case when using &lt;tt&gt;to&lt;/tt&gt;). However, enricher by default (and by design) clears UoW for exchange it creates and this breaks above check.&lt;/p&gt;

&lt;p&gt;Setting &lt;tt&gt;shareUnitOfWork&lt;/tt&gt; for &lt;tt&gt;enrich&lt;/tt&gt; works around the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13357964">CAMEL-16178</key>
            <summary>Enrich with REST+netty hangs when connection is closed without response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="krzysztofjamroz">Krzysztof Jamr&#243;z</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Feb 2021 15:53:48 +0000</created>
                <updated>Thu, 18 Feb 2021 16:08:23 +0000</updated>
                            <resolved>Thu, 18 Feb 2021 16:08:23 +0000</resolved>
                                    <version>3.4.5</version>
                    <version>3.7.2</version>
                                    <fixVersion>3.7.3</fixVersion>
                    <fixVersion>3.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17283010" author="krzysztofjamroz" created="Thu, 11 Feb 2021 12:32:56 +0000"  >&lt;p&gt;I might try to fix it, but I am not sure if adding another flag in &lt;tt&gt;ClientChannelHandler&lt;/tt&gt; (or maybe in &lt;tt&gt;NettyCamelState&lt;/tt&gt;), for example &lt;tt&gt;callbackCalled&lt;/tt&gt; and checking it instead of UoW presence is correct and is the right approach as this would make logic in &lt;tt&gt;ClientChannelHandler&lt;/tt&gt; even more complex than it already is.&lt;/p&gt;</comment>
                            <comment id="17283145" author="davsclaus" created="Thu, 11 Feb 2021 16:37:26 +0000"  >&lt;p&gt;Yeah its not so easy - netty is complex. &lt;/p&gt;</comment>
                            <comment id="17284930" author="krzysztofjamroz" created="Mon, 15 Feb 2021 19:38:06 +0000"  >&lt;p&gt;I started a pull request (&lt;a href=&quot;https://github.com/apache/camel/pull/5093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/5093&lt;/a&gt;) but I found one more problem, because after my fix &lt;tt&gt;NettyReuseChannelTest&lt;/tt&gt; hangs. This is because each &lt;tt&gt;NettyProducer&lt;/tt&gt; (there are 2) has each own &lt;tt&gt;NettyCamelStateCorrelationManager&lt;/tt&gt; each with separate map of &lt;tt&gt;NettyCamelState&lt;/tt&gt;. And when netty is invoked second time, what is supposed to reuse channel, it really reuses it but registers callback in wrong correlation manager. &lt;tt&gt;NettyCamelState&lt;/tt&gt; should be registered in correlation manager for producer that opened the channel but uses correlation manager of sending producer.&lt;/p&gt;</comment>
                            <comment id="17286565" author="davsclaus" created="Thu, 18 Feb 2021 16:08:23 +0000"  >&lt;p&gt;Thanks for working and fixing this&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13359039">CAMEL-16227</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12933665">CAMEL-9527</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12720632">CAMEL-7500</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13020296" name="EnrichWithoutRestResponseTest.java" size="2642" author="krzysztofjamroz" created="Wed, 10 Feb 2021 15:52:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nkco:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>