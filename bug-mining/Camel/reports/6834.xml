<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:07:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20918] Salesforce component does not resubscribe after exception</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20918</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In February this year I raised a ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-20388&quot; title=&quot;Salesforce component does not handshake on the connection failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-20388&quot;&gt;&lt;del&gt;CAMEL-20388&lt;/del&gt;&lt;/a&gt; after observing that the &lt;em&gt;SubscriptionHelper#handshake&lt;/em&gt; method was not being used, as the first thread to invoke it would hang in a deadlock state. After it was fixed there is no deadlock, but two other issues were introduced:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if any exception occurs during the connect phase and the response message does not contain a rehandshake advice, it will permanently disconnect the client,&lt;/li&gt;
	&lt;li&gt;because &lt;em&gt;SubscriptionHelper#connectListener&lt;/em&gt; delegates to a different thread poll and there may be a case whereBayeuxClient sends a request to rehandshake before &lt;em&gt;SubscriptionHelper#connectListener&lt;/em&gt; disconnects the client hance the disconnect will fail and consequently terminate the executor in &lt;em&gt;BayeuxClient&lt;/em&gt;. This results in the following exception being thrown:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
16:56:01.757 [Camel (camel-1) thread #287 - SalesforceHttpClient] DEBUG o.cometd.client.BayeuxClient.598138b - Transport failure: FailureInfo@1d90b9a7[transport=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,cause=java.util.concurrent.RejectedExecutionException: Task java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask@2ed1c350[Not completed, task = java.util.concurrent.Executors$RunnableAdapter@2429a820[Wrapped task = org.cometd.client.http.jetty.JettyHttpClientTransport$$Lambda$1947/0x00007f1581f26718@2aee42d5]] rejected from org.cometd.client.BayeuxClient$Scheduler@6bd348ee[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 27],action=handshake] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {failure={exception=java.util.concurrent.RejectedExecutionException: Task java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask@2ed1c350[Not completed, task = java.util.concurrent.Executors$RunnableAdapter@2429a820[Wrapped task = org.cometd.client.http.jetty.JettyHttpClientTransport$$Lambda$1947/0x00007f1581f26718@2aee42d5]] rejected from org.cometd.client.BayeuxClient$Scheduler@6bd348ee[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 27], message={ext={replay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, supportedConnectionTypes=[&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-polling], channel=/meta/handshake, id=304, version=1.0}, connectionType=&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-polling}, channel=/meta/handshake, id=304, successful=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In addition, because SubscriptionHelper#connectListener clears SubscriptionHelper#connectListener and subscriptionListener doesn&apos;t put the listeners back to the map if the subscription message fails, the Salesforce component will not be able to recover (SubscriptionHelper@listenerMap will be empty).&lt;/p&gt;

&lt;p&gt;Also, SalesforceComponent#REQUEST_TIMEOUT should be greater than 110 sec as this is the default Salesforce timeout for long-polling as per &lt;a href=&quot;https://developer.salesforce.com/docs/atlas.en-us.api_streaming.meta/api_streaming/using_streaming_api_timeouts.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Clients and Timeouts&lt;/a&gt; and &lt;a href=&quot;https://github.com/cometd/cometd/issues/1142#issuecomment-1048256297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CometD#1142&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Otherwise, java.util.concurrent.TimeoutException will be thrown if there are is no event before the timeout expires.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13583777">CAMEL-20918</key>
            <summary>Salesforce component does not resubscribe after exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="bartoszpop">Bartosz Popiela</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jun 2024 10:45:15 +0000</created>
                <updated>Mon, 22 Jul 2024 10:26:57 +0000</updated>
                            <resolved>Mon, 22 Jul 2024 10:26:57 +0000</resolved>
                                    <version>3.22.2</version>
                    <version>4.4.2</version>
                    <version>4.6.0</version>
                                    <fixVersion>4.8.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17860094" author="davsclaus" created="Wed, 26 Jun 2024 08:31:16 +0000"  >&lt;p&gt;Can you update the details about this. And give 4.4.3 a try when its released later this week&lt;/p&gt;</comment>
                            <comment id="17862720" author="davsclaus" created="Wed, 3 Jul 2024 10:46:09 +0000"  >&lt;p&gt;Can you add details ? Also try with 4.4.3 and 4.7.0 when its released&lt;/p&gt;</comment>
                            <comment id="17862911" author="bartoszpop" created="Thu, 4 Jul 2024 02:45:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, yes, it still occurs with 4.4.3 and 4.7.0. I&apos;ll provide a fix this week.&lt;/p&gt;</comment>
                            <comment id="17863118" author="davsclaus" created="Fri, 5 Jul 2024 05:07:38 +0000"  >&lt;p&gt;Thanks for the details. The fix is welcome as PR or attached to this JIRA.&lt;/p&gt;</comment>
                            <comment id="17866202" author="bartoszpop" created="Tue, 16 Jul 2024 01:27:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; can I backport the fix to 4.7. We only use Camel LTS versions and this issue affects our integrations significantly.&lt;/p&gt;</comment>
                            <comment id="17866228" author="ancosen" created="Tue, 16 Jul 2024 05:17:33 +0000"  >&lt;p&gt;4.7.x is not an LTS release, it&apos;s a development release. The next LTS will be 4.8.0&lt;/p&gt;</comment>
                            <comment id="17866338" author="bartoszpop" created="Tue, 16 Jul 2024 09:35:04 +0000"  >&lt;p&gt;Ok, thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12996618">CAMEL-10238</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13567117">CAMEL-20388</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13581573">CAMEL-20834</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pzqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>