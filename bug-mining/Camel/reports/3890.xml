<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:20:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10492] Camel Servlet, attachment object is empty</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10492</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I send a multipart form data to my camel servlet, before camel 2.18 attachment object is ok now is empty!&lt;/p&gt;

&lt;p&gt;Now i have an &lt;b&gt;header&lt;/b&gt; every form field but every field is java.lang.String&lt;/p&gt;

&lt;p&gt;So, I can not post any binary file.&lt;/p&gt;

&lt;p&gt;This is my web.xml filter&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;MultipartFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-class&amp;gt;&lt;/span&gt;org.eclipse.jetty.servlets.MultiPartFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;MultipartFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;CamelServlet&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Into zip file, you can found an example.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13021507">CAMEL-10492</key>
            <summary>Camel Servlet, attachment object is empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="fabryprog">Fabrizio Spataro</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Nov 2016 16:52:56 +0000</created>
                <updated>Tue, 29 Nov 2016 08:59:14 +0000</updated>
                            <resolved>Tue, 29 Nov 2016 08:59:13 +0000</resolved>
                                    <version>2.18.0</version>
                                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-http-common</component>
                    <component>camel-servlet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15676309" author="fabryprog" created="Fri, 18 Nov 2016 09:35:57 +0000"  >&lt;p&gt;i am reading camel source code.&lt;/p&gt;

&lt;p&gt;Into camel 2.18 the attribute atttachmentMultipartBinding is never set&lt;/p&gt;

&lt;p&gt;(look at &lt;a href=&quot;https://github.com/apache/camel/search?utf8=%E2%9C%93&amp;amp;q=setAttachmentMultipartBinding&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/search?utf8=%E2%9C%93&amp;amp;q=setAttachmentMultipartBinding&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Whether to automatic bind multipart/form-data as attachments on the Camel {@link Exchange}.
     * &amp;lt;p/&amp;gt;
     * This is turn off by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; as &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; may require servet specific configuration to enable &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; when using Servlet&apos;s.
     */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setAttachmentMultipartBinding(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; attachmentMultipartBinding) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.attachmentMultipartBinding = attachmentMultipartBinding;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so this check is always false:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ServletEndpoint &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; HttpCommonEndpoint {
.....
.....
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HttpBinding getHttpBinding() {
        &lt;span class=&quot;code-comment&quot;&gt;// make sure we include servlet variant of the http binding
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.binding == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-comment&quot;&gt;// is attachment binding enabled?
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getComponent().isAttachmentMultipartBinding()) {
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.binding = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AttachmentHttpBinding();
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.binding = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultHttpBinding();
            }
          ....... 
          .......
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.binding;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15683044" author="davsclaus" created="Mon, 21 Nov 2016 09:49:07 +0000"  >&lt;p&gt;You need to turn set that = true on the servlet component.&lt;/p&gt;

&lt;p&gt;Add a bean configuration in your xml file&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;servlet=&quot; class=..&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;attachmentMultipartBinding&quot; value=&quot;true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15683059" author="davsclaus" created="Mon, 21 Nov 2016 09:56:56 +0000"  >&lt;p&gt;I made it possible to configure this on endpoint in next release.&lt;/p&gt;</comment>
                            <comment id="15683561" author="fabryprog" created="Mon, 21 Nov 2016 13:21:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; This bug is more complex than it looks. When i set attachmentMultipartBinding property i have another error.&lt;/p&gt;

&lt;p&gt;It isn&apos;t a jetty bug (i had test it with junit) but it, i suppose, is a camel body trasformation bug. I do not know so thoroughly to understand it. Can you help me?&lt;/p&gt;

&lt;p&gt;You can use my zip attach file to debug it!&lt;/p&gt;

&lt;p&gt;Stacktrace&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.camel.RuntimeCamelException: Cannot populate attachments
	at org.apache.camel.component.servlet.AttachmentHttpBinding.populateAttachments(AttachmentHttpBinding.java:58)
	at org.apache.camel.http.common.DefaultHttpBinding.readBody(DefaultHttpBinding.java:209)
	at org.apache.camel.http.common.DefaultHttpBinding.readRequest(DefaultHttpBinding.java:107)
	at org.apache.camel.http.common.HttpMessage.&amp;lt;init&amp;gt;(HttpMessage.java:52)
	at org.apache.camel.http.common.CamelServlet.doService(CamelServlet.java:169)
	at org.apache.camel.http.common.CamelServlet.service(CamelServlet.java:74)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)
	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:830)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:551)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)
	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)
	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1589)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1213)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:486)
	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1552)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1126)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)
	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:118)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)
	at org.eclipse.jetty.server.Server.handle(Server.java:549)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:254)
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:269)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:97)
	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.io.IOException: Missing content &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; multipart request
	at org.eclipse.jetty.util.MultiPartInputStreamParser.parse(MultiPartInputStreamParser.java:541)
	at org.eclipse.jetty.util.MultiPartInputStreamParser.getParts(MultiPartInputStreamParser.java:429)
	at org.eclipse.jetty.server.Request.getParts(Request.java:2300)
	at org.eclipse.jetty.server.Request.getParts(Request.java:2279)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15683828" author="fabryprog" created="Mon, 21 Nov 2016 15:16:11 +0000"  >&lt;p&gt;please, look at my last comment&lt;/p&gt;</comment>
                            <comment id="15686118" author="davsclaus" created="Tue, 22 Nov 2016 08:53:28 +0000"  >&lt;p&gt;You need to test with latest code and turn on that option. And dive in the code and track down the issue on your end. It may depend on what content you send to the servet and what servlet container you use etc.&lt;/p&gt;</comment>
                            <comment id="15701561" author="fabryprog" created="Mon, 28 Nov 2016 10:30:28 +0000"  >&lt;p&gt;I have found a bug into this code. &lt;/p&gt;

&lt;p&gt;I am trying to fix it!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AttachmentHttpBinding &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DefaultHttpBinding {
..................
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void populateAttachments(HttpServletRequest request, HttpMessage message) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            Collection&amp;lt;Part&amp;gt; parts = request.getParts();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Part part : parts) {
                DataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PartDataSource(part);
                Attachment attachment = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultAttachment(ds);
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; headerName : part.getHeaderNames()) {
                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; headerValue : part.getHeaders(headerName)) {
                        attachment.addHeader(headerName, headerValue);
                    }
                }
                message.addAttachmentObject(part.getName(), attachment);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeCamelException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot populate attachments&quot;&lt;/span&gt;, e);
        }
    }
...............
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15701770" author="fabryprog" created="Mon, 28 Nov 2016 11:42:15 +0000"  >&lt;p&gt;I found a workaround to fix my problem:&lt;/p&gt;

&lt;p&gt;Updating my software to 2.18 version my attachments aren&apos;t available, now my servlet code is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;      	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;servlet:hello?servletName=CamelServlet&amp;amp;amp;disableStreamCache=true&amp;amp;amp;attachmentMultipartBinding=true&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i am using two parameters:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;disableStreamCache, &lt;b&gt;is original problem&lt;/b&gt;. With streamcache enable attachment files aren&apos;t available to jetty multicast parser&lt;/li&gt;
	&lt;li&gt;attachmentMultipartBinding, to enable AttachmentHttpBinding into servlet endpoint&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;my old code is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;      	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;servlet:hello?servletName=CamelServlet&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; evaluate you what to do with this issue!&lt;/p&gt;</comment>
                            <comment id="15704689" author="davsclaus" created="Tue, 29 Nov 2016 08:43:01 +0000"  >&lt;p&gt;Ah I think maybe in the past attachmentMultipartBinding=true turned off stream caching to make it work, so we could likely do that again.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12839394" name="camel-example-servlet-attachment.zip" size="11078" author="fabryprog" created="Thu, 17 Nov 2016 16:53:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36gnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>