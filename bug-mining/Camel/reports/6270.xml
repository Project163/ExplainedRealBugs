<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:58:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18576] kamelets - JSon Property value can&apos;t finish with }}</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18576</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi, I&apos;m using Quarkus Camel 2.12.3.Final with YAML DSL and Kamelets and I have a problem passing a JSON value through URI as a query parameter when trying to use the &lt;a href=&quot;https://github.com/apache/camel-kamelets/blob/main/kamelets/elasticsearch-search-source.kamelet.yaml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;elasticsearch-search-source&lt;/a&gt; with a basic query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-json&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;match_all&quot;&lt;/span&gt;:{}}} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Example on the YAML DSL:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Scenario 1
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;query: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;match_all&quot;&lt;/span&gt;:{}}}&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Gives&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: Missing {{ from the text: {&quot;query&quot;:{&quot;match_all&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Scenario 2
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;query: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;{{myQuery}}&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Gives&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: Missing {{ from the text: {&quot;query&quot;:{&quot;match_all&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Scenario 3
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;query: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;#property:myQuery&apos;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Gives&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: Property with key myQuery not found by properties component
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But using debug I&apos;ve checked that the above exception occurs due to the same&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: Missing {{ from the text: {&quot;query&quot;:{&quot;match_all&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Scenario 4&lt;br/&gt;
I&apos;ve also tried to change the Kamelet YAML definition to use the RAW value directly
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
- set-&lt;span class=&quot;code-keyword&quot;&gt;body: &lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;constant: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;RAW({{myQuery}})&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the same result&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: Missing {{ from the text: {&quot;query&quot;:{&quot;match_all&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have a workaround if I add spaces in JSON like below it works in scenarios 1 and 2.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-json&quot;&gt;
{ &lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;: { &lt;span class=&quot;code-quote&quot;&gt;&quot;match_all&quot;&lt;/span&gt;: { } } } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My point is, why do I have to change the JSON value to adapt to the Camel parser? Also, there also might exist some other use case where the value can&apos;t be changed.&lt;/p&gt;

&lt;p&gt;Why don&apos;t you simply have a function that does not try to resolve properties as placeholders recursively? For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;query: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;{{raw:myQuery}}&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Or with a default value&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-yaml&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;query: &lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;{{raw:myQuery:{&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;match_all&quot;&lt;/span&gt;:{}}}}}&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Or at least have a way to escape curly brackets.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13484227">CAMEL-18576</key>
            <summary>kamelets - JSon Property value can&apos;t finish with }}</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="MarcoMartins">Marco Martins</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Oct 2022 10:28:41 +0000</created>
                <updated>Thu, 13 Oct 2022 08:56:42 +0000</updated>
                            <resolved>Thu, 13 Oct 2022 07:54:43 +0000</resolved>
                                                    <fixVersion>3.20.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17614929" author="davsclaus" created="Mon, 10 Oct 2022 07:17:19 +0000"  >&lt;p&gt;Can you paste your route where you use this&lt;/p&gt;</comment>
                            <comment id="17614930" author="davsclaus" created="Mon, 10 Oct 2022 07:19:49 +0000"  >&lt;p&gt;Ah okay, so its the property placeholder that assumes it was a {{ }} pair, where you have no end pair.&lt;/p&gt;</comment>
                            <comment id="17615133" author="davsclaus" created="Mon, 10 Oct 2022 14:15:44 +0000"  >&lt;p&gt;I have reproduced this. So its because of using kamelets where the query is passed in as {{ }} placeholder, and that it has json that have }} as well, and the property placeholder performs nested placeholder (eg a placeholder has also a placeholder, recursive).&lt;/p&gt;

&lt;p&gt;So we need to &quot;think&quot; to find a better way.&lt;/p&gt;</comment>
                            <comment id="17615218" author="JIRAUSER296449" created="Mon, 10 Oct 2022 16:59:56 +0000"  >&lt;p&gt;Yeah, it is because of the placeholder recursivity feature together with the JSON having }} in its body, which, gets the Camel parser confused trying to find the beginning of a placeholder that does not exist.&lt;/p&gt;

&lt;p&gt;Thank you for your availability.&lt;/p&gt;</comment>
                            <comment id="17615624" author="davsclaus" created="Tue, 11 Oct 2022 09:10:26 +0000"  >&lt;p&gt;You can turn off nested on the properties component, but we need to find a better out of the box way for kamelets&lt;/p&gt;</comment>
                            <comment id="17615645" author="JIRAUSER296449" created="Tue, 11 Oct 2022 09:49:26 +0000"  >&lt;p&gt;Can you give me an example of how I could turn off the nested on configuration option? I can&apos;t find any reference to this in &lt;a href=&quot;https://camel.apache.org/components/3.18.x/elasticsearch-rest-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ELASTICSEARCH REST&lt;/a&gt;, &lt;a href=&quot;https://camel.apache.org/components/3.18.x/properties-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PropertiesComponent&lt;/a&gt; documentation nor do I see any obvious property analyzing the &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-elasticsearch-rest/src/main/java/org/apache/camel/component/elasticsearch/ElasticsearchComponent.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ElasticsearchComponent.java&lt;/a&gt; itself.&lt;/p&gt;</comment>
                            <comment id="17615652" author="davsclaus" created="Tue, 11 Oct 2022 09:55:19 +0000"  >&lt;p&gt;See the linked JIRA, and its a new feature in 3.20&lt;/p&gt;</comment>
                            <comment id="17615857" author="JIRAUSER296449" created="Tue, 11 Oct 2022 14:20:34 +0000"  >&lt;p&gt;Thank you, I did look into the changes, and I think I&apos;ve found a discrepancy in one of the commits. On the one that added the new configuration to the documentation&#160;&lt;b&gt;camel.component.properties.nested-placeholder&lt;/b&gt;&#160;mention that the default value is&#160;&lt;b&gt;false&lt;/b&gt;, although, in &#160;&lt;a href=&quot;https://github.com/apache/camel/blob/main/core/camel-base/src/main/java/org/apache/camel/component/properties/PropertiesComponent.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PropertiesComponent.java&lt;/a&gt; the default value is&#160;&lt;b&gt;true&lt;/b&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nestedPlaceholder = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which makes sense for using old library version behavior as default.&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17616013" author="JIRAUSER285918" created="Tue, 11 Oct 2022 18:06:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; I proposed in this PR &lt;a href=&quot;https://github.com/apache/camel/pull/8521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/8521&lt;/a&gt; a fix based on an escape character (backslash) WDYT?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;PS: Sorry to work on your ticket, initially, I just wanted to test an idea.&#160;&lt;/p&gt;</comment>
                            <comment id="17616410" author="davsclaus" created="Wed, 12 Oct 2022 13:09:31 +0000"  >&lt;p&gt;Nicolas, that look good for users that can edit their input and escape the JSon input.&lt;/p&gt;

&lt;p&gt;But for out of the box, we should ideally have a way.&lt;br/&gt;
I have run a full test with nested placeholder disabled and we do not use it very much - only in some special tests for camel-jasypt.&lt;/p&gt;

&lt;p&gt;I have also not seen real world use-cases with nested placeholders. Its only when you may go very fine grained and have a placeholder for hostname, and another for port, and then have a 3rd where you concat them together.&lt;/p&gt;

&lt;p&gt;But lets keep this open for a while and think about if we can have a nicer solution out of the box - but even then this problem is only when you have double {{ and }} which ought to be more rare for even JSon payloads. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=MarcoMartins&quot; class=&quot;user-hover&quot; rel=&quot;MarcoMartins&quot;&gt;MarcoMartins&lt;/a&gt; do you see the double `{{` used more often in your ES queries ?&lt;/p&gt;</comment>
                            <comment id="17616429" author="JIRAUSER296449" created="Wed, 12 Oct 2022 13:41:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; I don&apos;t see the `{{` pattern appear often on ES queries since they&apos;re JSON payloads and JSON can&apos;t have two `{{`, although, they could appear as a field value to be searched.&#160;&lt;/p&gt;

&lt;p&gt;This issue occurred without the {{ since Camel was looking for }} pattern which occurs very often in JSON, and if found it would consider that it was a property placeholder and when looking for the beginning of the &quot;false property&quot; it would not find it since there was no `{{`.&lt;/p&gt;</comment>
                            <comment id="17616432" author="JIRAUSER285918" created="Wed, 12 Oct 2022 13:48:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; Should I revert the fix that I proposed?&lt;/p&gt;</comment>
                            <comment id="17616439" author="davsclaus" created="Wed, 12 Oct 2022 13:55:12 +0000"  >&lt;p&gt;Nicolas, no its actually a good new functionality that end users can escape property placeholder values to make them literal values and not the begin or end markers&lt;/p&gt;</comment>
                            <comment id="17616778" author="davsclaus" created="Thu, 13 Oct 2022 05:19:34 +0000"  >&lt;p&gt;1&lt;br/&gt;
We could introduce &lt;tt&gt;myKey?nested=false&lt;/tt&gt; as a way to turn off nested for a specific placeholder. &lt;/p&gt;

&lt;p&gt;2&lt;br/&gt;
We can also relax the {{ }} check on level 2+ since its the value of the placeholder that cannot always be assumed to be another placeholder&lt;/p&gt;</comment>
                            <comment id="17616854" author="davsclaus" created="Thu, 13 Oct 2022 07:54:43 +0000"  >&lt;p&gt;Okay so the best we can do for now is&lt;/p&gt;

&lt;p&gt;a) allow to turn of nested placeholder globally&lt;br/&gt;
b) allow escaping property values&lt;br/&gt;
c) turn of nested on specific placeholder&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13485596">CAMEL-18600</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z190ko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>