<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:33:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-1652] Memory leak in File component when using batch processing</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1652</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;http://www.nabble.com/convertBodyTo-heap-problem-to23743181.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/convertBodyTo-heap-problem-to23743181.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When using a file endpoint with sorting as start of a route then the files are processed in a batch. In the current implementation this means a List of exchanges is created and given to the batch processing. The list is then traversed and each exchange is processed. This means the list references all exchanges during the whole batch processing. So none of the exchanges can be collected by the garbage collector till the whole batch is fully processed.&lt;/p&gt;

&lt;p&gt;The problem really becomes bad when the exchanges are large. For example if you use convertBodyTo(String.class) and the files are large. If you have 100 files with 10 MB each then camel will consume 1 GB of heap. What is even worse is that it seems the processing simply stops when the heap is full. &lt;/p&gt;

&lt;p&gt;I have written a small test that shows the problem and a patch that corrects this problem. I hope this gets into 2.0-M2 as this is a quite serious bug. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12486445">CAMEL-1652</key>
            <summary>Memory leak in File component when using batch processing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="cschneider">Christian Schneider</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 May 2009 21:45:28 +0000</created>
                <updated>Tue, 16 Jun 2009 03:06:50 +0000</updated>
                            <resolved>Thu, 28 May 2009 05:05:31 +0000</resolved>
                                    <version>2.0-M1</version>
                                    <fixVersion>2.0-M2</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12952338" author="chris@die-schneider.net" created="Wed, 27 May 2009 21:47:04 +0000"  >&lt;p&gt;Test and patch for this issue&lt;/p&gt;</comment>
                            <comment id="12952339" author="njiang" created="Wed, 27 May 2009 23:57:20 +0000"  >&lt;p&gt;@claus&lt;/p&gt;

&lt;p&gt;I think this issue is introduced by the recent new feature of BatchConsumer &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1640&quot; title=&quot;BatchConsumer - Allow consumers to be batch aware&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1640&quot;&gt;&lt;del&gt;CAMEL-1640&lt;/del&gt;&lt;/a&gt;, you may need to recheck the components of mail, ibatis, jpa.  &lt;/p&gt;</comment>
                            <comment id="12952340" author="davsclaus" created="Thu, 28 May 2009 04:18:20 +0000"  >&lt;p&gt;@willem&lt;/p&gt;

&lt;p&gt;The bug has been there before &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1640&quot; title=&quot;BatchConsumer - Allow consumers to be batch aware&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1640&quot;&gt;&lt;del&gt;CAMEL-1640&lt;/del&gt;&lt;/a&gt;, it used a List for quite some time. But glad we discovered it and have a fix for it.&lt;/p&gt;

&lt;p&gt;Yes it should be applied to the other listed here:&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/batch-consumer.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/batch-consumer.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12952346" author="davsclaus" created="Thu, 28 May 2009 04:35:45 +0000"  >&lt;p&gt;Running the unit test for 30 sec on my laptop: &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Before patch:&lt;/b&gt; usage = 42mb&lt;br/&gt;
&lt;b&gt;After patch:&lt;/b&gt; usage = 5mb&lt;/p&gt;
</comment>
                            <comment id="12952344" author="davsclaus" created="Thu, 28 May 2009 04:40:23 +0000"  >&lt;p&gt;Not critical, as there is a workaround by clearing the exchange body after usage.&lt;/p&gt;</comment>
                            <comment id="12952345" author="davsclaus" created="Thu, 28 May 2009 05:05:31 +0000"  >&lt;p&gt;trunk: 779434.&lt;/p&gt;

&lt;p&gt;Thanks Christian for the patch and unit test.&lt;/p&gt;

&lt;p&gt;I have applied the fix for the other BatchConsumer components as well.&lt;/p&gt;</comment>
                            <comment id="12952387" author="chris@die-schneider.net" created="Thu, 28 May 2009 22:16:13 +0000"  >&lt;p&gt;Thanks for committing the patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462966" name="camel-core.patch" size="5317" author="cschneider" created="Wed, 27 May 2009 21:47:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76781</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01jqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6966</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>