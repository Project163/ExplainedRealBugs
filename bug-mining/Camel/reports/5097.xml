<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:38:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-14190] JMSComponent tries to use applicationContext before it is initialised</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-14190</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The method&#160;getConfiguration checks if&#160;applicationContext is null. If not it will try to automatically initialise the&#160;ConnectionFactory and the DestinationResolver.&lt;/p&gt;

&lt;p&gt;The problem is that&#160;applicationContext will always be null when used with&#160;JmsComponentAutoConfiguration (or the corresponding classes in other similar starters)&#160; because the method&#160;setApplicationContext is called only after the method that creates the bean returns and because the auto configuration class also calls&#160;CamelPropertiesHelper.setCamelProperties which in turn calls getConfiguration.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13269162">CAMEL-14190</key>
            <summary>JMSComponent tries to use applicationContext before it is initialised</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="ccronemberger">Constantino Cronemberger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Nov 2019 21:05:09 +0000</created>
                <updated>Mon, 25 Nov 2019 09:16:11 +0000</updated>
                            <resolved>Thu, 21 Nov 2019 13:09:22 +0000</resolved>
                                    <version>3.0.0.RC3</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-jms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16977237" author="davsclaus" created="Tue, 19 Nov 2019 08:24:43 +0000"  >&lt;p&gt;Can you tell more about in which use-case you have this problem - the camel-jms component are very much in use and we havent got any issues reported before like this.&lt;/p&gt;</comment>
                            <comment id="16977309" author="ccronemberger" created="Tue, 19 Nov 2019 09:43:56 +0000"  >&lt;p&gt;I&apos;m trying to use camel-jms-starter and have the ConnectionFactory automatically set.&lt;br/&gt;
 I first made camel-jms work specifying the connection factory as an URI parameter (jms:queue:my-queue?connectionFactory=#myConnectionFactory). After that my next step was to start using camel-jms-starter so I could get rid of the connectionFactory parameter in all URIs. So I replaced camel-jms by camel-jms-starter in the pom and removed the URI parameter and added the following line in the application.properties:&lt;/p&gt;

&lt;p&gt; camel.component.jms.connection-factory=#myConnectionFactory&lt;/p&gt;

&lt;p&gt; Then I found that the # notation does not work in this case and finally I found (by checking the code) that I should not even need to set the connection factory because it should be automatically set if a connection factory bean is found in the application context. Then while debugging it I found that by the first time the getConfiguration method is called the attribute applicationContext is null, so the a configuration is created without the existing connection factory set on it.&lt;/p&gt;

&lt;p&gt; More information about the problem with # can be found in my last comment in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12956&quot; title=&quot;Spring Boot Auto-Configuration via application.properties does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12956&quot;&gt;&lt;del&gt;CAMEL-12956&lt;/del&gt;&lt;/a&gt;. There you can find the steps to reproduce it.&lt;/p&gt;</comment>
                            <comment id="16977310" author="davsclaus" created="Tue, 19 Nov 2019 09:47:38 +0000"  >&lt;p&gt;Hmm the # lookup ought to work, how have you setup your JMS CF &lt;/p&gt;</comment>
                            <comment id="16977311" author="davsclaus" created="Tue, 19 Nov 2019 09:47:38 +0000"  >&lt;p&gt;Hmm the # lookup ought to work, how have you setup your JMS CF &lt;/p&gt;</comment>
                            <comment id="16977428" author="ccronemberger" created="Tue, 19 Nov 2019 12:10:50 +0000"  >&lt;p&gt;I tried with # in the ActiveMQ example and it worked there, so something is missing in my actual project.&lt;/p&gt;

&lt;p&gt;In regard to automatic initialization of connection factory out of an existing one I confirmed that it happens in the camel-example-spring-boot-activemq project with the difference that in the case of ActiveMQ it implements the method createConnectionFactory, so it gives the impression that everything is ok, but in fact it is creating a second connection factory instead of using the existing one.&#160;&lt;/p&gt;</comment>
                            <comment id="16977453" author="ccronemberger" created="Tue, 19 Nov 2019 12:44:42 +0000"  >&lt;p&gt;Comparing camel-example-spring-boot-activemq with my code I found a significant difference that can explain why # does not work in my case.&lt;/p&gt;

&lt;p&gt;In ActiveMQ example the target in the Binder.bind method is:&lt;/p&gt;

&lt;p&gt;private java.lang.String org.apache.camel.component.activemq.springboot.ActiveMQComponentConfiguration.connectionFactory&lt;/p&gt;

&lt;p&gt;while in JMS the target is:&lt;/p&gt;

&lt;p&gt;private javax.jms.ConnectionFactory org.apache.camel.component.jms.springboot.JmsComponentConfiguration$JmsConfigurationNestedConfiguration.connectionFactory&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As you can see in the one that works the type is String and in the one that doesn&apos;t it is ConnectionFactory.&lt;/p&gt;</comment>
                            <comment id="16977489" author="ccronemberger" created="Tue, 19 Nov 2019 13:27:21 +0000"  >&lt;p&gt;In the JMS Component documentation page I found multiple connection factory related options:&lt;/p&gt;

&lt;p&gt;camel.component.jms.connection-factory&lt;/p&gt;

&lt;p&gt;camel.component.jms.configuration.connection-factory&lt;/p&gt;

&lt;p&gt;camel.component.jms.configuration.listener-connection-factory&lt;/p&gt;

&lt;p&gt;camel.component.jms.configuration.template-connection-factory&lt;/p&gt;

&lt;p&gt;only&#160;camel.component.jms.connection-factory works with #.**&lt;/p&gt;</comment>
                            <comment id="16977490" author="ccronemberger" created="Tue, 19 Nov 2019 13:28:14 +0000"  >&lt;p&gt;So the workaround for this bug is to set&#160;camel.component.jms.connection-factory with the name of the connection factory prefixed with #.&lt;/p&gt;</comment>
                            <comment id="16977819" author="ccronemberger" created="Tue, 19 Nov 2019 20:23:53 +0000"  >&lt;p&gt;I have debugged some tests in the camel-jms module and found that the order of the calls to JmsComponent.getConfiguration and JmsComponent.setApplicationContext is actually the opposite of what happens when running with Spring Boot.&lt;/p&gt;

&lt;p&gt;Looks like the major challenge to fix this issue will be to rework the tests and not the actual fix.&lt;/p&gt;

&lt;p&gt;Or maybe the code should be prepared to work no matter the order of the calls to those methods.&lt;/p&gt;</comment>
                            <comment id="16979109" author="davsclaus" created="Thu, 21 Nov 2019 09:07:44 +0000"  >&lt;p&gt;The example camel-example-spring-boot-activemq is using spring boot activemq starter and not Camel&apos;s starter. So its SB that setup ActiveMQ broker, and Camel just uses it, where it in JmsComponent does the auto-lookup of the CF. (so the camel-jms-starter is not in use at all)&lt;/p&gt;


</comment>
                            <comment id="16979113" author="davsclaus" created="Thu, 21 Nov 2019 09:10:53 +0000"  >&lt;p&gt;I have fixed the getConfiguration issue so those are lookup of CF, resolver etc are done in doStart which is more correct in Camel&lt;/p&gt;</comment>
                            <comment id="16979206" author="davsclaus" created="Thu, 21 Nov 2019 11:55:22 +0000"  >&lt;p&gt;Yeah the spring-boot docs is wrong, the nested configuration.xxx are duplicated which they shouldn&apos;t.&lt;/p&gt;

&lt;p&gt;So this is correct&lt;br/&gt;
camel.component.jms.connection-factory=#myConnectionFactory&lt;/p&gt;

&lt;p&gt;And it works if I modify the spring-boot example on master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13270401">CAMEL-14213</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13269839">CAMEL-14202</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08rag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>