<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:05:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17829] camel-as2 - issue in MDN response condition</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17829</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The MDN implementation has a field status that can be used to tell the requester if the message was processed with success or if any error occurred.&lt;/p&gt;

&lt;p&gt;The default template has that field in &lt;b&gt;$dispositionType&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;private static final String DEFAULT_MDN_MESSAGE_TEMPLATE = &quot;MDN for -\n&quot;
                                                           + &quot; Message ID: $requestHeaders[\&quot;Message-Id\&quot;]\n&quot;
                                                           + &quot;  Subject: $requestHeaders[\&quot;Subject\&quot;]\n&quot;
                                                           + &quot;  Date: $requestHeaders[\&quot;Date\&quot;]\n&quot;
                                                           + &quot;  From: $requestHeaders[\&quot;AS2-From\&quot;]\n&quot;
                                                           + &quot;  To: $requestHeaders[\&quot;AS2-To\&quot;]\n&quot;
                                                           + &quot;  Received on: $responseHeaders[\&quot;Date\&quot;]\n&quot;
                                                           + &quot; Status: $dispositionType \n&quot;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The issue is in the condition that determines if the MDN should be returned with success status or error status:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ResponseMDN.java

if (AS2DispositionType.FAILED.getType()
        .equals(HttpMessageUtils.getHeaderValue(request, AS2Header.DISPOSITION_TYPE))) {...}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This condition is looking at the &lt;b&gt;request header&lt;/b&gt; Disposition-Type which is not correct. If the requester sends this header with &lt;b&gt;failed&lt;/b&gt; the MDN will be returned with failed status regardless of the execution status of the receiver.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13434609">CAMEL-17829</key>
            <summary>camel-as2 - issue in MDN response condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jono">Jono Morris</assignee>
                                    <reporter username="joao.r.miranda">Jo&#227;o Miranda</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2022 18:21:38 +0000</created>
                <updated>Tue, 7 May 2024 13:58:36 +0000</updated>
                            <resolved>Tue, 7 May 2024 13:58:36 +0000</resolved>
                                                    <fixVersion>4.7.0</fixVersion>
                                    <component>camel-as2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17509050" author="davsclaus" created="Fri, 18 Mar 2022 19:37:09 +0000"  >&lt;p&gt;Can you send a PR to implement this fix?&lt;/p&gt;</comment>
                            <comment id="17511822" author="JIRAUSER286801" created="Thu, 24 Mar 2022 12:02:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; !&#160;&lt;/p&gt;

&lt;p&gt;I took a look at the MDN implementation and at the &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4130&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AS2 RFC&lt;/a&gt;. The issue seems to be bigger if my interpretation of the RFC is correct.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4130#section-7.6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Section 7.6&lt;/a&gt; says:&lt;br/&gt;
(...)&lt;br/&gt;
Status codes in the 200 range SHOULD also be used when an entity is returned (a signed receipt in a multipart/signed content type or an unsigned receipt in a multipart/report).  Even when the disposition of the data was an error condition at the authentication, decryption or other higher level, the HTTP status code SHOULD indicate success at the HTTP level.&lt;br/&gt;
Currently this is not happening. If an authentication, decryption or other error occurs during AS2 processing, an HttpException is raised and the component responds with status 500.&#160;&lt;br/&gt;
The ResponseMDN class is an HTTP interceptor that runs right before the response is sent back to the requester... I see 2 problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I&apos;m not sure if changing the HttpResponse (including the http status code) at this stage would be appropriate.&lt;/li&gt;
	&lt;li&gt;Since the AS2 processing finished with error, the context does not have the HttpCoreContext.HTTP_REQUEST in the MDNResponse class. The request is necessary to obtain the AS2 headers sent by the requester.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17843722" author="davsclaus" created="Mon, 6 May 2024 11:53:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jono_morris&quot; class=&quot;user-hover&quot; rel=&quot;jono_morris&quot;&gt;jono_morris&lt;/a&gt; maybe you have fixed or improved this recently with your work on camel-as2 ?&lt;/p&gt;</comment>
                            <comment id="17844237" author="jono" created="Tue, 7 May 2024 10:38:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; From the spec it seems the only thing that would cause a &apos;failure&apos; disposition is a client requesting a signed receipt with non-standard Disposition-notification-options, e.g. something other than:&lt;/p&gt;

&lt;p&gt;&#160;Disposition-notification-options: &lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160;signed-receipt-protocol=required,pkcs7-signature; &lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160;signed-receipt-micalg=required,sha1,md5&lt;/p&gt;

&lt;p&gt;Camel-as2 doesn&apos;t seem to validate these options at all, e.g. assumes pkcs7-signature and defaults to sha1, so such a failure will never occur.&#160;&lt;/p&gt;

&lt;p&gt;So the failure MDN block could be removed as it&apos;s never used, or we can read the attribute from HttpContext instead of the request in case disposition handling is improved in future e.g.&#160; &lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; if (AS2DispositionType.FAILED.getType() &lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .equals(coreContext.getAttribute(DISPOSITION_TYPE))) {&lt;/p&gt;</comment>
                            <comment id="17844247" author="davsclaus" created="Tue, 7 May 2024 10:56:33 +0000"  >&lt;p&gt;Okay Jono, what do you recommend to do?&lt;/p&gt;</comment>
                            <comment id="17844260" author="jono" created="Tue, 7 May 2024 11:55:08 +0000"  >&lt;p&gt;I think reading the disposition type from the HttpContext is the best way forward so that Camel-as2 can continue to be improved.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10mew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>