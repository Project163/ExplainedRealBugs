<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:54:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4171] Groovy language - classNotFoundException in OSGi environment</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4171</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The problem is in the following method of the GroovyLanguage&lt;/p&gt;

&lt;p&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
protected Class&amp;lt;Script&amp;gt; parseExpression(String expression) {&lt;br/&gt;
    return new GroovyClassLoader().parseClass(expression);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It uses the default constructor to create GroovyClassLoader, which uses Thread context classloader, which may not be equal to the classloader of the bundle where the camel context is defined.&lt;/p&gt;



&lt;p&gt;Caused by: java.lang.NoClassDefFoundError: groovy/lang/Script&lt;br/&gt;
	at java.lang.ClassLoader.defineClass1(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.ClassLoader.defineClassCond(ClassLoader.java:632)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:616)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.access$300(GroovyClassLoader.java:55)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$ClassCollector.createClass(GroovyClassLoader.java:519)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$ClassCollector.onClassNode(GroovyClassLoader.java:536)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$ClassCollector.call(GroovyClassLoader.java:540)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit$11.call(CompilationUnit.java:747)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:932)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:509)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:487)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:464)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:306)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:287)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:267)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:214)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:224)&lt;br/&gt;
	at org.apache.camel.language.groovy.GroovyLanguage.parseExpression(GroovyLanguage.java:44)&lt;br/&gt;
	at org.apache.camel.language.groovy.GroovyLanguage.createExpression(GroovyLanguage.java:38)&lt;br/&gt;
	at org.apache.camel.language.groovy.GroovyLanguage.createExpression(GroovyLanguage.java:27)&lt;br/&gt;
	at org.apache.camel.component.language.LanguageProducer.process(LanguageProducer.java:41)&lt;span class=&quot;error&quot;&gt;&amp;#91;68:org.apache.camel.camel-core:2.6.0.fuse-01-09&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50)&lt;span class=&quot;error&quot;&gt;&amp;#91;68:org.apache.camel.camel-core:2.6.0.fuse-01-09&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 92 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: groovy.lang.Script&lt;br/&gt;
	at java.net.URLClassLoader$1.run(URLClassLoader.java:202)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:307)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:696)&lt;span class=&quot;error&quot;&gt;&amp;#91;134:groovy-all:1.7.5&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$InnerLoader.loadClass(GroovyClassLoader.java:449)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:793)&lt;span class=&quot;error&quot;&gt;&amp;#91;134:groovy-all:1.7.5&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_24&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 115 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12512458">CAMEL-4171</key>
            <summary>Groovy language - classNotFoundException in OSGi environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="szhemzhitsky">Sergey Zhemzhitsky</reporter>
                        <labels>
                            <label>camel-groovy</label>
                    </labels>
                <created>Fri, 1 Jul 2011 12:00:20 +0000</created>
                <updated>Mon, 22 Oct 2012 12:44:12 +0000</updated>
                            <resolved>Mon, 22 Oct 2012 12:44:12 +0000</resolved>
                                    <version>2.7.2</version>
                                    <fixVersion>2.9.5</fixVersion>
                    <fixVersion>2.10.3</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                    <component>camel-groovy</component>
                    <component>osgi</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13058694" author="davsclaus" created="Fri, 1 Jul 2011 18:28:18 +0000"  >&lt;p&gt;Do you have a camel route or unit test etc. To reproduce this issue? &lt;br/&gt;
And what osgi container are you using. And do you use felix or equionox?&lt;/p&gt;</comment>
                            <comment id="13058891" author="ffang" created="Sat, 2 Jul 2011 01:08:28 +0000"  >&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;A quick question, does your customer bundle already import groovy.lang package?&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="13059257" author="szhemzhitsky" created="Sun, 3 Jul 2011 18:47:55 +0000"  >&lt;p&gt;Hi, I think that the problem is I&apos;m using cxf and it sets thread context class loader somewhere.&lt;br/&gt;
I will prepare unit test to demonstrate the problem.&lt;/p&gt;</comment>
                            <comment id="13059307" author="njiang" created="Mon, 4 Jul 2011 00:52:11 +0000"  >&lt;p&gt;Which version of CXF are you using?&lt;br/&gt;
I think we fixed some issue of Jetty TCCL with &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3497&quot; title=&quot;Set the ClassLoader Extension when the bus is loaded from Spring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-3497&quot;&gt;&lt;del&gt;CXF-3497&lt;/del&gt;&lt;/a&gt; few month ago.&lt;/p&gt;
</comment>
                            <comment id="13061103" author="szhemzhitsky" created="Thu, 7 Jul 2011 07:46:18 +0000"  >&lt;p&gt;Hi, I&apos;m using cxf 2.3.3.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3497&quot; title=&quot;Set the ClassLoader Extension when the bus is loaded from Spring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-3497&quot;&gt;&lt;del&gt;CXF-3497&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3503&quot; title=&quot;CXF should set the TCCL to the one of the service being invoked prior any invocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-3503&quot;&gt;&lt;del&gt;CXF-3503&lt;/del&gt;&lt;/a&gt; seem very similar to this issue.&lt;/p&gt;</comment>
                            <comment id="13103606" author="davsclaus" created="Tue, 13 Sep 2011 13:03:30 +0000"  >&lt;p&gt;Can you try with the new Camel 2.8.1 release?&lt;/p&gt;</comment>
                            <comment id="13103608" author="davsclaus" created="Tue, 13 Sep 2011 13:04:06 +0000"  >&lt;p&gt;And with OSGi do you use Blueprint or Spring-dm?&lt;br/&gt;
And what OSGi container do you run on? SMX, Karaf, something else?&lt;/p&gt;</comment>
                            <comment id="13144678" author="davsclaus" created="Sat, 5 Nov 2011 13:09:18 +0000"  >&lt;p&gt;Any update? Did you try with a later release or created an unit test?&lt;/p&gt;</comment>
                            <comment id="13145249" author="szhemzhitsky" created="Mon, 7 Nov 2011 06:36:30 +0000"  >&lt;p&gt;Hello Claus,&lt;/p&gt;

&lt;p&gt;Sorry for such a long answer,&lt;br/&gt;
I&apos;m using ServiceMix + Spring DM and going to check it asap.&lt;/p&gt;

</comment>
                            <comment id="13145271" author="szhemzhitsky" created="Mon, 7 Nov 2011 07:29:03 +0000"  >&lt;p&gt;Hello Claus,&lt;/p&gt;

&lt;p&gt;I can&apos;t reproduce this issue anymore with camel 2.8.0 and cxf 2.4.2.&lt;br/&gt;
I suppose this issue can be resolved as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3497&quot; title=&quot;Set the ClassLoader Extension when the bus is loaded from Spring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-3497&quot;&gt;&lt;del&gt;CXF-3497&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3503&quot; title=&quot;CXF should set the TCCL to the one of the service being invoked prior any invocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-3503&quot;&gt;&lt;del&gt;CXF-3503&lt;/del&gt;&lt;/a&gt; as those issues has already been fixed and they look very similar to this one.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Sergey&lt;/p&gt;</comment>
                            <comment id="13145274" author="davsclaus" created="Mon, 7 Nov 2011 07:31:46 +0000"  >&lt;p&gt;Great to know its working now. Thanks for testing.&lt;/p&gt;</comment>
                            <comment id="13479951" author="amarkevich" created="Fri, 19 Oct 2012 10:59:56 +0000"  >&lt;p&gt;camel 2.10.2:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;install feature &apos;camel-groovy&apos;;&lt;/li&gt;
	&lt;li&gt;deploy attached sample: the same exception&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13480975" author="davsclaus" created="Sun, 21 Oct 2012 14:28:51 +0000"  >&lt;p&gt;Well OSGi is often hard to use, and this is such a case.&lt;/p&gt;

&lt;p&gt;Your application that uses groovy would in theory need to import all the osgi packages you application uses.  So what you can do is to instruct the bundle to use dynamic imports, then it works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;instructions&amp;gt;&lt;/span&gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Bundle-SymbolicName&amp;gt;&lt;/span&gt;${project.artifactId}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Bundle-SymbolicName&amp;gt;&lt;/span&gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Bundle-Description&amp;gt;&lt;/span&gt;${project.description}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Bundle-Description&amp;gt;&lt;/span&gt;
	  	        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DynamicImport-Package&amp;gt;&lt;/span&gt;*&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DynamicImport-Package&amp;gt;&lt;/span&gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Private-Package&amp;gt;&lt;/span&gt;org.apache.servicemix.examples.camel&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Private-Package&amp;gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/instructions&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13481341" author="davsclaus" created="Mon, 22 Oct 2012 12:44:12 +0000"  >&lt;p&gt;We are now using GroovyShell to parse and evaluate the script.&lt;/p&gt;

&lt;p&gt;The attached sample works on Karaf 2.2.9 now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12602309">CAMEL-5493</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12549971" name="camel-osgi.zip" size="6361" author="amarkevich" created="Fri, 19 Oct 2012 10:59:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01za7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>