<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:53:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5525] Load balancing with &#8220;Random&#8221; policy is not halfway evenly distributed to endPoint with vast exchange </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5525</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Look the code about choosing processor in camel: &lt;a href=&quot;http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/RandomLoadBalancer.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/RandomLoadBalancer.html&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
 protected synchronized Processor chooseProcessor(List&amp;lt;Processor&amp;gt; processors, Exchange exchange) {
        int size = processors.size();
        while (true) {
            int index = (int) Math.round(Math.random() * size);
            if (index &amp;lt; size) {
                return processors.get(index);
            }
        }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;For example, processors.size() = 3,&lt;br/&gt;
so, Math.random() * size = 0.0 .. 3.0,&lt;br/&gt;
So, index is either 0, or 1, or 2, or 3,&lt;br/&gt;
so there is four variants, while we are looking for three variants.&lt;br/&gt;
and, variant &quot;3&quot; is then thrown away in &quot;if&quot; comparison and re-selected.that is a source of uneveningness.when there are vast message exchange, the load radio for three endpoints are approach to 20%,40%,40%. it is unreasonable radio,should approach 33% allowing the amount of difference for each endpoint(smaller than 10%). &lt;/p&gt;

&lt;p&gt;For the above code, can replace &quot;int index = (int) Math.round(Math.random() * size)&quot; with &quot;int index = (int)Math.ceil(Math.random() * 3 - 1)&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12604189">CAMEL-5525</key>
            <summary>Load balancing with &#8220;Random&#8221; policy is not halfway evenly distributed to endPoint with vast exchange </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="xlding">Xiaoli Ding</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2012 08:34:24 +0000</created>
                <updated>Sun, 26 Aug 2012 10:15:12 +0000</updated>
                            <resolved>Sun, 26 Aug 2012 10:15:12 +0000</resolved>
                                                    <fixVersion>2.9.4</fixVersion>
                    <fixVersion>2.10.2</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13442067" author="davsclaus" created="Sun, 26 Aug 2012 10:01:31 +0000"  >&lt;p&gt;Thanks for reporting. I did a test run with a simpler new logic vs the old logic, by running 100000 in a foor loop with a size of 3.&lt;/p&gt;


&lt;p&gt;New code&lt;br/&gt;
33255&lt;br/&gt;
33315&lt;br/&gt;
33430&lt;/p&gt;

&lt;p&gt;Old code&lt;br/&gt;
19976&lt;br/&gt;
39819&lt;br/&gt;
40205&lt;/p&gt;


&lt;p&gt;As you can see there is a flaw in the old code, pickup the last element more often.&lt;/p&gt;</comment>
                            <comment id="13442070" author="davsclaus" created="Sun, 26 Aug 2012 10:15:12 +0000"  >&lt;p&gt;Thanks for reporting.&lt;/p&gt;

&lt;p&gt;I did a simpler fix by using Random that is easer to understand.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i027mf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>