<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:41:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-14915] Trying to create directory (FtpOperations.buildDirectory) without starting directory in ftps URI</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-14915</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I setup a route using this FTPS URI:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ftps://filetransfer.bpost.be/?bridgeErrorHandler=true&amp;amp;connectTimeout=60000&amp;amp;delay=600000&amp;amp;disconnect=true&amp;amp;idempotent=true&amp;amp;idempotentKey=......&amp;amp;idempotentRepository=%23gfpIdempotentRepository&amp;amp;ignoreFileNotFoundOrPermissionError=true&amp;amp;localWorkDirectory=%2Ftmp%2F895c3952-e3f7-401f-b38f-055fcdf44301&amp;amp;maxMessagesPerPoll=0&amp;amp;move=archive&amp;amp;passiveMode=true&amp;amp;password=xxxxxx
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can see we didn&apos;t specify starting directory which we assume it would be defaulted to &quot;/&quot;, but actually inside the code it gets defaulted to &quot;&quot; empty.&lt;/p&gt;

&lt;p&gt;Upon debugging, I see this behavior from camel &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-ftp/src/main/java/org/apache/camel/component/file/remote/FtpConsumer.java#L77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FtpConsumer.doStart()&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    connectIfNecessary();
                    operations.buildDirectory(endpoint.getConfiguration().getDirectory(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (GenericFileOperationFailedException e) {
                    &lt;span class=&quot;code-comment&quot;&gt;// log a WARN as we want to start the consumer.
&lt;/span&gt;                    LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error auto creating directory: &quot;&lt;/span&gt; + endpoint.getConfiguration().getDirectory() + &lt;span class=&quot;code-quote&quot;&gt;&quot; due &quot;&lt;/span&gt; + e.getMessage() + &lt;span class=&quot;code-quote&quot;&gt;&quot;. This exception is ignored.&quot;&lt;/span&gt;, e);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now my ftp URI doesn&apos;t have starting directory, (which is optional according to &lt;a href=&quot;https://camel.apache.org/components/latest/ftps-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/latest/ftps-component.html&lt;/a&gt;), so the `getDirector()` here returns &quot;&quot; empty string. And then inside &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-ftp/src/main/java/org/apache/camel/component/file/remote/FtpOperations.java#L359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FtpOperations.buildDirectory()&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// maybe the full directory already exists
&lt;/span&gt;                success = client.changeWorkingDirectory(directory);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!success) {
                    log.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Trying to build remote directory: {}&quot;&lt;/span&gt;, directory);
                    success = client.makeDirectory(directory);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!success) {
                        &lt;span class=&quot;code-comment&quot;&gt;// we are here &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the server side doesn&apos;t create
&lt;/span&gt;                        &lt;span class=&quot;code-comment&quot;&gt;// intermediate folders so create the folder one by one
&lt;/span&gt;                        success = buildDirectoryChunks(directory);
                    }
                }

                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; success;
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It tries first to enter the &quot;&quot; directory, which failed. Then it tried to makeDirectory(&quot;&quot;), which failed as well, after a very long timeout.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Of course we can use &quot;autoCreate=false&quot; to turn this behavior off. But my question is why do we want to try to autoCreate a directory when the directory string is actually &quot;&quot; empty?&lt;/p&gt;</description>
                <environment>&lt;p&gt;mac/linux&lt;/p&gt;</environment>
        <key id="13298645">CAMEL-14915</key>
            <summary>Trying to create directory (FtpOperations.buildDirectory) without starting directory in ftps URI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jinfengnarvar">Jin Feng</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Apr 2020 19:38:05 +0000</created>
                <updated>Tue, 28 Apr 2020 12:03:11 +0000</updated>
                            <resolved>Tue, 28 Apr 2020 12:03:11 +0000</resolved>
                                    <version>2.24.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17084743" author="davsclaus" created="Thu, 16 Apr 2020 10:42:52 +0000"  >&lt;p&gt;Yeah lets improved this to detect the empty dir and skip attempting to create one&lt;/p&gt;</comment>
                            <comment id="17085752" author="jinfengnarvar" created="Fri, 17 Apr 2020 13:38:23 +0000"  >&lt;p&gt;Seems like the problem is worse than I reported initially. I worked around the initial `buildDirectory()` failure and long timeout by using `autoCreate=false`, that got the route created and started successfully. But later, file retrieval always met with&#160;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed: 125 Data connection already open; transfer starting.\r
  Read timed out. Code: 125
  \tat org.apache.camel.component.file.remote.FtpOperations.listFiles(FtpOperations.java:886)
  \tat org.apache.camel.component.file.remote.strategy.FtpChangedExclusiveReadLockStrategy.acquireExclusiveReadLock(FtpChangedExclusiveReadLockStrategy.java:95)
  \tat org.apache.camel.component.file.strategy.GenericFileProcessStrategySupport.begin(GenericFileProcessStrategySupport.java:64)
  \tat org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.begin(GenericFileRenameProcessStrategy.java:37)
  \tat org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:362)
  \tat org.apache.camel.component.file.remote.RemoteFileConsumer.processExchange(RemoteFileConsumer.java:133)
  \tat org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:223)
  \tat org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:187)
  \tat org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:174)
  \tat org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:101)
  \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
  \tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
  \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
  \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
  \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  \tat java.lang.Thread.run(Thread.java:748)
  Caused by: java.net.SocketTimeoutException: Read timed out
  \tat java.net.SocketInputStream.socketRead0(Native Method)
  \tat java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
  \tat java.net.SocketInputStream.read(SocketInputStream.java:171)
  \tat java.net.SocketInputStream.read(SocketInputStream.java:141)
  \tat sun.security.ssl.InputRecord.readFully(InputRecord.java:465)
  \tat sun.security.ssl.InputRecord.read(InputRecord.java:503)
  \tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:975)
  \tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1367)
  \tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1395)
  \tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1379)
  \tat org.apache.commons.net.ftp.FTPSClient._openDataConnection_(FTPSClient.java:646)
  \tat org.apache.commons.net.ftp.FTPClient._openDataConnection_(FTPClient.java:785)
  \tat org.apache.commons.net.ftp.FTPClient.initiateListParsing(FTPClient.java:3409)
  \tat org.apache.commons.net.ftp.FTPClient.initiateListParsing(FTPClient.java:3339)
  \tat org.apache.commons.net.ftp.FTPClient.listFiles(FTPClient.java:3016)
  \tat org.apache.camel.component.file.remote.FtpOperations.listFiles(FtpOperations.java:878)
  \t... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I finally worked around the problem by changing my ftp uri to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ftps://filetransfer.bpost.be//
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice the extra / there? Everything now worked fine. But that seems very strange and extra burden on camel user to take care of this default (missing) starting directory situation.&lt;/p&gt;</comment>
                            <comment id="17086408" author="dmvolod" created="Sat, 18 Apr 2020 10:28:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jinfengnarvar&quot; class=&quot;user-hover&quot; rel=&quot;jinfengnarvar&quot;&gt;jinfengnarvar&lt;/a&gt;, yes, looks like you are right.&lt;/p&gt;

&lt;p&gt;We should set &apos;directory&apos; to \ if it&apos;s not set explicitly&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dog8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>