<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:01:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7146] NPE in Aggregator when completionSize = 1</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7146</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A Camel aggregator with persistence repository cannot have a completionSize of 1. If this is configured, every message produces a NPE with the attached stacktrace. &lt;/p&gt;

&lt;p&gt;I have also attached a small example project that shows the Exception. As soon as the completionSize is &amp;gt; 1, it runs fine.&lt;/p&gt;

&lt;p&gt;This is just a minor flaw, since I cannot think about a really useful case with completionSize 1, but it worked with earlier versions of Camel. &lt;/p&gt;

&lt;p&gt;As an alternative (if completionSize 1 should not be used), Camel could throw an error during Context startup when completionSize &amp;lt; 2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12690219">CAMEL-7146</key>
            <summary>NPE in Aggregator when completionSize = 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="sburkard">Stefan Burkard</reporter>
                        <labels>
                            <label>aggregator</label>
                    </labels>
                <created>Wed, 22 Jan 2014 08:32:29 +0000</created>
                <updated>Thu, 6 Feb 2014 09:51:40 +0000</updated>
                            <resolved>Thu, 6 Feb 2014 09:51:40 +0000</resolved>
                                    <version>2.12.2</version>
                                    <fixVersion>2.12.3</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13878398" author="sburkard" created="Wed, 22 Jan 2014 08:33:43 +0000"  >&lt;p&gt;The NPE stacktrace&lt;/p&gt;</comment>
                            <comment id="13878400" author="sburkard" created="Wed, 22 Jan 2014 08:37:58 +0000"  >&lt;p&gt;Example project that shows the behaviour with completionSize = 1&lt;/p&gt;</comment>
                            <comment id="13889552" author="sburkard" created="Mon, 3 Feb 2014 15:24:52 +0000"  >&lt;p&gt;I edited the description of the issue since I analyzed the issue in the Camel code. &lt;/p&gt;

&lt;p&gt;In the method &quot;doAggregation&quot; the aggregator evaluates if the aggregation is complete. With completionSize = 1 this is the case on every Exchange. Therefore the aggregator does not persist the Exchanges, but skips this part: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;AggregateProcessor.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (complete == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
	doAggregationRepositoryAdd(newExchange.getContext(), key, originalExchange, answer);
	&lt;span class=&quot;code-comment&quot;&gt;// we are not complete so the answer should be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;	answer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the other hand does the method &quot;onCompletion&quot; no such evaluation and tries to delete the Exchange in the Repository. Therefore the NPE.&lt;/p&gt;</comment>
                            <comment id="13892029" author="davsclaus" created="Wed, 5 Feb 2014 11:59:18 +0000"  >&lt;p&gt;Yeah completion size = 1 doesnot so much sense, but you can also have a completion predicate that just returns true each time, and have the same situation with only 1 aggregated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12624303" name="Camel-7146-example.tgz" size="4533" author="sburkard" created="Wed, 22 Jan 2014 08:37:58 +0000"/>
                            <attachment id="12624302" name="Camel-7146-stacktrace.txt" size="4674" author="sburkard" created="Wed, 22 Jan 2014 08:33:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rmp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369478</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>