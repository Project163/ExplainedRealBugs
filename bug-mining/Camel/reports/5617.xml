<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:45:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16252] [camel-azure-storage-blob] Stream caching bug due to unsupported InputStream mark operation</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16252</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Already asked the question in the mailing list. &lt;b&gt;Claus Ibsen stated that this is actually a bug:&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Ad 1)&lt;/b&gt;&lt;br/&gt;
&lt;b&gt;Yes that seems like a little bug. You are welcome to create a JIRA ticket.&lt;/b&gt;&lt;/p&gt;


&lt;p&gt;Here is my description of the bug:&lt;br/&gt;
&amp;lt;dependency&amp;gt;&lt;br/&gt;
 &#160;&#160;&#160; &amp;lt;groupId&amp;gt;org.apache.camel.springboot&amp;lt;/groupId&amp;gt;&lt;br/&gt;
 &#160;&#160;&#160; &amp;lt;artifactId&amp;gt;camel-azure-storage-blob-starter&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;version&amp;gt;3.7.0&amp;lt;/version&amp;gt;&lt;br/&gt;
 &amp;lt;/dependency&amp;gt;&lt;/p&gt;



&lt;p&gt;We are currently trying to integrate azure cloud by using the &lt;b&gt;camel-azure-storage-blob&lt;/b&gt; component. Everything works fine until we activate &lt;b&gt;stream caching&lt;/b&gt; and camel starts to spool the payload. In this case we get the following error:&lt;/p&gt;


&lt;p&gt; Caused by: java.lang.IllegalArgumentException: InputStream of body exchange does not support mark/rest operations.&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.BlobStreamAndLength.createBlobStreamAndLengthFromExchangeBody(BlobStreamAndLength.java:52)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.operations.BlobOperations.uploadBlockBlob(BlobOperations.java:181)&lt;/p&gt;

&lt;p&gt;I have looked into the source and think that the component does not load the stream properly from the FileInputStreamCache object.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13360344">CAMEL-16252</key>
            <summary>[camel-azure-storage-blob] Stream caching bug due to unsupported InputStream mark operation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omarsmak">Omar Al-Safi</assignee>
                                    <reporter username="mueller110">Christian M&#252;ller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2021 14:12:26 +0000</created>
                <updated>Fri, 26 Feb 2021 11:35:16 +0000</updated>
                            <resolved>Fri, 26 Feb 2021 11:35:10 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.7.3</fixVersion>
                    <fixVersion>3.9.0</fixVersion>
                                    <component>camel-azure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17290978" author="omarsmak" created="Thu, 25 Feb 2021 15:08:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mueller110&quot; class=&quot;user-hover&quot; rel=&quot;mueller110&quot;&gt;mueller110&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;How do you enable the stream caching, can you please share with me DSL code/steps that have you taken here? The way I see it in &lt;a href=&quot;https://github.com/apache/camel/blob/e53235ba80bb6ad43e786380edb207f526b105bc/core/camel-support/src/main/java/org/apache/camel/converter/stream/FileInputStreamCache.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FileInputStreamCache&lt;/a&gt;, it doesn&apos;t support mark operation. &lt;br/&gt;
The issue is, the &lt;tt&gt;InputStream&lt;/tt&gt; implementation that is required by Azure SDK needs to implement both &lt;tt&gt;mark&lt;/tt&gt; and &lt;tt&gt;reset&lt;/tt&gt; and hence throwing this exception before processing the input stream. &lt;/p&gt;</comment>
                            <comment id="17291011" author="omarsmak" created="Thu, 25 Feb 2021 15:59:13 +0000"  >&lt;p&gt;Okay I checked again, Azure SDK needs only &lt;tt&gt;reset&lt;/tt&gt; operation and hence the fix should be straightforward. Nevertheless, It would be nice if you can attache a snippet of your route, just to confirm the issue. &lt;/p&gt;</comment>
                            <comment id="17291066" author="mueller110" created="Thu, 25 Feb 2021 17:27:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omarsmak&quot; class=&quot;user-hover&quot; rel=&quot;omarsmak&quot;&gt;omarsmak&lt;/a&gt;,&#160;&lt;br/&gt;
i attached the code snippet. we activate camels stream caching via springboot:&lt;/p&gt;

&lt;p&gt;camel:&lt;br/&gt;
&#160; springboot:&lt;br/&gt;
&#160; &#160; stream-caching-enabled: true&lt;/p&gt;

&lt;p&gt;Thx for looking into the problem!&lt;br/&gt;
Regards Christian&lt;/p&gt;</comment>
                            <comment id="17291587" author="omarsmak" created="Fri, 26 Feb 2021 11:35:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mueller110&quot; class=&quot;user-hover&quot; rel=&quot;mueller110&quot;&gt;mueller110&lt;/a&gt; should be fixed now. It will be released with 3.7.3 and 3.9.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13021222" name="azuredsl.txt" size="730" author="mueller110" created="Thu, 25 Feb 2021 17:26:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nz0o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>