<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:21:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10914] CxfConsumer doesn&apos;t clean up the CXF endpoint MBean upon stop</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10914</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;tt&gt;CxfConsumer&lt;/tt&gt;&apos;s &lt;tt&gt;doStop()&lt;/tt&gt; method just does &lt;tt&gt;server.stop()&lt;/tt&gt; and not &lt;tt&gt;server.destroy()&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doStop() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        server.stop();
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.doStop();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This leads to a growing number of dangling endpoint MBeans on CXF side which are never used.&lt;/p&gt;

&lt;p&gt;To reproduce the issue, extract the attached reproducer &lt;tt&gt;camel-cxf-hawtio.zip&lt;/tt&gt; and do the following steps:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Run the following command:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ mvn hawtio:camel
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Access hawtio Camel tab &lt;a href=&quot;http://localhost:8080/hawtio/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/hawtio/&lt;/a&gt;. Start and stop the route &lt;tt&gt;cxf-greeting&lt;/tt&gt; several times.&lt;/li&gt;
	&lt;li&gt;Go to hawtio JMX tab and check CXF endpoint MBeans are growing.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13047279">CAMEL-10914</key>
            <summary>CxfConsumer doesn&apos;t clean up the CXF endpoint MBean upon stop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tadayosi">Tadayoshi Sato</assignee>
                                    <reporter username="tadayosi">Tadayoshi Sato</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Mar 2017 11:15:09 +0000</created>
                <updated>Tue, 20 Apr 2021 06:25:00 +0000</updated>
                            <resolved>Thu, 2 Mar 2017 08:12:46 +0000</resolved>
                                    <version>2.18.2</version>
                                    <fixVersion>2.17.6</fixVersion>
                    <fixVersion>2.18.3</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15889996" author="githubbot" created="Wed, 1 Mar 2017 11:23:24 +0000"  >&lt;p&gt;GitHub user tadayosi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1498&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;: CxfConsumer doesn&apos;t clean up the CXF endpoint MBean upon stop&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-10914&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tadayosi/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tadayosi/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1498.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1498.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1498&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6d31d169dc17138ed02ad1164a4b2209729677fc&lt;br/&gt;
Author: Tadayoshi Sato &amp;lt;sato.tadayoshi@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-01T11:20:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;: CxfConsumer doesn&apos;t clean up the CXF endpoint MBean upon stop&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15890030" author="davsclaus" created="Wed, 1 Mar 2017 11:50:04 +0000"  >&lt;p&gt;Thanks Tada, I granted your user karma to self assign tickets in JIRA&lt;/p&gt;</comment>
                            <comment id="15891366" author="tadayosi" created="Thu, 2 Mar 2017 00:36:09 +0000"  >&lt;p&gt;Great! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15891368" author="githubbot" created="Thu, 2 Mar 2017 00:36:50 +0000"  >&lt;p&gt;Github user tadayosi closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1498&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15891384" author="njiang" created="Thu, 2 Mar 2017 00:56:46 +0000"  >&lt;p&gt;cxfRsConsumer&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; has the same problem, it&apos;s better to fix that part of code too.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;https://github.com/apache/camel/blob/master/components/camel-cxf/src/main/java/org/apache/camel/component/cxf/jaxrs/CxfRsConsumer.java&lt;/p&gt;</comment>
                            <comment id="15891410" author="tadayosi" created="Thu, 2 Mar 2017 01:22:45 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=njiang&quot; class=&quot;user-hover&quot; rel=&quot;njiang&quot;&gt;njiang&lt;/a&gt; for the good catch. I&apos;ll send another pull req soon.&lt;/p&gt;</comment>
                            <comment id="15891457" author="githubbot" created="Thu, 2 Mar 2017 01:53:06 +0000"  >&lt;p&gt;GitHub user tadayosi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1500&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;: Apply the same fix as CxfConsumer to CxfRsConsumer&lt;/p&gt;

&lt;p&gt;    Follow-up fix to: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-10914&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @WillemJiang @oscerd @davsclaus Can anyone merge this too, please?&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tadayosi/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tadayosi/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;_2&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1500.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1500.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1500&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d6330e34f702ee619f5a6ac579f54314e278a440&lt;br/&gt;
Author: Tadayoshi Sato &amp;lt;sato.tadayoshi@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-02T01:31:57Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10914&quot; title=&quot;CxfConsumer doesn&amp;#39;t clean up the CXF endpoint MBean upon stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10914&quot;&gt;&lt;del&gt;CAMEL-10914&lt;/del&gt;&lt;/a&gt;: Apply the same fix as CxfConsumer to CxfRsConsumer&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15891778" author="githubbot" created="Thu, 2 Mar 2017 08:08:53 +0000"  >&lt;p&gt;Github user tadayosi closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1500&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17324902" author="mash-sap" created="Mon, 19 Apr 2021 09:25:20 +0000"  >&lt;p&gt;Even this change is quite old, we just experience some problems with it. So I hope this is the right place to ask a question related to this change.&lt;/p&gt;

&lt;p&gt;Setup:&lt;br/&gt;
 Route1 - CXFConsumer with endpoint address /test is already running&lt;br/&gt;
 Route2 - Gets started with CXFConsumer with same endpoint /test&lt;/p&gt;

&lt;p&gt;The expected behavior: Route2 startup fails (endpoint already registered on address). Route1 keeps running.&lt;/p&gt;

&lt;p&gt;Expected error on Route2 (endpoint already registered on address):&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/cxf/blob/master/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingFactory.java#L918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/master/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingFactory.java#L918&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Due to the change in this ticket, server.destroy() will be called after failed startup:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/tadayosi/camel/commit/6d31d169dc17138ed02ad1164a4b2209729677fc#diff-174b6ca7cb178d3dc464aa9355d148d95fc0a3ad3f7edb60f0293fac988d3e05R100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tadayosi/camel/commit/6d31d169dc17138ed02ad1164a4b2209729677fc#diff-174b6ca7cb178d3dc464aa9355d148d95fc0a3ad3f7edb60f0293fac988d3e05R100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And it will eventually unregister the route:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/endpoint/ServerImpl.java#L191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/endpoint/ServerImpl.java#L191&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Observed behavior:&lt;br/&gt;
 After failed startup of Route2, Route1 is not registered anymore (HTTP 404 when trying to call /test). I could not reproduce this with embedded Jetty, but we experience this with tomcat on production.&lt;/p&gt;

&lt;p&gt;Do you have any suggestion how this could be reproduced in a test using tomcat? Is there a simple way to replace jetty with tomcat?&lt;/p&gt;</comment>
                            <comment id="17325493" author="tadayosi" created="Tue, 20 Apr 2021 06:04:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt; Hmm, my first impression is that you should just not try to register the same endpoint twice. Having duplicate consumers with exact same endpoint URI sounds application configuration issue rather than a bug with Camel.&lt;/p&gt;

&lt;p&gt;That said, I&apos;d file another JIRA with link to this one as &apos;is caused by&apos; and discuss your issue further there.&lt;/p&gt;</comment>
                            <comment id="17325507" author="mash-sap" created="Tue, 20 Apr 2021 06:25:00 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tadayosi&quot; class=&quot;user-hover&quot; rel=&quot;tadayosi&quot;&gt;tadayosi&lt;/a&gt;. I created a new ticket:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16532&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-16532&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12929422">CAMEL-9502</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12855349" name="camel-cxf-hawtio.zip" size="5362" author="tadayosi" created="Wed, 1 Mar 2017 11:19:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://issues.jboss.org/browse/ENTESB-6605]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3as9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>