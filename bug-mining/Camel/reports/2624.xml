<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:01:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7139] Problem with MvelExpression class visibility between camel bundles</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7139</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://camel.465427.n5.nabble.com/Problem-with-camel-routes-running-in-apache-karaf-2-3-3-td5745929.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.465427.n5.nabble.com/Problem-with-camel-routes-running-in-apache-karaf-2-3-3-td5745929.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am having problems with with class visibility between osgi bundles when using camel 2.12 and 2.13-SNAPSHOT. I have created a showcase to reproduce the problem based on camel example projects. I have tested the created solution in camel 2.10 and problem does not exist.&lt;/p&gt;

&lt;p&gt;I have created a sample application which is able to reproduce the problem. Please pick it up from my forked repo:&lt;br/&gt;
&lt;a href=&quot;https://github.com/andrzej-majewski/camel/tree/MvelExpression-class-visibility&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/andrzej-majewski/camel/tree/MvelExpression-class-visibility&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;The problem occurs when&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;camel-example-osgi-domain - project containing only domain classes required by different osgi projects ex.( org.apache.camel.example.osgi.domain.MyPojo )&lt;/li&gt;
	&lt;li&gt;camel-example-osgi-mvel -  example project which has dependency on camel-example-osgi-domain&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now camel-example-osgi-mvel has following camel context.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;   
&amp;lt;beans xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.springframework.org/schema/beans&quot;&lt;/span&gt;  
&lt;/span&gt;       xmlns:xsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;  
&lt;/span&gt;       xmlns:camel=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/spring&quot;&lt;/span&gt;  
&lt;/span&gt;       xsi:schemaLocation=&quot;   
         http:&lt;span class=&quot;code-comment&quot;&gt;//www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd  
&lt;/span&gt;         http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&amp;gt;  
&lt;/span&gt;  
    
  &amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/spring&quot;&lt;/span&gt;&amp;gt;  
&lt;/span&gt;  
    &amp;lt;route&amp;gt;  
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//mytestTrigger?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;amp;period=10000&quot;&lt;/span&gt;/&amp;gt;  
&lt;/span&gt;      &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;myTestFactory&quot;&lt;/span&gt;/&amp;gt;  
    &amp;lt;/route&amp;gt;  
    &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;mvelTest&quot;&lt;/span&gt;&amp;gt;  
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:&lt;span class=&quot;code-comment&quot;&gt;//myMvelTest?concurrentConsumers=2&quot;&lt;/span&gt;/&amp;gt;  
&lt;/span&gt;      &amp;lt;choice&amp;gt;  
      &amp;lt;when&amp;gt;  
        &amp;lt;mvel&amp;gt;request.body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.camel.example.osgi.MyPojo&amp;lt;/mvel&amp;gt;  
      &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;log:MvelRouter&quot;&lt;/span&gt;/&amp;gt;  
      &amp;lt;/when&amp;gt;            
      &amp;lt;/choice&amp;gt;  
    &amp;lt;/route&amp;gt;  
          
  &amp;lt;/camelContext&amp;gt;  
  
  &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;myTestFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.example.osgi.MyTestFactory&quot;&lt;/span&gt;&amp;gt;  
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;numberOfMessages&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;/&amp;gt;  
  &amp;lt;/bean&amp;gt;  
  
&amp;lt;/beans&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I deploy both feature to karaf and place a message on seda://myMvelTest queue I get following exception in karaf.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR | eda:&lt;span class=&quot;code-comment&quot;&gt;//myMvelTest | DefaultErrorHandler              | rg.apache.camel.util.CamelLogger  215 | 73 - org.apache.camel.camel-core - 2.13.0.SNAPSHOT | Failed delivery &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MessageId: ID-localhost-51000-1389691121739-1-56 on ExchangeId: ID-localhost-51000-1389691121739-1-85). Exhausted after delivery attempt: 1 caught: org.apache.camel.ExpressionEvaluationException: [Error: could not access: org; in class: org.apache.camel.language.mvel.RootObject]
&lt;/span&gt;[Near : {... est.body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.camel.example.osgi. ....}]
                                 ^
[Line: 1, Column: 25]
 
Message History
---------------------------------------------------------------------------------------------------------------------------------------
RouteId              ProcessorId          Processor                                                                        Elapsed (ms)
[mvelTest          ] [mvelTest          ] [seda:&lt;span class=&quot;code-comment&quot;&gt;//myMvelTest?concurrentConsumers=2                                       ] [        14]
&lt;/span&gt;[mvelTest          ] [choice2           ] [when[mvel{Mvel[request.body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.camel.example.osgi.MyPojo]}]] [         0]
 
Exchange
---------------------------------------------------------------------------------------------------------------------------------------
Exchange[
        Id                  ID-localhost-51000-1389691121739-1-85
        ExchangePattern     InOut
        Headers             {breadcrumbId=ID-localhost-51000-1389691121739-1-56, CamelRedelivered=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CamelRedeliveryCounter=0}
        BodyType            org.apache.camel.example.osgi.MyPojo
        Body                org.apache.camel.example.osgi.MyPojo@21093d9e
]
 
Stacktrace
---------------------------------------------------------------------------------------------------------------------------------------
org.apache.camel.ExpressionEvaluationException: [Error: could not access: org; in class: org.apache.camel.language.mvel.RootObject]
[Near : {... est.body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.camel.example.osgi. ....}]
                                 ^
[Line: 1, Column: 25]
        at org.apache.camel.language.mvel.MvelExpression.evaluate(MvelExpression.java:60)[103:org.apache.camel.camel-mvel:2.13.0.SNAPSHOT]
        at org.apache.camel.support.ExpressionSupport.matches(ExpressionSupport.java:32)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.processor.ChoiceProcessor.process(ChoiceProcessor.java:90)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:72)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:398)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:191)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:191)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:291)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:200)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:147)[73:org.apache.camel.camel-core:2.13.0.SNAPSHOT]
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)[:1.6.0_65]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)[:1.6.0_65]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:695)[:1.6.0_65]
Caused by: [Error: could not access: org; in class: org.apache.camel.language.mvel.RootObject]
[Near : {... est.body &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.camel.example.osgi. ....}]
                                 ^
[Line: 1, Column: 25]
        at org.mvel2.optimizers.impl.refl.ReflectiveAccessorOptimizer.getBeanProperty(ReflectiveAccessorOptimizer.java:683)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.optimizers.impl.refl.ReflectiveAccessorOptimizer.compileGetChain(ReflectiveAccessorOptimizer.java:337)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.optimizers.impl.refl.ReflectiveAccessorOptimizer.optimizeAccessor(ReflectiveAccessorOptimizer.java:140)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.optimizers.dynamic.DynamicOptimizer.optimizeAccessor(DynamicOptimizer.java:67)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.ast.ASTNode.optimize(ASTNode.java:159)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.ast.ASTNode.getReducedValueAccelerated(ASTNode.java:115)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.ast.Instance.getReducedValueAccelerated(Instance.java:21)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.compiler.ExecutableAccessor.getValue(ExecutableAccessor.java:42)[102:org.mvel2:2.1.7.Final]
        at org.mvel2.MVEL.executeExpression(MVEL.java:954)[102:org.mvel2:2.1.7.Final]
        at org.apache.camel.language.mvel.MvelExpression.evaluate(MvelExpression.java:57)[103:org.apache.camel.camel-mvel:2.13.0.SNAPSHOT]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12689519">CAMEL-7139</key>
            <summary>Problem with MvelExpression class visibility between camel bundles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="andrzej.majewski">Andrzej Majewski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2014 16:47:11 +0000</created>
                <updated>Mon, 3 Feb 2014 14:17:23 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 14:17:23 +0000</resolved>
                                    <version>2.12.2</version>
                                    <fixVersion>2.11.4</fixVersion>
                    <fixVersion>2.12.3</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13874942" author="andrzej.majewski" created="Fri, 17 Jan 2014 16:50:37 +0000"  >&lt;p&gt;I am happy to create a pull request with showcase example.&lt;/p&gt;</comment>
                            <comment id="13883486" author="fbalicchia" created="Mon, 27 Jan 2014 22:59:45 +0000"  >&lt;p&gt;I reproduced the problem with itest please see the attach.&lt;/p&gt;

&lt;p&gt;To Fix the problem a possible solution is remove TCCL to MVEL until &lt;br/&gt;
&lt;a href=&quot;http://jira.codehaus.org/browse/MVEL-250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/MVEL-250&lt;/a&gt; is not resolved&lt;/p&gt;

&lt;p&gt;Please see the attach for the patch;I hope it&apos;s ok for you.&lt;/p&gt;

&lt;p&gt;If it&apos;s ok for you please clean it a bit&lt;/p&gt;

&lt;p&gt;Any feedback is welcome.&lt;/p&gt;</comment>
                            <comment id="13883807" author="davsclaus" created="Tue, 28 Jan 2014 06:15:30 +0000"  >&lt;p&gt;Yeah you are welcome to cleanup the patch.&lt;/p&gt;</comment>
                            <comment id="13884798" author="fbalicchia" created="Tue, 28 Jan 2014 22:33:47 +0000"  >&lt;p&gt;osgi-itest for mvel&lt;/p&gt;</comment>
                            <comment id="13889495" author="davsclaus" created="Mon, 3 Feb 2014 14:17:23 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12625693" name="CAMEL-7139.patch.txt" size="1475" author="fbalicchia" created="Tue, 28 Jan 2014 22:34:27 +0000"/>
                            <attachment id="12625692" name="mvelItest.path.txt" size="3635" author="fbalicchia" created="Tue, 28 Jan 2014 22:33:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rigf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>