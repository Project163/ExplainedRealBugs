<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:29:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12451] Memory leak: camel-cxf componet don&apos;t release UoW  in case of using &quot;robust&quot; property</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12451</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In case of using &quot;org.apache.cxf.oneway.robust&quot; property camel-cxf component doesn&apos;t release UoW that leads to huge memory leak. I think it&apos;s relied with&#160; the feature of output chain of cxf framwork&#160;which&#160;doesn&apos;t invoke additional interceptors in case of oneway operation.&lt;/p&gt;

&lt;p&gt;in other words, this code is not called:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-cxf/src/main/java/org/apache/camel/component/cxf/CxfConsumer.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-cxf/src/main/java/org/apache/camel/component/cxf/CxfConsumer.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;


&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;UnitOfWorkCloserInterceptor &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractPhaseInterceptor&amp;lt;Message&amp;gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; UnitOfWorkCloserInterceptor() {
      &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(Phase.POST_LOGICAL_ENDING);
}
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void handleMessage(Message message) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Fault {
      Exchange cxfExchange = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((cxfExchange = message.getExchange()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
         org.apache.camel.Exchange exchange =             cxfExchange.get(org.apache.camel.Exchange.class);
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exchange != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            doneUoW(exchange);
   }
   }
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;minimal example:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;cxf:cxfEndpoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;soap_in1&quot;&lt;/span&gt; 
   address=&lt;span class=&quot;code-quote&quot;&gt;&quot;/service1&quot;&lt;/span&gt; 
   xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;urn:api:service1&quot;&lt;/span&gt; 
   wsdlURL=&lt;span class=&quot;code-quote&quot;&gt;&quot;wsdl/service1.wsdl&quot;&lt;/span&gt; 
   serviceName=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:service1&quot;&lt;/span&gt; 
   endpointName=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:HTTP_Port&quot;&lt;/span&gt;&amp;gt;
   &amp;lt;cxf:properties&amp;gt;
      &amp;lt;entry key=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataFormat&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;PAYLOAD&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;entry key=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cxf.oneway.robust&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
   &amp;lt;/cxf:properties&amp;gt;
&amp;lt;/cxf:cxfEndpoint&amp;gt;
&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/blueprint&quot;&lt;/span&gt;   id=&lt;span class=&quot;code-quote&quot;&gt;&quot;context1&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;   &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;loadTest1&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;cxf:bean:soap_in1&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;log:end&quot;&lt;/span&gt;/&amp;gt;
   &amp;lt;/route&amp;gt; 
&amp;lt;/camelContext&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13152941">CAMEL-12451</key>
            <summary>Memory leak: camel-cxf componet don&apos;t release UoW  in case of using &quot;robust&quot; property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="mfilippov">Filippov Mihail</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Apr 2018 09:13:57 +0000</created>
                <updated>Fri, 20 Apr 2018 05:09:19 +0000</updated>
                            <resolved>Fri, 20 Apr 2018 05:09:19 +0000</resolved>
                                    <version>2.20.2</version>
                    <version>2.20.3</version>
                                    <fixVersion>2.20.4</fixVersion>
                    <fixVersion>2.21.1</fixVersion>
                    <fixVersion>2.22.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16440675" author="davsclaus" created="Tue, 17 Apr 2018 09:47:14 +0000"  >&lt;p&gt;Try with synchronous=true on the cxf endpoint.&lt;/p&gt;</comment>
                            <comment id="16440730" author="mfilippov" created="Tue, 17 Apr 2018 10:38:27 +0000"  >&lt;p&gt;This has been tried. The result has not changed.&lt;/p&gt;</comment>
                            <comment id="16442067" author="davsclaus" created="Wed, 18 Apr 2018 07:46:22 +0000"  >&lt;p&gt;Its not recommended to use these seldom used options like oneway and roboust.&#160;&lt;/p&gt;</comment>
                            <comment id="16442136" author="mfilippov" created="Wed, 18 Apr 2018 08:46:44 +0000"  >&lt;p&gt;Thank you for the answer, unfortunately we can not abandon this option. At the moment, a workaround is used to clean up the &quot;onExchangeDone&quot; event. Is it possible to hope that this problem will be solved in closest future?&lt;/p&gt;</comment>
                            <comment id="16442397" author="davsclaus" created="Wed, 18 Apr 2018 12:11:42 +0000"  >&lt;p&gt;It helps if you have the time to dive into and try to find a solution. For example an unit test that reproduces the issue that we can add to camel-cxf would be a good start.&lt;/p&gt;</comment>
                            <comment id="16442601" author="njiang" created="Wed, 18 Apr 2018 14:35:01 +0000"  >&lt;p&gt;For the oneway request, CXF &lt;a href=&quot;https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/interceptor/OutgoingChainInterceptor.java#L66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;OutgoingChainInterceptor&lt;/a&gt; just close steam, so the UnitOfWorkCloserInterceptor never has a chance to be called.  We may need to install another interceptor to handle the oneway calling in the CxfConsumer.&lt;/p&gt;</comment>
                            <comment id="16445316" author="njiang" created="Fri, 20 Apr 2018 05:09:19 +0000"  >&lt;p&gt;Committed patch into master, camel-2.21.x and camel-2.20.x branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3smxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>