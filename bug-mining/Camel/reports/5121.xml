<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:38:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-14267] Conversion fails with NullPointerException when  the body is null at the end of a route and an outputType&#160;is set</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-14267</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;NullPointerException thrown if the body is null at the end of a route and an outputType is set.&lt;/p&gt;

&lt;p&gt;Sample code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:foo?repeatCount=1&quot;&lt;/span&gt;)
 &#160; .setBody().constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;42&quot;&lt;/span&gt;)
 &#160; .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sub&quot;&lt;/span&gt;);
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sub&quot;&lt;/span&gt;)
 &#160; .inputType(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class)
 &#160; .outputType(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class)
 &#160; .setBody().constant(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;Thrown exception:&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException: nulljava.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; at org.apache.camel.processor.ContractAdvice.convertIfRequired(ContractAdvice.java:149) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.ContractAdvice.doTransform(ContractAdvice.java:124) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.ContractAdvice.after(ContractAdvice.java:103) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor$InternalCallback.done(CamelInternalProcessor.java:251) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor$InternalCallback.done(CamelInternalProcessor.java:262) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:579) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2] at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:76) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:148) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:548) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.Pipeline.process(Pipeline.java:138) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.Pipeline.process(Pipeline.java:101) ~[camel-core-2.24.2.jar:2.24.2] at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2] at org.apache.camel.component.timer.TimerConsumer.sendTimerExchange(TimerConsumer.java:197) [camel-core-2.24.2.jar:2.24.2] at org.apache.camel.component.timer.TimerConsumer$1.run(TimerConsumer.java:79) [camel-core-2.24.2.jar:2.24.2] at java.util.TimerThread.mainLoop(Timer.java:555) [na:1.8.0_66] at java.util.TimerThread.run(Timer.java:505) [na:1.8.0_66]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13272763">CAMEL-14267</key>
            <summary>Conversion fails with NullPointerException when  the body is null at the end of a route and an outputType&#160;is set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ftaysse">Fabien Taysse</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Dec 2019 14:27:48 +0000</created>
                <updated>Tue, 10 Dec 2019 04:38:48 +0000</updated>
                            <resolved>Tue, 10 Dec 2019 04:38:48 +0000</resolved>
                                    <version>2.24.2</version>
                                    <fixVersion>2.24.3</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16990607" author="nikhilvibhav" created="Sat, 7 Dec 2019 20:27:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ftaysse&quot; class=&quot;user-hover&quot; rel=&quot;ftaysse&quot;&gt;ftaysse&lt;/a&gt; I tried this out locally using Camel 2.24.2, but didn&apos;t face this issue.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//foo?repeatCount=1&quot;&lt;/span&gt;)
&lt;/span&gt;    .setBody().constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;42&quot;&lt;/span&gt;)
    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:processFoo&quot;&lt;/span&gt;);

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:processFoo&quot;&lt;/span&gt;)
    .inputType(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class)
    .outputType(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class)
    .process(exchange -&amp;gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(exchange.getIn().getBody());
    })
    .setBody().constant(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    .process(exchange -&amp;gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(exchange.getIn().getBody());
    }); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Getting the output as expected and no exceptions are thrown.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;42
&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; finished with exit code 130 (interrupted by signal 2: SIGINT)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16991398" author="ftaysse" created="Mon, 9 Dec 2019 09:18:10 +0000"  >&lt;p&gt;Just created a dedicated mini maven project for this example and made it available as an attachement (using spring-boot-camel&#160; 2.24.2)&lt;/p&gt;

&lt;p&gt;In org.apache.camel.processor.ContractAdvice#convertIfRequired() method , the body isn&apos;t checked for null before calling &quot;getClass()&quot;, thus throwing an NPE&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; convertIfRequired(Message message, DataType type) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-comment&quot;&gt;// TODO &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; better performance it may be better to add TypeConverterTransformer
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// into transformer registry automatically to avoid unnecessary scan in transformer registry
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; type.isJavaType() &amp;amp;&amp;amp; type.getName() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            CamelContext context = message.getExchange().getContext();
            &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; typeJava = getClazz(type.getName(), context);
            &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; missing here...
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!typeJava.isAssignableFrom(message.getBody().getClass())) {
                LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Converting to &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt;&quot;&lt;/span&gt;, typeJava.getName());
                message.setBody(message.getMandatoryBody(typeJava));
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12988300/12988300_test-npe.zip&quot; title=&quot;test-npe.zip attached to CAMEL-14267&quot;&gt;test-npe.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16991473" author="davsclaus" created="Mon, 9 Dec 2019 10:22:08 +0000"  >&lt;p&gt;Thanks, you are welcome to attempt to fix this with a github PR to check for null body&lt;br/&gt;
&lt;a href=&quot;https://camel.apache.org/manual/latest/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/manual/latest/contributing.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16991590" author="ftaysse" created="Mon, 9 Dec 2019 13:38:56 +0000"  >&lt;p&gt;Done&#160;&lt;a href=&quot;https://github.com/apache/camel/pull/3393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[CAMEL-14267] Fix a nullPointerException in convertIfRequired&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16991706" author="davsclaus" created="Mon, 9 Dec 2019 15:37:46 +0000"  >&lt;p&gt;Fixed on Camel 3&lt;/p&gt;</comment>
                            <comment id="16992184" author="davsclaus" created="Tue, 10 Dec 2019 04:38:48 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12988300" name="test-npe.zip" size="3737" author="ftaysse" created="Mon, 9 Dec 2019 09:17:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09di0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>