<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:01:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19371] RedeliveryErrorHandler&apos;s suppressed exceptions cause memory leak and logging issue</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19371</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi There,&lt;/p&gt;


&lt;p&gt;I am a bit dubious about the behavior of RedeliveryErrorHandler&apos;s handleException() method in camel-core-processor bundle.&lt;/p&gt;

&lt;p&gt;Chaining all exceptions in suppressedExceptions of Throwable during the redelivery process may not be the original intention, at least the comment below is suggesting that the goal was something else here.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;if (previous != null &amp;amp;&amp;amp; previous != e) {&lt;br/&gt;
// a 2nd exception was thrown while handling a previous exception&lt;br/&gt;
// so we need to add the previous as suppressed by the new exception&lt;br/&gt;
// see also FatalFallbackErrorHandler&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The consequence of adding the previous exception to the suppressedExceptions list of the current one is building up an infinite chain of objects, besides a single log entry can be huge after a couple of retry attempts, see attached log.&lt;br/&gt;
I think the best would be to turn this feature on/off by a configuration parameter.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13536750">CAMEL-19371</key>
            <summary>RedeliveryErrorHandler&apos;s suppressed exceptions cause memory leak and logging issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Meszaros">Bence</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 May 2023 13:24:09 +0000</created>
                <updated>Thu, 4 Apr 2024 13:04:45 +0000</updated>
                            <resolved>Fri, 19 May 2023 16:35:04 +0000</resolved>
                                    <version>3.14.1</version>
                                    <fixVersion>3.14.8</fixVersion>
                    <fixVersion>3.18.7</fixVersion>
                    <fixVersion>3.20.5</fixVersion>
                    <fixVersion>3.21.0</fixVersion>
                    <fixVersion>4.0-RC1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17724011" author="davsclaus" created="Thu, 18 May 2023 20:03:18 +0000"  >&lt;p&gt;Yeah that is a good point about we should likely just keep the last error so the depth does not grow soo big&lt;/p&gt;</comment>
                            <comment id="17724012" author="davsclaus" created="Thu, 18 May 2023 20:04:37 +0000"  >&lt;p&gt;its not a memory leak as the memory can be reclaimed, its just a long stacktrace if retry is many times. And you should not have forever retries then you have another problem on your hand&lt;/p&gt;</comment>
                            <comment id="17724170" author="JIRAUSER296632" created="Fri, 19 May 2023 07:47:19 +0000"  >&lt;p&gt;I am afraid it is, since all exceptions thrown during the redelivery mechanism chained together and attached to the exchange via CamelExceptionCaught property (previous exception:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;font color=&quot;#000000&quot;&gt;Throwable previous &lt;/font&gt;= &lt;font color=&quot;#871094&quot;&gt;exchange&lt;/font&gt;.getProperty(&lt;font color=&quot;#000000&quot;&gt;ExchangePropertyKey&lt;/font&gt;.&lt;font color=&quot;#871094&quot;&gt;EXCEPTION_CAUGHT&lt;/font&gt;, &lt;font color=&quot;#000000&quot;&gt;Throwable&lt;/font&gt;.&lt;font color=&quot;#0033b3&quot;&gt;class&lt;/font&gt;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;On the other hand redeliveryPolicy maximumRedeliveries -1 is a valid option, this way the suppressedExceptions chain can definitely cause a memory leak. &lt;font color=&quot;#067d17&quot;&gt;&lt;/font&gt;&lt;/p&gt;</comment>
                            <comment id="17724183" author="davsclaus" created="Fri, 19 May 2023 08:17:09 +0000"  >&lt;p&gt;a leak is memory that cannot be reclaimed&lt;br/&gt;
what you describe is memory usage can become high if you have forever error handling, and using -1 is a bad practice&lt;/p&gt;</comment>
                            <comment id="17724274" author="davsclaus" created="Fri, 19 May 2023 13:16:13 +0000"  >&lt;p&gt;Okay have a pending fix, as this manifest in camel-jms and only when doing error handling that causes a 2nd error.&lt;/p&gt;

&lt;p&gt;However we may consider removing adding suppressed, but then end users may not see this from a result exception as they can only see the last, and not the original.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13058324" name="suppressed.log" size="81480" author="Meszaros" created="Thu, 18 May 2023 13:21:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hzj4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>