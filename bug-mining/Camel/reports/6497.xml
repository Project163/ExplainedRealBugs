<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:01:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19512] SetHeader not working anymore with InputStreamCache type</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19512</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;It seems there is a regression from Camel 3.20.3 which is the SetHeader not working anymore with InputStreamCache type.&lt;/p&gt;

&lt;p&gt;Given that a simple route:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
		from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:cTimer_1&quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;?period=&quot;&lt;/span&gt; + 1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;repeatCount=&quot;&lt;/span&gt; + 1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;delay=&quot;&lt;/span&gt; + 1)
		.setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;myheader1&quot;&lt;/span&gt;).constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi&quot;&lt;/span&gt;)
		.log(org.apache.camel.LoggingLevel.WARN, &lt;span class=&quot;code-quote&quot;&gt;&quot;MyRoute.cLog_1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;header myheader1 value is: ${header.myheader1}&quot;&lt;/span&gt;)
		.setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;myheader2&quot;&lt;/span&gt;).constant(iscache1)
		.log(org.apache.camel.LoggingLevel.WARN, &lt;span class=&quot;code-quote&quot;&gt;&quot;MyRoute.cLog_2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;header myheader2 value is: ${header.myheader2}&quot;&lt;/span&gt;)
		.setBody().constant(iscache2)
		.log(org.apache.camel.LoggingLevel.WARN, &lt;span class=&quot;code-quote&quot;&gt;&quot;MyRoute.cLog_3&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;body value is: ${body}&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the value of header.myheader2 is always null from Camel 3.20.3, whereas in Camel 3.20.2 or earlier version, it worked as expected.&lt;/p&gt;

&lt;p&gt;Attached a sample project for easily reproduce the issue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 11&lt;/p&gt;</environment>
        <key id="13541649">CAMEL-19512</key>
            <summary>SetHeader not working anymore with InputStreamCache type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="xldai">Xilai Dai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jun 2023 02:09:15 +0000</created>
                <updated>Tue, 11 Jul 2023 07:56:43 +0000</updated>
                            <resolved>Tue, 11 Jul 2023 07:56:43 +0000</resolved>
                                    <version>3.20.3</version>
                                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17737970" author="davsclaus" created="Wed, 28 Jun 2023 05:23:52 +0000"  >&lt;p&gt;Since you use Camel&apos;s StreamCache manually in the processor you need to turn on stream caching &lt;/p&gt;

&lt;p&gt;camelContext.setStreamCaching(true);&lt;/p&gt;</comment>
                            <comment id="17737981" author="xldai" created="Wed, 28 Jun 2023 06:29:00 +0000"  >&lt;p&gt;No any help adding camelContext.setStreamCaching(true)!&lt;/p&gt;

&lt;p&gt;Could you explain why the behavior is different between camel-core 3.20.2 and 3.20.3? with the same route above.&lt;/p&gt;

&lt;p&gt;Reopen it again.&lt;/p&gt;

&lt;p&gt;Would be good if anyone from Camel team can at least give it a try on the provided project, easily to be reproduced!&lt;/p&gt;</comment>
                            <comment id="17737982" author="davsclaus" created="Wed, 28 Jun 2023 06:32:53 +0000"  >&lt;p&gt;I tried your test and you need to enable stream caching.&lt;/p&gt;</comment>
                            <comment id="17737986" author="xldai" created="Wed, 28 Jun 2023 06:54:07 +0000"  >&lt;p&gt;again I don&apos;t see any help with camelContext.setStreamCaching(true) in the project.&lt;br/&gt;
Could anyone explain why the behavior is different between camel-core 3.20.2 and 3.20.3? with the same route above.&lt;/p&gt;</comment>
                            <comment id="17737992" author="davsclaus" created="Wed, 28 Jun 2023 07:18:47 +0000"  >&lt;p&gt;Using Camel&apos;s StreamCache objects like you do with InputStreamCache always require to use them with stream caching enabled. In fact end users are NOT supposed to create and use these classes themselves. They are part of Camel&apos;s stream caching functionality. Using these classes are for advanced use-cases such as in special components or addons.&lt;/p&gt;

&lt;p&gt;Also beware when using any kind of Stream object (InputStream) then you can only read them once, and you need to reset them (if they support this etc.).&lt;/p&gt;

&lt;p&gt;Read more at&lt;br/&gt;
&lt;a href=&quot;https://camel.apache.org/manual/stream-caching.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/manual/stream-caching.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For changes in Camel 3.20.x then go see the changelog / git commits or whatever. Camel releases are fixing bugs and whatnot.&lt;/p&gt;
</comment>
                            <comment id="17737999" author="xldai" created="Wed, 28 Jun 2023 07:41:00 +0000"  >&lt;p&gt;The main issue I raised here is simple(&quot;${body}&quot;) not working like before in case of the body is Stream type.&lt;br/&gt;
The issue was found with more complex route with cxfrs:// response with InputStreamCache, I just create a simple project without CXF involved but have the same behavior for easily analyzing the issue purpose.&lt;br/&gt;
For sure we checked already the changelog/git commits as already, the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-19186&lt;/a&gt; is more relative but not sure that&apos;s why this issue is raised.&lt;/p&gt;</comment>
                            <comment id="17739850" author="xldai" created="Tue, 4 Jul 2023 08:59:51 +0000"  >&lt;p&gt;Updated the test-setheader project and re-attached it.&lt;br/&gt;
The issue is not on simple language but on setHeader().&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=essobedo&quot; class=&quot;user-hover&quot; rel=&quot;essobedo&quot;&gt;essobedo&lt;/a&gt;, Could you please re-check it with the steps in README.txt? &lt;/p&gt;</comment>
                            <comment id="17740955" author="davsclaus" created="Fri, 7 Jul 2023 09:04:28 +0000"  >&lt;p&gt;What header do you have in real world use-cases that are streaming based ?&lt;/p&gt;

&lt;p&gt;Camel streaming caching is for message body only.&lt;/p&gt;</comment>
                            <comment id="17740957" author="JIRAUSER285918" created="Fri, 7 Jul 2023 09:18:37 +0000"  >&lt;p&gt;After a deeper analysis, it appears that the behavior change is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19026&quot; title=&quot;camel-jbang - camel.main.backlogTracing=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-19026&quot;&gt;&lt;del&gt;CAMEL-19026&lt;/del&gt;&lt;/a&gt;, and the problem is not limited to &lt;tt&gt;InputStreamCache&lt;/tt&gt;, it occurs with any &lt;tt&gt;InputStream&lt;/tt&gt; with &lt;tt&gt;setBacklogTracing(true)&lt;/tt&gt; like in the test project attached to this ticket. &lt;/p&gt;

&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19026&quot; title=&quot;camel-jbang - camel.main.backlogTracing=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-19026&quot;&gt;&lt;del&gt;CAMEL-19026&lt;/del&gt;&lt;/a&gt;, no message as XML was built with &lt;tt&gt;setBacklogTracing(true)&lt;/tt&gt; which implies that the headers were not read but since &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19026&quot; title=&quot;camel-jbang - camel.main.backlogTracing=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-19026&quot;&gt;&lt;del&gt;CAMEL-19026&lt;/del&gt;&lt;/a&gt;, messages are built as XML such that the value of headers are read more times so if the stream is not reset explicitly (streams in the body are reset automatically if possible), we end up with no content when we try to read it later which is the behavior that you get.&lt;/p&gt;

&lt;p&gt;As a workaround, please avoid enabling the backlog tracing if not needed but also avoid setting stream values to headers and properties, it is not a good practice as your route won&apos;t be idempotent, indeed adding a simple logger to display the content of your header can affect the result of your route while it should not. &lt;/p&gt;

&lt;p&gt;Try to rely on the result type of an expression to set value with a specific type like for example &lt;tt&gt;setHeader(&quot;myheader2&quot;).simple(&quot;${body}&quot;, String.class)&lt;/tt&gt;, this way, you can read the content of your header as many times as you want without affecting the overall result.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; Maybe this behavior change should be documented somewhere, don&apos;t you agree?&lt;/p&gt;</comment>
                            <comment id="17740962" author="davsclaus" created="Fri, 7 Jul 2023 10:13:26 +0000"  >&lt;p&gt;Backlog debugging is only for development - but you are surely welcome to add a note in the doc page&lt;/p&gt;</comment>
                            <comment id="17740967" author="JIRAUSER285918" created="Fri, 7 Jul 2023 10:44:44 +0000"  >&lt;p&gt;I could add a note with pleasure but TBH &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19026&quot; title=&quot;camel-jbang - camel.main.backlogTracing=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-19026&quot;&gt;&lt;del&gt;CAMEL-19026&lt;/del&gt;&lt;/a&gt; is not really clear to me, could you please clarify?&lt;/p&gt;</comment>
                            <comment id="17740985" author="JIRAUSER285918" created="Fri, 7 Jul 2023 12:01:58 +0000"  >&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19026&quot; title=&quot;camel-jbang - camel.main.backlogTracing=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-19026&quot;&gt;&lt;del&gt;CAMEL-19026&lt;/del&gt;&lt;/a&gt;, it behaves like backlog tracing does not even work which is quite surprising so I guess, I miss something&lt;/p&gt;</comment>
                            <comment id="17741185" author="davsclaus" created="Fri, 7 Jul 2023 20:34:00 +0000"  >&lt;p&gt;I added notes in the docs&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/d3a303476687d1238815a7b5556e90ffdd8c61ed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/d3a303476687d1238815a7b5556e90ffdd8c61ed&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17741186" author="davsclaus" created="Fri, 7 Jul 2023 20:35:12 +0000"  >&lt;p&gt;And also for the 3.20.3 upgrade section&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/f03a78cf01cbd26cc645b772f538c8f5540f8854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/f03a78cf01cbd26cc645b772f538c8f5540f8854&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17741250" author="JIRAUSER285918" created="Sat, 8 Jul 2023 07:46:48 +0000"  >&lt;p&gt;Very nice, thank you Claus&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13523828">CAMEL-19026</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13061051" name="test-setheader.zip" size="6067" author="xldai" created="Tue, 4 Jul 2023 08:55:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ito8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>