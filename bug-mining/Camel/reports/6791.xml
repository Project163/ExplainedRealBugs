<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:06:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20864] camel-kafka - With confluent schema registry does not work properly.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20864</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In confluent kafka, we can register the topic against schema validation from the schema registry. When configured the confluent document says either we should have a pojo object defined in the code that is used for serialization/deserialization &lt;b&gt;OR&lt;/b&gt;&#160;a custom &quot;ObjectNode&quot; can be created from their schema utils. Attaching the document below&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.confluent.io/platform/current/schema-registry/fundamentals/serdes-develop/serdes-json.html#sending-a-jsonnode-payload&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.confluent.io/platform/current/schema-registry/fundamentals/serdes-develop/serdes-json.html#sending-a-jsonnode-payload&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For our case, we have a different schema registered and can&apos;t have all the POJO defined as schema registered at run time, so we are using the below code to generate an object from the schema.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
config.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;basic.auth.credentials.source&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;USER_INFO&quot;&lt;/span&gt;);
config.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;basic.auth.user.info&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;secret-key&amp;gt;&quot;&lt;/span&gt;);
config.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;auto.register.schemas&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
config.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;use.latest.version&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

CachedSchemaRegistryClient registryClient = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CachedSchemaRegistryClient(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;registry-url&amp;gt;&quot;&lt;/span&gt;, 10, config);
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; schemaDoc = registryClient.getLatestSchemaMetadata(&lt;span class=&quot;code-quote&quot;&gt;&quot;topicTest-value&quot;&lt;/span&gt;).getSchema();
JsonSchema schema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonSchema(schemaDoc);

ObjectMapper mapper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ObjectMapper();
JsonNode jsonNode = mapper.readTree(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;myField1\&lt;span class=&quot;code-quote&quot;&gt;&quot;:123,\&quot;&lt;/span&gt;myField2\&lt;span class=&quot;code-quote&quot;&gt;&quot;:123.32,\&quot;&lt;/span&gt;myField3\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;pqr\&lt;span class=&quot;code-quote&quot;&gt;&quot;}&quot;&lt;/span&gt;);
ObjectNode envelope = JsonSchemaUtils.envelope(schema, jsonNode);

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//foo?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=60000&quot;&lt;/span&gt;)
&lt;/span&gt;        .setBody(ExpressionBuilder.constantExpression(envelope))
        .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sent &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; message&quot;&lt;/span&gt;)&lt;span class=&quot;code-comment&quot;&gt;// Message to send
&lt;/span&gt;        .to(kafkaEndpoint); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the &quot;ObjectNode&quot; payload is directly written using kafka-client library it works. But when written using camel component, The &quot;KafkaProducer&quot; in camel component does &quot;isIterable&quot; check and if true sends each value and this doesn&apos;t work for confluent kafka as the custom &quot;&lt;b&gt;io.confluent.kafka.serializers.json.KafkaJsonSchemaSerializer&lt;/b&gt;&quot; expects a whole object.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069448/13069448_image-2024-06-12-11-05-12-616.png&quot; height=&quot;459&quot; width=&quot;733&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;The code in &quot;&lt;/p&gt;

&lt;p&gt;io.confluent.kafka.serializers.json.KafkaJsonSchemaSerializer expects whole object.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069447/13069447_image-2024-06-12-11-06-33-915.png&quot; height=&quot;438&quot; width=&quot;906&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Basically, in simple words, The &quot;envelope&quot; object created is no longer the same object but is iterated and values are iterated and sent independently resulting in schema validation error.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Confluent Kafka&lt;/p&gt;

&lt;p&gt;Camel-3.22.x&lt;/p&gt;

&lt;p&gt;Java 17&lt;/p&gt;</environment>
        <key id="13582350">CAMEL-20864</key>
            <summary>camel-kafka - With confluent schema registry does not work properly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="kartikvk1996">Kartik</reporter>
                        <labels>
                            <label>camel-kafka</label>
                    </labels>
                <created>Wed, 12 Jun 2024 05:38:38 +0000</created>
                <updated>Mon, 17 Jun 2024 07:39:11 +0000</updated>
                            <resolved>Wed, 12 Jun 2024 17:43:02 +0000</resolved>
                                    <version>3.22.2</version>
                                    <fixVersion>3.21.5</fixVersion>
                    <fixVersion>3.22.3</fixVersion>
                    <fixVersion>4.0.6</fixVersion>
                    <fixVersion>4.4.3</fixVersion>
                    <fixVersion>4.7.0</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17854264" author="davsclaus" created="Wed, 12 Jun 2024 06:29:12 +0000"  >&lt;p&gt;Try with latest 4.4.x or 4.6.0 release and report back there thanks&lt;/p&gt;</comment>
                            <comment id="17854285" author="kartikvk1996" created="Wed, 12 Jun 2024 07:22:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;&#160; I see the same issue in 4.6.0 on checking there is a code that checks whether the input payload is of type Iterable.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069452/13069452_image-2024-06-12-12-51-58-966.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17854290" author="davsclaus" created="Wed, 12 Jun 2024 07:29:14 +0000"  >&lt;p&gt;Thanks for checking&lt;/p&gt;</comment>
                            <comment id="17854417" author="davsclaus" created="Wed, 12 Jun 2024 12:23:49 +0000"  >&lt;p&gt;You can turn this off with useIterator=false&lt;/p&gt;</comment>
                            <comment id="17855481" author="kartikvk1996" created="Mon, 17 Jun 2024 05:06:46 +0000"  >&lt;p&gt;Thanks for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; But the challenge is for users, they will never understand why schema validation is failing &lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;error message does not indicate about records sent as individual items&amp;#93;&lt;/span&gt;&lt;/b&gt; and it will be tough to find this flag and turn this off just be reading documentation.&lt;/p&gt;

&lt;p&gt;I think some additional doc should be added.&#160;&lt;/p&gt;</comment>
                            <comment id="17855517" author="davsclaus" created="Mon, 17 Jun 2024 07:38:55 +0000"  >&lt;p&gt;You are welcome to add docs, click &quot;edit this page&quot; in the top right&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://camel.apache.org/components/next/kafka-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/next/kafka-component.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And send the doc changes as PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13069448" name="image-2024-06-12-11-05-12-616.png" size="96506" author="kartikvk1996" created="Wed, 12 Jun 2024 05:35:13 +0000"/>
                            <attachment id="13069447" name="image-2024-06-12-11-06-33-915.png" size="88452" author="kartikvk1996" created="Wed, 12 Jun 2024 05:36:34 +0000"/>
                            <attachment id="13069452" name="image-2024-06-12-12-51-58-966.png" size="85837" author="kartikvk1996" created="Wed, 12 Jun 2024 07:21:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pqyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>