<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:35:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13625] Quartz2 firenow doesn&apos;t work consistently</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13625</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi Colleagues,&lt;/p&gt;

&lt;p&gt;We have an interesting bug in the camel-quartz2 where the firenow doesn&apos;t work consistently.&lt;/p&gt;

&lt;p&gt;it works sometimes and sometimes it doesn&apos;t. On debug i found that the problem occurs when Scheduler starts&#160;it invokes&#160;&lt;b&gt;CamleJob,&lt;/b&gt;&#160; &lt;b&gt;CamleJob&lt;/b&gt;&#160;starts executing and tries to read from&#160;&lt;b&gt;getProcessors()&lt;/b&gt; method of &lt;b&gt;LoadBalancerSupport&lt;/b&gt; class. sometimes&#160;&lt;b&gt;getProcessors()&lt;/b&gt; method returns empty list as a result routes doesn&apos;t get executed.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;StartupListener&lt;/b&gt; (QuartzComponent) gets notified much before the &lt;b&gt;QuartzConsumer&lt;/b&gt; starts, as a result it is not able to get the&#160;List&amp;lt;Processor&amp;gt; from&#160;&lt;b&gt;getProcessors()&lt;/b&gt; method of&#160;&lt;b&gt;LoadBalancerSupport&lt;/b&gt; class.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Analysis of the problem&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;DefaultCamelContext&lt;/b&gt; method&#160;&lt;b&gt;safelyStartRouteServices()&lt;/b&gt; notifies QuartzComponent&apos;s&#160;&lt;b&gt;onCamelContextStarted()&lt;/b&gt; method.&lt;/li&gt;
	&lt;li&gt;The above step starts the scheduler which then calls &lt;b&gt;execute()&lt;/b&gt; method in &lt;b&gt;CamelJob&lt;/b&gt; class.&lt;/li&gt;
	&lt;li&gt;In the execute() method it invokes&#160;&lt;b&gt;getProcessors()&lt;/b&gt;&#160;method of&#160;&lt;b&gt;LoadBalancerSupport&lt;/b&gt;&#160;class to get the List&amp;lt;Processor&amp;gt;.&lt;/li&gt;
	&lt;li&gt;Sometimes&#160;&lt;b&gt;getProcessors()&lt;/b&gt;&#160; returns empty list.&lt;/li&gt;
	&lt;li&gt;The reason is&#160;&#160;List&amp;lt;Processor&amp;gt; in&#160;&lt;b&gt;LoadBalancerSupport&lt;/b&gt; class is populated by &lt;b&gt;QuartzConsumer&lt;/b&gt; on start of consumer. but&#160; it is started after&#160;QuartzComponent&apos;s&#160;&lt;b&gt;onCamelContextStarted()&lt;/b&gt; method is called in &lt;b&gt;DefaultCamelContext&lt;/b&gt;.&lt;/li&gt;
	&lt;li&gt;When i checked the older version of camel which we are using in our organization 2.17.0 i see the order is different.&lt;/li&gt;
	&lt;li&gt;Consumer starts first then the classes that implements&#160;&lt;b&gt;StartupListener&lt;/b&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;To Summarize&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The order in which&#160;&lt;b&gt;StartupListener&lt;/b&gt; and &lt;b&gt;Consumer&lt;/b&gt; is started in &lt;b&gt;DefaultCamelContext&lt;/b&gt; is causing race condition.&lt;/li&gt;
	&lt;li&gt;The older version of camel 2.17.0 order is first &lt;b&gt;Consumer&lt;/b&gt; starts followed by classes that implement&#160;&lt;b&gt;StartupListener&lt;/b&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have attached the junit with quartz2, since it is intermittent issue, i made the junit to run 1000 times and it fails randomly which proves existence of the problem.&lt;/p&gt;

&lt;p&gt;I have also attached by proposed solution in DefaultCamelContext in the attachment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13238142">CAMEL-13625</key>
            <summary>Quartz2 firenow doesn&apos;t work consistently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="deepaktaker">Deepak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Jun 2019 08:35:20 +0000</created>
                <updated>Sun, 9 Jun 2019 11:44:58 +0000</updated>
                            <resolved>Sun, 9 Jun 2019 11:44:58 +0000</resolved>
                                    <version>2.24.0</version>
                                    <fixVersion>2.23.3</fixVersion>
                    <fixVersion>2.24.1</fixVersion>
                    <fixVersion>3.0.0.M4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                                    <component>camel-quartz2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16859422" author="davsclaus" created="Sun, 9 Jun 2019 10:28:17 +0000"  >&lt;p&gt;You can set the option startDelayedSeconds=X on the component to delay starting the quartz scheduler.&lt;/p&gt;</comment>
                            <comment id="16859424" author="davsclaus" created="Sun, 9 Jun 2019 10:32:25 +0000"  >&lt;p&gt;Are you use fireNow to run a quartz scheduler job only once? If so then use the timer component instead.&lt;/p&gt;</comment>
                            <comment id="16859438" author="davsclaus" created="Sun, 9 Jun 2019 11:44:58 +0000"  >&lt;p&gt;Thanks for reporting and the analysis of the bug&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12971167" name="Solution.java" size="2859" author="deepaktaker" created="Fri, 7 Jun 2019 11:04:24 +0000"/>
                            <attachment id="12971154" name="cameltest.zip" size="11864" author="deepaktaker" created="Fri, 7 Jun 2019 08:31:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03ig8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>