<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:55:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5900] StreamResequencer does not resequence correctly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5900</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;On some routes we noticed that the StreamResequencer was not resequencing correctly. By playing with the Camel unit test (org.apache.camel.processor.StreamResequencerTest) I was able to reproduce the problem.&lt;/p&gt;

&lt;p&gt;Test setup: &lt;br/&gt;
1. In the createRouteBuilder() method change the capacity and timeout to avoid false problems. I used:&lt;br/&gt;
from(&quot;direct:start&quot;).resequence(header(&quot;seqnum&quot;)).stream().capacity(10000).timeout(20000L).to(&quot;mock:result&quot;);&lt;/p&gt;

&lt;p&gt;2. In the testMultithreaded() method change numMessages to a high number (I used 9000).&lt;/p&gt;

&lt;p&gt;3. Run the unit test several times until it fails. It does not fail consistently which probably indicates a race condition / wrong synchronization. You might have to adapt the numbers above to have it fail on other configurations.&lt;/p&gt;

&lt;p&gt;The testSendMessagesInWrongOrderButReceiveThemInCorrectOrder() often fails with&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError: mock://result Received message count. Expected: &amp;lt;4&amp;gt; but was: &amp;lt;0&amp;gt;&lt;br/&gt;
	at org.apache.camel.component.mock.MockEndpoint.fail(MockEndpoint.java:1318)&lt;br/&gt;
	at org.apache.camel.component.mock.MockEndpoint.assertEquals(MockEndpoint.java:1300)&lt;br/&gt;
	at org.apache.camel.component.mock.MockEndpoint.doAssertIsSatisfied(MockEndpoint.java:372)&lt;br/&gt;
	at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:351)&lt;br/&gt;
	at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:339)&lt;br/&gt;
	at org.apache.camel.processor.StreamResequencerTest.testSendMessagesInWrongOrderButReceiveThemInCorrectOrder(StreamResequencerTest.java:56)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:168)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:134)&lt;br/&gt;
	at org.apache.camel.TestSupport.runBare(TestSupport.java:58)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:110)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:128)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:113)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:124)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:243)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:238)&lt;br/&gt;
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/p&gt;

&lt;p&gt;I also often get the testMultithreaded() that fails with:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;pool-2-thread-2&quot; org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: msg5181&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1287)&lt;br/&gt;
	at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:618)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:454)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:450)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:152)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:146)&lt;br/&gt;
	at org.apache.camel.processor.StreamResequencerTest$Sender.run(StreamResequencerTest.java:147)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: org.apache.camel.CamelExchangeException: No consumers available on endpoint: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://start&amp;#93;&lt;/span&gt;. Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: msg5181&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:56)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117)&lt;br/&gt;
	at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99)&lt;br/&gt;
	at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:63)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:366)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:1)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:233)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:337)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:175)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:111)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:150)&lt;br/&gt;
	... 5 more&lt;br/&gt;
Exception in thread &quot;pool-2-thread-1&quot; org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: msg5184&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1287)&lt;br/&gt;
	at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:618)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:454)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:450)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:152)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:146)&lt;br/&gt;
	at org.apache.camel.processor.StreamResequencerTest$Sender.run(StreamResequencerTest.java:147)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: org.apache.camel.CamelExchangeException: No consumers available on endpoint: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://start&amp;#93;&lt;/span&gt;. Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: msg5184&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:56)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117)&lt;br/&gt;
	at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99)&lt;br/&gt;
	at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:63)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:366)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:1)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:233)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:337)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:175)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:111)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:150)&lt;br/&gt;
	... 5 more&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Windows XP dual-core, Sun JDK 1.6.x&lt;br/&gt;
Ubuntu Linux quad-core, openjdk 6b24-1.11.5-0ubuntu1~12.04.1&lt;br/&gt;
Ubuntu Linux quad-core, openjdk 7u9-2.3.3-0ubuntu1~12.04.1&lt;br/&gt;
Camel 2.10 release version&lt;br/&gt;
Camel 2.11 snapshot code, svn checkout on 2012-12-18.&lt;/p&gt;</environment>
        <key id="12624748">CAMEL-5900</key>
            <summary>StreamResequencer does not resequence correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lombart">Vincent Lombart</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Dec 2012 00:54:00 +0000</created>
                <updated>Fri, 21 Dec 2012 13:03:36 +0000</updated>
                            <resolved>Fri, 21 Dec 2012 13:03:36 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13537789" author="bvahdat" created="Fri, 21 Dec 2012 10:25:43 +0000"  >&lt;p&gt;Regarding the test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testSendMessagesInWrongOrderButReceiveThemInCorrectOrder()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you define a timeout of 20 seconds inside the route (e.g. &lt;tt&gt;timeout(20000L)&lt;/tt&gt;) then you would need to wait &lt;em&gt;at least&lt;/em&gt; for this amount of time by the MockEndpoint before asserting on it, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;resultEndpoint.setResultWaitTime(25000L);
resultEndpoint.expectedBodiesReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;msg1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;msg2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;msg3&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;msg4&quot;&lt;/span&gt;);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And concerning the test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testMultithreaded()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Well 9000 messages you have defined here is &quot;a bit more&quot; than just 100 messages. So you need to give it a bit of time for processing until it&apos;s done, on my box I set the result wait timeout to &lt;tt&gt;40 seconds&lt;/tt&gt; by this test to make it pass:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
resultEndpoint.expectedBodiesReceived(bodies);
resultEndpoint.setResultWaitTime(40000L);
resultEndpoint.assertIsSatisfied();
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also be aware of the &lt;tt&gt;4 ms&lt;/tt&gt; the &lt;tt&gt;Sender&lt;/tt&gt; sleeps before sending &lt;b&gt;each&lt;/b&gt; exchange which for 9000 messages brings a bit of delay into the play as well.&lt;/p&gt;

&lt;p&gt;Please better provide a concrete unit-test of yours showing the problem you&apos;re facing, then it&apos;s easier for us to follow the problem (and probably fix it if any).&lt;br/&gt;
Also a &lt;b&gt;much&lt;/b&gt; better approach would be to &lt;em&gt;first&lt;/em&gt; ask for help @ the user forum as we already say this by the blue box below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://camel.apache.org/support.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/support.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13537836" author="lombart" created="Fri, 21 Dec 2012 13:03:12 +0000"  >&lt;p&gt;I am sorry not to have followed these rules. I will close this issue, create a test case as simple as possible and post for help in the user forum. Thanks for your help.&lt;/p&gt;

&lt;p&gt;Vincent&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>301106</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16nsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>246987</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10092"><![CDATA[Unit Test Broken]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>