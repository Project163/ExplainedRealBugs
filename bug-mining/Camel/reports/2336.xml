<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:58:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6473] NULL values are not supported in named parameters</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6473</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Due to the bug in the DefaultSqlPrepareStatementStrategy there no ability to use NULL values.&lt;/p&gt;

&lt;p&gt;Following query will be failed, if we try to use NULL  as a parameter value:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;select a, b from foo where (:#param1 IS NOT NULL AND a &amp;gt; 12 ) OR (:#param2 IS NOT NULL AND b &amp;gt; 12)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We&apos;ll get an error: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Caused by: java.sql.SQLException: Number of parameters mismatch. Expected: 2, was:1&lt;br/&gt;
at org.apache.camel.component.sql.DefaultSqlPrepareStatementStrategy.populateStatement(DefaultSqlPrepareStatementStrategy.java:132) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-sql-2.11.0.jar:2.11.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.component.sql.SqlProducer$1.doInPreparedStatement(SqlProducer.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-sql-2.11.0.jar:2.11.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.component.sql.SqlProducer$1.doInPreparedStatement(SqlProducer.java:57) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-sql-2.11.0.jar:2.11.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:587) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;spring-jdbc-3.1.4.RELEASE.jar:3.1.4.RELEASE&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Fix is quite simple: iterator implementation (returned by DefaultSqlPrepareStatementStrategy.createPopulateIterator()) should be changed as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;() {
                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; NamedQueryParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NamedQueryParser(query);
                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; nextParam;
                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; done;

                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasNext() {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (done) {
                            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                        }
                        
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextParam == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                            nextParam = parser.next();
                            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextParam == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                                done = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                            }
                        }
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextParam != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                    }

                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; next() {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!hasNext()){
                            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NoSuchElementException();
                        }
                        
                        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; contains = bodyMap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? bodyMap.containsKey(nextParam) : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                        contains |= headerMap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? headerMap.containsKey(nextParam) : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!contains) {
                            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeExchangeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot find key [&quot;&lt;/span&gt; + nextParam + &lt;span class=&quot;code-quote&quot;&gt;&quot;] in message body or headers to use when setting named parameter in query [&quot;&lt;/span&gt; + query + &lt;span class=&quot;code-quote&quot;&gt;&quot;]&quot;&lt;/span&gt;, exchange);
                        }
                            
                        &lt;span class=&quot;code-comment&quot;&gt;// get from body before header
&lt;/span&gt;                        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; next = bodyMap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? bodyMap.get(nextParam) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (next == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                            next = headerMap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? headerMap.get(nextParam) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                        }

                        nextParam = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; next;
                    }

                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void remove() {
                        &lt;span class=&quot;code-comment&quot;&gt;// noop
&lt;/span&gt;                    }
                };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12654096">CAMEL-6473</key>
            <summary>NULL values are not supported in named parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srg">Sergey Galkin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Jun 2013 07:00:05 +0000</created>
                <updated>Mon, 10 Nov 2014 21:26:00 +0000</updated>
                            <resolved>Sun, 23 Jun 2013 07:39:47 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.11.1</fixVersion>
                    <fixVersion>2.12.0</fixVersion>
                                    <component>camel-sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13691374" author="davsclaus" created="Sun, 23 Jun 2013 07:39:47 +0000"  >&lt;p&gt;Thanks for reporting and with the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lohz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334699</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>