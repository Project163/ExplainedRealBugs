<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:41:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15017] Can&apos;t use custom scheduler in polling consumer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15017</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I came across this error while trying to use a Quartz scheduler with a JPA component but I guess it applies to all the&#160;endpoints extending &lt;tt&gt;ScheduledPollEndpoint&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If I use&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jpa:&lt;span class=&quot;code-comment&quot;&gt;//myEntity?scheduler=quartz2&amp;amp;scheduler.cron=0+*+*+?+*+*+*&quot;&lt;/span&gt;)
&lt;/span&gt;   &lt;span class=&quot;code-comment&quot;&gt;/* ... */&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I receive the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.camel.FailedToCreateConsumerException: Failed to create Consumer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; endpoint: jpa:&lt;span class=&quot;code-comment&quot;&gt;//myEntity?scheduler=quartz2&amp;amp;scheduler.cron=0+*+*+%3F+*+*+*. Reason: There are 1 scheduler parameters that couldn&apos;t be set on the endpoint. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{cron=0 * * ? * * *}]
&lt;/span&gt;at org.apache.camel.impl.ScheduledPollConsumer.doStart(ScheduledPollConsumer.java:433) ~[camel-core-2.25.1.jar:2.25.1]
	at org.apache.camel.component.jpa.JpaConsumer.doStart(JpaConsumer.java:530) ~[camel-jpa-2.25.1.jar:2.25.1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This happens because the scheduler is an instance of &lt;tt&gt;DefaultScheduledPollConsumerScheduler&lt;/tt&gt;. After some debugging I found out that when &lt;tt&gt;ScheduledPollEndpoint#configureScheduledPollConsumerProperties&lt;/tt&gt; is called,&#160;&lt;tt&gt;schedulerName&lt;/tt&gt; is always null (&lt;tt&gt;Endpoint.configureProperties&lt;/tt&gt; is invoked before setting endpoint properties using reflection).&lt;/p&gt;

&lt;p&gt;The only workaround I&apos;ve found so far is to write a custom component and force the scheduler on the endpoint:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyJpaComponent &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JpaComponent {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Endpoint createEndpoint(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; options) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        JpaEndpoint endpoint = (JpaEndpoint) &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createEndpoint(uri, path, options);
        endpoint.setScheduler(&lt;span class=&quot;code-quote&quot;&gt;&quot;quartz2&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; endpoint;
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;lorenzo&lt;/p&gt;</description>
                <environment></environment>
        <key id="13303045">CAMEL-15017</key>
            <summary>Can&apos;t use custom scheduler in polling consumer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="lbenvenu">Lorenzo Benvenuti</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 May 2020 07:41:25 +0000</created>
                <updated>Wed, 6 May 2020 17:43:05 +0000</updated>
                            <resolved>Wed, 6 May 2020 17:43:05 +0000</resolved>
                                    <version>2.25.1</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17100550" author="davsclaus" created="Wed, 6 May 2020 07:43:51 +0000"  >&lt;p&gt;Can you try and test with Camel 3.2.x release.&lt;/p&gt;</comment>
                            <comment id="17100625" author="lbenvenu" created="Wed, 6 May 2020 09:36:02 +0000"  >&lt;p&gt;I&apos;m struggling to make my application work with Camel 3.2.0. Bumping the version caused some dependency issues; once I fixed those, I started receiving an error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: javax.persistence.PersistenceException: No Persistence provider &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; EntityManager named camel
	at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:85) ~[javax.persistence-api-2.2.jar:2.2]
	at org.springframework.orm.jpa.LocalEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalEntityManagerFactoryBean.java:96) ~[spring-orm-5.1.5.RELEASE.jar:5.1.5.RELEASE]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:390) ~[spring-orm-5.1.5.RELEASE.jar:5.1.5.RELEASE]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:377) ~[spring-orm-5.1.5.RELEASE.jar:5.1.5.RELEASE]
	at org.apache.camel.component.jpa.JpaEndpoint.createEntityManagerFactory(JpaEndpoint.java:539) ~[camel-jpa-3.2.0.jar:3.2.0] error.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like &lt;tt&gt;EntityManagerFactory&lt;/tt&gt; is not properly injected in the JPA component. When the JPA endpoint is created using &lt;tt&gt;JpaEndpoint(String uri, JpaComponent component)&lt;/tt&gt; constructor, in Camel 2.25.1 &lt;tt&gt;component.getEntityManagerFactory()&lt;/tt&gt; returns the Spring auto-configured &lt;tt&gt;EntityManagerFactory&lt;/tt&gt;, in Camel 3.2.0 it returns null and this causes Camel to try to create a new &lt;tt&gt;EntityManagerFactory&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;lorenzo&lt;/p&gt;</comment>
                            <comment id="17100744" author="davsclaus" created="Wed, 6 May 2020 12:16:21 +0000"  >&lt;p&gt;When the JPA component starts in 3.2 it logs that it auto discover this EMF (its start method).&lt;/p&gt;

&lt;p&gt;If it cannot find one it logs at DEBUG otherwise at INFO&lt;br/&gt;
LOG.debug(&quot;Could not find a single EntityManagerFactory in registry as there was {} instances.&quot;, map.size());&lt;/p&gt;

&lt;p&gt;What do you see?&lt;/p&gt;</comment>
                            <comment id="17100757" author="davsclaus" created="Wed, 6 May 2020 12:27:56 +0000"  >&lt;p&gt;It works in 3.x&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/50e8b4c0c55df9bf164e94e4a474ef298106240e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/50e8b4c0c55df9bf164e94e4a474ef298106240e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17100786" author="lbenvenu" created="Wed, 6 May 2020 13:09:07 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-05-06T14:31:33.964+0200  INFO 17321 --- [  restartedMain] o.a.camel.component.jpa.JpaComponent     : Using EntityManagerFactory found in registry with id [entityManagerFactory] org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean@13645b9b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I see the &lt;tt&gt;JpaComponent#doStart&lt;/tt&gt; method, which loads the &lt;tt&gt;entityManagerFactory&lt;/tt&gt; from the context in case it&apos;s null, is called after the &lt;tt&gt;JpaComponent#createEndpoint&lt;/tt&gt; method; so when the &lt;tt&gt;JpaEndpoint&lt;/tt&gt; constructor is invoked &lt;tt&gt;component.getEntityManagerFactory()&lt;/tt&gt; returns null.&lt;/p&gt;</comment>
                            <comment id="17101042" author="davsclaus" created="Wed, 6 May 2020 17:42:59 +0000"  >&lt;p&gt;yeah we have improved jpa component in camel 3.3 where this works.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ef8w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>