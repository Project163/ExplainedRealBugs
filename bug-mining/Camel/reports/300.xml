<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:28:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-860] DeadLetterChannel does not set the EXCEPTION_CAUSE_PROPERTY</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-860</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The DeadLetterChannel does not set the EXCEPTION_CAUSE_PROPERTY.&lt;/p&gt;

&lt;p&gt;It looks like a bug in the method:&lt;br/&gt;
public boolean process(final Exchange exchange, final AsyncCallback callback, final RedeliveryData data) &lt;/p&gt;

&lt;p&gt;The property is set by getting the Exception from the exchange:&lt;br/&gt;
exchange.setProperty(EXCEPTION_CAUSE_PROPERTY, exchange.getException());&lt;/p&gt;

&lt;p&gt;but several lines before the Exception ist set to null in exchange:&lt;br/&gt;
if (exchange.getException() != null) {&lt;br/&gt;
                Throwable e = exchange.getException();&lt;br/&gt;
                exchange.setException(null); // Reset it since we are handling it.&lt;/p&gt;

&lt;p&gt;to fix the bug, i think it is simply done by preserving the Throwable like this&lt;br/&gt;
Throwable e = exchange.getException();&lt;br/&gt;
if (exchange.getException() != null) {&lt;br/&gt;
                exchange.setException(null); // Reset it since we are handling it.&lt;br/&gt;
...&lt;br/&gt;
exchange.setProperty(EXCEPTION_CAUSE_PROPERTY, e);&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows XP,  JDK 6&lt;/p&gt;</environment>
        <key id="12485510">CAMEL-860</key>
            <summary>DeadLetterChannel does not set the EXCEPTION_CAUSE_PROPERTY</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12486835">CAMEL-870</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="oirad">Dario Sanna</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2008 13:58:57 +0000</created>
                <updated>Sun, 31 Aug 2008 19:52:17 +0000</updated>
                            <resolved>Sat, 30 Aug 2008 11:00:58 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="12948599" author="davsclaus" created="Thu, 28 Aug 2008 05:45:22 +0000"  >&lt;p&gt;Thanks for the report. &lt;/p&gt;

&lt;p&gt;I looked into it and yes the code is a bit &quot;tricky&quot; in the DLC. It actually restores the exception in the incrementRedeliveryCounter method.&lt;/p&gt;

&lt;p&gt;However I feel the code could be a bit more &quot;less surprising&quot; so I am re factoring it a bit (based on your suggestions)&lt;/p&gt;</comment>
                            <comment id="12948586" author="oirad" created="Fri, 29 Aug 2008 09:34:42 +0000"  >&lt;p&gt;The fix does not work, the property is not set.&lt;br/&gt;
Example code :&lt;/p&gt;

&lt;p&gt;from(&quot;file:/data&quot;).convertBodyTo(String.class)&lt;br/&gt;
.errorHandler(deadLetterChannel(&quot;myjms:dead&quot;).maximumRedeliveries(2).useExponentialBackOff())&lt;br/&gt;
.setHeader(&quot;xyz&quot;, xquery(&quot;wrong xquery {}&quot;).asString())&lt;br/&gt;
.to(&quot;direct:blabla&quot;);&lt;/p&gt;

&lt;p&gt;The use case is: &lt;br/&gt;
in case of an exchange-failure, the cause should be visible in the dead-letter-channel, for later investigate.&lt;/p&gt;

</comment>
                            <comment id="12948606" author="davsclaus" created="Sat, 30 Aug 2008 10:57:11 +0000"  >&lt;p&gt;Dario it is working as exepected. I have added some more unit test to verify that the original caused exception is on the exchange.&lt;/p&gt;

&lt;p&gt;However I can see what your problem is. You DLC is a &lt;b&gt;jms&lt;/b&gt; queue. And the JMS spec doesn&apos;t allow to send complex objects as properties on a JMSMessage. So the exception object is lost when its send to the JMS queue, only the body and simple properties is sent.&lt;/p&gt;

&lt;p&gt;The issue is that we need the JMS producer to send the entire exchange as an object to the JMS queue.&lt;br/&gt;
I will create a ticket for this feature in JIRA.&lt;/p&gt;</comment>
                            <comment id="12948647" author="davsclaus" created="Sat, 30 Aug 2008 11:00:58 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-870&quot; title=&quot;camel-jms - transfer exchange&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-870&quot;&gt;&lt;del&gt;CAMEL-870&lt;/del&gt;&lt;/a&gt; about the use of jms for DLC queues.&lt;/p&gt;</comment>
                            <comment id="12948604" author="oirad" created="Sun, 31 Aug 2008 19:52:17 +0000"  >&lt;p&gt;Thank you for the explanation, i think i have to dive deeper in Apache Camel ...&lt;br/&gt;
Many thanks!&lt;br/&gt;
With best regards, Dario&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01euf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>