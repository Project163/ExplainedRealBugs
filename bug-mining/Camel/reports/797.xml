<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:35:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2058] File Component - Rename operations fail sometimes on certain filesystems (Windows)</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2058</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;On Windows (don&apos;t know if there are other platforms that suffer from this problem), the file component fails to successfully rename files with the File.renameTo operation.  It fails when the rename is performed immediately after closing a file.  On Windows this usually indicates that some other process has the file open.  This occurs due to things like Virus scanners which keep the file open for very short periods of time.  Given a slight pause the rename would succeed.&lt;/p&gt;

&lt;p&gt;This is a serious problem which effectively makes useless options like &quot;tempPrefix&quot; in the File Producer and &quot;localWorkDirectory&quot; with the FTP Consumer.  Workarounds like &quot;disable your virus scanner&quot; don&apos;t cut it for everyone (me specifically) as I&apos;m system privilege restricted from doing so, and even then, there&apos;s no guarantee that other windows processes might not do similar things (file indexers, etc).&lt;/p&gt;

&lt;p&gt;The Java spec doesn&apos;t define the behavior of the rename operation and specifically says that this can vary from implementation to implementation / filesystem to filesystem.  Second, rename doesn&apos;t say why it fails, it merely returns false which is very unhelpful.&lt;/p&gt;

&lt;p&gt;A couple ways to fix:&lt;/p&gt;

&lt;p&gt;1).  Provide an option to disable this optimization.  ie, a &quot;alwaysCopyInsteadOfRename&quot; or something (clean, simple, easy).&lt;br/&gt;
This would be a simple fix.  More or less just a few clauses/tests in GenericFileProducer around any &quot;is local&quot; checks....&lt;/p&gt;

&lt;p&gt;2).  Attempt a copy instead if the rename fails&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maybe after a brief pause&lt;/li&gt;
	&lt;li&gt;maybe even after a number of rename attempts&lt;/li&gt;
	&lt;li&gt;maybe watch to see the file is closed prior to a rename attempt.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Rename operation failures may affect other things as well like certain locking schemes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4167147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4167147&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Sun JDK 1.6_16, Eclipse Gallileo, Spring 2.5, Camel 2.0.0, Windows XP SP2, McAfee VirusScan&lt;/p&gt;</environment>
        <key id="12486952">CAMEL-2058</key>
            <summary>File Component - Rename operations fail sometimes on certain filesystems (Windows)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mbmather">Michael Mathers</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Oct 2009 00:26:23 +0000</created>
                <updated>Mon, 21 Mar 2011 13:17:44 +0000</updated>
                            <resolved>Fri, 23 Oct 2009 10:42:34 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12953171" author="davsclaus" created="Mon, 12 Oct 2009 11:06:49 +0000"  >&lt;p&gt;Michael can you try 2.1-SNAPSHOT as we have fixed improved this.&lt;/p&gt;

&lt;p&gt;Fixed already by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1965&quot; title=&quot;onException does not work correctly when used in a transacted route and exception is not send to the bean component called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1965&quot;&gt;&lt;del&gt;CAMEL-1965&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12953302" author="mbmather" created="Mon, 12 Oct 2009 17:45:08 +0000"  >&lt;p&gt;For the record, I did try my route in 2.1-SNAPSHOT before filing the report.  But apparently I tried it just for &lt;tt&gt;localWorkDirectory&lt;/tt&gt; and not for &lt;tt&gt;tempPrefix&lt;/tt&gt;.&lt;br/&gt;
2.1-SNAPSHOT does seem to be fixed for &lt;tt&gt;tempPrefix&lt;/tt&gt; (although I think I still found an issue there), but &lt;ins&gt;NOT&lt;/ins&gt; fixed for &lt;tt&gt;localWorkDirectory&lt;/tt&gt;, an option of the FTP component.&lt;/p&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Issue%231%3A%7B%7BlocalWorkDirectory%7D%7D&quot;&gt;&lt;/a&gt;Issue #1:  &lt;tt&gt;localWorkDirectory&lt;/tt&gt;&lt;/h3&gt;

&lt;p&gt;In both 2.0 and 2.1snap, this has the following behavior.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;After creating the &quot;inprogress&quot; file, it fails renaming (only makes a single attempt) to the final name in the working directory.&lt;/li&gt;
	&lt;li&gt;After failing rename, it proceeds to consider the message &quot;delivered&quot; and does  not attempt to reconsume the file on the next poll (this seems wrong to me, but I&apos;m a newbie).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Issue%232%3A%7B%7BtempPrefix%7D%7D&quot;&gt;&lt;/a&gt;Issue #2:  &lt;tt&gt;tempPrefix&lt;/tt&gt;&lt;/h3&gt;

&lt;p&gt;You are right this is fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1965&quot; title=&quot;onException does not work correctly when used in a transacted route and exception is not send to the bean component called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1965&quot;&gt;&lt;del&gt;CAMEL-1965&lt;/del&gt;&lt;/a&gt; as you indicated.  &lt;em&gt;However&lt;/em&gt;, when using &lt;tt&gt;tempPrefix&lt;/tt&gt; with the &lt;tt&gt;fileExist&lt;/tt&gt; option does not behave as expected.  Instead, the &lt;tt&gt;fileExist&lt;/tt&gt; options are applied to the &quot;temp&quot; file and not to the target file.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Option Value &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Expected Behavior &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Actual Behavior when using &lt;tt&gt;tempPrefix&lt;/tt&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;tt&gt;Override&lt;/tt&gt; (Default) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; If the target file exists, overwrite it &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Will overwrite the temp file if it exists but will fail if the target file exists because the rename operation fails &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;tt&gt;Fail&lt;/tt&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Fail the exchange immediately if the target file exists &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Will fail the exchange immediately if the temp file exists.  Will not fail immediately if the target file exists.  The exchange still fails ultimately though due to the failing of the rename operation. &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I did not test &lt;tt&gt;Append&lt;/tt&gt; or &lt;tt&gt;Ignore&lt;/tt&gt; values but they probably have similar problems.  Also, I did not test other File component options that could involve rename operations such as &lt;tt&gt;readLock:rename&lt;/tt&gt;, &lt;tt&gt;preMove&lt;/tt&gt;, or &lt;tt&gt;moveFailed&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Let me know if you want me to file a separate issue for #2.  Given the number of potential issues with rename and the Java implementation of it (other filesystems?), I&apos;m still thinking that an eventual &quot;ForceCopyInsteadOfRename&quot; option might be a good idea.&lt;/p&gt;</comment>
                            <comment id="12953214" author="davsclaus" created="Mon, 19 Oct 2009 13:29:58 +0000"  >&lt;p&gt;&lt;b&gt;Issue #1&lt;/b&gt;&lt;br/&gt;
1. I am fixing the rename to be aligned with other code by doing retries to cater for Windows platforms. &lt;b&gt;DONE&lt;/b&gt;&lt;br/&gt;
Commited: 826686.&lt;/p&gt;</comment>
                            <comment id="12953244" author="davsclaus" created="Mon, 19 Oct 2009 15:49:57 +0000"  >&lt;p&gt;Can you post a snippet of the route that you are using to test this?&lt;/p&gt;
</comment>
                            <comment id="12953267" author="davsclaus" created="Fri, 23 Oct 2009 08:39:41 +0000"  >&lt;p&gt;&lt;b&gt;Issue #2&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I guess it depends on the OS. On my Mac the rename operation will succeed even if the target file exists. So that could be an Windows OS issue, that wont allow renaming a file when the target filename already exists.&lt;/p&gt;

&lt;p&gt;But Camel should of course use the &lt;tt&gt;fileExist&lt;/tt&gt; option in any case&lt;/p&gt;</comment>
                            <comment id="12953243" author="davsclaus" created="Fri, 23 Oct 2009 09:03:57 +0000"  >&lt;p&gt;Okay looks like I got the hang of this and have fixes being tested now&lt;/p&gt;</comment>
                            <comment id="12953276" author="davsclaus" created="Fri, 23 Oct 2009 10:42:34 +0000"  >&lt;p&gt;trunk: 828994.&lt;/p&gt;

&lt;p&gt;Michael can you test again?&lt;/p&gt;</comment>
                            <comment id="12946053" author="mbmather" created="Fri, 23 Oct 2009 16:31:52 +0000"  >&lt;p&gt;Sorry, I haven&apos;t got back  to help you out with this as you requested.  I just haven&apos;t been able to.  I&apos;ll try to hit the new changes this weekend.&lt;/p&gt;</comment>
                            <comment id="12951099" author="mbmather" created="Sat, 24 Oct 2009 00:04:35 +0000"  >&lt;p&gt;I produced a test to test the issue with the &lt;tt&gt;tempPrefix&lt;/tt&gt; use on Windows when the temporary file pre-exists and &lt;tt&gt;fileExist&lt;/tt&gt; behavior is set to &apos;Fail&apos;.  This test fails in 2.0.0 and now passes in 2.1-SNAPSHOT.  I also tested that when the &lt;em&gt;actual&lt;/em&gt; target file pre-exists that it fails correctly (and not failing due to a &quot;rename&quot; failure).&lt;/p&gt;

&lt;p&gt;I&apos;d produce the test code here but it is currently intermixed with proprietary stuff.  This looks totally resolved to me!&lt;/p&gt;</comment>
                            <comment id="12951157" author="davsclaus" created="Sat, 24 Oct 2009 10:49:43 +0000"  >&lt;p&gt;Thanks Michael for reporting and testing it.&lt;/p&gt;

&lt;p&gt;We can add your test code to Camel when you have the proprietary removed.&lt;/p&gt;</comment>
                            <comment id="12955693" author="davsclaus" created="Thu, 3 Jun 2010 07:24:45 +0000"  >&lt;p&gt;Closing old resolved issues&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12501949">CAMEL-3793</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76651</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01m8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>