<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11999] Cannot create queue/message for Azure</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11999</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The Azure Storage Queue API may have changed unnoticed since the component was incepted. &lt;br/&gt;
Currently it is broken in multiple places.&lt;/p&gt;

&lt;p&gt;CrossRef: &lt;a href=&quot;https://github.com/wildfly-extras/wildfly-camel/issues/1819&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wildfly-extras/wildfly-camel/issues/1819&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13117192">CAMEL-11999</key>
            <summary>Cannot create queue/message for Azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdiesler">Thomas Diesler</assignee>
                                    <reporter username="tdiesler">Thomas Diesler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Nov 2017 06:41:55 +0000</created>
                <updated>Mon, 13 Nov 2017 14:10:33 +0000</updated>
                            <resolved>Fri, 10 Nov 2017 08:11:32 +0000</resolved>
                                    <version>2.20.0</version>
                                    <fixVersion>2.20.1</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-azure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16245381" author="githubbot" created="Thu, 9 Nov 2017 08:40:55 +0000"  >&lt;p&gt;tdiesler opened a new pull request #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16245382" author="githubbot" created="Thu, 9 Nov 2017 08:40:56 +0000"  >&lt;p&gt;GitHub user tdiesler opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tdiesler/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tdiesler/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2087.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2087&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 517be1c23e3b5a9c00182953357d921a34df6d2a&lt;br/&gt;
Author: Thomas Diesler &amp;lt;tdiesler@redhat.com&amp;gt;&lt;br/&gt;
Date:   2017-11-09T05:55:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16247107" author="githubbot" created="Fri, 10 Nov 2017 07:09:44 +0000"  >&lt;p&gt;oscerd commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343392201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343392201&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @davsclaus can we pull this one in 2.20.x before the 2.20.1 cut or do we have to wait?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16247117" author="githubbot" created="Fri, 10 Nov 2017 07:29:41 +0000"  >&lt;p&gt;davsclaus commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343395613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343395613&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @onders86 +1 to backport&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16247120" author="githubbot" created="Fri, 10 Nov 2017 07:37:15 +0000"  >&lt;p&gt;davsclaus commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343396880&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343396880&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Also seems like you need to fix checkstyle&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16247171" author="githubbot" created="Fri, 10 Nov 2017 08:11:54 +0000"  >&lt;p&gt;oscerd commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343404194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343404194&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the PR.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16247172" author="githubbot" created="Fri, 10 Nov 2017 08:11:55 +0000"  >&lt;p&gt;oscerd closed pull request #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-azure/pom.xml b/components/camel-azure/pom.xml&lt;br/&gt;
index d8e94daca95..1e7c7aacdb1 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/pom.xml&lt;br/&gt;
+++ b/components/camel-azure/pom.xml&lt;br/&gt;
@@ -62,6 +62,11 @@&lt;br/&gt;
       &amp;lt;artifactId&amp;gt;camel-test-spring&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
       &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
     &amp;lt;/dependency&amp;gt;&lt;br/&gt;
+    &amp;lt;dependency&amp;gt;&lt;br/&gt;
+        &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;&lt;br/&gt;
+        &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
+        &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
+    &amp;lt;/dependency&amp;gt;&lt;br/&gt;
   &amp;lt;/dependencies&amp;gt;&lt;/p&gt;

&lt;p&gt; &amp;lt;/project&amp;gt;&lt;br/&gt;
diff --git a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceComponent.java b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceComponent.java&lt;br/&gt;
index 42bd47df930..572989c6333 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceComponent.java&lt;br/&gt;
+++ b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceComponent.java&lt;br/&gt;
@@ -42,15 +42,20 @@ protected Endpoint createEndpoint(String uri, String remaining, Map&amp;lt;String, Obje&lt;br/&gt;
         if (remaining != null) &lt;/p&gt;
{
             parts = remaining.split(&quot;/&quot;); 
         }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (parts == null || parts.length &amp;lt; 2) 
{
-            throw new IllegalArgumentException(&quot;The account and queue names must be specified.&quot;);
-        }&lt;/li&gt;
	&lt;li&gt;if (parts.length &amp;gt; 2) 
{
+        if (parts == null || parts.length &amp;lt; 1) 
+            throw new IllegalArgumentException(&quot;The account name must be specified.&quot;);
+
+        QueueServiceOperations operation = configuration.getOperation();
+        if (operation != null &amp;amp;&amp;amp; operation != QueueServiceOperations.listQueues &amp;amp;&amp;amp; parts.length &amp;lt; 2) 
+            throw new IllegalArgumentException(&quot;The queue name must be specified.&quot;);
+
+        if (parts.length &amp;gt; 2) 
             throw new IllegalArgumentException(&quot;Only the account and queue names must be specified.&quot;);
-        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         configuration.setAccountName(parts&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;configuration.setQueueName(parts&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+        &lt;br/&gt;
+        if (parts.length &amp;gt; 1)&lt;br/&gt;
+            configuration.setQueueName(parts&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         checkCredentials(configuration);&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceConfiguration.java b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceConfiguration.java&lt;br/&gt;
index e85cd2c029f..699e013762c 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceConfiguration.java&lt;br/&gt;
+++ b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceConfiguration.java&lt;br/&gt;
@@ -16,11 +16,12 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.camel.component.azure.queue;&lt;/p&gt;

&lt;p&gt;-import com.microsoft.azure.storage.queue.CloudQueue;&lt;br/&gt;
 import org.apache.camel.component.azure.common.AbstractConfiguration;&lt;br/&gt;
 import org.apache.camel.spi.UriParam;&lt;br/&gt;
 import org.apache.camel.spi.UriParams;&lt;/p&gt;

&lt;p&gt;+import com.microsoft.azure.storage.queue.CloudQueue;&lt;br/&gt;
+&lt;br/&gt;
 @UriParams&lt;br/&gt;
 public class QueueServiceConfiguration extends AbstractConfiguration {&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceUtil.java b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceUtil.java&lt;br/&gt;
index 6f094184cfd..9669dbe762c 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceUtil.java&lt;br/&gt;
+++ b/components/camel-azure/src/main/java/org/apache/camel/component/azure/queue/QueueServiceUtil.java&lt;br/&gt;
@@ -31,19 +31,12 @@ private QueueServiceUtil() {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     public static URI prepareStorageQueueUri(QueueServiceConfiguration cfg) &lt;/p&gt;
{
-        return prepareStorageQueueUri(cfg, true);
-    }
&lt;p&gt;-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URI prepareStorageQueueUri(QueueServiceConfiguration cfg, boolean isForMessages) {&lt;br/&gt;
         StringBuilder uriBuilder = new StringBuilder();&lt;br/&gt;
         uriBuilder.append(&quot;https://&quot;)&lt;br/&gt;
             .append(cfg.getAccountName())&lt;br/&gt;
             .append(QueueServiceConstants.SERVICE_URI_SEGMENT)&lt;/li&gt;
	&lt;li&gt;.append(&quot;/&quot;)&lt;/li&gt;
	&lt;li&gt;.append(cfg.getQueueName());&lt;/li&gt;
	&lt;li&gt;if (isForMessages) 
{
-            uriBuilder.append(&quot;/messages&quot;);
-        }
&lt;p&gt;+            .append(&quot;/&quot; + cfg.getQueueName());&lt;br/&gt;
+        &lt;br/&gt;
         return URI.create(uriBuilder.toString());&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -73,7 +66,9 @@ public static StorageCredentials getAccountCredentials(QueueServiceConfiguration&lt;br/&gt;
     public static void retrieveMessage(Exchange exchange, QueueServiceConfiguration cfg) throws Exception &lt;/p&gt;
{
         CloudQueue client = createQueueClient(cfg);
         QueueServiceRequestOptions opts = getRequestOptions(exchange);  
-        CloudQueueMessage message = client.retrieveMessage(cfg.getMessageVisibilityDelay(),
+        int visibilityTimeout = cfg.getMessageVisibilityDelay();
+        visibilityTimeout = visibilityTimeout != 0 ? visibilityTimeout : 30;
+        CloudQueueMessage message = client.retrieveMessage(visibilityTimeout,
                                opts.getRequestOpts(), opts.getOpContext());
         ExchangeUtil.getMessageForResponse(exchange).setBody(message);
     }
&lt;p&gt;diff --git a/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceComponentConfigurationTest.java b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceComponentConfigurationTest.java&lt;br/&gt;
index ac3e3c165d5..111812d03d9 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceComponentConfigurationTest.java&lt;br/&gt;
+++ b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceComponentConfigurationTest.java&lt;br/&gt;
@@ -136,10 +136,10 @@ public void testTooManyPathSegments() throws Exception {&lt;br/&gt;
     public void testTooFewPathSegments() throws Exception {&lt;br/&gt;
         QueueServiceComponent component = new QueueServiceComponent(context);&lt;br/&gt;
         try &lt;/p&gt;
{
-            component.createEndpoint(&quot;azure-queue://camelazure&quot;);
+            component.createEndpoint(&quot;azure-queue://camelazure?operation=addMessage&quot;);
             fail();
         }
&lt;p&gt; catch (IllegalArgumentException ex) &lt;/p&gt;
{
-            assertEquals(&quot;The account and queue names must be specified.&quot;, ex.getMessage());
+            assertEquals(&quot;The queue name must be specified.&quot;, ex.getMessage());
         }
&lt;p&gt;     }&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceProducerTest.java b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceProducerTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..bc3107f80a6&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceProducerTest.java&lt;br/&gt;
@@ -0,0 +1,116 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *      &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.camel.component.azure.queue;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.Hashtable;&lt;br/&gt;
+import java.util.Iterator;&lt;br/&gt;
+import java.util.Properties;&lt;br/&gt;
+&lt;br/&gt;
+import javax.naming.Context;&lt;br/&gt;
+import javax.naming.InitialContext;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.camel.CamelContext;&lt;br/&gt;
+import org.apache.camel.ProducerTemplate;&lt;br/&gt;
+import org.apache.camel.builder.RouteBuilder;&lt;br/&gt;
+import org.apache.camel.impl.DefaultCamelContext;&lt;br/&gt;
+import org.apache.camel.impl.JndiRegistry;&lt;br/&gt;
+import org.junit.Assert;&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import com.microsoft.azure.storage.OperationContext;&lt;br/&gt;
+import com.microsoft.azure.storage.StorageCredentials;&lt;br/&gt;
+import com.microsoft.azure.storage.StorageCredentialsAccountAndKey;&lt;br/&gt;
+import com.microsoft.azure.storage.queue.CloudQueue;&lt;br/&gt;
+import com.microsoft.azure.storage.queue.CloudQueueMessage;&lt;br/&gt;
+&lt;br/&gt;
+public class QueueServiceProducerTest {&lt;br/&gt;
+&lt;br/&gt;
+    private static final String AZURE_STORAGE_QUEUE = &quot;AZURE_STORAGE_QUEUE&quot;;&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testAppendQueue() throws Exception {&lt;br/&gt;
+&lt;br/&gt;
+        StorageCredentials creds = getStorageCredentials(&quot;camelqueue&quot;, System.getenv(AZURE_STORAGE_QUEUE));&lt;br/&gt;
+        Assume.assumeNotNull(&quot;Credentials not null&quot;, creds);&lt;br/&gt;
+&lt;br/&gt;
+        OperationContext.setLoggingEnabledByDefault(true);&lt;br/&gt;
+        &lt;br/&gt;
+        CamelContext camelctx = createCamelContext(creds);&lt;br/&gt;
+        camelctx.addRoutes(new RouteBuilder() {&lt;br/&gt;
+            public void configure() throws Exception &lt;/p&gt;
{
+                from(&quot;direct:createQueue&quot;)
+                .to(&quot;azure-queue://camelqueue/queue1?credentials=#creds&amp;amp;operation=createQueue&quot;);
+
+                from(&quot;direct:listQueues&quot;)
+                .to(&quot;azure-queue://camelqueue?credentials=#creds&amp;amp;operation=listQueues&quot;);
+
+                from(&quot;direct:deleteQueue&quot;)
+                .to(&quot;azure-queue://camelqueue/queue1?credentials=#creds&amp;amp;operation=deleteQueue&quot;);
+
+                from(&quot;direct:addMessage&quot;)
+                .to(&quot;azure-queue://camelqueue/queue1?credentials=#creds&amp;amp;operation=addMessage&quot;);
+
+                from(&quot;direct:retrieveMessage&quot;)
+                .to(&quot;azure-queue://camelqueue/queue1?credentials=#creds&amp;amp;operation=retrieveMessage&quot;);
+            }
&lt;p&gt;+        });&lt;br/&gt;
+&lt;br/&gt;
+        camelctx.start();&lt;br/&gt;
+        try {&lt;br/&gt;
+            ProducerTemplate producer = camelctx.createProducerTemplate();&lt;br/&gt;
+            &lt;br/&gt;
+            Iterator&amp;lt;?&amp;gt; it = producer.requestBody(&quot;direct:listQueues&quot;, null, Iterable.class).iterator();&lt;br/&gt;
+            Assert.assertFalse(&quot;No more queues&quot;, it.hasNext());&lt;br/&gt;
+&lt;br/&gt;
+            producer.sendBody(&quot;direct:addMessage&quot;, &quot;SomeMsg&quot;);&lt;br/&gt;
+            &lt;br/&gt;
+            it = producer.requestBody(&quot;direct:listQueues&quot;, null, Iterable.class).iterator();&lt;br/&gt;
+            Assert.assertTrue(&quot;Has queues&quot;, it.hasNext());&lt;br/&gt;
+            CloudQueue queue = (CloudQueue) it.next();&lt;br/&gt;
+            Assert.assertEquals(&quot;queue1&quot;, queue.getName());&lt;br/&gt;
+            Assert.assertFalse(&quot;No more queues&quot;, it.hasNext());&lt;br/&gt;
+            &lt;br/&gt;
+            try &lt;/p&gt;
{
+                CloudQueueMessage msg = producer.requestBody(&quot;direct:retrieveMessage&quot;, null, CloudQueueMessage.class);
+                Assert.assertNotNull(&quot;Retrieve a message&quot;, msg);
+                Assert.assertEquals(&quot;SomeMsg&quot;, msg.getMessageContentAsString());
+            }
&lt;p&gt; finally &lt;/p&gt;
{
+                queue.delete();
+            }
&lt;p&gt;+            &lt;br/&gt;
+        } finally &lt;/p&gt;
{
+            camelctx.stop();
+        }
&lt;p&gt;+    }&lt;br/&gt;
+&lt;br/&gt;
+    private StorageCredentials getStorageCredentials(String account, String key) &lt;/p&gt;
{
+        return key != null ? new StorageCredentialsAccountAndKey(account, key) : null;
+    }
&lt;p&gt;+&lt;br/&gt;
+    private CamelContext createCamelContext(StorageCredentials credentials) throws Exception &lt;/p&gt;
{
+        JndiRegistry registry = new JndiRegistry(createJndiContext());
+        registry.bind(&quot;creds&quot;, credentials);
+        return new DefaultCamelContext(registry);
+    }
&lt;p&gt;+&lt;br/&gt;
+    private Context createJndiContext() throws Exception &lt;/p&gt;
{
+        Properties properties = new Properties();
+        properties.put(&quot;java.naming.factory.initial&quot;, &quot;org.apache.camel.util.jndi.CamelInitialContextFactory&quot;);
+        return new InitialContext(new Hashtable&amp;lt;Object, Object&amp;gt;(properties));
+    }
&lt;p&gt;+}&lt;br/&gt;
\ No newline at end of file&lt;br/&gt;
diff --git a/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceUtilTest.java b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceUtilTest.java&lt;br/&gt;
index 40bf2a4d0f2..85a7216433f 100644&lt;br/&gt;
&amp;#8212; a/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceUtilTest.java&lt;br/&gt;
+++ b/components/camel-azure/src/test/java/org/apache/camel/component/azure/queue/QueueServiceUtilTest.java&lt;br/&gt;
@@ -32,42 +32,34 @@&lt;br/&gt;
     @Test&lt;br/&gt;
     public void testPrepareUri() throws Exception &lt;/p&gt;
{
         registerCredentials();
-        
+
         QueueServiceComponent component = new QueueServiceComponent(context);
-        QueueServiceEndpoint endpoint = 
-            (QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue?credentials=#creds&quot;);
-        URI uri = 
-            QueueServiceUtil.prepareStorageQueueUri(endpoint.getConfiguration());
-        assertEquals(&quot;https://camelazure.queue.core.windows.net/testqueue/messages&quot;, uri.toString());
+        QueueServiceEndpoint endpoint = (QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue?credentials=#creds&quot;);
+        URI uri = QueueServiceUtil.prepareStorageQueueUri(endpoint.getConfiguration());
+        assertEquals(&quot;https://camelazure.queue.core.windows.net/testqueue&quot;, uri.toString());
     }

&lt;p&gt;     @Test&lt;br/&gt;
     public void testGetConfiguredClient() throws Exception &lt;/p&gt;
{
-        CloudQueue client = 
-            new CloudQueue(URI.create(&quot;https://camelazure.queue.core.windows.net/testqueue/messages&quot;),
-                           newAccountKeyCredentials());
-        
+        CloudQueue client = new CloudQueue(URI.create(&quot;https://camelazure.queue.core.windows.net/testqueue&quot;), newAccountKeyCredentials());
         JndiRegistry registry = (JndiRegistry) ((PropertyPlaceholderDelegateRegistry) context.getRegistry()).getRegistry();
         registry.bind(&quot;azureQueueClient&quot;, client);
-        
+
         QueueServiceComponent component = new QueueServiceComponent(context);
-        QueueServiceEndpoint endpoint = 
-            (QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue?azureQueueClient=#azureQueueClient&quot;);
+        QueueServiceEndpoint endpoint = (QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue?azureQueueClient=#azureQueueClient&quot;);
         assertSame(client, QueueServiceUtil.getConfiguredClient(endpoint.getConfiguration()));
     }
&lt;p&gt;+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void testGetConfiguredClientUriMismatch() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CloudQueue client =&lt;/li&gt;
	&lt;li&gt;new CloudQueue(URI.create(&quot;https://camelazure.queue.core.windows.net/testqueue&quot;),&lt;/li&gt;
	&lt;li&gt;newAccountKeyCredentials());&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;+        CloudQueue client = new CloudQueue(URI.create(&quot;https://camelazure.queue.core.windows.net/testqueue&quot;), newAccountKeyCredentials());&lt;br/&gt;
+&lt;br/&gt;
         JndiRegistry registry = (JndiRegistry) ((PropertyPlaceholderDelegateRegistry) context.getRegistry()).getRegistry();&lt;br/&gt;
         registry.bind(&quot;azureQueueClient&quot;, client);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;+&lt;br/&gt;
         QueueServiceComponent component = new QueueServiceComponent(context);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;QueueServiceEndpoint endpoint =&lt;/li&gt;
	&lt;li&gt;(QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue2?azureQueueClient=#azureQueueClient&quot;);&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;+        QueueServiceEndpoint endpoint = (QueueServiceEndpoint) component.createEndpoint(&quot;azure-queue://camelazure/testqueue2?azureQueueClient=#azureQueueClient&quot;);&lt;br/&gt;
+&lt;br/&gt;
         try {&lt;br/&gt;
             QueueServiceUtil.getConfiguredClient(endpoint.getConfiguration());&lt;br/&gt;
             fail();&lt;br/&gt;
@@ -82,7 +74,6 @@ private void registerCredentials() {&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private StorageCredentials newAccountKeyCredentials() &lt;/p&gt;
{
-        return new StorageCredentialsAccountAndKey(&quot;camelazure&quot;, 
-                                                   Base64.encode(&quot;key&quot;.getBytes()));
+        return new StorageCredentialsAccountAndKey(&quot;camelazure&quot;, Base64.encode(&quot;key&quot;.getBytes()));
     }
&lt;p&gt; }&lt;br/&gt;
diff --git a/components/camel-azure/src/test/resources/log4j.properties b/components/camel-azure/src/test/resources/log4j.properties&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..6b2698af632&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/components/camel-azure/src/test/resources/log4j.properties&lt;br/&gt;
@@ -0,0 +1,36 @@&lt;br/&gt;
+###&lt;br/&gt;
+# #%L&lt;br/&gt;
+# Wildfly Camel :: Testsuite&lt;br/&gt;
+# %%&lt;br/&gt;
+# Copyright (C) 2013 - 2014 RedHat&lt;br/&gt;
+# %%&lt;br/&gt;
+# Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);&lt;br/&gt;
+# you may not use this file except in compliance with the License.&lt;br/&gt;
+# You may obtain a copy of the License at&lt;br/&gt;
+# &lt;br/&gt;
+#      &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+# &lt;br/&gt;
+# Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+# See the License for the specific language governing permissions and&lt;br/&gt;
+# limitations under the License.&lt;br/&gt;
+# #L%&lt;br/&gt;
+###&lt;br/&gt;
+&lt;br/&gt;
+# Root logger option&lt;br/&gt;
+log4j.rootLogger=DEBUG, file, console&lt;br/&gt;
+ &lt;br/&gt;
+# Direct log messages to a log file&lt;br/&gt;
+log4j.appender.file=org.apache.log4j.FileAppender&lt;br/&gt;
+log4j.appender.file.file=target/test.log&lt;br/&gt;
+log4j.appender.file.layout=org.apache.log4j.PatternLayout&lt;br/&gt;
+log4j.appender.file.layout.ConversionPattern=%d&lt;/p&gt;
{yyyy-MM-dd HH:mm:ss}
&lt;p&gt; %-5p &lt;span class=&quot;error&quot;&gt;&amp;#91;%c&amp;#93;&lt;/span&gt; (%t) - %m%n&lt;br/&gt;
+log4j.appender.file.threshold=DEBUG&lt;br/&gt;
+ &lt;br/&gt;
+# Direct log messages to console&lt;br/&gt;
+log4j.appender.console=org.apache.log4j.ConsoleAppender&lt;br/&gt;
+log4j.appender.console.target=System.out&lt;br/&gt;
+log4j.appender.console.layout=org.apache.log4j.PatternLayout&lt;br/&gt;
+log4j.appender.console.layout.ConversionPattern=%d&lt;/p&gt;
{yyyy-MM-dd HH:mm:ss}
&lt;p&gt; %-5p &lt;span class=&quot;error&quot;&gt;&amp;#91;%c&amp;#93;&lt;/span&gt; (%t) - %m%n&lt;br/&gt;
+log4j.appender.console.threshold=WARN&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16247173" author="githubbot" created="Fri, 10 Nov 2017 08:11:55 +0000"  >&lt;p&gt;Github user oscerd closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16249560" author="githubbot" created="Mon, 13 Nov 2017 13:40:36 +0000"  >&lt;p&gt;onders86 commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343921649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343921649&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @davsclaus i guess i missed your message. I will cherry-pick. Thanks.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16249637" author="githubbot" created="Mon, 13 Nov 2017 14:10:33 +0000"  >&lt;p&gt;oscerd commented on issue #2087: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11999&quot; title=&quot;Cannot create queue/message for Azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11999&quot;&gt;&lt;del&gt;CAMEL-11999&lt;/del&gt;&lt;/a&gt; Cannot create queue/message for Azure&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2087#issuecomment-343929732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2087#issuecomment-343929732&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I guess the message was for me. I already cherry picked and backported. Thanks @onders86 &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mkvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>