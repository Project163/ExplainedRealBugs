<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:53:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17861] Streaming  in Azure (Blob-Storage)  component not working </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17861</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;As described in the email conversation below we are having memory problems with the current implementation of the azure (blob storage component).&#160;&lt;br/&gt;
Concretely the component does not stream properly!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;But looking at this stacktrace and the corresponding sourcecode it&#8217;s obvious that the whole stream is read to memory to check the total payload size (seems necessary for the azure client)&lt;/em&gt;&lt;br/&gt;
As we transfer mass data with the azure component we consider this a major bug as we cannot use the azure-component as long as it does not stream properly.&#160;&lt;/p&gt;

&lt;p&gt;Thx and Regards Christian&lt;/p&gt;

&lt;p&gt;Email History (camel user mailing list):&#160;&lt;br/&gt;
&lt;b&gt;Response from Claus Ibsen:&lt;/b&gt;&#160;&lt;br/&gt;
What are the sources of those streams?&lt;br/&gt;
I wonder if we could enrich from the message some sort of total size header&lt;br/&gt;
into the camel blob producer, so it can tell the blob client the expected&lt;br/&gt;
length, so it does not read the stream itself to find out.&lt;br/&gt;
Also if you have the opportunity you are welcome to test with latest Camel&lt;br/&gt;
3.9.0 release, if its still a problem.&lt;br/&gt;
&#160;&lt;br/&gt;
And you are welcome to create a JIRA as it would be great to have streaming&lt;br/&gt;
work well with azure, especially for blob as its supposed to be also big&lt;br/&gt;
blobs of data &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;initial question from Lukas Angerer:&lt;/b&gt;&#160;&lt;br/&gt;
We are transferring lots of data to the azure-storage with the azure-storage-blob component (version 3.7.0)&lt;br/&gt;
The Route itself is only working with streams to keep the memory overhead low, streamcaching is enabled.&lt;/p&gt;

&lt;p&gt;But looking at this stacktrace and the corresponding sourcecode it&#8217;s obvious that the whole stream is read to memory to check the total payload size (seems necessary for the azure client)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.io.output.AbstractByteArrayOutputStream.toByteArrayImpl(AbstractByteArrayOutputStream.java:366)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.io.output.ByteArrayOutputStream.toByteArray(ByteArrayOutputStream.java:163)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.io.IOUtils.toByteArray(IOUtils.java:2241)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.BlobUtils.getInputStreamLength(BlobUtils.java:37)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.BlobStreamAndLength.createBlobStreamAndLengthFromExchangeBody(BlobStreamAndLength.java:50)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.operations.BlobOperations.uploadBlockBlob(BlobOperations.java:181)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.component.azure.storage.blob.BlobProducer.process(BlobProducer.java:86)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.support.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:66)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.camel.processor.SendDynamicProcessor.lambda$process$0(SendDynamicProcessor.java:195)&lt;/p&gt;

&lt;p&gt;I was wondering if there is a better way to do this. Maybe a shortcut for the cached stream that just checks the size of the cache?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13436121">CAMEL-17861</key>
            <summary>Streaming  in Azure (Blob-Storage)  component not working </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mueller110">Christian M&#252;ller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Mar 2022 09:43:52 +0000</created>
                <updated>Fri, 6 May 2022 13:12:35 +0000</updated>
                            <resolved>Thu, 5 May 2022 07:11:32 +0000</resolved>
                                    <version>3.14.1</version>
                                    <fixVersion>3.17.0</fixVersion>
                                    <component>camel-azure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17513337" author="davsclaus" created="Mon, 28 Mar 2022 12:21:25 +0000"  >&lt;p&gt;Can you take a look at the aws components for its blob storage component (such as s3) - i think we have done some better streamining support there that can be good to compare with&lt;/p&gt;</comment>
                            <comment id="17526540" author="mueller110" created="Fri, 22 Apr 2022 16:25:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, sry for my late response.&#160;&lt;br/&gt;
Following your suggestion i checked the aws storage component! My suggestion is to determine the length of the stream like it is done in:&#160;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/abb1ad84fac520b00339533a2eafdeb901e22d87/components/camel-aws/camel-aws2-s3/src/main/java/org/apache/camel/component/aws2/s3/utils/AWS2S3Utils.java#L83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/abb1ad84fac520b00339533a2eafdeb901e22d87/components/camel-aws/camel-aws2-s3/src/main/java/org/apache/camel/component/aws2/s3/utils/AWS2S3Utils.java#L83&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;is it ok if i create a pull request for that?&lt;/p&gt;</comment>
                            <comment id="17527391" author="davsclaus" created="Mon, 25 Apr 2022 09:16:56 +0000"  >&lt;p&gt;Yes a PR is much welcome&lt;/p&gt;</comment>
                            <comment id="17527638" author="mueller110" created="Mon, 25 Apr 2022 16:57:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; fyi &lt;a href=&quot;https://github.com/apache/camel/pull/7493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/7493&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17532832" author="mueller110" created="Fri, 6 May 2022 12:30:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, i tested the solution and found out that it does not work for FileInputStreamCache&lt;br/&gt;
i created a new pullrequest that properly handels FileInputStreamCache as well&#160;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/pull/7561/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/7561/&lt;/a&gt;&lt;br/&gt;
regards christian&lt;/p&gt;</comment>
                            <comment id="17532834" author="mueller110" created="Fri, 6 May 2022 12:33:19 +0000"  >&lt;p&gt;ah sry. just saw that you already fixed that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
i will close my pull request&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10vow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>