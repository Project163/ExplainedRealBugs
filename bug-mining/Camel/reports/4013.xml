<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:22:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10980] error with enableCORS(true) with camel-undertow</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10980</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;enableCORS(true) is causing an java.lang.IllegalArgumentException: Duplicate handler for a method &apos;OPTIONS&apos;: &apos;io.undertow.server.handlers.HttpContinueReadHandler@79c97cb&apos;, &apos;io.undertow.server.handlers.HttpContinueReadHandler@2d9caaeb&apos;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13049851">CAMEL-10980</key>
            <summary>error with enableCORS(true) with camel-undertow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scranton">Scott Cranton</assignee>
                                    <reporter username="scranton">Scott Cranton</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Mar 2017 02:49:35 +0000</created>
                <updated>Fri, 10 Mar 2017 20:45:00 +0000</updated>
                            <resolved>Fri, 10 Mar 2017 20:45:00 +0000</resolved>
                                    <version>2.19.0</version>
                                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-undertow</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15904308" author="scranton" created="Fri, 10 Mar 2017 02:58:28 +0000"  >&lt;p&gt;So if you enableCORS(true) &lt;b&gt;without&lt;/b&gt; setting the ApiContextPath it throws the duplicate OPTIONS handler exception.&lt;/p&gt;

&lt;p&gt;If you set both enableCORS(true) and setApiContextPath(&quot;api-doc&quot;), it does not throw an exception and seems to work.&lt;/p&gt;

&lt;p&gt;If both settings are required, at a minimum the error should be friendlier... Need to debug more...&lt;/p&gt;</comment>
                            <comment id="15905233" author="scranton" created="Fri, 10 Mar 2017 15:14:23 +0000"  >&lt;p&gt;dug a little deeper, and it looks like camel-undertow is throwing the duplicate handler exception because my rest dsl has 2 verbs on same path, and enableCORS(true) has it try to add an OPTIONS handler for each of those paths as well, so the 2nd add fails...&lt;/p&gt;

&lt;p&gt;restConfiguration()...enableCORS(true);&lt;br/&gt;
rest()&lt;br/&gt;
  . get(&quot;/users&quot;).to(...)&lt;br/&gt;
  .post(&quot;/users&quot;.to(...) // fails here trying to add a duplicate OPTIONS, &quot;/users&quot; handler&lt;/p&gt;

&lt;p&gt;I don&apos;t yet know why adding a setApiContextPath() changes things such that this works...&lt;/p&gt;

&lt;p&gt;To be clear, I am NOT testing that CORS is working from the client side. I&apos;m only testing that setting enableCORS(true) is breaking working code (I tripped over this case somehow in setting up other code).&lt;/p&gt;

&lt;p&gt;I tested the same example with the other REST implementations (jetty, netty-http, netty4-http, restlet, servlet, spark-rest), and adding enableCORS(true) does not rest existing unit tests, e.g. &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-netty4-http/src/test/java/org/apache/camel/component/netty4/http/rest/RestNettyHttpVerbTest.java#L78&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-netty4-http/src/test/java/org/apache/camel/component/netty4/http/rest/RestNettyHttpVerbTest.java#L78&lt;/a&gt; and adding .enableCORS(true) does not break existing unit tests.&lt;/p&gt;

&lt;p&gt;camel-coap DOES break, but that feels like how should it handle enabling HTTP headers in an non-HTTP protocol. Feels like a different issue...&lt;/p&gt;</comment>
                            <comment id="15905275" author="scranton" created="Fri, 10 Mar 2017 15:39:07 +0000"  >&lt;p&gt;disregard my comment about setApiContextPath changing things with enableCORS(true) - it does NOT. enableCORS(true) seems to consistently cause a duplicate handler error...&lt;/p&gt;</comment>
                            <comment id="15905421" author="scranton" created="Fri, 10 Mar 2017 17:10:56 +0000"  >&lt;p&gt;OK, looks like camel-undertow is strict about checking for and preventing registration of duplication verb and path pairs, like OPTIONS, /users. In my test code both get(&quot;/users&quot;) and post(&quot;/users&quot;) with enableCORS(true) will cause an attempt to register 2 handlers for the same pair OPTIONS, /users.&lt;/p&gt;

&lt;p&gt;The duplicate check happens here&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-undertow/src/main/java/org/apache/camel/component/undertow/handlers/CamelMethodHandler.java#L55-L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-undertow/src/main/java/org/apache/camel/component/undertow/handlers/CamelMethodHandler.java#L55-L55&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If I comment out this strict duplicate check, all the camel-undertow unit tests pass, including my previously failing enableCORS(true) variant, and CORS seems to work at least with a check test of running swagger-ui against my test code&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/CamelCookbook/camel-cookbook-examples/blob/3271a2cff02784062694536792f3b8d4f6e6f214/camel-cookbook-rest/src/main/java/org/camelcookbook/rest/api/CafeApiRouteBuilder.java#L77-L77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/CamelCookbook/camel-cookbook-examples/blob/3271a2cff02784062694536792f3b8d4f6e6f214/camel-cookbook-rest/src/main/java/org/camelcookbook/rest/api/CafeApiRouteBuilder.java#L77-L77&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also doing a quick look at camel-netty4-http, it appears that it allows duplicate verb, path pairs as well, which is probably why it &quot;works&quot;. It feels like first handler found is used, and since enableCORS(true) seems to cause the same OPTIONS handler to be registered its OK... This doesn&apos;t feel great however, as its only because we&apos;re registering the same handler that it is working - if we needed to handle OPTIONS,/users different for each REST DSL path we&apos;d get unpredictable behavior as first handler found is used...&lt;/p&gt;

&lt;p&gt;Not sure how to process from here...&lt;/p&gt;

&lt;p&gt;Removing the camel-undertow duplicate handler check seems to make it work the same as the other implementations. However it feels like a more through review should happen to figure out what is the right way to handle multiple VERB,PATH duplicates and how to handle CORS specifically...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-undertow/src/main/java/org/apache/camel/component/undertow/handlers/CamelMethodHandler.java#L55-L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-undertow/src/main/java/org/apache/camel/component/undertow/handlers/CamelMethodHandler.java#L55-L55&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please guide on do you want me to submit a PR for removal of the camel-undertow duplicate handler check OR pursue a different line of investigation (I&apos;m not a CORS or HTTP framework expert so may exceed my current expertise, though I seem to be learning them quickly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13050071">CAMEL-10985</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13047276">CAMEL-10913</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b7xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>