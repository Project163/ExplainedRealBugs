<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:09:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8812] Memory leak in HL7MLLPNettyDecoder</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8812</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;HL7MLLPNettyDecoder leaks memory because it doesn&apos;t release the Netty ByteBuf it uses.&lt;/p&gt;

&lt;p&gt;Checkout &lt;a href=&quot;http://netty.io/wiki/reference-counted-objects.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://netty.io/wiki/reference-counted-objects.html&lt;/a&gt; for more information about Netty ByteBuf and preventing leaks.&lt;/p&gt;

&lt;p&gt;When I set the leak detection level to paranoid (-Dio.netty.leakDetectionLevel=paranoid) I get consistent leak reports like the one below.&lt;/p&gt;

&lt;p&gt;I think the solution is to call buf.release() in the decode() method after it&apos;s done with buf. But I&apos;m still trying to reproduce this in a unit test.&lt;/p&gt;


&lt;p&gt;2015-05-28 10:13:48,951 ERROR io.netty.util.ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it&apos;s garbage-collected. See &lt;a href=&quot;http://netty.io/wiki/reference-counted-objects.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://netty.io/wiki/reference-counted-objects.html&lt;/a&gt; for more information.&lt;br/&gt;
Recent access records: 5&lt;br/&gt;
#5:&lt;br/&gt;
	io.netty.buffer.AdvancedLeakAwareByteBuf.release(AdvancedLeakAwareByteBuf.java:45)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:236)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:339)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:324)&lt;br/&gt;
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:847)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
#4:&lt;br/&gt;
	io.netty.buffer.AdvancedLeakAwareByteBuf.toString(AdvancedLeakAwareByteBuf.java:697)&lt;br/&gt;
	org.apache.camel.component.hl7.HL7MLLPNettyDecoder.asString(HL7MLLPNettyDecoder.java:90)&lt;br/&gt;
	org.apache.camel.component.hl7.HL7MLLPNettyDecoder.decode(HL7MLLPNettyDecoder.java:66)&lt;br/&gt;
	io.netty.handler.codec.DelimiterBasedFrameDecoder.decode(DelimiterBasedFrameDecoder.java:216)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:315)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:229)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:339)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:324)&lt;br/&gt;
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:847)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
#3:&lt;br/&gt;
	io.netty.buffer.AdvancedLeakAwareByteBuf.slice(AdvancedLeakAwareByteBuf.java:73)&lt;br/&gt;
	org.apache.camel.component.hl7.HL7MLLPNettyDecoder.decode(HL7MLLPNettyDecoder.java:64)&lt;br/&gt;
	io.netty.handler.codec.DelimiterBasedFrameDecoder.decode(DelimiterBasedFrameDecoder.java:216)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:315)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:229)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:339)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:324)&lt;br/&gt;
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:847)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
#2:&lt;br/&gt;
	io.netty.buffer.AdvancedLeakAwareByteBuf.bytesBefore(AdvancedLeakAwareByteBuf.java:607)&lt;br/&gt;
	org.apache.camel.component.hl7.HL7MLLPNettyDecoder.decode(HL7MLLPNettyDecoder.java:62)&lt;br/&gt;
	io.netty.handler.codec.DelimiterBasedFrameDecoder.decode(DelimiterBasedFrameDecoder.java:216)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:315)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:229)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:339)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:324)&lt;br/&gt;
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:847)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
#1:&lt;br/&gt;
	io.netty.buffer.AdvancedLeakAwareByteBuf.retain(AdvancedLeakAwareByteBuf.java:709)&lt;br/&gt;
	io.netty.handler.codec.DelimiterBasedFrameDecoder.decode(DelimiterBasedFrameDecoder.java:277)&lt;br/&gt;
	org.apache.camel.component.hl7.HL7MLLPNettyDecoder.decode(HL7MLLPNettyDecoder.java:60)&lt;br/&gt;
	io.netty.handler.codec.DelimiterBasedFrameDecoder.decode(DelimiterBasedFrameDecoder.java:216)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:315)&lt;br/&gt;
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:229)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:339)&lt;br/&gt;
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:324)&lt;br/&gt;
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:847)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:131)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Created at:&lt;br/&gt;
	io.netty.buffer.UnpooledByteBufAllocator.newDirectBuffer(UnpooledByteBufAllocator.java:55)&lt;br/&gt;
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:155)&lt;br/&gt;
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:146)&lt;br/&gt;
	io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:107)&lt;br/&gt;
	io.netty.channel.AdaptiveRecvByteBufAllocator$HandleImpl.allocate(AdaptiveRecvByteBufAllocator.java:104)&lt;br/&gt;
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:117)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:511)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:468)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:382)&lt;br/&gt;
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:354)&lt;br/&gt;
	io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12833342">CAMEL-8812</key>
            <summary>Memory leak in HL7MLLPNettyDecoder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="vandenbrink@zorgdomein.nl">Gijsbert van den Brink</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 May 2015 08:15:56 +0000</created>
                <updated>Fri, 29 May 2015 15:27:38 +0000</updated>
                            <resolved>Fri, 29 May 2015 15:27:38 +0000</resolved>
                                    <version>2.15.2</version>
                                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-hl7</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14564535" author="vandenbrink@zorgdomein.nl" created="Fri, 29 May 2015 10:24:31 +0000"  >&lt;p&gt;Attached is a unit test that reproduces the ResourceLeak error message. I&apos;m not sure how to turn this into a proper test though. Don&apos;t know what to assert on..&lt;/p&gt;</comment>
                            <comment id="14564545" author="vandenbrink@zorgdomein.nl" created="Fri, 29 May 2015 10:34:25 +0000"  >&lt;p&gt;This seems to fix it for me.&lt;/p&gt;</comment>
                            <comment id="14564970" author="njiang" created="Fri, 29 May 2015 15:27:25 +0000"  >&lt;p&gt;Applied the patch into Camel master, camel 2.15.x branch with thanks to Gijsbert.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12736106" name="0001-Release-netty-ByteBuf-after-use-fixes-resource-leak.patch" size="2194" author="vandenbrink@zorgdomein.nl" created="Fri, 29 May 2015 10:34:25 +0000"/>
                            <attachment id="12736105" name="HL7MLLPNettyDecoderResourceLeakTest.java" size="1900" author="vandenbrink@zorgdomein.nl" created="Fri, 29 May 2015 10:24:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fb1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>