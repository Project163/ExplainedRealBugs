<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:55:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5971] HdfsOutputStream is not closing</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5971</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have a simple camel route that takes file from a camel-file consumer endpoint and sends to a camel-hdfs producer endpoint:&lt;/p&gt;

&lt;p&gt;&amp;lt;from uri=&quot;file:/local/workspace/inbox?delete=true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;to uri=&quot;hdfs://localhost:9000/local/workspace/outbox/file1&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;However, my Hadoop server only creates a zero length file &quot;file1.opened&quot; unless I stop camel route or a splitting condition is met with a &quot;splitStratedy&quot; option added to URI. In above cases, a file called &quot;file1&quot; is created with proper contents and the &quot;file1.opened&quot; is disappeared.  &lt;/p&gt;

&lt;p&gt;It looks like that close() function of HdfsOutputStream is never called unless the camel route/context is stopping or we are splitting the file by looking at source code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12627641">CAMEL-5971</key>
            <summary>HdfsOutputStream is not closing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jluo">Joe Luo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jan 2013 13:13:51 +0000</created>
                <updated>Fri, 1 Feb 2013 11:47:03 +0000</updated>
                            <resolved>Fri, 1 Feb 2013 11:47:03 +0000</resolved>
                                    <version>2.10.3</version>
                                    <fixVersion>2.10.4</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-hdfs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13553864" author="njiang" created="Tue, 15 Jan 2013 15:00:56 +0000"  >&lt;p&gt;It&apos;s not a effective to write the hdfs is we close the stream every time.&lt;br/&gt;
Maybe we can consider to add a option to make sure the camel-hdfs producer to close the stream once the producer is finished the processing.&lt;/p&gt;</comment>
                            <comment id="13554879" author="davsclaus" created="Wed, 16 Jan 2013 09:43:36 +0000"  >&lt;p&gt;There is some idle task in the hdfs producer. I would assume that ought to close the stream if the producer is not busy.&lt;/p&gt;

&lt;p&gt;Though camel-hdfs is a bit odd. I would have liked it was implemented more like camel-file etc. In fact we have another JIRA ticket about that.&lt;/p&gt;</comment>
                            <comment id="13555934" author="njiang" created="Thu, 17 Jan 2013 07:04:00 +0000"  >&lt;p&gt;Yeah, from the usage of the user, it looks like we need to change the file name dynamically. &lt;br/&gt;
I think most people uses HDFS to store the large size file, so we didn&apos;t hit this kind of request before.&lt;/p&gt;</comment>
                            <comment id="13559476" author="davsclaus" created="Tue, 22 Jan 2013 08:21:06 +0000"  >&lt;p&gt;Why is closing a stream not efficient? &lt;/p&gt;

&lt;p&gt;Is the idea to keep the stream open just in case there is a lot of writes to HDFS?&lt;br/&gt;
But even if the stream is open, the data must be flushed at some point? Or does HDFS only let &quot;other parties&quot; see the file when the stream is closed.&lt;br/&gt;
So you can write to the stream 1000 times and only when you close its visibile for other parties?&lt;/p&gt;

&lt;p&gt;I dont see a point of keeping the stream open, when the end user has no way of closing it after usage.&lt;br/&gt;
Either we should&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;always close the stream after writing in the producer&lt;/li&gt;
	&lt;li&gt;use some background task to close the stream if idle for more than X&lt;/li&gt;
	&lt;li&gt;allow people to explicit close the stream in some way&lt;/li&gt;
	&lt;li&gt;add new option: closeStream=true|false which people can turn off|on to have old behavior etc&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13566268" author="njiang" created="Wed, 30 Jan 2013 07:50:20 +0000"  >&lt;p&gt;It&apos;s not a common practice that we close the HDFS OutputStream and try to append the data later.&lt;br/&gt;
It could more easy to make the data is consistent if we just make sure the file is visible for the other parties when the stream is closed.&lt;br/&gt;
Here is a page&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; to explain this.&lt;br/&gt;
I think when we provide the option of closeStream, I don&apos;t think we need to check the append option at the same time.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;http://blog.cloudera.com/blog/2009/07/file-appends-in-hdfs/  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17mg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>