<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:53:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5574] camel-sftp&apos;s stepwise behavior to walk up and down relatively to avoid potential traversal issues</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5574</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I am having a directory traversal problem using the stepwise mode of camel-sftp at the producer side. Basically, it can walk down the path from the starting directory to the walking directory, but it cannot go back correctly to the original starting directly. The server is SSH-2.0-Cleo VLProxy/3.0.1 SSH FTP server.&lt;br/&gt;
I saw a related JIRA issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-3309&quot; title=&quot;Stepwise change of directory unfit for production (ftp/ftps/sftp)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-3309&quot;&gt;&lt;del&gt;CAMEL-3309&lt;/del&gt;&lt;/a&gt; that describes some issues in the stepwise traversal and some background to this related problem.&lt;/p&gt;

&lt;p&gt;My question is on the part that changes the working directory back to the original starting folder. I am wondering why we are using stepwise traversal from the ancestor directory towards the starting child directory, instead of moving upwards relatively from the working directory back to the starting directory. This reverse traversal does not require accessing the ancestry path above the staring directory (hence, not affected by the accessing problem). And in fact, I think this reverse stepwise traversal seems more natural order than doing stepwise traversal each time from top down. How do you think?&lt;/p&gt;

&lt;p&gt;I have made a change that implements this reverse stepwise traversal in SftpOperations and also made a few minor improvement changes.&lt;br/&gt;
This changed version passes all the existing tests and works also against the above server.&lt;/p&gt;

&lt;p&gt;I am attaching a patch file for this change. I would appreciate if you can comment on it.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606484">CAMEL-5574</key>
            <summary>camel-sftp&apos;s stepwise behavior to walk up and down relatively to avoid potential traversal issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="ay">Akitoshi Yoshida</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Sep 2012 20:57:01 +0000</created>
                <updated>Thu, 24 Jan 2013 16:54:59 +0000</updated>
                            <resolved>Thu, 24 Jan 2013 16:54:59 +0000</resolved>
                                    <version>2.10.1</version>
                                    <fixVersion>2.9.4</fixVersion>
                    <fixVersion>2.10.2</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13456850" author="njiang" created="Mon, 17 Sep 2012 07:09:42 +0000"  >&lt;p&gt;Applied patch into with thanks to Aki into trunk, camel-2.10.x and camel-2.9.x branches.&lt;/p&gt;</comment>
                            <comment id="13559594" author="davsclaus" created="Tue, 22 Jan 2013 12:42:13 +0000"  >&lt;p&gt;-1 to this patch.&lt;/p&gt;

&lt;p&gt;The code in ftp/sftp/ftps should be similar as we keep the code in sync between the various FTP protocols. This code is only done at sftp and not the others.&lt;/p&gt;

&lt;p&gt;And it causes a regression bug logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5989&quot; title=&quot;Camel SFTP endpoint throws exception when running camel route on Windows OS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5989&quot;&gt;&lt;del&gt;CAMEL-5989&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;About the logic for stepwise. It is as it was designed, and its better to be consistent across the FTP protocols, and hence why the code is identical in the xxxOperations source code.&lt;/p&gt;

&lt;p&gt;If there is a better algorithm for stepwise then it has to be done across all FTP protocols and be consistent.&lt;/p&gt;</comment>
                            <comment id="13559622" author="ay" created="Tue, 22 Jan 2013 13:29:07 +0000"  >&lt;p&gt;Hi Claus,&lt;br/&gt;
I can work on the modified patch along your suggestion.&lt;/p&gt;

&lt;p&gt;Regarding &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5989&quot; title=&quot;Camel SFTP endpoint throws exception when running camel route on Windows OS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5989&quot;&gt;&lt;del&gt;CAMEL-5989&lt;/del&gt;&lt;/a&gt;, I am not sure why it is causing an windows related issue, as I was also using windows and thought the directory path was normalized at that place. (by the way, you linked the wrong ticket from &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5989&quot; title=&quot;Camel SFTP endpoint throws exception when running camel route on Windows OS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5989&quot;&gt;&lt;del&gt;CAMEL-5989&lt;/del&gt;&lt;/a&gt; in your comment there, 5564 instead of 5574). &lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13559647" author="davsclaus" created="Tue, 22 Jan 2013 14:03:58 +0000"  >&lt;p&gt;Aki,&lt;/p&gt;

&lt;p&gt;Yeah its important that the code is similar between ftp and s-ftp. eg the code in FtpOperations and SftpOperations is the same, except for when they use the native ftp client. This ensures that functionality works the same. As well when we change/add new options etc then its easier to implement in both as its the same. Also the regular ftp tests will sort-of test sftp as well, as the code is following the same pattern.&lt;/p&gt;

&lt;p&gt;In the early days we did not have a Java SFTP library to test against, so we did not have any SFTP tests. But recently we have a SFTP library now (though not sure if it works as well as a real SFTP server). And therefore we got a bit of sftp tests also.&lt;/p&gt;

&lt;p&gt;Also in the earlier days the SFTP tests caused the CI servers to hang. But just recently we enabled the tests again. And it seems the SFTP library is more stable and allow CI servers to not hang anymore.&lt;/p&gt;
</comment>
                            <comment id="13559650" author="davsclaus" created="Tue, 22 Jan 2013 14:06:04 +0000"  >&lt;p&gt;Also the ftp component is a bit complicated as people use different OS&apos;es and different FTP servers. And depending on if they are client or server etc. connecting to another OS etc. It gets a bit complicated with the / or \ handling of path separators. As well how the FTP server accepts traversing file paths. Some servers require you to CD into a dir, before you can GET or PUT. Where as others do not so you can GET foo/bar/myfile.dat etc.&lt;/p&gt;

&lt;p&gt;The world would have been easier if the windows guys just had used the same path separator as the rest of the world. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13559716" author="davsclaus" created="Tue, 22 Jan 2013 15:39:39 +0000"  >&lt;p&gt;I agree the stepwise and directory traversal could be better.&lt;br/&gt;
Though its problematic when people use absolute or relative starting directories as well.&lt;/p&gt;

&lt;p&gt;Also the logic for changing to parent directory could possible in sftp operations be using &quot;..&quot; which we would assume should be supported by the ftp client as a valid input to change dir command.&lt;/p&gt;</comment>
                            <comment id="13561602" author="ay" created="Thu, 24 Jan 2013 12:58:58 +0000"  >&lt;p&gt;Hi Claus,&lt;br/&gt;
As I commented in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5989&quot; title=&quot;Camel SFTP endpoint throws exception when running camel route on Windows OS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5989&quot;&gt;&lt;del&gt;CAMEL-5989&lt;/del&gt;&lt;/a&gt;, it looks like the original patch made in 2.10.2 worked for unix and windows as jsch consistently used the absolute path with &quot;/&quot; as delimiter and FileUtils.compactPath was not converting this path into the windows syntax on windows.&lt;/p&gt;

&lt;p&gt;FileUtils.compachPath in 2.10.3 converted this path into the windows syntax on windows. And rev 1424437 changed SFTPOperations to call FileUtils.compactPath with the explicit delimiter.&lt;/p&gt;

&lt;p&gt;To unify the processing in ftp and sftp, which have different behaviors, we need to make some of these underlining assumption detectable or if not, additionally configurable. Do you think it makes sense to use this ticket to do this refactoring or create a new one and refer to this ticket? &lt;/p&gt;

&lt;p&gt;How do you think?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;
</comment>
                            <comment id="13561755" author="davsclaus" created="Thu, 24 Jan 2013 16:54:48 +0000"  >&lt;p&gt;Aki, yeah you found the solution.&lt;/p&gt;

&lt;p&gt;That said, I still think the stepwise code can be improved and how sftp changes to parent directory etc.&lt;br/&gt;
I will open a new ticket, and then we can consider improving this in a future release or even 2.11 if we got the time.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12487892">CAMEL-3309</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12544109" name="trunk-camel-ftp.diff" size="4884" author="ay" created="Thu, 6 Sep 2012 20:58:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i027xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>