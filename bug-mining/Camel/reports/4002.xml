<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:21:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10820] DefaultFluentProducerTemplate mixes up data when sending asynchronously</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10820</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;DefaultFluentProducerTemplate&lt;/p&gt;

&lt;p&gt;code:&lt;/p&gt;

&lt;p&gt;producer = context.createFluentProducerTemplate();&lt;/p&gt;

&lt;p&gt;future1 = producer.withHeader(&quot;action&quot;, &quot;register&quot;).withBody(body1).asyncSend();&lt;br/&gt;
future2 = producer.withHeader(&quot;action&quot;, &quot;register&quot;).withBody(body2).asyncSend();&lt;/p&gt;

&lt;p&gt;These two subsequent calls produces with the default creation two calls with the same body - body2.&lt;br/&gt;
The cause is that it uses default processor supplier () -&amp;gt; this::populateExchange which is call lazily at the time of send and at that time the body property of DefaultFluentProducerTemplate is body2.&lt;/p&gt;</description>
                <environment>&lt;p&gt;eclipse, win7, gradle&lt;/p&gt;</environment>
        <key id="13042555">CAMEL-10820</key>
            <summary>DefaultFluentProducerTemplate mixes up data when sending asynchronously</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lb">Luca Burgazzoli</assignee>
                                    <reporter username="jub">Jakub Cernohorsky</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Feb 2017 12:03:30 +0000</created>
                <updated>Tue, 7 Mar 2017 14:04:37 +0000</updated>
                            <resolved>Tue, 7 Mar 2017 14:04:37 +0000</resolved>
                                    <version>2.18.2</version>
                                    <fixVersion>2.18.4</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15889787" author="davsclaus" created="Wed, 1 Mar 2017 08:49:01 +0000"  >&lt;p&gt;Ah well spotted.&lt;/p&gt;

&lt;p&gt;I wonder if you fancy taking a stab at trying to implement a fix for this? Not sure on top of my head how to do this, but maybe somehow with async send the state of the template must be computed and send asap. Or you need some kind of Stack to push/pop when doing multiple sends or something.&lt;/p&gt;
</comment>
                            <comment id="15896270" author="jub" created="Sun, 5 Mar 2017 13:39:28 +0000"  >&lt;p&gt;default processor always create copy of headers and actual reference of body&lt;/p&gt;</comment>
                            <comment id="15896271" author="jub" created="Sun, 5 Mar 2017 13:41:21 +0000"  >&lt;p&gt;The easiest solution would be to always create copy of headers and keep actual reference to body. It is not the most efficient way, because the copy of headers is also done for synchronuous calls.&lt;/p&gt;</comment>
                            <comment id="15896917" author="lb" created="Mon, 6 Mar 2017 08:50:40 +0000"  >&lt;p&gt;We may also delay the creation of default exchangeSupplier/processorSupplier so that for async* operation we can make a copy of the values only if needed&lt;/p&gt;</comment>
                            <comment id="15897073" author="lb" created="Mon, 6 Mar 2017 10:41:35 +0000"  >&lt;p&gt;I changed a little bit producer template so that it copies the body and headers when doing async stuffs, the changes are there: &lt;a href=&quot;https://github.com/lburgazzoli/apache-camel/commit/e329eabfe98f5ecab7fe50737567a0a921442325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lburgazzoli/apache-camel/commit/e329eabfe98f5ecab7fe50737567a0a921442325&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jub&quot; class=&quot;user-hover&quot; rel=&quot;jub&quot;&gt;jub&lt;/a&gt; do you mind having a look ?&lt;/p&gt;</comment>
                            <comment id="15899379" author="davsclaus" created="Tue, 7 Mar 2017 12:51:21 +0000"  >&lt;p&gt;Luca this looks fine&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12856173" name="default_fluent_producer_template.diff" size="1796" author="jub" created="Sun, 5 Mar 2017 13:39:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39zrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>