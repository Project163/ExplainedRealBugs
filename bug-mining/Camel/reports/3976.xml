<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:21:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10849] Salesforce: subscription channel created per component</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10849</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If I creates two salesforce consumers, I can&apos;t set different options per channel as the client is configured on component level so i.e. you can&apos;t set a per channel replay id as only the first one is taken into account:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    from(&lt;span class=&quot;code-quote&quot;&gt;&apos;salesforce:comments-1?updateTopic=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;sObjectQuery=SELECT Id, CommentId__c FROM Comment_Event__c&apos;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:salesforce-comments?level=INFO&amp;amp;showHeaders=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;multiline=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
    from(&lt;span class=&quot;code-quote&quot;&gt;&apos;salesforce:comments-2?updateTopic=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;sObjectQuery=SELECT Id FROM Case&apos;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:salesforce-cases?level=INFO&amp;amp;showHeaders=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;multiline=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13043655">CAMEL-10849</key>
            <summary>Salesforce: subscription channel created per component</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zregvart">Zoran Regvart</assignee>
                                    <reporter username="lb">Luca Burgazzoli</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2017 14:27:59 +0000</created>
                <updated>Tue, 8 Jan 2019 19:03:52 +0000</updated>
                            <resolved>Fri, 24 Feb 2017 13:21:01 +0000</resolved>
                                                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15871647" author="zregvart" created="Fri, 17 Feb 2017 10:46:39 +0000"  >&lt;p&gt;Its not all that well documented, but you can set per channel replay ids via the &lt;tt&gt;initialReplayIdMap&lt;/tt&gt; property, it accepts a map keyed by channel name for which replay id is the value. It is somewhat odd that the CometD listeners are on per-component level not per-endpoint level, the original reasoning behind this could be optimization &amp;#8211; so to have only one connection to Salesforce (per component), and multiple subscribers (per consumer endpoint).&lt;/p&gt;

&lt;p&gt;Perhaps having a endpoint property &lt;tt&gt;replayId&lt;/tt&gt; that would override any values for the channel in &lt;tt&gt;initialReplayIdMap&lt;/tt&gt; or value in &lt;tt&gt;defaultReplayId&lt;/tt&gt; would be the solution?&lt;/p&gt;

&lt;p&gt;Wonder if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sirlatrom&quot; class=&quot;user-hover&quot; rel=&quot;sirlatrom&quot;&gt;sirlatrom&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhirajsb&quot; class=&quot;user-hover&quot; rel=&quot;dhirajsb&quot;&gt;dhirajsb&lt;/a&gt; could chime in?&lt;/p&gt;</comment>
                            <comment id="15871668" author="lb" created="Fri, 17 Feb 2017 10:59:20 +0000"  >&lt;p&gt;I did set the replay id per channel using the map but it is not taken into account as once the SubscriptionHelper get initialized, the initialReplayIdMap is not more taken into account&lt;/p&gt;</comment>
                            <comment id="15874921" author="sirlatrom" created="Mon, 20 Feb 2017 18:29:39 +0000"  >&lt;p&gt;I believe it has to do with the session being bound to the component through its configuration, and the CometD listeners getting their messages over an authenticated session.&lt;/p&gt;</comment>
                            <comment id="15878091" author="zregvart" created="Wed, 22 Feb 2017 12:17:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt; I&apos;ve committed a fix for this. The CometD client is still tied to the component, I think this makes sense as the number of clients connected to Salesforce is limited (per edition you run). I&apos;ve change the way the replay support is configured and those properties (`defaultReplayId` and `initialReplayIdMap`) set on endpoint configuration should be taken into account, and preferred over the configuration on the component.&lt;/p&gt;

&lt;p&gt;With the CometD client tied to component, this means that you cannot configure per-endpoint HTTP client, I don&apos;t see it as a great disadvantage, but it could be addressed by creating a new CometD client if the HTTP client on the component and on the endpoint differ.&lt;/p&gt;

&lt;p&gt;Can you give it a spin and close this if it&apos;s now OK for you?&lt;/p&gt;</comment>
                            <comment id="15880160" author="lb" created="Thu, 23 Feb 2017 09:19:32 +0000"  >&lt;p&gt;A few notes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it would be nice to keep logging the replay id used for a channel&lt;/li&gt;
	&lt;li&gt;on endpoint level, it could make more sense to have also replayId instead of defaultReplayId/defaultReplayIdMap as most of the time you&apos;ll end up writing &lt;tt&gt;from(&quot;salesforce:comments-1?defaultReplayId=-1&amp;amp;...&quot;)&lt;/tt&gt; and defaultReplayId is a little misleading, &lt;tt&gt;from(&quot;salesforce:comments-1?replayId=-1&amp;amp;...&quot;)&lt;/tt&gt; is much clean IMHO.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15880369" author="sirlatrom" created="Thu, 23 Feb 2017 12:50:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt; I agree about logging; though it is possible to see already it if you enable debug logging level for the CometD client, as it is part of the subscribe message payload, and you could log it in your consuming route by reading the corresponding exchange header.&lt;/p&gt;

&lt;p&gt;As per the current naming, it is to signify that unless you specify initial &lt;tt&gt;replayId&lt;/tt&gt; values per channel using the &lt;tt&gt;initialReplayIdMap&lt;/tt&gt;, the default specified by &lt;tt&gt;defaultReplayId&lt;/tt&gt; should be used.&lt;/p&gt;

&lt;p&gt;Use case:&lt;br/&gt;
Keep 3 instances of a service running that subscribe to the same topic. They use Idempotent Consumer (&lt;a href=&quot;http://camel.apache.org/idempotent-consumer.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/idempotent-consumer.html&lt;/a&gt;) to only process each message once, but at the end of each route, the replayId from the message is stored, e.g. in Redis with a 24h TTL (since replayIds older than that are invalid anyway). When the application starts up, the initial replayIds are read from Redis and populated into the &lt;tt&gt;initialReplayIdMap&lt;/tt&gt;. Topics for which no replayId is stored (or it expired per TTL) will then have &lt;tt&gt;defaultReplayId&lt;/tt&gt; instead.&lt;/p&gt;

&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="15880697" author="lb" created="Thu, 23 Feb 2017 15:59:28 +0000"  >&lt;p&gt;Yes it make sense but what I meant was that when you want to set a replyId on the uri string, thus bound to a specific channel, having something named initialReplayIdMap or defaultReplayId does not make much sense whereas they are perfectly meaningful on component level.&lt;/p&gt;</comment>
                            <comment id="15880926" author="sirlatrom" created="Thu, 23 Feb 2017 17:49:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt; I agree completely. So at the endpoint level, there would only be a single replayId URI parameter, &lt;tt&gt;replayId&lt;/tt&gt;, which would override any default or initial replay IDs. This would only be useful if you&apos;re not actually using the replay functionality, or if you always want to play back the past 24 hours by setting the value to &lt;tt&gt;-2&lt;/tt&gt;. Am I missing any other obvious use cases?&lt;/p&gt;</comment>
                            <comment id="15881096" author="dhirajsb" created="Thu, 23 Feb 2017 19:36:45 +0000"  >&lt;p&gt;IIRC, the way that field was set was at the client level, which is wrong, it should really be just added to a map that the SF extension should then use. Or it could be an endpoint property, which I think you are making it now. That should be the only change required, since the SF extension does use a map from what I recall. &lt;/p&gt;</comment>
                            <comment id="15882334" author="zregvart" created="Fri, 24 Feb 2017 09:45:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sirlatrom&quot; class=&quot;user-hover&quot; rel=&quot;sirlatrom&quot;&gt;sirlatrom&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhirajsb&quot; class=&quot;user-hover&quot; rel=&quot;dhirajsb&quot;&gt;dhirajsb&lt;/a&gt; Thank you for the feedback, I&apos;ve added two additional (small) changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;logging at INFO level on subscription noting the replay ID sent (if sent)&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;replayId&lt;/tt&gt; Endpoint URI option that has preference over all other &lt;tt&gt;*replayId&lt;/tt&gt; options&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Do you think we can resolve this now?&lt;/p&gt;</comment>
                            <comment id="15882650" author="lb" created="Fri, 24 Feb 2017 13:21:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt; thx so much&lt;/p&gt;</comment>
                            <comment id="16737424" author="hnguyen15" created="Tue, 8 Jan 2019 19:03:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt;&#160;In version 2.23.0 when I set&#160;initialReplayIdMap to a value when the route starts everything behave like normal and&#160;I am&#160;fine with the replays. I&apos;m getting an issue&#160;every time the route re-subscribes it tries to replay from the map again. The initialReplayIdMap needs to zero out (don&apos;t see any code that modifies the initialReplayIdMap) so we can default to -1 so we can wait for new replay ids. Eventually if i leave the route on for over 24 hours it eventually breaks because the replay id 24h time to live.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My app keeps track of the last replay id that happens so if the app is down at startup it will replay from the last replay id and listens for new ones.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks for any help.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13021736">CAMEL-10495</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a6jj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>