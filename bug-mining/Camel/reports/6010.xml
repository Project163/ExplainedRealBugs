<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:51:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17466] xtokenize does not select following siblings in mode &quot;W&quot;</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17466</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Given the following XML:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;root&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &amp;lt;Level1&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;Level2preceding&amp;gt;Included&amp;lt;/Level2preceding&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;Level2&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &amp;lt;data&amp;gt;Hello, World!&amp;lt;/data&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160;&#160;&amp;lt;data&amp;gt;Hello, Camel!&amp;lt;/data&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160;&#160;&amp;lt;data&amp;gt;Hello, Apache Foundation!&amp;lt;/data&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;/Level2&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;Level2following&amp;gt;Not Included&amp;lt;/Level2following&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &amp;lt;/Level1&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;lt;/root&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;and the following xtokenizer:&lt;/p&gt;

&lt;p&gt;&amp;lt;xtokenize mode=&quot;w&quot;&amp;gt;/root/Leve1/Level2/data&amp;lt;/xtokenize&amp;gt;&lt;/p&gt;

&lt;p&gt;will yield the following result:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;root&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &amp;lt;Level1&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;Level2preceding&amp;gt;Included&amp;lt;/Level2preceding&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;Level2&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &amp;lt;data&amp;gt;Hello, World!&amp;lt;/data&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &amp;lt;/Level2&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &amp;lt;/Level1&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;lt;/root&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Please note that the node &lt;tt&gt;&amp;lt;Level2following/&amp;gt;&lt;/tt&gt; is missing while &lt;tt&gt;&amp;lt;Level2preceding/&amp;gt;&lt;/tt&gt; is included. Since both nodes are a child of &lt;tt&gt;&amp;lt;Level1/&amp;gt;&lt;/tt&gt; the tokenizer should include &lt;tt&gt;&amp;lt;Level2following/&amp;gt;&lt;/tt&gt;, too, since they are a child of a ancestor of the &lt;tt&gt;&amp;lt;data/&amp;gt;&lt;/tt&gt; node which the splitter processes.&lt;/p&gt;

&lt;p&gt;The documentation mentions that the mode &quot;w&quot; will include the node in its ancestor content. Strictly speaking, the XPath ancestor would exclude &lt;tt&gt;&amp;lt;Level2preceding&amp;gt;&lt;/tt&gt;. If I understand the XPath spec correctly the current implementation &lt;tt&gt;uses ancestor:: | preceding::&lt;/tt&gt; as the wrapper which it is a bit counterintuitive. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Servicemix 7.0.1 -&amp;gt; Camel 2.16.5&lt;/p&gt;</environment>
        <key id="13421789">CAMEL-17466</key>
            <summary>xtokenize does not select following siblings in mode &quot;W&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fhossfel">Felix Ho&#223;feld</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Jan 2022 18:40:59 +0000</created>
                <updated>Sat, 3 Sep 2022 10:50:05 +0000</updated>
                            <resolved>Sat, 3 Sep 2022 10:50:05 +0000</resolved>
                                                    <fixVersion>3.x</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17472227" author="davsclaus" created="Mon, 10 Jan 2022 18:46:05 +0000"  >&lt;p&gt;Camel 2.x is EOL and not supported.&lt;/p&gt;

&lt;p&gt;Can you try to test with latest Camel 3.x release, you dont have to try to run in ServiceMix or OSGi etc. Just a plain unit test or a standalone camel is fine&lt;/p&gt;</comment>
                            <comment id="17472320" author="JIRAUSER283343" created="Mon, 10 Jan 2022 21:28:05 +0000"  >&lt;p&gt;I have created a test case on &lt;a href=&quot;https://github.com/thought-gang/camel-xtokenize-testcase&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Github&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I should fail when running&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;mvn test&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The culprit is the following assertion predicate:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;exchange.getIn().getBody(String.class).contains(&quot;&amp;lt;Level2following&amp;gt;Not Included&amp;lt;/Level2following&amp;gt;&quot;)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17474382" author="davsclaus" created="Wed, 12 Jan 2022 09:05:31 +0000"  >&lt;p&gt;Thanks for the test case.&lt;/p&gt;

&lt;p&gt;Would you try to fix this, the code is in org.apache.camel.language.xtokenizer.XMLTokenExpressionIterator in core/camel-xml-jaxp module.&lt;br/&gt;
I added your test case that reproduces the problem&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/63b2a66be519d118b79be9170c9e89ea8701b30b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/63b2a66be519d118b79be9170c9e89ea8701b30b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then you can run this test and fix the &quot;bug&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17558550" author="klease78" created="Fri, 24 Jun 2022 15:47:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;The documentation mentions that the mode &quot;w&quot; will include the node in its ancestor content. Strictly speaking, the XPath ancestor would exclude &lt;tt&gt;&amp;lt;Level2preceding&amp;gt;&lt;/tt&gt;. If I understand the XPath spec correctly the current implementation &lt;tt&gt;uses ancestor:: | preceding::&lt;/tt&gt; as the wrapper which it is a bit counterintuitive.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Indeed it is; I&apos;ve done a lot of XML processing and I would &lt;b&gt;not&lt;/b&gt; expect the context to include all the content of each ancestor, but only the ancestor element itself. The example in the Split EIP documentation doesn&apos;t show this case, but the existing test cases do assume that in mode w, the ancestor content is also included. But if we take this logic to its conclusion, we would also include all content of the immediate ancestor &amp;lt;Level2&amp;gt; which is to say all the data elements, which is clearly not what is intended.&lt;br/&gt;
I would suggest that the implementation should include less context and not more!&lt;/p&gt;</comment>
                            <comment id="17599886" author="davsclaus" created="Sat, 3 Sep 2022 10:49:59 +0000"  >&lt;p&gt;Karen thanks for explaining. So lets keep this as-is&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yfow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>