<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:59:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18871] camel-netty - Application does not recover (threads are WAITING) when NettyProducer pool is exhausted</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18871</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When the Camel Application sends a LOT of requests to a TCP/IP Server (which is not available/down) using Netty component, after a bit, it hangs because the Producer Pool is exhausted (when &lt;b&gt;producerPoolMaxTotal&lt;/b&gt; is not -1).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;)
.to(&lt;span class=&quot;code-quote&quot;&gt;&quot;netty:&lt;span class=&quot;code-comment&quot;&gt;//tcp://localhost:18667?connectTimeout=500&amp;amp;decoders=#myDecoders&amp;amp;encoders=#myEncoders&amp;amp;producerPoolMaxTotal=10&amp;amp;producerPoolMinEvictableIdle=-1&amp;amp;requestTimeout=250&amp;amp;sync=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In previous version 3.14.1 the behavior was to fail when Pool was exhausted (&lt;b&gt;GenericObjectPool.&lt;/b&gt;&lt;b&gt;WHEN_EXHAUSTED_FAIL&lt;/b&gt;), however since version 3.14.2 and the migration to `&lt;b&gt;org.apache.commons:commons-pool2&lt;/b&gt;` (&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-17461&lt;/a&gt;) the default has become to block.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The proposal is to adjust `&lt;a href=&quot;https://github.com/apache/camel/blob/camel-3.14.7/components/camel-netty/src/main/java/org/apache/camel/component/netty/NettyProducer.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/camel-3.14.7/components/camel-netty/src/main/java/org/apache/camel/component/netty/NettyProducer.java&lt;/a&gt; ` , method `doStart()` to add optionally set the &lt;b&gt;BlockWhenExhausted&lt;/b&gt; flag (BaseGenericObjectPool.setBlockWhenExhausted) and the &lt;b&gt;&lt;tt&gt;borrowMaxWaitMillis&lt;/tt&gt;&lt;/b&gt; parameters.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;Camel &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; #74 - NettyClientTCPWorker&quot;&lt;/span&gt; #1166 prio=5 os_prio=0 tid=0x00007fd661a1d800 nid=0x18599 waiting on condition [0x00007fd5ffb12000]
&#160; &#160;java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
&#160; &#160; &#160; &#160; at sun.misc.Unsafe.park(Native Method)
&#160; &#160; &#160; &#160; - parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &#160;&amp;lt;0x00000005ce0e8338&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
&#160; &#160; &#160; &#160; at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
&#160; &#160; &#160; &#160; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
&#160; &#160; &#160; &#160; at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:1323)
&#160; &#160; &#160; &#160; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:306)
&#160; &#160; &#160; &#160; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:223)
&#160; &#160; &#160; &#160; at org.apache.camel.component.netty.NettyProducer.processWithBody(NettyProducer.java:259)
&#160; &#160; &#160; &#160; at org.apache.camel.component.netty.NettyProducer.process(NettyProducer.java:228)
&#160; &#160; &#160; &#160; at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:172)
&#160; &#160; &#160; &#160; at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:398)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13517256">CAMEL-18871</key>
            <summary>camel-netty - Application does not recover (threads are WAITING) when NettyProducer pool is exhausted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vincenzo.galluccio">Vincenzo Galluccio</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jan 2023 15:35:04 +0000</created>
                <updated>Mon, 30 Jan 2023 08:59:45 +0000</updated>
                            <resolved>Thu, 12 Jan 2023 10:23:01 +0000</resolved>
                                    <version>3.14.7</version>
                                    <fixVersion>3.14.8</fixVersion>
                    <fixVersion>3.18.5</fixVersion>
                    <fixVersion>3.20.2</fixVersion>
                    <fixVersion>3.21.0</fixVersion>
                    <fixVersion>4.0-M1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>camel-netty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17656158" author="JIRAUSER285695" created="Mon, 9 Jan 2023 15:38:12 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; , I see you were the assignee for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-17461&lt;/a&gt; which introduced the new Pool type.&lt;br/&gt;
What do you think about this issue and my proposal to add those 2 extra params when configuring the Producer Pool ?&lt;/p&gt;</comment>
                            <comment id="17656168" author="davsclaus" created="Mon, 9 Jan 2023 15:53:13 +0000"  >&lt;p&gt;Yes you are welcome to send a PR or patch file&lt;/p&gt;</comment>
                            <comment id="17675676" author="JIRAUSER285695" created="Wed, 11 Jan 2023 18:38:44 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; . I have created the following PR: &lt;a href=&quot;https://github.com/apache/camel/pull/9047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/9047&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;PS: The PR to add the two new options/params to &lt;a href=&quot;https://github.com/apache/camel-spring-boot/tree/main/components-starter/camel-netty-starter&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel-spring-boot/tree/main/components-starter/camel-netty-starter&lt;/a&gt; will follow..&lt;/p&gt;</comment>
                            <comment id="17675829" author="davsclaus" created="Thu, 12 Jan 2023 06:27:38 +0000"  >&lt;p&gt;Are you able to work on a special PR for 3.14.x as the other cannot cleanly be backported&lt;/p&gt;</comment>
                            <comment id="17675852" author="JIRAUSER285695" created="Thu, 12 Jan 2023 08:00:23 +0000"  >&lt;p&gt;Yes, I can make a new PR to target branch 3.14.x&lt;/p&gt;</comment>
                            <comment id="17675933" author="davsclaus" created="Thu, 12 Jan 2023 10:23:01 +0000"  >&lt;p&gt;Thanks for the PRs&lt;/p&gt;</comment>
                            <comment id="17675936" author="JIRAUSER285695" created="Thu, 12 Jan 2023 10:26:13 +0000"  >&lt;p&gt;Thank you. I&apos;ll work on the camel-netty-starter soon&lt;/p&gt;</comment>
                            <comment id="17676652" author="JIRAUSER285695" created="Fri, 13 Jan 2023 14:39:39 +0000"  >&lt;p&gt;Hey Claus, here the PR for the starter: &lt;a href=&quot;https://github.com/apache/camel-spring-boot/pull/697&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel-spring-boot/pull/697&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17680519" author="JIRAUSER285695" created="Wed, 25 Jan 2023 09:43:59 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; , any idea when 3.14.8 will be released ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1envs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>