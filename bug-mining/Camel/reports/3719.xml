<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:17:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10051] netty4 reuseChannel not working as expected</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10051</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;NettyProducer returns the channel to the pool every time a message is sent when the reuseChannel is set to true. It should instead return the channel to the pool only if the exchange is completed, so that other exchanges will not use the same channel.&lt;/p&gt;

&lt;p&gt;I have the following problem:&lt;br/&gt;
I need to send messages to a legacy tcp server through a REST server.&lt;br/&gt;
The tcp server requires messages from one connection to be send in a specific order, for example in order to send COMMAND1 I have to first send PRE1 and PRE2 and then COMMAND1. The component is set to reuseChannel=true and be sync=true and i have the following exchange:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:command1&quot;&lt;/span&gt;)
    .setBody(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;PRE1&quot;&lt;/span&gt;))
    .to(nettyEndpoint)
    .setBody(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;PRE2&quot;&lt;/span&gt;))
    .to(nettyEndpoint)
    .setBody(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;COMMAND1&quot;&lt;/span&gt;))
    .to(nettyEndpoint);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is that the NettyProducer returns the channel to the pool every time i send a message. So if concurrent requests are sent to the REST server things get messy. &lt;/p&gt;

&lt;p&gt;NettyProducer supports this behavior, if the reuseChannel is set to true the producer adds an onCompletion listener on the exchange that returns the channel to the pool. The problem is that it also sets the callback of the NettyCamelState to a NettyProducerCallback which runs every time a message is send by the ClientChannelHandler and returns the channel to the pool.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux 4.6.1-1-default (OpenSuse Tumbleweed)&lt;br/&gt;
openjdk version &quot;1.8.0_77&quot;&lt;br/&gt;
OpenJDK Runtime Environment (build 1.8.0_77-b03)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 25.77-b03, mixed mode)&lt;/p&gt;</environment>
        <key id="12977960">CAMEL-10051</key>
            <summary>netty4 reuseChannel not working as expected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="grigoriadis">Grigoris Grigoriadis</reporter>
                        <labels>
                    </labels>
                <created>Sun, 12 Jun 2016 12:46:24 +0000</created>
                <updated>Sun, 12 Jun 2016 14:32:43 +0000</updated>
                            <resolved>Sun, 12 Jun 2016 14:32:39 +0000</resolved>
                                    <version>2.17.1</version>
                                    <fixVersion>2.17.2</fixVersion>
                    <fixVersion>2.18.0</fixVersion>
                                    <component>camel-netty4</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15326425" author="githubbot" created="Sun, 12 Jun 2016 12:51:36 +0000"  >&lt;p&gt;GitHub user grigoriadis opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1026&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10051&quot; title=&quot;netty4 reuseChannel not working as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10051&quot;&gt;&lt;del&gt;CAMEL-10051&lt;/del&gt;&lt;/a&gt; - Fixed issue with reuse channel.&lt;/p&gt;

&lt;p&gt;    When reuseChannel is set to true, channel is not returned to the pool every time a message is sent&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/grigoriadis/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/grigoriadis/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10051&quot; title=&quot;netty4 reuseChannel not working as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10051&quot;&gt;&lt;del&gt;CAMEL-10051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1026.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1026.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1026&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5c4672b4e38cb88b5ffda8b1092ef759cec1b4e8&lt;br/&gt;
Author: grigoriadis &amp;lt;grigoriadis@itsaur.com&amp;gt;&lt;br/&gt;
Date:   2016-06-12T12:48:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10051&quot; title=&quot;netty4 reuseChannel not working as expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10051&quot;&gt;&lt;del&gt;CAMEL-10051&lt;/del&gt;&lt;/a&gt; - Fixed issue with reuse channel.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15326459" author="davsclaus" created="Sun, 12 Jun 2016 14:32:39 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                            <comment id="15326460" author="githubbot" created="Sun, 12 Jun 2016 14:32:43 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1026&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zcjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>