<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:19:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10399] OutOfMemoryError: Java heap space when sending large file to endpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10399</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;My route and jetty configuration:&lt;/p&gt;

&lt;p&gt;&amp;lt;route id=&quot;ds-rest-archive-upload-processor&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;from uri=&quot;jetty:&lt;a href=&quot;https://storage:8443/data/archive?sslContextParametersRef=sslContextParameters&amp;amp;requestBufferSize=32768&amp;amp;responseBufferSize=32768&amp;amp;httpMethodRestrict=POST&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://storage:8443/data/archive?sslContextParametersRef=sslContextParameters&amp;amp;amp;requestBufferSize=32768&amp;amp;amp;responseBufferSize=32768&amp;amp;amp;httpMethodRestrict=POST&lt;/a&gt;&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;            &amp;lt;to uri=&quot;bean:uploadFromArchiveFileProcessor?method=process&quot; pattern=&quot;InOut&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/route&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;jetty&quot; class=&quot;org.apache.camel.component.jetty9.JettyHttpComponent9&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;endpointClass&quot; value=&quot;org.apache.camel.component.jetty9.JettyHttpEndpoint9&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;sslContextParameters&quot; ref=&quot;sslContextParameters&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;useContinuation&quot; value=&quot;true&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;requestBufferSize&quot; value=&quot;32768&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;responseBufferSize&quot; value=&quot;32768&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;property name=&quot;threadPool&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot;org.eclipse.jetty.util.thread.QueuedThreadPool&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;constructor-arg index=&quot;0&quot; value=&quot;1000&quot; /&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;property name=&quot;jettyHttpBinding&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot;org.apache.camel.component.jetty.DefaultJettyHttpBinding&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;transferException&quot; value=&quot;false&quot; /&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;When I send file to this endpoint I have out of memory with this stacktrace:&lt;/p&gt;

&lt;p&gt; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
      at java.lang.StringCoding.decode(StringCoding.java:215)&lt;br/&gt;
      at java.lang.String.&amp;lt;init&amp;gt;(String.java:463)&lt;br/&gt;
      at java.lang.String.&amp;lt;init&amp;gt;(String.java:515)&lt;br/&gt;
      at org.eclipse.jetty.servlets.MultiPartFilter$Wrapper.getParameterBytesAsString(MultiPartFilter.java:390)&lt;br/&gt;
      at org.eclipse.jetty.servlets.MultiPartFilter$Wrapper.getParameterValues(MultiPartFilter.java:337)&lt;br/&gt;
      at org.apache.camel.http.common.DefaultHttpBinding.populateRequestParameters(DefaultHttpBinding.java:219)&lt;br/&gt;
      at org.apache.camel.http.common.DefaultHttpBinding.readHeaders(DefaultHttpBinding.java:174)&lt;br/&gt;
      at org.apache.camel.http.common.DefaultHttpBinding.readRequest(DefaultHttpBinding.java:110)&lt;br/&gt;
      at org.apache.camel.http.common.HttpMessage.&amp;lt;init&amp;gt;(HttpMessage.java:52)&lt;br/&gt;
      at org.apache.camel.component.jetty.CamelContinuationServlet.doService(CamelContinuationServlet.java:161)&lt;br/&gt;
      at org.apache.camel.http.common.CamelServlet.service(CamelServlet.java:74)&lt;br/&gt;
      at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)&lt;br/&gt;
      at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:812)&lt;br/&gt;
      at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1669)&lt;br/&gt;
      at org.eclipse.jetty.servlets.MultiPartFilter.doFilter(MultiPartFilter.java:200)&lt;br/&gt;
      at org.apache.camel.component.jetty.CamelFilterWrapper.doFilter(CamelFilterWrapper.java:43)&lt;br/&gt;
      at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)&lt;br/&gt;
      at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)&lt;br/&gt;
      at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)&lt;br/&gt;
      at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)&lt;br/&gt;
      at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)&lt;br/&gt;
      at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)&lt;br/&gt;
      at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)&lt;br/&gt;
      at org.eclipse.jetty.server.Server.handle(Server.java:499)&lt;br/&gt;
      at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:311)&lt;br/&gt;
      at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)&lt;br/&gt;
      at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:544)&lt;br/&gt;
      at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)&lt;br/&gt;
      at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)&lt;br/&gt;
      at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian inside docker container&lt;/p&gt;</environment>
        <key id="13013456">CAMEL-10399</key>
            <summary>OutOfMemoryError: Java heap space when sending large file to endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="igarashitm">Tomohisa Igarashi</assignee>
                                    <reporter username="vvsh">Uladzimir Shelhunou</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Oct 2016 09:58:53 +0000</created>
                <updated>Thu, 27 Oct 2016 06:29:03 +0000</updated>
                            <resolved>Thu, 27 Oct 2016 06:26:21 +0000</resolved>
                                    <version>2.17.3</version>
                    <version>2.18.0</version>
                                    <fixVersion>2.18.1</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-jetty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15588297" author="ancosen" created="Wed, 19 Oct 2016 10:22:40 +0000"  >&lt;p&gt;Is the camel-context deployed as a simple JAR? What are you using inside the Debian container? How much memory has your container?&lt;/p&gt;

&lt;p&gt;Did you set JVM_OPTS witch specific values for max Heap size and min Heap size?&lt;/p&gt;</comment>
                            <comment id="15588307" author="davsclaus" created="Wed, 19 Oct 2016 10:26:26 +0000"  >&lt;p&gt;Please use the user mailing list / user forum for this kind of help first.&lt;/p&gt;

&lt;p&gt;JIRA ticket is not for initial help.&lt;/p&gt;

&lt;p&gt;See more details here: &lt;a href=&quot;http://camel.apache.org/support.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/support.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15588522" author="vvsh" created="Wed, 19 Oct 2016 11:45:49 +0000"  >&lt;p&gt;Yes, it is a simple JAR. Actually, I do not know why attachment is read to a string instead of reading directly from InputStream? I expected, that I can send a file of any size and it will be handled.&lt;/p&gt;</comment>
                            <comment id="15588526" author="ancosen" created="Wed, 19 Oct 2016 11:47:06 +0000"  >&lt;p&gt;Please, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; said, use the users mailing-list first.&lt;/p&gt;</comment>
                            <comment id="15588576" author="vvsh" created="Wed, 19 Oct 2016 12:08:06 +0000"  >&lt;p&gt;Ok. Thanks.&lt;/p&gt;</comment>
                            <comment id="15591552" author="vvsh" created="Thu, 20 Oct 2016 11:24:47 +0000"  >&lt;p&gt;After discussing this issue in mailing list with Tomohisa, it seems that there is a bug in DefaultHttpBinding.populateRequestParameters, when file parameter is processed second time (after it was already processed in DefaultHttpBinding.populateAttachments).&lt;/p&gt;</comment>
                            <comment id="15601773" author="vvsh" created="Mon, 24 Oct 2016 12:05:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt;, Will you be investigating this issue?&lt;/p&gt;</comment>
                            <comment id="15601781" author="ancosen" created="Mon, 24 Oct 2016 12:11:12 +0000"  >&lt;p&gt;I will take a look as soon as I can &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15601811" author="ancosen" created="Mon, 24 Oct 2016 12:20:44 +0000"  >&lt;p&gt;Anyway if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=igarashitm&quot; class=&quot;user-hover&quot; rel=&quot;igarashitm&quot;&gt;igarashitm&lt;/a&gt; has time to take a look I&apos;m glad to pass the issue to him since he already started a bit of investigation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15608791" author="githubbot" created="Wed, 26 Oct 2016 15:33:23 +0000"  >&lt;p&gt;GitHub user igarashitm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1225&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10399&quot; title=&quot;OutOfMemoryError: Java heap space when sending large file to endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10399&quot;&gt;&lt;del&gt;CAMEL-10399&lt;/del&gt;&lt;/a&gt; camel-jetty - consumer should not load attachment payload&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/igarashitm/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/igarashitm/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10399&quot; title=&quot;OutOfMemoryError: Java heap space when sending large file to endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10399&quot;&gt;&lt;del&gt;CAMEL-10399&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1225.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1225.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1225&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit bb24b663caf901cba9134b7abbbd7b38b6fa2c8b&lt;br/&gt;
Author: Tomohisa Igarashi &amp;lt;tm.igarashi@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-10-26T15:08:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10399&quot; title=&quot;OutOfMemoryError: Java heap space when sending large file to endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10399&quot;&gt;&lt;del&gt;CAMEL-10399&lt;/del&gt;&lt;/a&gt; camel-jetty - consumer should not load attachment payload&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15610860" author="githubbot" created="Thu, 27 Oct 2016 06:23:42 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1225&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15610862" author="ancosen" created="Thu, 27 Oct 2016 06:24:54 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=igarashitm&quot; class=&quot;user-hover&quot; rel=&quot;igarashitm&quot;&gt;igarashitm&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Merged.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i352zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>