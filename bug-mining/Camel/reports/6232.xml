<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:57:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18387] camel-tarfile: TarAggregationStrategy throws error when first message is empty</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18387</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;TarAggregationStrategy will skip empty messages, but if the &lt;em&gt;first&lt;/em&gt; message is empty it will throw an error &quot;java.io.IOException: Cannot create temp file: &quot; on the next non-empty message.&lt;/p&gt;

&lt;p&gt;I added a test case to reproduce this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13476397">CAMEL-18387</key>
            <summary>camel-tarfile: TarAggregationStrategy throws error when first message is empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="chbecker">Christian Becker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Aug 2022 14:22:19 +0000</created>
                <updated>Tue, 16 Aug 2022 09:44:11 +0000</updated>
                            <resolved>Tue, 16 Aug 2022 09:42:44 +0000</resolved>
                                    <version>3.18.1</version>
                                    <fixVersion>3.14.6</fixVersion>
                    <fixVersion>3.18.2</fixVersion>
                    <fixVersion>3.19.0</fixVersion>
                                    <component>camel-tarfile</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17578509" author="JIRAUSER294287" created="Thu, 11 Aug 2022 14:35:13 +0000"  >&lt;p&gt;PS: The behavior with only one empty message is also strange: In my test the aggregate will be an empty String object instead of an empty File.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17578512" author="JIRAUSER294287" created="Thu, 11 Aug 2022 14:36:38 +0000"  >&lt;p&gt;The following patch should fix the issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java b/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
index 78c05bde6d8..3afc43b79ca 100644
--- a/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
+++ b/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
@@ -172,9 +172,6 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TarAggregationStrategy &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; AggregationStrategy {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;? newExchange.getIn().getHeader(Exchange.FILE_NAME, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;: newExchange.getIn().getMessageId();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;addFileToTar(tarFile, appendFile, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.preserveFolderStructure ? entryName : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GenericFile&amp;lt;File&amp;gt; genericFile = FileConsumer.asGenericFile(
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;genericFile.bindToExchange(answer);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
&#160; &#160; &#160; &#160; &#160; &#160; &#160;} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericFileOperationFailedException(e.getMessage(), e);
@@ -189,14 +186,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TarAggregationStrategy &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; AggregationStrategy {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;? newExchange.getIn().getHeader(Exchange.FILE_NAME, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;: newExchange.getIn().getMessageId();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;addEntryToTar(tarFile, entryName, buffer, buffer.length);
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GenericFile&amp;lt;File&amp;gt; genericFile = FileConsumer.asGenericFile(
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;genericFile.bindToExchange(answer);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
&#160; &#160; &#160; &#160; &#160; &#160; &#160;} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericFileOperationFailedException(e.getMessage(), e);
&#160; &#160; &#160; &#160; &#160; &#160; &#160;}
&#160; &#160; &#160; &#160; &#160;}
+ &#160; &#160; &#160; &#160;GenericFile&amp;lt;File&amp;gt; genericFile = FileConsumer.asGenericFile(tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
+ &#160; &#160; &#160; &#160;genericFile.bindToExchange(answer);
&#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
&#160; &#160; &#160;}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17578514" author="davsclaus" created="Thu, 11 Aug 2022 14:40:45 +0000"  >&lt;p&gt;You are welcome to send the patch as a PR&lt;/p&gt;</comment>
                            <comment id="17580092" author="JIRAUSER294287" created="Tue, 16 Aug 2022 07:14:14 +0000"  >&lt;p&gt;Created pull request &lt;a href=&quot;https://github.com/apache/camel/pull/8166&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/8166&lt;/a&gt; for main branch&lt;/p&gt;</comment>
                            <comment id="17580201" author="davsclaus" created="Tue, 16 Aug 2022 09:42:44 +0000"  >&lt;p&gt;Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13048022" name="TarAggregationStrategyEmptyFirstFileTest.java" size="4303" author="chbecker" created="Thu, 11 Aug 2022 14:22:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17ooo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>