<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:19:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10460] MetricsMessageHistoryFactory.java:138 Generate a NPE</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10460</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m trying to play with Spring-boot camel and metrics to expose dashboard. &lt;/p&gt;

&lt;p&gt;Hawtio is a great tools to check what it&apos;s going on at runtime but no persistence is done. We would like to persist statistics in prometheus by example. &lt;/p&gt;

&lt;p&gt;I configure camel context with MetricsMessageHistoryFactory as: &lt;/p&gt;

&lt;p&gt;    MetricsMessageHistoryFactory metricsMessageHistoryFactory = new MetricsMessageHistoryFactory(); &lt;br/&gt;
    metricsMessageHistoryFactory.setMetricsRegistry(metricRegistry); &lt;br/&gt;
    camelContext.setMessageHistoryFactory(metricsMessageHistoryFactory); &lt;/p&gt;

&lt;p&gt;where metricRegistry is injected with: &lt;br/&gt;
  /** &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Srping Boot metrics&lt;br/&gt;
   */ &lt;br/&gt;
  @Autowired &lt;br/&gt;
  private MetricRegistry metricRegistry; &lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Everything is ok until I passed in OnExceptionRoute. It seems that the routeId is set to Null in this case and generate a NPE (line MetricsMessageHistoryFactory:138) in the exception route. Route causing the NPE:&lt;/p&gt;

&lt;p&gt;onException(NoAttachmentToProcessException.class) &lt;br/&gt;
        .routeId(RouteIds.TECHNICAL_ERROR_HANDLING.routeId()) &lt;br/&gt;
        .log(LoggingLevel.ERROR,&quot;TECHNICAL ERROR: ${exchangeProperty.CamelExceptionCaught}&quot;) &lt;/p&gt;</description>
                <environment>&lt;p&gt;MacOs, JDK 1.8, SpringBoot 1.4.1, Spring Metrics&lt;/p&gt;</environment>
        <key id="13019575">CAMEL-10460</key>
            <summary>MetricsMessageHistoryFactory.java:138 Generate a NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="PhilG">Philippe Godot</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Nov 2016 16:36:28 +0000</created>
                <updated>Thu, 10 Nov 2016 11:03:55 +0000</updated>
                            <resolved>Thu, 10 Nov 2016 09:33:33 +0000</resolved>
                                    <version>2.18.0</version>
                                    <fixVersion>2.18.1</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15651383" author="philg" created="Wed, 9 Nov 2016 16:40:34 +0000"  >&lt;p&gt;For my point of view, problem could comes from ProcessorDefinitionHelper which is manage getRouteId which is working only for RouteDefinition object, but exception routes are of type OnExceptionDefinition and then this method return null. &lt;/p&gt;</comment>
                            <comment id="15651399" author="philg" created="Wed, 9 Nov 2016 16:46:30 +0000"  >&lt;p&gt;Uploaded a testU and possible patch&lt;/p&gt;</comment>
                            <comment id="15652102" author="davsclaus" created="Wed, 9 Nov 2016 21:34:46 +0000"  >&lt;p&gt;Its not entirely correct as on exception is not an route and hence why you dont see that. I will work on a different solution where we will grab the last route id from the current exchange instead. &lt;/p&gt;

&lt;p&gt;We can use your unit test, however we cannot accept the patch file with such license header. Can you remove that, or replace it with the ASF license header, and attach the .patch file again?&lt;/p&gt;</comment>
                            <comment id="15653296" author="philg" created="Thu, 10 Nov 2016 07:29:38 +0000"  >&lt;p&gt;Thanks Claus. Completly agree with your remark but I have need a quick fix for demo &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
TestU submitted.&lt;/p&gt;

&lt;p&gt;I saw you add a fix version for this ticket. Do you have already an expected date for 2.18.1 ?&lt;/p&gt;</comment>
                            <comment id="15653579" author="davsclaus" created="Thu, 10 Nov 2016 09:33:34 +0000"  >&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15653767" author="philg" created="Thu, 10 Nov 2016 11:03:55 +0000"  >&lt;p&gt;Thanks for the quick fix. Excellent. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12838309" name="__CAMEL_10460_2.patch" size="4435" author="PhilG" created="Thu, 10 Nov 2016 07:25:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i364qf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>