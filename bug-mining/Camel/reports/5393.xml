<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:42:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15370] CxfRsProducer: All but last value of query parameter with multiple values are lost</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15370</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If using a query parameter name multiple times, only the last value is actually used.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;e.g.&#160; .to(&quot;cxfrs:&lt;a href=&quot;http://example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://example.com/&lt;/a&gt;&quot;) with Exchange value&#160;Exchange.HTTP_QUERY id=1&amp;amp;id=2 will call to example.com with id=2&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As far as i can tell the problem is caused by&#160;CxfRsProducer::getQueryParametersFromQueryString. In the method all query paramters are inserted in a map, and only the last use of a parameter name is preserved.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;One solution would be to insert the values directy into the client field, skipping the Map.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13320948">CAMEL-15370</key>
            <summary>CxfRsProducer: All but last value of query parameter with multiple values are lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="k5">Frank Denninger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Aug 2020 20:04:35 +0000</created>
                <updated>Fri, 7 Aug 2020 13:13:29 +0000</updated>
                            <resolved>Fri, 7 Aug 2020 13:12:42 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>came-cxf</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17171269" author="davsclaus" created="Wed, 5 Aug 2020 05:47:06 +0000"  >&lt;p&gt;Okay sounds good, would you be able to provide a fix as a PR&lt;/p&gt;</comment>
                            <comment id="17171709" author="k5" created="Wed, 5 Aug 2020 19:27:48 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;i added a patch with a testcase and the changes to CxfRSProducer. I could write a version that has less changes to the class, but i think the version in the patch is more consistent.&lt;/p&gt;

&lt;p&gt;It is my first patch here, so it might not hold up to your standards.&lt;/p&gt;

&lt;p&gt;Regards, Frank&lt;/p&gt;</comment>
                            <comment id="17171748" author="chardahe@redhat.com" created="Wed, 5 Aug 2020 20:44:34 +0000"  >&lt;p&gt;Hi Frank,&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have modified existing method where I&apos;m checking if that query param is already present at map if yes then I&apos;m adding all the values by &amp;amp; and while calling client I&apos;m splitting it and calling for all the values. Refer&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-15370&quot; title=&quot;CxfRsProducer: All but last value of query parameter with multiple values are lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-15370&quot;&gt;&lt;del&gt;CAMEL-15370&lt;/del&gt;&lt;/a&gt;_Chandra.patch&lt;/p&gt;</comment>
                            <comment id="17171756" author="k5" created="Wed, 5 Aug 2020 21:05:30 +0000"  >&lt;p&gt;Hi Chandrakant, this implementation will cause problems if the value contains an &amp;amp; (or %26 escaped)&lt;/p&gt;

&lt;p&gt;See this failing testcase:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testProducerWithQueryParametersWithMultipleValues2() {
        Exchange exchange = template.send(&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfrs:&lt;span class=&quot;code-comment&quot;&gt;//http://localhost:&quot;&lt;/span&gt; + getPort2() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + getClass().getSimpleName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/testQuery?httpClientAPI=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;synchronous=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                    exchange.setPattern(ExchangePattern.InOut);
                    Message inMessage = exchange.getIn();
                    &lt;span class=&quot;code-comment&quot;&gt;// set the Http method
&lt;/span&gt;                    inMessage.setHeader(Exchange.HTTP_METHOD, &lt;span class=&quot;code-quote&quot;&gt;&quot;GET&quot;&lt;/span&gt;);
                    inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS, InputStream.class);
                    inMessage.setHeader(Exchange.HTTP_QUERY, &lt;span class=&quot;code-quote&quot;&gt;&quot;id=1%262&quot;&lt;/span&gt;);
                    inMessage.setBody(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);                
                }
            
            });
     
        &lt;span class=&quot;code-comment&quot;&gt;// get the response message 
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; response = exchange.getOut().getBody(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
        assertNotNull(response, &lt;span class=&quot;code-quote&quot;&gt;&quot;The response should not be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;id=1%262&quot;&lt;/span&gt;, response, &lt;span class=&quot;code-quote&quot;&gt;&quot;The response value is wrong&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;You also cause an npe if the value is null in the map.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I dont&apos;t really see a valid implemenation that leverages a csv syntax in the values of the Map, that doesn&apos;t cause incompatiblity issues for users that provide the Map with CxfConstatns.CAMEL_CXF_RS_QUERY_MAP.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17172184" author="chardahe@redhat.com" created="Thu, 6 Aug 2020 09:57:07 +0000"  >&lt;p&gt;Hi Frank,&#160;&lt;/p&gt;

&lt;p&gt;Thanks for pointing it, I forgot to check for NPE&lt;/p&gt;

&lt;p&gt;Can we introduce any other identifier to join the values instead of $ or any such special character, for which there is no possibility to be as a value?&lt;/p&gt;</comment>
                            <comment id="17172230" author="mail@bernhardunger.de" created="Thu, 6 Aug 2020 10:37:47 +0000"  >&lt;p&gt;Hi Chandrakant,&lt;/p&gt;

&lt;p&gt;Spring MVC ist using a &quot;MultiValueMap&quot; to solve this problem. See&#160;&lt;a href=&quot;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/MultiValueMap.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/MultiValueMap.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also available from google commons is&#160;com.google.common.collect.HashMultimap&lt;/p&gt;

&lt;p&gt;These maps simply allowing multiple identical keys.&lt;/p&gt;

&lt;p&gt;I think this could be a possibility for fixing the problem.&lt;/p&gt;

&lt;p&gt;We implemented a workarround so far:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; HashMultimap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; createParamsMultimap(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryString, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; charset)
			&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; UnsupportedEncodingException {
		HashMultimap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; queryMap = HashMultimap.create();


		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; param : queryString.split(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;&quot;&lt;/span&gt;)) {
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] pair = param.split(&lt;span class=&quot;code-quote&quot;&gt;&quot;=&quot;&lt;/span&gt;, 2);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pair.length == 2) {
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = URLDecoder.decode(pair[0], charset);
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = URLDecoder.decode(pair[1], charset);
				queryMap.put(name, value);
			}
			&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
				&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid parameter, expected to be a pair but was &quot;&lt;/span&gt; + param);
			}
		}

		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; queryMap;
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Disadvantage indeed is, that we must implement a new Map Interface, otherwise we would break Camels API.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// New implementation
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyMultiMap &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {
...
&lt;span class=&quot;code-comment&quot;&gt;//All other Methods throwing an UnsupportedOperationException
&lt;/span&gt;@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; entrySet() {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; mulitmap.entries();
		}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In process Method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryString = exchange.getIn().getHeader(Exchange.HTTP_QUERY, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

		&lt;span class=&quot;code-comment&quot;&gt;// create multimap of parameters, preserving multiple params of the same name
&lt;/span&gt;		HashMultimap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; queryMap =
				createParamsMultimap(queryString, ExchangeHelper.getCharsetName(exchange));

		&lt;span class=&quot;code-comment&quot;&gt;// wrap it to hide the multimap als a conventional map
&lt;/span&gt;		MyMultiMap myMultiMap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyMultiMap(queryMap);

		&lt;span class=&quot;code-comment&quot;&gt;// set override parameter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; cxf query map
&lt;/span&gt;		exchange.getMessage().setHeader(CxfConstants.CAMEL_CXF_RS_QUERY_MAP, myMultiMap);
&lt;span class=&quot;code-comment&quot;&gt;//further implementations....&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Maybe you find a cleaner backward compatible way for the fix?&lt;/p&gt;

&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Bernhard&lt;/p&gt;</comment>
                            <comment id="17172259" author="k5" created="Thu, 6 Aug 2020 11:09:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chardahe%40redhat.com&quot; class=&quot;user-hover&quot; rel=&quot;chardahe@redhat.com&quot;&gt;chardahe@redhat.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;as i already tried to state, i don&apos;t see a version working that leverages some kind of &quot;csv&quot; syntax in the values that doesn&apos;t have a significant risk to break for some consumer.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I appended a different version that uses a Map&amp;lt;String,List&amp;lt;String&amp;gt;&amp;gt; internally. WebClient seems to supports List&amp;lt;String&amp;gt; directly as parameter, and expands it as expected.&lt;/p&gt;

&lt;p&gt;I dont see incompatiblities if the map contained only String. But will introduce some further sideeffects/improvements like map with Map&amp;lt;String,Integer&amp;gt; will also work (it causes classcast error in the current version).&lt;/p&gt;

&lt;p&gt;But i still prefer my original patch that removes the usage of map for the querystring.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regards Frank&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17172482" author="ffang" created="Thu, 6 Aug 2020 15:53:30 +0000"  >&lt;p&gt;Hi Guys,&lt;/p&gt;

&lt;p&gt;Thanks all for the discussion and patches!&lt;/p&gt;

&lt;p&gt;I prefer &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k5&quot; class=&quot;user-hover&quot; rel=&quot;k5&quot;&gt;k5&lt;/a&gt;&apos;s original fix since it&apos;s straightforward with testcase.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k5&quot; class=&quot;user-hover&quot; rel=&quot;k5&quot;&gt;k5&lt;/a&gt;, could you please send a git PR(pull request), so that your name can be available in the git commit history. Also please revise your testcase a little bit to include the case that value could have escaped %26.&lt;/p&gt;

&lt;p&gt;Thanks all again!&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17172687" author="k5" created="Thu, 6 Aug 2020 22:02:29 +0000"  >&lt;p&gt;Hi Freeman,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;i created a PR&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regards Frank&lt;/p&gt;</comment>
                            <comment id="17173132" author="ffang" created="Fri, 7 Aug 2020 13:13:29 +0000"  >&lt;p&gt;patch applied on behalf of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k5&quot; class=&quot;user-hover&quot; rel=&quot;k5&quot;&gt;k5&lt;/a&gt; with thanks!&lt;/p&gt;

&lt;p&gt;Thanks all again for the discussion here!&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13009137" name="CAMEL-15370.patch" size="5089" author="k5" created="Wed, 5 Aug 2020 19:24:46 +0000"/>
                            <attachment id="13009144" name="CAMEL-15370_Chandra.patch" size="1876" author="chardahe@redhat.com" created="Wed, 5 Aug 2020 20:50:15 +0000"/>
                            <attachment id="13009191" name="camel_map_with_list (2).patch" size="2669" author="k5" created="Thu, 6 Aug 2020 11:17:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hh0g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>