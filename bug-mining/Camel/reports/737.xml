<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:34:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-1924] Unit test failures on Windows in 2.0.0 release</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1924</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;3 failures in camel-core that do not seem to occur on linux and mac.&lt;/p&gt;

&lt;p&gt;Failure Details&lt;br/&gt;
	testCannotDeleteFile&lt;/p&gt;

&lt;p&gt;	junit.framework.AssertionFailedError: Should have thrown an exception&lt;/p&gt;


&lt;p&gt;org.apache.camel.component.file.strategy.GenericFileDeleteProcessStrategyTest:125&lt;br/&gt;
	testCacheStreamToFileAndNotCloseStream&lt;/p&gt;

&lt;p&gt;	junit.framework.AssertionFailedError: we should have no temp file expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;&lt;/p&gt;


&lt;p&gt;org.apache.camel.converter.stream.CachedOutputStreamTest:117&lt;br/&gt;
	testRouteIsCorrectAtRuntime&lt;/p&gt;

&lt;p&gt;	junit.framework.AssertionFailedError: expected:&amp;lt;4&amp;gt; but was:&amp;lt;1&amp;gt;&lt;/p&gt;


&lt;p&gt;org.apache.camel.processor.ChoiceWithEndTest:39&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows Vista 32 Bit, JDK 1.6.0_14 and maven 2.2.0&lt;/p&gt;</environment>
        <key id="12485857">CAMEL-1924</key>
            <summary>Unit test failures on Windows in 2.0.0 release</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="cschneider">Christian Schneider</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2009 13:37:15 +0000</created>
                <updated>Mon, 24 Aug 2009 18:51:33 +0000</updated>
                            <resolved>Mon, 24 Aug 2009 12:28:33 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12951893" author="chris@die-schneider.net" created="Thu, 20 Aug 2009 13:37:50 +0000"  >&lt;p&gt;I have found the problem in the first test that failed:&lt;br/&gt;
GenericFileDeleteProcessStrategyTest.testCannotDeleteFile&lt;/p&gt;

&lt;p&gt;In the method exists file the test checks if the file name equals &quot;target/foo/boom.txt&quot; but on windows the file name is &quot;target\foo\boom.txt&quot;. So the method says the file does not exist. The test then thinks it has successfully deleted the file and does not throw the expected exception. &lt;/p&gt;

&lt;p&gt;Claus remarked:&lt;br/&gt;
Good use the FileUtil.normalizePath to ensure the path can be tested&lt;br/&gt;
using equals.&lt;br/&gt;
There are other unit tests that does this as well.&lt;/p&gt;</comment>
                            <comment id="12952024" author="chris@die-schneider.net" created="Thu, 20 Aug 2009 13:39:08 +0000"  >&lt;p&gt;I have digged into the next failure.&lt;br/&gt;
CachedOutputStreamTest.testCacheStreamToFileAndNotCloseStream&lt;/p&gt;

&lt;p&gt;At the end of the test the temporary file is expected to be deleted. But honestly I do not understand how this could work.&lt;/p&gt;

&lt;p&gt;The test first calls exchange.getUnitOfWork().done(exchange);. This will try to delete the file but the delete will fail as the stream is still open.&lt;br/&gt;
Then it calls ((InputStream)cache).close(); which will close the stream. The problem is that now the file will not be deleted again.&lt;/p&gt;

&lt;p&gt;I have swapped the two commands and the test works but I think this is wrong as the test seems to explicitly test the fact that close is not called before done.&lt;br/&gt;
Can anyone clarify what this test tries to do?&lt;br/&gt;
Btw. I think this test works on unix as the delete on the file will also work when the file is opened. On windows this does not work. &lt;/p&gt;</comment>
                            <comment id="12952023" author="chris@die-schneider.net" created="Thu, 20 Aug 2009 13:39:34 +0000"  >&lt;p&gt;I have just debugged the last failure:&lt;/p&gt;

&lt;p&gt;org.apache.camel.processor.ChoiceWithEndTest.testRouteIsCorrectAtRuntime&lt;/p&gt;

&lt;p&gt;It checks for 4 nodes but only gets one.&lt;/p&gt;

&lt;p&gt;The reason is that it checks the wrong route. When I change the line&lt;br/&gt;
       Navigate&amp;lt;Processor&amp;gt; nav = context.getRoutes().get(0).navigate();&lt;br/&gt;
to&lt;br/&gt;
       Navigate&amp;lt;Processor&amp;gt; nav = context.getRoutes().get(1).navigate();&lt;br/&gt;
then it works. So it seems the sequence of the routes is not the same for all systems. Perhaps it would be better to use another way of getting the route from the camel context. &lt;/p&gt;</comment>
                            <comment id="12952506" author="njiang" created="Mon, 24 Aug 2009 12:23:38 +0000"  >&lt;p&gt;@Christian&lt;br/&gt;
For the CachedOutputStreamTest.testCacheStreamToFileAndNotCloseStream, as you said, windows can&apos;t delete the file which is open, so I close the cached inputstream before calling the exchange  done method. &lt;/p&gt;

&lt;p&gt;I just tried run the org.apache.camel.processor.ChoiceWithEndTest.testRouteIsCorrectAtRuntime with JDK 1.5.0_13 on Windows Vista box, the test is OK.&lt;br/&gt;
So I added a method to search the route by looking up the endpoint&apos;s uri, please feel free to give it a try &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12952523" author="njiang" created="Mon, 24 Aug 2009 12:28:13 +0000"  >&lt;p&gt;Committed revision :  807183&lt;/p&gt;</comment>
                            <comment id="12952369" author="chris@die-schneider.net" created="Mon, 24 Aug 2009 18:51:33 +0000"  >&lt;p&gt;Camel-core now builds without failures or errors:&lt;br/&gt;
Tests	Errors 	Failures	Skipped	Success Rate	Time&lt;br/&gt;
1420	0	0	0	100%	1,286,584&lt;/p&gt;

&lt;p&gt;Great work. Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76693</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01lev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7238</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>