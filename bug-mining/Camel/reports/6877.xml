<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:07:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21161] camel-aws2-s3 is uploading always files as multipart when multiPartUpload is set true</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21161</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The Camel component camel-aws2-s3 has a producer boolean option called multiPartUpload.&lt;br/&gt;
Based on the documentation, when this attribute is set to true, the upload will be with multipart format in case the file is larger than the partSize (another attribute).&#160;&lt;br/&gt;
This is not happening, when multiPartUpload is set to true, the upload is always in multipart format unless the fileSize is 0, which is a corner case.&lt;/p&gt;

&lt;p&gt;The root cause of the problem is in the &#160;AWS2S3Producer code around line 151.&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;em&gt;long partSize = getConfiguration().getPartSize();&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;em&gt;if (contentLength == 0 &amp;amp;&amp;amp; contentLength &amp;lt; partSize) {&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;em&gt;// optimize to do a single op if content length is known and &amp;lt; part size&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;em&gt;LOG.debug(&quot;File size &amp;lt; partSize. Uploading file in single operation: {}&quot;, filePayload);&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;em&gt;processSingleOp(exchange);&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;em&gt;return;&lt;/em&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;em&gt;}&lt;/em&gt;&lt;br/&gt;
If the contentLength is not 0, the condition &quot;&lt;em&gt;contentLength &amp;lt; partSize&quot;&lt;/em&gt; is never met so the upload is always done as multipart.&lt;/p&gt;

&lt;p&gt;This is really affecting performance upload when files are below the partSize.&lt;/p&gt;

&lt;p&gt;The proposed fix is just to change the condition to: &lt;br/&gt;
&lt;em&gt;if (contentLength == 0 || contentLength &amp;lt; partSize) {&lt;/em&gt;&lt;br/&gt;
&lt;em&gt;...&lt;/em&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13590857">CAMEL-21161</key>
            <summary>camel-aws2-s3 is uploading always files as multipart when multiPartUpload is set true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="gfolch">Guillem Folch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Sep 2024 10:52:46 +0000</created>
                <updated>Wed, 4 Sep 2024 06:52:37 +0000</updated>
                            <resolved>Wed, 4 Sep 2024 06:50:04 +0000</resolved>
                                    <version>4.4.0</version>
                    <version>4.7.0</version>
                                    <fixVersion>4.4.4</fixVersion>
                    <fixVersion>4.8.0</fixVersion>
                                    <component>camel-aws2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17878826" author="davsclaus" created="Tue, 3 Sep 2024 11:09:17 +0000"  >&lt;p&gt;I think it should be &lt;/p&gt;

&lt;p&gt;contentLength &amp;gt; 0 &amp;amp;&amp;amp; xxxx&lt;/p&gt;

&lt;p&gt;The length must be known ahead of time, if the length is 0 then its unknown and multipart must be used instead.&lt;/p&gt;</comment>
                            <comment id="17878863" author="ancosen" created="Tue, 3 Sep 2024 12:25:17 +0000"  >&lt;p&gt;Once it&apos;s fixed I&apos;ll merge this.&lt;/p&gt;</comment>
                            <comment id="17878936" author="davsclaus" created="Tue, 3 Sep 2024 16:18:22 +0000"  >&lt;p&gt;Ah okay so there was also a need for uploading empty files so the content length would be 0 in those situations&lt;/p&gt;</comment>
                            <comment id="17878938" author="davsclaus" created="Tue, 3 Sep 2024 16:20:36 +0000"  >&lt;p&gt;Ah sorry yeah using || is more correct, so the attached patch can be used.&lt;/p&gt;</comment>
                            <comment id="17879096" author="davsclaus" created="Wed, 4 Sep 2024 05:34:03 +0000"  >&lt;p&gt;PR&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/15416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/15416&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13546002">CAMEL-19707</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13071262" name="CAMEL-21161.patch" size="1107" author="hdumont34" created="Tue, 3 Sep 2024 11:07:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r7eg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>