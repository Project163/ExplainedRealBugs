<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:08:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21403] AS2 Component  - Incorrect message length calculation when generating MIC for EDI messages with multi-byte characters</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21403</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When I receive an EDI message Camel tries to generate MIC (Message Integrity Code) and calls&#160;&lt;b&gt;public static byte[] getContent(HttpEntity entity)&lt;/b&gt; in&#160;&lt;b&gt;EntityUtils&lt;/b&gt;, which then executes &lt;b&gt;entity.writeTo(os)&lt;/b&gt; in &lt;b&gt;ApplicationEntity.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In line 67 [see code|&lt;a href=&quot;https://github.com/apache/camel/blob/camel-4.8.x/components/camel-as2/camel-as2-api/src/main/java/org/apache/camel/component/as2/api/entity/ApplicationEntity.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/camel-4.8.x/components/camel-as2/camel-as2-api/src/main/java/org/apache/camel/component/as2/api/entity/ApplicationEntity.java&lt;/a&gt;] , the library incorrectly calculates the message length, which causes it to truncate the content. Here is the relevant line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
transferEncodedStream.write(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ediMessage.getBytes(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getCharset()), 0, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ediMessage.length()); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this line, &lt;b&gt;this.ediMessage.getBytes(this.getCharset())&lt;/b&gt;&lt;br/&gt;
retrieves the message content as a byte array, but &lt;b&gt;this.ediMessage.length()&lt;/b&gt; returns the length of the &lt;b&gt;String&lt;/b&gt; in characters rather than in bytes. If the &lt;b&gt;ediMessage&lt;/b&gt; contains any multi-byte characters (e.g., &quot;&#243;&quot;), the &lt;b&gt;length&lt;/b&gt; method returns the count in characters, not in bytes, which leads to truncation.&lt;/p&gt;

&lt;p&gt;For instance, in UTF-8, a character like &quot;&#243;&quot; uses two bytes, but &lt;b&gt;ediMessage.length()&lt;/b&gt; will return 1, not 2. This discrepancy causes &lt;b&gt;write()&lt;/b&gt; to only transfer part of the byte array, leading to an incorrect MIC calculation and potential verification issues on the receiving end.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A potential fix is to use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
transferEncodedStream.write(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ediMessage.getBytes(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getCharset()));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;instead of&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
transferEncodedStream.write(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ediMessage.getBytes(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getCharset()), 0, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ediMessage.length());  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13597186">CAMEL-21403</key>
            <summary>AS2 Component  - Incorrect message length calculation when generating MIC for EDI messages with multi-byte characters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mateuszp">Mateusz Poncyliusz</reporter>
                        <labels>
                            <label>AS2</label>
                            <label>EDI</label>
                            <label>utf-8</label>
                    </labels>
                <created>Wed, 30 Oct 2024 09:07:25 +0000</created>
                <updated>Sat, 9 Nov 2024 13:20:46 +0000</updated>
                            <resolved>Sat, 9 Nov 2024 07:51:34 +0000</resolved>
                                    <version>4.8.1</version>
                                    <fixVersion>4.8.2</fixVersion>
                    <fixVersion>4.9.0</fixVersion>
                                    <component>camel-as2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17894103" author="davsclaus" created="Wed, 30 Oct 2024 09:13:51 +0000"  >&lt;p&gt;You are welcome to work on a patch and send as PR.&lt;/p&gt;

&lt;p&gt;Also if you could include an unit test then that is appreciated&lt;/p&gt;</comment>
                            <comment id="17895245" author="JIRAUSER307602" created="Mon, 4 Nov 2024 10:08:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/camel/pull/16148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/16148&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17896856" author="davsclaus" created="Sat, 9 Nov 2024 07:51:34 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1sadk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>