<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:47:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16640] camel-kafka race conditions during shut down</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16640</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Latest extension in KafkaConsumer with reconnect/retry introduced race condition during shut down. Potentially this leaves threads running after shut down.&lt;/p&gt;

&lt;p&gt;Retry flag is set to false only if consumer wakeup throws an exception during consumer poll.&#160;&lt;/p&gt;

&lt;p&gt;Interrupted Exception leaves the while loop only if thread is currently sleeping.&lt;/p&gt;

&lt;p&gt;If the thread executes any thing else during shut down, the thread will continuously loop.&lt;/p&gt;

&lt;p&gt;I will prepare a proposal patch set soon.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13379500">CAMEL-16640</key>
            <summary>camel-kafka race conditions during shut down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="EhsanAmiryousefi">Ehsan Amiryousefi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 May 2021 12:01:45 +0000</created>
                <updated>Fri, 21 May 2021 13:15:18 +0000</updated>
                            <resolved>Fri, 21 May 2021 13:15:18 +0000</resolved>
                                    <version>3.10.0</version>
                                    <fixVersion>3.11.0</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17348317" author="ancosen" created="Thu, 20 May 2021 12:04:31 +0000"  >&lt;p&gt;Are you talking about camel quarkus extension or the plain component or something else? It is not clear, not too much details.&lt;/p&gt;</comment>
                            <comment id="17348519" author="ehsanamiryousefi" created="Thu, 20 May 2021 13:18:11 +0000"  >&lt;p&gt;It is about the plain camel-kafka component as in 3.10. The changes which have been added for this ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-14980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-14980&lt;/a&gt;&#160;are causing this problem.&lt;/p&gt;

&lt;p&gt;In KafkaConsumer class in the run() method if the thread is sleeping and an Interrupted Exception occurs, then the thread will leave the loop, which is fine. But, if before the thread enter the sleeping, something happens then the thread will remain running without caring about the stopping state(Zombie Thread).&#160;&lt;/p&gt;

&lt;p&gt;In the doPollRun() method, the retry flag is set to false only when the consumer wakeup method throws an exception which again causes the thread again to keep running in the loop without stopping which again leaves the thread to be zombie.&#160;&lt;/p&gt;

&lt;p&gt;My proposed solution would be adding the following code to the run() method before calling the doRun() method. This will prevent the loop iteration in case the component is stopped or going to be stopped. I have prepared this in a patch set and could commit it.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isRunAllowed() || isStoppingOrStopped() || isSuspendingOrSuspended()) {
 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17349263" author="davsclaus" created="Fri, 21 May 2021 13:15:18 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r7o8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>