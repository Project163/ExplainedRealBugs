<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:07:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7318] Concurrency on HDFS Consumer not working efficiently</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7318</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If we have two HDFS consumers the files are being processed twice (once by each consumer, waiting one after the other) so the consumers are not working in parallel. If we add this the consumers will work as a team and the transfer will go faster.&lt;/p&gt;

&lt;p&gt;This happens because there is no exception thrown (the rename method just returns true or false and everything carries on as nothing would have happened &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;In order to fix this we could add in the HdfsInputStream: 49&lt;/p&gt;

&lt;p&gt;boolean tf = info.getFileSystem().rename(new Path(ret.actualPath), new Path(ret.suffixedPath));&lt;br/&gt;
if (!tf) &lt;/p&gt;
{
	throw new IOException(&quot;This exception is thrown because the rename did not succeded.&quot;);
	}

&lt;p&gt;And also in the HdfsConsumer: 150&lt;br/&gt;
try {&lt;br/&gt;
     this.rwlock.writeLock().lock();&lt;br/&gt;
     this.istream = HdfsInputStream.createInputStream(fileStatuses&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getPath().toString(), this.config);&lt;br/&gt;
} catch (IOException ioe) {&lt;br/&gt;
     log.info(ioe.getMessage()	+ &quot; If the rename fails we move on to the next file.&quot;);&lt;br/&gt;
     continue;&lt;br/&gt;
}&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12702829">CAMEL-7318</key>
            <summary>Concurrency on HDFS Consumer not working efficiently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggrzybek">Grzegorz Grzybek</assignee>
                                    <reporter username="thadia">Martha Obrinteschi</reporter>
                        <labels>
                            <label>concurrency</label>
                            <label>parallel</label>
                    </labels>
                <created>Fri, 21 Mar 2014 09:08:05 +0000</created>
                <updated>Thu, 5 Mar 2015 12:45:04 +0000</updated>
                            <resolved>Thu, 5 Mar 2015 12:43:11 +0000</resolved>
                                    <version>2.11.2</version>
                                    <fixVersion>2.14.3</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-hdfs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13965093" author="gzres" created="Thu, 10 Apr 2014 07:36:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thadia&quot; class=&quot;user-hover&quot; rel=&quot;thadia&quot;&gt;thadia&lt;/a&gt;, there is &lt;a href=&quot;https://camel.apache.org/competing-consumers.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this page&lt;/a&gt;, which talks about concurrent consumers. While this is obvious for JMS, other endpoints have more problems with such configuration.&lt;br/&gt;
Of course this may be done, but have you considered using &lt;tt&gt;pattern&lt;/tt&gt; endpoint parameter described &lt;a href=&quot;http://camel.apache.org/hdfs.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Please let me know.&lt;/p&gt;

&lt;p&gt;regards&lt;br/&gt;
Grzegorz Grzybek&lt;/p&gt;</comment>
                            <comment id="13972804" author="thadia" created="Thu, 17 Apr 2014 10:01:50 +0000"  >&lt;p&gt;The pattern parameter it had been considered, but that is not good enough for this case and I couldn&apos;t find another way except the one from the description.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="13972816" author="gzres" created="Thu, 17 Apr 2014 10:15:11 +0000"  >&lt;p&gt;Hello Martha - I just wanted to say, that according to &lt;a href=&quot;https://camel.apache.org/competing-consumers.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/competing-consumers.html&lt;/a&gt;, the only competing consumers are currently JMS and SEDA. I&apos;m not saying that it cannot be done for HDFS/HDFS2, but it&apos;s not trivial.&lt;br/&gt;
Please be patient &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14348469" author="gzres" created="Thu, 5 Mar 2015 09:29:04 +0000"  >&lt;p&gt;Actually the file is not being read twice.&lt;br/&gt;
I&apos;ve setup two consumers and watched the behavior under debugger.&lt;br/&gt;
This code you&apos;ve mentioned (in org.apache.camel.component.hdfs2.HdfsInputStream#createInputStream()):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        info.getFileSystem().rename(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(ret.actualPath), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(ret.suffixedPath));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;doesn&apos;t return &lt;tt&gt;false&lt;/tt&gt; if can&apos;t rename, it throws exception with the following stack trace (&quot;file://&quot; case):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.FileNotFoundException: File file:/data/ggrzybek/sources/github.com/grgrzybek/camel/components/camel-hdfs2/target/test/multiple-consumers/file-0194.txt does not exist
	at org.apache.hadoop.fs.RawLocalFileSystem.deprecatedGetFileStatus(RawLocalFileSystem.java:511)
	at org.apache.hadoop.fs.RawLocalFileSystem.getFileLinkStatusInternal(RawLocalFileSystem.java:722)
	at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:501)
	at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:337)
	at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:289)
	at org.apache.hadoop.fs.RawLocalFileSystem.rename(RawLocalFileSystem.java:334)
	at org.apache.hadoop.fs.ChecksumFileSystem.rename(ChecksumFileSystem.java:503)
	at org.apache.camel.component.hdfs2.HdfsInputStream.createInputStream(HdfsInputStream.java:49)
	at org.apache.camel.component.hdfs2.HdfsConsumer.doPoll(HdfsConsumer.java:140)
	at org.apache.camel.component.hdfs2.HdfsConsumer.poll(HdfsConsumer.java:98)
	at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:174)
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:101)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so then Camel invokes org.apache.camel.spi.PollingConsumerPollStrategy#rollback() and simply skips this file and move to the next one.&lt;br/&gt;
I&apos;ll check how it works in &quot;hdfs://&quot; case.&lt;/p&gt;</comment>
                            <comment id="14348482" author="gzres" created="Thu, 5 Mar 2015 09:36:13 +0000"  >&lt;p&gt;You&apos;re right - for &quot;hdfs://&quot; scheme, the rename just returns &lt;tt&gt;false&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14348694" author="gzres" created="Thu, 5 Mar 2015 12:43:56 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thadia&quot; class=&quot;user-hover&quot; rel=&quot;thadia&quot;&gt;thadia&lt;/a&gt; for investigating this issue. I&apos;ve added &lt;a href=&quot;https://github.com/apache/camel/commit/08eb8bf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;similar check&lt;/a&gt; to skip missing (failed to rename) file.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381167</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1to7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381443</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>