<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:20:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10616] shutdown timeout override not working in unit tests</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10616</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In my main application, I can override the timeout by declaring my own ShutdownStrategy bean and setting the timeout property. However this seems to be ignored during unit tests and always uses 10s timeouts.&lt;/p&gt;

&lt;p&gt;The bean is certainly being picked up because I see the following logging&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.camel.spring.boot.CamelAutoConfiguration - Using custom ShutdownStrategy: org.apache.camel.impl.DefaultShutdownStrategy@5b8b9b2d
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is preventing me from doing any debugging during unit tests as it will always end the jvm before I can inspect anything.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13029022">CAMEL-10616</key>
            <summary>shutdown timeout override not working in unit tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mtran">Minh Tran</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 Dec 2016 23:20:29 +0000</created>
                <updated>Thu, 5 Jan 2017 10:21:23 +0000</updated>
                            <resolved>Thu, 5 Jan 2017 08:48:13 +0000</resolved>
                                    <version>2.18.1</version>
                                    <fixVersion>2.18.2</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-spring-boot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15761932" author="davsclaus" created="Mon, 19 Dec 2016 18:33:38 +0000"  >&lt;p&gt;How are you doing your unit test, can you attach some sample project or point to a github repo with a sample?&lt;/p&gt;</comment>
                            <comment id="15762544" author="mtran" created="Mon, 19 Dec 2016 22:48:54 +0000"  >&lt;p&gt;You need a unit test that runs the route in its own thread so that your unit test will end and camel will shutdown the context. The following exhibits the problem. You can set a breakpoint in org.apache.camel.processor.exceptionpolicy.DefaultExceptionPolicyStrategy.findMatchedExceptionPolicy() (this was what I was debugging) and wait for longer than 10sec.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@RunWith(CamelSpringBootRunner.class)
@SpringBootTest
public class MyTest {
	@Configuration
	@EnableAutoConfiguration
	public static class Config extends SpringRouteBuilder {

		@Override
		public void configure() throws Exception {
			from(&quot;activemq:queue:a&quot;).onException(RuntimeException.class).handled(true).end()
                             .throwException(RuntimeException.class, &quot;something bad happened&quot;);
		}

		@Bean
		public ShutdownStrategy shutdownStrategy() {
			DefaultShutdownStrategy strat = new DefaultShutdownStrategy();
			// this is ignored
			strat.setTimeout(60000);
			return strat;
		}

	}

	@Produce(uri = &quot;activemq:queue:a&quot;)
	private ProducerTemplate producer;

	@Test
	public void testHello() throws InterruptedException {
		producer.sendBody(&quot;hello&quot;);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we can just override the shutdown timeout in unit tests, this wouldn&apos;t be an issue. Looks like it might be fixed in 2.18.2 according to linked issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10619&quot; title=&quot;Add spring boot configuration for configuring shutdown options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10619&quot;&gt;&lt;del&gt;CAMEL-10619&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;
</comment>
                            <comment id="15764920" author="davsclaus" created="Tue, 20 Dec 2016 18:43:36 +0000"  >&lt;p&gt;Yeah &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10619&quot; title=&quot;Add spring boot configuration for configuring shutdown options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10619&quot;&gt;&lt;del&gt;CAMEL-10619&lt;/del&gt;&lt;/a&gt; allows to configure this easier. But nevertheless a custom ShutdownStrategy @Bean should take precedence over default settings.&lt;/p&gt;</comment>
                            <comment id="15800790" author="davsclaus" created="Thu, 5 Jan 2017 08:48:13 +0000"  >&lt;p&gt;Added unit test but cannot reproduce the issue. The custom shutdown are in use.&lt;/p&gt;

&lt;p&gt;It could be that your unit tests are using mocks which has a default 10 sec timeout.&lt;/p&gt;</comment>
                            <comment id="15800990" author="mtran" created="Thu, 5 Jan 2017 10:18:46 +0000"  >&lt;p&gt;If you run the unit test, you&apos;ll see the following appear in the logs&lt;/p&gt;

&lt;p&gt;INFO  org.apache.camel.impl.DefaultShutdownStrategy - Starting to graceful shutdown 1 routes (timeout 10 seconds)&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t you expect that message to say timeout in 60 seconds?&lt;/p&gt;</comment>
                            <comment id="15800995" author="mtran" created="Thu, 5 Jan 2017 10:21:23 +0000"  >&lt;p&gt;And there are no assertions of mocks being done in that unit test so I don&apos;t believe the mock timeout is related here.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13029223">CAMEL-10619</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37r1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>