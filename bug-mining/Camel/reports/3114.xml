<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:07:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8409] Kafka producer: when no message key specified, use partition key</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8409</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8190&quot; title=&quot;Kafka producer: partition key is optional, not required by kafka client api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8190&quot;&gt;&lt;del&gt;CAMEL-8190&lt;/del&gt;&lt;/a&gt; has introduced behavior that has the potential to break existing code (hence setting to Critical priority so this can be fixed prior to 2.14.2/2.15.0 releases).  It broke my code (using 2.14.2-SNAPSHOT builds) in development and staging, and I didn&apos;t notice the problem until tonight.&lt;/p&gt;

&lt;p&gt;Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8190&quot; title=&quot;Kafka producer: partition key is optional, not required by kafka client api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8190&quot;&gt;&lt;del&gt;CAMEL-8190&lt;/del&gt;&lt;/a&gt;, the value of the &lt;tt&gt;KafkaConstants.PARTITION_KEY&lt;/tt&gt; header was used for both the &lt;tt&gt;key&lt;/tt&gt; and &lt;tt&gt;partitionKey&lt;/tt&gt; of the kafka &lt;tt&gt;KeyedMessage&lt;/tt&gt;.  My downstream consumers depended on this for the correct &lt;tt&gt;key&lt;/tt&gt; of the consumed message.  &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8190&quot; title=&quot;Kafka producer: partition key is optional, not required by kafka client api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8190&quot;&gt;&lt;del&gt;CAMEL-8190&lt;/del&gt;&lt;/a&gt;, changed things so the &lt;tt&gt;key&lt;/tt&gt; is set only via the &lt;tt&gt;KafkaConstants.KEY&lt;/tt&gt; header, and since my code didn&apos;t set that header, the &lt;tt&gt;key&lt;/tt&gt; started coming through as &lt;tt&gt;null&lt;/tt&gt; to downstream consumers.&lt;/p&gt;

&lt;p&gt;I propose the following to fix this (will attach a patch shortly):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If both &lt;tt&gt;KEY&lt;/tt&gt; &lt;em&gt;and&lt;/em&gt; &lt;tt&gt;PARTITION_KEY&lt;/tt&gt; are specified, no change from &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8190&quot; title=&quot;Kafka producer: partition key is optional, not required by kafka client api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8190&quot;&gt;&lt;del&gt;CAMEL-8190&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;If just one is specified, call the &lt;tt&gt;KeyedMessage&lt;/tt&gt; 3-argument constructor with the value (uses the value for both &lt;tt&gt;key&lt;/tt&gt; and &lt;tt&gt;partitionKey&lt;/tt&gt;)&lt;/li&gt;
	&lt;li&gt;If neither are specified, pass &lt;tt&gt;null&lt;/tt&gt; for both...but IMHO, a warning should be logged, as it seems unlikely that the user knowingly omitted both values.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12777781">CAMEL-8409</key>
            <summary>Kafka producer: when no message key specified, use partition key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mmindenhall">Mark Mindenhall</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Feb 2015 04:54:26 +0000</created>
                <updated>Thu, 26 Feb 2015 17:59:29 +0000</updated>
                            <resolved>Thu, 26 Feb 2015 09:13:26 +0000</resolved>
                                    <version>2.14.2</version>
                    <version>2.15.0</version>
                                    <fixVersion>2.14.2</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14338118" author="davsclaus" created="Thu, 26 Feb 2015 09:08:47 +0000"  >&lt;p&gt;Thanks will get the patch in, but for #3 can we not thrown an exception instead of logging a warn?&lt;/p&gt;</comment>
                            <comment id="14338647" author="mmindenhall" created="Thu, 26 Feb 2015 16:28:25 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;I think the whole point of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8190&quot; title=&quot;Kafka producer: partition key is optional, not required by kafka client api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8190&quot;&gt;&lt;del&gt;CAMEL-8190&lt;/del&gt;&lt;/a&gt; was that Camel was disallowing something allowed by kafka.  In this case, it&apos;s legal to pass null for both keys.  I can&apos;t think of a use case for wanting to do so, but it does allow more simple routes when prototyping.&lt;/p&gt;

&lt;p&gt;For example, the following route would work, but log the warning:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;mqtt:bar?subscribeTopicName=test.mqtt.topic&quot;&lt;/span&gt;)
  .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:localhost:9092?someKafkaOptions&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whereas if we throw an exception the route would need to look more like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;mqtt:bar?subscribeTopicName=test.mqtt.topic&quot;&lt;/span&gt;)
  .process(exchange -&amp;gt; exchange.getIn().setHeader(KafkaConstants.PARTITION_KEY, &lt;span class=&quot;code-quote&quot;&gt;&quot;someKey&quot;&lt;/span&gt;))
  .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:localhost:9092?someKafkaOptions&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12700979" name="0001-CAMEL-8409-fix-for-breaking-change-introduced-by-CAM.patch" size="3421" author="mmindenhall" created="Thu, 26 Feb 2015 06:19:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i262r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>