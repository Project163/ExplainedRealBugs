<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:42:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15233] camel-salesforce - CometDReplayExtension does not keep replayId for each message/channel</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15233</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;CometDReplayExtension class try to read the replayId from the message by doing&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = message.get(EXTENSION_NAME);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, the replayId (based on this&#160;&lt;a href=&quot;https://developer.salesforce.com/docs/atlas.en-us.api_streaming.meta/api_streaming/using_streaming_api_durability.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.salesforce.com/docs/atlas.en-us.api_streaming.meta/api_streaming/using_streaming_api_durability.htm&lt;/a&gt;) is actually within data -&amp;gt; event -&amp;gt; replayId.&lt;/p&gt;

&lt;p&gt;&#160;By doing the following (the same thing the salesforce consumer does &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceConsumer.java#L250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/SalesforceConsumer.java#L250&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; data = (Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;) message.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; event = (Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;) data.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;event&quot;&lt;/span&gt;);

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = event.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;replayId&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I was able to properly fetch the replayId from the message.&lt;/p&gt;

&lt;p&gt;&#160;Since the current version does not do this properly, If the component loses the connection and has to subscribe again it will use the replayid value from the endpoint which it will be outdated if any message was read before the connection failure.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13313113">CAMEL-15233</key>
            <summary>camel-salesforce - CometDReplayExtension does not keep replayId for each message/channel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="edgarc">Edgar Chernick</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jun 2020 21:43:42 +0000</created>
                <updated>Sun, 19 Jul 2020 08:55:36 +0000</updated>
                            <resolved>Sun, 19 Jul 2020 08:55:36 +0000</resolved>
                                                    <fixVersion>2.25.2</fixVersion>
                    <fixVersion>3.4.2</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17143591" author="davsclaus" created="Wed, 24 Jun 2020 07:25:31 +0000"  >&lt;p&gt;There are a number of tickets reported for camel-salesforce. Maybe you can look at the others and see if some also report about this replayId bug. I think I have seen this reported before. As it would be good to get as much detail as possible.&lt;/p&gt;</comment>
                            <comment id="17143592" author="davsclaus" created="Wed, 24 Jun 2020 07:25:47 +0000"  >&lt;p&gt;And can you tell us which Camel version you are using?&lt;/p&gt;</comment>
                            <comment id="17143857" author="edgarc" created="Wed, 24 Jun 2020 14:11:42 +0000"  >&lt;p&gt;I looked into open bugs for camel-saleforce and I found one that might be related to this (I&apos;ve linked it to this card). However that card is unresolved.&lt;/p&gt;

&lt;p&gt;I&apos;m using version 2.25.1. But looking in version 3.4.0 I can see the CometDReplayExtension class has not been changed.&lt;/p&gt;</comment>
                            <comment id="17149742" author="edgarc" created="Wed, 1 Jul 2020 23:33:37 +0000"  >&lt;p&gt;Hi guys, I&apos;ve tried fixing the issue myself here &lt;a href=&quot;https://github.com/apache/camel/compare/master...edgarc-ciandt:master&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/compare/master...edgarc-ciandt:master&lt;/a&gt;. Would you guys mind taking a look and code reviewing it ?&lt;/p&gt;

&lt;p&gt;I have deleted the CometDReplayExtension class and used another implementation of it from &lt;a href=&quot;https://github.com/forcedotcom/EMP-Connector/blob/master/src/main/java/com/salesforce/emp/connector/ReplayExtension.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/forcedotcom/EMP-Connector/blob/master/src/main/java/com/salesforce/emp/connector/ReplayExtension.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have also created some unit tests to cover it.&lt;/p&gt;

&lt;p&gt;Another question. I would need to have this fixed on 2.25, do you guys think it&apos;s possible or the fix will probably be applied to the latest version only ?&lt;/p&gt;</comment>
                            <comment id="17149873" author="davsclaus" created="Thu, 2 Jul 2020 05:10:40 +0000"  >&lt;p&gt;Hi Edgar&lt;/p&gt;

&lt;p&gt;Yes this looks great. And since this is an internal change only and fixes/improves this then I can see us backport this to 2.25.x.&lt;br/&gt;
The source from salesforce is BSD-3 which we can accept&lt;/p&gt;

&lt;p&gt;For the unit test can you find another way with the reflection to avoid using log4j util, as logging library.&lt;br/&gt;
And when ready can you create a PR.&lt;/p&gt;</comment>
                            <comment id="17150380" author="edgarc" created="Thu, 2 Jul 2020 15:23:58 +0000"  >&lt;p&gt;I have drafted the PR &lt;a href=&quot;https://github.com/apache/camel/pull/3969&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/3969&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17150844" author="ancosen" created="Fri, 3 Jul 2020 08:57:16 +0000"  >&lt;p&gt;Can you create the PR for 2.25.x too? It cannot be cherry-picked from master, I guess.&lt;/p&gt;</comment>
                            <comment id="17150999" author="davsclaus" created="Fri, 3 Jul 2020 13:33:19 +0000"  >&lt;p&gt;Yes a PR for 2.25.x would be apprecated as it cannot be cherry-picked. &lt;/p&gt;

&lt;p&gt;I backported to 3.4.x&lt;/p&gt;</comment>
                            <comment id="17151686" author="edgarc" created="Mon, 6 Jul 2020 01:13:44 +0000"  >&lt;p&gt;PR for 2.25.x created &lt;a href=&quot;https://github.com/apache/camel/pull/3975&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/3975&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13214472">CAMEL-13170</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g4wo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>