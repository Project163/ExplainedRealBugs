<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:54:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5769] Camel JMS producer can block a thread under specific circumstances</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5769</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This is an edge case, but when the following circumstances concur, the asynchronous routing engine in Camel become blocked:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sending an InOut exchange over JMS (request/reply), where:&lt;/li&gt;
	&lt;li&gt;Persistent messages are enabled (deliveryPersistent=true)&lt;/li&gt;
	&lt;li&gt;useMessageIDasCorrelationID is enabled&lt;/li&gt;
	&lt;li&gt;replyToType is Temporary queues (default) (using TemporaryQueueReplyManager)&lt;/li&gt;
	&lt;li&gt;a timeout is set&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You have to be really unlucky, but if the following condition is satisfied, a thread will become blocked:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;time the broker takes to ACK the produced message &amp;gt; message timeout&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Hence, if we have a timeout of 3000ms, and the broker takes 4000ms to ACK the message (e.g. slow Disk I/O while the journal is rotating - it happened to us), at some point we&apos;ll see this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-10-30 10:46:57,680 | WARN  | CorrelationMap | 89 - org.apache.camel.camel-core - 2.8.0.fuse-06-11 | Exception occurred during purge task. This exception will be ignored.
java.lang.NullPointerException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The CorrelationMap is rendered useless, so if subsequent exchanges time out, the ReplyHandler may never get an onTimeout callback, thus leading to the waiting thread getting blocked forever if the async routing engine was in place.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614644">CAMEL-5769</key>
            <summary>Camel JMS producer can block a thread under specific circumstances</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="raulvk">Ra&#250;l Kripalani</assignee>
                                    <reporter username="raulvk">Ra&#250;l Kripalani</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Nov 2012 12:57:45 +0000</created>
                <updated>Sun, 4 Nov 2012 23:34:38 +0000</updated>
                            <resolved>Sun, 4 Nov 2012 23:32:26 +0000</resolved>
                                    <version>2.8.6</version>
                    <version>2.9.4</version>
                    <version>2.10.2</version>
                                    <fixVersion>2.9.5</fixVersion>
                    <fixVersion>2.10.3</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-jms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13490327" author="raulvk" created="Sun, 4 Nov 2012 23:32:26 +0000"  >&lt;p&gt;Fixed in trunk, 2.10.x and 2.9.x. Added a test case to reproduce the buggy situation: JmsBlockedAsyncRoutingEngineTest.&lt;/p&gt;</comment>
                            <comment id="13490328" author="raulvk" created="Sun, 4 Nov 2012 23:34:38 +0000"  >&lt;p&gt;I noticed that the issue doesn&apos;t necessarily happen with persistent messages only. It happens under any situation where the broker takes longer than the value set for the request timeout to ACK the message to the producer (and thus send back the final Message ID). In other words, this situation is reproduceable also when ActiveMQ Producer Flow Control has kicked in.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eotb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83782</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>