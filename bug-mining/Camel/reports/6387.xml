<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:59:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19065] Saga Long-Running-Action header propagation might be broken with Kafka Component</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19065</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;As reported in the camel.zulipchat.com #camel stream, it seems that camel saga async workflows using the Kafka component might be losing the correlation between the original LRA header value since the Kafka component doesn&apos;t automatically turn it back into a String.&lt;/p&gt;

&lt;p&gt;Given the following route:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:bookings&quot;&lt;/span&gt;)
            .saga()
            .propagation(MANDATORY)
           .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;LOG1 \${headers}&quot;&lt;/span&gt;)
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:booking-requests?brokers=localhost:9092&quot;&lt;/span&gt;)

       from(&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:booking-responses?brokers=localhost:9092&quot;&lt;/span&gt;)
            .saga()
            .propagation(MANDATORY)
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;LOG2 \${headers}&quot;&lt;/span&gt;) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When printing the headers we can see the Long-Running-Action with a String value:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG1 ...,&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;-Running-Action=90EA3C7D191D45E-0000000000000001, ... &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This headers are serialized as bytes by the Kafka Producer and sent to a topic &lt;em&gt;booking-requests&lt;/em&gt; where a processing application reads them and writes them back to &lt;em&gt;booking-responses&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The problem shows up in the second log statement, where the Long-Running-Action header is not 90EA3C7D191D45E-0000000000000001 anymore:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG2 &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;-Running-Action=[B@4d4b56e8 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The Camel Saga component isn&apos;t automatically reformating the header value into a String.&lt;/p&gt;

&lt;p&gt;As a workaround we can provide a KafkaHeaderDeserializer to reconstruct it as a String:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       from(&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:booking-responses?brokers=localhost:9092&amp;amp;headerDeserializer=#kafkaHeaderStringDeserializer&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; .saga()
&#160; &#160; &#160; &#160; &#160; &#160; .propagation(MANDATORY)
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;LOG2 \${headers}&quot;&lt;/span&gt;) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s a sample project where you can check this behaviour: &lt;a href=&quot;https://github.com/codependent/booking-service&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/codependent/booking-service&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13525050">CAMEL-19065</key>
            <summary>Saga Long-Running-Action header propagation might be broken with Kafka Component</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="zhfeng">Zheng Feng</assignee>
                                    <reporter username="codependent">Jose A. I&#241;igo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2023 15:32:46 +0000</created>
                <updated>Wed, 22 Feb 2023 06:18:49 +0000</updated>
                            <resolved>Mon, 20 Feb 2023 13:22:37 +0000</resolved>
                                    <version>3.20.2</version>
                                                    <component>camel-kafka</component>
                    <component>camel-lra</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17691174" author="zhfeng" created="Mon, 20 Feb 2023 13:20:48 +0000"  >&lt;p&gt;This should work since converting &lt;b&gt;byte[]&lt;/b&gt; to &lt;b&gt;String&lt;/b&gt; has been added in &lt;a href=&quot;https://github.com/apache/camel/blob/f955a62d128804b45791d4f7e40b58ead58c866b/core/camel-base/src/main/java/org/apache/camel/converter/IOConverter.java#L147-L150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;IOConverter&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You need to use&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.log(&lt;span class=&quot;code-quote&quot;&gt;&quot;LRA id is \${headers.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;-Running-Action}&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to convert it to String explicitly. &lt;b&gt;log(&quot;LOG \${headers}&quot;)&lt;/b&gt; does not convert each header.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fzog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>