<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:05:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20388] Salesforce component does not handshake on the connection failure</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20388</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We use the Salesforce component to consume platform events and every 3 hours we observe the following warning message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Connect failure: {advice={reconnect=handshake, interval=0}, channel=/meta/connect, id=2005814, error=403::Unknown client, successful=false}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;According to &lt;a href=&quot;https://help.mulesoft.com/s/article/Couldn-t-connect-to-Salesforce-streaming-server-because-a-403-error-has-been-returned-error-403-Unknown-client-Warning-messages-in-log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; article, it is caused by the expiring sfdc-stream cookie used by CometD. When it happens, the client is expected to  perform a new handshake and re-subscribe to the channels. This is handled in connectListener (&lt;em&gt;SubscriptionHelper#initMessageListeners&lt;/em&gt;). Unfortunately, because the client is in the CONNECTED state when this message is received, the condition&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!abort &amp;amp;&amp;amp; !client.isDisconnected()) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(DISCONNECT_INTERVAL);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
                LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Aborting handshake on interrupt!&quot;&lt;/span&gt;);
                abort = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }

            abort = abort || isStoppingOrStopped();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; (&lt;em&gt;SubscriptionHelper#doHandshake&lt;/em&gt;) is not met and it stays in the handshaking state indefinitely (&lt;em&gt;SubscriptionHelper#handshaking&lt;/em&gt;), hence the handshake is not being performed. As a consequence, after a couple of days the client stops receiving Salesforce events.&lt;/p&gt;

&lt;p&gt;This bug may have been introduced by &lt;a href=&quot;https://github.com/apache/camel/commit/7a6315a73569f92a234a948a11cf4fc5478701c0#diff-fd8ac20f7b12e53a2e26d69754c9496a1c374377650c36979ac1d6d52c80fbe0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; commit, which removed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
client.disconnect();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;from connectListener (&lt;em&gt;SubscriptionHelper:178&lt;/em&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13567117">CAMEL-20388</key>
            <summary>Salesforce component does not handshake on the connection failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhfeng">Zheng Feng</assignee>
                                    <reporter username="bartoszpop">Bartosz Popiela</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Feb 2024 02:38:33 +0000</created>
                <updated>Thu, 4 Jul 2024 02:44:31 +0000</updated>
                            <resolved>Mon, 15 Apr 2024 07:37:10 +0000</resolved>
                                    <version>3.22.1</version>
                                    <fixVersion>3.21.5</fixVersion>
                    <fixVersion>3.22.2</fixVersion>
                    <fixVersion>4.0.5</fixVersion>
                    <fixVersion>4.4.2</fixVersion>
                    <fixVersion>4.6.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17813509" author="davsclaus" created="Fri, 2 Feb 2024 06:54:39 +0000"  >&lt;p&gt;Can you check if its the same code/problem on main branch&lt;/p&gt;</comment>
                            <comment id="17813600" author="bartoszpop" created="Fri, 2 Feb 2024 10:00:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; I confirm, it is in the main branch as well.&lt;/p&gt;</comment>
                            <comment id="17830055" author="jawwad124" created="Sat, 23 Mar 2024 10:36:23 +0000"  >&lt;p&gt;I am also facing this issue. The upgrade to the new camel version causing this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13583777">CAMEL-20918</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13157121">CAMEL-12484</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n5zs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>