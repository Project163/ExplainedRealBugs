<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:04:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17721] MDC - custom MDC property value is fixed to first assigned value by MDCUnitOfWork</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17721</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Once value (that matches &quot;mdc-logging-keys-pattern&quot; from configuration) is assigned/set to MDC and gets into MDCUnitOfWorks#MDCCallback &quot;custom&quot; map, it cannot be changed further down in the route (at least in processor), as changed value is always overwritten at the end of processing step with originally assigned value.&lt;/p&gt;

&lt;p&gt;This breaks use-cases, when you want to assign temporary value to one MDC property to signify the value could not be retrieved during some processing steps (but can be assigned further down).&lt;/p&gt;

&lt;p&gt;For example, when you assign, for example N/A to property &quot;someID&quot; in processor, right after consumer at the start of route, and want to change it few steps down, it will be overwritten back to &quot;N/A&quot; by MDCCallback.&lt;/p&gt;

&lt;p&gt;This interacts nastily with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17722&quot; title=&quot;MDC - custom properties in MDC Unit Of Work are not cleared at the end of route&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-17722&quot;&gt;&lt;del&gt;CAMEL-17722&lt;/del&gt;&lt;/a&gt;, making custom MDC properties unusable.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Tested in single-threaded route with no async processing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13430946">CAMEL-17721</key>
            <summary>MDC - custom MDC property value is fixed to first assigned value by MDCUnitOfWork</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="vdobos">Vladimir Dobos</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Feb 2022 09:08:38 +0000</created>
                <updated>Thu, 21 Dec 2023 15:28:32 +0000</updated>
                            <resolved>Mon, 18 Dec 2023 09:39:44 +0000</resolved>
                                    <version>3.11.5</version>
                    <version>3.14.1</version>
                                    <fixVersion>4.4.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17799449" author="JIRAUSER299710" created="Thu, 21 Dec 2023 15:28:32 +0000"  >&lt;p&gt;I have the same issue, but I&apos;m not convinced the current solution will actually fix this completely. This is the implemented solution for this issue right now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// keep existing custom value to not override
&lt;/span&gt;custom.forEach((k, v) -&amp;gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (MDC.get(k) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    MDC.put(k, v);
  }
});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this will not allow MDC.remove actions, since any removed key will still be put back. And potentially more dangerous this is the restore process for asynchronous threads, so if an asynchronous thread has changed the MDC it will be kept.&lt;/p&gt;

&lt;p&gt;I think this is because the doneSync of the MDCCallback is practically always false, so it does this cleanup even for synchronous processing. This seems to be because the CamelInternalProcessor is always wrapped into an AsyncProcessorSupport, which calls everything in an asynchronous way. Meaning the callback clear is always done and the MDC is always reset, even though it should only be reset after an asynchronous event.&lt;/p&gt;



</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13430947">CAMEL-17722</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zzwo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>