<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:43:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15622] endpoint-dsl - Bean name evaluated as string in sql component</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15622</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have this stack:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;camel spring boot starter&lt;/li&gt;
	&lt;li&gt;camel-sql component&lt;/li&gt;
	&lt;li&gt;camel endpoint DSL&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.to(sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;classpath:sql/zentiva.sql&quot;&lt;/span&gt;).dataSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;zentivaDataSource&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I use instance of DataSource object and set it in .datasource(dataSourceBean()) there is actually a problem that camel is looking in springbootcamelcontext for the name of the result of&#160;&lt;b&gt;dataSourceBean.toString()&lt;/b&gt; which might be like HikariDataSource (null). Lookup for wrong bean name happens in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.camel.support.CamelContextHelper#mandatoryLookupAndConvert
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Route with bean instance is not working properly. As a workaround, we have to use name of the bean.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13330587">CAMEL-15622</key>
            <summary>endpoint-dsl - Bean name evaluated as string in sql component</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="drezir">Adam Ostro&#382;l&#237;k</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Oct 2020 15:21:26 +0000</created>
                <updated>Mon, 12 Oct 2020 11:45:55 +0000</updated>
                            <resolved>Mon, 12 Oct 2020 11:26:06 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.6.0</fixVersion>
                                    <component>camel-endpointdsl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17206409" author="avi5kdon@gmail.com" created="Fri, 2 Oct 2020 18:58:48 +0000"  >&lt;p&gt;In the camel-sql component, the parameters map holds the key-value pair for &quot;datasource&quot; and its configured instance.  But this instance is being treated as &quot;String&quot; and being looked up in the registry. I think we can simply use this datasource if it turns out to be an instance of the DataSource class otherwise we can look it up as usual.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Endpoint createEndpoint(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; remaining, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; parameters) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        DataSource target = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

        &lt;span class=&quot;code-comment&quot;&gt;// endpoint options overrule component configured datasource
&lt;/span&gt;        DataSource ds = resolveAndRemoveReferenceParameter(parameters, &lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt;, DataSource.class);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17206631" author="drezir" created="Sat, 3 Oct 2020 07:55:27 +0000"  >&lt;p&gt;What about resolving this issue in lower level in&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.camel.support.DefaultComponent#resolveAndRemoveReferenceParameter(java.util.Map&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are parameter and also type specified (in this case &quot;dataSource&quot; and DataSource.class). The algorithm would just get the parameter and If types match, it would simply return the value from parameters without any transformation.&#160;&lt;/p&gt;

&lt;p&gt;Maybe something like this?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt; T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; &amp;gt; T resolveAndRemoveReferenceParameter(Map &amp;lt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; &amp;gt; parameters, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key, &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &amp;lt; T &amp;gt; type) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parameters.containsKey(key) &amp;amp;&amp;amp; type.isInstance(parameters.get(key).getClass()) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type.&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(parameters.get(key));
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resolveAndRemoveReferenceParameter(parameters, key, type, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17210554" author="avi5kdon@gmail.com" created="Fri, 9 Oct 2020 01:25:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=drezir&quot; class=&quot;user-hover&quot; rel=&quot;drezir&quot;&gt;drezir&lt;/a&gt;: This is even better. This will also address the same problem in other components. &lt;br/&gt;
Are you going to provide a pull request to fix this?&lt;/p&gt;</comment>
                            <comment id="17210614" author="drezir" created="Fri, 9 Oct 2020 04:57:27 +0000"  >&lt;p&gt;Sure, I will provide it, probably today but tomorrow at latest&lt;/p&gt;</comment>
                            <comment id="17211768" author="drezir" created="Sat, 10 Oct 2020 17:28:23 +0000"  >&lt;p&gt;Proposed fix in &lt;a href=&quot;https://github.com/apache/camel/pull/4414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/4414&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17212310" author="davsclaus" created="Mon, 12 Oct 2020 11:26:06 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13334995">CAMEL-15673</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0j4bk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>