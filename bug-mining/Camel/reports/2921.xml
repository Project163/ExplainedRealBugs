<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:04:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7920] Refresh of the camel-jaxb bundle results a strange behaviour</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7920</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have a simple test case to demonstrate this issue. Here is the camel route:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;  &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;testServiceRoute&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;cxf:bean:testServiceEndpoint&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Incoming Body:  ${body}&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;language:constant:classpath:OKResponse.xml&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Response Body before convert:  ${body}&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;convertBodyTo type=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.test.testservice.TestMessageResponse&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Response Body after convert:  ${body}&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/route&amp;gt;
&amp;lt;/camelContext&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;And the camel-cxf consumer endpoint:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;cxf:cxfEndpoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;testServiceEndpoint&quot;&lt;/span&gt;
                 address=&lt;span class=&quot;code-quote&quot;&gt;&quot;/TestService/v1&quot;&lt;/span&gt;
                 wsdlURL=&lt;span class=&quot;code-quote&quot;&gt;&quot;wsdl/TestService.wsdl&quot;&lt;/span&gt;
                 serviceName=&lt;span class=&quot;code-quote&quot;&gt;&quot;s:TestServiceInterface&quot;&lt;/span&gt;
                 endpointName=&lt;span class=&quot;code-quote&quot;&gt;&quot;s:TestServicePort&quot;&lt;/span&gt;
                 xmlns:s=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//test.com/TestService&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;        &amp;lt;cxf:properties&amp;gt;
          &amp;lt;entry key=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataFormat&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;PAYLOAD&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/cxf:properties&amp;gt;
&amp;lt;/cxf:cxfEndpoint&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have explicitly set &quot;dataFormat&quot; to default PAYLOAD just for clarity purpose.&lt;/p&gt;

&lt;p&gt;In this simple camel route, I try to change the entire body to a String XML message. As a result, the client will get an empty response back (I mean an empty soap envelope). The reason is due to following method:&lt;br/&gt;
org.apache.camel.component.cxf.DefaultCxfBinding.getBodyFromCamel:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getBodyFromCamel(org.apache.camel.Message out,
            DataFormat dataFormat) {
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; answer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataFormat == DataFormat.POJO) {
            answer = out.getBody();
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataFormat == DataFormat.PAYLOAD) {
            answer = out.getBody(CxfPayload.class);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataFormat.dealias() == DataFormat.RAW) {
            answer = out.getBody(InputStream.class);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataFormat.dealias() == DataFormat.CXF_MESSAGE) {
            answer = out.getBody();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Obviously it will return a null object back because it tries to get a body of CxfPayload type. And I also know that above camel route will work fine if I use MESSAGE dataFormat instead.&lt;/p&gt;

&lt;p&gt;However, the strange behaviour aries if I refresh camel-jaxb bundle in Karaf container. The client will get a non-empty response from OKResponse.xml file and everything works fine now. It looks like that when I refreshed camel-jaxb bundle, camel-core&apos;s FallbackConverter kicked in and it helped CXF consumer to convert the payload object into POJO.&lt;/p&gt;

&lt;p&gt;If I refreshed camel-core bundle, then above test case would stop working and client would get an empty response (empty soap envelope) back, again. So it looks like that when camel-core bundle&apos;s was refreshed, it&apos;s new activator was not able to load converters from camel-jaxb bundle since the bundle was already there. So only refreshing of the camel-jaxb bundle would enable camel-core to load the FallbackConverter again, thus helps the test route to work. &lt;/p&gt;

&lt;p&gt;I also tried to change &quot;start-level&quot; of the camel-jaxb bundle to a value much higher than &apos;50&apos;, say &apos;80&apos;, then it would work the most times. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12748546">CAMEL-7920</key>
            <summary>Refresh of the camel-jaxb bundle results a strange behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="joeluo">Joe Luo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Oct 2014 09:17:51 +0000</created>
                <updated>Fri, 17 Oct 2014 12:09:19 +0000</updated>
                            <resolved>Fri, 17 Oct 2014 12:09:19 +0000</resolved>
                                                    <fixVersion>2.13.3</fixVersion>
                    <fixVersion>2.14.1</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14173562" author="joeluo" created="Thu, 16 Oct 2014 09:20:16 +0000"  >&lt;p&gt;The test case can be downloaded from this JIRA:&lt;br/&gt;
&lt;a href=&quot;https://issues.jboss.org/browse/ENTESB-2094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jboss.org/browse/ENTESB-2094&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14173747" author="njiang" created="Thu, 16 Oct 2014 13:42:32 +0000"  >&lt;p&gt;It&apos;s caused by the JAXB FallbackTypeConverter need to be the first fallbackTypeConverter, but as camel loading the fallbackTypeConverter from a kind of OSGi Servers which is returned in different order. &lt;br/&gt;
Now I&apos;m thinking to introduce a ordered list which can help us to decide which fallbackTypeConverter need to the first one the list.&lt;/p&gt;</comment>
                            <comment id="14174982" author="njiang" created="Fri, 17 Oct 2014 12:09:19 +0000"  >&lt;p&gt;Applied the patch into camel master, camel-2.14.x and camel-2.13.x.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i218n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>