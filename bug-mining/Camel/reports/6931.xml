<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:08:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21302] camel-opentelemetry context leak with direct async producer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21302</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;There seems to be a Otel context leak when using a CXF producer in async mode. This causes different requests to have the same &lt;em&gt;traceId.&lt;/em&gt;&#160;As a workaround, setting &lt;em&gt;synchronous=true&lt;/em&gt;&#160;on the CXF producer resolves the issue. Here&apos;s a reproducer:&lt;/p&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RoutesBuilder createRouteBuilder() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
            from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;myRoute&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:send&quot;&lt;/span&gt;)
                    .end();

            from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:send&quot;&lt;/span&gt;)
                    .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfrs:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:&quot;&lt;/span&gt; + port1
&lt;/span&gt;                        + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/helloservice/sayHello?synchronous=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// setting to &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; resolves the issue
&lt;/span&gt;
            restConfiguration()
                    .port(port1);

            &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/helloservice&quot;&lt;/span&gt;)
                    .post(&lt;span class=&quot;code-quote&quot;&gt;&quot;/sayHello&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-GET-say-hi&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sayHi&quot;&lt;/span&gt;);

            from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sayHi&quot;&lt;/span&gt;)
                    .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock-GET-say-hi&quot;&lt;/span&gt;)
                    .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;example&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:end&quot;&lt;/span&gt;);
}};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve added the complete unit here: &lt;a href=&quot;https://github.com/apache/camel/blob/7d83a62b8e442dc9ac6fd79b153192add940301e/components/camel-opentelemetry/src/test/java/org/apache/camel/opentelemetry/AsyncCxfTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/7d83a62b8e442dc9ac6fd79b153192add940301e/components/camel-opentelemetry/src/test/java/org/apache/camel/opentelemetry/AsyncCxfTest.java&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13593983">CAMEL-21302</key>
            <summary>camel-opentelemetry context leak with direct async producer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="jpoth">John Poth</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Oct 2024 09:08:51 +0000</created>
                <updated>Thu, 24 Oct 2024 15:46:03 +0000</updated>
                            <resolved>Thu, 24 Oct 2024 15:45:43 +0000</resolved>
                                                    <fixVersion>4.4.5</fixVersion>
                    <fixVersion>4.8.2</fixVersion>
                    <fixVersion>4.9.0</fixVersion>
                                    <component>camel-opentelemetry</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17886346" author="davsclaus" created="Wed, 2 Oct 2024 11:11:35 +0000"  >&lt;p&gt;This is very likely a CXF issue; where CXF needs to ensure otel compliance when you use CXF with its own async processing client.&lt;/p&gt;</comment>
                            <comment id="17886925" author="ffang" created="Fri, 4 Oct 2024 13:52:26 +0000"  >&lt;p&gt;A quick update of this issue.&lt;/p&gt;

&lt;p&gt;I noticed this error in log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; [ForkJoinPool-1-worker-1] opened scope, but thread [&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-workqueue-1] closed it
        at io.opentelemetry.context.StrictContextStorage$StrictScope.close(StrictContextStorage.java:205) ~[opentelemetry-context-1.42.1.jar:1.42.1]
        at org.apache.camel.tracing.ActiveSpanManager$Holder.closeScope(ActiveSpanManager.java:140) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.tracing.ActiveSpanManager.deactivate(ActiveSpanManager.java:80) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.tracing.Tracer$TracingEventNotifier.notify(Tracer.java:266) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.support.EventHelper.doNotifyEvent(EventHelper.java:1495) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.support.EventHelper.notifyExchangeSent(EventHelper.java:969) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.processor.SendProcessor.lambda$process$0(SendProcessor.java:193) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.component.cxf.jaxrs.CxfRsProducer$CxfInvocationCallback.completed(CxfRsProducer.java:732) [camel-cxf-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
        at org.apache.camel.component.cxf.jaxrs.CxfRsProducer$CxfInvocationCallback.completed(CxfRsProducer.java:680) [camel-cxf-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otel expects the scope should be opened and closed in the same thread, if in different threads,  we see exception here.  And I highly believe this is the root cause which messes up scope/span stacks here and causes the same traceId is used in different invocations.&lt;/p&gt;

&lt;p&gt;For the camel-cxf producer endpoint, if async is used, the cxf client(code in org.apache.cxf.transport.http.HTTPConduit) will handleResponseOnWorkqueue(so camel-cxf producer opens otel scope and sends request in one thread which is from camel managed threadpool, but handles response and closes otel scope in another thread which is managed by cxf threadpool), here cxf creates org.apache.cxf.workqueue.WorkQueue extends java.util.concurrent.Executor if can&apos;t find an Executor instance from cxf Exchange. &lt;/p&gt;

&lt;p&gt;So back to the exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; [ForkJoinPool-1-worker-1] opened scope, but thread [&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-workqueue-1] closed it
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ForkJoinPool-1-worker-1 is from camel managed threadpool but default-workqueue-1 is from cxf threadpool.&lt;/p&gt;

&lt;p&gt;I think this would be a pretty common scenario for the async client(send and receive using different threads) and Otel should be able to accommodate this scenario(And I found related otel document like propagate Otel Context across threads seems promising).&lt;/p&gt;

&lt;p&gt;Another thing is that we probably can grab camel managed threadpool and set it to cxf exchange in async mode, so the shared threadpool is used here.&lt;/p&gt;

&lt;p&gt;Still experimenting...&lt;/p&gt;</comment>
                            <comment id="17886940" author="jpoth" created="Fri, 4 Oct 2024 14:44:30 +0000"  >&lt;p&gt;Yeah it is likely the source of the problem and sharing the threadpools is a great idea! Depending on how reactive the CXF client is, hopefully it will use the same thread for request/response... If this is really the issue I guess other async components could face the same issue ...&lt;/p&gt;</comment>
                            <comment id="17891046" author="ffang" created="Fri, 18 Oct 2024 17:52:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpoth&quot; class=&quot;user-hover&quot; rel=&quot;jpoth&quot;&gt;jpoth&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I have more update of this issue after reading code in camel-tracing and camel-opentelemetry.&lt;/p&gt;

&lt;p&gt;1. For the scenario that a camel producer endpoint using asynchronous way to send request and handle response in different threads, actually in camel-tracing and camel-opentelemetry have the mechanism to accommodate this scenario already.&lt;br/&gt;
There is a ExchangeAsyncStartedEvent which calls into org.apache.camel.tracing.ActiveSpanManager&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
     * If the underlying span is active, closes its scope without ending the span. This method should be called after
     * async execution is started on the same thread on which span was activated. ExchangeAsyncStartedEvent is used to
     * notify about it.
     *
     * @param exchange The exchange
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void endScope(Exchange exchange) {
        Holder holder = exchange.getProperty(ExchangePropertyKey.ACTIVE_SPAN, Holder.class);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (holder != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            holder.closeScope();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when a asynchronous camel producer(for example, a camel-cxf producer) endpoint sends request asynchronously. And this ExchangeAsyncStartedEvent and endScope method in org.apache.camel.tracing.ActiveSpanManager ensures the producer CLIENT scope can be closed in the expected thread.&lt;/p&gt;

&lt;p&gt;2. Why we have the issue exposed in AsyncCxfTest.java?&lt;br/&gt;
The problem actually comes from the DirectProduer used in the testcase.&lt;br/&gt;
The leak context actually is from DirectProducer but not CxfRsProducer(direct CLIENT but not cxfrs CLIENT)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
There must be no leaking span after test ==&amp;gt; expected: &amp;lt;{}&amp;gt; but was: &amp;lt;{opentelemetry-trace-span-key=SdkSpan{traceId=c29955d3b94b5673cc9ab23f43938a92, spanId=d6fa2ad9cdd6c636, parentSpanContext=ImmutableSpanContext{traceId=c29955d3b94b5673cc9ab23f43938a92, spanId=c0f0bed8f3615a2d, traceFlags=01, traceState=ArrayBasedTraceState{entries=[]}, remote=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, valid=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, name=send, kind=CLIENT, attributes=AttributesMap{data={url.scheme=direct, camel.uri=direct:&lt;span class=&quot;code-comment&quot;&gt;//send, url.path=send, component=camel-direct}, capacity=128, totalAddedValues=4}, status=ImmutableStatusData{statusCode=UNSET, description=}, totalRecordedEvents=0, totalRecordedLinks=0, startEpochNanos=1729272514478877531, endEpochNanos=1729272514491415078}}&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And if we take a look at the related code in DirectProducer.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// the consumer may be forced synchronous
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (consumer.getEndpoint().isSynchronous()) {
                    consumer.getProcessor().process(exchange);
                    callback.done(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; consumer.getAsyncProcessor().process(exchange, callback);
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; consumer.getAsyncProcessor().process(exchange, callback);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;will call the next DirectConsumer endpoint in the same thread, which will create Direct INTERNAL span/scope and this messes the scope/span stack, this causes that the previous camel-direct producer CLIENT scope can&apos;t be closed properly and hence causes the leak.&lt;/p&gt;

&lt;p&gt;I just sent a PR&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/pull/16008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/16008&lt;/a&gt;&lt;br/&gt;
And in the PR&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/pull/16008/commits/b9bf81b24c8a3c24117cc5454cafac906e8dd136#diff-62012c8f6e9737b3fe210a2abbb42fee51e22315ad31b82caf9df4ba3c53e9f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/16008/commits/b9bf81b24c8a3c24117cc5454cafac906e8dd136#diff-62012c8f6e9737b3fe210a2abbb42fee51e22315ad31b82caf9df4ba3c53e9f5&lt;/a&gt;&lt;br/&gt;
I added CurrentSpanTest.testDirectToDirectToAsync which exposes the same problem even without cxfrs endpoint involved.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17891791" author="davsclaus" created="Tue, 22 Oct 2024 09:58:00 +0000"  >&lt;p&gt;Thanks Freeman.&lt;/p&gt;

&lt;p&gt;We should look at only setting that exchange property in the direct producer if tracing is enabled as otherwise this will set it for everyone else when its not really needed&lt;/p&gt;</comment>
                            <comment id="17891799" author="davsclaus" created="Tue, 22 Oct 2024 10:41:16 +0000"  >&lt;p&gt;Are you sure it really works, I see DEBUG errors when running AsyncCxfTest in the log if I enable this via&lt;/p&gt;


&lt;p&gt;+logger.otel.name=org.apache.camel.tracing&lt;br/&gt;
+logger.otel.level=TRACE&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17891829" author="davsclaus" created="Tue, 22 Oct 2024 12:12:02 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

2024-10-22 14:07:44,387 [Pool-2-worker-1] DEBUG ActiveSpanManager              - Failed to close span scope. This exception is ignored.
java.lang.IllegalStateException: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; [ForkJoinPool-1-worker-1] opened scope, but thread [ForkJoinPool-2-worker-1] closed it
    at io.opentelemetry.context.StrictContextStorage$StrictScope.close(StrictContextStorage.java:205) ~[opentelemetry-context-1.43.0.jar:1.43.0]
    at org.apache.camel.tracing.ActiveSpanManager$Holder.closeScope(ActiveSpanManager.java:147) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.tracing.ActiveSpanManager.deactivate(ActiveSpanManager.java:87) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.tracing.Tracer$TracingEventNotifier.notify(Tracer.java:266) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.EventHelper.doNotifyEvent(EventHelper.java:1574) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.EventHelper.notifyExchangeSent(EventHelper.java:1048) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.processor.SendProcessor.lambda$process$0(SendProcessor.java:193) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.AsyncCallback.run(AsyncCallback.java:44) ~[camel-api-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.opentelemetry.CurrentSpanTest$AsyncMockEndpoint$1.lambda$process$1(CurrentSpanTest.java:339) ~[test-classes/:?]
    at java.base/java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:787) [?:?]
    at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) [?:?]
    at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1810) [?:?]
    at java.base/java.util.concurrent.CompletableFuture$AsyncRun.exec(CompletableFuture.java:1796) [?:?]
    at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373) [?:?]
    at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182) [?:?]
    at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655) [?:?]
    at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622) [?:?]
    at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165) [?:?]
Caused by: io.opentelemetry.context.StrictContextStorage$CallerStackTrace: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; [ForkJoinPool-1-worker-1] opened scope &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {opentelemetry-trace-span-key=SdkSpan{traceId=d1c56f92efbcbfee77db67d3fce5581e, spanId=3397200e7a63509c, parentSpanContext=ImmutableSpanContext{traceId=d1c56f92efbcbfee77db67d3fce5581e, spanId=79c4b170505d1064, traceFlags=01, traceState=ArrayBasedTraceState{entries=[]}, remote=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, valid=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, name=asyncmock1, kind=CLIENT, attributes=AttributesMap{data={camel.uri=asyncmock1:&lt;span class=&quot;code-comment&quot;&gt;//result, url.path=result, component=camel-asyncmock1, url.scheme=asyncmock1}, capacity=128, totalAddedValues=4}, status=ImmutableStatusData{statusCode=UNSET, description=}, totalRecordedEvents=0, totalRecordedLinks=0, startEpochNanos=1729598864373351708, endEpochNanos=0}} here:
&lt;/span&gt;    at org.apache.camel.opentelemetry.OpenTelemetrySpanAdapter.makeCurrent(OpenTelemetrySpanAdapter.java:118) ~[classes/:?]
    at org.apache.camel.tracing.ActiveSpanManager$Holder.&amp;lt;init&amp;gt;(ActiveSpanManager.java:128) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.tracing.ActiveSpanManager.activate(ActiveSpanManager.java:67) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.tracing.Tracer$TracingEventNotifier.notify(Tracer.java:250) ~[camel-tracing-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.EventHelper.doNotifyEvent(EventHelper.java:1574) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.EventHelper.notifyExchangeSending(EventHelper.java:1005) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:166) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:104) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:104) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.handleFirst(RedeliveryErrorHandler.java:440) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:416) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.doRun(DefaultReactiveExecutor.java:199) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.executeReactiveWork(DefaultReactiveExecutor.java:189) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.tryExecuteReactiveWork(DefaultReactiveExecutor.java:166) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:148) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.processor.Pipeline.process(Pipeline.java:163) ~[camel-core-processor-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.CamelInternalProcessor.processNonTransacted(CamelInternalProcessor.java:347) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:323) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:100) ~[camel-direct-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.SharedCamelInternalProcessor.processNonTransacted(SharedCamelInternalProcessor.java:156) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:133) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.SharedCamelInternalProcessor$1.process(SharedCamelInternalProcessor.java:89) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:82) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:86) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.support.cache.DefaultProducerCache.send(DefaultProducerCache.java:178) ~[camel-support-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:176) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:172) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:153) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:187) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:195) ~[camel-base-engine-4.9.0-SNAPSHOT.jar:4.9.0-SNAPSHOT]
    at org.apache.camel.opentelemetry.CurrentSpanTest.testDirectToDirectToAsync(CurrentSpanTest.java:122) ~[test-classes/:?]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]
    at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]
    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:767) ~[junit-platform-commons-1.11.3.jar:1.11.3]
    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$8(TestMethodTestDescriptor.java:217) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:213) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:138) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:68) ~[junit-jupiter-engine-5.11.3.jar:5.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:156) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService$ExclusiveTask.exec(ForkJoinPoolHierarchicalTestExecutorService.java:274) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService$ExclusiveTask.execSync(ForkJoinPoolHierarchicalTestExecutorService.java:247) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService.executeSync(ForkJoinPoolHierarchicalTestExecutorService.java:194) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService.invokeAll(ForkJoinPoolHierarchicalTestExecutorService.java:166) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService$ExclusiveTask.exec(ForkJoinPoolHierarchicalTestExecutorService.java:274) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService$ExclusiveTask.execSync(ForkJoinPoolHierarchicalTestExecutorService.java:247) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService.invokeAll(ForkJoinPoolHierarchicalTestExecutorService.java:159) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    at org.junit.platform.engine.support.hierarchical.ForkJoinPoolHierarchicalTestExecutorService$ExclusiveTask.exec(ForkJoinPoolHierarchicalTestExecutorService.java:274) ~[junit-platform-engine-1.11.3.jar:1.11.3]
    ... 5 more
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17891830" author="davsclaus" created="Tue, 22 Oct 2024 12:16:41 +0000"  >&lt;p&gt;Using synchronous=true resolves the issue and the logs are clean without any exceptions&lt;/p&gt;</comment>
                            <comment id="17891834" author="ffang" created="Tue, 22 Oct 2024 12:31:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;The exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed to close span scope. This exception is ignored.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;exists even without my changes when async mode is used here.&lt;/p&gt;

&lt;p&gt;And it comes from the code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (event &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CamelEvent.ExchangeAsyncProcessingStartedEvent eap) {

                    &lt;span class=&quot;code-comment&quot;&gt;// no need to filter scopes here. It&apos;s ok to close a scope multiple times and
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// implementations check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the scope being disposed is current
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// and should not &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; anything &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; scopes don&apos;t match.
&lt;/span&gt;                    ActiveSpanManager.endScope(eap.getExchange());
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I read comments here correctly, this is by design.  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                    &lt;span class=&quot;code-comment&quot;&gt;// no need to filter scopes here. It&apos;s ok to close a scope multiple times and
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// implementations check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the scope being disposed is current
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// and should not &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; anything &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; scopes don&apos;t match.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we close the scope already in the expected thread, it should be OK to close it again in another thread, and that&apos;s why we see this exception and can ignore it. And as long as we close the scope already in the expected thread, there would be no context leak.&lt;/p&gt;


&lt;p&gt;And for your comment&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
We should look at only setting that exchange property in the direct producer &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; tracing is enabled as otherwise &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will set it &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; everyone &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; when its not really needed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yes, I will do it accordingly.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17891982" author="ffang" created="Tue, 22 Oct 2024 19:54:02 +0000"  >&lt;p&gt;I think we also want this in 4.4.x and 4.8.x LTS version&lt;/p&gt;</comment>
                            <comment id="17892053" author="davsclaus" created="Wed, 23 Oct 2024 06:17:35 +0000"  >&lt;p&gt;Okay so the StrictContextStorage is only used during testing which has a serious overhead as it collects stack-traces for every request and throws exception for double closing.&lt;/p&gt;

&lt;p&gt;The default storage is thread-local which does not do that, and ignore double closing, so under normal operation this is working faster and better.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17892074" author="jpoth" created="Wed, 23 Oct 2024 07:39:08 +0000"  >&lt;p&gt;Yeah those are just warnings. We do check if there are any leaks at the end of each tests.&lt;/p&gt;</comment>
                            <comment id="17892271" author="davsclaus" created="Wed, 23 Oct 2024 18:58:49 +0000"  >&lt;p&gt;Freeman, you can backport to older branches.&lt;/p&gt;</comment>
                            <comment id="17892533" author="ffang" created="Thu, 24 Oct 2024 15:46:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, done!&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13594092">CXF-9063</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13594126">CAMEL-21309</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10065"><![CDATA[Needs James Gosling]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rqnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>