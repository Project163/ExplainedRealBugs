<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:48:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16734] Recipient list does not wait for processing an exchange by recipients and ignores aggregation strategy when route is transacted.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16734</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When migrating to Camel 3.7.2 I&apos;ve noticed that there is a problem with the recipient list in transacted routes.&lt;br/&gt;
Recipient list does not wait for processing an exchange by recipients and ignores aggregation strategy when :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;route is transacted,&lt;/li&gt;
	&lt;li&gt;doTry()...doCatch() is used,&lt;/li&gt;
	&lt;li&gt;processing by the recipient takes longer.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The bug was discovered in version 3.7.2 but it&apos;s also present in the newest versions 3.10.0 and 3.7.4 (LTS).&lt;/p&gt;

&lt;p&gt;Here is a test, which reproduces the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TransactedRecipientListTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TransactionClientDataSourceSupport {

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRecipientList() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running on version : &quot;&lt;/span&gt; + context.getVersion());

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; response = template.requestBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi !!!&quot;&lt;/span&gt;, response);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                &lt;span class=&quot;code-comment&quot;&gt;// NOTE commenting transacted(), doTry() or delay() make &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test green in Camel 3.7.4 and above
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// however commenting delay() doest not make &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test green in Camel 3.7.2
&lt;/span&gt;                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;)
                        .transacted()
                        .doTry()
                            .recipientList(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:a&quot;&lt;/span&gt;))
                        .endDoTry();
                &lt;span class=&quot;code-comment&quot;&gt;// NOTE doCatch() skipped here to keep test as simple as possible
&lt;/span&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:a&quot;&lt;/span&gt;)
                        .delay(1000)
                        .transform(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi !!!&quot;&lt;/span&gt;));
            }
        };
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This test is passing with Camel 3.7.1 and below, but it&apos;s failing with Camel 3.7.2 and above.&lt;br/&gt;
However it&apos;s also passing with Camel 3.9.0 !&lt;/p&gt;

&lt;p&gt;It&apos;s also passing on &apos;main&apos; and &apos;3.7.x&apos; branches after reverting commit b1b5b7d0 : &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16550&quot; title=&quot;camel-core - Split and Aggregate with Transacted may cause thread to stuck&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16550&quot;&gt;&lt;del&gt;CAMEL-16550&lt;/del&gt;&lt;/a&gt;: camel-core - Split and Aggregate with Transacted may cause thread to stuck&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve checked a history of MulticastProcessor class and it looks that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16103&quot; title=&quot;Stack size increases in split with transacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16103&quot;&gt;&lt;del&gt;CAMEL-16103&lt;/del&gt;&lt;/a&gt; introduced the problem.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16295&quot; title=&quot;split with AggregationStrategy is ignored when using transacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16295&quot;&gt;&lt;del&gt;CAMEL-16295&lt;/del&gt;&lt;/a&gt; fixed the problem.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16550&quot; title=&quot;camel-core - Split and Aggregate with Transacted may cause thread to stuck&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16550&quot;&gt;&lt;del&gt;CAMEL-16550&lt;/del&gt;&lt;/a&gt; introduced this problem again.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13384557">CAMEL-16734</key>
            <summary>Recipient list does not wait for processing an exchange by recipients and ignores aggregation strategy when route is transacted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="kmackowiak">Krzysztof Mackowiak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jun 2021 15:06:00 +0000</created>
                <updated>Mon, 21 Jun 2021 14:40:20 +0000</updated>
                            <resolved>Mon, 21 Jun 2021 06:07:01 +0000</resolved>
                                    <version>3.7.4</version>
                    <version>3.7.2</version>
                    <version>3.7.3</version>
                    <version>3.8.0</version>
                    <version>3.10.0</version>
                                    <fixVersion>3.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17366108" author="davsclaus" created="Sun, 20 Jun 2021 06:22:27 +0000"  >&lt;p&gt;Thanks for reporting. &lt;/p&gt;

&lt;p&gt;So yeah there is a problem with transacted and the reactive routing engine that goes against each other. &lt;br/&gt;
So its all the EIPs that use the routing engine to breakup into a series of tasks, such as try .. catch, pipeline, etc.&lt;/p&gt;
</comment>
                            <comment id="17366396" author="davsclaus" created="Mon, 21 Jun 2021 06:07:01 +0000"  >&lt;p&gt;Thanks for reporting and the detailed analysis and testing which other JIRAs caused this etc.&lt;/p&gt;

&lt;p&gt;I was able to come up with a better fix in the aggregator EIP itself and can therefore remove that special &lt;em&gt;hack&lt;/em&gt; in the multicast processor.&lt;/p&gt;

&lt;p&gt;The 3.11 upgrade doc mention the change in the aggregator eip.&lt;/p&gt;</comment>
                            <comment id="17366625" author="kmackowiak" created="Mon, 21 Jun 2021 14:21:15 +0000"  >&lt;p&gt;Would it be possible to backport this fix to LTS version (3.7.x) ?&lt;/p&gt;</comment>
                            <comment id="17366638" author="davsclaus" created="Mon, 21 Jun 2021 14:40:20 +0000"  >&lt;p&gt;No intention to backport to 3.7.x as the change is not a simple change and its in a core area. And Camel 3.11 LTS is coming out soon.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13384694">CAMEL-16737</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13027040" name="TransactedRecipientListTest.java" size="1414" author="kmackowiak" created="Fri, 18 Jun 2021 15:05:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0s2sg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>