<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:35:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13373] camel-stax - FileInputStream not closed</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13373</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The&#160;StAXProcessor.java class does not close the stream it opens.&lt;/p&gt;

&lt;p&gt;I had to modify it like this:&#160;&lt;/p&gt;

&lt;p&gt;public void process(Exchange exchange) throws Exception {&lt;br/&gt;
 InputSource is = exchange.getIn().getMandatoryBody(InputSource.class);&lt;br/&gt;
 XMLStreamReader stream = exchange.getIn().getMandatoryBody(XMLStreamReader.class);&lt;br/&gt;
 // Fermeture de la inputstream ici, car dans la version originale de la classe la stream reste ouverte.&lt;br/&gt;
 &lt;b&gt;try(InputStream inputStreamToClose = is.getByteStream()) {&lt;/b&gt;&lt;br/&gt;
 XMLReader reader = new StaxStreamXMLReader(stream);&lt;br/&gt;
 ContentHandler handler;&lt;br/&gt;
 if (this.contentHandlerClass != null)&lt;/p&gt;

{ handler = (ContentHandler) this.contentHandlerClass.newInstance(); }

&lt;p&gt;else&lt;/p&gt;

{ handler = this.contentHandler; }

&lt;p&gt;reader.setContentHandler(handler);&lt;br/&gt;
 reader.parse(is);&lt;br/&gt;
 if (ExchangeHelper.isOutCapable(exchange))&lt;/p&gt;

{ exchange.getOut().setHeaders(exchange.getIn().getHeaders()); exchange.getOut().setBody(handler); }

&lt;p&gt;else&lt;/p&gt;

{ exchange.getIn().setBody(handler); }

&lt;p&gt;} &lt;b&gt;finally&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;*&lt;/p&gt;
{ // Fermeture de la strem ValidatingStreamReader validatingStreamReader = (ValidatingStreamReader)stream; validatingStreamReader.closeCompletely(); }
&lt;p&gt;*&lt;/p&gt;

&lt;p&gt;&lt;b&gt;}&lt;/b&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13224357">CAMEL-13373</key>
            <summary>camel-stax - FileInputStream not closed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Sirbu">Alexandru</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Mar 2019 16:17:16 +0000</created>
                <updated>Tue, 18 Jun 2019 08:14:23 +0000</updated>
                            <resolved>Tue, 18 Jun 2019 08:14:23 +0000</resolved>
                                    <version>2.23.1</version>
                                    <fixVersion>3.0.0.M4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-stax</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16803022" author="ancosen" created="Wed, 27 Mar 2019 16:34:22 +0000"  >&lt;p&gt;It&apos;s not really clear. Maybe open a PR.&lt;/p&gt;</comment>
                            <comment id="16803050" author="sirbu" created="Wed, 27 Mar 2019 16:49:35 +0000"  >&lt;p&gt;Each time we have a from(&quot;file://).to(stax://) after camel finishes to process the route we observe a FileInputStream not closed.&lt;/p&gt;

&lt;p&gt;After analyzing who was responsible for opening the FileInputStream, i found that the StAXProcessor.java was in cause.&lt;/p&gt;

&lt;p&gt;t I opens the stream for reading (line; reader.parse(is) but it never closes it.&lt;/p&gt;

&lt;p&gt;So, i had to modify the source code by adding a try with resources at the line in bold.&lt;/p&gt;

&lt;p&gt;Is it more clear ? or should i open a PR and post the link here ?&lt;/p&gt;

&lt;p&gt;Thanks&#160; &#160;&lt;/p&gt;</comment>
                            <comment id="16803054" author="ancosen" created="Wed, 27 Mar 2019 16:52:04 +0000"  >&lt;p&gt;If you have a quick fix for this you can open a Pull request with the fix. Otherwise, it is clear.&#160;&lt;/p&gt;</comment>
                            <comment id="16803115" author="sirbu" created="Wed, 27 Mar 2019 17:33:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/2843&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2843&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16803851" author="sirbu" created="Thu, 28 Mar 2019 11:28:33 +0000"  >&lt;p&gt;Hello I updated the PR.&lt;/p&gt;

&lt;p&gt;I think that theres no quickfix as I had to add woodstox library. This is brocken the Checkstyle of the project..&lt;/p&gt;

&lt;p&gt;For more details on the pb:&lt;/p&gt;

&lt;p&gt;These 2 lines opens the FilesInputStreams that are never closed:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;InputSource is = exchange.getIn().getMandatoryBody(InputSource.class);&lt;/em&gt;&lt;/b&gt;&lt;br/&gt;
&lt;b&gt;&lt;em&gt;XMLStreamReader stream = exchange.getIn().getMandatoryBody(XMLStreamReader.class);&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="16866339" author="davsclaus" created="Tue, 18 Jun 2019 08:14:23 +0000"  >&lt;p&gt;Thanks for reporting and the PR.&lt;/p&gt;

&lt;p&gt;Mind that this happens on windows only&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z015zc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>