<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:29:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12449] DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12449</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If no services remains after applying ServiceFilter in&#160;DefaultServiceLoadBalancer, expecting exception RejectedExecutionException(&quot;No active services with name &quot; + serviceName), but&#160;throws&#160;IndexOutOfBoundsException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13152741">CAMEL-12449</key>
            <summary>DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Vadim R">Vadim R</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Apr 2018 14:41:04 +0000</created>
                <updated>Tue, 17 Apr 2018 08:31:50 +0000</updated>
                            <resolved>Tue, 17 Apr 2018 07:58:42 +0000</resolved>
                                    <version>2.21.0</version>
                                    <fixVersion>2.20.4</fixVersion>
                    <fixVersion>2.21.1</fixVersion>
                    <fixVersion>2.22.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16439533" author="githubbot" created="Mon, 16 Apr 2018 14:45:10 +0000"  >&lt;p&gt;player13 opened a new pull request #2297: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   If no services remains after applying ServiceFilter in DefaultServiceLoadBalancer, expecting exception RejectedExecutionException(&quot;No active services with name &quot; + serviceName), but throws IndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16439534" author="githubbot" created="Mon, 16 Apr 2018 14:45:13 +0000"  >&lt;p&gt;GitHub user player13 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException&lt;/p&gt;

&lt;p&gt;    If no services remains after applying ServiceFilter in DefaultServiceLoadBalancer, expecting exception RejectedExecutionException(&quot;No active services with name &quot; + serviceName), but throws IndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/player13/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/player13/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2297.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2297&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d7e85d89f1d2469862c9eadd5ecd82cb4a7aea8f&lt;br/&gt;
Author: Vadim R &amp;lt;8365723+player13@...&amp;gt;&lt;br/&gt;
Date:   2018-04-16T14:43:33Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16440552" author="githubbot" created="Tue, 17 Apr 2018 07:53:48 +0000"  >&lt;p&gt;davsclaus closed pull request #2297: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/camel-core/src/main/java/org/apache/camel/impl/cloud/DefaultServiceLoadBalancer.java b/camel-core/src/main/java/org/apache/camel/impl/cloud/DefaultServiceLoadBalancer.java&lt;br/&gt;
index 19a55fa31a0..51d33cd0c59 100644&lt;br/&gt;
&amp;#8212; a/camel-core/src/main/java/org/apache/camel/impl/cloud/DefaultServiceLoadBalancer.java&lt;br/&gt;
+++ b/camel-core/src/main/java/org/apache/camel/impl/cloud/DefaultServiceLoadBalancer.java&lt;br/&gt;
@@ -136,7 +136,7 @@ protected void doStop() throws Exception {&lt;br/&gt;
             // filter services&lt;br/&gt;
             services = serviceFilter.apply(services);&lt;br/&gt;
             // let the client service chooser find which server to use&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;service = services.size() &amp;gt; 1 ? serviceChooser.choose(services) : services.get(0);&lt;br/&gt;
+            service = services.isEmpty() ? null : services.size() &amp;gt; 1 ? serviceChooser.choose(services) : services.get(0);&lt;br/&gt;
             if (service == null) 
{
                 throw new RejectedExecutionException(&quot;No active services with name &quot; + serviceName);
             }
&lt;p&gt;diff --git a/camel-core/src/test/java/org/apache/camel/impl/cloud/LoadBalancerTest.java b/camel-core/src/test/java/org/apache/camel/impl/cloud/LoadBalancerTest.java&lt;br/&gt;
index a78c291c582..1b30c29f324 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/camel-core/src/test/java/org/apache/camel/impl/cloud/LoadBalancerTest.java&lt;br/&gt;
+++ b/camel-core/src/test/java/org/apache/camel/impl/cloud/LoadBalancerTest.java&lt;br/&gt;
@@ -16,22 +16,31 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.camel.impl.cloud;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+import java.util.concurrent.RejectedExecutionException;&lt;br/&gt;
 import java.util.stream.Collectors;&lt;/p&gt;

&lt;p&gt;-import org.apache.camel.ContextTestSupport;&lt;br/&gt;
+import org.apache.camel.impl.DefaultCamelContext;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
 import org.junit.Test;&lt;/p&gt;

&lt;p&gt;-public class LoadBalancerTest extends ContextTestSupport {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test&lt;/li&gt;
	&lt;li&gt;public void testLoadBalancer() throws Exception {&lt;/li&gt;
	&lt;li&gt;StaticServiceDiscovery serviceDiscovery = new StaticServiceDiscovery();&lt;br/&gt;
+import static junit.framework.TestCase.assertEquals;&lt;br/&gt;
+&lt;br/&gt;
+public class LoadBalancerTest {&lt;br/&gt;
+&lt;br/&gt;
+    private static StaticServiceDiscovery serviceDiscovery = new StaticServiceDiscovery();&lt;br/&gt;
+&lt;br/&gt;
+    @BeforeClass&lt;br/&gt;
+    public static void setUp() 
{
         serviceDiscovery.addServer(&quot;no-name&quot;, &quot;127.0.0.1&quot;, 2001);
         serviceDiscovery.addServer(&quot;no-name&quot;, &quot;127.0.0.1&quot;, 2002);
         serviceDiscovery.addServer(&quot;no-name&quot;, &quot;127.0.0.1&quot;, 1001);
         serviceDiscovery.addServer(&quot;no-name&quot;, &quot;127.0.0.1&quot;, 1002);
+    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    @Test&lt;br/&gt;
+    public void testLoadBalancer() throws Exception {&lt;br/&gt;
         DefaultServiceLoadBalancer loadBalancer = new DefaultServiceLoadBalancer();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;loadBalancer.setCamelContext(context);&lt;br/&gt;
+        loadBalancer.setCamelContext(new DefaultCamelContext());&lt;br/&gt;
         loadBalancer.setServiceDiscovery(serviceDiscovery);&lt;br/&gt;
         loadBalancer.setServiceFilter(services -&amp;gt; services.stream().filter(s -&amp;gt; s.getPort() &amp;lt; 2000).collect(Collectors.toList()));&lt;br/&gt;
         loadBalancer.setServiceChooser(new RoundRobinServiceChooser());&lt;br/&gt;
@@ -44,4 +53,14 @@ public void testLoadBalancer() throws Exception 
{
             return false;
         }
&lt;p&gt;);&lt;br/&gt;
     }&lt;br/&gt;
+&lt;br/&gt;
+    @Test(expected = RejectedExecutionException.class)&lt;br/&gt;
+    public void testNoActiveServices() throws Exception &lt;/p&gt;
{
+        DefaultServiceLoadBalancer loadBalancer = new DefaultServiceLoadBalancer();
+        loadBalancer.setCamelContext(new DefaultCamelContext());
+        loadBalancer.setServiceDiscovery(serviceDiscovery);
+        loadBalancer.setServiceFilter(services -&amp;gt; services.stream().filter(s -&amp;gt; s.getPort() &amp;lt; 1000).collect(Collectors.toList()));
+        loadBalancer.setServiceChooser(new RoundRobinServiceChooser());
+        loadBalancer.process(&quot;no-name&quot;, service -&amp;gt; false);
+    }
&lt;p&gt; }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16440553" author="githubbot" created="Tue, 17 Apr 2018 07:53:48 +0000"  >&lt;p&gt;Github user davsclaus closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16440559" author="davsclaus" created="Tue, 17 Apr 2018 07:58:42 +0000"  >&lt;p&gt;Thanks for the PR. I fixed the checkstyle issue.&lt;/p&gt;</comment>
                            <comment id="16440594" author="githubbot" created="Tue, 17 Apr 2018 08:31:23 +0000"  >&lt;p&gt;player13 commented on issue #2297: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2297#issuecomment-381898820&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297#issuecomment-381898820&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @davsclaus Tnx!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16440596" author="githubbot" created="Tue, 17 Apr 2018 08:31:50 +0000"  >&lt;p&gt;player13 commented on issue #2297: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12449&quot; title=&quot;DefaultServiceLoadBalancer throws IndexOutOfBoundsException after applying ServiceFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12449&quot;&gt;&lt;del&gt;CAMEL-12449&lt;/del&gt;&lt;/a&gt;: DefaultServiceLoadBalancer throws IndexOutOfBoundsException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2297#issuecomment-381898820&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2297#issuecomment-381898820&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @davsclaus Thx!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3slpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>