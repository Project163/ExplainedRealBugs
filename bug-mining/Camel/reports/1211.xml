<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:40:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-3249] HawtDB file grows indefinitely over time</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3249</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using an aggregator with the HawtDB persistent store, the file grows indefinitely until it fills the volume on which it&apos;s stored. This prevents the persistence from being used in any kind of long-running production deployment.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Using 2.5-SNAPSHOT&lt;/p&gt;</environment>
        <key id="12487431">CAMEL-3249</key>
            <summary>HawtDB file grows indefinitely over time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="gim">Glenn Moss</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Oct 2010 23:19:41 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:18 +0000</updated>
                            <resolved>Thu, 21 Oct 2010 17:52:45 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                    <version>2.5.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-hawtdb</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                                                            <comments>
                            <comment id="12956903" author="davsclaus" created="Tue, 19 Oct 2010 17:48:57 +0000"  >&lt;p&gt;Can you post how you have setup this?&lt;/p&gt;
</comment>
                            <comment id="12957181" author="gim" created="Tue, 19 Oct 2010 21:37:03 +0000"  >&lt;p&gt;Here&apos;s how I&apos;ve used the aggregator:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:source&quot;&lt;/span&gt;)
  .aggregate(header(&lt;span class=&quot;code-quote&quot;&gt;&quot;some-id&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyAggregationStrategy())
  .aggregationRepository(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HawtDBAggregationRepository(&lt;span class=&quot;code-quote&quot;&gt;&quot;repo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;hawtdbfile&quot;&lt;/span&gt;))
  .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:destination&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve replicated the behaviour with only HawtDB. By opening a new HawtDB file, and only putting in data of a fixed size into the identical key, the file size grows indefinitely, depending on the size of the data. In the following code, the breakpoint appears to be at 489 characters of data. The file size remains constant with 488 character string, but grows indefinitely with a 489-character string. I think this probably has something to do with how the size of the data relates to the page size (set on TxPageFileFactory).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;App {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename = args[0];
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dataSize = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(args[1]);

    BTreeIndexFactory&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; indexFact =
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BTreeIndexFactory&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
    indexFact.setKeyCodec(StringCodec.INSTANCE);
    indexFact.setValueCodec(StringCodec.INSTANCE);
    indexFact.setDeferredEncoding(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

    TxPageFileFactory pageFact = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TxPageFileFactory();
    pageFact.setFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(filename));
    pageFact.setPageSize((&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;)512);
    pageFact.setMappingSegementSize(8 * 1024 * 1024);
    pageFact.setSync(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    pageFact.open();
    TxPageFile pageFile = pageFact.getTxPageFile();

    Transaction tx = pageFile.tx();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!tx.allocator().isAllocated(0)) {
        SortedIndex&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; created = indexFact.create(tx);
    }
    tx.commit();
    pageFile.flush();

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; data = &quot;&quot;;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; dataSize; i++) {
      data += &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
        tx = pageFile.tx();
        SortedIndex&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; index = indexFact.open(tx);

        index.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, data);

        tx.commit();
        pageFile.flush();
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      pageFact.close();
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12957177" author="davsclaus" created="Wed, 20 Oct 2010 05:31:14 +0000"  >&lt;p&gt;Ah your problem is that you do not have any completion conditions. So data is never gone be sent out of the aggregator, and hence why the hawtdb file keeps growing.&lt;/p&gt;

&lt;p&gt;You need to add 1 .. n completion conditions. See more at&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/aggregator2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/aggregator2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For example a completionTimeout or completionSize etc.&lt;/p&gt;

&lt;p&gt;Also Camel in Action chapter 8 covers the aggregator pattern and how to use it with HawtDB&lt;/p&gt;</comment>
                            <comment id="12957159" author="gim" created="Wed, 20 Oct 2010 18:28:17 +0000"  >&lt;p&gt;Sorry, in sanitizing the code, I did leave the completion condition out, but be assured that I do have one. As I detailed in the remainder of my comment, the problem is reproducible with only HawtDB code, and appears to not be dependent on the aggregator component.&lt;/p&gt;</comment>
                            <comment id="12957199" author="davsclaus" created="Wed, 20 Oct 2010 19:27:09 +0000"  >&lt;p&gt;Please leave all details its important.&lt;/p&gt;

&lt;p&gt;What version of HawtDB are you using?&lt;/p&gt;

&lt;p&gt;What JDK are you using?&lt;/p&gt;</comment>
                            <comment id="12957198" author="gim" created="Wed, 20 Oct 2010 23:40:34 +0000"  >&lt;p&gt;We&apos;re using HawtDB 1.4 and JDK 1.6. (I don&apos;t have the exact version number as I don&apos;t have access to the machine I was using for testing right now.)&lt;/p&gt;</comment>
                            <comment id="12957189" author="davsclaus" created="Thu, 21 Oct 2010 07:37:47 +0000"  >&lt;p&gt;Hiram can you take a look.&lt;/p&gt;

&lt;p&gt;It looks like HawtDB doesn&apos;t register the old data as free.&lt;/p&gt;

&lt;p&gt;I have created an unit test in camel-hawtdb&lt;br/&gt;
org.apache.camel.component.hawtdb.HawtDBGrowIssueTest&lt;/p&gt;
</comment>
                            <comment id="12957166" author="davsclaus" created="Thu, 21 Oct 2010 15:13:57 +0000"  >&lt;p&gt;Hiram is working on a fix so we should try to get it fixed in Camel 2.5. eg a new release of hawtDB that camel-hawtdb uses.&lt;/p&gt;</comment>
                            <comment id="12957165" author="chirino" created="Thu, 21 Oct 2010 15:20:21 +0000"  >&lt;p&gt;Thanks for the test case.  I found an allocation leak in HawtDB.  I&apos;ve got it fixed in the latest snapshot now and am working on spinning a new release so you guys can pick the fix up.&lt;/p&gt;</comment>
                            <comment id="12957192" author="davsclaus" created="Thu, 21 Oct 2010 16:32:40 +0000"  >&lt;p&gt;Also remember to update the release notes and camel-hawtdb that v1.5 is required due the bug in older releases&lt;/p&gt;</comment>
                            <comment id="12957191" author="davsclaus" created="Thu, 21 Oct 2010 17:52:45 +0000"  >&lt;p&gt;trunk: 1026081.&lt;/p&gt;

&lt;p&gt;Gleen HawtDB 1.5 has been released which has the fix. So you should be able to upgrade and use that version.&lt;br/&gt;
Thanks for reporting.&lt;/p&gt;

&lt;p&gt;Its already in central maven repo&lt;/p&gt;</comment>
                            <comment id="12957252" author="gim" created="Sat, 23 Oct 2010 16:18:33 +0000"  >&lt;p&gt;Thanks for your work on this. I&apos;m currently out if the office for a while, but I&apos;m excited to try it out once I&apos;m back. &lt;/p&gt;</comment>
                            <comment id="13023750" author="davsclaus" created="Sun, 24 Apr 2011 09:57:18 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12487935">CAMEL-3258</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01tkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>