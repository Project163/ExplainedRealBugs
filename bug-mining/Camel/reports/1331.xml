<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:42:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-3595] FTP rename fails</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3595</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;(This is related to the user group discussion &lt;a href=&quot;http://camel.465427.n5.nabble.com/Problem-renaming-existing-file-in-FTP-td3307670.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.465427.n5.nabble.com/Problem-renaming-existing-file-in-FTP-td3307670.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;When using a tmpPrefix when uploading, the rename from the tmp-file to the destination file fails, if the destination file is already present, even though the option fileExist=Override is used.&lt;/p&gt;

&lt;p&gt;We have the problem on just a few destination servers which all seems to be windows machines&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;I have fetched the 2.4 branch of camel-ftp to find out why it does not work, since the unit test you refer to in your previous post do excercise the problem.&lt;/p&gt;

&lt;p&gt;It appears that the cause of the problem is, that the FtpOperations.existsFile fails to return true, which then causes the code not to enter the part where it deletes the exisiting file.&lt;/p&gt;

&lt;p&gt;The reason for the FtpOperations.existsFile to return false, is, that the list of existing files has the directoryname prepended, e.g. I&apos;m trying to upload Test.REN to folder test/rename, and in the code &lt;br/&gt;
&quot;if (existing.equals(onlyName))&quot; &lt;br/&gt;
existing=test/rename\Test.REN and onlyName=Test.REN - which returns false - but causes the later rename to fail as the target folder did contain the Test.REN. &lt;/p&gt;

&lt;p&gt;My guess is that it is server dependent whether the returned list of names in the directory include the directory name or not?&lt;/p&gt;

&lt;p&gt;To fix this I have added the following line of code before the if-statement&lt;br/&gt;
existing = FileUtil.stripPath(FileUtil.normalizePath(existing));&lt;br/&gt;
So it will strip the path part of the file name before comparing it to onlyName.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12496943">CAMEL-3595</key>
            <summary>FTP rename fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mikaelfj">Mikael J&#248;rgensen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Jan 2011 14:08:16 +0000</created>
                <updated>Tue, 25 Oct 2011 11:36:09 +0000</updated>
                            <resolved>Sun, 30 Jan 2011 14:10:25 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12987573" author="mikaelfj" created="Thu, 27 Jan 2011 14:11:01 +0000"  >&lt;p&gt;Patch file from eclipse&lt;/p&gt;</comment>
                            <comment id="12988570" author="mikaelfj" created="Sun, 30 Jan 2011 11:26:45 +0000"  >&lt;p&gt;The previous patch did not work when the client (camel) machine is unix and the target (ftp server) is windows as the normalizePath method checks the local OS etc.&lt;/p&gt;

&lt;p&gt;The attached patch is now working or us - but just takes the file name as the part of the string after the left-most occurence of either / or \ - so it will not work in a rare occation where a / or \ could be part of the filename.&lt;/p&gt;</comment>
                            <comment id="12988579" author="davsclaus" created="Sun, 30 Jan 2011 12:53:57 +0000"  >&lt;p&gt;Can you try with Camel 2.6 when its released. There has been many improvements and fixes since Camel 2.4.&lt;/p&gt;

&lt;p&gt;What FTP server do you use, and which OS does it run?&lt;br/&gt;
The API of &lt;tt&gt;listNames&lt;/tt&gt; ought to &lt;b&gt;only&lt;/b&gt; return the filename, without any path indication. Hence a plain &lt;tt&gt;equals&lt;/tt&gt; ought to be sufficient.&lt;/p&gt;
</comment>
                            <comment id="12988584" author="mikaelfj" created="Sun, 30 Jan 2011 13:22:55 +0000"  >&lt;p&gt;We can try with 2.6 when it is out.&lt;/p&gt;

&lt;p&gt;I&apos;ll see if I can find out which ftp server that is in use - and try out the NLST command from the command-line (which should be the ftp-command behind listNames.&lt;/p&gt;</comment>
                            <comment id="12988592" author="davsclaus" created="Sun, 30 Jan 2011 14:07:49 +0000"  >&lt;p&gt;Camel 2.6 has been released. Just that we haven&apos;t put out an announcement. You can download it from the links at the release note&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/camel-260-release.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/camel-260-release.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12988593" author="davsclaus" created="Sun, 30 Jan 2011 14:10:25 +0000"  >&lt;p&gt;Based on your patch I have committed an improvement to trunk.&lt;/p&gt;

&lt;p&gt;The path will be stripped of the name when comparing. Also the operations to strip the path caters for mixed separators.&lt;/p&gt;

&lt;p&gt;trunk: 1065278.&lt;/p&gt;</comment>
                            <comment id="12988723" author="mikaelfj" created="Mon, 31 Jan 2011 10:51:23 +0000"  >&lt;p&gt;I made the following small test case:&lt;/p&gt;

&lt;p&gt;    public void testNlstWin() throws Exception {&lt;br/&gt;
        FTPClient ftpClient = new FTPClient();&lt;br/&gt;
        ftpClient.connect(&quot;xxx&quot;, 21);&lt;br/&gt;
        ftpClient.login(&quot;yyy&quot;, &quot;zzz&quot;);&lt;br/&gt;
        System.out.println(ftpClient.getSystemName());&lt;br/&gt;
        String[] names = ftpClient.listNames(&quot;test/rename&quot;);&lt;br/&gt;
        for (String existing : names) &lt;/p&gt;
{
            System.out.println(existing);
        }
&lt;p&gt;        ftpClient.logout();&lt;br/&gt;
        ftpClient.disconnect();&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;The strange thing is, that I get the same result from both windows and unix (runing the test of a windows machine:&lt;/p&gt;

&lt;p&gt;Windows_NT&lt;br/&gt;
test/rename\Test.REN&lt;/p&gt;

&lt;p&gt;UNIX Type: L8 Version: BSD-44&lt;br/&gt;
test/rename/Test.REN&lt;/p&gt;

&lt;p&gt;I.e. both of them contains the directory as part of the returned filename - which I hadn&apos;t expected.&lt;/p&gt;

&lt;p&gt;It might be, that we have only seen the problem on windows servers because this has been the only place where we transfer multiple files to the same destination-name. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469767" name="camel-ftp-patch.txt" size="4800" author="mikaelfj" created="Sun, 30 Jan 2011 11:26:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01vpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8906</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>