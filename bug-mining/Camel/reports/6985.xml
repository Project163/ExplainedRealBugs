<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:09:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21550] camel-aws-sqs - message is getting expired before extender changes the visibility</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21550</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Issue: sqs extender scheduler initial start is set to queues visibility timeout.&#160; when the fifo queues in the application are couple of them it works but when its more it causes this issue.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (visibilityTimeout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; visibilityTimeout &amp;gt; 0) {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; delay = visibilityTimeout;
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; repeatSeconds = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (visibilityTimeout.doubleValue() * 1.5);
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timeoutExtender = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimeoutExtender(repeatSeconds);

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
                    LOG.debug(
                            &lt;span class=&quot;code-quote&quot;&gt;&quot;Scheduled TimeoutExtender task to start after {} delay, and run with {}/{} period/repeat (seconds)&quot;&lt;/span&gt;,
                            delay, delay, repeatSeconds);
                }
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.scheduledFuture
                        = scheduledExecutor.scheduleAtFixedRate(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timeoutExtender, delay, delay, TimeUnit.SECONDS);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;E.g if the visibility is 10sec the extender would start around 10sec and by the time the extender changes the visibility the message&apos;s visibility in the queue would have expired and got removed. And since the extender uses the expired message receipt handle sqs server return ReceiptHandleIsInvalidException but because this exception is supressed sqs client assumes it was successful.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        LOG.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Extending visibility window by {} seconds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; request entries {}&quot;&lt;/span&gt;, repeatSeconds,
                                batchEntries);
                        getEndpoint().getClient().changeMessageVisibilityBatch(request);
                        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Extended visibility window &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; request entries {}&quot;&lt;/span&gt;, batchEntries);
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (MessageNotInflightException | ReceiptHandleIsInvalidException e) {
                        &lt;span class=&quot;code-comment&quot;&gt;// Ignore.
&lt;/span&gt;                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SqsException e) {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e.getMessage()
                                .contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;Message does not exist or is not available &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; visibility timeout change&quot;&lt;/span&gt;)) {
                            &lt;span class=&quot;code-comment&quot;&gt;// Ignore.
&lt;/span&gt;                        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                            logException(e, batchEntries);
                        }
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                        logException(e, batchEntries);
                    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13602240">CAMEL-21550</key>
            <summary>camel-aws-sqs - message is getting expired before extender changes the visibility</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="narsi-nallamilli">Narsi Reddy Nallamilli</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Dec 2024 09:44:01 +0000</created>
                <updated>Mon, 27 Jan 2025 08:01:28 +0000</updated>
                            <resolved>Wed, 18 Dec 2024 10:39:16 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.4.5</fixVersion>
                    <fixVersion>4.8.3</fixVersion>
                    <fixVersion>4.10.0</fixVersion>
                                    <component>camel-aws2-sqs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17905971" author="davsclaus" created="Mon, 16 Dec 2024 09:46:58 +0000"  >&lt;p&gt;Yeah the start should be 1 or something so its starter earlier&lt;/p&gt;</comment>
                            <comment id="17905972" author="JIRAUSER283233" created="Mon, 16 Dec 2024 09:49:40 +0000"  >&lt;p&gt;I see it was change in this commit,&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/9a29ad738c5514d1ea9dc8975b5ab353333eac21#diff-c85e8e2e10450ca6ea23878a310bcfa2901dbdd97e5616c1669f0b04a14fcc80L175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/9a29ad738c5514d1ea9dc8975b5ab353333eac21#diff-c85e8e2e10450ca6ea23878a310bcfa2901dbdd97e5616c1669f0b04a14fcc80L175&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17906060" author="davsclaus" created="Mon, 16 Dec 2024 14:04:04 +0000"  >&lt;p&gt;Thanks, do you want to help fix this by sending a code fix as a PR ?&lt;/p&gt;</comment>
                            <comment id="17906061" author="JIRAUSER283233" created="Mon, 16 Dec 2024 14:07:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; Sure, will do&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13544926">CAMEL-19656</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13606336">CAMEL-21659</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t58w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>