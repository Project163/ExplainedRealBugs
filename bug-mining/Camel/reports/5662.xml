<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:46:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12472] Downloading a large file with streamDownload and stepwise hangs </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12472</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;b&gt;Downloading a file exceeding certain, system-dependent size with streamDownload and stepwise options turned on hangs and causes timeout.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I prepared a test which triggers the error. The patch file is pretty big, as I had to make a file enough big to make the timeout happen. Basing on my predictions, the size of the file triggering the error depends on FTP configuration and Java caching policy (no proof available yet). Working with plain Vsftpd server even 1mb files triggered timeouts. In the test environment the limit on my desktop is 5 mb. If the test passes, please make the file bigger.&lt;/p&gt;

&lt;p&gt;My intepretation of the problem:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start downloading a file with size exceeding InputStream cache (on my pc approx. 1mb is the limit).&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/camel/blob/dc6caa696255240a2a27c3bf229fc3aac9014401/components/camel-ftp/src/main/java/org/apache/camel/component/file/remote/FtpOperations.java#L423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FtpOperations.java:373&lt;/a&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
InputStream is = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.client.retrieveFileStream(remoteName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&#160;The server responds 150 and opens data connection.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[user_ftp] FTP response: Client &lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;150 Opening BINARY mode data connection &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; x (1048576 bytes).&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;The data connection does not end because InputStream is waiting for reads and it has not cached whole file. No &quot;226 Transfer complete&quot; response from server.&lt;/li&gt;
	&lt;li&gt;Try to change directory as stepwise is turned on.&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/camel/blob/dc6caa696255240a2a27c3bf229fc3aac9014401/components/camel-ftp/src/main/java/org/apache/camel/component/file/remote/FtpOperations.java#L443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FtpOperations.java:387&lt;/a&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.changeCurrentDirectory(currentDir);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Camel hangs as the server is still in the data connection and we are waiting for response from CWD command.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;Camel versions: 2.17.0 and 2.21.0&lt;/li&gt;
	&lt;li&gt;Ftp servers: plain vsftpd server, org.apache.ftpserver as a mock, Camel test environment ftp.&lt;/li&gt;
	&lt;li&gt;Files: depending on configuration from 1mb to 5mb file is vital for error to happen.&#160;&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13155669">CAMEL-12472</key>
            <summary>Downloading a large file with streamDownload and stepwise hangs </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="karol.koltun">Karol Koltun</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Apr 2018 09:53:09 +0000</created>
                <updated>Tue, 23 Mar 2021 12:48:51 +0000</updated>
                            <resolved>Tue, 23 Mar 2021 12:48:51 +0000</resolved>
                                    <version>2.21.0</version>
                                    <fixVersion>3.10.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16588846" author="davsclaus" created="Wed, 22 Aug 2018 13:33:09 +0000"  >&lt;p&gt;Okay thanks for reporting. I think this is a corner-case or limitations when you use streamDownload as then as you say cannot potentially do other FTP opertaions afterwards, until you have read the data stream. &lt;/p&gt;

&lt;p&gt;Anyone got thoughts if there is something we can do, or if not we can add some notes in the documentation about this issue&lt;/p&gt;</comment>
                            <comment id="17307028" author="davsclaus" created="Tue, 23 Mar 2021 12:48:48 +0000"  >&lt;p&gt;This has been fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-14506&quot; title=&quot;came-ftp - streamDownload=true and stepwise=true for larger files could cause deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-14506&quot;&gt;&lt;del&gt;CAMEL-14506&lt;/del&gt;&lt;/a&gt; where we does not allow to use stepwise with stream download.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13283663">CAMEL-14506</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12920989" name="0001-FtpSimpleConsumeStreamingStepwiseTest.patch" size="6279024" author="karol.koltun" created="Fri, 27 Apr 2018 09:42:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3t3lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>