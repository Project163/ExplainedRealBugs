<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:27:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10165] DefaultCxfMessageMapper.getBasePath creates a incorrect http path</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10165</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;in DefaultCxfMessageMapper.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getBasePath(Exchange camelExchange) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; answer = camelExchange.getIn().getHeader(Exchange.HTTP_BASE_URI, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (answer == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            answer = camelExchange.getFromEndpoint().getEndpointUri();
        }        
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;camelExchange.getFromEndpoint().getEndpointUri()&lt;/p&gt;

&lt;p&gt;in 2.14 returns a valid http URL for the jetty endpoint...]&lt;/p&gt;

&lt;p&gt;meanwhile in 2.17 it return a camel url that includes the scheme and it breaks the semantics of this method. I had to change the method to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getBasePath(Exchange camelExchange) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; answer = camelExchange.getIn().getHeader(Exchange.HTTP_BASE_URI, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (answer == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            Endpoint fromEndpoint = camelExchange.getFromEndpoint();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fromEndpoint &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HttpCommonEndpoint) {
              &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                URI u = ((HttpCommonEndpoint) fromEndpoint). getHttpUri();
                answer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(u.getScheme(), u.getUserInfo(), u.getHost(), u.getPort(), u.getPath(),
                        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toString();
              } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException ex) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(ex);
              }
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not sure this is the best way to deal with this, but it works...&lt;/p&gt;





</description>
                <environment></environment>
        <key id="12991231">CAMEL-10165</key>
            <summary>DefaultCxfMessageMapper.getBasePath creates a incorrect http path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="zolyfarkas">Zoltan Farkas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2016 19:47:22 +0000</created>
                <updated>Thu, 11 Jan 2018 14:25:30 +0000</updated>
                            <resolved>Thu, 11 Jan 2018 14:25:30 +0000</resolved>
                                    <version>2.17.2</version>
                                    <fixVersion>2.19.5</fixVersion>
                    <fixVersion>2.20.2</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15391863" author="davsclaus" created="Mon, 25 Jul 2016 13:14:34 +0000"  >&lt;p&gt;And what are you using that getBasePath method for ?&lt;/p&gt;

&lt;p&gt;Are you doing some custom CXF / Camel code or in what situation do you have this problem?&lt;/p&gt;</comment>
                            <comment id="15398208" author="zolyfarkas" created="Thu, 28 Jul 2016 21:03:13 +0000"  >&lt;p&gt;I do not use this method directly, it is being used in: DefaultCxfMessageMapper.createCxfMessageFromCamelExchange:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        ....
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; basePath = getBasePath(camelExchange);
        ....

        answer.put(org.apache.cxf.message.Message.BASE_PATH, basePath);
        ....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so the CXF message is created with a incorrect base path and the message does not find its destination....&lt;/p&gt;
</comment>
                            <comment id="15399373" author="davsclaus" created="Fri, 29 Jul 2016 13:59:48 +0000"  >&lt;p&gt;Do you have an unit test or sample application that reproduces this issue?&lt;/p&gt;</comment>
                            <comment id="15408293" author="zolyfarkas" created="Thu, 4 Aug 2016 18:44:28 +0000"  >
&lt;p&gt;basically all routes from jetty 9 to cxf 3.1.5 like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//{{http.host}}:{{http.port}}/somePath?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/span&gt;        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfbean:someJaxRSService&quot;&lt;/span&gt;);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;were was not finding destination anymore after the 2.17.2 upgrade (from 2.14.4). (404)&lt;br/&gt;
All unit tests that were testing routes like above were failing, however they are unfortunately proprietary code coupled to a lot of non camel stuff...&lt;/p&gt;

&lt;p&gt;if I would be to write a unit test to reproduce this that would depend solely on camel, camel-jetty9 and camel-cxf what would be the right place to put it in?&lt;/p&gt;

&lt;p&gt;I patched the getBaseBath method in DefaultCxfMessageMapper to get past this issue for now.&lt;/p&gt;</comment>
                            <comment id="16320443" author="kmackowiak" created="Wed, 10 Jan 2018 15:33:14 +0000"  >&lt;p&gt;I experienced the same issue when upgrading from Camel 2.15.2 to 2.16.0. The bug is present also in latest version 2.20.1 . Here is a JUnit test that reproduces it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Camel10165BugTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PORT1 = CXFTestSupport.getPort(&lt;span class=&quot;code-quote&quot;&gt;&quot;Camel10165BugTest.1&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-comment&quot;&gt;// NOTE: fails with camel 2.20.1, but passes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; camel 2.15.2
&lt;/span&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCallServiceWithBasePath() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; request = &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; response = template.requestBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:&quot;&lt;/span&gt; + PORT1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;/basePath/echo&quot;&lt;/span&gt;, request, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
&lt;/span&gt;        assertEquals(request, response);
    }

    &lt;span class=&quot;code-comment&quot;&gt;// NOTE: passes with camel 2.20.1 and camel 2.15.2
&lt;/span&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCallServiceWithoutBasePath() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; request = &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; response = template.requestBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:&quot;&lt;/span&gt; + PORT1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;/echo&quot;&lt;/span&gt;, request, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
&lt;/span&gt;        assertEquals(request, response);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RoutesBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:&quot;&lt;/span&gt; + PORT1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;/?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/span&gt;                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfbean:echoService&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:&quot;&lt;/span&gt; + PORT1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;/basePath/?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/span&gt;                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfbean:echoService&quot;&lt;/span&gt;);
            }
        };
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; JndiRegistry createRegistry() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        JndiRegistry registry = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createRegistry();
        registry.bind(&lt;span class=&quot;code-quote&quot;&gt;&quot;echoService&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EchoService());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; registry;
    }

    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;echo&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;EchoService {
        @POST
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; echo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; request) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; request;
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16320446" author="kmackowiak" created="Wed, 10 Jan 2018 15:35:20 +0000"  >&lt;p&gt;I&apos;ve attached a patch for version 2.20.x which contains a test and fix for this bug.&lt;/p&gt;</comment>
                            <comment id="16322286" author="davsclaus" created="Thu, 11 Jan 2018 14:25:30 +0000"  >&lt;p&gt;Thanks for the patch. I added a fix for https as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12905488" name="CAMEL_10165_test_and_bugfix.patch" size="3546" author="kmackowiak" created="Wed, 10 Jan 2018 15:33:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31a3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>