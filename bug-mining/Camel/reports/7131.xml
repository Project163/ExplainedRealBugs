<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:11:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22073] camel-http - NTLM authentication doesn&apos;t work over http</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22073</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;It appears that NTLM authentication is not functioning correctly in Apache Camel 4 (version 4.10.4) when using the &lt;tt&gt;http&lt;/tt&gt; component.&lt;/p&gt;

&lt;p&gt;Using the exact same credentials and request details, the call succeeds when made via the &lt;tt&gt;curl&lt;/tt&gt; command with the &lt;tt&gt;--ntlm&lt;/tt&gt; flag, but fails when executed through Camel.&lt;/p&gt;

&lt;p&gt;As shown in the attached Wireshark capture, the &lt;tt&gt;curl&lt;/tt&gt; request correctly initiates the NTLM handshake, including the &lt;tt&gt;Authorization: NTLM ...&lt;/tt&gt; header, whereas the Apache Camel request does not send the Authorization header and fails to trigger a challenge-response flow.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Apache Camel 4 (4.10.4) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//exacttest.myserver.local:8020/Services/Exact.Entity.REST.EG/?authMethod=NTLM&amp;amp;amp;authUsername=RAW(usr_exact1)&amp;amp;amp;authPassword=RAW(blabla)&amp;amp;amp;authDomain=RAW(myserver.local)&amp;amp;amp;maxTotalConnections=20&amp;amp;amp;connectionsPerRoute=2&amp;amp;amp;connectTimeout=180000&amp;amp;amp;soTimeout=180000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Curl (8.7.1) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl --ntlm --user myserver.local\\usr_exact1:blabla &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//exacttest.myserver.local:8020/services/Exact.Entity.REST.EG/&quot;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13618229">CAMEL-22073</key>
            <summary>camel-http - NTLM authentication doesn&apos;t work over http</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="brunovg">Bruno Gon&#231;alves</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 May 2025 15:41:15 +0000</created>
                <updated>Sat, 24 May 2025 06:38:41 +0000</updated>
                            <resolved>Sat, 24 May 2025 06:38:41 +0000</resolved>
                                    <version>4.10.4</version>
                                    <fixVersion>4.10.5</fixVersion>
                    <fixVersion>4.13.0</fixVersion>
                                    <component>camel-http</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17951809" author="ancosen" created="Thu, 15 May 2025 15:52:28 +0000"  >&lt;p&gt;Did you test another 4.10.x release or are you switching from older Camel versions to 4.10.4?&lt;/p&gt;</comment>
                            <comment id="17951813" author="JIRAUSER303582" created="Thu, 15 May 2025 16:06:47 +0000"  >&lt;p&gt;This was working on a older Camel 2 version (2.23.4).&lt;/p&gt;

&lt;p&gt;I didn&apos;t test on other 4.10.x releases.&lt;/p&gt;</comment>
                            <comment id="17951822" author="davsclaus" created="Thu, 15 May 2025 16:28:24 +0000"  >&lt;p&gt;This is a big upgrade and the http client is also a big upgrade. So you are welcome to dive into apache http client and camel code to see if you find out more. And if you find something report back, and if there is some code to be fixed or improved, then PR or patch file is welcome.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://camel.apache.org/community/support/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/community/support/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17951839" author="JIRAUSER303582" created="Thu, 15 May 2025 17:26:25 +0000"  >&lt;p&gt;It works on 4.8.7, and stopped working on 4.9.0.&lt;br/&gt;
You can find in attachment a reproducer (with Camel 4.9.0). If you switch to 4.8.7 it works.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13076527/13076527_http-ntlm-reproducer.tar&quot; title=&quot;http-ntlm-reproducer.tar attached to CAMEL-22073&quot;&gt;http-ntlm-reproducer.tar&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17951843" author="skin27" created="Thu, 15 May 2025 17:44:25 +0000"  >&lt;p&gt;Note that in Camel 4.9.0 the Apache HttpClient was upgraded from 5.2.1 to 5.4.1:&lt;/p&gt;

&lt;p&gt;From the 5.3 release notes of Apache HTTP Client:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
The 5.3 release series introduces support &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the Bearer authentication scheme (RFC 6750) and
deprecates NTLM and GSS-based experimental authentication schemes in favor of Basic / Bearer
authentication with TLS.

Notable changes and features included in the 5.3 series:

* Introduction of the Bearer authentication scheme.

* Deprecation of the NTLM authentication scheme.

* Deprecation of the GSS-based experimental authentication schemes.

* Support &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; load distribution across multiple proxies. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Deprecation doesn&apos;t mean removal of course, but it&apos;s &#160;suspicious.&lt;/p&gt;

&lt;p&gt;Probably good to remove this option in the HTTP component, or at least mark it as deprecated.&lt;/p&gt;

&lt;p&gt;Also the release notes state that:&lt;/p&gt;

&lt;p&gt;&quot;deprecates NTLM and GSS-based experimental authentication schemes in favor of Basic / Bearer&quot;&lt;/p&gt;

&lt;p&gt;The current &lt;b&gt;authMethod&lt;/b&gt; are &quot;Basic, Digest or NTLM&quot;. Maybe change this to &quot;Basic, Digest or Bearer&quot;?&lt;/p&gt;</comment>
                            <comment id="17952021" author="davsclaus" created="Fri, 16 May 2025 07:07:38 +0000"  >&lt;p&gt;Yes its being marked as deprecated in 4.10.x and 4.12 onwards.&lt;/p&gt;</comment>
                            <comment id="17952023" author="davsclaus" created="Fri, 16 May 2025 07:08:36 +0000"  >&lt;p&gt;I dont think we have added Bearer or unit test or anything like that. You are welcome to help with that.&lt;/p&gt;</comment>
                            <comment id="17952054" author="skin27" created="Fri, 16 May 2025 09:35:33 +0000"  >&lt;p&gt;&quot;Yes its being marked as deprecated in 4.10.x and 4.12 onwards.&quot;&lt;/p&gt;

&lt;p&gt;Do you mean it&apos;s marked deprecated in the code? Because in the documentation (&lt;a href=&quot;https://camel.apache.org/components/next/http-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/next/http-component.html&lt;/a&gt;) I don&apos;t see it deprecated. Shall I make a note about it.&lt;/p&gt;</comment>
                            <comment id="17952055" author="ancosen" created="Fri, 16 May 2025 09:37:28 +0000"  >&lt;p&gt;The website still needs to be deployed with the updated content, but it is ready.&lt;/p&gt;</comment>
                            <comment id="17952058" author="skin27" created="Fri, 16 May 2025 09:43:14 +0000"  >&lt;p&gt;OK, great&lt;/p&gt;</comment>
                            <comment id="17953371" author="davsclaus" created="Thu, 22 May 2025 08:45:09 +0000"  >&lt;p&gt;You need to turn on&#160;authenticationPreemptive=true and then you can try the attached 4.10.5-SNAPSHOT jar that has a potential fix.&lt;/p&gt;</comment>
                            <comment id="17953662" author="JIRAUSER303582" created="Fri, 23 May 2025 08:50:19 +0000"  >&lt;p&gt;I got the same &lt;b&gt;401 Unauthorized&lt;/b&gt; error back.&lt;/p&gt;

&lt;p&gt;I used the same http-ntlm-reproducer, with the following changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;replaced camel-http 4.10.4 dependency to camel-http-4.10.5-SNAPSHOT.jar&lt;/li&gt;
	&lt;li&gt;added org.apache.httpcomponents.core5:httpcore5:5.3.4 dependency&lt;/li&gt;
	&lt;li&gt;added org.apache.httpcomponents.client5:httpclient5:5.4.4 dependency&lt;/li&gt;
	&lt;li&gt;added org.slf4j:slf4j-simple:1.7.36 dependency&lt;/li&gt;
	&lt;li&gt;added authenticationPreemptive param with true on it&apos;s value&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17953664" author="ancosen" created="Fri, 23 May 2025 08:54:40 +0000"  >&lt;p&gt;You need to fully build 4.10.5-SNAPSHOT on your machine.&lt;/p&gt;

&lt;p&gt;The last build of 4.10.5-SNAPSHOT on Apache Snapshots repositories is from 16 May, it doesn&apos;t contain the fix.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/camel/camel-http/4.10.5-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/camel/camel-http/4.10.5-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So build locally the 4.10.5-SNAPSHOT, by using the 4.10.x branch and try again.&lt;/p&gt;</comment>
                            <comment id="17953667" author="JIRAUSER303582" created="Fri, 23 May 2025 09:38:16 +0000"  >&lt;p&gt;I pulled the 4.10.x branch, and I built successfully camel-http component locally.&lt;/p&gt;

&lt;p&gt;Still the same error, &lt;b&gt;401 Unauthorized&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="17953669" author="davsclaus" created="Fri, 23 May 2025 09:41:10 +0000"  >&lt;p&gt;Thanks for testing. But since NTLM is deprecated and its an old technology. I am sorry but I think you need to dive into this yourself or get outside help.&lt;/p&gt;

&lt;p&gt;You can try to build something with http client directly and see if you can get its NTLM to work and then you are welcome to share that as that can help find out easier if something can be changed in camel-http to fix this.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17953690" author="davsclaus" created="Fri, 23 May 2025 12:36:32 +0000"  >&lt;p&gt;Comparing the camel-http code 4.8.7 vs 4.12.0 etc does not reveal anything that smells like the problem. So I think the issue is more in http-client and its changes between those 2 versions 5.2 vs 5.4&lt;/p&gt;</comment>
                            <comment id="17953694" author="davsclaus" created="Fri, 23 May 2025 13:05:14 +0000"  >&lt;p&gt;Okay so it looks like http-client 5.4 does not come with NTLM auth as default and I have some new code in camel-http that adds this.&lt;/p&gt;

&lt;p&gt;Also&#160;authenticationPreemptive=true should not be needed but it was a hope that you could see something in the wireshark or something that indicates camel-http would include NTLM auth in the initial requests.&lt;/p&gt;

&lt;p&gt;Anyway try with rebuiding 4.10.x from code or the new attached JAR when I rebuild it later&lt;/p&gt;</comment>
                            <comment id="17953698" author="JIRAUSER303582" created="Fri, 23 May 2025 13:24:02 +0000"  >&lt;p&gt;Still nothing..&lt;br/&gt;
The second call never occurs to do the NTLM negotiate.&lt;br/&gt;
I tried with and without the authenticationPreemptive param.&lt;/p&gt;</comment>
                            <comment id="17953699" author="JIRAUSER303582" created="Fri, 23 May 2025 13:27:24 +0000"  >&lt;p&gt;I also added logs (locally) on those changes and compiled myself, just to be sure that I was using the latest changes.&lt;/p&gt;</comment>
                            <comment id="17953759" author="JIRAUSER303582" created="Fri, 23 May 2025 18:15:19 +0000"  >&lt;p&gt;Ok, I found a solution that works for me.&lt;br/&gt;
I added the following change on configureHttpClient method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configureHttpClient(HttpClientBuilder clientBuilder) {
    Credentials defaultcreds;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (domain != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        defaultcreds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NTCredentials(username, password, host, domain);
        &lt;span class=&quot;code-comment&quot;&gt;// NTLM is not included by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; so we need to rebuild the registry to include NTLM
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; copy = RegistryBuilder.&amp;lt;AuthSchemeFactory&amp;gt; create()
                .register(StandardAuthScheme.BASIC, BasicSchemeFactory.INSTANCE)
                .register(StandardAuthScheme.DIGEST, DigestSchemeFactory.INSTANCE)
                .register(StandardAuthScheme.BEARER, BearerSchemeFactory.INSTANCE)
                .register(StandardAuthScheme.NTLM, NTLMSchemeFactory.INSTANCE)
                .build();

        &lt;span class=&quot;code-comment&quot;&gt;// Set NTLM as preferred scheme
&lt;/span&gt;        RequestConfig requestConfig = RequestConfig.custom()
                .setTargetPreferredAuthSchemes(List.of(StandardAuthScheme.NTLM))
                .build();

        clientBuilder
                .setDefaultAuthSchemeRegistry(copy)
                .setDefaultRequestConfig(requestConfig);

    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        defaultcreds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UsernamePasswordCredentials(username, password);
    }
    clientBuilder.setDefaultCredentialsProvider(credentialsHelper
            .getCredentialsProvider(host, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, defaultcreds));
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17953767" author="JIRAUSER303582" created="Fri, 23 May 2025 18:53:27 +0000"  >&lt;p&gt;Created a PR for this - &lt;a href=&quot;https://github.com/apache/camel/pull/18170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/18170&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17953801" author="davsclaus" created="Sat, 24 May 2025 06:38:41 +0000"  >&lt;p&gt;Thanks for the PR that help fix this&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13618309">CAMEL-22075</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13618874">CAMEL-22101</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13076668" name="Screenshot 2025-05-23 at 14.21.44.png" size="282385" author="brunovg" created="Fri, 23 May 2025 13:22:06 +0000"/>
                            <attachment id="13076667" name="camel-http-4.10.5-SNAPSHOT.jar" size="163930" author="davsclaus" created="Fri, 23 May 2025 13:15:56 +0000"/>
                            <attachment id="13076527" name="http-ntlm-reproducer.tar" size="156672" author="brunovg" created="Thu, 15 May 2025 17:25:33 +0000"/>
                            <attachment id="13076525" name="wireshark_http_ntlm_camel4.png" size="352586" author="brunovg" created="Thu, 15 May 2025 15:39:01 +0000"/>
                            <attachment id="13076524" name="wireshark_http_ntlm_curl.png" size="647886" author="brunovg" created="Thu, 15 May 2025 15:39:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vvds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>