<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:51:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17472] camel-smpp: Consumer reconnect no longer works after updating to 3.14.0</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17472</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We using camel-smpp with Spring Boot.&lt;/p&gt;

&lt;p&gt;After updating the version from 3.13.0 to 3.14.0 reconnecting (at least for the consumer, do not know if the producer is also affected) does not seem to work anymore.&lt;/p&gt;

&lt;p&gt;We use the default values for maxReconnect and initialReconnectDelay. We set reconnectDelay to 60000.&lt;/p&gt;

&lt;p&gt;With version 3.13.0 and before camel tried to reconnect for a long time. With camel 3.14.0 there does not seem to be any reconnect attempts:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Jan 11, 2022 @ 04:20:11.499 - SmppConsumer - Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - trying to reconnect...
&lt;/span&gt;Jan 11, 2022 @ 04:20:16.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
Jan 11, 2022 @ 04:20:17.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
Jan 11, 2022 @ 04:20:18.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
Jan 11, 2022 @ 04:20:19.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
Jan 11, 2022 @ 04:20:20.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
Jan 11, 2022 @ 04:20:21.516 - BackgroundTask - The task smpp-reconnect does not have more budget to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; running
... (endless repeat of the last log message)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess this was caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17121&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-17121&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13421997">CAMEL-17472</key>
            <summary>camel-smpp: Consumer reconnect no longer works after updating to 3.14.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="pascalschumacher">Pascal Schumacher</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jan 2022 14:42:41 +0000</created>
                <updated>Thu, 13 Jan 2022 16:26:22 +0000</updated>
                            <resolved>Thu, 13 Jan 2022 16:04:52 +0000</resolved>
                                    <version>3.14.0</version>
                                    <fixVersion>3.14.1</fixVersion>
                    <fixVersion>3.15.0</fixVersion>
                                    <component>camel-smpp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17472793" author="davsclaus" created="Tue, 11 Jan 2022 14:49:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt; ^^^&lt;/p&gt;</comment>
                            <comment id="17472831" author="orpiske" created="Tue, 11 Jan 2022 15:33:23 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="17472859" author="orpiske" created="Tue, 11 Jan 2022 16:17:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pascalschumacher&quot; class=&quot;user-hover&quot; rel=&quot;pascalschumacher&quot;&gt;pascalschumacher&lt;/a&gt; are you able to give it a try on this proposed fix, please? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/6722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6722&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17472962" author="pascalschumacher" created="Tue, 11 Jan 2022 17:20:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt; Thank you very much for looking into this.&lt;/p&gt;

&lt;p&gt;I tried your fix, but it does not seem to be enough to fix the issue.&lt;/p&gt;

&lt;p&gt;With the fix i get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-11 17:50:19.482  WARN 17128 --- [Sender-12511ac2] o.a.camel.component.smpp.SmppConsumer    : Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYYY - trying to reconnect...
&lt;/span&gt;2022-01-11 17:50:19.486  WARN 17128 --- [Sender-12511ac2] o.a.camel.support.task.BackgroundTask    : Interrupted &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the repeatable task to execute
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;no further reconnection attempts/log messages.&lt;/p&gt;

&lt;p&gt;For comparision the log with camel 3.13.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-11 18:14:29.203  WARN 13456 --- [Sender-56f2f152] o.a.camel.component.smpp.SmppConsumer    : Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - trying to reconnect...
&lt;/span&gt;2022-01-11 18:14:29.204  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] o.a.camel.component.smpp.SmppConsumer    : Schedule reconnect after 5000 millis
2022-01-11 18:14:34.207  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] o.a.camel.component.smpp.SmppConsumer    : Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - attempt #1
&lt;/span&gt;2022-01-11 18:14:34.218  WARN 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] o.a.camel.component.smpp.SmppConsumer    : Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-11 18:15:34.219  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] o.a.camel.component.smpp.SmppConsumer    : Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - attempt #2
&lt;/span&gt;2022-01-11 18:15:34.254  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] org.jsmpp.session.SMPPSession            : Connected from port 62124 to /XXX:YYY
2022-01-11 18:15:34.255  INFO 13456 --- [Worker-52477284] org.jsmpp.session.SMPPSession            : Starting PDUReaderWorker
2022-01-11 18:15:34.390  INFO 13456 --- [ool-10-thread-1] org.jsmpp.session.SMPPSession            : Changing processor degree to 1
2022-01-11 18:15:34.390  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] org.jsmpp.bean.OptionalParameters        : Optional Parameter Tag &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.jsmpp.bean.OptionalParameter$Sc_interface_version not found
2022-01-11 18:15:34.391  INFO 13456 --- [      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-36] o.a.camel.component.smpp.SmppConsumer    : Reconnected to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17472997" author="orpiske" created="Tue, 11 Jan 2022 18:09:54 +0000"  >&lt;p&gt;Happy to help!&lt;/p&gt;

&lt;p&gt;That&apos;s very strange. I have just tested the patch using the manual reconnect test and I got this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-11 19:04:58,171 [main &#160; &#160; &#160; &#160; &#160; ] DEBUG SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Connecting to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775...
&lt;/span&gt;2022-01-11 19:04:58,186 [main &#160; &#160; &#160; &#160; &#160; ] INFO &#160;SMPPSession &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;- Connected from port 37744 to localhost/127.0.0.1:2775
2022-01-11 19:04:58,188 [Worker-fe0d7ef6] INFO &#160;SMPPSession &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;- Starting PDUReaderWorker
2022-01-11 19:05:08,139 [Worker-fe0d7ef6] INFO &#160;SMPPSession &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;- Reading PDU session fe0d7ef6 in state OPEN: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2022-01-11 19:05:08,142 [Worker-fe0d7ef6] WARN &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775 - trying to reconnect...
&lt;/span&gt;2022-01-11 19:05:13,149 [ smpp-reconnect] INFO &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:13,152 [ smpp-reconnect] WARN &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:14,149 [ smpp-reconnect] INFO &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:14,150 [ smpp-reconnect] WARN &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:15,149 [ smpp-reconnect] INFO &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:15,150 [ smpp-reconnect] WARN &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:16,149 [ smpp-reconnect] INFO &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:16,150 [ smpp-reconnect] WARN &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:17,149 [ smpp-reconnect] INFO &#160;SmppConsumer &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; - Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//smppclient@localhost:2775
&lt;/span&gt;2022-01-11 19:05:17,149 [ smpp-reconnect] INFO &#160;SMPPSession &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;- Connected from port 37754 to localhost/127.0.0.1:2775
2022-01-11 19:05:17,150 [Worker-eca5d2f0] INFO &#160;SMPPSession &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;- Starting PDUReaderWorker
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Is there something else I can do to reproduce the configuration you have?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;1. &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-smpp/src/test/java/org/apache/camel/component/smpp/integration/SmppConsumerReconnectManualIT.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/components/camel-smpp/src/test/java/org/apache/camel/component/smpp/integration/SmppConsumerReconnectManualIT.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17473103" author="pascalschumacher" created="Tue, 11 Jan 2022 19:08:30 +0000"  >&lt;p&gt;I use a remote smpp server for testing. To simulate a disconnect I cut the network connection.&lt;/p&gt;

&lt;p&gt;latch.await() at &lt;a href=&quot;https://github.com/apache/camel/blob/main/core/camel-support/src/main/java/org/apache/camel/support/task/BackgroundTask.java#L154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/core/camel-support/src/main/java/org/apache/camel/support/task/BackgroundTask.java#L154&lt;/a&gt; throws an InterruptedException when I am testing. No idea why or how debug this further (the InterrupetException does not contain any useful information).&lt;/p&gt;

&lt;p&gt;I guess it would work for me too if I were to use a local smpp server and shut it down to simulate disconnect.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit:&lt;/p&gt;

&lt;p&gt;I set a breakpoint at the entry of Thread#interrupt. I hope this is the right stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Daemon &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; [EnquireLinkSender-0a4b4b93] (Suspended (entry into method interrupt in &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;))	
	owns: SMPPSessionContext  (id=192)	
	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupt() line: 988	
	ThreadPoolExecutor$Worker.interruptIfStarted() line: 670	
	RejectableScheduledThreadPoolExecutor(ThreadPoolExecutor).interruptWorkers() line: 769	
	RejectableScheduledThreadPoolExecutor(ThreadPoolExecutor).shutdownNow() line: 1417	
	RejectableScheduledThreadPoolExecutor(ScheduledThreadPoolExecutor).shutdownNow() line: 870	
	SizedScheduledExecutorService.shutdownNow() line: 241	
	BackgroundTask.waitForTaskCompletion(CountDownLatch, ScheduledExecutorService) line: 173	
	BackgroundTask.run(BooleanSupplier) line: 147	
	SmppConsumer.reconnect(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) line: 172	
	SmppConsumer.access$300(SmppConsumer, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) line: 48	
	SmppConsumer$1.onStateChange(SessionState, SessionState, Session) line: 76	
	SMPPSessionContext(AbstractSessionContext).fireStateChanged(SessionState, SessionState, Session) line: 85	
	SMPPSessionContext.changeState(SessionState) line: 61	
	SMPPSessionContext(AbstractSessionContext).close() line: 66	
	SMPPSession(AbstractSession).close() line: 257	
	AbstractSession$EnquireLinkSender.run() line: 503	
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17473119" author="orpiske" created="Tue, 11 Jan 2022 19:40:12 +0000"  >&lt;p&gt;Thank you, that helps. While I go over this, I have updated the PR with more logging. This should give some additional hints. If you could take a moment to try that patch, it would be very helpful.&lt;/p&gt;</comment>
                            <comment id="17473131" author="orpiske" created="Tue, 11 Jan 2022 19:44:57 +0000"  >&lt;p&gt;BTW: I think the timeout of the&#160;awaitTermination is too low and it is causing this, but I want to rule out another possibility first.&lt;/p&gt;</comment>
                            <comment id="17474403" author="pascalschumacher" created="Wed, 12 Jan 2022 09:53:37 +0000"  >&lt;p&gt;Thanks, I test with the new pr later today.&lt;/p&gt;</comment>
                            <comment id="17474452" author="pascalschumacher" created="Wed, 12 Jan 2022 11:14:46 +0000"  >&lt;p&gt;Log with the updated pull request:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-12 12:07:44.953  INFO 14452 --- [MSNotifications] o.a.camel.component.smpp.SmppConsumer    : Connected to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-12 12:09:04.145  INFO 14452 --- [Worker-1e061096] org.jsmpp.session.SMPPSession            : Reading PDU session 1e061096 in state BOUND_RX: Connection reset
2022-01-12 12:09:04.145 ERROR 14452 --- [Sender-1e061096] org.jsmpp.session.AbstractSession        : Response timeout on enquireLink

org.jsmpp.extra.ResponseTimeoutException: No response after waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60000 millis when executing enquire_link with session 1e061096 and sequence_number 2
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:323)
	at org.jsmpp.session.AbstractSession.sendEnquireLink(AbstractSession.java:369)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:500)
Caused by: org.jsmpp.extra.ResponseTimeoutException: No response after 60000 millis
	at org.jsmpp.extra.PendingResponse.waitDone(PendingResponse.java:118)
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:317)
	... 2 common frames omitted

2022-01-12 12:09:04.146  WARN 14452 --- [Sender-1e061096] o.a.camel.component.smpp.SmppConsumer    : Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - trying to reconnect...
&lt;/span&gt;2022-01-12 12:09:04.150  WARN 14452 --- [Sender-1e061096] o.a.camel.support.task.BackgroundTask    : Interrupted &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the repeatable task to execute: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

java.lang.InterruptedException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1048)
	at java.base/java.util.concurrent.CountDownLatch.await(CountDownLatch.java:230)
	at org.apache.camel.support.task.BackgroundTask.waitForTaskCompletion(BackgroundTask.java:154)
	at org.apache.camel.support.task.BackgroundTask.run(BackgroundTask.java:147)
	at org.apache.camel.component.smpp.SmppConsumer.reconnect(SmppConsumer.java:178)
	at org.apache.camel.component.smpp.SmppConsumer.access$300(SmppConsumer.java:48)
	at org.apache.camel.component.smpp.SmppConsumer$1.onStateChange(SmppConsumer.java:76)
	at org.jsmpp.session.AbstractSessionContext.fireStateChanged(AbstractSessionContext.java:85)
	at org.jsmpp.session.SMPPSessionContext.changeState(SMPPSessionContext.java:61)
	at org.jsmpp.session.AbstractSessionContext.close(AbstractSessionContext.java:66)
	at org.jsmpp.session.AbstractSession.close(AbstractSession.java:257)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:503)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Edit:&lt;br/&gt;
I have been testing with the pull request applied on top of the camel-3.14.x branch.&lt;/p&gt;</comment>
                            <comment id="17474524" author="orpiske" created="Wed, 12 Jan 2022 13:33:47 +0000"  >&lt;p&gt;Thanks. I am not sure if I nailed it yet, but I have pushed a few more changes.&lt;/p&gt;</comment>
                            <comment id="17474668" author="pascalschumacher" created="Wed, 12 Jan 2022 16:24:28 +0000"  >&lt;p&gt;Thanks, with the new pull request I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-12 17:15:08.433  INFO 10968 --- [MSNotifications] o.a.camel.component.smpp.SmppConsumer    : Connected to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-12 17:16:27.633  INFO 10968 --- [Worker-3ad83cd4] org.jsmpp.session.SMPPSession            : Reading PDU session 3ad83cd4 in state BOUND_RX: Connection reset
2022-01-12 17:16:27.633 ERROR 10968 --- [Sender-3ad83cd4] org.jsmpp.session.AbstractSession        : Response timeout on enquireLink

org.jsmpp.extra.ResponseTimeoutException: No response after waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60000 millis when executing enquire_link with session 3ad83cd4 and sequence_number 2
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:323)
	at org.jsmpp.session.AbstractSession.sendEnquireLink(AbstractSession.java:369)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:500)
Caused by: org.jsmpp.extra.ResponseTimeoutException: No response after 60000 millis
	at org.jsmpp.extra.PendingResponse.waitDone(PendingResponse.java:118)
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:317)
	... 2 common frames omitted

2022-01-12 17:16:27.633  WARN 10968 --- [Sender-3ad83cd4] o.a.camel.component.smpp.SmppConsumer    : Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - trying to reconnect...
&lt;/span&gt;2022-01-12 17:16:27.639  WARN 10968 --- [Sender-3ad83cd4] o.a.camel.support.task.BackgroundTask    : Interrupted &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the repeatable task to execute: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

java.lang.InterruptedException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1048)
	at java.base/java.util.concurrent.CountDownLatch.await(CountDownLatch.java:230)
	at org.apache.camel.support.task.BackgroundTask.waitForTaskCompletion(BackgroundTask.java:155)
	at org.apache.camel.support.task.BackgroundTask.run(BackgroundTask.java:148)
	at org.apache.camel.component.smpp.SmppConsumer.reconnect(SmppConsumer.java:182)
	at org.apache.camel.component.smpp.SmppConsumer.access$300(SmppConsumer.java:48)
	at org.apache.camel.component.smpp.SmppConsumer$1.onStateChange(SmppConsumer.java:76)
	at org.jsmpp.session.AbstractSessionContext.fireStateChanged(AbstractSessionContext.java:85)
	at org.jsmpp.session.SMPPSessionContext.changeState(SMPPSessionContext.java:61)
	at org.jsmpp.session.AbstractSessionContext.close(AbstractSessionContext.java:66)
	at org.jsmpp.session.AbstractSession.close(AbstractSession.java:257)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:503)
... no further tries to reconnect
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It does not seem to improve the situation (at least for my test).&lt;/p&gt;</comment>
                            <comment id="17474671" author="orpiske" created="Wed, 12 Jan 2022 16:28:36 +0000"  >&lt;p&gt;Thanks for double checking. I think I managed to reproduce the issue, so I am taking a closer look now.&lt;/p&gt;</comment>
                            <comment id="17474955" author="orpiske" created="Wed, 12 Jan 2022 21:03:50 +0000"  >&lt;p&gt;I was able to reproduce the issue ... and with the latest set of changes, I think it&apos;s resolved. Can you, please, give it a try &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pascalschumacher&quot; class=&quot;user-hover&quot; rel=&quot;pascalschumacher&quot;&gt;pascalschumacher&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17475205" author="pascalschumacher" created="Thu, 13 Jan 2022 09:28:53 +0000"  >&lt;p&gt;The latest changes fixed the reconnect:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-01-13 10:20:32.632  INFO 20744 --- [MSNotifications] o.a.camel.component.smpp.SmppConsumer    : Connected to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:21:51.833  INFO 20744 --- [Worker-cd2c6373] org.jsmpp.session.SMPPSession            : Reading PDU session cd2c6373 in state BOUND_RX: Connection reset
2022-01-13 10:21:51.833 ERROR 20744 --- [Sender-cd2c6373] org.jsmpp.session.AbstractSession        : Response timeout on enquireLink

org.jsmpp.extra.ResponseTimeoutException: No response after waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60000 millis when executing enquire_link with session cd2c6373 and sequence_number 2
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:323)
	at org.jsmpp.session.AbstractSession.sendEnquireLink(AbstractSession.java:369)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:500)
Caused by: org.jsmpp.extra.ResponseTimeoutException: No response after 60000 millis
	at org.jsmpp.extra.PendingResponse.waitDone(PendingResponse.java:118)
	at org.jsmpp.session.AbstractSession.executeSendCommand(AbstractSession.java:317)
	... 2 common frames omitted

2022-01-13 10:21:51.834  WARN 20744 --- [Sender-cd2c6373] o.a.camel.component.smpp.SmppConsumer    : Lost connection to: smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY - trying to reconnect...
&lt;/span&gt;2022-01-13 10:21:51.840  WARN 20744 --- [Sender-cd2c6373] o.a.camel.support.task.BackgroundTask    : Interrupted &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the repeatable task to execute: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

java.lang.InterruptedException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1048)
	at java.base/java.util.concurrent.CountDownLatch.await(CountDownLatch.java:230)
	at org.apache.camel.support.task.BackgroundTask.waitForTaskCompletion(BackgroundTask.java:153)
	at org.apache.camel.support.task.BackgroundTask.run(BackgroundTask.java:144)
	at org.apache.camel.component.smpp.SmppConsumer.reconnect(SmppConsumer.java:192)
	at org.apache.camel.component.smpp.SmppConsumer.access$300(SmppConsumer.java:51)
	at org.apache.camel.component.smpp.SmppConsumer$1.onStateChange(SmppConsumer.java:84)
	at org.jsmpp.session.AbstractSessionContext.fireStateChanged(AbstractSessionContext.java:85)
	at org.jsmpp.session.SMPPSessionContext.changeState(SMPPSessionContext.java:61)
	at org.jsmpp.session.AbstractSessionContext.close(AbstractSessionContext.java:66)
	at org.jsmpp.session.AbstractSession.close(AbstractSession.java:257)
	at org.jsmpp.session.AbstractSession$EnquireLinkSender.run(AbstractSession.java:503)

2022-01-13 10:21:56.841  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:21:56.841  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Creating a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:21:56.851  WARN 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:22:56.840  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:22:56.840  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Creating a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:22:56.851  WARN 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Failed to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:23:56.842  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Trying to reconnect to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:23:56.842  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Creating a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY
&lt;/span&gt;2022-01-13 10:23:56.880  INFO 20744 --- [sumer-reconnect] org.jsmpp.session.SMPPSession            : Connected from port 52797 to /XXX:YYY
2022-01-13 10:23:56.880  INFO 20744 --- [Worker-60a4e4c3] org.jsmpp.session.SMPPSession            : Starting PDUReaderWorker
2022-01-13 10:23:57.019  INFO 20744 --- [ool-22-thread-1] org.jsmpp.session.SMPPSession            : Changing processor degree to 1
2022-01-13 10:23:57.020  INFO 20744 --- [sumer-reconnect] org.jsmpp.bean.OptionalParameters        : Optional Parameter Tag &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.jsmpp.bean.OptionalParameter$Sc_interface_version not found
2022-01-13 10:23:57.020  INFO 20744 --- [sumer-reconnect] o.a.camel.component.smpp.SmppConsumer    : Reconnected to smpp:&lt;span class=&quot;code-comment&quot;&gt;//XXX:YYY&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank you very much! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17475328" author="orpiske" created="Thu, 13 Jan 2022 12:48:01 +0000"  >&lt;p&gt;Thank you as well. I&apos;ll cleanup the patch, fix one more issue I found and then merge it.&lt;/p&gt;</comment>
                            <comment id="17475494" author="orpiske" created="Thu, 13 Jan 2022 16:04:52 +0000"  >&lt;p&gt;Closing, since it was fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13407886">CAMEL-17121</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13422234">CAMEL-17477</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13422327">CAMEL-17482</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ygz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>