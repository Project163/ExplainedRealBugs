<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:35:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2165] ftp uploads can fail: File operation failed:  Connection closed without indication.. Code: 421</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2165</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Looks like something that was fixed for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-444&quot; title=&quot;FTPConsumer - WARN connection closed without indication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-444&quot;&gt;&lt;del&gt;CAMEL-444&lt;/del&gt;&lt;/a&gt; didn&apos;t make it into 2.0?&lt;/p&gt;

&lt;p&gt;On 2.0.0, this is not a warning, this is a fatal.&lt;/p&gt;


&lt;p&gt;SEVERE: Exception occured during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: XXXXXX&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.camel.CamelExecutionException: Exception occured during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: XXXXX&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1027)&lt;br/&gt;
        at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:479)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:431)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:106)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:122)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.requestBody(DefaultProducerTemplate.java:266)&lt;br/&gt;
        at... into my code here...&lt;br/&gt;
Caused by: org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Connection closed without indication.. Code: 421&lt;br/&gt;
        at org.apache.camel.component.file.remote.FtpOperations.disconnect(FtpOperations.java:167)&lt;br/&gt;
        at org.apache.camel.component.file.remote.RemoteFileProducer.disconnect(RemoteFileProducer.java:77)&lt;br/&gt;
        at org.apache.camel.component.file.remote.RemoteFileProducer.handleFailedWrite(RemoteFileProducer.java:66)&lt;br/&gt;
        at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:104)&lt;br/&gt;
        at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:52)&lt;br/&gt;
        at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:81)&lt;br/&gt;
        at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:79)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:141)&lt;br/&gt;
        at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:78)&lt;br/&gt;
        at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:61)&lt;br/&gt;
        at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:186)&lt;br/&gt;
        at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:155)&lt;br/&gt;
        at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:88)&lt;br/&gt;
        at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49)&lt;br/&gt;
        at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:148)&lt;br/&gt;
        at org.apache.camel.processor.Pipeline.process(Pipeline.java:74)&lt;br/&gt;
        at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54)&lt;br/&gt;
        at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48)&lt;br/&gt;
        at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:170)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:156)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:141)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:155)&lt;br/&gt;
        at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:111)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:101)&lt;br/&gt;
        at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:105)&lt;br/&gt;
        ... 37 more&lt;br/&gt;
Caused by: org.apache.commons.net.ftp.FTPConnectionClosedException: Connection closed without indication.&lt;br/&gt;
        at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:297)&lt;/p&gt;


&lt;p&gt;This is &quot;not what I want&quot;  and there doesn&apos;t seem to be any keep alive or other option on the ftp2 component.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12486861">CAMEL-2165</key>
            <summary>ftp uploads can fail: File operation failed:  Connection closed without indication.. Code: 421</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="karlp">Karl Palsson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Nov 2009 15:33:19 +0000</created>
                <updated>Thu, 3 Jun 2010 07:25:26 +0000</updated>
                            <resolved>Wed, 18 Nov 2009 08:47:47 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12952721" author="davsclaus" created="Thu, 12 Nov 2009 16:57:10 +0000"  >&lt;p&gt;The FTP write operation failed for some reason but the exception logged is shadowed by Camel trying to graceful disconnect.&lt;/p&gt;

&lt;p&gt;Lowering bug priority as Camel should still indicate an exception back to the Exchange&lt;/p&gt;</comment>
                            <comment id="12952661" author="davsclaus" created="Thu, 12 Nov 2009 16:58:46 +0000"  >&lt;p&gt;trunk: 835443.&lt;/p&gt;


&lt;p&gt;I have committed a fix on trunk to let the original exception propagate back.&lt;/p&gt;

&lt;p&gt;Can you test it on you end?&lt;/p&gt;</comment>
                            <comment id="12952840" author="karlp" created="Thu, 12 Nov 2009 17:24:36 +0000"  >&lt;p&gt;I&apos;ll look into it, but I&apos;m new to maven, and this is the first time I would need to get a private build jar into mysetup somehow.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12951635" author="karlp" created="Mon, 16 Nov 2009 14:30:00 +0000"  >&lt;p&gt;The error messages are better, but this doesn&apos;t fix the problem.&lt;/p&gt;

&lt;p&gt;FTP consumers that get connection problems attempt to reopen the connection.  FTP producers open the connection once, and then simply fail if the connection has been closed.  I want the ftp producer to attempt to reopen the connection as well.&lt;/p&gt;

&lt;p&gt;I currently work around this by having a timer triggered ftp write, to the same endpoint url, which works, but seems a little hacky.&lt;/p&gt;

&lt;p&gt;        // hack to keep the ftp connection alive...&lt;br/&gt;
        from(&quot;timer://foo?fixedRate=true&amp;amp;period=45000&quot;)&lt;br/&gt;
                .setHeader(Exchange.FILE_NAME, constant(&quot;.keepalive.tmp&quot;))&lt;br/&gt;
                .setBody(constant(&quot;File written periodically to keep the ftp endpoint alive...&quot;))&lt;br/&gt;
                .to(ftpDestinationURI);&lt;/p&gt;</comment>
                            <comment id="12952623" author="davsclaus" created="Mon, 16 Nov 2009 15:18:44 +0000"  >&lt;p&gt;Yeah there is unfortunately nothing in the Commons FTP API for keep alive.&lt;/p&gt;

&lt;p&gt;Kinda hate to have to do a pool in Camel to periodically keep the connections alive.&lt;/p&gt;</comment>
                            <comment id="12953186" author="davsclaus" created="Mon, 16 Nov 2009 15:21:47 +0000"  >&lt;p&gt;That is odd there is a pre write check on the producer&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void preWriteCheck() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        connectIfNecessary();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!loggedIn) {
            &lt;span class=&quot;code-comment&quot;&gt;// must be logged in to be able to upload the file
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot connect/login to: &quot;&lt;/span&gt; + ((RemoteFileEndpoint) getEndpoint()).remoteServerInformation();
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericFileOperationFailedException(message);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Karl can you try with 2.1 in all components.&lt;/p&gt;</comment>
                            <comment id="12953467" author="karlp" created="Mon, 16 Nov 2009 16:16:13 +0000"  >&lt;p&gt;I was trying with 2.1-SNAPSHOT for all camel, 2.1-SNAPSHOT ftp doesn&apos;t work with 2.0 core.&lt;/p&gt;

&lt;p&gt;Here&apos;s the complete stack trace when I try and send something to FTP when the connection has been closed behind me...&lt;/p&gt;


&lt;p&gt;16.11.2009 16:11:07 com.sun.xml.ws.server.sei.EndpointMethodHandler invoke&lt;br/&gt;
SEVERE: Exception occurred during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message: MYMESSAGEHERE&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange&lt;span class=&quot;error&quot;&gt;&amp;#91;Message:MYMESSAGEHERE&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1055)&lt;br/&gt;
	at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:445)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:431)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:106)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:122)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.requestBody(DefaultProducerTemplate.java:266)&lt;br/&gt;
	at is.vf.conan.ConanCore.openSubscription(ConanCore.java:31)&lt;br/&gt;
	at is.vf.conan.services.ConanBusiness.openSubscription(ConanBusiness.java:40)&lt;br/&gt;
	jetty/jaxws stuff snipped below here...&lt;br/&gt;
Caused by: org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Software caused connection abort: recv failed. Code: 226&lt;br/&gt;
	at org.apache.camel.component.file.remote.FtpOperations.buildDirectory(FtpOperations.java:227)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileProducer.writeFile(GenericFileProducer.java:173)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:126)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:52)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:97)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:95)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor.doProcess(SendProcessor.java:94)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:82)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82)&lt;br/&gt;
	at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:93)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:232)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:162)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:91)&lt;br/&gt;
	at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49)&lt;br/&gt;
	at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:206)&lt;br/&gt;
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:74)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:179)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:161)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:160)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:116)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:101)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:105)&lt;br/&gt;
	... 42 more&lt;br/&gt;
Caused by: java.net.SocketException: Software caused connection abort: recv failed&lt;br/&gt;
	at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
	at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)&lt;br/&gt;
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)&lt;br/&gt;
	at java.io.InputStreamReader.read(InputStreamReader.java:167)&lt;br/&gt;
	at java.io.BufferedReader.fill(BufferedReader.java:136)&lt;br/&gt;
	at java.io.BufferedReader.readLine(BufferedReader.java:299)&lt;br/&gt;
	at java.io.BufferedReader.readLine(BufferedReader.java:362)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:294)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:490)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:534)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:583)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.pwd(FTP.java:1270)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTPClient.printWorkingDirectory(FTPClient.java:1800)&lt;br/&gt;
	at org.apache.camel.component.file.remote.FtpOperations.buildDirectory(FtpOperations.java:202)&lt;br/&gt;
	... 72 more&lt;/p&gt;</comment>
                            <comment id="12953466" author="davsclaus" created="Mon, 16 Nov 2009 16:21:20 +0000"  >&lt;p&gt;Well the FTP client code sees the connection as connected, hence the pre write check.&lt;/p&gt;

&lt;p&gt;I wonder if we should add a send noop in the pre write check to see if that succeed, and in case of a problem force a disconnect and connect again.&lt;/p&gt;</comment>
                            <comment id="12953338" author="davsclaus" created="Mon, 16 Nov 2009 16:51:00 +0000"  >&lt;p&gt;trunk: 880842.&lt;/p&gt;

&lt;p&gt;Karl can you try with latest fix where I have improved the preWriteCheck to send noop and reconnect in case of problems.&lt;/p&gt;</comment>
                            <comment id="12945947" author="karlp" created="Mon, 16 Nov 2009 17:22:23 +0000"  >&lt;p&gt;No good.. same stack trace too.  &lt;/p&gt;

&lt;p&gt;I&apos;ve got camel-ftp snapshot 20091116163620 I&apos;m hoping that includes your changes?&lt;/p&gt;
</comment>
                            <comment id="12953430" author="davsclaus" created="Mon, 16 Nov 2009 18:34:35 +0000"  >&lt;p&gt;Thats to fast. Wait till tomorrow so the snapshot build does include the fix.&lt;/p&gt;

&lt;p&gt;And you can enable DEBUG logging for org.apache.camel.component.remote which is the camel-ftp component.&lt;br/&gt;
It should log something about NOOP and reconnecting etc.&lt;/p&gt;</comment>
                            <comment id="12953477" author="karlp" created="Tue, 17 Nov 2009 15:08:27 +0000"  >&lt;p&gt;Ok, it&apos;s got a new stacktrace now, including the prewritecheck, so I&apos;m assuming this is the right code...  It still doesn&apos;t work  though...  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I can probably try and package up my test setup for this, if it would help, I can probably make it as small as a timer routed to an ftp endpoint.. ?&lt;/p&gt;

&lt;p&gt;I&apos;ll try and make a more minimal example and attach it here later today.&lt;/p&gt;



&lt;p&gt;Caused by: org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Software caused connection abort: socket write error. Code: 226&lt;br/&gt;
	at org.apache.camel.component.file.remote.FtpOperations.disconnect(FtpOperations.java:165)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileProducer.disconnect(RemoteFileProducer.java:87)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileProducer.preWriteCheck(RemoteFileProducer.java:114)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:75)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:52)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:97)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:95)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor.doProcess(SendProcessor.java:94)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:82)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82)&lt;br/&gt;
	at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:93)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:232)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:162)&lt;br/&gt;
	at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:91)&lt;br/&gt;
	at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49)&lt;br/&gt;
	at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:206)&lt;br/&gt;
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:74)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54)&lt;br/&gt;
	at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)&lt;br/&gt;
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:179)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:161)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:160)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:116)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:101)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:105)&lt;br/&gt;
	... 42 more&lt;br/&gt;
Caused by: java.net.SocketException: Software caused connection abort: socket write error&lt;br/&gt;
	at java.net.SocketOutputStream.socketWrite0(Native Method)&lt;br/&gt;
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)&lt;br/&gt;
	at java.net.SocketOutputStream.write(SocketOutputStream.java:136)&lt;br/&gt;
	at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)&lt;br/&gt;
	at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)&lt;br/&gt;
	at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:276)&lt;br/&gt;
	at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:122)&lt;br/&gt;
	at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:212)&lt;br/&gt;
	at java.io.BufferedWriter.flush(BufferedWriter.java:236)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:472)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:534)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:583)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTP.quit(FTP.java:794)&lt;br/&gt;
	at org.apache.commons.net.ftp.FTPClient.logout(FTPClient.java:697)&lt;br/&gt;
	at org.apache.camel.component.file.remote.FtpOperations.disconnect(FtpOperations.java:163)&lt;br/&gt;
	... 73 more&lt;/p&gt;</comment>
                            <comment id="12953461" author="karlp" created="Tue, 17 Nov 2009 16:24:30 +0000"  >&lt;p&gt;Attached small project that demonstrates failures.  Contains an apache ftp server configured to timeout connections every 5 seconds, and a camel route that writes a file every 10 seconds.&lt;/p&gt;

&lt;p&gt;Every other file write fails, and a new connection is made the next time.&lt;/p&gt;</comment>
                            <comment id="12953475" author="davsclaus" created="Tue, 17 Nov 2009 16:31:25 +0000"  >&lt;p&gt;Karl thanks for the stacktrace.&lt;/p&gt;

&lt;p&gt;I have just committed a new fix. Can you try again tomorrow?&lt;/p&gt;


&lt;p&gt;trunk: 881360.&lt;/p&gt;</comment>
                            <comment id="12953447" author="davsclaus" created="Tue, 17 Nov 2009 16:32:04 +0000"  >&lt;p&gt;Or use this .jar attached which has the fix&lt;/p&gt;</comment>
                            <comment id="12953497" author="davsclaus" created="Wed, 18 Nov 2009 08:33:45 +0000"  >&lt;p&gt;Thanks for the test project. I got it up and running and with the latest fix it can self heal the connection&lt;/p&gt;

&lt;p&gt;As you can see from the log output the write does not fail anymore&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2009-11-18 09:35:44,742 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Starting
2009-11-18 09:35:44,743 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Starting producer: Producer[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:44,746 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Not already connected/logged in. Connecting to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:45,792 INFO [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Connected and logged in to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:45,793 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck send noop success: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2009-11-18 09:35:45,856 INFO [org.apache.ftpserver.command.impl.STOR:pool-2-thread-1] - File uploaded /autreq/writeAttempt.txt
2009-11-18 09:35:45,857 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Wrote [autreq/writeAttempt.txt] to [Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]]
&lt;/span&gt;2009-11-18 09:35:54,681 ERROR [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Connection closed without indication.. Code: 226
2009-11-18 09:35:54,681 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck send noop success: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2009-11-18 09:35:54,685 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck forcing a disconnect as noop failed
2009-11-18 09:35:54,685 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Disconnecting from: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:54,685 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Not already connected/logged in. Connecting to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:54,689 INFO [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Connected and logged in to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:35:54,745 INFO [org.apache.ftpserver.command.impl.STOR:pool-2-thread-1] - File uploaded /autreq/writeAttempt.txt
2009-11-18 09:35:54,745 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Wrote [autreq/writeAttempt.txt] to [Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]]
&lt;/span&gt;2009-11-18 09:36:04,681 ERROR [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Connection closed without indication.. Code: 226
2009-11-18 09:36:04,681 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck send noop success: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2009-11-18 09:36:04,681 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck forcing a disconnect as noop failed
2009-11-18 09:36:04,681 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Disconnecting from: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:04,682 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Not already connected/logged in. Connecting to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:04,686 INFO [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Connected and logged in to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:04,741 INFO [org.apache.ftpserver.command.impl.STOR:pool-2-thread-1] - File uploaded /autreq/writeAttempt.txt
2009-11-18 09:36:04,741 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Wrote [autreq/writeAttempt.txt] to [Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]]
&lt;/span&gt;2009-11-18 09:36:14,681 ERROR [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed:  Connection closed without indication.. Code: 226
2009-11-18 09:36:14,682 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck send noop success: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2009-11-18 09:36:14,682 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - preWriteCheck forcing a disconnect as noop failed
2009-11-18 09:36:14,682 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Disconnecting from: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:14,682 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Not already connected/logged in. Connecting to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:14,686 INFO [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Connected and logged in to: Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]
&lt;/span&gt;2009-11-18 09:36:14,740 INFO [org.apache.ftpserver.command.impl.STOR:pool-2-thread-2] - File uploaded /autreq/writeAttempt.txt
2009-11-18 09:36:14,741 DEBUG [org.apache.camel.component.file.remote.RemoteFileProducer:foo] - Wrote [autreq/writeAttempt.txt] to [Endpoint[ftp:&lt;span class=&quot;code-comment&quot;&gt;//camelUser@localhost:2121/autreq?passiveMode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;password=camelUser]]
&lt;/span&gt;
&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; finished with exit code 143
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12953494" author="davsclaus" created="Wed, 18 Nov 2009 08:47:47 +0000"  >&lt;p&gt;Should work now.&lt;/p&gt;</comment>
                            <comment id="12953483" author="karlp" created="Wed, 18 Nov 2009 10:05:52 +0000"  >&lt;p&gt;Looks good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;One minor nit, now that it reliably recovers, do we really need the log at ERROR level?&lt;/p&gt;

&lt;p&gt;It would seem to be inconsistent with other areas, where even unhandled errors are only going out at DEBUG &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12953481" author="davsclaus" created="Wed, 18 Nov 2009 10:20:29 +0000"  >&lt;p&gt;Well spotted lets see if we can get that ERROR out of the picture or to DEBUG since it safely recovers.&lt;/p&gt;</comment>
                            <comment id="12953482" author="davsclaus" created="Wed, 18 Nov 2009 11:14:21 +0000"  >&lt;p&gt;Got rid of the ERROR log&lt;/p&gt;

&lt;p&gt;trunk: 881721.&lt;/p&gt;</comment>
                            <comment id="12956226" author="davsclaus" created="Thu, 3 Jun 2010 07:25:26 +0000"  >&lt;p&gt;Closing old resolved issues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462892" name="camel-ftp-2.1-SNAPSHOT.jar" size="53002" author="davsclaus" created="Tue, 17 Nov 2009 16:32:04 +0000"/>
                            <attachment id="12462880" name="camel-ftp-bug-CAMEL-2165.zip" size="34332" author="karlp" created="Tue, 17 Nov 2009 16:24:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01mwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7481</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>