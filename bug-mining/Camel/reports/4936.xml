<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:35:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13680] camel-file - From file to file with readLock=fileLock dont work on windows</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13680</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;You can get errors like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Stacktrace
---------------------------------------------------------------------------------------------------------------------------------------
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot store file: work\cbr\output\ID-WIN-JTA8KU4EF9D-1561426618994-0-2
	at org.apache.camel.component.file.FileOperations.storeFile(FileOperations.java:352)
	at org.apache.camel.component.file.GenericFileProducer.writeFile(GenericFileProducer.java:305)
	at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:169)
	at org.apache.camel.component.file.GenericFileProducer.process(GenericFileProducer.java:80)
	at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61)
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:148)
	at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:548)
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:138)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:101)
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201)
	at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:452)
	at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:219)
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:183)
	at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:174)
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:101)
	at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
	at java.util.concurrent.FutureTask.runAndReset(Unknown Source)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(Unknown Source)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
Caused by: java.nio.file.FileSystemException: work\cbr\input\ID-WIN-JTA8KU4EF9D-1561426618994-0-2 -&amp;gt; work\cbr\output\ID-WIN-JTA8KU4EF9D-1561426618994-0-2: The process cannot access the file because it is being used by another process
	at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)
	at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)
	at sun.nio.fs.WindowsFileCopy.copy(Unknown Source)
	at sun.nio.fs.WindowsFileSystemProvider.copy(Unknown Source)
	at java.nio.file.Files.copy(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13241404">CAMEL-13680</key>
            <summary>camel-file - From file to file with readLock=fileLock dont work on windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jun 2019 07:09:30 +0000</created>
                <updated>Tue, 2 Jul 2019 12:11:25 +0000</updated>
                            <resolved>Tue, 25 Jun 2019 07:58:53 +0000</resolved>
                                                    <fixVersion>3.0.0.M4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16876789" author="hfuruichi" created="Tue, 2 Jul 2019 08:55:40 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I realized that the fix was not enough for this issue.&lt;/p&gt;

&lt;p&gt;org.apache.camel.component.file.FileOperations.writeFileByFile() was OK now, but we also need to fix&#160;org.apache.camel.component.file.FileOperations.renameFile() and org.apache.camel.util.FileUtil class&apos;s methods to avoid to use&#160;java.nio.file.Files.copy() method.&lt;/p&gt;

&lt;p&gt;Please take a look at this stack trace to get an idea about it. (Sorry it&apos;s not 3.0.x, but I hope it still helps)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ead #4 - file:&lt;span class=&quot;code-comment&quot;&gt;//work/cbr/input] GenericFileOnCompletion        WARN  Error during commit. Exchange[ID-WIN-JTA8KU4EF9D-1562055372761-0-1]. Caused by: [org.apache.camel.component.file.GenericFileOperationFailedException - Error renaming file from C:\Users\Administrator\workspace\FuseReproducer\work\cbr\input\ID-WIN-JTA8KU4EF9D-1562029860727-1-2 to work\cbr\input\.camel\ID-WIN-JTA8KU4EF9D-1562029860727-1-2]
&lt;/span&gt;org.apache.camel.component.file.GenericFileOperationFailedException: Error renaming file from C:\Users\Administrator\workspace\FuseReproducer\work\cbr\input\ID-WIN-JTA8KU4EF9D-1562029860727-1-2 to work\cbr\input\.camel\ID-WIN-JTA8KU4EF9D-1562029860727-1-2
	at org.apache.camel.component.file.FileOperations.renameFile(FileOperations.java:85)
	at org.apache.camel.component.file.strategy.GenericFileProcessStrategySupport.renameFile(GenericFileProcessStrategySupport.java:128)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:111)
	at org.apache.camel.component.file.GenericFileOnCompletion.processStrategyCommit(GenericFileOnCompletion.java:127)
	at org.apache.camel.component.file.GenericFileOnCompletion.onCompletion(GenericFileOnCompletion.java:83)
	at org.apache.camel.component.file.GenericFileOnCompletion.onComplete(GenericFileOnCompletion.java:59)
	at org.apache.camel.util.UnitOfWorkHelper.doneSynchronizations(UnitOfWorkHelper.java:104)
	at org.apache.camel.impl.DefaultUnitOfWork.done(DefaultUnitOfWork.java:243)
	at org.apache.camel.util.UnitOfWorkHelper.doneUow(UnitOfWorkHelper.java:65)
	at org.apache.camel.processor.CamelInternalProcessor$UnitOfWorkProcessorAdvice.after(CamelInternalProcessor.java:685)
	at org.apache.camel.processor.CamelInternalProcessor$UnitOfWorkProcessorAdvice.after(CamelInternalProcessor.java:634)
	at org.apache.camel.processor.CamelInternalProcessor$InternalCallback.done(CamelInternalProcessor.java:251)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:127)
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201)
	at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:454)
	at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:223)
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:187)
	at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:174)
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:101)
	at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
	at java.util.concurrent.FutureTask.runAndReset(Unknown Source)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(Unknown Source)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
Caused by: java.nio.file.FileSystemException: C:\Users\Administrator\workspace\FuseReproducer\work\cbr\input\ID-WIN-JTA8KU4EF9D-1562029860727-1-2 -&amp;gt; work\cbr\input\.camel\ID-WIN-JTA8KU4EF9D-1562029860727-1-2: The process cannot access the file because it is being used by another process

	at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)
	at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)
	at sun.nio.fs.WindowsFileCopy.copy(Unknown Source)
	at sun.nio.fs.WindowsFileSystemProvider.copy(Unknown Source)
	at java.nio.file.Files.copy(Unknown Source)
	at org.apache.camel.util.FileUtil.copyFile(FileUtil.java:541)
	at org.apache.camel.util.FileUtil.renameFileUsingCopy(FileUtil.java:525)
	at org.apache.camel.util.FileUtil.renameFile(FileUtil.java:499)
	at org.apache.camel.component.file.FileOperations.renameFile(FileOperations.java:82)
	... 25 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16876794" author="davsclaus" created="Tue, 2 Jul 2019 08:59:20 +0000"  >&lt;p&gt;Can you try set renameUsingCopy=true&lt;/p&gt;</comment>
                            <comment id="16876815" author="hfuruichi" created="Tue, 2 Jul 2019 09:27:57 +0000"  >&lt;p&gt;Yes. I tested it, but does not work either.&lt;/p&gt;

&lt;p&gt;Even I enabled the option, go into the same stack trace.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)
 at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)
 at sun.nio.fs.WindowsFileCopy.copy(Unknown Source)
 at sun.nio.fs.WindowsFileSystemProvider.copy(Unknown Source)
 at java.nio.file.Files.copy(Unknown Source)
 at org.apache.camel.util.FileUtil.copyFile(FileUtil.java:541)
 at org.apache.camel.util.FileUtil.renameFileUsingCopy(FileUtil.java:525)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; Please take a look at this source code, how the &quot;renameUsingCopy&quot; option is used.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/eed7b1113ec1b72731b051f69ea3d269bf5fb1c5/components/camel-file/src/main/java/org/apache/camel/component/file/FileOperations.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/eed7b1113ec1b72731b051f69ea3d269bf5fb1c5/components/camel-file/src/main/java/org/apache/camel/component/file/FileOperations.java#L80&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16876904" author="davsclaus" created="Tue, 2 Jul 2019 12:01:41 +0000"  >&lt;p&gt;Okay so this is not possible on windows with readLock=fileLock. The changes we did previously was only to ensure the file lock could be released.&lt;/p&gt;

&lt;p&gt;There are too many places where the file component can do a copy/rename/move or other operations. We will update the doc to mention that readLock=fileLock is not supported on windows. You can use any of the many other read locks on windows instead.&lt;/p&gt;</comment>
                            <comment id="16876908" author="davsclaus" created="Tue, 2 Jul 2019 12:11:18 +0000"  >&lt;p&gt;Added a check that if readLock=fileLock on windows you now get an error and also updated the doc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z042ig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>