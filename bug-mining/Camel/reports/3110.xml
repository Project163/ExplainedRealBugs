<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:07:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8356] IOConverter.toInputStream(file, charset) returns strange behaving stream</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8356</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Calling IOConverter.toInputStream with either UTF-8 or ISO-8859-1 returns a stream that behaves strange on non-ascii-characters:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;putting this stream into an InputStreamReader will return false encoded characters&lt;/li&gt;
	&lt;li&gt;a naive new BufferedReader(new InputStreamReader(new FileInputStream(file), charset)) will return the correctly encoded characters.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will attach some unit tests for this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12775129">CAMEL-8356</key>
            <summary>IOConverter.toInputStream(file, charset) returns strange behaving stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="almond">Stefan Mandel</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Feb 2015 12:05:33 +0000</created>
                <updated>Fri, 26 Apr 2019 07:09:26 +0000</updated>
                            <resolved>Tue, 3 Mar 2015 02:06:07 +0000</resolved>
                                    <version>2.14.1</version>
                    <version>2.15.0</version>
                                    <fixVersion>2.14.2</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14321381" author="almond" created="Sat, 14 Feb 2015 12:13:37 +0000"  >&lt;p&gt;I wanted to provide a patch, but the resulting patch also had charset problems. So the Test has to be deployed manually:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The java file can be placed next to th IOConverterTest&lt;/li&gt;
	&lt;li&gt;The text files have to be placed at the directory mentioned in the test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can help to debug/patch this problem, when someone has confirmed this defect.&lt;/p&gt;</comment>
                            <comment id="14321383" author="almond" created="Sat, 14 Feb 2015 12:16:25 +0000"  >&lt;p&gt;To fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; I suggest to use the GenericFileConverter.toInputStream, which is dependent on IOConverter.&lt;/p&gt;

&lt;p&gt;Yet GenericFileConverter will not solve &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; because of this IOconvert.toInputStream problem.&lt;/p&gt;</comment>
                            <comment id="14321836" author="njiang" created="Sun, 15 Feb 2015 06:45:33 +0000"  >&lt;p&gt;When you consume the InputStream with a Reader, you need to specify the charset that reader use.&lt;br/&gt;
As IOconvert.toInputStream just return an InputStream back, it has no chance to use the charset information.&lt;br/&gt;
How about use IOconvert.toReader(File file, String charset) directly?&lt;/p&gt;</comment>
                            <comment id="14322011" author="almond" created="Sun, 15 Feb 2015 15:02:20 +0000"  >&lt;p&gt;How exactly is the specification of  IOconvert.toInputStream(File file, String charset)?&lt;/p&gt;

&lt;p&gt;I expected that it transforms the file to a stream using the specified charset. In fact that method uses the charset (can be seen in the implementation), but the resulting stream delivers exactly the same byte sequence as the one without charset specification.&lt;/p&gt;

&lt;p&gt;Using  IOconvert.toReader(File file, String charset) would be fine, but will not work for 2.14.x because it is not public in this branch. Besides this is a workaround, but the inconsistency of toInputStream stays.&lt;/p&gt;</comment>
                            <comment id="14322013" author="almond" created="Sun, 15 Feb 2015 15:05:52 +0000"  >&lt;p&gt;The third unit test (I just replaced the old test file attachment) shows that the returned byte stream is the same as a pure FileInputStream.&lt;/p&gt;

&lt;p&gt;This seems strange, because anybody can see that the implementation does use the specified charset. However the Streaming-Pipeline (Stream-&amp;gt;BufferedReader-&amp;gt;Stream) seems to loose it.&lt;/p&gt;

&lt;p&gt;As I said - i can hunt this bug down, but yet I am not certain if a majority recognizes this behaviour as bug.&lt;/p&gt;</comment>
                            <comment id="14333668" author="githubbot" created="Mon, 23 Feb 2015 19:12:59 +0000"  >&lt;p&gt;GitHub user almondtools opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/406&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; IOConverter.toInputStream(file, charset) returns strange&lt;/p&gt;

&lt;p&gt;    I extended some Unittests to point out the problems:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;toReader(file, charset) does respect the charset&lt;/li&gt;
	&lt;li&gt;toStream(file, charset) does not respect the charset&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The provided Patch for IOConverter.toInputStream does respect the charset. I do not know if other projects already rely on the current behaviour that the charset is completely ignored.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/almondtools/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/almondtools/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/406.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/406.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #406&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9020431e167c2f03d96597d3c598fd988b2b5f56&lt;br/&gt;
Author: Stefan Mandel &amp;lt;mandelst@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-02-14T17:31:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; IOConverter.toInputStream(file, charset) returns strange&lt;br/&gt;
    behaving stream&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14341100" author="njiang" created="Sat, 28 Feb 2015 00:34:37 +0000"  >&lt;p&gt;Applied the patch into camel-core with thanks to Stefan.&lt;/p&gt;</comment>
                            <comment id="14341505" author="almond" created="Sat, 28 Feb 2015 12:47:16 +0000"  >&lt;p&gt;I reviewed your patch and I think we both made a mistake.&lt;/p&gt;

&lt;p&gt;My intension was to provide an Inputstream which could be read by any unparameterized reader / wrapper stream. I will attach a patch for the tests and a fix for IOConverter.toInputStream.&lt;/p&gt;

&lt;p&gt;Your cleanup made obvious that my fix converts the stream to UTF-8, which could only be read by readers with UTF-8 (instead of default) input encoding.&lt;/p&gt;

&lt;p&gt;The attachment will fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; for branch 2.14 but unfortunately breaks branch 2.15. You cannot apply this attachment to branch 2.15.x without another fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Notify me if you want to apply this patch. I will try to provide a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; on branch 2.15.x then.&lt;/p&gt;



</comment>
                            <comment id="14341506" author="almond" created="Sat, 28 Feb 2015 12:49:28 +0000"  >&lt;p&gt;The proposed patch. Note that this patch needs another patch in JsonPathEngine (camel-jsonpath, only in the branches 2.15.x and newer), because the used JsonProvider expects a &quot;UTF-8&quot;-stream (and not a default-encoded stream).&lt;/p&gt;</comment>
                            <comment id="14342054" author="davsclaus" created="Sun, 1 Mar 2015 08:13:22 +0000"  >&lt;p&gt;We would need a patch for 2.15 as a release is scheduled soon.&lt;/p&gt;</comment>
                            <comment id="14342139" author="githubbot" created="Sun, 1 Mar 2015 11:11:47 +0000"  >&lt;p&gt;Github user almondtools closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/406&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14342157" author="githubbot" created="Sun, 1 Mar 2015 11:43:40 +0000"  >&lt;p&gt;GitHub user almondtools opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; corrections to default charset&lt;/p&gt;

&lt;p&gt;    this pull request contains:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;corrections to IOConverter as described in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;unit tests for json path (related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; (ported from master)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/almondtools/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/almondtools/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt;-2.14.x&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/412.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/412.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #412&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7f6538cb1b30a80eef3f743d0f9e98b3e7b8f1bc&lt;br/&gt;
Author: Stefan Mandel &amp;lt;mandelst@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-03-01T11:26:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; corrections to default charset&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14342161" author="githubbot" created="Sun, 1 Mar 2015 11:46:58 +0000"  >&lt;p&gt;GitHub user almondtools opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/413&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; corrections to default charset&lt;/p&gt;

&lt;p&gt;    this pull request contains:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;corrections to IOConverter as described in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8346&quot; title=&quot;JsonPathEngine skips file encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8346&quot;&gt;&lt;del&gt;CAMEL-8346&lt;/del&gt;&lt;/a&gt; adjusted to the the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/almondtools/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/almondtools/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt;-master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/413.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/413.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #413&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 55607d14787f574825e309a975659861e7d6ead4&lt;br/&gt;
Author: Stefan Mandel &amp;lt;mandelst@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-03-01T11:26:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8356&quot; title=&quot;IOConverter.toInputStream(file, charset) returns strange behaving stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8356&quot;&gt;&lt;del&gt;CAMEL-8356&lt;/del&gt;&lt;/a&gt; corrections to default charset&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14342167" author="almond" created="Sun, 1 Mar 2015 11:53:01 +0000"  >&lt;p&gt;I just proposed two pull requests, for each affected branch (2.14 and 2.15).&lt;/p&gt;

&lt;p&gt;Yet the fixes to jsonpath are included. I considered this best, because the fixes are not independent. If you suggest another partitioning of the commits I can adjust them.&lt;/p&gt;</comment>
                            <comment id="14342799" author="githubbot" created="Mon, 2 Mar 2015 05:58:57 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/412&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14344316" author="njiang" created="Tue, 3 Mar 2015 02:06:07 +0000"  >&lt;p&gt;Applied the patch into camel master and camel-2.14.x branches.&lt;/p&gt;</comment>
                            <comment id="14344862" author="githubbot" created="Tue, 3 Mar 2015 10:12:59 +0000"  >&lt;p&gt;Github user almondtools closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/413&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14568526" author="ssidashov" created="Tue, 2 Jun 2015 05:03:00 +0000"  >&lt;p&gt;It seems encoding problem with IOConverter still exists. I try to load text file in cp1251 encoding, using file component (uri=&lt;a href=&quot;file:C:addrin?charset=cp1251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:C:\addr\in&amp;amp;#63;charset=cp1251&lt;/a&gt; for example). Then I write bean with method:&lt;/p&gt;

&lt;p&gt;public static String convertStreamToString(InputStream inputStream) throws IOException {&lt;br/&gt;
        if (inputStream == null) return null;&lt;br/&gt;
        StringBuilder sb = new StringBuilder(2048); // Define a size if you have an idea of it.&lt;br/&gt;
        char[] read = new char&lt;span class=&quot;error&quot;&gt;&amp;#91;128&amp;#93;&lt;/span&gt;; // Your buffer size.&lt;br/&gt;
        try (InputStreamReader ir = new InputStreamReader(inputStream, &quot;cp1251&quot;)) &lt;/p&gt;
{
            for (int i; -1 != (i = ir.read(read)); sb.append(read, 0, i));
        }
&lt;p&gt; catch (Throwable t) {}&lt;br/&gt;
        return sb.toString();&lt;br/&gt;
    }&lt;br/&gt;
to test conversion from File to InputStream. This stream for some files reads all content successfully, but for some files it clips contents of file. It seems file reading ends with some characters (for example, in cp1251 encoding, file reading ends with characters &apos;&#1103;&#1103;&apos;). Camel version 2.15.2, java version 1.8.0_45.&lt;/p&gt;</comment>
                            <comment id="14570408" author="njiang" created="Wed, 3 Jun 2015 07:17:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ssidashov&quot; class=&quot;user-hover&quot; rel=&quot;ssidashov&quot;&gt;ssidashov&lt;/a&gt;&lt;br/&gt;
I just found you use char array as buffer to read the stream, what if the read method just read more than 128 character. Can you submit a simple test case for us to dig the issue?&lt;/p&gt;</comment>
                            <comment id="14570582" author="ssidashov" created="Wed, 3 Jun 2015 10:08:43 +0000"  >&lt;p&gt;source.txt - original file with non-ascii characters&lt;br/&gt;
result.txt - file processed by route&lt;/p&gt;

&lt;p&gt;files in cp1251 encoding&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;&lt;br/&gt;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;&lt;br/&gt;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; xmlns:jaxws=&quot;http://cxf.apache.org/jaxws&quot;&lt;br/&gt;
       xmlns:camel=&quot;http://camel.apache.org/schema/spring&quot;&lt;br/&gt;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans&lt;br/&gt;
	&lt;a href=&quot;http://www.springframework.org/schema/beans/spring-beans.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.springframework.org/schema/beans/spring-beans.xsd&lt;/a&gt;&lt;br/&gt;
	&lt;a href=&quot;http://www.springframework.org/schema/context&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.springframework.org/schema/context&lt;/a&gt;&lt;br/&gt;
    &lt;a href=&quot;http://www.springframework.org/schema/context/spring-context.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.springframework.org/schema/context/spring-context.xsd&lt;/a&gt;&lt;br/&gt;
    &lt;a href=&quot;http://www.springframework.org/schema/tx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.springframework.org/schema/tx&lt;/a&gt;&lt;br/&gt;
	&lt;a href=&quot;http://www.springframework.org/schema/tx/spring-tx.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.springframework.org/schema/tx/spring-tx.xsd&lt;/a&gt; &lt;a href=&quot;http://cxf.apache.org/jaxws&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/jaxws&lt;/a&gt; &lt;a href=&quot;http://cxf.apache.org/schemas/jaxws.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/schemas/jaxws.xsd&lt;/a&gt;&lt;br/&gt;
	&lt;a href=&quot;http://camel.apache.org/schema/spring&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/schema/spring&lt;/a&gt; &lt;a href=&quot;http://camel.apache.org/schema/spring/camel-spring.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/schema/spring/camel-spring.xsd&lt;/a&gt;&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;route&amp;gt;&lt;br/&gt;
            &amp;lt;from uri=&quot;file:C:\\test&lt;br class=&quot;atl-forced-newline&quot; /&gt;in?charset=cp1251&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;!-&lt;del&gt;&amp;lt;convertBodyTo type=&quot;String&quot;&amp;gt;&amp;lt;/convertBodyTo&amp;gt;&lt;/del&gt;-&amp;gt;&lt;br/&gt;
            &amp;lt;convertBodyTo type=&quot;java.io.InputStream&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;to uri=&quot;file:C:\\test&lt;br class=&quot;atl-forced-newline&quot; /&gt;out&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/route&amp;gt;&lt;br/&gt;
    &amp;lt;/camelContext&amp;gt;&lt;br/&gt;
&amp;lt;/beans&amp;gt;&lt;/p&gt;

&lt;p&gt;when I uncomment conversion to String step then file processed and copied entirely. When step is commented, file clipped to position of &apos;&#1103;&#1103;&apos; symbols.&lt;/p&gt;</comment>
                            <comment id="16826717" author="mvlakh" created="Fri, 26 Apr 2019 07:09:26 +0000"  >&lt;p&gt;Hello&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=njiang&quot; class=&quot;user-hover&quot; rel=&quot;njiang&quot;&gt;njiang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I have a question regarding this issue and the way it was fixed. It seems like there is a defect or maybe I do not understand something, maybe you can help me?&lt;/p&gt;

&lt;p&gt;The issue is the following, I have a file consumer that I use to process XML files with UTF-8 charset. In my processor I am taking content of an incoming file like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
exchange.getIn().getBody(InputStream.class)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then I am passing it to XML parser together with configured charset (UTF-8) to make sure that reader, that is used by XML parser, will consume binary stream correctly.&#160;&lt;/p&gt;

&lt;p&gt;The issue is that if default system charset is not UTF-8 (valid case for my application) I am getting question marks instead of Chinese characters.&#160;&lt;/p&gt;

&lt;p&gt;After some debugging I found a strange thing,&#160;the converted, which is used to give me file body as InputStream, org.apache.camel.converter.IOConverter.toInputStream(File, String) does something strange, it reads characters from the file and them encodes them into system&apos;s default charset. This blew my mind, this looks wrong.&lt;/p&gt;

&lt;p&gt;When I take body as InputStream I am expecting to get a binary stream, not a re-encoded characters stream. The current behavior seems totally unexpected to me.&lt;/p&gt;

&lt;p&gt;Thank you for your answer in advance.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12774804">CAMEL-8346</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12701581" name="CAMEL8356-repaired-Test-and-adjusted-converter-imple.patch" size="4715" author="almond" created="Sat, 28 Feb 2015 12:49:28 +0000"/>
                            <attachment id="12698984" name="IOConverterCharsetTest.java" size="2211" author="almond" created="Sun, 15 Feb 2015 15:06:42 +0000"/>
                            <attachment id="12698901" name="german.iso-8859-1.txt" size="39" author="almond" created="Sat, 14 Feb 2015 12:13:37 +0000"/>
                            <attachment id="12698902" name="german.utf-8.txt" size="42" author="almond" created="Sat, 14 Feb 2015 12:13:37 +0000"/>
                            <attachment id="12737149" name="result.txt" size="1243" author="ssidashov" created="Wed, 3 Jun 2015 10:08:43 +0000"/>
                            <attachment id="12737148" name="source.txt" size="2287" author="ssidashov" created="Wed, 3 Jun 2015 10:08:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25n13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>