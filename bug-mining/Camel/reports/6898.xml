<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:07:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21238] camel-jbang - k8s run - Reloading project does not change route behaviour</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21238</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When running a project with `--dev` like this ...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jbang camel kubernetes run timer-log-route.yaml --logs --dev \
	   --gav=examples:timer-log:1.0.0 \
	   --trait container.imagePullPolicy=IfNotPresent \
	   --trait service.type=NodePort \
	   --runtime=quarkus
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see ...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Reloading project due to file change: timer-log-route.yaml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;without image re-build/deploy&lt;/p&gt;</description>
                <environment></environment>
        <key id="13592471">CAMEL-21238</key>
            <summary>camel-jbang - k8s run - Reloading project does not change route behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdiesler">Thomas Diesler</assignee>
                                    <reporter username="tdiesler">Thomas Diesler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Sep 2024 11:21:14 +0000</created>
                <updated>Thu, 26 Sep 2024 05:06:32 +0000</updated>
                            <resolved>Wed, 25 Sep 2024 12:01:08 +0000</resolved>
                                                    <fixVersion>4.8.1</fixVersion>
                    <fixVersion>4.9.0</fixVersion>
                                    <component>camel-jbang</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17882686" author="davsclaus" created="Wed, 18 Sep 2024 11:31:24 +0000"  >&lt;p&gt;Okay so reloading locally is to let quarkus trigger reloading in the same JVM where source files are updated and its out of the box in quarkus.&lt;/p&gt;

&lt;p&gt;Reloading in k8s can be&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;same as local, need to sync source code from camel-jbang user to running k8s container in the right folder.&lt;/li&gt;
	&lt;li&gt;do a container rebuild and restart the container&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And we can argue whether reload (dev mode) in k8s run should be supported or not.&#160;&lt;/p&gt;</comment>
                            <comment id="17882980" author="tdiesler" created="Thu, 19 Sep 2024 11:21:23 +0000"  >&lt;p&gt;I&apos;d say there is little benefit in k8s reload. AFAICS, it would do the same as stopping/deleting the current container (ctrl+c) followed by k8s run.&lt;br/&gt;
Can we remove the reload functionality from KubernetesRun?&lt;/p&gt;</comment>
                            <comment id="17882982" author="davsclaus" created="Thu, 19 Sep 2024 11:38:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christophd&quot; class=&quot;user-hover&quot; rel=&quot;christophd&quot;&gt;christophd&lt;/a&gt; did most of this command - so it may be good to get his perspective&lt;/p&gt;</comment>
                            <comment id="17882988" author="christophd" created="Thu, 19 Sep 2024 11:55:59 +0000"  >&lt;p&gt;When a source file changes it will rerun the project export, rebuild the container image and redeploy the application to Kubernetes. In your case the file changes should have been triggered the export. If it is not this is a bug. When you are running on MacOS the file change listener is known to be less performant and more unreliable compared to running on other operating systems.&lt;/p&gt;

&lt;p&gt;The rationale behind this is the same as local --dev mode. You do not need to manually stop and remove the deployment and you do not manually have to call the Camel JBang commands to re-export. It saves you some commands. Also, doing the re-export and doing a full redeploy has been the first simple approach. We could think of uploading the changed files to the running container and skip the re-export and re-deployment which also would be much faster. This needs to be explored and refined though.&lt;/p&gt;

&lt;p&gt;Do you folks really think that there is no benefit from --dev mode when connected to Kubernetes?&lt;/p&gt;</comment>
                            <comment id="17882997" author="davsclaus" created="Thu, 19 Sep 2024 12:03:51 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Yes I see benefit - its similar to Camel K, for folks that wants to quickly run directly inside k8s via the CLI and be able to edit a few files locally.&lt;/p&gt;

&lt;p&gt;The other mode can be explored later (create a Jira ticket for that).&lt;/p&gt;</comment>
                            <comment id="17883000" author="tdiesler" created="Thu, 19 Sep 2024 12:11:33 +0000"  >&lt;p&gt;I fixed a few issues with re-export that prevented re-deploy. Now, re-deploy starts, but there is an issue with the shutdown hook and re-capturing the output of the new k8s process. Currently (as you say), there is no in-container hot swap of camel resources in a running container (as we had in camel-k) and given all complexities and even the questionable idea of swapping stuff in an otherwise immutable container, I&apos;d prefer the cleaner route of re-export + re-deploy.&lt;/p&gt;

&lt;p&gt;From the usage perspective, it is ...&lt;/p&gt;

&lt;p&gt;ctrl+c&lt;br/&gt;
camel k8s run ...&lt;/p&gt;

&lt;p&gt;stopping the container already removes the k8s resources (because --dev cleanup)&lt;br/&gt;
camel k8s run, is the re-export + re-deploy&lt;/p&gt;

&lt;p&gt;yes, I really think that there is little benefit and lots of potential headache with hot swapping resources (i.e. what if I want to change two files)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17883777" author="tdiesler" created="Mon, 23 Sep 2024 08:32:27 +0000"  >&lt;p&gt;Most modern IDEs (e.g. IntelliJ, Eclipse) autosave modified source files. How would the --dev mode work when there are multiple edits? &lt;br/&gt;
Would it not be better to let the user trigger the (potentially lengthy) image build/deploy cycle for k8s.&lt;/p&gt;</comment>
                            <comment id="17884255" author="tdiesler" created="Tue, 24 Sep 2024 12:20:51 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/camel/pull/15672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/15672&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The suggested change takes a fresh look at k8s run --dev, it detail ...&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;export directory is different for each reload&lt;/li&gt;
	&lt;li&gt;avoid duplicate labels (due to reexport)&lt;/li&gt;
	&lt;li&gt;pod logging is more lenient and patiently waits for the reloaded pod (as for the original)&lt;/li&gt;
	&lt;li&gt;file watching a setup anew for each reload&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17884585" author="tdiesler" created="Wed, 25 Sep 2024 12:01:08 +0000"  >&lt;p&gt;Done&lt;/p&gt;</comment>
                            <comment id="17884586" author="davsclaus" created="Wed, 25 Sep 2024 12:02:54 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://github.com/tdiesler&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;@tdiesler&lt;/a&gt;&#160;your PR actually caused other tests to fail, as it seems like the export append&#160;&lt;tt&gt;-000&lt;/tt&gt;&#160;inside&#160;&lt;tt&gt;.camel-jbang-run&lt;/tt&gt;&#160;folder or some number to the name, so for example kubernetes delete test cannot find the project - because it does not know about the&#160;&lt;tt&gt;-000&lt;/tt&gt;&#160;stuff.&lt;/p&gt;

&lt;p&gt;Can you help fix these tests&lt;/p&gt;</comment>
                            <comment id="17884587" author="davsclaus" created="Wed, 25 Sep 2024 12:03:13 +0000"  >&lt;p&gt;See for example&#160;&lt;br/&gt;
KubernetesDeleteTest&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rhc0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>