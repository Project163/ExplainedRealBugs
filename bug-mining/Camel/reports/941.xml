<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:37:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2510] Mixing jetty/http in a route screws up the URI used by HttpClient</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2510</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Below test shows the Http producer can&apos;t build up right HttpRequest URI as a bridgeEndpoint.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JettyHttpTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; targetProducerUri = &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8542/someservice?bridgeEndpoint=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;throwExceptionOnFailure=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; targetConsumerUri = &lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8542/someservice?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sourceUri = &lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:6323/myservice?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sourceProducerUri = &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:6323/myservice&quot;&lt;/span&gt;;
&lt;/span&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetRootPath() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        MockEndpoint mock = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
        mock.expectedBodiesReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi! /someservice&quot;&lt;/span&gt;);

        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:root&quot;&lt;/span&gt;, &quot;&quot;);

        assertMockEndpointsSatisfied();
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetWithRelativePath() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        MockEndpoint mock = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
        mock.expectedBodiesReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi! /someservice/relative&quot;&lt;/span&gt;);
        
        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:relative&quot;&lt;/span&gt;, &quot;&quot;);
        assertMockEndpointsSatisfied();
        
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

                from(targetConsumerUri)
                    .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = exchange.getIn().getHeader(Exchange.HTTP_PATH, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
                            exchange.getOut().setBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hi! &quot;&lt;/span&gt; + path);
                        }   
                    });

                from(sourceUri)
                    .to(targetProducerUri);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:root&quot;&lt;/span&gt;)
                    .to(sourceProducerUri)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
                
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:relative&quot;&lt;/span&gt;)
                    .to(sourceProducerUri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/relative&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);

            }
        };
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12484711">CAMEL-2510</key>
            <summary>Mixing jetty/http in a route screws up the URI used by HttpClient</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="njiang">Willem Jiang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Mar 2010 13:45:23 +0000</created>
                <updated>Sun, 24 Apr 2011 10:00:40 +0000</updated>
                            <resolved>Wed, 10 Mar 2010 10:01:21 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12955142" author="romkal" created="Tue, 2 Mar 2010 12:06:36 +0000"  >&lt;p&gt;Should we really have such assertion in &lt;tt&gt;testGetWithRelativePath()&lt;/tt&gt; test?&lt;/p&gt;

&lt;p&gt;I believe we should have &lt;tt&gt;&quot;Hi! /someservice&quot;&lt;/tt&gt; returned, not &lt;tt&gt;&quot;Hi! /someservice/relative&quot;&lt;/tt&gt; and no &lt;tt&gt;matchOnUriPrefix&lt;/tt&gt; should be required on &lt;tt&gt;targetConsumerUri&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In other words I believe, that by default we shouldn&apos;t propagate HTTP_PATH or HTTP_URI at all from one endpoint to the other, because by default it is not what people would expect. I would propose having two different header names for overriding path for producer, and informative headers for requests received.from consumers.&lt;/p&gt;</comment>
                            <comment id="12955155" author="njiang" created="Wed, 3 Mar 2010 01:42:54 +0000"  >&lt;p&gt;Hi Roma,&lt;/p&gt;

&lt;p&gt;The change that I made is trying to support the http bridge out of box.&lt;/p&gt;

&lt;p&gt;If you want to route the all the request which URI is start with &quot;http://localhost:1234/route&quot; to &quot;http://localhost:4567/service&quot;,  camel need to lookup the request&apos;s HTTP_PATH to figure out the relative path and apply it to http producer to send the request.&lt;br/&gt;
The original code supports  this kind of route &quot;http://localhost:1234&quot; to &quot;http://host:4567/service&quot; , but doesn&apos;t supports the upper route.&lt;/p&gt;

&lt;p&gt;For the header of HTTP_PATH and HTTP_URI, cxfbean is using it to support the JAXRS resource location.&lt;/p&gt;
</comment>
                            <comment id="12955190" author="romkal" created="Wed, 3 Mar 2010 14:08:12 +0000"  >&lt;p&gt;I believe I was misunderstood &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not saying that we shouldn&apos;t send HTTP_PATH or HTTP_URI headers at all. I believe they are needed definitely (as you wrote earlier). I just believe that by default some other headers should be used to override the URI used at HttpProducer.&lt;/p&gt;

&lt;p&gt;Assuming we have a route like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/input?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;http://localhost:/output&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When someone sends a POST to &lt;tt&gt;&lt;a href=&quot;http://localhost/input/some/path&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost/input/some/path&lt;/a&gt;&lt;/tt&gt; the payload should be sent to &lt;tt&gt;&lt;a href=&quot;http://localhost/output&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost/output&lt;/a&gt;&lt;/tt&gt; not to &lt;tt&gt;&lt;a href=&quot;http://localhost/output/some/path&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost/output/some/path&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="12955160" author="davsclaus" created="Thu, 4 Mar 2010 07:44:41 +0000"  >&lt;p&gt;I to think there is something wrong with this commit.&lt;/p&gt;

&lt;p&gt;The changed code in HttpProducerHelper makes other situations fail now. &lt;br/&gt;
And why do you have this relative check?&lt;/p&gt;

&lt;p&gt;The 2 urls should IMHO always be considered absolute when bridging.&lt;/p&gt;

&lt;p&gt;I do think we need to find a new solution for this and revert the current change.&lt;/p&gt;</comment>
                            <comment id="12955204" author="davsclaus" created="Thu, 4 Mar 2010 08:07:03 +0000"  >&lt;p&gt;After digging a bit more I think we have an issue in Camel when you combine Jetty with Http, since Jetty will populate the Exchange with HTTP_* headers. And these headers influence when you invoke other http endpoints later in the route, as if you should &lt;b&gt;overrule&lt;/b&gt; the endpoint uri.&lt;/p&gt;

&lt;p&gt;We got a catch-22 situation since those HTTP_* headers should have been &lt;em&gt;informative&lt;/em&gt; and should not impact the routing.&lt;/p&gt;

&lt;p&gt;Currently I cannot se an easy solution without breaking backwards comparability, but I also recon that not many Camel end users will use those HTTP_* headers in their routes.&lt;br/&gt;
So maybe we can change camel-jetty, to use other header keys, that dont clash.&lt;/p&gt;

&lt;p&gt;Or the opposite that you must use HTTP_CUSTOM_* header to overrule. However this is a bigger change as Camel end users then must change their code.&lt;/p&gt;</comment>
                            <comment id="12955208" author="njiang" created="Thu, 4 Mar 2010 08:10:43 +0000"  >&lt;p&gt;@Claus,&lt;/p&gt;

&lt;p&gt;I need to make my change more clear, lets take the REST service as an example, the relative path could be used for URI template.&lt;br/&gt;
If we use the jetty and http component to build a bridge, my change will support it out of box.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/input?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;http://localhost:8080/outservice?bridgeEndpoint=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the HttpProducer, our police is the message header of HTTP_PATH and HTTP_URI can override the http endpoint configuration, and we introduce the bridgeEndpoint option to ignore the message header of HTTP_URI.    &lt;br/&gt;
If you want to this route implement Roman&apos;s requirement, current solution could be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rom(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/input?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).removeHeader(Exchange.HTTP_PATH).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;http://localhost:8080/outservice?bridgeEndpoint=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13024220" author="davsclaus" created="Sun, 24 Apr 2011 10:00:40 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76502</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01p0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>