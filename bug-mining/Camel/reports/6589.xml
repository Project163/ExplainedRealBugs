<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:03:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19996] camel-lra NullPointerException when creating a saga with invalid lra-url</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19996</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;There is a NullpointerException occurring, when&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;you start a new saga (required, automatic completion)&lt;/li&gt;
	&lt;li&gt;your configured lra is not valid (e.g. you get some arbitrary page from this url)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As a result, the request never ends and runs infinite.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.camel.service.lra.LRAClient.newLRA()
  is calling org.apache.camel.service.lra.LRAClient.toURL(Object)
    -&amp;gt; throw new RuntimeCamelException(ex);
--&amp;gt; this is kind of expected, but now the error is handled

the call was initiated by 

org.apache.camel.processor.saga.RequiredSagaProcessor.process(Exchange, AsyncCallback)

and ends up finally in 

org.apache.camel.processor.saga.SagaProcessor.ifNotException(Throwable, Exchange, boolean, CamelSagaCoordinator, CamelSagaCoordinator, AsyncCallback, Runnable) {
            if (ex != null) {
               exchange.setException(ex);
            if (handleCompletion) {
                handleSagaCompletion(exchange, coordinator, previousCoordinator, callback);
            } else {

Since org.apache.camel.processor.saga.SagaProcessor.handleSagaCompletion(Exchange, CamelSagaCoordinator, CamelSagaCoordinator, AsyncCallback) is called 
with completionMode == SagaCompletionMode.AUTO
            if (exchange.getException() != null) {
                coordinator.compensate().whenComplete(...
  coordinator is always null, because newSaga was not yet (sucessfully) executed&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since the NPE occurs during the errorHandling of the invalid URL itself, it is retried to infinity or something else happens, which never retunrs in awaitable time.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Proposal Fix&lt;/p&gt;

&lt;p&gt;A coordinator should only be null, if there is no saga present yet. So in this case it would be safe to call&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;callback.done(false)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of trying to call some methods of the coordinator to rollback.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13554253">CAMEL-19996</key>
            <summary>camel-lra NullPointerException when creating a saga with invalid lra-url</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="johbossle">Johannes Bo&#223;le</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Oct 2023 14:19:33 +0000</created>
                <updated>Mon, 16 Oct 2023 15:15:46 +0000</updated>
                            <resolved>Mon, 16 Oct 2023 15:15:46 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>3.20.8</fixVersion>
                    <fixVersion>3.21.2</fixVersion>
                    <fixVersion>3.22.0</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                    <fixVersion>4.2.0</fixVersion>
                                    <component>camel-lra</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17775785" author="davsclaus" created="Mon, 16 Oct 2023 14:47:23 +0000"  >&lt;p&gt;You are welcome to send a PR&lt;/p&gt;</comment>
                            <comment id="17775802" author="davsclaus" created="Mon, 16 Oct 2023 15:15:46 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kyyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>