<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:51:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17437] Camel-aws2-sqs: Deadletter fails with sqs client from registry (could impact more components)</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17437</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m investigating an error on camel-quarkus (&lt;a href=&quot;https://github.com/apache/camel-quarkus/issues/3436)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel-quarkus/issues/3436)&lt;/a&gt; and found that it is happening on camel itself. It affects probably more components, so I set &quot;camel-core&quot; as a component.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is a description:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;aws2-sqs allows to use client from contex, which is autowired into the component&lt;/li&gt;
	&lt;li&gt;if deadletter is used (via RouteBuilder), endpoint is created immediately (even if context is not started yet) - see BuilderSupport l434 (&lt;a href=&quot;https://github.com/apache/camel/blob/main/core/camel-core-model/src/main/java/org/apache/camel/builder/BuilderSupport.java#L434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;Creation of component fails, because there is no client which could be autowired (see &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-aws/camel-aws2-sqs/src/main/java/org/apache/camel/component/aws2/sqs/Sqs2Component.java#L73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I created junit reproducer in my fork - &lt;a href=&quot;https://github.com/JiriOndrusek/camel/commit/f8d294afae9c6919b19cb6ca6f7cec50570d6208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/JiriOndrusek/camel/commit/f8d294afae9c6919b19cb6ca6f7cec50570d6208&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13420798">CAMEL-17437</key>
            <summary>Camel-aws2-sqs: Deadletter fails with sqs client from registry (could impact more components)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jondruse">Jiri Ondrusek</assignee>
                                    <reporter username="jondruse">Jiri Ondrusek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2022 12:00:00 +0000</created>
                <updated>Tue, 11 Jan 2022 15:46:24 +0000</updated>
                            <resolved>Tue, 11 Jan 2022 15:46:24 +0000</resolved>
                                    <version>3.14.0</version>
                    <version>3.15.0</version>
                                    <fixVersion>3.14.1</fixVersion>
                    <fixVersion>3.15.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17469247" author="jondruse" created="Wed, 5 Jan 2022 12:01:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=acosentino&quot; class=&quot;user-hover&quot; rel=&quot;acosentino&quot;&gt;acosentino&lt;/a&gt; ) I assigned this issue to myself (I see it as a nice way of learning how those core processes work). But I understand that that you&apos;d like to fix it by yourselve, in that case please reassign issue to yourselves.&lt;br/&gt;
If you agree with me looking into this, I&apos;d appreciate any type of suggestion, you might have. Thank you in advance.&lt;/p&gt;</comment>
                            <comment id="17469262" author="jondruse" created="Wed, 5 Jan 2022 12:21:01 +0000"  >&lt;p&gt;I&apos;m adding a code for junit test in text form (in case that my commit is overwritten by accident)&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
public class SqsDeadletterWithClientRegistryLocalstackIT extends Aws2SQSBaseTest {&lt;/p&gt;

&lt;p&gt;    @EndpointInject(&quot;direct:start&quot;)&lt;br/&gt;
    private ProducerTemplate template;&lt;/p&gt;

&lt;p&gt;    @EndpointInject(&quot;mock:result&quot;)&lt;br/&gt;
    private MockEndpoint result;&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    protected CamelContext createCamelContext() throws Exception &lt;/p&gt;
{
        CamelContext ctx = super.createCamelContext();
        AmazonSQSClientMock awsSQSClient = new AmazonSQSClientMock();


        Sqs2Component sqs = ctx.getComponent(&quot;aws2-sqs&quot;, Sqs2Component.class);

        //todo if those 2 lines are enabled, test is successful, becouse it will use client from context
        sqs.getConfiguration().setAmazonSQSClient(null);
        ctx.getRegistry().bind(&quot;awsSQSClient&quot;, awsSQSClient);

        return ctx;

    }

&lt;p&gt;    @Test&lt;br/&gt;
    public void deadletter() throws Exception {&lt;br/&gt;
        result.expectedMessageCount(1);&lt;/p&gt;

&lt;p&gt;        Exchange exchange = template.send(&quot;direct:start&quot;, ExchangePattern.InOnly, new Processor() {&lt;br/&gt;
            public void process(Exchange exchange) throws Exception &lt;/p&gt;
{
                exchange.getIn().setBody(&quot;test1&quot;);
            }
&lt;p&gt;        });&lt;/p&gt;

&lt;p&gt;        assertMockEndpointsSatisfied();&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    protected RouteBuilder createRouteBuilder() throws Exception {&lt;/p&gt;

&lt;p&gt;        //todo use generated query name for usage with real aws provider&lt;br/&gt;
        return new RouteBuilder() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void configure() throws Exception {&lt;br/&gt;
                errorHandler(deadLetterChannel(&quot;aws2-sqs://deadletter?autoCreateQueue=true&quot;)&lt;br/&gt;
                        .useOriginalMessage());&lt;/p&gt;

&lt;p&gt;                from(&quot;direct:start&quot;).startupOrder(2).process(e -&amp;gt; &lt;/p&gt;
{throw new IllegalStateException();}
&lt;p&gt;).toF(&quot;aws2-sqs://%s?autoCreateQueue=true&quot;, sharedNameGenerator.getName());&lt;/p&gt;

&lt;p&gt;                from(&quot;aws2-sqs://deadletter&quot;).to(&quot;mock:result&quot;);&lt;br/&gt;
            }&lt;br/&gt;
        };&lt;br/&gt;
    }&lt;br/&gt;
}&lt;br/&gt;
```&lt;/p&gt;</comment>
                            <comment id="17469275" author="davsclaus" created="Wed, 5 Jan 2022 12:43:07 +0000"  >&lt;p&gt;Jiri, you are surely welcome to work on this.&lt;/p&gt;</comment>
                            <comment id="17469276" author="davsclaus" created="Wed, 5 Jan 2022 12:45:46 +0000"  >&lt;p&gt;Yeah the endpoint can likely be build at a late phase in the actual dead letter channel in an doInit or doStart phase etc.&lt;/p&gt;</comment>
                            <comment id="17469306" author="jondruse" created="Wed, 5 Jan 2022 13:22:30 +0000"  >&lt;p&gt;Postponing creation to later phase should work, this was also my intention. I&apos;ll try to achieve this, thanks.&lt;/p&gt;</comment>
                            <comment id="17470479" author="jondruse" created="Fri, 7 Jan 2022 09:39:39 +0000"  >&lt;p&gt;This issue could be closed after this reverting PR is merged (&lt;a href=&quot;https://github.com/apache/camel/pull/6674&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6674&lt;/a&gt;), because error is not happening at all. Problem was caused by the flaw in the reproducer test (see &lt;a href=&quot;https://github.com/apache/camel/pull/6674/files#diff-32c38baf67be071134dc969e3335ca18b722b02fc780365d77b833180028fa2fR40-L45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6674/files#diff-32c38baf67be071134dc969e3335ca18b722b02fc780365d77b833180028fa2fR40-L45&lt;/a&gt;). &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13421463">CAMEL-17455</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0y9kw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>