<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11980] PushTopic client doesn&apos;t clear refresh token after a long disconnected period</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11980</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The bayeux client implements a mechanism to reconnect to salesforce&apos;s pushtopic after a network failure.&lt;/p&gt;

&lt;p&gt;In production, we experienced a lost of network connection. Bayeux client tried to reconnect and failed to.&lt;br/&gt;
when analyzing, we saw a bunch of logs  &lt;/p&gt;

&lt;p&gt;o.a.c.c.s.i.s.SubscriptionHelper : Error restarting: Error during HANDSHAKE: 403::Handshake denied org.apache.camel.CamelException: Error during HANDSHAKE: 403::Handshake denied&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Failed to restart after pausing for 0 msecs &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;skipped...&amp;#93;&lt;/span&gt;&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Error restarting: Error during HANDSHAKE: 403::Handshake denied org.apache.camel.CamelException: Error during HANDSHAKE: 403::Handshake denied&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Failed to restart after pausing for 5000 msecs &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;skipped...&amp;#93;&lt;/span&gt;&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Error restarting: Error during HANDSHAKE: 403::Handshake denied org.apache.camel.CamelException: Error during HANDSHAKE: 403::Handshake denied&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Failed to restart after pausing for 24000 msecs &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;skipped...&amp;#93;&lt;/span&gt;&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Error restarting: Error during HANDSHAKE: 403::Handshake denied org.apache.camel.CamelException: Error during HANDSHAKE: 403::Handshake denied&lt;br/&gt;
o.a.c.c.s.i.s.SubscriptionHelper : Failed to restart after pausing for 30000 msecs &lt;/p&gt;

&lt;p&gt;o.a.c.c.s.SalesforceConsumer : Aborting restart attempt due to: Error during HANDSHAKE: 403::Handshake denied. Caused by: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.salesforce.api.SalesforceException - Aborting restart attempt due to: Error during HANDSHAKE: 403::Handshake denied&amp;#93;&lt;/span&gt; org.apache.camel.component.salesforce.api.SalesforceException: Aborting restart attempt due to: Error during HANDSHAKE: 403::Handshake denied&lt;br/&gt;
then the stacktrace.&lt;/p&gt;


&lt;p&gt;When going deeped in analyzing, we figure out that Salesforce, after such a loss of network, can answer by a 401 code (subscription to channel is not valid anymore)  and in some circumstances by a 403 code (authentication is not valid anymore - the refresh token has been invalidated by salesforce).&lt;/p&gt;

&lt;p&gt;401 code implies that the client reissue a login with same refreshToken.&lt;br/&gt;
403 code implies that the client reissue a new login phase ( thus invalidating the previous refreshToken).&lt;/p&gt;


&lt;p&gt;401 code is already handled by SubscriptionHelper, while 403 is not.&lt;br/&gt;
see the doStart() method after the handshakeError test&lt;/p&gt;</description>
                <environment>&lt;p&gt;Salesforce API version 41.0 (we don&apos;t know if this affect other API versions)&lt;/p&gt;</environment>
        <key id="13115590">CAMEL-11980</key>
            <summary>PushTopic client doesn&apos;t clear refresh token after a long disconnected period</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mabroukb">Mabrouk Belhout</reporter>
                        <labels>
                            <label>reliability</label>
                    </labels>
                <created>Thu, 2 Nov 2017 11:00:55 +0000</created>
                <updated>Thu, 2 Nov 2017 15:19:26 +0000</updated>
                            <resolved>Thu, 2 Nov 2017 15:19:26 +0000</resolved>
                                    <version>2.19.0</version>
                                    <fixVersion>2.19.5</fixVersion>
                    <fixVersion>2.20.1</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16235636" author="davsclaus" created="Thu, 2 Nov 2017 12:24:26 +0000"  >&lt;p&gt;Thanks for reporting. Would you be able to work on a github PR that fixes this and includes 403 as well.&lt;/p&gt;</comment>
                            <comment id="16235818" author="githubbot" created="Thu, 2 Nov 2017 14:32:12 +0000"  >&lt;p&gt;GitHub user mabroukb opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2074&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    clearing salesforce session when bayeux client receive 403 &lt;/p&gt;

&lt;p&gt;    clearing salesforce session when bayeux client receive 403 &lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-11980&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mabroukb/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mabroukb/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2074.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2074.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2074&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e7bd3962f16fe5e68304118cc8d717435d26217c&lt;br/&gt;
Author: Mabrouk Belhout &amp;lt;mabrouk.belhout@capgemini.com&amp;gt;&lt;br/&gt;
Date:   2017-11-02T13:49:23Z&lt;/p&gt;

&lt;p&gt;    clearing salesforce session when bayeux client receive 403 (&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-11980&lt;/a&gt;)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16235833" author="mabroukb" created="Thu, 2 Nov 2017 14:42:50 +0000"  >&lt;p&gt;I proposed a PR.&lt;br/&gt;
can you check ?&lt;/p&gt;</comment>
                            <comment id="16235879" author="githubbot" created="Thu, 2 Nov 2017 15:10:54 +0000"  >&lt;p&gt;Github user davsclaus closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2074&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mb0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>