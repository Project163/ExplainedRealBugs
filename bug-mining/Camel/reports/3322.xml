<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:10:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8905] encoding problems in jsonpath</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8905</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I detected three different encoding problems in jsonpath:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if jsonpath is called with an input stream which has an encoding different from the default encoding (given by Charset.defaultCharset()) then jsonpath still uses the default encoding. Error location in JsonPathEngine:&lt;br/&gt;
        else if (json instanceof InputStream) 
{
            InputStream is = (InputStream) json;
            return path.read(is, Charset.defaultCharset().displayName(), 
configuration);}&lt;/li&gt;
&lt;/ul&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if jsonpath is called with a json file whose encoding is different from UTF-8, then jsonpath still parses the document with UTF-8. Error location in JsonPathEngine:&lt;br/&gt;
       else if (json instanceof File) 
{
            File file = (File) json;
            return path.read(file, configuration);
       }
&lt;p&gt; path.read(file, configuration) uses always UTF-8&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if jsonpath is called with an URL pointing to a JSON document whose encoding is different from UTF-8, then jsonPath still parses the document with UTF-8. Error location in JsonPathEngine:&lt;br/&gt;
         else if (json instanceof URL) 
{
            URL url = (URL) json;
            return path.read(url, configuration);
         }
&lt;p&gt;path.read(url, configuration) uses UTF-8&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My solution proposal is to determine the encoding of the JSON documents automatically according to the specification RFC-4627 (&lt;a href=&quot;https://www.ietf.org/rfc/rfc4627.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ietf.org/rfc/rfc4627.txt&lt;/a&gt;; see chapter 3. Encoding) and then call the method path.read(jsonDocument,foundEncoding,configuration) with the found encoding. See attached patch.&lt;/p&gt;

&lt;p&gt;Actually I can commit the patch myself. However, I would like that somebody who is more familiar with jsonpath than I does review my patch.&lt;/p&gt;

&lt;p&gt;So please tell me if my patch can be accepted or not. I can then do the actual commit or I will discard the patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840517">CAMEL-8905</key>
            <summary>encoding problems in jsonpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="forsthofer">Franz Forsthofer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jun 2015 12:13:38 +0000</created>
                <updated>Sat, 18 Jul 2015 07:33:39 +0000</updated>
                            <resolved>Sat, 18 Jul 2015 07:33:39 +0000</resolved>
                                    <version>2.15.2</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-jsonpath</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14602384" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"  >&lt;p&gt;I attache the test files whose encodings are different from UTF-8 because they are not part of the patch. &lt;/p&gt;</comment>
                            <comment id="14604593" author="davsclaus" created="Sun, 28 Jun 2015 09:05:52 +0000"  >&lt;p&gt;Are you sure you have the IP clearance of the code? You may get the feeling that its some code copied from SAP (eg commerical company).&lt;/p&gt;

&lt;p&gt;+        // SAPJVM SS 2008-08-26 workaround for broken InputStreams that &lt;br/&gt;
+        // throw EOFException instead of returning -1&lt;/p&gt;
</comment>
                            <comment id="14605749" author="forsthofer" created="Mon, 29 Jun 2015 15:22:00 +0000"  >&lt;p&gt;The IP clearance is fine. The code is just an implementation of the encoding part of spec RFC 4627.&lt;/p&gt;

&lt;p&gt;But I am wondering if it is really a good idea to restrict the encoding of JSON documents to unicode as specified in RFC 4627. There is another specification of JSON: &lt;a href=&quot;http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf&lt;/a&gt;. In this spec no encoding is mentioned. &lt;/p&gt;

&lt;p&gt;Instead of automatically determining the charset from the Json document, one could get the endcoding via the method org.apache.camel.util.IOHelper.getCharSetName(Exchange)which determines the encoding from the message header Exchange.CHARSET_NAME or the exchange property Exchange.CHARSET_NAME. But with this solution the header or property must be set somehow.&lt;/p&gt;

&lt;p&gt;What is your opinion on this?&lt;/p&gt;</comment>
                            <comment id="14612907" author="forsthofer" created="Fri, 3 Jul 2015 06:44:43 +0000"  >&lt;p&gt;I Improved the patch further. I have introduced the header &quot;CamelJsonpathJsonEncoding&quot;. Here the user can specify the charset of the JSON document. In most of the cases it is not necessary to specify the charset in the header. If the charset is one of the unicode charsets then the charset can be determined automatically. Or if the message body is of type String or GenericFile with CharSet then also no charset must be specified.&lt;/p&gt;</comment>
                            <comment id="14628254" author="davsclaus" created="Wed, 15 Jul 2015 15:44:39 +0000"  >&lt;p&gt;The patch is IMHO to big of a change to do on an existing patch branch - less changes the better. I am okay for making changes to the next release eg 2.16.&lt;/p&gt;</comment>
                            <comment id="14628255" author="davsclaus" created="Wed, 15 Jul 2015 15:45:38 +0000"  >&lt;p&gt;Also it seems a bit too much we have to do this in Camel, and its not a function of jsonpath library itself. Have you got in contact with them? &lt;/p&gt;

&lt;p&gt;Isn&apos;t this a general problem in json-path and better to be fixed/improved there?&lt;/p&gt;</comment>
                            <comment id="14629278" author="forsthofer" created="Thu, 16 Jul 2015 06:27:38 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;you are right, the charset determination should not be part of camel. Actually it also should not be part of jayway/jsonpath, but be part of the used json parser. Currently jayway/jsonpath offers to use three different parsers: gson, jsonsmart, and jackson. Only the jackson parser offers the possibility to determine the charset. So the right way would be to move the function to gson and jsonsmart. But this will definitely take some time. I will try first to get into contact with jayway/jsonpath.&lt;/p&gt;

&lt;p&gt;Regards Franz&lt;/p&gt;</comment>
                            <comment id="14629344" author="davsclaus" created="Thu, 16 Jul 2015 07:09:47 +0000"  >&lt;p&gt;What does jsonpath use as parser by default? I assume its not jackson, and thus maybe this can be beneficial as an interim solution until those would work with encoding detection out of the box?&lt;/p&gt;

&lt;p&gt;And btw does the input stream wrapper work with &quot;stream caching&quot; eg they are re-readable so you can use them in a content based router as predicate, and then afterwards read the full stream again?&lt;/p&gt;</comment>
                            <comment id="14631073" author="forsthofer" created="Fri, 17 Jul 2015 09:13:58 +0000"  >&lt;p&gt;jasonpath uses by default the jsonsmart parser. I also think that we could use the proposed patch as interim solution until all parsers work with encoding detection. &lt;/p&gt;

&lt;p&gt;Concerning the stream caching: The stream wrapper does not effect the stream caching functionality because the stream wrapper is never returned as body of the Camel message. At least not in the proposed solution. Of course, one could think of other use cases for the stream wrapper where it is set to the message body. For example you could write a processor whose only purpose it is to detect the encoding of a JSON document and you could return the stream wrapper in the body. In this case one has to test whether stream caching works. My feeling is that it will work. However, one has to test this. But as I said, currently this is not the use case for the stream wrapper.&lt;/p&gt;

&lt;p&gt;So, shall I go on and commit the change?&lt;/p&gt;</comment>
                            <comment id="14631079" author="davsclaus" created="Fri, 17 Jul 2015 09:17:50 +0000"  >&lt;p&gt;I do think that you should add an option that can be used to turn this off (but it can be enabled by default). But for people that are using jackson etc then they can use their detection. And then also say in the documentation for this option its an interim solution until all parsers support the detection out of the box.&lt;/p&gt;

&lt;p&gt;Yeah go ahead.&lt;/p&gt;</comment>
                            <comment id="14632297" author="forsthofer" created="Sat, 18 Jul 2015 06:29:51 +0000"  >&lt;p&gt;Sorry for not explaining this earlier in more detail:&lt;br/&gt;
Jackson does offer the encoding detection. However jasonpath does not call the Jackson API with the encoding detection; jasonpath has hardcoded the &quot;UTF-8&quot; encoding. So currently I do not think that an option to turn off the encoding detection makes sense.&lt;br/&gt;
So I will go ahead without the switch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12743458" name="0001-jsonpath-automatic-charset-detection.patch" size="35638" author="forsthofer" created="Fri, 3 Jul 2015 06:44:43 +0000"/>
                            <attachment id="12742045" name="booksUTF16BE.json" size="1106" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742046" name="booksUTF16LE.json" size="1106" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742047" name="jsonUCS2BigEndianWithBOM.txt" size="238" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742048" name="jsonUCS2BigEndianWithoutBOM.txt" size="236" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742049" name="jsonUCS2LittleEndianWithBom.txt" size="238" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742050" name="jsonUCS2LittleEndianWithoutBOM.txt" size="236" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742051" name="jsonUTF32BEWithBOM.txt" size="476" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742052" name="jsonUTF32BEWithoutBOM.txt" size="472" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742053" name="jsonUTF32LEWithBOM.txt" size="476" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                            <attachment id="12742054" name="jsonUTF32LEWithoutBOM.txt" size="472" author="forsthofer" created="Fri, 26 Jun 2015 04:39:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ghl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>