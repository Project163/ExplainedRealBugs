<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:45:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4345] Synchronized code causes long delays and hangs for big applications especially with Blueprint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4345</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The DefaultCamelContext uses synchronized &quot;endpoints&quot; which ends up ultimately extending a LinkedHashMap through the LRUCache.  The LinkedHashMap is obviously not thread safe, so it requires synchronized guards when accessing the endpoints object.  This especially happens in the getEndpoint(s) calls in the DefaultCamelContext.  In large systems with lots of routes and on multicore systems, dynamically created routes (and many routes) can cause long delays and hang for long times since route creation and the starting of the camel route can occur in unison with synchronization.  In a blueprint container, such as Karaf, this can cause timeouts on the bundle and camel routes will appear to hang indefinately.  Thread dumps show the hangs occur on the synchronized call in getEndpoint(s).  The fix for this is to use concurrent apis as much as possible and remove the synchronized code.  I refactored the LRUCache/LRUSoftCache to use Google&apos;s ConcurrentLinkedHashMap (ASL2 License &lt;a href=&quot;http://code.google.com/p/concurrentlinkedhashmap&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/concurrentlinkedhashmap&lt;/a&gt;) and removed the synchronized code that locks the endpoints object.  This should remove the hangs since the locks are no longer required.  Since COncurrentLinkedHashmap is not OSGi ready, I have shaded the classes in core.  On my executions, all unit tests pass with this refactoring using the concurrent code.  This should speed up Camel on multicore systems that have lots of routes.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux and Mac multicore machines&lt;/p&gt;</environment>
        <key id="12519240">CAMEL-4345</key>
            <summary>Synchronized code causes long delays and hangs for big applications especially with Blueprint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hadrian">Hadrian Zbarcea</assignee>
                                    <reporter username="jgenender">Jeff Genender</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2011 05:18:18 +0000</created>
                <updated>Mon, 19 Sep 2011 17:44:37 +0000</updated>
                            <resolved>Fri, 19 Aug 2011 00:58:40 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.8.2</fixVersion>
                    <fixVersion>2.9.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13086820" author="jgenender" created="Thu, 18 Aug 2011 05:28:41 +0000"  >&lt;p&gt;Patch attached against TRUNK as of r1158987&lt;/p&gt;</comment>
                            <comment id="13087005" author="davsclaus" created="Thu, 18 Aug 2011 13:27:38 +0000"  >&lt;p&gt;Nice patch.&lt;/p&gt;

&lt;p&gt;By shading it into camel-core I like the fact that the camel-core dependency don&apos;t change.&lt;br/&gt;
However are there people who would not like shading this into camel-core?&lt;/p&gt;

&lt;p&gt;And are there any Apache policy that would discourage this fact?&lt;br/&gt;
eg the JAR contains .class files which are not from Apache ?&lt;/p&gt;

&lt;p&gt;If just the JDK had this class already. Even JDK7 dont have it, right?&lt;/p&gt;</comment>
                            <comment id="13087073" author="joed" created="Thu, 18 Aug 2011 15:55:36 +0000"  >&lt;p&gt;At least the google code is ASF License, would that help some?&lt;/p&gt;</comment>
                            <comment id="13087076" author="davsclaus" created="Thu, 18 Aug 2011 16:00:47 +0000"  >&lt;p&gt;Yeah the ASL license sure does &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think back in the days Spring framework included the aop alliance JAR in the Spring JAR directly as well.&lt;/p&gt;
</comment>
                            <comment id="13087083" author="dkulp" created="Thu, 18 Aug 2011 16:07:15 +0000"  >
&lt;p&gt;I have no problem shading it in, but does it need to be exported from the bundle in OSGi?&lt;/p&gt;

&lt;p&gt;Since it&apos;s completely an internal field, I don&apos;t think it does.   I&apos;d definitely prefer it didn&apos;t get exported so if some other project has a bundle with it, we don&apos;t conflict and such.&lt;/p&gt;</comment>
                            <comment id="13087133" author="ben.manes" created="Thu, 18 Aug 2011 17:29:25 +0000"  >&lt;p&gt;Please open an issue to OSGi-ify CLHM and I&apos;ll do it for the next release (no timeframe).&lt;/p&gt;

&lt;p&gt;As Google Guava is OSGi ready and I helped port the algorithm into MapMaker, that may also be a reasonable choice if it becomes a concern.&lt;/p&gt;

&lt;p&gt;I&apos;ll be meeting up with Doug Lea in Sept. to discuss caching for JDK8, so maybe we&apos;ll see something in the standard libs eventually.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Ben&lt;br/&gt;
(CLHM author, Googler)&lt;/p&gt;

&lt;p&gt;P.S. Don&apos;t you love Google Alerts? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13087141" author="hadrian" created="Thu, 18 Aug 2011 17:47:08 +0000"  >&lt;p&gt;@Ben, thanks for the offer and welcome to the Camel community &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13087427" author="hadrian" created="Fri, 19 Aug 2011 00:44:36 +0000"  >&lt;p&gt;Patch applied in r1159457 with thanks to Jeff. Jeff, we expect more from you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
There are a few checkstyle issues in the patch I will correct in the next hour or so and mark this issue as resolved.&lt;/p&gt;</comment>
                            <comment id="13087441" author="hadrian" created="Fri, 19 Aug 2011 00:58:40 +0000"  >&lt;p&gt;Fixed checkstyle and also removed the OSGi export of the google stuff. The intent I believe was to make it accessible to components, but we can do that via a utility factory if/when needed.&lt;/p&gt;

&lt;p&gt;Thanks Jeff!&lt;/p&gt;</comment>
                            <comment id="13087605" author="davsclaus" created="Fri, 19 Aug 2011 08:21:01 +0000"  >&lt;p&gt;The osgi manifest contains import of the google code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Import-Package: com.googlecode.concurrentlinkedhashmap,javax.activatio
 n;resolution:=optional,javax.management,javax.management.modelmbean,j
 avax.management.remote,javax.naming,javax.naming.spi,javax.net.ssl,ja
 vax.xml.bind;resolution:=optional,javax.xml.bind.annotation;resolutio
 n:=optional,javax.xml.bind.annotation.adapters;resolution:=optional,j
 avax.xml.namespace,javax.xml.parsers,javax.xml.stream;resolution:=opt
 ional,javax.xml.transform,javax.xml.transform.dom,javax.xml.transform
 .sax,javax.xml.transform.stream,javax.xml.validation,javax.xml.xpath,
 org.apache.xalan.xsltc.trax;resolution:=optional,org.osgi.framework;v
 ersion=&lt;span class=&quot;code-quote&quot;&gt;&quot;[1.4,2)&quot;&lt;/span&gt;,org.slf4j;version=&lt;span class=&quot;code-quote&quot;&gt;&quot;[1.6,2)&quot;&lt;/span&gt;,org.w3c.dom,org.xml.sax
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I cannot see that its being exported, so I would assume we are almost okay.&lt;/p&gt;

&lt;p&gt;What if another bundle exports com.googlecode.concurrentlinkedhashmap,&lt;br/&gt;
then camel-core could potential pickup that instead from itself, or am I mistaking?&lt;/p&gt;</comment>
                            <comment id="13087606" author="davsclaus" created="Fri, 19 Aug 2011 08:21:46 +0000"  >&lt;p&gt;Did anyone create a ticket at Google CLHM to ask for osgify the distribution, as Ben said we should do?&lt;/p&gt;</comment>
                            <comment id="13087662" author="jgenender" created="Fri, 19 Aug 2011 11:34:17 +0000"  >&lt;p&gt;Claus, yes I opened an issue to OSGI-ify ConcurrentLinkedHashMap.&lt;/p&gt;

&lt;p&gt;Good catch on the import... it should not be in there.... clearly the Felix runs before the shade &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  &lt;/p&gt;

&lt;p&gt;The fix is in the camel-core pom, right under the &amp;lt;camel.osgi.import&amp;gt;, add this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;!com.googlecode.concurrentlinkedhashmap,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That will fix it.&lt;/p&gt;</comment>
                            <comment id="13087678" author="davsclaus" created="Fri, 19 Aug 2011 12:26:01 +0000"  >&lt;p&gt;I have applied that last change in osgi imports. And ran the osgi tests. All seems fine. Even camel-cxf which uses LRUCache from camel-core. It works also in osgi with that change above.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490756" name="CAMEL-4345.patch" size="15072" author="jgenender" created="Thu, 18 Aug 2011 05:28:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i020d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9660</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>