<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:08:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21319] Supervising routecontroller doesn&apos;t play nicely with SMPP if the SMS-C is down on route startup</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21319</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Say I have two routes in a RouteBuilder:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SimpleTestRouteBuilder &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RouteBuilder&#160;
{
&#160; &#160; @Override
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception&#160;
&#160; &#160; { &#160; &#160;
&#160; &#160; &#160; &#160; from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:/foo?repeatCount=20&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;smpp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:2775&quot;&lt;/span&gt;);
&lt;/span&gt;&#160; &#160; &#160; &#160;&#160;
&#160; &#160; &#160; &#160; from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:/foo2?repeatCount=20&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;smpp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:2776&quot;&lt;/span&gt;); &#160; &#160; &#160; &#160;
&lt;/span&gt;&#160; &#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(in practice you would populate your message body - and read from an MQ Queue or whatever)&lt;/p&gt;

&lt;p&gt;When I start the application up, if either route can&apos;t connect to its producer, then the application will shut down - fine.&lt;/p&gt;

&lt;p&gt;SupervisingRouteController (&lt;a href=&quot;https://camel.apache.org/manual/route-controller.html#_supervisingroutecontroller&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;See Docs&lt;/a&gt;) is intended to overcome this limitation - &quot;This controller is able to retry starting failing routes&quot;.&lt;/p&gt;

&lt;p&gt;So I then configure my application.yaml to use this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
camel:
&#160; routecontroller:
&#160; &#160; enabled: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&#160; &#160; backoffDelay: 5000
&#160; &#160; backoffMaxAttempts: 17280
&#160; &#160; initialDelay: 1000
&#160; &#160; threadPoolSize: 2
&#160; &#160; unhealthyOnExhausted: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&#160; &#160; unhealthyOnRestarting: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&#160; &#160; includeRoutes: &lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;However, if the first SMS-C is not running, the application won&apos;t start! It just shuts down after an attempt to start the route.&lt;/p&gt;

&lt;p&gt;Some digging showed me that the &quot;warmup&quot; that the camel context does starts the processors (i.e. calling startup in SmppProducer.java to open the connection to the SMS-C) before the SupervisingRouteController kicks in and takes over control of the route.&lt;/p&gt;

&lt;p&gt;In my mind, this shouldn&apos;t happen. If the Producer can&apos;t connect, it should either retry until it can (or at least that should be a configurable option); or the SRC should be able to take control (by not starting the endpoint on warmup, but rather on route startup).&lt;/p&gt;

&lt;p&gt;Additionally, and weirdly, with my example above, if the &lt;em&gt;second&lt;/em&gt; SMS-C (on port 2776) is down, but the one on port 2775 is &lt;em&gt;up&lt;/em&gt;, then the application behaves exactly as I would expect &#8211; the SRC takes over and retries the second route until the connection is available again. It&apos;s almost like Camel is only warming up the first route? But I&apos;m not 100% sure on that point.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Anyway, the DefaultSupervisingRouteController code is working as intended - it only kicks in after warmup. But the camel-smpp code isn&apos;t allowing it to do its job because the warmup kills the application too soon.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13594336">CAMEL-21319</key>
            <summary>Supervising routecontroller doesn&apos;t play nicely with SMPP if the SMS-C is down on route startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simonalexander2005">Simon Alexander</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Oct 2024 15:44:59 +0000</created>
                <updated>Tue, 8 Oct 2024 08:20:38 +0000</updated>
                            <resolved>Mon, 7 Oct 2024 17:46:56 +0000</resolved>
                                    <version>4.4.1</version>
                                                    <component>camel-smpp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17886972" author="davsclaus" created="Fri, 4 Oct 2024 16:42:08 +0000"  >&lt;p&gt;You can use lazy start producer, and for retry you have camel&apos;s error handler that can be configured a million ways&lt;/p&gt;</comment>
                            <comment id="17886991" author="JIRAUSER307270" created="Fri, 4 Oct 2024 17:46:45 +0000"  >&lt;p&gt;Thanks Claus, but that doesn&apos;t work if the SMPP component is set up for a transceiver (TRX) connection - then it really needs to try and connect as soon as possible, as it&apos;s acting as both a producer and a consumer&lt;/p&gt;</comment>
                            <comment id="17887175" author="davsclaus" created="Sun, 6 Oct 2024 07:35:02 +0000"  >&lt;p&gt;Okay maybe you can take a look in the camel-smpp source code and see if there is something to fix/improve. We love contributions&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://camel.apache.org/community/contributing/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/community/contributing/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17887176" author="davsclaus" created="Sun, 6 Oct 2024 07:39:53 +0000"  >&lt;p&gt;Okay so are you using messageReceiverRouteId in the producer that seems to be creating that TRX connection you talk about? And it setup this during doStart unless you turn on lazySessionCreation or lazyStartProducer&lt;/p&gt;</comment>
                            <comment id="17887179" author="davsclaus" created="Sun, 6 Oct 2024 08:10:41 +0000"  >&lt;p&gt;Added unit test using supervised and it will restart the route until the connector works&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/9955251f90963e6b0c1108782e45258198935f7f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/9955251f90963e6b0c1108782e45258198935f7f&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Try with latest Camel 4.8.x release&lt;/p&gt;</comment>
                            <comment id="17887300" author="JIRAUSER307270" created="Mon, 7 Oct 2024 09:50:31 +0000"  >&lt;p&gt;It&apos;s odd then - there&apos;s basically no difference between my actual code and your test code, but even when running 4.8.x my supervising route controller doesn&apos;t seem to be catching it. I can run your new integration test and it acts as I would expect.&lt;/p&gt;

&lt;p&gt;The only difference is that I am using `SpringApplication.run(Application.class, args);` to start my application, then I&apos;m using `@Bean CommandLineRunner init...`&#160; and calling `context.addRoutes` (where context is `@Autowired`). So I&apos;m starting the application using Spring. Could that make a difference?&lt;/p&gt;</comment>
                            <comment id="17887304" author="davsclaus" created="Mon, 7 Oct 2024 10:02:57 +0000"  >&lt;p&gt;I dont know - we only support running camel on spring via camel-spring-boot and its standard way. If you do something a bit custom, then its better you research yourself&lt;/p&gt;</comment>
                            <comment id="17887513" author="JIRAUSER307270" created="Tue, 8 Oct 2024 08:20:38 +0000"  >&lt;p&gt;For completeness, I reverted back to not using the conmandlinerunner and it&apos;s working fine now - so that&apos;s odd. Something about how spring camel deals with exceptions that way I guess&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rsts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>