<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:54:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5722] Classloader mixup when consumers across bundles share the same camel-jetty port</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5722</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Happens in an OSGi environment; but it is also applicable in modular servers that build dynamic classloaders (e.g. JBoss AS) per deployed artifacts (WAR, module, EAR, etc.).&lt;/p&gt;

&lt;p&gt;If bundles A and B are both creating camel-jetty consumers on the same TCP port, the consumers will share the underlying Jetty connector. Moreover, the Jetty connector is indeed created by the first consumer that initialises on that TCP port.&lt;/p&gt;

&lt;p&gt;Since the Camel route executes on the Jetty Connector thread, all class resolutions will happen against the classloader of the bundle that initialises first.&lt;/p&gt;

&lt;p&gt;This makes class resolution absolutely undeterministic and erratic. Quite a nasty bug IMHO.&lt;/p&gt;

&lt;p&gt;Perhaps this can be fixed by adding a call to &lt;tt&gt;Thread.setContextClassLoader()&lt;/tt&gt; passing the classloader of the JettyHttpEndpoint, as soon as a request comes in?&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSGi environment, Karaf 2.2.2.&lt;/p&gt;</environment>
        <key id="12612837">CAMEL-5722</key>
            <summary>Classloader mixup when consumers across bundles share the same camel-jetty port</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="raulvk">Ra&#250;l Kripalani</assignee>
                                    <reporter username="raulvk">Ra&#250;l Kripalani</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Oct 2012 16:02:25 +0000</created>
                <updated>Sat, 27 Oct 2012 18:33:46 +0000</updated>
                            <resolved>Sat, 27 Oct 2012 18:33:46 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.5</fixVersion>
                    <fixVersion>2.10.3</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-jetty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13480767" author="raulvk" created="Sat, 20 Oct 2012 16:03:38 +0000"  >&lt;p&gt;Have only been able to test in Camel 2.8.0. Will test on a later release and provide feedback.&lt;/p&gt;</comment>
                            <comment id="13480941" author="njiang" created="Sun, 21 Oct 2012 10:02:15 +0000"  >&lt;p&gt;We have faced the same issue in camel-jaxb, to resolve it we put the bundle class loader as application class laoder into the bus and it can be get by the CXF run time, so the TCCL can be set with the application class loader whenever the camel need. &lt;br/&gt;
@Raul, to resolve the issue that you faced, you can use the CamelContext.getApplicationContxt() to set the TCCL on the CamelContinuationServlet.&lt;/p&gt;</comment>
                            <comment id="13480943" author="raulvk" created="Sun, 21 Oct 2012 10:14:25 +0000"  >&lt;p&gt;Thanks a lot for the indications. I have confirmed that setting the TCCL to the classloader from CamelContext.getApplicationContextClassLoader() does the trick.&lt;/p&gt;

&lt;p&gt;Since the Jetty consumer is async, I just wondered if we also have to do something special on the AsyncCallbacks?&lt;/p&gt;</comment>
                            <comment id="13480991" author="raulvk" created="Sun, 21 Oct 2012 16:39:36 +0000"  >&lt;p&gt;Working on a fix. So far I have an itest-osgi that reproduces the issue.&lt;/p&gt;</comment>
                            <comment id="13484059" author="davsclaus" created="Thu, 25 Oct 2012 12:15:55 +0000"  >&lt;p&gt;Any update on this issue?&lt;/p&gt;</comment>
                            <comment id="13484061" author="davsclaus" created="Thu, 25 Oct 2012 12:17:14 +0000"  >&lt;p&gt;I guess a generic solution is to let the UnitOfWorkProcessor that is 1st on the route processors, set the TCCL and restore it on done. Then it may be a generic fix for all use-cases&lt;/p&gt;</comment>
                            <comment id="13485470" author="raulvk" created="Sat, 27 Oct 2012 16:50:19 +0000"  >&lt;p&gt;Yep, I committed fixes on r1400729 and r1400734 on 21/10. There was also some discussion on the mailing list regarding other cases to consider.&lt;/p&gt;

&lt;p&gt;Claus, that&apos;s another solution, but most consumers allow for some custom logic to execute before the route kicks in, e.g. HttpBinding and the like. The UoW processor wouldn&apos;t account for those scenarios, or would it?&lt;/p&gt;</comment>
                            <comment id="13485473" author="raulvk" created="Sat, 27 Oct 2012 17:05:26 +0000"  >&lt;p&gt;I think this can also be a problem in the Direct VM component, if a new Exchange is not created at the consumer side... I&apos;ll check.&lt;/p&gt;</comment>
                            <comment id="13485477" author="raulvk" created="Sat, 27 Oct 2012 18:07:02 +0000"  >&lt;p&gt;Yep, filed &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5748&quot; title=&quot;Classloader mixup in Direct VM component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5748&quot;&gt;&lt;del&gt;CAMEL-5748&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12613768">CAMEL-5748</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0apcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>