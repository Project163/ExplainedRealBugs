<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:47:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4650] NPE when using SEDA route and attaching an extra consumer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4650</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m trying to construct a system for moving some seda queues over to&lt;br/&gt;
ActiveMQ during system shutdown. What I did was create a Route that&lt;br/&gt;
connects to some of my seda queues and then drains the queue to activemq.&lt;/p&gt;

&lt;p&gt;Basicly I got two routes, the drainer:&lt;/p&gt;

&lt;p&gt;from(&quot;seda:&quot; + sedaId + &quot;?size=1000&quot;)&lt;br/&gt;
                    .routeId(routeName +&lt;br/&gt;
sedaIs).noAutoStartup().to(activeMQFailuresQueue);&lt;/p&gt;


&lt;p&gt;And the main route:&lt;/p&gt;

&lt;p&gt;from(&quot;seda:&quot; + sedaId + &quot;?size=1000&quot;)&lt;br/&gt;
                    .routeId(routeName + sedaIs).to(SomeProcessor);&lt;/p&gt;

&lt;p&gt;Now, sometimes the main route stalls for various reasons I need to&lt;br/&gt;
restart the jvm process it is running in, so I start the first route.&lt;br/&gt;
But when trying this in production, I got:&lt;/p&gt;

&lt;p&gt; java.lang.NullPointerException&lt;br/&gt;
    at&lt;br/&gt;
org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:210)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:155)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:129)&lt;br/&gt;
    at&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
    at&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;


&lt;p&gt;Bvahdat added a comment:&lt;br/&gt;
just a very tiny pointer:&lt;/p&gt;

&lt;p&gt;Looking at the source it seems that  the&lt;br/&gt;
SedaEndpoint.getConsumerMulticastProcessor() method returns &apos;null&apos; causing&lt;br/&gt;
the NPE, as the condition:&lt;/p&gt;

&lt;p&gt;multicastStarted == false || consumerMulticastProcessor == null&lt;/p&gt;

&lt;p&gt;is true.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 6, Camel 2.8.2, Centos 4.&lt;/p&gt;</environment>
        <key id="12530849">CAMEL-4650</key>
            <summary>NPE when using SEDA route and attaching an extra consumer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="tarjei@scanmine.com">Tarjei Huse</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Nov 2011 10:47:47 +0000</created>
                <updated>Fri, 18 Nov 2011 01:44:36 +0000</updated>
                            <resolved>Tue, 15 Nov 2011 12:08:24 +0000</resolved>
                                    <version>2.8.2</version>
                                    <fixVersion>2.8.3</fixVersion>
                    <fixVersion>2.9.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13146956" author="bvahdat" created="Wed, 9 Nov 2011 11:40:46 +0000"  >&lt;p&gt;I did a typo in the user forum about the condition which holds, causing the NPE. Correctly it&apos;s:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;multicastStarted == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; || consumerMulticastProcessor == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at SedaConsumer.sendToConsumers() it&apos;s:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void sendToConsumers(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = endpoint.getConsumers().size();

        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are multiple consumers then multicast to them
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;gt; 1) {

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
                LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Multicasting to {} consumers &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Exchange: {}&quot;&lt;/span&gt;, endpoint.getConsumers().size(), exchange);
            }
           
            &lt;span class=&quot;code-comment&quot;&gt;// use a multicast processor to process it
&lt;/span&gt;            MulticastProcessor mp = endpoint.getConsumerMulticastProcessor();

            &lt;span class=&quot;code-comment&quot;&gt;// and use the asynchronous routing engine to support it
&lt;/span&gt;            AsyncProcessorHelper.process(mp, exchange, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncCallback() {
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void done(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; doneSync) {
                    &lt;span class=&quot;code-comment&quot;&gt;// noop
&lt;/span&gt;                }
            });
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// use the regular processor and use the asynchronous routing engine to support it
&lt;/span&gt;            AsyncProcessorHelper.process(processor, exchange, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncCallback() {
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void done(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; doneSync) {
                    &lt;span class=&quot;code-comment&quot;&gt;// noop
&lt;/span&gt;                }
            });
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which as you see does call:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;endpoint.getConsumerMulticastProcessor();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But doesn&apos;t take into the account that the returned reference (of type MulticastProcessor) could be null. In your case it &lt;b&gt;was&lt;/b&gt; null, as apparently the condition I mentioned in user forum holds.  &lt;/p&gt;

&lt;p&gt;I would love to provide a patch for this, but the SedaEndpoint is to me one of those non-trivial camel&apos;s endpoint (concurrency was / is never trivial &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;

&lt;p&gt;If some camel riders could give me a hint, I would assign the ticket to myself and would provide a patch (including a unit-test) proving the fix.&lt;/p&gt;</comment>
                            <comment id="13147042" author="bvahdat" created="Wed, 9 Nov 2011 13:33:53 +0000"  >&lt;p&gt;@Tarjei, could you please give me some hints:&lt;/p&gt;

&lt;p&gt;Are your both routes (you called them the main &amp;amp; the drainer one) in the same camel context? If so I wonder how it should work &lt;b&gt;at all&lt;/b&gt; as you would consume twice using exactly the same seda uri in the same camel context as soon as you start the drainer route (for example through jmx)! IMHO the camel behaviour in this case would be undefined / unpredictable when a new message would arrive at this time to the seda endpoint.&lt;/p&gt;

&lt;p&gt;The Java-DSL doesn&apos;t inhibit you to do that and the code would of course compile but at runtime using the from() clause you would &lt;b&gt;concurrently&lt;/b&gt; consume twice using the same seda endpoint java object, again the uri by both routes seems to me to be exactly the same:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:&quot;&lt;/span&gt; + sedaId + &lt;span class=&quot;code-quote&quot;&gt;&quot;?size=1000&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I propose to use the try/catch or onException clause to send the failed messsages (the not processed ones) to some endpoints (for example &quot;direct:failed&quot;) and as soon as you start the drainer route you would consume from that endpoint in drainer route instead of consuming &lt;b&gt;concurrently&lt;/b&gt; from the seda endpoint together with the main route at &lt;b&gt;the same time&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13147551" author="tarjei@scanmine.com" created="Thu, 10 Nov 2011 08:34:11 +0000"  >&lt;p&gt;Hi Babak,&lt;/p&gt;

&lt;p&gt;1. Yes both routes are in the same context.&lt;/p&gt;

&lt;p&gt;2. Yes the point is to consume from the same seda endpoint. Think of this endpoint as a buffer between processes that take differing amounts of time and should not happen sequentially. &lt;/p&gt;

&lt;p&gt;3. I got an errorhandler for shorter errors like this:&lt;/p&gt;

&lt;p&gt;.onException(java.net.ConnectException.class, SolrServerException.class, SolrException.class)&lt;br/&gt;
	.log(LoggingLevel.ERROR,routeName+ &quot;:Connection down&quot;)&lt;br/&gt;
				.maximumRedeliveries(4)&lt;br/&gt;
				.backOffMultiplier(1)&lt;br/&gt;
				.redeliveryDelay(redeliveryDelay)&lt;br/&gt;
				.to(&quot;log:SolrRouteError?showAll=true&amp;amp;showStackTrace=true&amp;amp;showHeaders=true&amp;amp;showException=true&quot;)&lt;br/&gt;
				.to(getSolrFailuresQueue())&lt;br/&gt;
				.handled(true)&lt;br/&gt;
				.end()&lt;/p&gt;

&lt;p&gt;The problem is that on some errors the time it takes for a request can be quite long so the seda queue builds up.&lt;/p&gt;

&lt;p&gt;Maybe I should shut down the consuming route before starting the drainer - would that help?&lt;/p&gt;</comment>
                            <comment id="13147558" author="bvahdat" created="Thu, 10 Nov 2011 08:51:07 +0000"  >&lt;p&gt;Yeah try stopping the main route first before starting the drainer one and see if you can still reproduce the NPE. And before starting the drainer route make sure that the main route is &lt;b&gt;really&lt;/b&gt; stopped.&lt;/p&gt;

&lt;p&gt;For example with a JMX client like JConsole you can check it through the getState() operation of the main route, of course I assume you have not disabled the Camel&apos;s JMX support, see:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://camel.apache.org/camel-jmx.html#CamelJMX-UsingJMXtomanageApacheCamel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/camel-jmx.html#CamelJMX-UsingJMXtomanageApacheCamel&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13147832" author="bvahdat" created="Thu, 10 Nov 2011 17:14:43 +0000"  >&lt;p&gt;I could reproduce your issue on the trunk through a 2 liner change of &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; as the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SedaConcurrentConsumersTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ContextTestSupport {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSendToSeda() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        MockEndpoint mock = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
        mock.expectedBodiesReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;);

        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:foo?concurrentConsumers=5&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;);

        assertMockEndpointsSatisfied();
        
        context.getRoutes().get(0).getConsumer().start();
        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:foo?concurrentConsumers=5&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Claus absence today is a showstopper!&quot;&lt;/span&gt;);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:foo?concurrentConsumers=5&quot;&lt;/span&gt;).noAutoStartup().to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
                
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:foo?concurrentConsumers=5&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
            }
        };
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which blows up with a NPE exactly on the same place as yours:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2011-11-10 17:58:42,108 [main           ] INFO  DefaultCamelContext            - Apache Camel  (CamelContext: camel-1) is starting
2011-11-10 17:58:42,155 [main           ] INFO  AnnotationTypeConverterLoader  - Found 3 packages with 15 @Converter classes to load
2011-11-10 17:58:42,217 [main           ] INFO  LazyLoadingTypeConverter       - Loaded 163 core type converters (total 163 type converters)
2011-11-10 17:58:42,327 [main           ] INFO  DefaultCamelContext            - Cannot start route route1 as its configured with autoStartup=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2011-11-10 17:58:42,327 [main           ] INFO  DefaultCamelContext            - Route: route2 started and consuming from: Endpoint[seda:&lt;span class=&quot;code-comment&quot;&gt;//foo?concurrentConsumers=5]
&lt;/span&gt;2011-11-10 17:58:42,327 [main           ] INFO  DefaultCamelContext            - Total 2 routes, of which 1 is started.
2011-11-10 17:58:42,327 [main           ] INFO  DefaultCamelContext            - Apache Camel  (CamelContext: camel-1) started in 0.282 seconds
2011-11-10 17:58:42,358 [main           ] INFO  MockEndpoint                   - Asserting: Endpoint[mock:&lt;span class=&quot;code-comment&quot;&gt;//result] is satisfied
&lt;/span&gt;2011-11-10 17:58:42,358 [main           ] INFO  DefaultCamelContext            - Apache Camel  (CamelContext:camel-1) is shutting down
2011-11-10 17:58:42,358 [main           ] INFO  DefaultShutdownStrategy        - Starting to graceful shutdown 1 routes (timeout 10 seconds)
2011-11-10 17:58:42,374 [#1 - seda:&lt;span class=&quot;code-comment&quot;&gt;//foo] ERROR SedaConsumer                   - Error processing exchange. Exchange[Message: Second Hello World]. Caused by: [java.lang.NullPointerException - &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]
&lt;/span&gt;java.lang.NullPointerException
	at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)[file:/D:/Data/eclipse-workspace/camel/camel-core/target/classes/:]
	at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:210)[file:/D:/Data/eclipse-workspace/camel/camel-core/target/classes/:]
	at org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:155)[file:/D:/Data/eclipse-workspace/camel/camel-core/target/classes/:]
	at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:129)[file:/D:/Data/eclipse-workspace/camel/camel-core/target/classes/:]
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)[:1.6.0_29]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)[:1.6.0_29]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)[:1.6.0_29]
2011-11-10 17:58:43,374 [ - ShutdownTask] INFO  DefaultShutdownStrategy        - Route: route2 shutdown complete, was consuming from: Endpoint[seda:&lt;span class=&quot;code-comment&quot;&gt;//foo?concurrentConsumers=5]
&lt;/span&gt;2011-11-10 17:58:43,374 [main           ] INFO  DefaultShutdownStrategy        - Graceful shutdown of 1 routes completed in 1 seconds
2011-11-10 17:58:43,374 [main           ] INFO  DefaultInflightRepository      - Shutting down with no inflight exchanges.
2011-11-10 17:58:43,374 [main           ] INFO  DefaultCamelContext            - Uptime: 1.329 seconds
2011-11-10 17:58:43,374 [main           ] INFO  DefaultCamelContext            - Apache Camel  (CamelContext: camel-1) is shutdown in 1.016 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a clear evidence for me that while you start the drainer route, the main route is &lt;b&gt;still&lt;/b&gt; running causing the NPE as a side effect.&lt;/p&gt;

&lt;p&gt;Again IMHO you misuse the Camel&apos;s provided Java-DSL. See my previous comments on this ticket for a possible fix of it.&lt;/p&gt;

&lt;p&gt;I leave the closing of this ticket to you, as to my understanding it&apos;s definitely &lt;b&gt;not&lt;/b&gt; a bug but just a side effect of the API-misusage.&lt;/p&gt;

&lt;p&gt;Good luck&lt;br/&gt;
Babak &lt;/p&gt;





&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/component/seda/SedaConcurrentConsumersTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/component/seda/SedaConcurrentConsumersTest.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13147911" author="tarjei@scanmine.com" created="Thu, 10 Nov 2011 18:50:27 +0000"  >&lt;p&gt;Babak, thank you for working on this issue. &lt;/p&gt;

&lt;p&gt;As it stands, it is an api misuse, and I will close the bug.&lt;/p&gt;

&lt;p&gt;T&lt;/p&gt;</comment>
                            <comment id="13147912" author="tarjei@scanmine.com" created="Thu, 10 Nov 2011 18:50:50 +0000"  >&lt;p&gt;Closed as API misuse. &lt;/p&gt;</comment>
                            <comment id="13150347" author="davsclaus" created="Tue, 15 Nov 2011 10:16:48 +0000"  >&lt;p&gt;Regardless if its an API misuse etc. then Camel should shield itself better and report a IllegalArgumentException or IllegalStateException etc. with a better error description what is wrong.&lt;/p&gt;

&lt;p&gt;We should generally avoid any NPE being thrown inside Camel code.&lt;/p&gt;</comment>
                            <comment id="13150350" author="bvahdat" created="Tue, 15 Nov 2011 10:26:01 +0000"  >&lt;p&gt;Absolutely agree on that.&lt;/p&gt;</comment>
                            <comment id="13150384" author="davsclaus" created="Tue, 15 Nov 2011 11:12:57 +0000"  >&lt;p&gt;The unit test above can be fixed if you start the route correctly using the startRoute method form CamelContext&lt;/p&gt;</comment>
                            <comment id="13150385" author="davsclaus" created="Tue, 15 Nov 2011 11:14:25 +0000"  >&lt;p&gt;Ah sorry I can still reproduce the NPE. Will try to add some configuration check.&lt;/p&gt;</comment>
                            <comment id="13150411" author="bvahdat" created="Tue, 15 Nov 2011 11:59:45 +0000"  >&lt;p&gt;I think that the problem/challenge resides in the fact that camel-core doesn&apos;t realize that there&apos;s already another route consuming from the same URI (in this case the Seda consumer with multipleConsumers &lt;b&gt;not&lt;/b&gt; enabled) if one of the routes is not autoEnabled and the other one is already up and consuming and one starts that not-autoEnabled route afterwards through the provided API.&lt;/p&gt;

&lt;p&gt;However if both routes are already autoEnabled (which is the default) then this case gets caught correctly at the startup of the camel context:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.camel.FailedToStartRouteException: Failed to start route route2 because of Multiple consumers &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the same endpoint is not allowed: Endpoint[seda:&lt;span class=&quot;code-comment&quot;&gt;//foo?concurrentConsumers=5]
&lt;/span&gt;	at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRouteConsumers(DefaultCamelContext.java:1916)
	at org.apache.camel.impl.DefaultCamelContext.doStartRouteConsumers(DefaultCamelContext.java:1892)
	at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:1820)
	at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRoutes(DefaultCamelContext.java:1604)
	at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1494)
	at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1381)
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60)
	at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1359)
	at org.apache.camel.ContextTestSupport.startCamelContext(ContextTestSupport.java:171)
	at org.apache.camel.ContextTestSupport.setUp(ContextTestSupport.java:114)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at org.apache.camel.TestSupport.runBare(TestSupport.java:59)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at junit.framework.TestSuite.runTest(TestSuite.java:232)
	at junit.framework.TestSuite.run(TestSuite.java:227)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13150420" author="davsclaus" created="Tue, 15 Nov 2011 12:08:24 +0000"  >&lt;p&gt;The NPE is now fixed and an error message is reported.&lt;/p&gt;

&lt;p&gt;I created a new ticket for the check if multiple consumers is supported when manually starting a route.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12531445">CAMEL-4680</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02293:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9966</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>