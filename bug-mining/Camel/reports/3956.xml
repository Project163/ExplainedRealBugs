<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:21:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10747] CamelContext is not been set in VMConsumer when used with POJO @Consume</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10747</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In Spring environment, &lt;a href=&quot;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelBeanPostProcessor.java#L214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultCamelBeanPostProcessor relies on CamelPostProcessorHelper to inject consumer&lt;/a&gt; , when &lt;a href=&quot;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/CamelPostProcessorHelper.java#L108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CamelPostProcessorHelper creates a VMConsumer&lt;/a&gt; from the endpoint based on the use of @Consume annotation, it then tries to start the consumer as a service. &lt;/p&gt;

&lt;p&gt;Because the consumer endpoint of @Consume was created using the camel context from CamelPostProcessorHelper, it puts the VMConsumer  service in to &lt;a href=&quot;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/CamelPostProcessorHelper.java#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;deferred start&lt;/a&gt; until the camel context is finished starting. The service is ultimately been &lt;a href=&quot;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java#L1333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;added to the DeferServiceStartupListener&lt;/a&gt;. Then the DeferServiceStartupListener tries to start the VMConsumer at a later stage. 2.17.3 and 2.18.0 does not suffer this problem.&lt;/p&gt;

&lt;p&gt;The problem is non of the process above has considered the fact that the VMConsumer is an instance of CamelContextAware and injects the correct camel context to it. This then leads to the VMConsumer tries to prepare the exchange with a null pointer reference as its camel context.&lt;/p&gt;

&lt;p&gt;Because the exchange now has null as camel context, a NPE is thrown at &lt;a href=&quot;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/DefaultExchange.java#L519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/camel-core/src/main/java/org/apache/camel/impl/DefaultExchange.java#L519&lt;/a&gt; when it tries to create the exchange id.&lt;/p&gt;

&lt;p&gt;This problem only happened after issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10406&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CAMEL-10406&lt;/a&gt; is merged in&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 16.04, OpenJDK 1.7, OpenJDK 1.8, Spring 4.2.6.RELEASE&lt;/p&gt;</environment>
        <key id="13037702">CAMEL-10747</key>
            <summary>CamelContext is not been set in VMConsumer when used with POJO @Consume</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="chrisjheap">Christopher Harris</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jan 2017 13:54:47 +0000</created>
                <updated>Sun, 29 Jan 2017 12:21:17 +0000</updated>
                            <resolved>Sun, 29 Jan 2017 12:21:17 +0000</resolved>
                                    <version>2.17.4</version>
                    <version>2.17.5</version>
                    <version>2.18.1</version>
                                    <fixVersion>2.17.6</fixVersion>
                    <fixVersion>2.18.3</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15837966" author="jackygurui" created="Wed, 25 Jan 2017 15:58:38 +0000"  >&lt;p&gt;I have also had a look at this problem, and here is my finding:&lt;/p&gt;

&lt;p&gt;In 2.17.x camel-spring component, The CamelBeanPostProcessor creates and extends the DefaultCamelBeanPostProcessor as an anonymous class. It supposed to &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.17.5/components/camel-spring/src/main/java/org/apache/camel/spring/CamelBeanPostProcessor.java#L124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;override the startService method&lt;/a&gt; and add the service to the current camel context, the addService method would inject in the camel context &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.17.5/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;there and then&lt;/a&gt;. However due to &lt;a href=&quot;https://github.com/apache/camel/commit/9600bc4fec55a4ed02f2404dfd33b3584491ec80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;, the startService signature has been changed but failed to refactor the CamelBeanPostProcessor to have the same signature, which rendered the code not been used. This is then been removed completely by &lt;a href=&quot;https://github.com/apache/camel/commit/1233ea02ae4414a07b76d16b709beefbb0b1e448&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; and release in 2.18.x &lt;/p&gt;

&lt;p&gt;If this method was to reinstated and modified to override the startService method properly, it would fix this issue.&lt;/p&gt;</comment>
                            <comment id="15842871" author="davsclaus" created="Fri, 27 Jan 2017 13:31:15 +0000"  >&lt;p&gt;Thanks for reporting and Rui for diving into the code.&lt;/p&gt;

&lt;p&gt;You are welcome to work on a patch / github PR that adds the code back and fixes this.&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/contributing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/contributing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15842957" author="chrisjheap" created="Fri, 27 Jan 2017 15:09:27 +0000"  >&lt;p&gt;Patch file to reinstate startService in the CamelBeanPostProcessor.&lt;/p&gt;</comment>
                            <comment id="15842959" author="chrisjheap" created="Fri, 27 Jan 2017 15:10:26 +0000"  >&lt;p&gt;Claus, i have attached a patch file to reinstate the startService that overrides correctly as suggested by Rui.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13014074">CAMEL-10406</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12849703" name="CamelBeanPostProcessor_patchfile.diff" size="4134" author="chrisjheap" created="Fri, 27 Jan 2017 15:09:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i396rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>