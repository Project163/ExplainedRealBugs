<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:58:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6574] FTP consumer does not detect file changes</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6574</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have a route with an FTP consumer with the following options:&lt;/p&gt;

&lt;p&gt;delay=1800000&lt;br/&gt;
disconnect=true&lt;br/&gt;
fileName=xxxxx.yyy&lt;br/&gt;
idempotent=true&lt;br/&gt;
idempotentKey=${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}-${&lt;a href=&quot;file:size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:size&lt;/a&gt;}&lt;br/&gt;
maxMessagesPerPoll=1&lt;br/&gt;
noop=true&lt;br/&gt;
readLock=changed&lt;br/&gt;
sortBy=&lt;a href=&quot;file:modified&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:modified&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Upgrading from camel 2.11.0 to 2.11.1 the FTP consumer does not detect changes in the file.&lt;br/&gt;
I tried several idempotentKey without success.&lt;br/&gt;
Reverting to 2.11.0 works all fine.&lt;/p&gt;

&lt;p&gt;I did not find any relevant info in the release notes.&lt;/p&gt;</description>
                <environment>&lt;p&gt;GNU/Debian 6.0, Java 1.7 &lt;/p&gt;</environment>
        <key id="12659664">CAMEL-6574</key>
            <summary>FTP consumer does not detect file changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="albertob">Alberto Brosich</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jul 2013 21:05:34 +0000</created>
                <updated>Mon, 11 Nov 2013 11:30:49 +0000</updated>
                            <resolved>Mon, 11 Nov 2013 11:21:00 +0000</resolved>
                                    <version>2.11.1</version>
                                    <fixVersion>2.11.3</fixVersion>
                    <fixVersion>2.12.2</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13721689" author="davsclaus" created="Sat, 27 Jul 2013 17:11:31 +0000"  >&lt;p&gt;As we say on the file/ftp component docs in the bottom&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/ftp2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/ftp2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Enable TRACE logging and see what happens on your system.&lt;/p&gt;</comment>
                            <comment id="13730920" author="clee" created="Tue, 6 Aug 2013 16:36:37 +0000"  >&lt;p&gt;I had a similar issue and stepped through the code. IMHO, it has to do with the end point&apos;s internal inprogressIdempotentRepository not clearing under certain circumstances.&lt;/p&gt;

&lt;p&gt;The problem arise when you use have file names that do not change. In this case, you typically use the new custom idempotent key:&lt;/p&gt;

&lt;p&gt;        from(&quot;ftp://&quot; + this.user&lt;br/&gt;
                + &quot;@&quot; + this.host&lt;br/&gt;
                + &quot;:&quot; + this.port&lt;br/&gt;
                + this.ftpDir.trim()&lt;br/&gt;
                + &quot;?password=&quot; + this.pass&lt;br/&gt;
                // Poll every minute&lt;br/&gt;
                + &quot;&amp;amp;delay=60000&quot;&lt;br/&gt;
                // Site is Read-Only, so do not attempt any operation on remote FTP.&lt;br/&gt;
                // NOTE: This implies idempotent=true&lt;br/&gt;
                + &quot;&amp;amp;noop=true&quot;&lt;br/&gt;
                // Add timestamp to the key, so that we only process files that are new&lt;br/&gt;
                + &quot;&amp;amp;idempotentKey=${&lt;a href=&quot;file:onlyname&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:onlyname&lt;/a&gt;}&lt;del&gt;${&lt;a href=&quot;file:size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:size&lt;/a&gt;}&lt;/del&gt;${date:&lt;a href=&quot;file:yyyyMMddHHmmss&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:yyyyMMddHHmmss&lt;/a&gt;}&quot;&lt;br/&gt;
                // Use PASV FTP&lt;br/&gt;
                + &quot;&amp;amp;passiveMode=true&quot;).&lt;br/&gt;
                routeId(this.getClass().getSimpleName()).&lt;br/&gt;
                to(&quot;log:com.psi.camel?showAll=true&amp;amp;multiline=true&quot;).&lt;br/&gt;
                to(&quot;file://&quot; + dir.getAbsolutePath()&lt;br/&gt;
                + &quot;?fileName=&quot; + fileName&lt;br/&gt;
                + &quot;&amp;amp;autoCreate=true&quot;&lt;br/&gt;
                + &quot;&amp;amp;fileExist=Override&quot;);&lt;/p&gt;

&lt;p&gt;When the route executes the first time, all files are new (since its a memory based cache), and all is fine:&lt;br/&gt;
a) Filenames added to inprogress cache, &lt;br/&gt;
b) custom idempotent keys added to end point idempotent cache, &lt;br/&gt;
c) files processed&lt;br/&gt;
d) inprogress cache cleared.&lt;/p&gt;

&lt;p&gt;When the route runs again,&lt;br/&gt;
a) Filenames added to inprogress cache, &lt;br/&gt;
b) custom idempotent keys exists, &lt;br/&gt;
c) files not processed&lt;br/&gt;
d) inprogress cache not cleared.&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;

&lt;p&gt;Thanks vm&lt;/p&gt;</comment>
                            <comment id="13747551" author="davsclaus" created="Thu, 22 Aug 2013 14:10:05 +0000"  >&lt;p&gt;Added unit tests. Works fine on trunk. The file is picked up again if its changed such as length etc.&lt;/p&gt;</comment>
                            <comment id="13800665" author="albertob" created="Mon, 21 Oct 2013 13:54:18 +0000"  >&lt;p&gt;Still having problems using SFTP consumer. Trace the component gives no additional information.&lt;/p&gt;

&lt;p&gt;Endpoint configuration:&lt;/p&gt;

&lt;p&gt;sftp://username@host//dirname?delay=1800000&amp;amp;disconnect=true&amp;amp;fileName=FILENAME&amp;amp;idempotentKey=$simple&lt;/p&gt;
{file:name}
&lt;p&gt;-$simple&lt;/p&gt;
{file:modified}
&lt;p&gt;-$simple&lt;/p&gt;
{file:size}
&lt;p&gt;&amp;amp;idempotentRepository=#fileStore&amp;amp;maxMessagesPerPoll=1&amp;amp;noop=true&amp;amp;password=xxxxxx&amp;amp;readLock=changed&amp;amp;sortBy=&lt;a href=&quot;file:modified&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:modified&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Log:&lt;br/&gt;
2013-10-21 15:26:57,921 TRACE SftpConsumer - SftpFile&lt;span class=&quot;error&quot;&gt;&amp;#91;fileName=FILENAME, longName=-rwxr-xr-x    1 User Group   1504500 Oct 21 12:16 FILENAME, dir=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
2013-10-21 15:26:57,925 TRACE SftpConsumer - This consumer is idempotent and the file has been consumed before. Will skip this file: RemoteFile&lt;span class=&quot;error&quot;&gt;&amp;#91;dirname/FILENAME&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I tried both inMemory and file idempotent key repository but the behaviour is always the same. Looking in the file repository I can see the old key  that is different from that of the current file, but the consumer always says that the file has been consumed before.&lt;/p&gt;</comment>
                            <comment id="13807915" author="albertob" created="Tue, 29 Oct 2013 12:17:51 +0000"  >&lt;p&gt;Just a bit more.&lt;br/&gt;
The sftp server on test was an openssh on Windows. Now I tried with a sftp server on Linux and the behaviour is the same. The changes of the file are not detected.&lt;/p&gt;</comment>
                            <comment id="13818875" author="davsclaus" created="Mon, 11 Nov 2013 11:21:00 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6936&quot; title=&quot;FTP route with idempotent repo does not detect modified files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6936&quot;&gt;&lt;del&gt;CAMEL-6936&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12677585">CAMEL-6936</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mm7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>