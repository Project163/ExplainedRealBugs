<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:34:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-1844] Files size after simply route from file to file is smaller then the original size.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1844</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;ve got very simply camel route:&lt;/p&gt;

&lt;p&gt;CamelContext context = new DefaultCamelContext();&lt;br/&gt;
context.addRoutes(new RouteBuilder() {&lt;br/&gt;
  public void configure() &lt;/p&gt;
{
    from(&quot;file://&quot; + INBOX_DIR + &quot;?noop=false&quot;).to(&quot;file://&quot; + OUTBOX_DIR);
  }
&lt;p&gt;});&lt;br/&gt;
context.start();&lt;/p&gt;

&lt;p&gt;All this route does, is to copy a file from INBOX_DIR to OUTBOX_DIR.&lt;/p&gt;

&lt;p&gt;And everything goes fine for smaller files, but when I put something bigger into INBOX_DIR (on my machine problem starts with files bigger than ~100MB) things go wrong.&lt;br/&gt;
The file in OUTBOX_DIR has different size than the original one. In general it is smaller than the original (its size varies - can be 3/4 of the original, can be 1/2 etc).&lt;br/&gt;
With Camel 1.6.1 with noop set to &quot;true&quot; the file in OUTBOX was bigger than the original one (even 1,5-2 times larger !). With Camel 2.0-M2 setting noop to true or false didn&apos;t matter - the file in OUTBOX was smaller than the original one.&lt;/p&gt;

&lt;p&gt;It is possible to avoid this bug, by setting delay but this is no good. To handle large files, I&apos;d have to set a very high value which would slow down the whole application.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried all possible configurations noop=true/false, readLock, readLockTimeout but without success.&lt;/p&gt;

&lt;p&gt;Tested on both Apache Camel 1.6.1 and 2.0-M2 with similar results.&lt;/p&gt;


&lt;p&gt;My environment:&lt;br/&gt;
Java: 1.6.0.14&lt;br/&gt;
OS: Linux, Kubuntu 9.04&lt;/p&gt;


&lt;p&gt;Attached you will find a Maven project which exposes the bug.&lt;br/&gt;
Unpack it, run&lt;br/&gt;
mvn assembly:assembly&lt;br/&gt;
next run&lt;br/&gt;
run.sh&lt;br/&gt;
and copy big file to inbox dir and observe resulting file in outbox dir.&lt;/p&gt;

&lt;p&gt;To kill the application hit CTRL+C &lt;/p&gt;</description>
                <environment>&lt;p&gt;Java: 1.6.0.14&lt;br/&gt;
OS: Linux, Kubuntu 9.04&lt;br/&gt;
Intel Core Duo (2x2,5GHz), 4GB ram &lt;/p&gt;</environment>
        <key id="12487151">CAMEL-1844</key>
            <summary>Files size after simply route from file to file is smaller then the original size.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="rafal.janik">rafal janik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jul 2009 14:43:06 +0000</created>
                <updated>Sun, 7 Feb 2010 09:56:20 +0000</updated>
                            <resolved>Fri, 24 Jul 2009 07:03:37 +0000</resolved>
                                    <version>2.0-M2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12953294" author="rafal.janik" created="Tue, 21 Jul 2009 14:45:58 +0000"  >&lt;p&gt;Maven project which exposes the bug.&lt;br/&gt;
Unpack it, run&lt;br/&gt;
mvn assembly:assembly&lt;br/&gt;
next run&lt;br/&gt;
run.sh&lt;br/&gt;
and copy big file to inbox dir and observe resulting file in outbox dir.&lt;/p&gt;

&lt;p&gt;To kill the application hit CTRL+C &lt;/p&gt;</comment>
                            <comment id="12953346" author="davsclaus" created="Thu, 23 Jul 2009 12:27:46 +0000"  >&lt;p&gt;See answer posted on user forum&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/Large-files-processing-td24568287.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Large-files-processing-td24568287.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12953345" author="davsclaus" created="Thu, 23 Jul 2009 12:29:32 +0000"  >&lt;p&gt;Could you try with adding option &lt;tt&gt;readLock=rename&lt;/tt&gt; to the Camel file consumer.&lt;/p&gt;</comment>
                            <comment id="12953343" author="davsclaus" created="Thu, 23 Jul 2009 15:18:52 +0000"  >&lt;p&gt;Damn the Java IO File API sucks big time.&lt;/p&gt;

&lt;p&gt;All its fancy locking does not detect if you use a regular &lt;tt&gt;cp&lt;/tt&gt; to copy a big file that its in progress.&lt;/p&gt;

&lt;p&gt;I am adding a new strategy: &lt;tt&gt;changed&lt;/tt&gt; that you can use that will detect whether the file size/modified timestamp have changed.&lt;br/&gt;
However it requires that it uses at least 1 sec to detect whether the file is currently being copied or not.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:target/changed/in?readLock=changed&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:target/changed/out&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12953342" author="davsclaus" created="Thu, 23 Jul 2009 15:35:09 +0000"  >&lt;p&gt;tunnk: 797105.&lt;/p&gt;</comment>
                            <comment id="12953341" author="davsclaus" created="Thu, 23 Jul 2009 15:36:01 +0000"  >&lt;p&gt;.jar with the new changed option&lt;/p&gt;</comment>
                            <comment id="12953357" author="davsclaus" created="Thu, 23 Jul 2009 15:36:58 +0000"  >&lt;p&gt;Rafal I have attached a camel-core .jar with this new feature. You can test in your environment by adding this to the URI&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;readLock=changed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That will use the new strategy and it should avoid copying the file while its being in progress.&lt;/p&gt;</comment>
                            <comment id="12953318" author="davsclaus" created="Thu, 23 Jul 2009 15:46:46 +0000"  >&lt;p&gt;Update wiki pages as well&lt;/p&gt;</comment>
                            <comment id="12953363" author="rafal.janik" created="Fri, 24 Jul 2009 07:03:37 +0000"  >&lt;p&gt;Thank You very much.  Now it works fine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463033" name="camel-core-2.0-SNAPSHOT.jar" size="1086681" author="davsclaus" created="Thu, 23 Jul 2009 15:36:01 +0000"/>
                            <attachment id="12463029" name="camelTest.tar.gz" size="1578" author="rafal.janik" created="Tue, 21 Jul 2009 14:45:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01kx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7158</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>