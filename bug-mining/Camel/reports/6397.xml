<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:59:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19014] SimpleLanguage cache issue</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19014</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi guys, I&apos;m attaching a test class that will reproduce the issue that I&apos;m experiencing.&lt;br/&gt;
As summary: The cache inside the SimpleLanguage class looks like it&apos;s going to be affected by the evaluation of the simple expression, producing unexpected results.&lt;br/&gt;
When the method &lt;b&gt;resolveTemplate&lt;/b&gt; is used the result is not the expected one.&lt;br/&gt;
To make it work I have to simulate a new entry in the cache making use of the method &lt;b&gt;resolveTemplateNoCache.&lt;/b&gt;&lt;br/&gt;
Thanks in advance&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SimpleLanguageTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {
    @EndpointInject(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; MockEndpoint mockResult;

    @EndpointInject(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:fail&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; MockEndpoint mockWithFailure;

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void whenSimpleLanguageNotUseCachedEntriesItWillNotFail() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        mockResult.await(20, TimeUnit.SECONDS);
        mockResult.expectedMessageCount(102);
        assertMockEndpointsSatisfied();
        List&amp;lt;Exchange&amp;gt; exchanges = mockResult.getExchanges();
        exchanges.stream()
                .forEach(exchange -&amp;gt; assertTrue(exchange.getMessage().getHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;This is a test a with startLabel: `Document` endLabel: `Document` and label: `ALabel`&quot;&lt;/span&gt;)));


    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void whenSimpleLanguageUseCachedEntriesItWillFail() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        mockWithFailure.expectedMessageCount(102);
        assertMockEndpointsSatisfied();
        List&amp;lt;Exchange&amp;gt; exchanges = mockWithFailure.getExchanges();
        exchanges.stream()
                .forEach(exchange -&amp;gt; assertTrue(exchange.getMessage().getHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;This is a test a with startLabel: `Document` endLabel: `Document` and label: `ALabel`&quot;&lt;/span&gt;)));


    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RoutesBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            Map body = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap() {{
                put(&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ALabel&quot;&lt;/span&gt;);
                put(&lt;span class=&quot;code-quote&quot;&gt;&quot;startLabel&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Document&quot;&lt;/span&gt;);
                put(&lt;span class=&quot;code-quote&quot;&gt;&quot;endLabel&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Document&quot;&lt;/span&gt;);
            }};


            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; simpleTemplate = &lt;span class=&quot;code-quote&quot;&gt;&quot;This is a test a with startLabel: `${body.get(&lt;span class=&quot;code-quote&quot;&gt;&apos;startLabel&apos;&lt;/span&gt;)}` endLabel: `${body.get(&lt;span class=&quot;code-quote&quot;&gt;&apos;endLabel&apos;&lt;/span&gt;)}` and label: `${body.get(&lt;span class=&quot;code-quote&quot;&gt;&apos;label&apos;&lt;/span&gt;)}`&quot;&lt;/span&gt;;


            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplateNoCache(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer1?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;
                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplateNoCache(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer2?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplateNoCache(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer3?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplate(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:fail&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer4?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;
                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplate(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:fail&quot;&lt;/span&gt;);

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer5?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                exchange.getMessage().setBody(body);
                                exchange.getMessage().setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;, resolveTemplate(simpleTemplate, exchange));
                            }
                        })
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:fail&quot;&lt;/span&gt;);
            }

        };
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolveTemplate(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; template, Exchange exchange) {
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; simpleExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExpression();
        simpleExpression.setExpression(template);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; simpleExpression.evaluate(exchange, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolveTemplateNoCache(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; template, Exchange exchange) {
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; simpleExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExpression();
        &lt;span class=&quot;code-comment&quot;&gt;//This will force to create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; entry in the cache in the SimpleLanguage class
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; nocache = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.join(&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-nocache&quot;&lt;/span&gt;, UUID.randomUUID().toString());
        simpleExpression.setExpression(&lt;span class=&quot;code-quote&quot;&gt;&quot;%s%s&quot;&lt;/span&gt;.formatted(template, nocache));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; simpleExpression.evaluate(exchange, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class).replace(nocache, &quot;&quot;);

    }
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13523266">CAMEL-19014</key>
            <summary>SimpleLanguage cache issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhuanrocha">Rhuan Rocha</assignee>
                                    <reporter username="andrea81">Andrea Evangelista</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Feb 2023 16:26:40 +0000</created>
                <updated>Thu, 31 Aug 2023 15:56:39 +0000</updated>
                            <resolved>Wed, 22 Mar 2023 11:03:54 +0000</resolved>
                                    <version>3.19.0</version>
                    <version>3.20.1</version>
                    <version>3.20.2</version>
                    <version>4.0-M1</version>
                                    <fixVersion>3.21.0</fixVersion>
                    <fixVersion>4.0-M3</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17685292" author="JIRAUSER282651" created="Tue, 7 Feb 2023 12:54:32 +0000"  >&lt;p&gt;Just an update if in the previous method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolveTemplate(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; template, Exchange exchange) {       
  &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; simpleExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExpression();
  simpleExpression.setExpression(template);        
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; simpleExpression.evaluate(exchange, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I introduce a synchronization over the SimpleLanguage class it works as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolveTemplate(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; template, Exchange exchange) \{
    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (SimpleLanguage.class){
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; simpleExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExpression();
        simpleExpression.setExpression(template);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; simpleExpression.evaluate(exchange, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So maybe it&apos;s due a concurrency issue somewhere in the code.&lt;br/&gt;
I hope this can help as well too.&lt;br/&gt;
Thanks in advance&lt;/p&gt;</comment>
                            <comment id="17687288" author="JIRAUSER297305" created="Fri, 10 Feb 2023 21:04:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrea81&quot; class=&quot;user-hover&quot; rel=&quot;andrea81&quot;&gt;andrea81&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;&#160;I reproduced it here in my local environment and locks like you are correct. The issue is about Concurrence. I have seen the following log here&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;
[Camel (camel-1) thread #6 - timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer5] WARN org.apache.camel.component.timer.TimerConsumer - Error processing exchange. Exchange[4693970F0659A59-000000000000005C]. Caused by: [java.util.ConcurrentModificationException - &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]
&lt;/span&gt;java.util.ConcurrentModificationException
&#160; &#160; at java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:1013)
&#160; &#160; at java.base/java.util.ArrayList$Itr.next(ArrayList.java:967)
&#160; &#160; at org.apache.camel.support.builder.ExpressionBuilder$52.evaluate(ExpressionBuilder.java:1605)
&#160; &#160; at org.apache.camel.support.ExpressionAdapter.evaluate(ExpressionAdapter.java:45)
&#160; &#160; at org.apache.camel.model.language.ExpressionDefinition.evaluate(ExpressionDefinition.java:239)
&#160; &#160; at net.rhuanrocha.SampleLanguageTest.resolveTemplate(SampleLanguageTest.java:145)
&#160; &#160; at net.rhuanrocha.SampleLanguageTest$1$7.process(SampleLanguageTest.java:133)
&#160; &#160; at org.apache.camel.support.processor.DelegateSyncProcessor.process(DelegateSyncProcessor.java:65)
&#160; &#160; at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:477)
&#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181)
&#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59)
&#160; &#160; at org.apache.camel.processor.Pipeline.process(Pipeline.java:165)
&#160; &#160; at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:392)
&#160; &#160; at org.apache.camel.component.timer.TimerConsumer.sendTimerExchange(TimerConsumer.java:210)
&#160; &#160; at org.apache.camel.component.timer.TimerConsumer$1.run(TimerConsumer.java:76)
&#160; &#160; at java.base/java.util.TimerThread.mainLoop(Timer.java:566)
&#160; &#160; at java.base/java.util.TimerThread.run(Timer.java:516)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m working on it and I&apos;ll be back soon with news.&lt;/p&gt;</comment>
                            <comment id="17687312" author="JIRAUSER297305" created="Fri, 10 Feb 2023 23:07:11 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I sent a PR to resolve this issue. It is awaiting review and will likely be released in version 3.20.3&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/9332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/9332&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17687357" author="JIRAUSER297305" created="Sat, 11 Feb 2023 04:57:53 +0000"  >&lt;p&gt;This issue happens to version 4.0.0-M1 as well. Thus, I&apos;m sending the PR fixing it to version 4.0.0-M1.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/9333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/9333&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17687364" author="JIRAUSER282651" created="Sat, 11 Feb 2023 05:59:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhuanrocha&quot; class=&quot;user-hover&quot; rel=&quot;rhuanrocha&quot;&gt;rhuanrocha&lt;/a&gt; ,&lt;br/&gt;
Thanks a lot for your time, yep it&apos;s the same for 4.0.0-M1.&lt;/p&gt;

&lt;p&gt;Let me share with you a quick summary after a conversation here:&lt;br/&gt;
&lt;a href=&quot;https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Simple.20language&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Simple.20language&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is going to happen due the fact that I&apos;m going to create and invoke the evaluation of the expression inside a processor, and it looks like it&apos;s not the standard way to it.&lt;br/&gt;
The standard way to it&apos;s to use the simple expression by the dsl, with something like that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//test-timer5?fixedRate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;period=10&amp;amp;delay=1&quot;&lt;/span&gt;)
&lt;/span&gt;                    .setBody(constant(body))
                    .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;#CustomHeader&quot;&lt;/span&gt;,simple(simpleTemplate,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class))
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:fail&quot;&lt;/span&gt;); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and not in this way (directly inside a processor):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolveTemplate(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; template, Exchange exchange) {
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; simpleExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExpression();
        simpleExpression.setExpression(template);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; simpleExpression.evaluate(exchange, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);

    } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;due the fact that&apos;s not thread safe.&lt;/p&gt;

&lt;p&gt;We will see what will be decided for this ticket.&lt;br/&gt;
To me, by the user point of view, with your fix the user will have more advantages like avoid to write multiple time something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
....
.process(MyProcessor)
.xxxxx(.....,simple(xxxxxx))
.process
.(.....,simple(xxxxxx))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I mean multiple evaluation that at the end could be done in the processor itself directly.&lt;br/&gt;
So we will see what will be decided around this.&lt;br/&gt;
Thanks again and have a greet weekend.&lt;/p&gt;</comment>
                            <comment id="17687371" author="JIRAUSER297305" created="Sat, 11 Feb 2023 06:43:57 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thank you for the clarification.&#160;&lt;/p&gt;

&lt;p&gt;I understood. As the Expression is supposed to be cached, and it has one method that applies an operation to an internal collection and another method that iterates this collection, I think it&apos;s good to develop it as thread-safe, to avoid problems in the future as well. I agree the way you used is not a standard way, but I think this PR can avoid problems in the future.&lt;/p&gt;</comment>
                            <comment id="17687372" author="JIRAUSER282651" created="Sat, 11 Feb 2023 06:53:20 +0000"  >&lt;p&gt;I agree with you&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13536028">CAMEL-19346</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1foog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>