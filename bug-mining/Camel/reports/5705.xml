<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:47:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16507] Camel-sql: Body for empty ResultSet no longer null when using outputType selectOne</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16507</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;After upgrading from Camel 3.8.0 to 3.9.0 we noticed a change in behavior of camel-sql for empty ResultSets when using outputType selectOne.&lt;/p&gt;

&lt;p&gt;In Camel 3.8.0 and older versions the out body was null, in Camel 3.9.0 the out body is an empty string. This causes simple statements accessing the body as a map to fail.&lt;/p&gt;

&lt;p&gt;This test&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CamelSqlEmptyResultTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:in&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;sql:select * from Persons where PersonID=1?outputType=selectOne&quot;&lt;/span&gt;)
                    .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;PersonID&quot;&lt;/span&gt;, simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body[PersonID]}&quot;&lt;/span&gt;))
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:out&quot;&lt;/span&gt;);
            }
        };
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void bindToRegistry(Registry registry) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        EmbeddedDatabase db = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EmbeddedDatabaseBuilder().setType(EmbeddedDatabaseType.H2).generateUniqueName(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                .build();
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JdbcTemplate(db).execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE Persons (PersonID &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, LastName varchar(255))&quot;&lt;/span&gt;);
        registry.bind(&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt;, db);
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        MockEndpoint out = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:out&quot;&lt;/span&gt;);
        out.expectedMessageCount(1);

        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:in&quot;&lt;/span&gt;, &quot;&quot;);

        out.assertIsSatisfied(3_000);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;passes in Camel 3.8.0, but fails with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.camel.language.bean.RuntimeBeanExpressionException: Failed to invoke method: [PersonID] on java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; due to: java.lang.IndexOutOfBoundsException: Key: PersonID not found in bean:  of type: java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; using OGNL path [[PersonID]]
       at org.apache.camel.language.bean.BeanExpression.evaluate(BeanExpression.java:208)
       at org.apache.camel.language.bean.BeanExpression.evaluate(BeanExpression.java:214)
       at org.apache.camel.language.simple.SimpleExpressionBuilder$28.evaluate(SimpleExpressionBuilder.java:757)
       at org.apache.camel.support.ExpressionAdapter.evaluate(ExpressionAdapter.java:35)
       at org.apache.camel.processor.SetHeaderProcessor.process(SetHeaderProcessor.java:48)
       at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:439)
       at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181)
       at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:62)
       at org.apache.camel.processor.Pipeline.process(Pipeline.java:167)
       at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:388)
       at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:269)
       at org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:187)
       at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:130)
       at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
       at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
       at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
Caused by: java.lang.IndexOutOfBoundsException: Key: PersonID not found in bean:  of type: java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; using OGNL path [[PersonID]]
       at org.apache.camel.language.bean.BeanExpression.lookupResult(BeanExpression.java:540)
       at org.apache.camel.language.bean.BeanExpression.invokeOgnlMethod(BeanExpression.java:468)
       at org.apache.camel.language.bean.BeanExpression.evaluate(BeanExpression.java:199)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in Camel 3.9.0.&lt;/p&gt;

&lt;p&gt;I have uploaded a project to &lt;a href=&quot;https://github.com/PascalSchumacher/CamelSqlEmptyResult&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PascalSchumacher/CamelSqlEmptyResult&lt;/a&gt; which makes it easy to reproduce this issue (just by changing the camel version in the POM).&lt;br/&gt;
 &#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13372317">CAMEL-16507</key>
            <summary>Camel-sql: Body for empty ResultSet no longer null when using outputType selectOne</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="pascalschumacher">Pascal Schumacher</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Apr 2021 13:33:14 +0000</created>
                <updated>Thu, 15 Apr 2021 20:58:39 +0000</updated>
                            <resolved>Wed, 14 Apr 2021 18:02:49 +0000</resolved>
                                    <version>3.9.0</version>
                                    <fixVersion>3.10.0</fixVersion>
                                    <component>camel-sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17321207" author="davsclaus" created="Wed, 14 Apr 2021 18:02:49 +0000"  >&lt;p&gt;Thanks for the unit test, that helped to fix the problem&lt;/p&gt;</comment>
                            <comment id="17321231" author="pascalschumacher" created="Wed, 14 Apr 2021 18:32:46 +0000"  >&lt;p&gt;You are welcome. Thanks you very much for the quick fix! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13358559">CAMEL-16206</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pze8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>