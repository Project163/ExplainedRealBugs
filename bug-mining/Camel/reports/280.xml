<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:27:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-777] Allow &apos;@&apos; in usernames.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-777</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Many servers use &apos;username&apos;@&apos;servername&apos; as a login name. Camel-mail doesn&apos;t allow this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12484931">CAMEL-777</key>
            <summary>Allow &apos;@&apos; in usernames.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="avatah">Wojciech Durczynski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2008 09:11:29 +0000</created>
                <updated>Mon, 16 Feb 2009 05:51:49 +0000</updated>
                            <resolved>Fri, 8 Aug 2008 05:53:57 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>camel-mail</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                                                            <comments>
                            <comment id="12948291" author="magyardude" created="Fri, 1 Aug 2008 14:05:08 +0000"  >&lt;p&gt;It does allow it. Try to upgrade to 1.4.&lt;br/&gt;
This works for me:&lt;/p&gt;

&lt;p&gt;String smtpUri = &lt;br/&gt;
			 &quot;smtp://mail.server.com?username=freeforall@server.com&amp;amp;password=freeforall&quot; +&lt;br/&gt;
			 &quot;&amp;amp;From=freeforall@server.com&amp;amp;To=otheruser@server.com&quot;;&lt;/p&gt;</comment>
                            <comment id="12948235" author="avatah" created="Fri, 1 Aug 2008 14:26:36 +0000"  >&lt;p&gt;I use camel 1.4 and javax.mail 1.4.1.&lt;br/&gt;
If I define camel endpoint with &apos;@&apos; in username there is an exception during sending mail:&lt;br/&gt;
org.springframework.mail.MailParseException: Could not parse mail; nested exception is javax.mail.internet.AddressException: Illegal character in domain in string ``Wojciech.Durczynski@server.com@smtp.server.com&apos;&apos;&lt;br/&gt;
	at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:363)&lt;br/&gt;
	at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:346)&lt;br/&gt;
	at org.apache.camel.component.mail.MailProducer.process(MailProducer.java:46)&lt;br/&gt;
	at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:43)&lt;br/&gt;
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:75)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:57)&lt;br/&gt;
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:155)&lt;br/&gt;
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:91)&lt;br/&gt;
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:101)&lt;br/&gt;
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:85)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:57)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:39)&lt;br/&gt;
	at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:41)&lt;br/&gt;
	at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:66)&lt;br/&gt;
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:47)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:149)&lt;br/&gt;
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:86)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:84)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:122)&lt;br/&gt;
	at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:117)&lt;br/&gt;
	at com.comarch.p7samples.minis.password.PasswordPlugin$1.onSubmit(PasswordPlugin.java:92)&lt;br/&gt;
	at org.apache.wicket.markup.html.form.Form.delegateSubmit(Form.java:1355)&lt;br/&gt;
	at org.apache.wicket.markup.html.form.Form.onFormSubmitted(Form.java:810)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.wicket.RequestListenerInterface.invoke(RequestListenerInterface.java:183)&lt;br/&gt;
	at org.apache.wicket.request.target.component.listener.ListenerInterfaceRequestTarget.processEvents(ListenerInterfaceRequestTarget.java:73)&lt;br/&gt;
	at org.apache.wicket.request.AbstractRequestCycleProcessor.processEvents(AbstractRequestCycleProcessor.java:91)&lt;br/&gt;
	at com.comarch.p7.ui.core.application.BaseRequestCycleProcessor.processEvents(BaseRequestCycleProcessor.java:20)&lt;br/&gt;
	at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1171)&lt;br/&gt;
	at org.apache.wicket.RequestCycle.step(RequestCycle.java:1248)&lt;br/&gt;
	at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1349)&lt;br/&gt;
	at org.apache.wicket.RequestCycle.request(RequestCycle.java:493)&lt;br/&gt;
	at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:387)&lt;br/&gt;
	at org.apache.wicket.protocol.http.WicketServlet.doPost(WicketServlet.java:145)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:727)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)&lt;br/&gt;
	at com.comarch.p7.ui.webscope.ListenerServlet$FilterChainImpl.doFilter(ListenerServlet.java:206)&lt;br/&gt;
	at com.comarch.p7.ui.webscope.ListenerServlet.service(ListenerServlet.java:85)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:487)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:362)&lt;br/&gt;
	at org.ops4j.pax.web.service.internal.HttpServiceServletHandler.handle(HttpServiceServletHandler.java:66)&lt;br/&gt;
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:726)&lt;br/&gt;
	at org.ops4j.pax.web.service.internal.HttpServiceContext.handle(HttpServiceContext.java:107)&lt;br/&gt;
	at org.ops4j.pax.web.service.internal.JettyServerHandlerCollection.handle(JettyServerHandlerCollection.java:64)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)&lt;br/&gt;
	at org.mortbay.jetty.Server.handle(Server.java:324)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:505)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:843)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:648)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:380)&lt;br/&gt;
	at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)&lt;br/&gt;
	at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:488)&lt;br/&gt;
Caused by: javax.mail.internet.AddressException: Illegal character in domain in string ``Wojciech.Durczynski@server.com@smtp.server.com&apos;&apos;&lt;br/&gt;
	at javax.mail.internet.InternetAddress.checkAddress(InternetAddress.java:947)&lt;br/&gt;
	at javax.mail.internet.InternetAddress.parse(InternetAddress.java:833)&lt;br/&gt;
	at javax.mail.internet.InternetAddress.parse(InternetAddress.java:569)&lt;br/&gt;
	at javax.mail.internet.InternetAddress.parse(InternetAddress.java:546)&lt;br/&gt;
	at javax.mail.internet.MimeMessage.setRecipients(MimeMessage.java:607)&lt;br/&gt;
	at org.apache.camel.component.mail.MailBinding.populateMailMessage(MailBinding.java:53)&lt;br/&gt;
	at org.apache.camel.component.mail.MailProducer$1.prepare(MailProducer.java:48)&lt;br/&gt;
	at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:354)&lt;br/&gt;
	... 56 more&lt;/p&gt;</comment>
                            <comment id="12948215" author="avatah" created="Fri, 1 Aug 2008 14:34:07 +0000"  >&lt;p&gt;and in RouteBuilder I do simply:&lt;br/&gt;
.to(&quot;smtp://smtp.server.com?password=myPass&amp;amp;username=Wojciech.Durczynski@server.com&amp;amp;debugMode=true&quot;)&lt;/p&gt;</comment>
                            <comment id="12948239" author="avatah" created="Fri, 1 Aug 2008 14:53:43 +0000"  >&lt;p&gt;The problem probably exists because in class MailConfiguration there is a method:&lt;/p&gt;

&lt;p&gt;    public void setUsername(String username) {&lt;br/&gt;
        this.username = username;&lt;br/&gt;
        if (!recipients.containsKey(Message.RecipientType.TO)) &lt;/p&gt;
{
            // set default destination to username@host for backwards compatibility
            // can be overridden by URI parameters
            String address = username + &quot;@&quot; + host;
            recipients.put(Message.RecipientType.TO, address);
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;If &quot;To&quot; isn&apos;t a parameter in url, broken address is added to recipients map.&lt;br/&gt;
And my url doesn&apos;t have &quot;To&quot; parameter, because I always provide it as a header in a message.&lt;/p&gt;</comment>
                            <comment id="12948251" author="davsclaus" created="Mon, 4 Aug 2008 12:13:39 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Ah interesting, I would assume the TO header option is a quite common use-case. I do think Camel should support this as well.&lt;/p&gt;</comment>
                            <comment id="12948305" author="davsclaus" created="Wed, 6 Aug 2008 05:06:37 +0000"  >&lt;p&gt;Okay I got it now. Added a unit test that demonstrated the bug and now you can have @ in the username option.&lt;/p&gt;</comment>
                            <comment id="12948455" author="avatah" created="Thu, 7 Aug 2008 10:16:25 +0000"  >&lt;p&gt;Sadly your improvement doesn&apos;t solve problem.&lt;/p&gt;

&lt;p&gt;Look into this usecase:&lt;br/&gt;
endpoint: smtp://smtp.server.com?password=secret&amp;amp;username=user1@server.com&lt;br/&gt;
header: To=user2@server2.com&lt;/p&gt;

&lt;p&gt;Then during sending mail:&lt;br/&gt;
In MailConfiguration.setUsername() recipients map doesn&apos;t have element &quot;To&quot;, so &lt;br/&gt;
    recipients.put(javax.mail.Message.RecipientType.TO, &quot;user1@server.com&quot;);&lt;br/&gt;
is invoked&lt;/p&gt;

&lt;p&gt;Later in MailBinding.populateMailMessage()&lt;br/&gt;
appendHeadersFromCamel() is invoked, which sets &quot;To&quot; recipients of message right (to user2@server2.com)&lt;br/&gt;
but in the same method just after this, is invoked:&lt;br/&gt;
        if(recipients.containsKey(javax.mail.Message.RecipientType.TO))&lt;br/&gt;
            mimeMessage.setRecipients(javax.mail.Message.RecipientType.TO, (String)recipients.get(javax.mail.Message.RecipientType.TO));&lt;/p&gt;

&lt;p&gt;And this rewrites &quot;To&quot; recipients of message to these, which are set in recipients map. And that&apos;s &quot;user1@server.com&quot; only, which is wrong.&lt;/p&gt;

&lt;p&gt;Because of this recipient of the mail doesn&apos;t receive message, but only sender gets it.&lt;/p&gt;

&lt;p&gt;Why to bother with the following code and not remove it?:&lt;br/&gt;
        if(!recipients.containsKey(javax.mail.Message.RecipientType.TO))&lt;/p&gt;
        {
            String address = username;
            if(address.indexOf(&quot;@&quot;) == -1)
                address = (new StringBuilder()).append(address).append(&quot;@&quot;).append(host).toString();
            recipients.put(javax.mail.Message.RecipientType.TO, address);
        }</comment>
                            <comment id="12948387" author="davsclaus" created="Thu, 7 Aug 2008 10:47:40 +0000"  >&lt;p&gt;Hi Wojciech&lt;/p&gt;

&lt;p&gt;Yeah I was a little battle to try to fix it while staying 100% backwards compatible. I might as well take the heat and improve it so the &lt;b&gt;headers&lt;/b&gt; always overrides whatever you have pre configured on the endpoint/URI. &lt;/p&gt;

&lt;p&gt;And the userinfo from the URI should not be set as TO but in a special holder then we are in a better situation to preserve the &lt;b&gt;headers&lt;/b&gt; while populating the minemessage.&lt;/p&gt;
</comment>
                            <comment id="12948409" author="davsclaus" created="Thu, 7 Aug 2008 18:28:15 +0000"  >&lt;p&gt;Wojciech&lt;/p&gt;

&lt;p&gt;I am thinking about the following&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;configuration of recipients (to, from, bcc) is &lt;b&gt;either&lt;/b&gt; pre configured only (etc. URI) &lt;b&gt;or&lt;/b&gt; message headers only.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So if you have &lt;b&gt;none&lt;/b&gt; To, CC or BCC in the message headers it will use the pre configured&lt;br/&gt;
If you have a To, CC and/or BCC in the message header camel will only use these and not any from the pre configuration.&lt;/p&gt;

&lt;p&gt;So its like exclusive. Either pre configuration or headers (never mixed).&lt;/p&gt;

&lt;p&gt;Some will use it with pre configuration to just send mails to the same all the time (eg alert mails)&lt;br/&gt;
Others as you need dynamic recipients and therefore use message headers.&lt;/p&gt;</comment>
                            <comment id="12948402" author="davsclaus" created="Fri, 8 Aug 2008 05:50:49 +0000"  >&lt;p&gt;Change of strategy.&lt;/p&gt;

&lt;p&gt;Camel will first apply any headers from the message and set them as To, CC and BCC.&lt;br/&gt;
And then if any provided on the URI configuration they will &lt;b&gt;override&lt;/b&gt; these settings.&lt;/p&gt;

&lt;p&gt;This will support your use-case and let people without any headers configure camel to use the same To, CC and BCC from the URI configuration at all times.&lt;/p&gt;</comment>
                            <comment id="12948312" author="davsclaus" created="Fri, 8 Aug 2008 05:53:57 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Try my latest patch that is just committed.&lt;/p&gt;</comment>
                            <comment id="12948398" author="davsclaus" created="Fri, 8 Aug 2008 05:54:59 +0000"  >&lt;p&gt;Update wiki with the mail &lt;b&gt;overrule&lt;/b&gt; strategy &lt;b&gt;TODO&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="12948383" author="avatah" created="Mon, 11 Aug 2008 11:42:35 +0000"  >&lt;p&gt;Yes it works well now. But why have you changed your strategy? Headers should have greater priority then url parameters. Consider following use case:&lt;br/&gt;
somebody wants to define smtp endpoint with default recipient. If recipient is given in header, he receives mail. And if not, then default recipient receives it. &lt;br/&gt;
With your current approach this use case is impossible to achieve. &lt;br/&gt;
Maybe apply headers at the end of processing in MailBinding?&lt;/p&gt;</comment>
                            <comment id="12948324" author="davsclaus" created="Mon, 11 Aug 2008 11:53:59 +0000"  >&lt;p&gt;The short answer is that it will break existing behaviors in Camel 1.4 or older.&lt;/p&gt;

&lt;p&gt;I also though that if you have any recipient informations in the headers what should Camel do?&lt;br/&gt;
a) only use headers &lt;br/&gt;
b) only use pre configued (no - then dynamic recipients is not possible)&lt;br/&gt;
c) headers append to existing pre configured&lt;br/&gt;
d) headers override existing pre configured&lt;br/&gt;
e) pre configured override headers (reverse as option e)&lt;/p&gt;

&lt;p&gt;What we have now is option (e). What you want is option (d). But what about option (c) isn&apos;t the the most correct and least surprised one to have?&lt;/p&gt;

&lt;p&gt;I would like to change the behavior and if its not 100% backwards compatible then its okay anyway - we will write about it in the release notes.&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12948414" author="avatah" created="Mon, 11 Aug 2008 14:57:40 +0000"  >&lt;p&gt;Both (c) and (d) are better than (e). I don&apos;t know which one of them is better. &lt;br/&gt;
When there is no To recipients in url, MailConfiguration adds sender as recipient. And what you surely need to avoid is sending mail to recipients declared in message headers AND to sender himself. There is danger of this behaviour in (c).&lt;br/&gt;
Maybe think about new parameter in url, something like overrideRecipientsInHeaders. And depending on it use (c) or (d) for particular endpoint.&lt;/p&gt;
</comment>
                            <comment id="12948460" author="davsclaus" created="Mon, 11 Aug 2008 18:34:56 +0000"  >&lt;p&gt;From Hadrian&lt;/p&gt;

&lt;p&gt;To me it looks like d) is better than c) (and e) ).  I think headers explicitly express the expected behavior and that should not be altered by the pre-existing conf.  imho the pre-existing conf is there only for the case where explicit info is not present in the headers, constituting a default behaviour, but not a base to be added to.&lt;/p&gt;

&lt;p&gt;my $0.02,&lt;br/&gt;
Hadrian&lt;/p&gt;</comment>
                            <comment id="12948333" author="davsclaus" created="Mon, 11 Aug 2008 18:36:09 +0000"  >&lt;p&gt;I also think that d) is the best one and least surprise. Will create a sub task to implement it in Camel 1.5&lt;/p&gt;</comment>
                            <comment id="12950662" author="davsclaus" created="Mon, 16 Feb 2009 05:51:49 +0000"  >&lt;p&gt;Closing all 1.5.0 issues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12485586">CAMEL-812</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01ebz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6091</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>