<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:57:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6390]  Route with suspended SedaConsumer can&apos;t be stopped correctly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6390</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Route with suspended SedaConsumer can&apos;t be stopped correctly. Here is test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testOriginalSedaShutdownSuspended() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        SedaEndpoint endpoint = context().getEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:test&quot;&lt;/span&gt;, SedaEndpoint.class);
        context().addRouteDefinition(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteDefinition()
                .id(&lt;span class=&quot;code-quote&quot;&gt;&quot;testRoute&quot;&lt;/span&gt;)
                .from(endpoint)
                .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:body&quot;&lt;/span&gt;)
        );
        Set&amp;lt;SedaConsumer&amp;gt; consumers = endpoint.getConsumers();
        Assert.assertFalse(consumers.isEmpty());
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (SedaConsumer sedaConsumer: consumers) {
            sedaConsumer.suspend();
        }
        Assert.assertTrue(context().stopRoute(&lt;span class=&quot;code-quote&quot;&gt;&quot;testRoute&quot;&lt;/span&gt;, 2, TimeUnit.SECONDS, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12649112">CAMEL-6390</key>
            <summary> Route with suspended SedaConsumer can&apos;t be stopped correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="tivv">Vitalii Tymchyshyn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 May 2013 12:58:20 +0000</created>
                <updated>Thu, 30 May 2013 09:12:29 +0000</updated>
                            <resolved>Thu, 30 May 2013 09:12:29 +0000</resolved>
                                    <version>2.10.0</version>
                                    <fixVersion>2.11.1</fixVersion>
                    <fixVersion>2.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13667015" author="davsclaus" created="Sat, 25 May 2013 07:28:57 +0000"  >&lt;p&gt;Works fine. Even if its suspended it may need more than 2 sec to stop properly.&lt;/p&gt;</comment>
                            <comment id="13667637" author="tivv" created="Mon, 27 May 2013 08:48:28 +0000"  >&lt;p&gt;It does not work. Original test does not send any message.&lt;br/&gt;
Your test also does not work if it either: &lt;br/&gt;
1) Does not send any message&lt;br/&gt;
2) Sleep 2000ms after suspension. (that is better as &quot;do not send&quot; works on some timing clash, see below)&lt;/p&gt;

&lt;p&gt;To be clear:&lt;br/&gt;
a) 2000ms is used since default poll timeout is 1000ms. For real test, poll timeout can be lowered down and sleep after suspension used.&lt;br/&gt;
b) you test works because it does not have time to exit from queue.pool to really suspend polling thread. &lt;br/&gt;
c) The actual problem is that SedaConsumer first check isSuspending/isSuspended and go for next circle if it is. Shutdown check is done later (after queue.poll), so when suspended it never reaches this shutdown check.&lt;/p&gt;</comment>
                            <comment id="13667638" author="tivv" created="Mon, 27 May 2013 08:49:47 +0000"  >&lt;p&gt;The committed test do not show the problem, see my previous comment&lt;/p&gt;</comment>
                            <comment id="13670171" author="davsclaus" created="Thu, 30 May 2013 09:12:29 +0000"  >&lt;p&gt;Thanks I have added additional check&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ku53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>