<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11814] camel-spring-boot - Recent change in startup behaviour can cause camel-test-spring problems</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11814</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Creating this ticket up front as I was testing CiA2 source code with 2.20.0-SNAPSHOT and have issues with a camel spring boot app, that caused the test method to be executed without CamelContext been started prior - this works fine on 2.19.x and older versions.&lt;/p&gt;

&lt;p&gt;Its very likely the new startup/shutdown change in camel-spring / camel-spring-boot that is causing a regression problem. A bit weird our own set of unit tests at Apache Camel hasn&apos;t triggered this.&lt;/p&gt;

&lt;p&gt;Doing some more testing on CiA2 before posting more information here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13104499">CAMEL-11814</key>
            <summary>camel-spring-boot - Recent change in startup behaviour can cause camel-test-spring problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zregvart">Zoran Regvart</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Sep 2017 10:51:38 +0000</created>
                <updated>Tue, 26 Sep 2017 12:55:20 +0000</updated>
                            <resolved>Tue, 26 Sep 2017 12:55:20 +0000</resolved>
                                    <version>2.20.0</version>
                                    <fixVersion>2.20.0</fixVersion>
                                    <component>camel-spring</component>
                    <component>camel-spring-boot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16178737" author="davsclaus" created="Mon, 25 Sep 2017 08:41:08 +0000"  >&lt;p&gt;There are 2 examples that fails with 2.20.0 upgrade&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/camelinaction/camelinaction2/tree/master/chapter10/camel-cxf-rest-spring-boot&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/camelinaction/camelinaction2/tree/master/chapter10/camel-cxf-rest-spring-boot&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/camelinaction/camelinaction2/tree/master/chapter12/xa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/camelinaction/camelinaction2/tree/master/chapter12/xa&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16178753" author="davsclaus" created="Mon, 25 Sep 2017 09:02:26 +0000"  >&lt;p&gt;Found an issue with ActiveMQ and I logged a ticket&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6822&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16178759" author="davsclaus" created="Mon, 25 Sep 2017 09:10:36 +0000"  >&lt;p&gt;Okay got the XA problem fixed, now its only the spring boot testing problem.&lt;/p&gt;</comment>
                            <comment id="16178849" author="zregvart" created="Mon, 25 Sep 2017 11:03:04 +0000"  >&lt;p&gt;I have found that if the &lt;tt&gt;NO_START&lt;/tt&gt; flag in &lt;tt&gt;SpringCamelContext&lt;/tt&gt; is not thread-local, but global the tests pass, I&apos;ll run all tests to see if this breaks anything but it seems to be a solution.&lt;/p&gt;</comment>
                            <comment id="16180311" author="davsclaus" created="Tue, 26 Sep 2017 06:21:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt; how goes?&lt;/p&gt;</comment>
                            <comment id="16180472" author="zregvart" created="Tue, 26 Sep 2017 08:40:17 +0000"  >&lt;p&gt;I&apos;ve changed the &lt;tt&gt;NO_START&lt;/tt&gt; flag to be a global (static) &lt;tt&gt;AtomicBoolean&lt;/tt&gt; this will help with race conditions between &lt;tt&gt;CamelMainRunController&lt;/tt&gt; and &lt;tt&gt;SpringCamelContext/CamelContextFactoryBean&lt;/tt&gt; on different threads.&lt;/p&gt;

&lt;p&gt;This fix conditions itself upon different &lt;tt&gt;(Spring)CamelContexts&lt;/tt&gt; being in different classloaders to work. As far as I&apos;m aware this is true for &lt;tt&gt;wildfly-camel&lt;/tt&gt;; and integration tests support makes sure to manage the flag in single thread.&lt;/p&gt;</comment>
                            <comment id="16180493" author="zregvart" created="Tue, 26 Sep 2017 08:51:52 +0000"  >&lt;p&gt;I&apos;ve discussed this change with the &lt;tt&gt;wildfly-camel&lt;/tt&gt; team, a single classloader is used for SpringCamelContext, we need to use &lt;tt&gt;ThreadLocal&lt;/tt&gt; and we need to control &lt;tt&gt;CamelMainRunController&lt;/tt&gt; based on that.&lt;/p&gt;</comment>
                            <comment id="16180571" author="githubbot" created="Tue, 26 Sep 2017 10:04:16 +0000"  >&lt;p&gt;GitHub user zregvart opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11814&quot; title=&quot;camel-spring-boot - Recent change in startup behaviour can cause camel-test-spring problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11814&quot;&gt;&lt;del&gt;CAMEL-11814&lt;/del&gt;&lt;/a&gt;: makes NO_START a ThreadLocal, and ...&lt;/p&gt;

&lt;p&gt;    ...changes the way CamelMainRunController is started&lt;/p&gt;

&lt;p&gt;    We need to change NO_START flag back to ThreadLocal as there is a use&lt;br/&gt;
    case when it&apos;s used from a single classloader outside of the tests in&lt;br/&gt;
    wildfly-camel.&lt;/p&gt;

&lt;p&gt;    CamelMainRunController would atempt to start CamelContext from a thread&lt;br/&gt;
    that does not have the NO_START flag defined (it&apos;s a ThreadLocal), so&lt;br/&gt;
    it can only run when CamelContext is started. It&apos;s main purpose is to&lt;br/&gt;
    prevent the SpringBoot application JVM from terminating so having it&lt;br/&gt;
    run when the CamelContext is started doesn&apos;t prevent that.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zregvart/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zregvart/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11814&quot; title=&quot;camel-spring-boot - Recent change in startup behaviour can cause camel-test-spring problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11814&quot;&gt;&lt;del&gt;CAMEL-11814&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1961.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1961.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1961&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b53773853e8fff5cad3854ed096812b844086080&lt;br/&gt;
Author: Zoran Regvart &amp;lt;zregvart@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-09-26T10:03:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11814&quot; title=&quot;camel-spring-boot - Recent change in startup behaviour can cause camel-test-spring problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11814&quot;&gt;&lt;del&gt;CAMEL-11814&lt;/del&gt;&lt;/a&gt;: makes NO_START a ThreadLocal, and ...&lt;/p&gt;

&lt;p&gt;    ...changes the way CamelMainRunController is started&lt;/p&gt;

&lt;p&gt;    We need to change NO_START flag back to ThreadLocal as there is a use&lt;br/&gt;
    case when it&apos;s used from a single classloader outside of the tests in&lt;br/&gt;
    wildfly-camel.&lt;/p&gt;

&lt;p&gt;    CamelMainRunController would atempt to start CamelContext from a thread&lt;br/&gt;
    that does not have the NO_START flag defined (it&apos;s a ThreadLocal), so&lt;br/&gt;
    it can only run when CamelContext is started. It&apos;s main purpose is to&lt;br/&gt;
    prevent the SpringBoot application JVM from terminating so having it&lt;br/&gt;
    run when the CamelContext is started doesn&apos;t prevent that.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16180702" author="githubbot" created="Tue, 26 Sep 2017 12:53:13 +0000"  >&lt;p&gt;Github user zregvart closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1961&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16180707" author="zregvart" created="Tue, 26 Sep 2017 12:55:20 +0000"  >&lt;p&gt;I&apos;ve merged from &lt;a href=&quot;https://github.com/apache/camel/pull/1961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR#1961&lt;/a&gt; into &lt;tt&gt;master&lt;/tt&gt;, this way the ThreadLocal NO_START flag is preserved, and the issue with CamelMainRunController trying to start CamelContext in parallel was diverted by having the CamelMainRunController thread start after CamelContext is started (from a StartupListener).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kg93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>