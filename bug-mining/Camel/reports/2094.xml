<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:54:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5835] XPathBuilder is documented as being thread-safe, but it has thread-safety bugs.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5835</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The javadoc for org.apache.camel.builder.xml.XPathBuilder states that it is thread-safe, but an inspection of the source code in the trunk reveals that there are thread-safety bugs.&lt;/p&gt;</description>
                <environment>&lt;p&gt;This bug is not environment specific.&lt;/p&gt;</environment>
        <key id="12618233">CAMEL-5835</key>
            <summary>XPathBuilder is documented as being thread-safe, but it has thread-safety bugs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="petesramka">Peter Sramka</reporter>
                        <labels>
                            <label>thread-safety</label>
                    </labels>
                <created>Thu, 29 Nov 2012 21:25:26 +0000</created>
                <updated>Mon, 7 Jan 2013 12:21:55 +0000</updated>
                            <resolved>Mon, 7 Jan 2013 12:21:55 +0000</resolved>
                                                    <fixVersion>2.9.6</fixVersion>
                    <fixVersion>2.10.4</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13506883" author="petesramka" created="Thu, 29 Nov 2012 22:21:02 +0000"  >&lt;h4&gt;&lt;a name=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h4&gt;
&lt;p&gt;Java concurrency is a deep and subtle topic. I have found that knowledge of this topic is often lacking, even with very intelligent and experienced Java programmers. Consequently, there is much Java code in existence with concurrency bugs.&lt;/p&gt;

&lt;p&gt;Concurrency in Java is intimately inter-twined with the Java Memory Model. The Java Memory Model was updated via &lt;em&gt;JSR 133: Java Memory Model and Thread Specification Revision&lt;/em&gt;. Starting with Java 2 SE 5.0, all Java Virtual Machines are required to use this updated Java Memory Model. The results of &lt;em&gt;JSR 133&lt;/em&gt; are included in the Java Platform Standard Edition Documentation. This &lt;em&gt;JSR 133 (Java Memory Model) FAQ&lt;/em&gt; is a brief, but very well-written, synopsis of &lt;em&gt;JSR 133&lt;/em&gt;: &lt;a href=&quot;http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A basic discussion of Java concurrency is contained in the &lt;em&gt;Essential Classes Trail&lt;/em&gt; within the &lt;em&gt;Trails Covering the Basics&lt;/em&gt; of &lt;em&gt;The Java Tutorials&lt;/em&gt;: &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/essential/concurrency/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/tutorial/essential/concurrency/index.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This page from the &lt;em&gt;Essential Classes Trail&lt;/em&gt; briefly describes &lt;em&gt;Memory Consistency Errors&lt;/em&gt;: &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/essential/concurrency/memconsist.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/tutorial/essential/concurrency/memconsist.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For a more detailed discussion of Java concurrency, I highly recommend the book &lt;em&gt;Java Concurrency in Practice&lt;/em&gt;, which was written by the primary members of the &lt;em&gt;JSR 166&lt;/em&gt; Expert Group (&lt;em&gt;Concurrency Utilities&lt;/em&gt;): &lt;a href=&quot;http://jcip.net/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jcip.net/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please be advised that there are many sources of so-called &quot;expert&quot; information about Java concurrency, including published books and lectures of prestigious university professors, that are filled with fundamental technical errors. Consequently, there are many smart Java programmers who believe certain things about Java concurrency that are just plain wrong. As an example, &lt;em&gt;The &quot;Double-Checked Locking is Broken&quot; Declaration&lt;/em&gt; exposes one widely-used, but flawed, technique: &lt;a href=&quot;http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h4&gt;&lt;a name=&quot;ThreadSafeClasses&quot;&gt;&lt;/a&gt;Thread-Safe Classes&lt;/h4&gt;
&lt;p&gt;There are many techniques for writing thread-safe code, but one of the simplest and most effective is to write thread-safe classes. Here are a couple of excellent quotes from page 18 of &lt;em&gt;Java Concurrency in Practice&lt;/em&gt; (&lt;a href=&quot;http://jcip.net/):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jcip.net/):&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;A class is &lt;em&gt;thread-safe&lt;/em&gt; if it behaves correctly when accessed from multiple threads, regardless of the scheduling or interleaving of the execution of those threads by the runtime environment, and with no additional synchronization or other coordination on the part of the calling code.&quot;&lt;/p&gt;

&lt;p&gt;&quot;Thread-safe classes encapsulate any needed synchronization so that clients need not provide their own.&quot;&lt;/p&gt;

&lt;p&gt;A class is &quot;accessed from multiple threads&quot; when:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Any instance of that class is &quot;accessed from multiple threads&quot;&lt;br/&gt;
or&lt;/li&gt;
	&lt;li&gt;The class object itself &amp;#8211; the collection of all static fields and methods of the class &amp;#8211; is &quot;accessed from multiple threads&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that the statements above do not include the phrase &quot;accessed from multiple threads &lt;em&gt;simultaneously&lt;/em&gt;&quot;. It is a widely-held, but incorrect belief, that if a class is never accessed by more than one thread at a time, then all thread-safety considerations may be safely ignored for that class. If a class is accessed from multiple threads, but not simultaneously, mutual exclusion is not a concern, but memory visibility is. For more information about memory visibility and the related topic of memory consistency errors, please refer to the previous section.&lt;/p&gt;

&lt;p&gt;To determine if a particular class is thread-safe, all of the following must be analyzed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The source code of the class in question&lt;/li&gt;
	&lt;li&gt;The source code of all classes that the class in question extends either directly or indirectly&lt;/li&gt;
	&lt;li&gt;The source code of all interfaces that the class in question implements either directly or indirectly&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13506896" author="petesramka" created="Thu, 29 Nov 2012 22:37:43 +0000"  >&lt;p&gt;For example, shown here are all uses of the instance variable bodyFunction. Access to this variable is &quot;incorrectly synchronized,&quot; as defined by this &lt;em&gt;JSR 133 (Java Memory Model) FAQ&lt;/em&gt;: &lt;a href=&quot;http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12555422/12555422_screenshot-1.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13507228" author="davsclaus" created="Fri, 30 Nov 2012 09:57:52 +0000"  >&lt;p&gt;There is no problem with the default functions as they dont share any state or whatsoever. They are just anonym inlined functions as shown in the code above.&lt;/p&gt;</comment>
                            <comment id="13507230" author="davsclaus" created="Fri, 30 Nov 2012 10:00:44 +0000"  >&lt;p&gt;The functions are now being forced created when starting the builder. So they will never be null anymore.&lt;/p&gt;</comment>
                            <comment id="13507366" author="petesramka" created="Fri, 30 Nov 2012 14:59:53 +0000"  >&lt;p&gt;The changes made to the code did not make the class thread-safe. Perhaps it would help to:&lt;br/&gt;
1) Study the documentation that I presented in the comments section.&lt;br/&gt;
and/or&lt;br/&gt;
2) Get a Java thread-safety guru involved.&lt;/p&gt;</comment>
                            <comment id="13507371" author="davsclaus" created="Fri, 30 Nov 2012 15:15:10 +0000"  >&lt;p&gt;Peter&lt;/p&gt;

&lt;p&gt;Maybe you provide a patch for the Camel team to review.&lt;/p&gt;</comment>
                            <comment id="13507477" author="petesramka" created="Fri, 30 Nov 2012 17:31:43 +0000"  >&lt;p&gt;I can create the patch fairly quickly. However, I have to get legal clearance from my employer before I can make a submission to Camel. It make take awhile. I apologize for the delay...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555422" name="screenshot-1.jpg" size="62903" author="petesramka" created="Thu, 29 Nov 2012 22:32:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10063"><![CDATA[Advanced]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sg13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>