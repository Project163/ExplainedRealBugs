<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:01:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7269] camel-jpa - joinTransaction called for RESOURCE_LOCAL datasource</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7269</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;At line 82, JpaConsumer calls entityManager.joinTransaction(). This call cannot really work in environmnent without JTA. This is a change since 2.11.x and earlier versions where non JTA environments were supported&lt;/p&gt;</description>
                <environment>&lt;p&gt;tomcat+eclipselink+camel 2.12.2&lt;/p&gt;</environment>
        <key id="12698689">CAMEL-7269</key>
            <summary>camel-jpa - joinTransaction called for RESOURCE_LOCAL datasource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="ggrzybek">Grzegorz Grzybek</assignee>
                                    <reporter username="flyzepp">Hristo Sabev</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Mar 2014 18:17:01 +0000</created>
                <updated>Thu, 12 Feb 2015 10:30:40 +0000</updated>
                            <resolved>Fri, 16 Jan 2015 10:10:04 +0000</resolved>
                                    <version>2.12.0</version>
                                    <fixVersion>Future</fixVersion>
                                    <component>camel-jpa</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13920422" author="njiang" created="Wed, 5 Mar 2014 03:02:36 +0000"  >&lt;p&gt;It&apos;s the change of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5932&quot; title=&quot;Update camel-jpa for Spring 3.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5932&quot;&gt;&lt;del&gt;CAMEL-5932&lt;/del&gt;&lt;/a&gt;. Please feel free to provide patch for it.&lt;/p&gt;</comment>
                            <comment id="13925132" author="davsclaus" created="Sun, 9 Mar 2014 06:59:51 +0000"  >&lt;p&gt;Yeah maybe we should have an option on the component you can turn on|off to control if join should be called or not?&lt;/p&gt;</comment>
                            <comment id="13931929" author="davsclaus" created="Wed, 12 Mar 2014 16:21:33 +0000"  >&lt;p&gt;There is a joinTransaction option you can set to false.&lt;/p&gt;</comment>
                            <comment id="13955225" author="flyzepp" created="Mon, 31 Mar 2014 14:36:42 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Just tested the fix. Now the call to joinTransaction is ommited, however there&apos;s a later call to EntityManager.flush(), which also requires a transaction. This call is at JpaConsumer:137&lt;/p&gt;

&lt;p&gt;To my understanding the problem is a bit more generic and the fix to ommit the joinTransaction call is not enough. What is visible from the code is that the polling is done inside a TransactionTemplate with TransactionRequired behavior. This is seen at JpaEndpoint:280, where the method createTransactionTemplate is overriden and that is called at JpaConsumer:82 to create the transaction template. Now the problem is that a TransactionStatus which says that there&apos;s a new transaction is obtained from the TransactionManager at TransactionTemplate:128, no call to EntityManager.getTransaction().begin() is ever made. This leaves the entity transaction with no real jdbc transaction and the later call to EntityManager.flush just fails.&lt;/p&gt;

&lt;p&gt;An alternative would be to ommit the call to flush() and execute the call withouth any transaction similarly to how call is ommited for joinTransaction. However this more or less mangles the semantics of the transaction template with &quot;required&quot; behavior&lt;/p&gt;
</comment>
                            <comment id="14280049" author="gzres" created="Fri, 16 Jan 2015 10:09:29 +0000"  >&lt;p&gt;camel-jpa uses spring-orm (for camel 2.12.0 it is spring-orm-3.2.4.RELEASE). Even if JpaConsumer (and JpaProducer) calls &lt;tt&gt;javax.persistence.EntityManager#joinTransaction()&lt;/tt&gt;, the invocation is intercepted by spring-orm&apos;s &lt;tt&gt;org.springframework.orm.jpa.ExtendedEntityManagerCreator.ExtendedEntityManagerInvocationHandler#doJoinTransaction()&lt;/tt&gt; method which delegates only if JTA is in use. So for &lt;tt&gt;transaction-type=&quot;RESOURCE_LOCAL&quot;&lt;/tt&gt; the call is not delegated.&lt;/p&gt;

&lt;p&gt;Here&apos;s working example:&lt;/p&gt;

&lt;h6&gt;&lt;a name=&quot;METAINF%2Fpersistence.xml&quot;&gt;&lt;/a&gt;META-INF/persistence.xml&lt;/h6&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;persistence xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://java.sun.com/xml/ns/persistence&quot;&lt;/span&gt; version=&lt;span class=&quot;code-quote&quot;&gt;&quot;2.0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;persistence-unit name=&lt;span class=&quot;code-quote&quot;&gt;&quot;camel&quot;&lt;/span&gt; transaction-type=&lt;span class=&quot;code-quote&quot;&gt;&quot;RESOURCE_LOCAL&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;class&amp;gt;&lt;/span&gt;grgr.test.camel.model.Person&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/class&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;exclude-unlisted-classes&amp;gt;&lt;/span&gt;true&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/exclude-unlisted-classes&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/persistence-unit&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/persistence&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h6&gt;&lt;a name=&quot;JUnittest&quot;&gt;&lt;/a&gt;JUnit test&lt;/h6&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JpaTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Logger LOG = LoggerFactory.getLogger(JpaTest.class);
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DateFormat TS = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd HH:mm:ss&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; javax.sql.DataSource ds;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; EntityManagerFactory emf;

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; CamelContext createCamelContext() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        DataSource dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataSource();
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ds = dataSource;
        dataSource.setDriverClassName(Driver.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());
        &lt;span class=&quot;code-comment&quot;&gt;// docker PostgreSQL instance
&lt;/span&gt;        dataSource.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:postgresql:&lt;span class=&quot;code-comment&quot;&gt;//172.17.0.2:5432/camel&quot;&lt;/span&gt;);
&lt;/span&gt;        dataSource.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;postgres&quot;&lt;/span&gt;);
        dataSource.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;postgres&quot;&lt;/span&gt;);

        LocalEntityManagerFactoryBean localEntityManagerFactoryBean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LocalEntityManagerFactoryBean();
        localEntityManagerFactoryBean.setJpaDialect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenJpaDialect());
        localEntityManagerFactoryBean.setPersistenceUnitName(&lt;span class=&quot;code-quote&quot;&gt;&quot;camel&quot;&lt;/span&gt;);
        HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; jpaProperties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        jpaProperties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;openjpa.ConnectionFactory&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ds);
        localEntityManagerFactoryBean.setJpaPropertyMap(jpaProperties);
        localEntityManagerFactoryBean.afterPropertiesSet();
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.emf = localEntityManagerFactoryBean.getObject();

        JpaTransactionManager txManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JpaTransactionManager();
        txManager.setDataSource(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ds);
        txManager.setEntityManagerFactory(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.emf);
        txManager.afterPropertiesSet();

        DefaultCamelContext context = (DefaultCamelContext) &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createCamelContext();
        SimpleRegistry registry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleRegistry();
        registry.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;txManager&quot;&lt;/span&gt;, txManager);
        context.setRegistry(registry);

        JpaComponent jpaComponent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JpaComponent();
        jpaComponent.setEntityManagerFactory(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.emf);
        jpaComponent.setTransactionManager(txManager);
        context.addComponent(&lt;span class=&quot;code-quote&quot;&gt;&quot;jpa&quot;&lt;/span&gt;, jpaComponent);

        context.addRoutes(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;)
                        .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Body written: ${body}&quot;&lt;/span&gt;)
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;jpa:grgr.test.camel.model.Person&quot;&lt;/span&gt;);
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jpa:grgr.test.camel.model.Person?consumeDelete=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;consumer.delay=5000&quot;&lt;/span&gt;)
                        .transacted()
                        .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Body read: ${body}&quot;&lt;/span&gt;)
                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                Person person = exchange.getIn().getBody(Person.class);
                                LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Received: {} ({})&quot;&lt;/span&gt;, person.getName(), person.getDate());
                            }
                        });
            }
        });

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; context;
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testJpaWrite() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        Person result = template.requestBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person(&lt;span class=&quot;code-quote&quot;&gt;&quot;Terrence&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date()), Person.class);
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Result: {}: {}&quot;&lt;/span&gt;, result.getId(), result.getName());
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please reopen if the problem persists.&lt;/p&gt;</comment>
                            <comment id="14316558" author="abdelgadiri" created="Wed, 11 Feb 2015 17:16:09 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I am hitting same issue when upgraded from camel 2.11.x to (2.13.x). Also failing for me in 2.14.x.&lt;br/&gt;
when joinTransaction=true (the default in 2.12.x, 2.13.x and 2.14.x) my route hangs on below line in JpaConsumer.java class&lt;/p&gt;

&lt;p&gt;               // commit &lt;br/&gt;
                LOG.debug(&quot;Flushing EntityManager&quot;);&lt;br/&gt;
                entityManager.flush(); (line 137 of JpaConsumer.java class)&lt;/p&gt;


&lt;p&gt;when I set joinTransaction=false on the route uri, the route completes fine. But subsequent polls keep throwing following warning below. Now this may not be really an issue as it is just a warning but it is filling up my logs and I wonder if something is wrong.&lt;/p&gt;

&lt;p&gt;I am using RESOURCE_LOCAL entitymanager.&lt;/p&gt;

&lt;p&gt; 2015-02-11 16:49:10.633 &lt;span class=&quot;error&quot;&gt;&amp;#91;Camel (DefaultCamelContext) thread #0 - jpa://VFile&amp;#93;&lt;/span&gt; WARN  o.a.camel.component.jpa.JpaConsumer - Consumer Consumer[jpa://VFile?consumeDelete=false&amp;amp;consumer.query=select+vf+fro&lt;br/&gt;
m+VFile+vf+where+vf.processed%3Dfalse+and+vf.processorId+in+%28%27REPORT_EXPORT%27%29&amp;amp;joinTransaction=false&amp;amp;maximumResults=1] failed polling endpoint: Endpoint[jpa://VFile?consumeDelete=false&amp;amp;&lt;br/&gt;
consumer.query=select+vf+from+VFile+vf+where+vf.processed%3Dfalse+and+vf.processorId+in+%28%27REPORT_EXPORT%27%29&amp;amp;joinTransaction=false&amp;amp;maximumResults=1]. Will try again at next poll. Caused b&lt;br/&gt;
y: &lt;span class=&quot;error&quot;&gt;&amp;#91;javax.persistence.TransactionRequiredException - no transaction is in progress&amp;#93;&lt;/span&gt;&lt;br/&gt;
javax.persistence.TransactionRequiredException: no transaction is in progress&lt;br/&gt;
        at org.hibernate.jpa.spi.AbstractEntityManagerImpl.checkTransactionNeeded(AbstractEntityManagerImpl.java:1171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hibernate-entitymanager-4.3.8.Final.jar:4.3.8.Final&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.hibernate.jpa.spi.AbstractEntityManagerImpl.flush(AbstractEntityManagerImpl.java:1332) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hibernate-entitymanager-4.3.8.Final.jar:4.3.8.Final&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor139.invoke(Unknown Source) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:606) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:366) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;spring-orm-3.2.13.RELEASE.jar:3.2.13.RELEASE&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;        at com.sun.proxy.$Proxy178.flush(Unknown Source) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.camel.component.jpa.JpaConsumer$1.doInTransaction(JpaConsumer.java:137) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-jpa-2.13.3.jar:2.13.3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:131) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;spring-tx-3.2.13.RELEASE.jar:3.2.13.RELEASE&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.camel.component.jpa.JpaConsumer.poll(JpaConsumer.java:91) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-jpa-2.13.3.jar:2.13.3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:187) &lt;span class=&quot;error&quot;&gt;&amp;#91;camel-core-2.13.3.jar:2.13.3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:114) &lt;span class=&quot;error&quot;&gt;&amp;#91;camel-core-2.13.3.jar:2.13.3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_67&amp;#93;&lt;/span&gt;&lt;/p&gt;

</comment>
                            <comment id="14317912" author="abdelgadiri" created="Thu, 12 Feb 2015 09:51:13 +0000"  >&lt;p&gt;update:&lt;br/&gt;
my problems seems to be solved when I specify following uri parameters: &quot;consumer.transacted=true&amp;amp;joinTransaction=true&quot;&lt;/p&gt;

&lt;p&gt;I am fetching only *&lt;b&gt;one&lt;/b&gt;* db record at a time, so &apos;consumer.transacted&apos; is not really changing the semantics of my original logic as I still commit after every 1 message as opposed to after a batch of messages. I am not sure though why joinTransaction=true worked this time even though my data source is still RESOURCE_LOCAL&lt;/p&gt;</comment>
                            <comment id="14317919" author="gzres" created="Thu, 12 Feb 2015 09:57:40 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Have you run your test case under debugger? You should be able to see that&lt;br/&gt;
Spring-provided entity manager wrapper actually checks if it has to&lt;br/&gt;
delegate &quot;joinTransaction()&quot; call or not.&lt;/p&gt;

&lt;p&gt;regards&lt;br/&gt;
Grzegorz Grzybek&lt;/p&gt;

</comment>
                            <comment id="14317963" author="abdelgadiri" created="Thu, 12 Feb 2015 10:30:40 +0000"  >&lt;p&gt;I have now debugged and yes the entitymanager wrapper (org.springframework.orm.jpa.ExtendedEntityManagerCreator.java) is checking whether JTA is being used in which case it joins the transaction else it calls entityManager.getTransaction().begin()&lt;/p&gt;

&lt;p&gt;Thank you for your help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10063"><![CDATA[Advanced]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377047</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1syzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>