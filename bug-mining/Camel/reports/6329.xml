<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:58:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18739] ZipAggregationStrategy loses onCompletion</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18739</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We are facing an issue where we end up with stale files in the temp directory (on Windows: C:\Users\...\AppData\Local\Temp). This stops our application from running.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Problem description:&lt;/p&gt;

&lt;p&gt;When using &quot;Split Definition&quot; with &quot;ZipAggregationStrategy&quot;, we try to aggregate multiple parts in one zip archive. Our Code does exactly that and works fine, but it misses the step to delete the temporaly created archive (created automactly) in the temp directory after completion.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We would expect that the completion of the route does the deletion.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Having a look in into the code, we saw that the &quot;ZipAggregationStrategy&quot; does have a &quot;DeleteZipFileOnCompletion&quot;, which does exactly that. The &quot;OnCompletion&quot; is also added to the exchange. However,&#160; the deletion is never executed, due to a copy of the subexchange to the original exchange (losing the previously added onComplete)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Attached you can find code to reproduce the issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13504817">CAMEL-18739</key>
            <summary>ZipAggregationStrategy loses onCompletion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="AlexanderLex">Alexander Lex</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2022 12:52:31 +0000</created>
                <updated>Wed, 14 Dec 2022 18:00:55 +0000</updated>
                            <resolved>Wed, 14 Dec 2022 18:00:55 +0000</resolved>
                                    <version>3.19.0</version>
                                    <fixVersion>3.20.0</fixVersion>
                                    <component>camel-zipfile</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17636668" author="davsclaus" created="Mon, 21 Nov 2022 12:56:01 +0000"  >&lt;p&gt;Can you attach the reproducer as tar or zip (not 7z)&lt;/p&gt;</comment>
                            <comment id="17636670" author="JIRAUSER293944" created="Mon, 21 Nov 2022 13:08:56 +0000"  >&lt;p&gt;Maybe it helps to add:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;// must copy results at this point&lt;br/&gt;
if (subExchange != null) {&lt;br/&gt;
&#160;&#160;&#160; if (stoppedOnException) &lt;/p&gt;
{
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // if we stopped due an exception then only propagate the exception
&#160;&#160;&#160;&#160;&#160;&#160;&#160; original.setException(subExchange.getException());
&#160;&#160;&#160; }
&lt;p&gt; else &lt;/p&gt;
{
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // copy the current result to original so it will contain this result of this eip
&#160;&#160;&#160;&#160;&#160;&#160;&#160; ExchangeHelper.copyResults(original, subExchange);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; *subExchange.adapt(ExtendedExchange.class).handoverCompletions(original);*
&#160;&#160;&#160; }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;MulticastProcessor.java&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17640810" author="JIRAUSER293944" created="Tue, 29 Nov 2022 16:16:31 +0000"  >&lt;p&gt;Added a PR:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/8795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/8795&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17647649" author="davsclaus" created="Wed, 14 Dec 2022 17:55:39 +0000"  >&lt;p&gt;Did the same fix for camel-tarfile&lt;/p&gt;</comment>
                            <comment id="17647651" author="davsclaus" created="Wed, 14 Dec 2022 18:00:55 +0000"  >&lt;p&gt;Thanks for reporting and the PR and unit test&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13052933" name="zipaggregator-oncomplete.zip" size="32883" author="AlexanderLex" created="Mon, 21 Nov 2022 12:59:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1cjcg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>