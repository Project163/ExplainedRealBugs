<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:06:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17110] Camel-Kamelets: While using AWS S3 source noticed files were deleted before being consumed at all</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17110</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- route:
    from:
      uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;kamelet:aws-s3-source&quot;&lt;/span&gt;
      parameters:
        bucketNameOrArn: &lt;span class=&quot;code-quote&quot;&gt;&quot;camel-kafka-connector&quot;&lt;/span&gt;
        accessKey: &lt;span class=&quot;code-quote&quot;&gt;&quot;access&quot;&lt;/span&gt;
        secretKey: &lt;span class=&quot;code-quote&quot;&gt;&quot;secret&quot;&lt;/span&gt;
        region: &lt;span class=&quot;code-quote&quot;&gt;&quot;eu-west-1&quot;&lt;/span&gt;
    steps:
      - to: 
          uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;kamelet:kafka-not-secured-sink&quot;&lt;/span&gt;
          parameters:
            brokers: &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;
            topic: &lt;span class=&quot;code-quote&quot;&gt;&quot;s3-source-topic&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the log, if you enabled trace you may notice something like:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
10:14:24.476 [Camel (AWS-S3-To-Kafka) thread #11 - KafkaProducer[s3-source-topic]] TRACE o.a.c.c.aws2.s3.AWS2S3Consumer - Deleted object from bucket camel-kafka-connector with key jkXzIEbaYyKMTMwGpNHL.txt...

10:14:24.491 [Camel (AWS-S3-To-Kafka) thread #0 - aws2-s3:&lt;span class=&quot;code-comment&quot;&gt;//camel-kafka-connector] TRACE s.a.awssdk.auth.signer.Aws4Signer - AWS4 Canonical Request: GET
&lt;/span&gt;/jkXzIEbaYyKMTMwGpNHL.txt

10:14:24.582 [Camel (AWS-S3-To-Kafka) thread #0 - aws2-s3:&lt;span class=&quot;code-comment&quot;&gt;//camel-kafka-connector] DEBUG software.amazon.awssdk.request - Received error response: software.amazon.awssdk.services.s3.model.NoSuchKeyException: The specified key does not exist. &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While, the get should happens before the deletions. This is happening only when using Kamelets. It looks like the exchange completed before the get operation has been done.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13407462">CAMEL-17110</key>
            <summary>Camel-Kamelets: While using AWS S3 source noticed files were deleted before being consumed at all</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="acosentino">Andrea Cosentino</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Oct 2021 08:43:29 +0000</created>
                <updated>Sun, 7 Jul 2024 10:26:09 +0000</updated>
                            <resolved>Fri, 5 Jul 2024 07:35:39 +0000</resolved>
                                    <version>3.11.3</version>
                                    <fixVersion>4.7.0</fixVersion>
                                    <component>camel-aws</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17431169" author="davsclaus" created="Wed, 20 Oct 2021 12:11:06 +0000"  >&lt;p&gt;After digging a bit, it looks like its the aws-s3 consumer is having a race condition, where a previous poll picked up a file, that is sent to kafka, that is processed asynchronously so the current thread becomes idle, and then on next poll, the consumer thread &quot;sees&quot; the same file as on previous poll, that the kafka producer is currently sending. And so when the kafka producer is done sending, it has an on completion to delete the s3 file, which it does, at the same time as the other thread is trying to process the file (duplicate), which is then now deleted.&lt;/p&gt;

&lt;p&gt;What the s3 consumer lacks is an in-progress repository to keep track of currently in-flight messages with files. The camel-file component have such feature.&lt;/p&gt;

&lt;p&gt;We can add similar inflight repository as we have in camel-file to s3 - its a bit of work as you need to ensure to keep the in flight repo correctly up to date when there are exceptions / batch break before all done etc. But basically copy/paste from camel-file where you can.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13407464">CAMEL-17111</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w000:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>