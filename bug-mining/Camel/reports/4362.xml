<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:27:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12082] Camel route commands should set the TCCL when working with local camel context</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12082</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This causes class not found issues in Karaf when restarting routes for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
13:33:50.734 WARN [pipe-camel:route-start websocket camel-context] unavailable
java.lang.RuntimeException: Unable to load org.eclipse.jetty.websocket.server.WebSocketServerFactory
	at org.eclipse.jetty.websocket.servlet.WebSocketServletFactory$Loader.load(WebSocketServletFactory.java:53) ~[?:?]
	at org.eclipse.jetty.websocket.servlet.WebSocketServlet.init(WebSocketServlet.java:138) ~[?:?]
	at javax.servlet.GenericServlet.init(GenericServlet.java:244) ~[34:javax.servlet-api:3.1.0]
	at org.eclipse.jetty.servlet.ServletHolder.initServlet(ServletHolder.java:640) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletHolder.initialize(ServletHolder.java:419) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletHandler.initialize(ServletHandler.java:892) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletHandler.updateMappings(ServletHandler.java:1596) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletHandler.setServletMappings(ServletHandler.java:1684) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletHandler.addServletWithMapping(ServletHandler.java:1027) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.eclipse.jetty.servlet.ServletContextHandler.addServlet(ServletContextHandler.java:437) [241:org.eclipse.jetty.servlet:9.3.15.v20161220]
	at org.apache.camel.component.websocket.WebsocketComponent.createServlet(WebsocketComponent.java:457) [226:org.apache.camel.camel-websocket:2.21.0]
	at org.apache.camel.component.websocket.WebsocketComponent.addServlet(WebsocketComponent.java:439) [226:org.apache.camel.camel-websocket:2.21.0]
	at org.apache.camel.component.websocket.WebsocketComponent.connect(WebsocketComponent.java:214) [226:org.apache.camel.camel-websocket:2.21.0]
	at org.apache.camel.component.websocket.WebsocketEndpoint.connect(WebsocketEndpoint.java:123) [226:org.apache.camel.camel-websocket:2.21.0]
	at org.apache.camel.component.websocket.WebsocketProducer.doStart(WebsocketProducer.java:84) [226:org.apache.camel.camel-websocket:2.21.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.deferStartService(DefaultCamelContext.java:1558) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.doAddService(DefaultCamelContext.java:1475) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.addService(DefaultCamelContext.java:1445) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.ProducerCache.doGetProducer(ProducerCache.java:576) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.ProducerCache.acquireProducer(ProducerCache.java:168) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.processor.SendProcessor.doStart(SendProcessor.java:248) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:104) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:90) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.processor.RedeliveryErrorHandler.doStart(RedeliveryErrorHandler.java:1472) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ChildServiceSupport.start(ChildServiceSupport.java:44) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ChildServiceSupport.start(ChildServiceSupport.java:31) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:104) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:90) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.processor.interceptor.DefaultChannel.doStart(DefaultChannel.java:160) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:104) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:62) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:104) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:90) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.processor.MulticastProcessor.doStart(MulticastProcessor.java:1172) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:104) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:90) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.processor.DelegateAsyncProcessor.doStart(DelegateAsyncProcessor.java:80) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:75) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.RouteService.startChildService(RouteService.java:370) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.RouteService.doWarmUp(RouteService.java:196) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.RouteService.warmUp(RouteService.java:145) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.doWarmUpRoutes(DefaultCamelContext.java:3947) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:3854) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:3899) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.startRouteService(DefaultCamelContext.java:3753) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:1176) [54:org.apache.camel.camel-core:2.21.0]
	at org.apache.camel.commands.AbstractLocalCamelController.startRoute(AbstractLocalCamelController.java:341) [53:org.apache.camel.camel-commands-core:2.21.0]
	at org.apache.camel.commands.RouteStartCommand.executeOnRoute(RouteStartCommand.java:32) [53:org.apache.camel.camel-commands-core:2.21.0]
	at org.apache.camel.commands.AbstractRouteCommand.execute(AbstractRouteCommand.java:56) [53:org.apache.camel.camel-commands-core:2.21.0]
	at org.apache.camel.karaf.commands.RouteStart.execute(RouteStart.java:30) [67:org.apache.camel.karaf.camel-karaf-commands:2.21.0]
	at org.apache.karaf.shell.impl.action.command.ActionCommand.execute(ActionCommand.java:84) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:68) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:86) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:571) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:497) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:386) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Pipe.doCall(Pipe.java:417) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:229) [144:org.apache.karaf.shell.core:4.2.0]
	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:59) [144:org.apache.karaf.shell.core:4.2.0]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:?]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:?]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [?:?]
Caused by: java.lang.ClassNotFoundException: org.eclipse.jetty.websocket.server.WebSocketServerFactory
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:424) ~[?:?]
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method) ~[?:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348) ~[?:?]
	at org.eclipse.jetty.websocket.servlet.WebSocketServletFactory$Loader.load(WebSocketServletFactory.java:47) ~[?:?]
	... 76 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll push a PR&lt;/p&gt;</description>
                <environment></environment>
        <key id="13124901">CAMEL-12082</key>
            <summary>Camel route commands should set the TCCL when working with local camel context</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpoth">John Poth</assignee>
                                    <reporter username="jpoth">John Poth</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Dec 2017 09:27:11 +0000</created>
                <updated>Thu, 14 Dec 2017 09:40:11 +0000</updated>
                            <resolved>Thu, 14 Dec 2017 09:39:59 +0000</resolved>
                                    <version>2.20.1</version>
                                    <fixVersion>2.20.2</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16290609" author="githubbot" created="Thu, 14 Dec 2017 09:31:04 +0000"  >&lt;p&gt;johnpoth opened a new pull request #2146: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when execut&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;ing local route commands&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12082&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   This is similar to what&apos;s being done in &lt;span class=&quot;error&quot;&gt;&amp;#91;AbstractContexCommand&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/camel/blob/792ce5c5cc0af486b39471cf68206a2e95d3a037/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractContextCommand.java#L63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/792ce5c5cc0af486b39471cf68206a2e95d3a037/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractContextCommand.java#L63&lt;/a&gt;) and &lt;span class=&quot;error&quot;&gt;&amp;#91;DefaultCamelContext&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/camel/blob/bb39dc44d9603c0e6fce2460ddf35a7b94ca30d4/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java#L3264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/bb39dc44d9603c0e6fce2460ddf35a7b94ca30d4/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java#L3264&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16290610" author="githubbot" created="Thu, 14 Dec 2017 09:31:05 +0000"  >&lt;p&gt;GitHub user johnpoth opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when execut&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ing local route commands&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12082&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This is similar to what&apos;s being done in &lt;span class=&quot;error&quot;&gt;&amp;#91;AbstractContexCommand&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/camel/blob/792ce5c5cc0af486b39471cf68206a2e95d3a037/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractContextCommand.java#L63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/792ce5c5cc0af486b39471cf68206a2e95d3a037/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractContextCommand.java#L63&lt;/a&gt;) and &lt;span class=&quot;error&quot;&gt;&amp;#91;DefaultCamelContext&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/camel/blob/bb39dc44d9603c0e6fce2460ddf35a7b94ca30d4/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java#L3264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/bb39dc44d9603c0e6fce2460ddf35a7b94ca30d4/camel-core/src/main/java/org/apache/camel/impl/DefaultCamelContext.java#L3264&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Thanks!&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/johnpoth/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/johnpoth/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2146.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2146&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0572728f52a2d546cb7c0208c84108c8556643fe&lt;br/&gt;
Author: jpoth &amp;lt;poth.john@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-12-13T17:00:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when executing local route commands&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16290614" author="githubbot" created="Thu, 14 Dec 2017 09:36:14 +0000"  >&lt;p&gt;oscerd closed pull request #2146: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when execut&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractRouteCommand.java b/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractRouteCommand.java&lt;br/&gt;
index 74611e8b703..d0da95c57bf 100644&lt;br/&gt;
&amp;#8212; a/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractRouteCommand.java&lt;br/&gt;
+++ b/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/AbstractRouteCommand.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Map;&lt;/p&gt;

&lt;p&gt;+import org.apache.camel.CamelContext;&lt;br/&gt;
 import org.apache.camel.commands.internal.RegexUtil;&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -53,12 +54,36 @@ public Object execute(CamelController camelController, PrintStream out, PrintStr&lt;br/&gt;
         for (Map&amp;lt;String, String&amp;gt; row : camelRoutes) {&lt;br/&gt;
             String camelContextName = row.get(&quot;camelContextName&quot;);&lt;br/&gt;
             String routeId = row.get(&quot;routeId&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;executeOnRoute(camelController, camelContextName, routeId, out, err);&lt;br/&gt;
+            if (camelController instanceof LocalCamelController) 
{
+                executeLocal((LocalCamelController) camelController, camelContextName, routeId, out, err);
+            }
&lt;p&gt; else &lt;/p&gt;
{
+                executeOnRoute(camelController, camelContextName, routeId, out, err);
+            }
&lt;p&gt;         }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         return null;&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    private void executeLocal(LocalCamelController camelController, String camelContextName, String routeId, PrintStream out, PrintStream err) throws Exception {&lt;br/&gt;
+        CamelContext camelContext = camelController.getLocalCamelContext(context);&lt;br/&gt;
+        if (camelContext == null) &lt;/p&gt;
{
+            err.println(&quot;Camel context &quot; + context + &quot; not found.&quot;);
+            return;
+        }
&lt;p&gt;+&lt;br/&gt;
+        // Setting thread context classloader to the bundle classloader to enable legacy code that relies on it&lt;br/&gt;
+        ClassLoader oldClassloader = Thread.currentThread().getContextClassLoader();&lt;br/&gt;
+        ClassLoader applicationContextClassLoader = camelContext.getApplicationContextClassLoader();&lt;br/&gt;
+        if (applicationContextClassLoader  != null) &lt;/p&gt;
{
+            Thread.currentThread().setContextClassLoader(applicationContextClassLoader);
+        }
&lt;p&gt;+        try &lt;/p&gt;
{
+            executeOnRoute(camelController, camelContextName, routeId, out, err);
+        }
&lt;p&gt; finally &lt;/p&gt;
{
+            Thread.currentThread().setContextClassLoader(oldClassloader);
+        }
&lt;p&gt;+    }&lt;br/&gt;
+&lt;br/&gt;
     public abstract void executeOnRoute(CamelController camelController, String contextName, String routeId, PrintStream out, PrintStream err) throws Exception;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16290615" author="githubbot" created="Thu, 14 Dec 2017 09:36:14 +0000"  >&lt;p&gt;Github user oscerd closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16290616" author="githubbot" created="Thu, 14 Dec 2017 09:36:34 +0000"  >&lt;p&gt;oscerd commented on issue #2146: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when execut&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2146#issuecomment-351657908&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146#issuecomment-351657908&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the PR it has been merged into master. I&apos;ll backport on 2.20.x too&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16290622" author="githubbot" created="Thu, 14 Dec 2017 09:40:11 +0000"  >&lt;p&gt;johnpoth commented on issue #2146: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12082&quot; title=&quot;Camel route commands should set the TCCL when working with local camel context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12082&quot;&gt;&lt;del&gt;CAMEL-12082&lt;/del&gt;&lt;/a&gt; Set the TCCL to the application classloader when execut&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2146#issuecomment-351658775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2146#issuecomment-351658775&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks @oscerd !&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nw9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>