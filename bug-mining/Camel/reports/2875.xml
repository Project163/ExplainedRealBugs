<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:04:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7803] DefaultJdbcPrepareStatementStrategy Iterator fails on null value inserts</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7803</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The iterator returned by createPopulateIterator in DefaultJdbcPrepareStatementStrategy incorrectly uses a next value of &quot;null&quot; to identify when it has run out of parameters.  This fails when the parameter map intentionally contains a name with a null value, which is the case when some columns in an insert should be set to null.  The attached pull request adds an explicit preFetch flag and relies on the done flag, avoiding the incorrect overloading of (next==null) to indicate completion.&lt;/p&gt;

&lt;p&gt;The iterator reports &quot;hasNext() == false&quot; when it encounters a map value of null.  This happens when using the map header JDBC_PARAMETERS = &quot;CamelJdbcParameters&quot; to insert null values with a prepared statement.  The Iterator ends prematurely when it reaches a parameter name with a null value.  &lt;/p&gt;

&lt;p&gt;For example, passing in a map where the 3rd parameter of 19 has a value of null causes the following exception to be thrown:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Number of parameters mismatch. Expected: 19, was:2&lt;br/&gt;
        at org.apache.camel.component.jdbc.DefaultJdbcPrepareStatementStrategy.populateStatement(DefaultJdbcPrepareStatementStrategy.java:137)&lt;br/&gt;
        at org.apache.camel.component.jdbc.JdbcProducer.doCreateAndExecuteSqlStatementWithHeaders(JdbcProducer.java:133)&lt;br/&gt;
        at org.apache.camel.component.jdbc.JdbcProducer.createAndExecuteSqlStatement(JdbcProducer.java:116)&lt;br/&gt;
        at org.apache.camel.component.jdbc.JdbcProducer.processingSqlBySettingAutoCommit(JdbcProducer.java:85)&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12740774">CAMEL-7803</key>
            <summary>DefaultJdbcPrepareStatementStrategy Iterator fails on null value inserts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="nathanwray">Nathan Wray</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Sep 2014 12:53:01 +0000</created>
                <updated>Tue, 11 Nov 2014 01:29:55 +0000</updated>
                            <resolved>Tue, 16 Sep 2014 13:09:13 +0000</resolved>
                                    <version>2.13.2</version>
                                    <fixVersion>2.12.5</fixVersion>
                    <fixVersion>2.13.3</fixVersion>
                    <fixVersion>2.14.1</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14130000" author="nathanwray" created="Thu, 11 Sep 2014 13:17:03 +0000"  >&lt;p&gt;Patch added new boolean flag &quot;preFetched&quot; that replaces the (next==null) test.  this allows names with null values to succeed.&lt;/p&gt;</comment>
                            <comment id="14130177" author="githubbot" created="Thu, 11 Sep 2014 15:57:43 +0000"  >&lt;p&gt;GitHub user nathanwray opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/265&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-7803&quot; title=&quot;DefaultJdbcPrepareStatementStrategy Iterator fails on null value inserts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-7803&quot;&gt;&lt;del&gt;CAMEL-7803&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     Patch added new boolean flag &quot;preFetched&quot; to allow inserts with parameters that have null values&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nathanwray/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nathanwray/camel&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/265.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/265.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #265&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 693fea2b3cee7be931b4bcfd92726e75f782adf9&lt;br/&gt;
Author: nathanwray &amp;lt;nathanwray@users.noreply.github.com&amp;gt;&lt;br/&gt;
Date:   2014-09-11T15:57:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-7803&quot; title=&quot;DefaultJdbcPrepareStatementStrategy Iterator fails on null value inserts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-7803&quot;&gt;&lt;del&gt;CAMEL-7803&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     Patch added new boolean flag &quot;preFetched&quot; to allow inserts with parameters that have null values&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14130181" author="nathanwray" created="Thu, 11 Sep 2014 15:59:50 +0000"  >&lt;p&gt;Created pull request &lt;a href=&quot;https://github.com/apache/camel/pull/265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/265&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14135395" author="njiang" created="Tue, 16 Sep 2014 13:09:13 +0000"  >&lt;p&gt;Applied the patch into master, camel-2.14.x, camel-2.13.x and camel-2.12.x with thanks to Nathan.&lt;/p&gt;</comment>
                            <comment id="14135410" author="githubbot" created="Tue, 16 Sep 2014 13:22:31 +0000"  >&lt;p&gt;Github user nathanwray closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/265&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14205354" author="camelguy" created="Mon, 10 Nov 2014 21:27:06 +0000"  >&lt;p&gt;I appreciate that this is fixed. I spent the past 48 hours trying to figure this out. Eventually I found this JIRA and switched to 2.14.1-SNAPSHOT. When will 2.14.1 be released? I&apos;m OK but I thought I would add my two cents about the severity of this problem especially for newbies. This was a killer as the error message implies that it&apos;s user error.&lt;/p&gt;</comment>
                            <comment id="14205758" author="njiang" created="Tue, 11 Nov 2014 01:29:33 +0000"  >&lt;p&gt;As we target Camel 2.14.1 release at the end of this year, I suggest you to use the Camel 2.13.3 if you are not using any new Camel components of 2.14.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12668070" name="7803-patch.txt" size="988" author="nathanwray" created="Thu, 11 Sep 2014 13:17:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zxdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>