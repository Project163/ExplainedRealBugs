<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:24:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8419] Camel StreamCache does not work with CXF consumer for InOut messages</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8419</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If a route that is started by a CXF consumer and has an InOut exchange pattern (meaning that the CXF consumer is returning a response back to the caller) contains a StreamCache as message object that is not in memory, returning the payload will fail.&lt;/p&gt;

&lt;p&gt;The reason for this is that an on-disk stream cache in Camel will be removed when the LUW ends, but CXF will return the response afterwards.&lt;/p&gt;

&lt;p&gt;See the two attached unit tests for details.&lt;/p&gt;

&lt;p&gt;I don&apos;t like the actual patch too much, as it copies on-disk camel stream caches into CXF stream caches when creating the CXF message object in camel CXF, but this is about the last step before the LUW ends (and the file gets deleted).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12778695">CAMEL-8419</key>
            <summary>Camel StreamCache does not work with CXF consumer for InOut messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="siano">Stephan Siano</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Mar 2015 06:55:07 +0000</created>
                <updated>Thu, 29 Jun 2017 18:55:59 +0000</updated>
                            <resolved>Thu, 29 Jun 2017 11:55:59 +0000</resolved>
                                    <version>2.14.1</version>
                                    <fixVersion>2.20.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14349022" author="davsclaus" created="Thu, 5 Mar 2015 16:25:01 +0000"  >&lt;p&gt;It should be done like camel-jetty does, it lets the consumer create the uow and handle that lifecycle&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L146&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then it writes the response&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And in the finally it done the UoW&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-jetty-common/src/main/java/org/apache/camel/component/jetty/CamelContinuationServlet.java#L206&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then the stream cache which may have been offloaded to disk will only get the file deleted after the consumer has sent back the response. &lt;/p&gt;</comment>
                            <comment id="14526547" author="siano" created="Mon, 4 May 2015 11:35:05 +0000"  >&lt;p&gt;The initial patch was not closing the CachedOutputStream.&lt;/p&gt;

&lt;p&gt;I agree with Claus, that it would be better to have a callback that was ending the Camel LUW once CXF has finished processing the message (not when giving the control back to CXF), but I have not yet found any facility in CXF for that.&lt;/p&gt;</comment>
                            <comment id="16023748" author="onders" created="Wed, 24 May 2017 21:43:18 +0000"  >&lt;p&gt;2.14.x is a old branch. and this is an old issue. should we consider for 2.17.x 2.18x and 2.19.x and 2.20.x?&lt;/p&gt;</comment>
                            <comment id="16028054" author="siano" created="Mon, 29 May 2017 05:17:41 +0000"  >&lt;p&gt;The issue still occurs with newer versions, so yes, we should consider this. I still don&apos;t have a better idea than copying the Camel stream cache into a CXF stream cache, but maybe some CXF expert has a good idea for this.&lt;/p&gt;</comment>
                            <comment id="16051026" author="githubbot" created="Thu, 15 Jun 2017 20:38:39 +0000"  >&lt;p&gt;GitHub user snurmine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1766&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt; Camel StreamCache does not work with CXF consumer for InOut messages&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Closing UnitOfWork after Continuation has been processed&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/snurmine/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/snurmine/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1766.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1766.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1766&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 714cc53551aed07e572d94d7d8e762585e5f5317&lt;br/&gt;
Author: Sami Nurminen &amp;lt;snurmine@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-06-15T20:38:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt; Camel StreamCache does not work with CXF consumer for InOut messages&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closing UnitOfWork after Continuation has been processed&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="16057677" author="githubbot" created="Wed, 21 Jun 2017 15:15:24 +0000"  >&lt;p&gt;Github user snurmine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1766&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16062416" author="githubbot" created="Sun, 25 Jun 2017 19:51:50 +0000"  >&lt;p&gt;GitHub user snurmine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1783&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt; Camel StreamCache does not work with CXF consumer for InOu&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;t messages&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Closing UnitOfWork in Interceptor/MessageObserver&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/snurmine/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/snurmine/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1783.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1783.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1783&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0422b848b89a1038861cc8b86e4413fa9e60a6cf&lt;br/&gt;
Author: Sami Nurminen &amp;lt;snurmine@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-06-15T20:38:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8419&quot; title=&quot;Camel StreamCache does not work with CXF consumer for InOut messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8419&quot;&gt;&lt;del&gt;CAMEL-8419&lt;/del&gt;&lt;/a&gt; Camel StreamCache does not work with CXF consumer for InOut messages&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closing UnitOfWork in Interceptor/MessageObserver&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="16064463" author="davsclaus" created="Tue, 27 Jun 2017 08:28:59 +0000"  >&lt;p&gt;Thanks Sami for the PR. I think it looks good, but would just like a CXF committer to glace at the code before we do any merge.&lt;/p&gt;</comment>
                            <comment id="16068233" author="davsclaus" created="Thu, 29 Jun 2017 11:55:59 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                            <comment id="16068788" author="githubbot" created="Thu, 29 Jun 2017 18:55:59 +0000"  >&lt;p&gt;Github user snurmine closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1783&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12730161" name="0001-CAMEL-8419-Camel-StreamCache-does-not-work-with-CXF-.patch" size="9591" author="siano" created="Mon, 4 May 2015 11:35:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i268cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>