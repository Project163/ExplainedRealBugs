<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:09:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21599] Global Error Handler does not take effect when a source Kamelet fails</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21599</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I found a faulty behavior when configuring a global error handler and the failure is caused by the execution of a Kamelet.&lt;/p&gt;

&lt;p&gt;The following route works correctly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- route:
    errorHandler:
      deadLetterChannel:
        deadLetterUri: kamelet:log-sink/errorHandler
    from:
      uri: timer:tick
      steps:
        - setBody:
            constant: &lt;span class=&quot;code-quote&quot;&gt;&quot;fail!&quot;&lt;/span&gt;
        - setBody:
            simple: &lt;span class=&quot;code-quote&quot;&gt;&quot;${mandatoryBodyAs(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;)}&quot;&lt;/span&gt;
        - log: &lt;span class=&quot;code-quote&quot;&gt;&quot;${body}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It intercept the failing execution and forward the failure to the DLC. However, if the producer URI contains a failing Kamelet, then, the global error handler is not working. Wrapping the same failing logic in a local Kamelet like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
apiVersion: camel.apache.org/v1
kind: Kamelet
metadata:
  name: my-err-source
  labels:
    camel.apache.org/kamelet.type: &lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;
spec:
  definition:
    title: &lt;span class=&quot;code-quote&quot;&gt;&quot;Timer Example&quot;&lt;/span&gt;
    description: &lt;span class=&quot;code-quote&quot;&gt;&quot;Produces periodic events with a custom payload&quot;&lt;/span&gt;
    required:
      - message
    properties:
      period:
        title: Period
        description: The time interval between two events
        type: integer
        &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;: 1000
      message:
        title: Message
        description: The message to generate
        type: string
  types:
    out:
      mediaType: text/plain
  template:
    from:
      uri: timer:tick
      parameters:
        period: &lt;span class=&quot;code-quote&quot;&gt;&quot;{{period}}&quot;&lt;/span&gt;
      steps:
        - setBody:
            constant: &lt;span class=&quot;code-quote&quot;&gt;&quot;{{message}}&quot;&lt;/span&gt;
        - setBody:
            simple: &lt;span class=&quot;code-quote&quot;&gt;&quot;${mandatoryBodyAs(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;)}&quot;&lt;/span&gt;
        - setHeader:
            name: &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;
            constant: &lt;span class=&quot;code-quote&quot;&gt;&quot;text/plain&quot;&lt;/span&gt;
        - to: &lt;span class=&quot;code-quote&quot;&gt;&quot;kamelet:sink&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And executing a new route as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- route:
    errorHandler:
      deadLetterChannel:
        deadLetterUri: kamelet:log-sink/errorHandler
    from:
      uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;kamelet:my-err-source/source&quot;&lt;/span&gt;
      parameters:
        message: &lt;span class=&quot;code-quote&quot;&gt;&quot;fail!&quot;&lt;/span&gt;
      steps:
        - log: &lt;span class=&quot;code-quote&quot;&gt;&quot;${body}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will act as no error handler is set at all, logging a Warn:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ camel run * 
2025-01-07 15:36:45.452  INFO 611589 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 4.9.0 is starting
...
2025-01-07 15:36:47.543  WARN 611589 --- [ - timer:&lt;span class=&quot;code-comment&quot;&gt;//tick] ache.camel.component.timer.TimerConsumer : Error processing exchange. Exchange[FE1CC7B02A4822F-0000000000000000]. Caused by: [org.apache.camel.CamelExecutionException - Exception occurred during execution on the exchange: Exchange[FE1CC7B02A4822F-0000000000000000]]
&lt;/span&gt;org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange[FE1CC7B02A4822F-0000000000000000]
	at org.apache.camel.CamelExecutionException.wrapCamelExecutionException(CamelExecutionException.java:45) ~[camel-api-4.9.0.jar:4.9.0]
	at org.apache.camel.language.simple.SimpleExpressionBuilder$31.evaluate(SimpleExpressionBuilder.java:838) ~[camel-core-languages-4.9.0.jar:4.9.0]
	at org.apache.camel.support.ExpressionAdapter.evaluate(ExpressionAdapter.java:45) ~[camel-support-4.9.0.jar:4.9.0]
	at org.apache.camel.processor.SetBodyProcessor.process(SetBodyProcessor.java:45) ~[camel-core-processor-4.9.0.jar:4.9.0]
	at org.apache.camel.processor.errorhandler.NoErrorHandler.process(NoErrorHandler.java:46) ~[camel-core-processor-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.CamelInternalProcessor.processNonTransacted(CamelInternalProcessor.java:347) ~[camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:323) ~[camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.processor.Pipeline$PipelineTask.run(Pipeline.java:102) ~[camel-core-processor-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.doRun(DefaultReactiveExecutor.java:199) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.executeReactiveWork(DefaultReactiveExecutor.java:189) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.tryExecuteReactiveWork(DefaultReactiveExecutor.java:166) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:148) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:163) [camel-core-processor-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.CamelInternalProcessor.processNonTransacted(CamelInternalProcessor.java:347) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:323) [camel-base-engine-4.9.0.jar:4.9.0]
	at org.apache.camel.component.timer.TimerConsumer.sendTimerExchange(TimerConsumer.java:293) [camel-timer-4.9.0.jar:4.9.0]
	at org.apache.camel.component.timer.TimerConsumer$1.doRun(TimerConsumer.java:164) [camel-timer-4.9.0.jar:4.9.0]
	at org.apache.camel.component.timer.TimerConsumer$1.run(TimerConsumer.java:136) [camel-timer-4.9.0.jar:4.9.0]
	at java.base/java.util.TimerThread.mainLoop(Timer.java:566) [?:?]
	at java.base/java.util.TimerThread.run(Timer.java:516) [?:?]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13604083">CAMEL-21599</key>
            <summary>Global Error Handler does not take effect when a source Kamelet fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="squakez">Pasquale Congiusti</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2025 14:42:43 +0000</created>
                <updated>Wed, 29 Jan 2025 10:03:28 +0000</updated>
                            <resolved>Mon, 27 Jan 2025 10:58:49 +0000</resolved>
                                    <version>4.9.0</version>
                                    <fixVersion>4.10.0</fixVersion>
                                    <component>camel-kamelet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17910646" author="squakez" created="Tue, 7 Jan 2025 14:44:32 +0000"  >&lt;p&gt;I may contribute to the fix, but I&apos;d need some direction to understand where and when the global error handler is set in order to verify why it&apos;s not taking effect.&lt;/p&gt;</comment>
                            <comment id="17911366" author="davsclaus" created="Thu, 9 Jan 2025 08:23:13 +0000"  >&lt;p&gt;That is expected, the kamelet are used as a source (from) and it acts just like any regular component used in a from situation.&lt;/p&gt;

&lt;p&gt;See the bridgeErrorHandler option that a consumer can enable to let such &quot;internal consumer errors&quot; be wrapped into a Camel message and routed, to let it be handled by routing error handler.&lt;/p&gt;</comment>
                            <comment id="17911566" author="squakez" created="Thu, 9 Jan 2025 15:45:40 +0000"  >&lt;p&gt;Thanks, I managed to make it work by setting the following parameter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;kamelet:my-err-source/source&quot;&lt;/span&gt;
      parameters:
        message: &lt;span class=&quot;code-quote&quot;&gt;&quot;fail!&quot;&lt;/span&gt;
        noErrorHandler: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However it feels a bit counterintuitive.&lt;/p&gt;</comment>
                            <comment id="17916666" author="davsclaus" created="Fri, 24 Jan 2025 10:18:03 +0000"  >&lt;p&gt;Yeah its a bit what perspective we have&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;source: kamelet is a black box (like a component) and if a component cannot successfully consume a message then it fails internally. You can bridge that to Camel via bridgeErrorHandler=true.&lt;/li&gt;
	&lt;li&gt;sink: kamelet is a black box, however if failing to process then the error is propagated back to the route, just as it would do when you call a regular component&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So its the source kamelet where you have that noErrorHandler: true|false option.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17916672" author="squakez" created="Fri, 24 Jan 2025 10:37:59 +0000"  >&lt;p&gt;Thanks for looking at it. I wonder if then the default should be &quot;noErrorHandler:true&quot; instead of false. From a ux perspective it is what I&apos;d expect. If, however, there is some logical reason to be like this, I guess we can simply add a short note into the error handler documentation to explain that. Just let me know and I&apos;ll provide to complete this request by adding the required documentation.&lt;/p&gt;</comment>
                            <comment id="17916712" author="davsclaus" created="Fri, 24 Jan 2025 12:37:30 +0000"  >&lt;p&gt;I am working on an improvement ...&lt;/p&gt;</comment>
                            <comment id="17916777" author="davsclaus" created="Fri, 24 Jan 2025 16:04:24 +0000"  >&lt;p&gt;Its a bit more tricky due to some chicken vs egg situation - This needs some more work for the next coming days.&lt;/p&gt;</comment>
                            <comment id="17921294" author="davsclaus" created="Mon, 27 Jan 2025 08:33:26 +0000"  >&lt;p&gt;okay have a fix in the works&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13606340">CAMEL-21660</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13606578">CAMEL-21675</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13606582">CAMEL-21676</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tgmg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>