<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:49:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16921] KafkaSpanDecorator sometimes sets the wrong message_bus.destination tag value</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16921</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Consider a route like:&lt;/p&gt;

&lt;p&gt;from(&quot;kafka:foo&quot;)&lt;br/&gt;
.to(&quot;kafka:bar&quot;)&lt;/p&gt;

&lt;p&gt;When you view the trace span for the producer, the message_bus.destination tag contains &quot;foo&quot;. I&apos;d expect it to be &quot;bar&quot; (as that&apos;s what we are producing to).&lt;/p&gt;

&lt;p&gt;The logic to determine the destination can probably be improved a bit:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-tracing/src/main/java/org/apache/camel/tracing/decorators/KafkaSpanDecorator.java#L52-L59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/components/camel-tracing/src/main/java/org/apache/camel/tracing/decorators/KafkaSpanDecorator.java#L52-L59&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It looks up an exchange header &quot;kafka.TOPIC&quot;. The problem in this particular scenario is that there will be a value present in the exchange passed from the &quot;kafka:foo&quot; consumer. The Kafka header filter will have not yet stripped it when the tracing EventNotifier bits run, so an incorrect value is used for the span name &amp;amp; tag.&lt;/p&gt;

&lt;p&gt;Maybe it could always look up the topic name from the endpoint URI options instead of relying on the header.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13399244">CAMEL-16921</key>
            <summary>KafkaSpanDecorator sometimes sets the wrong message_bus.destination tag value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jamesnetherton">James Netherton</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Sep 2021 12:34:18 +0000</created>
                <updated>Fri, 3 Sep 2021 16:20:04 +0000</updated>
                            <resolved>Fri, 3 Sep 2021 16:20:04 +0000</resolved>
                                                    <fixVersion>3.11.2</fixVersion>
                    <fixVersion>3.12.0</fixVersion>
                                    <component>camel-tracing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17409501" author="davsclaus" created="Fri, 3 Sep 2021 13:20:53 +0000"  >&lt;p&gt;Ah its taking the wrong header when its a producer. The consumer sets that header. But the producer does not. The producer only uses KafkaConstants.OVERRIDE_TOPIC for dynamic topics, or if that header is not present then it uses the endpoint uri.&lt;/p&gt;

&lt;p&gt;So the span decorated need to act accordingly&lt;/p&gt;</comment>
                            <comment id="17409590" author="davsclaus" created="Fri, 3 Sep 2021 16:20:04 +0000"  >&lt;p&gt;The logic was also wrong as it was based on an old syntax with topic being a query parameter&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ulbs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>