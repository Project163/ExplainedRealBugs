<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:59:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18865] camel-main - Setters not invoked on bean that implements Map</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18865</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We are having trouble configuring camel-jms with IBM-MQ as runtime implementation, using camel-main.&lt;/p&gt;

&lt;p&gt;Doing so requires the declaration of a connection factory, which, in our case, is &lt;a href=&quot;https://www.ibm.com/docs/api/v1/content/SSFKSJ_9.2.0/com.ibm.mq.javadoc.doc/WMQJMSClasses/com/ibm/mq/jms/MQConnectionFactory.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;com.ibm.mq.jms.MQConnectionFactory&lt;/a&gt;. Unfortunately, this class implements both &lt;tt&gt;javax.jms.ConnectionFactory&lt;/tt&gt; and &lt;tt&gt;java.util.Map&amp;lt;java.lang.String,java.lang.Object&amp;gt;&lt;/tt&gt;. Also, the setters of that class have side effects, that are non-trivial to reproduce.&lt;/p&gt;

&lt;p&gt;What was really troubling us was that, contrary to intuition, defining a bean like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
camel.beans.mqConnectionFactory = #&lt;span class=&quot;code-keyword&quot;&gt;class:&lt;/span&gt;com.ibm.mq.jms.MQConnectionFactory
camel.beans.mqConnectionFactory.hostName = mqhost
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;does not actually invoke the setHostName method on the factory. Instead, value &quot;mqhost&quot; is put under key &quot;hostName&quot; into the map.&lt;/p&gt;

&lt;p&gt;Reproduction can be achieved with a quick custom class, like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.camel.main;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyFooFactory &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hostName;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getHostName() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hostName;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setHostName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hostName) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hostName = hostName;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and a unit test, which checks for the hostName:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBindBeansDottedHybridMap() {
        Main main = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Main();
        main.configure().addRoutesBuilder(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyRouteBuilder());

        &lt;span class=&quot;code-comment&quot;&gt;// defining a factory bean
&lt;/span&gt;        main.addProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;camel.beans.myfactory&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;#&lt;span class=&quot;code-keyword&quot;&gt;class:&lt;/span&gt;org.apache.camel.main.MyFooFactory&quot;&lt;/span&gt;);
        main.addProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;camel.beans.myfactory.hostName&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;);
        main.start();

        CamelContext camelContext = main.getCamelContext();
        assertNotNull(camelContext);

        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; bean = camelContext.getRegistry().lookupByName(&lt;span class=&quot;code-quote&quot;&gt;&quot;myfactory&quot;&lt;/span&gt;);
        assertNotNull(bean);
        assertInstanceOf(MyFooFactory.class, bean);

        MyFooFactory factory = (MyFooFactory) bean;
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, factory.getHostName());

        main.stop();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For a custom bean that is under our own control, I would consider implementing java.util.Map and having additional custom getters and setters with side-effects to be invalid, but the IBM-MQ JMS client is out of our control - and required for our use case.&lt;/p&gt;

&lt;p&gt;If the dotted annotation is used, it may be preferable to check for a suitable setter first, and only if that is missing, to check if the bean implements java.util.Map.&lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk11, camel-main, camel-jms, IBM-MQ 9.2 (&lt;a href=&quot;https://mvnrepository.com/artifact/com.ibm.mq/com.ibm.mq.allclient&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mvnrepository.com/artifact/com.ibm.mq/com.ibm.mq.allclient&lt;/a&gt;)&lt;/p&gt;</environment>
        <key id="13517020">CAMEL-18865</key>
            <summary>camel-main - Setters not invoked on bean that implements Map</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="chrissh">Christian Schubert-Huff</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2023 09:42:13 +0000</created>
                <updated>Mon, 30 Jan 2023 08:59:45 +0000</updated>
                            <resolved>Fri, 6 Jan 2023 11:54:07 +0000</resolved>
                                    <version>3.20.0</version>
                                    <fixVersion>3.20.2</fixVersion>
                    <fixVersion>3.21.0</fixVersion>
                    <fixVersion>4.0-M1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>camel-main</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17655358" author="davsclaus" created="Fri, 6 Jan 2023 09:46:48 +0000"  >&lt;p&gt;Sorry but Map/List will be used as a collection and not something else. &lt;br/&gt;
We will not add workarounds for all really weird corner cases.&lt;/p&gt;</comment>
                            <comment id="17655370" author="JIRAUSER298249" created="Fri, 6 Jan 2023 10:08:19 +0000"  >&lt;p&gt;I understand that. Yet, it took us hours of debugging and deep-diving into the implementations of camel-main and the ibm-mq client to figure out what was happening. Documenting it here may save other users some time in the future.&lt;/p&gt;</comment>
                            <comment id="17655371" author="davsclaus" created="Fri, 6 Jan 2023 10:27:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://camel.apache.org/community/contributing/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/community/contributing/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17655376" author="JIRAUSER298249" created="Fri, 6 Jan 2023 10:39:40 +0000"  >&lt;p&gt;As additional information, of course we are not implemtenting something new, but migrating from an XML blueprint that ran in camel2/karaf, where that same connection factory was declared like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;mqConnectionFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.ibm.mq.jms.MQConnectionFactory&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;hostName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${mqHostname}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- more properties, here --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which suggested that we could use the hostName property in camel-main as well. I cannot tell at the moment whether or not the version of MQConnectionFactory that was used to do so, did implement Map as well.&lt;/p&gt;</comment>
                            <comment id="17655382" author="davsclaus" created="Fri, 6 Jan 2023 10:56:31 +0000"  >&lt;p&gt;The old &amp;lt;bean&amp;gt; in blueprint is all reflection based and not optimized. camel-main is that and avoids reflection when possible.&lt;/p&gt;

&lt;p&gt;However looking at this again I can see the point about &lt;span class=&quot;error&quot;&gt;&amp;#91;xxx&amp;#93;&lt;/span&gt; vs .xxx that can make it possible to favour map first/last - because then the end user have declared the style of choice.&lt;br/&gt;
However its really bad that IBM make their CF extend a Map class - that is just crazy&lt;/p&gt;
</comment>
                            <comment id="17655415" author="davsclaus" created="Fri, 6 Jan 2023 11:54:07 +0000"  >&lt;p&gt;Okay so DOT vs [] style is now taking into account.&lt;/p&gt;</comment>
                            <comment id="17656174" author="JIRAUSER298249" created="Mon, 9 Jan 2023 16:06:04 +0000"  >&lt;p&gt;Thanks for reconsidering the issue and the quick fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1emfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>