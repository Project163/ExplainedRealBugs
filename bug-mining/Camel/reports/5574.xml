<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:45:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16078] IdempotentConsumer + MemoryIdempotentRepository allows duplicates</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16078</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In certain scenarios, it seems that IdempotentConsumer is allowing duplicate message to pass. In the test case below, with a cache size of 50, duplicate message within a few messages of each other are allowed to pass. &lt;/p&gt;

&lt;p&gt;Test case: &lt;a href=&quot;https://gist.github.com/jeremyross/d76f658767b4f476f93a12f9067ed515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/jeremyross/d76f658767b4f476f93a12f9067ed515&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13354467">CAMEL-16078</key>
            <summary>IdempotentConsumer + MemoryIdempotentRepository allows duplicates</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jeremyross">Jeremy Ross</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jan 2021 15:18:48 +0000</created>
                <updated>Wed, 27 Jan 2021 14:01:49 +0000</updated>
                            <resolved>Wed, 27 Jan 2021 14:01:48 +0000</resolved>
                                    <version>3.7.1</version>
                                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17271677" author="jeremyross" created="Mon, 25 Jan 2021 21:06:02 +0000"  >&lt;p&gt;I believe Caffeine&apos;s Window TinyLfu algorithm is the culprit here. If I exclude camel-caffeine-lrucache, the SimpleLRUCache is used, which seems to have a strict policy of eldest entry is removed. Considering the importance of idempotency and &quot;once and only once&quot; semantics, this is a far more preferable algorithm, even if it&apos;s not designed for massive scale. &lt;/p&gt;

&lt;p&gt;Considering that Caffeine&apos;s LRU cache can drop entries almost as soon as they&apos;re added, I don&apos;t see this as an appropriate backing for MemoryIdempotencyRepository, unless perhaps if the use case is massive scale, and it&apos;s ok if some duplicate messages get through as long as performance is good. Overall, to me, this behavior violates the &lt;a href=&quot;https://en.wikipedia.org/wiki/Principle_of_least_astonishment&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Principle of Least Surprise&lt;/a&gt;. We might consider, if nothing else, documenting this behavior. Long term it may be better to find a backing that can truly support idempotency. Hoping others can weigh in as I haven&apos;t used this part of Camel much.&lt;/p&gt;

&lt;p&gt;I&apos;m also curious if excluding camel-caffeine-lrucache has any other side effects for other parts of camel.&lt;/p&gt;
</comment>
                            <comment id="17272869" author="davsclaus" created="Wed, 27 Jan 2021 13:52:08 +0000"  >&lt;p&gt;Yeah Caffeine is not ideal for this use-case where a strict LRU order is required.&lt;/p&gt;

&lt;p&gt;It was used for internal caches to keep the most &quot;active&quot; elements, and there its okay that its not 100% lru ordered&lt;/p&gt;

&lt;p&gt;In the past we used a LRU implementation that then was requested to switch to caffeine by its author&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8602&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8602&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And this was also before we had our own implementation now with the DefaultLRUCache that uses JDK collections.&lt;br/&gt;
So I think we can deprecate caffeine and just use our default. &lt;/p&gt;

&lt;p&gt;The internal caches are really only used during startup/warmup and has less &quot;contention today&quot;. In the past it was the endpoint registry that benefitted from concurrency to lookup endpoints. But we now keep known/static endpoints in a fixed registry so its not dynamic and dont need the LRU anymore.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13354950">CAMEL-16093</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mysg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>