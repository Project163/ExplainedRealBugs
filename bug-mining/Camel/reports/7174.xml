<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:11:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22147] StackOverflowError when Running a Loop with Splitter &amp; Transaction</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22147</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m encountering a StackOverflowError when running a Camel test that worked perfectly fine with &lt;b&gt;the older (unmaintained &#8211; 2.x) Camel version&lt;/b&gt;. However, after migrating to Camel 3.14 and Camel 4.8, the same test fails:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In &lt;b&gt;(&lt;/b&gt;&lt;b&gt;unmaintained&lt;/b&gt;&lt;b&gt;)&lt;/b&gt; &lt;b&gt;Camel 3.14.7&lt;/b&gt; the process hangs for a long time with the following error message and finally terminates with a &lt;b&gt;StackOverflowError&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;java.lang.instrument ASSERTION FAILED ***: &quot;!errorOutstanding&quot; with message transform method call failed at s\src\java.instrument\share\native\libinstrument\JPLISAgent.c line: 876&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;In &lt;b&gt;Camel 4.8.x&lt;/b&gt;, the test is terminated more quickly, but with the same error.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A simplified unit test can be found in the appendix.&lt;/p&gt;

&lt;p&gt;The route uses a loop of 2000 iterations. Each iteration calls a subroute which is marked as transacted and contains a split step using XPath.&lt;/p&gt;

&lt;p&gt;The issue seems to be related to transaction boundaries and route recursion or resource handling in Camel 3+. There is no explicit recursion in the route, but internally Camel may be building a deep call stack due to how it handles loop combined with transacted and splitter. The StackOverflowError may indicate that each loop iteration adds to the call stack without releasing previous frames.&lt;/p&gt;

&lt;p&gt;Could you please confirm if this is a known issue?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13620152">CAMEL-22147</key>
            <summary>StackOverflowError when Running a Loop with Splitter &amp; Transaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="soesmaeili">Soheila Esmaeili</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jun 2025 12:22:09 +0000</created>
                <updated>Fri, 4 Jul 2025 08:05:11 +0000</updated>
                            <resolved>Wed, 2 Jul 2025 11:25:49 +0000</resolved>
                                    <version>4.8.0</version>
                                    <fixVersion>4.8.9</fixVersion>
                    <fixVersion>4.10.7</fixVersion>
                    <fixVersion>4.13.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17956348" author="davsclaus" created="Thu, 5 Jun 2025 13:23:12 +0000"  >&lt;p&gt;Try with 4.12.0 release first&lt;/p&gt;</comment>
                            <comment id="17956592" author="JIRAUSER308495" created="Fri, 6 Jun 2025 13:09:04 +0000"  >&lt;p&gt;same behavior with 4.12.0&lt;/p&gt;</comment>
                            <comment id="17978611" author="JIRAUSER308495" created="Mon, 16 Jun 2025 07:46:15 +0000"  >&lt;p&gt;kindly reminder - is there any progress or update on this issue?&lt;/p&gt;</comment>
                            <comment id="17986124" author="JIRAUSER308495" created="Wed, 25 Jun 2025 12:00:27 +0000"  >&lt;p&gt;Update:&lt;/p&gt;

&lt;p&gt;added screenshot of stack trace&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13077216/13077216_image-2025-06-25-13-59-33-912.png&quot; height=&quot;852&quot; width=&quot;1047&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17987186" author="JIRAUSER308495" created="Tue, 1 Jul 2025 10:57:22 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;We&#8217;ve found an older ticket with a stack trace that looks very similar to ours.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16938&quot; title=&quot;StackOverflowError in RedeliveryErrorHandler when using transacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16938&quot;&gt;&lt;del&gt;CAMEL-16938&lt;/del&gt;&lt;/a&gt; &lt;b&gt;StackOverflowError in RedeliveryErrorHandler when using transacted.&lt;/b&gt;&#160;In that ticket, we also saw a your commit message (&lt;b&gt;961ad0e56e9331e71c386415ec67676e586ea629&lt;/b&gt;) that might be related.&lt;/p&gt;

&lt;p&gt;During our investigation, we found in the code (&lt;b&gt;MulticastProcessor.java:395&lt;/b&gt;) that &lt;b&gt;reactiveExecutor.scheduleSync(runnable)&lt;/b&gt; is used instead of a &lt;b&gt;reactiveExecutor.scheduleQueue(runnable)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If this is also changed to use a &lt;b&gt;scheduleQueue&lt;/b&gt;, it appears to solve the StackOverFlowError.&lt;/p&gt;

&lt;p&gt;At this point, we&#8217;re unsure if this was missed in your original commit or if it was left as sync intentionally due to its impact on other parts of the code.&lt;/p&gt;

&lt;p&gt;Could you please confirm?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;P.S: full stack trace added&lt;/p&gt;</comment>
                            <comment id="17987854" author="davsclaus" created="Wed, 2 Jul 2025 09:36:25 +0000"  >&lt;p&gt;Thanks for reporting and providing the test case, and analysis what may be a related problem&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13622530">CAMEL-22216</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13076847" name="JdbcLoopTransactedSplitterTest.java" size="4814" author="soesmaeili" created="Thu, 5 Jun 2025 12:22:37 +0000"/>
                            <attachment id="13077275" name="full_stacktrace.txt" size="1058657" author="soesmaeili" created="Tue, 1 Jul 2025 11:58:13 +0000"/>
                            <attachment id="13077216" name="image-2025-06-25-13-59-33-912.png" size="421156" author="soesmaeili" created="Wed, 25 Jun 2025 11:59:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1w794:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>