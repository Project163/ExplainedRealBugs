<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:37:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-14136] ConcurrentModificationException when using recipientList with Strings</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-14136</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I already asked this on the mailing list:&lt;/p&gt;

&lt;p&gt;I encountered a ConcurrentModificationException in Camel: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.ConcurrentModificationException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.util.HashMap.computeIfAbsent(HashMap.java:1134) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.util.Scanner.cachePattern(Scanner.java:305) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.util.Scanner.&amp;lt;init&amp;gt;(Scanner.java:82) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.support.ObjectHelper.lambda$createIterable$3(ObjectHelper.java:593) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.support.ObjectHelper$$Lambda$1118.0000000000000000.iterator(Unknown Source) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.support.ObjectHelper.createIterator(ObjectHelper.java:435) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.support.ObjectHelper.createIterator(ObjectHelper.java:412) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.RecipientList.sendToRecipientList(RecipientList.java:137) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.RecipientList.process(RecipientList.java:125) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.Pipeline.doProcess(Pipeline.java:103) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.Pipeline.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$2(Pipeline.java:104) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.Pipeline$$Lambda$1096.0000000000000000.run(Unknown Source) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor$3.run(DefaultReactiveExecutor.java:116) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:185) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor.schedule(DefaultReactiveExecutor.java:67) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.spi.ReactiveExecutor.schedule(ReactiveExecutor.java:32) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.MulticastProcessor.lambda$schedule$1(MulticastProcessor.java:249) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at org.apache.camel.processor.MulticastProcessor$$Lambda$1099.0000000000000000.run(Unknown Source) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) 
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:831) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My simplified route is as follows. The input is a list of objects, these are split, and based on the object the recipientList is different. When there are two recipients in the String provided by &#8222;getRecipients&quot;, the named exception is thrown. Sadly not consistently. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:input&quot;&lt;/span&gt;) 
&#160; &#160; &#160; .split(method(TestClass.class, &lt;span class=&quot;code-quote&quot;&gt;&quot;split&quot;&lt;/span&gt;), AggregationStrategies.groupedBody()) 
&#160; &#160; &#160; &#160; .parallelProcessing() 
&#160; &#160; &#160; &#160; .recipientList(method(TestClass.class, &lt;span class=&quot;code-quote&quot;&gt;&quot;getRecipients&quot;&lt;/span&gt;)) 
&#160; &#160; &#160; &#160; &#160; .parallelProcessing() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It looks like the Scanner uses an internal map of compiled Patterns, but this map (LinkedHashMap) is not threadsafe. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Response from Claus Ibsen:&lt;/p&gt;

&lt;p&gt;Yeah its a bug in Camel 3, you are surely welcome to log a JIRA ticket &lt;br/&gt;
and work on a patch. &lt;br/&gt;
I can see we (gnodet) introduced a custom fast scanner implementation, &lt;br/&gt;
but its not thread safe. &lt;/p&gt;

&lt;p&gt;We could add synchronization block to that compute if absent. And for &lt;br/&gt;
those constant patterns WHITE_SPACE, FIND_ANY etc we can make them &lt;br/&gt;
static &lt;br/&gt;
as java.util.Pattern is thread-safe and create them once in a class &lt;br/&gt;
static block.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I did that and will post a PR-Request to the github project shortly, when the ticket number is known.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 11, Camel 3.0.0RC3&lt;/p&gt;</environment>
        <key id="13266132">CAMEL-14136</key>
            <summary>ConcurrentModificationException when using recipientList with Strings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Zohhak">Christian Mohr</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Nov 2019 14:55:52 +0000</created>
                <updated>Wed, 6 Nov 2019 07:24:10 +0000</updated>
                            <resolved>Wed, 6 Nov 2019 07:24:10 +0000</resolved>
                                    <version>3.0.0.RC3</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16968133" author="davsclaus" created="Wed, 6 Nov 2019 07:24:10 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z088lc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>