<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11482] SSLContextParameters settings are not properly copied to SslContextFactory</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11482</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Jetty 9.3+ excludes unsecure ciphers which end on either MD5, SHA or SHA1 by default now. This will however remove all ciphers that are used by either TLSv1 or TLSv1.1 and thus no ciphers remain in order to agree on a cipher for TLSv1 or TLSv1.1 connection attempts. (Further reading: &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/860&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/860&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;The Jetty 9 SSL configuration documentation (&lt;a href=&quot;https://www.eclipse.org/jetty/documentation/9.3.x/configuring-ssl.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.eclipse.org/jetty/documentation/9.3.x/configuring-ssl.html&lt;/a&gt;) states that this exclusion cipher suites can be customized by providing an own exclusion list. On specifying SSLContextParameters like below however will not correctly propagate this exclution cipher suites to the SslContextFactory of Jetty and thus use the default setting which prevents TLSv1 and TLSv1.1 connections.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;SSLContextParameters Spring Config&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Bean(name = &lt;span class=&quot;code-quote&quot;&gt;&quot;sslContextParameters&quot;&lt;/span&gt;)
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SSLContextParameters sslContextParameters() {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyStore = env.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;ssl.keyStore.resource&quot;&lt;/span&gt;);
    URL keyStoreUrl = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getResource(keyStore);

    &lt;span class=&quot;code-comment&quot;&gt;// http://camel.apache.org/jetty.html
&lt;/span&gt;    KeyStoreParameters ksp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyStoreParameters();
    ksp.setResource(keyStoreUrl.getPath());
    ksp.setPassword(env.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;ssl.keyStore.password&quot;&lt;/span&gt;));

    KeyManagersParameters kmp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyManagersParameters();
    kmp.setKeyStore(ksp);
    kmp.setKeyPassword(env.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;ssl.key.password&quot;&lt;/span&gt;));

    SSLContextParameters scp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SSLContextParameters();
    scp.setKeyManagers(kmp);

    &lt;span class=&quot;code-comment&quot;&gt;// Jetty 9.3+ support only TLSv1.2 by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; hence clients not supporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; protocol will fail
&lt;/span&gt;    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; supportedSslProtocols = Arrays.asList(&lt;span class=&quot;code-quote&quot;&gt;&quot;TLSv1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TLSv1.1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TLSv1.2&quot;&lt;/span&gt;);
    SecureSocketProtocolsParameters protocolsParameters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SecureSocketProtocolsParameters();
    protocolsParameters.setSecureSocketProtocol(supportedSslProtocols);
    scp.setSecureSocketProtocols(protocolsParameters);

    &lt;span class=&quot;code-comment&quot;&gt;// TLS 1.0 / 1.1 have been disabled by jetty 9.3
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a first attempt to re-enable them
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// see
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// - https://www.eclipse.org/jetty/documentation/9.3.x/configuring-ssl.html
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// - https://github.com/eclipse/jetty.project/issues/860
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// - http://camel.apache.org/camel-configuration-utilities.html
&lt;/span&gt;    FilterParameters cipherParameters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FilterParameters();
    cipherParameters.getInclude().add(&lt;span class=&quot;code-quote&quot;&gt;&quot;.*&quot;&lt;/span&gt;);
    cipherParameters.getExclude().add(&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*_(MD5|SHA1)$&quot;&lt;/span&gt;);
    scp.setCipherSuitesFilter(cipherParameters);

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; scp;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A workaround is to use a custom JettyHttpComponent9 implementation that sets the excludedCipherSuites manually like depicted below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Workaround&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  /**
   * A custom jetty http component which explicitly sets the excludedCipherSuites during creation of
   * the jetty connector.
   *
   * Why? It seems camel does not push included/excluded cipherSuites from {@link
   * SSLContextParameters} to the {@link SslContextFactory} nor does push explicitly listed cipher
   * suites (i.e. like &amp;lt;em&amp;gt;TLS_RSA_WITH_AES_256_CBC_SHA&amp;lt;/em&amp;gt;) to the Jetty SSL context factory.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HackedJettyHttpComponent &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JettyHttpComponent9 {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; AbstractConnector createConnectorJettyInternal(Server server,
                                                             JettyHttpEndpoint endpoint,
                                                             SslContextFactory sslcf) {

      sslcf.setExcludeCipherSuites(&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*_(MD5|SHA1)$&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createConnectorJettyInternal(server, endpoint, sslcf);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Max OS X, Java 8 Update 131&lt;br/&gt;
Ubuntu 14.04 LTS, Java 8 Update 111&lt;br/&gt;
Camel 2.19.0&lt;br/&gt;
Jetty9 9.4.5v20170502 and 9.3.14.v20161028&lt;/p&gt;</environment>
        <key id="13083446">CAMEL-11482</key>
            <summary>SSLContextParameters settings are not properly copied to SslContextFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Rovo">Roman Vottner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jun 2017 12:10:23 +0000</created>
                <updated>Tue, 26 Sep 2017 12:54:47 +0000</updated>
                            <resolved>Tue, 26 Sep 2017 12:54:47 +0000</resolved>
                                    <version>2.19.0</version>
                    <version>2.19.1</version>
                                    <fixVersion>2.19.4</fixVersion>
                    <fixVersion>2.20.0</fixVersion>
                                    <component>camel-jetty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16071071" author="davsclaus" created="Sat, 1 Jul 2017 07:24:50 +0000"  >&lt;p&gt;Are you working on a patch / github PR?&lt;/p&gt;</comment>
                            <comment id="16072151" author="rovo" created="Mon, 3 Jul 2017 09:12:30 +0000"  >&lt;p&gt;Have to see if I am able to find some time, but our upcoming release has higher priorities.&lt;/p&gt;</comment>
                            <comment id="16073965" author="rovo" created="Tue, 4 Jul 2017 17:49:21 +0000"  >&lt;p&gt;Just a quick headsup on this issue. I&apos;ve started to work on a fix (&lt;a href=&quot;https://github.com/RovoMe/camel/commit/952175559110babf0ee7224f8045c1270dad5aa7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/RovoMe/camel/commit/952175559110babf0ee7224f8045c1270dad5aa7&lt;/a&gt;) though I&apos;m not sure if the code has to support Java 7 (or even 6). Also, there are probably a couple other settings that aren&apos;t copied to the SslContextFactory which I have not yet included either. What should be the strategy on these? Continue work on that issue and copy over all settings or leave them to those who need them and ask them to provide a fix/PR?&lt;/p&gt;

&lt;p&gt;Will also check how to setup unit-tests therefore, though as the method is private I guess I have to test it within createConnector(Server, JettyHttpEndpoint) and/or createHttpClient(JettyHttpEndpoint, Integer, SSLContextParameters) which use the updated method.&lt;/p&gt;</comment>
                            <comment id="16074335" author="onders" created="Wed, 5 Jul 2017 07:21:45 +0000"  >&lt;p&gt;2.16.X is EOL. 2.17.X is EOL.&lt;/p&gt;

&lt;p&gt;I guess Java 6 and 7 support is not needed. &lt;/p&gt;

&lt;p&gt;for the setting to copy, IMHO i would suppose the nicer way would be to have full default copying all configurations to SSLContextFactory and also have configurable base strategy(which may be pluggable via SPI) and where you can choose which settings to copy and put to SSLContextFactory.&lt;/p&gt;</comment>
                            <comment id="16100002" author="davsclaus" created="Tue, 25 Jul 2017 13:06:35 +0000"  >&lt;p&gt;How is it going?&lt;/p&gt;</comment>
                            <comment id="16158563" author="davsclaus" created="Fri, 8 Sep 2017 12:43:14 +0000"  >&lt;p&gt;Roman, are you working on this?&lt;/p&gt;</comment>
                            <comment id="16180610" author="davsclaus" created="Tue, 26 Sep 2017 11:07:17 +0000"  >&lt;p&gt;I am working on this, and we now set those ciphers and protocols filters from the ssl context configuration. &lt;/p&gt;

&lt;p&gt;Camel will log at INFO level the configuration, such as the default ones as shown&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connector on por:t 23003 is using excludeChiperSuites: [[^.*_(MD5|SHA|SHA1)$]] excludeProtocols: [[SSL, SSLv2, SSLv2Hello, SSLv3]]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16180616" author="rovo" created="Tue, 26 Sep 2017 11:17:01 +0000"  >&lt;p&gt;Thanks for taking over as I&apos;m currently not having enough time lately. I&apos;ve some (WIP) tests for the changes I had in my branch if you are interested. They basically test that TLSv1 or TLSv1.1 connections work as they should via Java&apos;s HttpUrlConnection. The only thing that bugs me, is, that I am not able to retrieve the server certificate but I&apos;m not sure if this is related to self-signed certificates.&lt;/p&gt;</comment>
                            <comment id="16180624" author="davsclaus" created="Tue, 26 Sep 2017 11:32:39 +0000"  >&lt;p&gt;Yeah you are welcome to contribute your unit tests that would help surely.&lt;/p&gt;</comment>
                            <comment id="16180661" author="rovo" created="Tue, 26 Sep 2017 12:14:58 +0000"  >&lt;p&gt;Test for exclusion pattern. Both tests are green though you might notice a stacktrace on executing testHelloEndpoint as no server certificate is obtainable:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/RovoMe/camel/blob/fix/CAMEL-11482_SSLContextParameters_settings_are_not_properly_copied_to_SslContextFactory/components/camel-jetty9/src/test/java/org/apache/camel/component/jetty/HttpsRouteSslContextParametersInUriTest_TLSv1SupportWithExclusionPattern.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/RovoMe/camel/blob/fix/CAMEL-11482_SSLContextParameters_settings_are_not_properly_copied_to_SslContextFactory/components/camel-jetty9/src/test/java/org/apache/camel/component/jetty/HttpsRouteSslContextParametersInUriTest_TLSv1SupportWithExclusionPattern.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test for defining explicite ciphers to support. Though as it turns out Jettys exclusion patterns seem to kick in before and hence remove all of the TLSv1/1.1 ciphers:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/RovoMe/camel/blob/fix/CAMEL-11482_SSLContextParameters_settings_are_not_properly_copied_to_SslContextFactory/components/camel-jetty9/src/test/java/org/apache/camel/component/jetty/HttpsRouteSslContextParametersInUriTest_TLSv1SupportWithInclusionPattern.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/RovoMe/camel/blob/fix/CAMEL-11482_SSLContextParameters_settings_are_not_properly_copied_to_SslContextFactory/components/camel-jetty9/src/test/java/org/apache/camel/component/jetty/HttpsRouteSslContextParametersInUriTest_TLSv1SupportWithInclusionPattern.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;HTH&lt;/p&gt;</comment>
                            <comment id="16180705" author="davsclaus" created="Tue, 26 Sep 2017 12:54:47 +0000"  >&lt;p&gt;Thanks those SSL tests are extreme and they are hard to test as different platforms and JDKs and whatnot have different ciphers supported etc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gw5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>