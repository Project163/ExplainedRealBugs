<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:08:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8718] Connection leak with ftp consumer and invalid credentials</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8718</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In each iteration new socket connection is created, but never closed. This leads to growth of &lt;tt&gt;ESTABLISHED&lt;/tt&gt; connections to FTP server.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12825874">CAMEL-8718</key>
            <summary>Connection leak with ftp consumer and invalid credentials</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggrzybek">Grzegorz Grzybek</assignee>
                                    <reporter username="ggrzybek">Grzegorz Grzybek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Apr 2015 09:34:07 +0000</created>
                <updated>Fri, 8 May 2015 07:08:39 +0000</updated>
                            <resolved>Thu, 7 May 2015 18:14:40 +0000</resolved>
                                    <version>2.12.5</version>
                    <version>2.13.4</version>
                    <version>2.14.2</version>
                    <version>2.15.1</version>
                                    <fixVersion>2.14.3</fixVersion>
                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14519146" author="gzres" created="Wed, 29 Apr 2015 11:17:51 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/e129b88c223e53595113b54a3637e6fabb5a940f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;master branch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/7c51a070b9ef6d2d690eaa8f370b2bb1fbc8504f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;camel-2.15.x branch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/c18c4157d30fa81785c8e7d938006818da5af34b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;camel-2.14.x branch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14528600" author="kvileid@yahoo.com" created="Tue, 5 May 2015 15:07:21 +0000"  >&lt;p&gt;I am working in a project that has been hit by this problem with leaking sockets, and great to see that problem is attacked.&lt;br/&gt;
However I have some comments to the chosen solution.&lt;/p&gt;

&lt;p&gt;1. In FtpBadLoginConnectionLeakTest.java using maximumReconnectAttempts=3 (which is camel default), causes leaking sockets, and hence test to fail.&lt;/p&gt;

&lt;p&gt;2. In RemoteFileConsumer.java. Some FTP servers (at least one of ours), responds OK to getOperations().sendNoop(), even though user has not been authorized.&lt;br/&gt;
This again causes leaking sockets where;&lt;br/&gt;
            isConnected = getOperations().sendNoop();  // isConnected is true&lt;/p&gt;

&lt;p&gt;and loggedIn is always false (since credentials are wrong in this case), causing new connect, without disconnecting previous connection, for every poll.&lt;/p&gt;

&lt;p&gt;        if (!loggedIn || !isConnected) {&lt;br/&gt;
            loggedIn = getOperations().connect((RemoteFileConfiguration) endpoint.getConfiguration());&lt;/p&gt;

&lt;p&gt;3. Problem with leaking connections is also seen for Ftp producers, suggesting that solution could be done in common part for consumers and producers.&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;Possible solutions:&lt;br/&gt;
1. In FtpOperations.java could disconnect if login failed&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!login) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericFileOperationFailedException(client.getReplyCode(), client.getReplyString());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!login) {
    client.disconnect();
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericFileOperationFailedException(client.getReplyCode(), client.getReplyString());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. Disconnect regardless of what goes wrong, maybe a more robust solution. In FtpOperations.java&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; connect(RemoteFileConfiguration configuration) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; GenericFileOperationFailedException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; connect(RemoteFileConfiguration configuration) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; GenericFileOperationFailedException {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connectInternal(configuration);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (GenericFileOperationFailedException e) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isConnected()) {
            disconnect();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
    }
}
   
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; connectInternal(RemoteFileConfiguration configuration) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; GenericFileOperationFailedException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14532087" author="davsclaus" created="Thu, 7 May 2015 06:23:04 +0000"  >&lt;p&gt;Karsten, have you tried implementing those code changes you suggest and test it on your system to see if it works?&lt;/p&gt;

&lt;p&gt;You are welcome to contribute these changes as a patch or PR&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/contributing.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14532255" author="kvileid@yahoo.com" created="Thu, 7 May 2015 08:42:58 +0000"  >&lt;p&gt;I have tried implementing the code changes and tested them. However I will test the code changes a bit more in our system, and provide some additional unit tests (for ftp producers), and create a pull request.&lt;/p&gt;
</comment>
                            <comment id="14532318" author="gzres" created="Thu, 7 May 2015 09:26:41 +0000"  >&lt;p&gt;Thank you very much!&lt;/p&gt;

</comment>
                            <comment id="14532871" author="gzres" created="Thu, 7 May 2015 15:36:31 +0000"  >&lt;p&gt;I confirm that simply disconnecting &lt;tt&gt;client&lt;/tt&gt; after &lt;tt&gt;org.apache.commons.net.ftp.FTPClient#login()&lt;/tt&gt; returns &lt;tt&gt;false&lt;/tt&gt; prevents from leaking sockets/connections.&lt;br/&gt;
Checking with producer and whether this is correct solution.&lt;/p&gt;</comment>
                            <comment id="14533117" author="gzres" created="Thu, 7 May 2015 18:13:24 +0000"  >&lt;p&gt;Fixed producer and consumer connection leak (general approach) in:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/e1b6592a18362a5903c88923d18abb3430c1c630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;master branch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/8c6dce78c11c91d070ba1894c0a4d71336ad4e03&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;camel-2.15.x branch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/3f44084b38030e2fb6bd6bf399e1afedc4382d5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;camel-2.14.x branch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14533119" author="gzres" created="Thu, 7 May 2015 18:14:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kvileid%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;kvileid@yahoo.com&quot;&gt;kvileid@yahoo.com&lt;/a&gt;, could you check if this works for you?&lt;br/&gt;
I added a test for this &lt;tt&gt;NOOP&lt;/tt&gt; case too, but I think now it is not an issue anymore.&lt;/p&gt;</comment>
                            <comment id="14533994" author="kvileid@yahoo.com" created="Fri, 8 May 2015 07:07:12 +0000"  >&lt;p&gt;I can confirm that fix has been tested and works&lt;/p&gt;</comment>
                            <comment id="14533996" author="gzres" created="Fri, 8 May 2015 07:08:39 +0000"  >&lt;p&gt;Thanks for checking!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e2g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>