<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:09:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8914] Unable to shutdown endpoint when intercepted with interceptSendToEndpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8914</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m facing an issue with the version of camel 2.15.2 &lt;/p&gt;

&lt;p&gt;I have a component that create an endpoint. &lt;/p&gt;

&lt;p&gt;This endpoint override the shutdown and doShutdown method so we can log values at shutdown time. &lt;/p&gt;

&lt;p&gt;But when this endpoint is intercept with the interceptSendToEnpoint method the shutdown is not called. &lt;/p&gt;

&lt;p&gt;Here is an example of code to reproduce: &lt;/p&gt;

&lt;p&gt;the Component: &lt;br/&gt;
public class CustomComponent extends DefaultComponent {&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        protected Endpoint createEndpoint(String uri, String remaining, Map&amp;lt;String, Object&amp;gt; parameters) throws Exception &lt;/p&gt;
{
            return new CustomEndpoint();
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;the Endpoint: &lt;br/&gt;
    public class CustomEndpoint extends DefaultEndpoint {&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        public Producer createProducer() throws Exception {&lt;br/&gt;
            return new DefaultProducer(this) {&lt;br/&gt;
                @Override&lt;br/&gt;
                public void process(Exchange exchange) throws Exception &lt;/p&gt;
{
                    log.info(exchange.getExchangeId());
                }
&lt;p&gt;            };&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        public Consumer createConsumer(Processor processor) throws Exception &lt;/p&gt;
{
            return null;
        }

&lt;p&gt;        @Override&lt;br/&gt;
        public boolean isSingleton() &lt;/p&gt;
{
            return false;
        }

&lt;p&gt;        @Override&lt;br/&gt;
        public void shutdown() throws Exception &lt;/p&gt;
{
            super.shutdown();
            System.out.println(&quot;SHUTDOWN&quot;);
        }

&lt;p&gt;        @Override&lt;br/&gt;
        protected void doShutdown() throws Exception &lt;/p&gt;
{
            super.doShutdown();
            System.out.println(&quot;do SHUTDOWN&quot;);
        }

&lt;p&gt;        @Override&lt;br/&gt;
        protected String createEndpointUri() &lt;/p&gt;
{
            return &quot;myEndpoint&quot;;
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;the route: &lt;br/&gt;
public class MyRoute extends RouteBuilder {&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        public void configure() {&lt;br/&gt;
            try &lt;/p&gt;
{
                getContext().addComponent(&quot;myEndpoint&quot;, new CustomComponent());
            }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
                e.printStackTrace();
            }
&lt;p&gt;            interceptSendToEndpoint(&quot;myEndpoint:producer&quot;)&lt;br/&gt;
                    .log(&quot;INTERCEPTED&quot;);&lt;/p&gt;

&lt;p&gt;            from(&quot;direct:murex&quot;).routeId(&quot;Trade Repository Route&quot;)&lt;br/&gt;
                 .to(&quot;myEndpoint:producer&quot;);&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;When there is an interceptor the shutdown on the endpoint is not called, when there is no interceptor the shutdown is called. &lt;/p&gt;

&lt;p&gt;After some debugging I noticed that in the DefaultCamelContext at the shutdown time the shutdown is called on the list of endpoints, when there is an interceptor the list do not contain the CustomEnpoint but only the Interceptor, and because the interceptor does not implement ShutdownableAware the shutdown is not propagate to the underlying endpoint (here the CustomEndpoint) &lt;/p&gt;

&lt;p&gt;Without the interceptor the CustomEndpoint appears in the list and the shutdown method is called. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12841258">CAMEL-8914</key>
            <summary>Unable to shutdown endpoint when intercepted with interceptSendToEndpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="gterral">Terral Guillaume</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jun 2015 07:49:32 +0000</created>
                <updated>Wed, 1 Jul 2015 09:17:17 +0000</updated>
                            <resolved>Wed, 1 Jul 2015 09:17:17 +0000</resolved>
                                    <version>2.15.2</version>
                                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14609803" author="davsclaus" created="Wed, 1 Jul 2015 09:17:17 +0000"  >&lt;p&gt;Thanks for reporting.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gm2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>