<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:30:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12709] UseOriginalAggregationStrategy in outer loops</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12709</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Using splitters with the UseOriginalAggregationStrategy &lt;ins&gt;in a loop&lt;/ins&gt; causes the splitter to return always the same original exchange.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// my code is similar to the following one:
&lt;/span&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:myLoop&quot;&lt;/span&gt;)
  .loop(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;{{export.maxLoopsPerRun}}&quot;&lt;/span&gt;))
    .setHeader(...) &lt;span class=&quot;code-comment&quot;&gt;// changing header fields
&lt;/span&gt;    .split(body(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UseOriginalAggregationStrategy(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;))
      .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:handleRecord&quot;&lt;/span&gt;)
    .end()
    .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;${in.headers}&quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// the headers of the exchange of the very first loop iteration
&lt;/span&gt;  .end()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reason: Once the original exchange is set by UseOriginalAggregationStrategy#setOriginal(Exchange), it is not updated any more for loop iterations &amp;gt; 1.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13176707">CAMEL-12709</key>
            <summary>UseOriginalAggregationStrategy in outer loops</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Matthi">Matthias Humbert</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Aug 2018 13:26:38 +0000</created>
                <updated>Mon, 20 Aug 2018 07:26:50 +0000</updated>
                            <resolved>Tue, 7 Aug 2018 13:41:24 +0000</resolved>
                                    <version>2.21.2</version>
                                    <fixVersion>2.21.3</fixVersion>
                    <fixVersion>2.22.1</fixVersion>
                    <fixVersion>2.23.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16570771" author="onders" created="Mon, 6 Aug 2018 21:03:28 +0000"  >&lt;p&gt;i think this is on purpose. what loop-eip and split-eip with UseOriginalAggregationStrategy do it is right with the route definition you have given. i think this is not a bug, this is your routing design issue.&lt;/p&gt;</comment>
                            <comment id="16571662" author="davsclaus" created="Tue, 7 Aug 2018 13:37:54 +0000"  >&lt;p&gt;Thanks for reporting. There is an issue with concurrency as the strategy can be shared on the splitter with multiple exchanges and that is not good.&lt;/p&gt;

&lt;p&gt;The original that is being set would be set as the same instance. I am not sure what you do in your use-case that would set a clone of the exchange as Camel routes the same exchange instance for its lifecycle.&lt;/p&gt;

&lt;p&gt;But the concurrency issue should be fixed.&lt;/p&gt;</comment>
                            <comment id="16579890" author="matthi" created="Tue, 14 Aug 2018 14:41:04 +0000"  >&lt;p&gt;Thank you for the fix (my use case should now work too according to the new code on gitlab).&lt;/p&gt;</comment>
                            <comment id="16582270" author="matthi" created="Thu, 16 Aug 2018 09:36:51 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Do you already know when the bug fix release is planned?&lt;/p&gt;

&lt;p&gt;Thanks, Matthias&lt;/p&gt;</comment>
                            <comment id="16582523" author="davsclaus" created="Thu, 16 Aug 2018 13:36:25 +0000"  >&lt;p&gt;In Q3 2018. The next expected patch release is 2.22.1, and then some times later 2.21.3 or a 2.22.2 which ones come first.&lt;/p&gt;</comment>
                            <comment id="16583666" author="folschewski" created="Fri, 17 Aug 2018 09:08:02 +0000"  >&lt;p&gt;I think you missed the ShareUnitOfWorkAggregationStrategy in your fix.&lt;/p&gt;

&lt;p&gt;it should be like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AggregationStrategy strategy = getAggregationStrategy();

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (strategy == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    AggregationStrategy original = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UseOriginalAggregationStrategy(exchange, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isShareUnitOfWork()) {
        original = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ShareUnitOfWorkAggregationStrategy(original);
    }
    setAggregationStrategyOnExchange(exchange, original);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (DelegateAggregationStrategy.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isAssignableFrom(strategy)) {
       strategy = ((DelegateAggregationStrategy) strategy).getDelegate();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (UseOriginalAggregationStrategy.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isAssignableFrom(strategy)) {
        UseOriginalAggregationStrategy original = (UseOriginalAggregationStrategy) strategy;
        AggregationStrategy clone = original.newInstance(exchange);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isShareUnitOfWork()) {
            clone = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ShareUnitOfWorkAggregationStrategy(clone);
        }
        setAggregationStrategyOnExchange(exchange, clone);
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.process(exchange, callback);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16583756" author="davsclaus" created="Fri, 17 Aug 2018 10:41:27 +0000"  >&lt;p&gt;Thanks Frank, would you be able to provide a PR on github with this fix?&lt;/p&gt;</comment>
                            <comment id="16583812" author="folschewski" created="Fri, 17 Aug 2018 11:45:55 +0000"  >&lt;p&gt;Unfortunately not. I&apos;m not deeply enough involved in Camel to contribute.&lt;/p&gt;</comment>
                            <comment id="16585533" author="davsclaus" created="Mon, 20 Aug 2018 07:26:50 +0000"  >&lt;p&gt;Thanks I have updated the code a bit&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wnvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>