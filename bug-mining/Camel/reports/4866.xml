<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:34:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13403] Default allowUseOriginalMessage=&quot;false&quot; prevent clearing inflightRepository using jms with transferExchange=&quot;true&quot;</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13403</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using transferExchange=&quot;true&quot; in a JMS consumer (assuming producer also did), camel is breaking the match between key and exchange in inflightRepository if allowUseOriginalMessage=&quot;true&quot; is not set in camel context.&lt;/p&gt;

&lt;p&gt;This can lead to java heap space out of memory because camel is not able to clear the inflightRepository from old Exchange.&lt;/p&gt;

&lt;p&gt;Identified behaviour :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Camel receive the JMS message
	&lt;ol&gt;
		&lt;li&gt;If allowUseOriginalMessage=true : parse JMS message to build Exchange instance&lt;/li&gt;
		&lt;li&gt;If not : generate a new Instance&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Camel add the Exchange to inflightRepository&lt;/li&gt;
	&lt;li&gt;On accessing the ExchangeBody, if it was not parsed&#160; yet camel rebuild the Exchange but do not change the key(exchangeId) in the inflightRepository&lt;/li&gt;
	&lt;li&gt;When the route process is over the message is not disposed if the key has been changed in the Exchange but not inflightRepository&lt;/li&gt;
	&lt;li&gt;Sooner or later the heap space if full and application crash.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The problem appeared in 2.18.0 and is present up until 2.23.1 (tested with attached test case). Release note of 2.18.0 says :&lt;/p&gt;

&lt;p&gt;&quot;Optimize Camel to only enable AllowUseOriginalMessage if in use by error handler or OnCompletion&amp;lt;&lt;a href=&quot;http://camel.apache.org/oncompletion.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/oncompletion.html&lt;/a&gt;&amp;gt;. End user who manually access the original message using the Java API must configure AllowUseOriginalMessage=true.&quot;&lt;/p&gt;

&lt;p&gt;Problem is transferExchange=&quot;true&quot; case also needs allowUseOriginalMessage=&quot;true&quot; even if the not accessing original message by Java API an other way.&lt;/p&gt;

&lt;p&gt;Easy work around : set allowUseOriginalMessage=&quot;true&quot; in camel context configuration&lt;/p&gt;</description>
                <environment></environment>
        <key id="13227113">CAMEL-13403</key>
            <summary>Default allowUseOriginalMessage=&quot;false&quot; prevent clearing inflightRepository using jms with transferExchange=&quot;true&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Bastien M">Bastien Meert</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Apr 2019 08:00:48 +0000</created>
                <updated>Fri, 12 Apr 2019 09:34:47 +0000</updated>
                            <resolved>Fri, 12 Apr 2019 09:34:46 +0000</resolved>
                                                    <fixVersion>3.0.0-M3</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-jms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16816101" author="davsclaus" created="Fri, 12 Apr 2019 08:56:42 +0000"  >&lt;p&gt;The issue cannot be reproduced on master (camel 3) so we have likely fixed it there. For 2.x users then use the suggested workaround.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12965424" name="JmsInOutTransferExchangeInflightRepositoryFlushTest.java" size="3174" author="Bastien M" created="Wed, 10 Apr 2019 07:51:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01mm0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>