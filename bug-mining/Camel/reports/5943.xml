<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:50:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17174] UnitOfWorkHelper doesn&apos;t clear UoW when job is done</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17174</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;In 2.x, UnitOfWorkHelper used to&#160;remove the UoW from exchange when the job was done, however this is not the case anymore in 3.x.&lt;/p&gt;

&lt;p&gt;Exchanges now seem to reuse UoW after work completion and thus ExchangeCreatedEvents are not created as they were before.&lt;/p&gt;

&lt;p&gt;This is causing issues on functionality that depends on such Created events, and regressions to appear.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13410292">CAMEL-17174</key>
            <summary>UnitOfWorkHelper doesn&apos;t clear UoW when job is done</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="m4rc3iro">marc eiro</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Nov 2021 16:21:57 +0000</created>
                <updated>Sat, 13 Nov 2021 12:22:01 +0000</updated>
                            <resolved>Sat, 13 Nov 2021 12:02:48 +0000</resolved>
                                    <version>3.11.3</version>
                    <version>3.12.0</version>
                                    <fixVersion>3.11.4</fixVersion>
                    <fixVersion>3.14.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17439635" author="davsclaus" created="Sat, 6 Nov 2021 09:37:52 +0000"  >&lt;p&gt;Do you have a reproducer or something to better highlight your problem? &lt;br/&gt;
I cannot reproduce this on main branch where exchange created events are emitted correctly&lt;/p&gt;</comment>
                            <comment id="17439929" author="davsclaus" created="Sun, 7 Nov 2021 07:09:22 +0000"  >&lt;p&gt;Are you using exchange pooling?&lt;/p&gt;</comment>
                            <comment id="17440285" author="m4rc3iro" created="Mon, 8 Nov 2021 08:44:55 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;I&apos;ve been looking at the GIT history for changes in the &lt;tt&gt;UnitOfWorkHelper&lt;/tt&gt; class and found that in the past the UoW was being cleared correctly (you introduced the change on the 29.01.20 - &lt;a href=&quot;https://github.com/apache/camel/commit/e2da037e797d64e402bc6ca526d255ad112476f2),&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/e2da037e797d64e402bc6ca526d255ad112476f2):&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// MUST clear and set uow to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; on exchange after done
&lt;/span&gt;ExtendedExchange ee = (ExtendedExchange) exchange;
ee.setUnitOfWork(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, this change doesn&apos;t seem to exist anymore in main, it did somehow get lost with &lt;a href=&quot;https://github.com/apache/camel/commit/8c2939c45f67cc84c36e8ec2973eadda95477155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8c2939c45f67cc84c36e8ec2973eadda95477155&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;The issue is reproducible in one of our RetryHanlder JUnit tests, which in a nutshell does the following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Defines a simple route from A to endpoint B&lt;/li&gt;
	&lt;li&gt;Creates an file type exchange (&lt;tt&gt;testExchange.setProperty(FileComponent.&lt;b&gt;&lt;em&gt;FILE_EXCHANGE_FILE&lt;/em&gt;&lt;/b&gt;, testFile))&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Sets a route interceptor that on processing throws an exception&lt;/li&gt;
	&lt;li&gt;Sends the created exchange from A to B (using a ProducerTemplate)&lt;/li&gt;
	&lt;li&gt;Sends again the same exchange from A to B&lt;/li&gt;
	&lt;li&gt;Asserts that our RetryHandler (which basically listens for CreatedExchangeEvents) is invoked twice&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17441774" author="m4rc3iro" created="Wed, 10 Nov 2021 14:36:18 +0000"  >&lt;p&gt;Hi Claus,&#160;&lt;/p&gt;

&lt;p&gt;could you please confirm if this is an issue in the current 3.x implementation? If not, where does the UoW get cleared upon completion?&lt;/p&gt;

&lt;p&gt;BR,&lt;br/&gt;
Marc&lt;/p&gt;</comment>
                            <comment id="17442214" author="davsclaus" created="Thu, 11 Nov 2021 10:38:52 +0000"  >&lt;p&gt;Can you attach a reproducer, eg you say you have an unit test. Can you adapt this unit test to work with main branch.&lt;/p&gt;</comment>
                            <comment id="17442584" author="m4rc3iro" created="Fri, 12 Nov 2021 06:23:44 +0000"  >&lt;p&gt;Hi Claus, I will try to write a unit test and push it into a branch.&lt;/p&gt;</comment>
                            <comment id="17442706" author="m4rc3iro" created="Fri, 12 Nov 2021 12:06:33 +0000"  >&lt;p&gt;Hi Claus, please review and approve: &lt;a href=&quot;https://github.com/apache/camel/pull/6432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you think this could be backported to at least 3.11?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0whgg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>