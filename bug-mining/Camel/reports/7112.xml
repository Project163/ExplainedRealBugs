<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:10:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22020] platform-http - Error in clientRequestValidation consumes &amp; produces when plus sign in content-type</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22020</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Base on topic &lt;a href=&quot;https://camel.zulipchat.com/#narrow/channel/257302-camel-quarkus/topic/platform-http.20error.20validating.20consumes.20.26.20produces/near/514302427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#camel-quarkus &amp;gt; platform-http error validating consumes &amp;amp; produces @ &#128172;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;Hi!&lt;br/&gt;
I&apos;ve tested in 3.8.x and current 3.21.x quarkus version.&lt;br/&gt;
In both cases whenever you define and endpoint where you want to validate consumes or produces mime-types the validation fails if the mime-type you want to validate contains plus &apos;+&apos; symbol, for example &apos;application/fhir+json&apos;. Retrieving a response of 406 or 415 if you add the proper one in &apos;Accept&apos; and &apos;Content-Type&apos; header.&lt;br/&gt;
For example try to use these routes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        restConfiguration().component(&lt;span class=&quot;code-quote&quot;&gt;&quot;platform-http&quot;&lt;/span&gt;)
            .host(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;)
            .port(8080)
        ;

		&lt;span class=&quot;code-comment&quot;&gt;// Using &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; consumer
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;/test/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;&quot;&lt;/span&gt;)
            .post()
            .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;Main-Route&quot;&lt;/span&gt;)
            .description(&lt;span class=&quot;code-quote&quot;&gt;&quot;Create a FHIR resource&quot;&lt;/span&gt;)
            .clientRequestValidation(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
            .consumes(&lt;span class=&quot;code-quote&quot;&gt;&quot;application/fhir+json&quot;&lt;/span&gt;) 
            .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:createResource&quot;&lt;/span&gt;)
        ;

        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:createResource&quot;&lt;/span&gt;)
            .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;Create Resource FHIR&quot;&lt;/span&gt;)
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Received FHIR: ${body}&quot;&lt;/span&gt;)
            .setBody(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;{&lt;span class=&quot;code-quote&quot;&gt;&apos;response&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;Bundle FHIR processed successfully&apos;&lt;/span&gt;}&quot;&lt;/span&gt;))
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Response: ${body}&quot;&lt;/span&gt;)
        ;

        &lt;span class=&quot;code-comment&quot;&gt;// Using platform-http consumer
&lt;/span&gt;        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;platform-http:/test/platform?produces=application/fhir+json&amp;amp;httpMethodRestrict=GET&quot;&lt;/span&gt;)
            .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;Test Platform&quot;&lt;/span&gt;)
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Received FHIR JSON: ${body}&quot;&lt;/span&gt;)
            .setBody(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;{&lt;span class=&quot;code-quote&quot;&gt;&apos;response&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;Bundle FHIR JSON processed successfully&apos;&lt;/span&gt;}&quot;&lt;/span&gt;))
            .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Response: ${body}&quot;&lt;/span&gt;)
        ;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then if you try to call them, for example with &apos;curl&apos; as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
curl -H &lt;span class=&quot;code-quote-red&quot;&gt;&apos;Accept: application/fhir+json&apos;&lt;/span&gt; http://localhost:8080/test/platform -v
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You will get a 406 response.&lt;br/&gt;
And for POST, using &apos;curl&apos;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
curl -H &lt;span class=&quot;code-quote-red&quot;&gt;&apos;Content-Type: application/fhir+json&apos;&lt;/span&gt; -X POST -d &lt;span class=&quot;code-quote-red&quot;&gt;&apos;{&lt;span class=&quot;code-quote-red&quot;&gt;&quot;resource&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote-red&quot;&gt;&quot;Patient&quot;&lt;/span&gt;, ...}&apos;&lt;/span&gt; http://localhost:8080/test/rest -v
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You&apos;ll get 415 response.&lt;br/&gt;
The validation works well if there is no &apos;+&apos; symbol in the mime-type, however I didn&apos;t make tests with other kind of symbols.&lt;br/&gt;
I&apos;ve also tested the behavior of Quarkus resteasy component using annotations @Consumes and @Produces for the methods dispatching requests and the behavior is correct, that&apos;s why I&apos;m thinking the problem is in the camel implementation itself.&lt;br/&gt;
There is also a workaround by surrounding the mime-types with RAW(...) function, not only in platform-http, but also in Rest DSL, as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;platform-http:/foo?consumes=RAW(application/fhir+json)&quot;&lt;/span&gt;)
...
&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;/test&quot;&lt;/span&gt;)
   .post()
   .clientRequestValidation(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
   .consumes(&lt;span class=&quot;code-quote&quot;&gt;&quot;RAW(application/fhir+json)&quot;&lt;/span&gt;)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;I&apos;ve tested in 3.8.x and current 3.21.x quarkus version.&lt;/p&gt;</environment>
        <key id="13616352">CAMEL-22020</key>
            <summary>platform-http - Error in clientRequestValidation consumes &amp; produces when plus sign in content-type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="ogomezdi">Oscar Gomez</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Apr 2025 08:31:08 +0000</created>
                <updated>Mon, 28 Apr 2025 09:04:15 +0000</updated>
                            <resolved>Mon, 28 Apr 2025 09:04:04 +0000</resolved>
                                    <version>4.8.6</version>
                    <version>4.11.0</version>
                                    <fixVersion>4.8.7</fixVersion>
                    <fixVersion>4.10.5</fixVersion>
                    <fixVersion>4.12.0</fixVersion>
                                    <component>camel-platform-http</component>
                    <component>rest</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17947344" author="davsclaus" created="Fri, 25 Apr 2025 14:31:25 +0000"  >&lt;p&gt;This is only when you have content-type with the plus sign. And there is the RAW() style that works&lt;/p&gt;</comment>
                            <comment id="17947776" author="davsclaus" created="Mon, 28 Apr 2025 09:04:15 +0000"  >&lt;p&gt;Thanks for reporting and the reproducer&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vjso:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>