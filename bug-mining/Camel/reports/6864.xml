<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:07:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20958] camel-aws - Kinesis consumer loops on closed shards</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20958</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When shards are merged the consumer reads any remaining messages from those shards and then notes that the shard has closed.&#160; However it continuously loops as in the log exert below.&#160; This continues on a restart.&lt;/p&gt;

&lt;p&gt;Note this occurs no matter what type of failure option (silent, fail etc)&lt;/p&gt;

&lt;p&gt;I have not tested so far what happens when the shard reaches its expired state (due to a localstack bug)&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-4&amp;#93;&lt;/span&gt; WARN o.a.c.c.a.k.Kinesis2Consumer - The shard with id=shardId-000000000000 on stream ingestion-death-stream reached CLOSE status&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-3&amp;#93;&lt;/span&gt; WARN o.a.c.c.a.k.Kinesis2Consumer - The shard with id=shardId-000000000001 on stream ingestion-death-stream reached CLOSE status&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-4&amp;#93;&lt;/span&gt; INFO o.a.c.c.a.k.c.KinesisDefaultResumeAdapter - Resuming from offset 49653759514412492265585802359002135113225509352150925314 for key ingestion-death-stream&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-3&amp;#93;&lt;/span&gt; INFO o.a.c.c.a.k.c.KinesisDefaultResumeAdapter - Resuming from offset 49653759514434793010784332982141252979858928386588016658 for key ingestion-death-stream&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-4&amp;#93;&lt;/span&gt; DEBUG o.a.c.c.a.k.Kinesis2Consumer - Obtained new ShardIterator AAAAAAAAAAFhGdwQ2Ac96sw4ScfsOEaTn+V+4vvB9RE9cnHLqD+s4rLMSSioedJLXVbHf47GfSV8ktk53sJmQXMFb+EZOOA/PaByEh66RTC7iBK+8BCZrrL5wb4wNHV7M1qtua1Cu7NrsqEZli3+HgagoG4V7bopK5xPcezzfDN9EWclJRCnlq3Z9nJRSmB4JCmIweWsX8VrM7SHnaVabQ3Kd8l9zoj7 for shard shardId-000000000000 on stream ingestion-death-stream&lt;br/&gt;
2024-07-09 12:01:43 &lt;span class=&quot;error&quot;&gt;&amp;#91;ForkJoinPool.commonPool-worker-3&amp;#93;&lt;/span&gt; DEBUG o.a.c.c.a.k.Kinesis2Consumer - Obtained new ShardIterator AAAAAAAAAAEGg3GnGpu+nfbhufxJ7/V1iSjlD7G24d03xeQATtF9pV1dK21qLxxKpdS8g/CLPdV3MZaJaZoXkthM0J4xNvLOAkCwPpEsl9ympInzr/3QgNqFHqhGopNBlGKMyCdQUYi0UErBuUJ8dPKCq+IYRNVQvhSGg4fF4zXAlDi7jsXC7HZ2X9Xo3Q4XF/E7yEhi1YnFKAmMOmzstDkUtJd+U3MO for shard shardId-000000000001 on stream ingestion-death-stream&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Camel 4.6.0&lt;/p&gt;

&lt;p&gt;Localstack 3.0.2&lt;/p&gt;

&lt;p&gt;Reproducer attached.&lt;/p&gt;</environment>
        <key id="13585267">CAMEL-20958</key>
            <summary>camel-aws - Kinesis consumer loops on closed shards</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="markwimpory">Mark Wimpory</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jul 2024 07:16:05 +0000</created>
                <updated>Wed, 21 Aug 2024 06:23:40 +0000</updated>
                            <resolved>Wed, 21 Aug 2024 06:23:40 +0000</resolved>
                                    <version>4.6.0</version>
                                    <fixVersion>4.8.0</fixVersion>
                                    <component>camel-aws2-kinesis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17864511" author="JIRAUSER305715" created="Wed, 10 Jul 2024 07:17:14 +0000"  >&lt;p&gt;Readme.md contains additional steps to reproduce as it requires aws command&lt;/p&gt;</comment>
                            <comment id="17871962" author="davsclaus" created="Thu, 8 Aug 2024 11:44:07 +0000"  >&lt;p&gt;Okay so what should happen when the shard has CLOSED status. Should then consumer then just silently ignore that, and then keep attempting to read it in the future or what ?&lt;/p&gt;</comment>
                            <comment id="17872038" author="JIRAUSER305715" created="Thu, 8 Aug 2024 14:47:44 +0000"  >&lt;p&gt;Mmmm yes I can see what you mean, but when a shard is closed no new messages can be written to it.&#160; So when you reach the end of the shard there is no need to continue asking for a new subscription.&#160; So I would say on first start its fine, because we dont know we are at the end of the shard, and in fact the subscriber may want to read from the shard.&#160; But once that finishes we can stop until the next restart.&lt;/p&gt;</comment>
                            <comment id="17872047" author="davsclaus" created="Thu, 8 Aug 2024 15:00:43 +0000"  >&lt;p&gt;Okay so maybe we can detect the CLOSED and do a WARN or INFO log and saying that its closed and that no new messages will be consumed, and then make the consumer a noop mode.&lt;br/&gt;
You are welcome to attempt to implement this and send a PR against the main branch&lt;/p&gt;</comment>
                            <comment id="17875075" author="davsclaus" created="Tue, 20 Aug 2024 07:52:29 +0000"  >&lt;p&gt;Okay so the ignore will keep WARN logging. And ignore will be silent, but yes the consumer will keep looping.&lt;br/&gt;
Yes we need to make the consumer (when closed) not attempt to do more AWS activity. The Camel route/consumer will keep being started but it wont do anything until restarted.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13070035" name="camel-reproducer.zip" size="35262" author="markwimpory" created="Wed, 10 Jul 2024 07:15:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1q8xk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>