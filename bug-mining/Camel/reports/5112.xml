<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:38:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-14224] Camel-Websocket: The sendToAll method in the Producer is really slow</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-14224</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I don&apos;t know what the idea behind but in this class (&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-websocket/src/main/java/org/apache/camel/component/websocket/WebsocketProducer.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Producer&lt;/a&gt;) sendToAll method the Thread.sleep in the while loop make all the process crazy slow just try to run this code&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = &lt;span class=&quot;code-quote&quot;&gt;&quot;websocket:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:8443/test?sendToAll=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;sendTimeout=0&quot;&lt;/span&gt;;
&lt;/span&gt;
        from(uri).to(uri);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;and send multiple message to the server and you will see how slow is it for my point there is two defect:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Give the availability to send to all &lt;b&gt;expect&lt;/b&gt; the sender&lt;/li&gt;
	&lt;li&gt;Fix the while loop&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;During my test to have decent performance i set this parameter `sendTimeout` to 0 but i got this exception then: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.camel.component.websocket.WebsocketSendException: Failed to deliver message within 0 millis to one or more recipients.. Exchange[ID-DESKTOP-S8PM2C4-1574865248397-0-3]
	at org.apache.camel.component.websocket.WebsocketProducer.sendToAll(WebsocketProducer.java:149) ~[camel-websocket-2.24.2.jar:2.24.2]
	at org.apache.camel.component.websocket.WebsocketProducer.process(WebsocketProducer.java:52) ~[camel-websocket-2.24.2.jar:2.24.2]
	at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) ~[camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:148) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:548) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:76) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:148) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:548) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:201) [camel-core-2.24.2.jar:2.24.2]
	at org.apache.camel.component.websocket.WebsocketConsumer.sendMessage(WebsocketConsumer.java:75) [camel-websocket-2.24.2.jar:2.24.2]
	at org.apache.camel.component.websocket.WebsocketConsumer.sendMessage(WebsocketConsumer.java:59) [camel-websocket-2.24.2.jar:2.24.2]
	at org.apache.camel.component.websocket.DefaultWebsocket.onMessage(DefaultWebsocket.java:66) [camel-websocket-2.24.2.jar:2.24.2]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_201]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_201]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_201]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_201]
	at org.eclipse.jetty.websocket.common.events.annotated.CallableMethod.call(CallableMethod.java:70) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.events.annotated.OptionalSessionCallableMethod.call(OptionalSessionCallableMethod.java:72) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.events.JettyAnnotatedEventDriver.onTextMessage(JettyAnnotatedEventDriver.java:251) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.message.SimpleTextMessage.messageComplete(SimpleTextMessage.java:69) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.events.AbstractEventDriver.appendMessage(AbstractEventDriver.java:65) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.events.JettyAnnotatedEventDriver.onTextFrame(JettyAnnotatedEventDriver.java:243) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.events.AbstractEventDriver.incomingFrame(AbstractEventDriver.java:150) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.WebSocketSession.incomingFrame(WebSocketSession.java:322) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.extensions.AbstractExtension.nextIncomingFrame(AbstractExtension.java:147) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.extensions.compress.PerMessageDeflateExtension.nextIncomingFrame(PerMessageDeflateExtension.java:112) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.extensions.compress.CompressExtension.forwardIncoming(CompressExtension.java:168) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.extensions.compress.PerMessageDeflateExtension.incomingFrame(PerMessageDeflateExtension.java:92) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.extensions.ExtensionStack.incomingFrame(ExtensionStack.java:202) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.Parser.notifyFrame(Parser.java:225) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.Parser.parseSingleFrame(Parser.java:259) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.io.AbstractWebSocketConnection.onFillable(AbstractWebSocketConnection.java:460) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.websocket.common.io.AbstractWebSocketConnection.onFillable(AbstractWebSocketConnection.java:441) [websocket-common-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) [jetty-io-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) [jetty-io-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:336) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:313) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:171) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:129) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:388) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:806) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:938) [jetty-util-9.4.22.v20191022.jar:9.4.22.v20191022]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [na:1.8.0_201]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13271019">CAMEL-14224</key>
            <summary>Camel-Websocket: The sendToAll method in the Producer is really slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="michael992">michael elbaz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Nov 2019 14:49:45 +0000</created>
                <updated>Thu, 5 Dec 2019 12:37:31 +0000</updated>
                            <resolved>Wed, 4 Dec 2019 11:49:26 +0000</resolved>
                                    <version>2.24.2</version>
                                    <fixVersion>2.24.3</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>camel-websocket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16985364" author="davsclaus" created="Sat, 30 Nov 2019 13:49:39 +0000"  >&lt;p&gt;And what happens when you use =1&lt;/p&gt;</comment>
                            <comment id="16985366" author="davsclaus" created="Sat, 30 Nov 2019 13:51:16 +0000"  >&lt;p&gt;And yeah looks like you can move this sleep out in the outer loop so it sleeps per run and not per message, can you try to patch the code and test it, and then provide a PR&lt;/p&gt;</comment>
                            <comment id="16986143" author="michael992" created="Mon, 2 Dec 2019 15:37:54 +0000"  >&lt;p&gt;With 1 same exception depending on how fast the message was processed, yeah i&apos;ll try &lt;/p&gt;</comment>
                            <comment id="16986365" author="michael992" created="Mon, 2 Dec 2019 21:06:00 +0000"  >&lt;p&gt;Hum i don&apos;t know how to proceed because there is no test for this specific part, by the way there is a lot of non passing tests when i running using my IDE (IntelliJ) for different raison is it normal ?&lt;/p&gt;</comment>
                            <comment id="16986406" author="bedla" created="Mon, 2 Dec 2019 21:52:05 +0000"  >&lt;p&gt;All tests (except one for hystrix) are passing on CI (&#160;&lt;a href=&quot;https://builds.apache.org/job/Camel/job/master/1716/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Camel/job/master/1716/testReport/&lt;/a&gt; ) . I was never able to run tests directly in Intellij, the project is simply too huge for IDE and it randomly fails. You need to test it with maven.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cd components/whatever
mvn clean install # build and test all in submodule
mvn clean install -Dtest=YourTestClassName # build module and run single test&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16986780" author="michael992" created="Tue, 3 Dec 2019 10:26:04 +0000"  >&lt;p&gt;I know tests are passed using maven but for my point it must be passed when using an IDE also, by the way you can just open your component when you are using an ide and not the whole project &lt;/p&gt;</comment>
                            <comment id="16986993" author="davsclaus" created="Tue, 3 Dec 2019 15:20:05 +0000"  >&lt;p&gt;Well it can be some weird limitation in jetty how fast you can send using it.&lt;/p&gt;</comment>
                            <comment id="16987025" author="michael992" created="Tue, 3 Dec 2019 15:56:05 +0000"  >&lt;p&gt;It is not limitation of jetty actual implementation are wrong as you say before we have to fix this loop&lt;/p&gt;</comment>
                            <comment id="16988752" author="michael992" created="Thu, 5 Dec 2019 12:37:31 +0000"  >&lt;p&gt;Oh you already fix this one thanks !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z092qw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>