<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:36:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13886] camel-servlet + camel-http4 with null body causes &quot;Stream closed&quot; IOException</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13886</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A Rest DSL route like the following causes &lt;tt&gt;java.io.IOException: Stream closed&lt;/tt&gt; when invoked at &lt;a href=&quot;http://localhost:8000/test/proxy:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8000/test/proxy:&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;/test&quot;&lt;/span&gt;)
                .get(&lt;span class=&quot;code-quote&quot;&gt;&quot;/proxy&quot;&lt;/span&gt;)
                .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:callInternalRestService&quot;&lt;/span&gt;);

        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:callInternalRestService&quot;&lt;/span&gt;)
                .setHeader(Exchange.HTTP_METHOD, constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;DELETE&quot;&lt;/span&gt;))
                &lt;span class=&quot;code-comment&quot;&gt;//.setBody(constant(&quot;&quot;)) // workaround &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; body and http4 component
&lt;/span&gt;                .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;http4:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9000/test?bridgeEndpoint=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/span&gt;                .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body}&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.IOException: Stream closed
	at org.apache.catalina.connector.InputBuffer.read(InputBuffer.java:372)
	at org.apache.catalina.connector.CoyoteInputStream.read(CoyoteInputStream.java:156)
	at org.apache.camel.util.IOHelper.copy(IOHelper.java:202)
	at org.apache.camel.util.IOHelper.copy(IOHelper.java:174)
	at org.apache.camel.util.IOHelper.copyAndCloseInput(IOHelper.java:234)
	at org.apache.camel.util.IOHelper.copyAndCloseInput(IOHelper.java:230)
	at org.apache.camel.http.common.HttpHelper.readResponseBodyFromInputStream(HttpHelper.java:245)
	at org.apache.camel.http.common.HttpHelper.readRequestBodyFromServletRequest(HttpHelper.java:196)
	at org.apache.camel.http.common.DefaultHttpBinding.parseBody(DefaultHttpBinding.java:577)
	at org.apache.camel.http.common.HttpMessage.createBody(HttpMessage.java:78)
	... 54 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;This seems to happen only when Tomcat is used as the container with Spring Boot. Undertow doesn&apos;t cause such an issue.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;The real root cause is that when an exchange has an &lt;tt&gt;HttpMessage&lt;/tt&gt; with &lt;tt&gt;null&lt;/tt&gt; body as its out message, then the next time &lt;tt&gt;Exchange.getMessage()&lt;/tt&gt; is invoked the &lt;tt&gt;HttpMessage&lt;/tt&gt; is tricked by the &lt;tt&gt;null&lt;/tt&gt; body and tries to create body again with the already closed request input stream.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13252014">CAMEL-13886</key>
            <summary>camel-servlet + camel-http4 with null body causes &quot;Stream closed&quot; IOException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tadayosi">Tadayoshi Sato</assignee>
                                    <reporter username="tadayosi">Tadayoshi Sato</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Aug 2019 06:05:38 +0000</created>
                <updated>Fri, 13 Sep 2019 09:31:14 +0000</updated>
                            <resolved>Fri, 13 Sep 2019 02:37:14 +0000</resolved>
                                    <version>3.0.0.M4</version>
                    <version>2.25.0</version>
                                    <fixVersion>3.0.0.RC2</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                                    <component>camel-http-common</component>
                    <component>camel-http4</component>
                    <component>camel-servlet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16912281" author="coheigea" created="Wed, 21 Aug 2019 13:16:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tadayosi&quot; class=&quot;user-hover&quot; rel=&quot;tadayosi&quot;&gt;tadayosi&lt;/a&gt; - looks like this issues caused some test failures on 2.x in camel-servlet + camel-jetty: &lt;a href=&quot;https://builds.apache.org/job/Camel/job/camel-2.x/230/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Camel/job/camel-2.x/230/#showFailuresLink&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16912859" author="tadayosi" created="Thu, 22 Aug 2019 02:10:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; Yes, I noticed the failures too. Working on it. Thanks for your notification.&lt;/p&gt;</comment>
                            <comment id="16913893" author="davsclaus" created="Fri, 23 Aug 2019 03:48:55 +0000"  >&lt;p&gt;Okay but this works for Camel 3.x? If so then we can have a fix here if we dont find a solution that works on the old 2.x and 3.x at the same time.&lt;/p&gt;</comment>
                            <comment id="16913906" author="tadayosi" created="Fri, 23 Aug 2019 04:11:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; No, it turned out my previous fix was not really correct. I reverted it from both 2.x and 3.x. I&apos;m working on a better fix right now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05v8g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>