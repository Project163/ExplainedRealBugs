<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:07:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21109] Choice evaluation behaves inconsistently when source is String and Value is Float.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21109</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Choice evaluation works inconsistently if the condition contains Predicates with String, but the value is float.&lt;/p&gt;

&lt;p&gt;Consider the choice expression:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;${exchangeProperty.left} &amp;gt;= ${exchangeProperty.right}&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If the both the properties are &apos;left&apos; and &apos;right&apos;, but value contained in them is float like &apos;4.0&apos; &apos;7.5&apos; etc, the expression is compared as Strings and returns false. However, if the value contained in them is &quot;Pure&quot; Integer, then they are compared as &quot;Numbers&quot; and Comparision returns true.&lt;/p&gt;

&lt;p&gt;Please see the Examples:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Example 1:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&#160; &#160; &#160; &#160; from(&quot;timer:getter?period=1000&amp;amp;repeatCount=1&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setProperty(&quot;left&quot;, simple(&quot;40&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setProperty(&quot;right&quot;, simple(&quot;7.5&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .choice()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .when(simple(&quot;${exchangeProperty.left} &amp;gt;= ${exchangeProperty.right}&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .to(&quot;log://match&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .otherwise()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .to(&quot;log://otherwise&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .end();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;The Predicate in Example 1, evaluation returns false for the case above as it compares 40 and 7.5 as Strings.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;b&gt;Example 2:&lt;/b&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; from(&quot;timer:getter?period=1000&amp;amp;repeatCount=1&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setProperty(&quot;left&quot;, simple(&quot;40&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setProperty(&quot;right&quot;, simple(&quot;7&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .choice()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .when(simple(&quot;${exchangeProperty.left} &amp;gt;= ${exchangeProperty.right}&quot;))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .to(&quot;log://match&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .otherwise()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .to(&quot;log://otherwise&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .end();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;The Predicate in Example 2, evaluation returns true for the case above as it compares 40 and 7 as Numbers.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We debugged the Camel Code, and compared the behavior against Camel 2x, we can see that the predicate evaluation takes &quot;Double&quot; also into consideration.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Camel 2x Code:&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/8e512e50a49f309ae2f9641f59dbfe561e7c0a13/camel-core/src/main/java/org/apache/camel/util/ObjectHelper.java#L147C1-L161C10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ObjectHelper.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;public static int typeCoerceCompare(TypeConverter converter, Object leftValue, Object rightValue) {&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; // if both values is numeric then compare using numeric&lt;br/&gt;
&#160; &#160; &#160; &#160; Long leftNum = converter.tryConvertTo(Long.class, leftValue);&lt;br/&gt;
&#160; &#160; &#160; &#160; Long rightNum = converter.tryConvertTo(Long.class, rightValue);&lt;br/&gt;
&#160; &#160; &#160; &#160; if (leftNum != null &amp;amp;&amp;amp; rightNum != null) &lt;/p&gt;
{
&#160; &#160; &#160; &#160; &#160; &#160; return leftNum.compareTo(rightNum);
&#160; &#160; &#160; &#160; }

&lt;p&gt;&#160; &#160; &#160; &#160; // also try with floating point numbers&lt;br/&gt;
&#160; &#160; &#160; &#160; Double leftDouble = converter.tryConvertTo(Double.class, leftValue);&lt;br/&gt;
&#160; &#160; &#160; &#160; Double rightDouble = converter.tryConvertTo(Double.class, rightValue);&lt;br/&gt;
&#160; &#160; &#160; &#160; if (leftDouble != null &amp;amp;&amp;amp; rightDouble != null) &lt;/p&gt;
{
&#160; &#160; &#160; &#160; &#160; &#160; return leftDouble.compareTo(rightDouble);
&#160; &#160; &#160; &#160; }
&lt;p&gt; &#160;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Camel 3x Code:&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/bb339e9eb26fa38b448d74bbb058c70d0a057f33/core/camel-support/src/main/java/org/apache/camel/support/ObjectHelper.java#L261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ObjectHelper.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;public static int typeCoerceCompare(TypeConverter converter, Object leftValue, Object rightValue) {&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; // optimize for common combinations of comparing numbers&lt;br/&gt;
&#160; &#160; &#160; &#160; if (leftValue instanceof String &amp;amp;&amp;amp; rightValue instanceof String) {&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; String leftNum = (String) leftValue;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; String rightNum = (String) rightValue;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; if (isNumber(leftNum) &amp;amp;&amp;amp; isNumber(rightNum)) &lt;/p&gt;
{
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; // favour to use numeric comparison
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Long num1 = Long.parseLong(leftNum);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Long num2 = Long.parseLong(rightNum);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return num1.compareTo(num2);
&#160; &#160; &#160; &#160; &#160; &#160; }
&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; return leftNum.compareTo(rightNum);&lt;br/&gt;
&#160; &#160; &#160; &#160; } else if (leftValue instanceof Integer &amp;amp;&amp;amp; rightValue instanceof Integer) {&lt;/p&gt;</description>
                <environment></environment>
        <key id="13589735">CAMEL-21109</key>
            <summary>Choice evaluation behaves inconsistently when source is String and Value is Float.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="harisha">Harish Annamalai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Aug 2024 10:47:04 +0000</created>
                <updated>Mon, 26 Aug 2024 07:51:54 +0000</updated>
                            <resolved>Mon, 26 Aug 2024 07:51:54 +0000</resolved>
                                    <version>3.x</version>
                                    <fixVersion>3.22.3</fixVersion>
                    <fixVersion>4.4.4</fixVersion>
                    <fixVersion>4.8.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17875812" author="davsclaus" created="Thu, 22 Aug 2024 11:00:37 +0000"  >&lt;p&gt;Yeah that would require adding support for Float.&lt;/p&gt;</comment>
                            <comment id="17876173" author="JIRAUSER295572" created="Fri, 23 Aug 2024 05:15:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; : Thanks for providing a Fix to this issue in a very short duration.&lt;/p&gt;

&lt;p&gt;Could this also be patched to camel-3.x version as Camel 3.22 still supported for next 3-4 months?&lt;/p&gt;</comment>
                            <comment id="17876291" author="JIRAUSER295572" created="Fri, 23 Aug 2024 14:57:37 +0000"  >&lt;p&gt;We humbly request you to provide a this same patch to camel-3.x series of branches as Camel 3.22 is supported up to Dec 2024.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r0hc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>