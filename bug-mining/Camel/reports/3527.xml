<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:12:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-9483] Deploying bundle with Camel routes packaged in KAR fails randomly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9483</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I am struggling with random deployment failures of bundles containing Camel routes, packaged in a KAR file. Deployment fails mostly because data formats cannot be found on the classpath or Camel component beans are not found in the registry.&lt;/p&gt;

&lt;p&gt;The attached sample KAR file contains one bundle with the following blueprint deployment descriptor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;blueprint xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;&lt;/span&gt; 			&lt;span class=&quot;code-keyword&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; 			&lt;span class=&quot;code-keyword&quot;&gt;xmlns:camel&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/blueprint&quot;&lt;/span&gt; 			xsi:schemaLocation=&quot;				http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
				http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint-2.16.1.xsd&quot;&amp;gt;
 
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;processor&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;ch.rsteppac.karissue.RestProcessor&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camelContext id=&lt;span class=&quot;code-quote&quot;&gt;&quot;rest-api&quot;&lt;/span&gt; allowUseOriginalMessage=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;restConfiguration component=&lt;span class=&quot;code-quote&quot;&gt;&quot;netty4-http&quot;&lt;/span&gt; scheme=&lt;span class=&quot;code-quote&quot;&gt;&quot;http&quot;&lt;/span&gt; host=&lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt; port=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016&quot;&lt;/span&gt; bindingMode=&lt;span class=&quot;code-quote&quot;&gt;&quot;json&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataFormatProperty key=&lt;span class=&quot;code-quote&quot;&gt;&quot;prettyPrint&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/restConfiguration&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;rest path=&lt;span class=&quot;code-quote&quot;&gt;&quot;/say/hello&quot;&lt;/span&gt; id=&lt;span class=&quot;code-quote&quot;&gt;&quot;poc-route&quot;&lt;/span&gt; produces=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;get uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;/{yourName}&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;route&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camel:process ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;processor&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/route&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/get&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/rest&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/camelContext&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/blueprint&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The feature file of the KAR:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; standalone=&lt;span class=&quot;code-quote&quot;&gt;&quot;yes&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;features xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://karaf.apache.org/xmlns/features/v1.3.0&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;KAR deployment issue PoC&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;repository&amp;gt;&lt;/span&gt;mvn:org.apache.camel.karaf/apache-camel/2.16.1/xml/features&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/repository&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;feature name=&lt;span class=&quot;code-quote&quot;&gt;&quot;poc-rest-service&quot;&lt;/span&gt; description=&lt;span class=&quot;code-quote&quot;&gt;&quot;Sample REST bundle to demonstrate the deployment issue in Karaf 4&quot;&lt;/span&gt; version=&lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.1.SNAPSHOT&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;details&amp;gt;&lt;/span&gt;Sample REST bundle to demonstrate the deployment issue in Karaf 4&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/details&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;feature version=&lt;span class=&quot;code-quote&quot;&gt;&quot;2.16.1&quot;&lt;/span&gt; prerequisite=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; dependency=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;camel-jackson&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/feature&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;feature version=&lt;span class=&quot;code-quote&quot;&gt;&quot;2.16.1&quot;&lt;/span&gt; prerequisite=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; dependency=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;camel-blueprint&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/feature&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;feature version=&lt;span class=&quot;code-quote&quot;&gt;&quot;2.16.1&quot;&lt;/span&gt; prerequisite=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; dependency=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;camel-netty4-http&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/feature&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bundle&amp;gt;&lt;/span&gt;mvn:ch.rsteppac.kar-issue/poc-rest-service/0.0.1-SNAPSHOT&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bundle&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/feature&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/features&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On my development machine (OSX) deploying the sample KAR file succeeds about 8 out of 10 times. It appears that the more features the KAR file contains the lower the probability of success. Our actual project KAR fails deployment about 9 out of 10 times.&lt;br/&gt;
Not all Camel components are equally likely to cause the deployment failure. The most likely to trigger a failure are data formats, e.g., jackson-json or jaxb.&lt;br/&gt;
Once the KAR file has deployed successfully, restarting Karaf will consistently deploy the bundles successfully. Until one deletes Karaf&apos;s data folder, then all bets are off again.&lt;/p&gt;

&lt;p&gt;Adding the feature.xml generated for the KAR with &lt;tt&gt;feature:repo-add&lt;/tt&gt; and then deploying the features with &lt;tt&gt;feature:install&lt;/tt&gt; virtually never fails.&lt;/p&gt;

&lt;p&gt;Stack traces for most frequent deployment failure of the sample KAR are attached to the ticket.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;EDIT&quot;&gt;&lt;/a&gt;EDIT&lt;/h4&gt;

&lt;p&gt;The issue is actually unrelated to fact that the features are deployed via a KAR file. While I can successfully install each feature individually on the command line, if I restart Karaf and the features are deployed from the &lt;tt&gt;$KARAF_HOME/data&lt;/tt&gt; directory, the behavior is the same as described above.&lt;/p&gt;

&lt;p&gt;I encountered another class of errors: A bean declared in the blueprint context was not resolvable in the Camel context in the same file. &lt;/p&gt;

&lt;p&gt;Defining a start-level for my bundles (90) seems to be a workaround for the different issues described above.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Karaf 4.0.3, blueprint deployment, JDK 1.8_40 on OSX El Capitan and JDK 1.8_65 on Centos 6.5&lt;/p&gt;</environment>
        <key id="12927961">CAMEL-9483</key>
            <summary>Deploying bundle with Camel routes packaged in KAR fails randomly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="ralfsteppacher">Ralf Steppacher</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jan 2016 09:24:20 +0000</created>
                <updated>Fri, 13 May 2016 05:51:15 +0000</updated>
                            <resolved>Sun, 31 Jan 2016 10:11:43 +0000</resolved>
                                    <version>2.16.1</version>
                                    <fixVersion>2.16.3</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15092213" author="ralfsteppacher" created="Mon, 11 Jan 2016 16:22:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, should this be a Karaf ticket instead of a Camel ticket?&lt;/p&gt;</comment>
                            <comment id="15125270" author="davsclaus" created="Sun, 31 Jan 2016 09:56:42 +0000"  >&lt;p&gt;No we can improve camel-blueprint to detect those component names in the rest configuration. That should help with the netty4-http not found etc.&lt;/p&gt;</comment>
                            <comment id="15125274" author="davsclaus" created="Sun, 31 Jan 2016 10:11:43 +0000"  >&lt;p&gt;We now detect which components and data formats the rest-dsl is configured to use and wait for those bundles.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12969472">CAMEL-9963</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12780719" name="data_format_lookup_failed.log" size="67401" author="ralfsteppacher" created="Wed, 6 Jan 2016 09:31:16 +0000"/>
                            <attachment id="12780716" name="kar-build-0.0.1-SNAPSHOT.kar" size="8085" author="ralfsteppacher" created="Wed, 6 Jan 2016 09:25:49 +0000"/>
                            <attachment id="12780715" name="registry_lookup_failed.log" size="66800" author="ralfsteppacher" created="Wed, 6 Jan 2016 09:25:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qx8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>