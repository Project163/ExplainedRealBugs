<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:02:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7271] AbstractListGroupedExchangeAggregationStrategy produces failed exchange if first received exchange fails</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7271</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If the first exchange received by a (concrete implementation of) AggregationStrategy  contains an exception, then the result of the aggregation will also contain that exception, and so will not continue routing without error. This makes the first received exchange have an effect that subsequent exchanges do not have.&lt;/p&gt;

&lt;p&gt;The specific use case multicasts to GroupedExchangeAggregationStrategy. The MulticastProcessor.doDone function uses ExchangeHelper.copyResults to copy the aggregated result to the original exchange. The copyResults method copies the exception as well, thereby propagating the error.&lt;/p&gt;

&lt;p&gt; The attached unit test has 3 tests, testAFail, testBFail, and testAllGood. All three of these should pass, but testAFail does not.&lt;/p&gt;

&lt;p&gt;What is happening is that AbstractListAggregationStrategy is directly storing its values on and returning the first exchange:&lt;br/&gt;
    public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {&lt;br/&gt;
        List&amp;lt;V&amp;gt; list;&lt;/p&gt;

&lt;p&gt;        if (oldExchange == null) &lt;/p&gt;
{
            list = getList(newExchange);
        }
&lt;p&gt; else &lt;/p&gt;
{
            list = getList(oldExchange);
        }

&lt;p&gt;        if (newExchange != null) {&lt;br/&gt;
            V value = getValue(newExchange);&lt;br/&gt;
            if (value != null) &lt;/p&gt;
{
                list.add(value);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        return oldExchange != null ? oldExchange : newExchange;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;The pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5579&quot; title=&quot;Add an abstract grouped by aggregator strategy that users can extend from.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5579&quot;&gt;&lt;del&gt;CAMEL-5579&lt;/del&gt;&lt;/a&gt; version of GroupedExchangeAggregationStrategy created a fresh exchange to store and return the aggregated exchanges:&lt;br/&gt;
    public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {&lt;br/&gt;
        List&amp;lt;Exchange&amp;gt; list;&lt;br/&gt;
        Exchange answer = oldExchange;&lt;/p&gt;

&lt;p&gt;        if (oldExchange == null) &lt;/p&gt;
{
            answer = new DefaultExchange(newExchange);
            list = new ArrayList&amp;lt;Exchange&amp;gt;();
            answer.setProperty(Exchange.GROUPED_EXCHANGE, list);
        }
&lt;p&gt; else &lt;/p&gt;
{
            list = oldExchange.getProperty(Exchange.GROUPED_EXCHANGE, List.class);
        }

&lt;p&gt;        if (newExchange != null) &lt;/p&gt;
{
            list.add(newExchange);
        }
&lt;p&gt;        return answer;&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment></environment>
        <key id="12698772">CAMEL-7271</key>
            <summary>AbstractListGroupedExchangeAggregationStrategy produces failed exchange if first received exchange fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="wlhamaty">Luke Hamaty</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Mar 2014 00:00:19 +0000</created>
                <updated>Mon, 28 Apr 2014 05:39:33 +0000</updated>
                            <resolved>Mon, 28 Apr 2014 05:39:33 +0000</resolved>
                                    <version>2.11.3</version>
                    <version>2.12.2</version>
                                    <fixVersion>2.12.4</fixVersion>
                    <fixVersion>2.13.1</fixVersion>
                    <fixVersion>2.14.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13982760" author="davsclaus" created="Mon, 28 Apr 2014 05:39:33 +0000"  >&lt;p&gt;Thanks for reporting and providing test cases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12632715" name="camel-jira7271-test.zip" size="3374" author="wlhamaty" created="Wed, 5 Mar 2014 00:11:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377120</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1szfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377415</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>