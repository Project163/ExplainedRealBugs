<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:11:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-9217] URI validation verifies usage of &amp; char incorrectly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9217</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hello Camel team,&lt;/p&gt;

&lt;p&gt;I have faced a URI validation issue that does not allow me to use a correct file producer URI if it does not contain parameters. My file endpoint URI looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;raw form:             file:D:\camel_test\test&amp;amp;run
in encoded format:  file:D%3A%5Ccamel_test%5Ctest%26run
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see this is a simple file endpoint URI which does not contain any parameters, please note that the target folder name contains &apos;&amp;amp;&apos; char.&lt;/p&gt;

&lt;p&gt;When I try to start a route for this endpoint I get the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: file:&lt;span class=&quot;code-comment&quot;&gt;//D:%5Ccamel_test%5Ctest&amp;amp;run due to: Failed to resolve endpoint: file://D:%5Ccamel_test%5Ctest&amp;amp;run due to: Invalid uri syntax: no ? marker however the uri has &amp;amp; parameter separators. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its missing a ? marker.
&lt;/span&gt;at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:547)
at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:72)
at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:202)
at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:107)
at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:113)
at org.apache.camel.model.SendDefinition.resolveEndpoint(SendDefinition.java:61)
at org.apache.camel.model.SendDefinition.createProcessor(SendDefinition.java:55)
at org.apache.camel.model.ProcessorDefinition.makeProcessor(ProcessorDefinition.java:500)
at org.apache.camel.model.ProcessorDefinition.addRoutes(ProcessorDefinition.java:213)
at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:942)
Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: file:&lt;span class=&quot;code-comment&quot;&gt;//D:%5Ccamel_test%5Ctest&amp;amp;run due to: Invalid uri syntax: no ? marker however the uri has &amp;amp; parameter separators. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its missing a ? marker.
&lt;/span&gt;at org.apache.camel.impl.DefaultComponent.validateURI(DefaultComponent.java:210)
at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:115)
at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:527)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is that I have an &apos;&amp;amp;&apos; char in my folder path and do not have URI parameters. As a result the DefaultComponent.validateURI() function throws the exception at this point:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (uri.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !uri.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;?&quot;&lt;/span&gt;)) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResolveEndpointFailedException(uri, &lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid uri syntax: no ? marker however the uri &quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;has &amp;amp; parameter separators. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its missing a ? marker.&quot;&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the issue is that for some reason &amp;amp; char at this point is in decoded form which is incorrect because it should be URI encoded here. I know that Camel has issues with + and &amp;amp; chars and in case of URI parameters we can use RAW() wrapper as a workaround. But as far as I can see we cannot do the same in base endpoint URI.&lt;/p&gt;

&lt;p&gt;Please note that if I add an URI parameter (any parameter works) the issue disappears and the event target works fine.&lt;br/&gt;
For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;raw form:             file:D:\camel_test\test&amp;amp;run?forceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
in encoded format:  file:D%3A%5Ccamel_test%5Ctest%26run?forceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I also found that Camel cannot normally handle URIs with ? char in base URI string. For example in case of File endpoint it tries to handle the second part of the base URI (which follows the ? char) as a parameter which is incorrect because ? char was correctly encoded and should not be used as the point where parameters string starts. If I try to use ? char in bucket name for S3 endpoint the part after ? is simply ignored.&lt;br/&gt;
For example the following URI produces an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;raw form:             file:D:\camel_test\test?run?forceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
in encoded format:  file:D%3A%5Ccamel_test%5Ctest%3Frun?forceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-10-13 13:26:38,285 INFO [com.informatica.saas.infaagentv3.agentcore.TomcatManager] - Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: file:&lt;span class=&quot;code-comment&quot;&gt;//D:%5Ccamel_test%5Ctest?run%3FforceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{run?forceWrites=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}]
&lt;/span&gt;at org.apache.camel.impl.DefaultComponent.validateParameters(DefaultComponent.java:192)
at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:137)
at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:527)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And yes I know that ? char in a file path is not the best idea, I used the above example to illustrate a global camel issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12904481">CAMEL-9217</key>
            <summary>URI validation verifies usage of &amp; char incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mvlakh">MykhailoVlakh</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2015 09:27:16 +0000</created>
                <updated>Mon, 19 Oct 2015 07:36:11 +0000</updated>
                            <resolved>Sat, 17 Oct 2015 07:48:37 +0000</resolved>
                                    <version>2.14.3</version>
                                    <fixVersion>2.16.1</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14954878" author="mvlakh" created="Tue, 13 Oct 2015 12:55:12 +0000"  >&lt;p&gt;Sorry, but I think this issue has a Major priority because if base URI contains a ? character there is no workaround that allows using such endpoint.&lt;br/&gt;
Changed the priority back to Major.&lt;/p&gt;</comment>
                            <comment id="14954920" author="mvlakh" created="Tue, 13 Oct 2015 13:24:10 +0000"  >&lt;p&gt;By the way, I think a fix for this issue should also resolve the problem with URI parameters and with it in place we won&apos;t need to use the RAW() wrapper any longer.&lt;/p&gt;</comment>
                            <comment id="14954956" author="davsclaus" created="Tue, 13 Oct 2015 13:56:50 +0000"  >&lt;p&gt;Do not use &amp;amp; in directory names that is a bad practice.&lt;/p&gt;</comment>
                            <comment id="14956436" author="mvlakh" created="Wed, 14 Oct 2015 07:41:14 +0000"  >&lt;p&gt;Great advice but this is not a solution of the problem that affects many components, not just File.&lt;/p&gt;</comment>
                            <comment id="14961787" author="davsclaus" created="Sat, 17 Oct 2015 06:56:34 +0000"  >&lt;p&gt;We can relax the check about &amp;amp; in the context-path so you can use &amp;amp; in the file endpoint. &lt;/p&gt;</comment>
                            <comment id="14961796" author="davsclaus" created="Sat, 17 Oct 2015 07:48:37 +0000"  >&lt;p&gt;Relax uri validation check so &amp;amp; without ? is allowed&lt;/p&gt;</comment>
                            <comment id="14962966" author="mvlakh" created="Mon, 19 Oct 2015 07:36:11 +0000"  >&lt;p&gt;Thank you for a quick fix, but what about &quot;?&quot; character in base URI?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mxtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>