<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:08:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8688] Removed StreamCache when doing a Wiretap</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8688</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I noticed a bug where the body (StreamCache) was already removed before the exchange reached the end (in the Wiretap route).&lt;/p&gt;

&lt;p&gt;I added a test as an attachment.&lt;/p&gt;

&lt;p&gt;f you run the test you can clearly see the temp file deletion followed by the closed stream exception:&lt;/p&gt;

&lt;p&gt;Tried 1 to delete file: /var/folders/db/brq60fqj4vb8mnx_5nlz36nw0000gn/T/camel/camel-tmp-00cd1ce2-7d44-47fe-b357-008e8146f770/cos8797132745923044996.tmp with result: true&lt;/p&gt;

&lt;p&gt;Cannot reset stream from file /var/folders/db/brq60fqj4vb8mnx_5nlz36nw0000gn/T/camel/camel-tmp-00cd1ce2-7d44-47fe-b357-008e8146f770/cos8797132745923044996.tmp&lt;/p&gt;

&lt;p&gt;I encountered the same issue during a more complex route that does some splitting (zip file) and multicasting. This occurred on Camel 2.14.1 so it could be fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8284&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8284&lt;/a&gt; but I need to test this.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Geert&lt;/p&gt;</description>
                <environment></environment>
        <key id="12823390">CAMEL-8688</key>
            <summary>Removed StreamCache when doing a Wiretap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="geertvanheusden">Geert Vanheusden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Apr 2015 12:02:10 +0000</created>
                <updated>Mon, 4 May 2015 18:00:05 +0000</updated>
                            <resolved>Mon, 4 May 2015 18:00:05 +0000</resolved>
                                    <version>2.15.1</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14508940" author="geertvanheusden" created="Thu, 23 Apr 2015 12:07:04 +0000"  >&lt;p&gt;Solution proposal by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=forsthofer&quot; class=&quot;user-hover&quot; rel=&quot;forsthofer&quot;&gt;forsthofer&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;My original proposal to copy the stream cache file is not the optimal &lt;br/&gt;
solution. A better solution would be to have only one stream cache &lt;br/&gt;
file and to delete this file only when all exchanges which need this &lt;br/&gt;
file are done. This does mean we have to register listeners to the &lt;br/&gt;
event onDone of all UnitOfWorks of the relevant exchanges in the &lt;br/&gt;
stream cache file object and only when all listeners have got the &lt;br/&gt;
onDone event, then the file can be deleted.  However this will require &lt;br/&gt;
quite some changes &lt;/p&gt;

&lt;p&gt;Probably we could also use this solution for the agregator and splitter case.. &lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14523004" author="forsthofer" created="Fri, 1 May 2015 10:05:09 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I am working on a patch.&lt;br/&gt;
Regards Franz&lt;/p&gt;</comment>
                            <comment id="14523160" author="forsthofer" created="Fri, 1 May 2015 13:02:16 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Here is the patch. It consists of two files. One for camel-core and one for camel-netty-http.&lt;/p&gt;

&lt;p&gt;I had to change the clone() method in the interface StreamCache to&lt;/p&gt;

&lt;p&gt;StreamCache clone(Exchange exchange)&lt;/p&gt;

&lt;p&gt;because I needed to count the exchanges which are relevant for the cached file.&lt;/p&gt;

&lt;p&gt;Regards Franz Forsthofer&lt;br/&gt;
SAP SE&lt;br/&gt;
e-mail: franz.forsthofer@sap.com&lt;/p&gt;</comment>
                            <comment id="14526947" author="davsclaus" created="Mon, 4 May 2015 18:00:05 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;There we are few other components where the copy needed to be adjusted. But its all sorted now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12729758" name="0001-wire-tap-streaming-problem-camel-core.patch" size="33643" author="forsthofer" created="Fri, 1 May 2015 13:02:16 +0000"/>
                            <attachment id="12727595" name="WireTapTest.java" size="1540" author="geertvanheusden" created="Thu, 23 Apr 2015 12:04:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://camel.465427.n5.nabble.com/Closed-removed-StreamCache-when-doing-a-Wiretap-td5765977.html]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dno7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>