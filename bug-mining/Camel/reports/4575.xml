<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:30:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12624] ActiveMQ Artemis AMQP integration issue with topic prefix hardcode</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12624</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Currently we are running Camel AMQP component against Active MQ 5 (Amazon MQ) we want to move to an Artemis solution but this hasn&apos;t worked seamlessly.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-9204&quot; title=&quot;Provide AMQP component factory method for AMQP 1.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-9204&quot;&gt;&lt;del&gt;CAMEL-9204&lt;/del&gt;&lt;/a&gt;&#160;I believe a hardcoded topic prefix of &quot;topic://&quot; was introduced I think for a workaround of an Active MQ 5 bug.&#160;&lt;/p&gt;

&lt;p&gt;In Artemis this means Camel connects to a topic named &quot;topic://example.topic.event&quot; instead of &quot;example.topic.event&quot; and therefore receives no events.&lt;/p&gt;

&lt;p&gt;The only possible workaround is to manually create the connection factory which means then the topic prefix is not set.&#160;&lt;/p&gt;

&lt;p&gt;My believe is that the hardcoded topic prefix is a bug and should be removed or an option to override at the AMQP component level should be introduced.&lt;/p&gt;

&lt;p&gt;Bug location: AMQPComponent.java line 59&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doStart() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    Set&amp;lt;AMQPConnectionDetails&amp;gt; connectionDetails = getCamelContext().getRegistry().findByType(AMQPConnectionDetails.class);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionDetails.size() == 1) {
        AMQPConnectionDetails details = connectionDetails.iterator().next();
        JmsConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JmsConnectionFactory(details.username(), details.password(), details.uri());
        connectionFactory.setTopicPrefix(&lt;span class=&quot;code-quote&quot;&gt;&quot;topic:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt;);
&lt;/span&gt;        setConnectionFactory(connectionFactory);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.doStart();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Workaround:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Bean
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ConnectionFactory amqpConnectionFactory() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JmsConnectionFactory(username, password, url);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13170139">CAMEL-12624</key>
            <summary>ActiveMQ Artemis AMQP integration issue with topic prefix hardcode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmvolod">Dmitry Volodin</assignee>
                                    <reporter username="open_matt_nz">Matt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jul 2018 21:44:12 +0000</created>
                <updated>Wed, 18 Jul 2018 03:44:00 +0000</updated>
                            <resolved>Fri, 13 Jul 2018 15:29:16 +0000</resolved>
                                    <version>2.21.1</version>
                                    <fixVersion>2.21.2</fixVersion>
                    <fixVersion>2.22.1</fixVersion>
                    <fixVersion>2.23.0</fixVersion>
                                    <component>camel-amqp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16542844" author="dmvolod" created="Fri, 13 Jul 2018 10:21:39 +0000"  >&lt;p&gt;hardcoded topic prefix is not a bug and need for backward compatibility with ActiveMQ 5.&lt;/p&gt;

&lt;p&gt;Yes, it&apos;s possible to add property to the AMQPConnectionDetails which will skip setTopicPrefix if needed.&lt;/p&gt;</comment>
                            <comment id="16543308" author="githubbot" created="Fri, 13 Jul 2018 15:00:29 +0000"  >&lt;p&gt;dmvolod opened a new pull request #2425: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12624&quot; title=&quot;ActiveMQ Artemis AMQP integration issue with topic prefix hardcode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12624&quot;&gt;&lt;del&gt;CAMEL-12624&lt;/del&gt;&lt;/a&gt;: ActiveMQ Artemis AMQP integration issue with topic prefix hardcoded&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   hardcode&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16543309" author="githubbot" created="Fri, 13 Jul 2018 15:00:30 +0000"  >&lt;p&gt;GitHub user dmvolod opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12624&quot; title=&quot;ActiveMQ Artemis AMQP integration issue with topic prefix hardcode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12624&quot;&gt;&lt;del&gt;CAMEL-12624&lt;/del&gt;&lt;/a&gt;: ActiveMQ Artemis AMQP integration issue with topic prefix hardcoded&lt;/p&gt;

&lt;p&gt;    hardcode&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dmvolod/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dmvolod/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12624&quot; title=&quot;ActiveMQ Artemis AMQP integration issue with topic prefix hardcode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12624&quot;&gt;&lt;del&gt;CAMEL-12624&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2425.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2425&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16543330" author="githubbot" created="Fri, 13 Jul 2018 15:19:12 +0000"  >&lt;p&gt;dmvolod commented on issue #2425: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12624&quot; title=&quot;ActiveMQ Artemis AMQP integration issue with topic prefix hardcode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12624&quot;&gt;&lt;del&gt;CAMEL-12624&lt;/del&gt;&lt;/a&gt;: ActiveMQ Artemis AMQP integration issue with topic prefix hardcoded&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2425#issuecomment-404864833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425#issuecomment-404864833&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks, @oscerd . Merged.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16543331" author="githubbot" created="Fri, 13 Jul 2018 15:19:12 +0000"  >&lt;p&gt;dmvolod closed pull request #2425: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12624&quot; title=&quot;ActiveMQ Artemis AMQP integration issue with topic prefix hardcode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12624&quot;&gt;&lt;del&gt;CAMEL-12624&lt;/del&gt;&lt;/a&gt;: ActiveMQ Artemis AMQP integration issue with topic prefix hardcoded&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-amqp/pom.xml b/components/camel-amqp/pom.xml&lt;br/&gt;
index 28e85b0e000..92b3bf2fd15 100644&lt;br/&gt;
&amp;#8212; a/components/camel-amqp/pom.xml&lt;br/&gt;
+++ b/components/camel-amqp/pom.xml&lt;br/&gt;
@@ -96,6 +96,18 @@&lt;br/&gt;
       &amp;lt;artifactId&amp;gt;activemq-broker&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
       &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
     &amp;lt;/dependency&amp;gt;&lt;br/&gt;
+    &amp;lt;dependency&amp;gt;&lt;br/&gt;
+      &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;&lt;br/&gt;
+      &amp;lt;artifactId&amp;gt;artemis-server&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
+      &amp;lt;version&amp;gt;${activemq-artemis-version}&amp;lt;/version&amp;gt;&lt;br/&gt;
+      &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
+    &amp;lt;/dependency&amp;gt;&lt;br/&gt;
+    &amp;lt;dependency&amp;gt;&lt;br/&gt;
+      &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;&lt;br/&gt;
+      &amp;lt;artifactId&amp;gt;artemis-amqp-protocol&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
+      &amp;lt;version&amp;gt;${activemq-artemis-version}&amp;lt;/version&amp;gt;&lt;br/&gt;
+      &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
+    &amp;lt;/dependency&amp;gt;&lt;br/&gt;
     &amp;lt;dependency&amp;gt;&lt;br/&gt;
       &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;&lt;br/&gt;
       &amp;lt;artifactId&amp;gt;activemq-amqp&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
diff --git a/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPComponent.java b/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPComponent.java&lt;br/&gt;
index 43aebab1d86..cc1bda660bb 100644&lt;br/&gt;
&amp;#8212; a/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPComponent.java&lt;br/&gt;
+++ b/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPComponent.java&lt;br/&gt;
@@ -56,7 +56,9 @@ protected void doStart() throws Exception {&lt;br/&gt;
         if (connectionDetails.size() == 1) {&lt;br/&gt;
             AMQPConnectionDetails details = connectionDetails.iterator().next();&lt;br/&gt;
             JmsConnectionFactory connectionFactory = new JmsConnectionFactory(details.username(), details.password(), details.uri());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;connectionFactory.setTopicPrefix(&quot;topic://&quot;);&lt;br/&gt;
+            if (details.setTopicPrefix()) 
{
+                connectionFactory.setTopicPrefix(&quot;topic://&quot;);
+            }
&lt;p&gt;             setConnectionFactory(connectionFactory);&lt;br/&gt;
         }&lt;br/&gt;
         super.doStart();&lt;br/&gt;
diff --git a/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPConnectionDetails.java b/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPConnectionDetails.java&lt;br/&gt;
index 029e17b781b..66732e6c1f9 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPConnectionDetails.java&lt;br/&gt;
+++ b/components/camel-amqp/src/main/java/org/apache/camel/component/amqp/AMQPConnectionDetails.java&lt;br/&gt;
@@ -28,17 +28,29 @@&lt;br/&gt;
     public static final String AMQP_USERNAME = &quot;AMQP_SERVICE_USERNAME&quot;;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     public static final String AMQP_PASSWORD = &quot;AMQP_SERVICE_PASSWORD&quot;;&lt;br/&gt;
+    &lt;br/&gt;
+    public static final String AMQP_SET_TOPIC_PREFIX = &quot;AMQP_SET_TOPIC_PREFIX&quot;;&lt;/p&gt;

&lt;p&gt;     private final String uri;&lt;/p&gt;

&lt;p&gt;     private final String username;&lt;/p&gt;

&lt;p&gt;     private final String password;&lt;br/&gt;
+    &lt;br/&gt;
+    private final boolean setTopicPrefix;&lt;/p&gt;

&lt;p&gt;     public AMQPConnectionDetails(String uri, String username, String password) &lt;/p&gt;
{
         this.uri = uri;
         this.username = username;
         this.password = password;
+        this.setTopicPrefix = true; 
+    }
&lt;p&gt;+    &lt;br/&gt;
+    public AMQPConnectionDetails(String uri, String username, String password, boolean setTopicPrefix) &lt;/p&gt;
{
+        this.uri = uri;
+        this.username = username;
+        this.password = password;
+        this.setTopicPrefix = setTopicPrefix;
     }

&lt;p&gt;     public AMQPConnectionDetails(String uri) {&lt;br/&gt;
@@ -53,8 +65,9 @@ public static AMQPConnectionDetails discoverAMQP(CamelContext camelContext) &lt;/p&gt;
{
             int port = Integer.parseInt(property(propertiesComponent, AMQP_PORT, &quot;5672&quot;));
             String username = property(propertiesComponent, AMQP_USERNAME, null);
             String password = property(propertiesComponent, AMQP_PASSWORD, null);
+            boolean setTopicPrefix = Boolean.parseBoolean(property(propertiesComponent, AMQP_SET_TOPIC_PREFIX, &quot;true&quot;));
 
-            return new AMQPConnectionDetails(&quot;amqp://&quot; + host + &quot;:&quot; + port, username, password);
+            return new AMQPConnectionDetails(&quot;amqp://&quot; + host + &quot;:&quot; + port, username, password, setTopicPrefix);
         }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
             throw new RuntimeException(e);
         }
&lt;p&gt;@@ -71,6 +84,10 @@ public String username() {&lt;br/&gt;
     public String password() &lt;/p&gt;
{
         return password;
     }
&lt;p&gt;+    &lt;br/&gt;
+    public boolean setTopicPrefix() &lt;/p&gt;
{
+        return setTopicPrefix;
+    }

&lt;p&gt;     // Helpers&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-amqp/src/test/java/org/apache/camel/component/amqp/artemis/AMQPEmbeddedBrokerTest.java b/components/camel-amqp/src/test/java/org/apache/camel/component/amqp/artemis/AMQPEmbeddedBrokerTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..563aa466735&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/components/camel-amqp/src/test/java/org/apache/camel/component/amqp/artemis/AMQPEmbeddedBrokerTest.java&lt;br/&gt;
@@ -0,0 +1,117 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *      &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.camel.component.amqp.artemis;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.activemq.artemis.api.core.RoutingType;&lt;br/&gt;
+import org.apache.activemq.artemis.core.config.Configuration;&lt;br/&gt;
+import org.apache.activemq.artemis.core.config.CoreAddressConfiguration;&lt;br/&gt;
+import org.apache.activemq.artemis.core.config.impl.ConfigurationImpl;&lt;br/&gt;
+import org.apache.activemq.artemis.core.server.embedded.EmbeddedActiveMQ;&lt;br/&gt;
+import org.apache.activemq.artemis.core.settings.impl.AddressSettings;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.camel.CamelContext;&lt;br/&gt;
+import org.apache.camel.EndpointInject;&lt;br/&gt;
+import org.apache.camel.builder.RouteBuilder;&lt;br/&gt;
+import org.apache.camel.component.amqp.AMQPComponent;&lt;br/&gt;
+import org.apache.camel.component.mock.MockEndpoint;&lt;br/&gt;
+import org.apache.camel.impl.JndiRegistry;&lt;br/&gt;
+import org.apache.camel.impl.PropertyPlaceholderDelegateRegistry;&lt;br/&gt;
+import org.apache.camel.test.AvailablePortFinder;&lt;br/&gt;
+import org.apache.camel.test.junit4.CamelTestSupport;&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import static org.apache.camel.component.amqp.AMQPConnectionDetails.AMQP_PORT;&lt;br/&gt;
+import static org.apache.camel.component.amqp.AMQPConnectionDetails.AMQP_SET_TOPIC_PREFIX;&lt;br/&gt;
+import static org.apache.camel.component.amqp.AMQPConnectionDetails.discoverAMQP;&lt;br/&gt;
+&lt;br/&gt;
+public class AMQPEmbeddedBrokerTest extends CamelTestSupport {&lt;br/&gt;
+    &lt;br/&gt;
+    static int amqpPort = AvailablePortFinder.getNextAvailable();&lt;br/&gt;
+    &lt;br/&gt;
+    static EmbeddedActiveMQ server = new EmbeddedActiveMQ();&lt;br/&gt;
+    &lt;br/&gt;
+    @EndpointInject(uri = &quot;mock:result&quot;)&lt;br/&gt;
+    MockEndpoint resultEndpoint;&lt;br/&gt;
+&lt;br/&gt;
+    String expectedBody = &quot;Hello there!&quot;;&lt;br/&gt;
+&lt;br/&gt;
+    @BeforeClass&lt;br/&gt;
+    public static void beforeClass() throws Exception &lt;/p&gt;
{
+        Configuration config = new ConfigurationImpl();
+        AddressSettings addressSettings = new AddressSettings();
+        // Disable auto create address to make sure that topic name is correct without prefix
+        addressSettings.setAutoCreateAddresses(false);
+        config.addAcceptorConfiguration(&quot;amqp&quot;, &quot;tcp://0.0.0.0:&quot; + amqpPort 
+                                        + &quot;?tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;protocols=AMQP;useEpoll=true;amqpCredits=1000;amqpMinCredits=300&quot;);
+        config.setPersistenceEnabled(false);
+        config.addAddressesSetting(&quot;#&quot;, addressSettings);
+        config.setSecurityEnabled(false);
+        
+        // Set explicit topic name
+        CoreAddressConfiguration pingTopicConfig = new CoreAddressConfiguration();
+        pingTopicConfig.setName(&quot;topic.ping&quot;);
+        pingTopicConfig.addRoutingType(RoutingType.MULTICAST);
+        
+        config.addAddressConfiguration(pingTopicConfig);
+        
+        server.setConfiguration(config);
+        server.start();
+        System.setProperty(AMQP_PORT, amqpPort + &quot;&quot;);
+        System.setProperty(AMQP_SET_TOPIC_PREFIX, &quot;false&quot;);
+    }
&lt;p&gt;+&lt;br/&gt;
+    @AfterClass&lt;br/&gt;
+    public static void afterClass() throws Exception &lt;/p&gt;
{
+        server.stop();
+    }
&lt;p&gt;+    &lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testTopicWithoutPrefix() throws Exception &lt;/p&gt;
{
+        resultEndpoint.expectedMessageCount(1);
+        template.sendBody(&quot;direct:send-topic&quot;, expectedBody);
+        resultEndpoint.assertIsSatisfied();
+    }
&lt;p&gt;+    &lt;br/&gt;
+    @Override&lt;br/&gt;
+    protected JndiRegistry createRegistry() throws Exception &lt;/p&gt;
{
+        JndiRegistry registry = super.createRegistry();
+        return registry;
+    }
&lt;p&gt;+&lt;br/&gt;
+    protected CamelContext createCamelContext() throws Exception &lt;/p&gt;
{
+        CamelContext camelContext = super.createCamelContext();
+        JndiRegistry registry = (JndiRegistry)((PropertyPlaceholderDelegateRegistry)camelContext.getRegistry()).getRegistry();
+        registry.bind(&quot;amqpConnection&quot;, discoverAMQP(camelContext));
+        camelContext.addComponent(&quot;amqp-customized&quot;, new AMQPComponent());
+        return camelContext;
+    }
&lt;p&gt;+    &lt;br/&gt;
+    protected RouteBuilder createRouteBuilder() throws Exception {&lt;br/&gt;
+        return new RouteBuilder() {&lt;br/&gt;
+            public void configure() throws Exception &lt;/p&gt;
{
+                from(&quot;direct:send-topic&quot;)
+                    .to(&quot;amqp-customized:topic:topic.ping&quot;);
+                
+                from(&quot;amqp-customized:topic:topic.ping&quot;)
+                    .to(&quot;log:routing&quot;)
+                    .to(&quot;mock:result&quot;);
+            }
&lt;p&gt;+        };&lt;br/&gt;
+    }&lt;br/&gt;
+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16543332" author="githubbot" created="Fri, 13 Jul 2018 15:19:13 +0000"  >&lt;p&gt;Github user dmvolod closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16547339" author="open_matt_nz" created="Wed, 18 Jul 2018 03:44:00 +0000"  >&lt;p&gt;Thanks for the quick action &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvolod&quot; class=&quot;user-hover&quot; rel=&quot;dmvolod&quot;&gt;dmvolod&lt;/a&gt;. I do believe newer versions of Active MQ no longer need the topic prefix but agree that maintaining backwards compatibility is on balance more important than a seamless experience with the Artemis replacement.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vjyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>