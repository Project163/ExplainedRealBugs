<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:35:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13630] KafkaProducer is force closed on karaf</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13630</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;We are working on transport project that based on&#160;karaf, camel, kafka and etc.&lt;/p&gt;

&lt;p&gt;Recently we&#160;bumped into a bug that doesn&apos;t allow&#160;keep on it. I debugged it and saw that the &quot;sender&quot; is always force-closed.&lt;/p&gt;

&lt;p&gt;I will try to explain to reproduce it by simple example:&lt;/p&gt;

&lt;p&gt;1) We use a following blueprint:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&amp;lt;blueprint xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
xsi:schemaLocation=&quot;
http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&quot;&amp;gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;DirectToKafka&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;timer://foo?fixedRate=true&amp;amp;amp;period=5000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;setBody&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;simple&amp;gt;&lt;/span&gt;Hello from Karaf Camel!&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/simple&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/setBody&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;${in.body}&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;setHeader headerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.PARTITION_KEY&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;simple&amp;gt;&lt;/span&gt;0&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/simple&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/setHeader&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;setHeader headerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.KEY&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;simple&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/simple&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/setHeader&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka:myTopic?brokers=localhost:9092&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;${headers}&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/route&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/camelContext&amp;gt;&lt;/span&gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/blueprint&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;2) The issue log is attached (&quot;issue.log&quot;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you please provide some information&#160;to fix the issue?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</description>
                <environment>&lt;p&gt;&#160;- MacBook Pro&#160;&lt;/p&gt;

&lt;p&gt;&#160;- MacOS&#160;10.13.6&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;kafka&#160;kafka_2.11-2.2.0&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;- apache-karaf-4.2.5&lt;/p&gt;

&lt;p&gt;installed features in karaf&lt;/p&gt;

&lt;p&gt;feature:install webconsole&lt;br/&gt;
 feature:repo-add camel 3.0.0-M3&lt;br/&gt;
 feature:install camel&lt;br/&gt;
 feature:install camel-blueprint&lt;br/&gt;
 feature:install deployer&lt;br/&gt;
 feature:install aries-blueprint&lt;br/&gt;
 feature:repo-add hawtio 2.6.0&lt;br/&gt;
 install mvn:org.apache.commons/commons-lang3/3.9&lt;br/&gt;
 feature:install camel-sql&lt;br/&gt;
 feature:install camel-jdbc&lt;br/&gt;
 feature:install pax-jdbc-postgresql&lt;br/&gt;
 install -s wrap:mvn:org.postgresql/postgresql/42.2.5&lt;br/&gt;
 feature:install camel-jaxb&lt;br/&gt;
 feature:install camel-servlet&lt;br/&gt;
 feature:install war&lt;/p&gt;

&lt;p&gt;feature:install camel-kafka&lt;/p&gt;</environment>
        <key id="13238417">CAMEL-13630</key>
            <summary>KafkaProducer is force closed on karaf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="turtle">Yeldar</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Jun 2019 17:42:58 +0000</created>
                <updated>Mon, 6 Jan 2020 08:49:56 +0000</updated>
                            <resolved>Mon, 6 Jan 2020 08:49:56 +0000</resolved>
                                    <version>3.0.0-M2</version>
                                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16859782" author="davsclaus" created="Mon, 10 Jun 2019 07:29:04 +0000"  >&lt;p&gt;Can you point out where you see that the producer is force closed&lt;/p&gt;</comment>
                            <comment id="16859819" author="turtle" created="Mon, 10 Jun 2019 08:30:34 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;When I debugged the source I found out that after installation a bundle (camel+kafka) on karaf&#160; server, a kafka-sender&#160;is initialized and&#160;method&#160;forceClose() is invoked&#160;after that.&lt;/p&gt;

&lt;p&gt;Class: org.apache.kafka.clients.producer.internals.Sender&lt;br/&gt;
 Method: forceClose()&lt;/p&gt;

&lt;p&gt;I tried on Camel 2.23.2 - all&apos;s good.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16859826" author="turtle" created="Mon, 10 Jun 2019 08:38:01 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;It&apos;s reproduced on 3.0.0-M2 and M3&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;</comment>
                            <comment id="16859927" author="davsclaus" created="Mon, 10 Jun 2019 11:10:03 +0000"  >&lt;p&gt;Well you need to debug and check logs on your system as it may be networking issues, or your remote kafka server not accepting messages or something else. I dont see a bug in Camel. &lt;/p&gt;</comment>
                            <comment id="16859962" author="turtle" created="Mon, 10 Jun 2019 12:19:35 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;I would like to describe about simple steps for reproduce (2 min):&lt;/p&gt;

&lt;p&gt;1) Before, I test my current environment, I was working on the project that use Camel 2.23.2 and all&apos;s good. I can produce and consume messages to and from Kafka. Karaf 4.2.5, Kafka&#160;kafka_2.11-2.2.0 and Zookeeper were started.&lt;/p&gt;

&lt;p&gt;2) I stoped just current karaf, unpack new karaf instance, started and install following features:&lt;/p&gt;

&lt;p&gt;feature:install webconsole&lt;br/&gt;
feature:repo-add camel 3.0.0-M3&lt;br/&gt;
feature:install camel&lt;br/&gt;
feature:install camel-blueprint&lt;br/&gt;
feature:install deployer&lt;br/&gt;
feature:install aries-blueprint&lt;br/&gt;
feature:install camel-kafka&lt;/p&gt;

&lt;p&gt;3) I&#160;copied file &quot;karaf-camel-kafka.xml&quot; into directory &quot;deploy&quot; of new karaf instance and got the issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m attaching the file&#160;&quot;karaf-camel-kafka.xml&quot; and karaf log.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12971328/12971328_karaf-camel-kafka.xml&quot; title=&quot;karaf-camel-kafka.xml attached to CAMEL-13630&quot;&gt;karaf-camel-kafka.xml&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12971329/12971329_karaf.log&quot; title=&quot;karaf.log attached to CAMEL-13630&quot;&gt;karaf.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;There is no issues with network, because it work for Camel 2.23.2 and doesn&apos;t work for Camel 3.0.0-M3 on my laptop.&lt;/p&gt;

&lt;p&gt;You can reproduce it on several minutes and if you need some additional information don&apos;t hesitate ask me.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16859991" author="ancosen" created="Mon, 10 Jun 2019 13:20:12 +0000"  >&lt;p&gt;I&apos;m able to reproduce this, even with only the camel and camel-kafka feature installed.&lt;/p&gt;</comment>
                            <comment id="16860035" author="davsclaus" created="Mon, 10 Jun 2019 14:22:58 +0000"  >&lt;p&gt;I wonder if this happens only on Karaf (eg OSGi) and its some OSGi classloading issues in newer kafka client JARs or something that is causing things to close/stop etc. Or can you even see this in a plain JUnit test? / standalone&lt;/p&gt;</comment>
                            <comment id="16860038" author="turtle" created="Mon, 10 Jun 2019 14:25:33 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;You can try above steps with Camel 2.23.2 and no issue will be happen.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16860039" author="ancosen" created="Mon, 10 Jun 2019 14:25:36 +0000"  >&lt;p&gt;Only on OSGi actually. Cannot reproduce in unit test.&lt;/p&gt;</comment>
                            <comment id="16860170" author="turtle" created="Mon, 10 Jun 2019 17:13:30 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;It&apos;s good news! I spent last weekend on&#160;detection a reason of that.&lt;/p&gt;

&lt;p&gt;Currently, I don&apos;t have any ideas, but will be glad to be aware of detection and assist if it necessary.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16950889" author="davsclaus" created="Mon, 14 Oct 2019 10:37:19 +0000"  >&lt;p&gt;Can anyone try with Camel 3 RC2&lt;/p&gt;</comment>
                            <comment id="17008073" author="fvaleri" created="Sat, 4 Jan 2020 16:10:27 +0000"  >&lt;p&gt;Hi, just tried with Camel 3.0.0 on Karaf 4.2.7 and it seems to work fine.&lt;br/&gt;
I&apos;m attaching the project that includes a small README with instructions.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
karaf@root()&amp;gt; camel:route-list 
 Context        Route           Status              Total #       Failed #     Inflight #   Uptime        
 -------        -----           ------              -------       --------     ----------   ------        
 camel-1        DirectToKafka   Started                  18              0              0   1 minute  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Retrieving some messages with console-consumer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic myTopic --max-messages 10
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Hello from Karaf Camel!
Processed a total of 10 messages
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12971273" name="issue.log" size="5410" author="turtle" created="Sun, 9 Jun 2019 17:39:21 +0000"/>
                            <attachment id="12971328" name="karaf-camel-kafka.xml" size="991" author="turtle" created="Mon, 10 Jun 2019 12:15:17 +0000"/>
                            <attachment id="12989936" name="karaf-kafka-producer.zip" size="3050" author="fvaleri" created="Sat, 4 Jan 2020 16:14:20 +0000"/>
                            <attachment id="12971329" name="karaf.log" size="79396" author="turtle" created="Mon, 10 Jun 2019 12:16:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03k5c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>