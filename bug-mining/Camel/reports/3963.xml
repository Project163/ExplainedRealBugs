<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:21:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10756] Mina2 Producer &quot;hang&quot; until timeout if the response message could not be decoded</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10756</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have tried to upgrade from camel 2.16 to 2.18 and run into an issue with camel-mina2. It looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10024&quot; title=&quot;Race condition in Mina2Producer/Mina2Consumer when closing connections with disconnect=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10024&quot;&gt;&lt;del&gt;CAMEL-10024&lt;/del&gt;&lt;/a&gt; has maybe introduced this issue.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The scenario which fail:&lt;/b&gt;&lt;br/&gt;
A Mina2 producer send a request to a server, the server provide a response which could not be interpreted/decoded by a custom codec on the producer side (e.g. due to invalid encoding).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected behavior:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The Exception from the decoder on the producer side will be directly propogated to the caller. The mina2 session will be closed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Current behavior:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Instead of the exception from the decoder, the producer wait until the timeout is reached and the caller get a timeout exception after the timeout is reached.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;First analysis:&lt;/b&gt;&lt;br/&gt;
I have attached a patch for the camel-mina2 module which contain a test &lt;tt&gt;org.apache.camel.component.mina2.Mina2CustomCodecTest.testProducerFailInDecodingResponse()&lt;/tt&gt; to reproduce this issue. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;If i revert the changes done within &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10024&quot; title=&quot;Race condition in Mina2Producer/Mina2Consumer when closing connections with disconnect=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10024&quot;&gt;&lt;del&gt;CAMEL-10024&lt;/del&gt;&lt;/a&gt;, the test run correct.&lt;/b&gt; If I debug into the new code, i see that the producer &quot;hang&quot; in &lt;tt&gt;Mina2Producer.closeSessionIfNeededAndAwaitCloseInHandler(IoSession)&lt;/tt&gt; &amp;#8211; &lt;tt&gt;closeLatch.await(timeout, TimeUnit.MILLISECONDS);&lt;/tt&gt; which was introduced with CAML-10024.&lt;/p&gt;

&lt;p&gt;I could not yet provide a fix as well, since I don&apos;t really understand the details of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10024&quot; title=&quot;Race condition in Mina2Producer/Mina2Consumer when closing connections with disconnect=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10024&quot;&gt;&lt;del&gt;CAMEL-10024&lt;/del&gt;&lt;/a&gt;. But hopefully my testcase helps to fix this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13038453">CAMEL-10756</key>
            <summary>Mina2 Producer &quot;hang&quot; until timeout if the response message could not be decoded</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="thopap">Thomas Papke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jan 2017 14:44:33 +0000</created>
                <updated>Tue, 7 Feb 2017 17:45:50 +0000</updated>
                            <resolved>Tue, 7 Feb 2017 17:45:50 +0000</resolved>
                                    <version>2.18.1</version>
                                    <fixVersion>2.17.6</fixVersion>
                    <fixVersion>2.18.3</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-mina2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15853816" author="anoordover" created="Mon, 6 Feb 2017 10:41:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10024&quot; title=&quot;Race condition in Mina2Producer/Mina2Consumer when closing connections with disconnect=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10024&quot;&gt;&lt;del&gt;CAMEL-10024&lt;/del&gt;&lt;/a&gt; was introduced to take care of the fact that producers were returned to the pool with an active CloseFuture.&lt;br/&gt;
When you reusing this producer the CloseFuture closed the session that was being used.&lt;br/&gt;
The Producer should wait for the handler to close the session.&lt;br/&gt;
I think the &quot;exceptionCaught&quot; method should not use the same closeSessionIfNeededAndAwaitCloseInHandler (because this method is already inside the handler).&lt;br/&gt;
awaiting the CloseFuture should be sufficient (I think/hope).&lt;br/&gt;
B.t.w. maybe the session should only be closed based on the &quot;disconnect&quot; setting.&lt;/p&gt;</comment>
                            <comment id="15854010" author="anoordover" created="Mon, 6 Feb 2017 13:47:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cibsen%40e-ma.net&quot; class=&quot;user-hover&quot; rel=&quot;cibsen@e-ma.net&quot;&gt;cibsen@e-ma.net&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt;: What do you think, should the session be closed on &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-mina2/src/main/java/org/apache/camel/component/mina2/Mina2Producer.java#L510?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-mina2/src/main/java/org/apache/camel/component/mina2/Mina2Producer.java#L510?&lt;/a&gt; My feeling is that the Producer itself should ask for the closing of the session based on the &quot;disconnect&quot; setting.&lt;/p&gt;</comment>
                            <comment id="15854171" author="thopap" created="Mon, 6 Feb 2017 15:03:41 +0000"  >&lt;p&gt;Just my two cents on this: I think closing the session in an mina internal error would make sense. E.g. If Mina receive UDP packages and of them is causing an session exception, further processing might make no sense. From my understandning the &quot;disconnect&quot; flag is intended in case i want to stop the session after valid processing the request.&lt;/p&gt;

&lt;p&gt;I have prepared a proposal which fix the test and switch back to a basic close connection behavior as suggested by Arno:&lt;br/&gt;
&lt;a href=&quot;https://github.com/Thopap/camel/commit/16d1f57640752d8c5a8fcace1299decc50176c46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Thopap/camel/commit/16d1f57640752d8c5a8fcace1299decc50176c46&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15854232" author="anoordover" created="Mon, 6 Feb 2017 15:48:14 +0000"  >&lt;p&gt;I&apos;m doubting about what the developers of mina would advise.&lt;br/&gt;
According to &lt;a href=&quot;https://mina.apache.org/mina-project/apidocs/org/apache/mina/core/service/IoHandler.html#exceptionCaught-org.apache.mina.core.session.IoSession-java.lang.Throwable-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mina.apache.org/mina-project/apidocs/org/apache/mina/core/service/IoHandler.html#exceptionCaught-org.apache.mina.core.session.IoSession-java.lang.Throwable-&lt;/a&gt; the connection is closed if the cause is an instance of IoException.&lt;br/&gt;
I think the &quot;producer&quot; should be in control of the closing of the session not the &quot;handler&quot;.&lt;br/&gt;
But still.. I think this solution will work given that exceptions should be exceptional.&lt;/p&gt;</comment>
                            <comment id="15854251" author="githubbot" created="Mon, 6 Feb 2017 15:58:56 +0000"  >&lt;p&gt;GitHub user Thopap opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1449&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10756&quot; title=&quot;Mina2 Producer &amp;quot;hang&amp;quot; until timeout if the response message could not be decoded&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10756&quot;&gt;&lt;del&gt;CAMEL-10756&lt;/del&gt;&lt;/a&gt;: Mina2 Producer &quot;hang&quot; until timeout if the response message could not be decoded&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/Thopap/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Thopap/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1449.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1449.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1449&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f37c5576fa32d499359d0aaeb4be5f8e3e8782fb&lt;br/&gt;
Author: Thomas Papke &amp;lt;thomas.papke@icw.de&amp;gt;&lt;br/&gt;
Date:   2017-01-30T15:49:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10765&quot; title=&quot;Remove unused oauth dependency from camel-cxf pom&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10765&quot;&gt;&lt;del&gt;CAMEL-10765&lt;/del&gt;&lt;/a&gt;: Remove unused oauth dependency from camel-cxf pom&lt;/p&gt;

&lt;p&gt;commit 16d1f57640752d8c5a8fcace1299decc50176c46&lt;br/&gt;
Author: Thomas Papke &amp;lt;thomas.papke@icw.de&amp;gt;&lt;br/&gt;
Date:   2017-02-06T12:32:47Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10756&quot; title=&quot;Mina2 Producer &amp;quot;hang&amp;quot; until timeout if the response message could not be decoded&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10756&quot;&gt;&lt;del&gt;CAMEL-10756&lt;/del&gt;&lt;/a&gt; Mina2 Producer &quot;hang&quot; until timeout if the response message&lt;br/&gt;
    could not be decoded&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adapt exception caught&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit 833468d4ddd886ecc66b5ce0950e60f2806fc252&lt;br/&gt;
Author: Thopap &amp;lt;thomas.papke@icw.de&amp;gt;&lt;br/&gt;
Date:   2017-02-06T15:50:54Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;origin/master&apos;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15856396" author="githubbot" created="Tue, 7 Feb 2017 17:45:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1449&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15856398" author="davsclaus" created="Tue, 7 Feb 2017 17:45:50 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12976333">CAMEL-10024</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12849700" name="camel_mina2.patch" size="4670" author="thopap" created="Fri, 27 Jan 2017 14:45:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39avz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>