<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:53:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-4857] Endpoint URI normalization: information in path is lost</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-4857</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A project with a test case is here: &lt;a href=&quot;https://github.com/alaz/camel290_uri&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/alaz/camel290_uri&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The test case with the problem description (the problem occured during migration of camel-beanstalk &lt;a href=&quot;https://github.com/osinka/camel-beanstalk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/osinka/camel-beanstalk&lt;/a&gt; component onto 2.9.0):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;UriTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; camel290.uri;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Consumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Endpoint;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Processor;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Producer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.impl.DefaultComponent;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.impl.DefaultEndpoint;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.test.CamelTestSupport;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Before;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.Assert.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;UriTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

  /**
   * An URI of Camel Beanstalk component consists of a hostname, port and a list
   * of tube names. Tube names are separated by &lt;span class=&quot;code-quote&quot;&gt;&quot;+&quot;&lt;/span&gt; character (which is more or less
   * usualy used on the Web to make lists), but every tube name may contain URI special
   * characters like ? or +
   */

  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyEndpoint &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DefaultEndpoint {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; remaining = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MyEndpoint(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; remaining) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.uri = uri;
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.remaining = remaining;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Producer createProducer() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Not supported yet.&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Consumer createConsumer(Processor prcsr) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Not supported yet.&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isSingleton() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
  }

  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyComponent &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DefaultComponent {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Endpoint createEndpoint(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; remaining, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; parameters) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyEndpoint(uri, remaining);
    }
  }

  @Before
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setUp() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setUp();
    context.addComponent(&lt;span class=&quot;code-quote&quot;&gt;&quot;my&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyComponent());
  }

  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testExclamationInUri() {
    /**
     * %3F is not an ?, it&apos;s part of tube name.
     */
    MyEndpoint endpoint = context.getEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;my:host:11303/tube1+tube%2B+tube%3F&quot;&lt;/span&gt;, MyEndpoint.class);
    assertNotNull(&lt;span class=&quot;code-quote&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;, endpoint);
  }

  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testPath() {
    /**
     * Here a tube name is &lt;span class=&quot;code-quote&quot;&gt;&quot;tube+&quot;&lt;/span&gt; and written in URI as &lt;span class=&quot;code-quote&quot;&gt;&quot;tube%2B&quot;&lt;/span&gt;, but it gets
     * normalized, so that an endpoint sees &lt;span class=&quot;code-quote&quot;&gt;&quot;tube1+tube+&quot;&lt;/span&gt;
     */
    MyEndpoint endpoint = context.getEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;my:host:11303/tube1+tube%2B&quot;&lt;/span&gt;, MyEndpoint.class);
    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Path contains several tube names, every tube name may have + or ? characters&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;host:11303/tube1+tube%2B&quot;&lt;/span&gt;, endpoint.remaining);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </description>
                <environment></environment>
        <key id="12537080">CAMEL-4857</key>
            <summary>Endpoint URI normalization: information in path is lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="azarov">Alexander Azarov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jan 2012 17:08:22 +0000</created>
                <updated>Thu, 2 May 2013 02:29:56 +0000</updated>
                            <resolved>Tue, 25 Sep 2012 06:48:43 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13179353" author="njiang" created="Wed, 4 Jan 2012 08:55:14 +0000"  >&lt;p&gt;The issue is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4425&quot; title=&quot;Cleanup usage of improper URIs in Camel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4425&quot;&gt;&lt;del&gt;CAMEL-4425&lt;/del&gt;&lt;/a&gt;, now camel is try to turn the encoded uri string to be a normalized one. That is why the &quot;%2B&quot; is changed to &quot;+&quot;, &quot;%3F&quot; is changed to &quot;?&quot; at the end.&lt;/p&gt;

&lt;p&gt;It think we need to find a way to resolve the issue of using unsafe uri code in camel uri. &lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;
</comment>
                            <comment id="13188948" author="davsclaus" created="Thu, 19 Jan 2012 06:33:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4256&quot; title=&quot;Adding a EndpointConfiguration interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4256&quot;&gt;&lt;del&gt;CAMEL-4256&lt;/del&gt;&lt;/a&gt; is the real cause. It is too restrictive in terms of URI flexibility. We need to open up this so the component writers have the power back again, and can totally decide how to handle uri&apos;s in their components.&lt;/p&gt;</comment>
                            <comment id="13188982" author="davsclaus" created="Thu, 19 Jan 2012 08:05:43 +0000"  >&lt;p&gt;I noticed that &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4256&quot; title=&quot;Adding a EndpointConfiguration interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4256&quot;&gt;&lt;del&gt;CAMEL-4256&lt;/del&gt;&lt;/a&gt; or thereabouts also broke some previous URI validation. For example we have a check for double ampersand, that is now being normalized into an empty parameter &quot;&quot; -&amp;gt; null. &lt;/p&gt;</comment>
                            <comment id="13288831" author="hadrian" created="Mon, 4 Jun 2012 19:18:31 +0000"  >&lt;p&gt;I beg to differ.&lt;/p&gt;

&lt;p&gt;The question is not if Camel is too restrictive, but rather if camel uses URIs or not. What a URI is and isn&apos;t is clearly defined by a spec. The changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4256&quot; title=&quot;Adding a EndpointConfiguration interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4256&quot;&gt;&lt;del&gt;CAMEL-4256&lt;/del&gt;&lt;/a&gt; were intended to still support the invalid uris we now use in Camel and provide a migration path for 3.0. If some scenarios were missed, that can be fixed.&lt;/p&gt;

&lt;p&gt;However the question still remains, does Camel use URIs or not? Today, I wouldn&apos;t know how to define the concept of URI flexibility. I totally agree that that component writers should have complete control on how to handle URIs but those should be URIs to start with. That&apos;s not the case today, is it?&lt;/p&gt;</comment>
                            <comment id="13288900" author="bvahdat" created="Mon, 4 Jun 2012 21:01:49 +0000"  >&lt;p&gt;IMHO the &lt;b&gt;CORE&lt;/b&gt; question should not be if Camel uses URIs correctly or not but more important than that if Camel is &lt;b&gt;REALLY&lt;/b&gt; 100% backward-compatible by it&apos;s minor releases which to my understanding is much much more important than to be 100% IETF RFC_XYZ complaint.&lt;/p&gt;

&lt;p&gt;In this concrete case the user reporting this issue (on Jan. 3rd) was struggling to upgrade to a newer Camel version a day before (on Jan. 2nd) which then ended up with:&lt;br/&gt;
&lt;a href=&quot;https://plus.google.com/103504600126086444972/posts/5q1aFtYLryi&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://plus.google.com/103504600126086444972/posts/5q1aFtYLryi&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;@Alexander please correct me if I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;Anyway, I think this&apos;s really sad &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13288937" author="hadrian" created="Mon, 4 Jun 2012 21:51:14 +0000"  >&lt;p&gt;@Babak,&lt;/p&gt;

&lt;p&gt;Although we never were 100% backward compatible in minor releases, the intent is to be 100% backwards compatible. The incompatibility only crept in, I believe, because there are no unit tests for enough variations of URIs. When the changes got committed all the tests passed and it&apos;s not like existing tests were deleted or we introduced incompatibilities on purpose. We do strive to be 100% backwards compatible on patch releases though and we are, with very rare exceptions.&lt;/p&gt;

&lt;p&gt;I was the one publishing that release, and believe it or not, vanity wasn&apos;t among the reasons. Sad? Maybe. I have a long list myself. &lt;/p&gt;

&lt;p&gt;That said, I totally agree that the the camel-core should be more stable and less incompatibilities should be introduced on minor releases. We can discuss on dev@ if and how this could be achieved.&lt;/p&gt;</comment>
                            <comment id="13289213" author="azarov" created="Tue, 5 Jun 2012 07:30:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bvahdat&quot; class=&quot;user-hover&quot; rel=&quot;bvahdat&quot;&gt;bvahdat&lt;/a&gt;, please do not build your proofs based on my old emotions. In the end of a day, I&apos;m rational in my decisions.&lt;/p&gt;

&lt;p&gt;I perfectly understand every release may bring some bugs. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hadrian&quot; class=&quot;user-hover&quot; rel=&quot;hadrian&quot;&gt;hadrian&lt;/a&gt; explains there were incomplete test coverage of URIs.&lt;/p&gt;

&lt;p&gt;I still wonder why no Camel users have been affected by the same issue, since URI is the main transport of transmitting settings into Camel components. Anyway (a) the number of camel-beanstalk component users is very small and no one complained; (b) the number of voters/watchers of this issue shows no significant interest. Hence, if nobody needs it, it seems logical to postpone the fix.&lt;/p&gt;</comment>
                            <comment id="13289272" author="bvahdat" created="Tue, 5 Jun 2012 09:14:11 +0000"  >&lt;p&gt;@Alexander I&apos;m absolutely aware of the fact that through providing that link I did abash you, I&apos;m REALLY sorry for that and please accept my apologies  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;However my ONLY INTENTION was to show how frustrating an update could be, that&apos;s it! IMHO we had better postponed these URI issues and discussions for the Camel 3 roadmap to AVOID taking any risks and also breaking the existing behaviour given through the minor releases.&lt;/p&gt;</comment>
                            <comment id="13291365" author="muellerc" created="Thu, 7 Jun 2012 22:04:19 +0000"  >&lt;p&gt;I will go through this until end of this week...&lt;/p&gt;</comment>
                            <comment id="13455722" author="davsclaus" created="Fri, 14 Sep 2012 10:57:22 +0000"  >&lt;p&gt;A patch which allows component writers to control if the uri should be raw or encoded (default as now). &lt;/p&gt;</comment>
                            <comment id="13462494" author="davsclaus" created="Tue, 25 Sep 2012 06:48:43 +0000"  >&lt;p&gt;Introduced &lt;tt&gt;useRawUri&lt;/tt&gt; method to &lt;tt&gt;Component&lt;/tt&gt; which gives component writers full power.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12597473">CAMEL-5420</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12545133" name="CAMEL-4857.patch" size="17295" author="davsclaus" created="Fri, 14 Sep 2012 10:57:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i023in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>