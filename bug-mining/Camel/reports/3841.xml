<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:19:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10380] JettyHttpEndpoint9 ignores eagerCheckContentAvailable so Jetty builds a reuqest with &quot;Transfer-Encoding: chunked&quot;</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10380</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;My original problem is the fact, that in a Jetty based proxy the consumer sets the header &quot;Transfer-Encoding: chunked&quot; to the backend request for a GET request without body. This is not necessary, since there is no body, but the http component puts that null body into a InputStreamCache/HttpInputOverHTTP. This happens, because there is no content-length header set (which means it&apos;s &quot;-1&quot;):&lt;br/&gt;
see &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-http-common/src/main/java/org/apache/camel/http/common/DefaultHttpBinding.java#L564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-http-common/src/main/java/org/apache/camel/http/common/DefaultHttpBinding.java#L564&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The only workaround I found, is to set &quot;eagerCheckContentAvailable=true&quot;. Unfortunately the JettyHttpEndpoint9 does not transfer this setting to the http binding and therefor my problem can&apos;t be fixed. (Ok, I found another workaround, but it&apos;s really ugly.)&lt;/p&gt;

&lt;p&gt;I found that problem using camel-2.17. In the current master branch, there is an open TODO to transfer this option:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blame/master/components/camel-jetty9/src/main/java/org/apache/camel/component/jetty9/JettyHttpEndpoint9.java#L52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blame/master/components/camel-jetty9/src/main/java/org/apache/camel/component/jetty9/JettyHttpEndpoint9.java#L52&lt;/a&gt;&lt;br/&gt;
For me this fixed the problem in my &quot;test&quot;.&lt;/p&gt;

&lt;p&gt;I didn&apos;t manage to build a good test, since that header is set deeply inside &quot;org.eclipse.jetty.client.HttpConnection.normalizeRequest(Request)&quot;, but it&apos;s easy to reproduce it, by running a simple proxy and enable DEBUG log for &quot;org.eclipse.jetty.client.HttpSender&quot;:&lt;/p&gt;

&lt;p&gt;Inside the log a http header like will be logged:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Accept-Encoding: gzip
User-Agent: Jetty/9.2.15.v20160210
sendDirect: true
Host: 127.0.0.1
Transfer-Encoding: chunked
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the test I used to reproduce and debug that problen&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JettyEndpointsChuckedFalseTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; BaseJettyTest {
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void runningTest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        Exchange exchange = template.request(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:{{port}}/test&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
&lt;/span&gt;            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
            	exchange.getIn().getBody();
            }
        });
        assertNotNull(exchange);
    }
    
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

            	from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:{{port}}/test?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;chunked=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;disableStreamCache=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
&lt;/span&gt;            			+ &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;eagerCheckContentAvailable=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
	            	.to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:request-debug?showHeaders=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;showBody=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;level=INFO&quot;&lt;/span&gt;)
	            	.to(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:{{port2}}/test?bridgeEndpoint=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;chunked=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/span&gt;            	
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:{{port2}}/test&quot;&lt;/span&gt;)
&lt;/span&gt;                	.to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:dead.end&quot;&lt;/span&gt;);
            }
        };
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13011348">CAMEL-10380</key>
            <summary>JettyHttpEndpoint9 ignores eagerCheckContentAvailable so Jetty builds a reuqest with &quot;Transfer-Encoding: chunked&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="rudibatt">Rudolf Batt</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Oct 2016 13:57:45 +0000</created>
                <updated>Mon, 17 Oct 2016 09:34:53 +0000</updated>
                            <resolved>Mon, 17 Oct 2016 09:34:52 +0000</resolved>
                                    <version>2.17.3</version>
                                    <fixVersion>2.17.4</fixVersion>
                    <fixVersion>2.18.1</fixVersion>
                    <fixVersion>2.19.0</fixVersion>
                                    <component>camel-jetty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15565768" author="rudibatt" created="Tue, 11 Oct 2016 15:31:02 +0000"  >&lt;p&gt;My workaround:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;when&amp;gt;
        &amp;lt;simple&amp;gt;${bodyAs(String)} == &apos;&apos;&amp;lt;/simple&amp;gt;
        &amp;lt;setBody&amp;gt;&amp;lt;simple&amp;gt;${null}&amp;lt;/simple&amp;gt;&amp;lt;/setBody&amp;gt;
&amp;lt;/when&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15579800" author="davsclaus" created="Sun, 16 Oct 2016 11:16:51 +0000"  >&lt;p&gt;Contributions with PR is welcome&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34q47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>