<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:46:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16316] ProducerTemplate asyncSend is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16316</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CompletableFuture&amp;lt;Exchange&amp;gt; asyncSend(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; endpointUri, Processor processor)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;method is not thread safe because the processor is passed as a lambda to the executor service:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getExecutorService().submit(() -&amp;gt; getProducerCache().asyncSendExchange(endpoint, pattern, processor,
 resultProcessor, inExchange, exchangeFuture));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and therefore if the caller use the original Exchange reference in the Processor, for example&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
request -&amp;gt; request.setBody(originalExchange.getIn().getBody(...))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the executorService thread will use a dirty Exchange body in cases where the original executor thread runs faster.&lt;br/&gt;
On the other hand this method is thread safe because the new Exchange object can be populated from the original exchange:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CompletableFuture&amp;lt;Exchange&amp;gt; asyncSend(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; endpointUri, Exchange exchange)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the solution would be processing the request with the passed processor then submit the job to the executor service or clearly mention this in the API doc. This behavior is currently not straightforward.&lt;/p&gt;

&lt;p&gt;Of course you can pass references with the 2. method also which will become dirty but I think the clear intention here is sending a clean Exchange asynchronously to an endpoint with either a Processor or an exact Exchange object.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13363006">CAMEL-16316</key>
            <summary>ProducerTemplate asyncSend is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="ezolnbl">Zolt&#225;n N&#233;bli</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Mar 2021 13:10:39 +0000</created>
                <updated>Tue, 23 Mar 2021 06:20:02 +0000</updated>
                            <resolved>Tue, 23 Mar 2021 06:20:02 +0000</resolved>
                                    <version>3.1.0</version>
                    <version>3.7.2</version>
                                    <fixVersion>3.10.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17297369" author="davsclaus" created="Mon, 8 Mar 2021 13:58:13 +0000"  >&lt;p&gt;Camel 3.1 is rather old, try with 3.7.3&lt;/p&gt;</comment>
                            <comment id="17297600" author="ezolnbl" created="Mon, 8 Mar 2021 18:01:33 +0000"  >&lt;p&gt;there is no 3.7.3 version on maven central but there is 3.7.2 and the implementation is very similar of the &lt;b&gt;asyncSendExchange&lt;/b&gt; method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CompletableFuture&amp;lt;Exchange&amp;gt; exchangeFuture = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompletableFuture();
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getExecutorService().submit(() -&amp;gt; {
 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getProducerCache().asyncSendExchange(endpoint, pattern, processor, resultProcessor, inExchange, exchangeFuture);
});
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; exchangeFuture;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the processor lambda is not evaluated until a thread from the executor threadpool starts work on it.&lt;/p&gt;</comment>
                            <comment id="17306792" author="davsclaus" created="Tue, 23 Mar 2021 06:20:02 +0000"  >&lt;p&gt;Added note to javadoc about the thread-safety issue&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0oeso:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>