<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:03:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20103] DefaultProducerCache returns wrong ProducerTemplate under high concurrency load</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20103</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;as already posted on the &lt;a href=&quot;https://lists.apache.org/thread/2o0fhstmdjgc0nss0t30d9g3337qnm8j&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dev mailing list&lt;/a&gt; the DefaultProducerCache can return a wrong ProducerTemplate under high concurrency load which leads to misrouted exchanges and therefor errors in the application and workflow.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The improvement in the DefaultProducerCache from &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-19058&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;issue 19058&lt;/a&gt; introduced a severe concurrency issue with &lt;a href=&quot;https://github.com/apache/camel/commit/921ce519331ac5c8b0a1dfd099f9acbaba4feeab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;that change&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;While writing to the &quot;lastUsed&quot; fields in &quot;acquireProducers&quot; is synchronised, so that they are updated together, the read at the beginning of the method is not synchronised at all with the writes and therefor can be read at every time, even between the synced update to the fields which can lead to wrong producer templates being returned under high concurrency load. This then leads to exchanges being delivered to wrong endpoints causing severe malfunctions and errors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;i have created a patch (and also a branch in my forked camel repo) including the fix and a unit test reproduces the problem with returning the wrong producer template for the requested endpoint when accessing from multiple threads&lt;/p&gt;</description>
                <environment></environment>
        <key id="13557566">CAMEL-20103</key>
            <summary>DefaultProducerCache returns wrong ProducerTemplate under high concurrency load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="nukulami">Peter Nowak</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Nov 2023 10:22:22 +0000</created>
                <updated>Tue, 14 Nov 2023 10:22:02 +0000</updated>
                            <resolved>Tue, 14 Nov 2023 10:22:02 +0000</resolved>
                                    <version>4.0.0</version>
                    <version>4.0.1</version>
                    <version>4.0.2</version>
                    <version>4.1.0</version>
                    <version>4.2.0</version>
                                    <fixVersion>4.0.3</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17785158" author="nukulami" created="Sat, 11 Nov 2023 10:24:40 +0000"  >&lt;p&gt;my pull request (containing the same changes as the attached patch) &lt;a href=&quot;https://github.com/apache/camel/pull/11971&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/11971&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17785834" author="orpiske" created="Tue, 14 Nov 2023 10:22:02 +0000"  >&lt;p&gt;This should have been fixed by the linked PR 11971 by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nukulami&quot; class=&quot;user-hover&quot; rel=&quot;nukulami&quot;&gt;nukulami&lt;/a&gt; which I backported to 4.0.x.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064322" name="patch.diff" size="5255" author="nukulami" created="Sat, 11 Nov 2023 10:17:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ljeo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>