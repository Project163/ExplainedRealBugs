<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:40:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-3118] camel-spring causes wrong initialization-order of dependent beans</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3118</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Attached is a patch with a test that demonstrates the problem. The test uses a custom RouteBuilder (&lt;tt&gt;SampleIninitalizingRouteBuilder&lt;/tt&gt;) and another bean (&lt;tt&gt;SampleIninitalizingBean&lt;/tt&gt;) that both implement &lt;tt&gt;InitializingBean&lt;/tt&gt;. When the beans&apos; &lt;tt&gt;afterPropertiesSet()&lt;/tt&gt; methods are called, these beans add their names to a shared list. When the &lt;tt&gt;SampleIninitalizingRouteBuilder.configure()&lt;/tt&gt; method is called then &quot;configured&quot; is added to the shared list.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;  org.apache.camel.spring.issues

&lt;span class=&quot;code-comment&quot;&gt;// imports omitted ...
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SampleInitializingBean &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; InitializingBean {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; entries;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name = name;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setEntries(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; entries) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.entries = entries;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void afterPropertiesSet() {
        entries.add(name);
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SampleInitializingRouteBuilder &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RouteBuilder &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; InitializingBean {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; entries;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name = name;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setEntries(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; entries) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.entries = entries;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void afterPropertiesSet() {
        entries.add(name);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        entries.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;configured&quot;&lt;/span&gt;);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These beans are wired as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;entries1&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.ArrayList&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;

    &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleBean1&quot;&lt;/span&gt;
          class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.spring.issues.SampleInitializingBean&quot;&lt;/span&gt;&amp;gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;test1a&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;entries&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;entries1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;

    &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleRouteBuilder1&quot;&lt;/span&gt;
          class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.spring.issues.SampleInitializingRouteBuilder&quot;&lt;/span&gt; depends-on=&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleBean1&quot;&lt;/span&gt;&amp;gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;test1b&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;entries&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;entries1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/spring&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;routeBuilder ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleRouteBuilder1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/camelContext&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the &lt;tt&gt;depends-on&lt;/tt&gt; attribute on the &lt;tt&gt;sampleRouteBuilder1&lt;/tt&gt; bean: it should ensure that &lt;tt&gt;sampleBean1&lt;/tt&gt; is being initialized before &lt;tt&gt;sampleRouteBuilder1&lt;/tt&gt; and the &lt;tt&gt;camelContext&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Actual behaviour, however, is that the beans are initialized in the following order:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;sampleRouteBuilder1&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;camelContext&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;sampleBean1&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;which is definitely wrong. The shared list contains the entries&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;test1b&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;configured&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;test1a&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This differs from the expected order&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;test1a&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;test1b&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;configured&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;which cannot be observed. After some debugging, it seems the problem is related to the &lt;tt&gt;CamelBeanPostProcessor.postProcessBeforeInitialization()&lt;/tt&gt; method. It does a lookup of the &lt;tt&gt;camelContext&lt;/tt&gt; (i.e. &lt;tt&gt;applicationContext.getBean(camelId))&lt;/tt&gt;) &lt;b&gt;before&lt;/b&gt; the application context finished initialization of dependent beans. The problem is that this lookup already triggers a &lt;tt&gt;SampleInitializingRouteBuilder.configure()&lt;/tt&gt; method call.&lt;/p&gt;

&lt;p&gt;Even worse, this behaviour depends on the declaration order of the beans in the application context XML file. When the &lt;tt&gt;camelContext&lt;/tt&gt; bean is moved to the top, the bean initialization are done in the correct order.&lt;/p&gt;

&lt;p&gt;To demonstrate that this is not a Spring-related problem, the attached test also contains another bean (&lt;tt&gt;SampleRouteBuilderContainer&lt;/tt&gt;) that plays the role of the &lt;tt&gt;camelContext&lt;/tt&gt; but does nothing else than calling &lt;tt&gt;configure()&lt;/tt&gt; on the injected route builder within (&lt;tt&gt;afterPropertiesSet()&lt;/tt&gt;). In this case, the bean initialization occur in the expected, correct order.&lt;/p&gt;

&lt;p&gt;I didn&apos;t find a solution to this problem so far and need to dig in further (hope to find some time next week for that). If any of the committers (who are more familiar with camel-spring than I am) have already an idea how to solve that, I appreciate any hints.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12487536">CAMEL-3118</key>
            <summary>camel-spring causes wrong initialization-order of dependent beans</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="mrt1nz">Martin Krasser</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Sep 2010 14:51:09 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:41 +0000</updated>
                            <resolved>Mon, 13 Sep 2010 04:30:58 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12956698" author="njiang" created="Mon, 13 Sep 2010 04:05:38 +0000"  >&lt;p&gt;This issue is related to recent change of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-3050&quot; title=&quot;RouteBuilderRef should work out of the box with Spring 3 and dependency injection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-3050&quot;&gt;&lt;del&gt;CAMEL-3050&lt;/del&gt;&lt;/a&gt;, I&apos;m working on the patch for it now.&lt;/p&gt;</comment>
                            <comment id="12956693" author="njiang" created="Mon, 13 Sep 2010 04:30:58 +0000"  >&lt;p&gt;Applied patch into the trunk.&lt;/p&gt;</comment>
                            <comment id="12956700" author="mrt1nz" created="Mon, 13 Sep 2010 06:54:39 +0000"  >&lt;p&gt;Thanks for fixing!&lt;/p&gt;</comment>
                            <comment id="13023900" author="davsclaus" created="Sun, 24 Apr 2011 09:57:41 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463354" name="camel-spring-test.patch" size="11197" author="mrt1nz" created="Sat, 11 Sep 2010 14:51:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01srr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>