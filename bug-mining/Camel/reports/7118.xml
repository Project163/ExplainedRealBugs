<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:10:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22038] aws-ddb: float/doubles are being set as ddb attribute type=S while using transformer - Ddb2JsonDataTypeTransformer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22038</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We are using Ddb2JsonDataTypeTransformer&#160; &#160;to serialize the json input to DynamoDB AttributeValue Map for all the attributes before sending the payload (to create an item in dynamodb table) to DynamoDB put operation.&#160;&lt;/p&gt;

&lt;p&gt;My input payload:&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;{&lt;br/&gt;
&#160; &quot;operation&quot;: &quot;PutItem&quot;,&lt;br/&gt;
&#160; &quot;item&quot;: &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &amp;quot;Id&amp;quot;}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Route sink endpoint:&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;.to(aws2Ddb(&quot;tablename&quot;))&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;Issue:&lt;/b&gt;&lt;/ins&gt;&#160;&lt;/p&gt;

&lt;p&gt;We are seeing the floating-point value in above Json which are being saved to dynamodb as type=S instead of N.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Why this problem?&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I debugged this class &lt;b&gt;org.apache.camel.component.aws2.ddb.transform.Ddb2JsonDataTypeTransformer&lt;/b&gt;,&#160; I found that there is no condition in method (which checks and matches data types to attribute value types) for float/double data type. Hence, all float/default values are getting defaulted back to type=S.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;private static AttributeValue getAttributeValue(Object value) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; if (value == null)
Unknown macro}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; &#160; if (value instanceof String)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().s(value.toString()).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof Integer)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().n(value.toString()).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof Boolean)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().bool((Boolean) value).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof String[])&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ss((String[]) value).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof int[])&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ns(Stream.of((int[]) value).map(Object}&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof List) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; &#160; &#160; List&amp;lt;?&amp;gt; values = (List&amp;lt;?&amp;gt;) value;

&#160; &#160; &#160; &#160; &#160; &#160; if (values.isEmpty())
Unknown macro}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;else if (values.get(0) instanceof Integer)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ns(values.stream().map(Object}&lt;br/&gt;
else&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ss(values.stream().map(Object}&lt;br/&gt;
&#160; &#160; &#160; &#160; }&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; if (value instanceof Map) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; &#160; &#160; Map&amp;lt;String, AttributeValue&amp;gt; nestedAttributes = new LinkedHashMap&amp;lt;&amp;gt;();

&#160; &#160; &#160; &#160; &#160; &#160; for (Map.Entry&amp;lt;?, ?&amp;gt; nested }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().m(nestedAttributes).build();&lt;br/&gt;
&#160; &#160; &#160; &#160; }&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &lt;b&gt;return AttributeValue.builder().s(value.toString()).build();&lt;/b&gt;&lt;br/&gt;
&#160; &#160; }&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So - the current code in this class as below should have an if condition to match the data type to float/double and set the attribute type for such values as N:&#160;&lt;/p&gt;

&lt;p&gt;&#160; &lt;b&gt;if (value instanceof Double) {&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160;&lt;b&gt;return AttributeValue.builder().n(value.toString()).build();&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;b&gt;}&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The fix should be included is as follows:&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;private static AttributeValue getAttributeValue(Object value) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; if (value == null)
Unknown macro}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; &#160; if (value instanceof String)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().s(value.toString()).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof Integer)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().n(value.toString()).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;b&gt;if (value instanceof Double) {&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160;&lt;b&gt;return AttributeValue.builder().n(value.toString()).build();&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &#160; &#160; &lt;b&gt;}&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; if (value instanceof Boolean)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().n((Boolean) value).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof String[])&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ss((String[]) value).build(); &#160; &#160; &#160; &#160; }&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof int[])&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ns(Stream.of((int[]) value).map(Object}&lt;br/&gt;
&#160; &#160; &#160; &#160; if (value instanceof List) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; &#160; &#160; List&amp;lt;?&amp;gt; values = (List&amp;lt;?&amp;gt;) value;

&#160; &#160; &#160; &#160; &#160; &#160; if (values.isEmpty())
Unknown macro}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;else if (values.get(0) instanceof Integer)&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ns(values.stream().map(Object}&lt;br/&gt;
else&lt;br/&gt;
Unknown macro: { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().ss(values.stream().map(Object}&lt;br/&gt;
&#160; &#160; &#160; &#160; }&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; if (value instanceof Map) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
&#160; &#160; &#160; &#160; &#160; &#160; Map&amp;lt;String, AttributeValue&amp;gt; nestedAttributes = new LinkedHashMap&amp;lt;&amp;gt;();

&#160; &#160; &#160; &#160; &#160; &#160; for (Map.Entry&amp;lt;?, ?&amp;gt; nested }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; return AttributeValue.builder().m(nestedAttributes).build();&lt;br/&gt;
&#160; &#160; &#160; &#160; }&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; return AttributeValue.builder().s(value.toString()).build();&lt;br/&gt;
&#160; &#160; }&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13616772">CAMEL-22038</key>
            <summary>aws-ddb: float/doubles are being set as ddb attribute type=S while using transformer - Ddb2JsonDataTypeTransformer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="kumargaura486807">Kumar Gaurav</reporter>
                        <labels>
                            <label>dynamodb</label>
                    </labels>
                <created>Wed, 30 Apr 2025 08:06:25 +0000</created>
                <updated>Thu, 1 May 2025 13:03:49 +0000</updated>
                            <resolved>Thu, 1 May 2025 13:03:49 +0000</resolved>
                                    <version>4.4.5</version>
                                    <fixVersion>4.8.7</fixVersion>
                    <fixVersion>4.10.5</fixVersion>
                    <fixVersion>4.12.0</fixVersion>
                                    <component>camel-aws</component>
                    <component>camel-aws2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17948659" author="davsclaus" created="Thu, 1 May 2025 13:01:55 +0000"  >&lt;p&gt;Is this work complete ?&lt;/p&gt;</comment>
                            <comment id="17948661" author="ancosen" created="Thu, 1 May 2025 13:03:49 +0000"  >&lt;p&gt;Yes, it is&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vme0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>