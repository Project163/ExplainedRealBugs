<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:39:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2899] out of heap space if remote FTP site has too many files to pick up</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2899</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;2010-07-02 11:38:07,439 FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.file.remote.FtpConsumer:CamelThread 10&amp;#93;&lt;/span&gt;   - &amp;lt;Consumer Consumer[my_ftp_URI_here caused by: Java heap space&amp;gt;&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;

&lt;p&gt;My remote FTP server has ~60k 100 byte files, and the camel endpoint consumer falls over and doesn&apos;t start again.  I can use JMX to stop/start the consumer, (it still has status &quot;started&quot;) and it will log in to the remote server again, but then fall over with the out of heap space.&lt;/p&gt;

&lt;p&gt;I can work around this by increasing the heap, or by moving some of the files aside,  but I don&apos;t think camel should care how many files there are, or at least, I think it should deal with it more gracefully.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12486190">CAMEL-2899</key>
            <summary>out of heap space if remote FTP site has too many files to pick up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="karlp">Karl Palsson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Jul 2010 11:49:32 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:21 +0000</updated>
                            <resolved>Tue, 6 Jul 2010 08:22:20 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12953977" author="gertvanthienen" created="Fri, 2 Jul 2010 11:59:32 +0000"  >&lt;p&gt;I think you can already configure that with the &lt;b&gt;&lt;tt&gt;maxMessagesPerPoll&lt;/tt&gt;&lt;/b&gt; URI parameter to limit the number of files being processing in a single poll (cfr. &lt;a href=&quot;http://camel.apache.org/file2.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/file2.html&lt;/a&gt;) - could you give that a try to see if it solves your problem?&lt;/p&gt;</comment>
                            <comment id="12955141" author="karlp" created="Fri, 2 Jul 2010 17:07:23 +0000"  >&lt;p&gt;Seemed very reasonable, but unfortunately, it doesn&apos;t help....&lt;/p&gt;

&lt;p&gt;2010-07-02 17:02:42,327 FATAL Consumer Consumer[ftp://sms02@localhost:2121/autre&lt;br/&gt;
q/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.process&lt;br/&gt;
ed&amp;amp;passiveMode=true&amp;amp;password=sms02] could not poll endpoint: &lt;a href=&quot;ftp://sms02@localho&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localho&lt;/a&gt;&lt;br/&gt;
st:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;&lt;br/&gt;
move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02 caused by: Java heap space&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;

&lt;p&gt;I tried again without file filter, (just an ant pattern name matcher) in case that was causing any problems, but it still fails.&lt;/p&gt;</comment>
                            <comment id="12955721" author="karlp" created="Fri, 2 Jul 2010 18:45:16 +0000"  >&lt;p&gt;Some stack traces...&lt;/p&gt;

&lt;p&gt;This is without having a file name pattern match filter&lt;/p&gt;


&lt;p&gt; FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.file.remote.FtpConsumer:CamelThread 4&amp;#93;&lt;/span&gt;   - &amp;lt;Consumer Consumer&lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; could not poll endpoint: &lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; caused by: Java heap space&amp;gt;&lt;/p&gt;

&lt;p&gt;java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
	at java.util.concurrent.ConcurrentHashMap.&amp;lt;init&amp;gt;(ConcurrentHashMap.java:613)&lt;br/&gt;
	at java.util.concurrent.ConcurrentHashMap.&amp;lt;init&amp;gt;(ConcurrentHashMap.java:652)&lt;br/&gt;
	at org.apache.camel.impl.DefaultExchange.getProperties(DefaultExchange.java:168)&lt;br/&gt;
	at org.apache.camel.impl.DefaultExchange.setProperty(DefaultExchange.java:153)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFile.bindToExchange(GenericFile.java:96)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileEndpoint.createExchange(RemoteFileEndpoint.java:50)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:87)&lt;br/&gt;
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:98)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)&lt;br/&gt;
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;



&lt;p&gt;The two below here were when I had an ant pattern match filter.  From the debug logs, it filtered &lt;em&gt;every&lt;/em&gt; file, regardless of the max messages per poll&lt;/p&gt;

&lt;p&gt;FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.file.remote.FtpConsumer:CamelThread 4&amp;#93;&lt;/span&gt;   - &amp;lt;Consumer Consumer&lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; could not poll endpoint: &lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; caused by: Java heap space&amp;gt;&lt;/p&gt;

&lt;p&gt;java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
	at java.util.Arrays.copyOf(Arrays.java:2882)&lt;br/&gt;
	at java.lang.AbstractStringBuilder.expandCapacity(AbstractStringBuilder.java:100)&lt;br/&gt;
	at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:390)&lt;br/&gt;
	at java.lang.StringBuilder.append(StringBuilder.java:119)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFile.populateHeaders(GenericFile.java:118)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFile.populateHeaders(RemoteFile.java:39)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFile.bindToExchange(GenericFile.java:99)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileEndpoint.createExchange(RemoteFileEndpoint.java:50)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:87)&lt;br/&gt;
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:98)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)&lt;br/&gt;
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;



&lt;p&gt;FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.file.remote.FtpConsumer:CamelThread 4&amp;#93;&lt;/span&gt;   - &amp;lt;Consumer Consumer&lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; could not poll endpoint: &lt;a href=&quot;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://sms02@localhost:2121/autreq/ok?delay=5000&amp;amp;filter=%23conaxRequestFilter&amp;amp;maxMessagesPerPoll=50&amp;amp;move=.processed&amp;amp;passiveMode=true&amp;amp;password=sms02&lt;/a&gt; caused by: Java heap space&amp;gt;&lt;/p&gt;

&lt;p&gt;java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
	at java.util.Arrays.copyOf(Arrays.java:2882)&lt;br/&gt;
	at java.lang.AbstractStringBuilder.expandCapacity(AbstractStringBuilder.java:100)&lt;br/&gt;
	at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:390)&lt;br/&gt;
	at java.lang.StringBuilder.append(StringBuilder.java:119)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFile.populateHeaders(GenericFile.java:118)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFile.populateHeaders(RemoteFile.java:39)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFile.bindToExchange(GenericFile.java:99)&lt;br/&gt;
	at org.apache.camel.component.file.remote.RemoteFileEndpoint.createExchange(RemoteFileEndpoint.java:50)&lt;br/&gt;
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:87)&lt;br/&gt;
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:98)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)&lt;br/&gt;
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="12955728" author="davsclaus" created="Sat, 3 Jul 2010 08:26:28 +0000"  >&lt;p&gt;We could either&lt;/p&gt;

&lt;p&gt;a)&lt;br/&gt;
Use lightweight record structure for the 160K list of files instead of turning them into Exchange objects which carries extra load&lt;/p&gt;

&lt;p&gt;b)&lt;br/&gt;
Alter so the maxMessagesPerPoll will be effective earlier. Currently it loads the entire list, then you can filter, sort etc. And after all this it will cut down the list.&lt;br/&gt;
If we apply the maxMessagesPerPoll earlier we can&apos;t really be able to sort the entire list etc. And the filter could also cut out some from the max list.&lt;br/&gt;
Or in other words we will have to re-add files until we hit that limit if there are more files.&lt;/p&gt;

&lt;p&gt;In your case I don&apos;t think you care about sorting/filtering etc. You just want to poll X number of files per go to avoid excessive memory overhead. So I think we could add an option in the uri for solution b.&lt;/p&gt;

&lt;p&gt;Anyone got a good name for such an option?&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12955712" author="davsclaus" created="Tue, 6 Jul 2010 08:22:20 +0000"  >&lt;p&gt;The &lt;tt&gt;maxMessagesPerPoll&lt;/tt&gt; option is now applied earlier for the file/ftp components so we avoid creating so many Exchange objects which are then afterwards discarded.&lt;/p&gt;

&lt;p&gt;trunk: 960839.&lt;/p&gt;

&lt;p&gt;Notice there is no limit in the java.io.File or FTP API to tell it to only list at most X number of files.&lt;/p&gt;</comment>
                            <comment id="13023765" author="davsclaus" created="Sun, 24 Apr 2011 09:57:21 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76403</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01rfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>