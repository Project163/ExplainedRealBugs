<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:01:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7142] CsvDataFormat unmarshal overwrites delimiter in static CSVStrategy strategies</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7142</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The unmarshal function in CsvDataFormat contains the following line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;strategy.setDelimiter(config.getDelimiter());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can cause problems when multiple CsvDataFormats are used which rely on the default CSVStrategy or one of the other static CSVStrategy objects.&lt;/p&gt;

&lt;p&gt;Here is sample code to demonstrate the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CsvDataFormat csv = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CsvDataFormat();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CsvDataFormat tsv = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CsvDataFormat();
tsv.setDelimiter(&lt;span class=&quot;code-quote&quot;&gt;&quot;\t&quot;&lt;/span&gt;);

context.addRoutes(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///tmp/?include=.*.csv&quot;&lt;/span&gt;)
&lt;/span&gt;                .unmarshal(csv)
                .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyProcessor());
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///tmp/?include=.*.tsv&quot;&lt;/span&gt;)
&lt;/span&gt;                .unmarshal(tsv)
                .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyProcessor());
    }
});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running the code above with several files with 2 lines, 9 columns per line and comma or tab delimiters returns the following (the exact values may be different from run to run):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;File: 0.tsv, lines: 2
  Line 1 columns: 9
  Line 2 columns: 9
File: 0.csv, lines: 2
  Line 1 columns: 1
  Line 2 columns: 1
File: 1.csv, lines: 2
  Line 1 columns: 2
  Line 2 columns: 1
File: 1.tsv, lines: 2
  Line 1 columns: 9
  Line 2 columns: 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These should all show 9 columns.&lt;/p&gt;

&lt;p&gt;Adding the following lines corrects the problem, because each DataFormat has its own CSVStrategy:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;csv.setStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVStrategy(&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;#&apos;&lt;/span&gt;));
tsv.setStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVStrategy(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;#&apos;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The suggested fix would be for the CsvDataFormat to have its own copy of its CSVStrategy instead of using what amounts to a pointer to another CSVStrategy. Perhaps setStrategy should be changed to do that. This is tedious because CSVStrategy has no copy constructor and has many properties, but would be a defensive way to do it.&lt;/p&gt;

&lt;p&gt;Note also that the example at &lt;a href=&quot;http://camel.apache.org/csv.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/csv.html&lt;/a&gt; under &quot;Unmarshalling with a pipe as delimiter&quot; actually alters the CSVStrategy.DEFAULT_STRATEGY, so any subsequent CsvDataFormat objects created would have a pipe as the delimiter.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12689565">CAMEL-7142</key>
            <summary>CsvDataFormat unmarshal overwrites delimiter in static CSVStrategy strategies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bvahdat">Babak Vahdat</assignee>
                                    <reporter username="johnsdouglass">John Douglass</reporter>
                        <labels>
                            <label>easyfix</label>
                    </labels>
                <created>Fri, 17 Jan 2014 20:08:12 +0000</created>
                <updated>Sat, 18 Jan 2014 12:15:35 +0000</updated>
                            <resolved>Sat, 18 Jan 2014 12:15:35 +0000</resolved>
                                    <version>2.12.2</version>
                                    <fixVersion>2.11.4</fixVersion>
                    <fixVersion>2.12.3</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-csv</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13875633" author="bvahdat" created="Sat, 18 Jan 2014 11:43:36 +0000"  >&lt;p&gt;Luckily &lt;tt&gt;CSVStrategy&lt;/tt&gt; has widen the visibility of &lt;tt&gt;Object#clone()&lt;/tt&gt; method from &lt;tt&gt;protected&lt;/tt&gt; to &lt;tt&gt;public&lt;/tt&gt;, so that we can easily make a safe copy of a given &lt;tt&gt;CSVStrategy&lt;/tt&gt; object when necessary.&lt;/p&gt;</comment>
                            <comment id="13875636" author="bvahdat" created="Sat, 18 Jan 2014 12:15:35 +0000"  >&lt;p&gt;Thanks for reporting.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1riqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>