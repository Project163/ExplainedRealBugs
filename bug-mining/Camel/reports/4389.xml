<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:27:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12134] spring-boot: two camel contexts created when using xml configuration</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12134</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When running the camel-example-spring-boot-xml, or any spring-boot camel application using xml route definition, camel seems to create 2 contexts.&lt;/p&gt;

&lt;p&gt;It seems to happen only when using spring xml routes.&lt;/p&gt;

&lt;p&gt;The second one has no routes. Camel fails to register it to jmx and adds a &quot;-1&quot; to its name.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a.c.m.DefaultManagementLifecycleStrategy : This CamelContext(SampleCamel) will be registered using the name: SampleCamel-1 due to clash with an existing name already registered in MBeanServer.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The relevant parts of the trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-01-10 12:00:26.538  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.21.0-SNAPSHOT (CamelContext: SampleCamel) is starting
2018-01-10 12:00:26.539  INFO 11245 --- [           main] o.a.c.m.ManagedManagementStrategy        : JMX is enabled
2018-01-10 12:00:26.700  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/stream-caching.html
&lt;/span&gt;2018-01-10 12:00:26.740  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Route: hello started and consuming from: timer:&lt;span class=&quot;code-comment&quot;&gt;//hello?period=2000
&lt;/span&gt;2018-01-10 12:00:26.742  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Total 1 routes, of which 1 are started
2018-01-10 12:00:26.743  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.21.0-SNAPSHOT (CamelContext: SampleCamel) started in 0.204 seconds
2018-01-10 12:00:26.757  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.21.0-SNAPSHOT (CamelContext: SampleCamel) is starting
2018-01-10 12:00:26.757  INFO 11245 --- [           main] o.a.c.m.ManagedManagementStrategy        : JMX is enabled
2018-01-10 12:00:26.757  WARN 11245 --- [           main] a.c.m.DefaultManagementLifecycleStrategy : This CamelContext(SampleCamel) will be registered using the name: SampleCamel-1 due to clash with an existing name already registered in MBeanServer.
2018-01-10 12:00:26.762  INFO 11245 --- [           main] o.a.c.i.converter.DefaultTypeConverter   : Type converters loaded (core: 193, classpath: 1)
2018-01-10 12:00:26.770  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/stream-caching.html
&lt;/span&gt;2018-01-10 12:00:26.770  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Total 0 routes, of which 0 are started
2018-01-10 12:00:26.770  INFO 11245 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.21.0-SNAPSHOT (CamelContext: SampleCamel) started in 0.013 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13129821">CAMEL-12134</key>
            <summary>spring-boot: two camel contexts created when using xml configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nferraro">Nicola Ferraro</assignee>
                                    <reporter username="nferraro">Nicola Ferraro</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jan 2018 11:14:12 +0000</created>
                <updated>Thu, 11 Jan 2018 07:35:12 +0000</updated>
                            <resolved>Wed, 10 Jan 2018 13:21:41 +0000</resolved>
                                    <version>2.20.0</version>
                    <version>2.20.1</version>
                                    <fixVersion>2.20.2</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-spring-boot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16320189" author="nferraro" created="Wed, 10 Jan 2018 12:57:32 +0000"  >&lt;p&gt;This was probably introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11752&quot; title=&quot;camel-spring-boot : improve handling classic spring xml with spring-boot  &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11752&quot;&gt;&lt;del&gt;CAMEL-11752&lt;/del&gt;&lt;/a&gt;, in &lt;a href=&quot;https://github.com/apache/camel/blob/4f65a942465d82acea52a5012c00bec81d1183e6/components/camel-spring/src/main/java/org/apache/camel/spring/CamelContextFactoryBean.java#L452-L463&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/4f65a942465d82acea52a5012c00bec81d1183e6/components/camel-spring/src/main/java/org/apache/camel/spring/CamelContextFactoryBean.java#L452-L463&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We call the configurer from within the context creation, but if the configurer finds CamelContextAware beans in the registry, the CamelBeanPostProcessor looks up the CamelContext from the registry again, resulting in another creation.&lt;/p&gt;

&lt;p&gt;Splitting creation from initialization may solve the issue.&lt;/p&gt;</comment>
                            <comment id="16320297" author="kalusn" created="Wed, 10 Jan 2018 14:07:06 +0000"  >&lt;p&gt;We experienced the same issue at our organization, and I came here to make the issue until I found out someone had already created it. Nice!&lt;/p&gt;

&lt;p&gt;The issue showed itself to us when injecting a ProducerTemplate in a bean after injecting a CamelContext. The ProducerTemplate would then have a reference to the wrong (contextName-1) camelContext. Ironically, making sure that the CamelContext is injected &lt;b&gt;after&lt;/b&gt; the ProducerTemplate solves the issue when working with Camel 2.20.1.&lt;/p&gt;

&lt;p&gt;I&apos;ll try out your patch and ensure it solves the issue.&lt;/p&gt;</comment>
                            <comment id="16320340" author="kalusn" created="Wed, 10 Jan 2018 14:38:00 +0000"  >&lt;p&gt;I can confirm that the patch solves the problem with a ProducerTemplate having a &quot;dead&quot; CamelContext attached.&lt;/p&gt;</comment>
                            <comment id="16321822" author="nferraro" created="Thu, 11 Jan 2018 07:35:12 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kalusn&quot; class=&quot;user-hover&quot; rel=&quot;kalusn&quot;&gt;kalusn&lt;/a&gt;! Version 2.20.2 is expected to be released shortly (next week most probably).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oqh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>