<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:00:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6854] Type conversion between DOMSource and InputStream breaks on Windows</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6854</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The type conversion between DomSource and InputStream will destroy non-ascii characters if the default charset is not UTF-8.&lt;/p&gt;

&lt;p&gt;Therefore the following test will work on Linux (and in my Eclipse on Windows) where the default charset is UTF-8, but it will not work if invoked from the command line (maven) when the default charset is not UTF-8.&lt;/p&gt;

&lt;p&gt;I will also get similar issues if the type converter are implicitly called by endpoints (the real use case was to read the output of a camel-cxf endpoint as an InputStream).&lt;/p&gt;

&lt;p&gt;import java.io.InputStream;&lt;/p&gt;

&lt;p&gt;import javax.xml.transform.dom.DOMSource;&lt;/p&gt;

&lt;p&gt;import org.apache.camel.builder.RouteBuilder;&lt;br/&gt;
import org.apache.camel.component.mock.MockEndpoint;&lt;br/&gt;
import org.apache.camel.test.junit4.CamelTestSupport;&lt;br/&gt;
import org.junit.Test;&lt;/p&gt;

&lt;p&gt;public class XMLTypeConverterTest extends CamelTestSupport {&lt;/p&gt;

&lt;p&gt;    @Test&lt;br/&gt;
    public void testBase64Marshal() throws InterruptedException &lt;/p&gt;
{
        MockEndpoint mock = getMockEndpoint(&quot;mock:result&quot;);
        mock.expectedMessageCount(1);
        template.sendBody(&quot;direct:source&quot;, &quot;&amp;lt;colors&amp;gt;&amp;lt;color&amp;gt;gr&#252;n&amp;lt;/color&amp;gt;&amp;lt;/colors&amp;gt;&quot;);
        assertMockEndpointsSatisfied();
        String body = mock.getReceivedExchanges().get(0).getIn().getBody(String.class);
        assertStringContains(body, &quot;&amp;lt;colors&amp;gt;&amp;lt;color&amp;gt;gr&#252;n&amp;lt;/color&amp;gt;&amp;lt;/colors&amp;gt;&quot;);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    protected RouteBuilder createRouteBuilder() throws Exception {&lt;br/&gt;
        return new RouteBuilder() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void configure() throws Exception &lt;/p&gt;
{
                from(&quot;direct:source&quot;).convertBodyTo(DOMSource.class).convertBodyTo(InputStream.class).convertBodyTo(DOMSource.class)
                        .convertBodyTo(String.class).to(&quot;mock:result&quot;);
            }
&lt;p&gt;        };&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12673376">CAMEL-6854</key>
            <summary>Type conversion between DOMSource and InputStream breaks on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="siano">Stephan Siano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Oct 2013 05:53:15 +0000</created>
                <updated>Tue, 10 Dec 2013 07:54:52 +0000</updated>
                            <resolved>Tue, 10 Dec 2013 07:54:52 +0000</resolved>
                                    <version>2.10.7</version>
                    <version>2.11.2</version>
                    <version>2.12.1</version>
                                    <fixVersion>2.11.3</fixVersion>
                    <fixVersion>2.12.3</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13792386" author="siano" created="Fri, 11 Oct 2013 06:13:54 +0000"  >&lt;p&gt;I think the issue is in org.apache.camel.converter.jaxp.XmlConverter&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
    @Converter&lt;br/&gt;
    public InputStream toInputStream(DOMSource source, Exchange exchange) throws TransformerException, IOException &lt;/p&gt;
{
        String s = toString(source, exchange);
        return new ByteArrayInputStream(s.getBytes());
    }

&lt;p&gt;Converts the data to a String first, then we get a ByteArrayInputStream. The content of the InputStream has to be UTF-8 unless the preamble (which we don&apos;t have) or the BOM (which we also don&apos;t have) indicate otherwise.&lt;/p&gt;

&lt;p&gt;I am pretty sure that other XML data types (like Document) have the same issue.&lt;/p&gt;

&lt;p&gt;I am not entirely sure how to fix this, but it might be possible that the either the default charset needs to be UTF-8 for these XML type conversions or that a XML preamble (with charset) needs to be written in all cases.&lt;/p&gt;</comment>
                            <comment id="13792539" author="siano" created="Fri, 11 Oct 2013 11:46:33 +0000"  >&lt;p&gt;Wouldn&apos;t changing lines 834 and 848 of XMLConverter class to&lt;br/&gt;
        return new ByteArrayInputStream(s.getBytes(&quot;UTF-8&quot;));&lt;/p&gt;

&lt;p&gt;fix this issue? (hardcoded UTF-8 no matter what the default encoding is)&lt;/p&gt;

&lt;p&gt;Or would this have side effects?&lt;/p&gt;</comment>
                            <comment id="13793936" author="siano" created="Mon, 14 Oct 2013 06:03:04 +0000"  >&lt;p&gt;I have attached a patch that will fix this specific issue (even though there might be encoding issues elswhere in the code)&lt;/p&gt;</comment>
                            <comment id="13843171" author="ay" created="Mon, 9 Dec 2013 14:03:58 +0000"  >&lt;p&gt;Hi Willem,&lt;br/&gt;
I was wondering if the reason for this change not being committed is the test using non-ascii characters that are violating the code check? If that is the case, I am attaching a modified test that does not directly include those non-ascii characters in the code but includes them using their corresponding escaped unicode characters. I even added a few characters to make it more interesting.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13843174" author="ay" created="Mon, 9 Dec 2013 14:05:58 +0000"  >&lt;p&gt;a modified test file with test cases that use escaped unicode characters.&lt;/p&gt;</comment>
                            <comment id="13843824" author="njiang" created="Tue, 10 Dec 2013 01:48:12 +0000"  >&lt;p&gt;This issue was out of my radar for a while, I will review patch and apply it to the master branch today.&lt;/p&gt;</comment>
                            <comment id="13844061" author="njiang" created="Tue, 10 Dec 2013 07:54:52 +0000"  >&lt;p&gt;Applied the patch into master, camel-2.12.x and camel-2.11.x branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12608241" name="0001-CAMEL-6854-Type-conversion-between-DOMSource-and-Inp.patch" size="5007" author="siano" created="Mon, 14 Oct 2013 06:01:16 +0000"/>
                            <attachment id="12607954" name="XMLTypeConverterTest.txt" size="12016" author="siano" created="Fri, 11 Oct 2013 06:03:35 +0000"/>
                            <attachment id="12617832" name="test2.diff" size="1949" author="ay" created="Mon, 9 Dec 2013 14:05:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ouyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>