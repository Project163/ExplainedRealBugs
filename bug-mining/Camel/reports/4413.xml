<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:27:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11876] OsgiCamelContextPublisher might leak Service-References</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11876</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;OsgiCamelContextPublisher holds a Map of Service-References in its doShutdown method this map is cleared.&lt;/p&gt;

&lt;p&gt;This could lead to problem when there are still items in the map.&lt;/p&gt;

&lt;p&gt;Instead of clearing the map, it should be iterate+remove&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Iterator&amp;lt;ServiceRegistration&amp;lt;?&amp;gt;&amp;gt; it = registrations.values().iterator();
    	&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (it.hasNext()) {
			it.next().unregister();
			it.remove();
		}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13106659">CAMEL-11876</key>
            <summary>OsgiCamelContextPublisher might leak Service-References</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="laeubi">Christoph L&#228;ubrich</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Oct 2017 09:48:30 +0000</created>
                <updated>Thu, 1 Feb 2018 14:46:22 +0000</updated>
                            <resolved>Thu, 1 Feb 2018 14:46:22 +0000</resolved>
                                                    <fixVersion>2.21.0</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16189492" author="vrlgohel" created="Tue, 3 Oct 2017 10:05:00 +0000"  >&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;Thanks for reporting this. Do you have an application reproducer to test this ? or how are you observing this?  Can you attach a snapshot of the memory leak suspects you have identified and attached it to the ticket ? &lt;/p&gt;</comment>
                            <comment id="16189507" author="laeubi" created="Tue, 3 Oct 2017 10:18:20 +0000"  >&lt;p&gt;No I just found this in the code while debugging another problem an found it serious enough to report. In fact there are two cases:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The map is already empty at this point (I can&apos;t found a proof for this) then the clear is pointless&lt;/li&gt;
	&lt;li&gt;The map is NOT empty at this point and you will have CamelContext registrations hanging around that get cleared only when the bundle stops at all&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The Class also does some fancy checks to see if a CamelContext is already registered under the given name so maybe this was added to adress a problem with dangling service references? I&apos;m just not familiar enough with camel life-cycle to guess if there are cases where a CamelCOntext is started without beeing stopped be for, so this code looks suspicious to me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16189511" author="laeubi" created="Tue, 3 Oct 2017 10:20:34 +0000"  >&lt;p&gt;So to reproduce this something like this must happen:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;A CamelContextService is registered by a bundle&lt;/li&gt;
	&lt;li&gt;The doShutdown Method is called (no sure when this would happen)&lt;/li&gt;
	&lt;li&gt;Shutdown the CamelContext&lt;/li&gt;
	&lt;li&gt;The Service should still be there&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16323714" author="davsclaus" created="Fri, 12 Jan 2018 08:47:26 +0000"  >&lt;p&gt;In the notify method it unregisters the CamelContext &lt;/p&gt;</comment>
                            <comment id="16323716" author="davsclaus" created="Fri, 12 Jan 2018 08:47:59 +0000"  >&lt;p&gt;OSGi is complex, lets leave the code as-is to avoid causing unforsen problems for others&lt;/p&gt;</comment>
                            <comment id="16323720" author="laeubi" created="Fri, 12 Jan 2018 08:57:08 +0000"  >&lt;p&gt;This is nothing specific to OSGi, if you clear a Map of e.g. open Sockets instead of closing them explicitly you will leak open file descriptor.&lt;/p&gt;

&lt;p&gt;Same here: You clear a map with ServiceRefernece so you will not be sure the serivce is unregistered until the bundle itself is stopped.&lt;/p&gt;

&lt;p&gt;If unregistering stale reference causes problem somewhere else it should be fixed there and not hiding bugs by simply ignore the problem.&lt;/p&gt;

&lt;p&gt;In fact OSGi is not that complex at all, but its crucial to cleanup if your done with something or you will get doomed soon or later...&lt;/p&gt;</comment>
                            <comment id="16326059" author="davsclaus" created="Mon, 15 Jan 2018 09:58:03 +0000"  >&lt;p&gt;Can you submit a github PR with the changes you think is needed, then we can take a look at that&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kthj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>