<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:58:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6004] Tokenize XML does not support self-closing XML tokens</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6004</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Tokenize creates non-well-formed XML when handling self-closing XML tokens.  Tokenize should support parsing tokens that are either have a closing tag or are self-closing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12628991">CAMEL-6004</key>
            <summary>Tokenize XML does not support self-closing XML tokens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="gheidorn">Greg Heidorn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jan 2013 02:22:39 +0000</created>
                <updated>Fri, 3 Jan 2014 10:35:27 +0000</updated>
                            <resolved>Sun, 23 Jun 2013 08:26:08 +0000</resolved>
                                    <version>2.10.2</version>
                                    <fixVersion>2.10.6</fixVersion>
                    <fixVersion>2.11.1</fixVersion>
                    <fixVersion>2.12.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13561369" author="gheidorn" created="Thu, 24 Jan 2013 02:23:33 +0000"  >&lt;p&gt;JUnit that illustrates how tokenizeXML falls down when the tokens are self-closing.&lt;/p&gt;</comment>
                            <comment id="13561417" author="njiang" created="Thu, 24 Jan 2013 04:39:40 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I just checked the code of Tokenize, it only works after setting the startToken and endToken. So it is not strange that it doesn&apos;t support the self-closing XML. As it doesn&apos;t has the pair startToken and endToken.&lt;/p&gt;

&lt;p&gt;If you want to make your route support the those XML at the same time, you make consider to use the xpath expression like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;).split().xpath(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//child&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/span&gt;            }
        };
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You will get the result like this in you two test case, as you can see the result is unified. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;child anotherAttr=&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; some_attr=&quot;&lt;/span&gt;&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13561462" author="muellerc" created="Thu, 24 Jan 2013 07:18:27 +0000"  >&lt;p&gt;Greg is using tokenizeXML instead of XPath. I guess because XPath load the entire XML in memory (this was the intention of creating the tokenizeXML). So, may this is not a solution for him...&lt;/p&gt;</comment>
                            <comment id="13562037" author="gheidorn" created="Thu, 24 Jan 2013 22:02:55 +0000"  >&lt;p&gt;I swapped tokenizeXML for XPath and it worked well as expected.  Christian&apos;s memory concern is valid, however, in my case, it is an acceptable risk (I don&apos;t expect very large files).  I would, however, like to still see tokenizeXML operate on both tokens with closing tags and tokens that are self-closing.  I will think about how to approach a patch proposal that meets that requirement.  Willem, thanks for the reminder to xpath on split!&lt;/p&gt;</comment>
                            <comment id="13670277" author="muellerc" created="Thu, 30 May 2013 12:07:24 +0000"  >&lt;p&gt;I added the attached test to the Camel test suite. I annotated the failing test with @Ignore until somebody fixed it. Thanks Greg for the test case!&lt;/p&gt;</comment>
                            <comment id="13681032" author="ay" created="Wed, 12 Jun 2013 08:14:58 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I have a question to the camel team.&lt;/p&gt;

&lt;p&gt;I got distracted to this cute regex-based xml tokenizer and I made it work for both cases.&lt;/p&gt;

&lt;p&gt;However, the original approach itself has several inherent limitation in parsing a tree structure, namely handling of the same named elements appearing at different depths or extracting namespace declarations at several ancestor depths (the current approach only allows the extraction of additional namespace declarations from one particular depth specified by the inheritNamespaceToken parameter). So, it works perfect for those cases where the input document is constrained so that the splitting elements do not appear at different depths in hierarchy and any additional namespace declarations needed in the split elements come from one ancestor depth. But it does not work for more general cases.&lt;/p&gt;

&lt;p&gt;As long as the input document fits to the constraint, this regex-based approach is more efficient as it does not need to construct those xml artifacts that need to be serialized into a token. However, for other cases, it would be more practical to use a stax based tokenizer to build the valid namespace context and serialize the content into a token instead of purely relying on the regex based parsing.&lt;/p&gt;

&lt;p&gt;I don&apos;t know how typical use cases look and whether we can stay with or at least keep the regex-based approach or move to a stax based approach.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13690518" author="ay" created="Fri, 21 Jun 2013 17:54:31 +0000"  >&lt;p&gt;As commented in my previous reply, attached is a suggested fix that also works for empty elements.&lt;/p&gt;

&lt;p&gt;It passes the existing tokenizing tests and a few other new tests that are included in the patch file.&lt;/p&gt;

&lt;p&gt;I didn&apos;t directly change TokenXMLPairExpressionIterator but added its replacement TokenXMLExressionIterator and made ExpressionBuilder to use this new one instead. &lt;/p&gt;

&lt;p&gt;I was not sure if I should reuse TokenPairExpressionIterator by passing a dummy end pair tag and overwrite only the necessary methods, or not use it because the end-pairing logic could suggest an arbitrary start and end tag pairing which does not fit to xml tokenizing. I decided to the latter approach. We could add a neutral abstract class that has those commonly used methods and both can be extended from it. But in any case, you can see a regex-based approach to handle normal and empty xml elements.&lt;/p&gt;

&lt;p&gt;I would appreciate if you can review it.&lt;br/&gt;
thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="13691382" author="davsclaus" created="Sun, 23 Jun 2013 08:25:52 +0000"  >&lt;p&gt;Thanks Aki, for the patch. This is great.&lt;/p&gt;

&lt;p&gt;The old class has been marked as @deprecated. &lt;/p&gt;</comment>
                            <comment id="13858921" author="subrata1106" created="Mon, 30 Dec 2013 16:58:10 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am using service mix 4.5.3. Is this fixed in this release? If not please let me know how to install the patch.&lt;/p&gt;

&lt;p&gt;I am getting a similar issues where there are child nodes which are self closing and the tokenizer is creating malformed xml. I am hoping this will fix the issue I am getting also.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13859870" author="muellerc" created="Wed, 1 Jan 2014 12:22:36 +0000"  >&lt;p&gt;Apache ServiceMix comes with Camel 2.10.7 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. This means this issue should be fixed in this version.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://servicemix.apache.org/downloads/servicemix-4.5.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://servicemix.apache.org/downloads/servicemix-4.5.3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13860160" author="subrata1106" created="Thu, 2 Jan 2014 12:01:11 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Actually service mix 4.5.3 does not resolve this issue fully. Please see the sample input and output below when we have self closing tag. There seems to be a problem still &lt;font color=&quot;red&quot;&gt;if the first child element has self closing tag&lt;/font&gt;. Note - this does not seems to be an issue if any other child node has self closing tag except the first one.&lt;br/&gt;
&lt;b&gt;Input XML&lt;/b&gt;:&lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;orders&amp;gt;&lt;br/&gt;
    &amp;lt;order RECORDID=&quot;1&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;name/&amp;gt;&lt;br/&gt;
        &amp;lt;description&amp;gt;asdasd&amp;lt;/description&amp;gt;&lt;br/&gt;
        &amp;lt;price&amp;gt;7000&amp;lt;/price&amp;gt;&lt;br/&gt;
        &amp;lt;remark&amp;gt;testing&amp;lt;/remark&amp;gt;&lt;br/&gt;
    &amp;lt;/order&amp;gt;&lt;br/&gt;
    &amp;lt;order RECORDID=&quot;2&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;name/&amp;gt;&lt;br/&gt;
        &amp;lt;description&amp;gt;adasd&amp;lt;/description&amp;gt;&lt;br/&gt;
        &amp;lt;price&amp;gt;7000&amp;lt;/price&amp;gt;&lt;br/&gt;
        &amp;lt;remark&amp;gt;testing&amp;lt;/remark&amp;gt;&lt;br/&gt;
    &amp;lt;/order&amp;gt;&lt;br/&gt;
&amp;lt;/orders&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Camel XML&lt;/b&gt;:&lt;br/&gt;
        &amp;lt;camelContext xmlns=&quot;http://camel.apache.org/schema/blueprint&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;route&amp;gt;&lt;br/&gt;
			&amp;lt;from uri=&quot;file:camel/XMLInput&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;split streaming=&quot;true&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;tokenize token=&quot;order&quot; xml=&quot;true&quot;/&amp;gt;&lt;br/&gt;
				&amp;lt;to uri=&quot;file:camel/XMLOutput?fileName=RECORDID.xml&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;/split&amp;gt;&lt;br/&gt;
		&amp;lt;/route&amp;gt;&lt;br/&gt;
	&amp;lt;/camelContext&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;OUTPUT Generated&lt;/b&gt;: (malformed XML)&lt;br/&gt;
&amp;lt;order RECORDID=&quot;2&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;name/&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13861159" author="ay" created="Fri, 3 Jan 2014 03:32:02 +0000"  >&lt;p&gt;Hi subrata,&lt;br/&gt;
The issue which you are observing has been solved with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6940&quot; title=&quot;tokenize xml for splitter throwing org.xml.sax.SAXParseException; XML documents structures must start and end within the same entity. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6940&quot;&gt;&lt;del&gt;CAMEL-6940&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Concretely, &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6004&quot; title=&quot;Tokenize XML does not support self-closing XML tokens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6004&quot;&gt;&lt;del&gt;CAMEL-6004&lt;/del&gt;&lt;/a&gt; did not handle some cases when child elements of the split target element are self-terminated and this particular issue was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6940&quot; title=&quot;tokenize xml for splitter throwing org.xml.sax.SAXParseException; XML documents structures must start and end within the same entity. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6940&quot;&gt;&lt;del&gt;CAMEL-6940&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13861407" author="subrata1106" created="Fri, 3 Jan 2014 10:35:27 +0000"  >&lt;p&gt;Thanks Aki. The current service mix is using Version 2.10.7 of Camel. So I guess we need to wait for the next service mix release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12677736">CAMEL-6940</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12661890">CAMEL-6607</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12566239" name="GenericTokenizeTest.java" size="1615" author="gheidorn" created="Thu, 24 Jan 2013 02:23:33 +0000"/>
                            <attachment id="12589112" name="camel-6004.patch" size="16130" author="ay" created="Fri, 21 Jun 2013 17:54:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>308609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1cqq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>282461</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>