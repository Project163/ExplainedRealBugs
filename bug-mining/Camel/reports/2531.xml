<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:00:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6945] camel-netty-http producer should close the connection when the request connection header is close</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6945</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;camel-netty-http producer should close the connection when the request connection header is close otherwise it will get ClosedChannelException when the producer try to reuse the connection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678158">CAMEL-6945</key>
            <summary>camel-netty-http producer should close the connection when the request connection header is close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="njiang">Willem Jiang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Nov 2013 05:33:33 +0000</created>
                <updated>Mon, 11 Nov 2013 03:18:36 +0000</updated>
                            <resolved>Fri, 8 Nov 2013 08:56:48 +0000</resolved>
                                    <version>2.12.0</version>
                    <version>2.12.1</version>
                                    <fixVersion>2.12.2</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-netty-http</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13817125" author="njiang" created="Fri, 8 Nov 2013 08:56:48 +0000"  >&lt;p&gt;Applied the patch into master and camel-2.12.x branches.&lt;/p&gt;</comment>
                            <comment id="13817231" author="davsclaus" created="Fri, 8 Nov 2013 12:38:21 +0000"  >&lt;p&gt;I think we have a catch-22 situation here.&lt;/p&gt;

&lt;p&gt;Yeah this ticket about the netty http producer should close the connection if &quot;Connection: close&quot; is in the HTTP header, then that is correct. The missing piece was that the check was already there, but the binding code didn&apos;t set the Exhcange.CLOSE header. Though this code sets it as a property on the exchange. Should really be header instead to be consistent.&lt;/p&gt;

&lt;p&gt;Okay the catch-22 is when you bridge using netty-http, eg&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1..n clients
--&amp;gt;
from netty-http 
   to netty-http 
--&amp;gt;
  backend server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you have N+ clients on the outside that may have &quot;Connection: close&quot; in their http headers. So on the Camel server we have the catch-22 situation, because&lt;/p&gt;

&lt;p&gt;1. We want the netty http consumer to close the connection when the request is done (current code does that)&lt;br/&gt;
2. We most likely do not want to close connections between Camel and the backend server (to keep these connections alive and fast as possible)&lt;/p&gt;

&lt;p&gt;So we should have a better way of doing #2 to tell Camel it should disregard the &quot;Connection: close&quot; header but keep it alive between Camel and backend server. eg some way of configuring this better.&lt;/p&gt;

&lt;p&gt;Today we have the disconnect option people could use to force this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from netty-http 
   to netty-http?disconnect=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I am not sure if setting that disconnect option would have the http header override it, so if there is a http header with &quot;Connection: close&quot; it may take precedence and still close the connection on the netty http producer side.&lt;/p&gt;</comment>
                            <comment id="13818673" author="njiang" created="Mon, 11 Nov 2013 03:18:36 +0000"  >&lt;p&gt;If we want to proxy the request and keep using the connection, we need to change the header &quot;Connection: close&quot; to be &quot;Connection: keepalive&quot;, the proxy can be like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;netty-http:xxx&quot;&lt;/span&gt;).setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;connection&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;keep-alive&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;netty-http:yyy&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357533</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pmvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>