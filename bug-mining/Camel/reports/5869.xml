<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:49:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17009] camel-core - Camel does not clear MDC correctly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17009</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Unfortunately it looks that when MDC logging is enabled Camel does not clear MDC correctly.&lt;br/&gt;
After a Camel message is processed by a thread MDC fields like camel.breadcrumbId are not cleared. It causes a mess in application logs. For example after Jetty thread processes a Camel message then other HTTP requests may be included in logs filtered by specific camel.breadcrumbId, camel.exchangeId etc.&lt;/p&gt;

&lt;p&gt;I&apos;ve prepared a patch with a test that reproduces this problem (for branch main - Camel version 3.12.0-SNAPSHOT).&lt;/p&gt;

&lt;p&gt;This test is working (after small changes to be able to compile test with specific version) in Camel 2.25.3. Two tests out of three are passing in Camel versions between 3.0.0 and 3.8.0 (shouldPropagateAndClearMdcInSyncRoute() and shouldPropagateAndClearMdcInAsyncRoute()). Starting from Camel 3.9.0 all three tests are failing.&lt;/p&gt;

&lt;p&gt;It seems that tests shouldPropagateAndClearMdcInSyncRoute() and shouldPropagateAndClearMdcInAsyncRoute() started failing&lt;br/&gt;
because of a change in class UnitOfWorkHelper in commit 22c7af56 (&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16222&quot; title=&quot;camel-core - ExchangeFactory SPI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16222&quot;&gt;&lt;del&gt;CAMEL-16222&lt;/del&gt;&lt;/a&gt;: camel-core - ExchangeFactory SPI to allow to use exchange pooling).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13403655">CAMEL-17009</key>
            <summary>camel-core - Camel does not clear MDC correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="kmackowiak">Krzysztof Mackowiak</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Sep 2021 19:49:20 +0000</created>
                <updated>Thu, 17 Feb 2022 16:25:55 +0000</updated>
                            <resolved>Mon, 1 Nov 2021 08:36:02 +0000</resolved>
                                    <version>3.11.0</version>
                                    <fixVersion>3.13.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17421115" author="zhfeng" created="Tue, 28 Sep 2021 02:07:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmackowiak&quot; class=&quot;user-hover&quot; rel=&quot;kmackowiak&quot;&gt;kmackowiak&lt;/a&gt;&#160;it could be nice to raise a PR on &lt;a href=&quot;https://github.com/apache/camel/pulls&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pulls&lt;/a&gt;&#160;with your patch&lt;/p&gt;</comment>
                            <comment id="17421406" author="kmackowiak" created="Tue, 28 Sep 2021 13:52:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;&#160;Just to clarify: this patch contains only test reproducing the bug, it does not contain a fix. Do you still want me to create PR ?&lt;/p&gt;</comment>
                            <comment id="17421430" author="davsclaus" created="Tue, 28 Sep 2021 14:38:05 +0000"  >&lt;p&gt;Yeah a PR with the unit test helps to fix this.&lt;/p&gt;</comment>
                            <comment id="17422161" author="kmackowiak" created="Wed, 29 Sep 2021 14:26:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;&#160;I&apos;ve just added a PR with the test : :&#160;&lt;a href=&quot;https://github.com/apache/camel/pull/6179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6179&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17434192" author="davsclaus" created="Tue, 26 Oct 2021 08:32:01 +0000"  >&lt;p&gt;Okay so the MDC is getting more complicated in a reactive world. The code to setup and cleanup MDC from current exchange in the routing engine gets trickier.&lt;/p&gt;

&lt;p&gt;The sync can be fixed more easily as the UoW done should clean the MDC state, which wasn&apos;t happening. &lt;b&gt;DONE&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Find a way for async which is more tricky &lt;b&gt;DONE&lt;/b&gt; via &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17153&quot; title=&quot;afterprocess of UnitOfWork doesn&amp;#39;t work properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-17153&quot;&gt;&lt;del&gt;CAMEL-17153&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13408487">CAMEL-17134</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13429146">CAMEL-17676</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13409319">CAMEL-17153</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13423506">CAMEL-17514</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13034225" name="Clearing_MDC_in_Camel_.patch" size="4319" author="kmackowiak" created="Mon, 27 Sep 2021 19:48:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vcjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>