<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:55:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6069] java.io.IOException: Permission denied from MarkerFileExclusiveReadLockStrategy.acquireExclusiveReadLock on NAS</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6069</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We recently upgraded to 2.10.x and discovered that the file poller no longer works on our NAS. We have hit similar issues with other open source libraries in the past.&lt;/p&gt;

&lt;p&gt;The problem occurs when MarkerFileExclusiveReadLockStrategy.acquireExclusiveReadLock is called and tries to create the new file. This actually works but also results in a Permission denied IOException (strange but true). &lt;/p&gt;

&lt;p&gt;A simple fix for this is to change the acquireExclusiveReadLock method as follows. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; acquireExclusiveReadLock(GenericFileOperations&amp;lt;File&amp;gt; operations,
                                            GenericFile&amp;lt;File&amp;gt; file, Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; lockFileName = getLockFileName(file);
        LOG.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Locking the file: {} using the lock file name: {}&quot;&lt;/span&gt;, file, lockFileName);

        &lt;span class=&quot;code-comment&quot;&gt;// create a plain file as marker filer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; locking (&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not use FileLock)
&lt;/span&gt;        File lock = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(lockFileName);
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; acquired = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
        {
            acquired = lock.createNewFile();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lock.exists())
            {
                acquired = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; acquired;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the same problem occurring with Spring Batch can be found &lt;a href=&quot;https://jira.springsource.org/browse/BATCH-1659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12631881">CAMEL-6069</key>
            <summary>java.io.IOException: Permission denied from MarkerFileExclusiveReadLockStrategy.acquireExclusiveReadLock on NAS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="andersmholmgren">Anders Holmgren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Feb 2013 04:19:55 +0000</created>
                <updated>Wed, 18 Feb 2015 11:14:26 +0000</updated>
                            <resolved>Tue, 12 Feb 2013 08:47:09 +0000</resolved>
                                    <version>2.10.3</version>
                                    <fixVersion>2.10.4</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13576464" author="davsclaus" created="Tue, 12 Feb 2013 08:47:09 +0000"  >&lt;p&gt;Thanks for reporting.&lt;/p&gt;</comment>
                            <comment id="13578123" author="andersmholmgren" created="Thu, 14 Feb 2013 03:29:45 +0000"  >&lt;p&gt;thanks Claus&lt;/p&gt;</comment>
                            <comment id="14325721" author="barisacar" created="Wed, 18 Feb 2015 11:14:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andersmholmgren&quot; class=&quot;user-hover&quot; rel=&quot;andersmholmgren&quot;&gt;andersmholmgren&lt;/a&gt; - are you &lt;em&gt;certain&lt;/em&gt; that it was the thread/process that raised the exception that created the file, and not some other process?&lt;/p&gt;

&lt;p&gt;We are having problems with the current implementation as per your proposal, as it introduces race conditions into the locking mechanism, and allows multiple threads or processes to lock the same file at once.&lt;br/&gt;
See &lt;a href=&quot;http://camel.465427.n5.nabble.com/FileUtil-createNewFile-race-condition-issue-td5762853.html#a5762897&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.465427.n5.nabble.com/FileUtil-createNewFile-race-condition-issue-td5762853.html#a5762897&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hwon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312723</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>