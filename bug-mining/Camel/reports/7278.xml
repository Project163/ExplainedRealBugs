<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:12:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22581] OAuth may validate token audience incorrectly </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22581</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Tassos says:&lt;/p&gt;

&lt;p&gt;It seems that the camel-oauth library, while verifying the JWT token, the library expects the audience value to be equal to clientId. Is it by design or is it a bug? More specifically inside the &lt;b&gt;{&lt;/b&gt;}UserProfile.java{&lt;b&gt;}&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!target.isEmpty()) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!idToken &amp;amp;&amp;amp; jwtOptions.getAudience() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; el : jwtOptions.getAudience()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!target.contains(el)) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OAuthException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid JWT audience. expected: &quot;&lt;/span&gt; + el);
            }
        }
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!target.contains(config.getClientId())) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OAuthException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid JWT audience. expected: &quot;&lt;/span&gt; + config.getClientId());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, in OAuth2 access tokens, &quot;aud&quot; is normally the resource server (the API audience), not the client_id.&lt;/p&gt;

&lt;p&gt;If it is by design is it possibly to make the audience verification optional? When used on the client side it would make sense. Or is it there a way to configure that?&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Tassos&lt;/p&gt;

&lt;p&gt;PS: it is regarding to the client_credentials flow.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13632170">CAMEL-22581</key>
            <summary>OAuth may validate token audience incorrectly </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdiesler">Thomas Diesler</assignee>
                                    <reporter username="tdiesler">Thomas Diesler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Oct 2025 07:13:20 +0000</created>
                <updated>Tue, 28 Oct 2025 06:24:14 +0000</updated>
                            <resolved>Tue, 28 Oct 2025 06:24:14 +0000</resolved>
                                                    <fixVersion>4.16.0</fixVersion>
                                    <component>camel-oauth</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="18033178" author="tdiesler" created="Mon, 27 Oct 2025 10:48:52 +0000"  >&lt;p&gt;Generally ...&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;aud&lt;/tt&gt; = who the token is meant for.&lt;br/&gt;
Recipients must check it matches their identifier per &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7519#section-4.1.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RFC 7519 &#167;4.1.3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In case of an access_token, I believe is true what you say - aud would contain the resource identifier when given in the Authorization Request&lt;br/&gt;
In case of an id_token, the relying party (RP) (i.e. the Camel app) would need to verify that the issued id_token is indeed meant for the app, in which case aud must contain the client_id&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.1.3.7. &#160;ID Token Validation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I would relax the target audience check like this ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idToken &amp;amp;&amp;amp; !targetAudience.contains(clientId)) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OAuthException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid JWT audience. Expected to contain: &quot;&lt;/span&gt; + clientId);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1y928:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>