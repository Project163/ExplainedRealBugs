<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:06:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-20834] camel-salesforce - A NullPointException in SubscriptionHelper.subscribe() interrupts platform-event subscription</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-20834</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;It appears that when the &lt;tt&gt;SubscriptionHelper&lt;/tt&gt; attempts to reconnect and resubscribe to a channel in Salesforce, that occasionally and at an unpredictable rate, the &lt;tt&gt;subscriptionListener&lt;/tt&gt; instance in &lt;tt&gt;SubscriptionHelper.subscribe&lt;/tt&gt; throws an NPE when attempting to get the &lt;tt&gt;SUBSCRIPTION_FIELD&lt;/tt&gt; from the response message from Salesforce because in some cases that message does not contain a &lt;tt&gt;subscription&lt;/tt&gt; property in the JSON response.&lt;/p&gt;

&lt;p&gt;This results in the component seeming to &lt;/p&gt;

&lt;p&gt;This seems to be the offending line:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/streaming/SubscriptionHelper.java#L475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/streaming/SubscriptionHelper.java#L475&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The reconnection seem to happen, but never actually re-subscribes to the channel and therefore the flow of platform-events stops until the spring-boot application is restarted.&lt;/p&gt;

&lt;p&gt;Here is some of the associated logging:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[DEBUG]	2024-06-04 00:17:20,212	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #319 - SalesforceHttpClient ] - [CHANNEL:META_HANDSHAKE]: {ext={replay=true, payload.format=true}, minimumVersion=1.0, clientId=REDACTED, supportedConnectionTypes=[long-polling], channel=/meta/handshake, id=328, version=1.0, successful=true}
[DEBUG]	2024-06-04 00:17:20,227	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #320 - SalesforceHttpClient ] - [CHANNEL:META_CONNECT]: {clientId=REDACTED, advice={reconnect=retry, interval=0, timeout=110000}, channel=/meta/connect, id=329, successful=true}
[DEBUG]	2024-06-04 00:17:20,227	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #320 - SalesforceHttpClient ] - Refreshing subscriptions to 1 channels on reconnect
[INFO ]	2024-06-04 00:17:20,227	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #320 - SalesforceHttpClient ] - Subscribing to channel /event/M1SF_SObject_Capture__e...
[DEBUG]	2024-06-04 00:17:20,243	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #321 - SalesforceHttpClient ] - [CHANNEL:META_CONNECT]: {advice={reconnect=handshake, interval=0}, channel=/meta/connect, id=330, error=403::Unknown client, successful=false}
[WARN ]	2024-06-04 00:17:20,243	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #321 - SalesforceHttpClient ] - Connect failure: {advice={reconnect=handshake, interval=0}, channel=/meta/connect, id=330, error=403::Unknown client, successful=false}
[DEBUG]	2024-06-04 00:17:20,243	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #321 - SalesforceHttpClient ] - Advice != retry, so handshaking
[DEBUG]	2024-06-04 00:17:20,243	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #321 - SalesforceHttpClient ] - Begin handshake if not already in progress.
[DEBUG]	2024-06-04 00:17:20,269	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [SalesforceHttpClient@f13e0a2-34 ] - [CHANNEL:META_SUBSCRIBE]: {advice={reconnect=handshake, interval=0}, channel=/meta/subscribe, id=331, error=403::Unknown client, successful=false}
[INFO ]	2024-06-04 00:17:20,270	org.cometd.bayeux.client.ClientSession [SalesforceHttpClient@f13e0a2-34 ] - Exception while invoking listener org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper$5@704dd2c3
java.lang.NullPointerException: Cannot invoke &quot;Object.toString()&quot; because the return value of &quot;org.cometd.bayeux.Message.get(Object)&quot; is null
	at org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper$5.onMessage(SubscriptionHelper.java:452)
	at org.cometd.common.AbstractClientSession$AbstractSessionChannel.notifyOnMessage(AbstractClientSession.java:599)
	at org.cometd.common.AbstractClientSession$AbstractSessionChannel.notifyMessageListeners(AbstractClientSession.java:586)
	at org.cometd.common.AbstractClientSession.notifyListeners(AbstractClientSession.java:311)
	at org.cometd.common.AbstractClientSession.lambda$receive$4(AbstractClientSession.java:268)
	at org.cometd.bayeux.Promise$2.succeed(Promise.java:96)
	at org.cometd.common.AsyncFoldLeft$AbstractLoop.run(AsyncFoldLeft.java:236)
	at org.cometd.common.AsyncFoldLeft.run(AsyncFoldLeft.java:107)
	at org.cometd.common.AbstractClientSession.extendIncoming(AbstractClientSession.java:99)
	at org.cometd.common.AbstractClientSession.receive(AbstractClientSession.java:262)
	at org.cometd.client.BayeuxClient.processMessage(BayeuxClient.java:812)
	at org.cometd.client.BayeuxClient.processMessages(BayeuxClient.java:634)
	at org.cometd.client.BayeuxClient$MessageTransportListener.onMessages(BayeuxClient.java:1227)
	at org.cometd.client.http.common.AbstractHttpClientTransport.processResponseMessages(AbstractHttpClientTransport.java:178)
	at org.cometd.client.http.jetty.JettyHttpClientTransport.access$200(JettyHttpClientTransport.java:51)
	at org.cometd.client.http.jetty.JettyHttpClientTransport$ResponseListener.onComplete(JettyHttpClientTransport.java:285)
	at org.eclipse.jetty.client.transport.ResponseListeners.notifyComplete(ResponseListeners.java:350)
	at org.eclipse.jetty.client.transport.ResponseListeners.lambda$addCompleteListener$7(ResponseListeners.java:335)
	at org.eclipse.jetty.client.transport.ResponseListeners.notifyComplete(ResponseListeners.java:350)
	at org.eclipse.jetty.client.transport.ResponseListeners.notifyComplete(ResponseListeners.java:342)
	at org.eclipse.jetty.client.transport.HttpReceiver.terminateResponse(HttpReceiver.java:420)
	at org.eclipse.jetty.client.transport.HttpReceiver.terminateResponse(HttpReceiver.java:402)
	at org.eclipse.jetty.client.transport.HttpReceiver.lambda$responseSuccess$3(HttpReceiver.java:367)
	at org.eclipse.jetty.util.thread.SerializedInvoker$Link.run(SerializedInvoker.java:191)
	at org.eclipse.jetty.util.thread.SerializedInvoker.run(SerializedInvoker.java:117)
	at org.eclipse.jetty.client.transport.HttpReceiver.responseHeaders(HttpReceiver.java:243)
	at org.eclipse.jetty.client.transport.internal.HttpReceiverOverHTTP.lambda$headerComplete$2(HttpReceiverOverHTTP.java:435)
	at org.eclipse.jetty.client.transport.internal.HttpReceiverOverHTTP.parse(HttpReceiverOverHTTP.java:320)
	at org.eclipse.jetty.client.transport.internal.HttpReceiverOverHTTP.parseAndFill(HttpReceiverOverHTTP.java:250)
	at org.eclipse.jetty.client.transport.internal.HttpReceiverOverHTTP.receive(HttpReceiverOverHTTP.java:76)
	at org.eclipse.jetty.client.transport.internal.HttpChannelOverHTTP.receive(HttpChannelOverHTTP.java:97)
	at org.eclipse.jetty.client.transport.internal.HttpConnectionOverHTTP.onFillable(HttpConnectionOverHTTP.java:207)
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:322)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:99)
	at org.eclipse.jetty.io.ssl.SslConnection$SslEndPoint.onFillable(SslConnection.java:574)
	at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:390)
	at org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:150)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:99)
	at org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53)
	at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:478)
	at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:441)
	at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:293)
	at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:201)
	at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:311)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:979)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1209)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1164)
	at java.base/java.lang.Thread.run(Thread.java:833)
[DEBUG]	2024-06-04 00:17:20,326	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #322 - SalesforceHttpClient ] - [CHANNEL:META_HANDSHAKE]: {ext={replay=true, payload.format=true}, minimumVersion=1.0, clientId=REDACTED, supportedConnectionTypes=[long-polling], channel=/meta/handshake, id=332, version=1.0, successful=true}
[DEBUG]	2024-06-04 00:17:20,345	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #323 - SalesforceHttpClient ] - [CHANNEL:META_CONNECT]: {clientId=REDACTED, advice={reconnect=retry, interval=0, timeout=110000}, channel=/meta/connect, id=333, successful=true}
[DEBUG]	2024-06-04 00:19:10,361	org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper [Camel (camel-1) thread #324 - SalesforceHttpClient ] - [CHANNEL:META_CONNECT]: {clientId=REDACTED, channel=/meta/connect, id=334, successful=true}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This bug is causing the flow of play for events to stop unpredictably.  We have some alerting around this logging event, but it seems like this should be handled in code. I have attempted to try to catch this exception in the Camel route, but have not been successful.&lt;/p&gt;

&lt;p&gt;The message the SubscriptionHelper is try to parse is:&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{advice={reconnect=handshake, interval=0}, channel=/meta/subscribe, id=331, error=403::Unknown client, successful=false}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception while invoking listener org.apache.camel.component.salesforce.internal.streaming.SubscriptionHelper$5@704dd2c3
java.lang.NullPointerException: Cannot invoke &quot;Object.toString()&quot; because the return value of &quot;org.cometd.bayeux.Message.get(Object)&quot; is null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; subscribedChannelName = message.get(SUBSCRIPTION_FIELD).toString();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is producing the NPE and interrupting the subscription process.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Spring-Boot: 3.2.6&lt;br/&gt;
Camel: 4.5.0 or 4.6.0&lt;br/&gt;
Java: 17&lt;/p&gt;</environment>
        <key id="13581573">CAMEL-20834</key>
            <summary>camel-salesforce - A NullPointException in SubscriptionHelper.subscribe() interrupts platform-event subscription</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jasonholmberg">Jason</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jun 2024 19:38:57 +0000</created>
                <updated>Thu, 4 Jul 2024 02:44:37 +0000</updated>
                            <resolved>Tue, 18 Jun 2024 11:56:24 +0000</resolved>
                                    <version>4.5.0</version>
                    <version>4.6.0</version>
                                    <fixVersion>4.0.6</fixVersion>
                    <fixVersion>4.4.3</fixVersion>
                    <fixVersion>4.7.0</fixVersion>
                                    <component>camel-salesforce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                    <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13583777">CAMEL-20918</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pm68:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>