<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:00:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-18985] camel-kafka: messages are getting lost with &quot;breakOnFirstError&quot;</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-18985</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;b&gt;Description:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Messages are getting lost with &quot;breakOnFirstError=true&quot; when&#160;processing of a particular message failed several times in a raw.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Configuration:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;autoCommitEnable=false&lt;/li&gt;
	&lt;li&gt;allowManualCommit=true&lt;/li&gt;
	&lt;li&gt;breakOnFirstError=true&lt;/li&gt;
	&lt;li&gt;autoOffsetReset=earliest&lt;/li&gt;
	&lt;li&gt;maxPollRecords is greater than one (e.g. 5 in this test)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Scenario:&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;inbound-topic contains 10 messages: 0,1,2,3,4,5,6,7,8,9&lt;/li&gt;
	&lt;li&gt;camel-route polls 5 messages: 0,1,2,3,4&lt;/li&gt;
	&lt;li&gt;camel-route successfully processes message=0 and manually commits offset&lt;/li&gt;
	&lt;li&gt;camel-route successfully processes message=1 and manually commits offset&lt;/li&gt;
	&lt;li&gt;camel-route fails with processing message=2 first time&lt;/li&gt;
	&lt;li&gt;breakOnFirstError=true causes camel-route to reconnect and poll from the committed offset&lt;/li&gt;
	&lt;li&gt;camel-route polls 5 messages: 2,3,4,5,6&lt;/li&gt;
	&lt;li&gt;camel-route fails with processing message=2 second time&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;ACTUAL:&lt;/b&gt; camel-route reconnects and polls messages 7,8,9 - as result messages 3,4,5,6 are never processed&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;b&gt;EXPECTED:&lt;/b&gt; camel-route should do the following on the step 9:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;reconnect and poll the same 5 messages again: 2,3,4,5,6&lt;/li&gt;
	&lt;li&gt;process message=2 third time (the test is configured to succeed on the 3rd attempt)&lt;/li&gt;
	&lt;li&gt;continue with processing messages 3,4,5,6...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;GitHub project reproducing the issue:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Test-runs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;3.18.5 (failing): &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039702564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039702564&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;3.19.0 (failing): &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039815226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039815226&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;3.20.0 (failing): &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039709753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039709753&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;3.20.1 (failing): &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039673222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039673222&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;2.25.4 (passing): &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373&lt;/a&gt;&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Impact:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;It seems &quot;breakOnFirstError&quot; is not fully reliable in LTS versions of Camel Kafka component at the moment:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;3.20.x - due to this bug&lt;/li&gt;
	&lt;li&gt;3.18.x - due to this bug&lt;/li&gt;
	&lt;li&gt;3.14.x - due to another bug &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-17925&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-17925&lt;/a&gt; as fix was not back-ported to the 3.14.x&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13521955">CAMEL-18985</key>
            <summary>camel-kafka: messages are getting lost with &quot;breakOnFirstError&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="opershai">Oleg Pershai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jan 2023 01:59:41 +0000</created>
                <updated>Wed, 26 Apr 2023 15:31:30 +0000</updated>
                            <resolved>Wed, 26 Apr 2023 15:02:23 +0000</resolved>
                                    <version>3.18.5</version>
                    <version>3.19.0</version>
                    <version>3.20.0</version>
                    <version>3.20.1</version>
                    <version>4.0-M2</version>
                                    <fixVersion>3.18.7</fixVersion>
                    <fixVersion>3.20.5</fixVersion>
                    <fixVersion>3.21.0</fixVersion>
                    <fixVersion>4.0-M3</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17681968" author="orpiske" created="Mon, 30 Jan 2023 09:03:49 +0000"  >&lt;p&gt;I am assigning this one to me, so I can keep it my radar. But I don&apos;t have an ETC yet about when I&apos;ll be able to fix it, as I have a lot on the queue right now. &lt;/p&gt;

&lt;p&gt;Obs.: anyone with time/interest on working this, just drop a note here and feel free to work on it.&lt;/p&gt;</comment>
                            <comment id="17682694" author="JIRAUSER298839" created="Tue, 31 Jan 2023 18:48:08 +0000"  >&lt;p&gt;Just a quick note that old Camel Kafka Component v2.25.4 works as expected: &lt;a href=&quot;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17716461" author="JIRAUSER298839" created="Tue, 25 Apr 2023 21:49:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://github.com/apache/camel/pull/9932&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt;. Could you please take a look whether the suggested fix makes sense for you?&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;</comment>
                            <comment id="17716763" author="orpiske" created="Wed, 26 Apr 2023 15:02:23 +0000"  >&lt;p&gt;Fixed on main and back-ported to multiple branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fgns:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>