<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:48:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16707] camel-rabbitmq connection leak on error during &apos;declare&apos;</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16707</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;camel-rabbitmq component causes a connection leak when there is an error during declaration of exchanges/queues (e.g. when an exchange with the same name but different type already exists).&lt;/p&gt;

&lt;p&gt;Problem lies in &lt;tt&gt;org.apache.camel.component.rabbitmq.RabbitConsumer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    RabbitConsumer(RabbitMQConsumer consumer) {
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(channel);
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.consumer = consumer;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            Connection conn = consumer.getConnection();
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.channel = openChannel(conn);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException | TimeoutException e) {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to open channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; RabbitMQConsumer. Continuing and will &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again&quot;&lt;/span&gt;, e);
        }
    }

    &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Channel openChannel(Connection conn) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        Channel channel = &lt;span class=&quot;code-comment&quot;&gt;//... channel gets created
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (consumer.getEndpoint().isDeclare()) {
            consumer.getEndpoint().declareExchangeAndQueue(channel);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; channel;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if &lt;tt&gt;declareExchangeAndQueue&lt;/tt&gt; gets called, and if it throws an exception (e.g. because the exchange is already declared with different configuration) the exception is caught and consumed in the constructor, and the channel is never closed. I think the exception should be propagated in this case, because it is not recoverable (or at least there should be an option for this). It would also cause the app startup to fail, which would be a good thing in this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13383267">CAMEL-16707</key>
            <summary>camel-rabbitmq connection leak on error during &apos;declare&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rastislav.papp">Rastislav Papp</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jun 2021 19:22:53 +0000</created>
                <updated>Mon, 19 Jul 2021 10:58:53 +0000</updated>
                            <resolved>Mon, 14 Jun 2021 08:46:25 +0000</resolved>
                                    <version>3.6.0</version>
                                    <fixVersion>3.7.5</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                    <component>camel-rabbitmq</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17361388" author="davsclaus" created="Fri, 11 Jun 2021 04:31:32 +0000"  >&lt;p&gt;You are welcome to test with Camel 3.10.0 and also if still a bug, then try to fix and send a PR.&lt;br/&gt;
Also try testing with camel-spring-rabbitmq as its a better component than this.&lt;/p&gt;</comment>
                            <comment id="17361454" author="rastislav.papp" created="Fri, 11 Jun 2021 06:33:09 +0000"  >&lt;p&gt;I&apos;ve tried to look at 3.10.0 code, it seems unchanged. &lt;/p&gt;

&lt;p&gt;We&apos;ll probably migrate to the camel-spring-rabbitmq component in the future. In the meantime I have the fix in our fork, will try to submit PR.&lt;/p&gt;</comment>
                            <comment id="17361563" author="davsclaus" created="Fri, 11 Jun 2021 09:07:21 +0000"  >&lt;p&gt;Thanks a PR is much appreciated&lt;/p&gt;</comment>
                            <comment id="17362576" author="rastislav.papp" created="Sun, 13 Jun 2021 17:36:26 +0000"  >&lt;p&gt;I&apos;ve eventually found the connection leak at a different place. The PR is submitted &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17362828" author="davsclaus" created="Mon, 14 Jun 2021 08:46:57 +0000"  >&lt;p&gt;You are welcome to provide a PR for 3.7.x branch if possible&lt;/p&gt;</comment>
                            <comment id="17383254" author="rastislav.papp" created="Mon, 19 Jul 2021 10:58:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, the new camel-rabbitmq property &lt;tt&gt;recoverFromDeclareException&lt;/tt&gt; has a default value of true (so as not to change the previous behavior). It is declared in the in the component as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Metadata(label = &lt;span class=&quot;code-quote&quot;&gt;&quot;consumer&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recoverFromDeclareException = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and in the endpoint as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@UriParam(label = &lt;span class=&quot;code-quote&quot;&gt;&quot;consumer&quot;&lt;/span&gt;, defaultValue = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recoverFromDeclareException = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but the documentation page &lt;a href=&quot;https://camel.apache.org/components/3.7.x/rabbitmq-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/3.7.x/rabbitmq-component.html&lt;/a&gt;  says the default value is false. How come?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ruu8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>