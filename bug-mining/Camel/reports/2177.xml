<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:55:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5459] Folder closed too early when working asynchronously</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5459</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using a MailConsumer connected with IMAP to a mailserver and routing the messages to SEDA or any other asynchronous endpoint, &lt;br/&gt;
it can cause a com.sun.mail.util.FolderClosedIOException or javax.mail.FolderClosedException to happen if you are trying to process the mails/messages attachments.&lt;/p&gt;

&lt;p&gt;This is because the IMAP folder gets closed at the end of each MailConsumer.poll()&lt;br/&gt;
I propose to add a new MailConfiguration option &quot;closeFolder&quot;, which can override this behaviour.&lt;/p&gt;


&lt;p&gt;Here&apos;s an example on how to reproduce the problem. (Scala code, sorry! But it should be self-explanatory)&lt;br/&gt;
You need a couple of mails with attachments in your mailbox to test this. &lt;br/&gt;
~10 mails should be enough to cause the exceptions.&lt;/p&gt;



&lt;p&gt;import javax.mail.internet.MimeMultipart&lt;br/&gt;
import org.apache.camel.impl.DefaultCamelContext&lt;br/&gt;
import org.apache.camel.scala.dsl.builder.RouteBuilder&lt;br/&gt;
import scala.io.Source&lt;/p&gt;

&lt;p&gt;object Main { &lt;br/&gt;
  def main(args: Array&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    val camelContext = new DefaultCamelContext&lt;/p&gt;

&lt;p&gt;    val host = &quot;imap.gmail.com&quot;&lt;br/&gt;
    val username = &quot;*****@gmail.com&quot;&lt;br/&gt;
    val password = &quot;*****&quot;&lt;/p&gt;

&lt;p&gt;    // this will cause com.sun.mail.util.FolderClosedIOException or javax.mail.FolderClosedException&lt;br/&gt;
    val endpoint = &quot;imaps://&quot;&lt;ins&gt;host&lt;/ins&gt;&quot;?password=&quot;&lt;ins&gt;password&lt;/ins&gt;&quot;&amp;amp;username=&quot;&lt;ins&gt;username&lt;/ins&gt;&quot;&amp;amp;folderName=INBOX&amp;amp;unseen=false&amp;amp;disconnect=false&amp;amp;mapMailMessage=true&amp;amp;connectionTimeout=60000&quot;&lt;/p&gt;

&lt;p&gt;    // with fix / new feature &apos;closeFolder&apos; set to false&lt;br/&gt;
    //val endpoint = &quot;imaps://&quot;&lt;ins&gt;host&lt;/ins&gt;&quot;?password=&quot;&lt;ins&gt;password&lt;/ins&gt;&quot;&amp;amp;username=&quot;&lt;ins&gt;username&lt;/ins&gt;&quot;&amp;amp;folderName=INBOX&amp;amp;unseen=false&amp;amp;disconnect=false&amp;amp;mapMailMessage=true&amp;amp;connectionTimeout=60000&amp;amp;closeFolder=false&quot;&lt;/p&gt;

&lt;p&gt;    camelContext.addRoutes(&lt;br/&gt;
      new RouteBuilder {&lt;br/&gt;
        endpoint&lt;br/&gt;
        .to(&quot;seda:process&quot;)&lt;/p&gt;

&lt;p&gt;        from(&quot;seda:process?concurrentConsumers=5&quot;) ==&amp;gt; {&lt;br/&gt;
          process &lt;/p&gt;
{ ex =&amp;gt; 
            val att = ex.getIn.getBody.asInstanceOf[MimeMultipart].getBodyPart(1)
            println(&quot;Attachment Name:&quot; + att.getFileName)
            println(&quot;Attachment Content:&quot; + att.getDataHandler.getContent)
            println(&quot;Attachment Content:&quot; + Source.fromInputStream(att.getDataHandler.getInputStream).mkString)
            Thread.sleep(2500) // simulate some work being done here with the attachment, takes time..
          }
&lt;p&gt;        }&lt;br/&gt;
      }&lt;br/&gt;
    )&lt;/p&gt;

&lt;p&gt;    camelContext.start()&lt;br/&gt;
    Thread.sleep(45 * 1000)&lt;br/&gt;
    camelContext.stop()&lt;br/&gt;
  }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment>&lt;p&gt;IMAP connection to mailserver&lt;/p&gt;</environment>
        <key id="12599844">CAMEL-5459</key>
            <summary>Folder closed too early when working asynchronously</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jamesclonk">Fabio Berchtold</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Mon, 23 Jul 2012 12:57:42 +0000</created>
                <updated>Sun, 3 Feb 2013 09:56:13 +0000</updated>
                            <resolved>Sun, 3 Feb 2013 09:56:13 +0000</resolved>
                                    <version>2.10.0</version>
                                    <fixVersion>2.10.4</fixVersion>
                    <fixVersion>2.11.0</fixVersion>
                                    <component>camel-mail</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13420620" author="jamesclonk" created="Mon, 23 Jul 2012 12:58:48 +0000"  >&lt;p&gt;Patch for MailConsumer.java and MailConfiguration.java&lt;/p&gt;</comment>
                            <comment id="13569742" author="davsclaus" created="Sun, 3 Feb 2013 09:56:13 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12537562" name="camel-mail-closeFolder.patch" size="2275" author="jamesclonk" created="Mon, 23 Jul 2012 12:58:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0277z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10771</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>