<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:08:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21376] UseOriginalAggregationStrategy - null pointer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21376</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I found a case when NullPointerException occurs in&#160;&lt;br/&gt;
UseOriginalAggregationStrategy&apos;s aggregate method.&lt;br/&gt;
&#160;&lt;br/&gt;
I have this route configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.multicast(AggregationStrategies.useOriginal()).parallelProcessing()
.to(DIRECT_ROUTE1)
.to(DIRECT_ROUTE2) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
and in the DIRECT_ROUTE2 there is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 
.doTry() 
.unmarshal().zipFile()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the zip file is invalid there&apos;s exception handling in UseOriginalAggregationStrategy::aggregate method:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
exception = checkCaughtException(oldExchange, newExchange);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exception != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (original != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        original.setProperty(Exchange.EXCEPTION_CAUGHT, exception);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        oldExchange.setProperty(Exchange.EXCEPTION_CAUGHT, exception);   &lt;span class=&quot;code-comment&quot;&gt;//NULL POINTER oldExchange is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
I checked javadoc about this aggregate method it says that:&lt;br/&gt;
Params:&lt;br/&gt;
oldExchange - the oldest exchange (is null on first aggregation as we only have the new exchange)&lt;br/&gt;
&#160;&lt;br/&gt;
and I think this is what happens in my case when I get NullPointerException in line 78 (oldExchange is null):&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      oldExchange.setProperty(Exchange.EXCEPTION_CAUGHT, exception);
}
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When I create my own aggregation strategy based on UseOriginalAggregationStrategy and modify this `else` part everything works properly:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldExchange != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      oldExchange.setProperty(Exchange.EXCEPTION_CAUGHT, exception);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
I see that similar null check already exists in checkCaughtException method.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;The full stack trace can be found as attachment to this ticket.&lt;/p&gt;

&lt;p&gt;This error does not happen on Camel 4.4.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13596459">CAMEL-21376</key>
            <summary>UseOriginalAggregationStrategy - null pointer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gregrzn">Grzegorz Rozanski</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2024 09:54:25 +0000</created>
                <updated>Sun, 27 Oct 2024 11:46:43 +0000</updated>
                            <resolved>Sun, 27 Oct 2024 11:46:43 +0000</resolved>
                                    <version>4.8.0</version>
                                    <fixVersion>4.8.2</fixVersion>
                    <fixVersion>4.9.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17892125" author="davsclaus" created="Wed, 23 Oct 2024 11:48:37 +0000"  >&lt;p&gt;try with 4.8.1, we have fixed camel-zipfile.&lt;/p&gt;</comment>
                            <comment id="17892126" author="davsclaus" created="Wed, 23 Oct 2024 11:49:13 +0000"  >&lt;p&gt;But ideally that UseOriginalAggregationStrategy should check for != null as well, you are welcome to send a PR on main branch&lt;/p&gt;</comment>
                            <comment id="17892487" author="JIRAUSER307493" created="Thu, 24 Oct 2024 13:28:15 +0000"  >&lt;p&gt;I will try to verify it in coming days. If I find time I&apos;ll also create a PR. Thank you&lt;/p&gt;</comment>
                            <comment id="17892809" author="JIRAUSER307493" created="Fri, 25 Oct 2024 13:48:48 +0000"  >&lt;p&gt;I tested 4.8.1 and got the same error.&lt;br/&gt;
I created a PR here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/pull/16093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/16093&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks Claus!&lt;/p&gt;
</comment>
                            <comment id="17893213" author="davsclaus" created="Sun, 27 Oct 2024 11:46:43 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13072389" name="camel-null-pointer.log" size="6368" author="gregrzn" created="Wed, 23 Oct 2024 09:52:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s5wo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>