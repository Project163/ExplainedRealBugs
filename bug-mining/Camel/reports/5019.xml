<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:37:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13121] Route irc-&gt;irc cycles the message because of &quot;irc.target&quot; header</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13121</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Configure this route:&lt;/p&gt;

&lt;p&gt;from(&quot;irc://priv@localhost:6667/test1&quot;)&lt;br/&gt;
 .log(&quot;${headers}&quot;)&lt;br/&gt;
 .to(&quot;irc://chan@localhost:6667/test2&quot;);&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Send private message to user &lt;em&gt;priv.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Expected result:&lt;br/&gt;
 The message is routed to user &lt;em&gt;chan.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Actual result:&lt;/p&gt;

&lt;p&gt;The message is routed back to user &lt;em&gt;priv&lt;/em&gt; and enters an infinite loop&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Cause:&lt;/p&gt;

&lt;p&gt;Inside camel-core Pipeline, the IRC message has still its old target set in its properties.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13211552">CAMEL-13121</key>
            <summary>Route irc-&gt;irc cycles the message because of &quot;irc.target&quot; header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmvolod">Dmitry Volodin</assignee>
                                    <reporter username="rnetuka">Radovan Netuka</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jan 2019 13:34:41 +0000</created>
                <updated>Fri, 27 Sep 2019 13:46:36 +0000</updated>
                            <resolved>Fri, 27 Sep 2019 13:46:36 +0000</resolved>
                                    <version>2.21.0</version>
                                    <fixVersion>3.0.0.RC2</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                                    <component>camel-irc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16751153" author="dmvolod" created="Thu, 24 Jan 2019 14:01:14 +0000"  >&lt;p&gt;Please ask &lt;a href=&quot;https://gitter.im/apache/apache-camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitter.im/apache/apache-camel&lt;/a&gt; channel first. Note, that camel-core doesn&apos;t know nothing about irc or any other components...and can&apos;t be a cause&lt;/p&gt;

&lt;p&gt;If not, please submit a complete JUnit test case, but it&apos;s a minimal chance that is related to camel-core behavior, not camel-irc&lt;/p&gt;</comment>
                            <comment id="16751161" author="ancosen" created="Thu, 24 Jan 2019 14:10:45 +0000"  >&lt;p&gt;We have a camel-irc component and I guess this is a real issue. The problem is probably related on how the stuff is done.&lt;/p&gt;</comment>
                            <comment id="16751180" author="dmvolod" created="Thu, 24 Jan 2019 14:28:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt;, yes, I agree with you, it&apos;s looks like component default behavior and not related to camel-core. The producer takes&#160;IrcConstants.IRC_TARGET by default from the header populated by consumer.&lt;/p&gt;</comment>
                            <comment id="16751219" author="rnetuka" created="Thu, 24 Jan 2019 15:14:45 +0000"  >&lt;p&gt;The problem is there is field called &lt;em&gt;target&lt;/em&gt; in IrcMessage and that field is left intact during routing. This causes the message being sent to the former user when it reaches the SendProcessor.&lt;/p&gt;</comment>
                            <comment id="16751225" author="davsclaus" created="Thu, 24 Jan 2019 15:24:42 +0000"  >&lt;p&gt;You can remove that header as a workaround&lt;/p&gt;</comment>
                            <comment id="16751268" author="dmvolod" created="Thu, 24 Jan 2019 16:03:59 +0000"  >&lt;p&gt;org.apache.camel.component.irc.it.IrcRouteTest and org.apache.camel.component.irc.it.IrcPrivmsgTest also fails with java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;Need to be checked&lt;/p&gt;</comment>
                            <comment id="16752124" author="rnetuka" created="Fri, 25 Jan 2019 10:21:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;: I surely can&apos;t remove the &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-irc/src/main/java/org/apache/camel/component/irc/IrcMessage.java#L29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;target&lt;/a&gt;&#160;field&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16752130" author="dmvolod" created="Fri, 25 Jan 2019 10:31:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rnetuka&quot; class=&quot;user-hover&quot; rel=&quot;rnetuka&quot;&gt;rnetuka&lt;/a&gt;, it looks like not related to message target property. It takes this property from header &lt;a href=&quot;https://github.com/apache/camel/blob/e34b4f87d1aecf739c7dd142e480019dfa189848/components/camel-irc/src/main/java/org/apache/camel/component/irc/IrcProducer.java#L45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/e34b4f87d1aecf739c7dd142e480019dfa189848/components/camel-irc/src/main/java/org/apache/camel/component/irc/IrcProducer.java#L45&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will look at this issue more detail with real test case and server.&lt;/p&gt;</comment>
                            <comment id="16752131" author="davsclaus" created="Fri, 25 Jan 2019 10:33:47 +0000"  >&lt;p&gt;Just remove the header via &amp;lt;removeHeader&amp;gt; and the name is the value of the constant IrcConstants.IRC_TARGET&lt;/p&gt;</comment>
                            <comment id="16752139" author="rnetuka" created="Fri, 25 Jan 2019 10:41:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvolod&quot; class=&quot;user-hover&quot; rel=&quot;dmvolod&quot;&gt;dmvolod&lt;/a&gt; I have proposed solution in &lt;a href=&quot;https://github.com/rnetuka/camel-1/commit/35c57d4aca64be6d22c11af248e5eba02dd28f8a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rnetuka/camel-1/commit/35c57d4aca64be6d22c11af248e5eba02dd28f8a&lt;/a&gt;. See if it&apos;s of any use.&lt;/p&gt;</comment>
                            <comment id="16752141" author="ancosen" created="Fri, 25 Jan 2019 10:44:00 +0000"  >&lt;p&gt;It doesn&apos;t make sense to add a method to camel-core Pipeline for a corner case.&lt;/p&gt;</comment>
                            <comment id="16752142" author="dmvolod" created="Fri, 25 Jan 2019 10:48:35 +0000"  >&lt;p&gt;+1 to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt;, it could be better to change component logic rather than change a core behaivour for all.&lt;/p&gt;</comment>
                            <comment id="16752148" author="davsclaus" created="Fri, 25 Jan 2019 10:53:47 +0000"  >&lt;p&gt;Some of the other components did that too, and the workaround was to remove that header. The solution is to use another named header for overriding the target in the producer, and not use the name of the header from the consumer.&lt;/p&gt;
</comment>
                            <comment id="16937670" author="jondruse" created="Wed, 25 Sep 2019 12:10:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvolod&quot; class=&quot;user-hover&quot; rel=&quot;dmvolod&quot;&gt;dmvolod&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; I agree with your previous comments and removal of header is working in this case. &lt;br/&gt;
From my POV it would be nice to have a validation, which fail if message goes to target which is not defined in &quot;to&quot; endoint.&lt;br/&gt;
In the above case it will fail with validation error, because message is being sent to channel #test1, which is not defined as in endpoint .to(&quot;irc://chan@localhost:6667/test2&quot;);&lt;/p&gt;

&lt;p&gt;It is a simple change, which makes sense. It could be done by this: &lt;a href=&quot;https://github.com/JiriOndrusek/camel/commit/1f972395eac1ee998b7d7b790ba704f7e34466af#diff-c64bf7249f53d33cc5f9c65b8c9a9fe9R58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/JiriOndrusek/camel/commit/1f972395eac1ee998b7d7b790ba704f7e34466af#diff-c64bf7249f53d33cc5f9c65b8c9a9fe9R58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="16937697" author="dmvolod" created="Wed, 25 Sep 2019 12:46:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jondruse&quot; class=&quot;user-hover&quot; rel=&quot;jondruse&quot;&gt;jondruse&lt;/a&gt;, I think it could be possible solution to log an error for this case and could be applied via PR.&#160;&lt;/p&gt;</comment>
                            <comment id="16937755" author="davsclaus" created="Wed, 25 Sep 2019 13:55:42 +0000"  >&lt;p&gt;Lets just add a new header key that you use to send to a specific target instead of the configured name from the endpoint. Then the existing header is a read-only header. We do this in JMS etc, and other components.&lt;/p&gt;
</comment>
                            <comment id="16937792" author="jondruse" created="Wed, 25 Sep 2019 14:34:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvolod&quot; class=&quot;user-hover&quot; rel=&quot;dmvolod&quot;&gt;dmvolod&lt;/a&gt; Should I look into the header as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; suggested, or will you do it (because you are assignee to this issue)?&lt;/p&gt;</comment>
                            <comment id="16937824" author="dmvolod" created="Wed, 25 Sep 2019 15:10:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jondruse&quot; class=&quot;user-hover&quot; rel=&quot;jondruse&quot;&gt;jondruse&lt;/a&gt;, you are welcome to work on the PR, don&apos;t care about assignments.&lt;/p&gt;</comment>
                            <comment id="16938552" author="jondruse" created="Thu, 26 Sep 2019 12:32:57 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/camel/pull/3200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/3200&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve added new header &quot;irc.sendTo&quot; to define target destination of message. Route defined in this issue works with this change without modification.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure about correct processes here, but I think that this change should be mentioned in documentation for the component, as it ads new header for users to use.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13258725">CAMEL-14013</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi09mw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>