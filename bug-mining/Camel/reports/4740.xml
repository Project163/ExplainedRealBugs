<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:33:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12980] Bundle in &apos;Active&apos; State but Camel Context not initialized</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12980</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The camel context can&apos;t get initialized when validation of the RouteDefinition failed (e.g. typo in Uri or add an unsupported option in Uri), but when deploy the blueprint, the CamelContext startup and then shutdown, but the bundle status is still &apos;Active&apos;, only a FailedToCreateRouteException ERROR is logged.&lt;/p&gt;

&lt;p&gt;318 &#9474; Active  &#9474;  80 &#9474; 0.0.0                 &#9474; blueprint.xml&lt;/p&gt;

&lt;p&gt;Attached the simple blueprint.xml for reproduce it.&lt;/p&gt;

&lt;p&gt;The expected behaviour is the bundle is in the &apos;Failure&apos; status in this case.&lt;/p&gt;

&lt;p&gt;The fix proposal from my side is, move the call of &quot;this.maybeStart()&quot; from blueprintEvent() method to the constructor of the BlueprintCamelContext class. then this kind of Route definition error can be processed during the Blueprint &quot;CREATING&quot; phase. Currently, the start() is invoked after Blueprint in &quot;CREATED&quot; phase. (I tested this fix locally and have the expected &apos;Failure&apos; bundle status) &lt;/p&gt;

&lt;p&gt;(This issue is found in Camel 2.20.x, 2.21.x, but it may affects also on master branch)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13202715">CAMEL-12980</key>
            <summary>Bundle in &apos;Active&apos; State but Camel Context not initialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggrzybek">Grzegorz Grzybek</assignee>
                                    <reporter username="xldai">Xilai Dai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Dec 2018 07:47:08 +0000</created>
                <updated>Thu, 19 Dec 2019 17:30:04 +0000</updated>
                            <resolved>Fri, 11 Jan 2019 09:53:04 +0000</resolved>
                                    <version>2.20.1</version>
                    <version>2.21.1</version>
                                    <fixVersion>2.21.5</fixVersion>
                    <fixVersion>2.22.3</fixVersion>
                    <fixVersion>2.23.1</fixVersion>
                    <fixVersion>2.24.0</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>camel-blueprint</component>
                        <due></due>
                            <votes>5</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16724934" author="davsclaus" created="Wed, 19 Dec 2018 11:53:55 +0000"  >&lt;p&gt;Yeah noticed this with 2.24 as well.&lt;/p&gt;</comment>
                            <comment id="16724936" author="gzres" created="Wed, 19 Dec 2018 11:57:41 +0000"  >&lt;p&gt;Sorry I missed that - let me check&lt;/p&gt;</comment>
                            <comment id="16724942" author="gzres" created="Wed, 19 Dec 2018 12:03:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt; moved the initialization to after &lt;tt&gt;BlueprintEvent.CREATED&lt;/tt&gt; state.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;Active&lt;/tt&gt; in &lt;tt&gt;318 &#9474; Active &#9474; 80 &#9474; 0.0.0 &#9474; blueprint.xml&lt;/tt&gt; means the &lt;em&gt;bundle&lt;/em&gt; is active. You should however not treat &lt;em&gt;bundle&lt;/em&gt; and its &lt;em&gt;blueprint container&lt;/em&gt; as the same thing!&lt;br/&gt;
A &lt;em&gt;bundle&lt;/em&gt; should be treated as kind of &lt;em&gt;carrier&lt;/em&gt; of blueprint description, which is then processed by &lt;em&gt;blueprint extender&lt;/em&gt;, which monitors bundles being installed, resolved, started and stopped. &lt;em&gt;blueprint extender&lt;/em&gt; may pick up your &lt;b&gt;started&lt;/b&gt; bundle and &lt;em&gt;attempt&lt;/em&gt; processing the blueprint descriptor it carries.&lt;/p&gt;

&lt;p&gt;You can imagine a bundle that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;creates a thread that waits till next Halloween&lt;/li&gt;
	&lt;li&gt;this thread registers blueprint container manually&lt;/li&gt;
	&lt;li&gt;this thread fails&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t think moving back &lt;tt&gt;this.maybeStart()&lt;/tt&gt; to constructor is good idea. Events are the way to synchronize actions within OSGi. And it&apos;s perfectly fine that &lt;em&gt;active&lt;/em&gt; bundle wasn&apos;t correctly processed by &lt;em&gt;blueprint extender&lt;/em&gt;. Such bundle may do many other things that don&apos;t fail (register OSGi services manually, register SCR components or alter CM configurations).&lt;/p&gt;</comment>
                            <comment id="16724943" author="gzres" created="Wed, 19 Dec 2018 12:04:27 +0000"  >&lt;p&gt;Even if you drop &lt;tt&gt;blueprint.xml&lt;/tt&gt; file to &lt;tt&gt;deploy/&lt;/tt&gt; it doesn&apos;t matter - it&apos;s wrapped inside a bundle that&apos;s started/activated and &lt;em&gt;blueprint extender&lt;/em&gt; processes the XML - despite it&apos;s the &lt;b&gt;only&lt;/b&gt; thing such bundle provides.&lt;/p&gt;</comment>
                            <comment id="16724950" author="davsclaus" created="Wed, 19 Dec 2018 12:17:40 +0000"  >&lt;p&gt;Yeah but the big problem for the normal user of Camel on OSGi Blueprint is that their Camel application failed to startup and they can&apos;t see this in the list which they used to do in the past. eg this is how camel-blueprint runs on OSGi, not some vanilla blueprint app that are NOT using Camel.&lt;/p&gt;

&lt;p&gt;If you run the same Camel application outside OSGi such as standalone then it will fail to start and an exception is thrown and the JVM terminated. &lt;/p&gt;

&lt;p&gt;So we should somehow get the failure to startup the CamelContext (due to thrown exception) propagatede into blueprint and let the bundle go into some kind of error state. &lt;/p&gt;
</comment>
                            <comment id="16724953" author="gzres" created="Wed, 19 Dec 2018 12:23:14 +0000"  >&lt;p&gt;True. Because blueprint should &lt;em&gt;break&lt;/em&gt; after CREATED. TBH we had already several problems with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt;... Let me think about it.&lt;/p&gt;</comment>
                            <comment id="16725535" author="xldai" created="Thu, 20 Dec 2018 02:53:46 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggrzybek&quot; class=&quot;user-hover&quot; rel=&quot;ggrzybek&quot;&gt;ggrzybek&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Yes, moving maybeStart() to constructor is not good, it also breaks many of the &quot;unit test&quot; and &quot;itest&quot; in the Camel tests/camel-blueprint-test and tests/camel-itest-osgi.&lt;/p&gt;

&lt;p&gt;Maybe the BlueprintComponentResolver can be extended a bit? or something like an &quot;URIResolver&quot; can be introduced to do this kind of validation. (Currently, given a wrong component name e.g (&quot;aaatimer:&quot; insteadof &quot;timer:&quot;) in the blueprint xml, the the blueprint bundle is in &quot;GracePeriod&quot; status and finally &quot;Failure&quot; status after timeout.)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Bundle blueprint.xml/0.0.0 is waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; dependencies [(&amp;amp;(component=aaatimer)(objectClass=org.apache.camel.spi.ComponentResolver))]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16725628" author="davsclaus" created="Thu, 20 Dec 2018 07:17:26 +0000"  >&lt;p&gt;The problem with using a component name that has not been installed is fine IMHO. It allows the bundle to wait a bit for it to be installed and fail after the timeout.&lt;/p&gt;

&lt;p&gt;Its the other problems that are worse when Camel cannot startup due to an exception on startup, which should cause the bundle to be in Failure state and not Active as today. &lt;/p&gt;</comment>
                            <comment id="16725642" author="xldai" created="Thu, 20 Dec 2018 07:44:09 +0000"  >&lt;p&gt;I was not clear enough ~&lt;/p&gt;

&lt;p&gt;I didn&apos;t blame the behaviour when component name is wrong, it&apos;s good and expected status (&quot;Failure&quot;). I meant that any possibility if the BlueprintComponentResolver can be enhanced to also doing the URI validation for fix this Jira issue.&lt;/p&gt;</comment>
                            <comment id="16726768" author="davsclaus" created="Fri, 21 Dec 2018 14:19:17 +0000"  >&lt;p&gt;No&lt;/p&gt;

&lt;p&gt;But there is some existing Camel tooling that can check your source code and report potential issues. See the maven tooling validate at:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/blob/master/tooling/maven/camel-maven-plugin/src/main/docs/camel-maven-plugin.adoc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/tooling/maven/camel-maven-plugin/src/main/docs/camel-maven-plugin.adoc&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="16735642" author="gzres" created="Mon, 7 Jan 2019 10:28:19 +0000"  >&lt;p&gt;I read again through &lt;a href=&quot;https://github.com/apache/camel/pull/1297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1297&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt; and tbh, I prefer &lt;b&gt;not to&lt;/b&gt; revert &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt; (as this &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12980&quot; title=&quot;Bundle in &amp;#39;Active&amp;#39; State but Camel Context not initialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12980&quot;&gt;&lt;del&gt;CAMEL-12980&lt;/del&gt;&lt;/a&gt; is effectively a revert of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;What convinced me is:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The example would fail if the autoStartup=&quot;false&quot; attribute were present in the XML as well&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed, starting (optionally) a Camel context after &lt;tt&gt;BlueprintEvent.CREATED&lt;/tt&gt; separates Blueprint and Camel lifecycles. While there&apos;s one benefit of not doing it:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;seeing &lt;tt&gt;Failed&lt;/tt&gt; in a list of bundles&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think there are more drawbacks:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;handling contexts with &lt;em&gt;auto startup&lt;/em&gt; set to &lt;tt&gt;false&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;suggesting that Camel context &lt;b&gt;is&lt;/b&gt; blueprint container, but a container for bundle may declare more contexts and/or also one context may be implemented in different bundles (importing routes defined in separate bundles)&lt;/li&gt;
	&lt;li&gt;reviewing all the adjustments we had to make after accepting &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In my opinion it&apos;s better to use dedicated Camel commands to check status of Camel contexts/routes.&lt;/p&gt;</comment>
                            <comment id="16735653" author="davsclaus" created="Mon, 7 Jan 2019 10:45:26 +0000"  >&lt;p&gt;Yeah we had some hard problems with blueprint and lifecycle between camel, blueprint and osgi/karaf. The last many years it has been stable after the work of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt;. So maybe we can find an alternative solution if there is some way of having some event notification or background thread that tracks the startup of the camel context and can report &quot;somehow&quot; to osgi/karaf/blueprint.&lt;/p&gt;

&lt;p&gt;And we could also see if the existing camel karaf commands can show the state of all bundles with camel, then you can find which bundles are in error etc. &lt;/p&gt;</comment>
                            <comment id="16735666" author="gzres" created="Mon, 7 Jan 2019 11:01:22 +0000"  >&lt;p&gt;+1 for enhancing &lt;tt&gt;camel:context-list&lt;/tt&gt; (&lt;tt&gt;org.apache.camel.commands.ContextListCommand&lt;/tt&gt;) command instead.&lt;/p&gt;

&lt;p&gt;Unfortunately, now, &lt;tt&gt;camel:context-list&lt;/tt&gt; doesn&apos;t return any blueprint-based Camel context that has failed - because relevant OSGi service (&lt;tt&gt;(objectClass=org.apache.camel.CamelContext)&lt;/tt&gt;) is not registered.&lt;/p&gt;</comment>
                            <comment id="16739262" author="owulff" created="Thu, 10 Jan 2019 10:04:06 +0000"  >&lt;p&gt;This issue becomes more critical when your camel route publishes CXF endpoints. Blueprint will then start the CXF endpoints successfully but something else goes wrong with the route initialization. The CXF endpoints are successfully published (including the initialization of some CXF features which registers at a central service) but they can&apos;t be called via SOAP/REST because the camel route is not started successfully.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;IMHO, the OSGi specification states the following that a&#160;bundle is in the&#160;&lt;tt&gt;ACTIVE&lt;/tt&gt;&#160;state when it has been successfully started and activated.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://osgi.org/javadoc/r4v43/core/org/osgi/framework/Bundle.html#ACTIVE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://osgi.org/javadoc/r4v43/core/org/osgi/framework/Bundle.html#ACTIVE&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If the bundle uses Camel for its implementation, the bundle should not be in ACTIVE mode when something went wrong during the initialization. Further, all beans which has been initialized should be properly removed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The implementation for spring-dm works perfectly fine. I think it should work in the same way for blueprint.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16739379" author="gzres" created="Thu, 10 Jan 2019 13:16:33 +0000"  >&lt;p&gt;I understand the problem... &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10513&quot; title=&quot;Start BlueprintCamelContext on BlueprintEvent.CREATED&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10513&quot;&gt;&lt;del&gt;CAMEL-10513&lt;/del&gt;&lt;/a&gt; was a big change, but actually not against any specification... It&apos;s especially true with context using &lt;tt&gt;autoStart=&quot;false&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A bundle is in the ACTIVE state when it has been successfully started and activated. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;means exactly this - &quot;activated&quot; == &quot;called BundleActivator.start()&quot; which is NOT the same as successfully starting Camel Context or &lt;b&gt;even&lt;/b&gt; creating Blueprint Container.&lt;/p&gt;

&lt;p&gt;But if we look at blueprint specification:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;b&gt;121.3.2.2 Failure&lt;/b&gt;&lt;br/&gt;
If at any time there is a failure, the Blueprint Container must:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;State = FAILURE&lt;/li&gt;
	&lt;li&gt;Unregister the Blueprint Container service.&lt;/li&gt;
	&lt;li&gt;Destroy the Blueprint Container.&lt;/li&gt;
	&lt;li&gt;Wait for the Blueprint bundle to be stopped.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;Which may be a reason to call back from failed Camel context/route to their blueprint container.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.osgi.service.blueprint.container.BlueprintContainer&lt;/tt&gt; doesn&apos;t have any such callback methods, but &lt;tt&gt;org.apache.aries.blueprint.services.ExtendedBlueprintContainer&lt;/tt&gt; may be called to grab &lt;tt&gt;org.osgi.service.blueprint.container.BlueprintListener&lt;/tt&gt; to send Failure event like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ExtendedBlueprintContainer.getEventDispatcher().blueprintEvent(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlueprintEvent(BlueprintEvent.FAILURE, getBundle(), getExtenderBundle(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Throwable(&lt;span class=&quot;code-quote&quot;&gt;&quot;Camel context says: oops&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then Karaf would catch such event using &lt;tt&gt;org.apache.karaf.bundle.state.blueprint.internal.BlueprintStateService&lt;/tt&gt; and alter output of &lt;tt&gt;bundle:list&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think it&apos;s doable.&lt;/p&gt;

&lt;p&gt;The problem/confusion may be with this scenario:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;bundle with blueprint.xml and Camel Context using autostart=false is installed/started&lt;/li&gt;
	&lt;li&gt;blueprint is successfull&lt;/li&gt;
	&lt;li&gt;bundle is ACTIVE&lt;/li&gt;
	&lt;li&gt;one year later someone actually starts Camel context&lt;/li&gt;
	&lt;li&gt;bundle becomes FAILED&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;no problem for me, but may be confusing for others.&lt;/p&gt;</comment>
                            <comment id="16739394" author="owulff" created="Thu, 10 Jan 2019 13:39:28 +0000"  >&lt;p&gt;I agree with you it&apos;s true if autoStart is false. In this case, the bundle developer explicitly decides (default is autoStart=true) that the bundle is properly started and active without starting the camel context. In the other case, the bundle developer decides or assumes that the bundle is properly started and active if starting the camel context is successfull as well.&lt;/p&gt;

&lt;p&gt;This is working as described for Spring-DM and standalone, but different for Blueprint.&lt;/p&gt;

&lt;p&gt;If the lifecycle of blueprint and camel is not aligned you end up with half-way startup as explained above. CXF endpoints published via HTTP but the route with the CXF endpoints is not started.&lt;/p&gt;</comment>
                            <comment id="16739403" author="davsclaus" created="Thu, 10 Jan 2019 13:45:43 +0000"  >&lt;p&gt;autoStartup=false means only the routes are not started. CamelContext is ALWAYS started.&lt;/p&gt;</comment>
                            <comment id="16739409" author="jbonofre" created="Thu, 10 Jan 2019 13:52:09 +0000"  >&lt;p&gt;I would extend to blueprint lifecycle.&lt;/p&gt;</comment>
                            <comment id="16739410" author="davsclaus" created="Thu, 10 Jan 2019 13:52:11 +0000"  >&lt;p&gt;In Gregors example then with autoStartup=false, we should just &quot;see this&quot; as a camel context with 0 routes. Its something the user explicit decided to not start the routes on startup. When he/she start them later, then errors may happen, just as it can happen later on if you start/stop routes at runtime etc. I think in this situation the bundle should still be active.&lt;/p&gt;

&lt;p&gt;But in the normal use-case I also think that its ideal that the bundle becomes failed if CamelContext cannot fully startup and run successfully.&lt;/p&gt;</comment>
                            <comment id="16739411" author="gzres" created="Thu, 10 Jan 2019 13:52:20 +0000"  >&lt;p&gt;Thanks. But because it&apos;s &lt;tt&gt;FailedToCreateRouteException&lt;/tt&gt;, I assume that anything may break at any time, so looks like Camel-specific &lt;tt&gt;org.apache.karaf.bundle.core.BundleStateService&lt;/tt&gt; (there&apos;s already scr, blueprint and spring-dm specific) implementation is the best idea (for now).&lt;/p&gt;</comment>
                            <comment id="16739421" author="jbonofre" created="Thu, 10 Jan 2019 13:58:31 +0000"  >&lt;p&gt;I would do the following:&lt;/p&gt;

&lt;p&gt;1. &lt;tt&gt;BlueprintCamelContext&lt;/tt&gt; could register an Camel implement of Karaf &lt;tt&gt;BundleStateService&lt;/tt&gt;. It could be optional if the user doesn&apos;t want to run Camel in Karaf (even I think it never happens &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;br/&gt;
2. We hook the camel context/route lifecycle to the bundle thanks to this service&lt;br/&gt;
3. Thanks to this light &lt;tt&gt;BundleStateService&lt;/tt&gt; service, we can retrieve all failing info, and react accordingly&lt;/p&gt;

&lt;p&gt;Just my $0.01.&lt;/p&gt;</comment>
                            <comment id="16740200" author="gzres" created="Fri, 11 Jan 2019 09:21:55 +0000"  >&lt;p&gt;OK, Here&apos;s what I did. With sample blueprint.xml with &lt;b&gt;two&lt;/b&gt; contexts (one bad, one correct):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;blueprint xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;r1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;timer://simpleTimer?period=1000&amp;amp;amp;repeatCount=0&amp;amp;amp;funnyopt=1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;setBody&amp;gt;&lt;/span&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;simple&amp;gt;&lt;/span&gt;Hello World 1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/simple&amp;gt;&lt;/span&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/setBody&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/route&amp;gt;&lt;/span&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/camelContext&amp;gt;&lt;/span&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;r2&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;timer://simpleTimer?period=1000&amp;amp;amp;repeatCount=0&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;setBody&amp;gt;&lt;/span&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;simple&amp;gt;&lt;/span&gt;Hello World 2&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/simple&amp;gt;&lt;/span&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/setBody&amp;gt;&lt;/span&gt; 
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;log:test&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/route&amp;gt;&lt;/span&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/camelContext&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/blueprint&amp;gt;&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve installed it using &lt;tt&gt;install -s blueprint:&lt;a href=&quot;file:///data/tmp/blueprint.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///data/tmp/blueprint.xml&lt;/a&gt;&lt;/tt&gt; and saw:&lt;/p&gt;

&lt;p&gt;Working and visible context 2:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; context-list
 Context        Status              Total #       Failed #     Inflight #   Uptime         
 -------        ------              -------       --------     ----------   ------         
 camel-4        Started                   7              0              0   7.662 seconds  
karaf@root()&amp;gt; route-list
 Context        Route          Status              Total #       Failed #     Inflight #   Uptime         
 -------        -----          ------              -------       --------     ----------   ------         
 camel-4        r2             Started                   9              0              0   9.213 seconds  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Correct state for a bundle:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; la -l|grep blueprint.xml
65 &#9474; Failure  &#9474;  80 &#9474; 0.0.0           &#9474; blueprint:file:///data/tmp/blueprint.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additional diagnostic information:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; bundle:diag 65
Bundle 65
---------
Status: Failure
Camel Blueprint
Camel context &quot;camel-1&quot;
Exception: Failed to create route r1: Route(r1)[[From[timer://simpleTimer?period=1000&amp;amp;repeatCount=... because of Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri if the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{funnyopt=1}]
org.apache.camel.FailedToCreateRouteException: Failed to create route r1: Route(r1)[[From[timer://simpleTimer?period=1000&amp;amp;repeatCount=... because of Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri if the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{funnyopt=1}]
	at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:217)
	at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:1140)
	at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:3735)
	at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:3440)
	at org.apache.camel.impl.DefaultCamelContext$4.call(DefaultCamelContext.java:3248)
	at org.apache.camel.impl.DefaultCamelContext$4.call(DefaultCamelContext.java:3244)
	at org.apache.camel.impl.DefaultCamelContext.doWithDefinedClassLoader(DefaultCamelContext.java:3267)
	at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:3244)
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:72)
	at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:3160)
	at org.apache.camel.blueprint.BlueprintCamelContext.start(BlueprintCamelContext.java:254)
	at org.apache.camel.blueprint.BlueprintCamelContext.maybeStart(BlueprintCamelContext.java:296)
	at org.apache.camel.blueprint.BlueprintCamelContext.blueprintEvent(BlueprintCamelContext.java:187)
	at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:190)
	at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:188)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri if the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{funnyopt=1}]
	at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:753)
	at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:80)
	at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:227)
	at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:116)
	at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:122)
	at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:75)
	at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:98)
	at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:1332)
	at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:212)
	... 24 more
Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri if the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{funnyopt=1}]
	at org.apache.camel.impl.DefaultComponent.validateParameters(DefaultComponent.java:215)
	at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:139)
	at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:706)
	... 32 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After stopping the bundle, the status is correct and contexts are gone:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; context-list
karaf@root()&amp;gt; bundle:diag 65
karaf@root()&amp;gt; la -l|grep blueprint.xml
65 &#9474; Resolved &#9474;  80 &#9474; 0.0.0           &#9474; blueprint:file:///data/tmp/blueprint.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There&apos;s single instance of new &lt;tt&gt;BundleStateService&lt;/tt&gt; exposed from blueprint bundle (regardles of number of contexts it exposes):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; bundle:services -p 65                                                                              

Bundle 65 provides:
-------------------
objectClass = [org.apache.karaf.bundle.core.BundleStateService]
service.bundleid = 65
service.id = 156
service.scope = singleton
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This new service is used by &lt;tt&gt;org.apache.camel.blueprint.BlueprintCamelContext#start()&lt;/tt&gt; to track state of the bundle and context.&lt;/p&gt;

&lt;p&gt;After fixing first camel context we see the state changed and diagnostic info removed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; context-list
 Context        Status              Total #       Failed #     Inflight #   Uptime         
 -------        ------              -------       --------     ----------   ------         
 camel-7        Started                   6              0              0   6.989 seconds  
 camel-8        Started                   6              0              0   6.963 seconds  
karaf@root()&amp;gt; bundle:diag 65
karaf@root()&amp;gt; la -l|grep blueprint.xml
65 &#9474; Active   &#9474;  80 &#9474; 0.0.0           &#9474; blueprint:file:///data/tmp/blueprint.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And blueprint bundle exposes 6 services:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; bundle:services 65

Bundle 65 provides:
-------------------
[org.apache.karaf.bundle.core.BundleStateService]
[org.osgi.service.blueprint.container.BlueprintListener]
[org.osgi.service.blueprint.container.BlueprintListener]
[org.osgi.service.blueprint.container.BlueprintContainer]
[org.apache.camel.CamelContext]
[org.apache.camel.CamelContext]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;camel-blueprint bundle imports additional package (optionally):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.karaf.bundle.core;resolution:=optional;version=&quot;[4,5)&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If (somehow), this package is not available (wrong Karaf version or no Karaf at all), everything works fine, but bundle is Active (again, with one correct and one broken context):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; bundle:diag 65
karaf@root()&amp;gt; la -l|grep blueprint.xml
65 &#9474; Active   &#9474;  80 &#9474; 0.0.0           &#9474; blueprint:file:///data/tmp/blueprint.xml
karaf@root()&amp;gt; context-list
 Context        Status              Total #       Failed #     Inflight #   Uptime          
 -------        ------              -------       --------     ----------   ------          
 camel-4        Started                  18              0              0   18.667 seconds  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And no extra, Karaf-related OSGi service is exposed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; bundle:services 65

Bundle 65 provides:
-------------------
[org.osgi.service.blueprint.container.BlueprintListener]
[org.osgi.service.blueprint.container.BlueprintListener]
[org.osgi.service.blueprint.container.BlueprintContainer]
[org.apache.camel.CamelContext]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there&apos;s actual Blueprint (non-Camel) problem, we can see it too:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;karaf@root()&amp;gt; la -l|grep 65
65 &#9474; Failure  &#9474;  80 &#9474; 0.0.0           &#9474; blueprint:file:///data/tmp/blueprint.xml
karaf@root()&amp;gt; bundle:diag 65                                                                                 
Bundle 65
---------
Status: Failure
Blueprint
1/11/19 10:38 AM
Exception: 
Unable to validate xml
org.osgi.service.blueprint.container.ComponentDefinitionException: Unable to validate xml
	at org.apache.aries.blueprint.parser.Parser.validate(Parser.java:349)
	at org.apache.aries.blueprint.parser.Parser.validate(Parser.java:336)
	at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:345)
	at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:278)
	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:299)
	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:268)
	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:264)
	at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:254)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422)
	at org.apache.felix.framework.util.SecureAction.invokeBundleEventHook(SecureAction.java:1179)
	at org.apache.felix.framework.EventDispatcher.createWhitelistFromHooks(EventDispatcher.java:730)
	at org.apache.felix.framework.EventDispatcher.fireBundleEvent(EventDispatcher.java:485)
	at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4579)
	at org.apache.felix.framework.Felix.startBundle(Felix.java:2174)
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:998)
	at org.apache.karaf.bundle.command.Start.executeOnBundle(Start.java:38)
	at org.apache.karaf.bundle.command.BundlesCommand.doExecute(BundlesCommand.java:65)
	at org.apache.karaf.bundle.command.BundlesCommand.execute(BundlesCommand.java:55)
	at org.apache.karaf.shell.impl.action.command.ActionCommand.execute(ActionCommand.java:84)
	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:68)
	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:86)
	at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:599)
	at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:526)
	at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:415)
	at org.apache.felix.gogo.runtime.Pipe.doCall(Pipe.java:416)
	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:229)
	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:59)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.xml.sax.SAXParseException; cvc-complex-type.2.4.c: The matching wildcard is strict, but no declaration can be found for element &apos;camelaContext&apos;.
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)
	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:134)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:396)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)
	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:284)
	at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator$XSIErrorReporter.reportError(XMLSchemaValidator.java:453)
	at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.reportSchemaError(XMLSchemaValidator.java:3231)
	at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.handleStartElement(XMLSchemaValidator.java:1912)
	at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.startElement(XMLSchemaValidator.java:741)
	at com.sun.org.apache.xerces.internal.jaxp.validation.DOMValidatorHelper.beginNode(DOMValidatorHelper.java:277)
	at com.sun.org.apache.xerces.internal.jaxp.validation.DOMValidatorHelper.validate(DOMValidatorHelper.java:244)
	at com.sun.org.apache.xerces.internal.jaxp.validation.DOMValidatorHelper.validate(DOMValidatorHelper.java:190)
	at com.sun.org.apache.xerces.internal.jaxp.validation.ValidatorImpl.validate(ValidatorImpl.java:109)
	at javax.xml.validation.Validator.validate(Validator.java:124)
	at org.apache.aries.blueprint.parser.Parser.validate(Parser.java:346)
	... 34 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16740257" author="davsclaus" created="Fri, 11 Jan 2019 10:17:34 +0000"  >&lt;p&gt;Great work Grzegorz&lt;/p&gt;</comment>
                            <comment id="16742927" author="xldai" created="Tue, 15 Jan 2019 10:11:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggrzybek&quot; class=&quot;user-hover&quot; rel=&quot;ggrzybek&quot;&gt;ggrzybek&lt;/a&gt;&#160; I did a quickly test by applying the fixes onto camel-blueprint 2.21.2. yes, the bundle status now it&apos;s shown as expected (Failure in case). but one thing I found that the Camel context is still started and then getting shutdown quickly in case of wrong definition in the URI of the Route. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-01-15T17:30:51,141 | INFO&#160; | fileinstall-H:\product\7.1.1GA\Talend-&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;-V7.1.1/deploy | install.internal.Util$OsgiLogger&#160; 205 | 10 - org.apache.felix.fileinstall - 3.6.4 | Installing bundle blueprint.xml / 0.0.0
2019-01-15T17:30:52,049 | INFO&#160; | Blueprint Event Dispatcher: 1 | .blueprint.BlueprintCamelContext&#160; 187 | 224 - org.apache.camel.camel-blueprint - 2.21.2 | Attempting to start CamelContext: camel-1
2019-01-15T17:30:52,051 | INFO&#160; | Blueprint Event Dispatcher: 1 | e.camel.impl.DefaultCamelContext 3143 | 226 - org.apache.camel.camel-core - 2.21.2 | Apache Camel 2.21.2 (CamelContext: camel-1) is starting
2019-01-15T17:30:52,053 | INFO&#160; | Blueprint Event Dispatcher: 1 | gement.ManagedManagementStrategy&#160; 205 | 226 - org.apache.camel.camel-core - 2.21.2 | JMX is enabled
2019-01-15T17:30:52,270 | INFO&#160; | Blueprint Event Dispatcher: 1 | e.camel.impl.DefaultCamelContext 3501 | 226 - org.apache.camel.camel-core - 2.21.2 | Apache Camel 2.21.2 (CamelContext: camel-1) is shutting down
2019-01-15T17:30:52,283 | INFO&#160; | Blueprint Event Dispatcher: 1 | e.camel.impl.DefaultCamelContext 3592 | 226 - org.apache.camel.camel-core - 2.21.2 | Apache Camel 2.21.2 (CamelContext: camel-1) uptime 0.232 seconds
2019-01-15T17:30:52,284 | INFO&#160; | Blueprint Event Dispatcher: 1 | e.camel.impl.DefaultCamelContext 3593 | 226 - org.apache.camel.camel-core - 2.21.2 | Apache Camel 2.21.2 (CamelContext: camel-1) is shutdown in 0.014 seconds
2019-01-15T17:30:52,284 | WARN&#160; | Blueprint Event Dispatcher: 1 | print.BlueprintCamelStateService&#160;&#160; 79 | 224 - org.apache.camel.camel-blueprint - 2.21.2 | Changing Camel state &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; bundle 316 to Failure
2019-01-15T17:30:52,284 | ERROR | Blueprint Event Dispatcher: 1 | .blueprint.BlueprintCamelContext&#160; 190 | 224 - org.apache.camel.camel-blueprint - 2.21.2 | Error occurred during starting CamelContext: camel-1
org.apache.camel.FailedToCreateRouteException: Failed to create route route1: Route(route1)[[From[timer:&lt;span class=&quot;code-comment&quot;&gt;//simpleTimer?period=1000&amp;amp;repeatCo... because of Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: Failed to resolve endpoint: timer://simpleTimer?funnyopt=1&amp;amp;period=1000&amp;amp;repeatCount=0 due to: There are 1 parameters that couldn&apos;t be set on the endpoint. Check the uri &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{funnyopt=1}]
&lt;/span&gt;&#160;&#160; &#160;at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:209) [226:org.apache.camel.camel-core:2.21.2]
&#160;&#160; &#160;at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:1145) [226:org.apache.camel.camel-core:2.21.2]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is it possible to enhance the fixes by stop doing the Context start/shutdown? &lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="16742940" author="davsclaus" created="Tue, 15 Jan 2019 10:22:57 +0000"  >&lt;p&gt;No its not possible. Camel must be started up to detect the error.&lt;/p&gt;</comment>
                            <comment id="16742944" author="gzres" created="Tue, 15 Jan 2019 10:26:58 +0000"  >&lt;p&gt;Agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13022622">CAMEL-10513</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12950801" name="blueprint.xml" size="400" author="xldai" created="Thu, 6 Dec 2018 07:42:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0186o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>