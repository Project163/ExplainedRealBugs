<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:27:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11996] RabbitConsumer could hang when RabbitMQ connection is lost and autoAck=false.</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11996</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When the connection is lost to a RabbitMQ server and later restored there is the possibility that the RabbitConsumer hangs. The only way around this that I found is to restart my application. &lt;/p&gt;

&lt;p&gt;I have experienced this problem in my testing environment running camel 2.18.3 where my RabbitMQ installation is not stable causing every consumer thread to hang on &lt;em&gt;lock.acquire()&lt;/em&gt; .&lt;/p&gt;

&lt;p&gt;The problem has been introduced in version 2.18.0 commit 7ee0977c9f5c327a95122f5b80202dc5dd872e40&lt;br/&gt;
A possible fix could be to include the statement &lt;em&gt;if (!channel.isOpen()) return;&lt;/em&gt; in the try-finally block below it.&lt;/p&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JUnit test&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.camel.component.rabbitmq;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.mockito.Mockito;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RabbitConsumerTest {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RabbitMQConsumer consumer = Mockito.mock(RabbitMQConsumer.class);
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RabbitMQEndpoint endpoint = Mockito.mock(RabbitMQEndpoint.class);
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Connection conn = Mockito.mock(Connection.class);
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Channel channel = Mockito.mock(Channel.class);
     
  @Test(timeout=5000)
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testHandleDelivery_ShouldNotHangForeverIfChanelWasClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {  
    Mockito.when(consumer.getEndpoint()).thenReturn(endpoint);  
    Mockito.when(consumer.getConnection()).thenReturn(conn);
    Mockito.when(conn.createChannel()).thenReturn(channel);
    Mockito.when(channel.isOpen()).thenReturn(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).thenReturn(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    
    RabbitConsumer rabbitConsumer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RabbitConsumer(consumer);
    
    rabbitConsumer.handleDelivery(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    rabbitConsumer.handleDelivery(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    rabbitConsumer.stop();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13116710">CAMEL-11996</key>
            <summary>RabbitConsumer could hang when RabbitMQ connection is lost and autoAck=false.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jmongard">Joel Mong&#229;rd</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Nov 2017 15:33:10 +0000</created>
                <updated>Fri, 2 Feb 2018 08:53:58 +0000</updated>
                            <resolved>Fri, 2 Feb 2018 08:53:58 +0000</resolved>
                                    <version>2.18.0</version>
                    <version>2.19.0</version>
                    <version>2.20.0</version>
                                    <fixVersion>2.19.5</fixVersion>
                    <fixVersion>2.20.3</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-rabbitmq</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16242219" author="davsclaus" created="Tue, 7 Nov 2017 15:45:11 +0000"  >&lt;p&gt;You are welcome to provide a fix as github PR if you want to try doing that&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/contributing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/contributing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16323709" author="davsclaus" created="Fri, 12 Jan 2018 08:43:31 +0000"  >&lt;p&gt;Can you try with latest code from master or 2.20.1 release as we have had some fixes to this component&lt;/p&gt;</comment>
                            <comment id="16349990" author="davsclaus" created="Fri, 2 Feb 2018 08:46:50 +0000"  >&lt;p&gt;Thanks I reproduced the issue with your unit test and have a fix&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13083427">CAMEL-11480</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mhx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>