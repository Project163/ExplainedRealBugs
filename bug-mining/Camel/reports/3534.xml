<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:13:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-9555] Setting deadLetterHandleNewException to false breaks DeadLetterChannel default exception handling</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9555</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;By default, the &lt;tt&gt;DeadLetterChannel&lt;/tt&gt; handles every exception, including any exception thrown by the dead letter itself. This can be changed by setting the option &lt;tt&gt;deadLetterHandleNewException&lt;/tt&gt; to &lt;em&gt;false&lt;/em&gt;. Unfortunately, setting it to &lt;em&gt;false&lt;/em&gt; also disable the handling in case of a normal exception, which is not at all what the name suggests. &lt;/p&gt;

&lt;p&gt;To make the point clear, here is the little scenario I am trying to set up, and why this option is really important in that case.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Scenario&quot;&gt;&lt;/a&gt;Scenario&lt;/h3&gt;

&lt;p&gt;I have a camel route consuming persistent messages from a JMS (activemq) endpoint. I have set &lt;tt&gt;CLIENT_ACKNOWLEDGE&lt;/tt&gt; on the component to prevent consuming the messages until they have been successfully processed.&lt;/p&gt;

&lt;p&gt;So I want to configure my error handler as a &lt;tt&gt;DeadLetterChannel&lt;/tt&gt; with the following behavior:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;in case of an exception during processing, send the message to a DLQ&lt;/li&gt;
	&lt;li&gt;if the DLQ itself fails (preventing the message to be safely stored), do not handle it and let the exception being propagated back to the JMS consumer, such that ActiveMQ won&apos;t remove it from its queue.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;From my understanding, this is what the option &lt;tt&gt;deadLetterHandleNewException=false&lt;/tt&gt; should provide. But when testing it, setting it to &lt;em&gt;false&lt;/em&gt; actually breaks the default handling of the dead letter channel as well, and no exception at all are handled, even when successfully sent to the DLQ...&lt;/p&gt;

&lt;p&gt;I checked &lt;tt&gt;DeadLetterHandleNewExceptionTest&lt;/tt&gt; from the camel test cases, but it does not cover the scenario I described (it only checks the behavior when the DLQ fails, not when it succeeds).&lt;/p&gt;

&lt;p&gt;Basically, in the current release, I can either have:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the DLC handle &lt;b&gt;all&lt;/b&gt; exceptions (default)&lt;/li&gt;
	&lt;li&gt;the DLC handle &lt;b&gt;no&lt;/b&gt; exception at all (with &lt;tt&gt;deadLetterHandleNewException=false&lt;/tt&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, the intended behavior with &lt;tt&gt;deadLetterHandleNewException=false&lt;/tt&gt; should have the DLC handle any exception thrown during normal routing, while not handling any exception thrown during the DLQ processing itself.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12935587">CAMEL-9555</key>
            <summary>Setting deadLetterHandleNewException to false breaks DeadLetterChannel default exception handling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="lchdev">Laurent Chiarello</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2016 10:38:12 +0000</created>
                <updated>Mon, 8 Feb 2016 07:36:48 +0000</updated>
                            <resolved>Sat, 6 Feb 2016 08:47:41 +0000</resolved>
                                                    <fixVersion>2.15.6</fixVersion>
                    <fixVersion>2.16.3</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15126090" author="lchdev" created="Mon, 1 Feb 2016 10:44:03 +0000"  >&lt;p&gt;Attached test case which tests the &lt;tt&gt;DeadLetterChannel&lt;/tt&gt; in the four following scenarios:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;deadLetterHandleNewException=true&lt;/tt&gt; and the DLC succeeds&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;deadLetterHandleNewException=true&lt;/tt&gt; and the DLC fails&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;deadLetterHandleNewException=false&lt;/tt&gt; and the DLC succeeds&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;deadLetterHandleNewException=false&lt;/tt&gt; and the DLC fails&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Output of scenario 3 is not as expected.&lt;/p&gt;</comment>
                            <comment id="15135666" author="davsclaus" created="Sat, 6 Feb 2016 07:44:55 +0000"  >&lt;p&gt;Can you attach a new test file that does not have that (c) on the license file, we cannot use or accept such a source code at ASF. It must be free to use.&lt;/p&gt;</comment>
                            <comment id="15135691" author="davsclaus" created="Sat, 6 Feb 2016 08:47:41 +0000"  >&lt;p&gt;Thanks for reporting.&lt;/p&gt;</comment>
                            <comment id="15136672" author="lchdev" created="Mon, 8 Feb 2016 07:36:48 +0000"  >&lt;p&gt;Reupload of Test case&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786765" name="DeadLetterChannelTest.java" size="3421" author="lchdev" created="Mon, 8 Feb 2016 07:36:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s88n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>