<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:12:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22251] Incorrect Exchange status when using camel-rest</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22251</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Consider the following integration yaml file and also an Event Listener:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- from:
    uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;:get:/demo&quot;&lt;/span&gt;
    steps:
      - removeHeaders:
          pattern: &lt;span class=&quot;code-quote&quot;&gt;&quot;Camel*&quot;&lt;/span&gt;
      - to:
          uri: https:&lt;span class=&quot;code-comment&quot;&gt;//httpbin.org/status/500
&lt;/span&gt;          parameters:
            bridgeEndpoint: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
            httpMethod: GET &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.lsergio.poc;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.spi.CamelEvent;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.support.EventNotifierSupport;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.Logger;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.LoggerFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyEventListener &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; EventNotifierSupport {

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Logger log = LoggerFactory.getLogger(getClass());

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void notify(CamelEvent event) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (event.getSource() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Exchange) {
          Exchange ex = (Exchange)event.getSource();
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Event class: &quot;&lt;/span&gt; + event.getClass());
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Event: &quot;&lt;/span&gt; + event.getType().name() + &lt;span class=&quot;code-quote&quot;&gt;&quot; - Failed:&quot;&lt;/span&gt; + ex.isFailed() + &lt;span class=&quot;code-quote&quot;&gt;&quot; Id: &quot;&lt;/span&gt; + ex.getExchangeId() + &lt;span class=&quot;code-quote&quot;&gt;&quot; - Exception: &quot;&lt;/span&gt; + ex.getException());
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;--------------------------&quot;&lt;/span&gt;);
      }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The integration intentionally fails by calling an endpoint that always returns status 5xx.&lt;/p&gt;

&lt;p&gt;After running this code with&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jbang -Dcamel.jbang.version=4.13.0 camel@apache/camel run integration.yaml MyEventListener.java&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;we get the following output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-07-14 16:45:57.233  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeCreatedEvent
2025-07-14 16:45:57.236  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event: ExchangeCreated - Failed:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; Id: 57E85F0594C3DD7-0000000000000001 - Exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2025-07-14 16:45:57.236  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:45:57.246  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeSendingEvent
2025-07-14 16:45:57.246  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event: ExchangeSending - Failed:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; Id: 57E85F0594C3DD7-0000000000000001 - Exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2025-07-14 16:45:57.246  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:45:58.022  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeSentEvent
2025-07-14 16:45:58.022  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : Event: ExchangeSent - Failed:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; Id: 57E85F0594C3DD7-0000000000000001 - Exception: org.apache.camel.http.base.HttpOperationFailedException: HTTP operation failed invoking https:&lt;span class=&quot;code-comment&quot;&gt;//httpbin.org/status/500 with statusCode: 500
&lt;/span&gt;2025-07-14 16:45:58.022  INFO 412676 --- [worker-thread-0] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:45:58.036  INFO 412676 --- [ntloop-thread-0] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeCompletedEvent
2025-07-14 16:45:58.037  INFO 412676 --- [ntloop-thread-0] com.lsergio.poc.MyEventListener          : Event: ExchangeCompleted - Failed:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; Id: 57E85F0594C3DD7-0000000000000001 - Exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2025-07-14 16:45:58.037  INFO 412676 --- [ntloop-thread-0] com.lsergio.poc.MyEventListener          : -------------------------- &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can see an &lt;b&gt;ExchangeSent&lt;/b&gt; event where the exchange is marked as failed, but the &lt;b&gt;ExchangeCompleted&lt;/b&gt; event is not.&lt;/p&gt;

&lt;p&gt;Also, changing the bridgeEndpoint param to false does not change the behavior.&lt;/p&gt;

&lt;p&gt;However, changing the route trigger to quartz:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- from:
    uri: &lt;span class=&quot;code-quote&quot;&gt;&quot;quartz:&lt;span class=&quot;code-comment&quot;&gt;//ipaas/trigger?cron=0+*+*+?+*+MON-FRI&quot;&lt;/span&gt;
&lt;/span&gt;    steps:
      - removeHeaders:
          pattern: &lt;span class=&quot;code-quote&quot;&gt;&quot;Camel*&quot;&lt;/span&gt;
      - to:
          uri: https:&lt;span class=&quot;code-comment&quot;&gt;//httpbin.org/status/500
&lt;/span&gt;          parameters:
            bridgeEndpoint: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
            httpMethod: GET &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;yields a different result:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-07-14 16:44:00.016  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeCreatedEvent
2025-07-14 16:44:00.024  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event: ExchangeCreated - Failed:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; Id: 03955C93A9468F8-0000000000000000 - Exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2025-07-14 16:44:00.024  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:44:00.033  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeSendingEvent
2025-07-14 16:44:00.033  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event: ExchangeSending - Failed:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; Id: 03955C93A9468F8-0000000000000000 - Exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2025-07-14 16:44:00.033  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:44:01.078  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeSentEvent
2025-07-14 16:44:01.080  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event: ExchangeSent - Failed:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; Id: 03955C93A9468F8-0000000000000000 - Exception: org.apache.camel.http.base.HttpOperationFailedException: HTTP operation failed invoking https:&lt;span class=&quot;code-comment&quot;&gt;//httpbin.org/status/500 with statusCode: 502
&lt;/span&gt;2025-07-14 16:44:01.081  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : --------------------------
2025-07-14 16:44:01.095  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.impl.event.ExchangeFailedEvent
2025-07-14 16:44:01.095  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : Event: ExchangeFailed - Failed:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; Id: 03955C93A9468F8-0000000000000000 - Exception: org.apache.camel.http.base.HttpOperationFailedException: HTTP operation failed invoking https:&lt;span class=&quot;code-comment&quot;&gt;//httpbin.org/status/500 with statusCode: 502
&lt;/span&gt;2025-07-14 16:44:01.095  INFO 409081 --- [ration_Worker-1] com.lsergio.poc.MyEventListener          : -------------------------- &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now there an &lt;b&gt;ExchangeFailed&lt;/b&gt; event instead of the &lt;b&gt;ExchangeCompleted&lt;/b&gt; event. This is the behavior I was expecting with the rest component, as the request indeed failed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13623773">CAMEL-22251</key>
            <summary>Incorrect Exchange status when using camel-rest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="luiscarneiro">Luis Sergio Faria Carneiro</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jul 2025 16:37:31 +0000</created>
                <updated>Mon, 21 Jul 2025 09:24:13 +0000</updated>
                            <resolved>Mon, 21 Jul 2025 09:24:13 +0000</resolved>
                                    <version>4.8.8</version>
                    <version>4.10.5</version>
                    <version>4.12.0</version>
                    <version>4.13.0</version>
                                    <fixVersion>4.8.9</fixVersion>
                    <fixVersion>4.10.7</fixVersion>
                    <fixVersion>4.14.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="18007877" author="luiscarneiro" created="Thu, 17 Jul 2025 16:38:11 +0000"  >&lt;p&gt;Zulip thread about this issue: &lt;a href=&quot;https://camel.zulipchat.com/#narrow/channel/257298-camel/topic/Different.20event.20behavior.20depending.20on.20route.20trigger/with/529269637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.zulipchat.com/#narrow/channel/257298-camel/topic/Different.20event.20behavior.20depending.20on.20route.20trigger/with/529269637&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18007907" author="luiscarneiro" created="Thu, 17 Jul 2025 19:59:06 +0000"  >&lt;p&gt;Some info I found after debugging:&lt;/p&gt;

&lt;p&gt;The request is handled by the &lt;a href=&quot;https://github.com/apache/camel/blob/camel-4.8.5/components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpConsumer.java#L216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;VertxPlatformHttpConsumer&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I noticed that when I added a breakpoint&#160; at this block:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            vertx.executeBlocking(() -&amp;gt; processExchange(exchange), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).onComplete(processExchangeResult -&amp;gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (processExchangeResult.succeeded()) {
                    writeResponse(ctx, exchange, getEndpoint().getHeaderFilterStrategy(), muteExceptions)
                            .onComplete(writeResponseResult -&amp;gt; {
                                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (writeResponseResult.succeeded()) {
                                    handleExchangeComplete(exchange);
                                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                                    handleFailure(exchange, ctx, writeResponseResult.cause());
                                }
                            });
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    handleFailure(exchange, ctx, processExchangeResult.cause());
                }
            });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;sometimes the exchange had the failure info, sometimes it didn&apos;t. And it usually did when I added a breakpoint to the http component and executed the code step by step.&lt;br/&gt;
So I guess this might be related to some async processing.&lt;/p&gt;</comment>
                            <comment id="18007991" author="davsclaus" created="Fri, 18 Jul 2025 06:29:05 +0000"  >&lt;p&gt;Thanks for the analysis.&#160;&lt;/p&gt;</comment>
                            <comment id="18008629" author="davsclaus" created="Mon, 21 Jul 2025 08:13:42 +0000"  >&lt;p&gt;Okay so I have found the problem that its in platform-http-vertx that clears the caused exception which it should not have done - the other http components like jetty does not do that&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wtl4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>