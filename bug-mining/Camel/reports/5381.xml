<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:42:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15355] unacceptable_type,longstr error if we set  &apos;arg.queue.x-single-active-consumer=true in rabbitmq endpoint url</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15355</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We are using camel-rabbitmq to create a single-active-consumer.&lt;br/&gt;
 to create a single active consumer we need to give a queue arg in endpoint uri as&lt;br/&gt;
&#160;&lt;b&gt;&amp;amp;arg.queue.x-single-active-consumer=true&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;We get error below error if we set this argument&lt;/p&gt;

&lt;p&gt;Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&amp;lt;channel.close&amp;gt;(reply-code=406, reply-text=PRECONDITION_FAILED - invalid arg &apos;x-single-active-consumer&apos; for queue &apos;testQ4&apos; in vhost &apos;vh1&apos;: {&lt;b&gt;unacceptable_type,longstr&lt;/b&gt;}, class-id=50, method-id=10)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13320170">CAMEL-15355</key>
            <summary>unacceptable_type,longstr error if we set  &apos;arg.queue.x-single-active-consumer=true in rabbitmq endpoint url</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="devansharora68@gmail.com">Devansh Arora</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jul 2020 11:35:06 +0000</created>
                <updated>Thu, 30 Jul 2020 13:39:38 +0000</updated>
                            <resolved>Thu, 30 Jul 2020 13:18:48 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>camel-rabbitmq</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17167840" author="ancosen" created="Thu, 30 Jul 2020 11:46:50 +0000"  >&lt;p&gt;Please read the documentation correctly. You need to pass the args through the args parameter.&lt;/p&gt;

&lt;p&gt;Like this example:&#160;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-rabbitmq/src/test/java/org/apache/camel/component/rabbitmq/integration/RabbitMQInOutIntTest.java#L82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-rabbitmq/src/test/java/org/apache/camel/component/rabbitmq/integration/RabbitMQInOutIntTest.java#L82&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17167846" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 11:53:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=acosentino&quot; class=&quot;user-hover&quot; rel=&quot;acosentino&quot;&gt;acosentino&lt;/a&gt; &lt;br/&gt;
i tried using it like&#160;&lt;br/&gt;
&amp;amp;args=arg.queue.x-single-active-consumer=true&lt;/p&gt;



&lt;p&gt;getting NPE&lt;br/&gt;
Caused by: java.lang.NullPointerException: nullaused by: java.lang.NullPointerException: null at org.apache.camel.util.PropertiesHelper.extractProperties(PropertiesHelper.java:33) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-util-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQEndpoint.getExchangeArgs(RabbitMQEndpoint.java:825) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.resolvedExchangeArguments(RabbitMQDeclareSupport.java:101) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.declareAndBindExchangeWithQueue(RabbitMQDeclareSupport.java:49) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.declareAndBindExchangesAndQueuesUsing(RabbitMQDeclareSupport.java:36) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQEndpoint.declareExchangeAndQueue(RabbitMQEndpoint.java:244) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitConsumer.openChannel(RabbitConsumer.java:353) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitConsumer.&amp;lt;init&amp;gt;(RabbitConsumer.java:59) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQConsumer.createConsumer(RabbitMQConsumer.java:127) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQConsumer.createConsumers(RabbitMQConsumer.java:99) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.component.rabbitmq.RabbitMQConsumer.doStart(RabbitMQConsumer.java:179) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-rabbitmq-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.support.service.BaseService.start(BaseService.java:115) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-api-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.AbstractCamelContext.startService(AbstractCamelContext.java:3025) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.InternalRouteStartupManager.doStartOrResumeRouteConsumers(InternalRouteStartupManager.java:348) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.InternalRouteStartupManager.doStartRouteConsumers(InternalRouteStartupManager.java:275) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.InternalRouteStartupManager.safelyStartRouteServices(InternalRouteStartupManager.java:180) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.InternalRouteStartupManager.doStartOrResumeRoutes(InternalRouteStartupManager.java:114) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.AbstractCamelContext.doStartCamel(AbstractCamelContext.java:2809) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.AbstractCamelContext.doStartContext(AbstractCamelContext.java:2657) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.AbstractCamelContext.doStart(AbstractCamelContext.java:2620) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.spring.boot.SpringBootCamelContext.doStart(SpringBootCamelContext.java:43) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-spring-boot-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.support.service.BaseService.start(BaseService.java:115) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-api-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.impl.engine.AbstractCamelContext.start(AbstractCamelContext.java:2452) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-base-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt; at org.apache.camel.spring.SpringCamelContext.start(SpringCamelContext.java:121) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-spring-3.4.0.jar:3.4.0&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17167850" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 11:57:37 +0000"  >&lt;p&gt;Also as mentioned in camel-rabbitmq document&lt;br/&gt;
 &lt;a href=&quot;https://camel.apache.org/components/latest/rabbitmq-component.html#_query_parameters_64_parameters&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/latest/rabbitmq-component.html#_query_parameters_64_parameters&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;using queueargs parameter gives below error&lt;/p&gt;

&lt;p&gt;*Unknown parameters=[&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
{queueargs=arg.queue.x-single-active-consumer=true}
&lt;p&gt;]*&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17167854" author="davsclaus" created="Thu, 30 Jul 2020 12:01:40 +0000"  >&lt;p&gt;Whats the endpoint uri for your camel rabbitmq endpoint you use, can you paste it here&lt;/p&gt;</comment>
                            <comment id="17167858" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 12:07:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; &lt;br/&gt;
my endpoint uri is like&lt;/p&gt;

&lt;p&gt;rabbitmq://localhost:5672/mydirectdelayed?queue=testQ4&amp;amp;routingKey=testKey&amp;amp;username=me&amp;amp;password=mypwd&amp;amp;threadPoolSize=1&amp;amp;concurrentConsumers=1&amp;amp;autoDelete=false&amp;amp;vhost=myvhost&amp;amp;arg.queue.x-single-active-consumer=true&amp;amp;arg.exchange.x-delayed-type=direct&amp;amp;exchangeType=x-delayed-message&lt;/p&gt;</comment>
                            <comment id="17167895" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 12:53:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=acosentino&quot; class=&quot;user-hover&quot; rel=&quot;acosentino&quot;&gt;acosentino&lt;/a&gt; &lt;br/&gt;
do we need a change in&#160;&lt;/p&gt;

&lt;p&gt;org.apache.camel.component.rabbitmq.&lt;b&gt;RabbitMQDeclareSupport.formatSpecialQueueArguments&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;to parse this argument to Boolean for rabbitmq api to take this as boolean and not as longstr&lt;/p&gt;</comment>
                            <comment id="17167903" author="davsclaus" created="Thu, 30 Jul 2020 13:05:54 +0000"  >&lt;p&gt;Yeah sadly it seems rabbitmq have put that burden on end-users. We can&apos;t frankly not always know if its supposed to be number, text or boolean etc for any arbitrary argument.&lt;/p&gt;</comment>
                            <comment id="17167907" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 13:13:54 +0000"  >&lt;p&gt;previously we were using camel-rabbitmq 2.24.x, then we could configure arguments like&lt;/p&gt;

&lt;p&gt;&lt;b&gt;public class QueueArgsSACConfigurer implements ArgsConfigurer {&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;@Override&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;public void configurArgs(Map&amp;lt;String, Object&amp;gt; map) { map.put(&quot;x-max-priority&quot;, 3); map.put(&quot;x-single-active-consumer&quot;, true); }&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;}&lt;/b&gt;&lt;br/&gt;
 and in endpoint url we could add this bean definition&#160;&lt;br/&gt;
 it used to work fine then.&lt;br/&gt;
 but in camel-rabbitmq 3.x&#160;ArgsConfigurer was deprecated.&lt;br/&gt;
and we then we switched to endpoint url based args and found this prblm&lt;/p&gt;</comment>
                            <comment id="17167911" author="davsclaus" created="Thu, 30 Jul 2020 13:20:39 +0000"  >&lt;p&gt;If you use java code, you can do something as workaround&lt;/p&gt;

&lt;p&gt;RabbitMQEndpoint e = context.getEndpoint(&quot;xxx&quot;, RabbitMQEndpoint.class);&lt;br/&gt;
e.getArgs().put(&quot;x-single ...&quot;, true&quot;);&lt;/p&gt;

&lt;p&gt;And then&lt;/p&gt;

&lt;p&gt;from(e).to(&quot;foo&quot;)&lt;/p&gt;


&lt;p&gt;eg you get the endpoint, and then put on the args with the boolean value, and then use the endpoint instance in the route dsl&lt;/p&gt;</comment>
                            <comment id="17167923" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 13:32:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; &lt;br/&gt;
yes we are using java code. i tried this workaround like&lt;/p&gt;

&lt;p&gt;RabbitMQEndpoint e = context.getEndpoint(epUri, RabbitMQEndpoint.class);RabbitMQEndpoint e = context.getEndpoint(epUri, RabbitMQEndpoint.class); e.getArgs().put(&quot;arg.queue.x-single-active-consumer&quot;, true); e.getArgs().put(&quot;arg.exchange.x-delayed-type&quot;, &quot;direct&quot;); from(e).startupOrder(4).log(&quot;${body}&quot;).routeId(&quot;fourthorderROute&quot;);&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;RabbitMQEndpoint e = context.getEndpoint(epUri, RabbitMQEndpoint.class);RabbitMQEndpoint e = context.getEndpoint(epUri, RabbitMQEndpoint.class); e.getArgs().put(&quot;x-single-active-consumer&quot;, true); e.getArgs().put(&quot;x-delayed-type&quot;, &quot;direct&quot;); from(e).startupOrder(4).log(&quot;${body}&quot;).routeId(&quot;fourthorderROute&quot;);&lt;/p&gt;


&lt;p&gt;the consumer is getting started, but without single active consumer feature.&lt;br/&gt;
seems it is not taking up the arguments&lt;/p&gt;</comment>
                            <comment id="17167926" author="davsclaus" created="Thu, 30 Jul 2020 13:37:18 +0000"  >&lt;p&gt;I think it should be &quot;queue.x-single-active-consumer&quot; as key&lt;/p&gt;</comment>
                            <comment id="17167927" author="davsclaus" created="Thu, 30 Jul 2020 13:37:48 +0000"  >&lt;p&gt;And exchange. as prefix for the exchange args, see the source in the endpoint code&lt;/p&gt;</comment>
                            <comment id="17167930" author="devansharora68@gmail.com" created="Thu, 30 Jul 2020 13:39:38 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;&#160;it works with queue. and exchange.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12312720" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Docs Text</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://camel.apache.org/components/latest/rabbitmq-component.html#_query_parameters_64_parameters&quot;&gt;https://camel.apache.org/components/latest/rabbitmq-component.html#_query_parameters_64_parameters&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hc88:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>