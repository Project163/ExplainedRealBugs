<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:19:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-10340] camel-aws - SQS option deleteAfterRead not work if set deleteIfFiltered=false</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10340</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m using aws-sqs 2.17.3, if I set deleteAfterRead=true and deleteIfFiltered=false in my DSL, the message will not be deleted. If I want to delete the message after read it, I have to set deleteAfterRead and deleteIfFiltered both with true when I use the two options in one DSL, but in fact there is no filter in my route, the message should be removed whatever the deleteIfFiltered option set to ture or false.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;SqsConsumerDeleteTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;aws-sqs:my-quque&quot;&lt;/span&gt;
    + &lt;span class=&quot;code-quote&quot;&gt;&quot;?amazonSQSClient=#conn_cAWSConnection_1&quot;&lt;/span&gt;
    + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;deleteAfterRead=&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;deleteIfFiltered=&quot;&lt;/span&gt;
    + &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:qs_route.cLog_1&quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;?level=DEBUG&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:mock_1&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I attached my test file, after run the test method, the sqs message still exists in the sqs queue after 30 seconds.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13007030">CAMEL-10340</key>
            <summary>camel-aws - SQS option deleteAfterRead not work if set deleteIfFiltered=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="yanbasic">Yi Yan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2016 03:25:03 +0000</created>
                <updated>Wed, 23 Nov 2016 10:14:41 +0000</updated>
                            <resolved>Fri, 30 Sep 2016 11:59:45 +0000</resolved>
                                    <version>2.17.3</version>
                                    <fixVersion>2.17.4</fixVersion>
                    <fixVersion>2.18.0</fixVersion>
                                    <component>camel-aws</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15529050" author="ancosen" created="Wed, 28 Sep 2016 09:30:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; shouldDelete(Exchange exchange) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfiguration().isDeleteAfterRead()
                &amp;amp;&amp;amp; (getConfiguration().isDeleteIfFiltered()
                    || (!getConfiguration().isDeleteIfFiltered()
                        &amp;amp;&amp;amp; passedThroughFilter(exchange)));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-aws/src/main/java/org/apache/camel/component/aws/sqs/SqsConsumer.java#L245-L250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-aws/src/main/java/org/apache/camel/component/aws/sqs/SqsConsumer.java#L245-L250&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The condition is not good for your case. It will always return false.&lt;/p&gt;</comment>
                            <comment id="15529080" author="ancosen" created="Wed, 28 Sep 2016 09:40:38 +0000"  >&lt;p&gt;Since you&apos;re not using a filter, it doesn&apos;t make sense to specify deleteIfFiltered parameter.&lt;/p&gt;

&lt;p&gt;I assume this from your example.&lt;/p&gt;</comment>
                            <comment id="15531587" author="yanbasic" created="Thu, 29 Sep 2016 02:34:24 +0000"  >&lt;p&gt;Hi Andrea,&lt;/p&gt;

&lt;p&gt;Thank you for your reply! I list the relationship table between &apos;delete after read&apos; and &apos;if filtered&apos; options by the sqs consumer source code: &lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;deleteAfterRead(option)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;deleteIfFiltered(option)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Passed by filter&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;result to delete&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes/No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Delete&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Delete&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Do not delete&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes/No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Yes/No&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Do not delete&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;After that, I added a filter in my route and it works when the deleteAfterRead is false, but when I set both deleteAfterRead and deleteIfFiltered to true, all the messages have been removed in my queue finally, that means if the deleteIfFiltered is true, the message will be always removed whether or not the route has filter, is it expected result?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Yi&lt;/p&gt;




&lt;p&gt;Here is my code, in this route deleteAfterRead and deleteIfFiltered are both true, filtered the message body with &apos;bar&apos;, should it only delete the &apos;bar&apos; message in SQS queue?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;aws-sqs:myQueue?amazonSQSClient=#myClient&amp;amp;deleteAfterRead=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;deleteIfFiltered=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
        .filter().simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;${body} == &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;&quot;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:r1.myLog1?level=INFO&quot;&lt;/span&gt;);

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:myTimer1?repeatCount=2&amp;amp;delay=1000&quot;&lt;/span&gt;)
        .setBody().constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;aws-sqs:myQueue?amazonSQSClient=#myClient&quot;&lt;/span&gt;);

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:myTimer2?repeatCount=3&amp;amp;delay=1000&quot;&lt;/span&gt;)
        .setBody().constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;aws-sqs:myQueue?amazonSQSClient=#myClient&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15532016" author="ancosen" created="Thu, 29 Sep 2016 07:17:59 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanbasic&quot; class=&quot;user-hover&quot; rel=&quot;yanbasic&quot;&gt;yanbasic&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Looking at the docs of AWS-SQS component I see:&lt;/p&gt;

&lt;p&gt;deleteIfFiltered: Camel 2.12.2,2.13.0 Whether or not to send the DeleteMessage to the SQS queue if an exchange fails to get through a filter. If &apos;false&apos; and exchange does not make it through a Camel filter upstream in the route, then don&apos;t send DeleteMessage.&lt;/p&gt;

&lt;p&gt;In your route all the messages will be deleted because you set deleteAfterRead to true (and &apos;bar&apos; will be deleted too), since deleteIfFiltered is set to true, the or operator will return true and the whole condition will be true, without taking into account the filter. So I guess the deleteIfFiltered will work only if deleteAfterRead is set to false. I guess this is expected because deleteIfFiltered has a default value of true, like deleteAfterRead.&lt;/p&gt;

&lt;p&gt;I believe we should change this behaviour or at least evaluate the two behaviour in a separated way.&lt;/p&gt;</comment>
                            <comment id="15535604" author="yanbasic" created="Fri, 30 Sep 2016 10:06:18 +0000"  >&lt;p&gt;What about to change the behavior like this? When deleteAfterRead is set to true, it will always remove message, and the deleteIfFiltered with true value will only work that the route must has a filter, and the message passed through the filter. I have test by this modification, it works as expected.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; shouldDelete(Exchange exchange) {
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; shouldDeleteByFilter = exchange.getProperty(Exchange.FILTER_MATCHED) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                &amp;amp;&amp;amp; getConfiguration().isDeleteIfFiltered()
                &amp;amp;&amp;amp; passedThroughFilter(exchange);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfiguration().isDeleteAfterRead()
                || shouldDeleteByFilter;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15535611" author="ancosen" created="Fri, 30 Sep 2016 10:10:40 +0000"  >&lt;p&gt;I think it is a good idea.&lt;/p&gt;

&lt;p&gt;Can you open a PR against master?&lt;/p&gt;

&lt;p&gt;I will add your contribution and then backport on 2.17&lt;/p&gt;</comment>
                            <comment id="15535720" author="githubbot" created="Fri, 30 Sep 2016 11:16:23 +0000"  >&lt;p&gt;GitHub user yanbasic opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1193&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10340&quot; title=&quot;camel-aws - SQS option deleteAfterRead not work if set deleteIfFiltered=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10340&quot;&gt;&lt;del&gt;CAMEL-10340&lt;/del&gt;&lt;/a&gt;: Adjusted deleteIfFiltered behavior for aws-sqs component&lt;/p&gt;

&lt;p&gt;    Hello, &lt;/p&gt;

&lt;p&gt;    Please review my code by fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10340&quot; title=&quot;camel-aws - SQS option deleteAfterRead not work if set deleteIfFiltered=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10340&quot;&gt;&lt;del&gt;CAMEL-10340&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    Thanks,&lt;br/&gt;
    Yi Yan&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yanbasic/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yanbasic/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1193.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1193.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1193&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 631e463c8c710965b6b7c35cde19250c3c0e5ac1&lt;br/&gt;
Author: Mike Yan &amp;lt;yyan@talend.com&amp;gt;&lt;br/&gt;
Date:   2016-09-30T11:13:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10340&quot; title=&quot;camel-aws - SQS option deleteAfterRead not work if set deleteIfFiltered=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10340&quot;&gt;&lt;del&gt;CAMEL-10340&lt;/del&gt;&lt;/a&gt;: Adjusted deleteIfFiltered behavior for aws-sqs component&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15535724" author="yanbasic" created="Fri, 30 Sep 2016 11:18:22 +0000"  >&lt;p&gt;Hello Andrea,&lt;/p&gt;

&lt;p&gt;I have opened the PR on master by the discussion result.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Yi&lt;/p&gt;</comment>
                            <comment id="15535847" author="githubbot" created="Fri, 30 Sep 2016 12:24:42 +0000"  >&lt;p&gt;Github user yanbasic closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1193&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15689397" author="ancosen" created="Wed, 23 Nov 2016 08:50:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanbasic&quot; class=&quot;user-hover&quot; rel=&quot;yanbasic&quot;&gt;yanbasic&lt;/a&gt;, can you comment here? &lt;a href=&quot;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It seems the change breaks particular scenarios.&lt;/p&gt;</comment>
                            <comment id="15689471" author="jonw9" created="Wed, 23 Nov 2016 09:13:44 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;As per comments on the commit here:  &lt;a href=&quot;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This change has changed the behaviour of our routes and deviates from the documentation. Can I ask if this is what was intended? ...this doesn&apos;t seem to match what was in the Camel-SQS documentation.&lt;/p&gt;

&lt;p&gt;The code before was:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; shouldDelete(Exchange exchange) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfiguration().isDeleteAfterRead()
                &amp;amp;&amp;amp; (getConfiguration().isDeleteIfFiltered()
                    || (!getConfiguration().isDeleteIfFiltered()
                        &amp;amp;&amp;amp; passedThroughFilter(exchange)));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which matched the documentation:&lt;/p&gt;

&lt;p&gt;deleteAfterRead: Delete message from SQS after it has been read (and processed by the route).&lt;br/&gt;
deleteIfFiltered: If false and exchange does not make it through a Camel filter upstream in the route, then don&apos;t send DeleteMessage.&lt;/p&gt;

&lt;p&gt;With the above code, deleteAfterRead needed to be set to &quot;true&quot; for ANY message to be deleted, filtered or not. Then, it was up to the configuration of deleteIfFiltered - if this was set to false then as the documentation states the message would not be deleted if if didn&apos;t pass through the filter.&lt;/p&gt;

&lt;p&gt;So, our config of:&lt;br/&gt;
deleteAfterRead = true (default)&lt;br/&gt;
deleteIfFiltered = false&lt;/p&gt;

&lt;p&gt;...gave the right outcome. Messages that were filtered &quot;out&quot; (i.e. not allowed through the filter) were not deleted from SQS.&lt;/p&gt;

&lt;p&gt;However, the new code commit has changed this behaviour.&lt;/p&gt;

&lt;p&gt;Firstly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfiguration().isDeleteAfterRead() &amp;amp;&amp;amp; (...filteringLogic...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;..has changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfiguration().isDeleteAfterRead() || shouldDeleteByFilter;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.. an &amp;amp;&amp;amp; becoming an || which means for the filtering logic to take effect the deleteAfterRead must now be set to false.  This isn&apos;t covered in the documentation and is a change of behaviour from before.&lt;/p&gt;

&lt;p&gt;Secondly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;|| (!getConfiguration().isDeleteIfFiltered() &amp;amp;&amp;amp; passedThroughFilter(exchange)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;..has changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;... &amp;amp;&amp;amp; getConfiguration().isDeleteIfFiltered() &amp;amp;&amp;amp; passedThroughFilter(exchange);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.. this time the negation has been removed, so the logic has now changed to not looking at whether the message was filtered out, but whether is was allowed through the filter.&lt;/p&gt;

&lt;p&gt;With the new code that has been committed, to get the same behaviour as before you now have to set deleteAfterRead to &quot;false&quot; and deletedIfFiltered to &quot;true&quot; so that messages filtered out are not deleted, and those that pass the filter are.&lt;/p&gt;

&lt;p&gt;New config:&lt;br/&gt;
deleteAfterRead = false&lt;br/&gt;
deleteIfFiltered = true&lt;/p&gt;

&lt;p&gt;Is this what was intended? Seems to be a departure from the documentation? If so is the documentation going to be updated? ..or should the logic be put back how it was?&lt;/p&gt;

&lt;p&gt;I believe, reading the posts above, that the code worked the way it was; if deleteAfterRead was set to true and deleteIfFiltered was set to false then the scenarios above would have worked - messages that did not pass the filter would not have been deleted; those that did pass the filter would have been.  I don&apos;t see why the code was changed!&lt;/p&gt;</comment>
                            <comment id="15689482" author="ancosen" created="Wed, 23 Nov 2016 09:19:39 +0000"  >&lt;p&gt;This must be reverted. Thanks for your detailed explanation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JonW9&quot; class=&quot;user-hover&quot; rel=&quot;JonW9&quot;&gt;JonW9&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, are you ok with the revert?&lt;/p&gt;</comment>
                            <comment id="15689508" author="yanbasic" created="Wed, 23 Nov 2016 09:29:22 +0000"  >&lt;p&gt;I have added my comment here &lt;a href=&quot;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15689593" author="ancosen" created="Wed, 23 Nov 2016 09:58:26 +0000"  >&lt;p&gt;We&apos;ll wait for further discussions.&lt;/p&gt;</comment>
                            <comment id="15689601" author="ancosen" created="Wed, 23 Nov 2016 10:00:52 +0000"  >&lt;p&gt;Anyway the answer from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanbasic&quot; class=&quot;user-hover&quot; rel=&quot;yanbasic&quot;&gt;yanbasic&lt;/a&gt;, seems to clarify the situation. We can add the table to our documentation in the related .adoc.&lt;/p&gt;</comment>
                            <comment id="15689662" author="jonw9" created="Wed, 23 Nov 2016 10:14:41 +0000"  >&lt;p&gt;I don&apos;t think the table from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanbasic&quot; class=&quot;user-hover&quot; rel=&quot;yanbasic&quot;&gt;yanbasic&lt;/a&gt; is 100% correct.  I&apos;ve posted my interpretation (&lt;a href=&quot;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/50dc4ea14c0ad6d3d93cfe4ddb386a006d1fafcc&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Please have a look and correct my understanding!!&lt;/p&gt;

&lt;p&gt;Thanks everyone for the amazingly quick replies!!!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12829982" name="SqsConsumerDeleteTest.java" size="2259" author="yanbasic" created="Fri, 23 Sep 2016 03:26:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33zhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>