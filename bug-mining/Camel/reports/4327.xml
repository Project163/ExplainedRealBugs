<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11951] Uri matching does not match request type</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11951</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I had previously described the problem here:&lt;br/&gt;
&lt;a href=&quot;https://stackoverflow.com/questions/46936348/apache-camel-rest-dsl-405-method-not-allowed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/46936348/apache-camel-rest-dsl-405-method-not-allowed&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It appears that the problem is down to a possible bug in the way URIs are matched (not to mention my rather obscure use-case)&lt;/p&gt;

&lt;p&gt;I have a number of REST-DSL endpoints with the same URI but different request types (POST, PUT, GET, DELETE).  In my case, the URI is getting selected by&lt;br/&gt;
HttpServletResolveConsumerStrategy.resolve (in addition to these, I have some specific endpoints with wildcards in them)&lt;/p&gt;

&lt;p&gt;This method matches the URI, but not the request type.  When I send a GET request, it returns the first consumer candidate it finds which, in my case, always seems to be PUT.  Later, when CamelContinuationServlet.doService checks that the request type and cadidate type match, they don&apos;t.  It then returns 405 Method Not Allowed.&lt;/p&gt;

&lt;p&gt;I believe that the HttpServletResolveConsumerStrategy.resolve method IN camel-hhtp-common should check the request type as well as the URI.&lt;/p&gt;</description>
                <environment>&lt;p&gt;camel-spring, camel-jetty&lt;br/&gt;
OS - RHEL&lt;/p&gt;</environment>
        <key id="13112351">CAMEL-11951</key>
            <summary>Uri matching does not match request type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="robert.hillier">Robert Hillier</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Oct 2017 17:44:43 +0000</created>
                <updated>Tue, 31 Oct 2017 19:00:36 +0000</updated>
                            <resolved>Tue, 31 Oct 2017 10:24:50 +0000</resolved>
                                    <version>2.20.0</version>
                                    <fixVersion>2.19.4</fixVersion>
                    <fixVersion>2.20.1</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                                    <component>camel-http-common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16223343" author="davsclaus" created="Sat, 28 Oct 2017 08:58:22 +0000"  >&lt;p&gt;Its the rest based HttpRestServletResolveConsumerStrategy that should be in-use as it cater for HTTP methods as well&lt;/p&gt;</comment>
                            <comment id="16223347" author="davsclaus" created="Sat, 28 Oct 2017 09:00:06 +0000"  >&lt;p&gt;Can you post a sample project to github or attach a .zip&lt;/p&gt;</comment>
                            <comment id="16224832" author="robert.hillier" created="Mon, 30 Oct 2017 12:37:58 +0000"  >&lt;p&gt;As requested, Camel Bug Demo project attached.&lt;/p&gt;

&lt;p&gt;To start the project, run:&lt;br/&gt;
mvn clean install camel:run&lt;/p&gt;

&lt;p&gt;The project contains a number of routes which make http calls to a dummy server running on a Heroku instance.  There are two REST calls which demonstrate the problem:&lt;/p&gt;

&lt;p&gt;http://&lt;tt&gt;serverAddr&lt;/tt&gt;/integration/api/v1/customer/123456/devices&lt;/p&gt;

&lt;p&gt;http://&lt;tt&gt;serverAddr&lt;/tt&gt;/integration/api/v1/customer/123456/detail&lt;/p&gt;

&lt;p&gt;The &quot;devices&quot; request is a specific uri, which performs some simple aggregation.  It contains a variable part in it&apos;s URI, used in subsequent calls.  This one is working fine&lt;/p&gt;

&lt;p&gt;The &quot;detail&quot; request should be simply proxied through to the other server.  However, this call returns a 405 Method Not Allowed.&lt;/p&gt;

&lt;p&gt;Furthermore, if you comment out the &quot;devices&quot; request and restart, the proxied &quot;detail&quot; call then works fine.&lt;/p&gt;</comment>
                            <comment id="16225174" author="vrlgohel" created="Mon, 30 Oct 2017 15:43:33 +0000"  >&lt;p&gt;Hi Robert, &lt;/p&gt;

&lt;p&gt;Your attached reproducer is missing, mandatory &apos;location&apos; attribute in &amp;lt;propertyPlaceholder&amp;gt; in your route file. Can you make the changes and upload the reproducer so that we can check ? Which is the property file you are referring in the reproducer ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;propertyPlaceholder id=&lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;propertiesLocation resolver=&lt;span class=&quot;code-quote&quot;&gt;&quot;classpath&quot;&lt;/span&gt;
				path=&lt;span class=&quot;code-quote&quot;&gt;&quot;mobile-gateway.properties&quot;&lt;/span&gt; optional=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
			&amp;lt;propertiesLocation resolver=&lt;span class=&quot;code-quote&quot;&gt;&quot;classpath&quot;&lt;/span&gt; path=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;
				optional=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/propertyPlaceholder&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16225382" author="robert.hillier" created="Mon, 30 Oct 2017 17:31:32 +0000"  >&lt;p&gt;Apologies, the properties aren&apos;t used in this demo, and can be removed.  I have updated the source and attached a zip file.&lt;/p&gt;

&lt;p&gt;Many thanks,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="16226522" author="davsclaus" created="Tue, 31 Oct 2017 09:41:30 +0000"  >&lt;p&gt;The attached sample code does NOT have the &quot;detail&quot; REST service, there is only devices.&lt;/p&gt;</comment>
                            <comment id="16226529" author="davsclaus" created="Tue, 31 Oct 2017 09:51:23 +0000"  >&lt;p&gt;It works fine when I do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &amp;lt;get uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;/v1/customer/{custId}/devices&quot;&lt;/span&gt; consumes=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt; produces=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;description&amp;gt;Queries all devices &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a single customer&amp;lt;/description&amp;gt;
        &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:getCustomerDevices&quot;&lt;/span&gt; /&amp;gt;
      &amp;lt;/get&amp;gt;
      &amp;lt;get uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;/v1/customer/{custId}/detail&quot;&lt;/span&gt; consumes=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt; produces=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;description&amp;gt;Customer detail&amp;lt;/description&amp;gt;
        &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:getCustomer&quot;&lt;/span&gt; /&amp;gt;
      &amp;lt;/get&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then just make those routes log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;getCustomer&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;description&amp;gt;Queries the customer details from the heroku server&amp;lt;/description&amp;gt;
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:getCustomer&quot;&lt;/span&gt; /&amp;gt;
      &amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;getCustomer detail ${header.custId}&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/route&amp;gt;
    
    &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;getDevice&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;description&amp;gt;Queries the device details from heroku server&amp;lt;/description&amp;gt;
      &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:getDevice&quot;&lt;/span&gt; /&amp;gt;
      &amp;lt;log message=&lt;span class=&quot;code-quote&quot;&gt;&quot;getCustomer device ${header.custId}&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/route&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then I call Camel via these 2 curls&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/123456/devices
&lt;/span&gt;davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/999999/detail&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I can see it calls different rest-dsl operation&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO ] 2017-10-31 10:49:23.692 [qtp1739303520-24] getCustomerDevices:159 - getCustomer devices 123456
[INFO ] 2017-10-31 10:49:40.139 [qtp1739303520-19] getCustomer:159 - getCustomer detail 999999
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16226531" author="robert.hillier" created="Tue, 31 Oct 2017 09:52:48 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;That&apos;s correct.  The &quot;detail&quot; request gets proxied through to the backend service by one of the four proxy REST services.  These are the ones with the &quot;/v1?matchOnUriPrefix=true&amp;amp;chunked=false&quot; uri.  But it is not selecting the correct service, as described above.&lt;/p&gt;

&lt;p&gt;When I stepped through the code, I noticed that it is selecting the best matching URI, but it selects the first one it finds (which always seems to be &quot;put&quot;).  When it later checks the restriction against the incoming request type, it rejects with 405.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="16226541" author="robert.hillier" created="Tue, 31 Oct 2017 10:01:57 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;As described, the &quot;detail&quot; request needs to be handled by one of the proxy requests, and not a specific request.  The proxy works fine, until I add REST services that contain variable parameters.  If you comment out the &quot;detail&quot; request, you&apos;ll find that the requests are proxied successfully.  When they are enabled, proxied requests return 405.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="16226548" author="davsclaus" created="Tue, 31 Oct 2017 10:05:23 +0000"  >&lt;p&gt;Ah good it, yeah reproduced the bug and working on a fix&lt;/p&gt;</comment>
                            <comment id="16226553" author="davsclaus" created="Tue, 31 Oct 2017 10:09:26 +0000"  >&lt;p&gt;Got it fixed&lt;/p&gt;

&lt;p&gt;Sending these requests&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/999999/detail
&lt;/span&gt;davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/123456/devices
&lt;/span&gt;davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/123456/detail
&lt;/span&gt;davsclaus:/Users/davsclaus/Downloads/camel-bug-demo/$ curl -XPUT http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8078/integration/api/v1/customer/123456/detail&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And it logs now&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO ] 2017-10-31 11:08:09.257 [qtp810576909-21] proxyOutbound:159 - Proxied call GET - /customer/999999/detail
[INFO ] 2017-10-31 11:08:17.556 [qtp810576909-16] getCustomerDevices:159 - getCustomer devices 123456
[INFO ] 2017-10-31 11:08:24.964 [qtp810576909-18] proxyOutbound:159 - Proxied call GET - /customer/123456/detail
[INFO ] 2017-10-31 11:08:44.232 [qtp810576909-18] proxyOutbound:159 - Proxied call PUT - /customer/123456/detail
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16226586" author="robert.hillier" created="Tue, 31 Oct 2017 10:37:29 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;Many thanks for this, and very nicely done too.&lt;/p&gt;

&lt;p&gt;What&apos;s the process for getting a fixed version?  Will I need to wait for 2.20.1?  Also, should I close the issue?&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="16226715" author="davsclaus" created="Tue, 31 Oct 2017 12:47:24 +0000"  >&lt;p&gt;Yes wait for the release&lt;/p&gt;</comment>
                            <comment id="16226743" author="robert.hillier" created="Tue, 31 Oct 2017 13:04:48 +0000"  >&lt;p&gt;Final question is of course, when will that be?&lt;br/&gt;
Thanks,&lt;br/&gt;
Rob&lt;/p&gt;</comment>
                            <comment id="16227040" author="davsclaus" created="Tue, 31 Oct 2017 16:09:09 +0000"  >&lt;p&gt;Keep an eye on&lt;br/&gt;
&lt;a href=&quot;http://camel.465427.n5.nabble.com/Next-round-of-patch-releases-Camel-2-19-4-and-2-20-1-td5814926.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.465427.n5.nabble.com/Next-round-of-patch-releases-Camel-2-19-4-and-2-20-1-td5814926.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16227333" author="robert.hillier" created="Tue, 31 Oct 2017 19:00:36 +0000"  >&lt;p&gt;Will do.  Thanks once again for your help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12894799" name="camel-bug-demo.zip" size="10054" author="robert.hillier" created="Mon, 30 Oct 2017 17:30:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lr2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>