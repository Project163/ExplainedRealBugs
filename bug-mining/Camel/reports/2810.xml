<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:03:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-7456] Camel PropertiesComponent ignores custom parser in Blueprint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7456</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have implemented a custom PropertiesParser which allows me to use system property placeholders in propertyPrefix and propertySuffix.&lt;/p&gt;

&lt;p&gt;In my use case the propertyPrefix is defined as &quot;${container.stage}.&quot;, where container.stage is a jvm option defined at container creation. The value is one of dev, test and prod.&lt;/p&gt;

&lt;p&gt;This works fine in Java DSL world (SCR bundle), but custom parser is ignored in Blueprint. Here is sample of my blueprint xml:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;cm:property-placeholder id=&lt;span class=&quot;code-quote&quot;&gt;&quot;integration&quot;&lt;/span&gt; persistent-id=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.sample.temp&quot;&lt;/span&gt; placeholder-prefix=&lt;span class=&quot;code-quote&quot;&gt;&quot;[[&quot;&lt;/span&gt; placeholder-suffix=&lt;span class=&quot;code-quote&quot;&gt;&quot;]]&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;cm:&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-properties&amp;gt;
        &amp;lt;cm:property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;example&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value is the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;cm:property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;dev.example&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value is used in development environment&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;cm:property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;test.example&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value is used in test environment&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;cm:property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;prod.example&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value is used in production environment&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/cm:&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-properties&amp;gt;
&amp;lt;/cm:property-placeholder&amp;gt;

&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;parser&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.sample.MyCustomPropertiesParser&quot;&lt;/span&gt;/&amp;gt;

&amp;lt;!-- Load properties &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; current container stage --&amp;gt;
&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.component.properties.PropertiesComponent&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;propertiesParser&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;parser&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;propertyPrefix&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${container.stage}.&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fallbackToUnaugmentedProperty&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;location&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;blueprint:integration,classpath:properties/temp.properties&quot;&lt;/span&gt;/&amp;gt;&amp;lt;/bean&amp;gt;

&amp;lt;camelContext id=&lt;span class=&quot;code-quote&quot;&gt;&quot;temp&quot;&lt;/span&gt; xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/blueprint&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;    &amp;lt;route id=&lt;span class=&quot;code-quote&quot;&gt;&quot;exampleRoute&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:foo?period=5000&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;transform&amp;gt;
            &amp;lt;simple&amp;gt;{{example}}&amp;lt;/simple&amp;gt;
        &amp;lt;/transform&amp;gt;
        &amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;log:something&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/route&amp;gt;
&amp;lt;/camelContext&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason it did not work was because by default, it uses blueprint property resolver (useBlueprintPropertyResolver=&quot;true&quot;) to bridge PropertiesComponent to blueprint in order to support looking up property placeholders from the Blueprint Property Placeholder Service. Then it always creates a BlueprintPropertiesParser object and set it to PropertiesComponent. &lt;/p&gt;

&lt;p&gt;The customer Property Parser I created was only set into the BlueprintPropertiesParser object as a delegate Property Parser. Therefore, it was always the method parseUri() from the BlueprintPropertiesParser object got invoked. The same method from your custom parser was ignored. &lt;/p&gt;

&lt;p&gt;For more detail, please take a look at org.apache.camel.blueprint.CamelContextFactoryBean.initPropertyPlaceholder() function.&lt;/p&gt;

&lt;p&gt;The only workaround is to add the attribute useBlueprintPropertyResolver=&quot;false&quot; to &amp;lt;camelContext&amp;gt; element to disable default blueprint property resolver. However, I will have to change PropertiesComponent&apos;s &quot;location&quot; property to remove blueprint &quot;blueprint:integration&quot; from the comma separated value list:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;location&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;classpath:properties/temp.properties&quot;&lt;/span&gt;/&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because once I set it to false, I will no longer be able to lookup from blueprint property service.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12716049">CAMEL-7456</key>
            <summary>Camel PropertiesComponent ignores custom parser in Blueprint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggrzybek">Grzegorz Grzybek</assignee>
                                    <reporter username="joeluo">Joe Luo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 May 2014 11:24:42 +0000</created>
                <updated>Tue, 22 Jul 2014 07:15:54 +0000</updated>
                            <resolved>Tue, 22 Jul 2014 07:15:54 +0000</resolved>
                                    <version>2.12.3</version>
                                    <fixVersion>2.12.5</fixVersion>
                    <fixVersion>2.13.3</fixVersion>
                    <fixVersion>2.14.0</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14006843" author="davsclaus" created="Fri, 23 May 2014 05:58:18 +0000"  >&lt;p&gt;Frankly this has not been the intention to support custom properties parser in OSGi.&lt;/p&gt;

&lt;p&gt;So what is the use case for having a custom parser? And having both blueprint and your custom what should happen as there are 2 parsers? So if a property is to be parsed should it use&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use blueprint first, and parse using custom afterwards&lt;/li&gt;
	&lt;li&gt;use custom first, and parse using blueprint afterwards&lt;/li&gt;
	&lt;li&gt;or something else?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14006978" author="joeluo" created="Fri, 23 May 2014 08:48:14 +0000"  >&lt;p&gt;If I have a custom parser, then I&apos;d expect my custom parser to be used first and then blueprint or default parser afterwards. There are a lot cases that people might want to use combination of them. For instance, in this case, I configured &quot;propertyPrefix&quot; property to use property placeholder ${container.stage} here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;propertyPrefix&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${container.stage}.&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My custom parser basically just tries to look up system property for the value of the property placeholder &quot;container.stage&quot; to decide what environment I am in. Say &quot;dev&quot;, &quot;prod&quot; or &quot;test&quot;. Depends on the value returned by my custom parser, I can either go to blueprint or just default file property to find relevant value. And I still want to use blueprint in this case.&lt;/p&gt;

&lt;p&gt;I understand that it was not the intention to support custom parser with blueprint. But I think it is reasonable use case I presented here and more people are going to use blueprint in future so I believe the custom parser with blueprint issue should be addressed in my opinion.&lt;/p&gt;</comment>
                            <comment id="14068550" author="gzres" created="Mon, 21 Jul 2014 14:11:14 +0000"  >&lt;p&gt;Custom parser is set as the delegate (see for example &lt;tt&gt;org.apache.camel.component.jasypt.JasyptPropertiesParser&lt;/tt&gt; which decrypts properties which were first resolved by BlueprintParser) and is called after main parser.&lt;/p&gt;

&lt;p&gt;If your use case is &lt;b&gt;only&lt;/b&gt; about making propertyPrefix/propertySuffix resolvable, then maybe better&amp;amp;simpler would be to do it while configuring PropertiesConfigurer than by changing parser-delegate order.&lt;/p&gt;</comment>
                            <comment id="14068609" author="gzres" created="Mon, 21 Jul 2014 15:16:49 +0000"  >&lt;p&gt;&lt;tt&gt;BlueprintPropertiesParser&lt;/tt&gt; uses provided (configured on &lt;tt&gt;PropertiesComponent&lt;/tt&gt;) parser as delegate (see example with &lt;tt&gt;JasyptPropertiesParser&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;The provided use case is rather about making &lt;tt&gt;propertyPrefix/Suffix&lt;/tt&gt; resolvable against system/env properties and this is how it was resolved.&lt;/p&gt;</comment>
                            <comment id="14068617" author="gzres" created="Mon, 21 Jul 2014 15:20:01 +0000"  >&lt;p&gt;Reopening to update the docs&lt;/p&gt;</comment>
                            <comment id="14069921" author="gzres" created="Tue, 22 Jul 2014 07:15:54 +0000"  >&lt;p&gt;Documentation updated&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394258</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vvtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>