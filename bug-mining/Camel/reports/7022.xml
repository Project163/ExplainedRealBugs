<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:09:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21735] MongoDB component connecting to localhost event if connection data is set</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21735</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;m trying to use the MongoDB component within a Camel K integration. And the code is as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- to:              
    uri: mongodb:dummy              
    parameters:                
      operation: findAll                
      collection: environment                
      database: environments                
      username: someuser                
      password: somepass
      hosts: somehost:27017&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although the connection parameters are set, I see component trying to connect to 127.0.0.1:27017.&lt;/p&gt;

&lt;p&gt;Debugging the source code and checking the log, I see the component is using an autowired client which is configured to localhost instead of creating a new client from my parameters.&#160;&lt;/p&gt;

&lt;p&gt;I haven&apos;t configured any beans.&lt;/p&gt;

&lt;p&gt;But anyways, shoudn&apos;t the endpoint parameters take precedence over any pre-configured bean which I&apos;m not even aware of?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13608025">CAMEL-21735</key>
            <summary>MongoDB component connecting to localhost event if connection data is set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="luiscarneiro">Luis Sergio Faria Carneiro</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2025 17:44:50 +0000</created>
                <updated>Sun, 16 Feb 2025 09:57:27 +0000</updated>
                            <resolved>Sun, 16 Feb 2025 09:57:27 +0000</resolved>
                                    <version>4.8.0</version>
                                    <fixVersion>4.11.0</fixVersion>
                                    <component>camel-mongodb</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17925889" author="squakez" created="Tue, 11 Feb 2025 08:21:16 +0000"  >&lt;p&gt;I think this would be more suitable for Camel Quarkus project. The extension (which is the one used in Camel K) can be responsible for a different behavior. My suggestion is to try a simple reproducer over plain Camel or Camel Springboot as well as for Camel Quarkus and see if it&apos;s indeed a core problem or, as I presume, a runtime problem instead.&lt;/p&gt;</comment>
                            <comment id="17925954" author="luiscarneiro" created="Tue, 11 Feb 2025 11:30:50 +0000"  >&lt;p&gt;Yes, the extension creates a default Mongo client which is injected into the component. What made me open this issue in the core project is the doStart/resolveMongoConnection methods at the &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-mongodb/src/main/java/org/apache/camel/component/mongodb/MongoDbEndpoint.java#L422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MongoDbEndpoint&lt;/a&gt; class.&lt;/p&gt;

&lt;p&gt;In those methods, if any connection is autowired into the component, it takes precedence over the parameters defined at the endpoint level.&lt;/p&gt;

&lt;p&gt;There&apos;s also the &lt;b&gt;connectionBean&lt;/b&gt;&#160;path parameter, which has a lower precedence over the hosts configuration, per the &lt;a href=&quot;https://camel.apache.org/components/4.8.x/mongodb-component.html#_endpoint_path_option_connectionBean&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;docs.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So at the end connections can be defined in three ways:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;autowiring a MongoDBClient;&lt;/li&gt;
	&lt;li&gt;defining a bean and referencing it with the connectionBean path parameter;&lt;/li&gt;
	&lt;li&gt;defining connection data with the hosts and other endpoint parameters;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;#3 takes precedence over #2, but not over #1.&lt;/p&gt;

&lt;p&gt;It that&apos;s expected, we can close this as Not a bug.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17926031" author="squakez" created="Tue, 11 Feb 2025 15:02:22 +0000"  >&lt;p&gt;Thanks for the detailed explanation. I reiterate the question: is this only happening for Camel Quarkus or is it also happening in other runtimes?&lt;/p&gt;</comment>
                            <comment id="17926052" author="luiscarneiro" created="Tue, 11 Feb 2025 16:17:37 +0000"  >&lt;p&gt;Yes, that&apos;s specific to camel-quarkus. Running the code with jbang, for example, works.&lt;/p&gt;

&lt;p&gt;One other point that I noticed is that even if I set autowiredEnabled to false in the parameters, I still see the default client being injected into the component:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-02-11 16:15:51,895 INFO &#160;[org.apa.cam.sup.LifecycleStrategySupport] (main) Autowired property: mongoConnection on component: mongodb as exactly one instance of type: com.mongodb.client.MongoClient (com.mongodb.client.MongoClient_h1_G0-d2ADp3y2Tmh2-WKjUlre0_Synthetic_ClientProxy) found in the registry&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17926298" author="squakez" created="Wed, 12 Feb 2025 08:18:52 +0000"  >&lt;p&gt;Thanks for confirming. I think it&apos;s the way it works the Quarkus MongoDB client. You can have a look at the Quarkus extension documentation &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamesnetherton&quot; class=&quot;user-hover&quot; rel=&quot;jamesnetherton&quot;&gt;jamesnetherton&lt;/a&gt; do you know if this would be suitable for some future enhancement on the extension side by any chance?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://camel.apache.org/camel-quarkus/3.15.x/reference/extensions/mongodb.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/camel-quarkus/3.15.x/reference/extensions/mongodb.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17926345" author="luiscarneiro" created="Wed, 12 Feb 2025 11:35:06 +0000"  >&lt;p&gt;Great, I checked the docs.&lt;/p&gt;

&lt;p&gt;From a developer experience perspective, it feels a little bit confusing to use the mongodb component within a Camel K integration using the yaml dsl.&lt;/p&gt;

&lt;p&gt;I&apos;m trying to setup integrations that connect to a source and a target mongo database, but I feel that the injected client is getting in the way. At the end, there are the hosts/username/password parameters which I cannot use, because the autowired connection is used instead. And if I need to change the default client, I have to do it using quarkus properties, which I managed to do.&lt;/p&gt;

&lt;p&gt;Now I will try to set up the 2 connection scenario, where I create clients, and configure them as described in &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I see that the MongoClient implementation does not have a no-parameters constructor, so it might not be straightforward to declare a bean using the yaml syntax. All the examples I have seen use wither the xml or java dsl.&lt;/p&gt;

&lt;p&gt;From a personal perspective, I like the way the jdbc/sql components work, where I can set up my Datasource beans and reference them in the endpoints with no default datasource being created.&lt;br/&gt;
On the mongodb extension, that default client to localhost might be handy for development environments, where the application and the database run on the same host, but that is not usually what we see in production environments.&lt;/p&gt;

&lt;p&gt;If we can get some enhancements either on the extension or the component that makes it simpler to use, that would be awesome.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://camel.apache.org/camel-quarkus/3.15.x/reference/extensions/mongodb.html#extensions-mongodb-additional-camel-quarkus-configuration&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/camel-quarkus/3.15.x/reference/extensions/mongodb.html#extensions-mongodb-additional-camel-quarkus-configuration&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17926356" author="squakez" created="Wed, 12 Feb 2025 12:20:14 +0000"  >&lt;p&gt;I think the best thing would be to open an issue directly on Camel Quarkus Github page and contribute to the feature if there is no other reason not to do this. I recall we were very dependent on the Quarkus MondoDB dependency a few years back, not sure if the things are different now.&lt;/p&gt;</comment>
                            <comment id="17927253" author="davsclaus" created="Fri, 14 Feb 2025 19:36:49 +0000"  >&lt;p&gt;You can turn off autowiring on the component. But I agree if you set the hostname and other values then the autowired client should not be in use. Maybe we can do something for next version&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1u4wo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>