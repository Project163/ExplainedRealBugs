<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:48:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16692] SFTP sometimes doesn&apos;t receive all files </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16692</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have following Camel route, created by a RoutingBuilder:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.camel.builder.RouteBuilder() {
  void configure() {
    from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:myProgram&quot;&lt;/span&gt;)
      .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;${params.profile}&quot;&lt;/span&gt;)
      .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;sftp:&lt;span class=&quot;code-comment&quot;&gt;//${params.hostname}:${params.port}/${params.directory}?username=RAW(${params.username})&amp;amp;amp;password=RAW(${params.password})&amp;amp;amp;fileName=RAW(\${header.fileName})&amp;amp;amp;fileExist=Fail&amp;amp;amp;disconnect=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;amp;stepwise=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;amp;useUserKnownHostsFile=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;amp;serverAliveInterval=${params.serverAliveInterval}&quot;&lt;/span&gt;)
&lt;/span&gt;  }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This route is the only one which I place on my CamelContext and than I start the CamelContext.&lt;/p&gt;

&lt;p&gt;I&apos;m doing a test on my local machine to send 50 files through this route to a remote SFTP server. Most of the time, all files arrive, but sometimes 1 file seems to be missing.&lt;/p&gt;

&lt;p&gt;My program doesn&apos;t notice the failure of sending. But during debugging I found something interesting that happened.&lt;/p&gt;

&lt;p&gt;That one specific file which is missing throws in the camel library an SFTPException at the method existsFile (SftpOperations.java:1046).&lt;/p&gt;

&lt;p&gt;The exception contains only reason &lt;b&gt;4:&lt;/b&gt;&#160;message but the exception contains another exception.&#160;The wrapped exception contain following exception message: &lt;b&gt;java.io.IOException: Pipe Closed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Camel wraps the exception in a GenericFileOperationFailedException and throws it to the method which called SftpOperations, GenericFileProducer (GenericFileProducer.java:135).&lt;br/&gt;
 That exception arrives in the tr/catch block of it and goes to the generic catch block.&lt;/p&gt;

&lt;p&gt;In that catch-block the exception is handled by the &lt;b&gt;handleWrite()&lt;/b&gt; method (RemoteFileProducer.java:83) and there it gets interesting. &lt;br/&gt;
 In handleWrite() check is performed if the Camel Base Service is in stopping() or stopped() state. If that&apos;s the case, the exception is only logged but not thrown. But isStopped() returns true, so my exception is thrown, but my application doesn&apos;t receive it, so it thinks that the file is transferred succesfully to the SFTP server, but it never arrives.&lt;/p&gt;</description>
                <environment>&lt;p&gt;I&apos;m reproducing this on my own computer and a SFTP server running on a Docker container locally.&lt;/p&gt;</environment>
        <key id="13382392">CAMEL-16692</key>
            <summary>SFTP sometimes doesn&apos;t receive all files </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Jonas_a">Jonas Audenaert</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jun 2021 07:38:08 +0000</created>
                <updated>Tue, 29 Jun 2021 05:25:52 +0000</updated>
                            <resolved>Thu, 24 Jun 2021 13:13:55 +0000</resolved>
                                    <version>3.7.3</version>
                                    <fixVersion>3.11.1</fixVersion>
                    <fixVersion>3.12.0</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17358504" author="davsclaus" created="Mon, 7 Jun 2021 10:57:18 +0000"  >&lt;p&gt;So are you stopping / shutting down your Camel application?&lt;/p&gt;</comment>
                            <comment id="17358507" author="davsclaus" created="Mon, 7 Jun 2021 10:58:00 +0000"  >&lt;p&gt;If you can build a reproducer sample application and put on github with readme file how to run and test then that would be good.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rpg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>