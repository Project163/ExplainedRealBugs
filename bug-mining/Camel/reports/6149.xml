<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:54:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17723] camel-ssh - Dynamic Header is not resolved in pollCommand using endpoint-dsl</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17723</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hello&lt;/p&gt;

&lt;p&gt;I have been trying to add a dynamic argument to SSH command through a header. However the pollCommand parameter does not resolve it and issue the command as is.&lt;/p&gt;

&lt;p&gt;Please see this Zulip discussion:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Dynamic.20SSH.20command&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Dynamic.20SSH.20command&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also tried to create a UnitTest to replicate the issue, please see attached.&lt;/p&gt;

&lt;p&gt;Best regards&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13430952">CAMEL-17723</key>
            <summary>camel-ssh - Dynamic Header is not resolved in pollCommand using endpoint-dsl</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jondruse">Jiri Ondrusek</assignee>
                                    <reporter username="gnieser">Guillaume N.</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Feb 2022 09:33:51 +0000</created>
                <updated>Mon, 16 May 2022 17:51:34 +0000</updated>
                            <resolved>Mon, 16 May 2022 17:51:34 +0000</resolved>
                                    <version>3.15.0</version>
                                    <fixVersion>3.18.0</fixVersion>
                                    <component>camel-ssh</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17506820" author="jondruse" created="Tue, 15 Mar 2022 09:49:47 +0000"  >&lt;p&gt;I went through the chat and the proposed test.&#160;&lt;/p&gt;

&lt;p&gt;Here is a code snippet from the test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:ssh&quot;&lt;/span&gt;)
                        .pollEnrich(&lt;span class=&quot;code-quote&quot;&gt;&quot;ssh:&lt;span class=&quot;code-comment&quot;&gt;//smx:smx@localhost:&quot;&lt;/span&gt; + port + &lt;span class=&quot;code-quote&quot;&gt;&quot;?useFixedDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;delay=40000&amp;amp;pollCommand=${in.header.CommandArg}%0A&quot;&lt;/span&gt;)
&lt;/span&gt;                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the relevant doc, which describes how it should work: &lt;a href=&quot;https://camel.netlify.app/components/latest/eips/pollEnrich-eip.html#_using_dynamic_uris&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.netlify.app/components/latest/eips/pollEnrich-eip.html#_using_dynamic_uris&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;The test misses &lt;b&gt;.simple(...)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;if test is changed (see below), it works as expected.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:ssh&quot;&lt;/span&gt;)
                        .pollEnrich().simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;ssh:&lt;span class=&quot;code-comment&quot;&gt;//smx:smx@localhost:&quot;&lt;/span&gt; + port + &lt;span class=&quot;code-quote&quot;&gt;&quot;?useFixedDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;delay=40000&amp;amp;pollCommand=${header.CommandArg}%0A&quot;&lt;/span&gt;)
&lt;/span&gt;                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnieser&quot; class=&quot;user-hover&quot; rel=&quot;gnieser&quot;&gt;gnieser&lt;/a&gt; Does this explanation solve your problem?&lt;/p&gt;</comment>
                            <comment id="17506885" author="davsclaus" created="Tue, 15 Mar 2022 12:43:02 +0000"  >&lt;p&gt;Jiri, can you try also with camel-endpointdsl, where you build the uri using the builder instead of a string uri&lt;/p&gt;</comment>
                            <comment id="17508673" author="jondruse" created="Fri, 18 Mar 2022 09:35:29 +0000"  >&lt;p&gt;I&apos;ll verify it&lt;/p&gt;</comment>
                            <comment id="17508705" author="jondruse" created="Fri, 18 Mar 2022 10:42:18 +0000"  >&lt;p&gt;I tested following route:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:ssh&quot;&lt;/span&gt;)
                        .pollEnrich(
                                ssh(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:&quot;&lt;/span&gt; + port).username(&lt;span class=&quot;code-quote&quot;&gt;&quot;smx&quot;&lt;/span&gt;).password(&lt;span class=&quot;code-quote&quot;&gt;&quot;smx&quot;&lt;/span&gt;)
                                        .useFixedDelay(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).delay(4000)
                                        .pollCommand(&lt;span class=&quot;code-quote&quot;&gt;&quot;${in.header.CommandArg}&quot;&lt;/span&gt;))
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Result if failure: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Expected :&amp;lt;test&amp;gt;
Actual   :&amp;lt;${in.header.CommandArg}&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll dig more into it and try to find a way of defining route to be working.&lt;/p&gt;</comment>
                            <comment id="17508778" author="jondruse" created="Fri, 18 Mar 2022 13:25:52 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, I&apos;m debugging the code and I found a reason of the wrong behavior, but I&apos;m not sure how it should be fixed.&lt;/p&gt;

&lt;p&gt;If the route below is used&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:ssh&quot;&lt;/span&gt;)
                        .pollEnrich(
                                ssh(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:&quot;&lt;/span&gt; + port).username(&lt;span class=&quot;code-quote&quot;&gt;&quot;smx&quot;&lt;/span&gt;).password(&lt;span class=&quot;code-quote&quot;&gt;&quot;smx&quot;&lt;/span&gt;)
                                        .useFixedDelay(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).delay(4000)
                                        .pollCommand(&lt;span class=&quot;code-quote&quot;&gt;&quot;${header.CommandArg}&quot;&lt;/span&gt;))
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;SshEndpoint builder returns &lt;b&gt;encoded&lt;/b&gt; uri &quot;ssh://localhost:40249?delay=4000&amp;amp;password=smx&amp;amp;pollCommand=&lt;b&gt;%24%7Bheader.CommandArg%7D&lt;/b&gt;&amp;amp;useFixedDelay=true&amp;amp;username=smx&quot;&lt;/p&gt;

&lt;p&gt;This uri is then evaluated as an expression in `ExpressionAdapter`, but because it is encoded, it is not evaluated correctly.&lt;/p&gt;

&lt;p&gt;If the workaround is used (from my first omment, which fixes test to pass), then url entering `ExressionAdapter` is `ssh://smx:smx@localhost:43915?delay=4000&amp;amp;password=smx&amp;amp;pollCommand=&lt;b&gt;${in.header.CommandArg}&lt;/b&gt;&amp;amp;useFixedDelay=true` ad is resolved correctly.&lt;/p&gt;

&lt;p&gt;I have several ideas, how to solve the problem. Following 2 approaches seem to be &quot;the safest ones&quot; (shouldn&apos;t broke other code - at least I hope)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;value can be decoded before evaluation of the expression is triggered&lt;/li&gt;
	&lt;li&gt;evaluation of the expression can &quot;understand encoded strings&quot;, which will make evaluation to be correct&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In case you have an idea how this could be solved, please let me know. (I can fore example turn off encodidng for dsl builders, but it may cause problems - from my POV)&lt;/p&gt;</comment>
                            <comment id="17508786" author="davsclaus" created="Fri, 18 Mar 2022 13:48:38 +0000"  >&lt;p&gt;Jiri, great analysis&lt;/p&gt;

&lt;p&gt;Yeah the endpoint-dsl is building up an URI string - and encoded as you say.&lt;/p&gt;

&lt;p&gt;I wonder if the endpoint DSL builder needs for options that can be expression to expose this too&lt;/p&gt;

&lt;p&gt;.pollCommand(&quot;${header.CommandArg}&quot;))&lt;/p&gt;

&lt;p&gt;So you can do&lt;/p&gt;

&lt;p&gt;.pollCommand(simple(&quot;${header.CommandArg}&quot;)))&lt;/p&gt;

&lt;p&gt;Then its explicit that this is a simple expression.&lt;br/&gt;
But that requires to markup all these options that have this feature.&lt;/p&gt;

&lt;p&gt;And it comes back to pollEnrich taking a string as input will evaluate that as simple today.&lt;br/&gt;
But when the string is build using endpoint-dsl, then its encoded as you analysis found out.&lt;/p&gt;

&lt;p&gt;What we can maybe do is to have&lt;/p&gt;

&lt;p&gt;    public Type pollEnrich(EndpointConsumerBuilder resourceUri) &lt;/p&gt;
{
        return pollEnrich(new SimpleExpression(resourceUri.getUri()), -1, (String) null, false);
    }

&lt;p&gt;Which is where this happens, we could have a getRawUri() (not encoded) on the endpoint-dsl builder methods.&lt;br/&gt;
Then we can likely fix this for pollEnrich and maybe a few other EIPs that does this ^^^^&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13040523" name="SshComponentProducerCommandTest.java" size="2288" author="gnieser" created="Mon, 28 Feb 2022 09:31:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zzy0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>