<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:24:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11476] spring-boot - routes not loaded when setting a management.port</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11476</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This is a really weird bug. If you set:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;management.port=8081
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the application.properties file of any spring-boot application using actuator, then camel routes created through RouteBuilders are not loaded (&quot;Total 0 routes, of which 0 are started.&quot;). &lt;/p&gt;

&lt;p&gt;I&apos;ve found it in (all) the fabric8 basic quickstarts, but it happens also in the &quot;camel-example-spring-boot&quot; bundled with Apache Camel. Everything works in 2.19.x.&lt;/p&gt;

&lt;p&gt;Setting a different management port is a best practice. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zregvart&quot; class=&quot;user-hover&quot; rel=&quot;zregvart&quot;&gt;zregvart&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cibsen%40e-ma.net&quot; class=&quot;user-hover&quot; rel=&quot;cibsen@e-ma.net&quot;&gt;cibsen@e-ma.net&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lb&quot; class=&quot;user-hover&quot; rel=&quot;lb&quot;&gt;lb&lt;/a&gt; any idea?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13083151">CAMEL-11476</key>
            <summary>spring-boot - routes not loaded when setting a management.port</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zregvart">Zoran Regvart</assignee>
                                    <reporter username="nferraro">Nicola Ferraro</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jun 2017 14:17:06 +0000</created>
                <updated>Thu, 29 Jun 2017 12:34:03 +0000</updated>
                            <resolved>Thu, 29 Jun 2017 12:34:03 +0000</resolved>
                                    <version>2.20.0</version>
                                    <fixVersion>2.20.0</fixVersion>
                                    <component>camel-spring-boot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16066634" author="zregvart" created="Wed, 28 Jun 2017 15:00:38 +0000"  >&lt;p&gt;I wonder if the change I did in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11261&quot; title=&quot;Revise Camel context destruction in Spring (Boot) applications&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11261&quot;&gt;&lt;del&gt;CAMEL-11261&lt;/del&gt;&lt;/a&gt; had any influence on this.&lt;/p&gt;</comment>
                            <comment id="16066838" author="davsclaus" created="Wed, 28 Jun 2017 16:41:38 +0000"  >&lt;p&gt;Just to be sure this is only a problem on the master branch of Camel ?&lt;/p&gt;</comment>
                            <comment id="16066995" author="zregvart" created="Wed, 28 Jun 2017 18:21:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; yes, and I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nferraro&quot; class=&quot;user-hover&quot; rel=&quot;nferraro&quot;&gt;nferraro&lt;/a&gt; alluded to that in the description, but I verified, with 2.19.1 &lt;tt&gt;camel-example-spring-boot&lt;/tt&gt; and &lt;tt&gt;management.port=8081&lt;/tt&gt; finds the &lt;tt&gt;RouteBuilder&lt;/tt&gt; route, with 2.20.0-SNAPSHOT it does not.&lt;/p&gt;</comment>
                            <comment id="16067073" author="zregvart" created="Wed, 28 Jun 2017 19:14:47 +0000"  >&lt;p&gt;I&apos;ve found the issue and a possible solution, I&apos;m running tests to see if the solution caused any other issues.&lt;/p&gt;

&lt;p&gt;The problem is that the equality check in &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-spring-boot/src/main/java/org/apache/camel/spring/boot/RoutesCollector.java#L81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RoutesCollector.java#L81&lt;/a&gt; does not pass when &lt;tt&gt;management.port=8081&lt;/tt&gt; is set. And this in turn is because &lt;a href=&quot;https://github.com/spring-projects/spring-boot/blob/master/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/autoconfigure/EndpointWebMvcAutoConfiguration.java#L144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;EndpointWebMvcAutoConfiguration.java#L144&lt;/a&gt; instantiates a new &lt;tt&gt;ApplicationContext&lt;/tt&gt; instance if the management port is customized.&lt;/p&gt;

&lt;p&gt;So previously &lt;tt&gt;RoutesCollector} would start {{CamelContext&lt;/tt&gt; but now &lt;tt&gt;CamelContext&lt;/tt&gt; is started by &lt;tt&gt;ContextRefreshedEvent&lt;/tt&gt;, and it is started on the first &lt;tt&gt;ContextRefreshedEvent&lt;/tt&gt; for the first &lt;tt&gt;ApplicationContext&lt;/tt&gt;, and as &lt;tt&gt;RoutesCollector&lt;/tt&gt; checks if its a part of that &lt;tt&gt;AppplicationContext&lt;/tt&gt; it won&apos;t add &lt;tt&gt;RouteBuilders&lt;/tt&gt;, and the second &lt;tt&gt;ContextRefreshedEvent&lt;/tt&gt; from the second &lt;tt&gt;ApplicationContext&lt;/tt&gt; does not load any &lt;tt&gt;RouteBuilders&lt;/tt&gt; as at that point &lt;tt&gt;CamelContext&lt;/tt&gt; is already started and the second check in  &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-spring-boot/src/main/java/org/apache/camel/spring/boot/RoutesCollector.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RoutesCollector.java#L86&lt;/a&gt; will not pass.&lt;/p&gt;</comment>
                            <comment id="16068024" author="githubbot" created="Thu, 29 Jun 2017 08:48:27 +0000"  >&lt;p&gt;GitHub user zregvart opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11476&quot; title=&quot;spring-boot - routes not loaded when setting a management.port&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11476&quot;&gt;&lt;del&gt;CAMEL-11476&lt;/del&gt;&lt;/a&gt;: spring-boot - routes not loaded when setting a management.port&lt;/p&gt;

&lt;p&gt;    @nicolaferraro would you mind taking a look, thanks &#128077; &lt;/p&gt;

&lt;p&gt;    Fixes `RouteBuilder` (Java DSL) based routes not loading when setting `management.port` Spring Boot property by removing the &apos;same application context&apos; check.&lt;/p&gt;

&lt;p&gt;    Also removes `maybeStart` method to start the Camel context from `RoutesCollector`, startup is now handled in `SpringCamelContext`.&lt;/p&gt;

&lt;p&gt;    When customizing the `management.port` configuration option Spring Boot creates a new `ApplicationContext` instance which when started emits a `ContextRefreshedEvent` that is different from the `ApplicationContext` the `RoutesCollector` is initialized with.&lt;/p&gt;

&lt;p&gt;    Due to change in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11261&quot; title=&quot;Revise Camel context destruction in Spring (Boot) applications&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11261&quot;&gt;&lt;del&gt;CAMEL-11261&lt;/del&gt;&lt;/a&gt;, `SpringCamelContext` is started via the same `ContextRefreshedEvent`, at the point the second `ContextRefreshedEvent` emited from the `ApplicationContext`, that `RoutesCollector` is initialized with, `SpringCamelContext` is already started and no Java DSL routes are added to Camel context.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zregvart/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zregvart/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11476&quot; title=&quot;spring-boot - routes not loaded when setting a management.port&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11476&quot;&gt;&lt;del&gt;CAMEL-11476&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1797.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1797.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1797&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3ab5ce9c61daf2d50f2f33ac78dfa189aa2cd1a8&lt;br/&gt;
Author: Zoran Regvart &amp;lt;zregvart@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-29T08:42:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11476&quot; title=&quot;spring-boot - routes not loaded when setting a management.port&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11476&quot;&gt;&lt;del&gt;CAMEL-11476&lt;/del&gt;&lt;/a&gt;: spring-boot - routes not loaded wh...&lt;/p&gt;

&lt;p&gt;    ...en setting a management.port&lt;/p&gt;

&lt;p&gt;    Fixes `RouteBuilder` (Java DSL) based routes not loading when setting&lt;br/&gt;
    `management.port` Spring Boot property by removing the &apos;same application&lt;br/&gt;
    context&apos; check.&lt;/p&gt;

&lt;p&gt;    Also removes `maybeStart` method to start the Camel context from&lt;br/&gt;
    `RoutesCollector`, startup is now handled in `SpringCamelContext`.&lt;/p&gt;

&lt;p&gt;    When customizing the `management.port` configuration option Spring Boot&lt;br/&gt;
    creates a new `ApplicationContext` instance which when started emits a&lt;br/&gt;
    `ContextRefreshedEvent` that is different from the `ApplicationContext`&lt;br/&gt;
    the `RoutesCollector` is initialized with.&lt;/p&gt;

&lt;p&gt;    Due to change in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11261&quot; title=&quot;Revise Camel context destruction in Spring (Boot) applications&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11261&quot;&gt;&lt;del&gt;CAMEL-11261&lt;/del&gt;&lt;/a&gt;, `SpringCamelContext` is started via the&lt;br/&gt;
    same `ContextRefreshedEvent`, at the point the second&lt;br/&gt;
    `ContextRefreshedEvent` emited from the `ApplicationContext`, that&lt;br/&gt;
    `RoutesCollector` is initialized with, `SpringCamelContext` is already&lt;br/&gt;
    started and no Java DSL routes are added to Camel context.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16068274" author="githubbot" created="Thu, 29 Jun 2017 12:32:14 +0000"  >&lt;p&gt;Github user zregvart closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1797&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16068276" author="zregvart" created="Thu, 29 Jun 2017 12:34:03 +0000"  >&lt;p&gt;Merged to &lt;tt&gt;master&lt;/tt&gt; from &lt;a href=&quot;https://github.com/apache/camel/pull/1797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR#1797&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12780354">CAMEL-8460</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gubz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>