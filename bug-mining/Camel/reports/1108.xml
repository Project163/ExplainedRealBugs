<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:39:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2991] Restart CamelContext won&apos;t restart services on CxfBeanEndpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2991</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A route that sends to a CxfBean destination is unusable after the CamelContext has been stopped and re-started.  The following is an example of a route that demonstrates the problem.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&amp;lt;camelContext id=&lt;span class=&quot;code-quote&quot;&gt;&quot;camel&quot;&lt;/span&gt; xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/spring&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;		&amp;lt;route&amp;gt;
			&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;jetty:http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9000?matchOnUriPrefix=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
&lt;/span&gt;			&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfbean:customerServiceBean&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/route&amp;gt;
	&amp;lt;/camelContext&amp;gt;

	&amp;lt;util:list id=&lt;span class=&quot;code-quote&quot;&gt;&quot;customerServiceBean&quot;&lt;/span&gt;&amp;gt;
		&amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&quot;&lt;/span&gt; /&amp;gt;
	&amp;lt;/util:list&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The follow issues have been identified.&lt;/p&gt;

&lt;p&gt;1) SendProcessor should implement the Navigate interface so that its children (if they are Services) can be managed by the lifecycle methods.  This will address any destination endpoint that requires services to be re-started.&lt;/p&gt;

&lt;p&gt;2) CxfBeanEndpoint should be a Service itself.  The reason why the start() on CxfBeanEndpoint gets called during the first start is because CxfBeanComponent.start() gets invoked during route definition initialization.   The problem is that re-starting doesn&apos;t trigger the CxfBeanComponent.start() method.  Therefore, putting the hook in CxfBeanComponent to start/stop CxfBeanEndpoint was a bug.&lt;/p&gt;

&lt;p&gt;3) The default type converter which is a Service won&apos;t get &quot;re-started&apos; as the (lazy-instantiation) getTypeConverter() method won&apos;t perform addService() on a created but &quot;stopped&apos; typeConverter.  We need to discuss the correct remedy since I am not sure how to fix it.  It is kind of strange that the type converter is a service (which has the start/stop semantics) and yet it can be used even the CamelContext is stopped (or never started).  In the patch, I just set the type converter to null in DefaultCamelContext doStop() for now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12485562">CAMEL-2991</key>
            <summary>Restart CamelContext won&apos;t restart services on CxfBeanEndpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="wtam">William Tam</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jul 2010 03:02:17 +0000</created>
                <updated>Sun, 24 Apr 2011 09:58:12 +0000</updated>
                            <resolved>Tue, 27 Jul 2010 06:23:36 +0000</resolved>
                                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-core</component>
                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12953335" author="davsclaus" created="Sun, 25 Jul 2010 06:50:45 +0000"  >&lt;p&gt;Which runtime are you using? OSGi or something else?&lt;/p&gt;</comment>
                            <comment id="12949698" author="davsclaus" created="Sun, 25 Jul 2010 06:53:44 +0000"  >&lt;p&gt;BTW Doing a stop/start of CamelContext is not 100% safe to be totally possible to restart.&lt;br/&gt;
The mantra is to create a new context instead. &lt;/p&gt;</comment>
                            <comment id="12949498" author="davsclaus" created="Sun, 25 Jul 2010 07:28:22 +0000"  >&lt;p&gt;trunk: 978994.&lt;/p&gt;

&lt;p&gt;I have fixed the issue in CamelContext to re-initialize type converter registry on restart&lt;/p&gt;</comment>
                            <comment id="12949343" author="davsclaus" created="Mon, 26 Jul 2010 06:02:55 +0000"  >&lt;p&gt;trunk: 979164.&lt;/p&gt;

&lt;p&gt;a)&lt;br/&gt;
Endpoint is now a Service which means (#2) CxfBeanEndpoint is now also a Service.&lt;/p&gt;

&lt;p&gt;b)&lt;br/&gt;
TypeConverter now check state that it&apos;s started when being used.&lt;/p&gt;</comment>
                            <comment id="12950353" author="davsclaus" created="Mon, 26 Jul 2010 07:31:37 +0000"  >&lt;p&gt;Hmm the logic in &lt;tt&gt;CxfBeanDestination&lt;/tt&gt; is a bit peculiar&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;active&lt;/tt&gt; method is invoked when &lt;tt&gt;org.apache.cxf.endpoint.Server&lt;/tt&gt; is started from &lt;tt&gt;CxfBeanEndpoint&lt;/tt&gt; in the &lt;tt&gt;createServer&lt;/tt&gt; method.&lt;br/&gt;
Then the &lt;tt&gt;active&lt;/tt&gt; method will lookup a shared &lt;tt&gt;CxfBeanEndpoint&lt;/tt&gt; which is stored on &lt;tt&gt;CxfBeanComponent&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The problem is that this shared endpoint instance will have the &lt;tt&gt;setProcessor&lt;/tt&gt; invoked, which then &lt;b&gt;overrides&lt;/b&gt; a previously set processor.&lt;/p&gt;

&lt;p&gt;I don&apos;t know a good solution to this at this point. Maybe there is a bit impedance mismatch between the CXF API lifecycle and Camel&apos;s lifecycle API.&lt;/p&gt;</comment>
                            <comment id="12950890" author="davsclaus" created="Mon, 26 Jul 2010 07:44:57 +0000"  >&lt;p&gt;I found a problem in &lt;tt&gt;CamelDestination&lt;/tt&gt; as it just creates a new &lt;tt&gt;DefaultCamelContext&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CamelContext getCamelContext() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (camelContext == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            getLogger().log(Level.INFO, &lt;span class=&quot;code-quote&quot;&gt;&quot;No CamelContext injected, create a &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; one&quot;&lt;/span&gt;);
            camelContext = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultCamelContext();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; camelContext;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a big no no. And I have fixed the issue as the CamelContext can be obtained from the &lt;tt&gt;CxfBeanComponent&lt;/tt&gt; which has the context injected.&lt;/p&gt;

&lt;p&gt;Also there was an issue when creating a CxfConsumer and if that failed with an Exception it was just logged. Instead a FailedToCreateConsumerException should be thrown. We should fail fast in such cases.&lt;/p&gt;


&lt;p&gt;Fixed the above issue and polished the code and javadoc&lt;/p&gt;

&lt;p&gt;trunk: 979188.&lt;/p&gt;</comment>
                            <comment id="12948925" author="wtam" created="Mon, 26 Jul 2010 15:50:52 +0000"  >&lt;p&gt;@claus  I tried your fixes but my route is still unusable after CamelContext is restarted.  I attached the test case and assign to you.  Thanks for looking at it.&lt;/p&gt;</comment>
                            <comment id="12948909" author="davsclaus" created="Tue, 27 Jul 2010 06:23:36 +0000"  >&lt;p&gt;trunk: 979549.&lt;/p&gt;

&lt;p&gt;I found an issue in camel-core and the test now works.&lt;/p&gt;</comment>
                            <comment id="13024099" author="davsclaus" created="Sun, 24 Apr 2011 09:58:12 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12485530">CAMEL-3001</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12463309" name="CAMEL-2991-test-case.txt" size="2526" author="wtam" created="Mon, 26 Jul 2010 15:46:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01rzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>