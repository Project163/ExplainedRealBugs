<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:51:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5282] Strange race condition in for SEDA, when shutting down in Camel 2.9.1</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5282</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We have file endpoints, with idemptotent file repository feeds into a SEDA chanel.&lt;br/&gt;
Behind the SEDA is a solution, which can only deal one file at a time.&lt;/p&gt;

&lt;p&gt;If the system some reason shutdowns, than on restart we shouldn&apos;t consume already consumed files.&lt;/p&gt;

&lt;p&gt;If exception occurs, we shutdown our application.&lt;br/&gt;
This behaviour assured by a unit test, which begin to fail when we introduce timeout=0 configuration.&lt;/p&gt;

&lt;p&gt;Here is the pseudo code:&lt;/p&gt;

&lt;p&gt;onException(RuntimeException.class).process(new ShutDown());&lt;/p&gt;

&lt;p&gt;from(&quot;file:/tempfolder/files/?idempotent=true&amp;amp;noop=true&amp;amp;idempotentRepository=#repo&amp;amp;delay=1000&quot;)&lt;br/&gt;
            .inOut(&quot;seda:process?timeout=0&quot;);&lt;/p&gt;

&lt;p&gt;from(&quot;seda:process&quot;).delay(1000).throwException(new RuntimeException(&quot;Testing with exception&quot;));&lt;/p&gt;

&lt;p&gt;I use inOut so the file thread, waits for SEDA to acomplish. This serves as there is an exception happens behind seda side, by using DefaultErrorHandler strategy it propagates back to file endpoint and the sent file, won&apos;t be marked consumed.&lt;/p&gt;

&lt;p&gt;With 2.9.1 the files marked as consumed (meaning recorded in the idempotent repository) 90% of the times. I say % because sometimes the test passes without any issue. On 2.9.0 I wasn&apos;t able to reproduce the error.&lt;/p&gt;

&lt;p&gt;NOTE: When you remove the timeout, than behaviour will be fine&lt;br/&gt;
So on 2.9.0 and 2.9.1 with positive timeout there is no issue.&lt;br/&gt;
In 2.9.1 timeout &amp;lt; 1 there is issue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP, jdk1.6.0_29&lt;/p&gt;</environment>
        <key id="12556241">CAMEL-5282</key>
            <summary>Strange race condition in for SEDA, when shutting down in Camel 2.9.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="edvicif">David Cifer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 May 2012 13:55:54 +0000</created>
                <updated>Sun, 20 May 2012 14:25:44 +0000</updated>
                            <resolved>Sun, 20 May 2012 08:11:44 +0000</resolved>
                                    <version>2.9.1</version>
                                    <fixVersion>2.9.3</fixVersion>
                    <fixVersion>2.10.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13277815" author="edvicif" created="Thu, 17 May 2012 13:57:34 +0000"  >&lt;p&gt;The unit tests, which reproduce the error&lt;/p&gt;</comment>
                            <comment id="13277818" author="edvicif" created="Thu, 17 May 2012 13:58:27 +0000"  >&lt;p&gt;Maybe the error relates: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-4882&quot; title=&quot;Timed out Exchanges should be removed from seda queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-4882&quot;&gt;&lt;del&gt;CAMEL-4882&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13277835" author="edvicif" created="Thu, 17 May 2012 14:08:19 +0000"  >&lt;p&gt;I don&apos;t know this is the same issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5033&quot; title=&quot;Seda producer should not handover completions if waiting for task to complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5033&quot;&gt;&lt;del&gt;CAMEL-5033&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13277839" author="edvicif" created="Thu, 17 May 2012 14:14:23 +0000"  >&lt;p&gt;This test shows, that with default 30 sec timeout the behavoir is stable&lt;/p&gt;</comment>
                            <comment id="13279560" author="davsclaus" created="Sat, 19 May 2012 14:57:19 +0000"  >&lt;p&gt;Can you re-attached the files and mark &lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; in grant license to Apache. Otherwise we cannot use them for regression testing in the source.&lt;/p&gt;</comment>
                            <comment id="13279561" author="davsclaus" created="Sat, 19 May 2012 15:00:17 +0000"  >&lt;p&gt;See this FAQ how to properly shutdown a route from a route. What you do is wrong&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/how-can-i-stop-a-route-from-a-route.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/how-can-i-stop-a-route-from-a-route.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13279587" author="edvicif" created="Sat, 19 May 2012 17:10:44 +0000"  >&lt;p&gt;Got the idea from the book &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I used the latch solution on a project, but I was allowed to modify the application lifecycle logic...&lt;/p&gt;

&lt;p&gt;I try to implement server applications, with camel... but the requirements most of the time is a short running feed applications... maybe a reusable but properly implemented shutdown component would be handy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13279692" author="davsclaus" created="Sun, 20 May 2012 08:11:44 +0000"  >&lt;p&gt;This is working as designed. &lt;br/&gt;
I have added unit tests, that runs fine.&lt;/p&gt;

&lt;p&gt;And btw the source code for the Camel in Action book has been updated to follow the practice outlined in that FAQ&lt;/p&gt;</comment>
                            <comment id="13279738" author="edvicif" created="Sun, 20 May 2012 12:54:36 +0000"  >&lt;p&gt;Sorry. Maybe I&apos;m looking in wrong files... but I didn&apos;t see in the commit list the test, which tries with seda:name?timeout=0&lt;/p&gt;</comment>
                            <comment id="13279746" author="davsclaus" created="Sun, 20 May 2012 13:28:06 +0000"  >&lt;p&gt;A timeout with 0 does &lt;b&gt;not&lt;/b&gt; make sense.&lt;/p&gt;</comment>
                            <comment id="13279747" author="edvicif" created="Sun, 20 May 2012 13:30:12 +0000"  >&lt;p&gt;I thought timeout=0 means that never timeout.&lt;/p&gt;</comment>
                            <comment id="13279751" author="davsclaus" created="Sun, 20 May 2012 13:39:37 +0000"  >&lt;p&gt;Yeah timeout=0 or timeout=-1, is the same as &lt;b&gt;not&lt;/b&gt; specifying timeout, which there is already a test for. Click the subversions tab on the JIRA tracker to see the commits.&lt;/p&gt;</comment>
                            <comment id="13279754" author="edvicif" created="Sun, 20 May 2012 13:44:16 +0000"  >&lt;p&gt;Oh. I thought not specifying timeout means it should have 30000 as default. I think this is the reason we tried to introduce timeout=0. Because large file consumption timed out on the producer side side.&lt;/p&gt;</comment>
                            <comment id="13279756" author="davsclaus" created="Sun, 20 May 2012 13:46:50 +0000"  >&lt;p&gt;Ah yeah sorry. I just added a timeout=-1 example. All of them works fine.&lt;/p&gt;</comment>
                            <comment id="13279761" author="edvicif" created="Sun, 20 May 2012 13:53:20 +0000"  >&lt;p&gt;Hmm. Let me try it on my home machine. In the office 7-9 out times from 10 failed.&lt;/p&gt;</comment>
                            <comment id="13279767" author="edvicif" created="Sun, 20 May 2012 14:08:47 +0000"  >&lt;p&gt;I was able to reproduce this issue, with my the tests I sent. This is environment is Linux, with multi-core processor. I try to implement now the thread solution, what u showed in the FAQ.&lt;/p&gt;</comment>
                            <comment id="13279770" author="edvicif" created="Sun, 20 May 2012 14:16:13 +0000"  >&lt;p&gt;Ok. When I move to the thread solution the application shutdowns fine and the exceptions arrives as well. So works for me. Thx for the help.&lt;/p&gt;</comment>
                            <comment id="13279777" author="davsclaus" created="Sun, 20 May 2012 14:25:44 +0000"  >&lt;p&gt;Yeah you really need to use a separate thread for stopping/shutting down. This is also how you do eg when you stop the JVM etc.&lt;br/&gt;
If you do in the same thread as processing the message, then its much harder and causes blocking issues and whatnot. Hence why the FAQ and the Camel in Action source code has been updated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12527836" name="SedaTimeoutTest.java" size="2534" author="edvicif" created="Thu, 17 May 2012 13:57:34 +0000"/>
                            <attachment id="12528262" name="TimeoutSetToDefault30SecSedaTimeoutTest.java" size="2548" author="edvicif" created="Sat, 19 May 2012 16:48:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241155</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0264n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>