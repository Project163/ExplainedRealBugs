<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:45:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16227] Netty with reuseChannel=true invokes wrong callback</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16227</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Netty when configured with &lt;tt&gt;reuseChannel=true&lt;/tt&gt; invokes wrong &lt;tt&gt;AsyncCallback&lt;/tt&gt;. It invokes callback registered by first netty invocation in given route multiple times. This can be observed by debugging &lt;tt&gt;NettyReuseChannelTest&lt;/tt&gt;. This seems not to cause serious problems at least in simple cases, because both callbacks (from &lt;tt&gt;SendProcessor&lt;/tt&gt;) do not do much and simply continue routing. I am not sure if in more complex cases this could cause more problems.&lt;/p&gt;

&lt;p&gt;However there is one observable issue caused by this behavior: event notifications contain wrong endpoint and wrong time taken. I attached a test for it.&lt;/p&gt;

&lt;p&gt;Another problem is that this behavior makes it harder (if possible at all) to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16178&quot; title=&quot;Enrich with REST+netty hangs when connection is closed without response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-16178&quot;&gt;&lt;del&gt;CAMEL-16178&lt;/del&gt;&lt;/a&gt; for case with &lt;tt&gt;reuseChannel=true&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13359039">CAMEL-16227</key>
            <summary>Netty with reuseChannel=true invokes wrong callback</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="krzysztofjamroz">Krzysztof Jamr&#243;z</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Feb 2021 10:54:56 +0000</created>
                <updated>Thu, 18 Feb 2021 16:08:31 +0000</updated>
                            <resolved>Thu, 18 Feb 2021 16:08:31 +0000</resolved>
                                    <version>3.7.2</version>
                                    <fixVersion>3.7.3</fixVersion>
                    <fixVersion>3.9.0</fixVersion>
                                    <component>camel-netty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17285793" author="krzysztofjamroz" created="Wed, 17 Feb 2021 11:22:16 +0000"  >&lt;p&gt;The underlying issue is that each &lt;tt&gt;NettyProducer&lt;/tt&gt; (there are 2 of them - one for each &lt;tt&gt;to(&quot;netty:tcp...&quot;)&lt;/tt&gt;) has its own &lt;tt&gt;NettyCamelStateCorrelationManager&lt;/tt&gt;, each with separate map of &lt;tt&gt;NettyCamelState&lt;/tt&gt;. And when netty is invoked second time, what is supposed to reuse channel, it really reuses it but registers callback in wrong correlation manager. &lt;tt&gt;NettyCamelState&lt;/tt&gt; should be registered in correlation manager for producer that opened the channel but uses correlation manager of sending producer. Then, when response is processed first &lt;tt&gt;NettyCamelState&lt;/tt&gt; is found, not the second one.&lt;/p&gt;

&lt;p&gt;I am not sure how this should be a fixed:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Looking up correct correlation manager in &lt;tt&gt;processWithConnectedChannel&lt;/tt&gt;&#160;would need some information which currently is not there, eg. new property on Exchange with correlation manager or original producer similar to &lt;tt&gt;NETTY_CHANNEL&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Moving &lt;tt&gt;NettyCamelStateCorrelationManager&lt;/tt&gt; from &lt;tt&gt;NettyProducer&lt;/tt&gt; to &lt;tt&gt;NettyEndpoint&lt;/tt&gt; seems to be risky or wrong&lt;/li&gt;
	&lt;li&gt;There is no room to store additional data in &lt;tt&gt;Channel&lt;/tt&gt; itself&lt;/li&gt;
	&lt;li&gt;Reusing the same &lt;tt&gt;NettyProducer&lt;/tt&gt; when &lt;tt&gt;reuseChannel=true&lt;/tt&gt; is probably wrong, because each endpoint can have slightly different configuration&lt;/li&gt;
	&lt;li&gt;Something different?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17286494" author="krzysztofjamroz" created="Thu, 18 Feb 2021 14:18:47 +0000"  >&lt;p&gt;Netty Channel has attributes which I used to store appropriate correlation manager. PR: &lt;a href=&quot;https://github.com/apache/camel/pull/5101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/5101&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17286566" author="davsclaus" created="Thu, 18 Feb 2021 16:08:31 +0000"  >&lt;p&gt;Thanks for working and fixing this&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13357964">CAMEL-16178</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13020558" name="NettyReuseChannelCallbackTest.java" size="6600" author="krzysztofjamroz" created="Wed, 17 Feb 2021 10:55:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nqzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>