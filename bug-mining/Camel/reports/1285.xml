<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:41:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-2305] Polling consumer does not work well with transacted ActiveMQ 5.3.0</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2305</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A bean in a activemq route is consuming messages from another activemq queue.  Instead of reading all queued messages, it always gets just the first message in the queue.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((exchange = consumer.receive(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue&quot;&lt;/span&gt;, 2000l)) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;This did not happen with ActiveMQ 5.2.0&lt;/li&gt;
	&lt;li&gt;This does not happen if Spring transaction support is not set for activemq component.&lt;/li&gt;
	&lt;li&gt;This does not happen if consumer bean is invoked from direct: route.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12486906">CAMEL-2305</key>
            <summary>Polling consumer does not work well with transacted ActiveMQ 5.3.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="dragisak">Dragisa Krsmanovic</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Dec 2009 18:58:45 +0000</created>
                <updated>Sat, 9 Jul 2011 10:10:58 +0000</updated>
                            <resolved>Sat, 9 Jul 2011 10:10:58 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.1.0</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                    <component>camel-jms</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12954250" author="dragisak" created="Fri, 18 Dec 2009 18:59:56 +0000"  >&lt;p&gt;Added unit test that demonstrates the problem. &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12462902/12462902_JmsPollingConsumerTest.patch&quot; title=&quot;JmsPollingConsumerTest.patch attached to CAMEL-2305&quot;&gt;JmsPollingConsumerTest.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12954251" author="davsclaus" created="Sun, 20 Dec 2009 12:28:38 +0000"  >&lt;p&gt;Are you saying that it works completely with AMQ 5.2 (all 3 bullets)?&lt;/p&gt;

&lt;p&gt;Can you test with AMQ trunk?&lt;/p&gt;</comment>
                            <comment id="12954265" author="tranchida" created="Mon, 21 Dec 2009 01:22:32 +0000"  >&lt;p&gt;I see same problem with jms ou xa transaction.&lt;/p&gt;

&lt;p&gt;Setting the prefetch to 0 seems to solve the problem.&lt;/p&gt;

&lt;p&gt;Everything work fine on 5.2.0 with any prefetch size.&lt;/p&gt;</comment>
                            <comment id="12954032" author="dragisak" created="Mon, 21 Dec 2009 16:52:44 +0000"  >&lt;p&gt;Claus,&lt;br/&gt;
Yes, it works completely with AMQ 5.2.0.&lt;/p&gt;

&lt;p&gt;In other words, work around would be to do any of these:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Use AMQ 5.2.0&lt;/li&gt;
	&lt;li&gt;Not use JMS transactions&lt;/li&gt;
	&lt;li&gt;Not use activemq queue to invoke the bean&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12954097" author="dragisak" created="Mon, 21 Dec 2009 17:42:24 +0000"  >&lt;p&gt;I am seeing the same bug with latest AMQ 5.4-SNAPSHOT (892896).&lt;/p&gt;</comment>
                            <comment id="12953425" author="davsclaus" created="Tue, 22 Dec 2009 10:44:20 +0000"  >&lt;p&gt;Dragisa do you mind trying with FUSE 5.2.x versions to see if it stops in one of those releases. This will help the AMQ engineers to narrow down the versions where it stopped working.&lt;/p&gt;

&lt;p&gt;The releases are in this maven repo&lt;br/&gt;
&lt;a href=&quot;http://repo.fusesource.com/maven2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo.fusesource.com/maven2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At&lt;br/&gt;
&lt;a href=&quot;http://repo.fusesource.com/maven2/org/apache/activemq/activemq-core/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo.fusesource.com/maven2/org/apache/activemq/activemq-core/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12953424" author="davsclaus" created="Tue, 22 Dec 2009 10:45:25 +0000"  >&lt;p&gt;The same goes for the FUSE 5.3 releases as they was released before the Apache ActiveMQ 5.3.0 was released. So it may work in some of the earlier FUSE 5.3.0.x releases.&lt;/p&gt;</comment>
                            <comment id="12953559" author="dragisak" created="Tue, 22 Dec 2009 18:08:26 +0000"  >&lt;p&gt;Works with activemq-camel 5.2.0.0-fuse but fails for 5.2.0.1-fuse and all later versions.&lt;/p&gt;</comment>
                            <comment id="12954045" author="dragisak" created="Mon, 28 Dec 2009 23:15:42 +0000"  >&lt;p&gt;Confirmed that  setting prefetch to 0 solves problem.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;prefetchPolicy&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.activemq.ActiveMQPrefetchPolicy&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;all&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;jmsFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;brokerURL&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;vm://localhost?broker.persistent=false&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;prefetchPolicy&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;prefetchPolicy&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See &lt;a href=&quot;http://activemq.apache.org/what-is-the-prefetch-limit-for.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/what-is-the-prefetch-limit-for.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12954150" author="dragisak" created="Tue, 29 Dec 2009 19:34:53 +0000"  >&lt;p&gt;Setting prefetch to 0 is not ideal because it can impact performance.  Allowing to set consumer prefetch size as an option in AMQ component url would, at least, allow us to still use prefetch in other routes that do not use polling consumer.&lt;/p&gt;</comment>
                            <comment id="12954130" author="tranchida" created="Wed, 30 Dec 2009 00:36:18 +0000"  >&lt;p&gt;I use this workaround that solve my problem using a pooledConnectionFactoryBean with one pool size&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.activemq.pool.PooledConnectionFactoryBean&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionFactory&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;brokerURL&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;vm:&lt;span class=&quot;code-comment&quot;&gt;//localhost?broker.persistent=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;             &amp;lt;/bean&amp;gt;            
        &amp;lt;/property&amp;gt;
    &amp;lt;/bean&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12954338" author="davsclaus" created="Fri, 8 Jan 2010 06:03:44 +0000"  >&lt;p&gt;Dragisa&lt;/p&gt;

&lt;p&gt;Maybe you can check the release notes for FUSE 5.2.0.0 and 5.2.0.1 and check if there is some JIRA tickets that &lt;em&gt;smells&lt;/em&gt; like the cause of the problem&lt;br/&gt;
&lt;a href=&quot;http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.2+Release+Notes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.2+Release+Notes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then we can help pin point the cause.&lt;/p&gt;

&lt;p&gt;The AMQ people is very busy so its best we can do most of the leg work ahead.&lt;/p&gt;</comment>
                            <comment id="12954354" author="dragisak" created="Fri, 8 Jan 2010 21:44:46 +0000"  >&lt;p&gt;This one seems fishy since it made changes to QueueStorePrefetch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/activemq/browse/AMQ-2020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://issues.apache.org/activemq/browse/AMQ-2020&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://fusesource.com/issues/browse/MB-417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fusesource.com/issues/browse/MB-417&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12954367" author="davsclaus" created="Mon, 11 Jan 2010 08:39:04 +0000"  >&lt;p&gt;Dragisa is it possible to create a pure JMS based example which we can present as unit test for the AMQ team?&lt;/p&gt;

&lt;p&gt;Then its easier and faster for them to get started looking into this.&lt;/p&gt;</comment>
                            <comment id="12954388" author="dragisak" created="Tue, 12 Jan 2010 19:50:31 +0000"  >&lt;p&gt;Created AMQ issue &lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-2565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AMQ-2565&lt;/a&gt;  with appropriate unit test.&lt;/p&gt;</comment>
                            <comment id="12973527" author="davsclaus" created="Tue, 21 Dec 2010 09:30:18 +0000"  >&lt;p&gt;Added the unit test to camel itest: 1051428.&lt;/p&gt;</comment>
                            <comment id="13062258" author="dragisak" created="Fri, 8 Jul 2011 23:56:13 +0000"  >&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2565&quot; title=&quot;Consumer skips messages in a queue when invoked from another queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2565&quot;&gt;&lt;del&gt;AMQ-2565&lt;/del&gt;&lt;/a&gt; is not going to be fixed.&lt;/p&gt;

&lt;p&gt;See comment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2565?focusedCommentId=13062233&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13062233&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2565?focusedCommentId=13062233&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13062233&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13062354" author="davsclaus" created="Sat, 9 Jul 2011 10:10:58 +0000"  >&lt;p&gt;The AMQ team indicate the issue was an invalid usage of transactions. Marking this ticket as resolved as this ticket was just a placeholder for the AMQ ticket as there is nothing we can do in the Camel codebase.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462902" name="JmsPollingConsumerTest.patch" size="7273" author="dragisak" created="Fri, 18 Dec 2009 18:59:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01nrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>