<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:43:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15547] Wrong URI with http dsl and query parameters</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15547</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When declaring an http endpoint for an URL with a query string using endpoint dsl the target URL is incorrect due to appended value to the last parameter.&lt;/p&gt;


&lt;p&gt; Consider the following route snippet:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
.to(http(&quot;myhost/mypath?param1=a&amp;amp;param2=b&quot;).httpMethod(&quot;GET&quot;))
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The endpoint URI computed by &lt;b&gt;AbstractEndpointBuilder&lt;/b&gt; is: &lt;tt&gt;myhost/mypath?param1=a&amp;amp;param2=b?httpMethod=GET (spot the double question mark)&#160;}}and this leads to a wrong http request to {{&lt;a href=&quot;http://myhost/mypath?param1=a&amp;amp;param2=b%3FhttpMethod%3DGET&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://myhost/mypath?param1=a&amp;amp;param2=b%3FhttpMethod%3DGET&lt;/a&gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If the query string is removed from the URI and provided as &lt;b&gt;Exchange.HTTP_QUERY&lt;/b&gt; header the final HTTP URL is correct.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The same route without endpoint dsl works fine&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&#8230;
to(&quot;http://myhost/mypath?param1=a&amp;amp;param2=b&amp;amp;httpMethod=GET&quot;)
&#8230;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The problem may be in the following code in &lt;b&gt;AbstractEndpointBuilder.computeUri&lt;/b&gt;, where a query string computed with endpoint parameters&lt;br/&gt;
 is added to the target path without checking for the presence of a question mark.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; query = URISupport.createQueryString(params, encode);
answer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NormalizedUri(targetScheme + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt; + targetPath + &lt;span class=&quot;code-quote&quot;&gt;&quot;?&quot;&lt;/span&gt; + query);
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t know if this is the desired behavior and potential query string part of URIs should be provided in other ways (eg as header) or if it is a bug.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is a test to replicate the problem&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RoutesBuilder createRouteBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EndpointRouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

                restConfiguration().port(9999);
                &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;path/xyz&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;log:myLogger?level=INFO&amp;amp;showAll=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
                from(direct(&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;))
                    .to(http(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:9999/path/xyz?param1=1&amp;amp;param1=2&quot;&lt;/span&gt;).httpMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;GET&quot;&lt;/span&gt;));
                from(direct(&lt;span class=&quot;code-quote&quot;&gt;&quot;test2&quot;&lt;/span&gt;))
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9999/path/xyz?param1=1&amp;amp;param2=2&amp;amp;httpMethod=GET&quot;&lt;/span&gt;);
&lt;/span&gt;            }
        };
    }

    &lt;span class=&quot;code-comment&quot;&gt;// Test passes
&lt;/span&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRoute() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
        MockEndpoint mockEndpoint = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);

        mockEndpoint.expectedHeaderReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;param1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);
        mockEndpoint.expectedHeaderReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;param2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);

        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:test2&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        mockEndpoint.assertIsSatisfied();
    }

    &lt;span class=&quot;code-comment&quot;&gt;// Test fails with
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// java.lang.AssertionError: mock://result Header with name param1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; message: 0. Expected: &amp;lt;1&amp;gt; but was: &amp;lt;[1, 2%3FhttpMethod%3DGET]&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Expected :&amp;lt;1&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Actual   :&amp;lt;[1, 2%3FhttpMethod%3DGET]&amp;gt;    
&lt;/span&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEndpointDslRoute() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
        MockEndpoint mockEndpoint = getMockEndpoint(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
        mockEndpoint.expectedHeaderReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;param1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);
        mockEndpoint.expectedHeaderReceived(&lt;span class=&quot;code-quote&quot;&gt;&quot;param2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);

        template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:test&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        mockEndpoint.assertIsSatisfied();
    }


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13328114">CAMEL-15547</key>
            <summary>Wrong URI with http dsl and query parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mcollovati">Marco Collovati</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Sep 2020 18:48:26 +0000</created>
                <updated>Sat, 19 Sep 2020 06:56:08 +0000</updated>
                            <resolved>Sat, 19 Sep 2020 06:56:08 +0000</resolved>
                                    <version>3.4.3</version>
                    <version>3.5.0</version>
                                    <fixVersion>3.4.4</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>camel-endpointdsl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17197904" author="chardahe@redhat.com" created="Thu, 17 Sep 2020 18:51:37 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mcollovati&quot; class=&quot;user-hover&quot; rel=&quot;mcollovati&quot;&gt;mcollovati&lt;/a&gt;&#160;for reporting it, I&apos;ll work on this&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ip2o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>