<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:29:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12418] camel-consul - High CPU load on events watching</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12418</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Camel-Consul library expects EventClient to block requests and &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.21.0/components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java#L59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;passes number of seconds to block request to EventClient&lt;/a&gt;.&lt;br/&gt;
 However Event HTTP Endpoint &lt;a href=&quot;https://www.consul.io/api/event.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;does not support Blocking Queries&lt;/a&gt; and EventClient &lt;a href=&quot;https://github.com/rickfast/consul-client/blob/1.1.1/src/main/java/com/orbitz/consul/EventClient.java#L164&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ignores passed queryOptions&lt;/a&gt;.&lt;br/&gt;
 This results in high CPU usage because ConsulEventConsumer constantly makes requests to Consul without any delay or blocking.&lt;br/&gt;
 Maybe some &lt;em&gt;Thread.sleep&lt;/em&gt; could be added to &lt;em&gt;EventWatcher.watch(EventClient client)&lt;/em&gt; before &lt;em&gt;client.listEvents&lt;/em&gt; call or any other fix to introduce delay between &lt;em&gt;listEvents&lt;/em&gt; requests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13149955">CAMEL-12418</key>
            <summary>camel-consul - High CPU load on events watching</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Viachaslau.Tsikhanovich">Viachaslau Tsikhanovich</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Apr 2018 10:48:26 +0000</created>
                <updated>Wed, 18 Apr 2018 07:39:54 +0000</updated>
                            <resolved>Wed, 18 Apr 2018 07:39:54 +0000</resolved>
                                    <version>2.21.0</version>
                                    <fixVersion>2.21.1</fixVersion>
                    <fixVersion>2.22.0</fixVersion>
                                    <component>camel-consul</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16429275" author="davsclaus" created="Sat, 7 Apr 2018 07:40:32 +0000"  >&lt;p&gt;Yeah that sounds like a good idea. Contributions is welcome to add an option to configure the sleep delay, and have a resonable default of maybe 500 millis or something.&lt;/p&gt;</comment>
                            <comment id="16429903" author="githubbot" created="Sun, 8 Apr 2018 22:44:32 +0000"  >&lt;p&gt;Gr1f0n6x opened a new pull request #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I believe that scheduledExecutorService with schedule method will be a little better then Thread.sleep(mills) (maybe i&apos;m wrong).&lt;/p&gt;

&lt;p&gt;   Also, i didn&apos;t add default value as proposed in description of this problem beecause as i found in `ConsulClientConfiguration` the default value of  `blockSeconds` is 10:&lt;br/&gt;
   ```&lt;br/&gt;
   @UriParams&lt;br/&gt;
   public class ConsulClientConfiguration implements Cloneable &lt;/p&gt;
{
       . . . 
       @UriParam(label = &quot;consumer,watch&quot;, defaultValue = &quot;10&quot;)
       private Integer blockSeconds = 10;
       . . . 
   }
&lt;p&gt;   ```&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Check style&lt;br/&gt;
   Result of `mvn clean install -Psourcecheck`:&lt;br/&gt;
   ```&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Scanning for projects...&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;                                                                         &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Building Camel :: Consul 2.22.0-SNAPSHOT&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-clean-plugin:3.0.0:clean (default-clean) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Deleting D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-enforcer-plugin:1.4.1:enforce (enforce-maven) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-bundle-plugin:3.5.0:cleanVersions (versions) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-checkstyle-plugin:3.0.0:checkstyle (default-cli) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Starting audit...&lt;br/&gt;
   Audit done.&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-remote-resources-plugin:1.5:process (process-resource-bundles) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-components (prepare) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Generated D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\components\META-INF\services\org\apache\camel\component.properties containing 1 Camel component: consul&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-resources-plugin:3.0.2:resources (default-resources) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Using &apos;UTF-8&apos; encoding to copy filtered resources.&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 4 resources&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 3 resources&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 1 resource&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; skip non existing resourceDirectory D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\dataformats&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; skip non existing resourceDirectory D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\languages&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-compiler-plugin:3.7.0:compile (default-compile) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Changes detected - recompiling the module!&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Compiling 37 source files to D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\classes&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-resources-plugin:3.0.2:testResources (default-testResources) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Using &apos;UTF-8&apos; encoding to copy filtered resources.&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 4 resources&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 3 resources&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-compiler-plugin:3.7.0:testCompile (default-testCompile) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Changes detected - recompiling the module!&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Compiling 23 source files to D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\test-classes&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-surefire-plugin:2.20.1:test (default-test) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Tests are skipped.&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-bundle-plugin:3.5.0:manifest (bundle-manifest) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; Manifest org.apache.camel:camel-consul:jar:2.22.0-SNAPSHOT : Unused Import-Package instructions: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.ws.*, org.springframework.xml.*, org.springframework.*, org.apache.cxf.*, org.apache.qpid.*, org.apache.abdera.*, org.apache.commons.httpclient.*, org.apache.velocity.*, org.apache.xmlbeans.*, org.eclipse.jetty.*, com.thoughtworks.xstream.*, org.antlr.stringtemplate.*, org.ccil.cowan.tagsoup.*, org.mortbay.cometd.*, net.sf.flatpack.*, net.sf.saxon.*, freemarker.*, javax.persistence.*, org.apache.lucene.*, org.apache.solr.*&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:validate-components (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Validation complete&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-spring-boot-starter (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Spring-Boot-Starter: starter dir for the component is: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Reusing the existing pom.xml for the starter&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-spring-boot-auto-configuration (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Updated existing file: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter\src\main\java\org\apache\camel\component\consul\springboot\ConsulComponentConfiguration.java&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Updated existing file: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter\src\main\java\org\apache\camel\component\consul\springboot\ConsulComponentAutoConfiguration.java&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-jar-plugin:3.0.2:jar (default-jar) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Building jar: D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\camel-consul-2.22.0-SNAPSHOT.jar&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-site-plugin:3.5.1:attach-descriptor (attach-descriptor) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:update-readme (readme) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-install-plugin:2.5.2:install (default-install) @ camel-consul &amp;#8212;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Installing D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\camel-consul-2.22.0-SNAPSHOT.jar to C:\Users\GrIfOn\.m2\repository\org\apache\camel\camel-consul\2.22.0-SNAPSHOT\camel-consul-2.22.0-SNAPSHOT.jar&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Installing D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\pom.xml to C:\Users\GrIfOn\.m2\repository\org\apache\camel\camel-consul\2.22.0-SNAPSHOT\camel-consul-2.22.0-SNAPSHOT.pom&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESS&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 16.378 s&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: 2018-04-09T01:29:11+03:00&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 53M/553M&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
   ```&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16429904" author="githubbot" created="Sun, 8 Apr 2018 22:44:34 +0000"  >&lt;p&gt;GitHub user Gr1f0n6x opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;/p&gt;

&lt;p&gt;    I believe that scheduledExecutorService with schedule method will be a little better then Thread.sleep(mills) (maybe i&apos;m wrong).&lt;/p&gt;

&lt;p&gt;    Also, i didn&apos;t add default value as proposed in description of this problem beecause as i found in `ConsulClientConfiguration` the default value of  `blockSeconds` is 10:&lt;br/&gt;
    ```&lt;br/&gt;
    @UriParams&lt;br/&gt;
    public class ConsulClientConfiguration implements Cloneable &lt;/p&gt;
{
        . . . 
        @UriParam(label = &quot;consumer,watch&quot;, defaultValue = &quot;10&quot;)
        private Integer blockSeconds = 10;
        . . . 
    }
&lt;p&gt;    ```&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Check style&lt;br/&gt;
    Result of `mvn clean install -Psourcecheck`:&lt;br/&gt;
    ```&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Scanning for projects...&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;                                                                         &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Building Camel :: Consul 2.22.0-SNAPSHOT&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-clean-plugin:3.0.0:clean (default-clean) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Deleting D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-enforcer-plugin:1.4.1:enforce (enforce-maven) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-bundle-plugin:3.5.0:cleanVersions (versions) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-checkstyle-plugin:3.0.0:checkstyle (default-cli) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Starting audit...&lt;br/&gt;
    Audit done.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-remote-resources-plugin:1.5:process (process-resource-bundles) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-components (prepare) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Generated D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\components\META-INF\services\org\apache\camel\component.properties containing 1 Camel component: consul&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-resources-plugin:3.0.2:resources (default-resources) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Using &apos;UTF-8&apos; encoding to copy filtered resources.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 4 resources&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 3 resources&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 1 resource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; skip non existing resourceDirectory D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\dataformats&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; skip non existing resourceDirectory D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\generated\camel\languages&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-compiler-plugin:3.7.0:compile (default-compile) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Changes detected - recompiling the module!&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Compiling 37 source files to D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-resources-plugin:3.0.2:testResources (default-testResources) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Using &apos;UTF-8&apos; encoding to copy filtered resources.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 4 resources&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Copying 3 resources&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-compiler-plugin:3.7.0:testCompile (default-testCompile) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Changes detected - recompiling the module!&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Compiling 23 source files to D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\test-classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-surefire-plugin:2.20.1:test (default-test) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Tests are skipped.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-bundle-plugin:3.5.0:manifest (bundle-manifest) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; Manifest org.apache.camel:camel-consul:jar:2.22.0-SNAPSHOT : Unused Import-Package instructions: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.ws.*, org.springframework.xml.*, org.springframework.*, org.apache.cxf.*, org.apache.qpid.*, org.apache.abdera.*, org.apache.commons.httpclient.*, org.apache.velocity.*, org.apache.xmlbeans.*, org.eclipse.jetty.*, com.thoughtworks.xstream.*, org.antlr.stringtemplate.*, org.ccil.cowan.tagsoup.*, org.mortbay.cometd.*, net.sf.flatpack.*, net.sf.saxon.*, freemarker.*, javax.persistence.*, org.apache.lucene.*, org.apache.solr.*&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:validate-components (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Validation complete&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-spring-boot-starter (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Spring-Boot-Starter: starter dir for the component is: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Reusing the existing pom.xml for the starter&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:prepare-spring-boot-auto-configuration (validate) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Updated existing file: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter\src\main\java\org\apache\camel\component\consul\springboot\ConsulComponentConfiguration.java&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Updated existing file: D:\Program Files\WORK\WORK_Java\camel\platforms\spring-boot\components-starter\camel-consul-starter\src\main\java\org\apache\camel\component\consul\springboot\ConsulComponentAutoConfiguration.java&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-jar-plugin:3.0.2:jar (default-jar) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Building jar: D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\camel-consul-2.22.0-SNAPSHOT.jar&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-site-plugin:3.5.1:attach-descriptor (attach-descriptor) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; camel-package-maven-plugin:2.22.0-SNAPSHOT:update-readme (readme) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-install-plugin:2.5.2:install (default-install) @ camel-consul &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Installing D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\target\camel-consul-2.22.0-SNAPSHOT.jar to C:\Users\GrIfOn\.m2\repository\org\apache\camel\camel-consul\2.22.0-SNAPSHOT\camel-consul-2.22.0-SNAPSHOT.jar&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Installing D:\Program Files\WORK\WORK_Java\camel\components\camel-consul\pom.xml to C:\Users\GrIfOn\.m2\repository\org\apache\camel\camel-consul\2.22.0-SNAPSHOT\camel-consul-2.22.0-SNAPSHOT.pom&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESS&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 16.378 s&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: 2018-04-09T01:29:11+03:00&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 53M/553M&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
    ```&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/Gr1f0n6x/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Gr1f0n6x/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2283.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2283&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5ea5cbda3a52948669e7a2fe00eacb577dd674ba&lt;br/&gt;
Author: Nick &amp;lt;grifon52@...&amp;gt;&lt;br/&gt;
Date:   2018-04-08T22:30:46Z&lt;/p&gt;

&lt;p&gt;    Add delay between listEvents requests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16430168" author="githubbot" created="Mon, 9 Apr 2018 07:13:22 +0000"  >&lt;p&gt;davsclaus commented on issue #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#issuecomment-379656748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#issuecomment-379656748&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   We should have code that shutdown that executor service - also the executor service should be created via Camel&apos;s API for that, see `ExecutorServiceManager` you can get via `CamelContext`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16430170" author="githubbot" created="Mon, 9 Apr 2018 07:14:04 +0000"  >&lt;p&gt;davsclaus commented on issue #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#issuecomment-379656748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#issuecomment-379656748&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   We should have code that shutdown that executor service - also the executor service should be created via Camel&apos;s API for that, see `ExecutorServiceManager` you can get via `CamelContext`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16430206" author="lb" created="Mon, 9 Apr 2018 07:39:59 +0000"  >&lt;p&gt;maybe the issue should also be reported against the underlying consul library so this may get fixed on their side&lt;/p&gt;</comment>
                            <comment id="16432627" author="githubbot" created="Tue, 10 Apr 2018 17:30:23 +0000"  >&lt;p&gt;Gr1f0n6x commented on issue #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#issuecomment-380183508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#issuecomment-380183508&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Ok, i&apos;ll fix it &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16439272" author="githubbot" created="Mon, 16 Apr 2018 10:42:44 +0000"  >&lt;p&gt;davsclaus commented on issue #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#issuecomment-381557484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#issuecomment-381557484&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @Gr1f0n6x let us know how it goes for you&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16440227" author="githubbot" created="Tue, 17 Apr 2018 01:20:20 +0000"  >&lt;p&gt;Gr1f0n6x commented on issue #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#issuecomment-381799061&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#issuecomment-381799061&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @davsclaus, I tried to use `ConsulEndpoint` for getting `CamelContext` as it implemented `CamelContextAware`.&lt;br/&gt;
   Also, i move field `scheduledExecutorService` to the `ConsulEventConsumer` class from the inner class `EventWatcher` because otherwise it will created more than one thread for this background work. &lt;br/&gt;
   I&apos;m not sure about `doStop` but i overrided it and shutdown executor there.&lt;/p&gt;

&lt;p&gt;   Sorry for delay. I had some problems with building the project &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16440603" author="githubbot" created="Tue, 17 Apr 2018 08:38:41 +0000"  >&lt;p&gt;dmvolod commented on a change in pull request #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#discussion_r181994251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#discussion_r181994251&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -33,32 +36,46 @@&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulEndpoint;&lt;/p&gt;

&lt;p&gt; public final class ConsulEventConsumer extends AbstractConsulConsumer&amp;lt;EventClient&amp;gt; {&lt;br/&gt;
+    private ScheduledExecutorService scheduledExecutorService;&lt;/p&gt;

&lt;p&gt;     public ConsulEventConsumer(ConsulEndpoint endpoint, ConsulConfiguration configuration, Processor processor) &lt;/p&gt;
{
         super(endpoint, configuration, processor, Consul::eventClient);
+        this.scheduledExecutorService = endpoint.getCamelContext().getExecutorServiceManager().newSingleThreadScheduledExecutor(this, &quot;ConsulEventConsumer&quot;);
     }

&lt;p&gt;     @Override&lt;br/&gt;
     protected Runnable createWatcher(EventClient client) throws Exception &lt;/p&gt;
{
         return new EventWatcher(client);
     }

&lt;p&gt;+    @Override&lt;br/&gt;
+    protected void doStop() throws Exception {&lt;br/&gt;
+        scheduledExecutorService.shutdown();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @Gr1f0n6x , please use ExecutorServiceManager.shutdownGraceful there&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16440851" author="githubbot" created="Tue, 17 Apr 2018 13:26:56 +0000"  >&lt;p&gt;Gr1f0n6x commented on a change in pull request #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#discussion_r182071274&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#discussion_r182071274&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -33,32 +36,46 @@&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulEndpoint;&lt;/p&gt;

&lt;p&gt; public final class ConsulEventConsumer extends AbstractConsulConsumer&amp;lt;EventClient&amp;gt; {&lt;br/&gt;
+    private ScheduledExecutorService scheduledExecutorService;&lt;/p&gt;

&lt;p&gt;     public ConsulEventConsumer(ConsulEndpoint endpoint, ConsulConfiguration configuration, Processor processor) &lt;/p&gt;
{
         super(endpoint, configuration, processor, Consul::eventClient);
+        this.scheduledExecutorService = endpoint.getCamelContext().getExecutorServiceManager().newSingleThreadScheduledExecutor(this, &quot;ConsulEventConsumer&quot;);
     }

&lt;p&gt;     @Override&lt;br/&gt;
     protected Runnable createWatcher(EventClient client) throws Exception &lt;/p&gt;
{
         return new EventWatcher(client);
     }

&lt;p&gt;+    @Override&lt;br/&gt;
+    protected void doStop() throws Exception {&lt;br/&gt;
+        scheduledExecutorService.shutdown();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @dmvolod, did it. Thank you for hint, didn&apos;t notice this method before&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16442052" author="githubbot" created="Wed, 18 Apr 2018 07:34:13 +0000"  >&lt;p&gt;davsclaus commented on a change in pull request #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283#discussion_r182332929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283#discussion_r182332929&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -28,37 +30,54 @@&lt;br/&gt;
 import org.apache.camel.Exchange;&lt;br/&gt;
 import org.apache.camel.Message;&lt;br/&gt;
 import org.apache.camel.Processor;&lt;br/&gt;
+import org.apache.camel.spi.ExecutorServiceManager;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulConfiguration;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulConstants;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulEndpoint;&lt;/p&gt;

&lt;p&gt; public final class ConsulEventConsumer extends AbstractConsulConsumer&amp;lt;EventClient&amp;gt; {&lt;br/&gt;
+    private ExecutorServiceManager executorServiceManager;&lt;br/&gt;
+    private ScheduledExecutorService scheduledExecutorService;&lt;/p&gt;

&lt;p&gt;     public ConsulEventConsumer(ConsulEndpoint endpoint, ConsulConfiguration configuration, Processor processor) {&lt;br/&gt;
         super(endpoint, configuration, processor, Consul::eventClient);&lt;br/&gt;
+        this.executorServiceManager = endpoint.getCamelContext().getExecutorServiceManager();&lt;br/&gt;
+        this.scheduledExecutorService = this.executorServiceManager.newSingleThreadScheduledExecutor(this, &quot;ConsulEventConsumer&quot;);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   We create these in the doStart method, so we have start/stop logic together, and the constructors are light-weight&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16442054" author="githubbot" created="Wed, 18 Apr 2018 07:35:07 +0000"  >&lt;p&gt;davsclaus closed pull request #2283: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12418&quot; title=&quot;camel-consul - High CPU load on events watching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12418&quot;&gt;&lt;del&gt;CAMEL-12418&lt;/del&gt;&lt;/a&gt;: High CPU load on events watching&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java b/components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
index 2e8a141e0bb..7133fec5df3 100644&lt;br/&gt;
&amp;#8212; a/components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
+++ b/components/camel-consul/src/main/java/org/apache/camel/component/consul/endpoint/ConsulEventConsumer.java&lt;br/&gt;
@@ -18,6 +18,8 @@&lt;/p&gt;

&lt;p&gt; import java.math.BigInteger;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
+import java.util.concurrent.ScheduledExecutorService;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;/p&gt;

&lt;p&gt; import com.orbitz.consul.Consul;&lt;br/&gt;
 import com.orbitz.consul.EventClient;&lt;br/&gt;
@@ -28,14 +30,19 @@&lt;br/&gt;
 import org.apache.camel.Exchange;&lt;br/&gt;
 import org.apache.camel.Message;&lt;br/&gt;
 import org.apache.camel.Processor;&lt;br/&gt;
+import org.apache.camel.spi.ExecutorServiceManager;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulConfiguration;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulConstants;&lt;br/&gt;
 import org.apache.camel.component.consul.ConsulEndpoint;&lt;/p&gt;

&lt;p&gt; public final class ConsulEventConsumer extends AbstractConsulConsumer&amp;lt;EventClient&amp;gt; {&lt;br/&gt;
+    private ExecutorServiceManager executorServiceManager;&lt;br/&gt;
+    private ScheduledExecutorService scheduledExecutorService;&lt;/p&gt;

&lt;p&gt;     public ConsulEventConsumer(ConsulEndpoint endpoint, ConsulConfiguration configuration, Processor processor) &lt;/p&gt;
{
         super(endpoint, configuration, processor, Consul::eventClient);
+        this.executorServiceManager = endpoint.getCamelContext().getExecutorServiceManager();
+        this.scheduledExecutorService = this.executorServiceManager.newSingleThreadScheduledExecutor(this, &quot;ConsulEventConsumer&quot;);
     }

&lt;p&gt;     @Override&lt;br/&gt;
@@ -43,22 +50,34 @@ protected Runnable createWatcher(EventClient client) throws Exception &lt;/p&gt;
{
         return new EventWatcher(client);
     }

&lt;p&gt;+    @Override&lt;br/&gt;
+    protected void doStop() throws Exception &lt;/p&gt;
{
+        executorServiceManager.shutdownGraceful(scheduledExecutorService);
+        super.doStop();
+    }
&lt;p&gt;+&lt;br/&gt;
     // *************************************************************************&lt;br/&gt;
     // Watch&lt;br/&gt;
     // *************************************************************************&lt;/p&gt;

&lt;p&gt;     private class EventWatcher extends AbstractWatcher implements EventResponseCallback {&lt;br/&gt;
+&lt;br/&gt;
         EventWatcher(EventClient client) &lt;/p&gt;
{
             super(client);
         }

&lt;p&gt;         @Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void watch(EventClient client) {&lt;/li&gt;
	&lt;li&gt;client.listEvents(&lt;/li&gt;
	&lt;li&gt;key,&lt;/li&gt;
	&lt;li&gt;QueryOptions.blockSeconds(configuration.getBlockSeconds(), index.get()).build(),&lt;/li&gt;
	&lt;li&gt;this&lt;/li&gt;
	&lt;li&gt;);&lt;br/&gt;
+        public void watch(final EventClient client) {&lt;br/&gt;
+            scheduledExecutorService.schedule(new Runnable() 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                @Override+                public void run() {
+                    client.listEvents(
+                        key,
+                        QueryOptions.blockSeconds(configuration.getBlockSeconds(), index.get()).build(),
+                        EventWatcher.this
+                    );
+                }+            }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;, configuration.getBlockSeconds(), TimeUnit.SECONDS);&lt;br/&gt;
         }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         @Override&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16442055" author="githubbot" created="Wed, 18 Apr 2018 07:35:08 +0000"  >&lt;p&gt;Github user davsclaus closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2283&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16442060" author="davsclaus" created="Wed, 18 Apr 2018 07:39:54 +0000"  >&lt;p&gt;Thanks for reporting and the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s4lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>