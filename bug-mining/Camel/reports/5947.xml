<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:50:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17131] camel-kafka - JMX MBean InstanceAlreadyExistsException thrown</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17131</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using camel-kafka receiving messages, InstanceAlreadyExistsException is thrown in registerAppInfo().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[thread #0 - KafkaConsumer[abc]] AppInfoParser                  WARN  Error registering AppInfo mbean
javax.management.InstanceAlreadyExistsException: kafka.consumer:type=app-info,id=789
        at java.management/com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:436)
        at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerWithRepository(DefaultMBeanServerInterceptor.java:1855)
        at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:955)
        at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:890)
        at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:320)
        at java.management/com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:522)
        at org.apache.kafka.common.utils.AppInfoParser.registerAppInfo(AppInfoParser.java:64)
        at org.apache.kafka.clients.consumer.KafkaConsumer.&amp;lt;init&amp;gt;(KafkaConsumer.java:814)
        at org.apache.kafka.clients.consumer.KafkaConsumer.&amp;lt;init&amp;gt;(KafkaConsumer.java:665)
        at org.apache.kafka.clients.consumer.KafkaConsumer.&amp;lt;init&amp;gt;(KafkaConsumer.java:646)
        at org.apache.kafka.clients.consumer.KafkaConsumer.&amp;lt;init&amp;gt;(KafkaConsumer.java:626)
        at org.apache.camel.component.kafka.DefaultKafkaClientFactory.getConsumer(DefaultKafkaClientFactory.java:34)
        at org.apache.camel.component.kafka.KafkaConsumer$KafkaFetchRecords.doInit(KafkaConsumer.java:267)
        at org.apache.camel.component.kafka.KafkaConsumer$KafkaFetchRecords.run(KafkaConsumer.java:215)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attached project test-kafka.zip for quickly reproduce this issue.&lt;/p&gt;

&lt;p&gt;Note that there was no this kind of issue on Camel-kafka 2.24.x.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 11.&lt;/p&gt;</environment>
        <key id="13408403">CAMEL-17131</key>
            <summary>camel-kafka - JMX MBean InstanceAlreadyExistsException thrown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="xldai">Xilai Dai</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Oct 2021 10:01:47 +0000</created>
                <updated>Tue, 16 Nov 2021 09:02:58 +0000</updated>
                            <resolved>Tue, 16 Nov 2021 09:02:58 +0000</resolved>
                                    <version>3.11.1</version>
                                    <fixVersion>3.11.4</fixVersion>
                    <fixVersion>3.14.0</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17434259" author="davsclaus" created="Tue, 26 Oct 2021 10:48:27 +0000"  >&lt;p&gt;This MBean is not a Camel MBean but a Kafka MBean. &lt;/p&gt;</comment>
                            <comment id="17443104" author="davsclaus" created="Sat, 13 Nov 2021 14:23:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt; okay so it looks like the KafkaConsumer is created twice, as part of preInit, and then on 1st run because of retry = true and reconnect = true.&lt;/p&gt;

&lt;p&gt;And because JMX is present and this example uses a hardcoded clientId then we have the JMX ObjectName clash.&lt;/p&gt;</comment>
                            <comment id="17443106" author="davsclaus" created="Sat, 13 Nov 2021 14:32:59 +0000"  >&lt;p&gt;Also on the initial pool due to state of either in retry or reconnect in KafkaFetchRecords then the INFO logging is&lt;/p&gt;

&lt;p&gt;15:25:55.715 &lt;a href=&quot;#1 - KafkaConsumer[abc]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Camel (camel-1) thread #1 - KafkaConsumer[abc]&lt;/a&gt; INFO  o.a.c.c.kafka.KafkaFetchRecords - Retrying abc-Thread 0 to topic abc after 5000 ms&lt;/p&gt;

&lt;p&gt;Since this is the 1st fetch, then saying Retrying is not entirely accurate. Maybe we can have a flag to determine the state is first fetch and then log&lt;/p&gt;

&lt;p&gt;15:25:55.715 &lt;a href=&quot;#1 - KafkaConsumer[abc]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Camel (camel-1) thread #1 - KafkaConsumer[abc]&lt;/a&gt; INFO  o.a.c.c.kafka.KafkaFetchRecords - Consuming abc-Thread 0 from topic abc&lt;/p&gt;

&lt;p&gt;And maybe we can make it DEBUG logging level as this is normal operation. The retry / reconnect logic is fine to have noisy logging at INFO so end users can notice that there has been some network connectivity problems and that Camel is re-establishing.&lt;/p&gt;</comment>
                            <comment id="17443107" author="orpiske" created="Sat, 13 Nov 2021 14:36:50 +0000"  >&lt;p&gt;I am under the impression that this has been happening prior to the refactoring as well. When I started on it I noticed that we were initializing the consumer prior to the starting the thread (1) (2). Then, when we started the thread, during the first execution, we re-initialized it again (3). I think we need to fix this for 3.14. Feel free to assign to me and I will take a look.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L139&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L228-L246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L228-L246&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L191-L218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/camel-3.7.6/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaConsumer.java#L191-L218&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17443108" author="davsclaus" created="Sat, 13 Nov 2021 14:37:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt; a quick PR to start with&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/pull/6438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6438&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Would you take a look, and also work on a better initial logging as mentioned above ^^^^ so that normal operation works nicely and do not log that Camel is retrying or reconnecting on 1st fetch.&lt;/p&gt;
</comment>
                            <comment id="17443109" author="davsclaus" created="Sat, 13 Nov 2021 14:39:33 +0000"  >&lt;p&gt;I attached test-kafka-claus.tar which is updated to run with 3.14.0-SNAPSHOT and also some other adjustments to make it run (and removed OSGi stufff)&lt;/p&gt;</comment>
                            <comment id="17443110" author="davsclaus" created="Sat, 13 Nov 2021 14:41:36 +0000"  >&lt;p&gt;Ah yeah it can be a older problem we have not noticed due to no exception on startup.&lt;br/&gt;
Thanks to JMX we now know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17443118" author="orpiske" created="Sat, 13 Nov 2021 15:01:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; absolutely. I&apos;ll be happy to take a look at that and any other thing we can improve on that one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17444379" author="davsclaus" created="Tue, 16 Nov 2021 09:02:58 +0000"  >&lt;p&gt;Made a simpler fix on 3.11.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13128045">CAMEL-12110</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13036060" name="test-kafka-claus.tar" size="28672" author="davsclaus" created="Sat, 13 Nov 2021 14:38:56 +0000"/>
                            <attachment id="13035348" name="test-kafka.zip" size="4980" author="xldai" created="Tue, 26 Oct 2021 10:01:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w5t4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>