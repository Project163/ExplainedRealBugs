<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:08:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21355] LangChain4j Tools fails with direct LLM response</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21355</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The Tools component is designed to provide functions to the LLM. However the LLM may decide not to invoke any of the given tools.&lt;/p&gt;

&lt;p&gt;In that scenario, the LLM replies directly instead of requesting the execution of a tool/function. The Camel Tools components seems unable to handle such use case and throws an exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13595636">CAMEL-21355</key>
            <summary>LangChain4j Tools fails with direct LLM response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="bruno.meseguer">Bruno Meseguer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Oct 2024 08:24:54 +0000</created>
                <updated>Mon, 4 Nov 2024 12:02:55 +0000</updated>
                            <resolved>Mon, 4 Nov 2024 12:02:55 +0000</resolved>
                                    <version>4.8.0</version>
                                    <fixVersion>4.8.2</fixVersion>
                    <fixVersion>4.9.0</fixVersion>
                                    <component>camel-langchain4j-tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17892390" author="orpiske" created="Thu, 24 Oct 2024 08:36:44 +0000"  >&lt;p&gt;Just for the record, I am not entirely sure this is a problem. The LLM deciding not to call a tool is a valid scenario and throwing an exception lets applications deal with it accordingly (instead of, let&apos;s say, failing silently). &lt;/p&gt;</comment>
                            <comment id="17892397" author="davsclaus" created="Thu, 24 Oct 2024 08:54:18 +0000"  >&lt;p&gt;Hmm could there be an option so you can control whether to throw an exception or ignore).&lt;/p&gt;

&lt;p&gt;IMHO throwing an exception seems unexpected, so maybe the default should be to not throw (ie ignore).&#160;&lt;/p&gt;</comment>
                            <comment id="17892403" author="bruno.meseguer" created="Thu, 24 Oct 2024 09:19:53 +0000"  >&lt;p&gt;This is an unorthodox one.&lt;/p&gt;

&lt;p&gt;Camel initiates a conversation with the LLM, which may or may not decide to call the tools. Not calling the tools is a valid use case, so I wouldn&apos;t treat it as an exception scenario.&lt;/p&gt;

&lt;p&gt;I wonder if we should pair the chat component as producer only and tools as consumer only.&lt;/p&gt;</comment>
                            <comment id="17892428" author="orpiske" created="Thu, 24 Oct 2024 10:41:58 +0000"  >&lt;p&gt;I think adding an option to throw/no-throw is a reasonable compromise and give the users some flexibility. What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bruno.meseguer&quot; class=&quot;user-hover&quot; rel=&quot;bruno.meseguer&quot;&gt;bruno.meseguer&lt;/a&gt; ? &lt;/p&gt;

&lt;p&gt;Maybe we allow them do define some bean or processor to handle this? Maybe just cascade the response? &lt;/p&gt;


&lt;p&gt;At this point, I&apos;d prefer to avoid more complex scenarios involving adding other components as dependencies and try to favor something that can be flexible and simple (not saying, never, though ... just trying to minimize the scope of the fix).   &lt;/p&gt;</comment>
                            <comment id="17892444" author="bruno.meseguer" created="Thu, 24 Oct 2024 11:23:11 +0000"  >&lt;p&gt;I agree... connecting two different components will overcomplicate things.&lt;/p&gt;

&lt;p&gt;To be honest, because no-tool calling is a valid scenario for the LLM I wouldn&apos;t throw an exception. I don&apos;t even see the need to define a parameter switch between throw/ignore the no-tool response (because it&apos;s valid).&lt;/p&gt;

&lt;p&gt;I would simply look at cases where the tool call from the LLM is mal-formed to throw an exception from Camel, or when any other non-expected error occurs when interacting with the LLM.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="17892504" author="davsclaus" created="Thu, 24 Oct 2024 14:13:34 +0000"  >&lt;p&gt;I agree with Bruno&lt;/p&gt;</comment>
                            <comment id="17892510" author="orpiske" created="Thu, 24 Oct 2024 14:35:48 +0000"  >&lt;p&gt;I get your suggestion, but there is something that is not very clear to me. How do you guys propose determining whether the tool call from the LLM is malformed? &lt;/p&gt;</comment>
                            <comment id="17892525" author="bruno.meseguer" created="Thu, 24 Oct 2024 15:13:13 +0000"  >&lt;p&gt;It may not conform to the API spec of LLM tools support for example&lt;/p&gt;</comment>
                            <comment id="17892723" author="orpiske" created="Fri, 25 Oct 2024 09:12:34 +0000"  >&lt;p&gt;I presume you are talking about, let&apos;s say, if the user pass invalid characters to the name of the function? Or is it something different? Can you please, give an example of how we could make that happen with Camel? Considering that we do not get that low level into the client API ... &lt;/p&gt;

&lt;p&gt; Additionally, it&apos;s not just a malformed response that may cause the model to decide not to invoke anything. A model is non-deterministic by design and it may decide not to call a tool even if the request is well-formed. Considering this and letting the user decide what they want to do in the absence of a tool call response is a better compromise IMHO.&lt;/p&gt;

&lt;p&gt;And, please, I am not arguing for the sake of arguing or because of stubbornness, but I do need an specific and concrete scenario. &lt;/p&gt;</comment>
                            <comment id="17892870" author="orpiske" created="Fri, 25 Oct 2024 16:35:42 +0000"  >&lt;p&gt;Bruno and I had a great discussion today and as a result, I modified the code so that it sets a flag on the header (see the linked PR) to indicate to users if a tool has not been called. This satisfies both my intention to let users have a way to handle this scenario, while also providing a clean way to ignore it for users that don&apos;t have that need. The code was merged on 4.9 and I&apos;ll backport to 4.8.x next week (so, please, keep the ticket open).&lt;/p&gt;</comment>
                            <comment id="17895264" author="orpiske" created="Mon, 4 Nov 2024 12:02:55 +0000"  >&lt;p&gt;The fix was merged and backported.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s0u8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>