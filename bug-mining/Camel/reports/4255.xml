<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:25:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11750] Camel route with multicast (parallel) generate huge CPU load</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11750</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I&apos;ve created simple Spring Camel Route application that can be used for issue reproducing. Here we have very simple route:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;)
                .multicast().parallelProcessing()
                .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:very-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;direct:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .end();

        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Started &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .process(exchange -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(5000))
                .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Finished &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .end();
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:very-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;very-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Started very-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .process(exchange -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(35000))
                .log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Finished very-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-task&quot;&lt;/span&gt;)
                .end();
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From our main route &apos;start&apos; we are starting in parallel two sub-routes: &apos;long-task&apos; and &apos;very-long-task&apos;. They are just doing something for some period of time and do not generate any load to the system.&lt;br/&gt;
But I found that when one task finished earlier than other one, route start to make a huge CPU load. Here you can see a CPU usage during executiong of Camel route that was mentioned earlier (after finishing of &apos;long-task&apos; usage of CPU uncreased from 0 to 12.5%):&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://content.screencast.com/users/NazarV/folders/Jing/media/830268f0-d184-4c57-adb1-b782ea63fa6d/2017-09-06_1241.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
Screenshot was made when I was running route on my Windows PC with 4 physical CPU cores + 4 HT. On Unix systems we found that after end of &apos;long-task&apos; it used 100% of one core till the end of work.&lt;br/&gt;
One more interesting thing that i&apos;ve found is that the main load on the system was generated by the thread MulticastProcessor-AggregateTask that was spending a lot of time in the method java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#awaitNanos that was called from java.util.concurrent.DelayQueue#poll(long, java.util.concurrent.TimeUnit):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;Camel (camel-1) thread #2 - MulticastProcessor-AggregateTask&quot;&lt;/span&gt; #29 daemon prio=5 os_prio=0 tid=0x00000000215e3000 nid=0x7a0 runnable [0x0000000022eaf000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.isInterrupted(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:944)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.checkInterruptWhileWaiting(AbstractQueuedSynchronizer.java:2002)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2079)
	at java.util.concurrent.DelayQueue.poll(DelayQueue.java:273)
	at org.apache.camel.util.concurrent.SubmitOrderedCompletionService.poll(SubmitOrderedCompletionService.java:127)
	at org.apache.camel.processor.MulticastProcessor$AggregateOnTheFlyTask.aggregateOnTheFly(MulticastProcessor.java:463)
	at org.apache.camel.processor.MulticastProcessor$AggregateOnTheFlyTask.run(MulticastProcessor.java:418)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In DelayQueue#poll(long, java.util.concurrent.TimeUnit) we have a piece of code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;E first = q.peek();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (first == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
 ...
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; delay = first.getDelay(NANOSECONDS);
    ...
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeLeft =  available.awaitNanos(delay) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;During debugging I found that E first is object of class &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.19.2/camel-core/src/main/java/org/apache/camel/util/concurrent/SubmitOrderedCompletionService.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;org.apache.camel.util.concurrent.SubmitOrderedCompletionService.SubmitOrderFutureTask&lt;/a&gt; and it&apos;s very interesting &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.19.2/camel-core/src/main/java/org/apache/camel/util/concurrent/SubmitOrderedCompletionService.java#L64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getDelay(TimeUnit) method&lt;/a&gt; always return 1. I thing that is a source of current issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getDelay(TimeUnit unit) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the answer is 0 then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; task is ready to be taken
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; id - index.get();
        }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So when delay is 1, AggregateTask thread is not sleeping at all and generates a huge CPU load all the time when it is waiting for the end of the last task.&lt;br/&gt;
I think that &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.19.2/camel-core/src/main/java/org/apache/camel/util/concurrent/SubmitOrderedCompletionService.java#L64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getDelay(TimeUnit) method&lt;/a&gt; should be somehow re-implemented.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13100094">CAMEL-11750</key>
            <summary>Camel route with multicast (parallel) generate huge CPU load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Nazar Vishka">NV</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Sep 2017 10:14:58 +0000</created>
                <updated>Mon, 29 Mar 2021 11:48:03 +0000</updated>
                            <resolved>Mon, 11 Sep 2017 09:54:37 +0000</resolved>
                                    <version>2.18.4</version>
                    <version>2.19.2</version>
                                    <fixVersion>2.18.5</fixVersion>
                    <fixVersion>2.19.3</fixVersion>
                    <fixVersion>2.20.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16156665" author="githubbot" created="Thu, 7 Sep 2017 08:16:22 +0000"  >&lt;p&gt;GitHub user leofromgroza opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1922&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11750&quot; title=&quot;Camel route with multicast (parallel) generate huge CPU load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11750&quot;&gt;&lt;del&gt;CAMEL-11750&lt;/del&gt;&lt;/a&gt;: Camel route with multicast (parallel) generate huge CPU &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;load&lt;/p&gt;

&lt;p&gt;    Fixed issue with huge CPU load: added 1 second delay for a task that is 2nd in the queue order, 2sec for 3rd task, 3sec for 4th taks, etc. That helps to decrease CPU load and does not broke previous logic.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/leofromgroza/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/leofromgroza/camel&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1922.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1922.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1922&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 089b64ae85d76230d647eb646d806400e1df4b21&lt;br/&gt;
Author: leofromgroza &amp;lt;vishka.nazar@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-07T08:15:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11750&quot; title=&quot;Camel route with multicast (parallel) generate huge CPU load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11750&quot;&gt;&lt;del&gt;CAMEL-11750&lt;/del&gt;&lt;/a&gt;: Camel route with multicast (parallel) generate huge CPU load&lt;/p&gt;

&lt;p&gt;    Fixed issue with huge CPU load: added 1 second delay for a task that is 2nd in the queue order, 2sec for 3rd task, 3sec for 4th taks, etc. That helps to decrease CPU load and does not broke previous logic.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16156670" author="nazar vishka" created="Thu, 7 Sep 2017 08:22:19 +0000"  >&lt;p&gt;I propose minor fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getDelay(TimeUnit unit) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; unit.convert(id - index.get(), TimeUnit.MILLISECONDS);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It does not broke other logic but adds 1ms delay for a task that is 2nd in the queue, 2ms for 3rd task, 3ms for 4th task, etc. On my test project it helps to decrease CPU load:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://content.screencast.com/users/NazarV/folders/Jing/media/c86ed62c-be49-4ab9-b03a-35028d95bf29/2017-09-07_1119.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16156693" author="onders" created="Thu, 7 Sep 2017 08:41:34 +0000"  >&lt;p&gt;well, i would say if you have got long running tasks and and you push many tasks to your direct endpoint which will cause oveflooding your processor chain / route, i think this is a design issue.&lt;br/&gt;
i am not convinced that you can put delay to each task you send to direct enpoint. this may resolve your issue because you have got long running tasks. &lt;br/&gt;
what if you don&apos;t have long running tasks and you want to multicast and parallelize your route? I think putting delay will break such scenario as i mentioned as &quot;what if&quot;.&lt;/p&gt;

&lt;p&gt;i think you need to use throttler EIP if you have long running tasks and overflooding your direct endpoint to reduce the number of messages to your direct enpoint because you have got long running tasks. &lt;/p&gt;</comment>
                            <comment id="16156789" author="nazar vishka" created="Thu, 7 Sep 2017 10:30:38 +0000"  >&lt;p&gt;In my example application we have not many tasks, but just two. That does not cause overflooding of processor chain/route. Definitely problem is not in route&apos;s design.&lt;br/&gt;
For now, when last task is running, method &lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.19.2/camel-core/src/main/java/org/apache/camel/util/concurrent/SubmitOrderedCompletionService.java#L64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getDelay(TimeUnit)&lt;/a&gt; always returns 1. That results to situation that is alike while(true) loop and &quot;eats&quot; one CPU core. Throttler EIP cannot resolve this issue. Please take a look at example application.&lt;/p&gt;</comment>
                            <comment id="16156805" author="onders" created="Thu, 7 Sep 2017 10:54:02 +0000"  >&lt;p&gt;hmm, i see what you mean but i still think that putting 1 second delay to each item in the queue incrementally did not seem right to me.&lt;br/&gt;
there must be better solution. because such change may break short running tasks as my initial look to your PR. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; can better comment on this.&lt;/p&gt;</comment>
                            <comment id="16156811" author="nazar vishka" created="Thu, 7 Sep 2017 11:11:30 +0000"  >&lt;p&gt;I thought a little bit and I found we can decrease delay to 1 &#956;s. Even that will decrease load to CPU in ~1000 times for such cases. Also I think that will not seriously affect performance for a bunch of short tasks.&lt;/p&gt;</comment>
                            <comment id="16158292" author="davsclaus" created="Fri, 8 Sep 2017 08:21:52 +0000"  >&lt;p&gt;Thanks for reporting and diving int the JDK code and showing CPU graphs. Yeah it does smell like the JDK with the no-delay would keep looping in that logic&lt;/p&gt;</comment>
                            <comment id="16158310" author="davsclaus" created="Fri, 8 Sep 2017 08:41:19 +0000"  >&lt;p&gt;Thanks for the PR. I ammended and pushed to master branch. Do you mind giving that a test on your system?&lt;/p&gt;

&lt;p&gt;I set the minimal delay to 1 micro-second. That is very low, but some may think that even 1 milli second is too high. But lets see if 1 micro-second is too fast and also takes up too much CPU. I am open to changing it to 1 milli-second or do 100 micro-seconds (1/10th of micro second).&lt;/p&gt;</comment>
                            <comment id="16158311" author="githubbot" created="Fri, 8 Sep 2017 08:42:13 +0000"  >&lt;p&gt;Github user leofromgroza closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1922&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16160864" author="nazar vishka" created="Mon, 11 Sep 2017 07:52:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; thank you for fast reaction. I&apos;ve made tests with 1 microsecond delay and it helps - CPU usage is &amp;lt;=0.1% that is a great result. I think that we can dwell on 1 microsecond delay.  &lt;/p&gt;</comment>
                            <comment id="16160998" author="davsclaus" created="Mon, 11 Sep 2017 09:54:37 +0000"  >&lt;p&gt;Thanks for testing.&lt;/p&gt;</comment>
                            <comment id="16948369" author="vzinkevich" created="Thu, 10 Oct 2019 09:59:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; hi, this appeared to be an issue with java 11 due to minor, but affecting changes to java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#awaitNanos. &lt;/p&gt;

&lt;p&gt;In java 8 the condition to wait was&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#000080&quot;&gt;if &lt;/font&gt;(nanosTimeout &amp;gt;= &lt;font color=&quot;#660e7a&quot;&gt;SPIN_FOR_TIMEOUT_THRESHOLD&lt;/font&gt;)&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;

&lt;p&gt;but got changed to&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#000080&quot;&gt;if &lt;/font&gt;(nanosTimeout &amp;gt; &lt;font color=&quot;#660e7a&quot;&gt;SPIN_FOR_TIMEOUT_THRESHOLD&lt;/font&gt;)&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;

&lt;p&gt;And this is breaking change for Camel, because&#160;&lt;font color=&quot;#660e7a&quot;&gt;SPIN_FOR_TIMEOUT_THRESHOLD&lt;/font&gt; = 1000L and org.apache.camel.util.concurrent.SubmitOrderedCompletionService.SubmitOrderFutureTask#getDelay returns 1000 as well, when called with NANOSECONDS.&lt;/p&gt;

&lt;p&gt;If the values is 1001 for example, it works fine, otherwise the CPU is highly loaded.&lt;/p&gt;</comment>
                            <comment id="16948377" author="davsclaus" created="Thu, 10 Oct 2019 10:11:29 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vzinkevich&quot; class=&quot;user-hover&quot; rel=&quot;vzinkevich&quot;&gt;vzinkevich&lt;/a&gt; are you able to submit a fix as a github PR ?&lt;/p&gt;</comment>
                            <comment id="16948381" author="vzinkevich" created="Thu, 10 Oct 2019 10:13:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; will do! I&apos;m planning to do a quick fix to avoid those 1000L value to just be as 1001L. Looks like a hack, but it will suffice I guess...&lt;/p&gt;</comment>
                            <comment id="16948428" author="davsclaus" created="Thu, 10 Oct 2019 11:07:32 +0000"  >&lt;p&gt;Yeah its fine to 1001 and then maybe just add a little code comment above why we do this&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jp7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>