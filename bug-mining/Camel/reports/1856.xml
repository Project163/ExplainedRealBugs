<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:51:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-5235] Make sure to close file input stream when converting file to string to avoid locking file on windows</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5235</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;See nabble&lt;br/&gt;
&lt;a href=&quot;http://camel.465427.n5.nabble.com/File-Processor-Not-deleting-the-files-tp5670301.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.465427.n5.nabble.com/File-Processor-Not-deleting-the-files-tp5670301.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Need to explicit close the file input/output streams to avoid the files to be locked on windows.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553453">CAMEL-5235</key>
            <summary>Make sure to close file input stream when converting file to string to avoid locking file on windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 May 2012 06:51:47 +0000</created>
                <updated>Wed, 2 May 2012 08:48:42 +0000</updated>
                            <resolved>Tue, 1 May 2012 07:05:03 +0000</resolved>
                                    <version>2.9.2</version>
                                    <fixVersion>2.9.3</fixVersion>
                    <fixVersion>2.10.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13265720" author="bvahdat" created="Tue, 1 May 2012 09:18:38 +0000"  >&lt;p&gt;Claus, one stupid question of mine:&lt;/p&gt;

&lt;p&gt;Why don&apos;t we simply remove these two static member classes EncodingFileReader as well as EncodingFileWriter and just make use of JDK&apos;s own InputStreamReader &amp;amp; OutputStreamWriter directly? To my understanding these two classes provide no added value other than trouble. And the JDK&apos;s own bridges (byte streams to character streams) are already &lt;b&gt;encoding aware&lt;/b&gt; anyway!&lt;/p&gt;

&lt;p&gt;So the two usage methods would simply become:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BufferedReader toReader(File file, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; charset) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        FileInputStream in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; IOHelper.buffered(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(in, charset));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BufferedWriter toWriter(File file, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; append, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; charset) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        FileOutputStream os = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(file, append);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; IOHelper.buffered(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamWriter(os, charset));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They were both introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-2056&quot; title=&quot;Optional charset parameter in convertBodyTo is ignored by most converters in IOConverter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-2056&quot;&gt;&lt;del&gt;CAMEL-2056&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13265725" author="davsclaus" created="Tue, 1 May 2012 09:31:22 +0000"  >&lt;p&gt;Maybe but dont you still have the the issue that the File input/output streams do not get closed when the InputStreamWriter/OutputStreamWriter gets closed.&lt;/p&gt;

&lt;p&gt;With the current code we explicit close those now.&lt;/p&gt;</comment>
                            <comment id="13265727" author="davsclaus" created="Tue, 1 May 2012 09:32:19 +0000"  >&lt;p&gt;You are welcome to do some investigations and see if we can do as you suggests, but we need to make sure the file streams gets closed, to avoid locking issues with windows.&lt;/p&gt;</comment>
                            <comment id="13265736" author="bvahdat" created="Tue, 1 May 2012 10:26:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Maybe but dont you still have the the issue that the File input/output streams do not get closed when the InputStreamWriter/OutputStreamWriter gets closed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No as that&apos;s done for &quot;free&quot; through the close() method magic, that&apos;s the call-chaining of the close() call by the underlying input/output streams. As an example when we look at BufferedReader.close() method we see that the close() call get&apos;s chained and the underlying stream (hopefully) does properly chain the call again and again, until the OS native stream gets properly closed. &lt;b&gt;But&lt;/b&gt; that&apos;s the user&apos;s responsibility to&lt;br/&gt;
do that:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;BufferedReader myReader = CamelContext.getTypeConverter().convertTo(BufferedReader.class, ...);
&#8230;
&#8230;
myReader.close(); &lt;span class=&quot;code-comment&quot;&gt;// user should close the stream properly after the usage&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The main &quot;problem&quot; is that we can&apos;t control if the user do &lt;b&gt;properly&lt;/b&gt; close the Reader, Writer, In and Outputstream after the usage. And if they don&apos;t, then they will run into trouble and think something in Camel could be the reason for that.&lt;/p&gt;</comment>
                            <comment id="13265845" author="davsclaus" created="Tue, 1 May 2012 14:48:28 +0000"  >&lt;p&gt;Yeah if the user gets a reader/stream etc then he may need to close it after use.&lt;/p&gt;

&lt;p&gt;But in this use-case it was converting to String or byte[] etc directly. And for that Camel must make sure to close the stream internally.&lt;/p&gt;</comment>
                            <comment id="13266421" author="bvahdat" created="Wed, 2 May 2012 08:08:49 +0000"  >&lt;p&gt;While trying to find some resources on the web describing what my &lt;b&gt;poor&lt;/b&gt; english is talking about, I came along many of them but the best one was given through that &lt;b&gt;already dissappered real vendor&lt;/b&gt; itself:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Similarly, when closing chained streams, you only need to close the outermost stream class because the close() call is automatically trickled through all the chained classes; in the example above, you would simply call the close() method on the GZIPOutputStream class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When you look at the example there the inner most OutputStream is also a FileOutputStream, however there&apos;s no need of an explicit close call on that:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://java.sun.com/developer/technicalArticles/Streams/ProgIOStreams/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/developer/technicalArticles/Streams/ProgIOStreams/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are plenty of other APIs having similar semantics (call-chaining) like when you close a JDBC Statement:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note:When a Statement object is closed, its current ResultSet object, if one exists, is also closed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/sql/Statement.html#close(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/sql/Statement.html#close(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;So why I still ask for your approval to get rid of those two obsolete static member classes.&lt;/p&gt;</comment>
                            <comment id="13266440" author="davsclaus" created="Wed, 2 May 2012 08:48:42 +0000"  >&lt;p&gt;Yes they can possible be removed, just make sure the FileInputStream gets closed, as otherwise it can lock file handles on Windows.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i025u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>