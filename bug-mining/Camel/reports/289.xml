<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:27:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-792] Exception is not logged or handled when error handler is LoggingErrorHandler and processing occurs inside Pipeline</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-792</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Exception throw inside Pipeline is not reported or handled when error handler is LoggingErrorHandler.&lt;br/&gt;
Attached unit test fails - exchange with exception is not passed to &quot;mock:error&quot; endpoints.&lt;br/&gt;
Test will pass when you change error handler to default (DeadLetterErrorHandler)&lt;br/&gt;
or when processor throwing an exception is processed not inside Pipeline.&lt;/p&gt;

&lt;p&gt;After some digging inside source code I noticed Pipeline source code fragment.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        AsyncProcessorHelper.process(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, exchange);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;AsyncProcessorHelper.process(..) never throws exception directly.&lt;br/&gt;
Instead it passes exception information in exchange object properties.&lt;br/&gt;
Problem is LoggingErrorHandler doesn&apos;t use it correctly because (code snipped from LoggingErrorHandler):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            output.process(exchange);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!customProcessorForException(exchange, e)) {
                logError(exchange, e);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it is logging only exception returned directly by output.process call.&lt;/p&gt;</description>
                <environment>&lt;p&gt;camel-core-1.4.0.0-fuse. windows xp, java 6&lt;/p&gt;</environment>
        <key id="12485995">CAMEL-792</key>
            <summary>Exception is not logged or handled when error handler is LoggingErrorHandler and processing occurs inside Pipeline</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="tdomzal">Tomasz Domzal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Aug 2008 21:22:13 +0000</created>
                <updated>Mon, 16 Feb 2009 05:51:49 +0000</updated>
                            <resolved>Wed, 13 Aug 2008 18:42:52 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12948313" author="davsclaus" created="Fri, 8 Aug 2008 12:25:14 +0000"  >&lt;p&gt;Error handling should &lt;b&gt;just work&lt;/b&gt; so target for Camel 1.5&lt;/p&gt;</comment>
                            <comment id="12948376" author="tdomzal" created="Mon, 11 Aug 2008 08:19:37 +0000"  >&lt;p&gt;Attached patch for LoggingErrorHandler and verifying test case (new file).&lt;/p&gt;

&lt;p&gt;Two doubts:&lt;/p&gt;

&lt;p&gt;1)&lt;br/&gt;
Inside LoggingErrorHandler, before passing to handling exception cause is moved to exchange property.&lt;br/&gt;
Is that correct ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
		output.process(exchange);
	} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
		exchange.setException(e);
	}
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exchange.getException()!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {

		&lt;span class=&quot;code-comment&quot;&gt;// move exchange exception cause to property
&lt;/span&gt;		Throwable e = exchange.getException();
		exchange.setProperty(DeadLetterChannel.EXCEPTION_CAUSE_PROPERTY, e);
		exchange.setException(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!customProcessorForException(exchange, e)) {
			logError(exchange, e);
		}

		&lt;span class=&quot;code-comment&quot;&gt;// restore exception on exchange
&lt;/span&gt;		exchange.setException((Throwable)exchange.getProperty(DeadLetterChannel.EXCEPTION_CAUSE_PROPERTY));
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2)&lt;br/&gt;
Inside test case.&lt;br/&gt;
When defining exception enclusure in path DSL definition I used &apos;end()&apos; element to close &apos;exception handling&apos; subpath.&lt;br/&gt;
(without &apos;end()&apos; exception handling is not working at all.)&lt;br/&gt;
Is that correct ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(...)
	.exception(SomeException.class).to(...).end()
	.process(...)
	.to(...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12948318" author="davsclaus" created="Tue, 12 Aug 2008 04:27:14 +0000"  >&lt;p&gt;Hi Thomasz&lt;/p&gt;

&lt;p&gt;Thanks for looking into this and providing patches and with comments as well.&lt;/p&gt;

&lt;p&gt;Ad 1)&lt;br/&gt;
Ah here we get a bit confusing with Camel.&lt;/p&gt;

&lt;p&gt;You can fail a route by:&lt;br/&gt;
a) throwing an exception&lt;br/&gt;
b) setting an exception on the exchange&lt;/p&gt;

&lt;p&gt;case a is handled today by the logging error handler. The bug is that case b is not. The DLC handles both cases.&lt;/p&gt;

&lt;p&gt;What you do by setting the exception on the message is that a is now =&amp;gt; b. I do think we should keep the two cases separated.&lt;/p&gt;


&lt;p&gt;Ad 2)&lt;br/&gt;
Ah this is not seen very often but clever. You have the exception within the from = in your route path.&lt;br/&gt;
Yes the end() is needed otherwise Camel doesn&apos;t know when to stop if it goes by the exception path.&lt;br/&gt;
It doesn&apos;t know about new lines so it would just continue. With this you can do fancy stuff&lt;/p&gt;

&lt;p&gt;exception(xxx).to(yy).process(zzz).choice()....&lt;br/&gt;
Just like a regular route path. So when you have it nested you need to tell Camel when to end this path.&lt;/p&gt;

&lt;p&gt;If you move the exception outside then you can use the semi colon to stop ;&lt;/p&gt;

&lt;p&gt;exception(xxx).to(yy);&lt;br/&gt;
from(aaa).process(bla);&lt;/p&gt;

&lt;p&gt;Then the ; is like the end()&lt;/p&gt;
</comment>
                            <comment id="12948500" author="tdomzal" created="Tue, 12 Aug 2008 18:34:32 +0000"  >&lt;p&gt;So you suggest not touching &quot;case a&quot; and adding proper handling of &quot;case b&quot; ?&lt;/p&gt;</comment>
                            <comment id="12948339" author="davsclaus" created="Tue, 12 Aug 2008 19:00:26 +0000"  >&lt;p&gt;Yes, something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Throwable toBeLogged = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; a
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// base b
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (toBeLogged != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  &lt;span class=&quot;code-comment&quot;&gt;// log it
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12948437" author="davsclaus" created="Wed, 13 Aug 2008 18:42:52 +0000"  >&lt;p&gt;Tomasz thanks for the patches. I have applied a fix based on your work. Also I fixed that for INFO logging it was logging at DEBUG level instead.&lt;/p&gt;</comment>
                            <comment id="12948498" author="tdomzal" created="Thu, 14 Aug 2008 16:31:33 +0000"  >&lt;p&gt;I was still working on this but you ware faster &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
BWT. I&apos;m digging a little bit more around LoggingErrorHandler and found some issues directly related to modified error handler fragment. Should I report it here or rather on mailing list ?&lt;/p&gt;</comment>
                            <comment id="12948515" author="davsclaus" created="Sat, 16 Aug 2008 06:02:14 +0000"  >&lt;p&gt;Tomasz the mailing list is a good place if you are not sure its really a in issue or you need help.&lt;br/&gt;
If you are pretty sure its a bug then please open a new JIRA ticket.&lt;/p&gt;

&lt;p&gt;Glad you are looking into this and take time to report it. Digging into the code also helps you understand how Camel works so you get some education as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12950737" author="davsclaus" created="Mon, 16 Feb 2009 05:51:49 +0000"  >&lt;p&gt;Closing all 1.5.0 issues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462560" name="ExceptionHandlingWithLoggingHanderAndPipelineTest.java" size="2074" author="tdomzal" created="Thu, 7 Aug 2008 21:32:06 +0000"/>
                            <attachment id="12462517" name="camel-792-logging-error-handler-test-case.patch.txt" size="7349" author="tdomzal" created="Mon, 11 Aug 2008 08:15:13 +0000"/>
                            <attachment id="12462634" name="camel-792-logging-error-handler.patch.txt" size="1234" author="tdomzal" created="Mon, 11 Aug 2008 08:14:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01efb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6106</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>