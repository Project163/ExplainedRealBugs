<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:31:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-1428] SftpConsumer : GenericFileRenameProcessStrategy - String index out of bounds</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1428</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;While trying to consume a file via SFTP and using the moveExpression to move the file into a done folder a renameException is thrown.&lt;/p&gt;

&lt;p&gt;In GenericFile the relativeFileName reads something like the following.   /incoming/test/file1.txt&lt;/p&gt;

&lt;p&gt;When it tries to call this code and exception is thrown because File.separator is &apos;\&apos; in a windows environment.&lt;br/&gt;
String relative = relativeFileName.substring(0, relativeFileName.lastIndexOf(File.separator));&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP&lt;/p&gt;</environment>
        <key id="12485458">CAMEL-1428</key>
            <summary>SftpConsumer : GenericFileRenameProcessStrategy - String index out of bounds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="watcher">Paddy Daly</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Mar 2009 17:08:26 +0000</created>
                <updated>Fri, 31 Jul 2009 06:34:12 +0000</updated>
                            <resolved>Mon, 9 Mar 2009 15:30:51 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0-M1</fixVersion>
                                    <component>camel-ftp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12951082" author="davsclaus" created="Thu, 5 Mar 2009 17:22:55 +0000"  >&lt;p&gt;Hi Paddy&lt;/p&gt;

&lt;p&gt;Thanks for reporting. I have commited a fix. Do you mind trying again when you get hold of an updated .jar?&lt;/p&gt;

&lt;p&gt;Committed revision 750515.&lt;/p&gt;</comment>
                            <comment id="12951053" author="davsclaus" created="Thu, 5 Mar 2009 17:23:40 +0000"  >&lt;p&gt;Maybe we have a record, 14 min bug fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12951066" author="watcher" created="Thu, 5 Mar 2009 19:54:21 +0000"  >&lt;p&gt;WOW, what a response time. Glad to be part of that record.&lt;/p&gt;

&lt;p&gt;Good news is that issue is solved. However I&apos;m now getting another issue.&lt;/p&gt;</comment>
                            <comment id="12951093" author="davsclaus" created="Fri, 6 Mar 2009 05:16:03 +0000"  >&lt;p&gt;Hi Paddy&lt;/p&gt;

&lt;p&gt;Thanks for the 2nd report. I got that fixed now.&lt;br/&gt;
It was a refactor that didnt look in the sftp file. The regular ftp was okay.&lt;/p&gt;

&lt;p&gt;Committed revision 750770.&lt;/p&gt;

&lt;p&gt;Could you try again, much appreciated.&lt;/p&gt;</comment>
                            <comment id="12951020" author="davsclaus" created="Fri, 6 Mar 2009 05:16:26 +0000"  >&lt;p&gt;BTW: This time the response time is longer, I had to sleep you know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12951032" author="watcher" created="Fri, 6 Mar 2009 09:26:38 +0000"  >&lt;p&gt;Still one more issue. I think I noticed a file path generated with .done twice.&lt;/p&gt;

&lt;p&gt;e.g temp/files/incoming/.done/.done/file.txt &lt;/p&gt;

&lt;p&gt;During the move into the done folder it looks like it trying to delete it from the .done folder instead of the incoming folder.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sleeping is cheating &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12951092" author="davsclaus" created="Fri, 6 Mar 2009 09:40:43 +0000"  >&lt;p&gt;Paddy can you show me your URI configuration of the FTP&lt;/p&gt;</comment>
                            <comment id="12951063" author="watcher" created="Fri, 6 Mar 2009 09:45:34 +0000"  >&lt;p&gt;&amp;lt;endpoint id=&quot;sftp&quot; uri=&quot;sftp://${sftpusername}@${ipaddress}//temp?password=pass&amp;amp;binary=true&amp;amp;recursive=true&amp;amp;delay=10000&amp;amp;initialDelay=2000&amp;amp;moveExpression=.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&amp;amp;knownHostsFile=c://known_host&amp;amp;filter=#myAntFilter&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;!-- we use the AntPathMatcherRemoteFileFilter to use ant paths for includes and exlucde --&amp;gt; 	&lt;br/&gt;
	&amp;lt;bean id=&quot;myAntFilter&quot; class=&quot;org.apache.camel.component.file.AntPathMatcherGenericFileFilter&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;	    &amp;lt;property name=&quot;includes&quot; value=&quot;*&lt;b&gt;/incoming/&lt;/b&gt;&quot;/&amp;gt;&lt;br/&gt;
	    &amp;lt;property name=&quot;excludes&quot; value=&quot;*&lt;b&gt;/outgoing/&lt;/b&gt;&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;/bean&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12951115" author="davsclaus" created="Fri, 6 Mar 2009 09:46:08 +0000"  >&lt;p&gt;And beware the FTP should not use absolute paths for names. They should all be relative to the FTP home directory.&lt;/p&gt;</comment>
                            <comment id="12948940" author="davsclaus" created="Fri, 6 Mar 2009 10:13:59 +0000"  >&lt;p&gt;I can reproduce it here locally. Will work on a fix.&lt;/p&gt;</comment>
                            <comment id="12951062" author="davsclaus" created="Fri, 6 Mar 2009 14:24:33 +0000"  >&lt;p&gt;Paddy I am still working on this one as it leads me to do a minor refactor in the core to fix it better. &lt;/p&gt;</comment>
                            <comment id="12951079" author="watcher" created="Fri, 6 Mar 2009 14:30:37 +0000"  >&lt;p&gt;Thanks for the update Claus&lt;/p&gt;</comment>
                            <comment id="12951029" author="davsclaus" created="Fri, 6 Mar 2009 16:31:07 +0000"  >&lt;p&gt;Paddy can you try again? I have just committed a fix. I had to do some more work to get it properly fixed.&lt;/p&gt;

&lt;p&gt;Now the code that handles/computes file names, and rename file names etc. is much cleaner and relies a bit more on JDK.&lt;/p&gt;</comment>
                            <comment id="12951031" author="watcher" created="Fri, 6 Mar 2009 18:30:23 +0000"  >&lt;p&gt;I&apos;m getting a null in my path now.&lt;/p&gt;

&lt;p&gt;I&apos;ve updated my uri since, i.e just removed  the temp folder.&lt;/p&gt;

&lt;p&gt;&amp;lt;endpoint id=&quot;sftp&quot; uri=&quot;sftp://${sftpusername}@${ipaddress}?password=pass&amp;amp;binary=true&amp;amp;recursive=true&amp;amp;delay=10000&amp;amp;initialDelay=2000&amp;amp;moveExpression=.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&amp;amp;knownHostsFile=c://known_host&amp;amp;filter=#myAntFilter&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;When you referred to &lt;br/&gt;
&quot;beware the FTP should not use absolute paths for names&quot; &lt;br/&gt;
do you mean the knownHostsFile path.&lt;/p&gt;</comment>
                            <comment id="12951113" author="davsclaus" created="Sat, 7 Mar 2009 08:18:19 +0000"  >&lt;p&gt;Paddy can you try again? I have committed a new fix&lt;br/&gt;
Committed revision 751221.&lt;/p&gt;

&lt;p&gt;My tests was having a starting directory configured, where as you URI option above does not.&lt;/p&gt;

&lt;p&gt;About the &lt;b&gt;absolute&lt;/b&gt; paths. That is the move expression should not be like D:/myfolder, or //myserver/path, or /rootfolder as all paths in FTP should be considered relative to starting directory you configure in the URI.&lt;/p&gt;</comment>
                            <comment id="12951111" author="davsclaus" created="Sat, 7 Mar 2009 09:23:43 +0000"  >&lt;p&gt;Paddy notice &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1434&quot; title=&quot;Camel VFS - Shorten options for move, preMove and file by removing the Expression suffix &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1434&quot;&gt;&lt;del&gt;CAMEL-1434&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have shortened the xxxExpression options to:&lt;br/&gt;
moveExpression = move&lt;br/&gt;
preMoveExpression = preMove&lt;br/&gt;
fileExpression = fileName&lt;/p&gt;</comment>
                            <comment id="12951118" author="watcher" created="Sat, 7 Mar 2009 09:26:18 +0000"  >&lt;p&gt;Here&apos;s the error now.&lt;/p&gt;

&lt;p&gt;Why is it trying to delete the file from the .done directory?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;le.remote.SftpComponent@7b1641&amp;#93;&lt;/span&gt; SftpConsumer                   DEBUG Done processing file: GenericFile&lt;span class=&quot;error&quot;&gt;&amp;#91;temp/incoming/file.txt&amp;#93;&lt;/span&gt;. Status is: processed OK&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;le.remote.SftpComponent@7b1641&amp;#93;&lt;/span&gt; SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1be4663 for file: GenericFile&lt;span class=&quot;error&quot;&gt;&amp;#91;temp/incoming/file.txt&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;le.remote.SftpComponent@7b1641&amp;#93;&lt;/span&gt; SftpOperations                 DEBUG Deleteing file: /.done/file.txt&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;le.remote.SftpComponent@7b1641&amp;#93;&lt;/span&gt; SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1be4663&lt;br/&gt;
org.apache.camel.component.file.remote.RemoteFileOperationFailedException: Cannot delete file: /.done/file.txt&lt;br/&gt;
	at org.apache.camel.component.file.remote.SftpOperations.deleteFile(SftpOperations.java:154)&lt;br/&gt;
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:65)&lt;br/&gt;
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)&lt;/p&gt;</comment>
                            <comment id="12951119" author="davsclaus" created="Sat, 7 Mar 2009 09:43:37 +0000"  >&lt;p&gt;Paddy&lt;/p&gt;

&lt;p&gt;Could you try again, with this new commit?&lt;br/&gt;
Committed revision 751231.&lt;/p&gt;

&lt;p&gt;Its trying to delete the file, in case an existing file exists, before it moves the file. The API does not allow you to instruct it to overriding any existing files. Hence we delete it before move.&lt;/p&gt;</comment>
                            <comment id="12951127" author="watcher" created="Sat, 7 Mar 2009 09:55:21 +0000"  >&lt;p&gt;Still the same issue/error&lt;/p&gt;</comment>
                            <comment id="12951126" author="davsclaus" created="Sat, 7 Mar 2009 10:21:59 +0000"  >&lt;p&gt;Okay a new fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Committed revision 751237.&lt;/p&gt;

&lt;p&gt;I will be out the door for approx. 1h&lt;/p&gt;</comment>
                            <comment id="12951125" author="watcher" created="Sat, 7 Mar 2009 11:18:19 +0000"  >&lt;p&gt;When I look into the GenericFileRenameProcessStrategy&lt;/p&gt;

&lt;p&gt; operations.deleteFile(to.getAbsoluteFileName());&lt;/p&gt;

&lt;p&gt;The &quot;to&quot;  the canonicalFileName is pointing to my local directory&lt;/p&gt;

&lt;p&gt;C:\source\router\.done\file.txt&lt;/p&gt;

&lt;p&gt;The to.getAbsoluteFileName() translates to &lt;br/&gt;
/.done/file.txt&lt;/p&gt;

&lt;p&gt;I&apos;m going to look into the  channel.rm(name); code now&lt;/p&gt;</comment>
                            <comment id="12951124" author="davsclaus" created="Sat, 7 Mar 2009 12:09:05 +0000"  >&lt;p&gt;Paddy did you try the latest patch? It should translate /.done/file.txt -&amp;gt; .done/file.txt when it does the delete operation.&lt;/p&gt;

&lt;p&gt;The problem is likely that the SFTP server you use eg doesnt jail the user, so using / will escape and give access to the root of your file system.&lt;/p&gt;

&lt;p&gt;So I fix this for the FTP operations to remove any leading / for file names.&lt;/p&gt;</comment>
                            <comment id="12951123" author="watcher" created="Sat, 7 Mar 2009 12:21:59 +0000"  >&lt;p&gt;Yeah, got the latest patch&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;e.remote.SftpComponent@167e3a5&amp;#93;&lt;/span&gt; SftpConsumer                   ERROR Cannot delete file: .done/file.txt&lt;br/&gt;
org.apache.camel.component.file.remote.RemoteFileOperationFailedException: Cannot delete file: .done/file.txt&lt;/p&gt;</comment>
                            <comment id="12951122" author="davsclaus" created="Sat, 7 Mar 2009 12:30:24 +0000"  >&lt;p&gt;Ah got it, must have started blind:&lt;br/&gt;
RemoteFileOperationFailedException is extending the wrong base class. Will commit a fix in a sec.&lt;/p&gt;</comment>
                            <comment id="12951121" author="davsclaus" created="Sat, 7 Mar 2009 12:37:44 +0000"  >&lt;p&gt;Paddy commited a fix&lt;br/&gt;
Committed revision 751256.&lt;/p&gt;

&lt;p&gt;Sorry for causing all this trouble. There are no Java SFTP library we can use for unit testing. So we rely on the fact that the codebase for FTP and SFTP is as similar as possible. However the SFTP and FTP client .jars are a bit differently. The FTP returns true/false for many of its operations where as the SFTP throws Exception.&lt;/p&gt;

&lt;p&gt;So this bug was not caught by the FTP unit testing.&lt;/p&gt;

&lt;p&gt;Let me know how it goes this time.&lt;/p&gt;</comment>
                            <comment id="12951129" author="watcher" created="Sat, 7 Mar 2009 12:56:58 +0000"  >&lt;p&gt;That worked.&lt;/p&gt;

&lt;p&gt;However the file ended up in the .done folder relative to the root folder.&lt;/p&gt;

&lt;p&gt;sftpRootFolder/&lt;br/&gt;
                             .done&lt;br/&gt;
                                      /file.txt   &amp;lt;---- end here&lt;/p&gt;


&lt;p&gt;                          /temp&lt;br/&gt;
                                   /incoming&lt;br/&gt;
                                                     /file.txt   &amp;lt;-- consumed from here &lt;br/&gt;
                                   /.done                     &lt;br/&gt;
                                                    /file1.txt   &amp;lt;-- expected here&lt;/p&gt;</comment>
                            <comment id="12951132" author="davsclaus" created="Sat, 7 Mar 2009 14:29:58 +0000"  >&lt;p&gt;Great glad it worked now.&lt;/p&gt;

&lt;p&gt;About the location of the .done folder.&lt;br/&gt;
Yeah I guess that it should be local since you enter a relative path (eg not starting with /)&lt;/p&gt;

&lt;p&gt;I will check into it when I get a bit time.&lt;/p&gt;

&lt;p&gt;So entering:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} will be a subfolder where the file was consumed&lt;/li&gt;
	&lt;li&gt;../.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} will be a parent folder (sibling) to where the file was consumed&lt;/li&gt;
	&lt;li&gt;/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} will be a subfolder in the FTP root folder&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12951163" author="davsclaus" created="Sat, 7 Mar 2009 14:55:12 +0000"  >&lt;p&gt;Paddy&lt;/p&gt;

&lt;p&gt;About the placement of the .done folder. You should use the full power of the file language to put together an expression that solves your needs.&lt;/p&gt;

&lt;p&gt;So if you want to place the file in a .done subfolder in the &lt;b&gt;same&lt;/b&gt; folder it was consumed from, then you need to combine the ${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;} and ${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} such as:&lt;br/&gt;
&lt;tt&gt;move=${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;&lt;/tt&gt;}&lt;/p&gt;

&lt;p&gt;I have reworked the code a bit as ${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} should always only return the name (no directories) etc. as it should mimmic the corresponding java.io.File method.&lt;br/&gt;
See the file language wiki page for more.&lt;/p&gt;

&lt;p&gt;Using just .done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} will place it in  the root as Camel uses absolute names when it performs FTP operations. The reason is that it does a double pass, first find files to consume and then in the 2nd pass process them. This allows Camel to pickup the total number of files, for people that need to rely on batch processing where the want to know the current index and when the are no more files.&lt;/p&gt;</comment>
                            <comment id="12951147" author="watcher" created="Sat, 7 Mar 2009 15:14:46 +0000"  >&lt;p&gt;Thanks Claus&lt;/p&gt;

&lt;p&gt;I&apos;m heading out now. Will probably not get to try that until Monday. &lt;br/&gt;
Have a good weekend.&lt;br/&gt;
-Paddy&lt;/p&gt;</comment>
                            <comment id="12951162" author="watcher" created="Sun, 8 Mar 2009 10:30:18 +0000"  >&lt;p&gt;I&apos;ve added the the expression -&amp;gt;move=${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;/p&gt;

&lt;p&gt;and its generating this error.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[le.remote.SftpComponent@e80740] SftpConsumer                   DEBUG Total 1 files to consume
[le.remote.SftpComponent@e80740] SftpEndpoint                   DEBUG Using Generic file process strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1f42731
[le.remote.SftpComponent@e80740] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt.camelExclusiveReadLock
[le.remote.SftpComponent@e80740] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt.camelExclusiveReadLock to: temp/incoming/file.txt
[le.remote.SftpComponent@e80740] SftpConsumer                   DEBUG About to process file: GenericFile[temp/incoming/file.txt] using exchange: Exchange[GenericFileMessage: GenericFile[temp/incoming/file.txt]]
[le.remote.SftpComponent@e80740] RouterComponent                INFO  filename temp/incoming/file.txt
[le.remote.SftpComponent@e80740] GenericFileProducer            DEBUG Wrote [c:\fileserver\file.txt] to [Endpoint[file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver]]
&lt;/span&gt;[le.remote.SftpComponent@e80740] ObjectHelper                   WARN  Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX
[le.remote.SftpComponent@e80740] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[le.remote.SftpComponent@e80740] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1f42731 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@e80740] SftpOperations                 DEBUG Deleteing file: \temp\incoming\.done/file.txt
[le.remote.SftpComponent@e80740] SftpOperations                 DEBUG Trying to build remote directory: temp\incoming\.done
[le.remote.SftpComponent@e80740] SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1f42731
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot create directory: \temp\incoming\.done (could be because of denied permissions)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:74)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)
	at org.apache.camel.component.file.GenericFileConsumer.processStrategyCommit(GenericFileConsumer.java:226)
	at org.apache.camel.component.file.GenericFileConsumer$1.done(GenericFileConsumer.java:180)
	at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:57)
	at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:74)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:106)


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951140" author="davsclaus" created="Sun, 8 Mar 2009 11:16:43 +0000"  >&lt;p&gt;Paddy I have committed a fix for you to try out.&lt;br/&gt;
Committed revision 751401.&lt;/p&gt;

&lt;p&gt;There might still be a gremlin in there but I would like to see how it goes on your XP with SFTP.&lt;/p&gt;</comment>
                            <comment id="12951161" author="davsclaus" created="Sun, 8 Mar 2009 11:29:14 +0000"  >&lt;p&gt;Another minor fix&lt;br/&gt;
Committed revision 751402.&lt;/p&gt;</comment>
                            <comment id="12951139" author="watcher" created="Sun, 8 Mar 2009 11:31:55 +0000"  >&lt;p&gt;Sorry got to head out the door, wont be back for a few hours&lt;/p&gt;</comment>
                            <comment id="12951168" author="watcher" created="Sun, 8 Mar 2009 14:57:03 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[e.remote.SftpComponent@19b808a] SftpConsumer                   DEBUG Total 1 files to consume
[e.remote.SftpComponent@19b808a] SftpEndpoint                   DEBUG Using Generic file process strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@149f041
[e.remote.SftpComponent@19b808a] SftpOperations                 DEBUG Renaming file: /temp/incoming/file.txt to: /temp/incoming/file.txt.camelExclusiveReadLock
[e.remote.SftpComponent@19b808a] SftpOperations                 DEBUG Renaming file: /temp/incoming/file.txt.camelExclusiveReadLock to: /temp/incoming/file.txt
[e.remote.SftpComponent@19b808a] SftpConsumer                   DEBUG About to process file: GenericFile[temp/incoming/file.txt] using exchange: Exchange[GenericFileMessage: GenericFile[temp/incoming/file.txt]]
[e.remote.SftpComponent@19b808a] RouterComponent                INFO  filename &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
[e.remote.SftpComponent@19b808a] DeadLetterChannel              ERROR Failed delivery &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; exchangeId: ID-DELLPD-2562-1236524034668-0-0. On delivery attempt: 0 caught: java.lang.NullPointerException
java.lang.NullPointerException
	at java.util.StringTokenizer.&amp;lt;init&amp;gt;(StringTokenizer.java:182)
	at java.util.StringTokenizer.&amp;lt;init&amp;gt;(StringTokenizer.java:204)
	at com.opt2vote.easyprint.router.RouterComponent$1.process(RouterComponent.java:45)
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:80)
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:194)
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:129)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:115)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:89)
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.proceed(StreamCachingInterceptor.java:88)
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.process(StreamCachingInterceptor.java:83)
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:52)
	at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:165)
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:98)
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:66)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951167" author="davsclaus" created="Sun, 8 Mar 2009 15:18:13 +0000"  >&lt;p&gt;Paddy the bug is in &lt;b&gt;your&lt;/b&gt; code. You gotta check you route. Check RouterComponent.java:45 what you are doing there.&lt;/p&gt;</comment>
                            <comment id="12951175" author="watcher" created="Sun, 8 Mar 2009 16:10:19 +0000"  >&lt;p&gt;The filename is null now for some reason&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(getSFTPEndPoint())		
		.process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
				Message message = (Message) exchange.getIn();
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) message.getHeader(Exchange.FILE_NAME);
				log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename &quot;&lt;/span&gt; + filename);
				StringTokenizer tokenizer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringTokenizer(filename, &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);
				&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(tokenizer.hasMoreTokens()){
					&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; token = tokenizer.nextToken();
					&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(tokenizer.hasMoreTokens() == &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;){
						log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;setting filename header on exchange to &quot;&lt;/span&gt; + token);
						exchange.getOut().setHeader(
								Exchange.FILE_NAME,
								token);
					}
				}
			}
		}). 
		to(getFileRepository())
		.setHeader(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, groovy(&lt;span class=&quot;code-quote&quot;&gt;&quot;in.headers.filename&quot;&lt;/span&gt;)).setBody(constant(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:print&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951170" author="davsclaus" created="Sun, 8 Mar 2009 16:14:35 +0000"  >&lt;p&gt;And you rebuild all the code when you try again?&lt;/p&gt;

&lt;p&gt;camel-ftp and camel-core should always be recompiled?&lt;/p&gt;

&lt;p&gt;I will try to look if there is something I can spot, and create a unit test that resembles your route. Albeit with regular FTP.&lt;/p&gt;</comment>
                            <comment id="12951128" author="davsclaus" created="Sun, 8 Mar 2009 16:25:43 +0000"  >&lt;p&gt;BTW In all the code you do above I have added a new header: &lt;tt&gt;Exchange.FILE_NAME_ONLY&lt;/tt&gt; that just returns the name with no paths at all.&lt;/p&gt;

&lt;p&gt;And its best practice to use the 2nd parameter to provide the type:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = message.getHeader(Exchange.FILE_NAME_ONLY, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="12951151" author="watcher" created="Mon, 9 Mar 2009 05:02:02 +0000"  >&lt;p&gt;I&apos;ve rebuilt both camel-ftp and camel-core and updated my route to use FILE_NAME_ONLY and I&apos;m getting an error&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[e.remote.SftpComponent@110278e] SftpConsumer                   DEBUG About to process file: GenericFile[temp/incoming/file.txt] using exchange: Exchange[GenericFileMessage: GenericFile[temp/incoming/file.txt]]
[e.remote.SftpComponent@110278e] RouterComponent                INFO  message GenericFileMessage: GenericFile[temp/incoming/file.txt]
[e.remote.SftpComponent@110278e] RouterComponent                INFO  filename file.txt
[e.remote.SftpComponent@110278e] GenericFileProducer            DEBUG Wrote [c:\fileserver\file.txt] to [Endpoint[file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver]]
&lt;/span&gt;[e.remote.SftpComponent@110278e] ObjectHelper                   WARN  Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX
[e.remote.SftpComponent@110278e] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[e.remote.SftpComponent@110278e] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@19c4091 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[e.remote.SftpComponent@110278e] SftpOperations                 DEBUG Deleteing file: /\temp\incoming\.done/file.txt
[e.remote.SftpComponent@110278e] SftpOperations                 DEBUG Trying to build remote directory: \temp\incoming\.done
[e.remote.SftpComponent@110278e] SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@19c4091
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot create directory: \temp\incoming\.done (could be because of denied permissions)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:74)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)
	at org.apache.camel.component.file.GenericFileConsumer.processStrategyCommit(GenericFileConsumer.java:226)
	at org.apache.camel.component.file.GenericFileConsumer$1.done(GenericFileConsumer.java:180)
	at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:57)
	at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:74)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:106)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Error seems to be here&lt;/p&gt;

&lt;p&gt;DEBUG Deleteing file: /\temp\incoming\.done/file.txt&lt;/p&gt;</comment>
                            <comment id="12951158" author="davsclaus" created="Mon, 9 Mar 2009 07:02:14 +0000"  >&lt;p&gt;Ahh yeah bloddy world with either / or \ as path separators. &lt;/p&gt;

&lt;p&gt;I have changed the logic in Camel to rely more on the JDK to compute file paths for me, instead of me build them self using strings.&lt;br/&gt;
So the problem manifests when you use Windows that uses \ separators with a FTP protocol that uses /.&lt;/p&gt;

&lt;p&gt;This one: Deleteing file: /\temp\incoming\.done/file.txt&lt;br/&gt;
Will just be ignored if it cannot delete it.&lt;/p&gt;

&lt;p&gt;But the dir path is correct FTP path: \temp\incoming\.done&lt;br/&gt;
I suspect I wont like the leading separator = \&lt;/p&gt;

&lt;p&gt;I will look into it and commit a fix in approx 1h or less.&lt;/p&gt;</comment>
                            <comment id="12951146" author="davsclaus" created="Mon, 9 Mar 2009 08:19:45 +0000"  >&lt;p&gt;Paddy a new fix committed, could you test it again?&lt;br/&gt;
Committed revision 751614.&lt;/p&gt;

&lt;p&gt;Both camel-core and camel-ftp should be rebuild.&lt;/p&gt;</comment>
                            <comment id="12951159" author="watcher" created="Mon, 9 Mar 2009 09:19:01 +0000"  >&lt;p&gt;Just arrived @work. Here ya go.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[le.remote.SftpComponent@8ae59a] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[le.remote.SftpComponent@8ae59a] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@7f3b8a &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@8ae59a] SftpOperations                 DEBUG Deleteing file: temp/incoming/file.txt
[le.remote.SftpComponent@8ae59a] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile[temp/incoming/file.txt] to: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@8ae59a] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt
[le.remote.SftpComponent@8ae59a] SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@7f3b8a
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot rename file from: temp/incoming/file.txt to: temp/incoming/file.txt
	at org.apache.camel.component.file.remote.SftpOperations.renameFile(SftpOperations.java:167)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:80)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)
	at org.apache.camel.component.file.GenericFileConsumer.processStrategyCommit(GenericFileConsumer.java:226)
	at org.apache.camel.component.file.GenericFileConsumer$1.done(GenericFileConsumer.java:180)
	at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:57)
	at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:74)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:106)
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.proceed(StreamCachingInterceptor.java:88)
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.process(StreamCachingInterceptor.java:83)
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:52)
	at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:165)
	at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:98)
	at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:66)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951177" author="davsclaus" created="Mon, 9 Mar 2009 09:44:24 +0000"  >&lt;p&gt;Paddy can you post your route and FTP uri as I am wondering why its trying to rename a file to the exact same name.&lt;br/&gt;
This can of course be optimized in Camel, but I am wondering though.&lt;/p&gt;</comment>
                            <comment id="12951171" author="watcher" created="Mon, 9 Mar 2009 09:51:16 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	 &amp;lt;camelContext xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/schema/spring&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;	    &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;&amp;gt;com.xxx.xxx.router&amp;lt;/&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;&amp;gt;    
	    &amp;lt;!-- use myFilter as filter to allow setting ANT paths &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; which files to scan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; --&amp;gt;
	    &amp;lt;endpoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sftpEndPoint&quot;&lt;/span&gt; uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;sftp:&lt;span class=&quot;code-comment&quot;&gt;//${sftpusername}@${ipaddress}?password=pass&amp;amp;amp;readLock=rename&amp;amp;amp;binary=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;amp;recursive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;amp;delay=10000&amp;amp;amp;initialDelay=2000&amp;amp;amp;move=${file:parent}/.done/${file:name}&amp;amp;amp;knownHostsFile=c://known_host&amp;amp;amp;filter=#myAntFilter&quot;&lt;/span&gt;/&amp;gt; 	  
&lt;/span&gt;	    &amp;lt;endpoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileRepository&quot;&lt;/span&gt; uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;	 &amp;lt;/camelContext&amp;gt;

	&amp;lt;!-- we use the AntPathMatcherRemoteFileFilter to use ant paths &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; includes and exlucde --&amp;gt; 	
	&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;myAntFilter&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.component.file.AntPathMatcherGenericFileFilter&quot;&lt;/span&gt;&amp;gt;	   
	    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;includes&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;**/incoming/*&quot;&lt;/span&gt;/&amp;gt;
	    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;excludes&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;**/outgoing/*&quot;&lt;/span&gt;/&amp;gt;
	&amp;lt;/bean&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	from(getSftpEndPoint())
		
		.process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
				Message message =  exchange.getIn();
				log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;message &quot;&lt;/span&gt; + message);
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename = message.getHeader(Exchange.FILE_NAME_ONLY, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
				log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename &quot;&lt;/span&gt; + filename);
				exchange.getOut().setHeader(
								Exchange.FILE_NAME,
								filename);
			}
		}). 
		to(getFileRepository())
		.setHeader(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, groovy(&lt;span class=&quot;code-quote&quot;&gt;&quot;in.headers.filename&quot;&lt;/span&gt;)).setBody(constant(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:print&quot;&lt;/span&gt;);
				
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951173" author="davsclaus" created="Mon, 9 Mar 2009 10:55:23 +0000"  >&lt;p&gt;Paddy can you try with:&lt;br/&gt;
${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:onlyname&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:onlyname&lt;/a&gt;}&lt;/p&gt;

&lt;p&gt;You must use the &lt;b&gt;onlyname&lt;/b&gt; to store it correctly.&lt;/p&gt;

&lt;p&gt;For me it looks like when there is no parent, then the evaluation of the:&lt;br/&gt;
${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;br/&gt;
results in ${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;} and not as it should .done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;/p&gt;

&lt;p&gt;And thus the file gets the exact same name.&lt;/p&gt;

</comment>
                            <comment id="12951166" author="davsclaus" created="Mon, 9 Mar 2009 10:58:05 +0000"  >&lt;p&gt;PS: in your processor above you should change the name directly on the IN.&lt;/p&gt;

&lt;p&gt;Message message = exchange.getIn();&lt;br/&gt;
String filename = message.getHeader(Exchange.FILE_NAME_ONLY, String.class);&lt;/p&gt;

&lt;p&gt;// replace name on IN to force no relative names&lt;br/&gt;
message.setHeader(Exchange.FILE_NAME, filename);&lt;/p&gt;
</comment>
                            <comment id="12951164" author="davsclaus" created="Mon, 9 Mar 2009 11:26:03 +0000"  >&lt;p&gt;Paddy can you do me a favor&lt;/p&gt;

&lt;p&gt;Adding the tracer to your route. Just add the code below in your route builder, before the from(getFTP...)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                getContext().addInterceptStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tracer());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will log at INFO level the message as they are routed.&lt;/p&gt;

&lt;p&gt;I would like to see what all the headers got resolve to, in that last bug of yours, eg using:&lt;br/&gt;
${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;/p&gt;

&lt;p&gt;PS: I am wondering if Camel should default add the pre and postfix so you as an end user just sets:&lt;br/&gt;
move=.done&lt;/p&gt;

&lt;p&gt;And then Camel will add the ${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;} and ${&lt;a href=&quot;file:onlyname&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:onlyname&lt;/a&gt;} itself. Then its easier for end users to work with.&lt;/p&gt;</comment>
                            <comment id="12951192" author="watcher" created="Mon, 9 Mar 2009 11:34:39 +0000"  >&lt;p&gt;This time the file is deleted from the incoming folder. It does not appear in any .done folder&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[le.remote.SftpComponent@7b1641] RouterComponent                INFO  filename file.txt
[le.remote.SftpComponent@7b1641] GenericFileProducer            DEBUG Wrote [c:\fileserver\file.txt] to [Endpoint[file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver]]
&lt;/span&gt;[le.remote.SftpComponent@7b1641] ObjectHelper                   WARN  Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX
[le.remote.SftpComponent@7b1641] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[le.remote.SftpComponent@7b1641] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@19214b1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@7b1641] SftpOperations                 DEBUG Deleteing file: temp/incoming/file.txt
[le.remote.SftpComponent@7b1641] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile[temp/incoming/file.txt] to: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@7b1641] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt
[le.remote.SftpComponent@7b1641] SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@19214b1
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot rename file from: temp/incoming/file.txt to: temp/incoming/file.txt
	at org.apache.camel.component.file.remote.SftpOperations.renameFile(SftpOperations.java:167)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:80)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)
	at org.apache.camel.component.file.GenericFileConsumer.processStrategyCommit(GenericFileConsumer.java:226)
	at org.apache.camel.component.file.GenericFileConsumer$1.done(GenericFileConsumer.java:180)
	at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:57)
	at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:74)
	at org.apache.camel.processor.Pipeline.process(Pipeline.java:106)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951191" author="watcher" created="Mon, 9 Mar 2009 11:35:42 +0000"  >&lt;p&gt;only after seeing your comments above, will retry&lt;/p&gt;</comment>
                            <comment id="12951209" author="watcher" created="Mon, 9 Mar 2009 11:45:48 +0000"  >&lt;p&gt;move=${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	getContext().addInterceptStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tracer());
	from(getSftpEndPoint())
		
		.process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
				Message message =  exchange.getIn();
				log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;message &quot;&lt;/span&gt; + message);
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename = message.getHeader(Exchange.FILE_NAME_ONLY, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
				
				message.setHeader(Exchange.FILE_NAME, filename);
				log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename &quot;&lt;/span&gt; + filename);
				exchange.getOut().setHeader(
								Exchange.FILE_NAME,
								filename);
			}
		}). 
		to(getFileRepository())
		.setHeader(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, groovy(&lt;span class=&quot;code-quote&quot;&gt;&quot;in.headers.filename&quot;&lt;/span&gt;)).setBody(constant(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:print&quot;&lt;/span&gt;);
				
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[le.remote.SftpComponent@1321f5] SftpEndpoint                   DEBUG Using Generic file process strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@e7d53
[le.remote.SftpComponent@1321f5] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt.camelExclusiveReadLock
[le.remote.SftpComponent@1321f5] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt.camelExclusiveReadLock to: temp/incoming/file.txt
[le.remote.SftpComponent@1321f5] SftpConsumer                   DEBUG About to process file: GenericFile[temp/incoming/file.txt] using exchange: Exchange[GenericFileMessage: GenericFile[temp/incoming/file.txt]]
[le.remote.SftpComponent@1321f5] TraceInterceptor               INFO  ID-DELLPD-2715-1236598778931-2-0 &amp;gt;&amp;gt;&amp;gt; sftp:&lt;span class=&quot;code-comment&quot;&gt;//xxxDemo@192.168.51.x?password=pass&amp;amp;readLock=rename&amp;amp;binary=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;recursive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;delay=10000&amp;amp;initialDelay=2000&amp;amp;move=${file:parent}/.done/${file:name}&amp;amp;knownHostsFile=c://known_host&amp;amp;filter=#myAntFilter --&amp;gt; process(com.xxx.xxx.router.RouterComponent$1@cd4544), Pattern:InOnly, Headers:{CamelFileBatchSize=1, CamelFileNameOnly=file.txt, CamelFileBatchIndex=0, CamelFileLastModified=Mon Mar 09 11:34:06 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFilePath=\temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileHost=192.168.51.5, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:org.apache.camel.component.file.remote.RemoteFile, Body:
&lt;/span&gt;[le.remote.SftpComponent@1321f5] RouterComponent                INFO  message GenericFileMessage: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@1321f5] RouterComponent                INFO  filename file.txt
[le.remote.SftpComponent@1321f5] TraceInterceptor               INFO  ID-DELLPD-2715-1236598778931-2-0 &amp;gt;&amp;gt;&amp;gt; process(com.xxx.xxx.router.RouterComponent$1@cd4544) --&amp;gt; to(file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 11:34:06 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=\temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
&lt;/span&gt;[le.remote.SftpComponent@1321f5] GenericFileProducer            DEBUG Wrote [c:\fileserver\file.txt] to [Endpoint[file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver]]
&lt;/span&gt;[le.remote.SftpComponent@1321f5] TraceInterceptor               INFO  ID-DELLPD-2715-1236598778931-2-0 &amp;gt;&amp;gt;&amp;gt; to(file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver) --&amp;gt; setHeader(groovy: in.headers.filename), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 11:34:06 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=\temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
&lt;/span&gt;[le.remote.SftpComponent@1321f5] TraceInterceptor               INFO  ID-DELLPD-2715-1236598778931-2-0 &amp;gt;&amp;gt;&amp;gt; setHeader(groovy: in.headers.filename) --&amp;gt; setBody(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 11:34:06 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=\temp/incoming/file.txt, CamelFileParent=temp/incoming, filename=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
[le.remote.SftpComponent@1321f5] TraceInterceptor               INFO  ID-DELLPD-2715-1236598778931-2-0 &amp;gt;&amp;gt;&amp;gt; setBody(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) --&amp;gt; to(activemq:queue:print), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 11:34:06 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=\temp/incoming/file.txt, CamelFileParent=temp/incoming, filename=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
[le.remote.SftpComponent@1321f5] ObjectHelper                   WARN  Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX
[le.remote.SftpComponent@1321f5] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[le.remote.SftpComponent@1321f5] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@e7d53 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@1321f5] SftpOperations                 DEBUG Deleteing file: temp/incoming/file.txt
[le.remote.SftpComponent@1321f5] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile[temp/incoming/file.txt] to: GenericFile[temp/incoming/file.txt]
[le.remote.SftpComponent@1321f5] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt
[le.remote.SftpComponent@1321f5] SftpConsumer                   WARN  Error committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@e7d53
org.apache.camel.component.file.GenericFileOperationFailedException: Cannot rename file from: temp/incoming/file.txt to: temp/incoming/file.txt
	at org.apache.camel.component.file.remote.SftpOperations.renameFile(SftpOperations.java:167)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.renameFile(GenericFileRenameProcessStrategy.java:80)
	at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:58)
	at org.apache.camel.component.file.GenericFileConsumer.processStrategyCommit(GenericFileConsumer.java:226)
	at org.apache.camel.component.file.GenericFileConsumer$1.done(GenericFileConsumer.java:180)
	at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:57)
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.proceed(StreamCachingInterceptor.java:96)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951198" author="davsclaus" created="Mon, 9 Mar 2009 12:15:09 +0000"  >&lt;p&gt;Paddy could you try again. I have commited a fix and added some DEBUG logging I need when the name is changed/computed.&lt;/p&gt;

&lt;p&gt;Committed revision 751658.&lt;/p&gt;

&lt;p&gt;Please run the same test as above.&lt;/p&gt;</comment>
                            <comment id="12951210" author="watcher" created="Mon, 9 Mar 2009 12:37:37 +0000"  >&lt;p&gt;That worked. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s the logs &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[e.remote.SftpComponent@15dc37d] SftpConsumer                   DEBUG Total 1 files to consume
[e.remote.SftpComponent@15dc37d] SftpEndpoint                   DEBUG Using Generic file process strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1f42731
[e.remote.SftpComponent@15dc37d] GenericFile                    DEBUG Changing name to: file.txt.camelExclusiveReadLock
[e.remote.SftpComponent@15dc37d] GenericFile                    DEBUG Name changed: GenericFile[temp/incoming/file.txt.camelExclusiveReadLock]
[e.remote.SftpComponent@15dc37d] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/file.txt.camelExclusiveReadLock
[e.remote.SftpComponent@15dc37d] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt.camelExclusiveReadLock to: temp/incoming/file.txt
[e.remote.SftpComponent@15dc37d] SftpConsumer                   DEBUG About to process file: GenericFile[temp/incoming/file.txt] using exchange: Exchange[GenericFileMessage: GenericFile[temp/incoming/file.txt]]
[e.remote.SftpComponent@15dc37d] TraceInterceptor               INFO  ID-DELLPD-3120-1236601791200-2-0 &amp;gt;&amp;gt;&amp;gt; sftp:&lt;span class=&quot;code-comment&quot;&gt;//xxxDemo@192.168.51.x?password=pass&amp;amp;readLock=rename&amp;amp;binary=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;recursive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;delay=10000&amp;amp;initialDelay=2000&amp;amp;move=${file:parent}/.done/${file:name}&amp;amp;knownHostsFile=c://known_host&amp;amp;filter=#myAntFilter --&amp;gt; process(com.xxx.xxx.router.RouterComponent$1@c5122f), Pattern:InOnly, Headers:{CamelFileBatchSize=1, CamelFileNameOnly=file.txt, CamelFileBatchIndex=0, CamelFileLastModified=Mon Mar 09 12:23:23 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFilePath=temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileHost=192.168.51.5, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:org.apache.camel.component.file.remote.RemoteFile, Body:
&lt;/span&gt;[e.remote.SftpComponent@15dc37d] RouterComponent                INFO  message GenericFileMessage: GenericFile[temp/incoming/file.txt]
[e.remote.SftpComponent@15dc37d] RouterComponent                INFO  filename file.txt
[e.remote.SftpComponent@15dc37d] TraceInterceptor               INFO  ID-DELLPD-3120-1236601791200-2-0 &amp;gt;&amp;gt;&amp;gt; process(com.xxx.xxx.router.RouterComponent$1@c5122f) --&amp;gt; to(file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 12:23:23 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
&lt;/span&gt;[e.remote.SftpComponent@15dc37d] GenericFileProducer            DEBUG Wrote [c:\fileserver\file.txt] to [Endpoint[file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver]]
&lt;/span&gt;[e.remote.SftpComponent@15dc37d] TraceInterceptor               INFO  ID-DELLPD-3120-1236601791200-2-0 &amp;gt;&amp;gt;&amp;gt; to(file:&lt;span class=&quot;code-comment&quot;&gt;//c://fileserver) --&amp;gt; setHeader(groovy: in.headers.filename), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 12:23:23 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=temp/incoming/file.txt, CamelFileParent=temp/incoming, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
&lt;/span&gt;[e.remote.SftpComponent@15dc37d] TraceInterceptor               INFO  ID-DELLPD-3120-1236601791200-2-0 &amp;gt;&amp;gt;&amp;gt; setHeader(groovy: in.headers.filename) --&amp;gt; setBody(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 12:23:23 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=temp/incoming/file.txt, CamelFileParent=temp/incoming, filename=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
[e.remote.SftpComponent@15dc37d] TraceInterceptor               INFO  ID-DELLPD-3120-1236601791200-2-0 &amp;gt;&amp;gt;&amp;gt; setBody(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) --&amp;gt; to(activemq:queue:print), Pattern:InOnly, Headers:{CamelFileNameOnly=file.txt, CamelFileLastModified=Mon Mar 09 12:23:23 GMT 2009, CamelFileRelativePath=temp/incoming/file.txt, CamelFileAbsolutePath=temp/incoming/file.txt, CamelFileName=file.txt, CamelFilePath=temp/incoming/file.txt, CamelFileParent=temp/incoming, filename=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, CamelFileNameProduced=c:\fileserver\file.txt, CamelFileAbsolute=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, BodyType:java.io.ByteArrayOutputStream, Body:
[e.remote.SftpComponent@15dc37d] ObjectHelper                   WARN  Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX
[e.remote.SftpComponent@15dc37d] SftpConsumer                   DEBUG Done processing file: GenericFile[temp/incoming/file.txt]. Status is: processed OK
[e.remote.SftpComponent@15dc37d] SftpConsumer                   DEBUG Committing remote file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@1f42731 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file: GenericFile[temp/incoming/file.txt]
[e.remote.SftpComponent@15dc37d] GenericFile                    DEBUG Changing name to: temp/incoming/.done/file.txt
[e.remote.SftpComponent@15dc37d] GenericFile                    DEBUG Name changed: GenericFile[temp/incoming/.done/file.txt]
[e.remote.SftpComponent@15dc37d] SftpOperations                 DEBUG Deleteing file: temp/incoming/.done/file.txt
[e.remote.SftpComponent@15dc37d] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile[temp/incoming/file.txt] to: GenericFile[temp/incoming/.done/file.txt]
[e.remote.SftpComponent@15dc37d] SftpOperations                 DEBUG Renaming file: temp/incoming/file.txt to: temp/incoming/.done/file.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12951216" author="davsclaus" created="Mon, 9 Mar 2009 13:20:27 +0000"  >&lt;p&gt;Great. This was a long operation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Paddy I have removed some crux code.&lt;br/&gt;
Could you update and try again. To make sure it still works for you.&lt;/p&gt;

&lt;p&gt;Committed revision 751673.&lt;/p&gt;</comment>
                            <comment id="12951200" author="watcher" created="Mon, 9 Mar 2009 13:38:14 +0000"  >&lt;p&gt;Yeah, still working.&lt;/p&gt;

&lt;p&gt;Great stuff Claus.&lt;/p&gt;</comment>
                            <comment id="12951180" author="davsclaus" created="Mon, 9 Mar 2009 14:42:26 +0000"  >&lt;p&gt;Paddy. &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1441&quot; title=&quot;camel-file : java.lang.StringIndexOutOfBoundsException: String index out of range: 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1441&quot;&gt;&lt;del&gt;CAMEL-1441&lt;/del&gt;&lt;/a&gt; had a bug with the file component on Windows.&lt;/p&gt;

&lt;p&gt;Can you try again to test if your SFTP is still working&lt;br/&gt;
Committed revision 751694.&lt;/p&gt;</comment>
                            <comment id="12951187" author="watcher" created="Mon, 9 Mar 2009 14:55:48 +0000"  >&lt;p&gt;yeah, still works , no problems to report&lt;/p&gt;</comment>
                            <comment id="12951178" author="davsclaus" created="Mon, 9 Mar 2009 15:30:51 +0000"  >&lt;p&gt;Okay Paddy, this is is finally fixed. You got me out for a spin &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Glad you could help so much and be very quick to respond and try all my attempts.&lt;/p&gt;</comment>
                            <comment id="12951203" author="davsclaus" created="Wed, 11 Mar 2009 07:32:38 +0000"  >&lt;p&gt;Paddy with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1440&quot; title=&quot;Camel VFS - move and preMove options be a bit easier to setup to just move into a sub dir of current dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1440&quot;&gt;&lt;del&gt;CAMEL-1440&lt;/del&gt;&lt;/a&gt; you should be able to enter the move option a bit more simple&lt;/p&gt;

&lt;p&gt;before:&lt;br/&gt;
move=${&lt;a href=&quot;file:parent&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:parent&lt;/a&gt;}/.done/${&lt;a href=&quot;file:name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:name&lt;/a&gt;}&lt;/p&gt;

&lt;p&gt;now:&lt;br/&gt;
move=.done&lt;/p&gt;

</comment>
                            <comment id="12951145" author="watcher" created="Wed, 11 Mar 2009 09:32:18 +0000"  >&lt;p&gt;Great, &lt;br/&gt;
thanks for the update&lt;/p&gt;</comment>
                            <comment id="12949834" author="davsclaus" created="Fri, 31 Jul 2009 06:34:12 +0000"  >&lt;p&gt;Closing 2.0m1 tickets&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12485755">CAMEL-1430</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12462769" name="camel-error.txt" size="4424" author="watcher" created="Thu, 5 Mar 2009 17:08:56 +0000"/>
                            <attachment id="12462698" name="camel-error2.txt" size="14458" author="watcher" created="Thu, 5 Mar 2009 19:54:55 +0000"/>
                            <attachment id="12462736" name="camel-error3.txt" size="5808" author="watcher" created="Fri, 6 Mar 2009 09:26:57 +0000"/>
                            <attachment id="12462833" name="camel-error4.txt" size="6238" author="watcher" created="Fri, 6 Mar 2009 18:32:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01icv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>