<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:29:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12573] ClassCastException thrown KafkaSpanDecorator</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12573</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;ClassCastException is thrown by `KafkaSpanDecorator` for the Partition and the Offset header values. The fix to this is to cast the partition to an Integer and the Offset to a Long. I have got a fix for it and here is a pull request for it:&#160;&lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-06-12 16:36:26.224 WARN 34820 --- [kaConsumer[ocr]] o.a.camel.opentracing.OpenTracingTracer : OpenTracing: Failed to capture tracing data

java.lang.ClassCastException: java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
at org.apache.camel.opentracing.decorators.KafkaSpanDecorator.pre(KafkaSpanDecorator.java:61) ~[camel-opentracing-2.21.0.jar:2.21.0]
at org.apache.camel.opentracing.OpenTracingTracer$OpenTracingRoutePolicy.onExchangeBegin(OpenTracingTracer.java:297) ~[camel-opentracing-2.21.0.jar:2.21.0]
at org.apache.camel.processor.CamelInternalProcessor$RoutePolicyAdvice.before(CamelInternalProcessor.java:495) [camel-core-2.21.0.jar:2.21.0]
at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:149) [camel-core-2.21.0.jar:2.21.0]
at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:97) [camel-core-2.21.0.jar:2.21.0]
at org.apache.camel.component.kafka.KafkaConsumer$KafkaFetchRecords.doRun(KafkaConsumer.java:295) [camel-kafka-2.21.0.jar:2.21.0]
at org.apache.camel.component.kafka.KafkaConsumer$KafkaFetchRecords.run(KafkaConsumer.java:187) [camel-kafka-2.21.0.jar:2.21.0]
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_151]
at java.util.concurrent.FutureTask.run(FutureTask.java:266) [na:1.8.0_151]
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_151]
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_151]
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [na:1.8.0_151]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13165602">CAMEL-12573</key>
            <summary>ClassCastException thrown KafkaSpanDecorator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="akhettar">ayache khettar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2018 15:41:59 +0000</created>
                <updated>Thu, 14 Jun 2018 08:25:30 +0000</updated>
                            <resolved>Wed, 13 Jun 2018 06:19:06 +0000</resolved>
                                                    <fixVersion>2.20.4</fixVersion>
                    <fixVersion>2.21.2</fixVersion>
                    <fixVersion>2.22.0</fixVersion>
                                    <component>camel-opentracing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16509774" author="githubbot" created="Tue, 12 Jun 2018 15:47:12 +0000"  >&lt;p&gt;akhettar opened a new pull request #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I have introduced a generic method which extracts the values of the `Partition` and the `Offset` from the Exchange headers according to their corresponding types.&lt;/p&gt;

&lt;p&gt;   Here is the Jira ticket for it.&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12573&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16509775" author="githubbot" created="Tue, 12 Jun 2018 15:47:13 +0000"  >&lt;p&gt;GitHub user akhettar opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;/p&gt;

&lt;p&gt;    I have introduced a generic method which extracts the values of the `Partition` and the `Offset` from the Exchange headers according to their corresponding types.&lt;/p&gt;

&lt;p&gt;    Here is the Jira ticket for it.&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12573&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/akhettar/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/akhettar/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2372.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2372&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit aa9464cdd8a30ff9a88bf893999158ec7c8ae40e&lt;br/&gt;
Author: akhettar &amp;lt;ayache@...&amp;gt;&lt;br/&gt;
Date:   2018-06-12T15:31:12Z&lt;/p&gt;

&lt;p&gt;    Fixing class cast exception. Handling kafka.Partition as Integer and kafka.Offset as a Long.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16509777" author="akhettar" created="Tue, 12 Jun 2018 15:48:46 +0000"  >&lt;p&gt;Can anyone review this for me, please? Pull request:&#160;&lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16509778" author="githubbot" created="Tue, 12 Jun 2018 15:49:41 +0000"  >&lt;p&gt;oscerd commented on issue #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372#issuecomment-396639580&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372#issuecomment-396639580&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Can you please add the Jira number to the commit message? Otherwise it looks good.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16509809" author="githubbot" created="Tue, 12 Jun 2018 16:10:56 +0000"  >&lt;p&gt;akhettar commented on issue #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372#issuecomment-396646766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372#issuecomment-396646766&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @oscerd I&apos;ve just amended the commit with the Jira nunber&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16509810" author="githubbot" created="Tue, 12 Jun 2018 16:11:06 +0000"  >&lt;p&gt;akhettar commented on issue #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372#issuecomment-396646766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372#issuecomment-396646766&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @oscerd I&apos;ve just amended the commit with the Jira number&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16510674" author="githubbot" created="Wed, 13 Jun 2018 06:19:22 +0000"  >&lt;p&gt;oscerd commented on issue #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372#issuecomment-396826349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372#issuecomment-396826349&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged on master, 2.21.x and 2.20.x, thanks.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16510675" author="githubbot" created="Wed, 13 Jun 2018 06:19:22 +0000"  >&lt;p&gt;oscerd closed pull request #2372: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12573&quot; title=&quot;ClassCastException thrown KafkaSpanDecorator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12573&quot;&gt;&lt;del&gt;CAMEL-12573&lt;/del&gt;&lt;/a&gt;: Fixing class cast exception&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-opentracing/src/main/java/org/apache/camel/opentracing/decorators/KafkaSpanDecorator.java b/components/camel-opentracing/src/main/java/org/apache/camel/opentracing/decorators/KafkaSpanDecorator.java&lt;br/&gt;
index ecc92797d58..1ec0a6886eb 100644&lt;br/&gt;
&amp;#8212; a/components/camel-opentracing/src/main/java/org/apache/camel/opentracing/decorators/KafkaSpanDecorator.java&lt;br/&gt;
+++ b/components/camel-opentracing/src/main/java/org/apache/camel/opentracing/decorators/KafkaSpanDecorator.java&lt;br/&gt;
@@ -58,7 +58,7 @@ public String getDestination(Exchange exchange, Endpoint endpoint) {&lt;br/&gt;
     public void pre(Span span, Exchange exchange, Endpoint endpoint) {&lt;br/&gt;
         super.pre(span, exchange, endpoint);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String partition = (String)exchange.getIn().getHeader(PARTITION);&lt;br/&gt;
+        String partition = getValue(exchange, PARTITION, Integer.class);&lt;br/&gt;
         if (partition != null) 
{
             span.setTag(KAFKA_PARTITION_TAG, partition);
         }
&lt;p&gt;@@ -73,10 +73,22 @@ public void pre(Span span, Exchange exchange, Endpoint endpoint) &lt;/p&gt;
{
             span.setTag(KAFKA_KEY_TAG, key);
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String offset = (String)exchange.getIn().getHeader(OFFSET);&lt;br/&gt;
+        String offset = getValue(exchange, OFFSET, Long.class);&lt;br/&gt;
         if (offset != null) 
{
             span.setTag(KAFKA_OFFSET_TAG, offset);
         }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    /**&lt;br/&gt;
+     * Extracts header value from the exchange for given header&lt;br/&gt;
+     * @param exchange the &lt;/p&gt;
{@link Exchange}
&lt;p&gt;+     * @param header the header name&lt;br/&gt;
+     * @param type the class type of the exchange header&lt;br/&gt;
+     * @return&lt;br/&gt;
+     */&lt;br/&gt;
+    private &amp;lt;T&amp;gt; String getValue(final Exchange exchange, final String header, Class&amp;lt;T&amp;gt; type) &lt;/p&gt;
{
+         T partition = exchange.getIn().getHeader(header, type);
+         return partition != null ? String.valueOf(partition) : exchange.getIn().getHeader(header, String.class);
+    }
&lt;p&gt;+&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/components/camel-opentracing/src/test/java/org/apache/camel/opentracing/decorators/KafkaSpanDecoratorTest.java b/components/camel-opentracing/src/test/java/org/apache/camel/opentracing/decorators/KafkaSpanDecoratorTest.java&lt;br/&gt;
index b3eda9c3770..2c51def5b47 100644&lt;br/&gt;
&amp;#8212; a/components/camel-opentracing/src/test/java/org/apache/camel/opentracing/decorators/KafkaSpanDecoratorTest.java&lt;br/&gt;
+++ b/components/camel-opentracing/src/test/java/org/apache/camel/opentracing/decorators/KafkaSpanDecoratorTest.java&lt;br/&gt;
@@ -19,6 +19,7 @@&lt;br/&gt;
 import io.opentracing.mock.MockSpan;&lt;br/&gt;
 import io.opentracing.mock.MockTracer;&lt;/p&gt;

&lt;p&gt;+import jdk.nashorn.internal.IntDeque;&lt;br/&gt;
 import org.apache.camel.Endpoint;&lt;br/&gt;
 import org.apache.camel.Exchange;&lt;br/&gt;
 import org.apache.camel.Message;&lt;br/&gt;
@@ -59,7 +60,7 @@ public void testGetDestinationNoHeaderTopic() {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     @Test&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void testPre() {&lt;br/&gt;
+    public void testPreOffsetAndPartitionAsStringHeader() {&lt;br/&gt;
         String testKey = &quot;TestKey&quot;;&lt;br/&gt;
         String testOffset = &quot;TestOffset&quot;;&lt;br/&gt;
         String testPartition = &quot;TestPartition&quot;;&lt;br/&gt;
@@ -72,8 +73,8 @@ public void testPre() {&lt;br/&gt;
         Mockito.when(endpoint.getEndpointUri()).thenReturn(&quot;test&quot;);&lt;br/&gt;
         Mockito.when(exchange.getIn()).thenReturn(message);&lt;br/&gt;
         Mockito.when(message.getHeader(KafkaSpanDecorator.KEY)).thenReturn(testKey);&lt;/li&gt;
	&lt;li&gt;Mockito.when(message.getHeader(KafkaSpanDecorator.OFFSET)).thenReturn(testOffset);&lt;/li&gt;
	&lt;li&gt;Mockito.when(message.getHeader(KafkaSpanDecorator.PARTITION)).thenReturn(testPartition);&lt;br/&gt;
+        Mockito.when(message.getHeader(KafkaSpanDecorator.OFFSET, String.class)).thenReturn(testOffset);&lt;br/&gt;
+        Mockito.when(message.getHeader(KafkaSpanDecorator.PARTITION, String.class)).thenReturn(testPartition);&lt;br/&gt;
         Mockito.when(message.getHeader(KafkaSpanDecorator.PARTITION_KEY)).thenReturn(testPartitionKey);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         SpanDecorator decorator = new KafkaSpanDecorator();&lt;br/&gt;
@@ -89,4 +90,29 @@ public void testPre() &lt;/p&gt;
{
         assertEquals(testPartitionKey, span.tags().get(KafkaSpanDecorator.KAFKA_PARTITION_KEY_TAG));
     }

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void testPrePartitionAsIntegerHeaderAndOffsetAsLongHeader() &lt;/p&gt;
{
+        Long testOffset = 4875454l;
+        Integer testPartition = 0;
+
+        Endpoint endpoint = Mockito.mock(Endpoint.class);
+        Exchange exchange = Mockito.mock(Exchange.class);
+        Message message = Mockito.mock(Message.class);
+
+        Mockito.when(endpoint.getEndpointUri()).thenReturn(&quot;test&quot;);
+        Mockito.when(exchange.getIn()).thenReturn(message);
+        Mockito.when(message.getHeader(KafkaSpanDecorator.OFFSET, Long.class)).thenReturn(testOffset);
+        Mockito.when(message.getHeader(KafkaSpanDecorator.PARTITION, Integer.class)).thenReturn(testPartition);
+
+        SpanDecorator decorator = new KafkaSpanDecorator();
+
+        MockTracer tracer = new MockTracer();
+        MockSpan span = tracer.buildSpan(&quot;TestSpan&quot;).start();
+
+        decorator.pre(span, exchange, endpoint);
+
+        assertEquals(String.valueOf(testOffset), span.tags().get(KafkaSpanDecorator.KAFKA_OFFSET_TAG));
+        assertEquals(String.valueOf(testPartition), span.tags().get(KafkaSpanDecorator.KAFKA_PARTITION_TAG));
+    }
&lt;p&gt;+&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16510676" author="githubbot" created="Wed, 13 Jun 2018 06:19:23 +0000"  >&lt;p&gt;Github user oscerd closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2372&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16511390" author="akhettar" created="Wed, 13 Jun 2018 16:29:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ancosen&quot; class=&quot;user-hover&quot; rel=&quot;ancosen&quot;&gt;ancosen&lt;/a&gt; any idea in which release this fix is going to be?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16511396" author="ancosen" created="Wed, 13 Jun 2018 16:32:51 +0000"  >&lt;p&gt;2.22.0,2.21.2 and 2.20.4&lt;/p&gt;</comment>
                            <comment id="16512151" author="akhettar" created="Thu, 14 Jun 2018 08:25:30 +0000"  >&lt;p&gt;Many thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3uryf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>