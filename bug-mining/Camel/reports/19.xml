<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:24:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-154] Improper wiring of camel context using Spring</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-154</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using spring to wire camel components, the whole magic is driven by org.springframework.context.support.AbstractApplicationContext.refresh().&lt;/p&gt;

&lt;p&gt;At about line 327 the xml file is read and at some point AbstractApplicationContext.doParse is called.  What is notable is that we use parseUsingJaxb (line 135) instead of the spring way of doing things, and then we still use &lt;br/&gt;
BeanDefinitionParser(s) to build the BeanDefinition(s).&lt;/p&gt;

&lt;p&gt;On a sample context definition like the one in the unit tests:&lt;br/&gt;
  &amp;lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;beanPostProcessor/&amp;gt;&lt;br/&gt;
    &amp;lt;endpoint id=&quot;endpoint1&quot; uri=&quot;direct:start&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;endpoint id=&quot;endpoint2&quot; uri=&quot;mock:end&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;route&amp;gt;&lt;br/&gt;
      &amp;lt;from ref=&quot;endpoint1&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;to ref=&quot;endpoint2&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/route&amp;gt;&lt;br/&gt;
  &amp;lt;/camelContext&amp;gt;&lt;br/&gt;
The jaxb parser instantiates the BeanPostProcessor, endpoints, the RouteType, From/ToTypes properly, but the BeanPostProcessor is not injected with the camelContext and applicationContext, obviously.&lt;/p&gt;

&lt;p&gt;Later on in AbstractApplicationContext.refresh() during the registerBeanPostProcessors() call (line 337) spring figures out that it needs to instantiate the BeanPostProcessor first and use it before it initializes the other beans.  So far so good, but in doing so there are 2 major problems.&lt;br/&gt;
1. It uses the BeanDefinition instead of the instance already created during jaxb parsing.&lt;br/&gt;
2. There is a chicken and egg situation; while it initializes &quot;camel:beanPostProcessor&quot;, it looks for a &quot;camel&quot; bean which isn&apos;t registered yet.  The model for it does exist though, so a new instance of the CamelContextFactoryBean gets instantiated (and the id now is null instead of &quot;camel&quot; as in the spring xml).&lt;/p&gt;

&lt;p&gt;I wrestled with this and couldn&apos;t figure out a solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12485887">CAMEL-154</key>
            <summary>Improper wiring of camel context using Spring</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hadrian">Hadrian Zbarcea</assignee>
                                    <reporter username="hadrian">Hadrian Zbarcea</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Sep 2007 14:31:44 +0000</created>
                <updated>Wed, 14 Jul 2010 23:42:02 +0000</updated>
                            <resolved>Tue, 25 Sep 2007 15:52:50 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>camel-spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12946076" author="hzbarcea" created="Tue, 25 Sep 2007 15:01:53 +0000"  >&lt;p&gt;The issue was the id not being set on the BeanDefinition, so when Spring initialized the CamelContextFactoryBean, the id was missing.&lt;/p&gt;

&lt;p&gt;I also refactored the jmx naming conventions with this patch&lt;/p&gt;</comment>
                            <comment id="12946123" author="chirino" created="Tue, 25 Sep 2007 15:52:50 +0000"  >&lt;p&gt;Patch applied rev 579301&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462407" name="camel-154.patch" size="12770" author="hzbarcea" created="Tue, 25 Sep 2007 15:01:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83162</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01ahb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5467</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>