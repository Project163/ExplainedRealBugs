<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:52:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-17592] concurrentConsumers URI parameter not working with aws2-sqs endpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-17592</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The concurrentConsumers URI parameter is not taken into account by the endpoint.&lt;br/&gt;
We can reproduce the issue with the following prototype:&lt;/p&gt;

&lt;p&gt;from(&quot;aws2-sqs://queuexxx?concurrentConsumers=5&amp;amp;amazonSQSClient=#sqsClient&amp;amp;&lt;br/&gt;
waitTimeSeconds=20&quot;)&lt;br/&gt;
.process(exchange -&amp;gt; &lt;/p&gt;
{
&#160; &#160; &#160;System.out.println(&quot;Message received...&quot;);
}
&lt;p&gt;)&lt;br/&gt;
.process(exchange -&amp;gt; {&lt;br/&gt;
&#160; &#160; &#160;try &lt;/p&gt;
{
&#160; &#160; &#160; &#160; Thread.sleep(5000);
&#160; &#160; &#160;}
&lt;p&gt; catch (InterruptedException e) {&lt;br/&gt;
&#160; &#160; &#160; &#160; e.printStackTrace();&lt;br/&gt;
&#160; &#160; &#160;}});&lt;/p&gt;

&lt;p&gt;With the above queue, if we send 3 messages, we have to wait&lt;br/&gt;
5 seconds to see the second message (&quot;Message received...&quot;) and 5 more&lt;br/&gt;
seconds to see the third one. The expected behavior is to see the 3 messages&lt;br/&gt;
consumed without delay since 3 threads will consume them in parallel.&lt;/p&gt;

&lt;p&gt;Turning on the Camel logs it seems that the next polling is done only after&lt;br/&gt;
the Delete for the previous message is sent (which is with a delay of 5s).&lt;br/&gt;
The messages are read 1 by 1 (=1 message per polling) so the above behavior is not seen because the message are consumed together by one polling and continue in the same thread.&lt;/p&gt;

&lt;p&gt;Note that, as commented by Narsi Reddy Nallamilli in the user mailing list, we obtain the expected behavior by adding a delay in the route as follow:&#160;&lt;/p&gt;

&lt;p&gt;from(&quot;aws2-sqs://queuexxx?concurrentConsumers=5&amp;amp;amazonSQSClient=#sqsClient&amp;amp;&lt;br/&gt;
waitTimeSeconds=20&quot;)&lt;br/&gt;
.delay(1L)&lt;br/&gt;
.process(exchange -&amp;gt; &lt;/p&gt;
{
&#160; &#160; System.out.println(&quot;Message received...&quot;);
}
&lt;p&gt;)&lt;br/&gt;
.process(exchange -&amp;gt; {&lt;br/&gt;
&#160; &#160; try &lt;/p&gt;
{
&#160; &#160; &#160; &#160;Thread.sleep(5000);
&#160; &#160; }
&lt;p&gt; catch (InterruptedException e) {&lt;br/&gt;
&#160; &#160; &#160; &#160;e.printStackTrace();&lt;br/&gt;
&#160; &#160; }});&lt;/p&gt;</description>
                <environment>&lt;p&gt;&amp;lt;dependency&amp;gt;&lt;br/&gt;
&amp;lt;groupId&amp;gt;org.apache.camel.springboot&amp;lt;/groupId&amp;gt;&lt;br/&gt;
&amp;lt;artifactId&amp;gt;camel-aws2-sqs-starter&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
&amp;lt;version&amp;gt;3.13.0&amp;lt;/version&amp;gt;&lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;/p&gt;</environment>
        <key id="13426357">CAMEL-17592</key>
            <summary>concurrentConsumers URI parameter not working with aws2-sqs endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="arnaudlbcn">Arnaud Level</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2022 09:06:56 +0000</created>
                <updated>Thu, 3 Feb 2022 17:02:43 +0000</updated>
                            <resolved>Thu, 3 Feb 2022 17:02:43 +0000</resolved>
                                    <version>3.13.0</version>
                                    <fixVersion>3.11.6</fixVersion>
                    <fixVersion>3.14.2</fixVersion>
                    <fixVersion>3.16.0</fixVersion>
                                    <component>camel-aws</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17486435" author="JIRAUSER283233" created="Thu, 3 Feb 2022 12:44:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arnaudlbcn&quot; class=&quot;user-hover&quot; rel=&quot;arnaudlbcn&quot;&gt;arnaudlbcn&lt;/a&gt; The expected behavior which you are seeking is changed with &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-16383&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-16383&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;By default the consumer creates a defaultScheduler with only one thread which is why&#160; the messages are consumed serially. Before the change the scheduler thread are created based on concurrentConsumers attribute value, that is why it used to work.&lt;/p&gt;

&lt;p&gt;You need to specify your own scheduler with &apos;scheduledExecutorService&apos; as shown in&#160; &lt;a href=&quot;https://camel.apache.org/components/3.7.x/aws2-sqs-component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/components/3.7.x/aws2-sqs-component.html&lt;/a&gt; with required pool size to work the way you want.&lt;/p&gt;

&lt;p&gt;However I have tried this and it is not honoring the attribute. The issue is in &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-aws/camel-aws2-sqs/src/main/java/org/apache/camel/component/aws2/sqs/Sqs2Endpoint.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/components/camel-aws/camel-aws2-sqs/src/main/java/org/apache/camel/component/aws2/sqs/Sqs2Endpoint.java&lt;/a&gt; where it creates the consumer with default schedule. It should consider the provided custom schedule if exists.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Consumer createConsumer(Processor processor) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    Sqs2Consumer sqsConsumer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Sqs2Consumer(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, processor);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.configureConsumer(sqsConsumer);
    sqsConsumer.setMaxMessagesPerPoll(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxMessagesPerPoll);
    DefaultScheduledPollConsumerScheduler scheduler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultScheduledPollConsumerScheduler(); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;&#160; can you please have a look?&lt;/p&gt;</comment>
                            <comment id="17486539" author="davsclaus" created="Thu, 3 Feb 2022 15:08:44 +0000"  >&lt;p&gt;Yeah that seems like something that can be improved&lt;/p&gt;</comment>
                            <comment id="17486555" author="davsclaus" created="Thu, 3 Feb 2022 15:36:43 +0000"  >&lt;p&gt;There is a fix on main branch at&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/599a3a0e2ab610e71dafe326965d697b8061db06&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/599a3a0e2ab610e71dafe326965d697b8061db06&lt;/a&gt;&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0z7rc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>