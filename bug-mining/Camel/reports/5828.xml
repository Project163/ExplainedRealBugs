<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:49:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16906] Platform-http components fail when using unmarshal</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16906</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When we run a route which is using platform-http component and we try to unmarshal to json (and I suspect also any other dataformat), there is a failure due to a missing conversion type.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    from(&lt;span class=&quot;code-quote&quot;&gt;&quot;platform-http:/hello?httpMethodRestrict=GET&quot;&lt;/span&gt;).
      setBody(simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;hello\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;world\&lt;span class=&quot;code-quote&quot;&gt;&quot;}&quot;&lt;/span&gt;))
      .unmarshal().json();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will fail because there is a &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpSupport.java#L183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mandatory conversion from Map to ByteBuffer&lt;/a&gt; that is failing.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[1] 2021-08-31 13:41:58,676 ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (vert.x-eventloop-thread-1) HTTP Request to /hello failed, error id: 3ea4fdb8-931c-4d59-b8e6-376dc6a34e09-1: org.apache.camel.NoTypeConversionAvailableException: No type converter available to convert from type: java.util.LinkedHashMap to the required type: java.nio.ByteBuffer with value {hello=world}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13398467">CAMEL-16906</key>
            <summary>Platform-http components fail when using unmarshal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="squakez">Pasquale Congiusti</assignee>
                                    <reporter username="squakez">Pasquale Congiusti</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Aug 2021 13:23:31 +0000</created>
                <updated>Fri, 3 Dec 2021 08:22:26 +0000</updated>
                            <resolved>Fri, 3 Dec 2021 08:22:26 +0000</resolved>
                                    <version>3.11.1</version>
                    <version>3.12.0</version>
                                    <fixVersion>3.14.0</fixVersion>
                                    <component>camel-platform-http-vertx</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17407355" author="squakez" created="Tue, 31 Aug 2021 13:44:57 +0000"  >&lt;p&gt;A possible solution would be to include a conversion to ByteBuffer in each dataformat. I have drafted a POC and made some test for jackson dataformat: &lt;a href=&quot;https://github.com/apache/camel/pull/6016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/6016&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17409495" author="davsclaus" created="Fri, 3 Sep 2021 13:10:51 +0000"  >&lt;p&gt;Yeah sure, but it also helps if instead of using ByteBuffer as fallback in the writeResponse of platform-vertx, then use InputStream as fallback, as a lot more can be converter to this in Camel.&lt;/p&gt;
</comment>
                            <comment id="17409500" author="squakez" created="Fri, 3 Sep 2021 13:18:18 +0000"  >&lt;p&gt;I didn&apos;t think about it, let me try your suggested approach and see how it goes. I will reopen this issue while we have a final fix.&lt;/p&gt;</comment>
                            <comment id="17411023" author="squakez" created="Tue, 7 Sep 2021 08:18:33 +0000"  >&lt;p&gt;I managed to give a look and here my assessment:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;certain dataformats (ie, the json ones) still need a conversion to InputStream so we need to make some code change to them. However the impact will be reduced as many other have an InputStream fallback converter.&lt;/li&gt;
	&lt;li&gt;as far I can understand from the code, the Vert.x component is designed to prefer java.nio.ByteBuffer for performances reason. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lburgazzoli&quot; class=&quot;user-hover&quot; rel=&quot;lburgazzoli&quot;&gt;lburgazzoli&lt;/a&gt;, I&apos;ve seen you originally developed the &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpSupport.java#L183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;part involved in this discussion&lt;/a&gt;. I&apos;d appreciate if you can confirm this thought.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Given this quick analysis, my proposal is to still &lt;b&gt;try&lt;/b&gt; to convert to ByteBuffer as it is now but if that is not available, to finally fallback to InputStream. In this way we should be able to maintain compatibility and keep the original design.&lt;/p&gt;</comment>
                            <comment id="17419841" author="davsclaus" created="Fri, 24 Sep 2021 15:20:34 +0000"  >&lt;p&gt;Okay we should revert this as this causes unforseen problem because we use fallback converters in those json libraries. So that means they end up taking any kind of Java object and convert to InputStream. Even objects the json parser would not support.&lt;/p&gt;</comment>
                            <comment id="17419847" author="davsclaus" created="Fri, 24 Sep 2021 15:22:26 +0000"  >&lt;p&gt;For a general solution then we cannot risk such change in the LTS patch branch so moving this to 3.12 or 3.13&lt;/p&gt;</comment>
                            <comment id="17419850" author="davsclaus" created="Fri, 24 Sep 2021 15:23:27 +0000"  >&lt;p&gt;Since this is is mainly a VertX problem with the platform-http (eg its a vertx http server underneed) then we can make something for the vertx side of things for the 3.11 LTS branch&lt;/p&gt;</comment>
                            <comment id="17419852" author="davsclaus" created="Fri, 24 Sep 2021 15:24:10 +0000"  >&lt;p&gt;This causes test failures in other components such as camel-serlvet and whatnot. But the general problem is that fallback type converter should be used with extra care.&lt;/p&gt;</comment>
                            <comment id="17419964" author="davsclaus" created="Fri, 24 Sep 2021 20:19:46 +0000"  >&lt;p&gt;I have reverted on main branch for 3.12.0 release.&lt;/p&gt;

&lt;p&gt;Lets find a better solution for this. And I think we should maybe add some more documentation about thinking twice before using fallback converters. I should have known better. &lt;/p&gt;

&lt;p&gt;For instance those json libraries like gson etc cannot be used to converter anything to InputStream as this would only work if you 100% know the object is json based. So maybe we can only do regular converters for known types that gson/json actually would support, or find some other way.&lt;/p&gt;</comment>
                            <comment id="17420545" author="squakez" created="Mon, 27 Sep 2021 08:00:18 +0000"  >&lt;p&gt;Thanks for taking care of it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; . I wonder if the original idea of including only a converter to ByteBuffer to the json dataformats would still cause troubles.&lt;/p&gt;</comment>
                            <comment id="17420569" author="davsclaus" created="Mon, 27 Sep 2021 08:33:40 +0000"  >&lt;p&gt;Yeah lets revisit this. I think if you can add the unit test in platform-http that you reported in the top, so we have that test-case, even if it fails. Then we can mark it as ignored, until we find the correct solution.&lt;/p&gt;</comment>
                            <comment id="17420775" author="davsclaus" created="Mon, 27 Sep 2021 14:20:59 +0000"  >&lt;p&gt;Okay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=squakez&quot; class=&quot;user-hover&quot; rel=&quot;squakez&quot;&gt;squakez&lt;/a&gt; we are able to use the work from platform-http-vertx&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/9825f640a104cd506487109e8d351ef84dc25118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/9825f640a104cd506487109e8d351ef84dc25118&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The camel-jackson can do the use-case you reported in the top. You just need to turn on its type converter support. You can do that also via a property if using camel-k etc.&lt;/p&gt;

&lt;p&gt;This will make it into Camel 3.12.0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13401008">CAMEL-16957</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ugjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>