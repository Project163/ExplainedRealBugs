<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:10:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-21816] camel-ai - Missing tool information when returning function call response</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-21816</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When a Camel route uses the LangChain4J-tools component, it calls the LLM, providing metadata about the tools (tool routes) available the LLM can use.&lt;/p&gt;

&lt;p&gt;The LLM computes the request and decides if a tool call is necessary or not. If the LLM performs a tool call, Camel executes the tool and returns the result to the LLM.&lt;/p&gt;

&lt;p&gt;However, the current implementation does not provide the Tools metadata (tools available) when returning the tool result.&lt;/p&gt;

&lt;p&gt;The consequence of Camel not including Tools metadata when returning the tool response is that the LLM understands there are no more Tools available, and concludes that subsequent tool calls are not allowed, forcing the LLM to compose a final response.&lt;/p&gt;

&lt;p&gt;The expected behaviour from Camel is to always provide a full history of tool calls and results, including the metadata of available tools the LLM can use at all times.&lt;/p&gt;

&lt;p&gt;Let&apos;s assume Camel asks the LLM the following question:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&quot;what is the weather in London?&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Camel calls the LLM and provides metadata listing the tools available to the LLM. In this example, it would provide:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tool to find the geo-coordinates for a given city&lt;/li&gt;
	&lt;li&gt;Tool to obtain weather information for a given longitude and latitude&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The LLM needs to first obtain from Camel the geo-coordinates for London, and in a subsequent call, invoke the second tool to obtain the weather passing the geo-coordinates obtained in the first call.&lt;/p&gt;

&lt;p&gt;When Camel returns the result of the geo-coordinates tool call, the current implementation is missing to provide tools metadata. The sample below shows all the data Camel needs to provide to allow the LLM to call a second time:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Request:
- method: POST
- url: http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:11434/api/chat
&lt;/span&gt;- headers: [Accept: application/json], [Content-Type: application/json], [User-Agent: Apache Camel], [content-length: 2257]
- body: {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;model&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qwen2.5:7b-instruct&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;messages&quot;&lt;/span&gt; : [ {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;system&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;    You are a meteorologist, and you need to answer questions asked by the user about weather using at most 3 lines.\n\n    The weather information is a JSON object and has the following fields:\n\n    maxTemperature is the maximum temperature of the day in Celsius degrees\n    minTemperature is the minimum temperature of the day in Celsius degrees\n    precipitation is the amount of water in mm\n    windSpeed is the speed of wind in kilometers per hour\n    weather is the overall weather.\n&quot;&lt;/span&gt;
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;What is the weather in london ?&quot;&lt;/span&gt;
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;assistant&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;tool_calls&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;function&quot;&lt;/span&gt; : {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;findCity&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;arguments&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;london&quot;&lt;/span&gt;
        }
      }
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;tool&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;{\n  \&quot;&lt;/span&gt;results\&lt;span class=&quot;code-quote&quot;&gt;&quot; : [ {\n    \&quot;&lt;/span&gt;latitude\&lt;span class=&quot;code-quote&quot;&gt;&quot; : 51.50853,\n    \&quot;&lt;/span&gt;longitude\&lt;span class=&quot;code-quote&quot;&gt;&quot; : -0.12574\n  } ]\n}&quot;&lt;/span&gt;
  } ],
  
  &lt;span class=&quot;code-quote&quot;&gt;&quot;tools&quot;&lt;/span&gt; : [ {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;function&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;function&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;forecast&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;description&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Forecasts the weather &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given latitude and longitude&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;parameters&quot;&lt;/span&gt; : {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;object&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;latitude&quot;&lt;/span&gt; : {
            &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;number&quot;&lt;/span&gt;
          },
          &lt;span class=&quot;code-quote&quot;&gt;&quot;longitude&quot;&lt;/span&gt; : {
            &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;number&quot;&lt;/span&gt;
          }
        },
        &lt;span class=&quot;code-quote&quot;&gt;&quot;required&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;latitude&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;longitude&quot;&lt;/span&gt; ]
      }
    }
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;function&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;function&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;findCity&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;description&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Finds the latitude and longitude of a given city&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;parameters&quot;&lt;/span&gt; : {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;object&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : {
            &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;
          }
        },
        &lt;span class=&quot;code-quote&quot;&gt;&quot;required&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; ]
      }
    }
  } ],
  &lt;span class=&quot;code-quote&quot;&gt;&quot;options&quot;&lt;/span&gt; : {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;temperature&quot;&lt;/span&gt; : 0.0,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;top_k&quot;&lt;/span&gt; : 40,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;top_p&quot;&lt;/span&gt; : 0.9
  },
  &lt;span class=&quot;code-quote&quot;&gt;&quot;stream&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note in the JSON data above that Camel provides both the result of the tool call (provides latitude and longitude for the city of London), and also provides (again) the list of available tools the LLM can use at all times if it decides to call again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13610135">CAMEL-21816</key>
            <summary>camel-ai - Missing tool information when returning function call response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="bruno.meseguer">Bruno Meseguer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Feb 2025 09:34:10 +0000</created>
                <updated>Wed, 2 Apr 2025 09:00:39 +0000</updated>
                            <resolved>Fri, 28 Mar 2025 10:02:11 +0000</resolved>
                                    <version>4.10.0</version>
                                    <fixVersion>4.10.4</fixVersion>
                    <fixVersion>4.12.0</fixVersion>
                                    <component>camel-ai</component>
                    <component>camel-langchain4j-tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17932927" author="orpiske" created="Thu, 6 Mar 2025 10:05:31 +0000"  >&lt;p&gt;Root cause: missing loop between lines 102 and 108 on the LangChain4jToolsProducer. It needs to re-evaluate the tools until it gets a not tools execution request response. &lt;/p&gt;</comment>
                            <comment id="17939182" author="ancosen" created="Fri, 28 Mar 2025 08:55:17 +0000"  >&lt;p&gt;Is this complete?&lt;/p&gt;</comment>
                            <comment id="17939195" author="orpiske" created="Fri, 28 Mar 2025 10:02:11 +0000"  >&lt;p&gt;This was resolved with the linked PRs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13610852">CAMEL-21839</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1uhvk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>